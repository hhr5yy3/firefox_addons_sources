import{a as J,b as Qo,c as Jo,d as li,e as De,f as Fe,g as ui,h as Xt}from"./chunk-2TNTZIHB.js";import{a as Ko}from"./chunk-AU5XKNPD.js";import{A as Go,B as Ae,C as Ie,F as Yo,H as ci,J as Mt,K as Zo,L as Pe,M as ts,a as vo,b as Co,c as Qt,d as si,e as xe,g as Lo,h as Oo,i as pi,j as Jt,k as Bo,l as zo,m as ft,n as Rt,o as Uo,p as Wo,r as It,s as Vo,t as Ho,v as qo,w as jo,x as Te,y as Se,z as Ne}from"./chunk-Z2ZWTSDM.js";import{a as wn}from"./chunk-4DY7Q7SZ.js";import{a as Ct,b as lt}from"./chunk-WDPQNPC7.js";import{C as ri,c as ko,e as Ro,g as ni,h as Ft,i as No,j as Gt,k as Ao,l as Io,m as Et,n as Yt,o as Po,q as wt,r as Do,s as B,t as Re,u as Fo,v as Eo,w as xt}from"./chunk-HMFVUZXK.js";import{a as So}from"./chunk-3REBBJSH.js";import{b as Mo,c as $o,d as ai}from"./chunk-543EMZFQ.js";import{a as ke,b as Ce}from"./chunk-L4RDDWJP.js";import{a as Xo}from"./chunk-34DZYYOD.js";import{a as At,d as oi,e as kt,h as ho,i as fo,k as jt,l as _o}from"./chunk-6BB4SG5R.js";import{b as To}from"./chunk-IJLSJJ7U.js";import{a as wo,c as bo,m as yo}from"./chunk-LG525BKV.js";import{a as go}from"./chunk-WOENBU2A.js";import{a as xo}from"./chunk-W32UHEZE.js";import{a as ei,b as gn}from"./chunk-3DLX7NOK.js";import{a as ao,b as hn}from"./chunk-4GJAJKDK.js";import{a as ye}from"./chunk-5GRN66PK.js";import{a as uo}from"./chunk-FVPQGETT.js";import{a as ve}from"./chunk-Z64FBUPL.js";import{a as H}from"./chunk-MT4LVDUX.js";import{a as ii}from"./chunk-WN4MFSKN.js";import{a as mo}from"./chunk-QUFHRGH2.js";import{a as bn}from"./chunk-BODFWMPN.js";import{a as R,b as lo,e as ge,f as b,h as we,i as be,n as yn}from"./chunk-LADTODTA.js";import{A as qt,B as k,c as v,d as po,g as it,j as co,r as c,v as N,x as fe,z as _e}from"./chunk-WRHUMLYF.js";import{a as ti,d as _n}from"./chunk-RXMLGJMT.js";import{G as fn,R as he,S as ro,q as Q,r as me}from"./chunk-OEPSEZ5A.js";import{c as Xe,e as r}from"./chunk-3GYLW4KZ.js";var bi=Xe(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.Collapse=void 0;var Me=Object.assign||function(s){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i])}return s},In=function(){function s(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}}(),Pn=R(),Le=bs(Pn),Dn=lo(),rt=bs(Dn),ws=ii();function bs(s){return s&&s.__esModule?s:{default:s}}function Fn(s,t){var e={};for(var i in s)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i]);return e}function En(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}function Mn(s,t){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:s}function $n(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);s.prototype=Object.create(t&&t.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(s,t):s.__proto__=t)}var Ln=1,$e="WAITING",gs="RESIZING",ys="RESTING",Ot="IDLING",wi=function(){return null},On={collapse:"ReactCollapse--collapse",content:"ReactCollapse--content"},vs=Oe.Collapse=function(s){$n(t,s);function t(e){En(this,t);var i=Mn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Bn.call(i),i.state={currentState:Ot,from:0,to:0},i}return In(t,[{key:"componentDidMount",value:function(){var i=this.props,o=i.isOpened,n=i.forceInitialAnimation,a=i.onRest;if(o){var p=this.getTo();if(n){var l=this.wrapper.clientHeight;this.setState({currentState:gs,from:l,to:p})}else this.setState({currentState:Ot,from:p,to:p})}a()}},{key:"componentWillReceiveProps",value:function(i){i.hasNestedCollapse?i.isOpened!==this.props.isOpened&&this.setState({currentState:$e}):this.state.currentState===Ot&&(i.isOpened||this.props.isOpened)&&this.setState({currentState:$e})}},{key:"componentDidUpdate",value:function(i,o){var n=this.props,a=n.isOpened,p=n.onRest,l=n.onMeasure;if(this.state.currentState===Ot){p();return}o.to!==this.state.to&&l({height:this.state.to,width:this.content.clientWidth});var u=this.wrapper.clientHeight,h=a?this.getTo():0;if(u!==h){this.setState({currentState:gs,from:u,to:h});return}(this.state.currentState===ys||this.state.currentState===$e)&&this.setState({currentState:Ot,from:u,to:h})}},{key:"componentWillUnmount",value:function(){cancelAnimationFrame(this.raf)}},{key:"render",value:function(){return Le.default.createElement(ws.Motion,Me({},this.getMotionProps(),{onRest:this.onRest,children:this.renderContent}))}}]),t}(Le.default.PureComponent);vs.propTypes={isOpened:rt.default.bool.isRequired,springConfig:rt.default.objectOf(rt.default.number),forceInitialAnimation:rt.default.bool,hasNestedCollapse:rt.default.bool,fixedHeight:rt.default.number,theme:rt.default.objectOf(rt.default.string),style:rt.default.object,onRender:rt.default.func,onRest:rt.default.func,onMeasure:rt.default.func,children:rt.default.node.isRequired};vs.defaultProps={forceInitialAnimation:!1,hasNestedCollapse:!1,fixedHeight:-1,style:{},theme:On,onRender:wi,onRest:wi,onMeasure:wi};var Bn=function(){var t=this;this.onContentRef=function(e){t.content=e},this.onWrapperRef=function(e){t.wrapper=e},this.onRest=function(){t.raf=requestAnimationFrame(t.setResting)},this.setResting=function(){t.setState({currentState:ys})},this.getTo=function(){var e=t.props.fixedHeight;return e>-1?e:t.content.clientHeight},this.getWrapperStyle=function(e){if(t.state.currentState===Ot&&t.state.to){var i=t.props.fixedHeight;return i>-1?{overflow:"hidden",height:i}:{height:"auto"}}return t.state.currentState===$e&&!t.state.to?{overflow:"hidden",height:0}:{overflow:"hidden",height:Math.max(0,e)}},this.getMotionProps=function(){var e=t.props.springConfig;return t.state.currentState===Ot?{defaultStyle:{height:t.state.to},style:{height:t.state.to}}:{defaultStyle:{height:t.state.from},style:{height:(0,ws.spring)(t.state.to,Me({precision:Ln},e))}}},this.renderContent=function(e){var i=e.height,o=t.props,n=o.isOpened,a=o.springConfig,p=o.forceInitialAnimation,l=o.hasNestedCollapse,u=o.fixedHeight,h=o.theme,_=o.style,y=o.onRender,f=o.onRest,m=o.onMeasure,C=o.children,x=Fn(o,["isOpened","springConfig","forceInitialAnimation","hasNestedCollapse","fixedHeight","theme","style","onRender","onRest","onMeasure","children"]),w=t.state,S=w.from,D=w.to;return y({current:i,from:S,to:D}),Le.default.createElement("div",Me({ref:t.onWrapperRef,className:h.collapse,style:Me({},t.getWrapperStyle(Math.max(0,i)),_)},x),Le.default.createElement("div",{ref:t.onContentRef,className:h.content},C))}}});var Rs=Xe(Be=>{"use strict";Object.defineProperty(Be,"__esModule",{value:!0});Be.UnmountClosed=void 0;var zn=Object.assign||function(s){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i])}return s},Un=function(){function s(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}}(),Wn=R(),ks=xs(Wn),Vn=lo(),Cs=xs(Vn),Hn=bi();function xs(s){return s&&s.__esModule?s:{default:s}}function qn(s,t){var e={};for(var i in s)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i]);return e}function jn(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}function Gn(s,t){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:s}function Yn(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);s.prototype=Object.create(t&&t.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(s,t):s.__proto__=t)}var Zn=Be.UnmountClosed=function(s){Yn(t,s);function t(e){jn(this,t);var i=Gn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.componentWillReceiveProps=function(o){var n=o.isOpened;!i.props.isOpened&&n&&i.setState({forceInitialAnimation:!0,shouldUnmount:!1})},i.onRest=function(){var o=i.props,n=o.isOpened,a=o.onRest;n||i.setState({shouldUnmount:!0}),a&&a.apply(void 0,arguments)},i.state={shouldUnmount:!i.props.isOpened,forceInitialAnimation:!i.props.isOpened},i}return Un(t,[{key:"render",value:function(){var i=this.props,o=i.isOpened,n=i.onRest,a=qn(i,["isOpened","onRest"]),p=this.state,l=p.forceInitialAnimation,u=p.shouldUnmount;return u?null:ks.default.createElement(Hn.Collapse,zn({forceInitialAnimation:l,isOpened:o,onRest:this.onRest},a))}}]),t}(ks.default.PureComponent);Zn.propTypes={isOpened:Cs.default.bool.isRequired,onRest:Cs.default.func}});var Ss=Xe((Cp,Ts)=>{"use strict";var Kn=bi(),Qn=Kn.Collapse,Jn=Rs(),ze=Jn.UnmountClosed;ze.Collapse=Qn;ze.UnmountClosed=ze;Ts.exports=ze});var es=r(bn()),$t=r(Q()),is=r(wn());gn();var vn=v.select("couponView");function kn(){return N()==="ebay.com"&&v.get(["selfStandDown",`${N()}_${v.get("tabId")}`])}async function Cn(s){let t=document.createElement("iframe");t.src=s,t.style="position: fixed; top: 0; left: 0; border: 0; background: transparent;",t.width=1,t.height=1,t.setAttribute(`data-${v.get("pageViewId")}`,!0),document.body.appendChild(t),await xe.setupIframeMessenger(t)}async function xn(){let s=(0,es.exponential)({randomisationFactor:0,initialDelay:50,maxDelay:5e3});await new Promise((e,i)=>{s.on("ready",async()=>{let o=await xe.checkShouldPrompt();o&&(s.removeAllListeners(),e(o)),s.backoff()}),s.backoff()})}async function Rn(s){let t;if(c("shopify_async_tigger")&&s==="Shopify"){let e=(0,is.getSiteData)(s,"checkoutPage");t=$t.default.get(e,"identifiers")}return t?{siteData:{coupons:{identifiers:t}}}:null}async function os(s={}){return Ne({...s,isAsyncTigger:!0})}async function Ba(s={}){let t=N(),e=await xo(t),i=e,o=v.get("platform");if(o){let A=await Rn(o);A&&(i=A)}if(!await ci(i)){let A=v.get("deweyResult");if(si(A)){k("trackError","couponsInitError","asyncTigger"),ri(A);return}await new Promise((E,$)=>{To.emitter.on("result",async W=>{let L=await ci(i);L?E(L):si(W)&&(k("trackError","couponsInitError","asyncTigger"),ri(W),$("coupon identifiers not found on page, loading cashback instead"))})})}let a=c("shopify_async_tigger")&&o?o:$t.default.get(e,"siteData.tld"),p=`${co}?site=${a}`;await Cn(p),await xn();let{coupons:l,ignoreAffiliate:u}=$t.default.get(e,"siteData.coupons",{}),h=l&&l.length,_=!1,y=!1,f=!1,m=l&&l.length&&kn();m&&po({active:!0}),(u||v.get(["couponsAffiliateDisabledSites",`${t}_${v.get("tabId")}`])>ei()||v.get(["couponsAffiliateDisabledSites",`${t}_all`])>ei())&&!m&&(vn.set("disableAffiliate",!0),_=!0),ko()&&!m&&(y=!0),Yo({siteAPIData:e,domain:t}),k("track","couponCheck");let C,x;if(xe.setConfig(Oo),!h)return f;let w;try{let A=await Ct("couponRun");if(w=JSON.parse(A),w){let F={domain:t},{savings:E}=await Lo(F);w.result.savings=E,w.result.pageReload=void 0,await lt("couponRun")}}catch{lt("couponRun")}x&&(l=[],h=x),f={coupons:l,estimatedRunTime:C,disableAffiliate:_,couponCount:h,affiliateLinkCurrentTab:$t.default.get(e,"meta.affiliate_link_current_tab"),pageWasReloaded:!!w,standDown:y,standDownOverride:m,autoCoupConfig:$t.default.get(e,"siteData.coupons.config.auto_coup")};let S=v.get("couponsConfig");return $t.default.get(S,"pageWasReloaded")&&(f.pageWasReloaded=!0),v.set("couponsConfig",f),w&&Go(w),f}var rn=r(R()),pn=r(R()),cn=r(yn()),Ye=r(ii()),ue=r(fn()),d=r(Q()),ln=r(me());_n();var op=r(R()),ms=r(R()),st=r(Q());function Lt(s){return parseInt(s.replace(/[^0-9]/gi,""))}var as=r(R()),rs=r(R()),di=r(Q());ro();var ss=r(R());var te=r(b()),Tn=({activateRewardsOnly:s,toggleHideSecondaryCta:t,hideSecondaryCta:e,activatingCredits:i,creditsActivated:o,ctaText:n}={})=>{let a=B(N()),p=c("ext_red_cta_202305")&&!a,l=c("ext_notif_animation")?"btn-wiggle":"";return(0,te.jsx)(ss.default.Fragment,{children:i&&e?(0,te.jsx)("button",{className:`bold primary-btn-large ${p?"red-btn-test":""}`,children:"Activating..."}):o&&e?(0,te.jsx)("button",{className:`bold primary-btn-large ${p?"red-btn-test":""}`,children:"Activated!"}):(0,te.jsx)("button",{className:`bold primary-btn-large ${p?"red-btn-test":""} ${l}`,onClick:async()=>{s({ctaText:"dismissCouponNotification",label:n}),t()},children:n})})},ns=Tn;var O=r(b()),mi=class extends rs.Component{constructor(...t){super(...t),this.state={hideSecondaryCta:!1},this.onShowExclusion=this.onShowExclusion.bind(this)}componentDidMount(){B(N())&&(this.closeTimeout=setTimeout(()=>this.props.onClosePopup(),5e3)),lt("couponNotifiedImmediately")}async sendCtaEvent({ctaText:t,notificationText:e,clickId:i}={}){let o=he(i);k("track","couponsModalClickCta",{coupons:this.props.couponsFromResult,savings:this.props.rawSavings,bestCoupon:this.props.bestCode,cashback:this.props.isCashback,triggerType:"auto",ctaText:t.toLowerCase(),notificationText:e,runDuration:di.default.get(this,"props.runDuration"),clickId:i,redirectId:o,couponRunId:v.get(["couponView","result","couponRunId"])}),At("couponNotificationResult",t,"cta","primary",{redirect:!0,cashback:this.props.isCashback&&!this.props.hasDeferredCouponRewards,coupons:this.props.couponsFromResult,savings:this.props.rawSavings,bestCoupon:this.props.bestCode,triggerType:"auto",notificationText:e,runDuration:di.default.get(this,"props.runDuration"),clickId:i,redirectId:o,couponRunId:v.get(["couponView","result","couponRunId"])})}onShowExclusion(){k("trackClick","viewExclusionDetails","view details"),window.open(`${it}/s/${this.props.tld}/coupon`,"_blank")}componentWillUnmount(){clearTimeout(this.timeout),clearTimeout(this.closeTimeout)}render(){let{activateRewardsOnly:t,savings:e,reward:i,exclusions:o,postCoupons:n,requiresInput:a,didTryCodes:p,running:l,onClosePopup:u,activateCredits:h,activatingCredits:_,creditsActivated:y,isBonkersSavings:f,hasDeferredCouponRewards:m}=this.props,C=i&&i.amount&&!n&&(!m||a),x=i&&(!!i.categories||i.estimated),w=i&&i.type==="threshold"&&i.threshold,S=B(N()),D=c("ext_red_cta_202305")&&!S,A=c("ext_notif_animation")?"btn-wiggle":"",F=!1,E="Apply Savings",$="Apply Savings",W=i&&i.amount&&(c("apply_savings_rewards_option")||c("apply_savings_rewards_option_2")),L=W&&!f&&!a?"rewards-only-btn":"";W&&(E="Check for Rewards"),(S||f)&&(E="Continue",F=!0);let V=()=>F?`Continue to ${w?"earn":"get"} ${x?"up to an additional":"an additional"}`:`Click to ${w?"earn":"get"} ${x?"up to an additional":"an additional"}`,z=()=>Fo(i,{hideUpTo:!0})+Eo(i),tt=()=>{this.setState({hideSecondaryCta:!0})},K=`${a||f?"code entered":`you saved ${e} automatically!`} ${C?`${V().toLowerCase()} ${z()}`:""}`;return(0,O.jsxs)("div",{className:`savings-wrapper automatic ${C?"has-reward":""} ${o?"has-exclusions":""} ${S?" amazon":""}`,children:[(0,O.jsx)(Et,{domain:N()}),(0,O.jsxs)("div",{children:[(0,O.jsx)("div",{className:`coupon-count ${C?"":"no-reward"}`,children:a||f?(0,O.jsx)("div",{children:(0,O.jsxs)("h2",{children:["Code Entered",C?(0,O.jsxs)("span",{className:"credits-text",children:[(0,O.jsx)("br",{}),V()," ",(0,O.jsx)("span",{className:"palmetto",children:z()}),"."]}):null]})}):(0,O.jsxs)("h2",{className:"result-text",children:[(0,O.jsxs)("span",{children:["You saved",(0,O.jsxs)("span",{className:"palmetto",children:[" ",e," "]})," automatically!"]}),C?(0,O.jsxs)("span",{className:"credits-text",children:[V()," ",(0,O.jsx)("span",{className:"palmetto",children:z()}),"."]}):null]})}),(0,O.jsxs)("div",{children:[p&&!l&&(0,O.jsxs)("div",{style:{marginTop:"25px"},children:[W&&!f&&!a&&(0,O.jsx)(ns,{creditsActivated:y,activatingCredits:_,activateRewardsOnly:t,toggleHideSecondaryCta:tt,hideSecondaryCta:this.state.hideSecondaryCta,ctaText:E}),!this.state.hideSecondaryCta&&(0,O.jsx)("button",{className:`primary-btn-large ${L} ${D?"red-btn-test":""} ${L?"":A} `,disabled:l||y||_,onClick:async()=>{let et=J();this.sendCtaEvent({ctaText:E,notificationText:K,clickId:et}),C||m&&i&&i.amount?(h({clickId:et,fromAutoRun:!0,savings:!0,codeEntered:a,shouldLoadEmailCreateAccountNotification:!0}),this.timeout=setTimeout(()=>{u()},750)):(Te({clickId:et,fromAutoRun:!0,autoSavings:!0}),u())},children:W?$:E})]}),C&&(0,O.jsx)(Gt,{reward:i,containerStyle:{marginTop:12,textAlign:"left"}}),(_||y)&&(!W||W&&this.state.hideSecondaryCta)&&!m?(0,O.jsx)("div",{className:"exclusions-wrapper visible",children:(0,O.jsxs)("h4",{style:{fontSize:"12px"},className:"try-more-link",children:["*Rewards may vary based on exchange rates.",o?(0,O.jsxs)(as.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,O.jsxs)("span",{className:"tertiary-link-lighter",onClick:this.onShowExclusion,children:[" ","view details."]})]}):null]})}):null]})]})]})}},hi=mi;var ls=r(R()),us=r(R()),ie=r(Q()),ds=r(me());ro();var gr=r(R()),cs=r(Q());var bt=r(b());function Sn(){let s=Ce();return(0,bt.jsxs)("div",{style:{border:"none",borderTop:"2px dashed lightgray",borderBottom:"2px dashed lightgray",padding:6,margin:"12px 0"},children:[(0,bt.jsxs)("div",{children:[(0,bt.jsxs)("h4",{style:{display:"inline-block",width:"75%",textAlign:"left",marginBottom:0},children:[(0,bt.jsx)(ke,{}),":"]}),(0,bt.jsx)("h4",{style:{display:"inline-block",width:"25%",textAlign:"end"},children:s})]}),(0,bt.jsxs)("div",{children:[(0,bt.jsx)("h4",{className:"palmetto",style:{display:"inline-block",width:"75%",textAlign:"left",marginBottom:0},children:"Transaction Savings:"}),(0,bt.jsx)("h4",{className:"palmetto",style:{display:"inline-block",width:"25%",textAlign:"end"},children:"???"})]})]})}var ps=Sn;var ut=r(b()),Nn=s=>{let{couponCount:t,showReward:e,reward:i}=s,o=v.get("lifetimeSavings"),n=cs.default.get(o,"lifetimeSavings.amount",0)*100,a,p,l=c("ext_shorten_notif_text")?"Test codes in seconds.":"Capital One Shopping tests codes in seconds.",u=c("ext_coupon_savings_emphasis")&&n>=1e3;u?(a=(0,ut.jsx)(ps,{}),p=(0,ut.jsxs)("span",{style:{textAlign:"center",display:"block"},children:["Found"," ",(0,ut.jsxs)("span",{className:"palmetto",children:[t," ",t===1?"code":"codes"]})]})):(a=(0,ut.jsx)("h4",{className:"bold left",children:Ae()||l}),p=Pe({couponCount:t}));let h=!0;return(Rt()||Uo())&&(h=!1),h?(0,ut.jsxs)("div",{children:[(0,ut.jsxs)("h2",{className:"left",children:[p,e&&!u?(0,ut.jsxs)(ut.Fragment,{children:[" ","and",(0,ut.jsx)("br",{}),Re(i,{capitalize:!1}),xt(i,{hidePrefix:!0})]}):null]}),a]}):null},ee=Nn;var M=r(b()),fi=class extends us.Component{constructor(...t){super(...t)}async componentDidMount(){ft()&&!await Ct("couponNotifiedImmediately")&&await oi("couponNotifiedImmediately",JSON.stringify({notifiedImmediate:!0})),B(N())&&(this.closeTimeout=setTimeout(()=>this.props.onClosePopup(),5e3))}componentWillUnmount(){clearTimeout(this.closeTimeout)}sendCtaEvent({ctaText:t,clickId:e,couponRunId:i,manuallyActivatedAutoRun:o}={}){let n=he(e);k("track","couponsModalClickCta",{coupons:this.props.couponsFromResult,bestCoupon:this.props.bestCode,savings:this.props.rawSavings,cashback:this.props.isCashback,triggerType:o?"auto":"auto_fallback",ctaText:t,runDuration:ie.default.get(this,"props.runDuration"),clickId:e,redirectId:n,couponRunId:i}),At(o?"couponNotification":"couponNotificationResult",t,"cta","primary",{redirect:!0,cashback:this.props.isCashback&&!this.props.hasDeferredCouponRewards,coupons:this.props.couponsFromResult,bestCoupon:this.props.bestCode,savings:this.props.rawSavings,triggerType:o?"auto":"auto_fallback",runDuration:ie.default.get(this,"props.runDuration"),clickId:e,redirectId:n,couponRunId:i})}onShowExclusion(){k("trackClick","viewExclusionDetails","view details"),window.open(`${it}/s/${this.props.tld}/coupon`,"_blank")}async autoCoupNotifClick({manuallyActivatedAutoRun:t,continueCtaText:e,hasReward:i}){let{activateCredits:o,manuallyActivateAutocoupRun:n}=this.props,a=J(),p=ds.default.v4();t&&sessionStorage.getItem("__cos_coupon_run_id")&&(p=sessionStorage.getItem("__cos_coupon_run_id")),this.sendCtaEvent({ctaText:e,clickId:a,couponRunId:p,manuallyActivatedAutoRun:t});let l=v.get("couponsConfig"),u=ie.default.get(l,"affiliateLinkCurrentTab")||kt();if(t)await oi("manuallyActivatedAutoRun",JSON.stringify({manuallyActivatedAutoRun:!0})),lt("couponNotifiedImmediately"),n({clickId:a,couponRunId:p}),u||(i?o({clickId:a,fromAutoRun:!0,savings:!0,manuallyActivatedAutoRun:!0}):Te({clickId:a,fromAutoRun:!0}));else{lt("couponNotifiedImmediately");let h={fromAutoRun:!0,clickId:a,couponRunId:p};this.props.onTryCodes({disableAutomatic:!0,disableCookieDrop:!1,config:h})}}determineTryCodeCount(){let{autoFallbackCouponsCount:t,couponCount:e}=this.props;return t&&Mt({autoFallbackCouponsCount:t})?t:e}render(){let{activateRewardsOnly:t,reward:e,postCoupons:i,activatingCredits:o,creditsActivated:n,manuallyActivatedAutoRun:a,hasDeferredCouponRewards:p,onShowExclusion:l,vendorName:u}=this.props,h=e&&e.amount&&!i&&!p,_=c("ext_notif_animation")?"btn-wiggle":"",y=this.determineTryCodeCount(),f=ie.default.get(this.props,"exclusions"),m=B(N()),C=c("ext_red_cta_202305")&&!m,x={display:"flex",flexDirection:"column",justifyContent:"center"};Rt()&&(x={...x,paddingLeft:10,paddingRight:10});let w=Pe({couponCount:y,isTryCodesButton:!0}),S=u||N(),D=(0,M.jsxs)("div",{children:[o?null:(0,M.jsx)("button",{className:`primary-btn-large ${C?"red-btn-test":""} ${_}`,onClick:async()=>{this.autoCoupNotifClick({manuallyActivatedAutoRun:a,continueCtaText:w,hasReward:h})},children:w}),Wo()?(0,M.jsx)(Qo,{creditsActivated:n,activatingCredits:o,activateRewardsOnly:t,ctaText:w,fromAutoCoupImmediateNotif:a}):null,h&&(0,M.jsx)(Gt,{reward:e,containerStyle:{marginTop:12,textAlign:"left"}}),n||o?(0,M.jsx)("div",{className:`exclusions-wrapper ${o||n?"visible":"invisible"}`,style:{textAlign:"left"},children:(0,M.jsxs)("h6",{style:{height:"30px",display:"flex",marginTop:"10px",paddingLeft:"3px"},children:[(0,M.jsx)("span",{style:{marginRight:"3px"},children:"*"}),(0,M.jsxs)("span",{children:["Rewards may vary based on exchange rates.",f?(0,M.jsxs)(ls.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,M.jsxs)("span",{className:"tertiary-link-lighter",onClick:l,children:[" ","view details."]})]}):null]})]})}):null,(n||o)&&(e?.categories||e?.tiers)?(0,M.jsxs)("div",{style:{textAlign:"left",borderTop:"1px solid #dedede",marginTop:15,paddingTop:10},children:[(0,M.jsx)(Ft,{reward:e}),(0,M.jsx)(Yt,{reward:e})]}):null,(n||o)&&c("ext_exclusion_warning")&&f?(0,M.jsx)("div",{style:{paddingTop:"20px"},children:(0,M.jsx)(Po,{exclusions:f})}):null]});return(0,M.jsx)("div",{className:`no-savings-wrapper automatic${m?" amazon":""}`,children:(0,M.jsxs)("div",{children:[m?(0,M.jsx)("h2",{className:"left",children:(0,M.jsx)("span",{children:"Coupon Clipped"})}):(0,M.jsxs)("div",{children:[!Rt()&&(0,M.jsx)(Et,{domain:N()}),o?(0,M.jsxs)("h2",{children:["Activating ",e.categories?"up to ":"",(0,M.jsx)("span",{className:"palmetto",children:e.type==="percentage"?`${e.amount/100}%`:H(e.amount,{currency:e.currency})})," ","back"]}):(0,M.jsx)("div",{"data-testid":"right-content",style:x,children:(0,M.jsx)(ee,{couponCount:y,showReward:h,reward:e,vendor:S})})]}),D]})})}},Ee=ge({vendorName:["siteAPIData","meta","name"]},fi);var _t=r(b()),_i=class extends ms.Component{constructor(...t){super(...t),this.state={viewCodes:!1,estimatedTimeLeft:null,willEstimateDuration:!1},this.onInitTryCoupons=()=>{this.setState({willEstimateDuration:!0})},this.onEstimatedCouponDuration=({detail:e})=>{this.setState({estimatedTimeLeft:e.estimatedTimeLeft})}}componentDidMount(){document.addEventListener("__iv_init_try_coupons",this.onInitTryCoupons),document.addEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration),!this.props.didTryCodes&&!this.props.running&&this.props.onTryCodes({ignoreCancelled:!0,disableAutomatic:!1,disableCookieDrop:!0})}componentWillUnmount(){document.removeEventListener("__iv_init_try_coupons",this.onInitTryCoupons),document.removeEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration)}render(){let{result:t,couponCount:e,roo:i,hasDeferredCouponRewards:o}=this.props.view,{activateRewardsOnly:n,activateCredits:a,activatingCredits:p,barComplete:l,creditsActivated:u,didTryCodes:h,isCashback:_,manuallyActivateAutocoupRun:y,onShowExclusion:f,onTryCodes:m,pause:C,postCoupons:x,reward:w,running:S}=this.props,D=st.default.get(t,"pageReload"),A=st.default.get(t,"originalTotal"),F=st.default.filter(st.default.get(t,"coupons"),Je=>Je.savings>0||Je.generatedFreeGift||Je.generatedFreeShipping),E=t&&t.savings&&t.savings>0?H(Math.trunc(t.savings)):0,$=st.default.get(t,"savings")>=1e5||typeof E=="string"&&Lt(E)>=1e5,W=st.default.get(t,"savings")>1e6||typeof E=="string"&&Lt(E)>1e6,L=st.default.get(t,"bestCoupon.code"),V=(st.default.get(t,"runTime",0)/1e3).toFixed(2),tt=S||D||l&&!C,K=t&&t.requiresInput,et=t&&(!L||!E)&&!S&&!K,vt=this.props.exclusions,St=this.props.tld,Nt=w&&w.amount&&!x,ht=st.default.get(t,"savings"),Ze=st.default.get(t,"coupons"),Ke=st.default.get(this,"props.view.autoCoupConfig.codeCount")||(i?1:2),un=st.default.get(this,"props.view.couponCount")-Ke,de=e-Math.min(e,Ke),Qe=st.default.get(this,"props.view.result.runTime"),dn=!S&&!t||S||D,mn=!tt&&!C&&!S&&Nt&&this.props.eligibleForNewUserBonus;return(0,_t.jsx)("div",{className:"auto-render-result render-result-layout auto",children:(0,_t.jsx)("div",{className:"left full",children:(0,_t.jsxs)("div",{className:`result-column ${st.default.get(this.props.googleData,"contacts.length")?"has-contacts":""}`,children:[dn?(0,_t.jsx)(Ee,{activateRewardsOnly:n,activateCredits:a,activatingCredits:p,autoCoupTryMoreCount:de,bestCode:L,couponCount:e,couponsFromResult:Ze,creditsActivated:u,didTryCodes:h,exclusions:vt,hasDeferredCouponRewards:o,isCashback:_,manuallyActivateAutocoupRun:y,onShowExclusion:f,onTryCodes:m,postCoupons:x,rawSavings:ht,requiresInput:K,result:t,reward:w,roo:i,runDuration:Qe,running:S,runTimeSeconds:V,tld:St,couponCount:Ke,manuallyActivatedAutoRun:!0,onClosePopup:this.props.onClosePopup.bind(this)}):et&&!It()||de<0?(0,_t.jsx)(Ee,{activateRewardsOnly:n,activateCredits:a,activatingCredits:p,autoCoupTryMoreCount:de,autoFallbackCouponsCount:un,bestCode:L,couponCount:e,couponsFromResult:Ze,creditsActivated:u,didTryCodes:h,exclusions:vt,hasDeferredCouponRewards:o,isCashback:_,onShowExclusion:f,onTryCodes:m,postCoupons:x,rawSavings:ht,requiresInput:K,result:t,reward:w,roo:i,runDuration:Qe,running:S,runTimeSeconds:V,tld:St,onClosePopup:this.props.onClosePopup.bind(this)}):(0,_t.jsx)(hi,{activateCredits:a,activatingCredits:p,activateRewardsOnly:n,autoCoupTryMoreCount:de,bestCode:L,couponCount:e,couponsFromResult:Ze,creditsActivated:u,didTryCodes:h,exclusions:vt,hasDeferredCouponRewards:o,isBigSavings:$,isBonkersSavings:W,isCashback:_,onTryCodes:m,originalTotal:A,postCoupons:x,rawSavings:ht,requiresInput:K,reward:w,runDuration:Qe,running:S,runTimeSeconds:V,savings:E,tld:St,workingCoupons:F,onClosePopup:this.props.onClosePopup.bind(this)}),mn&&(0,_t.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,_t.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,_t.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]})]})})})}onClickViewCode(){k("trackClick","toggleCodes",this.state.viewCodes?"hide codes":"view codes"),this.state.viewCodes||Ie(),this.setState({viewCodes:!this.state.viewCodes})}onShowNewUserDetails(){k("trackClick","viewNewUserBonusDetails","Details",{view:"cashbackNotificiation"}),window.open("https://help.capitaloneshopping.com/hc/en-us/articles/360047681572-How-do-I-earn-a-New-Member-Bonus-of-10-in-Wikibuy-Credits-on-my-first-purchase-","_blank")}},gi=_i;var hs=r(R()),fs=r(R());var ot=r(b()),An=({reward:s,activateRewardsOnly:t,exclusions:e,onShowExclusion:i,onClosePopup:o,activatingCredits:n,creditsActivated:a,onLoad:p})=>{(0,fs.useEffect)(()=>{p(),_e("couponDismissConfirmation")},[]);let l=c("ext_red_cta_202305")?"red-btn-test":"",u=c("ext_red_cta_202305")?"unfavorable-text":"primary-text",h=!n&&!a,_=s.type==="percentage"?`${s.amount/100}%`:H(s.amount,{currency:s.currency}),y=s.type==="threshold"&&s.threshold?` when ${H(s.threshold,{currency:s.currency})} spent`:"",f=`Dismiss with ${_} back${y}`,m="Decline Offer",C;c("notif_areyousure_message")&&(f=`Oops! Activate my ${_} back${y}`,C="Rewards are free and take one click.",m="Yes, close without Rewards");let x=()=>{t({label:f,pageLocation:"couponDismissConfirmation"})},w=()=>{c("notif_areyousure_throttling")&&No("areyousure_throttling"),o(m,{pageLocation:"couponDismissConfirmation"})};return(0,ot.jsxs)("div",{className:"flex flex-col items-center justify-center button-wrapper",children:[(0,ot.jsx)("h2",{style:{marginTop:16,marginBottom:16},children:"Are you sure?"}),C?(0,ot.jsx)("p",{className:"mb-4",children:C}):null,n?(0,ot.jsx)("h5",{className:`bold ${u}`,children:"Activating..."}):a?(0,ot.jsx)("h5",{className:`bold ${u}`,children:"Activated!"}):(0,ot.jsx)("button",{className:`primary-btn-large ${l}`,onClick:x,children:f}),h&&(0,ot.jsx)("a",{onClick:w,style:{textDecoration:"none"},children:(0,ot.jsx)("h5",{className:"mt-4 font-bold text-base text-neutralsecondary",children:m})}),a||n?(0,ot.jsx)("div",{className:`exclusions-wrapper ${n||a?"visible":"invisible"}`,children:(0,ot.jsxs)("h6",{style:{height:"30px",display:"flex",marginTop:"10px",paddingLeft:"3px"},children:[(0,ot.jsx)("span",{style:{marginRight:"3px"},children:"*"}),(0,ot.jsxs)("span",{children:["Rewards may vary based on exchange rates.",e?(0,ot.jsxs)(hs.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,ot.jsxs)("span",{className:"tertiary-link-lighter",onClick:i,children:[" ","view details."]})]}):null]})]})}):null]})},_s=An;var $p=r(R()),Is=r(R());var Tp=r(R()),Ns=r(R()),As=r(Ss()),yi=r(Q());function pt(s){return navigator.clipboard.writeText(s).catch(t=>{k("trackError","copyCodeError",s)}),!0}var j=r(b()),oe=class extends Ns.Component{constructor(...t){super(...t),this.state={copied:!1}}render(){let t=this.props.coupon,e=this.props.result&&!this.props.running,i={borderTop:"1px solid #f1f1f1",padding:"10px 0"};return(0,j.jsx)("div",{className:this.state.copied?"copied":"",children:(0,j.jsxs)("div",{style:c("ext_eeyore_modernization")?i:{},className:"coupon-list-item-container",onClick:this.onClickCopy.bind(this),children:[(0,j.jsx)("div",{className:"details",children:(0,j.jsx)("h4",{className:`code midnight bold ${this.props.noScript?"noscript":""}`,children:t.code})}),c("ext_eeyore_modernization")?(0,j.jsx)("div",{className:"savings",children:this.state.copied?(0,j.jsxs)("span",{style:{color:"#01c049"},className:"copied-text",children:["Copied",(0,j.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{width:"14px",height:"14px",marginLeft:"4px"},children:(0,j.jsx)("path",{d:"M4.49999 14C4.42502 13.9998 4.35104 13.9829 4.28341 13.9506C4.21578 13.9183 4.1562 13.8713 4.10899 13.813L0.108989 8.81302C0.0261092 8.70932 -0.0121819 8.57695 0.00253975 8.44502C0.0172614 8.31308 0.0837895 8.1924 0.187489 8.10952C0.291189 8.02664 0.423565 7.98835 0.555497 8.00307C0.687429 8.0178 0.808109 8.08432 0.890989 8.18802L4.47099 12.664L13.089 0.215024C13.1264 0.161051 13.1741 0.114978 13.2293 0.0794354C13.2846 0.0438932 13.3463 0.0195776 13.4109 0.00787743C13.4755 -0.00382275 13.5418 -0.00267826 13.606 0.0112449C13.6702 0.025168 13.731 0.0515974 13.785 0.0890241C13.839 0.126451 13.885 0.174142 13.9206 0.229374C13.9561 0.284606 13.9804 0.346299 13.9921 0.410928C14.0038 0.475558 14.0027 0.541859 13.9888 0.606047C13.9748 0.670234 13.9484 0.73105 13.911 0.785024L4.91099 13.785C4.86661 13.8491 4.80788 13.9019 4.73947 13.9392C4.67106 13.9765 4.59487 13.9974 4.51699 14H4.49999Z",fill:"#19AC39"})})]}):(0,j.jsx)("svg",{width:"17",height:"19",viewBox:"0 0 17 19",fill:"none",children:(0,j.jsx)("path",{d:"M6.05775 15.5C5.55258 15.5 5.125 15.325 4.775 14.975C4.425 14.625 4.25 14.1974 4.25 13.6923V2.30775C4.25 1.80258 4.425 1.375 4.775 1.025C5.125 0.675 5.55258 0.5 6.05775 0.5H14.4423C14.9474 0.5 15.375 0.675 15.725 1.025C16.075 1.375 16.25 1.80258 16.25 2.30775V13.6923C16.25 14.1974 16.075 14.625 15.725 14.975C15.375 15.325 14.9474 15.5 14.4423 15.5H6.05775ZM6.05775 14H14.4423C14.5192 14 14.5898 13.9679 14.6538 13.9038C14.7179 13.8398 14.75 13.7692 14.75 13.6923V2.30775C14.75 2.23075 14.7179 2.16025 14.6538 2.09625C14.5898 2.03208 14.5192 2 14.4423 2H6.05775C5.98075 2 5.91025 2.03208 5.84625 2.09625C5.78208 2.16025 5.75 2.23075 5.75 2.30775V13.6923C5.75 13.7692 5.78208 13.8398 5.84625 13.9038C5.91025 13.9679 5.98075 14 6.05775 14ZM2.55775 19C2.05258 19 1.625 18.825 1.275 18.475C0.925 18.125 0.75 17.6974 0.75 17.1923V4.30775H2.25V17.1923C2.25 17.2693 2.28208 17.3398 2.34625 17.4038C2.41025 17.4679 2.48075 17.5 2.55775 17.5H12.4423V19H2.55775Z",fill:"#1D92FF"})})}):(0,j.jsxs)("div",{className:"savings",children:[this.state.copied?(0,j.jsx)("span",{style:{color:"#788b96",marginRight:"8px"},className:"copied-text",children:"Copied"}):null,this.state.copied&&!this.props.disableChecks?(0,j.jsx)("svg",{viewBox:"0 0 150 150",children:(0,j.jsx)("path",{d:"M10,30 l30,50 l95,-70",fill:"none",strokeWidth:"15",style:{stroke:"#0276b1",strokeDasharray:"180px, 180px",strokeDashoffset:"0px",animationDelay:e?"0ms":`${this.props.stagger*this.props.index}ms`}})}):null]})]})})}onClickCopy(){let t=J();this.setState({copied:pt(this.props.coupon.code)},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e4)}),k("trackClick","copyCouponCode","code",{clickId:t})}componentWillUnmount(){clearTimeout(this.timeoutId)}};oe.defaultProps={stagger:400};function Zt(s){return s.collapsable?(0,j.jsx)(As.default,{isOpened:!!s.show,className:"reactcollapse",children:(0,j.jsx)("div",{className:`code-list ${s.className||""}`,children:yi.default.map(s.coupons,(t,e)=>(0,j.jsx)(oe,{running:s.running,result:s.result,index:e,coupon:t,stagger:s.stagger,disableChecks:s.disableChecks,noScript:s.noScript},e))})}):(0,j.jsx)("div",{className:`code-list ${s.className||""}`,children:yi.default.map(s.coupons,(t,e)=>(0,j.jsx)(oe,{running:s.running,result:s.result,index:e,coupon:t,stagger:s.stagger,disableChecks:s.disableChecks,noScript:s.noScript},e))})}var Z=r(b()),vi=class extends Is.Component{state={showCodes:!1};componentDidMount(){localStorage.getItem("__wb_redirecting")&&this.setUpPostRedirect()}setUpPostRedirect(){this.setState({showCodes:!0}),localStorage.removeItem("__wb_redirecting")}render(){let{coupons:t,result:e,couponCount:i}=this.props.view,{reward:o,postCoupons:n,onShowExclusion:a,exclusions:p}=this.props,l=o&&o.amount&&!n,u=!e&&l&&this.props.eligibleForNewUserBonus;return(0,Z.jsxs)("div",{children:[(0,Z.jsxs)("div",{className:"found-codes",children:[this.props.reward&&this.state.showCodes?(0,Z.jsxs)("h2",{children:["Activated ",xt(o,{hidePrefix:!0})]}):(0,Z.jsxs)("h2",{children:["Found ",i," ",i===1?"code":"codes",l&&(0,Z.jsxs)(Z.Fragment,{children:[" ","and",(0,Z.jsx)("br",{}),Re(o,{capitalize:!1}),xt(o,{hidePrefix:!0})]})]}),this.state.showCodes?(0,Z.jsx)("h4",{className:"bold",children:"Click code to copy to clipboard."}):(0,Z.jsxs)("h4",{className:"bold",children:["Click show ",i===1?"code":"codes"," to save."]})]}),this.state.showCodes?(0,Z.jsx)("div",{children:(0,Z.jsx)(Zt,{show:!0,result:e,running:!1,coupons:t,stagger:0,noScript:!0,collapsable:!0})}):(0,Z.jsxs)("button",{className:`primary-btn-large ${c("ext_red_cta_202305")?"red-btn-test":""}`,style:{width:"100%",fontWeight:"bold",marginTop:"20px"},onClick:this.onShowCodes.bind(this),children:["Show ",i===1?"Code":"Codes"]}),u&&(0,Z.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,Z.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,Z.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]}),o&&this.state.showCodes&&(0,Z.jsx)(wt,{exclusions:p,onDetailsClick:a,style:{display:"flex"}})]})}onShowCodes(){let t=this.props.reward,e=N();k("trackClick","showCodesButton","show codes",{domain:e,cashback:this.props.isCashback}),At("couponNotification","show codes","cta","primary",{redirect:!0,cashback:this.props.isCashback,domain:e}),this.props.reward&&(jt(),k("track","activateCashbackRedirect",{rewardAmount:t.amount,rewardDisplay:t.type}));let{clickId:i}=ve();jo(i),k("track","showCodes",{cashback:this.props.isCashback,clickId:i}),this.setState({showCodes:!0})}onShowNewUserDetails(){k("trackClick","viewNewUserBonusDetails","Details",{view:"cashbackNotificiation"}),window.open("https://help.capitaloneshopping.com/hc/en-us/articles/360047681572-How-do-I-earn-a-New-Member-Bonus-of-10-in-Wikibuy-Credits-on-my-first-purchase-","_blank")}},ki=vi;var Ps=r(R()),ne=r(ii()),se=r(b());function Ue({hideNotification:s,shouldDisableCouponNotifAnimation:t,styles:e,children:i}){let{width:o,minHeight:n,marginRight:a,className:p,left:l,right:u,translate:h}=e;return(0,se.jsx)(Ps.default.Fragment,{children:t&&!s?(0,se.jsx)("div",{className:p,style:{transform:"translate3d(0,0%,0)",opacity:"1",width:o,minHeight:n,marginRight:a,left:l,right:u,translate:h},children:i}):(0,se.jsx)(ne.Motion,{style:{opacity:(0,ne.spring)(s?0:1,{stiffness:180,damping:20}),y:(0,ne.spring)(s?-100:0,{stiffness:180,damping:20})},children:({opacity:_,y})=>(0,se.jsx)("div",{className:p,style:{transform:`translate3d(0,${y}%,0)`,opacity:`${_}`,width:o,minHeight:n,marginRight:a,left:l,right:u,translate:h},children:i})})})}var io=r(R()),an=r(R()),I=r(Q());var fc=r(R()),Es=r(R()),Bt=r(Q()),Ms=r(me());var Ci=r(R()),dt=r(Q()),Ds=r(me());var xi=class extends Ci.default.Component{constructor(...t){super(...t),this.state={},this.impressionMap=[]}componentWillMount(){dt.default.get(this.props,"children.length")&&!this.props.ignoreImpression&&this.setState({children:this.attachProps(this.props.children)})}componentDidMount(){this.props.logOnMount&&this.logImpression(dt.default.map(this.state.children,(t,e)=>({type:"impression",props:{...t.mirageData.trackProps,displayIndex:String(e)}})))}componentWillReceiveProps(t){!this.props.ignoreImpression&&dt.default.get(t.children,"length")&&!dt.default.get(this.props.children,"length")&&!this.state.children&&this.setState({children:this.attachProps(t.children)})}render(){let t=this.props.children;return this.state.children?(t=this.state.children,dt.default.map(t,e=>e.component)):t}attachProps(t){let e=this.logImpression.bind(this);return dt.default.map(t,i=>{if(!i||!i.props)throw new Error("Children Must Be A Component");let o=dt.default.clone(dt.default.get(i.props,"__mirage",{}));o.trackProps.view_id=Ds.default.v4();let n={...i.props,__mirage:o,logImpression:e};return{mirageData:o,component:Ci.default.cloneElement(i,n)}})}logImpression(t){t=dt.default.isArray(t)?t:[t];let e=dt.default.filter(t,i=>!dt.default.find(this.impressionMap,{type:i.type,props:{contentInstanceId:i.props.contentInstanceId}}));e.length&&(this.impressionMap=this.impressionMap.concat(e),yo(t))}},Ri=xi;var gt=r(b()),Xn=({style:s,image:t,title:e,subtitle:i,cta:o,onClickContentCard:n,...a})=>{let p=Ao(t?.url);return(0,gt.jsx)("div",{style:s,onClick:()=>n(a),className:"store-content-card-a",children:(0,gt.jsxs)("div",{className:"flex",children:[(0,gt.jsx)("div",{className:"image-wrapper",children:(0,gt.jsx)("div",{className:`image ${t?.className||""}`,style:{...t?.style||{},backgroundImage:p?`url("${p}")`:void 0},children:p===null&&(0,gt.jsx)(Io,{})})}),(0,gt.jsxs)("div",{className:"content",children:[(0,gt.jsx)("h4",{className:`${e?.className||""} charcoal`,style:e?.style,children:e?.value}),(0,gt.jsx)("h5",{className:`${i?.className||""} silver`,style:i?.style,children:i?.value}),(0,gt.jsx)("h6",{className:`${o?.className||""} palmetto`,style:o?.style,children:o?.value})]})]})})},Fs=Xn;var zt=r(b()),Ti=class extends Es.Component{constructor(...t){super(...t),this.state={}}render(){return(0,zt.jsxs)("div",{className:"store-content-data",children:[(0,zt.jsx)("div",{children:(0,zt.jsx)("h2",{className:"bold",children:"Personalized Offers"})}),(0,zt.jsx)(Ri,{logOnMount:!0,children:Bt.default.map(Bt.default.get(this.props.data,"items"),(t,e)=>(0,zt.jsx)(Fs,{onClickContentCard:this.onClickContentCard.bind(this),index:e,...t},e))})]})}onClickContentCard(t){let e=Ms.default.v4(),i=Bt.default.get(t,"__mirage.trackProps",{});t.logImpression({type:"click",props:{...i,clickId:e,displayIndex:String(t.index)}}),t.actions&&Bt.default.forEach(t.actions,o=>{if(o.type==="openUrl"){let n=Bt.default.get(o.props,"href").replace("__WBCLICKID__",e);window.open(n,Bt.default.get(o.props,"target","_blank"))}})}},Si=Ti;var $s=()=>fe("manufacturedSavingsThrottlingGet");var Ni=r(b());function We(){return(0,Ni.jsx)("div",{className:"blocks-offers",children:(0,Ni.jsx)(Xo,{contentSlug:"blocks-personalized-offers"})})}var Os=r(R());var Ls=()=>fe("manufacturedSavingsThrottlingSet");var mt=r(b()),ta=({payoutProcessingPeriod:s,onClosePopup:t})=>{let[e,i]=(0,Os.useState)(!1),o=async()=>{let n=v.get("siteAPIData","tld");k("track","extSavingsEarned",{domain:n}),await Ls(),t()};return(0,mt.jsxs)("div",{className:"activate-manufactured-wrapper",children:[(0,mt.jsxs)("div",{className:"spacing",children:[(0,mt.jsxs)("h3",{children:["Activate now to receive ",(0,mt.jsx)("span",{className:"palmetto size-emphasis",children:"$5.00"})]}),(0,mt.jsx)("h5",{children:"in Shopping Rewards"})]}),(0,mt.jsxs)("div",{className:"spacing",children:[(0,mt.jsxs)("p",{children:["Complete your purchase now to receive your rewards by"," ",Fe(s)]}),(0,mt.jsx)("p",{children:"You can redeem your Rewards for gift cards from top merchants"})]}),(0,mt.jsx)("div",{className:"activate-button",children:(0,mt.jsx)("button",{className:"primary-btn-large red-btn-test",disabled:e,onClick:()=>{o(),i(!0)},children:e?"Activating Rewards ...":"Activate Rewards"})})]})},Ai=ta;var Ve=r(R());var Y=r(b());function ea(s){k("trackClick","viewExclusionDetails","view details"),window.open(`${it}/s/${s}/coupon`,"_blank")}var Bs={marginTop:30},Ii={marginTop:10},zs="Activate Rewards",ia=({reward:s,payoutProcessingPeriod:t,exclusions:e,tld:i,activateRewardsOnly:o})=>{let[n,a]=(0,Ve.useState)(void 0),p=B(N()),l=c("ext_red_cta_202305")&&!p;return(0,Y.jsx)("div",{style:{display:"flex",height:"100%",overflow:"scroll",padding:c("ext_coupons_streamlined_click")?void 0:"0 28px"},children:(0,Y.jsxs)("div",{style:{alignSelf:s.categories?"flex-start":"safe center",flex:c("ext_coupons_streamlined_click")?1:void 0},children:[!c("ext_coupons_streamlined_click")&&(0,Y.jsxs)("h2",{children:["Activate now to earn ",xt(s,{hidePrefix:!0}),"!"]}),s.type==="threshold"&&s.threshold?(0,Y.jsx)(Gt,{reward:s,containerStyle:Ii}):(0,Y.jsxs)("h6",{style:Ii,children:["Rewards may vary based on exchange rates.",e&&(0,Y.jsxs)(Ve.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,Y.jsxs)("span",{className:"tertiary-link-lighter",onClick:()=>ea(i),children:[" ","view details."]})]})]}),!c("ext_coupons_streamlined_click")&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)("h5",{style:Bs,children:["Complete your purchase now to receive your Rewards by"," ",(0,Y.jsx)("span",{className:"bold",children:Fe(t)}),"."]}),(0,Y.jsx)("h5",{style:Ii,children:"You can redeem your Rewards for gift cards from top merchants."}),!!s.categories&&(0,Y.jsx)("div",{style:Bs,children:(0,Y.jsx)(Ft,{reward:s,tld:i,center:!0})}),(0,Y.jsx)(Yt,{reward:s})]}),(0,Y.jsx)("div",{className:"sticky-cta",children:(0,Y.jsx)("button",{className:`primary-btn-large ${l?"red-btn-test":""}`,disabled:n,onClick:()=>{let{clickId:u}=ve();o({clickId:u,label:zs,fromActivateRewards:!0}),a(!0)},style:c("ext_coupons_streamlined_click")?{width:"100%",marginTop:10}:void 0,children:n?"Activating Rewards...":zs})})]})})},Pi=ia;var pl=r(R()),Di=r(R()),Us=r(Q());var Pt=r(b()),He=class extends Di.Component{constructor(...t){super(...t),this.state={copied:!1}}render(){let t=this.props.coupon;return(0,Pt.jsx)("div",{className:`coupon-item-wrapper ${this.props.active?"active":""} ${t.success?"success":"finished"} ${this.state.copied?"copied":""}`,children:(0,Pt.jsx)("div",{className:"coupon-list-item-container",onClick:this.onClickCopy.bind(this),children:(0,Pt.jsx)("div",{className:"details",children:(0,Pt.jsx)("h4",{className:"code midnight bold",children:t.code})})})})}onClickCopy(){let t=J();this.setState({copied:pt(this.props.coupon.code)},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e3)}),k("trackClick","copyCouponCode","code",{clickId:t})}componentWillUnmount(){clearTimeout(this.timeoutId)}};He.defaultProps={stagger:400};var ae=class extends Di.Component{constructor(...t){super(...t);let e=0;this.props.roo&&this.props.currentCodeIndex>-1&&(e=this.props.currentCodeIndex),this.state={active:e},this.onEstimatedCouponDuration=({detail:i})=>{let o=i.currentCodeIndex;o>=0&&o<this.props.coupons.length&&o>this.state.active&&this.setState({active:o})}}componentWillReceiveProps(t){t.pause!==this.state.pause&&(t.pause?clearInterval(this.interval):this.startInterval())}componentDidMount(){this.props.roo&&this.startInterval(),document.addEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration)}startInterval(){let t=this.props.runTimePerCoupon||(this.props.estimatedRunTime+1e3)/this.props.coupons.length;this.interval=setInterval(()=>{let e=this.state.active+1;this.setState({active:e}),e===this.props.coupons.length-1&&clearInterval(this.interval)},t)}componentWillUnmount(){clearInterval(this.interval),document.removeEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration)}render(){let t=!!c("ext_coupons_streamlined_click"),e=t?(this.state.active-1)*40:(this.state.active-4)*40,i=c("ext_coupons_streamlined_click")?"reduced-height":"",o=t?this.state.active>2:this.state.active>4,n={WebkitTransform:`translate3d(0px, -${e}px, 0px)`,transform:`translate3d(0px, -${e}px, 0px)`,msTransform:`translate3d(0px, -${e}px, 0px)`,WebkitTransition:"-webkit-transform 0.3ms ease",transition:"transform 0.3s ease"};return(0,Pt.jsx)("div",{className:"code-list-wrapper",children:(0,Pt.jsx)("div",{style:o?n:{},className:`code-list ${this.props.className||""} ${i}`,children:Us.default.map(this.props.coupons,(a,p)=>(0,Pt.jsx)(He,{last:p===this.props.coupons.length-1,running:this.props.running,result:this.props.result,index:p,active:this.state.active===p,coupon:a,disableChecks:this.props.disableChecks},p))})})}};var qe=r(R());var nt=r(b()),Fi=class extends qe.default.Component{constructor(t){super(t),this.state={answered:!1}}componentDidMount(){k("page","ilSurvey")}handleSelection=t=>{t.type==="change"&&(k("track","ilSurveyResponse",{value:t.target.value}),setTimeout(()=>{this.setState({answered:!0},()=>{this.props.dismiss()})},250))};render(){let t=c("il_survey_split")?"Would you be interested in splitting this purchase into 4 payments with 0% interest and no fees?":c("il_survey_apr")?"Would you be interested in splitting this purchase into equal monthly payments with a competitive APR and no fees?":"Would you be interested in splitting this purchase into equal monthly payments at 0% APR and no fees?";return(0,nt.jsx)("div",{className:"installment-survey",children:this.state.answered?(0,nt.jsxs)(qe.default.Fragment,{children:[(0,nt.jsx)("h3",{children:"Thank you for letting us know!"}),(0,nt.jsx)("p",{children:"We're exploring this as a feature of Capital One Shopping and will let you know if it becomes available!"})]}):(0,nt.jsxs)(qe.default.Fragment,{children:[(0,nt.jsx)("h3",{children:t}),(0,nt.jsxs)("div",{children:[(0,nt.jsxs)("div",{className:"answer",children:[(0,nt.jsx)("input",{type:"radio",className:"default",name:"survey-response",id:"survey-response-yes",onChange:this.handleSelection,value:"yes"}),(0,nt.jsx)("label",{htmlFor:"survey-response-yes",children:"Yes"})]}),(0,nt.jsxs)("div",{className:"answer",children:[(0,nt.jsx)("input",{type:"radio",className:"default",name:"survey-response",id:"survey-response-no",onChange:this.handleSelection,value:"no"}),(0,nt.jsx)("label",{htmlFor:"survey-response-no",children:"No"})]})]})]})})}},Ei=Fi;var at=r(b()),oa=()=>(0,at.jsxs)("svg",{width:"232",height:"157",viewBox:"0 0 232 157",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,at.jsx)("circle",{cx:"120.273",cy:"66.7137",r:"55.183",fill:"#0276B1"}),(0,at.jsx)("path",{d:"M91.229 83.5287C98.2439 87.999 105.053 90.2341 111.655 90.2341C115.85 90.2341 119.22 89.4088 121.765 87.7583C124.309 86.1077 125.581 83.8726 125.581 81.0528C125.581 77.7517 123.415 75.2758 119.082 73.6253L114.027 71.5621C108.182 69.2238 104.021 66.6447 101.545 63.825C99.138 61.0053 97.9344 57.3947 97.9344 52.9932C97.9344 48.2478 99.2068 44.0526 101.751 40.4076C104.296 36.6938 107.735 33.8741 112.067 31.9484C116.469 29.954 121.386 28.9568 126.819 28.9568C130.74 28.9568 134.9 29.5069 139.302 30.6073C143.703 31.6389 147.245 32.9456 149.927 34.5274L147.245 48.0415C144.769 46.5284 141.846 45.3249 138.477 44.4308C135.175 43.468 132.046 42.9866 129.089 42.9866C125.375 42.9866 122.383 43.7087 120.114 45.153C117.913 46.5284 116.813 48.3853 116.813 50.7236C116.813 52.2367 117.294 53.4402 118.257 54.3343C119.22 55.2283 121.18 56.2943 124.137 57.5322L129.192 59.6986C134.694 62.1057 138.614 64.8222 140.952 67.8483C143.291 70.8056 144.46 74.5881 144.46 79.1959C144.46 84.354 143.188 88.8587 140.643 92.71C138.098 96.4925 134.591 99.4154 130.121 101.479C125.65 103.473 120.492 104.47 114.646 104.47C106.394 104.47 98.5878 102.51 91.229 98.5901V83.5287Z",fill:"white"}),(0,at.jsx)("path",{d:"M57.73 29.6364C55.4526 30.2482 53.1151 28.9172 52.5135 26.666C51.9118 24.4148 53.2724 22.0903 55.5497 21.4784C57.8271 20.8666 60.1646 22.1976 60.7663 24.4488C61.3679 26.7 60.0073 29.0246 57.73 29.6364Z",fill:"#281830"}),(0,at.jsx)("path",{d:"M164.824 9.46223C162.765 10.6147 160.174 9.89826 159.04 7.8634C157.907 5.82853 158.658 3.24066 160.717 2.0882C162.775 0.935729 165.367 1.65217 166.5 3.68703C167.633 5.7219 166.882 8.30977 164.824 9.46223Z",fill:"#CC2427"}),(0,at.jsx)("path",{d:"M219.769 81.6748L214.815 71.7271L209.862 61.7795L220.931 62.4522L232 63.1248L225.884 72.3998L219.769 81.6748Z",fill:"#98D5EC"}),(0,at.jsx)("path",{d:"M23.483 33.3298L27.1139 30.2731C27.1139 30.2731 16.7896 28.992 15.0857 22.2543C12.6536 12.6373 5.07239 9.98347 5.07239 9.98347L1.22218 13.1913C1.22218 13.1913 6.41654 16.1741 9.96631 25.139C13.6656 34.4813 23.483 33.3298 23.483 33.3298Z",fill:"#98D5EC"}),(0,at.jsx)("path",{d:"M190.01 110.924L194.315 112.916C194.315 112.916 191.075 103.005 196.429 98.5896C204.072 92.2881 203.239 84.2805 203.239 84.2805L198.705 82.1536C198.705 82.1536 198.225 88.136 191.646 95.1738C184.791 102.508 190.01 110.924 190.01 110.924Z",fill:"#CC2427"}),(0,at.jsx)("path",{d:"M212.266 30.3042C212.266 30.3042 212.392 26.2833 216.522 25.1719C220.143 24.1977 220.048 22.5491 220.048 22.5491C220.048 22.5491 215.036 19.9703 212.293 16.6328C210.213 14.1012 210.241 10.347 210.241 10.347C210.241 10.347 210 12.5232 205.239 14.9111C203.772 15.6465 200.975 16.0245 200.975 16.0245C200.975 16.0245 202.814 20.7328 205.115 23.9045C207.416 27.0763 212.266 30.3042 212.266 30.3042Z",fill:"#3374AC"}),(0,at.jsx)("path",{d:"M31.3189 76.0543C31.3189 76.0543 32.6673 72.6618 36.5354 72.9946C39.9264 73.2864 40.3534 71.8497 40.3534 71.8497C40.3534 71.8497 36.8719 68.0942 35.561 64.3952C34.5664 61.5892 35.7491 58.394 35.7491 58.394C35.7491 58.394 34.8716 60.1764 30.0716 60.7375C28.5932 60.9103 26.0888 60.3651 26.0888 60.3651C26.0888 60.3651 26.2058 64.9539 27.1907 68.3745C28.1757 71.7951 31.3189 76.0543 31.3189 76.0543Z",fill:"#CC2427"}),(0,at.jsx)("path",{d:"M51.9231 118.149C51.9231 118.149 49.3936 115.522 51.2873 112.124C52.9474 109.145 51.817 108.164 51.817 108.164C51.817 108.164 46.9708 109.8 43.0688 109.477C40.1088 109.232 37.6905 106.837 37.6905 106.837C37.6905 106.837 38.9499 108.372 37.4856 112.989C37.0346 114.411 35.5088 116.476 35.5088 116.476C35.5088 116.476 39.7286 118.256 43.2433 118.763C46.7581 119.27 51.9231 118.149 51.9231 118.149Z",fill:"#98D5EC"}),(0,at.jsx)("ellipse",{cx:"120.284",cy:"152.263",rx:"45.1112",ry:"4.2963",fill:"#D9D9D9"})]}),Ws=oa;var Ut=r(b()),sa=()=>(0,Ut.jsxs)("div",{className:"manufactured-rewards-wrapper",children:[(0,Ut.jsx)("h5",{children:"Limited Time Offer!"}),(0,Ut.jsx)("h3",{children:"You've been selected for a special one time offer!"}),(0,Ut.jsx)("div",{className:"celebrate-svg",children:(0,Ut.jsx)(Ws,{})})]}),Mi=sa;var Vs=r(R()),Hs=r(R()),pe=r(Q());var Pl=r(R()),$i=r(b()),na=s=>{let t=s.h||60,e=s.w||76;return(0,$i.jsx)("svg",{className:"checkmark-icon",width:e,height:t,viewBox:"0 0 76 60",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,$i.jsx)("path",{d:"M24.323 57.46h0L2.668 35.91l-.002-.002a.79.79 0 01-.235-.563v-.005c0-.217.08-.412.232-.565l.001-.001 5.862-5.86s0 0 0 0a.787.787 0 01.565-.235h.002a.78.78 0 01.562.235h0L23.77 43.027l1.061 1.06 1.06-1.06L66.378 2.541h.001a.785.785 0 01.512-.233 1.5 1.5 0 01.364.088.73.73 0 01.251.147l.001.001 5.836 5.898h0a.8.8 0 01-.003 1.123l1.06 1.06-1.06-1.06L25.447 57.46a.788.788 0 01-.562.231.79.79 0 01-.562-.23z",strokeWidth:"3"})})},re=na;var T=r(b()),Li=class extends Hs.Component{constructor(...t){super(...t),this.state={viewCodes:!1}}componentDidMount(){let t=B(N());if(c("coup_modal_auto_dismiss")&&!t){let e=this.props.reward?8e3:5e3;this.props.closeModalTimeout(e)}}render(){let{runTimeSeconds:t,couponCount:e,reward:i,codes:o,postCoupons:n,requiresInput:a,view:p}=this.props,l=i&&i.amount&&!i.categories&&!n&&!p.hasDeferredCouponRewards,u=B(N()),h=c("ext_red_cta_202305")&&!u,_=`${c("ext_coupons_streamlined_click")?"primary-btn-small":"primary-btn-large"} ${h?"red-btn-test":""}`,y=c("ext_modal_savings_emphasis")?Ce():null,f=!!y;return(0,T.jsxs)("div",{className:"no-savings-wrapper",children:[a&&(0,T.jsxs)("div",{className:"no-savings-header",children:[(0,T.jsx)("h2",{children:"Code Entered"}),o&&o.length&&!c("ext_coupons_streamlined_click")&&(0,T.jsx)("div",{className:"view-codes-link-wrapper",children:(0,T.jsx)("h6",{onClick:l?()=>this.setState({viewCodes:!this.state.viewCodes}):null,className:`${l?"clickable":""} bold"`,children:this.state.viewCodes?(0,T.jsx)("span",{children:"hide codes"}):(0,T.jsxs)("span",{children:[c("coup_fo_202403_test")?"A variety of codes":`${e} ${e===1?"code":"codes"}`," ","tested in ",t," sec."]})})})]}),this.state.viewCodes&&!l?(0,T.jsx)("div",{className:"view-codes",children:pe.default.map(o,(m,C)=>{let x=this.state.copied===m.code;return(0,T.jsx)("div",{onClick:this.onClickCopy.bind(this,m.code),style:{animationDelay:`${(C+1)*50}ms`},className:`coupon-list-item-container gray ${x?"copied":""}`,children:(0,T.jsxs)("h4",{className:"code midnight bold",children:[x?(0,T.jsx)("span",{className:"copied-text",children:"COPIED"}):m.code,(0,T.jsx)("span",{className:"hidden",children:m.code})]})},C)})}):null,l&&a?(0,T.jsx)("div",{className:c("ext_coupons_streamlined_click")?void 0:"center-content",children:(0,T.jsxs)("div",{className:"activation-amount",children:[(0,T.jsxs)("h3",{className:"silver",style:c("ext_coupons_streamlined_click")?{margin:"10px 0"}:void 0,children:[(0,T.jsx)("span",{className:"palmetto bold",children:i.type==="percentage"?`+${i.amount/100}%`:"+"+H(i.amount,{currency:i.currency})})," ",(0,T.jsx)("span",{className:"antialiased",children:"Shopping Rewards"})]}),pe.default.get(this.props,"exclusions")?(0,T.jsx)(wt,{style:c("ext_coupons_streamlined_click")?{display:"flex"}:{height:"19px",marginTop:"1px",display:"flex",alignItems:"center",justifyContent:"center"},onDetailsClick:this.onShowExclusion.bind(this)}):null]})}):!p.hasDeferredCouponRewards&&!i.categories&&a?(0,T.jsx)("div",{className:"center-content",children:(0,T.jsxs)("h6",{className:"bold",children:[c("coup_fo_202403_test")?"A variety of codes":`${e} ${e===1?"code":"best codes"}`," ","tested in ",t," sec."]})}):!p.hasDeferredCouponRewards&&i.categories&&a?(0,T.jsx)("div",{}):!p.hasDeferredCouponRewards||!a?(0,T.jsxs)("div",{className:c("ext_coupons_streamlined_click")?void 0:"center-column",children:[c("ext_coupons_streamlined_click")&&(0,T.jsx)("div",{className:"best-price-image",style:{width:140,height:140,margin:"0 auto"},children:(0,T.jsx)(re,{w:"100%",h:"100%"})}),(0,T.jsx)("h2",{style:c("ext_coupons_streamlined_click")?{fontSize:20}:void 0,children:"You have a great price."}),!c("ext_coupons_streamlined_click")&&!f&&(0,T.jsx)("div",{className:"best-price-image",children:(0,T.jsx)(re,{})}),c("ext_coupons_streamlined_click")?(0,T.jsx)("h4",{className:"bold left",children:i&&p.hasDeferredCouponRewards?(0,T.jsxs)(T.Fragment,{children:["Activate now to earn ",xt(i,{hidePrefix:!0})]}):(0,T.jsxs)(T.Fragment,{children:["We tried"," ",(0,T.jsx)("span",{children:c("coup_fo_202403_test")?"a variety of codes":`${e} ${e===1?"code":"codes"}`})]})}):(0,T.jsxs)("p",{style:f?{textAlign:"center",marginTop:8}:void 0,children:["We tried"," ",(0,T.jsx)("span",{children:c("coup_fo_202403_test")?"a variety of codes":`${e} ${e===1?"code":"codes"}`})," ","to make sure you got a great price, but did not find any additional savings."]}),f&&(0,T.jsxs)("div",{style:{textAlign:"center",marginTop:64},children:[(0,T.jsx)("h6",{className:"bold",children:(0,T.jsx)(ke,{prefixText:"You've",hoverText:"saved"})}),(0,T.jsx)("h1",{className:"brand",children:y}),(0,T.jsx)("h6",{className:"bold",children:"so far with"}),(0,T.jsx)("h6",{className:"bold",children:"Capital One Shopping"})]})]}):null,(!i||!p.hasDeferredCouponRewards)&&(0,T.jsx)("div",{className:"dismiss-notif",children:ft()&&pe.default.get(this,"props.view.manuallyActivatedAutoRun")&&!(pe.default.get(this,"props.view.result.savings")>0)?(0,T.jsx)(Vs.default.Fragment,{children:(0,T.jsx)(De,{view:this.props.view,isCashback:this.props.isCashback,onTryCodes:this.props.onTryCodes,buttonClassName:_})}):(0,T.jsx)("button",{className:_,onClick:this.props.onClosePopup.bind(this),style:c("ext_coupons_streamlined_click")?{width:"100%",marginTop:10}:void 0,children:"Continue to Checkout"})})]})}onShowExclusion(){k("trackClick","viewExclusionDetails","view details"),window.open(`${it}/s/${this.props.tld}/coupon`,"_blank")}onClickCopy(t){let e=J();pt(t),this.setState({copied:t},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e3)}),k("trackClick","copyCouponCode","code",{clickId:e})}},Oi=Li;var au=r(R()),js=r(R()),Gs=r(Q());var qs=r(R()),yt=r(b()),Bi=class extends qs.default.Component{render(){return this.props.type==="half"?this.half():this.full(this.props.type)}half(){return(0,yt.jsxs)("svg",{className:"nc-icon glyph star",x:"0px",y:"0px",width:"48px",height:"48px",viewBox:"-281 373 48 48",children:[(0,yt.jsx)("g",{children:(0,yt.jsx)("path",{fill:"#E8E8E8",stroke:"#acaaaa",d:`M-256.1,376l6.5,13.2l14.6,2.1c0.8,0.1,1.1,1.1,0.6,1.7l-10.5,10.3l2.5,14.5c0.1,0.8-0.7,1.4-1.5,1.1l-13-6.9
            l-13,6.9c-0.7,0.4-1.6-0.2-1.5-1.1l2.5-14.5l-10.5-10.3c-0.6-0.6-0.3-1.6,0.6-1.7l14.6-2.1l6.5-13.2
            C-257.5,375.2-256.5,375.2-256.1,376z`})}),(0,yt.jsx)("g",{children:(0,yt.jsx)("path",{fill:"#F9C319",d:`M-257,412l-13,6.9c-0.7,0.4-1.6-0.2-1.5-1.1l2.5-14.5l-10.5-10.3c-0.6-0.6-0.3-1.6,0.6-1.7l14.6-2.1l6.5-13.2
            c0.2-0.4,0.5-0.6,0.9-0.6L-257,412z`})})]})}full(t){let e=this.props.type==="empty";return(0,yt.jsx)("svg",{onClick:this.props.onClick?this.props.onClick.bind(this,this.props.rating):null,className:"nc-icon glyph star",x:"0px",y:"0px",width:"48px",height:"48px",viewBox:"0 0 48 48",children:(0,yt.jsx)("g",{children:(0,yt.jsx)("path",{fill:e?"#E8E8E8":"#f9c319",stroke:e?"#acaaaa":"#f9c319",d:"M24.897,2.99l6.521,13.211l14.577,2.119c0.82,0.119,1.148,1.127,0.554,1.706L36,30.307l2.49,14.52 c0.14,0.817-0.717,1.44-1.451,1.054l-13.038-6.854l-13.04,6.856C10.227,46.27,9.37,45.647,9.51,44.83L12,30.307L1.451,20.026 c-0.594-0.578-0.266-1.587,0.554-1.706l14.577-2.119L23.103,2.99C23.47,2.247,24.53,2.247,24.897,2.99z"})})})}},zi=Bi;var Wt=r(b()),Ui=class extends js.Component{constructor(...t){super(...t),this.state={deduction:5}}componentDidMount(){k("track","reviewWikibuyVisible",{})}render(){return this.state.confirmation?(0,Wt.jsx)("span",{}):(0,Wt.jsxs)("div",{className:"review-wrapper",children:[(0,Wt.jsx)("h4",{className:"bold charcoal",style:{textAlign:"center",marginBottom:15},children:"How would you rate Capital One Shopping?"}),(0,Wt.jsx)("div",{className:"review-wikibuy",children:Gs.default.map(new Array(5),(t,e)=>(0,Wt.jsx)(zi,{onClick:this.starWikibuy.bind(this,e),rating:e,type:this.state.deduction<=e?"fill":"empty"},e))})]})}starWikibuy(t){this.setState({deduction:t}),this.rateWikibuy("star",t)}checkStars(t){let e=this.state.deduction;e===0?this.rateWikibuy(t,e):this.rateWikibuy(t,e)}rateWikibuy(t,e){let i=this.props.savings;k("trackClick","rateWikibuy",t,{savings:i,rating:5-e});let n=wo().browser.name;if(e===0){if(n==="Edge"){window.open("https://microsoftedge.microsoft.com/addons/detail/capital-one-shopping-add/kiiaghlmeikbpmeabhilfphikfcefljn","_blank");return}else if(n==="Firefox"){window.open("https://addons.mozilla.org/en-US/firefox/addon/wikibuy-for-firefox/","_blank");return}window.open("https://chromewebstore.google.com/detail/capital-one-shopping-save/nenlahapcbofgnanklpelkaejcehkggg/reviews?hl=en-US","_blank")}this.props.onClosePopup("rate capital one shopping")}},je=Ui;var gu=r(R()),Ys=r(R()),Wi=r(Q());var U=r(b()),Vi=class extends Ys.Component{constructor(...t){super(...t),this.state={}}render(){let{runTimeSeconds:t,couponCount:e,savings:i,reward:o,workingCoupons:n,postCoupons:a,isBonkersSavings:p,onClosePopup:l,hasDeferredCouponRewards:u}=this.props,h=l?l.bind(this):null,_=o&&o.amount&&!a&&!u,y=B(N()),f=c("ext_red_cta_202305")&&!y;return(0,U.jsxs)("div",{className:`savings-wrapper ${o.categories?"has-categories":""}`,children:[(0,U.jsxs)("div",{className:`coupon-count ${_?"":"no-reward"}`,children:[this.props.requiresInput||p?(0,U.jsx)("h2",{children:"Code Entered"}):(0,U.jsxs)("h2",{className:c("ext_coupons_streamlined_click")?"center":void 0,children:["You saved ",(0,U.jsx)("span",{className:"palmetto",children:i})]}),n.length?(0,U.jsxs)("h6",{className:"bold center",children:[n.length," ",n.length===1?" code ":" codes "," worked in"," ",t," sec."]}):(0,U.jsxs)("h6",{className:"bold center",children:[c("coup_fo_202403_test")?"A variety of codes":`${e} ${e===1?"code":"codes"}`," ","tested in ",t," sec."]})]}),_||n.length?(0,U.jsxs)("div",{className:"center-content",children:[(0,U.jsx)("div",{className:`flex-center savings-breakdown ${_?"reward":""} ${this.props.hideBorder?"hide-border":""}`,children:(0,U.jsx)("div",{className:"code-scroll-container",children:this.renderWorkingCodes(n)})}),_&&!o.categories&&this.props.requiresInput?(0,U.jsxs)("div",{className:"activation-amount",children:[(0,U.jsxs)("h3",{className:"silver",children:[(0,U.jsx)("span",{className:"palmetto bold",children:o.type==="percentage"?`+${o.amount/100}%`:H(o.amount,{currency:o.currency})})," ",(0,U.jsx)("span",{className:"antialiased",children:"Shopping Rewards"})]}),Wi.default.get(this.props,"exclusions")?(0,U.jsx)(wt,{style:{height:"19px",marginTop:"1px",display:"flex",alignItems:"center",justifyContent:"center"},onDetailsClick:this.onShowExclusion.bind(this)}):null]}):null]}):null,h?(0,U.jsx)("div",{className:`dismiss-notif ${_&&!o.categories&&this.props.requiresInput?"code-entered-cashback":""}`,children:(0,U.jsx)("button",{className:`primary-btn-large ${f?"red-btn-test":"brand"}`,onClick:h,children:"Continue to Checkout"})}):null]})}onShowExclusion(){k("trackClick","viewExclusionDetails","view details"),window.open(`${it}/s/${this.props.tld}/coupon`,"_blank")}renderWorkingCodes(t){return Wi.default.map(t,(e,i)=>{let o=this.state.copied===e.code;return(0,U.jsx)("div",{onClick:this.onClickCopy.bind(this,e.code),style:{animationDelay:`${(i+1)*50}ms`},className:`coupon-list-item-container ${o?"copied":""}`,children:(0,U.jsxs)("h4",{className:"code midnight bold",children:[o?(0,U.jsx)("span",{className:"copied-text",children:"COPIED"}):e.code,(0,U.jsx)("span",{className:"hidden",children:e.code})]})},i)})}onClickCopy(t){let e=J();pt(t),this.setState({copied:t},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e3)}),k("trackClick","copyCouponCode","code",{clickId:e})}},Hi=Vi;var Vt=r(b()),aa=s=>(0,Vt.jsx)("div",{className:"try-codes-wrapper",style:{textAlign:"center"},children:(0,Vt.jsxs)("div",{children:[(0,Vt.jsx)("h2",{children:"Trying Coupon Codes"}),(0,Vt.jsx)("h5",{className:"silver",children:"Capital One Shopping automatically tries coupon codes to save you money."}),s.renderProgressRunning(),(0,Vt.jsx)("div",{className:"streamlined",children:s.renderProgressBar()})]})}),Zs=aa;var Tt=r(R()),Yi=r(Q());var Ks=r(R()),qi=r(b()),Ge=class extends Ks.default.Component{constructor(...t){super(...t),this.state={progress:0,end:0}}componentWillMount(){let t=this.props.coupons.length||0,e,i;this.props.currentCodeIndex===-1?(e=0,i=1/t*100):(i=(this.props.currentCodeIndex+1)/t*100,this.props.currentCodeIndex===0?e=15:e=this.props.currentCodeIndex/t*100),e>this.state.progress&&(this.setState({progress:Math.round(e)}),this.setState({end:Math.round(i)}),this.initInterval())}componentWillUnmount(){clearInterval(this.intervalId)}componentWillReceiveProps(t){if(!this.props.complete&&t&&t.complete)clearInterval(this.intervalId),this.setState({progress:100});else if(!this.props.complete&&t&&t.currentCodeIndex){if(clearInterval(this.intervalId),this.props.coupons.length){let e=t.currentCodeIndex/this.props.coupons.length*100;if(e>this.state.progress){let i=(t.currentCodeIndex+1)/this.props.coupons.length*100;this.setState({progress:Math.round(e)}),this.setState({end:Math.round(i)})}}this.initInterval()}}initInterval(){let t=Math.round(this.props.runTimePerCoupon*this.props.coupons.length/100);this.intervalId=setInterval(()=>{this.state.progress<this.state.end?this.setState({progress:this.state.progress+1}):clearInterval(this.intervalId)},t)}render(){return(0,qi.jsx)("div",{className:this.props.rounded?"rounded progress-bar":"progress-bar",children:(0,qi.jsx)("div",{className:"progress",style:{width:`${Math.min(this.state.progress||10,100)}%`}})})}};Ge.defaultProps={estimatedDuration:3e3};var ji=Ge;var ce=r(R());function Gi(s,t,e=!0){let i=(0,ce.useRef)();(0,ce.useEffect)(()=>{i.current=s},[s]),(0,ce.useEffect)(()=>{function o(){i.current?.()}if(e){let n=window.setTimeout(o,t);return()=>window.clearTimeout(n)}},[t,e])}var ct=r(b()),ra=s=>{let{currentCodeIndex:t,coupons:e}=s,i="Finding great deals...",[o,n]=(0,Tt.useState)(i),[a,p]=(0,Tt.useState)(0),[l,u]=(0,Tt.useState)(0),[h,_]=(0,Tt.useState)(0);return(0,Tt.useEffect)(()=>(u(Date.now()),()=>{u(0),_(0)}),[]),Gi(()=>{let y=(Date.now()-l)/1e3;_(y)},4e3,l>0),(0,Tt.useEffect)(()=>{if(t){if(t>1){let y=(Date.now()-l)/1e3;_(y)}p(t/e.length)}},[t]),(0,Tt.useEffect)(()=>{e.length>1&&a<.8&&h>4&&n("Checking for savings..."),(a>=.8||e.length===1&&h>4)&&n("Wrapping up...")},[a,h]),(0,ct.jsx)("h2",{children:o})},pa=s=>{let{coupons:t,couponCount:e,currentCouponCode:i,roo:o}=s,n=(0,Yi.default)(t).take(e).map((p,l)=>(p.success=!0,p)).value(),a;return o&&(a=Yi.default.findIndex(n,p=>p.code===i),n.forEach((p,l)=>{p.success=l<a})),a},Qs=({currentCodeIndexTigger:s,view:t}={})=>{let e=pa(t);return s||e},Zi=s=>{let{estimatedRunTime:t,barIsComplete:e,coupons:i,currentCodeIndexTigger:o,pause:n,runTimePerCoupon:a,estimatedDuration:p,estimatedTimeLeft:l,resetProgressBarState:u,roo:h,view:_}=s,y=Qs({currentCodeIndexTigger:o,view:_}),f=c("ext_coupons_streamlined_click")?"streamlined":"";return(0,ct.jsx)("div",{className:`progress-bar ${f}`,children:h?(0,ct.jsx)(ji,{estimatedDuration:t,complete:e,currentCodeIndex:y,coupons:i,runTimePerCoupon:a}):(0,ct.jsx)(ts,{pause:n,estimatedDuration:p,complete:e,estimatedTimeLeft:l,resetProgressBarState:u})})},ca=s=>{let{couponCount:t,currentCodeIndexTigger:e,coupons:i,view:o}=s;if(!i)return null;let n=Qs({currentCodeIndexTigger:e,view:o});return(0,ct.jsx)("div",{className:"try-codes-wrapper",children:(0,ct.jsxs)("div",{children:[(0,ct.jsx)(ra,{currentCodeIndex:n,coupons:i}),(0,ct.jsx)("h5",{className:"silver",children:"Capital One Shopping automatically tries coupon codes to save you money."}),(0,ct.jsx)(Zi,{...s,currentCodeIndex:n}),n>-1?(0,ct.jsx)("h5",{style:{textAlign:"center",marginTop:15},className:"bold",children:c("coup_fo_202403_test")?"Trying Coupon Codes":`Trying ${Math.min(n+1,t)} of ${t} Codes`}):(0,ct.jsx)("h5",{style:{height:"20px"}})]})})},Js=ca;var td=r(R()),Ht=r(R()),Dt=r(Q());hn();var Xs=r(R());var le=class extends Xs.Component{constructor(t){super(t)}componentDidCatch(t,e){if(qt("fpError",{name:"financialProductsError",error:t.toString(),label:e.componentStack}),this.props.onFail&&typeof this.props.onFail=="function")return this.props.onFail()}render(){return this.props.children}};var Gu=r(R());var G=r(b()),la=be.div`
  ${ye(we`
    padding: 10px;
    margin-left: 18px;
    margin-right: 19px;
    margin-bottom: 12px;
    border-radius: 5px;
    border: ${({theme:s})=>s.colors.borderNeutralEmphasisLow} solid 2px;
    background-color: #fff;
    &:hover {
      border-color: ${({theme:s})=>s.colors.borderInteractiveHover};
      cursor: pointer;
    }
  `)}
`,ua=be.ul`
  ${ye(we`
    margin-bottom: 10px;
    padding-left: 15px;
    list-style: disc;

    li {
      font-weight: ${({theme:s})=>s.fontWeights.light};
      list-style-position: outside;
    }
  `)}
`,da=be.div`
  ${ye(we`
    display: flex;
    justify-content: center;
    width: 100%;
    min-width: inherit;
    min-height: inherit;
    height: 24px;
    background-color: ${({theme:s})=>s.colors.objectInteractiveEmphasisLow};
    color: ${({theme:s})=>s.colors.objectInteractiveEmphasisHigh};
  `)}
`,ma=({children:s})=>(0,G.jsx)("h1",{className:"text-base font-bold mb-4",children:s}),ha=({card:s,handleClick:t})=>{let e=s.pillText&&s.pillText!=="";return(0,G.jsxs)(la,{onClick:()=>t(s),children:[(0,G.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,G.jsx)("h2",{className:"text-xs font-bold",children:s.name}),e&&(0,G.jsx)("p",{className:"rounded-full bg-gray-150 text-black text-xs leading-0 px-3 py-0.5",children:s.pillText})]}),(0,G.jsxs)("div",{className:"flex mb-3",children:[(0,G.jsx)("div",{className:"flex w-[115px] h-[70px] mr-[10px]",children:(0,G.jsx)("img",{src:s.imageUrl,alt:s.name})}),(0,G.jsxs)("div",{className:"ml-[5px] flex flex-col justify-between w-[165px]",children:[(0,G.jsx)(ua,{children:s.featureList.map((i,o)=>(0,G.jsx)("li",{children:(0,G.jsx)("div",{className:"text-xs font-light leading-[18px]",children:i})},o))}),(0,G.jsx)(da,{children:(0,G.jsx)("p",{className:"leading-6 text-interactive",children:s.ctaText})})]})]})]})},tn=({content:s,handleCardClick:t})=>(0,G.jsxs)("div",{children:[(0,G.jsx)("div",{className:"flex justify-center",children:(0,G.jsx)(ma,{children:s.header})}),(0,G.jsx)("div",{children:s.cards.map(e=>(0,G.jsx)(ha,{card:e,handleClick:t},e.key))})]});var Kt=r(b()),fa="fp_ext_coupon_modal_and_order_confirmation",_a="fp_ext_coupon_modal_only",ga=s=>{try{let t=Dt.default.get(s,"pageData.products");if(t&&t.length>0){let e=Dt.default.find(t,i=>Dt.default.get(i,"list_price")!==null&&Dt.default.get(i,"list_price")>0);if(e)return Dt.default.get(e,"list_price")}return null}catch{return null}},wa=s=>{let t=N(),e=Dt.default.get(s,"session.id",null),{deweyResult:i,onFail:o,couponResult:n}=s,[a,p]=(0,Ht.useState)(null),[l,u]=(0,Ht.useState)(!0),[h,_]=(0,Ht.useState)(!1),y=(m,C)=>new Promise(x=>ao(async()=>{let w={domain:C};return m&&(w.purchasedAmount=m),await go({contentSlug:"fp-coupon-card-content",contentProps:w})}).then(w=>{x(w)})),f=({landingPageUrl:m,attributionTestSegment:C,metricData:x})=>{console.log({landingPageUrl:m,attributionTestSegment:C,metricData:x});let w={...x,pageLocation:"modal"},S=x.cardName.replace(" ","-").replace(/[\u{0080}-\u{FFFF}]/gu,"").toLowerCase(),D="";c(_a)?D="coupon-only":c(fa)&&(D="both");let A=["ext","CMA_SHOP",e,"coupon",t,C,D,S].join("_"),F=`${m}?external_id=${A}`;x.cardKey==="venture-one"&&(F+="&ptgDisable=1"),window.open(F),qt("financialProductsClickCard",w)};return(0,Ht.useEffect)(()=>{(async()=>{try{u(!0);let C=Dt.default.get(i,"pageData.order.total"),x=ga(i),w=await y(C||x,t);(!w||Object.keys(w).length===0||w.cards&&!w.cards.length||w.error)&&(w.error&&(qt("fpError",{name:"fetchBestCardsError",error:w.error}),_(!0)),o()),p(w)}catch(C){qt("fpError",{name:"fetchBestCardsError",error:C.toString()}),_(!0),o()}finally{u(!1)}})()},[]),(0,Ht.useEffect)(()=>{n&&!l&&!h&&_e("couponCardList",{pageLocation:"modal",pagePath:location.pathname,couponRunId:n.couponRunId})},[l,h,n]),h?null:(0,Kt.jsx)(le,{onFail:o,children:(0,Kt.jsx)("div",{children:l?(0,Kt.jsx)("div",{className:"card-list",children:(0,Kt.jsx)("h3",{className:"loading-text",children:"Loading..."})}):(0,Kt.jsx)(tn,{content:a,handleCardClick:f})})})},en=wa;var on=r(R()),sn=r(R()),Ki=r(Q());var P=r(b()),Qi=class extends sn.Component{constructor(...t){super(...t),this.state={viewCodes:!1}}componentDidMount(){let t=B(N());if(c("coup_modal_auto_dismiss")&&!t){let e=this.props.reward?8e3:5e3;this.props.closeModalTimeout(e)}}render(){let{runTimeSeconds:t,couponCount:e,reward:i,codes:o,postCoupons:n,requiresInput:a}=this.props,p=i&&i.amount&&!n&&!i.categories,l=o&&o.length;return(0,P.jsxs)("div",{className:"no-savings-wrapper",children:[a?(0,P.jsxs)("div",{className:"no-savings-header",children:[a?(0,P.jsx)("h2",{children:"Code Entered"}):p?null:(0,P.jsx)("h2",{children:"You have a great price."}),l?(0,P.jsx)("div",{className:"view-codes-link-wrapper",children:(0,P.jsx)("h6",{onClick:p?()=>this.setState({viewCodes:!this.state.viewCodes}):null,className:`${p?"clickable":""} bold"`,children:this.state.viewCodes?(0,P.jsx)("span",{children:"hide codes"}):(0,P.jsxs)("span",{children:[c("coup_fo_202403_test")?"A variety of codes":`${e} ${e===1?"code":"codes"}`," ","tested in ",t," sec."]})})}):null]}):null,this.state.viewCodes&&!p?(0,P.jsx)("div",{className:"view-codes",children:Ki.default.map(o,(u,h)=>{let _=this.state.copied===u.code;return(0,P.jsx)("div",{onClick:this.onClickCopy.bind(this,u.code),style:{animationDelay:`${(h+1)*50}ms`},className:`coupon-list-item-container gray ${_?"copied":""}`,children:(0,P.jsxs)("h4",{className:"code midnight bold",children:[_?(0,P.jsx)("span",{className:"copied-text",children:"COPIED"}):u.code,(0,P.jsx)("span",{className:"hidden",children:u.code})]})},h)})}):null,p&&a?(0,P.jsx)("div",{className:"center-content",children:(0,P.jsxs)("div",{className:"activation-amount",children:[(0,P.jsxs)("h3",{className:"silver",children:[(0,P.jsx)("span",{className:"palmetto bold",children:i.type==="percentage"?`+${i.amount/100}%`:"+"+H(i.amount,{currency:i.currency})})," ",(0,P.jsx)("span",{className:"antialiased",children:"Shopping Rewards"})]}),Ki.default.get(this.props,"exclusions")?(0,P.jsx)(wt,{style:{height:"19px",marginTop:"1px",display:"flex",alignItems:"center",justifyContent:"center"},onDetailsClick:this.onShowExclusion.bind(this)}):null]})}):!i.categories&&a?(0,P.jsx)(on.default.Fragment,{children:l?null:(0,P.jsx)("div",{className:"center-content",children:(0,P.jsxs)("h6",{className:"bold",children:[c("coup_fo_202403_test")?"A variety of codes":`${e} ${e===1?"code":"best codes"}`," ","tested in ",t," sec."]})})}):i.categories&&a?(0,P.jsx)("div",{}):(0,P.jsxs)("div",{className:"center-column",children:[(0,P.jsxs)("div",{className:"flex-row best-price-title",children:[(0,P.jsx)("h2",{children:"You have the best price."}),(0,P.jsx)("div",{className:"best-price-image",children:(0,P.jsx)(re,{h:24,w:30})})]}),(0,P.jsxs)("p",{children:["We tried"," ",(0,P.jsx)("span",{children:c("coup_fo_202403_test")?"a variety of codes":`${e} ${e===1?"code":"codes"}`})," ","to make sure you got a great price, but did not find any additional savings."]})]})]})}onShowExclusion(){k("trackClick","viewExclusionDetails","view details"),window.open(`${it}/s/${this.props.tld}/coupon`,"_blank")}onClickCopy(t){let e=J();pt(t),this.setState({copied:t},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e3)}),k("trackClick","copyCouponCode","code",{clickId:e})}},Ji=Qi;var Id=r(R()),nn=r(R()),Xi=r(Q());var q=r(b()),to=class extends nn.Component{constructor(...t){super(...t),this.state={}}render(){let{runTimeSeconds:t,couponCount:e,savings:i,reward:o,workingCoupons:n,postCoupons:a,isBonkersSavings:p}=this.props,l=o&&o.amount&&!a;return(0,q.jsxs)("div",{className:`savings-wrapper ${o.categories?"has-categories":""}`,children:[(0,q.jsxs)("div",{className:`coupon-count ${l?"":"no-reward"}`,children:[this.props.requiresInput||p?(0,q.jsx)("h2",{children:"Code Entered"}):(0,q.jsx)("h2",{children:(0,q.jsxs)("span",{children:["You saved ",(0,q.jsx)("span",{className:"palmetto",children:i})]})}),n.length?(0,q.jsxs)("h6",{className:"bold center",children:[n.length," ",n.length===1?" code ":" codes "," worked in"," ",t," sec."]}):(0,q.jsxs)("h6",{className:"bold center",children:[e," ",e===1?" code ":" codes "," tested in ",t," ","sec."]})]}),l||n.length?(0,q.jsxs)("div",{className:"center-content",children:[(0,q.jsx)("div",{className:`flex-center savings-breakdown ${l?"reward":""} ${this.props.hideBorder?"hide-border":""}`,children:(0,q.jsx)("div",{className:"code-scroll-container",children:this.renderWorkingCodes(n)})}),l&&!o.categories&&this.props.requiresInput?(0,q.jsxs)("div",{className:"activation-amount",children:[(0,q.jsxs)("h3",{className:"silver",children:[(0,q.jsx)("span",{className:"palmetto bold",children:o.type==="percentage"?`+${o.amount/100}%`:H(o.amount,{currency:o.currency})})," ",(0,q.jsx)("span",{className:"antialiased",children:"Shopping Rewards"})]}),Xi.default.get(this.props,"exclusions")?(0,q.jsx)(wt,{style:{height:"19px",marginTop:"1px",display:"flex",alignItems:"center",justifyContent:"center"},onDetailsClick:this.onShowExclusion.bind(this)}):null]}):null]}):null]})}onShowExclusion(){k("trackClick","viewExclusionDetails","view details"),window.open(`${it}/s/${this.props.tld}/coupon`,"_blank")}renderWorkingCodes(t){return Xi.default.map(t,(e,i)=>{let o=this.state.copied===e.code;return(0,q.jsx)("div",{onClick:this.onClickCopy.bind(this,e.code),style:{animationDelay:`${(i+1)*50}ms`},className:`coupon-list-item-container ${o?"copied":""}`,children:(0,q.jsxs)("h4",{className:"code midnight bold",children:[o?(0,q.jsx)("span",{className:"copied-text",children:"COPIED"}):e.code,(0,q.jsx)("span",{className:"hidden",children:e.code})]})},i)})}onClickCopy(t){let e=J();pt(t),this.setState({copied:t},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e3)}),k("trackClick","copyCouponCode","code",{clickId:e})}},eo=to;var g=r(b()),oo=class extends an.Component{constructor(...t){super(...t),this.state={viewCodes:!1,estimatedTimeLeft:null,willEstimateDuration:!1,currentCodeIndexTigger:0,couponQtTigger:null,viewedInstallmentSurvey:!1,failBackToFinDefault:!1,ctaColorClass:""},this.onInitTryCoupons=()=>{this.setState({willEstimateDuration:!0})},this.onEstimatedCouponDuration=({detail:e})=>{this.setState({estimatedTimeLeft:e.estimatedTimeLeft,currentCodeIndexTigger:e.currentCodeIndex,couponQtTigger:e.couponQt})},this.onFinProductsFail=this.onFinProductsFail.bind(this)}async componentDidMount(){let t=await $s();document.addEventListener("__iv_init_try_coupons",this.onInitTryCoupons),document.addEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration);let e=B(N()),i=c("ext_red_cta_202305")&&!e;this.setState({ctaColorClass:i?"red-btn-test":"",manufacturedSavingsThrottle:t})}componentWillUnmount(){document.removeEventListener("__iv_init_try_coupons",this.onInitTryCoupons),document.removeEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration)}resetProgressBarState(){this.setState({viewCodes:!1,estimatedTimeLeft:null,willEstimateDuration:!1,currentCodeIndexTigger:0,couponQtTigger:null,viewedInstallmentSurvey:!1,failBackToFinDefault:!1})}selectDisplayableCouponsAndCount(){let t=Qt(v.get("couponView")),e=v.get("couponNotif")==="siteHub",i=t.couponCount,o=t.coupons,n=I.default.get(t,"autoFallback.autoFallbackCouponsCount");return n&&Mt({autoFallbackCouponsCount:n})&&!e&&(i=n,o=I.default.get(t,"autoFallback.coupons")),this.props.manuallyActivatedAutoRun&&(i=t.automaticCoupons&&t.automaticCoupons.length,o=t.automaticCoupons,!i&&t.result&&(i=t.result.coupons&&t.result.coupons.length,o=t.result.coupons)),t.manuallyActivatedAutoRun&&(i=t.automaticCoupons&&t.automaticCoupons.length,!i&&t.result&&(i=t.result.coupons&&t.result.coupons.length)),{couponCount:i,coupons:o}}determineCouponCount(){let{couponCount:t}=this.selectDisplayableCouponsAndCount();return t}getCurrentIndexRoo(){let{coupons:t,couponCount:e,currentCouponCode:i,roo:o}=this.props.view,n=(0,I.default)(t).take(e).map((p,l)=>(p.success=!0,p)).value(),a;return o&&(a=I.default.findIndex(n,p=>p.code===i),n=I.default.map(n,(p,l)=>(l<a?p.success=!0:p.success=!1,p))),a}determineManufacturedSavings(t,e){return c("ext_manufactured_savings")&&!c("ext_coupons_streamlined_click")&&t&&e&&!this.state.manufacturedSavingsThrottle}renderProgressRunning(){let{pause:t,barComplete:e}=this.props;this.props.clearCloseModalTimeout();let i=Qt(v.get("couponView")),{currentCodeIndexTigger:o,couponQtTigger:n,estimatedTimeLeft:a}=this.state,p=this.state.willEstimateDuration?8e4:i.estimatedRunTime,{couponCount:l,coupons:u}=this.selectDisplayableCouponsAndCount(),h={pause:t,estimatedRunTime:i.estimatedRunTime,estimatedDuration:p,estimatedTimeLeft:a,barIsComplete:e,view:i,currentCodeIndexTigger:o,couponCount:l,resetProgressBarState:this.resetProgressBarState.bind(this),roo:i.roo,coupons:u,runTimePerCoupon:i.runTimePerCoupon,couponQtTigger:n};return c("ext_coupons_streamlined_click")?(0,g.jsx)(Zi,{...h}):(0,g.jsx)(Js,{...h})}willShowBlocksOffers(){return c("ext_show_blocks_offers")}renderLeft(){let{running:t,barComplete:e,reward:i,postCoupons:o,pause:n,vendor:a,payoutProcessingPeriod:p,creditsActivated:l,activatingCredits:u,activateRewardsOnly:h,onShowExclusion:_,view:y}=this.props,{result:f,couponCount:m,roo:C}=y,x=I.default.get(f,"pageReload"),w=I.default.filter(I.default.get(f,"coupons"),ht=>ht.savings>0||ht.generatedFreeGift||ht.generatedFreeShipping),S=f&&f.savings&&f.savings>0?H(Math.trunc(f.savings)):0,D=I.default.get(f,"savings")>1e6||typeof S=="string"&&Lt(S)>1e6,A=I.default.get(f,"bestCoupon.code"),F=(I.default.get(f,"runTime",0)/1e3).toFixed(2),E=e&&!n,$=t||x||E,W=f&&(!A||!S)&&!t,L=!E&&!t&&f&&!n,V=f&&f.requiresInput,z=this.props.exclusions,tt=this.props.tld,K=i&&i.amount&&!o&&!y.hasDeferredCouponRewards,et=!$&&!n&&!t&&!f&&K&&this.props.eligibleForNewUserBonus,vt=!Rt()&&!B(N()),St=(!c("ext_coupons_streamlined_click")||!f)&&(0,g.jsxs)(io.default.Fragment,{children:[(0,g.jsx)(ui,{domain:this.props.domain,onTryCodes:this.props.onTryCodes.bind(this),onClosePopup:this.props.onClosePopup.bind(this),renderViewCodes:this.renderViewCodes.bind(this),renderPostResultCtaInUi:L,loading:this.props.ctaLoading,settings:this.props.settings,roo:C,hideExclusions:this.props.fullPageModal&&this.props.fullPageModal.length>0,creditsActivated:l,activatingCredits:u,activateRewardsOnly:h,exclusions:z,onShowExclusion:_,running:t,result:f,couponCount:m,pageReload:x,savings:S,reward:i,showReward:K}),et&&(0,g.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,g.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,g.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]})]}),Nt=this.determineManufacturedSavings(L,y.hasDeferredCouponRewards);return(0,g.jsx)("div",{className:"left",children:(0,g.jsxs)("div",{className:`result-column ${I.default.get(this.props.googleData,"contacts.length")?"has-contacts":""}`,children:[$||n?this.renderProgressRunning():!t&&!f||t||x||E?(0,g.jsx)("div",{children:(0,g.jsxs)("div",{className:"found-codes",children:[vt&&(0,g.jsx)(Et,{domain:N()}),u?(0,g.jsxs)("h2",{children:["Activating ",i.categories?"up to ":"",(0,g.jsx)("span",{className:"palmetto",children:i.type==="percentage"?`${i.amount/100}%`:H(i.amount,{currency:i.currency})})," ","back"]}):(0,g.jsx)(ee,{couponCount:m,showReward:K,reward:i})]})}):W?Nt?(0,g.jsx)(Mi,{}):!y.hasDeferredCouponRewards&&(i.categories||i.tiers)&&!V?(0,g.jsx)(Xt,{reward:i,payoutProcessingPeriod:p,exclusions:z,tld:tt,showDismiss:!0,noSavingsAvailable:!0,vendor:a,couponCount:this.determineCouponCount(),onClosePopup:this.props.onClosePopup.bind(this),onTryCodes:this.props.onTryCodes.bind(this),ctaColorClass:this.state.ctaColorClass,view:this.props.view}):(0,g.jsx)(Oi,{exclusions:z,tld:tt,runTimeSeconds:F,roo:C,reward:i,postCoupons:o,requiresInput:V,workingCoupons:w,vendor:a,couponCount:this.determineCouponCount(),closeModalTimeout:this.props.closeModalTimeout.bind(this),manuallyActivatedAutoRun:this.props.manuallyActivatedAutoRun,codes:I.default.get(f,"coupons"),onClosePopup:this.props.onClosePopup.bind(this),onTryCodes:this.props.onTryCodes.bind(this),view:this.props.view}):(0,g.jsx)(Hi,{activateRewardsOnly:h,exclusions:z,tld:tt,runTimeSeconds:F,couponCount:m,savings:S,reward:i,postCoupons:o,workingCoupons:w,requiresInput:V,isBonkersSavings:D,hideBorder:i.categories,onClosePopup:this.props.onClosePopup.bind(this),hasDeferredCouponRewards:y.hasDeferredCouponRewards}),St]})})}renderProgressBar(){let{view:t,autoFallback:e}=this.props,{result:i,pageWasReloaded:o,estimatedRunTime:n,runTimePerCoupon:a,roo:p}=this.props.view,l=B(N()),u=t.couponCount,h=t.coupons;this.props.manuallyActivatedAutoRun&&(u=t.automaticCoupons&&t.automaticCoupons.length,h=t.automaticCoupons,!u&&t.result&&(u=t.result.coupons&&t.result.coupons.length,h=t.result.coupons)),c("coupon_non_rerun")&&!l&&e&&t.autoFallback&&(u=I.default.get(t,"autoFallback.autoFallbackCouponsCount",u),h=I.default.get(t,"autoFallback.coupons",h));let{running:_,barComplete:y,pause:f}=this.props,m=this.props.getRunAnimation(this.state.willEstimateDuration),C=(0,I.default)(h).take(u).map((A,F)=>(A.success=!0,A)).value(),x=this.getCurrentIndexRoo(),w=I.default.get(i,"pageReload");return _||w||y&&!f||f?(0,g.jsx)("div",{className:"run-codes",children:(0,g.jsx)(ae,{pause:f,runTimePerCoupon:a,currentCodeIndex:x,estimatedRunTime:n,roo:p,disableChecks:!0,show:_||i,result:i,running:_,coupons:C,stagger:o?0:m.stagger,collapsable:!0})}):null}renderRightComponent(){let{activateRewardsOnly:t,view:e}=this.props,{result:i}=e,{running:o,barComplete:n,reward:a,postCoupons:p,pause:l,payoutProcessingPeriod:u}=this.props,h=i&&i.savings&&i.savings>0?H(Math.trunc(i.savings)):0,_=I.default.get(i,"bestCoupon.code"),y=n&&!l,f=i&&(!_||!h)&&!o,m=!y&&!o&&i&&!l,C=i&&i.requiresInput,x=this.props.exclusions,w=this.props.tld,S=c("il_survey_split")||c("il_survey_no_apr")||c("il_survey_apr"),D=!c("show_rewards")&&!c("show_price_comparison");return m&&!this.props.reportAProblem&&S&&!this.state.viewedInstallmentSurvey?(0,g.jsx)(Ei,{dismiss:this.dismissInstallmentSurvey}):this.determineManufacturedSavings(m,e.hasDeferredCouponRewards)&&f&&!this.props.reportAProblem?(0,g.jsx)(Ai,{payoutProcessingPeriod:u,onClosePopup:this.props.onClosePopup.bind(this)}):m&&e.hasDeferredCouponRewards&&f&&a&&a.amount&&!this.props.reportAProblem?(0,g.jsx)(Pi,{reward:a,payoutProcessingPeriod:u,exclusions:x,tld:w,activateRewardsOnly:t}):c("ext_coupons_streamlined_click")?null:m&&(a.categories||a.tiers)&&f&&!D&&!this.props.reportAProblem?(0,g.jsxs)("div",{className:"w-full px-6",children:[(0,g.jsx)(Ft,{displayInModal:!0,reward:a,tld:w,center:!0,onClosePopup:this.props.onClosePopup.bind(this)}),(0,g.jsx)(Yt,{reward:a})]}):!e.hasDeferredCouponRewards&&(f&&!a.categories||!f)&&a&&a.amount&&m&&!this.props.reportAProblem&&!C?(0,g.jsx)(Xt,{postCoupons:p,reward:a,payoutProcessingPeriod:u,exclusions:x,tld:w,onTryCodes:this.props.onTryCodes.bind(this),ctaColorClass:this.state.ctaColorClass,view:this.props.view}):this.props.reportAProblem?(0,g.jsx)(li,{email:this.props.email,onClosePopup:this.props.onClosePopup.bind(this),forceReportCoupon:this.props.forceReportCoupon,toggleReportAProblem:this.props.toggleReportAProblem}):m?this.willShowBlocksOffers()?(0,g.jsx)(We,{}):I.default.get(this.props.storeContentApiData,"items.length")?(0,g.jsx)(Si,{data:this.props.storeContentApiData}):(0,g.jsx)(je,{onClosePopup:this.props.onClosePopup.bind(this),savings:I.default.get(this.props,"view.savings",0)}):null}renderRight(){let{running:t,barComplete:e,pause:i,view:o}=this.props,{result:n}=o,p=!(e&&!i)&&!t&&n&&!i,l=this.determineManufacturedSavings(p,o.hasDeferredCouponRewards);return this.props.hideRight?null:(0,g.jsxs)("div",{className:"right",style:c("ext_coupons_streamlined_click")?{display:"block"}:l?{backgroundColor:"#F7FCFF"}:void 0,children:[this.renderProgressBar(),this.renderRightComponent()]})}renderFinLeft(){let{running:t,barComplete:e,reward:i,postCoupons:o,pause:n,vendor:a,payoutProcessingPeriod:p,manuallyActivatedAutoRun:l,creditsActivated:u,activatingCredits:h,activateRewardsOnly:_,onShowExclusion:y,view:f}=this.props,{result:m,couponCount:C,roo:x}=f,w=I.default.get(m,"bestCoupon.code"),S=I.default.get(m,"pageReload"),D=I.default.filter(I.default.get(m,"coupons"),ht=>ht.savings>0||ht.generatedFreeGift||ht.generatedFreeShipping),A=m&&m.savings&&m.savings>0?H(Math.trunc(m.savings)):0,F=I.default.get(m,"savings")>1e6||typeof A=="string"&&Lt(A)>1e6,E=(I.default.get(m,"runTime",0)/1e3).toFixed(2),$=e&&!n,W=t||S||$,L=m&&(!w||!A)&&!t,V=!$&&!t&&m&&!n,z=m&&m.requiresInput,tt=this.props.exclusions,K=this.props.tld,et=i&&i.amount&&!o,vt=!W&&!n&&!t&&!m&&et&&this.props.eligibleForNewUserBonus,St=c("il_survey_split")||c("il_survey_no_apr")||c("il_survey_apr"),Nt=W||n;return(0,g.jsx)("div",{className:"left",children:(0,g.jsxs)("div",{className:`result-column fin-result-column ${I.default.get(this.props.googleData,"contacts.length")?"has-contacts":""}`,children:[Nt?this.renderProgressRunning():!t&&!m||t||S||$?(0,g.jsx)("div",{children:(0,g.jsxs)("div",{className:"found-codes",children:[N()!=="amazon.com"&&(0,g.jsx)(Et,{domain:N()}),(0,g.jsx)(ee,{couponCount:C,showReward:et,reward:i})]})}):L?i.categories&&!z?(0,g.jsx)(Xt,{reward:i,payoutProcessingPeriod:p,exclusions:tt,tld:K,showDismiss:!0,noSavingsAvailable:!0,vendor:a,couponCount:this.determineCouponCount(),isFinComponent:!0,onTryCodes:this.props.onTryCodes.bind(this),ctaColorClass:this.state.ctaColorClass,view:this.props.view}):(0,g.jsx)(Ji,{exclusions:tt,tld:K,runTimeSeconds:E,couponCount:C,roo:x,reward:i,postCoupons:o,requiresInput:z,workingCoupons:D,vendor:a,manuallyActivatedAutoRun:l,closeModalTimeout:this.props.closeModalTimeout.bind(this),codes:I.default.get(m,"coupons"),onClosePopup:this.props.onClosePopup.bind(this)}):(0,g.jsx)(eo,{exclusions:tt,tld:K,runTimeSeconds:E,couponCount:C,savings:A,reward:i,postCoupons:o,workingCoupons:D,requiresInput:z,isBonkersSavings:F,hideBorder:i.categories,onClosePopup:this.props.onClosePopup.bind(this)}),(0,g.jsx)(ui,{domain:this.props.domain,onTryCodes:this.props.onTryCodes.bind(this),onClosePopup:this.props.onClosePopup.bind(this),renderViewCodes:this.renderViewCodes.bind(this),renderPostResultCtaInUi:V,loading:this.props.ctaLoading,settings:this.props.settings,roo:x,hideExclusions:this.props.fullPageModal&&this.props.fullPageModal.length>0,creditsActivated:u,activatingCredits:h,activateRewardsOnly:_,exclusions:tt,onShowExclusion:y,running:t,result:m,couponCount:C,pageReload:S,savings:A,reward:i,showReward:et}),vt&&(0,g.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,g.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,g.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]}),V&&!this.props.reportAProblem&&St&&!this.state.viewedInstallmentSurvey?(0,g.jsx)(Ei,{dismiss:this.dismissInstallmentSurvey}):V&&i.categories&&L&&!this.props.reportAProblem?(0,g.jsx)(Ft,{displayInModal:!0,reward:i,tld:K,center:!0,onClosePopup:this.props.onClosePopup.bind(this)}):(L&&!i.categories||!L)&&i&&i.amount&&V&&!this.props.reportAProblem&&!z?(0,g.jsx)(Xt,{postCoupons:o,reward:i,payoutProcessingPeriod:p,exclusions:tt,tld:K,onTryCodes:this.props.onTryCodes.bind(this),ctaColorClass:this.state.ctaColorClass,view:this.props.view}):this.props.reportAProblem?(0,g.jsx)(li,{email:this.props.email,onClosePopup:this.props.onClosePopup.bind(this),forceReportCoupon:this.props.forceReportCoupon,toggleReportAProblem:this.props.toggleReportAProblem}):V&&I.default.get(this.props.storeContentApiData,"items.length")?(0,g.jsx)(Si,{data:this.props.storeContentApiData}):V?(0,g.jsx)(je,{onClosePopup:this.props.onClosePopup.bind(this),savings:I.default.get(this.props,"view.savings",0)}):null,!Nt&&!t&&m?(0,g.jsx)("div",{className:"sticky-cta",children:ft()&&I.default.get(this,"props.view.manuallyActivatedAutoRun")&&!(I.default.get(this,"props.view.result.savings")>0)?(0,g.jsx)(io.default.Fragment,{children:(0,g.jsx)(De,{view:this.props.view,isCashback:this.props.isCashback,onTryCodes:this.props.onTryCodes.bind(this),buttonClassName:`primary-btn-small ${this.state.ctaColorClass}`})}):(0,g.jsx)("button",{className:`primary-btn-small ${this.state.ctaColorClass}`,onClick:this.props.onClosePopup.bind(this),children:"Continue to Checkout"})}):null]})})}renderFinRight(){if(this.props.hideRight)return null;let{result:e}=this.props.view,{running:i,barComplete:o,pause:n}=this.props,a=I.default.get(e,"pageReload");return(0,g.jsx)("div",{className:"right",children:i||a||o&&!n||n?this.renderProgressBar():(0,g.jsx)(en,{...this.props,onFail:this.onFinProductsFail})})}renderLayout(){let{view:t}=this.props,e=c("fp_ext_coupon_modal_only")||c("fp_ext_coupon_modal_and_order_confirmation"),i=c("show_financial_products")&&e&&!t.hasDeferredCouponRewards,{failBackToFinDefault:o}=this.state;return i&&!o?(0,g.jsxs)("div",{className:"financial-container",children:[this.renderFinLeft(),this.renderFinRight()]}):(0,g.jsxs)("div",{className:"base",children:[this.renderLeft(),this.renderRight()]})}render(){let{view:t}=this.props;return(0,g.jsx)("div",{className:`render-result-layout ${t.hasDeferredCouponRewards?"activate-rewards":""} ${this.willShowBlocksOffers()?"blocks-offers-container":""}`,children:(this.props.running||this.props.barComplete)&&c("ext_coupons_streamlined_click")?(0,g.jsx)(Zs,{renderProgressBar:this.renderProgressBar.bind(this),renderProgressRunning:this.renderProgressRunning.bind(this)}):this.renderLayout()})}onFinProductsFail(){this.setState({failBackToFinDefault:!0})}renderViewCodes(){let{coupons:t,result:e,couponCount:i}=this.props.view,o=e?t.slice(i,t.length):t;return o&&o.length>0?(0,g.jsxs)("div",{children:[(0,g.jsx)("h4",{className:"bold",style:{marginBottom:"8px",marginTop:"8px",textAlign:"center"},children:(0,g.jsx)("span",{className:"tertiary-link",onClick:this.onClickViewCode.bind(this),children:this.state.viewCodes?"hide codes":"view codes"})}),(0,g.jsx)(Zt,{running:this.props.running,show:!!this.state.viewCodes,coupons:o,collapsable:!0,result:e,disableChecks:!0})]}):null}onClickViewCode(){k("trackClick","toggleCodes",this.state.viewCodes?"hide codes":"view codes"),this.state.viewCodes||Ie(),this.setState({viewCodes:!this.state.viewCodes})}onShowNewUserDetails(){k("trackClick","viewNewUserBonusDetails","Details",{view:"cashbackNotificiation"}),window.open("https://help.capitaloneshopping.com/hc/en-us/articles/360047681572-How-do-I-earn-a-New-Member-Bonus-of-10-in-Wikibuy-Credits-on-my-first-purchase-","_blank")}dismissInstallmentSurvey=()=>{setTimeout(()=>{this.setState({viewedInstallmentSurvey:!0})},4e3)}},so=oo;var X=r(b()),no=class extends pn.Component{constructor(...t){super(...t),this.state={hideNotification:!0,isThrottled:!1,viewCodes:!1,running:this.props.view.rooRunning,rooRunning:this.props.view.rooRunning,didTryCodes:this.props.view.rooRunning||this.props.view.pageWasReloaded||!1,result:this.props.view.result,roo:this.props.view.roo,showThrottleToolTip:this.props.view.showThrottleToolTip,settings:this.props.settings,ctaLoading:!1,autoFallback:d.default.get(this.props,"affiliateRedirect.autoFallback.autoFallback"),automaticCouponsEnabled:zo(),manuallyActivatedAutoRun:this.props.view.manuallyActivatedAutoRun||!1,scriptType:d.default.get(v.get("siteAPIData"),"siteData.coupons.type"),showDismissConfirmation:!1,dismissConfirmationDisplayed:!1},this.activateCreditsAfterAutomatic=this.activateCreditsAfterAutomatic.bind(this),this.activateRewardsOnly=this.activateRewardsOnly.bind(this),this.isRewardSite=this.isRewardSite.bind(this),this.boundCloseModal=this.closeModalOnClickOutside.bind(this),this.determineIfCouponsNotifiedImmediately=this.determineIfCouponsNotifiedImmediately.bind(this)}async getContentAPiData(){let t=await bo();this.setState({storeContentApiData:t})}onDismissConfirmationPageLoad(){this.setState({dismissConfirmationDisplayed:!0})}async componentWillMount(){let t=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled&&!this.state.manuallyActivatedAutoRun,e=ft()&&t;e&&!this.state.result&&this.sendCouponNotificationEvent({runAutomatically:t,notifyImmediate:e});let i=v.get("siteAPIData"),n=d.default.get(i,"siteData.coupons.type")==="eeyore"&&kt();localStorage.getItem("__wb_redirecting")?(n||(localStorage.removeItem("__wb_redirecting"),await Ct("affiliateRedirect")&&(await lt("affiliateRedirect"),v.unset("affiliateRedirect")),this.setState({redirectInCurrentTab:!1},()=>{let a={manuallyActivatedSameTabReload:this.state.manuallyActivatedAutoRun};this.onTryCodes({disableCookieDrop:!0,config:a})})),await Ct("manuallyActivatedAutoRun")&&this.setState({manuallyActivatedAutoRun:!0})):(d.default.get(this.props,"view.affiliateLinkCurrentTab")||kt())&&this.setState({redirectInCurrentTab:!0})}async componentDidMount(){this.getContentAPiData(),this.isAutoFallback(),Ct("manuallyActivatedAutoRun").then(n=>{n&&(this.setState({manuallyActivatedAutoRun:!0}),this.setAutomaticCouponCursor(),v.select("couponView").set("manuallyActivatedAutoRun",!0),this.state.result&&lt("manuallyActivatedAutoRun"))}),await this.determineIfCouponsNotifiedImmediately(),await this.checkThrottledForAutoCoup(),this.checkForCompetitorNotifs(),$o(this.setState.bind(this));let t=!!d.default.get(this.props,"cashbackView.reward.amount");It()&&this.state.result&&!this.state.automaticCouponsEnabled&&v.select("couponView").set("isQuietSavingsMiss",!1),this.state.autoFallback&&this.couponsNonRerun(),It()&&!this.state.automaticCouponsEnabled&&!this.state.didTryCodes&&!this.state.running&&!this.preparingToRun&&!this.state.result&&!v.get("cashbackVisible")&&(t&&Vo({isFromNonAutoRun:!0}),this.setState({hideNotification:!0})),this.props.view.shouldTryCoupons&&!this.state.didTryCodes&&!this.state.running&&!this.preparingToRun&&(this.preparingToRun=!0,this.setState({hideNotification:!1,didTryCodes:!1,result:null,running:!0,barComplete:!1},()=>{this.onTryCodes({ignoreCancelled:!0,disableAutomatic:!1,disableCookieDrop:!1}),this.preparingToRun=!1}));let e=d.default.get(this.props,"view.affiliateLinkCurrentTab")&&this.state.manuallyActivatedAutoRun,i=v.get("couponNotif")==="siteHub",o=this.state.automaticCouponsEnabled&&!this.state.manuallyActivatedAutoRun||!this.state.disableAutomatic&&this.state.automaticCouponsEnabled;o&&this.state.result?this.sendCouponNotificationEvent({runAutomatically:o,isSiteHub:i}):!o&&!e&&this.sendCouponNotificationEvent({runAutomatically:o,isSiteHub:i})}async componentDidUpdate(t,e){if(this.isRewardSite()&&t.warnAboutStandDown!==this.props.warnAboutStandDown&&this.props.warnAboutStandDown&&!v.get("throttleCreditsReactivation")){let o=await ho();v.merge({cashback:o}),this.props.router.push("reactivate")}if(this.props.affiliateRedirect!==t.affiliateRedirect&&this.isAutoFallback(),this.state.autoFallback!==e.autoFallback&&this.couponsNonRerun(),this.state.result!==e.result){this.isAutoFallback();let o,n=v.get("couponNotif")==="siteHub",a=!this.state.manuallyActivatedAutoRun&&this.state.automaticCouponsEnabled||!this.state.disableAutomatic&&this.state.automaticCouponsEnabled;this.state.result&&!this.state.manuallyActivatedAutoRun&&(o=this.state.result.autoFallback),n&&!o&&v.get(["couponView","autoFallback"])&&v.unset(["couponView","autoFallback"]),a||o?this.sendCouponNotificationEvent({runAutomatically:a,isSiteHub:n}):a||(this.sendCouponNotificationEvent({runAutomatically:a,isSiteHub:n}),this.state.result&&n&&(v.unset("couponNotif"),n=!1))}!t.cashbackView.autoActivate&&this.props.cashbackView.autoActivate&&this.onClosePopup(null,{pageLocation:"shopifyButton"})}componentWillReceiveProps(t){if((!this.preparingToRun&&!this.state.running&&!this.state.didTryCodes&&t.view.shouldTryCoupons&&!this.props.view.shouldTryCoupons||this.state.didTryCodes&&t.view.forceTryCoupons&&!this.props.view.forceTryCoupons)&&(this.preparingToRun=!0,this.setState({hideNotification:!1,didTryCodes:!1,result:null,running:!0,barComplete:!1,roo:t.view.roo,automaticCouponsEnabled:!1},()=>{this.onTryCodes({ignoreCancelled:!0}),this.preparingToRun=!1}),t.view.forceTryCoupons))return;let e={};this.state.rooRunning&&this.props.view.rooRunning&&!t.view.rooRunning&&(e.running=!1,e.rooRunning=!1),!this.props.view.shouldDismissTooltip&&t.view.shouldDismissTooltip&&!this.state.running&&!this.state.result&&this.onDismissTooltip(),t.view.result&&(e.result=t.view.result),t.view.roo&&(e.roo=t.view.roo),d.default.has(t,"view.showThrottleToolTip")&&(e.showThrottleToolTip=t.view.showThrottleToolTip),d.default.has(t,"view.hideThrottleToolTip")&&(e.hideThrottleToolTip=t.view.hideThrottleToolTip),this.setState(e),d.default.has(t,"shouldHidePrompt")&&t.shouldHidePrompt===!0&&!t.shouldShowSPAPrompt&&!this.state.hideNotification&&!this.state.running&&!this.state.results&&(v.unset("shouldHidePrompt"),this.setState({hideNotification:!0}),k("track","hideSPAPrompt",{currentLocation:d.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])})),d.default.has(t,"shouldShowSPAPrompt")&&t.shouldShowSPAPrompt===!0&&this.state.hideNotification&&!this.state.running&&!this.state.result&&(v.unset("shouldShowSPAPrompt"),this.setState({hideNotification:!1}),k("track","showSPAPrompt",{currentLocation:d.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])}))}async determineIfCouponsNotifiedImmediately(){let t=await Ct("couponNotifiedImmediately");return t&&(this.state.disableAutomatic||this.setState({couponsHasNotifiedInitially:!0}),this.state.result&&lt("couponNotifiedImmediately")),t}couponsNonRerun(){let{autoFallbackCouponsCount:t}=this.determineCouponTryCount();this.setState({couponsNonRerunCreditNotif:!0});let e=qo(),i=this.isRewardSite(),o=B(N());if(!(c("coupon_non_rerun")&&c("coupon_selective_non_rerun")&&t<=0&&!d.default.get(this.state,"result.errored"))&&c("coupon_non_rerun")&&!o&&t<=0&&!d.default.get(this.state,"result.errored")&&!this.state.couponsNonRerunCreditNotif){if(e&&!i)return;v.set("couponsVisible",!1),this.setState({hideNotification:!0,isThrottled:!0}),Jt(),i&&Ho()}}isAutoFallback(){if(d.default.get(this.state,"automaticCouponsEnabled")&&this.state.result&&d.default.get(this.state.result,"automaticCouponsRun"))return this.setState({autoFallback:!0}),!0;this.props.affiliateRedirect&&d.default.get(this.props,"affiliateRedirect.autoFallback.autoFallback")&&this.setState({autoFallback:!0})}async checkThrottledForAutoCoup(){if(this.state.automaticCouponsEnabled&&ft()){let t=await mo({domain:N(),message:"isThrottled",fromAutoCoupImmediateNotif:!0});if(t){let{isThrottled:e,fromAutoCoupImmediateNotif:i}=t;i&&e&&this.setState({hideNotification:!0,didTryCodes:!0,isThrottled:!0})}}}async checkForCompetitorNotifs(){this.state.isThrottled||this.setState({hideNotification:!1});let t=200,e=1;for(;t<7e3;){let i=document.querySelector("#honeyContainer"),o=document.querySelector("#piggyWrapper");if(i){let n=i.shadowRoot.querySelector("#honey-shadow").style;i.shadowRoot.querySelector("#cornerContent")&&(n.opacity==="1"||n.visibility==="visible")&&(this.setState({compNotifLoaded:!0,rightOffset:"310px"}),this.setState({compNotifLoaded:!0,rightOffset:"455px"}))}if(o&&(o.offsetWidth>0||o.offsetHeight>0)&&this.setState({compNotifLoaded:!0,rightOffset:"340px"}),(document.querySelector(".ebates-notification")||document.querySelector(".ebates-hover.ebates-hover-top"))&&this.setState({compNotifLoaded:!0,rightOffset:"420px"}),await ti(t),e>25&&(t*=1.5),(this.state.running||this.state.results)&&!this.state.automaticCouponsEnabled)break;e+=1}}async manuallyActivateAutocoupRun({clickId:t,couponRunId:e}={}){this.setState({manuallyActivatedAutoRun:!0,disableAutomatic:!0}),v.select("couponView").set("manuallyActivatedAutoRun",!0),sessionStorage.removeItem("__cos_coupon_run_id"),this.state.rooRunning&&sessionStorage.setItem("__r_reload_auto",JSON.stringify({reload:!0,manuallyActivatedAutoRun:!0}));let o=d.default.get(this.props,"cashbackView.reward")?d.default.get(this.props,"cashbackView.reward"):!1,n=d.default.get(this.props.cashbackView,"postCoupons"),a=!1;o&&o.amount&&!n&&(a=!0),await this.determineShouldRespectSameTab()&&(kt()||this.state.redirectInCurrentTab)&&(a||!this.props.view.disableAffiliate)&&await Se(a,{couponRunId:e,clickId:t,fromAutoRun:!1,manuallyActivatedAutoRun:!0})}isRewardSite(){return!!d.default.get(this.props,"cashbackView.reward")}onShowExclusion(){k("trackClick","viewExclusionDetails","view details"),window.open(`${it}/s/${this.props.tld}/coupon`,"_blank")}isResultWithSavings(){let{result:t,running:e}=this.state;if(t){let i=t.savings&&t.savings>0?H(Math.trunc(t.savings)):0,o=t.requiresInput;return!((!d.default.get(t,"bestCoupon.code")||!i)&&!e&&!o)}return!1}trackFirstDragEnd=d.default.once((t,e)=>{So("couponNotification",t,e)});render(){let{roo:t,reportAProblem:e,forceReportCoupon:i}=this.state,{hideNotification:o}=this.state,n=!this.state.running&&!this.props.view.result,a=this.props.view.noScript,p=!!d.default.get(this.props,"cashbackView.reward.amount"),l=d.default.get(this.props,"vendorName",this.props.tld),u=d.default.get(this.props,"cashbackView.payoutProcessingPeriod",{}),h=B(N()),_=!!(this.state.manuallyActivatedAutoRun||this.shouldShowFullPage()),y=_?"full-page":"",f=h&&(this.state.running||d.default.get(this.state.result,"pageReload")||this.state.barComplete)&&d.default.get(this.props.deweyResult,"pageType")!=="checkoutPage",m=n||f||this.state.running===!1&&c("ext_coupons_streamlined_click")?"hide-right":"",C=c("ext_coupons_streamlined_click")&&this.state.running?"streamlined-running":"",x=this.isRewardSite()?d.default.get(this.props,"cashbackView.reward"):!1,w=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled&&!this.state.manuallyActivatedAutoRun,S=!!(this.state.couponsHasNotifiedInitially&&w),{running:D,result:A,pageReload:F}=this.state;if(!ft()&&w&&(!D&&!A||D||F||h&&A.savings<=0&&!A.requiresInput||It()&&(A.savings<=0||!A.savings))&&(o=!0),ft()&&w&&It()&&A&&(A.savings<=0||!A.savings)&&(o=!0),ai(this.state))return null;let $=Ro(this.state.compNotifLoaded),W=Qt(this.props.view),L=this.state.showDismissConfirmation?null:(0,X.jsx)(Jo,{fullPageModal:y,determineIfCouponsNotifiedImmediately:this.determineIfCouponsNotifiedImmediately.bind(this),noScript:a,onClosePopup:this.onClosePopup.bind(this),reportAProblem:({forceCoupon:z}={})=>{this.clearCloseModalTimeout(),this.setState({reportAProblem:!this.state.reportAProblem,forceReportCoupon:z&&!this.state.reportAProblem})},reportAProblemOpen:this.state.reportAProblem,roo:t,runAutomatically:w,running:this.state.running,view:W,isRewardSite:this.isRewardSite()}),V=(0,X.jsx)(rn.default.Fragment,{children:(0,X.jsx)("section",{className:"result-section-wrapper",children:a?(0,X.jsx)(ki,{view:W,reward:x,isCashback:p,postCoupons:d.default.get(this.props,"cashbackView.postCoupons"),eligibleForNewUserBonus:this.props.settings.eligibleForNewUserBonus,onShowExclusion:this.onShowExclusion.bind(this),exclusions:this.props.exclusions}):this.state.showDismissConfirmation?(0,X.jsx)("div",{children:(0,X.jsx)(_s,{reward:x,activateRewardsOnly:this.activateRewardsOnly,exclusions:this.props.exclusions,onShowExclusion:this.onShowExclusion.bind(this),onClosePopup:this.onClosePopup.bind(this),activatingCredits:this.state.activatingCredits,creditsActivated:this.state.creditsActivated,onLoad:this.onDismissConfirmationPageLoad.bind(this)})}):w?(0,X.jsx)("div",{children:(0,X.jsx)(gi,{activateRewardsOnly:this.activateRewardsOnly,activateCredits:this.activateCreditsAfterAutomatic,activatingCredits:this.state.activatingCredits,barComplete:this.state.barComplete,closeModalTimeout:this.closeModalTimeout.bind(this),creditsActivated:this.state.creditsActivated,ctaLoading:this.state.ctaLoading,deweyResult:this.props.deweyResult,didTryCodes:this.state.didTryCodes,domain:N(),eligibleForNewUserBonus:this.props.settings.eligibleForNewUserBonus,exclusions:this.props.exclusions,getRunAnimation:this.getRunAnimation.bind(this),isCashback:p,onClosePopup:this.onClosePopup.bind(this),onShowExclusion:this.onShowExclusion.bind(this),onTryCodes:this.onTryCodes.bind(this),manuallyActivateAutocoupRun:this.manuallyActivateAutocoupRun.bind(this),postCoupons:d.default.get(this.props,"cashbackView.postCoupons"),reportAProblem:e,reward:x,running:this.state.running,settings:this.props.settings,tld:this.props.tld,view:W})}):(0,X.jsx)(so,{activateRewardsOnly:this.activateRewardsOnly,activatingCredits:this.state.activatingCredits,autoFallback:this.state.autoFallback,barComplete:this.state.barComplete,clearCloseModalTimeout:this.clearCloseModalTimeout.bind(this),closeModalTimeout:this.closeModalTimeout.bind(this),couponResult:this.state.result,creditsActivated:this.state.creditsActivated,ctaLoading:this.state.ctaLoading,deweyResult:this.props.deweyResult,domain:N(),eligibleForNewUserBonus:this.props.settings.eligibleForNewUserBonus,email:d.default.get(this.props,"session.email"),exclusions:this.props.exclusions,forceReportCoupon:i,fullPageModal:y,getRunAnimation:this.getRunAnimation.bind(this),googleData:this.props.googleData,hideRight:f,isCashback:p,manuallyActivatedAutoRun:this.state.manuallyActivatedAutoRun,onClosePopup:this.onClosePopup.bind(this),onShowExclusion:this.onShowExclusion.bind(this),onTryCodes:this.onTryCodes.bind(this),payoutProcessingPeriod:u,postCoupons:d.default.get(this.props,"cashbackView.postCoupons"),reportAProblem:e,reward:x,running:this.state.running,session:this.props.session,settings:this.state.settings,shortCode:d.default.get(this.props,"session.short_code"),storeContentApiData:this.state.storeContentApiData,tld:this.props.tld,toggleReportAProblem:({forceCoupon:z}={})=>{this.setState({reportAProblem:!this.state.reportAProblem,forceReportCoupon:z&&!this.state.reportAProblem})},vendor:l,view:W})})});return this.state.showThrottleToolTip?(0,X.jsx)("div",{children:(0,X.jsx)(Ye.Motion,{style:{opacity:(0,Ye.spring)(this.state.hideThrottleToolTip?0:1,{stiffness:180,damping:20})},children:({opacity:z})=>(0,X.jsx)(Do,{tip:!0,tipLabel:"Capital One Shopping tip:",message:(0,X.jsx)("span",{children:'click the "S" above if you want to try codes again.'}),style:{top:"15px",bottom:"auto",width:"461px",left:"auto",right:"310px"},innerStyle:{opacity:`${z}`},onDismissTooltip:this.onDismissTooltip.bind(this)})})}):(0,X.jsx)(uo,{onClick:z=>{this.boundCloseModal(z)},className:o?`disabled coupon-page ${m} ${this.state.resetNotification?y:""} ${w?"run-automatically":""}`:`coupon-page ${C} ${m} ${w?"run-automatically":""} ${y}`,style:{top:0,bottom:"auto",left:$.left??"auto",right:$.right??0,translate:!_&&$.translateX},dragSelector:"header",isDraggable:!_&&c("ext_notif_drag"),onDragEnd:this.trackFirstDragEnd,children:(0,X.jsxs)(Ue,{hideNotification:o,shouldDisableCouponNotifAnimation:S,styles:{className:`coupon-notification ${w&&Rt()||h?"":"notification-min-height"}`},children:[L,V]})})}shouldShowFullPage(){if(c("ext_coupons_streamlined_click")||!this.state.manuallyActivatedAutoRun&&!this.state.disableAutomatic&&this.state.automaticCouponsEnabled)return!1;let e=v.get("siteAPIData");return d.default.get(e,"siteData.coupons.type")==="eeyore"?!1:!this.state.barComplete&&!this.state.running&&d.default.get(this.state.result,"savings",0)>0&&(!this.state.qualified||this.state.qualified&&this.state.activated)||this.state.running||!!this.state.result||d.default.get(this.props.view,"forceTryCoupons")}onDismissTooltip({type:t}={}){this.state.tooltipDismissed||(this.setState({hideThrottleToolTip:!0}),this.setState({hideNotification:!0}),this.setState({tooltipDismissed:!0}),fo("hasSeenCouponsThrottleToolTip"))}dismissOrActivateRewardsOnlyCouponNotificationEvent({ctaText:t,label:e,runAutomatically:i,eventName:o,category:n,pageLocation:a,modalType:p,activateRewardsOnly:l=!1,fromActivateRewards:u=!1,fromAutoCoupImmediateNotif:h=!1}={}){let _=Math.trunc((performance.now()-window.__wb_timing.couponsRequireAt)/1e3),y=v.get(["siteAPIData","siteData","coupons","type"]);u||k("trackClick",o,e,{pageLocation:a,triggerType:i?"auto":null,savings:d.default.get(this,"props.view.result.savings"),bestCoupon:d.default.get(this,"props.view.result.bestCoupon.code"),coupons:d.default.get(this,"props.view.result.coupons"),ctaText:t,runDuration:d.default.get(this,"props.view.result.runTime"),dismissalTimeSeconds:_,category:n,engine:y,modalType:p}),n!=="auto"&&At(i&&!h||u?"couponNotificationResult":"couponNotification",e,l?"cta":"dismiss",l?u?"primary":"secondary":"primary",{redirect:l,cashback:l,pageLocation:a,triggerType:i?"auto":null,savings:d.default.get(this,"props.view.result.savings"),bestCoupon:d.default.get(this,"props.view.result.bestCoupon.code"),coupons:d.default.get(this,"props.view.result.coupons"),runDuration:d.default.get(this,"props.view.result.runTime"),dismissalTimeSeconds:_,category:n,engine:y,modalType:p})}async showDismissConfirmationModal(){let t=this.state.scriptType==="eeyore",e=!1;return c("notif_areyousure_throttling")&&(e=await Ko("areyousure_throttling")),c("notif_areyousure_inplace")&&this.isRewardSite()&&!e&&!this.state.showDismissConfirmation&&!this.shouldShowFullPage()&&!this.state.showDismissConfirmation&&!this.state.creditsActivated&&!t&&!this.props.cashbackView.autoActivate}async onClosePopup(t,e={}){let{ctaText:i,fromTooltip:o,urlChange:n,fromAutoCoupImmediateNotif:a,autoDismissNotif:p,sameTab:l,pageLocation:u,skipEvent:h,shouldLoadCreateAccountNotification:_,willRedirect:y}=e;this.clearCloseModalTimeout();let f=await this.showDismissConfirmationModal(),m=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled;if(l||this.setState({hideNotification:!f,resetNotification:!f,showDismissConfirmation:f},()=>{!f&&!y&&(!m&&this.state.didTryCodes||_)&&ni(d.default.get(this.props,"cashbackView.reward",null)),this.timeout=setTimeout(()=>{this.setState({resetNotification:!1})},1e3)}),f&&!this.state.dismissConfirmationDisplayed)return;this.state.running&&(k("track","couponRunCancelled"),v.set(["coupons","runCancelled"],!0)),this.state.rooRunning&&pi.cancel(),n||Jt(),m&&a&&Jt({fromAutoCoupImmediateNotif:a});let C=u==="couponDismissConfirmation",x=u==="shopifyButton";if(!h){if(this.state.running&&t==="x")return this.dismissOrActivateRewardsOnlyCouponNotificationEvent({ctaText:i,label:t,runAutomatically:m,eventName:"dismissCouponNotification",modalType:"runningModal",pageLocation:u,fromAutoCoupImmediateNotif:a});m&&p?this.dismissOrActivateRewardsOnlyCouponNotificationEvent({label:null,runAutomatically:m,eventName:"autoDismissCouponNotification",category:"auto",pageLocation:u,fromAutoCoupImmediateNotif:a}):(!this.state.didTryCodes||m&&(t==="x"||o||C||x))&&this.dismissOrActivateRewardsOnlyCouponNotificationEvent({ctaText:i,label:t,runAutomatically:m,eventName:"dismissCouponNotification",pageLocation:u,fromAutoCoupImmediateNotif:a})}}async determineShouldRespectSameTab(){if(!d.default.get(this.props,"view.affiliateLinkCurrentTab")&&!kt())return!1;let t=!0,e=d.default.get(this,"props.deweyResult.pageData.meta");return e&&d.default.has(e,"disable_aff_link_current_tab")&&(t=!1),t}determineCouponTryCount({disableAutomatic:t,autoFallback:e}={}){let i=this.props.affiliateRedirect,o=d.default.get(v.get("siteAPIData"),"siteData.coupons.type")==="roo",n=d.default.get(this,"props.view.autoCoupConfig.codeCount")||(o?1:2),a=d.default.get(i,"autofallback.autoFallbackCouponsCount")||d.default.get(this,"props.view.couponCount")-n,p=null;return(!t&&this.state.automaticCouponsEnabled||this.state.manuallyActivatedAutoRun)&&(p=n),Mt({autoFallbackCouponsCount:a})&&(this.state.autoFallback||e)&&(p=a,this.setFallbackCouponCursor({autoFallbackCouponsCount:a})),{autoCoupTryCount:n,autoFallbackCouponsCount:a,couponTryCount:p}}setAutomaticCouponCursor(){let{autoCoupTryCount:t}=this.determineCouponTryCount(),e=v.select("couponView"),i=Co(e.get("coupons"));e.set("automaticCoupons",d.default.take(i,t))}setFallbackCouponCursor({autoFallbackCouponsCount:t}){let e=v.select("couponView"),i=d.default.takeRight(e.get("coupons"),t);e.set("autoFallback",{coupons:i,autoFallbackCouponsCount:t})}couponsToTry(t={}){let e=v.select("couponView"),i=e.get("coupons"),{automaticCouponsRun:o,couponTryCount:n,autoFallbackCouponsCount:a}=t,p=o||this.state.manuallyActivatedAutoRun?d.default.take(e.get("coupons"),n):i;return a&&Mt({autoFallbackCouponsCount:a})&&this.state.autoFallback&&(p=d.default.takeRight(e.get("coupons"),a),this.setFallbackCouponCursor({autoFallbackCouponsCount:a,coupons:p})),o&&this.setAutomaticCouponCursor(),p}async onTryCodes({ignoreCancelled:t,disableAutomatic:e,disableCookieDrop:i,config:o={}}={}){let{fromAutoRun:n,manuallyActivatedFallback:a,manuallyActivatedSameTabReload:p}=o,{clickId:l,couponRunId:u,isFallbackRun:h}=o,_=v.get("couponNotif")==="siteHub",y=n&&!_,f=!!d.default.get(this.props,"cashbackView.reward.amount"),m=this.props.affiliateRedirect;m&&(y=d.default.get(m,"autoFallback.autoFallback",y)&&!_),this.setState({autoFallback:y}),u=u||sessionStorage.getItem("__wb_amz_coup_id")||d.default.get(m,"couponRunId")||ln.default.v4(),l=l||sessionStorage.getItem("__wb_clickId")||J();let C=c("shopify_async_tigger")&&v.get("platform")==="Shopify",x=d.default.get(v.get("siteAPIData"),"siteData.coupons.type"),w=x==="roo",S=x==="asyncTigger"||C;(_&&this.state.manuallyActivatedAutoRun||h||a)&&(v.select("couponView").set("manuallyActivatedAutoRun",!1),this.setState({manuallyActivatedAutoRun:!1}));let{couponTryCount:D,autoFallbackCouponsCount:A}=this.determineCouponTryCount({disableAutomatic:e,autoFallback:y}),F=d.default.get(this.props,"cashbackView.reward")?d.default.get(this.props,"cashbackView.reward"):!1,E=d.default.get(this.props.cashbackView,"postCoupons"),$=!1;if(F&&F.amount&&!E&&($=!0),await this.determineShouldRespectSameTab()&&(this.state.redirectInCurrentTab||kt())&&($||!this.props.view.disableAffiliate)&&!i)return Se($,{clickId:l,couponRunId:u,fromAutoRun:n,autoFallback:{autoFallback:y,autoFallbackCouponsCount:A}});this.setState({didTryCodes:!0,running:!0,rooRunning:!!this.props.view.roo,disableAutomatic:e===!0});let L;w?L=pi.tryCodes:S?L=os:L=Ne;let V=this.getRunAnimation();if(Bo()===!1){sessionStorage.setItem("__wb_amz_coup_id",u),document.querySelector("#nav-link-accountList .nav-line-1").click();return}let tt=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled,K=this.couponsToTry({automaticCouponsRun:tt,couponTryCount:D,autoFallbackCouponsCount:A});ue.default.all([L({ignoreCancelled:t,disableAffiliate:i||$||this.props.view.disableAffiliate,coupons:K,automaticCouponsRun:tt,autoFallback:y,manuallyActivatedFallback:a,manuallyActivatedSameTabReload:p,isSiteHub:_,passedInClickId:l,couponRunId:u,cashback:f}),$&&!i?jt({clickId:l,coupons:!0,fromAutoRun:n,isSiteHub:_}):ue.default.resolve(),w?ue.default.resolve().delay(V.duration):ue.default.resolve()]).then(([et,vt,St])=>{vt&&k("track","activateCashbackRedirect",{rewardAmount:F.amount,rewardDisplay:F.type}),sessionStorage.removeItem("__wb_clickId"),sessionStorage.removeItem("__wb_amz_coup_id");let Nt=d.default.get(et,"finishWithoutResult")||d.default.get(et,"pageReload")||d.default.get(et,"changePageLocation");setTimeout(()=>{v.unset("affiliateRedirectData"),this.setState({running:!1,barComplete:!0,rooRunning:!1},()=>{setTimeout(()=>this.setState({barComplete:!1,manuallyActivatedAutoRun:!1,currentCodeIndexTigger:0,autoFallback:!1}),300)})},Nt?2400:200)})}async activateCreditsAfterAutomatic({clickId:t,fromAutoRun:e,fromActivateRewards:i,savings:o,codeEntered:n,manuallyActivatedAutoRun:a,shouldLoadEmailCreateAccountNotification:p}={}){let l=await this.determineShouldRespectSameTab(),u=d.default.get(this.props.cashbackView,"postCoupons");this.setState({creditsActivated:!0}),(kt()||this.state.redirectInCurrentTab||i)&&l&&!a?await Se(!u,{clickId:t,fromAutoRun:e,fromActivateRewards:i,autoSavings:o,codeEntered:n,shouldLoadEmailCreateAccountNotification:p}):(await jt({clickId:t,coupons:!0,codeEntered:n,fromAutoRun:e,fromActivateRewards:i}),p&&ni())}async activateRewardsOnly({clickId:t,fromAutoRun:e,fromActivateRewards:i,ctaText:o,label:n,pageLocation:a,fromAutoCoupImmediateNotif:p}={}){let l=await this.determineShouldRespectSameTab(),u=n||Zo();this.setState({activatingCredits:!0});let h=d.default.get(this.props,"cashbackView.reward"),_=this.state.automaticCouponsEnabled&&!this.state.manuallyActivatedAutoRun||!this.state.disableAutomatic&&this.state.automaticCouponsEnabled;if(Jt(),this.dismissOrActivateRewardsOnlyCouponNotificationEvent({ctaText:o,label:u,runAutomatically:_,eventName:"dismissCouponNotification",pageLocation:a,activateRewardsOnly:!0,fromActivateRewards:i,fromAutoCoupImmediateNotif:p}),(this.state.redirectInCurrentTab||i||c("also_pin_202401_test"))&&l){let y=await _o();await ti(3e3),k("track","activateCashbackRedirect",d.default.assign({rewardAmount:h.amount,rewardDisplay:h.type},y)),this.onClosePopup(u,{skipEvent:!0,willRedirect:!0}),location.href=y.affiliateUrl;return}await jt({clickId:t,coupons:!0,fromAutoRun:e,fromActivateRewards:!0}),this.setState({activatingCredits:!1,creditsActivated:!0}),k("track","activateCashbackRedirect",{rewardAmount:h.amount,rewardDisplay:h.type}),this.onClosePopup(u,{skipEvent:!0,shouldLoadCreateAccountNotification:!0})}getRunAnimation(){let{roo:t,estimatedRunTime:e}=this.props.view,i;return t?i={duration:0,stagger:0}:e<=5e3?i={class:"fast",stagger:500,duration:5500}:e<=1e4?i={class:"medium",stagger:1e3,duration:10500}:e<=15e3?i={class:"slow",stagger:1500,duration:15500}:e<=2e4?i={class:"extra-slow",stagger:2e3,duration:20500}:i={class:"extra-extra-slow",stagger:2500,duration:25500},i}closeModalOnClickOutside(t){let e=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled,i=t.path||t.nativeEvent.composedPath&&t.nativeEvent.composedPath();!d.default.find(i,n=>n.className&&d.default.isString(n.className)&&n.className.includes("coupon-notification"))&&t.isTrusted&&!this.state.hideNotification&&(this.shouldShowFullPage()||e)&&!this.state.running&&this.state.result&&!e&&this.onClosePopup()}closeModalTimeout(t){this.coupModalAutoDismissId=setTimeout(()=>this.onClosePopup(),t)}clearCloseModalTimeout(){clearTimeout(this.coupModalAutoDismissId)}async sendCouponNotificationEvent({isSiteHub:t,notifyImmediate:e}={}){await new Promise(F=>setTimeout(F,300));let i=(0,cn.findDOMNode)(this),o="",n="",a="",p="";if(i){let F=i.querySelector("button"),E=i.querySelector("h2"),$=i.querySelector("h4");F&&F.textContent&&(n=F.textContent.toLowerCase()),E&&E.textContent&&(a=E.textContent.toLowerCase()),$&&$.textContent&&(p=$.textContent.toLowerCase())}o=`${a} ${p}`,a==="trying coupon codes"&&(o="");let l=await Mo(),u=v.get("affiliateRedirect"),h=d.default.get(u,"redirected"),_=d.default.get(this,"state.result"),y=d.default.get(_,"couponRunId"),f=vo({automaticCouponsRun:d.default.get(_,"automaticCouponsRun")||e,autoFallback:d.default.get(_,"autoFallback"),isSiteHub:d.default.get(_,"isSiteHub")||t,manuallyActivatedFallback:d.default.get(_,"manuallyActivatedFallback"),sameTabAffiliateRedirect:h}),m=this.state.result?"couponNotificationResult":"couponNotification",C,x=v.get("lifetimeSavings"),w=d.default.get(x,"lifetimeSavings.amount",0)*100;if(c("ext_coupon_savings_emphasis")&&w>=1e3?C="":m==="couponNotification"&&!h&&(C=Ae()),It()){let F=d.default.get(this.state,"result.savings");if(this.state.result&&F<=0&&!t||!this.state.result&&!t)return}let S=d.default.get(_,"savings");S>0&&!d.default.get(_,"bestCoupon")&&(S=0);let D=!!d.default.get(this.props,"cashbackView.reward.amount");d.default.get(this.props,"view.hasDeferredCouponRewards")&&(f==="auto"||f==="auto_fallback"&&S>0)&&(D=!1),k("page",m,{view:m,type:"notification",source:"coupons",cashback:D,cashbackAmount:D?d.default.get(this.props,"cashbackView.reward.amount"):void 0,cashbackType:D?d.default.get(this.props,"cashbackView.reward.type"):void 0,vendorMetaId:d.default.get(this.props,"cashbackView.id"),savings:S,triggerType:f,copyTestVariant:C,couponRunId:y,engine:v.get(["siteAPIData","siteData","coupons","type"]),hasCredits:ai(l),ctaText:n,notificationText:o,deweyResult:d.default.get(this.props.deweyResult,"pageType")})}componentWillUnmount(){this.timeout&&clearTimeout(this.timeout),v.get("couponNotif")&&v.unset("couponNotif"),window.removeEventListener("click",this.boundCloseModal)}},ya=ge({affiliateRedirect:["affiliateRedirect"],view:["couponView"],deweyResult:["deweyResult"],cashbackView:["cashbackView"],exclusions:["siteAPIData","siteData","merchantPage","exclusions"],tld:["siteAPIData","meta","domain"],vendorName:["siteAPIData","meta","name"],giftCardView:["giftCardView"],session:["session"],settings:["settings"],googleData:["googleData"],events:["events"],shouldHidePrompt:["shouldHidePrompt"],shouldShowSPAPrompt:["shouldShowSPAPrompt"],warnAboutStandDown:["warnAboutStandDown"]},no);export{Ba as a,Ss as b,pt as c,Si as d,zi as e,ya as f};
