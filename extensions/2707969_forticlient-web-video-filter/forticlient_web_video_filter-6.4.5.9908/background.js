!function(e){var t={};function n(i){if(t[i])return t[i].t;var r=t[i]={i:i,o:!1,t:{}};return e[i].call(r.t,r,r.t,n),r.o=!0,r.t}n.s=e,n.c=t,n.d=function(e,t,i){n.l(e,t)||Object.defineProperty(e,t,{u:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"h",{value:!0})},n.m=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.h)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{u:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.h?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.l=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.g="",n(n.p=0)}([function(e,t,n){"use strict";n.r(t);var i={v:{NONE:-1,_:0,S:1,I:2,ERROR:3,k:4,T:5,R:6,D:7},O:5,A:function(){},C:function(){},U:function(e){e>=this.v.NONE&&e<=this.v.D&&(this.O=e)},L:function(e){this.O>=this.v.D&&this.B(e)},M:function(e){this.O>=this.v.R&&this.B(e)},N:function(e){this.O>=this.v.T&&this.B(e)},P:function(e){this.O>=this.v.ERROR&&this.B(e)},B:function(e){var t;t=this.$()+", "+e,console.log(t)},$:function(){var e,t,n,i,r,o=new Date;return e=o.getMonth()+1<10?"0"+String(o.getMonth()+1):String(o.getMonth()+1),t=o.getDate()<10?"0"+String(o.getDate()):String(o.getDate()),n="",o.getHours()<10&&(n="0"),n+=String(o.getHours()),i="",o.getMinutes()<10&&(i="0"),i+=String(o.getMinutes()),r="",o.getSeconds()<10&&(r="0"),r+=String(o.getSeconds()),o.getFullYear()+"-"+e+"-"+t+" "+(n+":"+i+":"+r)}},r={async_mode:!1,q:!1,safesearch:!1,W:!1,G:null,restrictionLevel:"0",videoFilterConfig:{enabled:!1,siteSettings:{youtube:{hideComment:!1,safeSearch:!1,restrictionLevel:"1"}}},F:function(){this.safesearch=!1,this.videoFilterConfig.siteSettings.youtube.safeSearch=!1,this.videoFilterConfig.siteSettings.youtube.hideComment=!1}};function o(e,t,n,i){this.url=e,this.tabId=t,this.H=i,this.j=n}var a={J:"7",V:{0:{name:"Unrated",group:0},1:{name:"Drug Abuse",group:1},2:{name:"Alternative Beliefs",group:2},3:{name:"Hacking",group:1},4:{name:"Illegal or Unethical",group:1},5:{name:"Discrimination",group:1},6:{name:"Explicit Violence",group:1},7:{name:"Abortion",group:2},8:{name:"Other Adult Materials",group:2},9:{name:"Advocacy Organizations",group:2},11:{name:"Gambling",group:2},12:{name:"Extremist Groups",group:1},13:{name:"Nudity and Risque",group:2},14:{name:"Pornography",group:2},15:{name:"Dating",group:2},16:{name:"Weapons (Sales)",group:2},17:{name:"Advertising",group:6},18:{name:"Brokerage and Trading",group:6},19:{name:"Freeware and Software Downloads",group:4},20:{name:"Games",group:6},23:{name:"Web-based Email",group:6},24:{name:"File Sharing and Storage",group:4},25:{name:"Streaming Media and Download",group:4},26:{name:"Malicious Websites",group:5},28:{name:"Entertainment",group:6},29:{name:"Arts and Culture",group:6},30:{name:"Education",group:6},31:{name:"Finance and Banking",group:7},33:{name:"Health and Wellness",group:6},34:{name:"Job Search",group:6},35:{name:"Medicine",group:6},36:{name:"News and Media",group:6},37:{name:"Social Networking",group:6},38:{name:"Political Organizations",group:6},39:{name:"Reference",group:6},40:{name:"Global Religion",group:6},41:{name:"Search Engines and Portals",group:7},42:{name:"Shopping",group:6},43:{name:"General Organizations",group:7},44:{name:"Society and Lifestyles",group:6},46:{name:"Sports",group:6},47:{name:"Travel",group:6},48:{name:"Personal Vehicles",group:6},49:{name:"Business",group:7},50:{name:"Information and Computer Security",group:7},51:{name:"Government and Legal Organizations",group:7},52:{name:"Information Technology",group:7},53:{name:"Armed Forces",group:7},54:{name:"Dynamic Content",group:6},55:{name:"Meaningless Content",group:6},56:{name:"Web Hosting",group:7},57:{name:"Marijuana",group:2},58:{name:"Folklore",group:6},59:{name:"Proxy Avoidance",group:1},61:{name:"Phishing",group:5},62:{name:"Plagiarism",group:1},63:{name:"Sex Education",group:2},64:{name:"Alcohol",group:2},65:{name:"Tobacco",group:2},66:{name:"Lingerie and Swimsuit",group:2},67:{name:"Sports Hunting and War Games",group:2},68:{name:"Web Chat",group:6},69:{name:"Instant Messaging",group:6},70:{name:"Newsgroups and Message Boards",group:6},71:{name:"Digital Postcards",group:6},72:{name:"Peer-to-peer File Sharing",group:4},75:{name:"Internet Radio and TV",group:4},76:{name:"Internet Telephony",group:4},77:{name:"Child Education",group:6},78:{name:"Real Estate",group:6},79:{name:"Restaurant and Dining",group:6},80:{name:"Personal Websites and Blogs",group:6},81:{name:"Secure Websites",group:7},82:{name:"Content Servers",group:6},83:{name:"Child Abuse",group:1},84:{name:"Web-based Applications",group:7},85:{name:"Domain Parking",group:6},86:{name:"Spam URLs",group:5},87:{name:"Personal Privacy",group:6},88:{name:"Dynamic DNS",group:5},89:{name:"Auction",group:6},90:{name:"Newly Observed Domain",group:5},"91:":{name:"Newly Registered Domain",group:5},92:{name:"Charitable Organizations",group:7},93:{name:"Remote Access",group:7},94:{name:"Web Analytics",group:7},95:{name:"Online Meeting",group:7}},Y:{0:"Unrated",1:"Potentially Liable",2:"Adult/Mature Content",4:"Bandwidth Consuming",5:"Security Risk",6:"General Interest - Personal",7:"General Interest - Business"},X:[],K:!1,Z:null,ee:null,te:6048e5,web_access_statistics:{},ne:!1,ie:null,re:0,oe:function(){i.L("url_rate_init is called"),this.web_access_statistics={};try{var e=localStorage.web_access_statistics;null!=e&&(i.B("cached web access statistics:"+e),this.web_access_statistics=JSON.parse(e))}catch(e){i.B("failed to get cached web access statistics data")}},A:function(){var e;e=this,this.Z=setInterval(function(){e.ae()},3e4),this.ee=setInterval(function(){e.se()},3e5)},C:function(){if(null!=this.Z&&clearInterval(this.Z),null!=this.ee&&clearInterval(this.ee),r.async_mode)for(;this.X.length;)this.X.pop()},ce:function(e){if(r.async_mode,0==e)for(r.async_mode=!1,this.K=!1;this.X.length;)this.X.pop();else r.async_mode=!0},ae:function(){try{localStorage.web_access_statistics=JSON.stringify(this.web_access_statistics)}catch(e){i.P("failed to save cached web access statistics data, error:"+e.message)}},le:function(e,t,n,a){var s,c=this;if(0,"main_frame"==n&&1,(b={}).action=1,r.async_mode){var l=new o(e,t,n,a);this.X.push(l),this.K||(setTimeout(function(){c.ue()},10),this.K=!0)}else{var h,m,g,d,p,f=new XMLHttpRequest;u.he>=u.me.length&&(u.he=0),s=u.me[u.he],u.he++;var b,v,_=`http://localhost:${s}/rate?url=${e}`;try{f.overrideMimeType("text/plain"),f.open("GET",_,!1),f.send()}catch(e){console.log("Error happened while rating web site, error:"+e.message)}if(u.ge(),"4"==f.readyState&&200==f.status)if(console.log("response from rating server:"+f.response),h=(b=JSON.parse(f.response)).category,3==(m=b.action)&&"main_frame"!=n&&(m=2),p=b.customized_page?b.customized_page:"",u.de(b.enabled),4==m&&u.pe(t,e),1!=m&&u.fe(t,n,e,m,h,p),2==m||3==m)return 2==m?"main_frame"==n?(g=u.be[t].customized_page.length>0?chrome.extension.getURL("../customize.html"):chrome.extension.getURL("../block.html"),g+="?tabid=",g+=t,chrome.tabs.update(t,{url:g},function(e){chrome.runtime.lastError?i.L("UrlRating()  exception happened while calling chrome.tabs.update()"):u.ve(t)}),{cancel:!0}):{cancel:!0}:u._e(h)?{cancel:!1}:(v="  UrlRating()",v+="show warning page under sync mode, action:"+m,v+=", url:"+e,i.L(v),d=u.be[t].customized_page.length>0?chrome.extension.getURL("../customize.html"):chrome.extension.getURL("../warning.html"),d+="?tabid=",d+=t,chrome.tabs.update(t,{url:d},function(e){chrome.runtime.lastError?i.L("UrlRating()  exception happened while calling chrome.tabs.update()"):u.ve(t)}),{cancel:!0})}return{cancel:!1}},we:function(e){for(var t=[];this.X.length;){var n=this.X.pop();n.tabId!=e&&t.push(n)}this.X=t},ye:function(e,t){var n="unknown";return this.V[String(t)]&&(n=this.V[String(t)].name),"data:text/html,<div>According to the policy, web site "+e+" is blocked, rating result:"+n+"</div>"},Se:function(e){var t,n="";return-1==e||-2==e?n=-1==e?"unknown":"black list":null!=this.V[String(e)]&&(t=this.V[String(e)].group,n=this.Y[String(t)],n+=":",n+=this.V[String(e)].name),n},Ie:function(e,t,n,r){i.L("block this url:"+e.url),this.ye(e.url,t),4==n&&u.pe(e.tabId,e.url),1!=n&&u.fe(e.tabId,e.j,decodeURIComponent(e.url),n,t,r),e.j},ue:function(){var e,t=this;if(this.re>=1)setTimeout(function(){t.ue()},10);else if(void 0!==(e=this.X.pop())){this.re++;var n=`http://localhost:${u.ke}/rate?url=${e.url}`,r=new XMLHttpRequest;r.overrideMimeType("text/plain"),r.tabId=e.tabId,r.url=e.url,r.H=e.H,r.j=e.j,r.open("GET",n,!0),r.onreadystatechange=function(){if("4"==r.readyState){if("200"==r.status){var e,n,o;i.L("******** rating result:"+r.responseText+" tabId:"+r.tabId+" url:"+r.url+"  ********");var a=JSON.parse(r.response);n=a.category,3==(e=a.action)&&"main_frame"!=r.j&&(e=2),o=a.customized_page?a.customized_page:"",t.Ie(r,n,e,o),r=void 0}else i.P("Error happened while rating web site, error:"+r.status),t.Ie(r,0,1,""),r=void 0,0==t.X.length?t.K=!1:setTimeout(function(){t.ue()},10);t.re>0&&t.re--}0==t.X.length?t.K=!1:setTimeout(function(){t.ue()},10)},r.onerror=function(){i.L("Error happened while rating web site under async mode"),t.re>0&&t.re--,r=void 0,0==t.X.length?t.K=!1:setTimeout(function(){t.ue()},10)},r.send(),u.ge()}else 0==this.X.length?this.K=!1:setTimeout(function(){t.ue()},10)},Te:function(e){var t;return t=!0,-1==/(\w+):\/\/([\w.\-]+)(:\d*)?(\/.*)/i.exec(e)[2].indexOf("google")&&(t=!1),t},se:function(){var e,t,n,o,a;if(this.ne){t=this;var s,c,l=[];a=(c=Object.keys(this.web_access_statistics)).length;for(var h=0;h<a;h++)(s={}).category=Number(c[h]),s.count=this.web_access_statistics[c[h]],l.push(s);e=JSON.stringify(l),n=new XMLHttpRequest,o=r.Re?r.Ee+"/userid-stat":r.Ee+"/token-stat",n.open("POST",o,!0),n.setRequestHeader("Content-type","application/json"),r.Re?n.setRequestHeader("UserID",u.De):n.setRequestHeader("Token",u.De),n.timeout=1e4,n.ontimeout=function(){i.L("send web access stats timed out."),n=void 0},n.onreadystatechange=function(){"4"==n.readyState&&("200"==n.status?(i.L("web access stats are sent successfully"),t.web_access_statistics={},localStorage.removeItem("web_access_statistics"),t.ne=!1):i.P("Error happened when sending web access statistics data to EMS")),n=void 0},n.send(e)}}},s={Oe:5,Ae:{"-1":"Unknown",0:"Not Rated",1:"Business",2:"Entertainment",3:"Games",4:"Knowledge",5:"Lifestyle",6:"Music",7:"News",8:"People",9:"Society",10:"Sports"},type:{1:"Regular",2:"Made for Kids",3:"Age Restricted"},Ce:{Ue:1,Le:2,Be:3,Me:4},Ne:{},Pe:function(e,t){u.he>=u.me.length&&(u.he=0);var n=u.me[u.he];u.he+=1;var i=`http://localhost:${n}/rate?video=youtube&channelurl=${e}`;t&&(i+=`&videourl=${t}`);var r=new XMLHttpRequest;try{r.overrideMimeType("text/plain"),r.open("GET",i,!1),r.send()}catch(e){console.log("Error happened while rating video, error:"+e.message)}return"4"==r.readyState&&200==r.status?JSON.parse(r.response):{action:1,category:0}},xe:function(e,t,n,o){if(i.M(`Video Rating - Youtube - ChannelUrl ${e} VideoUrl${t} tabId ${n}`),r.videoFilterConfig.enabled){var a=r.videoFilterConfig.siteSettings.youtube.hideComment,s=this.Pe(e,t),c=parseInt(s.action);if(c===this.Ce.Le){o({$e:!0,hideComment:a});var l=this.Ae[s.category],h="";if(s.customized_page){if(-1!==(f=(h=(h=s.customized_page).replace(/<div class="category">[^<]*<\/div>/,`<div class="category">${l}</div>`)).indexOf('<div class="reeval">'))){var m=h.indexOf("</a></div></div>"),g=h.slice(0,f),d=h.slice(m+16);h=g+d}-1==s.category&&h.replace("inaccessible.","inaccessible or video has not yet been rated.")}this.Ne[n]={channelUrl:e,videoUrl:t,category:l,customizePage:h},p=""===h?chrome.runtime.getURL("video.html"):chrome.extension.getURL("../videoCustomize.html"),"Firefox"===u.qe?browser.tabs.goBack(n).then(function(){browser.tabs.update(n,{url:p}).then(function(){browser.runtime.lastError?i.We(`WebFilterProcess - scanTabsAndBlock - FAILED - Cannot update tab ${n}: ${chrome.runtime.lastError.message}`):u.ve(n)})}):chrome.tabs.goBack(n,function(){chrome.tabs.update(n,{url:p},function(){chrome.runtime.lastError?i.We(`WebFilterProcess - scanTabsAndBlock - FAILED - Cannot update tab ${n}: ${chrome.runtime.lastError.message}`):u.ve(n)})})}else if(c===this.Ce.Be){var p;o({$e:!0,hideComment:a});l=this.Ae[s.category],h="";if(s.customized_page){var f;if(-1!==(f=(h=(h=(h=s.customized_page).replace(/<div class="category">[^<]*<\/div>/,`<div class="category">${l}</div>`)).replace(/blocking access to .* until/,`blocking access to "${l}" until`)).indexOf('<div class="reeval">'))){m=h.indexOf("</a></div></div>"),g=h.slice(0,f),d=h.slice(m+16);h=g+d}-1==s.category&&h.replace("inaccessible.","inaccessible or video has not yet been rated.")}this.Ne[n]={channelUrl:e,videoUrl:t,category:l,customizePage:h},p=""===h?chrome.runtime.getURL("video.html"):chrome.extension.getURL("../videoCustomize.html"),console.log(u.qe),"Firefox"===u.qe?browser.tabs.goBack(n).then(function(){browser.tabs.update(n,{url:p}).then(function(){browser.runtime.lastError?i.We(`WebFilterProcess - scanTabsAndBlock - FAILED - Cannot update tab ${n}: ${chrome.runtime.lastError.message}`):u.ve(n)})}):chrome.tabs.goBack(n,function(){chrome.tabs.update(n,{url:p},function(){chrome.runtime.lastError?i.We(`WebFilterProcess - scanTabsAndBlock - FAILED - Cannot update tab ${n}: ${chrome.runtime.lastError.message}`):u.ve(n)})})}else o({$e:!1,hideComment:a})}else o({$e:!1,hideComment:!1})}};function c(){this.action=1,this.rating="0",this.url="",this.bar_url="",this.block_page=!1,this.time="",this.customized_page=""}function l(e){this.url=e,this.Ge=new Date,this.Fe=!1,this.category="N/A"}n.d(t,"WebFilterProcess",function(){return u});var u={qe:null,ze:null,He:null,je:!1,Je:!1,Ve:!1,Ye:0,test:!1,Xe:null,Ke:null,Qe:null,tabId:null,Ze:null,et:["chrome-extension://","chrome://","chrome-devtools://devtools","https://accounts.google","https://accounts.gstatic.com","https://accounts.youtube.com","https://clients1.google.com","https://clients2.google.com","https://clients3.google.com","https://clients4.google.com","https://clients5.google.com","https://clients6.google.com","https://commondatastorage.googleapis.com","https://cros-omahaproxy.appspot.com","https://dl.google.com","https://dl-ssl.google.com","https://gweb-gettingstartedguide.appspot.com","https://m.google.com","https://omahaproxy.appspot.com","https://pack.google.com","https://safebrowsing-cache.google.com","https://safebrowsing.google.com","https://ssl.gstatic.com","https://storage.googleapis.com","https://tools.google.com","https://www.googleapis.com","https://fonts.gstatic.com","https://fonts.googleapis.com","https://security.google.com"],tt:[/https?:\/\/.*?\.googleusercontent.com\/.*/,/https?:\/\/.*?\.gstatic\.com\/?.*/,/https?:\/\/clients(\d)?\.google\.com\/?.*/],nt:[/^https?:\/\/www\.youtube\.com/,/^https?:\/\/m\.youtube\.com/,/^https?:\/\/youtubei\.googleapis\.com/,/^https?:\/\/youtube\.googleapis\.com/,/^https?:\/\/www\.youtube-nocookie\.com/],it:{NONE:0,rt:1,ot:2},at:0,st:0,ct:null,lt:0,be:[],ut:null,ht:{},gt:!1,dt:null,pt:!1,ft:null,bt:null,vt:0,_t:18e4,wt:18e4,yt:17713,St:10,ke:0,me:[],It:0,he:0,kt:!1,Tt:1e4,Rt:0,Et:!0,Dt:!1,Ot:0,At:1e3,Ct:4e3,Ut:3e4,Lt:0,Bt:0,Mt:["HBO"],Ne:{},Nt:{},Pt:{rt:"1",ot:"0"},xt:function(){var e=this.Bt;return this.Bt++,e},$t:function(e,t){this.Nt[String(t)]=e},_e:function(e){var t=!1,n=new Date;return null!=this.Nt[String(e)]&&n<this.Nt[String(e)]&&(t=!0),t},onBeforeSendHeaders:function(e){var t=r.safesearch,n=r.videoFilterConfig.siteSettings.youtube.safeSearch;if(!t&&!n)return{};if(this.nt.some(function(t){return t.test(e.url)})){var o=e.requestHeaders;if(o){var a=o.filter(function(e){return"youtube-restrict"!==e.name.toLowerCase()}),s=u.Pt.ot,c=u.Pt.ot;t&&(s=r.restrictionLevel),n&&(c=r.videoFilterConfig.siteSettings.youtube.restrictionLevel);var l=s;switch(c>s&&(l=c),l){case this.Pt.ot:a.push({name:"YouTube-Restrict",value:"Moderate"});break;case this.Pt.rt:a.push({name:"YouTube-Restrict",value:"Strict"});break;default:i.P(`Unexpected RESTRICTION_LEVEL: ${r.restrictionLevel}.`)}return{requestHeaders:a}}}return{}},qt:function(e){e?(r.safesearch=!0,this.at=u.it.rt):(r.safesearch=!1,this.at=u.it.NONE)},Wt:function(e,t){var n,o=!1;return n=r.restrictionLevel===this.Pt.rt?"strict":"moderate",-1==e.indexOf("www.bing.com/search?")&&-1==e.indexOf("www.bing.com/images/search?")&&-1==e.indexOf("www.bing.com/videos/search?")||-1!=e.indexOf("adlt=")?-1!=e.indexOf("search.yahoo")&&-1!=e.indexOf("/search")&&-1==e.indexOf("vm=r")?(i.L("it is yahoo search"),t.redirectUrl=e+"&vm=r",o=!0):-1==e.indexOf("www.google")||-1!=e.indexOf("safe=active")||-1==e.indexOf("&q=")&&-1==e.indexOf("#q=")&&-1==e.indexOf("?q=")||(i.L("it is google search"),t.redirectUrl=e+"&safe=active",o=!0):(i.L("it is bing search"),t.redirectUrl=`${e}&adlt=${n}`,o=!0),o},OnBeforeWebRequest:function(e){var t,n,o,s,l;for(n="OnBeforeWebRequest  ",n+="Web request URL:"+e.url,n+=",tabId:"+e.tabId,n+=",type:"+e.type,i.L(n),t=this.et.length,o=0;o<t;o++)if(e.url.startsWith(this.et[o]))return{cancel:!1};if(""==e.url)return{cancel:!1};if(e.url.startsWith("file://"))return{cancel:!1};if(s=e.url,-1!=(l=e.url.indexOf("//"))&&(5!=l&&6!=l||-1!=(l=e.url.indexOf("/",l+2))&&(s=e.url.substring(0,l))),this.Et&&this.Dt&&-1!=e.tabId){var u=h(e.url);if("main_frame"==e.type&&(null==this.be[e.tabId]&&(this.be[e.tabId]=new c),this.be[e.tabId].url=u,this.be[e.tabId].bar_url=e.url),i.L("OnBeforeWebRequest()  BaseUrl:"+u),r.safesearch){var m={redirectUrl:""};if(this.Wt(e.url,m))return m}for(t=this.tt.length,o=0;o<t;o++)if(this.tt[o].test(s))return{cancel:!1};return r.q?"main_frame"==e.type?a.le(encodeURIComponent(e.url),e.tabId,e.type,this.De):{cancel:!1}:a.le(encodeURIComponent(e.url),e.tabId,e.type,this.De)}return{cancel:!1}},ve:function(e){null!=this.be[e]&&(this.be[e].block_page=!0)},Gt:function(e,t){var n=e.substr(e.indexOf("&")+1),i="";params=n.split("&");for(var r=0;r<params.length;r++)querystrpair=params[r].split("="),[querystrpair[0]]==t&&(i=querystrpair[1]);return i},Ft:function(e){void 0!==e&&void 0!==e.id?this.tabId=e.id:this.je=!1},pe:function(e,t){var n;null!=this.ht[e]&&this.ht[e].url==t&&(this.ht[e].Fe=!0,n="SetMonitorThisPage()  monitor_this_page is set",n+=",tabId:"+e,n+=",url:"+t,i.L(n))},zt:function(e,t){var n;this.ht[e]&&this.ht[e].url==t&&(this.ht[e].Fe=!1,n="ResetMonitorThisPage()  monitor_this_page is set",n+=",tabId:"+e,n+=",url:"+t,i.L(n))},Ht:function(e){var t,n;if(this.gt){if(this.dt=new Date,this.ft!=this.ut||this.bt!=e){for(var i in t=!1,this.ht)if(this.ht[i].url==e){t=!0,n=i;break}t&&n!=this.ut&&(this.ut=n,this.ht[n].Ge=new Date,this.ft=n,this.bt=e)}}else{for(var i in t=!1,this.ht)if(this.ht[i].url==e){t=!0,n=i;break}t&&(this.ut=n,this.ht[n].Ge=new Date,this.ft=n,this.bt=e,this.gt=!0,this.dt=new Date)}},jt:function(){var e=this;chrome.tabs.query({},function(t){for(var n=0;n<t.length;n++)if(null!=t[n]){var r=h(t[n].url),o=t[n].id;if(r.length>0&&void 0!==e.be[o]){var a,s;if(2==e.be[o].action)e.be[o].action=0,i.L("BlockTabTimer()  block web page in timer thread"),a=e.be[o].customized_page.length>0?chrome.extension.getURL("../customize.html"):chrome.extension.getURL("../block.html"),a+="?tabid=",a+=o,chrome.tabs.update(o,{url:a}),e.ve(o);if(3==e.be[o].action)e.be[o].action=0,s=e.be[o].customized_page.length>0?chrome.extension.getURL("../customize.html"):chrome.extension.getURL("../warning.html"),s+="?tabid=",s+=o,chrome.tabs.update(o,{url:s}),e.ve(o)}}})},Jt:function(e,t){this.ht[e]&&(this.ht[e].category=t)},Vt:function(e,t){var n;null==this.ht[e]?(n="AddUrlBrowseTimeItem()  url_browse_time_item",n+=" tabId: "+e,n+=" url: "+t,n+=" has been added into table",i.L(n),this.ht[e]=new l(t)):this.ht[e].url!=t&&(n="AddUrlBrowseTimeItem()  url_browse_time_item",n+=" tabId: "+e,n+=" url: "+t,n+=" has been updated",i.L(n),this.ht[e].url=t,this.ht[e].Ge=new Date)},Yt:function(e){var t;null!=this.ht[e]&&(t="DeleteUrlBrowseTimeItem()  item ",t+=" tabId: "+e,t+=" url: "+this.ht[e].url,t+=" has been removed",i.L(t),delete this.ht[e])},Xt:function(e){null!=this.ht[e]&&this.Yt(e)},Kt:function(e){if(null!=this.ut){this.ut;if(this.ut==e)return}this.ut=e,null!=this.ht[e]&&(this.ht[e].Ge=new Date)},Qt:function(e,t){this.ht[t]!=undefine&&this.Yt(t),this.ut=e},Zt:function(e,t,n){if(t.startsWith("chrome://newtab/")||t.startsWith("data:text/html"))null!=this.ht[e]&&this.Yt(e);else{var i,r,o=!1;if(null==this.ht[e]||this.ht[e].url!=t){for(i=this.et.length,r=0;r<i;r++)if(t.startsWith(this.et[r])){o=!0;break}if(!o)for(i=this.tt.length,r=0;r<i;r++){this.tt[r].test(t)&&(o=!0);break}o||null!=this.ht[e]&&(this.ht[e].url=t,this.ht[e].Ge=new Date)}}},fe:function(e,t,n,o,a,s){var c,l;if(void 0!==this.be[e]&&(!this._e(a)||3!=o)){if(c=this.be[e].action,l=!1,r.async_mode){if(r.q)this.be[e].bar_url==n&&(l=!0);else if(2!=c&&3!=c&&"main_frame"==t)l=!0;else if("main_frame"!=t&&2==o){var u=chrome.extension.getURL("../logo128.png");chrome.tabs.sendMessage(e,{block_url:n,action_url:u},function(e){chrome.runtime.lastError&&i.L(chrome.runtime.lastError.message)})}}else(3!=c||3==c&&2==o)&&(l=!0);if((2==o||3==o)&&l){var h=new Date;h=new Date(h.getTime()+this.wt),i.L("TabsStatusUpdate()--tabid:"+e+",action before set:"+this.be[e].action+",action set:"+o+",rating before set:"+this.be[e].rating+",rating set:"+a+",url before set:"+this.be[e].url+",urrl set:"+n),this.be[e].action=o,this.be[e].url=n,this.be[e].time=h,this.be[e].rating=a,this.be[e].customized_page=s}}},en:function(e,t,n,i,o,a){(null!=this.ht[e]&&this.ht[e].url==t||r.W)&&(null==this.ht[e]||this.ht[e].url!=t||this.ht[e].Fe||this.pt||this.Yt(e))},tn:function(){this.gt&&(new Date-this.dt>=this._t&&(this.gt=!1))},nn:function(e){var t;t=this,0==e?(r.async_mode=!1,0!=this.lt&&(clearInterval(this.lt),this.lt=0)):(r.async_mode=!0,0==this.lt&&(this.lt=setInterval(function(){t.jt()},500)))},in:function(){var e,t=this,n=new Date;if(0!==this.Lt&&n-this.Lt>=this.Ut&&r.F(),!(n-this.It<=this.At)){this.kt=!0,e=this.yt+this.St-1;var o=new XMLHttpRequest,a=`http://localhost:${this.ke}/rate?keepalive=1&browsername=chrome`;o.overrideMimeType("text/plain"),o.timeout=this.Ct,o.onreadystatechange=function(){if("4"==o.readyState&&"200"==o.status){t.Lt=new Date,t.Et=!0;var e=JSON.parse(o.response);t.rn(e),t.kt=!1}},o.ontimeout=function(){t.Et=!1,i.L("SendKeepAlive timeout:"+new Date),t.Ot++,t.Ot<t.St&&(t.ke++,t.ke>e&&(t.ke=t.yt),t.kt=!1)},o.onerror=o.ontimeout;try{o.open("GET",a),o.send()}catch(e){i.L("Error happened while sending keepalive message, error:"+e.message),this.Et=!1,this.kt=!1}}},rn:function(e){var t=this.Pt.ot,n=Boolean(parseInt(e.enabled)||!1),i=Boolean(parseInt(e.safesearch)||!1),o=e.strict||t,s=parseInt(e.async_mode)||0,c=Boolean(parseInt(e.addressbar_only)||!1),l=e.ports;this.Dt=n,Boolean(parseInt(i))?(this.qt(!0),r.restrictionLevel=o||t):this.qt(!1),a.ce(s),this.nn(s),r.q=c,this.me=l,this.St=l.length,e.video&&(r.videoFilterConfig.enabled=Boolean(parseInt(e.video.enabled)||!1),r.videoFilterConfig.siteSettings.youtube.hideComment=Boolean(parseInt(e.video.hide_comments)||!1),r.videoFilterConfig.siteSettings.youtube.safeSearch=Boolean(parseInt(e.video.safe_search)||!1),r.videoFilterConfig.siteSettings.youtube.restrictionLevel=1===parseInt(e.video.restriction_level)?this.Pt.ot:this.Pt.rt),this.Et=!0},de:function(e){this.Dt=Boolean(parseInt(e))},ge:function(){this.It=new Date}};function h(e){return e.startsWith("chrome://")?"":e.replace("http://","").replace("https://","").split(/[/?#]/)[0]}document.addEventListener("DOMContentLoaded",function(e){i.L("**** DOM fully loaded and parsed ****"),function e(){var t,n=new Date;i.L("Ext_Initializer Enter at "+n);try{i.L("LogManager:"+i),i.L("UrlRate:"+a)}catch(t){if(i.L("exception happened"),t instanceof ReferenceError)return void setTimeout(function(){e()},2e3)}try{browser.runtime.getBrowserInfo(function(e){u.qe=e.name})}catch(e){u.qe="Chrome"}u.ke=u.yt,u.Rt=new Date,u.vt=setInterval(function(){u.Ot=0,u.in()},u.At),chrome.webRequest.onBeforeRequest.addListener(function(e){return u.OnBeforeWebRequest(e)},{urls:["<all_urls>"]},["blocking"]),chrome.webRequest.onBeforeSendHeaders.addListener(function(e){return u.onBeforeSendHeaders(e)},{urls:["<all_urls>"]},["blocking","requestHeaders"]),chrome.downloads.onCreated.addListener(function(e){if(u.Dt&&e.startTime){var t=new Date(e.startTime);if(!(Date.now()-t>5e3)){var n=e.id,r=e.url.trim();if((!r||r.startsWith("about")||r.startsWith("chrome"))&&(r=e.finalUrl.trim()),r&&!r.startsWith("about")&&!r.startsWith("chrome")){try{new URL(r)}catch(e){return void i.P(r+"is not a valid url")}if((!r||r.startsWith("about")||r.startsWith("chrome://"))&&(r=e.finalUrl),r&&!r.startsWith("about")&&!r.startsWith("chrome://")){try{new URL(r)}catch(e){return void i.P("not a valid url")}var o,a,s,l,h;chrome.downloads.pause(n);var m,g=new XMLHttpRequest;u.he>=u.me.length&&(u.he=0),m=u.me[u.he],u.he++;var d=`http://localhost:${m}/rate?url=${r}`;try{g.overrideMimeType("text/plain"),g.open("GET",d,!1),g.send()}catch(e){i.P("Error happened while rating web site, error:"+e.message)}if(u.ge(),"4"==g.readyState&&200==g.status){var p;i.P("response from rating server:"+g.response),p=JSON.parse(g.response),o=p.category;var f={$e:2,warn:3};(a=p.action)==f.$e||a==f.warn?chrome.tabs.create({},function(t){var m,g=t.id;h=p.customized_page?p.customized_page:"",u.de(p.enabled),null==u.be[g]&&(u.be[g]=new c),u.be[g].url=r,u.be[g].bar_url=r,u.fe(g,"main_frame",r,a,o,h),2==a?(s=u.be[g].customized_page.length>0?chrome.extension.getURL("../customize.html"):chrome.extension.getURL("../block.html"),s+="?tabid=",s+=g,chrome.tabs.update(g,{url:s},function(e){chrome.runtime.lastError?i.L("UrlRating()  exception happened while calling chrome.tabs.update()"):u.ve(g)}),chrome.downloads.cancel(n),"complete"===e.state&&chrome.downloads.removeFile(n)):u._e(o)?chrome.downloads.resume(n):(m="  UrlRating()",m+="show warning page under sync mode, action:"+a,m+=", url:"+r,i.L(m),l=u.be[g].customized_page.length>0?chrome.extension.getURL("../customize.html"):chrome.extension.getURL("../warning.html"),l+="?tabid=",l+=g,chrome.tabs.update(g,{url:l},function(e){chrome.runtime.lastError?i.L("UrlRating()  exception happened while calling chrome.tabs.update()"):u.ve(g)}),chrome.downloads.cancel(n),"complete"===e.state&&chrome.downloads.removeFile(n))}):chrome.downloads.resume(n)}}}}}}),chrome.tabs.onUpdated.addListener(function(e,t,n){var r;r="chrome.tabs.onUpdated is called,",r+=" tabId:"+e,r+=" status:"+t.status,r+=" url:"+n.url,i.L(r),u.Zt(e,n.url,t.status),u.Je=!0}),chrome.tabs.onRemoved.addListener(function(e,t){var n;n="chrome.tabs.onRemoved is called,",n+=" tabId:"+e,i.L(n),u.Xt(e)}),chrome.tabs.onCreated.addListener(function(e){new Date,u.Je=!0}),chrome.tabs.onActivated.addListener(function(e){var t;t="chrome.tabs.onActivated is called,",t+=" tabId:"+e.tabId,i.L(t),u.Kt(e.tabId),u.Je=!0}),chrome.tabs.onReplaced.addListener(function(e,t){var n;n="chrome.tabs.onReplaced is called,",n+=" addedTabId:"+e,n+=" removedTabId:"+t,i.L(n),u.Je=!0}),chrome.tabs.onHighlighted.addListener(function(e){var t,n,r;for(t="chrome.tabs.onHighlighted is called,",t+=" windowId:"+e.on,n=e.tabIds.length,r=0;r<n;r++)t+=" tab:"+e.tabIds[r];i.L(t),u.Je=!0}),t=chrome.runtime.getManifest(),u.Xe=t.version,chrome.runtime.onMessage.addListener(function(e,t,n){switch(i.L(t.tab?"from a content script:"+t.tab.url:"from the extension"),e.action){case"loginagain":n({action:"done"}),u.an();break;case"setloglevel":var o=0;"Error"==e.level?o=4:"Info"==e.level?o=7:"Debug"==e.level&&(o=8),i.U(o);break;case"clearcache":break;case"setmode":var c=0;"async"==e.mode&&(c=1,r.q=e.q),"1"==e.safe_search?r.safesearch=!0:r.safesearch=!1,a.ce(c),u.nn(c);break;case"config_request":var l={mode:"sync"};r.async_mode&&(l.mode="async",l.q=!1,r.q&&(l.q=!0)),l.safe_search="0",r.safesearch&&(l.safe_search="1"),n(l);break;case"mouse_move":case"mouse_wheel":i.L("requst:"+e.action+" url:"+e.url),n(l={}),u.Ht(e.url);break;case"get_warning_web_page_info":var h,m,g;l={rating_url:"",home_url:"",category:"",time:"",rating:0},null!=u.be[e.id]&&(i.L("found item, rating:"+u.be[e.id].rating),l.rating_url=u.be[e.id].url,l.home_url=u.be[e.id].bar_url,l.category=a.Se(u.be[e.id].rating),g=u.be[e.id].time,u.be[e.id].rating&&(l.rating=u.be[e.id].rating),h=m=g.getHours(),m>12&&(h=m-12),h+=":",h+=g.getMinutes(),h+=":",h+=g.getSeconds(),h+=m>=12?" PM.":" AM.",l.time=h),n(l);break;case"block_warning_page":u.be[e.id].rating,n(l={});break;case"get_customized_web_page":l={customized_page:""},null!=u.be[e.id]&&(l.customized_page=u.be[e.id].customized_page),n(l);break;case"set_igore_category":u.$t(u.be[e.id].time,u.be[e.id].rating);break;case"refresh_token_revoke":chrome.tabs.create({url:"https://security.google.com/settings/security/permissions",active:!0},function(e){}),n(l={action:"refresh_token_revoke is done"});break;case"get_last_error":n(l={error:u.Ze});break;case"youtubeFilter":s.xe(e.channelUrl,e.videoUrl,t.tab.id,n);break;case"video":n(s.Ne[t.tab.id])}}),i.L("Ext_Initializer Exit")}()})}]);