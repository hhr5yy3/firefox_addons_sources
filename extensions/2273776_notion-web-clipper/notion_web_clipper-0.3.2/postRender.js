(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{1087:function(e,t,n){"use strict";n.r(t);n(15),n(11);var a=n(0),r=n.n(a),i=n(366),s=n(3),o=n(45),l=n(12),c=n(349),d=n(1),u=n(748);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class h extends s.a{constructor(){super(...arguments),this.renderModal=()=>{const e=c.a.state;if(e.isOpen)return r.a.createElement(u.a,{captureSelection:!0,restoreSelection:!this.environment.device.isMobile,autocompleteQuery:e.autocompleteQuery,targets:e.targets,onAutocompleteQueryChange:this.handleAutocompleteQueryChange,onAccept:this.handleAccept,onCancel:this.handleCancel,desktopWidth:220,isAddTo:e.isAddTo,isCreateIn:!1})},this.handleAccept=async e=>{const t=l.c(this.environment);await i.a({environment:this.environment,value:e,transaction:t}),l.b({environment:this.environment,transaction:t})},this.handleCancel=()=>{i.c(this.environment)},this.handleAutocompleteQueryChange=e=>{c.a.state.isOpen&&c.a.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},c.a.state,{autocompleteQuery:e}))}}renderComponent(){const{device:e}=this.environment,t=c.a.state;return r.a.createElement(o.c,{popupType:e.isMobile?o.c.PopupType.SlideUp:o.c.PopupType.Popup,alignmentToOrigin:o.c.Alignment.Start,open:t.isOpen,render:this.renderModal,originRect:t.isOpen?t.rect:void 0,onDismiss:()=>i.c(this.environment)})}}t.default=Object(d.g)(h)},1088:function(e,t,n){"use strict";n.r(t);n(15),n(11);var a=n(2),r=n.n(a),i=n(0),s=n.n(i),o=n(3),l=n(398),c=n(81),d=n(76),u=n(24),p=n(758),m=n(22),h=n(55),g=n(53),b=n(256),f=n(1632),y=n(124),S=n(82),v=n(285),E=n(772),M=n(58),C=n(360),O=n(618),w=n(1),k=n(95),P=n(40),T=n(258),I=n(20),j=n(86),D=n(117),x=n(153),B=n(408),A=n(301),F=n(1461);function R(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const W=["pdf","html","markdown"],N=e=>e>.1&&e<2;class z extends o.a{constructor(){super(...arguments),this.storeTypes={exportTypePopupStore:S.a,pdfFormatPopupStore:S.a},this.renderMenu=()=>{const{device:e}=this.environment;if(!c.a.state.online)return this.renderOffline();const t=l.a.state;return t.open&&e.isMobile?this.renderMobileModal(t):t.open?this.renderDesktopModal(t):void 0},this.handleSelectExportType=(e,t)=>{const n=l.a.state;if(!n.open)return;const{exportOptions:a}=n;if(e===a.exportType)return;let r;r=U({},a,"pdf"===e?{exportType:"pdf",pdfFormat:E.g(t)}:{exportType:e}),E.b(this.environment,U({},n,{exportOptions:r}))},this.handleSelectPaperFormat=e=>{const t=l.a.state;t.open&&l.c(t)&&E.b(this.environment,U({},t,{exportOptions:U({},t.exportOptions,{pdfFormat:e})}))},this.handleToggleRecursive=()=>{const e=l.a.state;if(e.open){if(l.c(e)&&!E.a(this.environment))return C.a(this.environment,{from:"export_modal",for:"enterprise"}),void this.handleUpgrade();E.b(this.environment,U({},e,{recursive:!e.recursive}))}},this.handleSetScalePercent=e=>{const t=l.a.state;t.open&&l.c(t)&&E.b(this.environment,U({},t,{exportOptions:U({},t.exportOptions,{scale:e})}))},this.handleCancel=()=>{E.c()},this.handleSubmit=()=>{if(!this.canSubmit())return;const e=l.a.state;e.open&&(E.c(),e.root.table===M.a?E.f(this.environment,{spaceId:e.root.id,exportOptions:e.exportOptions}):E.d(this.environment,{blockId:e.root.id,recursive:e.recursive,exportOptions:e.exportOptions}))},this.handleUpgrade=()=>{E.c()}}renderComponent(){return s.a.createElement(F.a,{onDismiss:this.handleCancel,render:this.renderMenu,requireOnline:!0,modalStore:l.a})}renderOffline(){return s.a.createElement("div",{style:this.getOfflineStyle()},s.a.createElement(w.a,{defaultMessage:"Please go online to export.",id:"exportModal.offlineMessage.description"}))}renderMobileModal(e){const t={menuType:m.a.Modal,title:s.a.createElement(w.a,{id:"exportModal.title",defaultMessage:"Export"}),right:s.a.createElement(w.a,{id:"exportModal.closeButton.label",defaultMessage:"Close"}),onClickRight:this.handleCancel};return s.a.createElement(m.b,Object.assign({},t),s.a.createElement(h.a,{type:h.a.Type.Vertical,initialFocus:void 0,sections:[{key:"exportOptions",render:e=>s.a.createElement(u.a,Object.assign({},e)),items:this.getMobileExportOptionsMenuItems(e)},{key:"actions",render:e=>{let{children:t}=e,n=R(e,["children"]);return s.a.createElement(u.a,Object.assign({isSubmitButton:!0},n),t)},items:[{key:"submit",render:e=>{const{onClick:t}=e,n=R(e,["onClick"]);return s.a.createElement(p.a,Object.assign({},n,{onClick:t||this.handleSubmit,disabled:!this.canSubmit(),title:s.a.createElement(w.a,{id:"exportModal.exportButton.label",defaultMessage:"Export"})}))},action:this.handleSubmit}]}]}))}renderDesktopModal(e){const{device:t,currentUser:n}=this.environment,a=l.c(e)&&!E.a(this.environment);return s.a.createElement("div",{style:this.getModalWrapStyle()},s.a.createElement(f.a,{isMenuItem:t.isMobile,buttonPopupStore:this.stores.exportTypePopupStore,label:s.a.createElement(w.a,{id:"exportModal.exportFormat.description",defaultMessage:"Export format"}),selectedTitle:this.getBlockExportTypeTitle(e.exportOptions.exportType),renderMenuSections:e=>[{key:"exportType",render:e=>s.a.createElement(u.a,Object.assign({},e)),items:W.map(t=>this.getBlockExportTypeMenuListItem(t,e,n.id))}]}),l.c(e)&&s.a.createElement(s.a.Fragment,null,s.a.createElement(f.a,{isMenuItem:t.isMobile,buttonPopupStore:this.stores.pdfFormatPopupStore,label:s.a.createElement(w.a,{id:"exportModal.pageFormat.description",defaultMessage:"Page format"}),selectedTitle:this.getPDFFormatTitle(e.exportOptions.pdfFormat),renderMenuSections:e=>[{key:"isoPaperFormats",render:e=>s.a.createElement(u.a,Object.assign({},e)),items:y.a.map(t=>this.getPaperFormatMenuListItem(t,e))},{key:"otherPaperFormats",render:e=>s.a.createElement(u.a,Object.assign({topBorder:!0},e)),items:y.b.map(t=>this.getPaperFormatMenuListItem(t,e))}]}),this.renderScalePercent()),"space"!==e.root.table&&s.a.createElement(O.a,{requireUpgradeToTier:a&&"enterprise",analyticsName:"export_modal",onClick:this.handleToggleRecursive,render:(n,r)=>s.a.createElement("div",Object.assign({},n,{style:{display:"flex",alignItems:"center",height:32}}),s.a.createElement("div",{style:{display:"flex",alignItems:"center",marginRight:"auto",color:this.theme.lightTextColor,fontSize:14}},s.a.createElement(w.a,{defaultMessage:"Include subpages",id:"exportModal.includeSubpages.label"})," ",r&&s.a.createElement("div",{style:{marginLeft:8}},r)),s.a.createElement(b.a,{on:e.recursive,isAndroid:t.isAndroid,disabled:a})),renderUpgradeTooltip:()=>s.a.createElement(T.a,{imageURL:I.a.images.tooltips.upsells.exportPdfSubpagesPng,imageWidth:240,imageHeight:100,title:s.a.createElement(w.a,{defaultMessage:"Upgrade to include subpages in PDF exports",id:"exportModal.pdfSubpageUpgradeTooltip.title"}),caption:s.a.createElement(w.a,{defaultMessage:"Creates a zip file containing all the pages nested inside the current page as PDF files.",id:"exportModal.pdfSubpageUpgradeTooltip.caption"})}),tooltipPlacement:P.a.Placement.Left,upgradeButtonDesktopStyle:{marginTop:2},onUpgradeClick:this.handleUpgrade}),s.a.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:16}},s.a.createElement(d.a,{isGray:!0,style:{marginLeft:"auto",marginRight:8},onClick:this.handleCancel},s.a.createElement(w.a,{defaultMessage:"Cancel",id:"exportModal.cancelButton.label"})),s.a.createElement(v.a,{onClick:this.handleSubmit,disabled:!this.canSubmit()},s.a.createElement(w.a,{defaultMessage:"Export",id:"exportModal.exportButton.label"}))))}renderScalePercent(){const e=this.getScalePercent();return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",height:32}},s.a.createElement(j.a,{style:{color:this.theme.lightTextColor}},s.a.createElement(w.a,{id:"exportModal.pageScale.description",defaultMessage:"Scale percent"})),s.a.createElement(V,{value:e,onChange:this.handleSetScalePercent})),!N(e)&&s.a.createElement(A.a,{show:!0,showDelay:500,showHold:100,render:e=>e&&s.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:32,padding:"4px 0"}},s.a.createElement(j.a,{isSmall:!0,isMultiline:!0,style:{color:this.theme.errorText}},s.a.createElement(w.a,{id:"exportModal.pageScale.invalidScaleError",defaultMessage:"Scale percent must be a number between 10 and 200",description:"Shown if the scale percent for pdf export is outside of range."})))}))}getMobileExportOptionsMenuItems(e){const{currentUser:t,device:n}=this.environment;return r.a.compact([{key:"export type",render:a=>s.a.createElement(f.a,Object.assign({},a,{isMenuItem:n.isMobile,buttonPopupStore:this.stores.exportTypePopupStore,label:s.a.createElement(w.a,{defaultMessage:"Export format",id:"exportModal.exportFormat.description"}),selectedTitle:this.getBlockExportTypeTitle(e.exportOptions.exportType),renderMenuSections:e=>[{key:"exportType",render:e=>s.a.createElement(u.a,Object.assign({},e)),items:W.map(n=>this.getBlockExportTypeMenuListItem(n,e,t.id))}]})),action:()=>{this.stores.exportTypePopupStore.setState({open:!0})}},l.c(e)&&{key:"pdf format",render:t=>s.a.createElement(f.a,Object.assign({},t,{isMenuItem:n.isMobile,buttonPopupStore:this.stores.pdfFormatPopupStore,label:s.a.createElement(w.a,{defaultMessage:"Page format",id:"exportModal.pageFormat.description"}),selectedTitle:this.getPDFFormatTitle(e.exportOptions.pdfFormat),renderMenuSections:e=>[{key:"isoPaperFormats",render:e=>s.a.createElement(u.a,Object.assign({},e)),items:y.a.map(t=>this.getPaperFormatMenuListItem(t,e))},{key:"otherPaperFormats",render:e=>s.a.createElement(u.a,Object.assign({topBorder:!0},e)),items:y.b.map(t=>this.getPaperFormatMenuListItem(t,e))}]})),action:()=>{this.stores.pdfFormatPopupStore.setState({open:!0})}},"space"!==e.root.table&&{key:"recursive",render:t=>{let{onClick:a,key:r}=t,i=R(t,["onClick","key"]);const o=l.c(e)&&!E.a(this.environment);return s.a.createElement(O.a,{key:r,requireUpgradeToTier:o&&"enterprise",analyticsName:"export_modal",onClick:a,render:(t,a)=>{const r=Object(k.a)(i,t);return s.a.createElement(g.a,Object.assign({},r,{title:s.a.createElement("div",{style:{display:"flex",alignItems:"center"}},s.a.createElement(w.a,{defaultMessage:"Include subpages",id:"exportModal.includeSubpages.label"})," ",a&&s.a.createElement("div",{style:{marginLeft:8}},a)),right:s.a.createElement(b.a,Object.assign({},r,{on:e.recursive,isAndroid:n.isAndroid,disabled:o}))}))},renderUpgradeTooltip:()=>s.a.createElement(T.a,{imageURL:I.a.images.tooltips.upsells.exportPdfSubpagesPng,imageWidth:240,imageHeight:100,title:s.a.createElement(w.a,{defaultMessage:"Upgrade to include subpages in PDF exports",id:"exportModal.pdfSubpageUpgradeTooltip.title"}),caption:s.a.createElement(w.a,{defaultMessage:"Creates a zip file containing all the pages nested inside the current page as PDF files.",id:"exportModal.pdfSubpageUpgradeTooltip.caption"})}),tooltipPlacement:P.a.Placement.Left,upgradeButtonDesktopStyle:{marginTop:2},onUpgradeClick:this.handleUpgrade})},action:this.handleToggleRecursive}])}getBlockExportTypeTitle(e){switch(e){case"pdf":return s.a.createElement(w.a,{id:"exportModal.exportFormatButton.pdf.label",defaultMessage:"PDF"});case"markdown":return s.a.createElement(w.a,{id:"exportModal.exportFormatButton.markdownAndCSV.label",defaultMessage:"Markdown & CSV"});case"html":return s.a.createElement(w.a,{id:"exportModal.exportFormatButton.html.label",defaultMessage:"HTML"})}}getPDFFormatTitle(e){switch(e){case"Letter":return s.a.createElement(w.a,{id:"exportModal.pageFormatButton.letter.label",defaultMessage:"Letter"});case"A3":return s.a.createElement(w.a,{id:"exportModal.pageFormatButton.a3.label",defaultMessage:"A3"});case"A4":return s.a.createElement(w.a,{id:"exportModal.pageFormatButton.a4.label",defaultMessage:"A4"});case"Legal":return s.a.createElement(w.a,{id:"exportModal.pageFormatButton.legal.label",defaultMessage:"Legal"});case"Tabloid":return s.a.createElement(w.a,{id:"exportModal.pageFormatButton.tabloid.label",defaultMessage:"Tabloid"})}}getBlockExportTypeMenuListItem(e,t,n){const a=l.a.state,r=a.open&&"pdf"===e&&"space"===a.root.table&&!E.a(this.environment);return{key:e,action:()=>{if(t.close(),r)return C.a(this.environment,{from:"export_modal",for:"enterprise"}),void this.handleUpgrade();this.handleSelectExportType(e,n)},render:n=>{let{onClick:a,key:i}=n,o=R(n,["onClick","key"]);return s.a.createElement(O.a,{key:i,requireUpgradeToTier:r&&"enterprise",analyticsName:"export_modal",onClick:a,onUpgradeClick:()=>{t.close(),this.handleUpgrade()},render:(t,n)=>s.a.createElement(g.a,Object.assign({},Object(k.a)(o,t),{title:this.getBlockExportTypeTitle(e),right:n})),renderUpgradeTooltip:()=>s.a.createElement(T.a,{imageURL:I.a.images.tooltips.upsells.exportPdfSubpagesPng,imageWidth:240,imageHeight:100,title:s.a.createElement(w.a,{defaultMessage:"Upgrade to export the workspace as PDFs",id:"exportModal.workspacePdfUpgradeTooltip.title"}),caption:s.a.createElement(w.a,{defaultMessage:"Creates a zip file containing all pages in the workspace as PDF files.",id:"exportModal.workspacePdfUpgradeTooltip.caption"})}),tooltipPlacement:P.a.Placement.Left,upgradeButtonDesktopStyle:{marginTop:2}})}}}getPaperFormatMenuListItem(e,t){return{key:e,action:()=>{t.close(),this.handleSelectPaperFormat(e)},render:t=>s.a.createElement(g.a,Object.assign({},t,{title:this.getPDFFormatTitle(e)}))}}getScalePercent(){const e=l.a.state;return e.open&&l.c(e)?void 0===e.exportOptions.scale?1:e.exportOptions.scale:1}canSubmit(){return N(this.getScalePercent())}getModalWrapStyle(){return{width:320,padding:24,fontSize:14}}getOfflineStyle(){return U({},this.getModalWrapStyle(),{color:this.theme.mediumTextColor})}}function V(e){let{value:t,onChange:n}=e;const a=Object(w.h)(),r=s.a.useCallback(e=>{const t=e.target.value,a=Object(D.f)(t)||Object(D.e)(t);let r=void 0;"object"==typeof a?r="percent"===a.format?a.value:a.value/100:"number"==typeof a&&(r=a/100),void 0!==r&&n(r)},[n]),[i,o]=s.a.useState(!1),l=s.a.useMemo(()=>Object(D.c)(100*t,"number",a),[t,a]);return s.a.createElement(B.a,{capture:i},s.a.createElement(x.b,{value:l,onChange:r,onFocus:()=>o(!0),onBlur:()=>o(!1),style:{width:60},inputStyle:{textAlign:"right"}}))}t.default=z},1089:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(3),s=n(829),o=n(743),l=n(23),c=n(285),d=n(20),u=n(217),p=n(630),m=n(257),h=n(1);class g extends i.a{constructor(){super(...arguments),this.handleModalDismiss=()=>{s.a.state.open&&s.a.state.onDecline&&s.a.state.onDecline(),s.a.setState({open:!1})},this.handleConnectClick=()=>{s.a.state.open&&s.a.state.onConfirm(),s.a.setState({open:!1})},this.handleConnectedAppsClick=()=>{this.handleModalDismiss(),p.a({currentTab:"connected_apps"})}}renderComponent(){const{device:e}=this.environment,t=s.a.state;return r.a.createElement(o.a,{open:t.open,innerStyle:g.wrapStyle,preventHideChildrenWhileOpening:!0,render:()=>r.a.createElement(a.Fragment,null,r.a.createElement("div",{style:g.modalHeaderWrapStyle},r.a.createElement("img",{src:d.a.images.googleDriveLogoPng,style:{width:50,display:"inline-block"}}),r.a.createElement("div",{style:this.getModalMessageStyle()},r.a.createElement(h.a,{defaultMessage:"Notion cannot access the Google Drive file you are trying to embed.",id:"googleAuthPromptModal.noAccessFile.errorMessage"})),e.isReactNative?r.a.createElement("div",{style:this.getModalMessageStyle()},r.a.createElement(h.a,{defaultMessage:"Please use Notion on desktop to connect a new account.",id:"googleAuthPromptModal.mobileUseDesktopPrompt.errorMessage"})):r.a.createElement(c.a,{isLarge:!0,onClick:this.handleConnectClick},r.a.createElement(h.a,{defaultMessage:"Connect to Google",id:"googleAuthPromptModal.connectToGoogleButton.label"})),!e.isMobile&&this.renderConnectedAccountsLink())),onDismiss:this.handleModalDismiss})}renderConnectedAccountsLink(){return r.a.createElement("div",{style:{display:"block",marginTop:u.a.vertical.tiny}},r.a.createElement(m.a,{underlined:!0,onClick:this.handleConnectedAppsClick},r.a.createElement(h.a,{defaultMessage:"See my connected accounts",id:"googleAuthPromptModal.seeConnectedAccountsButton.label"})))}getModalMessageStyle(){return{fontSize:16,lineHeight:1.5,fontWeight:l.a.fontWeight.medium,marginTop:15,marginBottom:20,color:this.theme.mediumTextColor}}}g.wrapStyle={padding:"24px 36px 24px",minWidth:300,maxWidth:400},g.modalHeaderWrapStyle={textAlign:"center",marginTop:8,marginBottom:18,justifyContent:"space-between"},t.default=g},1090:function(e,t,n){"use strict";n.r(t);n(15),n(11);var a=n(0),r=n.n(a),i=n(39),s=n(19),o=n(23),l=n(300),c=n(799),d=n(200),u=n(61),p=n(3),m=n(743),h=n(153),g=n(285),b=n(487),f=n(8),y=n(83),S=n(1),v=n(79);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){C(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class O extends p.a{constructor(){super(...arguments),this.storeTypes={promoCodeStore:d.a,promoError:u.a.of(void 0)},this.handleModalDismiss=()=>{c.a.setState({open:!1})},this.handleChangeEmail=()=>{this.handleModalDismiss(),l.a.setState(M({},l.a.state,{open:!0,currentTab:"profile"}))},this.handleInputChange=e=>{this.stores.promoCodeStore.setState(M({},this.stores.promoCodeStore.state,{inputValue:e.target.value.toUpperCase()})),this.stores.promoError.set(void 0)},this.handleSubmitPromoCode=async()=>{const e=this.stores.promoCodeStore.state.inputValue;if(e){const t=await i.T(this.environment,{code:e});"failed"!==t.type&&t.data.promo?c.a.state.open&&(await c.a.state.handlePromoCode(this.stores.promoCodeStore.state.inputValue),this.handleModalDismiss()):this.stores.promoError.set(this.props.intl.formatMessage({defaultMessage:"Promo code {code} does not exist",id:"studentNotEligibleModal.numberedList.item2.promocode.errorMessage"},{code:e}))}}}renderComponent(){const{open:e}=c.a.state;return r.a.createElement(m.a,{open:e,innerStyle:O.wrapStyle,preventHideChildrenWhileOpening:!0,render:()=>this.renderModalContents(),onDismiss:this.handleModalDismiss})}renderModalContents(){return r.a.createElement("div",{style:{fontSize:14}},r.a.createElement("div",null,r.a.createElement(S.a,{defaultMessage:"<p>Unfortunately you are not eligible for a free Personal Pro plan if you use this email address.</p><p>K-12 students, K-12 educators, and personal email addresses such as Gmail and Outlook are not eligible to receive the <pricinglink>Personal Pro Plan</pricinglink> for free, but anyone is welcome to use the <pricinglink>Personal Plan</pricinglink> for free with unlimited storage.</p>",id:"studentNotEligibleModal.header",values:{br:r.a.createElement("br",null),p:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement("p",{style:{marginTop:0,marginBottom:8}},1===t.length?t[0]:r.a.Children.toArray(t))},pricinglink:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement(b.a,{external:!0,href:v.c.pricing},t)}}})),this.renderSchoolEmailCodePrompt(),this.renderPromoCode(),this.renderContactUs())}renderSchoolEmailCodePrompt(){const e=Object(y.g)(this.environment);return r.a.createElement("div",{style:{display:"flex",marginTop:16}},r.a.createElement("div",{style:{width:18,flexShrink:0,color:this.theme.mediumTextColor}},r.a.createElement(S.a,{defaultMessage:"1.",id:"studentNotEligibleModal.numberedList.firstItem"})),r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement("div",{style:{color:this.theme.mediumTextColor}},r.a.createElement(S.a,{defaultMessage:"Your current email is:",id:"studentNotEligibleModal.numberedList.changeEmailItem.message"})),r.a.createElement("div",{style:{fontWeight:o.a.fontWeight.medium,marginTop:0}},e&&e.email),r.a.createElement("div",{style:{color:this.theme.mediumTextColor,marginTop:4}},r.a.createElement(S.a,{defaultMessage:"Thousands of university, college, and post-secondary school domains are already eligible, not just .edu emails!",id:"studentNotEligibleModal.numberedList.changeEmailItem.message2"})),r.a.createElement(g.a,{style:{marginTop:12},onClick:this.handleChangeEmail,isLarge:!0},r.a.createElement(S.a,{defaultMessage:"Change email",id:"studentNotEligibleModal.numberedList.changeEmailItem.button.label"}))))}renderPromoCode(){const e=this.stores.promoError.get(),t=this.props.intl.formatMessage({defaultMessage:"Enter student promo code…",id:"studentNotEligibleModal.numberedList.item2.promocodePlaceholder"});return r.a.createElement("div",{style:{display:"flex",marginTop:16}},r.a.createElement("div",{style:{width:18,flexShrink:0,color:this.theme.mediumTextColor}},r.a.createElement(S.a,{defaultMessage:"2.",id:"studentNotEligibleModal.numberedList.secondItem"})),r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement("div",{style:{color:this.theme.mediumTextColor}},r.a.createElement(S.a,{defaultMessage:"Have a student promo code?",id:"studentNotEligibleModal.numberedList.promoCodeItem.message"})),r.a.createElement("div",{style:{display:"flex",marginTop:12}},r.a.createElement(h.b,{style:{marginRight:8,height:32},value:this.stores.promoCodeStore.state.inputValue,onChange:this.handleInputChange,onSubmit:this.handleSubmitPromoCode,placeholder:t}),r.a.createElement(g.a,{onClick:this.handleSubmitPromoCode,disabled:!this.stores.promoCodeStore.state.inputValue,isLarge:!0},r.a.createElement(S.a,{defaultMessage:"Submit",id:"studentNotEligibleModal.numberedList.promoCodeItem.submitButton"}))),r.a.createElement("div",{style:{color:s.f.red,fontSize:12,marginTop:4,marginLeft:8,height:20}},e)))}renderContactUs(){return r.a.createElement("div",{style:{display:"flex",alignItems:"center",color:this.theme.lightTextColor,borderTop:"1px solid ".concat(this.theme.regularDividerColor),paddingTop:14}},f.a.help({width:14,marginTop:1,marginRight:6,fill:this.theme.lightIconColor})," ",r.a.createElement("div",null,r.a.createElement(S.a,{defaultMessage:"Have questions about this? <inlinelink>More info & FAQs</inlinelink>.",id:"studentNotEligibleModal.contactUsSection.message",values:{inlinelink:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement(b.a,{href:"https://www.notion.so/Notion-for-students-teachers-adc631df15ee4ab9a7a33dd50f4c16fe",external:!0},t)}}})))}}O.wrapStyle={padding:"24px 36px 24px",minWidth:300,maxWidth:400},t.default=Object(S.g)(O)},1091:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(3),s=n(565),o=n(422),l=n(22),c=n(55),d=n(24),u=n(83),p=n(53),m=n(90),h=n(47),g=n(45),b=n(252),f=n(17),y=n(94),S=n(1),v=n(116);class E extends i.a{constructor(){super(...arguments),this.renderPopup=()=>{const{device:e}=this.environment,t=s.a.state;if(!t.open)return;const{currentUserRootStore:n}=f.a.state;if(!n)return;const a=u.j(n),i=[];for(const s of a){const n=s.getSpaceStore();if(n){const a=Object(v.getSpaceName)(this.environment,n),l=Object(v.getSpaceIcon)(this.environment,n);i.push({key:s.id,action:async()=>{await o.c({environment:this.environment,store:t.store,spaceStore:n,spaceViewStore:s,isPrivate:!0})},render:t=>r.a.createElement(p.a,Object.assign({title:a,icon:r.a.createElement(m.a,{icon:l,isEmptyPage:!1,title:a,size:e.isMobile?24:20,disabled:!0})},t))})}}const h=[{key:"spaces",render:t=>r.a.createElement(d.a,Object.assign({title:e.isMobile?void 0:r.a.createElement(S.a,{defaultMessage:"Choose a workspace",id:"duplicatePagePopup.chooseWorkspace.menuItem.title"}),isTitleUppercase:!0},t)),items:i},{key:"logout",render:e=>r.a.createElement(d.a,Object.assign({},e,{topBorder:!0})),items:[{key:"logout",action:()=>b.k(this.environment),render:e=>{const{currentUserStore:t}=f.a.state;let n="";if(t){const e=t.getValue();e&&(n=e.email)}return r.a.createElement(p.a,Object.assign({caption:r.a.createElement(S.a,{defaultMessage:"Log out ({email})",id:"duplicatePagePopup.buttonMenuItem.logoutButton.label",values:{email:n}})},e))}}]}];let g;return g=e.isMobile?{menuType:l.b.MenuType.Modal,title:r.a.createElement(S.a,{defaultMessage:"Choose a workspace",id:"duplicatePagePopup.choooseWorkspaceMobileMenu.title"}),right:r.a.createElement(y.CancelMenuText,null),onClickRight:o.a}:{menuType:l.b.MenuType.Popup},r.a.createElement(l.b,Object.assign({},g),r.a.createElement(c.a,{type:c.a.Type.Vertical,sections:h,initialFocus:1}))}}renderComponent(){const{device:e}=this.environment;return r.a.createElement(g.c,{popupType:e.isMobile?h.a.PopupType.SlideUp:h.a.PopupType.Popup,open:s.a.state.open,render:this.renderPopup,originGap:8,onDismiss:o.a,originRect:s.a.state.originRect,enableRounding:!0})}}t.default=E},1100:function(e,t,n){"use strict";n.r(t);n(15),n(11);var a=n(0),r=n.n(a),i=n(2),s=n.n(i),o=n(28),l=n(39),c=n(114),d=n(54),u=n(252),p=n(17),m=n(14),h=n(148),g=n(1),b=n(6);const f=Object(g.f)({deletingAccount:{id:"accountActions.deletingAccount.loadingMessage",defaultMessage:"Deleting your account…"},noUserError:{id:"accountActions.deletingAccount.noUserToDeleteMessage",defaultMessage:"No account to delete."}}),y=function(e){const{userStore:t,data:n,transaction:a}=e,r={};n.givenName&&(r.given_name=n.givenName),n.familyName&&(r.family_name=n.familyName),r.profile_photo=n.profilePhoto,o.d({store:t,data:r,transaction:a})};var S=n(128),v=n(84),E=n(16),M=n(13);class C extends E.a{getInitialState(){return{uploadingProfilePhoto:!1,givenName:"",familyName:"",startDayOfWeek:Object(M.H)()}}getValueForUser(e,t){const n=e.getValue();if(n){const{given_name:e,family_name:a,profile_photo:r}=n,i=t.getSettings();return{uploadingProfilePhoto:!1,givenName:e||"",familyName:a||"",profilePhoto:r,startDayOfWeek:void 0===i.start_day_of_week?Object(M.H)():i.start_day_of_week}}}}var O=C;class w extends E.a{getInitialState(){return{emailDomains:[],name:"",domain:""}}getValueForSpace(e){const t=e.getValue(),n=e.getDomain();if(t){const{name:e,email_domains:a}=t;return{name:e||"",domain:n||"",emailDomains:a||[]}}}}var k=w;class P extends E.a{getInitialState(){return{disablePublicAccess:!1,disableGuests:!1,disableMoveToSpace:!1,disableExport:!1,disableSpacePageEdits:!1,disablePublicAccessRequests:!1}}getValueForSpace(e){const t=e.getValue();if(t){const{disable_public_access:e,disable_guests:n,disable_move_to_space:a,disable_export:r,disable_space_page_edits:i,disable_public_access_requests:s}=t;return{disablePublicAccess:Boolean(e),disableGuests:Boolean(n),disableMoveToSpace:Boolean(a),disableExport:Boolean(r),disableSpacePageEdits:Boolean(i),disablePublicAccessRequests:Boolean(s)}}}}var T=P;function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}async function D(e){const{environment:t,spaceId:n,store:a}=e,r=await l.W(t,{spaceId:n});if("failed"===r.type)d.d(r);else if(r.data&&r.data.samlConfig){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){j(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r.data.samlConfig,{useMetadataUrl:Boolean(r.data.samlConfig.idpMetadataUrl)});return a.setState(e),r.data}return a.reset(),{}}class x extends E.a{getInitialState(){return{status:"unconfigured",emailDomains:[],spaceIds:[],createAccount:!1,useMetadataUrl:!1}}async getValueForSpace(e,t){const n=new x;return await D({environment:e,spaceId:t.id,store:n}),Promise.resolve(n.state)}}var B=x,A=n(300),F=n(3),R=n(586),L=n(743),U=n(1352),_=n(489),W=n(32),N=n(233),z=n(153),V=n(102),q=n(1140),H=n(744),G=n(750),Y=n(12),Q=n(61),K=n(23),Z=n(250),X=n(194),$=n(81),J=n(19),ee=n(285),te=n(299);n(136);function ne(){return(navigator.languages?navigator.languages.map(e=>e.toLowerCase()):navigator.language?[navigator.language.toLowerCase()]:navigator.userLanguage?[navigator.userLanguage.toLowerCase()]:[]).map(e=>e.split("-")[0])}const ae=["ar","az","he","fa","ur"];function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(Object(n),!0).forEach((function(t){se(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class oe extends F.a{renderComponent(){return this.renderTranslatedText()}renderTranslatedText(){const{translations:e}=this.props,t=ne();for(const n of t){const t=e[n];if(t)return r.a.createElement("div",{style:this.getTextStyle(n)},t)}}getTextStyle(e){return ae.includes(e)?ie({direction:"rtl"},this.props.style):ie({},this.props.style)}}var le,ce=oe,de=n(1150),ue=n(503),pe=n(86),me=n(83),he=n(1634),ge=n(255),be=n(1353),fe=n(89),ye=n(8),Se=n(640),ve=n(473),Ee=n(257),Me=n(746);!function(e){e.Password="Password",e.CurrentEmail="TemporaryPasscode"}(le||(le={}));class Ce extends E.a{getInitialState(){return{open:!1,authorized:!1,authorizationType:void 0}}}var Oe=Ce,we=n(487),ke=n(224);function Pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pe(Object(n),!0).forEach((function(t){Ie(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class je extends F.a{constructor(){super(...arguments),this.storeTypes={store:Oe},this.renderModalContent=()=>{const{store:e}=this.stores,{state:t}=e;return r.a.createElement("div",{style:Te({},this.styles.modal,{},this.getColors().modal)},r.a.createElement(Se.a,{fetch:this.getAuthorizationType,loading:e=>e&&r.a.createElement("div",{style:this.styles.loadingSpinner},r.a.createElement(V.a,null)),render:()=>r.a.createElement(r.a.Fragment,null,t.authorizationType===le.Password?this.renderVerifyPassword(t):t.authorizationType===le.CurrentEmail?this.renderVerifyCurrentEmail(t):void 0,t.authorized&&this.renderSetNewEmail(t))}))},this.renderSetNewEmail=e=>{const{store:t}=this.stores;if(t.state.authorized)return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{style:this.styles.paragraph},r.a.createElement(g.a,{id:"profileSettings.changeEmailModal.newEmailInstructions",defaultMessage:"Please enter a new email and we will send you a verification code."})),r.a.createElement("div",null,this.renderNewEmailInput()),t.state.newEmailPasscodeSent?this.renderNewEmailPasscodeInput(e):this.renderSendNewEmailPasscodeButton(e),this.renderEducationPlanDowngradeWarning())},this.handleSendCurrentEmailVerification=async()=>{const{userValue:e}=this.props,{store:t}=this.stores;if(!e)return;const n=await l.Zb(this.environment,{email:e.email,disableLoginLink:!0,isSignup:!1});"success"===n.type?t.setState(Te({},t.state,{currentEmailPasscodeSent:!0,currentEmailPasscode:"",error:void 0})):t.setState(Te({},t.state,{currentEmailPasscodeSent:!0,error:Object(ke.b)(this.props.intl,n)}))},this.handleChangeCurrentEmailPasscode=e=>{const{store:t}=this.stores;t.setState(Te({},t.state,{currentEmailPasscode:e.currentTarget.value,error:void 0}))},this.handleChangePassword=e=>{const{store:t}=this.stores;t.setState({open:!0,authorized:!1,authorizationType:le.Password,password:e.currentTarget.value,error:void 0})},this.handleClearPassword=()=>{const{store:e}=this.stores;e.setState({open:!0,authorized:!1,authorizationType:le.Password,password:""})},this.handleSubmitAuthorization=async()=>{const{store:e}=this.stores;if(!e.state.authorized)if(e.state.authorizationType===le.Password){const t=this.getUserCurrentEmail();if(!t)return;const n=await l.Cb(this.environment,{email:t,password:e.state.password});if("failed"===n.type)return void e.setState(Te({},e.state,{error:Object(ke.b)(this.props.intl,n)}));e.setState(Te({},e.state,{authorized:!0,newEmail:"",newEmailPasscode:"",newEmailPasscodeSent:!1}))}else e.state.authorizationType===le.CurrentEmail&&e.setState(Te({},e.state,{authorized:!0,newEmail:"",newEmailPasscode:"",newEmailPasscodeSent:!1}))},this.handleChangeNewEmail=e=>{const{store:t}=this.stores;t.setState(Te({},t.state,{newEmail:e.currentTarget.value,error:void 0}))},this.handleClearNewEmail=()=>{const{store:e}=this.stores;e.setState(Te({},e.state,{newEmail:"",newEmailPasscodeSent:!1,error:void 0}))},this.handleSendNewEmailVerification=async()=>{const{store:e}=this.stores;if(!e.state.authorized)return;const t=await l.Yb(this.environment,{email:e.state.newEmail});"success"===t.type?e.setState(Te({},e.state,{newEmailPasscodeSent:!0,newEmailPasscode:"",error:void 0})):e.setState(Te({},e.state,{error:Object(ke.b)(this.props.intl,t)}))},this.handleChangeNewEmailPasscode=e=>{const{store:t}=this.stores;t.setState(Te({},t.state,{newEmailPasscode:e.currentTarget.value,error:void 0}))},this.handleSubmit=async()=>{const{store:e}=this.stores;if(!e.state.authorized)return;const t=e.state.authorizationType===le.Password?{type:"Password",password:e.state.password,newEmail:e.state.newEmail,newEmailPasscode:e.state.newEmailPasscode}:{type:"CurrentEmail",currentEmailPasscode:e.state.currentEmailPasscode,newEmail:e.state.newEmail,newEmailPasscode:e.state.newEmailPasscode},n=await l.l(this.environment,t);"success"===n.type?await this.closeModal():e.setState(Te({},e.state,{error:Object(ke.b)(this.props.intl,n)}))},this.handleSendUsMessageClick=()=>{Me.a({environment:this.environment,from:"change_email_student"})},this.openModal=()=>{const{store:e}=this.stores;e.setState({open:!0,authorized:!1,authorizationType:void 0})},this.closeModal=async()=>{const{store:e}=this.stores,{hasEducationPlan:t}=this.props;e.reset(),t&&await v.e(this.environment)},this.getAuthorizationType=async()=>{const{store:e}=this.stores,{intl:t}=this.props,n=this.getUserCurrentEmail();if(!n)return;const a=await ve.b({environment:this.environment,userEmail:n});a.error?e.setState({open:e.state.open,authorized:!1,authorizationType:void 0,error:t.formatMessage({id:"profileSettings.changeEmailModal.errorFetchingAccountData",defaultMessage:"Could not fetch account information for {currentEmail}."},{currentEmail:n})}):a.value.hasPassword?e.setState({open:!0,authorized:!1,authorizationType:le.Password,password:""}):e.setState({open:!0,authorized:!1,authorizationType:le.CurrentEmail,currentEmailPasscodeSent:!1,currentEmailPasscode:""})},this.styles={modal:{width:460,padding:32,borderRadius:3,fontSize:14},loadingSpinner:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},paragraph:{marginTop:12,marginBottom:14},error:{color:J.f.red,fontSize:12,marginTop:4,marginLeft:8},bold:{fontWeight:K.a.fontWeight.bold},input:{padding:"4px 8px"},button:{marginTop:14},educationPlanWarning:{display:"flex",marginTop:14,paddingTop:14}}}renderComponent(){const{userValue:e}=this.props,{store:t}=this.stores;return r.a.createElement(r.a.Fragment,null,r.a.createElement(G.a,null,r.a.createElement(g.a,{id:"profileSettings.personalInfoSection.emailSetting.label",defaultMessage:"Email"})),r.a.createElement("div",null,r.a.createElement("span",{style:{marginRight:12}},e&&e.email),r.a.createElement(Ee.a,{onClick:this.openModal},r.a.createElement(g.a,{id:"profileSettings.personalInfoSection.emailSetting.changeEmailButton.label",defaultMessage:"Change email"}))),r.a.createElement(L.a,{open:t.state.open,onDismiss:this.closeModal,render:this.renderModalContent}))}renderVerifyPassword(e){const{userValue:t}=this.props;if(t)return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{style:{margin:0}},this.renderCurrentEmail()),r.a.createElement("p",{style:this.styles.paragraph},r.a.createElement(g.a,{id:"profileSettings.changeEmailModal.enterPasswordInstructions",defaultMessage:"Please enter your password."})),r.a.createElement(z.b,{style:{display:"none"},type:"text",value:t.email,autoComplete:"username",disabled:!0}),r.a.createElement(z.b,{type:"password",disabled:e.authorized,value:e.password,onChange:this.handleChangePassword,showClearButton:!0,onClearButtonClick:this.handleClearPassword,onSubmit:this.handleSubmitAuthorization,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.passwordInput.label",defaultMessage:"Password"}),style:this.styles.input,focusInitial:!0,autoComplete:"current-password"}),!e.authorized&&e.error&&r.a.createElement("div",{style:this.styles.error},e.error),!e.authorized&&r.a.createElement(ee.a,{isLarge:!0,style:this.styles.button,onClick:this.handleSubmitAuthorization},r.a.createElement(g.a,{id:"profileSettings.changeEmailModal.continueButton.label",defaultMessage:"Continue",description:"After the user verifies their current password or email, they click this button to continue changing their email."})))}renderVerifyCurrentEmail(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{style:Te({},this.styles.paragraph,{marginTop:0})},this.renderCurrentEmail()," ",e.currentEmailPasscodeSent?r.a.createElement(g.a,{id:"profileSettings.changeEmailModal.sentVerificationCodeToCurrentEmail",defaultMessage:"We've sent a temporary verification code to this email."}):r.a.createElement(g.a,{id:"profileSettings.changeEmailModal.sendVerificationCodeToCurrentEmail",defaultMessage:"We'll send a temporary verification code to this email."})),e.currentEmailPasscodeSent?this.renderCurrentEmailPasscodeInput(e):this.renderSendCurrentEmailPasscodeButton())}renderSendCurrentEmailPasscodeButton(){return r.a.createElement(ee.a,{isLarge:!0,onClick:this.handleSendCurrentEmailVerification},r.a.createElement(g.a,{id:"profileSettings.changeEmailModal.sendCurrentEmailVerificationCode.label",defaultMessage:"Send verification code",description:"Sends a temporary verification passcode to the user's current email."}))}renderCurrentEmailPasscodeInput(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(z.b,{value:e.currentEmailPasscode,onChange:this.handleChangeCurrentEmailPasscode,onSubmit:this.handleSubmitAuthorization,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.enterCurrentEmailVerificationCodeInput.placeholder",defaultMessage:"Enter verification code"}),focusInitial:!0,style:this.styles.input}),!e.authorized&&r.a.createElement(ee.a,{isLarge:!0,style:this.styles.button,onClick:this.handleSubmitAuthorization},r.a.createElement(g.a,{id:"profileSettings.changeEmailModal.continueButton.label",defaultMessage:"Continue",description:"After the user verifies their current password or email, they click this button to continue changing their email."})))}renderNewEmailInput(){const{store:e}=this.stores;if(e.state.authorized)return r.a.createElement(z.b,{value:e.state.newEmail,onChange:this.handleChangeNewEmail,onSubmit:this.handleSendNewEmailVerification,showClearButton:!0,onClearButtonClick:this.handleClearNewEmail,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.newEmailInput.placeholder",defaultMessage:"Enter new email"}),style:this.styles.input,focusInitial:!0})}renderSendNewEmailPasscodeButton(e){return r.a.createElement(r.a.Fragment,null,e.error&&r.a.createElement("div",{style:this.styles.error},e.error),r.a.createElement(ee.a,{isLarge:!0,style:this.styles.button,onClick:this.handleSendNewEmailVerification},r.a.createElement(g.a,{id:"profileSettings.changeEmailModal.sendVerificationCodeButton.label",defaultMessage:"Send verification code"})))}renderNewEmailPasscodeInput(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{style:this.styles.paragraph},r.a.createElement(g.a,{id:"profileSettings.changeEmailModal.verificationCodeSentMessage",defaultMessage:"We just sent you a temporary verification code to {newEmail}.",values:{newEmail:r.a.createElement("span",{style:this.styles.bold},e.newEmail)}})),r.a.createElement(z.b,{value:e.newEmailPasscode,onChange:this.handleChangeNewEmailPasscode,onSubmit:this.handleSubmit,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.enterVerificationCodeInput.placeholder",defaultMessage:"Enter verification code"}),focusInitial:!0,style:this.styles.input}),e.error&&r.a.createElement("div",{style:this.styles.error},e.error),r.a.createElement(ee.a,{isLarge:!0,style:this.styles.button,onClick:this.handleSubmit},r.a.createElement(g.a,{id:"profileSettings.changeEmailModal.changeEmailButton.label",defaultMessage:"Change email"})))}renderEducationPlanDowngradeWarning(){var e=this;const{hasEducationPlan:t}=this.props;if(t)return r.a.createElement("div",{style:Te({},this.styles.educationPlanWarning,{},this.getColors().educationPlanWarning)},ye.a.help({width:14,marginTop:4,marginRight:6,fill:this.theme.lightIconColor})," ",r.a.createElement("div",null,r.a.createElement(g.a,{defaultMessage:"Changing your email may downgrade your workspace on a Free Education Plan to the basic Free Plan. You won't lose any data, but you'll need to upgrade to re-access paid features. Have questions about this? <sendmessagelink>Send us a message</sendmessagelink>.",id:"emailChangeSettings.downgradeEducationPlan.warning.message",values:{sendmessagelink:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return r.a.createElement(we.a,{onClick:e.handleSendUsMessageClick},n)}}})))}renderCurrentEmail(){const{userValue:e}=this.props;if(e)return r.a.createElement(g.a,{id:"profileSettings.changeEmailModal.currentEmail",defaultMessage:"Your current email is {currentEmail}.",values:{currentEmail:r.a.createElement("span",{style:this.styles.bold},e&&e.email)}})}getUserCurrentEmail(){const{store:e}=this.stores,{userValue:t,intl:n}=this.props;if(t)return t.email;e.setState({open:e.state.open,authorized:!1,authorizationType:void 0,error:n.formatMessage({id:"profileSettings.changeEmailModal.errorNoUserValue",defaultMessage:"User value is undefined."})})}getColors(){return{modal:{background:this.theme.contentBackground},educationPlanWarning:{color:this.theme.lightTextColor,borderTop:"1px solid ".concat(this.theme.regularDividerColor)}}}}var De=Object(g.g)(je),xe=n(100),Be=n(133),Ae=n(116);class Fe extends E.a{getInitialState(){return{open:!1}}}var Re=new Fe;function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(n),!0).forEach((function(t){_e(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class We extends F.a{constructor(){super(...arguments),this.handleLogOutFromActiveSessions=async()=>{await l.Gb(this.environment,{}),this.openConfirmationModal()}}renderComponent(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:this.getSettingsOptionStyle()},r.a.createElement(H.a,{smallMarginBottom:!0},r.a.createElement(g.a,{id:"manageActiveSessions.title",defaultMessage:"Log out of all devices"})),r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.a.createElement(g.a,{id:"manageActiveSessions.logOutActiveSessions.label",defaultMessage:"You will be logged out of all other active sessions besides this one and will have to log back in."})),r.a.createElement(te.a,{isLarge:!0,isRed:!0,onClick:this.handleLogOutFromActiveSessions,style:{marginTop:12}},r.a.createElement(g.a,{id:"manageActiveSessions.logOutActiveSessions.button",defaultMessage:"Log out"}))),this.renderManageActiveSessionsModal())}renderManageActiveSessionsModal(){const{device:e}=this.environment,{open:t}=Re.state,n=this.getUserEmailAddress();return r.a.createElement(L.a,{open:t,onDismiss:this.closeConfirmationModal,innerStyle:{width:e.isPhone?"90%":350,padding:24,display:"flex",flexDirection:"column"},render:()=>r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{marginBottom:24}},n?r.a.createElement(g.a,{id:"manageActiveSessions.confirmationModal.withEmail",defaultMessage:"You have been logged out from other active sessions for {email}.",values:{email:n}}):r.a.createElement(g.a,{id:"manageActiveSessions.confirmationModal.withoutEmail",defaultMessage:"You have been logged out from other active sessions for your account."})),r.a.createElement(ee.a,{onClick:this.closeConfirmationModal},r.a.createElement(g.a,{id:"manageActiveSessions.confirmationModal.close",defaultMessage:"Close"})))})}openConfirmationModal(){Re.setState(Ue({},Re.state,{open:!0}))}closeConfirmationModal(){Re.setState(Ue({},Re.state,{open:!1}))}getUserEmailAddress(){let e=void 0;const{currentUserStore:t}=p.a.state;if(t){const n=t.getValue();e=n&&n.email}return e}getSettingsOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",height:"auto",paddingLeft:e.isMobile?t.state.paddingLeftCSS:0,paddingRight:e.isMobile?t.state.paddingRightCSS:0}}}var Ne=We,ze=n(1444);function Ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(n),!0).forEach((function(t){He(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function He(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ge extends F.a{constructor(){super(...arguments),this.storeTypes={spaceProfileSettingsStore:O,passwordRequestStore:ge.a,isEducationStore:Q.a.of(!1)},this.handleUploadProfilePhoto=()=>{Z.c({environment:this.environment,onStart:this.handleUploadStart,bucket:"public",onError:this.handleUploadError,onComplete:this.handleUploadComplete,accept:"image/*"})},this.handleDeleteProfilePhoto=()=>{this.stores.spaceProfileSettingsStore.setState(qe({},this.stores.spaceProfileSettingsStore.state,{profilePhoto:void 0}))},this.handleUpdateClick=()=>{const{givenName:e,familyName:t,profilePhoto:n,startDayOfWeek:a}=this.stores.spaceProfileSettingsStore.state;e&&t?(Y.d(this.environment,r=>{const{currentUserStore:i,currentUserSettingsStore:s}=p.a.state;if(i&&y({userStore:i,data:{givenName:e,familyName:t,profilePhoto:n},transaction:r}),s){s.getSettings().start_day_of_week!==a&&_.e({userSettingsStore:s,data:{start_day_of_week:a},transaction:r})}}),A.a.setState(qe({},A.a.state,{open:!1}))):d.e(r.a.createElement(g.a,{id:"profileSettings.personalInfoSection.firstOrLastNameMissing.message",defaultMessage:"Please fill in both first name and last name."}))},this.handleStartOfWeekToggle=()=>{const{state:e}=this.stores.spaceProfileSettingsStore,{startDayOfWeek:t}=e;this.stores.spaceProfileSettingsStore.setState(qe({},e,{startDayOfWeek:t?0:1}))},this.handleCancelClick=()=>{A.a.setState(qe({},A.a.state,{open:!1}))},this.handleGivenNameChange=e=>{this.stores.spaceProfileSettingsStore.setState(qe({},this.stores.spaceProfileSettingsStore.state,{givenName:e.target.value}))},this.handleFamilyNameChange=e=>{this.stores.spaceProfileSettingsStore.setState(qe({},this.stores.spaceProfileSettingsStore.state,{familyName:e.target.value}))},this.handleUploadStart=()=>{this.stores.spaceProfileSettingsStore.setState(qe({},this.stores.spaceProfileSettingsStore.state,{uploadingProfilePhoto:!0}))},this.handleUploadError=()=>{this.stores.spaceProfileSettingsStore.setState(qe({},this.stores.spaceProfileSettingsStore.state,{uploadingProfilePhoto:!1})),d.e(r.a.createElement(g.a,{id:"profileSettings.profilePhotoSection.uploadProfilePhotoError.message",defaultMessage:"Upload failed."}))},this.handleUploadComplete=e=>{this.stores.spaceProfileSettingsStore.setState(qe({},this.stores.spaceProfileSettingsStore.state,{profilePhoto:e[0],uploadingProfilePhoto:!1}))},this.handleDeleteAccountClick=async()=>{const{currentUserStore:e,currentUserRootStore:t}=p.a.state;if(!e||!t)return;const n=e.getValue();if(!n)return;const a=s.a.compact(t.getSpaceViewStores().map(e=>e.getSpaceStore())).filter(e=>!Object(ue.e)(e.getValue(),e.getRole())),i=s.a.compact(a.map(e=>Object(Ae.getSpaceName)(this.environment,e)));await U.b({width:420,message:r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(g.a,{id:"profileSettings.deleteAccountConfirmationDialog.warning",defaultMessage:"This action cannot be undone. This will permanently delete your entire account. All private workspaces will be deleted, and you will be removed from all shared workspaces."}),i.length>0&&r.a.createElement("ul",{style:{padding:0}},i.map(e=>r.a.createElement("li",{style:{marginTop:6,color:J.f.red,fontWeight:K.a.fontWeight.medium,listStyle:"none"}},e)))," ",r.a.createElement(g.a,{id:"profileSettings.deleteAccountConfirmationDialog.prompt",defaultMessage:"Please type in your email to confirm."})),r.a.createElement(ce,{style:{marginTop:16},translations:{es:"Esta acción no se puede deshacer. Esto eliminará permanentemente su cuenta completa. Se eliminarán todas las áreas de trabajo privadas y se eliminará de todas las áreas de trabajo compartidas. Por favor, escriba su correo electrónico para confirmar.",ru:"Это действие не может быть отменено. Это навсегда удалит всю вашу учетную запись. Все частные рабочие области будут удалены, и вы будете удалены из всех общих рабочих областей. Пожалуйста, введите ваш адрес электронной почты для подтверждения.",zh:"此操作无法撤消。 这将永久删除您的整个帐户。 将删除所有私有工作空间，您将从所有共享工作空间中删除。 请输入您的电子邮箱进行确认。",de:"Diese Aktion kann nicht rückgängig gemacht werden. Dadurch wird Ihr gesamtes Konto dauerhaft gelöscht. Alle privaten Arbeitsbereiche werden gelöscht und Sie werden aus allen freigegebenen Arbeitsbereichen entfernt. Bitte geben Sie Ihre E-Mail-Adresse zur Bestätigung ein.",fr:"Cette action ne peut pas être annulée. Cela supprimera définitivement votre compte en entier. Tous les espaces de travail privés seront supprimés et vous serez supprimé de tous les espaces de travail partagés. Veuillez taper votre email pour confirmer.",ja:"この操作を元に戻すことはできません。 これによりアカウント全体が完全に削除されます。 すべてのプライベートワークスペースが削除され、あなたはすべての共有ワークスペースから削除されます。 確認のためにメールアドレスを入力してください。",it:"Questa azione non può essere annullata. Questo eliminerà definitivamente l'intero account. Tutti gli spazi di lavoro privati verranno eliminati e verranno rimossi da tutti gli spazi di lavoro condivisi. Inserisci la tua email per confermare.",pt:"Essa ação não pode ser desfeita. Isso excluirá permanentemente sua conta inteira. Todos os espaços de trabalho privados serão excluídos e você será removido de todos os espaços de trabalho compartilhados. Por favor, digite o seu email para confirmar.",nl:"Deze actie kan niet ongedaan gemaakt worden. Hiermee wordt uw gehele account permanent verwijderd. Alle privéwerkruimten worden verwijderd en u wordt verwijderd uit alle gedeelde werkruimten. Voer je e-mailadres in om te bevestigen.",pl:"Tego działania nie można cofnąć. Spowoduje to trwałe usunięcie całego konta. Wszystkie prywatne obszary robocze zostaną usunięte, a użytkownik zostanie usunięty ze wszystkich współużytkowanych obszarów roboczych. Wpisz swój e-mail, aby potwierdzić.",sv:"Den här åtgärden kan inte ångras. Detta tar bort hela ditt konto permanent. Alla privata arbetsytor kommer att raderas, och du kommer att tas bort från alla delade arbetsytor. Vänligen skriv in din email för att bekräfta.",uk:"Цю дію не можна скасувати. Таким чином буде видалено весь обліковий запис назавжди. Всі приватні робочі області будуть видалені, і ви будете видалені з усіх спільних робочих областей. Будь ласка, введіть електронний лист для підтвердження.",no:"Denne handlingen kan ikke fortrykkes. Dette vil permanent slette hele kontoen din. Alle private arbeidsområder blir slettet, og du vil bli fjernet fra alle delte arbeidsområder. Vennligst skriv inn din epost for å bekrefte.",tr:"Bu işlem geri alınamaz. Bu işlem hesabınızın tamamını kalıcı olarak siler. Tüm özel çalışma alanları silinecek ve paylaşılan tüm çalışma alanlarından kaldırılacaksınız. Lütfen onaylamak için e-postanızı yazın.",cs:"Tuto akci nelze vrátit zpět. Tím bude trvale smazán celý váš účet. Všechny soukromé pracovní prostory budou smazány a budete ze všech sdílených pracovních prostor odstraněni. Pro potvrzení zadejte svůj e-mail.",vi:"Hành động này không thể được hoàn tác. Điều này sẽ xóa vĩnh viễn toàn bộ tài khoản của bạn. Tất cả các không gian làm việc riêng tư sẽ bị xóa và bạn sẽ bị xóa khỏi tất cả các không gian làm việc chung. Vui lòng nhập email của bạn để xác nhận.",da:"Denne handling kan ikke fortrydes. Dette vil permanent slette hele din konto. Alle private arbejdsområder slettes, og du vil blive fjernet fra alle delte arbejdsområder. Indtast venligst din email for at bekræfte.",hu:"Ez a művelet nem visszavonható. Ez véglegesen törli a teljes fiókot. Minden privát munkaterület törlődik, és eltávolításra kerül minden megosztott munkaterületről. Kérjük, írja be e-mail címét, hogy megerősítse.",ar:"لا يمكن التراجع عن هذا الإجراء. سيؤدي الإجراء إلى حذف حسابك بالكامل. سيتم أيضا حذف جميع مساحات العمل الخاصة ، وستتم إزالتك من جميع مساحات العمل المشتركة. يرجى كتابة البريد الإلكتروني الخاص بك للتأكيد.",th:"การกระทำนี้ไม่สามารถยกเลิกได้ นี่จะเป็นการลบบัญชีทั้งหมดของคุณอย่างถาวร พื้นที่ทำงานส่วนตัวทั้งหมดจะถูกลบและคุณจะถูกลบออกจากพื้นที่ทำงานที่ใช้ร่วมกันทั้งหมด กรุณาพิมพ์อีเมลของคุณเพื่อยืนยัน",he:"לא ניתן לבטל פעולה זו. פעולה זו תמחק לצמיתות את כל החשבון שלך. כל סביבות העבודה הפרטיות יימחקו, ותוסר מכל סביבות העבודה המשותפות. הקלד את האימייל שלך כדי לאשר.",fi:"Tätä toimintoa ei voi peruuttaa. Tämä poistaa koko tilin pysyvästi. Kaikki yksityiset työtilat poistetaan ja poistetaan kaikista jaetuista työtiloista. Vahvistaaksesi kirjoita sähköpostiosoitteesi.",id:"Tindakan ini tidak bisa dibatalkan. Ini akan secara permanen menghapus seluruh akun Anda. Semua ruang kerja pribadi akan dihapus, dan Anda akan dihapus dari semua ruang kerja bersama. Ketikkan email Anda untuk mengonfirmasi."}})),acceptLabel:0===i.length?r.a.createElement(g.a,{id:"profileSettings.deleteAccountConfirmationDialog.deleteAccountButton.label",defaultMessage:"Permanently delete account"}):r.a.createElement(g.a,{id:"profileSettings.deleteAccountConfirmationDialog.deleteAccountAndWorkspacesButton.label",defaultMessage:"{numberOfWorkspaces, plural, one {Permanently delete account and 1 workspace} other {Permanently delete account and {numberOfWorkspaces} workspaces}}",values:{numberOfWorkspaces:i.length}}),requiredInputValue:n.email})&&(A.a.reset(),async function(e){c.b({message:f.deletingAccount});const t=e.currentUser.id,{currentUserRootStore:n,currentUserStore:a}=p.a.state;if(!n||!a||!t)return c.a(),void d.e(b.a.formatMessage(f.noUserError));m.sb(e),await l.t(e,{}),await h.a.clearForUser(t),u.l({environment:e,userId:t}),c.a()}(this.environment))}}willMount(e){super.willMount(e);const{spaceProfileSettingsStore:t,isEducationStore:n}=this.stores,{currentUserStore:a,currentUserSettingsStore:r,currentUserRootStore:i}=p.a.state;if(a&&r){const e=t.getValueForUser(a,r);e&&t.setState(e)}if(i){const e=(Object(fe.b)({environment:this.environment,userRootStore:i})||[]).some(e=>e===W.a.pricing.student.productId);n.set(e)}}renderComponent(){return $.a.state.online?this.renderSettings():this.renderOfflineMessage()}renderOfflineMessage(){return r.a.createElement(q.a,null,r.a.createElement(pe.a,{isSmall:!0,style:{textAlign:"center"}},r.a.createElement(g.a,{defaultMessage:"Please go online to manage your profile.",id:"profileSettings.offline.message"})))}renderSettings(){const{currentUserStore:e}=p.a.state;if(!e)return;e.getValue();const{profilePhoto:t,uploadingProfilePhoto:n,givenName:i,familyName:s,startDayOfWeek:o}=this.stores.spaceProfileSettingsStore.state,{passwordRequestStore:l}=this.stores,c="on"===xe.a.getGroup(this.environment,"lion-tamer"),d="on"===xe.a.getGroup(this.environment,"user-data-consent");return l.state.loading?r.a.createElement(V.a,{style:{margin:"50% auto"}}):r.a.createElement(q.a,{controlRow:this.renderControlRow()},this.renderSpaceProfileHeader(),r.a.createElement("div",{style:{marginBottom:24}},r.a.createElement(de.a,{title:r.a.createElement(a.Fragment,null,r.a.createElement(g.a,{id:"profileSettings.helpButton.caption",defaultMessage:"Changes to account settings will apply to all of your workspaces."})," ",r.a.createElement(g.a,{id:"profileSettings.helpButton.learnMoreLink",defaultMessage:"<s>Learn more.</s>",values:{s:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement("span",{style:{textDecoration:"underline"}},t)}}})),href:Object(Be.a)("guides.profileSettings"),analyticsFrom:"profile_settings"})),r.a.createElement(H.a,null,r.a.createElement(g.a,{id:"profileSettings.profilePhotoSection.title",defaultMessage:"Photo"})),t&&r.a.createElement(X.a,{url:t,isAuthenticated:!1,stripGoogleIconQuery:!0,width:90,render:(e,t)=>r.a.createElement("div",{style:{width:90,height:90}},r.a.createElement(N.a,{src:t,style:{width:90,height:90,objectFit:"cover",borderRadius:"100%"}}))}),r.a.createElement(te.a,{isLarge:!0,onClick:this.handleUploadProfilePhoto,style:{marginTop:8,marginBottom:4}},r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement(g.a,{id:"profileSettings.profilePhotoSection.uploadPhotoButton.label",defaultMessage:"Upload photo"}),n&&r.a.createElement(V.a,{style:{marginLeft:4}}))),t&&"on"===xe.a.getGroup(this.environment,"remove-profile-photo-string")&&r.a.createElement(te.a,{onClick:this.handleDeleteProfilePhoto,style:{marginTop:4,marginLeft:12,marginBottom:2}},r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement(g.a,{id:"profileSettings.profilePhotoSection.removePhotoButton.label",defaultMessage:"Remove"}))),q.a.renderDivider(),r.a.createElement(H.a,null,r.a.createElement(g.a,{id:"profileSettings.personalInfoSection.title",defaultMessage:"Personal info"})),r.a.createElement(De,{userValue:Object(me.g)(this.environment),hasEducationPlan:this.stores.isEducationStore.get()}),r.a.createElement(G.a,{hasMarginTop:!0},r.a.createElement(g.a,{id:"profileSettings.personalInfoSection.firstNameInput.label",defaultMessage:"First name",description:"User's first name, also known as forename or given name."})),r.a.createElement(z.b,{value:i,onChange:this.handleGivenNameChange}),r.a.createElement(G.a,{hasMarginTop:!0}," ",r.a.createElement(g.a,{id:"profileSettings.personalInfoSection.lastNameInput.label",defaultMessage:"Last name",description:"User's last name, also known as family name or surname"})),r.a.createElement(z.b,{value:s,onChange:this.handleFamilyNameChange}),q.a.renderDivider(),r.a.createElement(he.a,{isEducationPlan:this.props.isEducationPlan,requestStore:l}),d&&q.a.renderDivider(),d&&r.a.createElement(ze.a,null),q.a.renderDivider(),r.a.createElement(Ne,null),!c&&q.a.renderDivider(),!c&&r.a.createElement(be.a,{onClick:this.handleStartOfWeekToggle,startDayOfWeek:o}),q.a.renderDivider(),r.a.createElement(H.a,null,r.a.createElement(g.a,{id:"profileSettings.dangerousSettings.title",defaultMessage:"Danger zone",description:"Title for the user settings that we consider 'dangerous', like deleting an account."})),r.a.createElement(te.a,{isLarge:!0,isRed:!0,onClick:this.handleDeleteAccountClick},r.a.createElement(g.a,{id:"profileSettings.dangerousSettings.deleteAccountButton.label",defaultMessage:"Delete my account"})))}renderControlRow(){return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(ee.a,{isLarge:!0,onClick:this.handleUpdateClick},r.a.createElement(g.a,{id:"profileSettings.updateButton.label",defaultMessage:"Update"})),r.a.createElement(te.a,{isLarge:!0,style:{marginLeft:12},onClick:this.handleCancelClick},r.a.createElement(g.a,{id:"profileSettings.cancelButton.label",defaultMessage:"Cancel"})))}renderSpaceProfileHeader(){return r.a.createElement(H.a,{large:!0,divider:"full"},r.a.createElement(g.a,{id:"profileSettings.title",defaultMessage:"Account"}))}}var Ye=Object(g.g)(Ge);function Qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ke(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ze extends F.a{renderComponent(){return r.a.createElement("div",{style:this.getStyle(),onMouseDown:this.props.onMouseDown,onClick:this.props.onClick,onDoubleClick:this.props.onDoubleClick,onContextMenu:this.props.onContextMenu},r.a.createElement("div",{style:this.getSidebarStyle()},this.props.sidebar),r.a.createElement("div",{style:this.getChildrenStyle()},this.props.children))}getStyle(){return{display:"flex",height:"100%",flexDirection:this.props.isReversed?"row-reverse":"row"}}getSidebarStyle(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(n),!0).forEach((function(t){Ke(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({width:160,height:"100%",background:this.theme.sidebarBackground,flexGrow:0,flexShrink:0},this.props.sidebarStyle)}getChildrenStyle(){return{flexGrow:1,position:"relative",zIndex:1,height:"100%"}}}var Xe=Ze,$e=n(90),Je=n(95);function et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?et(Object(n),!0).forEach((function(t){nt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function nt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class at extends F.a{constructor(){super(...arguments),this.handleKeyDown=e=>{"Backspace"===e.key&&0===this.props.value.length&&this.props.onRemoveLastToken()}}renderComponent(){const{device:e}=this.environment;return r.a.createElement("div",{onClick:this.props.onClick,style:e.isMobile?this.getMobileWrapStyle():this.getDesktopWrapStyle()},this.props.tokens,this.renderInput())}renderInput(){const{device:e}=this.environment,t=0===this.props.tokens.length;return r.a.createElement(z.b,Object.assign({format:z.b.Format.Transparent},Object(Je.a)({onKeyDown:this.handleKeyDown},{onChange:this.props.onChange}),{value:this.props.value,onSubmit:this.props.onSubmit,onBlur:this.props.onBlur,focus:this.props.focus,style:tt({},at.inputStyle,{margin:e.isMobile?"0 8px 8px 0":"0 6px 6px 0"}),readOnly:this.props.readOnly,inputStyle:{height:18},size:1,type:this.props.type,placeholder:t?this.props.placeholder:"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}))}getDesktopWrapStyle(){return tt({display:"flex",flexWrap:"wrap",alignItems:"flex-start",minHeight:32,boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,borderRadius:3,fontSize:14,cursor:"text",overflow:"hidden",padding:"7px 9px 0px"},this.props.style)}getMobileWrapStyle(){return tt({},this.getDesktopWrapStyle(),{fontSize:14,padding:"7px 10px 0"})}}at.inputStyle={flexGrow:1,flexShrink:1,flexBasis:60,minWidth:60,width:"auto",lineHeight:"20px"};var rt=at,it=n(146),st=n(40),ot=n(251),lt=n(45),ct=n(22),dt=n(55),ut=n(53),pt=n(24),mt=n(119),ht=(n(695),n(772)),gt=n(752),bt=n(192),ft=n(271),yt=n(37);function St(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function vt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?St(Object(n),!0).forEach((function(t){Et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):St(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Et(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Mt(){return r.a.createElement(g.a,{id:"spaceBasicSettings.workspaceNameSection.nameInput.caption",defaultMessage:"You can use your name or the name of your team. Keep it simple.",description:"The caption below the text input where a user edits the name of their workspace"})}const Ct=Object(g.f)({nameInputPlaceholder:{id:"spaceBasicSettings.nameInput.placeholder",defaultMessage:"e.g. company name"},workspaceDomainInputPlaceholder:{id:"spaceBasicSettings.domainSection.workspaceDomainInput.placeholder",defaultMessage:"URL"},allowedEmailDomainsInputPlaceholder:{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainInput.placeholder",defaultMessage:"Type an email domain…"},copyDomainTooltip:{id:"spaceBasicSettings.workspaceDomain.tooltip",defaultMessage:"Click to copy link"}});class Ot extends F.a{constructor(){super(...arguments),this.storeTypes={spaceBasicSettingsStore:k,tokenQuery:Q.a.of("")},this.handleSpaceNameChange=e=>{this.stores.spaceBasicSettingsStore.setState(vt({},this.stores.spaceBasicSettingsStore.state,{name:e.target.value}))},this.handleSpaceUrlChange=e=>{this.stores.spaceBasicSettingsStore.setState(vt({},this.stores.spaceBasicSettingsStore.state,{domain:S.A(e.target.value)})),this.forceUpdate()},this.handleConfirm=async()=>{const{spaceStore:e}=this.props,{spaceBasicSettingsStore:t}=this.stores;await S.z({environment:this.environment,spaceStore:e,spaceBasicSettingsStore:t}),A.a.setState(vt({},A.a.state,{open:!1}))},this.handleCancelClick=()=>{A.a.setState(vt({},A.a.state,{open:!1}))},this.handleExportClick=()=>{const{currentSpaceStore:e}=p.a.state;e&&ht.h({environment:this.environment,root:{table:"space",id:e.id}})},this.handleExportMembersClick=()=>{const{currentSpaceStore:e}=p.a.state,{data:t}=mt.a.state;e&&t&&"subscribed_admin"===t.type&&ht.e({spaceStore:e,subscriptionData:t,intl:this.props.intl})},this.handleLeaveClick=()=>{const{spaceStore:e}=this.props,{currentUserSettingsStore:t}=p.a.state;t&&d.c({message:r.a.createElement(g.a,{id:"spaceBasicSettings.leaveWorkspaceConfirmationDialog.prompt",defaultMessage:"Are you sure you want to leave this workspace?"}),showCancel:!0,keepFocus:!0,items:[{label:r.a.createElement(g.a,{id:"spaceBasicSettings.leaveWorkspaceConfirmationDialog.leaveButton.label",defaultMessage:"Leave"}),color:"red",onAccept:async()=>{await S.l({environment:this.environment,spaceId:e.id,userSettingsStore:t})&&(m.cc(this.environment),A.a.setState(vt({},A.a.state,{open:!1})))}}]})},this.handleDeleteClick=async()=>{const{currentUserSettingsStore:e}=p.a.state;if(!e)return;const{spaceStore:t,intl:n}=this.props,a=Object(Ae.getSpaceName)(this.environment,t)||n.formatMessage({defaultMessage:"Untitled workspace",id:"spaceBasicSettings.deleteWorkspace.untitledWorkspace.placeholder"});await U.b({message:r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(g.a,{id:"spaceBasicSettings.deleteWorkspaceConfirmationDialog.prompt",defaultMessage:"This action cannot be undone. This will permanently delete the workspace, including all pages and files. Please type the name of the workspace to confirm."})),r.a.createElement(ce,{style:{marginTop:16},translations:{es:"Esta acción no se puede deshacer. Esto eliminará permanentemente el espacio de trabajo, incluidas todas las páginas y archivos. Por favor escriba el nombre del espacio de trabajo para confirmar.",ru:"Это действие не может быть отменено. Это навсегда удалит рабочее пространство, включая все страницы и файлы. Пожалуйста, введите название рабочей области для подтверждения.",zh:"此操作无法撤消。 这将永久删除工作区，包括所有页面和文件。 请输入要确认的工作空间的名称。",de:"Diese Aktion kann nicht rückgängig gemacht werden. Dadurch wird der Arbeitsbereich einschließlich aller Seiten und Dateien dauerhaft gelöscht. Bitte geben Sie den Namen des Arbeitsbereichs zur Bestätigung ein.",fr:"Cette action ne peut pas être annulée. Cela supprimera définitivement l'espace de travail, y compris toutes les pages et tous les fichiers. Veuillez saisir le nom de l'espace de travail pour confirmer.",ja:"この操作を元に戻すことはできません。 これにより、すべてのページとファイルを含むワークスペースが完全に削除されます。 確認するワークスペースの名前を入力してください。",it:"Questa azione non può essere annullata. Questo eliminerà definitivamente l'area di lavoro, incluse tutte le pagine e i file. Digita il nome dell'area di lavoro per confermare.",pt:"Essa ação não pode ser desfeita. Isso excluirá permanentemente o espaço de trabalho, incluindo todas as páginas e arquivos. Por favor, digite o nome do espaço de trabalho para confirmar.",nl:"Deze actie kan niet ongedaan gemaakt worden. Hiermee wordt de werkruimte permanent verwijderd, inclusief alle pagina's en bestanden. Typ de naam van de werkruimte om te bevestigen.",pl:"Tego działania nie można cofnąć. Spowoduje to trwałe usunięcie obszaru roboczego, w tym wszystkich stron i plików. Wpisz nazwę obszaru roboczego, aby potwierdzić.",sv:"Den här åtgärden kan inte ångras. Detta tar bort arbetsytan permanent, inklusive alla sidor och filer. Vänligen skriv in arbetsplatsens namn för att bekräfta.",uk:"Цю дію не можна скасувати. Це дозволить остаточно видалити робочу область, включаючи всі сторінки та файли. Введіть назву робочої області для підтвердження.",no:"Denne handlingen kan ikke fortrykkes. Dette vil permanent slette arbeidsområdet, inkludert alle sider og filer. Vennligst skriv navnet på arbeidsområdet for å bekrefte.",tr:"Bu işlem geri alınamaz. Bu, tüm sayfaları ve dosyaları içeren çalışma alanını kalıcı olarak siler. Lütfen onaylamak için çalışma alanının adını yazın.",cs:"Tuto akci nelze vrátit zpět. Tím se trvale odstraní pracovní prostor včetně všech stránek a souborů. Zadejte prosím název pracovního prostoru, který chcete potvrdit.",vi:"Hành động này không thể được hoàn tác. Điều này sẽ xóa vĩnh viễn không gian làm việc, bao gồm tất cả các trang và tệp. Vui lòng nhập tên của không gian làm việc để xác nhận.",da:"Denne handling kan ikke fortrydes. Dette vil permanent slette arbejdsområdet, inklusive alle sider og filer. Indtast navnet på arbejdsområdet for at bekræfte.",hu:"Ez a művelet nem visszavonható. Ez véglegesen törli a munkaterületet, beleértve az összes oldalt és fájlt. Kérjük, írja be a munkaterület nevét a megerősítéshez.",ar:"لا يمكن التراجع عن هذا الإجراء. سيؤدي ذلك إلى حذف مساحة العمل كليا ، بما يشمل جميع الصفحات والملفات. يرجى كتابة اسم مساحة العمل للتأكيد.",th:"การกระทำนี้ไม่สามารถยกเลิกได้ นี่จะเป็นการลบพื้นที่ทำงานอย่างถาวรรวมถึงหน้าและไฟล์ทั้งหมด โปรดพิมพ์ชื่อของพื้นที่ทำงานเพื่อยืนยัน",he:"לא ניתן לבטל פעולה זו. פעולה זו תמחק לצמיתות את סביבת העבודה, כולל כל הדפים והקבצים. הקלד את שם מרחב העבודה כדי לאשר.",fi:"Tätä toimintoa ei voi peruuttaa. Tämä poistaa työtilan pysyvästi, mukaan lukien kaikki sivut ja tiedostot. Vahvista kirjoittamalla työtilan nimi.",id:"Tindakan ini tidak bisa dibatalkan. Ini akan secara permanen menghapus ruang kerja, termasuk semua halaman dan file. Silakan ketik nama ruang kerja untuk mengonfirmasi."}})),acceptLabel:r.a.createElement(g.a,{id:"spaceBasicSettings.deleteWorkspaceConfirmationDialog.deleteWorkspaceButton.label",defaultMessage:"Permanently delete workspace"}),requiredInputValue:a})&&(S.h({environment:this.environment,spaceId:t.id,userSettingsStore:e}),m.qb(this.environment),A.a.setState(vt({},A.a.state,{open:!1})))},this.handleRecordIconChange=e=>{const{spaceStore:t}=this.props;Y.d(this.environment,n=>{o.c({store:t.getIconStore(),value:e,transaction:n})})}}willMount(e){super.willMount(e);const{spaceStore:t}=this.props,{spaceBasicSettingsStore:n}=this.stores,a=n.getValueForSpace(t);a&&n.setState(a)}renderComponent(){return $.a.state.online?this.renderSettings():this.renderOfflineMessage()}renderOfflineMessage(){return r.a.createElement(q.a,null,r.a.createElement(pe.a,{isSmall:!0,style:{textAlign:"center"}},r.a.createElement(g.a,{id:"spaceBasicSettings.offlineMessage",defaultMessage:"Please go online to manage settings."})))}renderSettings(){const{spaceStore:e}=this.props,{spaceBasicSettingsStore:t}=this.stores,{name:n,domain:i}=t.state,{data:s}=mt.a.state;if(!s)return;const o=e.canAdmin(),l=!e.canRead(),c=Object(Ae.getSpacePermissionItems)(e),d=fe.J(this.environment),u=e.getValue(),p=o&&u&&!u.disable_export,m=o,h="subscribed_admin"===s.type&&"enterprise"===fe.i(this.environment);return r.a.createElement(q.a,{controlRow:o&&this.renderControlRow()},this.renderSpaceBasicHeader(),l&&r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{textAlign:"center"}},r.a.createElement(g.a,{id:"spaceBasicSettings.guestLimitedAccessMessage",defaultMessage:"You are currently a guest in this workspace. Ask an admin to add you as a member in order to see other pages and workspace settings."})),l&&q.a.renderDivider(),o&&r.a.createElement(a.Fragment,null,r.a.createElement(H.a,null,r.a.createElement(g.a,{id:"spaceBasicSettings.workspaceNameSection.title",defaultMessage:"Name"})),r.a.createElement(z.b,{value:n,placeholder:b.a.formatMessage(Ct.nameInputPlaceholder),readOnly:!o,onChange:this.handleSpaceNameChange}),r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},r.a.createElement(Mt,null)),q.a.renderDivider()),o&&r.a.createElement(a.Fragment,null,r.a.createElement(H.a,null,r.a.createElement(g.a,{id:"spaceBasicSettings.workspaceIconSection.title",defaultMessage:"Icon"})),r.a.createElement("div",{style:{width:72,height:72,border:"1px solid ".concat(this.theme.regularDividerColor),borderRadius:6,display:"flex",justifyContent:"center",alignItems:"center"}},o?r.a.createElement($e.a,{bucket:"public",disabled:!1,icon:Object(Ae.getSpaceIcon)(this.environment,e),isEmptyPage:!1,title:n,size:64,onChange:this.handleRecordIconChange}):r.a.createElement($e.a,{disabled:!0,icon:Object(Ae.getSpaceIcon)(this.environment,e),isEmptyPage:!1,title:n,size:64})),r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{marginTop:8}},r.a.createElement(g.a,{id:"spaceBasicSettings.workspaceIconSection.caption",defaultMessage:"Upload an image or pick an emoji. It will show up in your sidebar and notifications."})),q.a.renderDivider()),o&&r.a.createElement("div",null,r.a.createElement(H.a,null,r.a.createElement(g.a,{id:"spaceBasicSettings.domainSection.title",defaultMessage:"Domain"})),r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement("div",null,window.location.host,"/"),r.a.createElement("div",{style:{marginLeft:6,width:"100%"}},r.a.createElement(z.b,{value:i,placeholder:b.a.formatMessage(Ct.workspaceDomainInputPlaceholder),readOnly:!o,onChange:this.handleSpaceUrlChange}))),r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},Ot.renderDomainCaption(this.environment,i,!0,this.theme)),q.a.renderDivider()),o&&d&&r.a.createElement(a.Fragment,null,r.a.createElement(H.a,null,r.a.createElement(g.a,{id:"spaceBasicSettings.allowedEmailDomainsSection.title",defaultMessage:"Allowed email domains"})),this.renderAllowedEmailDomains(),r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},Ot.renderAllowEmailDomainsCaption()),q.a.renderDivider()),p&&r.a.createElement(a.Fragment,null,r.a.createElement(H.a,null,r.a.createElement(g.a,{id:"spaceBasicSettings.exportContentSection.title",defaultMessage:"Export content"})),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(te.a,{isLarge:!0,onClick:this.handleExportClick},r.a.createElement(g.a,{id:"spaceBasicSettings.exportContentSection.exportButton.label",defaultMessage:"Export all workspace content"}))),r.a.createElement("div",{style:{height:12}}),r.a.createElement(de.a,{title:r.a.createElement(g.a,{id:"spaceBasicSettings.exportContentSection.helpButton.caption",defaultMessage:"Learn about exporting workspaces."}),href:Object(Be.a)("guides.exportWorkspace"),analyticsFrom:"space_settings"}),q.a.renderDivider()),m&&r.a.createElement(a.Fragment,null,r.a.createElement(H.a,{style:{display:"flex",alignItems:"center"}},r.a.createElement("span",{style:{marginRight:8}},r.a.createElement(g.a,{id:"spaceBasicSettings.exportMembersSection.title",defaultMessage:"Export members"})),!h&&r.a.createElement(gt.a,{subscriptionTier:"enterprise",analyticsName:"space_export_members",desktopStyle:{marginTop:-1}})),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(te.a,{isLarge:!0,disabled:!h,onClick:this.handleExportMembersClick,disabledFeedback:!0},r.a.createElement(g.a,{id:"spaceBasicSettings.exportMembersSection.exportAsCSVButton.label",defaultMessage:"Export members as CSV"}))),r.a.createElement("div",{style:{height:12}}),r.a.createElement(de.a,{title:r.a.createElement(g.a,{id:"spaceBasicSettings.exportMembersSection.helpButton.caption",defaultMessage:"Learn about exporting members."}),href:Object(Be.a)("guides.exportMembers"),analyticsFrom:"space_settings"}),q.a.renderDivider()),r.a.createElement(H.a,null,r.a.createElement(g.a,{id:"spaceBasicSettings.dangerousSettingsSection.title",defaultMessage:"Danger zone"})),r.a.createElement("div",{style:{display:"flex"}},(c.length>1||l)&&r.a.createElement(te.a,{isLarge:!0,onClick:this.handleLeaveClick,style:{marginRight:o?12:void 0}},r.a.createElement(g.a,{id:"spaceBasicSettings.dangerousSettingsSection.leaveWorkspaceButton.label",defaultMessage:"Leave workspace"})),o&&r.a.createElement(te.a,{isLarge:!0,isRed:!0,onClick:this.handleDeleteClick},r.a.createElement(g.a,{id:"spaceBasicSettings.dangerousSettingsSection.deleteWorkspaceButton.label",defaultMessage:"Delete entire workspace"}))),o&&r.a.createElement(a.Fragment,null,r.a.createElement("div",{style:{height:12}}),r.a.createElement(de.a,{title:r.a.createElement(g.a,{id:"spaceBasicSettings.dangerousSettingsSection.deleteWorkspaceHelpButton.caption",defaultMessage:"Learn about deleting workspaces."}),href:Object(Be.a)("guides.deleteWorkspace"),analyticsFrom:"space_settings"})))}renderSpaceBasicHeader(){return r.a.createElement(H.a,{large:!0,divider:"full"},r.a.createElement(g.a,{id:"spaceBasicSettings.title",defaultMessage:"Workspace settings"}))}renderControlRow(){return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(ee.a,{isLarge:!0,onClick:this.handleConfirm},r.a.createElement(g.a,{id:"spaceBasicSettings.updateButton.label",defaultMessage:"Update"})),r.a.createElement(te.a,{isLarge:!0,style:{marginLeft:12},onClick:this.handleCancelClick},r.a.createElement(g.a,{id:"spaceBasicSettings.cancelButton.label",defaultMessage:"Cancel"})))}renderAllowedEmailDomains(){const{device:e}=this.environment,{spaceStore:t}=this.props,{spaceBasicSettingsStore:n}=this.stores,{emailDomains:a}=n.state,i=t.canAdmin();return r.a.createElement(lt.c,{popupType:e.isMobile?lt.c.PopupType.SlideUp:lt.c.PopupType.Popup,sameWidthAsOrigin:!0,open:this.stores.tokenQuery.get().length>0,origin:r.a.createElement(rt,{placeholder:b.a.formatMessage(Ct.allowedEmailDomainsInputPlaceholder),value:this.stores.tokenQuery.get(),onChange:e=>this.stores.tokenQuery.set(e.target.value),readOnly:!i,onRemoveLastToken:()=>{const e=a.slice(0,a.length-1);n.setState(vt({},n.state,{emailDomains:e}))},tokens:a.map(e=>r.a.createElement(it.b,{showRemoveButton:!0,isSingle:!1,format:it.b.Format.Medium,key:e,onClickRemove:()=>{const t=a.filter(t=>t!==e);n.setState(vt({},n.state,{emailDomains:t}))},value:e}))}),render:()=>{const t=this.stores.tokenQuery.get().trim(),{data:i}=mt.a.state,{spaceStore:s}=this.props,o=r.a.createElement(g.a,{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainsDropdown.placeholder",defaultMessage:"Type an email domain…"}),l=r.a.createElement(g.a,{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainsDropdown.placeholderNoResults",defaultMessage:"Type an email domain of a member of this workspace…"}),c=i?fe.t(i).map(e=>{if(("unsubscribed_admin"===i.type||"unsubscribed_member"===i.type||"subscribed_admin"===i.type)&&i.joinedMemberIds.includes(e.userId)){const t=bt.a.createChildStore(s,{table:yt.a,id:e.userId}).getEmail();return t&&t.split("@")[1]}}).filter((e,t,n)=>Boolean(e&&t===n.indexOf(e)&&!a.includes(e))):[],d=Object(ft.b)(t,c,e=>e).map((e,t)=>({key:t,render:t=>r.a.createElement(ut.a,Object.assign({},t,{title:e})),action:()=>{const t=[...a,e];n.setState(vt({},n.state,{emailDomains:t})),this.stores.tokenQuery.set("")}}));let u;return u=e.isMobile?{menuType:ct.b.MenuType.ActionSheet}:{menuType:ct.b.MenuType.Popup,width:"100%"},r.a.createElement(ct.b,Object.assign({},u),r.a.createElement(dt.a,{type:dt.a.Type.Vertical,initialFocus:d.length>0?0:void 0,sections:[{key:0,render:e=>r.a.createElement(pt.a,Object.assign({},e,{disableDesktopPadding:!0,title:d.length>0?o:l})),items:d}]}))},onDismiss:()=>{this.stores.tokenQuery.set("")}})}}Ot.renderDomainCaption=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;const i="".concat(window.location.host,"/").concat(t);let s;if(t&&(s=n?r.a.createElement(st.a,{delayThreshold:0,renderTooltip:()=>b.a.formatMessage(Ct.copyDomainTooltip),render:t=>r.a.createElement(we.a,Object.assign({onClick:()=>{ot.c({environment:e,stringValue:i})}},t),i)}):r.a.createElement("span",{style:{color:a.regularTextColor}},i)),!fe.P(e,"personal")&&!fe.P(e,"student"))return r.a.createElement("div",null,r.a.createElement(g.a,{id:"spaceBasicSettings.domainSection.workspaceDomainInput.caption",defaultMessage:"Share the link {linkText} to add anyone with an allowed email domain to your workspace.",values:{linkText:s}}))},Ot.renderAllowEmailDomainsCaption=()=>r.a.createElement(g.a,{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainInput.caption",defaultMessage:"Anyone with email addresses at these domains can automatically join your workspace."});var wt=Object(g.g)(Ot),kt=n(1631),Pt=n(1446),Tt=n(749),It=n(220),jt=n(591),Dt=n(173);class xt extends E.a{getInitialState(){return{churnSurveyModalOpen:!1}}}var Bt=xt,At=n(117),Ft=n(559),Rt=n(372),Lt=n(172);function Ut(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Wt={"en-US":{enterpriseContact:"https://notionup.typeform.com/to/FbZ6Tk",enterpriseTrial:"https://notionup.typeform.com/to/OHk8LR",startupFounder:"https://notionup.typeform.com/to/HgYsu8",startupPartner:"https://notionup.typeform.com/to/XEqmGB",nonprofit:"https://notionup.typeform.com/to/nlhrVv",apiPrivateBeta:"https://notionup.typeform.com/to/dSurQQp2"},"ko-KR":{enterpriseContact:"https://notionup.typeform.com/to/K5knuI18",enterpriseTrial:"https://notionup.typeform.com/to/XkdAkTfV",startupFounder:"https://notionup.typeform.com/to/DYAiiu7x",startupPartner:"https://notionup.typeform.com/to/GfPkKEJZ",nonprofit:"https://notionup.typeform.com/to/cSKAL2LL",apiPrivateBeta:"https://notionup.typeform.com/to/dSurQQp2"}};async function Nt(e){const t=Wt[Lt.a][e.typeform];let n={};e.params&&(n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ut(Object(n),!0).forEach((function(t){_t(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ut(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n,{},e.params));const a=t+"?".concat(Object.keys(n).map(e=>"".concat(e,"=").concat(n[e])).join("&"));m.bd(e.environment,{from:e.frontContext,name:e.typeform}),await Object(Rt.b)("https://embed.typeform.com/embed.js"),window.typeformEmbed.makePopup(a,{hideHeaders:!0,hideFooter:!1}).open()}const zt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement("p",{style:{marginTop:8,marginBottom:8}},1===t.length?t[0]:r.a.Children.toArray(t))},Vt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement(we.a,{external:!0,href:Object(Be.a)("guides.guides")},t)},qt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement(we.a,{external:!0,href:Object(Be.a)("guides.billingAndPayment")},t)};function Ht(e,t,n){Nt({environment:e,typeform:"enterpriseContact",frontContext:t,params:{source:n}})}const Gt={general:function(e){return[{question:r.a.createElement(g.a,{id:"faq.freeVsPersonalAndTeam.question",defaultMessage:"How is the free Personal Plan different from the Personal Pro and Team Plans?"}),answer:r.a.createElement(g.a,{id:"faq.freeVsPersonalAndTeam.answer",defaultMessage:'<p>The biggest difference is how you can collaborate with others.</p><p>The free Personal Plan is designed for individual use, but allows up to 5 unique guests. These are friends, family members, and others you can invite to collaborate with you privately on any page. You can also share a page publicly and turn on commenting or editing access. In the Share menu at the top right, turn on "Share to web" then "Allow editing." Any Notion user with the link will be able to edit your page.</p><p>With the Personal Pro Plan, you can invite unlimited guests for private collaboration. For example, if you run your own business, you can invite all your clients to provide feedback on your work. </p><p>With the Team Plan, you can add members to your workspace so you all share and work on the same content. It also comes with more permission and admin controls so you and your teammates can work together securely. See the plan comparison chart for more details.</p>',values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.overGuestLimitInFreePlan.question",defaultMessage:"What happens when I go over the guest limit on my Personal Plan?"}),answer:r.a.createElement(g.a,{id:"faq.overGuestLimitInFreePlan.answer",defaultMessage:"<p>Upgrade to the Personal Pro Plan for unlimited guests, or the Team Plan if you collaborate with the same group of people automatically. You can also review and remove inactive guests in Settings & Members.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.teamTrial.question",defaultMessage:"How do I try out the Team Plan for free?"}),answer:r.a.createElement(g.a,{id:"faq.teamTrial.answer",defaultMessage:"<p>When asked how you would like to set up Notion during sign up, select Team, and you’ll be automatically enrolled in a Team Plan trial. You’ll get access to most features of a paid Team Plan, with a 1,000 block storage limit. If your team wants to add more than that, upgrade to the full Team Plan. Details above.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.overStorageLimitInFreePlan.question",defaultMessage:"What happens when I go over the block storage limit on my Team trial?"}),answer:r.a.createElement(g.a,{id:"faq.overStorageLimitInFreePlan.answer",defaultMessage:"<p>You can still read, edit, and organize existing content blocks as usual, but you won’t be able to add new content blocks.</p><p>However, you can delete existing content blocks to free up your storage.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.useNotionForFree.question",defaultMessage:"Can I use Notion for free?"}),answer:r.a.createElement(g.a,{id:"faq.useNotionForFree.answer",defaultMessage:"<p>Absolutely! Notion is free to use indefinitely.</p><p>The Personal Plan is completely free for individual use. The Team Plan has a free trial with a 1,000 block limit, more than enough to try out Notion with your team before upgrading.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.whatIsABlock.question",defaultMessage:"What is a block?"}),answer:r.a.createElement(g.a,{id:"faq.whatIsABlock.answer",defaultMessage:"<p>A block is any single piece of content you add to your page, like a paragraph of text, a to-do item, an image, a code block, an embedded file, etc. Think of your page as being made up of these building blocks.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.deleteBlocks.question",defaultMessage:"Can I delete blocks to free up my storage?"}),answer:r.a.createElement(g.a,{id:"faq.deleteBlocks.answer",defaultMessage:"<p>Of course! It works just like the storage limit on your phone or computer. If you delete something, you will free up space for more.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.studentDiscount.question",defaultMessage:"Do you offer student discounts?"}),answer:r.a.createElement(g.a,{id:"faq.studentDiscount.answer",defaultMessage:"<p>The Personal Pro Plan is free for students and educators. This lets you collaborate with unlimited guests and gives you version history. Simply sign up with your school email address and you’ll immediately gain access to these features.</p><p>If you’re already on a Personal Pro Plan, change the email associated with your account to your school email address to get it for free. If you're already on our free Education Plan, you've been automatically upgraded to the Personal Pro Plan.</p><p><helpcenterlink>Visit the help center to learn more</helpcenterlink></p>",values:{p:zt,helpcenterlink:Vt}})},{question:r.a.createElement(g.a,{id:"faq.howToEarnCredit.question",defaultMessage:"How do I earn credit?"}),answer:r.a.createElement(g.a,{id:"faq.howToEarnCredit.answer",defaultMessage:"<p>You can earn credit by using Notion across your devices and trying out new features. Go to the Earn Credit tab in Settings & Members to learn more.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.howToApplyCredit.question",defaultMessage:"How do I apply credit to my workspace?"}),answer:r.a.createElement(g.a,{id:"faq.howToApplyCredit.answer",defaultMessage:"<p>To apply credit, you must first upgrade to a paid plan. As part of this process, you can choose to apply some or all of your account credit to the plan.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.whyBillingInformation.question",defaultMessage:"Why do you need my billing information if I have enough credit to pay for Notion?"}),answer:r.a.createElement(g.a,{id:"faq.whyBillingInformation.answer",defaultMessage:"<p>We still require your billing information, even if you applied enough credit to make your first bill $0, because you may run out of credit in the future and we need to be able to charge your account.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.runOutOfCredit.question",defaultMessage:"What happens if I run out of credit?"}),answer:r.a.createElement(g.a,{id:"faq.runOutOfCredit.answer",defaultMessage:"<p>If you run out of credit, your account will be charged via your selected payment method.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.maximumEarnedCredit.question",defaultMessage:"Is there a maximum amount of credit I can earn?"}),answer:r.a.createElement(g.a,{id:"faq.maximumEarnedCredit.answer",defaultMessage:"<p>Yes, you can earn up to {maximumAmountInDollars} in credit.</p>",values:{p:zt,maximumAmountInDollars:Object(At.b)({amount:Ft.f,currency:"dollar",intl:b.a.getIntl()})}})},{question:r.a.createElement(g.a,{id:"faq.advancedPermissions.question",defaultMessage:"What advanced permissions does the paid Team & Enterprise Plans offer?"}),answer:r.a.createElement(g.a,{id:"faq.advancedPermissions.answer",defaultMessage:'<p>If you are on a free Team trial, you can set the access level on each page to "Full access," "Can view," or "Can comment." That dictates how other users can interact with that page. "Full access" means someone can edit, comment, and share the page with others.</p><p>On paid Team and Enterprise Plans, you have the ability to grant "Can edit" access to other users. This gives someone the ability to edit and comment on that page, but not share it with others. This is especially useful if you do not want your content leaking outside your team.</p><p><contactsales>Contact sales to learn more</contactsales></p>',values:{p:zt,contactsales:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return r.a.createElement(we.a,{onClick:()=>Ht(e,"faq","Advanced permissions")},n)}}})},{question:r.a.createElement(g.a,{id:"faq.teamAdminTools.question",defaultMessage:"What admin tools come with the Team Plan? "}),answer:r.a.createElement(g.a,{id:"faq.teamAdminTools.answer",defaultMessage:"<p>On a free Team trial, every member in your workspace is an admin. This means all of you can adjust team settings and invite other people into the workspace.</p><p>If you want only a few people to have admin abilities, we recommend upgrading to the full Team Plan. It comes with tools that allow you to make only select people admins while everyone else is a member. Members can't edit billing information or security options, and can't share your content outside the workspace.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.personalPricing.question",defaultMessage:"How is pricing calculated for the Personal Pro Plan?"}),answer:r.a.createElement(g.a,{id:"faq.personalPricing.answer",defaultMessage:"<p>If you upgrade your workspace to Personal Pro, you will be charged a flat fee ($5 monthly or $48 yearly).</p><p>Guests are free of charge, but they can only be added to one page at a time.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.teamPricing.question",defaultMessage:"How is pricing calculated for the Team Plan?"}),answer:r.a.createElement(g.a,{id:"faq.teamPricing.answer",defaultMessage:'<p>If you upgrade your workspace to the Team Plan, you will be charged a fee per member ($10 monthly or $96 yearly). For example, if you pay per month and have 5 members, you will be charged $50 each month.</p><p>Guests are free of charge – but they can only access individual pages they are invited to. In other words, guests won’t be able to see all the team pages under the "Workspace" section in the left sidebar.</p>',values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.monthlyAndYearlyBilling.question",defaultMessage:"Do you have monthly and yearly billing options?"}),answer:r.a.createElement(g.a,{id:"faq.monthlyAndYearlyBilling.answer",defaultMessage:"<p>Yes! We offer both monthly and yearly billing options. The yearly billing option is always cheaper (an estimated 20% discount). For example, the Team Plan is $10 per member per month when you choose the monthly option, but $8 per member per month if you choose to pay yearly.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.addingAndRemovingMembers.question",defaultMessage:"How does adding and removing members work?"}),answer:r.a.createElement(g.a,{id:"faq.addingAndRemovingMembers.answer",defaultMessage:"<p>Whether you're on a monthly or yearly billing schedule, your account may be charged on a monthly basis if you make these types of changes. If you added members, your account will be charged a prorated amount based on the percentage of the billing cycle left at the time each member was added. If you removed members, your account will be credited in the same way.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.changePlans.question",defaultMessage:"What happens when I change plans?"}),answer:r.a.createElement(g.a,{id:"faq.changePlans.answer",defaultMessage:"<p>Upgrading or downgrading your plan works similarly to adding and removing members. Your account will be charged or credited based on the percentage of the billing cycle left at the time the plan was changed.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.cancelPlan.question",defaultMessage:"How do I cancel my paid plan?"}),answer:r.a.createElement(g.a,{id:"faq.cancelPlan.answer",defaultMessage:'<p>Your Notion subscription, annual or monthly, will automatically renew until you cancel it. You can cancel your subscription by going to "Settings & Members" in the left-hand sidebar on a desktop computer, then selecting "Plans," then "Downgrade." After you cancel, you’ll still have access to all the paid features until the end of your billing cycle.</p><p><billingandpaymentlink>More on billing & payment here</billingandpaymentlink></p>',values:{p:zt,billingandpaymentlink:qt}})},{question:r.a.createElement(g.a,{id:"faq.paymentFailure.question",defaultMessage:"What happens if my payment fails? Like if my credit card expires?"}),answer:r.a.createElement(g.a,{id:"faq.paymentFailure.answer",defaultMessage:"<p>Your account email will be notified after each failed payment. Payments may be retried up to 4 times within the next month. After this, if the payment did not succeed, you will be downgraded to the free plan.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.changePaymentMethod.question",defaultMessage:"Can I change my payment method?"}),answer:r.a.createElement(g.a,{id:"faq.changePaymentMethod.answer",defaultMessage:"<p>You can change your payment method at any time in your billing settings.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.refund.question",defaultMessage:"How do refunds work?"}),answer:r.a.createElement(g.a,{id:"faq.refund.answer",defaultMessage:"<p>Our refund policy is simple. If you believe you've made a mistake signing up for a paid Notion subscription online or in-app, please contact us inside the app or email team@makenotion.com. We'll be happy to refund you the full amount (not pro-rated) if you downgrade your subscription within 72 hours of signing up for monthly billing, or within 30 days of signing up for annual billing.</p><p>And if for any reason you're unhappy with Notion, please let us know at team@makenotion.com — we'd love to hear your feedback, and will be happy to work with you to create the best experience possible.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.mandatoryRefund.question",defaultMessage:"What if I live in a region with a mandatory refund policy?"}),answer:r.a.createElement(g.a,{id:"faq.mandatoryRefund.answer",defaultMessage:"<p>If you live in the European Union, United Kingdom, or another region with a mandatory refund policy, you may be eligible for a monthly subscription refund past 72 hours. For example, customers in the European Union can receive a full refund for a monthly subscription within 14 days of purchase, rather than 72 hours.</p><p>To request a refund, please contact us inside the app or email team@makenotion.com. If you live in a region with a mandatory refund policy, please let us know and we'll be happy to assist you.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.serviceLevelAgreement.question",defaultMessage:"Do you have a Service-Level Agreement (SLA)?"}),answer:r.a.createElement(g.a,{id:"faq.serviceLevelAgreement.answer",defaultMessage:"<p>We do not offer a standard SLA. For teams with greater than 100 members, we can offer a custom SLA.</p><p><contactsales>Contact sales to learn more</contactsales></p>",values:{p:zt,contactsales:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return r.a.createElement(we.a,{onClick:()=>Ht(e,"faq","SLA")},n)}}})},{question:r.a.createElement(g.a,{id:"faq.importStorageLimit.question",defaultMessage:"How does importing content from another app affect my block storage limit if I'm on the Team Plan trial?"}),answer:r.a.createElement(g.a,{id:"faq.importStorageLimit.answer",defaultMessage:"<p>Content created via import doesn’t count toward your workspace’s storage limit. We want to make sure you get started with Notion as smoothly as possible.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.paymentProcessor.question",defaultMessage:"How is my payment being processed?"}),answer:r.a.createElement(g.a,{id:"faq.paymentProcessor.answer",defaultMessage:"<p>We use Stripe to process your payment. It’s the same payment provider used by products such as Twitter, Pinterest, and Lyft. We do not handle your credit card information directly.</p>",values:{p:zt}})},{question:r.a.createElement(g.a,{id:"faq.multipleTeams.question",defaultMessage:"Can I belong to multiple teams on Notion? "}),answer:r.a.createElement(g.a,{id:"faq.multipleTeams.answer",defaultMessage:"<p>Yes! You can use the same email address to create and join multiple teams. However, each one of these workspaces is on its own plan and needs to be upgraded individually.</p>",values:{p:zt}})}]}};class Yt extends F.a{constructor(){super(...arguments),this.renderFaqItem=(e,t)=>r.a.createElement(a.Fragment,{key:t},r.a.createElement("div",{style:Yt.questionStyle},e.question),r.a.createElement("div",{style:this.getAnswerStyle()},e.answer)),this.handleHelpButtonClick=()=>{Me.a({environment:this.environment,from:"pricing"})}}renderComponent(){return r.a.createElement("div",{style:{maxWidth:600}},this.getFaqList().map((e,t)=>this.renderFaqItem(e,t)),r.a.createElement("div",{style:{color:this.props.isSettings?this.theme.mediumTextColor:J.f.frontTextMedium}},this.props.cta?"intercom"===this.props.cta?this.renderIntercomCTA():this.renderGuidesCTA():null))}renderIntercomCTA(){var e=this;return r.a.createElement(g.a,{id:"faqList.moreQuestionsTextIntercom",defaultMessage:"Still have more questions? <messagelink>Send us a message</messagelink>",values:{messagelink:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return r.a.createElement(we.a,{onClick:e.handleHelpButtonClick},n)}}})}renderGuidesCTA(){return r.a.createElement(g.a,{id:"faqList.moreQuestionsTextHelpCenter",defaultMessage:"Still have more questions? Learn more in our <messagelink>help center</messagelink>.",values:{messagelink:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement(we.a,{href:Object(Be.a)("guides.guides")},t)}}})}getFaqList(){return Gt[this.props.type](this.environment)}getAnswerStyle(){return{color:this.props.isSettings?this.theme.mediumTextColor:J.f.frontTextMedium,marginBottom:"1.5rem",lineHeight:1.5}}}Yt.questionStyle={fontWeight:K.a.fontWeight.semibold,marginBottom:4};var Qt=Yt,Kt=n(761),Zt=n(236),Xt=n(1278),$t=n(751),Jt=n(797),en=n(41),tn=n(79);var nn={fontSize:{ui:{s:14,m:15},body:{s:15,m:17,l:20},title:{s:22,m:30,l:38,xl:50,xxl:74}},fontFamily:{sans:'inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"',handwriting:'permanent-marker, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"',mono:"iawriter-mono, Nitti, Menlo, Courier, monospace"},fontWeight:{regular:400,medium:500,bold:700},styles:{paragraph:{fontSize:17,lineHeight:1.5},smallCaps:{textTransform:"uppercase",fontSize:11,letterSpacing:.5,fontWeight:500}}};function an(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function rn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?an(Object(n),!0).forEach((function(t){sn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):an(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function sn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class on extends F.a{constructor(){super(...arguments),this.storeTypes={loginStore:$t.a,loginPermissionsStore:Xt.a},this.handleLoginClick=async()=>{const{email:e}=this.stores.loginStore.state;this.props.analyticsName&&m.V(this.environment,{from:this.props.analyticsName});const t=await l.m(this.environment,{email:e});if("failed"===t.type)return;const n=t.data;n.samlRedirect?u.n(this.environment,n.samlRedirect.redirectUrl):n.isGoogleAppsEmail?u.p({environment:this.environment,store:this.stores.loginStore,email:e,permissionsStore:this.stores.loginPermissionsStore}):n.hasPassword?(en.f({environment:this.environment,url:tn.d.login}),n.mustReverify?(await u.r({environment:this.environment,store:Zt.a,reverify:!0}),this.stores.loginStore.reset()):Zt.a.setState({loginType:"password",email:e,password:"",emailInputFocused:!1,alert:void 0})):(en.f({environment:this.environment,url:tn.d.signup}),Zt.a.setState({loginType:"email",email:e,password:"",emailInputFocused:!1}),await u.r({environment:this.environment,store:Zt.a}),this.stores.loginStore.reset())},this.handleInputChange=e=>{""===e.target.value&&this.stores.loginStore.reset(),this.stores.loginStore.setState(rn({},this.stores.loginStore.state,{email:e.target.value}))},this.handleInputFocus=e=>{this.stores.loginStore.setState(rn({},this.stores.loginStore.state,{emailInputFocused:!0}))},this.handleInputBlur=e=>{this.stores.loginStore.setState(rn({},this.stores.loginStore.state,{emailInputFocused:!1}))}}renderComponent(){const e=this.renderPlaceholderText();return r.a.createElement("div",{style:this.getWrapStyle()},r.a.createElement(z.b,{style:on.inputStyle,value:this.stores.loginStore.state.email,type:"email",format:z.b.Format.Large,autoFocus:!1,autoComplete:"off",placeholder:e,onSubmit:this.handleLoginClick,showClearButton:!0,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,onChange:this.handleInputChange}),r.a.createElement(Kt.a,{variant:this.props.buttonVariant?this.props.buttonVariant:"primary",style:{textAlign:"center",width:this.props.buttonWidth?this.props.buttonWidth:"auto"},onClick:this.handleLoginClick},this.props.buttonTitle||r.a.createElement(g.a,{id:"frontSignupComponent.submitButton.label",defaultMessage:"Sign up"})))}renderPlaceholderText(){const{persona:e,intl:t}=this.props,n=t.formatMessage({id:"frontSignupComponent.emailInput.genericEmailPlaceholder",defaultMessage:"Enter your email…"});switch(e){case"personal":return n;case"education":return t.formatMessage({id:"frontSignupComponent.emailInput.educationEmailPlaceholder",defaultMessage:"Enter your school email…"});case"team":return t.formatMessage({id:"frontSignupComponent.emailInput.teamEmailPlaceholder",defaultMessage:"Enter your work email…"});default:return n}}getWrapStyle(){return{width:"100%",maxWidth:this.props.maxWidth?this.props.maxWidth:320,display:"flex",alignItems:"center"}}}on.inputStyle={fontSize:nn.fontSize.ui.m,height:36,flex:1,background:J.f.white,boxShadow:Jt.a.frontInputShadow,marginRight:8};var ln=Object(g.g)(on),cn=n(20),dn=n(721);class un extends E.a{getInitialState(){return{termType:"yearly"}}}var pn=new un,mn=n(256);function hn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function gn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class bn extends F.a{renderComponent(){const e="yearly"===pn.state.termType?"monthly":"yearly";return r.a.createElement("div",{style:this.getTermToggleStyle(this.theme),onClick:()=>{m.Nb(this.environment,{from:"pricing_grid_top",toggle_to:e}),pn.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hn(Object(n),!0).forEach((function(t){gn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},pn.state,{termType:e}))}},r.a.createElement("div",{style:{marginRight:8}},this.props.isSettings?r.a.createElement(g.a,{id:"pricingGrid.pricingTermToggle.payAnnually.label",defaultMessage:"Pay annually"}):r.a.createElement(g.a,{id:"frontPricingPage.pricingTermToggle.payAnnually.label",defaultMessage:"Pay annually"})),r.a.createElement(mn.a,{on:"monthly"===pn.state.termType}),r.a.createElement("div",{style:{marginLeft:8}},this.props.isSettings?r.a.createElement(g.a,{id:"pricingGrid.pricingTermToggle.payMonthly.label",defaultMessage:"Monthly"}):r.a.createElement(g.a,{id:"frontPricingPage.pricingTermToggle.payMonthly.label",defaultMessage:"Pay monthly"})))}getTermToggleStyle(e){return{cursor:"pointer",fontSize:14,color:e.mediumTextColor,display:"flex",alignItems:"center",marginBottom:8}}}var fn=bn;var yn=function(e){return!!e.device.isMobile||e.WindowSizeStore.state.width<960};const Sn={s:620,m:940,l:1260};F.a;var vn=n(29),En=n(1245),Mn=n(96);function Cn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function On(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Cn(Object(n),!0).forEach((function(t){wn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const kn=["free","personal","team","enterprise"];class Pn extends F.a{willMount(e){const t=fe.o(e.data);t&&e.data&&pn.setState({termType:"year"===t.interval?"yearly":"monthly"})}renderComponent(){return r.a.createElement("div",null,r.a.createElement("table",{style:this.getTableStyle(this.props.isSettings)},this.props.isSettings&&this.renderHeader(),r.a.createElement("tbody",null,dn.e.map((e,t)=>this.renderSection(e,t))),!this.props.isSettings&&this.renderFooter()))}renderCheck(){return ye.a.thinCheck({display:"inline",height:this.props.isSettings?12:14,width:this.props.isSettings?12:14,color:this.theme.regularTextColor})}upgradeLink(e,t){const{planState:n}=this.props;if(n)return r.a.createElement(we.a,{onClick:n.plans[e].onClick,style:{fontSize:12,fontWeight:500,textDecoration:"none",color:this.theme.mediumTextColor,lineHeight:1.2}},t||r.a.createElement(g.a,{id:"pricingGrid.planAttribute.button.upgrade",defaultMessage:"Upgrade"}))}renderPlanContent(e){const{label:t,upgradeCta:n,upgradeCTALabel:i}=e;return t&&n?r.a.createElement(a.Fragment,null,t,r.a.createElement("br",null),this.upgradeLink(n,i)):t||(n?r.a.createElement(a.Fragment,null,r.a.createElement(g.a,{id:"pricingGrid.planAttribute.notInTrial",defaultMessage:"Not in trial"}),r.a.createElement("br",null),this.upgradeLink(n,i)):this.renderCheck())}renderPlan(e,t,n){return r.a.createElement("td",{style:On({},this.getRowStyle(this.theme),{},this.getValueStyle(),{},this.getActiveStyle(this.theme,this.isPlanActive(e)),{},this.getBorderStyle(e))},n.hasFeature&&r.a.createElement(st.a,{delayThreshold:0,placement:st.a.Placement.Right,renderTooltip:()=>Object(dn.f)(t),textWrap:!0,render:e=>r.a.createElement("div",Object.assign({style:{cursor:"help",lineHeight:1.3,padding:"6px 0"}},e),this.renderPlanContent(n))}))}renderItem(e,t){const n=this.props.isSettings?"auto":300,a=this.props.planState&&this.props.planState.isTeamTrial;return r.a.createElement("tr",{key:"table-row-".concat(t)},r.a.createElement("td",{style:On({},this.getRowStyle(this.theme),{},this.getRowLabelStyle(this.theme),{width:n,maxWidth:n,minWidth:n})},r.a.createElement(st.a,{delayThreshold:0,placement:st.a.Placement.Right,renderTooltip:()=>Object(dn.f)(e.tooltip),textWrap:!0,render:t=>r.a.createElement("span",Object.assign({},t,{style:this.getTooltipInnerStyle(this.theme)}),e.label,e.isComingSoon&&this.renderComingSoonBadge())})),kn.map(t=>{const n="team"===t&&a?"teamTrial":t;return this.renderPlan(t,e.tooltip,e.plans[n])}))}renderEmptyTableCell(e,t){return r.a.createElement("td",{style:On({},this.getSectionStyle(this.theme,t),{},this.getValueStyle(),{},this.getActiveStyle(this.theme,this.isPlanActive(e)),{},this.getBorderStyle(e),{color:J.f.lightTextColor,fontWeight:400})},!this.props.isSettings&&this.getPlanName(e))}renderEmptyTableCells(e){return r.a.createElement(a.Fragment,null,kn.map(t=>this.renderEmptyTableCell(t,e)))}renderSection(e,t){const n=this.props.isSettings?"auto":300;return r.a.createElement(a.Fragment,{key:"table-section-".concat(t)},r.a.createElement("tr",null,r.a.createElement("td",{style:On({},this.getSectionStyle(this.theme,t),{width:n,maxWidth:n,minWidth:n})},e.label),this.renderEmptyTableCells(t)),e.items.map((e,t)=>this.renderItem(e,t)))}renderButton(e,t){const n=t.plans[e],a="notion-pricing-grid-upgrade-".concat(e);let i;switch(n.buttonType){case"current":i=r.a.createElement(g.a,{id:"pricingGrid.currentPlanButton.label",defaultMessage:"Current"});break;case"upgrade":i=r.a.createElement(g.a,{id:"pricingGrid.upgradePlanButton.label",defaultMessage:"Upgrade"});break;case"downgrade":i=r.a.createElement(g.a,{id:"pricingGrid.downgradePlanButton.label",defaultMessage:"Downgrade"});break;case"will-downgrade":i=r.a.createElement(g.a,{id:"pricingGrid.willDowngradePlanButton.label",defaultMessage:"Future plan"});break;case"resubscribe":i=r.a.createElement(g.a,{id:"pricingGrid.resubscribePlanButton.label",defaultMessage:"Resubscribe"});break;default:vn.e(n.buttonType)}if("current"===n.buttonType)return this.renderDisabledButtonWithTooltip({tooltip:r.a.createElement(g.a,{id:"pricingGrid.currentPlan.tooltip",defaultMessage:"This is your current active plan"}),label:r.a.createElement(g.a,{id:"pricingGrid.currentPlan.largeScreenLabel",defaultMessage:"Current plan"}),buttonClassName:a,wrapTooltip:!1});if(!t.canSwitchPlans){let e;return e=t.isInAppPurchase?r.a.createElement(g.a,{id:"pricingGrid.switchPlanFromInAppPurchase.tooltip",defaultMessage:"You're currently subscribed through an in-app purchase with Apple. To switch plans, cancel your subscription with Apple first."}):r.a.createElement(g.a,{id:"pricingGrid.switchPlanAsMember.tooltip",defaultMessage:"You need to be an administrator of this workspace to switch plans."}),this.renderDisabledButtonWithTooltip({tooltip:e,label:i,buttonClassName:a,wrapTooltip:!0})}return("personal"===e||"free"===e)&&t.memberCount>1?this.renderDisabledButtonWithTooltip({tooltip:r.a.createElement(g.a,{id:"pricingGrid.switchToPersonalPlanButton.tooltip",defaultMessage:"The Personal and Personal Pro Plans are only available for 1-person use. If you'd like to use these plans, please remove the other members in this workspace."}),label:i,buttonClassName:a,wrapTooltip:!0}):"will-downgrade"===n.buttonType?this.renderDisabledButtonWithTooltip({tooltip:r.a.createElement(g.a,{id:"pricingGrid.willDowngradePlan.tooltip",defaultMessage:"This is the plan after your current plan expires"}),label:r.a.createElement(g.a,{id:"pricingGrid.willDowngradePlan.largeScreenLabel",defaultMessage:"Future plan"}),buttonClassName:a,wrapTooltip:!1}):"downgrade"===n.buttonType?r.a.createElement(te.a,{isLarge:!0,style:{width:"100%"},onClick:()=>{m.rd(this.environment,{plan:e,from:"pricing_grid_top",button_text:n.buttonType}),n.onClick()},className:a},i):r.a.createElement(ee.a,{isLarge:!0,style:{width:"100%"},onClick:()=>{m.rd(this.environment,{plan:e,from:"pricing_grid_top",button_text:n.buttonType}),n.onClick()},className:a},i)}renderDisabledButtonWithTooltip(e){const{tooltip:t,label:n,buttonClassName:a,wrapTooltip:i}=e;return r.a.createElement(st.a,{style:{width:i?320:"auto"},textWrap:i,renderTooltip:()=>t,render:e=>r.a.createElement(te.a,Object.assign({style:{width:"100%",opacity:.5},isLarge:!0,disabled:!0},e,{className:a}),n)})}renderSalesContactLink(){return r.a.createElement(we.a,{onClick:()=>{const{currentUserStore:e}=p.a.state,t=e&&e.getValue();m.W(this.environment),En.a.setState({open:!0,email:t&&t.email,name:t&&Object(Mn.d)(this.props.intl,t)})}},r.a.createElement("div",{style:this.getUpgradeButtonBelowLinkStyle()},r.a.createElement(g.a,{id:"pricingGrid.contactSalesLink",defaultMessage:"Contact sales"})))}renderTeamTrialIndicator(){return r.a.createElement(st.a,{delayThreshold:0,placement:st.a.Placement.Bottom,renderTooltip:()=>r.a.createElement(g.a,{id:"pricingGrid.inTeamTrial.tooltip",defaultMessage:"Your current Team trial has a 1,000 block limit. Upgrade to go unlimited."}),textWrap:!0,style:{width:280},render:e=>r.a.createElement("div",Object.assign({style:On({},this.getUpgradeButtonBelowLinkStyle(),{fontWeight:500,display:"flex",flexDirection:"row",cursor:"help"})},e),r.a.createElement("div",{style:{paddingRight:4,paddingTop:2}},this.renderCheck()),r.a.createElement("div",null,r.a.createElement(g.a,{id:"pricingGrid.inTeamTrial",defaultMessage:"In free trial"})))})}renderTeamTrialButton(e){if(e.isActive&&"resubscribe"===e.buttonType)return;const t="current"===e.buttonType?r.a.createElement(g.a,{id:"pricingGrid.cancelPlanLink",defaultMessage:"Cancel plan"}):r.a.createElement(g.a,{id:"pricingGrid.teamTrialLink",defaultMessage:"Try for free"});return r.a.createElement(we.a,{onClick:e.onClickTeamFree},r.a.createElement("div",{style:this.getUpgradeButtonBelowLinkStyle()},t))}getPlanName(e){const{intl:t}=this.props;switch(e){case"free":return t.formatMessage({id:"pricingGrid.personalFreePlanColumn.header",defaultMessage:"Personal"});case"personal":return t.formatMessage({id:"pricingGrid.personalProPlanColumn.header",defaultMessage:"Personal Pro"});case"team":return t.formatMessage({id:"pricingGrid.teamPlanColumn.header",defaultMessage:"Team"});case"enterprise":return t.formatMessage({id:"pricingGrid.enterprisePlanColumn.header",defaultMessage:"Enterprise"});default:vn.e(e)}}renderHeaderTitle(e){const t=this.getPlanName(e.plan);return r.a.createElement("td",{style:On({},this.getHeaderStyle(),{},this.getActiveStyle(this.theme,this.isPlanActive(e.plan)),{},this.getBorderStyle(e.plan))},!this.props.isSettings&&r.a.createElement("img",{style:{height:80,marginBottom:-5},src:e.image,alt:t}),r.a.createElement("div",{style:this.getHeaderTitleStyle()},t),void 0!==e.price&&r.a.createElement("div",{style:{display:yn(this.environment)?"block":"flex"}},r.a.createElement("div",{style:this.getHeaderPriceStyle()},e.price),void 0!==e.terms&&r.a.createElement("div",{style:this.getHeaderTermsStyle(this.theme)},Object(dn.c)(this.props.intl,e.terms))),!this.props.isSettings&&"enterprise"===e.plan&&r.a.createElement("div",{style:{height:30}},this.renderSalesContactLink()))}renderHeaderLabels(){const e=this.isPlanActive("team")||this.isPlanActive("enterprise");return r.a.createElement("tr",null,r.a.createElement("td",{style:{width:"28%"}}),r.a.createElement("td",{style:On({},this.getHeaderLabelStyle(!e),{},this.getBorderStyle("free"),{borderLeft:this.props.isSettings?"1px solid ".concat(this.theme.lightDividerColor):void 0}),colSpan:2},r.a.createElement(g.a,{id:"pricingGrid.personalPlans.label",defaultMessage:"For individuals"})),r.a.createElement("td",{style:On({},this.getHeaderLabelStyle(e),{},this.getBorderStyle("enterprise")),colSpan:2},r.a.createElement(g.a,{id:"pricingGrid.teamPlans.label",defaultMessage:"For teams & businesses"})))}renderHeaderTitles(){const e=pn.state.termType,t=Object(dn.d)(W.a,this.props.intl);return r.a.createElement("tr",null,r.a.createElement("td",null),this.renderHeaderTitle({plan:"free",price:t.price[e].personal,image:cn.a.front.pricing.pricingFreeV2Png}),this.renderHeaderTitle({plan:"personal",price:t.price[e].pro,image:cn.a.front.pricing.pricingPersonalV2Png,terms:t.terms.pro}),this.renderHeaderTitle({plan:"team",price:t.price[e].team,image:cn.a.front.pricing.pricingTeamV2Png,terms:t.terms.team}),this.props.isSettings?this.renderHeaderTitle({plan:"enterprise",price:t.price[e].enterprise,image:cn.a.front.pricing.pricingEnterpriseV2Png,terms:t.terms.enterprise}):this.renderHeaderTitle({plan:"enterprise",image:cn.a.front.pricing.pricingEnterpriseV2Png}))}renderHeaderAction(e){const{planState:t}=this.props;if(t)return r.a.createElement("td",{style:On({},this.getHeaderStyle(),{},this.getActiveStyle(this.theme,this.isPlanActive(e)),{},this.getBorderStyle(e))},this.renderButton(e,t),this.renderHeaderSubAction(e))}renderHeaderSubAction(e){if("enterprise"===e)return r.a.createElement("div",{style:{marginTop:7}},this.renderSalesContactLink());if("team"===e){const{planState:t}=this.props;if(!t||!t.canSwitchPlans||t.plans.personal.isActive)return;return r.a.createElement("div",{style:{marginTop:7}},t.isTeamTrial?this.renderTeamTrialIndicator():this.renderTeamTrialButton(t.plans[e]))}}renderHeaderActions(){if(this.props.isSettings&&this.props.planState)return r.a.createElement("tr",null,r.a.createElement("td",{style:{width:"28%",verticalAlign:"top",paddingTop:16}},r.a.createElement(fn,{isSettings:this.props.isSettings})),kn.map(e=>this.renderHeaderAction(e)))}renderHeader(){return r.a.createElement("thead",null,this.renderHeaderLabels(),this.renderHeaderTitles(),this.renderHeaderActions())}renderStandardCTA(){return r.a.createElement(ln,{buttonTitle:r.a.createElement(g.a,{id:"pricingGrid.signupComponent.submitButton.label",defaultMessage:"Try it free"}),analyticsName:"pricing_grid_bottom",buttonWidth:100,persona:"personal"})}renderEnterpriseCTA(){return r.a.createElement(Kt.a,{variant:"secondary",isFullWidth:!0,onClick:()=>{Nt({environment:this.environment,typeform:"enterpriseTrial",frontContext:"pricing_grid_bottom",params:{source:"pricing_grid_bottom"}})}},r.a.createElement(g.a,{defaultMessage:"Try Enterprise",id:"pricingGrid.enterpriseCallToAction.message"}))}renderCTAs(){return r.a.createElement(a.Fragment,null,r.a.createElement("td",{colSpan:3,style:On({},this.getCTACellStyle())},r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-start",width:"100%"}},this.renderStandardCTA())),r.a.createElement("td",{style:On({},this.getCTACellStyle())},this.renderEnterpriseCTA()))}renderFooter(){return r.a.createElement("tfoot",null,r.a.createElement("tr",null,r.a.createElement("td",{style:{verticalAlign:"middle",fontWeight:500}},r.a.createElement(g.a,{defaultMessage:"Sign up for free.{br}Add your team later.",id:"pricingGrid.footerSignupCallToAction.message",values:{br:r.a.createElement("br",null)}})),this.renderCTAs()))}renderComingSoonBadge(){return r.a.createElement("div",{style:{background:this.theme.buttonHoveredBackground,fontSize:10,fontWeight:500,letterSpacing:"0.015em",color:this.theme.mediumTextColor,display:"inline",textTransform:"uppercase",padding:"2px 4px",marginLeft:6,borderRadius:3,whiteSpace:"nowrap"}},r.a.createElement(g.a,{id:"pricingGrid.comingSoonBadge",defaultMessage:"Coming soon"}))}isPlanActive(e){return!(!this.props.planState||!this.props.planState.plans[e].isActive)}getTableStyle(e){return{fontSize:e?14:16,width:e?"100%":Sn.m,tableLayout:"fixed",borderCollapse:"initial"}}getSectionStyle(e,t){const n={borderBottom:"1px solid ".concat(e.regularDividerColor),paddingBottom:7,paddingRight:15,fontWeight:500,verticalAlign:"bottom"};return On({},n,0===t?{paddingTop:this.props.isSettings?0:54}:{paddingTop:this.props.isSettings?20:42})}getUpgradeButtonBelowLinkStyle(){return{fontSize:this.props.isSettings?12:14}}getRowStyle(e){return{borderBottom:"1px solid ".concat(e.regularDividerColor)}}getRowLabelStyle(e){const t=(this.props.isSettings,5);return{color:e.mediumTextColor,paddingRight:10,paddingTop:t,paddingBottom:t+1,verticalAlign:"top"}}getCTACellStyle(){return{padding:"20px 15px"}}getValueStyle(){const e=this.props.isSettings?10:15;return{paddingLeft:e,paddingRight:e,textAlign:"left",overflow:"hidden",verticalAlign:"top"}}getActiveStyle(e,t){return{background:t?e.sidebarBackground:J.f.transparent}}getBorderStyle(e){return{borderLeft:this.props.isSettings?"1px solid ".concat(this.theme.lightDividerColor):void 0,borderRight:this.props.isSettings&&["enterprise"].includes(e)?"1px solid ".concat(this.theme.lightDividerColor):void 0}}getHeaderLabelStyle(e){const t=this.props.isSettings?10:15;return{paddingLeft:t,paddingRight:t,verticalAlign:"top",width:"36%",paddingTop:this.props.isSettings?10:0,fontWeight:700,fontSize:12,paddingBottom:10,borderBottom:e?"2px solid ".concat(this.theme.regularTextColor):"1px solid ".concat(this.theme.lightDividerColor),borderTop:"1px solid ".concat(this.theme.lightDividerColor)}}getHeaderStyle(){const e=this.props.isSettings?10:15;return{paddingLeft:e,paddingRight:e,verticalAlign:"top",width:"18%",paddingTop:this.props.isSettings?10:0}}getHeaderTitleStyle(){return{fontSize:this.props.isSettings?16:25,fontWeight:this.props.isSettings&&yn(this.environment)?500:700,lineHeight:1.3,marginBottom:2}}getHeaderPriceStyle(){return{fontSize:this.props.isSettings?20:25,marginRight:7}}getTooltipInnerStyle(e){return{cursor:"help",width:"100%",display:"inline-block"}}getHeaderTermsStyle(e){return{fontSize:this.props.isSettings?10:12,lineHeight:1,color:e.mediumTextColor,width:70,paddingTop:this.props.isSettings?yn(this.environment)?0:3:5}}}var Tn=Object(g.g)(Pn);const In=["not_using_enough","too_difficult","trial_over","too_expensive","security_compliance_requirements","company_shutting_down","upgraded_by_mistake","using_alternative","missing_features","other"],jn=["google_drive_docs","asana","trello","microsoft_office","atlassian_confluence","atlassian_jira","airtable","coda","dropbox_paper","quip","evernote","other"];class Dn extends E.a{getInitialState(){return{reasons:[],reasonMissingFeatures:"",reasonOther:"",alternatives:[],alternativeOther:"",otherFeedback:""}}}var xn=Dn,Bn=n(315),An=n(69);function Fn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Rn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fn(Object(n),!0).forEach((function(t){Ln(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ln(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Un=Object(g.f)({missingFeaturesPlaceholder:{id:"churnSurveyMenu.reasons.missingFeaturesPlaceholder",defaultMessage:"Let us know which features are missing..."},reasonOtherPlaceholder:{id:"churnSurveyMenu.reasons.reasonOtherPlaceholder",defaultMessage:"Tell us more..."},alternativeOtherPlaceholder:{id:"churnSurveyMenu.alternatives.alternativeOtherPlaceholder",defaultMessage:"Tell us more..."},otherFeedbackPlaceholder:{id:"churnSurveyMenu.other.otherFeedbackPlaceholder",defaultMessage:"Our team will review your feedback to make Notion better."}});class _n extends F.a{constructor(){super(...arguments),this.shuffledReasons=[...s.a.shuffle(s.a.without(In,"other")),"other"],this.shuffledAlternatives=[...s.a.shuffle(s.a.without(jn,"other")),"other"],this.storeTypes={store:xn},this.handleAccept=()=>{Object(m.w)(this.environment,this.stores.store.state),this.props.onAccept()}}renderComponent(){var e=this;const{churnType:t,onClose:n,periodEnd:a}=this.props,{store:i}=this.stores,{reasons:o,reasonMissingFeatures:l,reasonOther:c,alternatives:d,alternativeOther:u,otherFeedback:p}=i.state,m=Object(An.a)(a).format("LL");return r.a.createElement("div",{style:{fontSize:14}},r.a.createElement("div",{style:{display:"flex",fontSize:14,padding:24,paddingBottom:20,borderBottom:"1px solid ".concat(this.theme.lightDividerColor)}},r.a.createElement("div",null,r.a.createElement("h3",{style:_n.headerStyle},"personal"===t?r.a.createElement(g.a,{id:"churnSurveyMenu.header.personal.title",defaultMessage:"Downgrade to Personal"}):r.a.createElement(g.a,{id:"churnSurveyMenu.header.team.title",defaultMessage:"Downgrade to Team Trial"})),r.a.createElement("p",{style:{lineHeight:1.4,margin:"8px 0 12px"}},r.a.createElement(g.a,{id:"churnSurveyMenu.header.description",defaultMessage:"Notion is constantly improving. Before you downgrade, we’d love your input to help us make Notion better for everyone. Thank you for your feedback."})),r.a.createElement(te.a,{onClick:n},r.a.createElement(g.a,{id:"churnSurveyMenu.goBackButton.title",defaultMessage:"Back to Plans"}))),r.a.createElement("div",{style:{alignSelf:"center",padding:"0px 8px"}},r.a.createElement("img",{src:cn.a.images.downgradeFeedbackPng,style:{filter:this.theme.illustrationFilter},width:160}))),r.a.createElement("div",{style:{padding:"8px 12px",margin:"20px 24px 12px 24px",background:this.theme.sidebarBackground,borderRadius:3}},r.a.createElement(g.a,{id:"churnSurveyMenu.header.covidMessage",defaultMessage:"💛 If you are impacted by COVID-19, <contactuslink>contact us</contactuslink> for assistance.",values:{contactuslink:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return r.a.createElement(we.a,{onClick:()=>{Object(Me.a)({environment:e.environment,from:"churn_survey"})}},n)}}})),r.a.createElement("div",{style:_n.surveySectionStyle},r.a.createElement("h4",{style:_n.subheaderStyle},r.a.createElement(g.a,{id:"churnSurveyMenu.reasons.title",defaultMessage:"1. What are your reasons for downgrading?"})),r.a.createElement("div",{style:this.getDescriptionStyle()},r.a.createElement(g.a,{id:"churnSurveyMenu.reasons.description",defaultMessage:"Please select one or more"})),this.shuffledReasons.map(e=>{const t=o.includes(e);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{key:e,style:_n.optionRowStyle,onClick:()=>{i.setState(Rn({},i.state,{reasons:t?s.a.without(o,e):[...o,e]}))}},r.a.createElement(Bn.a,{checked:t,size:14}),r.a.createElement("span",{style:{marginLeft:4}},this.renderMessageForReason(e))),"missing_features"===e&&t&&r.a.createElement(z.b,{style:_n.inlineInputStyle,autoFocus:!0,value:l,placeholder:b.a.formatMessage(Un.missingFeaturesPlaceholder),onChange:e=>{i.setState(Rn({},i.state,{reasonMissingFeatures:e.target.value}))}}),"other"===e&&t&&r.a.createElement(z.b,{style:_n.inlineInputStyle,autoFocus:!0,value:c,placeholder:b.a.formatMessage(Un.reasonOtherPlaceholder),onChange:e=>{i.setState(Rn({},i.state,{reasonOther:e.target.value}))}}))})),r.a.createElement("div",{style:_n.surveySectionStyle},r.a.createElement("h4",{style:_n.subheaderStyle},r.a.createElement(g.a,{id:"churnSurveyMenu.alternatives.title",defaultMessage:"2. What tools are you using instead?"})),r.a.createElement("div",{style:this.getDescriptionStyle()},r.a.createElement(g.a,{id:"churnSurveyMenu.alternatives.description",defaultMessage:"Please select one or more"})),this.shuffledAlternatives.map(e=>{const t=d.includes(e);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{key:e,style:_n.optionRowStyle,onClick:()=>{i.setState(Rn({},i.state,{alternatives:t?s.a.without(d,e):[...d,e]}))}},r.a.createElement(Bn.a,{checked:t,size:14}),r.a.createElement("span",{style:{marginLeft:4}},this.renderMessageForAlternative(e))),"other"===e&&t&&r.a.createElement(z.b,{style:_n.inlineInputStyle,autoFocus:!0,value:u,placeholder:b.a.formatMessage(Un.alternativeOtherPlaceholder),onChange:e=>{i.setState(Rn({},i.state,{alternativeOther:e.target.value}))}}))})),r.a.createElement("div",{style:_n.surveySectionStyle},r.a.createElement("h4",{style:_n.subheaderStyle},r.a.createElement(g.a,{id:"churnSurveyMenu.otherFeedback.title",defaultMessage:"3. Any other feedback for us?"})),r.a.createElement(z.b,{textarea:!0,style:{marginTop:4},value:p,placeholder:b.a.formatMessage(Un.otherFeedbackPlaceholder),onChange:e=>{i.setState(Rn({},i.state,{otherFeedback:e.target.value}))}})),r.a.createElement("div",{style:{padding:"20px 24px",marginTop:20,borderTop:"1px solid ".concat(this.theme.lightDividerColor)}},r.a.createElement("h4",{style:_n.subheaderStyle},r.a.createElement(g.a,{id:"churnSurveyMenu.continueDowngrade.title",defaultMessage:"Continue downgrade?"})),r.a.createElement("p",{style:{margin:"4px 0 20px",lineHeight:1.4}},"personal"===t?r.a.createElement(g.a,{id:"churnSurveyMenu.continueDowngrade.downgradeMessage.personal",defaultMessage:"If you cancel now, you'll still enjoy all the features of your paid plan until {periodEnd}. You can resubscribe or switch to another paid plan anytime.{br}After {periodEnd}, this workspace will be downgraded to the free Personal plan, with these restrictions: <li>Single-person use</li><li>Guest limit of 5 per workspace</li><li>Upload files up to 5 MB</li><li>No version history</li><li>No member shared workspace</li>",values:{periodEnd:r.a.createElement("span",{style:{fontWeight:600}},m),br:r.a.createElement("div",{style:{height:8}}),li:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement("ul",{style:_n.restrictionListItemStyle},r.a.createElement("li",null,t))}}}):r.a.createElement(g.a,{id:"churnSurveyMenu.continueDowngrade.downgradeMessage.team",defaultMessage:"If you cancel now, you'll still enjoy all the features of your paid plan until {periodEnd}. You can resubscribe or switch to another paid plan anytime.{br}After {periodEnd}, this workspace will be downgraded to a free trial of the Team Plan, with these restrictions: <li>1,000 block limit</li><li>Upload files up to 5 MB</li><li>No version history</li><li>No bulk exports</li><li>No advanced permissions</li><li>No permission groups</li>",values:{periodEnd:r.a.createElement("span",{style:{fontWeight:600}},m),br:r.a.createElement("div",{style:{height:8}}),li:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement("ul",{style:_n.restrictionListItemStyle},r.a.createElement("li",null,t))}}})),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(te.a,{isRed:!0,onClick:this.handleAccept},r.a.createElement(g.a,{id:"churnSurveyMenu.downgradeButton.title",defaultMessage:"Downgrade"})),r.a.createElement(te.a,{onClick:n,style:{marginLeft:12}},r.a.createElement(g.a,{id:"churnSurveyMenu.cancelButton.title",defaultMessage:"Cancel"})))))}renderMessageForReason(e){return"not_using_enough"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.reasons.notUsingEnough",defaultMessage:"Not using it enough"}):"too_difficult"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.reasons.toDifficult",defaultMessage:"Too difficult to use"}):"trial_over"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.reasons.trialOver",defaultMessage:"Trial is over"}):"too_expensive"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.reasons.tooExpensive",defaultMessage:"Too expensive"}):"security_compliance_requirements"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.reasons.securityComplianceRequirements",defaultMessage:"Security or compliance requirements"}):"company_shutting_down"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.reasons.companyShuttingDown",defaultMessage:"Company is shutting down or making cuts"}):"upgraded_by_mistake"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.reasons.upgradedByMistake",defaultMessage:"Upgraded by mistake"}):"using_alternative"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.reasons.usingAlternative",defaultMessage:"Using an alternative"}):"missing_features"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.reasons.missingFeatures",defaultMessage:"Missing features"}):"other"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.reasons.other",defaultMessage:"Other"}):void Object(vn.e)(e)}renderMessageForAlternative(e){return"google_drive_docs"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.alternatives.googleDriveDocs",defaultMessage:"Google Drive / Docs"}):"asana"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.alternatives.asana",defaultMessage:"Asana"}):"trello"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.alternatives.trello",defaultMessage:"Trello"}):"microsoft_office"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.alternatives.microsoftOffice",defaultMessage:"Microsoft 365 / Office"}):"atlassian_confluence"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.alternatives.atlassianConfluence",defaultMessage:"Confluence"}):"atlassian_jira"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.alternatives.atlassianJira",defaultMessage:"Jira"}):"airtable"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.alternatives.airtable",defaultMessage:"Airtable"}):"coda"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.alternatives.coda",defaultMessage:"Coda"}):"dropbox_paper"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.alternatives.dropboxPaper",defaultMessage:"Dropbox Paper"}):"quip"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.alternatives.quip",defaultMessage:"Quip"}):"evernote"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.alternatives.evernote",defaultMessage:"Evernote"}):"other"===e?r.a.createElement(g.a,{id:"churnSurveyMenu.alternatives.other",defaultMessage:"Other"}):void Object(vn.e)(e)}getDescriptionStyle(){return{margin:0,color:this.theme.mediumTextColor,marginBottom:8}}}_n.optionRowStyle={display:"flex",alignItems:"center",cursor:"pointer",marginBottom:4},_n.restrictionListItemStyle={paddingLeft:20,margin:"6px 0"},_n.surveySectionStyle={padding:"8px 24px"},_n.headerStyle={margin:0,marginBottom:8},_n.subheaderStyle={margin:0,marginTop:8,fontSize:16,fontWeight:600},_n.inlineInputStyle={marginBottom:12,marginLeft:18,width:"calc(100% - 18px)"};var Wn=_n,Nn=n(1354);function zn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Vn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zn(Object(n),!0).forEach((function(t){qn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Hn extends F.a{constructor(){super(...arguments),this.storeTypes={store:Bt},this.renderChurnSurveyModal=()=>{const e=this.stores.store.state,{data:t}=this.props,n=fe.o(t),a=fe.i(this.environment);if(e.churnSurveyModalOpen&&a&&n)return r.a.createElement(Wn,{churnType:e.churnType,periodEnd:n.periodEnd,onAccept:this.handleChurnSurveyModalAccept,onClose:this.handleChurnSurveyModalClose})},this.handleFreeClick=async()=>{const{data:e}=this.props;if(e&&"subscribed_admin"===e.type){const e=await new Promise(e=>{const{store:t}=this.stores;t.setState({churnType:"personal",churnSurveyModalOpen:!0,onAccept:()=>e(!0),onClose:()=>e(!1)})});if(!e)return;e&&await v.a({environment:this.environment,spaceStore:this.props.spaceStore,planType:"personal"})}else if(e&&("unsubscribed_admin"===e.type||"unsubscribed_member"===e.type)){await new Promise((e,t)=>{d.c({showCancel:!0,keepFocus:!1,message:r.a.createElement("div",null,r.a.createElement("h4",{style:{margin:"8px 0 0"}},r.a.createElement(g.a,{id:"subscriptSettings.freePersonal.downgradeTitle",defaultMessage:"Downgrade to the Personal Plan?"})),r.a.createElement("p",{style:{margin:"8px 0"}},r.a.createElement(g.a,{id:"subscriptionSettings.freePersonal.downgradeMessage",defaultMessage:"The Personal Plan is free for 1-person use. You'll lose the ability to add members, and guests will be limited to 5 per workspace."}))),items:[{label:r.a.createElement(g.a,{id:"subscriptionSettings.freePersonal.downgradeConfirmationButton",defaultMessage:"Downgrade to Personal Plan"}),color:"red",onAccept:()=>{e(!0)}}],handleCancel:()=>{e(!1)}})})&&await v.a({environment:this.environment,spaceStore:this.props.spaceStore,planType:"personal"})}},this.handlePersonalClick=async()=>{const{spaceStore:e,data:t}=this.props,n=fe.o(t);if(n&&fe.H(t)){const t=jt.c.personal[n.interval];await v.h({environment:this.environment,spaceStore:e,plan:t,billing:n.billing})}else v.d(this.environment,{subscriptionTier:"personal",from:"pricing_grid"})},this.handleEducationPlanClick=()=>{const{spaceStore:e}=this.props;v.i({environment:this.environment,spaceStore:e})},this.handleTeamClick=async()=>{const{spaceStore:e,data:t}=this.props,n=fe.o(t),a=n&&void 0===n.canceledAt;let i;if(n&&a&&"enterprise"!==fe.i(this.environment)&&(i=this.props.intl.formatMessage({id:"spaceSubscriptionPlans.teamPlan.confirmMessage",defaultMessage:"You are about to subscribe to Notion's Team Plan for {price} per member per {monthlyBilling, select, true {month} other {year}}.{br}You will be charged a prorated amount, minus any account balance."},{price:fe.j({subscriptionTier:"team",billingInterval:n.interval,intl:this.props.intl}),monthlyBilling:"month"===n.interval,br:r.a.createElement("br",null)})),i){const e="unsubscribed_admin"===t.type||"unsubscribed_member"===t.type||n&&n.canceledAt||"enterprise"!==fe.i(this.environment);if(!(await d.a({message:i,acceptLabel:this.props.intl.formatMessage({id:"spaceSubscriptionPlans.teamPlan.confirmButtonLabel",defaultMessage:"{upgrading, select, true {Upgrade to Team Plan} other {Downgrade to Team Plan}}"},{upgrading:e})})))return}if(n&&fe.H(t)){const t=jt.c.team[n.interval];await v.h({environment:this.environment,spaceStore:e,plan:t,billing:n.billing})}else v.d(this.environment,{subscriptionTier:"team",from:"pricing_grid"})},this.handleTeamFreeClick=async()=>{const{data:e}=this.props;if(e&&"subscribed_admin"===e.type){const e=await new Promise(e=>{const{store:t}=this.stores;t.setState({churnType:"team",churnSurveyModalOpen:!0,onAccept:()=>e(!0),onClose:()=>e(!1)})});if(m.G(this.environment,{confirmed:e}),!e)return;e&&await v.a({environment:this.environment,spaceStore:this.props.spaceStore,planType:"team"})}else if(e&&("unsubscribed_admin"===e.type||"unsubscribed_member"===e.type)){const e=await new Promise((e,t)=>{d.c({showCancel:!0,keepFocus:!1,message:r.a.createElement("div",null,r.a.createElement("h4",{style:{margin:"8px 0 0"}},r.a.createElement(g.a,{id:"subscriptionSettings.freeTeam.upgradeTitle",defaultMessage:"Try the Team Plan for free"})),r.a.createElement("p",{style:{margin:"8px 0"}},r.a.createElement(g.a,{id:"subscriptionSettings.freeTeam.upgradeMessage",defaultMessage:"You'll get access to most features of a paid Team Plan, with a 1,000 block storage limit. Upgrade to go unlimited anytime."}))),items:[{label:r.a.createElement(g.a,{id:"subscriptionSettings.startTeamTrialDialog.confirmationbutton",defaultMessage:"Start Team trial"}),color:"blue",onAccept:()=>{e(!0)}}],handleCancel:()=>{e(!1)}})});if(m.H(this.environment,{confirmed:Boolean(e)}),!e)return;e&&await v.a({environment:this.environment,spaceStore:this.props.spaceStore,planType:"team"})}},this.handleEnterpriseClick=async()=>{const{spaceStore:e,data:t}=this.props,n=fe.o(t),a=n&&void 0===n.canceledAt;if(n&&a){const e=r.a.createElement(g.a,{id:"subscriptionSettings.upgradeToEnterpriseDialog.message",defaultMessage:"You are about to subscribe to Notion's Enterprise Plan for {price} per member per {monthlyBilling, select, true {month} other {year}}.{br}You will be charged a prorated amount, minus any account balance.",values:{price:fe.j({subscriptionTier:"enterprise",billingInterval:n.interval,intl:this.props.intl}),monthlyBilling:"month"===n.interval,br:r.a.createElement("br",null)}});if(!(await d.a({message:e,acceptLabel:r.a.createElement(g.a,{id:"subscriptionSettings.upgradeToEnterpriseDialog.confirmationbutton",defaultMessage:"Upgrade to Enterprise Plan"})})))return}if(n&&fe.H(t)){const t=jt.c.enterprise[n.interval];await v.h({environment:this.environment,spaceStore:e,plan:t,billing:n.billing})}else v.d(this.environment,{subscriptionTier:"enterprise",from:"pricing_grid"})},this.handleChurnSurveyModalAccept=()=>{const{store:e}=this.stores;e.state.churnSurveyModalOpen&&e.state.onAccept(),e.reset()},this.handleChurnSurveyModalClose=()=>{const{store:e}=this.stores;e.state.churnSurveyModalOpen&&e.state.onClose(),e.reset()}}willMount(){v.e(this.environment)}renderComponent(){return $.a.state.online?this.renderPlans():r.a.createElement(Nn.a,null)}renderPlans(){const{churnSurveyModalOpen:e}=this.stores.store.state;return r.a.createElement("div",{style:Hn.wrapStyle},r.a.createElement(Dt.b,{style:Hn.scrollerStyle,type:Dt.a.Y},this.renderSubscriptionInfo(),this.renderPricingGrid(),this.renderPriceDisclaimer(),this.allowEducationUpgrade()&&this.renderStudentUpgrade(),this.renderFAQ(),r.a.createElement(L.a,{innerStyle:{width:600,height:"80vh",overflow:"scroll"},open:e,render:this.renderChurnSurveyModal,onDismiss:this.handleChurnSurveyModalClose})))}renderPriceDisclaimer(){const{intl:e}=this.props;return r.a.createElement("div",{style:Hn.priceDisclaimerStyle},r.a.createElement(g.a,{id:"spaceSubscriptionPlans.priceDisclaimer",defaultMessage:"Prices shown are for annual billing. When billed month-to-month, the <b>Personal Pro Plan</b> is {personalMonthlyPrice} per month, the <b>Team Plan</b> is {teamMonthlyPrice} per member per month, and the <b>Enterprise Plan</b> is {enterpriseMonthlyPrice} per member per month.",values:{b:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement("b",null,t)},personalMonthlyPrice:Object(At.b)({amount:W.a.pricing.personal.monthlyPrice,currency:"dollar",intl:e}),teamMonthlyPrice:Object(At.b)({amount:W.a.pricing.team.monthlyPricePerMember,currency:"dollar",intl:e}),enterpriseMonthlyPrice:Object(At.b)({amount:W.a.pricing.enterprise.monthlyPricePerMember,currency:"dollar",intl:e})}}))}renderSubscriptionInfo(){const{spaceStore:e}=this.props,{data:t}=this.props;return"subscribed_admin"===t.type?r.a.createElement("div",{style:this.subscriptionInfoStyle()},fe.G(this.environment,e,t)):"unsubscribed_admin"===t.type||"unsubscribed_member"===t.type?r.a.createElement("div",{style:Vn({},this.subscriptionInfoStyle(),{display:"flex",alignItems:"center",justifyContent:"space-between"})},r.a.createElement("div",null,fe.G(this.environment,e,t))):void 0}renderPricingGrid(){const e=this.getPlanState();return r.a.createElement(Tn,{isSettings:!0,planState:e,data:this.props.data})}renderStudentUpgrade(){return r.a.createElement("div",{style:Hn.subsectionStyle},r.a.createElement("div",{style:Hn.subsectionTitleStyle},r.a.createElement(g.a,{id:"spaceSubscriptionPlans.studentsAndEducatorsSection.title",defaultMessage:"Students & educators"})),r.a.createElement("div",{style:{color:this.theme.mediumTextColor,marginBottom:15}},r.a.createElement(g.a,{id:"spaceSubscriptionPlans.studentsAndEducatorsSection.text",defaultMessage:"<p>Personal Pro Plans are free for students and educators! Simply sign up with your school email address and you'll immediately gain access to those features.</p><p>If you're already on a Personal Pro Plan, change the email associated with your account to your school email address to get it for free.</p>",values:{p:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement("div",{style:{marginBottom:4}},t)}}})),r.a.createElement(ee.a,{isLarge:!0,onClick:this.handleEducationPlanClick},r.a.createElement(g.a,{id:"spaceSubscriptionPlans.studentsAndEducatorsSection.getEducationPlanButton.label",defaultMessage:"Get free Education plan"})))}renderFAQ(){return r.a.createElement("div",{style:Hn.subsectionStyle},r.a.createElement("div",{style:Hn.subsectionTitleStyle},r.a.createElement(g.a,{id:"spaceSubscriptionPlans.faqSection.title",defaultMessage:"FAQ"})),r.a.createElement(Qt,{cta:"intercom",type:"general",isSettings:!0}))}getMemberCount(){return fe.u(this.props.data)}canSwitchPlans(){const e=fe.y(this.props.data);return this.props.spaceStore.canAdmin()&&!e}calculateButtonState(e){const{data:t}=this.props,n=fe.C(t);return"personal_free"===e?{free:"current",personal:"upgrade",team:"upgrade",enterprise:"upgrade"}:"personal"===e||"student"===e?{free:n?"current":"downgrade",personal:n?"resubscribe":"current",team:"upgrade",enterprise:"upgrade"}:"team_free"===e||"free"===e?{free:"downgrade",personal:"upgrade",team:"upgrade",enterprise:"upgrade"}:"team"===e?{free:"downgrade",personal:"downgrade",team:n?"resubscribe":"current",enterprise:"upgrade"}:"enterprise"===e?{free:"downgrade",personal:"downgrade",team:"downgrade",enterprise:n?"resubscribe":"current"}:void Object(vn.e)(e)}isButtonStateActive(e){return["current","resubscribe"].includes(e)}getPlanState(){const e=fe.i(this.environment);if(!e)return;const t="team_free"===e||"free"===e,n=fe.y(this.props.data),a=this.calculateButtonState(e);return{plans:{free:{buttonType:a.free,isActive:this.isButtonStateActive(a.free),onClick:this.handleFreeClick},personal:{buttonType:a.personal,isActive:this.isButtonStateActive(a.personal),onClick:this.handlePersonalClick},team:{buttonType:a.team,isActive:this.isButtonStateActive(a.team)||t,onClick:this.handleTeamClick,onClickTeamFree:this.handleTeamFreeClick},enterprise:{buttonType:a.enterprise,isActive:this.isButtonStateActive(a.enterprise),onClick:this.handleEnterpriseClick}},isTeamTrial:t,isInAppPurchase:n,canSwitchPlans:this.canSwitchPlans(),memberCount:this.getMemberCount()}}allowEducationUpgrade(){const{data:e}=this.props,t=this.getPlanState();return t&&t.canSwitchPlans&&!fe.x(e)&&1===t.memberCount&&(t.plans.free.isActive||t.plans.personal.isActive)}subscriptionInfoStyle(){return{textAlign:"left",marginBottom:24,fontSize:14,borderBottom:"1px solid ".concat(this.theme.regularDividerColor),paddingBottom:16}}}Hn.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},Hn.scrollerStyle={transform:"translateZ(0px)",flexGrow:1,padding:30},Hn.subscriptionInfoCtaButtonStyle={marginLeft:16,paddingLeft:10},Hn.priceDisclaimerStyle={fontSize:14,marginTop:20,marginBottom:40},Hn.subsectionStyle={fontSize:14,marginTop:40},Hn.subsectionTitleStyle={fontSize:20,fontWeight:K.a.fontWeight.bold,marginBottom:12};var Gn=Object(g.g)(Hn),Yn=n(562);function Qn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Kn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qn(Object(n),!0).forEach((function(t){Zn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Zn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Xn extends E.a{getInitialState(){return{paymentMethodModalOpen:!1,billingIntervalModalOpen:!1,billingEmailModalOpen:!1,vatIdModalOpen:!1,addressModalOpen:!1,applyCreditModalOpen:!1,billingEventsLimit:20,applyCouponModalOpen:!1,addressErrorMessage:void 0}}setAddressField(e,t){const n=this.state.temporaryAddress?this.state.temporaryAddress:{name:"",businessName:"",addressLine1:"",addressLine2:"",zipCode:"",city:"",state:"",country:""};this.setState(Kn({},this.state,{temporaryAddress:Kn({},n,{[e]:t})}))}}var $n=Xn;class Jn extends E.a{getInitialState(){return{inputValue:void 0}}}var ea=Jn;class ta extends F.a{constructor(){super(...arguments),this.storeTypes={store:ea},this.handleInputChange=e=>{const{store:t}=this.stores,n=e.target.value,a=this.inputValueToCents(n);let r;r=n?void 0!==a?n:this.getCurrentInputValue():"",t.setState({inputValue:r}),this.forceUpdate(),this.props.onChange(this.inputValueToCents(r)||0)}}renderComponent(){const{focus:e,selectAll:t,availableCredit:n}=this.props,a=this.getCurrentInputValue();return r.a.createElement(z.b,{value:a,onChange:this.handleInputChange,focus:e,selectAll:t,disabled:n<=0,style:{maxWidth:120},inputStyle:{textAlign:"right"}})}getCurrentInputValue(){const{availableCredit:e}=this.props,{inputValue:t}=this.stores.store.state;return void 0===t?"".concat(Math.floor(e/100)):t}inputValueToCents(e){const{availableCredit:t}=this.props,n=Math.floor(100*parseFloat(e));if(!isNaN(n)&&n<=t&&n>=0)return n}}var na=ta;const aa={workspaceBalance:r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.workspaceSubscriptionBalance.title",defaultMessage:"Workspace balance"}),applyCoupon:r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.applyCoupon.title",defaultMessage:"Apply coupon"})};var ra=n(183),ia=n(76),sa=n(112);function oa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function la(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ca extends F.a{constructor(){super(...arguments),this.storeTypes={store:$n,billingHistoryRequestStore:ge.a},this.performGetBillingHistoryRequest=async e=>{const{spaceStore:t}=this.props,n=await l.G(this.environment,{spaceId:t.id,limit:e});if("failed"===n.type)throw n.error;return n.data},this.renderBillingHistoryResults=(e,t)=>{this.props.mockBillingHistoryResult&&(t=this.props.mockBillingHistoryResult);const{billingHistoryRequestStore:n}=this.stores;return r.a.createElement("div",null,t&&0===t.events.length&&r.a.createElement("div",{style:{color:this.theme.mediumTextColor,fontSize:14}},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.invoicesSection.noInvoicesMessage",defaultMessage:"This workspace has no payments yet."})),t&&t.events.length>0&&r.a.createElement("table",null,r.a.createElement("tbody",null,t.events.map(this.renderBillingHistoryEvent))),t&&!t.reachedEndOfResults&&r.a.createElement(ia.a,{onClick:this.handleLoadMoreBillingEventsClick,style:{marginLeft:-4,width:"100%"}},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.invoicesSection.loadMoreInvoicesButton.label",defaultMessage:"Load more"})),n.state.loading&&r.a.createElement(V.a,null))},this.renderBillingHistoryEvent=(e,t)=>{let n;const{intl:a}=this.props;return n="paid"===e.status?e.total<0?r.a.createElement(g.a,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.credited",defaultMessage:"Credited"}):r.a.createElement(g.a,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.paid",defaultMessage:"Paid"}):e.attempted?r.a.createElement(g.a,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.failed",defaultMessage:"Failed"}):r.a.createElement(g.a,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.due",defaultMessage:"Due",description:"Label for the amount that the user owes on a given invoice"}),r.a.createElement("tr",{style:{height:28,fontSize:14,whiteSpace:"nowrap"},key:t},r.a.createElement("td",{style:{width:"100%",paddingRight:18,color:this.theme.mediumTextColor}},Object(An.a)(e.timestamp).format("LL")),r.a.createElement("td",{style:{paddingRight:18}},n),r.a.createElement("td",{style:{paddingRight:18,textAlign:"right"}},Object(At.b)({amount:e.total,currency:"dollar",intl:a})),r.a.createElement("td",null,r.a.createElement(sa.a,{inline:!0,href:"/invoice/".concat(e.id),external:!0,innerStyle:this.getViewInvoiceButtonStyle()},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.invoicesSection.viewInvoiceButton",defaultMessage:"View invoice"}))))},this.handleLoadMoreBillingEventsClick=()=>{this.stores.store.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oa(Object(n),!0).forEach((function(t){la(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.stores.store.state,{billingEventsLimit:this.stores.store.state.billingEventsLimit+ca.billingEventsLimitIncrement}))}}renderComponent(){const{store:e,billingHistoryRequestStore:t}=this.stores,n={request:e.state.billingEventsLimit,performRequest:this.performGetBillingHistoryRequest,render:this.renderBillingHistoryResults};return r.a.createElement("div",null,r.a.createElement(H.a,{large:!0,divider:"full",style:{marginTop:36}},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.invoicesSection.title",defaultMessage:"Invoices"})),r.a.createElement(ra.a,Object.assign({},n,{requestStore:t})))}static getModalStyle(e){return{width:480,background:e.popoverBackground,padding:24,borderRadius:3}}getViewInvoiceButtonStyle(){return{color:this.theme.mediumTextColor,padding:"2px 3px",borderRadius:3}}}ca.billingEventsLimitIncrement=20,ca.modalTitleStyle={fontSize:18,marginBottom:16,fontWeight:K.a.fontWeight.medium};var da=Object(g.g)(ca);const ua=Object(g.f)({apply_credit:{id:"spaceSubscriptionBilling.applyCreditButton.label",defaultMessage:"Apply credit",description:"Button a user clicks to apply Notion credits towards their Notion bill."},update:{id:"spaceSubscriptionBilling.updateButton.label",defaultMessage:"Update"},add:{id:"spaceSubscriptionBilling.addButton.label",defaultMessage:"Add"},apply:{id:"spaceSubscriptionBilling.apply.label",defaultMessage:"Apply"}});class pa extends F.a{renderComponent(){const{title:e,caption:t,buttonArgs:n}=this.props,a=r.a.createElement(g.a,Object.assign({},ua[n.buttonPurpose]));return r.a.createElement("div",{style:{display:"flex",alignItems:"center",fontSize:14}},r.a.createElement("div",{style:{marginRight:"auto"}},e),r.a.createElement("div",{style:{color:this.theme.mediumTextColor}},t),r.a.createElement("div",{style:{minWidth:110,display:"flex",justifyContent:"flex-end"}},n.showButton&&r.a.createElement(ia.a,{isBlue:!0,onClick:n.onClick,style:pa.buttonStyle},a)))}}pa.buttonStyle={marginLeft:18,marginRight:-4,fontWeight:K.a.fontWeight.medium};var ma=Object(g.g)(pa),ha=n(170),ga=n(1437),ba=n(1355),fa=n(1356);function ya(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Sa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ya(Object(n),!0).forEach((function(t){va(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ya(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function va(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Ea={offline:r.a.createElement(g.a,{defaultMessage:"Please go online to manage billing.",id:"spaceSubscriptionBilling.offline.message"})};class Ma extends F.a{constructor(){super(...arguments),this.couponEntryInput=null,this.storeTypes={store:$n,billingHistoryRequestStore:ge.a},this.renderPaymentMethodModal=()=>{const{customerData:e,spaceStore:t}=this.props;return r.a.createElement(ha.j,{customerData:e,spaceStore:t,onComplete:this.handleModalClose})},this.renderBillingIntervalModal=()=>{const{temporaryBillingInterval:e}=this.stores.store.state,{customerData:t}=this.props,n=e||t.interval,{monthlyPlanAmount:a,yearlyPlanAmount:i}=t,s=1-i/(12*a);return r.a.createElement(Ca,{theme:this.theme,title:r.a.createElement(g.a,{id:"spaceSubscriptionBilling.changeBillingInterval.title",defaultMessage:"Change billing interval"}),helpButton:r.a.createElement(de.a,{title:r.a.createElement(g.a,{id:"spaceSubscriptionBilling.changeBillingInterval.helpButton.label",defaultMessage:"Learn about how this change will impact what you pay."}),href:Object(Be.a)("guides.changeBillingInterval"),analyticsFrom:"billing_interval_settings"}),acceptAction:"update",onAccept:this.handleBillingIntervalAccept,onClose:this.handleModalClose},r.a.createElement("div",{style:{marginTop:12,marginBottom:16}},fe.F({environment:this.environment,productId:t.productId,yearlyPlanAmount:i,monthlyPlanAmount:a,yearlySavingsPercent:s,currentBillingInterval:n,handleMonthlyBillingClick:this.handleMonthlyBillingClick,handleYearlyBillingClick:this.handleYearlyBillingClick})))},this.renderApplyCreditModal=()=>{const{subscriptionData:e,customerData:t,intl:n}=this.props,{availableCredit:a}=e,i=this.getCurrentFormCreditAmount(),s=Math.max(0,(t.nextInvoiceAmount||0)-i);return r.a.createElement("div",{style:Ma.getModalStyle(this.theme)},r.a.createElement("div",{style:Ma.modalTitleStyle},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.useCreditModal.title",defaultMessage:"Use Notion credit - {creditInDollars} available",values:{creditInDollars:Object(At.b)({amount:a,currency:"dollar",intl:n})}})),r.a.createElement("div",{style:{fontSize:14,display:"flex",alignItems:"center",marginBottom:16}},r.a.createElement("div",{style:{width:"100%",marginRight:20,color:this.theme.mediumTextColor}},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.useCreditModal.amountOfCreditQuestion",defaultMessage:"How much credit would you like to apply to your next invoice?"})),r.a.createElement(na,{availableCredit:a,focus:!0,selectAll:!0,onChange:this.handleApplyCreditAmountInputChange}),r.a.createElement("div",{style:{whiteSpace:"nowrap",marginLeft:8}},"/"," ",Object(At.b)({amount:a,currency:"dollar",intl:n}))),r.a.createElement("div",{style:{borderTop:"1px solid ".concat(this.theme.regularDividerColor),paddingTop:16}},r.a.createElement("div",{style:{paddingBottom:18,fontSize:12,color:this.theme.mediumTextColor}},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.useCreditModal.warning",defaultMessage:"Applying credit to your account <bold>cannot be undone</bold>.",values:{bold:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement("b",null,t)}}})),r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement("div",{style:{fontSize:36,lineHeight:1}},Object(At.b)({amount:s,currency:"dollar",intl:n})),r.a.createElement("div",{style:{marginLeft:8,fontSize:12,color:this.theme.mediumTextColor,alignSelf:"flex-end"}},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.useCreditModal.nextInvoiceAmount",defaultMessage:"next invoice total",description:"Text that appears next to the amount, in dollars, that the user's next invoice will be after applying their Notion credits to their bill."})),r.a.createElement(te.a,{isLarge:!0,style:{marginLeft:"auto"},onClick:this.handleModalClose},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.useCreditModal.cancelButton.label",defaultMessage:"Cancel"})),r.a.createElement(ee.a,{isLarge:!0,style:{marginLeft:12},disabled:i<=0,onClick:this.handleApplyCreditAccept},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.useCreditModal.applyCreditButton.label",defaultMessage:"Apply credit"})))))},this.renderSingleTextFieldModal=(e,t,n,a,i)=>r.a.createElement(Ca,{theme:this.theme,title:t,acceptAction:i,onAccept:a,onClose:this.handleModalClose},r.a.createElement(z.b,{focus:!0,selectAll:!0,value:e,onChange:n,onSubmit:a,style:Ma.modalInputStyle})),this.renderBillingEmailModal=()=>{const{customerData:e}=this.props,{temporaryBillingEmail:t}=this.stores.store.state,n=void 0!==t?t:e.billingEmail||"",a=e.billingEmail?"update":"add";return this.renderSingleTextFieldModal(n,r.a.createElement(g.a,{id:"spaceSubscriptionBilling.changeBillingEmailModal.title",defaultMessage:"Change billing email"}),this.handleBillingEmailChange,this.handleBillingEmailAccept,a)},this.renderVatIdModal=()=>{const{customerData:e}=this.props,{temporaryVatId:t}=this.stores.store.state,n=void 0!==t?t:e.vatId||"",a=e.vatId?"update":"add";return r.a.createElement(Ca,{theme:this.theme,title:r.a.createElement(g.a,{id:"spaceSubscriptionBilling.changeVATIDModal.title",defaultMessage:"Change VAT/GST number"}),acceptAction:a,onAccept:this.handleVatIdAccept,onClose:this.handleModalClose},r.a.createElement(z.b,{focus:!0,selectAll:!0,value:n,onChange:this.handleVatIdChange,onSubmit:this.handleVatIdAccept,style:Ma.modalInputStyle}),r.a.createElement("div",{style:{color:this.theme.mediumTextColor,fontSize:K.a.fontSize.UISmall.desktop,marginTop:-10}},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.changeVATIDModal.subtitle",defaultMessage:"Please include your country code"})))},this.renderApplyCouponModal=()=>r.a.createElement(Ca,{theme:this.theme,title:r.a.createElement(g.a,{id:"spaceSubscriptionBilling.applyCouponModal.title",defaultMessage:"Apply coupon"}),acceptAction:"apply",onAccept:()=>{this.couponEntryInput&&this.couponEntryInput.checkCouponCode()},onClose:this.handleModalClose},r.a.createElement(ga.a,{ref:e=>this.couponEntryInput=e,hideApply:!0,handlePromo:async e=>{this.handleModalClose(),await v.h({environment:this.environment,spaceStore:this.props.spaceStore,coupon:e.id})&&Object(d.f)({message:r.a.createElement(g.a,{id:"spaceSubscriptionBilling.applyCouponModal.successMessage",defaultMessage:"Coupon applied!"})})}})),this.updateTemporaryAddress=e=>{const{temporaryAddress:t}=this.stores.store.state;this.stores.store.setState(Sa({},this.stores.store.state,{temporaryAddress:Sa({},this.props.customerData.address,{},t,{},e)}))},this.renderAddressModal=()=>{const{customerData:e}=this.props,{temporaryAddress:t,addressErrorMessage:n}=this.stores.store.state,a=fe.i(this.environment);return r.a.createElement("div",{style:{display:"flex",flexDirection:"column",maxHeight:"75vh"}},r.a.createElement("div",{style:Ma.getModalStyle(this.theme)},r.a.createElement("div",{style:Ma.modalTitleStyle},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.changeYourAddressModal.title",defaultMessage:"Change your address"})),r.a.createElement(ba.a,{address:t||{name:e.customerName||"",businessName:"",addressLine1:"",addressLine2:"",zipCode:"",city:"",state:"",country:""},updateAddressField:(e,t)=>{this.stores.store.setAddressField(e,t)},shouldShowBusinessName:Boolean(a&&["team","enterprise"].includes(a))}),r.a.createElement("div",{style:{color:J.f.red,marginTop:10}},n)),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",padding:"16px 24px",background:this.theme.contentBackground}},r.a.createElement(te.a,{isLarge:!0,onClick:this.handleModalClose},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.changeBillingAddressModal.cancelButton.label",defaultMessage:"Cancel"})),r.a.createElement(ee.a,{style:{marginLeft:12},isLarge:!0,disabled:void 0===this.getUpdatedAddress(),onClick:this.handleAddressAccept},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.changeBillingAddressModal.updateButton.label",defaultMessage:"Update"}))))},this.handleChangePlanClick=()=>{A.a.setState({open:!0,currentTab:"plans"})},this.handlePaymentMethodChangeClick=()=>{this.stores.store.setState(Sa({},this.stores.store.state,{paymentMethodModalOpen:!0}))},this.handleBillingIntervalChangeClick=()=>{this.stores.store.setState(Sa({},this.stores.store.state,{billingIntervalModalOpen:!0}))},this.handleBillingEmailChangeClick=()=>{this.stores.store.setState(Sa({},this.stores.store.state,{billingEmailModalOpen:!0}))},this.handleAddressChangeClick=()=>{this.stores.store.setState(Sa({},this.stores.store.state,{addressModalOpen:!0}))},this.handleVatIdChangeClick=()=>{this.stores.store.setState(Sa({},this.stores.store.state,{vatIdModalOpen:!0}))},this.handleApplyCouponClick=()=>{this.stores.store.setState(Sa({},this.stores.store.state,{applyCouponModalOpen:!0}))},this.handleModalClose=()=>{this.stores.store.reset()},this.handleBillingEmailChange=e=>{this.stores.store.setState(Sa({},this.stores.store.state,{temporaryBillingEmail:e.target.value}))},this.handleBillingEmailAccept=async()=>{const{spaceStore:e,customerData:t}=this.props,{temporaryBillingEmail:n}=this.stores.store.state;n!==t.billingEmail&&await v.h({environment:this.environment,spaceStore:e,billingEmail:n}),this.handleModalClose()},this.handleVatIdChange=e=>{this.stores.store.setState(Sa({},this.stores.store.state,{temporaryVatId:e.target.value}))},this.handleVatIdAccept=async()=>{const{spaceStore:e,customerData:t}=this.props,{temporaryVatId:n}=this.stores.store.state;n!==t.vatId&&await v.h({environment:this.environment,spaceStore:e,vatId:n}),this.handleModalClose()},this.handleAddressAccept=async()=>{const{spaceStore:e}=this.props,t=this.getUpdatedAddress();if(!t)return void this.stores.store.setState(Sa({},this.stores.store.state,{addressErrorMessage:this.props.intl.formatMessage({id:"spaceSubscriptionBilling.address.invalidError",defaultMessage:"Your address is invalid. Please update your address so we can process your payment."})}));const n=await Object(fa.a)(this.environment,t);if(!n.valid)return void this.stores.store.setState(Sa({},this.stores.store.state,{addressErrorMessage:this.props.intl.formatMessage({id:"spaceSubscriptionBilling.address.invalidError",defaultMessage:"Your address is invalid. Please update your address so we can process your payment."})}));const a=Sa({},t,{},n.validatedAddresses?n.validatedAddresses[0]:void 0);if(t)try{await v.f({environment:this.environment,spaceStore:e,address:a}),this.handleModalClose()}catch(r){}},this.getUpdatedAddress=()=>{const{customerData:e}=this.props,{temporaryAddress:t}=this.stores.store.state;if(t&&t!==e.address)return t},this.handleMonthlyBillingClick=()=>{this.stores.store.setState(Sa({},this.stores.store.state,{temporaryBillingInterval:"month"}))},this.handleYearlyBillingClick=()=>{this.stores.store.setState(Sa({},this.stores.store.state,{temporaryBillingInterval:"year"}))},this.handleBillingIntervalAccept=async()=>{const{spaceStore:e,customerData:t}=this.props,{temporaryBillingInterval:n}=this.stores.store.state;if(n&&n!==t.interval){const t=this.getPlanForOppositeBillingInterval();t&&await v.h({environment:this.environment,spaceStore:e,plan:t})}this.handleModalClose()},this.handleUseCardClick=()=>{this.stores.store.setState(Sa({},this.stores.store.state,{temporaryBillingType:"charge_automatically"}))},this.handleSendInvoiceClick=()=>{this.stores.store.setState(Sa({},this.stores.store.state,{temporaryBillingType:"send_invoice"}))},this.handleCardUpdateClick=async()=>{const{spaceStore:e}=this.props,{customerData:t}=this.props;if(t.billingEmail){const n=await v.c({name:"Update your Card",panelLabel:"Update",email:t.billingEmail});await v.h({environment:this.environment,spaceStore:e,billing:"charge_automatically",stripeToken:n})}this.handleModalClose()},this.handlePaymentMethodAccept=async()=>{const{spaceStore:e}=this.props,{customerData:t}=this.props,{temporaryBillingType:n}=this.stores.store.state,a=n||t.billing;if("charge_automatically"!==a||t.brand)a!==t.billing&&await v.h({environment:this.environment,spaceStore:e,billing:n});else{const{currentUserStore:n}=p.a.state,a=n?n.getValue():void 0,r=t.billingEmail||(a?a.email:void 0);if(!r)throw new Error("No billing email found.");const i=await v.c({name:"Update your Card",panelLabel:"Update",email:r});await v.h({environment:this.environment,spaceStore:e,billing:"charge_automatically",stripeToken:i,billingEmail:r})}this.handleModalClose()},this.handleApplyCreditClick=()=>{this.stores.store.setState(Sa({},this.stores.store.state,{applyCreditModalOpen:!0}))},this.handleApplyCreditAccept=async()=>{const e=this.getCurrentFormCreditAmount(),{spaceStore:t}=this.props;e>0&&await v.h({environment:this.environment,spaceStore:t,creditAmount:e}),this.handleModalClose(),m.Yd(this.environment,{amount:e})},this.handleApplyCreditAmountInputChange=e=>{this.stores.store.setState(Sa({},this.stores.store.state,{temporaryApplyCreditCents:e}))},this.handleRestartSubscriptionClick=async()=>{const{spaceStore:e}=this.props,{customerData:t}=this.props;await v.h({environment:this.environment,spaceStore:e,plan:t.plan}),this.handleModalClose()}}willMount(){v.e(this.environment)}renderComponent(){return $.a.state.online?this.renderBilling():Ma.renderOfflineMessage()}static renderOfflineMessage(){return r.a.createElement(q.a,null,r.a.createElement(pe.a,{isSmall:!0,style:{textAlign:"center"}},Ea.offline))}renderBilling(){const{customerData:e,subscriptionData:t}=this.props,{paymentMethodModalOpen:n,billingIntervalModalOpen:a,billingEmailModalOpen:i,addressModalOpen:s,applyCreditModalOpen:o,vatIdModalOpen:l,applyCouponModalOpen:c}=this.stores.store.state;return r.a.createElement("div",{style:Ma.wrapStyle},r.a.createElement(Dt.b,{style:Ma.scrollerStyle,type:Dt.a.Y},this.renderHeader(e),this.renderSummary(t),this.renderPaymentMethod(e),this.renderSeparator(),this.renderBillingInterval(e),this.renderSeparator(),this.renderBillingEmail(e),this.renderSeparator(),this.renderAddress(e),this.renderSeparator(),this.shouldRenderVat(e)&&this.renderVatId(e),this.shouldRenderVat(e)&&this.renderSeparator(),this.renderCredit(e),this.renderSeparator(),this.renderCoupon(),this.renderSeparator(),r.a.createElement(da,Object.assign({},this.props,{data:t})),r.a.createElement(L.a,{open:n,render:this.renderPaymentMethodModal,onDismiss:this.handleModalClose}),r.a.createElement(L.a,{open:a,render:this.renderBillingIntervalModal,onDismiss:this.handleModalClose}),r.a.createElement(L.a,{open:o,render:this.renderApplyCreditModal,onDismiss:this.handleModalClose}),r.a.createElement(L.a,{open:i,render:this.renderBillingEmailModal,onDismiss:this.handleModalClose}),r.a.createElement(L.a,{open:s,render:this.renderAddressModal,onDismiss:this.handleModalClose}),r.a.createElement(L.a,{open:l,render:this.renderVatIdModal,onDismiss:this.handleModalClose}),r.a.createElement(L.a,{open:c,render:this.renderApplyCouponModal,onDismiss:this.handleModalClose})))}renderHeader(e){let t=r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.legacyPlanTitle",defaultMessage:"Legacy Plan"});switch(e.productId){case W.a.pricing.personal.productId:t=r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.personalPlanTitle",defaultMessage:"Personal Pro Plan"});break;case W.a.pricing.student.productId:t=r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.personalEducationPlanTitle",defaultMessage:"Personal Pro (Education) Plan"});break;case W.a.pricing.team.productId:t=r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.teamPlanTitle",defaultMessage:"Team Plan"});break;case W.a.pricing.enterprise.productId:t=r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.enterprisePlanTitle",defaultMessage:"Enterprise Plan"})}return r.a.createElement(H.a,{large:!0,divider:"full"},t)}renderSummary(e){const{spaceStore:t}=this.props,n=fe.G(this.environment,t,e),a=fe.C(e),i="subscribed_admin"===e.type;return r.a.createElement("div",{style:Ma.summaryStyle},r.a.createElement("div",{style:Ma.summaryMessageStyle},n),a&&r.a.createElement(ee.a,{isLarge:!0,onClick:this.handleRestartSubscriptionClick,style:{marginRight:8}},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.restartSubscriptionButton.label",defaultMessage:"Restart subscription"})),i&&r.a.createElement(te.a,{isLarge:!0,onClick:this.handleChangePlanClick},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.changePlanButton.label",defaultMessage:"Change plan"})))}renderSeparator(){return r.a.createElement("div",{style:{flex:"none",height:1,marginTop:10,marginBottom:10,background:this.theme.regularDividerColor}})}renderPaymentMethod(e){return r.a.createElement(ma,{title:r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.title",defaultMessage:"Payment method"}),caption:r.a.createElement(a.Fragment,null,"send_invoice"===e.billing&&r.a.createElement("div",null,r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.value.achOrWireTransfer",defaultMessage:"ACH or Wire Transfer"})),"charge_automatically"===e.billing&&(e.last4&&e.brand?r.a.createElement("div",null,r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.value.creditCard",defaultMessage:"{creditCardBrand} ending in {lastFourDigits}",values:{creditCardBrand:Object(Yn.a)(e.brand),lastFourDigits:e.last4}})):r.a.createElement("div",null,r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.value.none",defaultMessage:"None",description:"The payment method setting we display for users who haven't set up a payment method yet"})))),buttonArgs:{showButton:!0,buttonPurpose:"update",onClick:this.handlePaymentMethodChangeClick}})}renderBillingInterval(e){return r.a.createElement(ma,{title:r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingInterval.title",defaultMessage:"Billing interval"}),caption:r.a.createElement("div",null,"month"===e.interval?r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingInterval.value.monthly",defaultMessage:"Monthly"}):r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingInterval.value.yearly",defaultMessage:"Yearly"})),buttonArgs:{showButton:Boolean(this.getPlanForOppositeBillingInterval()),buttonPurpose:"update",onClick:this.handleBillingIntervalChangeClick}})}renderBillingEmail(e){return r.a.createElement(ma,{title:r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingEmail.title",defaultMessage:"Billing email"}),caption:r.a.createElement("div",null,e.billingEmail||""),buttonArgs:{showButton:!0,buttonPurpose:Boolean(e.billingEmail)?"update":"add",onClick:this.handleBillingEmailChangeClick}})}renderVatId(e){return r.a.createElement(ma,{title:r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.VATID.title",defaultMessage:"VAT/GST number",description:"Title for the section where users can update their VAT (value added tax) identification number"}),caption:r.a.createElement("div",null,e.vatId||""),buttonArgs:{showButton:!0,buttonPurpose:Boolean(e.vatId)?"update":"add",onClick:this.handleVatIdChangeClick}})}renderAddress(e){return r.a.createElement(ma,{title:r.a.createElement(g.a,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.yourAddress.title",defaultMessage:"Your address"}),caption:r.a.createElement("div",{style:{textAlign:"right",width:"80%",float:"right"}},this.renderAddressString(e.address)||""),buttonArgs:{showButton:!0,buttonPurpose:e.address&&!s.a.isEmpty(e.address)?"update":"add",onClick:this.handleAddressChangeClick}})}renderCredit(e){const t=-Math.min(0,e.accountBalance),{intl:n}=this.props;return r.a.createElement(ma,{title:aa.workspaceBalance,caption:r.a.createElement("div",null,Object(At.b)({amount:t,currency:"dollar",intl:n})),buttonArgs:{showButton:!0,buttonPurpose:"apply_credit",onClick:this.handleApplyCreditClick}})}renderCoupon(){return r.a.createElement(ma,{title:aa.applyCoupon,caption:void 0,buttonArgs:{showButton:!0,buttonPurpose:"apply",onClick:this.handleApplyCouponClick}})}renderAddressString(e){return e?this.props.intl.formatList([e.name,e.businessName,e.addressLine1,e.country].filter(Boolean),{type:"conjunction",style:"narrow"}):""}shouldRenderVat(e){const t=e.address.country;return void 0!=={AE:"ae_trn",AU:"au_abn",CA:"ca_qst",CH:"ch_vat",ES:"eu_vat",AT:"eu_vat",BE:"eu_vat",BG:"eu_vat",CY:"eu_vat",CZ:"eu_vat",DE:"eu_vat",EE:"eu_vat",FI:"eu_vat",FR:"eu_vat",GR:"eu_vat",HR:"eu_vat",HU:"eu_vat",IE:"eu_vat",IT:"eu_vat",LT:"eu_vat",LU:"eu_vat",LV:"eu_vat",MT:"eu_vat",NL:"eu_vat",PL:"eu_vat",PT:"eu_vat",RO:"eu_vat",SE:"eu_vat",SI:"eu_vat",SK:"eu_vat",GB:"gb_vat",IN:"in_gst",KR:"kr_brn",NZ:"nz_gst",SG:"sg_gst"}[t]}getCurrentFormCreditAmount(){const{subscriptionData:e}=this.props,{store:t}=this.stores,{temporaryApplyCreditCents:n}=t.state;return void 0!==n?n:e.availableCredit}getPlanForOppositeBillingInterval(){const{customerData:e}=this.props,t=jt.b.find(t=>t.indexOf(e.plan)>=0);if(t){const n=t.indexOf(e.plan);return t[0===n?1:0]}}static getModalStyle(e){return{width:480,background:e.popoverBackground,padding:24,borderRadius:3}}}function Ca(e){const t=r.a.createElement(g.a,Object.assign({},ua[e.acceptAction]));return r.a.createElement("div",{style:Ma.getModalStyle(e.theme)},r.a.createElement("div",{style:Ma.modalTitleStyle},e.title),e.children,r.a.createElement("div",{style:{marginBottom:20}},e.helpButton),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},r.a.createElement(te.a,{isLarge:!0,onClick:e.onClose,style:{marginRight:12}},r.a.createElement(g.a,{id:"spaceSubscriptionBilling.cancelButton.label",defaultMessage:"Cancel"})),r.a.createElement(ee.a,{isLarge:!0,onClick:e.onAccept},t)))}Ma.modalTitleStyle={fontSize:18,marginBottom:16,fontWeight:K.a.fontWeight.medium},Ma.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},Ma.scrollerStyle={height:"100%",padding:"36px 60px"},Ma.summaryStyle={display:"flex",alignItems:"flex-start",fontSize:14,marginBottom:36},Ma.summaryMessageStyle={marginRight:"auto",paddingRight:32},Ma.modalInputStyle={marginTop:12,marginBottom:20};var Oa=Object(g.g)(Ma);class wa extends F.a{constructor(){super(...arguments),this.storeTypes={store:$n,billingHistoryRequestStore:ge.a}}willMount(){v.e(this.environment)}renderComponent(){const{data:e}=this.props;return $.a.state.online?r.a.createElement("div",{style:wa.wrapStyle},r.a.createElement(Dt.b,{style:wa.scrollerStyle,type:Dt.a.Y},r.a.createElement(H.a,{large:!0,divider:"full"},r.a.createElement(g.a,Object.assign({},A.d.billingTab))),this.renderCredit(e),this.renderSeparator(),r.a.createElement(da,Object.assign({},this.props)))):wa.renderOfflineMessage()}static renderOfflineMessage(){return r.a.createElement(q.a,null,r.a.createElement(pe.a,{isSmall:!0,style:{textAlign:"center"}},Ea.offline))}renderCredit(e){const t=-Math.min(0,e.accountBalance),{intl:n}=this.props;return r.a.createElement(ma,{title:aa.workspaceBalance,caption:r.a.createElement("div",null,Object(At.b)({amount:t,currency:"dollar",intl:n})),buttonArgs:{showButton:!1,buttonPurpose:"apply_credit",onClick:s.a.noop}})}renderSeparator(){return r.a.createElement("div",{style:{flex:"none",marginTop:30}})}}wa.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},wa.scrollerStyle={height:"100%",padding:"36px 60px"};var ka=Object(g.g)(wa);class Pa extends E.a{getInitialState(){return{emailInputValue:"",showAllInviteCredits:!1}}}var Ta=Pa,Ia=n(490),ja=n(210);function Da(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function xa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Da(Object(n),!0).forEach((function(t){Ba(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Da(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ba(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Aa extends F.a{constructor(){super(...arguments),this.handleImportActionClick=()=>{Ia.a.setState({open:!0}),m.kb(this.environment,{type:"import_evernote"})},this.handleWebActionClick=()=>{en.i({environment:this.environment,url:"/product"}),m.kb(this.environment,{type:"web_login"})},this.handleDesktopActionClick=()=>{en.i({environment:this.environment,url:"/desktop"}),m.kb(this.environment,{type:"desktop_login"})},this.handleMobileActionClick=()=>{en.i({environment:this.environment,url:"/mobile"}),m.kb(this.environment,{type:"mobile_login"})},this.handleBrowserExtensionActionClick=()=>{en.i({environment:this.environment,url:"/web-clipper"}),m.kb(this.environment,{type:"browser_extension"})},this.handleMobileShareSheetActionClick=()=>{en.i({environment:this.environment,url:"/mobile"}),m.kb(this.environment,{type:"mobile_share_sheet"})}}renderComponent(){return r.a.createElement("div",{style:this.getWrapperStyle()},r.a.createElement("div",{style:{flex:0}},this.renderLeft()),r.a.createElement("div",{style:this.getCenterStyle()},r.a.createElement("div",null,this.renderTitle()),r.a.createElement(pe.a,{isSmall:!0,style:{marginBottom:2}},this.renderCaption())),r.a.createElement("div",{style:{flex:0}},this.renderRight()))}renderTitle(){const{credit:e,intl:t}=this.props;if("invited_user"===e.type){const t=this.getUserStore(e.to_user_id).getValue();return r.a.createElement(a.Fragment,null,Object(yt.d)(t)," ",!e.activated&&t&&!t.onboarding_completed&&r.a.createElement("span",{style:{color:this.theme.mediumTextColor}},r.a.createElement(g.a,{id:"userCreditSettings.inviteFriendsSection.userHasNotSignedUpNote",defaultMessage:"(has not signed up)",description:"Annotation that appears next to a referred user's name if the user hasn't signed up for Notion yet"})),!e.activated&&t&&t.onboarding_completed&&r.a.createElement("span",{style:{color:this.theme.mediumTextColor}},r.a.createElement(g.a,{id:"userCreditSettings.inviteFriendsSection.userHasAlreadySignedUpNote",defaultMessage:"(has already signed up)",description:"Annotation that appears next to a referred user's name if the user has signed up for Notion already"})))}if("invited_by_user"===e.type){const t=this.getUserStore(e.from_user_id).getValue();return r.a.createElement(a.Fragment,null,Object(yt.d)(t),r.a.createElement("span",{style:{color:this.theme.mediumTextColor}},r.a.createElement(g.a,{id:"userCreditSettings.inviteFriendsSection.sourceOfReferralNote",defaultMessage:"(invited you)",description:"Annotation that appears next to the name of the user who invited this user to Notion"})))}return"import_evernote"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.evernoteImport.title",defaultMessage:"Import from Evernote"}):"web_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webApp.title",defaultMessage:"Log in on the web"}):"desktop_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.desktopApp.title",defaultMessage:"Log in on the desktop app"}):"mobile_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileApp.title",defaultMessage:"Log in on the mobile app"}):"browser_extension"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webClipper.title",defaultMessage:"Use the Web Clipper"}):"mobile_share_sheet"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileShare.title",defaultMessage:"Use the iOS or Android system share menu"}):void 0}renderCaption(){const{credit:e,intl:t}=this.props;if("invited_user"===e.type){const t=this.getUserStore(e.to_user_id).getValue();return t&&t.email}if("invited_by_user"===e.type){const t=this.getUserStore(e.from_user_id).getValue();return t&&t.email}return"import_evernote"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.evernoteImport.description",defaultMessage:"Import your notes and notebooks"}):"web_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webApp.description",defaultMessage:"Sign in to Notion from any web browser"}):"desktop_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.desktopApp.description",defaultMessage:"Download the desktop app and sign in"}):"mobile_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileApp.description",defaultMessage:"Download the mobile app and sign in"}):"browser_extension"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webClipper.description",defaultMessage:"Download the Chrome extension and save a link"}):"mobile_share_sheet"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileShare.description",defaultMessage:"Use the share menu to save a link into Notion"}):void 0}renderLeft(){const{credit:e}=this.props;if("invited_user"===e.type){const t=this.getUserStore(e.to_user_id);return r.a.createElement(ja.a,{userValue:t.getValue(),style:{marginRight:8},size:24,hasTooltip:!0})}if("invited_by_user"===e.type){const t=this.getUserStore(e.from_user_id);return r.a.createElement(ja.a,{userValue:t.getValue(),style:{marginRight:8},size:24,hasTooltip:!0})}return"import_evernote"===e.type?ye.a.evernoteLogo(this.getIconStyle()):"web_login"===e.type?ye.a.logInWeb(this.getIconStyle()):"desktop_login"===e.type?ye.a.deviceDesktop(this.getIconStyle()):"mobile_login"===e.type?ye.a.deviceMobile(this.getIconStyle()):"browser_extension"===e.type?ye.a.googleChrome(this.getIconStyle()):"mobile_share_sheet"===e.type?ye.a.deviceMobileShareSheet(this.getIconStyle()):void 0}renderRight(){const{credit:e,intl:t}=this.props;let n;return"import_evernote"===e.type?n={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.evernoteImport.actionLink",defaultMessage:"Connect"}),onClick:this.handleImportActionClick}:"web_login"===e.type?n={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webApp.actionLink",defaultMessage:"Visit"}),onClick:this.handleWebActionClick}:"desktop_login"===e.type?n={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.desktopApp.actionLink",defaultMessage:"Download"}),onClick:this.handleDesktopActionClick}:"mobile_login"===e.type?n={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileApp.actionLink",defaultMessage:"Download"}),onClick:this.handleMobileActionClick}:"browser_extension"===e.type?n={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webClipper.actionLink",defaultMessage:"Install"}),onClick:this.handleBrowserExtensionActionClick}:"mobile_share_sheet"===e.type&&(n={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileShare.actionLink",defaultMessage:"Download"}),onClick:this.handleMobileShareSheetActionClick}),r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},n&&!e.activated&&r.a.createElement(ia.a,{isBlue:!0,isSmall:!0,onClick:n.onClick},n.text),r.a.createElement("div",{style:xa({minWidth:32,marginLeft:8,marginRight:8,textAlign:"right",fontWeight:K.a.fontWeight.semibold},!e.activated&&{color:this.theme.lightTextColor})},Object(At.b)({amount:e.amount,currency:"dollar",intl:this.props.intl})),r.a.createElement("div",{style:this.getTickStyles(e.activated)},ye.a.check({fill:J.f.white,width:12,height:12,opacity:e.activated?1:0})))}getUserStore(e){const{currentSpaceStore:t}=p.a.state;if(!t)throw new Error("No current space.");return bt.a.createChildStore(t,{table:yt.a,id:e})}getWrapperStyle(){const e="1px solid ".concat(this.theme.regularDividerColor);return{display:"flex",alignItems:"center",borderTop:this.props.isFirst?e:void 0,borderBottom:e,paddingTop:8,paddingBottom:8}}getCenterStyle(){return{flex:1,fontSize:14,marginLeft:4}}getIconStyle(){return{width:24,height:24,fill:this.theme.mediumIconColor,marginRight:8}}getTickStyles(e){const t=e?void 0:"inset 0 0 0 2px ".concat(this.theme.regularDividerColor);return{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20,borderRadius:20,background:e?J.f.blue:void 0,boxShadow:t}}}var Fa=Object(g.g)(Aa);function Ra(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function La(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ua extends F.a{constructor(){super(...arguments),this.storeTypes={store:Ta},this.renderCredit=(e,t)=>r.a.createElement(Fa,{key:e.id,credit:e,isFirst:0===t}),this.handleInviteCreditsToggleShowMoreClick=()=>{const{store:e}=this.stores;e.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ra(Object(n),!0).forEach((function(t){La(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ra(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.state,{showAllInviteCredits:!e.state.showAllInviteCredits}))},this.handleApplyCreditClick=()=>{const{data:e}=this.props;A.a.setState({open:!0,currentTab:"subscribed_admin"===e.type?"billing":"plans"}),m.m(this.environment)}}willMount(){v.e(this.environment)}renderComponent(){if($.a.state.online){const{credits:e}=this.props.data;return this.renderSettings(e)}return this.renderOfflineMessage()}renderOfflineMessage(){return r.a.createElement(q.a,null,r.a.createElement(pe.a,{isSmall:!0,style:{textAlign:"center"}},r.a.createElement(g.a,{id:"userCreditSettings.offline.message",defaultMessage:"Please go online to manage your account credit."})))}renderOtherCreditWays(e){const t=this.getActionCredits(e);return t.length>0&&r.a.createElement(a.Fragment,null,r.a.createElement(H.a,{large:!0},r.a.createElement(g.a,{id:"userCreditSettings.otherWaysToEarnCreditSectionAlt.title",defaultMessage:"Ways to earn credit"})),r.a.createElement("div",null,t.map(this.renderCredit)))}renderReferralSection(e){const{store:t}=this.stores,{showAllInviteCredits:n}=t.state,a=this.getInviteCredits(e),i=n?a:a.slice(0,Ua.showInviteCreditCount);return a.length>0&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:this.getHeaderContainerStyles()},r.a.createElement("div",{style:this.getHeaderStyles()},r.a.createElement(g.a,{id:"userCreditSettings.inviteFriendsSection.title",defaultMessage:"Invite friends and earn credit"}))),r.a.createElement("div",{style:this.getInviteCreditStyles()},i.map(e=>this.renderCredit(e,1)),a.length>Ua.showInviteCreditCount&&r.a.createElement(Ee.a,{style:{marginTop:8},onClick:this.handleInviteCreditsToggleShowMoreClick},n?r.a.createElement(g.a,{id:"userCreditSettings.inviteFriendsSection.showLessReferredUsers.link",defaultMessage:"Show {numberOfReferredUsers} less",values:{numberOfReferredUsers:a.length-Ua.showInviteCreditCount}}):r.a.createElement(g.a,{id:"userCreditSettings.inviteFriendsSection.showMoreReferredUsers.link",defaultMessage:"Show {numberOfReferredUsers} more",values:{numberOfReferredUsers:a.length-Ua.showInviteCreditCount}}))))}renderTotalCreditEarned(e){const{intl:t}=this.props,n=e.reduce((e,t)=>e+(t.activated?t.amount:0),0);return n>0&&r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"}},r.a.createElement(de.a,{title:t.formatMessage({id:"userCreditSettings.helpButton.caption",defaultMessage:"Learn how to earn and apply credits"}),href:Object(Be.a)("guides.referralsAndCredit"),analyticsFrom:"credit_settings"}),r.a.createElement("div",{style:{display:"flex",alignItems:"center",paddingRight:28,marginTop:16}},r.a.createElement("div",{style:{marginLeft:"auto",fontSize:14,color:this.theme.mediumTextColor}},r.a.createElement(g.a,{id:"userCreditSettings.otherWaysToEarnCreditSection.totalCreditSummaryText",defaultMessage:"Total credit earned"})),r.a.createElement("div",{style:{minWidth:44,fontWeight:K.a.fontWeight.semibold,textAlign:"right"}},Object(At.b)({amount:n,currency:"dollar",intl:t}))))}renderSettings(e){return r.a.createElement(q.a,null,this.renderCreditBalance(),this.renderReferralSection(e),this.renderOtherCreditWays(e),this.renderTotalCreditEarned(e))}renderCreditBalance(){var e=this;const{data:t,intl:n}=this.props,{availableCredit:i,totalCredit:s}=t,o=mt.a.state.data;if(!o)return;const l=fe.D(o),c=Math.floor(i/W.a.pricing.personal.monthlyPrice),d=s>=Ft.f;return r.a.createElement(a.Fragment,null,r.a.createElement(H.a,{large:!0,divider:"full"},r.a.createElement(g.a,{id:"userCreditSettings.creditBalanceSection.title",defaultMessage:"Credit balance"})),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:40,fontSize:14}},r.a.createElement("div",null,r.a.createElement(g.a,{id:"userCreditSettings.creditBalanceSection.creditBalanceMessage",defaultMessage:"Your current credit balance is {creditBalance}.",values:{creditBalance:r.a.createElement("b",{style:{color:this.theme.regularTextColor}},Object(At.b)({amount:i,currency:"dollar",intl:n}))}})," ",i>0&&!d&&r.a.createElement(g.a,{id:"userCreditSettings.creditBalanceSection.freeMonthMessage",description:"Message in sidebar letting user know how many months of free Notion they can get with their credits",defaultMessage:"{numberOfMonths, plural, one {That's equivalent to <b>{numberOfMonths} month</b> of the Personal Pro Plan.} other {That's equivalent to <b>{numberOfMonths} months</b> of the Personal Pro Plan.}}",values:{numberOfMonths:c,b:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return r.a.createElement("b",{style:{color:e.theme.regularTextColor}},n)}}}),d&&r.a.createElement(g.a,{id:"userCreditSettings.creditBalanceSection.maximumCreditBalanceExceeded",defaultMessage:"You've exceeded the maximum amount of credit per account, {maximumCreditBalance}. Any additional credit you earn will not increase your balance.",values:{maximumCreditBalance:Object(At.b)({amount:Ft.f,currency:"dollar",intl:n})}})),i>0&&r.a.createElement(te.a,{isLarge:!0,onClick:this.handleApplyCreditClick},l?ye.a.settingsBilling(Ua.applyCreditButtonIconStyle):ye.a.settingsUpgrade(Ua.applyCreditButtonIconStyle),l?n.formatMessage({id:"userCreditSettings.creditBalanceSection.applyCreditButton.label",defaultMessage:"Apply your credit"}):n.formatMessage({id:"userCreditSettings.creditBalanceSection.upgradeForFreeButton.label",defaultMessage:"Upgrade for free"}))))}getActionCredits(e){const{id:t}=this.environment.currentUser,{currentUserSettingsStore:n}=p.a.state;if(!t||!n)return[];const a=[],r=n.getValue();if(r&&Ft.e(r)){const n={id:"web_login_default",version:0,amount:Ft.a.web_login,activated:!1,created_timestamp:Date.now(),type:"web_login",user_id:t};a.push(e.find(e=>"web_login"===e.type)||n);const r={id:"desktop_login_default",version:0,amount:Ft.a.desktop_login,activated:!1,created_timestamp:Date.now(),type:"desktop_login",user_id:t};a.push(e.find(e=>"desktop_login"===e.type)||r);const i={id:"mobile_login_default",version:0,amount:Ft.a.mobile_login,activated:!1,created_timestamp:Date.now(),type:"mobile_login",user_id:t};a.push(e.find(e=>"mobile_login"===e.type)||i)}const i={id:"import_evernote_default",version:0,amount:Ft.a.import_evernote,activated:!1,created_timestamp:Date.now(),type:"import_evernote",user_id:t};a.push(e.find(e=>"import_evernote"===e.type)||i);const s={id:"browser_extension_default",version:0,amount:Ft.a.browser_extension,activated:!1,created_timestamp:Date.now(),type:"browser_extension",user_id:t};a.push(e.find(e=>"browser_extension"===e.type)||s);const o={id:"mobile_share_sheet_default",version:0,amount:Ft.a.mobile_share_sheet,activated:!1,created_timestamp:Date.now(),type:"mobile_share_sheet",user_id:t};return a.push(e.find(e=>"mobile_share_sheet"===e.type)||o),a}getInviteCredits(e){const t=e.find(e=>"invited_by_user"===e.type),n=e.filter(e=>"invited_user"===e.type&&!e.activated),a=e.filter(e=>"invited_user"===e.type&&e.activated);return s.a.compact([t,...s.a.sortBy(n,e=>-e.created_timestamp),...s.a.sortBy(a,e=>-e.created_timestamp)])}getHeaderContainerStyles(){return{borderBottom:"1px solid ".concat(this.theme.regularDividerColor),paddingBottom:4,marginBottom:12}}getHeaderStyles(){return{fontWeight:K.a.fontWeight.medium,fontSize:18}}getInviteCreditStyles(){return{marginBottom:44}}}Ua.showInviteCreditCount=3,Ua.applyCreditButtonIconStyle={width:20,height:20,marginRight:6};var _a=Object(g.g)(Ua);class Wa extends F.a{isMultipleAccounts(e){return Array.isArray(e)}isSingleAccount(e){return"string"==typeof e}isConnected(e){return this.isSingleAccount(e)||this.isMultipleAccounts(e)&&e.length>0}renderComponent(){const{account:e,intl:t}=this.props;return r.a.createElement(a.Fragment,null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",fontSize:14,paddingTop:2,paddingBottom:2}},this.renderIcon(),r.a.createElement("div",{style:{marginRight:"auto"}},r.a.createElement("div",null,this.props.appName),r.a.createElement("div",{style:{fontSize:12,color:this.theme.mediumTextColor}},this.props.caption)),r.a.createElement("div",{style:Wa.buttonWrapStyle},this.renderConnectButton(this.isConnected(e)?t.formatMessage({id:"connectedAppsSettingsItem.connectAnotherAccountLink",defaultMessage:"Connect another account",description:"Link that enables user to connect another account from a 3rd-party app (like Google Drive) to Notion, assuming they've already connected an account previously"}):t.formatMessage({id:"connectedAppsSettingsItem.connectAccountLink",defaultMessage:"Connect",description:"Link that enables user to connect an account from a 3rd-party app (like Google Drive) to Notion"})))),this.isSingleAccount(e)?this.renderAccount({accountName:e,onDisconnect:this.props.onDisconnect}):this.renderMultipleAccounts(),r.a.createElement(R.a,{size:12}))}renderIcon(){const{logo:e}=this.props;return r.a.createElement("img",{style:Wa.imageIconStyle,src:e})}renderConnectButton(e){return r.a.createElement(ia.a,{isBlue:!0,onClick:this.props.onConnect,style:Wa.buttonStyle},e)}renderAccount(e){const{accountName:t,onDisconnect:n,key:a}=e;return r.a.createElement("div",{key:a,style:{marginLeft:44}},r.a.createElement(R.a,{size:12}),r.a.createElement("div",{style:{display:"flex",alignItems:"center",height:32,marginBottom:2,fontSize:14}},r.a.createElement("div",{style:{marginRight:"auto"}},r.a.createElement("div",{style:{color:this.theme.mediumTextColor}},t)),r.a.createElement("div",{style:Wa.buttonWrapStyle},r.a.createElement(ia.a,{isRed:!0,onClick:()=>n(),style:Wa.buttonStyle},r.a.createElement(g.a,{id:"connectedAppsSettingsItem.disconnectLink",defaultMessage:"Disconnect",description:"If a user has connected an account from a 3rd-party app (like Google Drive) to Notion, they can click this link to disconnect the account."})))))}renderMultipleAccounts(){const e=this.props.account;if(this.isMultipleAccounts(e))return e.map(e=>this.renderAccount({accountName:e.accountName,onDisconnect:()=>{this.props.onDisconnect(e)},key:e.accountId}))}}Wa.iconSize=32,Wa.buttonStyle={marginLeft:14,marginRight:-4},Wa.buttonWrapStyle={minWidth:80,display:"flex",justifyContent:"flex-end"},Wa.imageIconStyle={flexShrink:0,width:Wa.iconSize,height:Wa.iconSize,borderRadius:3,marginRight:12,background:J.f.white};var Na=Object(g.g)(Wa);async function za(e){const t=await l.K(e,{});if("failed"===t.type){const e=t.error;return console.error(e),{drive:[],evernote:void 0,trello:void 0,asana:void 0}}return t.data}var Va=n(443),qa=n(1447),Ha=n(1448),Ga=n(1449);class Ya extends F.a{constructor(){super(...arguments),this.storeTypes={connectedAppsStatus:ge.a}}renderComponent(){return $.a.state.online?r.a.createElement(ra.a,{request:this.environment,performRequest:za,requestStore:this.stores.connectedAppsStatus,render:(e,t)=>t?this.renderConnectedAppsSettings(t):r.a.createElement("div",{style:Ya.loadingWrapStyle},r.a.createElement(V.a,null))}):this.renderOfflineMessage()}renderOfflineMessage(){return r.a.createElement(q.a,null,r.a.createElement(pe.a,{isSmall:!0,style:{textAlign:"center"}},r.a.createElement(g.a,{id:"connectedAppsSettings.offline.message",defaultMessage:"Please go online to manage connecting to apps."})))}renderSectionTitle(){return r.a.createElement(H.a,{large:!0,divider:"full"},r.a.createElement(g.a,{id:"connectedAppsSettings.connectedAppsSection.title",defaultMessage:"Connected apps"}))}renderConnectedAppsSettings(e){const{intl:t}=this.props,n=this.stores.connectedAppsStatus;return r.a.createElement("div",{style:Ya.wrapStyle},r.a.createElement(Dt.b,{style:Ya.scrollerStyle,type:Dt.a.Y},this.renderSectionTitle(),r.a.createElement(Na,{appName:"Google Drive",caption:t.formatMessage({id:"connectedAppsSettings.googleDrive.caption",defaultMessage:"Find and embed your files"}),logo:cn.a.images.import.googleDrivePng,account:n.state.result.drive,onConnect:()=>this.handleDriveAuth(),onDisconnect:e=>{this.handleDisconnectDrive(e)}}),r.a.createElement(Na,{appName:"Evernote",caption:t.formatMessage({id:"connectedAppsSettings.evernote.caption",defaultMessage:"Import notebooks"}),logo:cn.a.images.import.evernotePng,account:n.state.result.evernote,onConnect:()=>qa.a({environment:this.environment,requestStore:n}),onDisconnect:()=>async function(e,t){await l.w(e,{}),await t.refresh(),m.Bd(e,{name:"evernote"})}(this.environment,n)}),r.a.createElement(Na,{appName:"Trello",caption:t.formatMessage({id:"connectedAppsSettings.trello.caption",defaultMessage:"Import your boards"}),logo:cn.a.images.import.trelloPng,account:n.state.result.trello,onConnect:()=>Ga.a({environment:this.environment,requestStore:n}),onDisconnect:()=>async function(e,t){await l.x(e,{}),await t.refresh(),m.Bd(e,{name:"trello"})}(this.environment,n)}),r.a.createElement(Na,{appName:"Asana",caption:t.formatMessage({id:"connectedAppsSettings.asana.caption",defaultMessage:"Import tasks from boards and lists"}),logo:cn.a.images.import.asanaPng,account:n.state.result.asana,onConnect:()=>Ha.a({environment:this.environment,requestStore:n}),onDisconnect:()=>async function(e,t){await l.u(e,{}),await t.refresh(),m.Bd(e,{name:"asana"})}(this.environment,n)}),r.a.createElement("div",{style:{marginTop:8}},r.a.createElement(de.a,{title:t.formatMessage({id:"connectedAppsSettings.helpButton.caption",defaultMessage:"Learn more about embedding content in Notion"}),href:Object(Be.a)("guides.import"),analyticsFrom:"connected_apps_settings"}))))}async handleDriveAuth(){m.sd(this.environment,{name:"google",from:"connected_apps"}),await Va.f(this.environment),this.stores.connectedAppsStatus.refresh()}handleDisconnectDrive(e){const{intl:t}=this.props;d.c({message:t.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.message",defaultMessage:"Disconnecting disables file preview on Google Drive files embedded in all of your workspaces. It would not delete your embeds from Notion, so you can re-connect at anytime."}),showCancel:!0,keepFocus:!0,items:[{label:t.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.disconnectButton.label",defaultMessage:"Disconnect"}),color:"red",onAccept:async()=>{await l.v(this.environment,{googleUserId:e.accountId}),this.stores.connectedAppsStatus.refresh()}}]})}}Ya.loadingWrapStyle={alignItems:"center",display:"flex",flexDirection:"column",flex:1,height:"100%",justifyContent:"center"},Ya.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},Ya.scrollerStyle={height:"100%",padding:"36px 60px"};var Qa=Object(g.g)(Ya),Ka=n(34),Za=n(68),Xa=n(52),$a=n(193),Ja=n(588),er=n(58),tr=n(82);class nr extends E.a{getInitialState(){return{botName:"",botType:"space",spaceRole:"none"}}}var ar=nr,rr=n(288),ir=n(92),sr=n(613);async function or(e){const{environment:t,table:n,id:a,type:r}=e,i=await l.I(t,{table:n,id:a,type:r});return"failed"===i.type?(Object(d.d)(i),{botIds:[],recordMap:{}}):{botIds:i.data.botIds,recordMap:i.data.recordMap}}function lr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function cr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class dr extends F.a{constructor(){super(...arguments),this.storeTypes={botCreateStore:ar},this.renderModal=()=>r.a.createElement("div",null,this.renderBotNameSection(),r.a.createElement(ee.a,{isLarge:!0,style:{marginTop:24},onClick:this.handleCreateBot},"Create Bot")),this.handleChangeBotName=e=>{const t=this.stores.botCreateStore.state;this.stores.botCreateStore.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lr(Object(n),!0).forEach((function(t){cr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{botName:e.target.value}))},this.handleCreateBot=()=>{const{botName:e,spaceRole:t}=this.stores.botCreateStore.state,{userStore:n,spaceStore:a}=this.props,r=function(e){const{environment:t,name:n,spaceStore:a,spaceRole:r,userId:i}=e,s=Y.c(t),l=Object(o.b)({environment:t,table:$a.a,value:{name:n,parent_table:er.a,parent_id:a.id,created_at:Date.now(),created_by_table:yt.a,created_by_id:i,alive:!0,type:"guest"},inMemoryRecordCache:ir.a,transaction:s});return rr.f({environment:t,store:a,permissionItems:[{type:"bot_permission",role:r,bot_id:l.id}],transaction:s}),Y.b({environment:t,transaction:s}),l}({environment:this.environment,name:e,userId:n.id,spaceStore:a,spaceRole:t});this.props.onCreateBot(r)}}renderComponent(){return r.a.createElement(L.a,{open:!0,render:this.renderModal,onDismiss:this.props.onDismiss,innerStyle:{width:400,padding:24},preventHideChildrenWhileOpening:!0})}renderBotNameSection(){const{botName:e}=this.stores.botCreateStore.state;return r.a.createElement(r.a.Fragment,null,r.a.createElement(G.a,{style:{marginBottom:8}},"Bot Name"),r.a.createElement(z.b,{placeholder:"Hello World",value:e,onChange:this.handleChangeBotName}))}}var ur=Object(g.g)(dr),pr=n(47),mr=n(420),hr=n(156);class gr extends F.a{constructor(){super(...arguments),this.storeTypes={tokenOptionsButtonPopupStore:tr.a},this.handleViewApiTokenClick=async()=>{const e=await async function(e){const{environment:t,botId:n}=e,a=await l.H(t,{botId:n});if("failed"!==a.type)return a.data.token;Object(d.d)(a)}({environment:this.environment,botId:this.props.botStore.id});e&&d.c({message:r.a.createElement("div",{style:{width:"100%"}},r.a.createElement("header",{style:{marginBottom:8}},Object(hr.a)(this.props.botStore.getValue())),r.a.createElement(z.b,{type:"text",format:z.a.Default,value:e,disabled:!0,style:{height:32}})),showCancel:!1,keepFocus:!1,items:[{label:r.a.createElement(g.a,{id:"securitySAMLSettings.SCIMSection.viewTokenModal.copyButton.label",defaultMessage:"Copy token"}),color:"blue",onAccept:()=>{ot.c({environment:this.environment,stringValue:e})}},{label:r.a.createElement(g.a,{id:"securitySAMLSettings.SCIMSection.viewTokenModal.dismissButton.label",defaultMessage:"Close"}),onAccept:()=>{}}],innerStyle:{width:336}})},this.handleRevokeApiTokenClick=async()=>{const e=this.props.botStore.getValue();e&&await d.a({message:"scim"===e.type?r.a.createElement(g.a,{id:"securitySAMLSettings.SCIMSection.revokeTokenModal.message",defaultMessage:"Revoke SCIM token? All SCIM API requests that use this token will no longer succeed."}):r.a.createElement(g.a,{id:"botWithTokenSettings.revokeTokenModal.message",defaultMessage:"Revoke API token? All API requests that use this token will no longer succeed."}),acceptLabel:"scim"===e.type?r.a.createElement(g.a,{id:"securitySAMLSettings.SCIMSection.revokeTokenModal.acceptButton.label",defaultMessage:"Revoke SCIM token"}):r.a.createElement(g.a,{id:"botWithTokenSettings.revokeTokenModal.acceptButton.label",defaultMessage:"Revoke API token"}),cancelLabel:r.a.createElement(g.a,{id:"securitySAMLSettings.SCIMSection.revokeTokenModal.cancelButton.label",defaultMessage:"Cancel"})})&&await async function(e){const{environment:t,botId:n,tokenId:a}=e,r=await l.Ub(t,{botId:n,tokenId:a});if("failed"!==r.type)return!0;Object(d.d)(r)}({environment:this.environment,botId:e.id})&&d.f({message:"scim"===e.type?r.a.createElement(g.a,{id:"securitySAMLSettings.SCIMSection.tokenRevoked.message",defaultMessage:"SCIM token revoked successfully. A new token is available."}):r.a.createElement(g.a,{id:"botWithTokenSettings.revokeTokenModal.tokenRevoked.message",defaultMessage:"API token revoked successfully. A new token is now available."})})},this.handleDeleteBot=async()=>{await async function(e){const t=e.getValue();return Object(d.a)({message:r.a.createElement("span",null,r.a.createElement(g.a,{id:"botActions.deleteBotConfirmationDialog.confirmationMessage",defaultMessage:"Are you sure you want to delete {bot}?",values:{bot:r.a.createElement(sr.a,{botValue:t,inline:!0})}})),acceptLabel:r.a.createElement(g.a,{id:"botActions.deleteBotConfirmationDialog.confirmDeleteBotButton.label",defaultMessage:"Yes"})})}(this.props.botStore)&&(!function(e,t){const n=Y.c(e);Y.a({transaction:n,store:t,operation:{pointer:t.pointer,path:["alive"],command:"set",args:!1}}),Y.b({environment:e,transaction:n})}(this.environment,this.props.botStore),this.props.onDelete&&this.props.onDelete(this.props.botStore))}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:ct.b.MenuType.ActionSheet}:{menuType:ct.b.MenuType.Popup};const n=Boolean(this.props.onDelete);return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(sr.a,{botValue:this.props.botStore.getValue(),avatarSize:24,style:{fontSize:14,flex:1}}),r.a.createElement(ia.a,{onClick:()=>this.handleViewApiTokenClick(),isBlue:!0},r.a.createElement(g.a,{id:"securitySAMLSettings.SCIMSection.viewToken.label",defaultMessage:"View token"})),r.a.createElement(pr.a,{popupType:e.isMobile?pr.a.PopupType.SlideUp:pr.a.PopupType.Popup,buttonPopupStore:this.stores.tokenOptionsButtonPopupStore,renderOrigin:t=>r.a.createElement(mr.a,Object.assign({isMobile:e.isMobile},t,{style:{marginLeft:8,marginRight:8}})),render:e=>r.a.createElement(ct.b,Object.assign({},t),r.a.createElement(dt.a,{type:dt.a.Type.Vertical,sections:[{key:"token options",render:e=>r.a.createElement(pt.a,Object.assign({},e)),items:[{key:"revoke token",render:e=>r.a.createElement(ut.a,Object.assign({title:r.a.createElement(g.a,{id:"securitySAMLSettings.SCIMSection.revokeToken.label",defaultMessage:"Revoke token"}),icon:ye.a.showDeletedPages({width:18,fill:"currentColor"})},e)),action:()=>{this.handleRevokeApiTokenClick(),e.close()}},...n?[{key:"delete",action:()=>{this.handleDeleteBot(),e.close()},render:e=>r.a.createElement(ut.a,Object.assign({title:r.a.createElement(g.a,{id:"botWithTokenSettings.deleteBot.label",defaultMessage:"Delete bot"}),icon:ye.a.trash({width:18,fill:"currentColor"})},e))}]:[]]}],initialFocus:void 0}))}))}}var br=gr;function fr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function yr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fr(Object(n),!0).forEach((function(t){Sr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Sr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const vr=r.a.Fragment;class Er extends F.a{constructor(){super(...arguments),this.storeTypes={requestStore:ge.a,popupStore:tr.a},this.renderResult=(e,t,n)=>r.a.createElement(Ja.a,{loaded:n,spinnerSize:16,showSpinnerTimeout:600},e&&r.a.createElement("div",null,"Something went wrong..."),t&&this.renderBots(t)),this.renderBots=e=>{let{spaceBotIds:t}=e;return r.a.createElement(vr,null,r.a.createElement(H.a,{style:{marginTop:"2em"}},r.a.createElement(g.a,{id:"apiSettingsPage.bots.title",defaultMessage:"Bots",description:"Bots are the way to access the Notion API."})),r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{width:"90%",marginBottom:14}},r.a.createElement(g.a,{id:"apiSettingsPage.bots.description",defaultMessage:"Bots can only access content shared with the current workspace. To give access to private pages, share pages with the bot from the Share menu. <learnmorelink>Learn more</learnmorelink>",values:{learnmorelink:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement(we.a,{href:tn.d.publicApiGetStarted},t)}},description:"Bots are the way to access the Notion API. Inform users about what bots are and what they can do."})),r.a.createElement(ee.a,{isLarge:!0,onClick:this.handleOpenCreateBotModal},r.a.createElement(g.a,{id:"apiSettingsPage.bots.addBotbutton",defaultMessage:"Add bot",description:"Bots are the way to access the Notion API. Create a new bot."})),this.renderBotTable(t))},this.renderBotCreateModal=()=>{const{spaceStore:e,userStore:t}=this.props;return r.a.createElement(ur,{spaceStore:e,userStore:t,onCreateBot:this.handleCreateBot,onDismiss:this.handleCloseCreateBotModal})},this.handleDeleteBot=e=>{const t=this.stores.requestStore.state;t.result&&this.stores.requestStore.setState(yr({},t,{result:{spaceBotIds:t.result.spaceBotIds.filter(t=>t!==e.id),userBotIds:t.result.userBotIds.filter(t=>t!==e.id)}}))},this.handleCreateBot=e=>{const t=e.getValue();if(t){const e=this.stores.requestStore.state;e.result&&this.stores.requestStore.setState(yr({},e,{result:{spaceBotIds:t.parent_table===er.a?[...e.result.spaceBotIds,t.id]:e.result.spaceBotIds,userBotIds:t.parent_table===yt.a?[...e.result.userBotIds,t.id]:e.result.userBotIds}}))}this.handleCloseCreateBotModal()},this.handleOpenCreateBotModal=()=>{this.stores.popupStore.setState({open:!0})},this.handleCloseCreateBotModal=()=>{this.stores.popupStore.setState({open:!1})},this.fetchUserAndSpaceBots=async e=>{let{userId:t,spaceId:n}=e;const[a,r]=await Promise.all([or({environment:this.environment,table:yt.a,id:t,type:"guest"}),or({environment:this.environment,table:er.a,id:n,type:"guest"})]);return{userBotIds:a.botIds,spaceBotIds:r.botIds}}}renderComponent(){return r.a.createElement("div",{style:Er.wrapStyle},r.a.createElement(Dt.b,{style:Er.scrollerStyle,type:Dt.a.Y},r.a.createElement(de.a,{title:"Read the Notion API documentation.",href:tn.d.publicAPISpec,analyticsFrom:"api"}),r.a.createElement(R.a,{size:32,style:{marginBottom:16}}),this.renderRequest(),this.stores.popupStore.state.open&&this.renderBotCreateModal()))}renderRequest(){const{spaceStore:e,userStore:t}=this.props;return r.a.createElement(ra.a,{requestStore:this.stores.requestStore,request:{spaceId:e.id,userId:t.id},performRequest:this.fetchUserAndSpaceBots,render:this.renderResult})}renderBotTable(e){const{spaceStore:t}=this.props,n=e.map(e=>Object(Xa.c)(t,{table:$a.a,id:e}));if(n.length>0)return r.a.createElement(vr,null,r.a.createElement(R.a,{size:16,style:{marginTop:16}}),r.a.createElement("div",null,n.map(e=>r.a.createElement(vr,{key:e.id},r.a.createElement(br,{botStore:e,onDelete:this.handleDeleteBot}),r.a.createElement(R.a,{size:16})))))}}Er.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},Er.scrollerStyle={height:"100%",padding:"36px 60px"};var Mr=Object(g.g)(Er),Cr=n(360),Or=n(203);function wr(e,t){return"".concat(function(e){return"".concat(e||"https://www.notion.so").concat(tn.d.samlAuth)}(t),"/").concat(e)}var kr=n(722),Pr=n(1445),Tr=n(232),Ir=n(161);function jr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Dr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jr(Object(n),!0).forEach((function(t){xr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Br extends F.a{constructor(){super(...arguments),this.storeTypes={botsRequestStore:ge.a,tokenOptionsButtonPopupStore:tr.a},this.renderScimBotTokens=(e,t,n)=>{if(!n)return r.a.createElement(V.a,null);if(t&&!e){const{botIds:e}=t,n=e[0]&&Object(Xa.c)(this.props.spaceStore,{table:$a.a,id:e[0]});return r.a.createElement(a.Fragment,null,r.a.createElement(R.a,{size:48,style:{opacity:0}}),r.a.createElement("div",{style:this.getHeaderStyle()},r.a.createElement("span",{style:{marginRight:8}},r.a.createElement(g.a,{id:"securitySAMLSettings.SCIMSection.title",defaultMessage:"SCIM configuration"})),"enterprise"!==fe.i(this.environment)&&r.a.createElement(gt.a,{subscriptionTier:"enterprise",analyticsName:"space_saml",onClick:this.handleUpgradeClick,desktopStyle:{marginTop:-1}})),n&&r.a.createElement(br,{botStore:n})||"enterprise"===fe.i(this.environment)&&this.renderScimContactUs(),this.renderScimHelp())}},this.handleDisablePublicAccessSwitcherClick=async()=>{const{securitySettingsStore:e}=this.props,t=e.state.disablePublicAccess;if(!t){if(!(await d.a({message:r.a.createElement(g.a,{id:"securitySAMLSettings.preventPublicSharing.confirmationModal.message",defaultMessage:"Are you sure? This will remove access for anyone who is not a member or guest of the workspace from all pages in this workspace."}),acceptLabel:r.a.createElement(g.a,{id:"securitySAMLSettings.preventPublicSharing.confirmationModal.confirmButton.label",defaultMessage:"Yes"})})))return}e.setState(Dr({},e.state,{disablePublicAccess:!t}))},this.handleAllowDisableGuestsSwitcherClick=async()=>{const{securitySettingsStore:e}=this.props,t=e.state.disableGuests;if(!t){if(!(await d.a({message:r.a.createElement(g.a,{id:"securitySAMLSettings.disableGuests.confirmationModal.message",defaultMessage:"Are you sure? All guests in this workspace will be removed."}),acceptLabel:r.a.createElement(g.a,{id:"securitySAMLSettings.disableGuests.confirmationModal.confirmButton.label",defaultMessage:"Yes"})})))return}e.setState(Dr({},e.state,{disableGuests:!t}))},this.handleDisableMoveToSwitcherClick=()=>{const{securitySettingsStore:e}=this.props;e.setState(Dr({},e.state,{disableMoveToSpace:!e.state.disableMoveToSpace}))},this.handleAllowDisableWorkspaceTopLevelSwitcherClick=()=>{const{securitySettingsStore:e}=this.props;e.setState(Dr({},e.state,{disableSpacePageEdits:!e.state.disableSpacePageEdits}))},this.handleDisableExportClick=()=>{const{securitySettingsStore:e}=this.props;e.setState(Dr({},e.state,{disableExport:!e.state.disableExport}))},this.handleDisablePublicAccessRequestsClick=()=>{const{securitySettingsStore:e}=this.props;e.setState(Dr({},e.state,{disablePublicAccessRequests:!e.state.disablePublicAccessRequests}))},this.handleUpdateClick=async()=>{await Promise.all([this.saveSecuritySettings(),this.saveSamlConfig()]),this.props.securitySettingsStore.state.error?d.d(this.props.securitySettingsStore.state.error):this.closeSettings()},this.handleCancelClick=()=>{this.closeSettings()},this.handleEnableSamlToggle=()=>{if(!this.isSamlEditable())return;const{state:e}=this.props.samlConfigStore,t=!this.isInvalidSamlConfig(e);"unconfigured"===e.status||"disabled"===e.status?t&&this.props.samlConfigStore.setState(Dr({},e,{status:"configured"})):this.props.samlConfigStore.setState(Dr({},e,{status:t?"disabled":"unconfigured"}))},this.handleIdpMetadataUrlChange=e=>{this.props.samlConfigStore.setState(Dr({},this.props.samlConfigStore.state,{idpMetadataUrl:e.target.value}))},this.handleIdpMetadataUrlBlur=e=>{Boolean(e.target.value)&&this.setUseMetadataUrl(!0)},this.handleIdpMetadataChange=e=>{this.props.samlConfigStore.setState(Dr({},this.props.samlConfigStore.state,{idpMetadata:e.target.value}))},this.handleIdpMetadataBlur=e=>{Boolean(e.target.value)&&this.setUseMetadataUrl(!1)},this.handleEnforceSamlToggle=()=>{const{state:e}=this.props.samlConfigStore;if(this.isSamlEditable()&&!this.isInvalidSamlConfig(e)){const t="enforced"===e.status?"configured":"enforced";this.props.samlConfigStore.setState(Dr({},e,{status:t}))}},this.handleCreateAccountToggle=()=>{const{state:e}=this.props.samlConfigStore;this.isSamlEditable()&&this.props.samlConfigStore.setState(Dr({},e,{createAccount:!e.createAccount}))},this.handleEmailDomainContactUsClick=()=>{Me.a({environment:this.environment,from:"saml_settings",prepopulatedContent:"Request to add or change an email domain for SAML Single Sign-on on workspace ".concat(this.props.spaceStore.id,".")})},this.handleWorkspaceContactUsClick=()=>{Me.a({environment:this.environment,from:"saml_settings",prepopulatedContent:"Request to add or remove a workspace for SAML Single Sign-on on workspace ".concat(this.props.spaceStore.id,".")})},this.handleUpgradeClick=()=>{Cr.a(this.environment,{from:"space_saml",for:"enterprise"})},this.handleScimTokenContactUsClick=()=>{Me.a({environment:this.environment,from:"saml_settings",prepopulatedContent:"Request to generate a SCIM API token for workspace ".concat(this.props.spaceStore.id,".")})},this.setUseMetadataUrl=e=>{this.props.samlConfigStore.setState(Dr({},this.props.samlConfigStore.state,{useMetadataUrl:e}))}}renderComponent(){return $.a.state.online?r.a.createElement(q.a,{controlRow:this.renderControlRow()},this.renderSecuritySettings(),this.renderSamlSettings(),this.renderScimSettings()):this.renderOfflineMessage()}renderUpsell(){if(!this.isSecuritySubscribed())return r.a.createElement("div",{style:{border:"1px solid ".concat(this.theme.regularDividerColor),borderRadius:3,padding:16,marginTop:Object(Ir.f)(this.environment)?void 0:24,marginBottom:24}},r.a.createElement(Pr.a,{for:"enterprise",from:"space_saml",icon:ye.a.key,title:r.a.createElement(g.a,{id:"securitySAMLSettings.upsell.title",defaultMessage:"Upgrade for advanced security, SAML & SCIM"}),caption:r.a.createElement(g.a,{id:"securitySAMLSettings.upsell.caption",defaultMessage:"Upgrade to the Enterprise Plan for advanced security settings, SAML single sign-on, and automated user and group provisioning."}),learnMoreRoute:"guides.securitySettings"}))}renderSecuritySettings(){const{securitySettingsStore:e}=this.props,t=r.a.createElement(gt.a,{subscriptionTier:"enterprise",analyticsName:"space_saml",onClick:this.handleUpgradeClick,desktopStyle:{display:"inline-block",marginLeft:8,marginTop:-3}}),n=n=>r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleDisablePublicAccessSwitcherClick:this.handleUpgradeClick},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.a,{id:"securitySAMLSettings.securitySection.preventPublicSharing.label",defaultMessage:"Prevent members from sharing pages publicly"}),!n&&t,r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.a.createElement(g.a,{id:"securitySAMLSettings.securitySection.preventPublicSharing.caption",defaultMessage:"This will disable the Share to web option in the Share menu on every page in this workspace."}))),r.a.createElement("div",{style:{marginTop:5,opacity:n?void 0:.5}},r.a.createElement(mn.a,{on:e.state.disablePublicAccess,disabled:!n}))),r.a.createElement(R.a,{size:24,style:{opacity:0}})),i=n=>r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleAllowDisableWorkspaceTopLevelSwitcherClick:this.handleUpgradeClick},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.a,{id:"securitySAMLSettings.securitySection.disableSpacePageEdits.label",defaultMessage:"Prevent members from changing the Workspace section"}),!n&&t,r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"85%"}},r.a.createElement(g.a,{id:"securitySAMLSettings.securitySection.disableSpacePageEdits.caption",defaultMessage:"This disables the ability for members to create, move, reorder, and delete top-level Workspace pages."}))),r.a.createElement("div",{style:{marginTop:5,opacity:n?void 0:.5}},r.a.createElement(mn.a,{on:e.state.disableSpacePageEdits,disabled:!n}))),r.a.createElement(R.a,{size:24,style:{opacity:0}})),s=n=>r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleAllowDisableGuestsSwitcherClick:this.handleUpgradeClick},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.a,{id:"securitySAMLSettings.securitySection.disableGuests.label",defaultMessage:"Disable guests"}),!n&&t,r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.a.createElement(g.a,{id:"securitySAMLSettings.securitySection.disableGuests.caption",defaultMessage:"This prevents anyone from inviting people outside the workspace to any page."}))),r.a.createElement("div",{style:{marginTop:5,opacity:n?void 0:.5}},r.a.createElement(mn.a,{on:e.state.disableGuests,disabled:!n}))),r.a.createElement(R.a,{size:24,style:{opacity:0}})),o=n=>r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleDisableMoveToSwitcherClick:this.handleUpgradeClick},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.a,{id:"securitySAMLSettings.securitySection.disableMovingPages.label",defaultMessage:"Disable moving or duplicating pages to other workspaces"}),!n&&t,r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.a.createElement(g.a,{id:"securitySAMLSettings.securitySection.disableMovingPages.caption",defaultMessage:"This prevents anyone from moving or duplicating pages to other workspaces via the Move To or Duplicate To action."}))),r.a.createElement("div",{style:{marginTop:5,opacity:n?void 0:.5}},r.a.createElement(mn.a,{on:e.state.disableMoveToSpace,disabled:!n}))),r.a.createElement(R.a,{size:24,style:{opacity:0}})),{state:l}=e,c=n=>r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleDisableExportClick:this.handleUpgradeClick},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.a,{id:"securitySAMLSettings.securitySection.disableExport.label",defaultMessage:"Disable export"}),!n&&t,r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.a.createElement(g.a,{id:"securitySAMLSettings.securitySection.disableExport.caption",defaultMessage:"This prevents anyone from exporting as Markdown, CSV, or PDF."}))),r.a.createElement("div",{style:{marginTop:5,opacity:n?void 0:.5}},r.a.createElement(mn.a,{on:e.state.disableExport,disabled:!n}))),r.a.createElement(R.a,{size:24,style:{opacity:0}})),d=n=>{if(Object(Ir.f)(this.environment))return r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleDisablePublicAccessRequestsClick:this.handleUpgradeClick},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.a,{id:"securitySAMLSettings.securitySection.disablePublicAccessRequests.label",defaultMessage:"Disable page access requests from non-members"}),!n&&t,r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.a.createElement(g.a,{id:"securitySAMLSettings.securitySection.disablePublicAccessRequests.caption",defaultMessage:"This prevents anyone with the link to a page from requesting access. Workspace members can always request access."}))),r.a.createElement("div",{style:{marginTop:5,opacity:n?void 0:.5}},r.a.createElement(mn.a,{on:e.state.disablePublicAccessRequests,disabled:!n}))),r.a.createElement(R.a,{size:24,style:{opacity:0}}))};return this.isSecuritySubscribed()?r.a.createElement(a.Fragment,null,r.a.createElement(H.a,{large:!0,divider:"full"},r.a.createElement(g.a,{id:"securitySAMLSettings.securitySection.title",defaultMessage:"Security"})),d(!0),n(!0),i(!0),s(!0),o(!0),c(!0),r.a.createElement("div",{style:{height:36}})):r.a.createElement(a.Fragment,null,this.renderUpsell(),r.a.createElement("div",{style:this.getHeaderStyle()},r.a.createElement("span",{style:{marginRight:8}},r.a.createElement(g.a,{id:"securitySAMLSettings.securitySection.title",defaultMessage:"Security"}))),d(!0),n(l.disablePublicAccess),i(l.disableSpacePageEdits),s(l.disableGuests),o(l.disableMoveToSpace),c(l.disableExport),r.a.createElement("div",{style:{height:32}}))}renderSamlSettings(){return r.a.createElement(ra.a,{request:{environment:this.environment,spaceId:this.props.spaceStore.id,store:this.props.samlConfigStore},performRequest:D,render:(e,t,n)=>n?t&&!e?this.isSamlAvailable()?this.renderSamlConfig():this.renderUpgradeSamlPrompt():void 0:r.a.createElement(V.a,null)})}renderSamlHelp(){return r.a.createElement("div",{style:{marginTop:18,marginBottom:24}},r.a.createElement(de.a,{title:r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSection.helpButton.label",defaultMessage:"Learn about SAML and single sign-on"}),href:Object(Be.a)("guides.samlSettings"),analyticsFrom:"saml_settings"}))}renderSamlUneditable(e){if(this.isSamlEditable()||!e)return;const t=Tr.a.getPublicSpaceData(this.environment,e);return t?r.a.createElement("div",{style:{marginBottom:24}},r.a.createElement(pe.a,{isMultiline:!0},r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSection.uneditableMessage",defaultMessage:"SAML is being managed by the workspace <bold>{workspaceName}</bold>. Please go there to change any SAML settings.",values:{workspaceName:t.name,bold:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.a.createElement("span",{style:{fontWeight:K.a.fontWeight.semibold}},t)}}}))):void 0}renderUpgradeSamlPrompt(){return r.a.createElement("div",null,r.a.createElement(a.Fragment,null,r.a.createElement("div",{style:this.getHeaderStyle()},r.a.createElement("span",{style:{marginRight:8}},r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.title",defaultMessage:"SAML single sign-on"})),r.a.createElement(gt.a,{subscriptionTier:"enterprise",analyticsName:"space_saml",onClick:this.handleUpgradeClick,desktopStyle:{marginTop:-1}})),this.renderSamlHelp()))}renderEmailDomains(e){var t=this;return r.a.createElement(a.Fragment,null,r.a.createElement(H.a,{smallMarginBottom:!0},r.a.createElement(g.a,{id:"securitySAMLSettings.emailDomainsSection.title",defaultMessage:"Email domains"})),r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:Dr({},Br.captionStyle,{marginBottom:12,marginTop:2})},r.a.createElement(g.a,{id:"securitySAMLSettings.emailDomainsSection.emailInput.caption",defaultMessage:"Once you enable SAML, anyone using an email address with the domains below will be able to log in using SAML SSO. <contactlink>Contact support</contactlink> to add or remove a domain.",values:{contactlink:function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return r.a.createElement(we.a,{onClick:t.handleEmailDomainContactUsClick},n)}}})),r.a.createElement("div",{style:{height:32}},r.a.createElement(rt,{placeholder:this.props.intl.formatMessage({id:"securitySAMLSettings.emailDomainsSection.emailInput.placeholder",defaultMessage:"No email domains configured"}),value:"",onChange:()=>{},onRemoveLastToken:()=>{},readOnly:!0,tokens:e.map(e=>r.a.createElement(it.b,{showRemoveButton:!1,isSingle:!1,format:it.b.Format.Medium,key:e,value:e}))})),r.a.createElement(R.a,{size:40}))}renderSpaceNames(e){var t=this;if(!this.isSamlEditable())return;const n=e.map(e=>Tr.a.getPublicSpaceData(this.environment,e)).filter(e=>Boolean(e));return n.length<=1?void 0:r.a.createElement(a.Fragment,null,r.a.createElement(H.a,{smallMarginBottom:!0},r.a.createElement(g.a,{id:"securitySAMLSettings.spaceNamesSection.title",defaultMessage:"Workspaces"})),r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:Dr({},Br.captionStyle,{marginBottom:12,marginTop:2})},r.a.createElement(g.a,{id:"securitySAMLSettings.spaceNamesSection.spaceNameInput.caption",defaultMessage:"The SAML settings here apply to multiple workspaces. <contactlink>Contact support</contactlink> to add or remove a workspace.",values:{contactlink:function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return r.a.createElement(we.a,{onClick:t.handleWorkspaceContactUsClick},n)}}})),r.a.createElement("div",{style:{height:32}},r.a.createElement(rt,{placeholder:"",value:"",onChange:()=>{},onRemoveLastToken:()=>{},readOnly:!0,tokens:n.map(e=>r.a.createElement(it.b,{showRemoveButton:!1,isSingle:!1,format:it.b.Format.Medium,key:e.id,value:e.name}))})),r.a.createElement(R.a,{size:40}))}renderSingleSignOnUrl(){const e=wr(this.props.spaceStore.id),t=r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.url.tooltip",defaultMessage:"Copy link"});return r.a.createElement(a.Fragment,null,r.a.createElement(H.a,null,r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.title",defaultMessage:"Single sign-on URL"})),r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:Dr({},Br.captionStyle,{marginTop:2})},r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.url.caption",defaultMessage:"Enter this in your Identity Provider's SAML configuration."})),r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",alignItems:"flex-start",marginTop:12,marginBottom:6}},r.a.createElement(z.b,{type:"text",format:z.a.Default,value:e,disabled:!0,style:{borderTopRightRadius:0,borderBottomRightRadius:0,width:"calc(100% - 90px)",height:32}}),r.a.createElement(ee.a,{onClick:()=>{ot.c({environment:this.environment,stringValue:e})},style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,width:90},isLarge:!0},t))))}renderIdpSettings(e){return r.a.createElement(a.Fragment,null,r.a.createElement(ia.a,{style:this.getRadioTitleStyle(),onClick:e=>{this.setUseMetadataUrl(!0)},disabled:!this.isSamlEditable()},r.a.createElement(kr.a,{isSelected:Boolean(e.useMetadataUrl)})," ",r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataURLOption.label",defaultMessage:"IDP metadata URL"})),r.a.createElement("div",{style:{maxWidth:"100%",marginLeft:32}},r.a.createElement(z.b,{value:e.idpMetadataUrl,onChange:this.handleIdpMetadataUrlChange,onBlur:this.handleIdpMetadataUrlBlur,placeholder:"https://...",style:{height:32},readOnly:!this.isSamlEditable()})),r.a.createElement(ia.a,{style:this.getRadioTitleStyle(),onClick:e=>{this.setUseMetadataUrl(!1)},disabled:!this.isSamlEditable()},r.a.createElement(kr.a,{isSelected:!e.useMetadataUrl})," ",r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataXMLOption.label",defaultMessage:"IDP metadata XML"})),r.a.createElement("div",{style:{maxWidth:"100%",marginLeft:32}},r.a.createElement(z.b,{textarea:!0,value:e.idpMetadata,onChange:this.handleIdpMetadataChange,onBlur:this.handleIdpMetadataBlur,placeholder:this.props.intl.formatMessage({id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataXMLOption.input.placeholder",defaultMessage:"IDP metadata XML"}),readOnly:!this.isSamlEditable()}),r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:Br.captionStyle},r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataXMLOption.caption",defaultMessage:"Enter the value provided by your Identity Provider (IDP)."}))))}renderCreateAccountToggle(e){const t=!this.isSamlEditable();return r.a.createElement("div",null,r.a.createElement(R.a,{size:24,style:{marginTop:12}}),r.a.createElement("div",{style:Br.settingOptionStyle(t),onClick:this.handleCreateAccountToggle},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.automaticallyCreateAccounts.label",defaultMessage:"Automatically create accounts on sign-in"}),r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:Br.captionStyle},r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.automaticallyCreateAccounts.caption",defaultMessage:"Allow users to create Notion accounts without provisioning from the IDP."}))),r.a.createElement(mn.a,{on:e,disabled:t})),r.a.createElement(R.a,{size:24}))}renderEnableSamlToggle(e,t){return r.a.createElement("div",null,r.a.createElement("div",{style:Br.settingOptionStyle(t||!this.isSamlEditable()),onClick:this.handleEnableSamlToggle},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enableSAML.label",defaultMessage:"Enable SAML"}),r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:Br.captionStyle},r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enableSAML.caption",defaultMessage:"This allows users with emails on the configured domains to log in with SAML. SAML authentication can be enforced below."}))),r.a.createElement("div",null,t?r.a.createElement(st.a,{delayThreshold:0,renderTooltip:()=>r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enableSAML.tooltip",defaultMessage:"SAML can be enabled once it is fully configured."}),alignment:Or.a.End,render:e=>r.a.createElement("div",Object.assign({},e),r.a.createElement(mn.a,{on:!1,disabled:!0}))}):r.a.createElement(mn.a,{on:"disabled"!==e&&"unconfigured"!==e,disabled:!this.isSamlEditable()}))),r.a.createElement(R.a,{size:24}))}renderEnforceSamlToggle(e,t){return r.a.createElement("div",{style:Br.settingOptionStyle(t||!this.isSamlEditable()),onClick:this.handleEnforceSamlToggle},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enforceSAML.label",defaultMessage:"Enforce SAML"}),r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:Br.captionStyle},r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enforceSAML.captionMulti",defaultMessage:"Once enforced, workspace members with an email on the domains configured above can only use SAML SSO to log in. Administrator accounts can still log in using email."}))),r.a.createElement("div",null,t?r.a.createElement(st.a,{delayThreshold:0,renderTooltip:()=>r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enforceSAML.tooltip",defaultMessage:"Enable SAML to access this option."}),alignment:Or.a.End,render:e=>r.a.createElement("div",Object.assign({},e),r.a.createElement(mn.a,{on:!1,disabled:!0}))}):r.a.createElement(mn.a,{on:"enforced"===e,disabled:!this.isSamlEditable()})))}renderSamlConfig(){const e=this.props.samlConfigStore.state,t=this.isInvalidSamlConfig(e);return r.a.createElement(a.Fragment,null,r.a.createElement("div",{style:this.getHeaderStyle()},r.a.createElement(g.a,{id:"securitySAMLSettings.SAMLSingleSignOnSection.title",defaultMessage:"SAML single sign-on"})),this.renderSamlHelp(),this.renderSamlUneditable(e.id),this.renderEmailDomains(e.emailDomains),this.renderSpaceNames(e.spaceIds),this.renderSingleSignOnUrl(),this.renderIdpSettings(e),this.renderCreateAccountToggle(e.createAccount),this.renderEnableSamlToggle(e.status,t),this.renderEnforceSamlToggle(e.status,t))}renderScimSettings(){return r.a.createElement(ra.a,{requestStore:this.stores.botsRequestStore,request:{environment:this.environment,table:er.a,id:this.props.spaceStore.id,type:"scim"},performRequest:or,render:this.renderScimBotTokens})}renderScimContactUs(){var e=this;return r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:Br.captionStyle},r.a.createElement(g.a,{id:"securitySAMLSettings.SCIMSection.contactUs",defaultMessage:"To generate a SCIM API token, please <contactlink>contact support</contactlink>.",values:{contactlink:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return r.a.createElement(we.a,{onClick:e.handleScimTokenContactUsClick},n)}}}))}renderScimHelp(){return r.a.createElement("div",{style:{marginTop:18,marginBottom:24}},r.a.createElement(de.a,{title:r.a.createElement(g.a,{id:"securitySAMLSettings.SCIMSection.helpButton.label",defaultMessage:"Learn about SCIM"}),href:Object(Be.a)("guides.scim"),analyticsFrom:"scim_settings"}))}renderControlRow(){if(this.isSecuritySubscribed()||Object(Ir.f)(this.environment))return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(ee.a,{isLarge:!0,onClick:this.handleUpdateClick},r.a.createElement(g.a,{id:"securitySAMLSettings.updateButton.label",defaultMessage:"Update"})),r.a.createElement(te.a,{isLarge:!0,style:{marginLeft:12},onClick:this.handleCancelClick},r.a.createElement(g.a,{id:"securitySAMLSettings.cancelButton.label",defaultMessage:"Cancel"})))}renderOfflineMessage(){return r.a.createElement(q.a,null,r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{textAlign:"center"}},r.a.createElement(g.a,{defaultMessage:"Please go online to manage security settings.",id:"securitySAMLSettings.offline.message"})))}closeSettings(){A.a.setState(Dr({},A.a.state,{open:!1}))}isSamlAvailable(){return this.props.samlConfigStore.state.emailDomains.length>0||"enterprise"===fe.i(this.environment)}isSamlEditable(){const e=this.props.samlConfigStore.state;return this.isSamlAvailable()&&(!e.id||e.id===this.props.spaceStore.id)}isSecuritySubscribed(){const e=fe.i(this.environment);if("enterprise"===e)return!0;if("team"===e||"team_free"===e){const{data:e}=mt.a.state,t=fe.o(e);return e&&t&&"subscribed_admin"===e.type&&t.created<M.d}return!1}isInvalidSamlConfig(e){return 0===e.emailDomains.length||e.useMetadataUrl&&!e.idpMetadataUrl||!e.useMetadataUrl&&!e.idpMetadata}saveSecuritySettings(){const{securitySettingsStore:e,spaceStore:t}=this.props,{disablePublicAccess:n,disableGuests:a,disableMoveToSpace:r,disableExport:i,disableSpacePageEdits:s,disablePublicAccessRequests:o}=e.state;return Y.d(this.environment,e=>{S.x({environment:this.environment,transaction:e,spaceStore:t,disablePublicAccess:n,disableGuests:a,disableMoveToSpace:r,disableExport:i,disableSpacePageEdits:s,disablePublicAccessRequests:o})})}async saveSamlConfig(){if(this.isSamlAvailable()){const e=this.props.samlConfigStore.state,t=await l.b(this.environment,{spaceId:this.props.spaceStore.id,status:e.status,useMetadataUrl:e.useMetadataUrl,idpMetadataUrl:e.idpMetadataUrl,idpMetadata:e.idpMetadata,createAccount:e.createAccount});"failed"===t.type&&this.props.securitySettingsStore.setState(Dr({},this.props.securitySettingsStore.state,{error:t}))}}static settingOptionStyle(){return{display:"flex",alignItems:"center",width:"100%",cursor:arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"default":"pointer"}}getHeaderStyle(){return{fontWeight:K.a.fontWeight.medium,fontSize:18,borderBottom:"1px solid ".concat(this.theme.regularDividerColor),paddingBottom:6,marginBottom:12,display:"flex",alignItems:"center"}}getTitleStyle(){return{fontSize:14,marginRight:8,flexGrow:1}}getRadioTitleStyle(){return{marginTop:8,marginBottom:4}}}Br.captionStyle={marginTop:4,width:"85%"};var Ar=Object(g.g)(Br);var Fr=function(e){return e=s.a.assign({percent:.1},e),r.a.createElement("div",{style:s.a.assign({position:"relative",minWidth:30,height:5,borderRadius:1,overflow:"hidden"},e.style)},r.a.createElement("div",{style:{position:"absolute",top:0,left:0,height:"100%",width:"100%",background:"currentColor",opacity:.1}}),r.a.createElement("div",{style:{position:"absolute",top:0,left:0,height:"100%",width:"".concat(100*e.percent,"%"),minWidth:2,background:"currentColor",opacity:.6}}))};class Rr extends F.a{constructor(){super(...arguments),this.handleClick=()=>{Cr.a(this.environment,{from:"sidebar"===this.props.source?"block_limit_sidebar":"block_limit_settings",for:"team"})}}renderComponent(){const{data:e}=mt.a.state;if(!e||!fe.M(this.environment))return;const t=fe.q(this.environment,e);return"sidebar"===this.props.source&&t<ue.a?void 0:r.a.createElement(a.Fragment,null,this.renderDivider("settings"===this.props.source),r.a.createElement(Ka.a,{style:Rr.buttonStyle,onClick:this.handleClick},r.a.createElement("div",{style:Rr.headerStyle},r.a.createElement(g.a,{id:"spaceSettings.sidebar.upgradeLink",defaultMessage:"Upgrade to go unlimited"})),r.a.createElement("div",{style:Rr.labelStyle},r.a.createElement("div",{style:this.usageLabelStyle(t)},fe.p(this.environment,e)),r.a.createElement(Fr,{style:{marginTop:12,marginBottom:12},percent:t}),r.a.createElement("div",{style:Rr.ctaStyle},r.a.createElement(g.a,{id:"spaceSettings.sidebar.button.upgrade",defaultMessage:"Upgrade plan"})))))}renderDivider(e){return e?r.a.createElement(R.a,{size:27,style:{paddingLeft:14,paddingRight:14}}):r.a.createElement(R.a,{size:0})}usageLabelStyle(e){return e>ue.b?this.theme.calloutBlockColors.red:{}}}Rr.buttonStyle={padding:14,fontSize:12,lineHeight:1.4},Rr.headerStyle={fontWeight:500,lineHeight:2},Rr.labelStyle={fontWeight:400},Rr.ctaStyle={textDecoration:"underline"};var Lr=Rr,Ur=n(789),_r=n(278);function Wr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Nr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wr(Object(n),!0).forEach((function(t){zr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Vr extends F.a{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:tr.a},this.handleSelectChange=e=>{const{label:t}=this.getItemLabelAndCaption(e);if(this.props.confirm){const n=()=>{this.props.onChange(e)};d.c({showCancel:!0,keepFocus:!1,message:r.a.createElement(g.a,{id:"languagePicker.changeLanguage.confirmationMessage",defaultMessage:"Are you sure you want to update the language to {language}?",values:{language:t}}),items:[{label:r.a.createElement(g.a,{id:"languagePicker.changeLanguage.updateButton.label",defaultMessage:"Update"}),color:"red",onAccept:n}]})}else this.props.onChange(e)}}renderComponent(){const{device:e}=this.environment;if(!e.isMobile)return r.a.createElement(pr.a,{popupType:pr.a.PopupType.Popup,buttonPopupStore:this.stores.buttonPopupStore,renderOrigin:e=>r.a.createElement(ia.a,Object.assign({style:{marginLeft:-8,paddingLeft:8,paddingRight:8}},e),this.getItemLabelAndCaption(this.props.currentLocale).label,ye.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})),placementToOrigin:_r.b.Bottom,alignmentToOrigin:_r.a.Start,render:e=>{let t;t="on"===xe.a.getGroup(this.environment,"polyglot")?[...Ur.a,...Ur.b]:Ur.a;const n=[{key:"languages",render:e=>r.a.createElement(pt.a,Object.assign({},e,{topBorder:0!==e.index})),items:t.map(t=>({key:t,render:e=>this.getItem(t,e.focused,e),action:()=>{this.handleSelect(t),e.close()}}))}],a={menuType:ct.b.MenuType.Popup,width:216};return r.a.createElement(ct.b,Object.assign({className:Za.A},a),r.a.createElement(dt.a,{type:dt.a.Type.Vertical,initialFocus:void 0,sections:n}))}})}renderItem(e){return r.a.createElement(ut.a,Object.assign({},e.props,{title:r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement("div",{style:Nr({},e.style,{marginRight:0})},e.label)),caption:e.caption&&r.a.createElement("span",{style:{color:this.theme.mediumTextColor}},e.caption),shouldWrapCaption:!0}))}handleSelect(e){this.props.currentLocale!==e&&this.handleSelectChange(e)}getItemLabelAndCaption(e){var t;return{"en-US":{label:"English",caption:(t=this.props.intl).formatMessage({defaultMessage:"English (US)",id:"languagePicker.captions.englishUS"})},"ko-KR":{label:"한국어",caption:t.formatMessage({defaultMessage:"Korean",id:"languagePicker.captions.koreanKo"})},"zh-CN":{label:"简体中文",caption:t.formatMessage({defaultMessage:"Simplified Chinese",id:"languagePicker.captions.chineseS"})},"zh-TW":{label:"繁體中文",caption:t.formatMessage({defaultMessage:"Traditional Chinese",id:"languagePicker.captions.chineseT"})},"ja-JP":{label:"日本語",caption:t.formatMessage({defaultMessage:"Japanese",id:"languagePicker.captions.japaneseJa"})},"es-ES":{label:"Español",caption:t.formatMessage({defaultMessage:"Spanish (Spain)",id:"languagePicker.captions.spanishEs"})},"es-419":{label:"Español (Latinoamérica)",caption:t.formatMessage({defaultMessage:"Spanish (Latin America)",id:"languagePicker.captions.spanishLatam"})},"pt-BR":{label:"Português",caption:t.formatMessage({defaultMessage:"Portuguese (Brazil)",id:"languagePicker.captions.portugueseBr"})},"fr-FR":{label:"Français",caption:t.formatMessage({defaultMessage:"French",id:"languagePicker.captions.frenchFr"})}}[e]}getItem(e,t,n){return this.renderItem(Nr({},this.getItemLabelAndCaption(e),{focused:t,props:n}))}}var qr=Object(g.g)(Vr),Hr=n(105);class Gr extends F.a{renderComponent(){return r.a.createElement("div",{style:this.getSettingsOptionStyle()},r.a.createElement("div",{style:{display:"flex",alignItems:"flex-start",width:"100%"}},r.a.createElement("div",{style:{flex:1}},r.a.createElement(qr,{confirm:!0,onChange:async e=>{const t=await l.cc(this.environment,{locale:e});"success"===t.type?(Hr.a.set("preferredLocale",e),await h.a.drain(),window.location.reload(!0)):d.d(t)},currentLocale:this.props.locale}),r.a.createElement(pe.a,{isSmall:!0,isMultiline:!0,style:{width:"80%"}},r.a.createElement(g.a,{id:"languageSettings.languageSwitcher.subtitle",defaultMessage:"Choose a language you'd like to use with Notion."})))))}getSettingsOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",height:"auto",paddingLeft:e.isMobile?t.state.paddingLeftCSS:0,paddingRight:e.isMobile?t.state.paddingRightCSS:0}}}var Yr=Gr,Qr=n(197);class Kr extends F.a{constructor(){super(...arguments),this.handleStartOfWeekToggle=()=>{const e=this.getLanguageRegionSettingsState();if(!e)return;const{startDayOfWeek:t}=e;(1===t?_.d:_.c)(this.environment)}}renderComponent(){return $.a.state.online?this.renderSettings():this.renderOfflineMessage()}renderOfflineMessage(){return r.a.createElement(q.a,null,r.a.createElement(pe.a,{isSmall:!0,style:{textAlign:"center"}},r.a.createElement(g.a,{defaultMessage:"Please go online to manage your language and region.",id:"languageSettings.offline.message"})))}renderSettings(){const{currentUserSettingsStore:e}=p.a.state;if(!e)return;const t=this.getLanguageRegionSettingsState();if(!t)return;const{locale:n,startDayOfWeek:a}=t;return r.a.createElement(q.a,null,r.a.createElement(H.a,{large:!0,divider:"full"},r.a.createElement(g.a,{id:"languageSettings.languageSection.title",defaultMessage:"Language & region"})),r.a.createElement(Yr,{locale:n,userSettingsStore:e}),r.a.createElement(R.a,{size:24}),r.a.createElement(be.a,{onClick:this.handleStartOfWeekToggle,startDayOfWeek:a}))}getLanguageRegionSettingsState(){const{currentUserSettingsStore:e}=p.a.state;if(!e)return;const t=e.getValue();if(!t||!t.settings)return;const{settings:n}=t;return{locale:n.preferred_locale||Qr.a,startDayOfWeek:void 0===n.start_day_of_week?Object(M.H)():n.start_day_of_week}}}var Zr=Object(g.g)(Kr),Xr=n(1450),$r=n(1451);function Jr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ei(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jr(Object(n),!0).forEach((function(t){ti(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ti(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ni extends F.a{constructor(){super(...arguments),this.lastSpaceSettingsModalStoreOpen=!1,this.storeTypes={spaceBasicSettingsStore:k,spaceProfileSettingsStore:O,securitySettingsStore:T,spaceSecuritySamlSettingsStore:B},this.renderContent=()=>{const e={profile:this.renderProfile,notifications:this.renderNotifications,settings:this.renderSettings,members:this.renderMembers,plans:this.renderPlans,billing:this.renderBilling,appearance:this.renderAppearance,subscription:this.renderSubscription,credit:this.renderCredit,connected_apps:this.renderConnectedApps,bots:this.renderBotSettings,security_saml:this.renderSecuritySaml,language_and_region:this.renderLanguageAndRegion};return r.a.createElement(It.a,{capture:!0,allowEsc:!0,render:t=>r.a.createElement(Tt.a,{capture:!0,ignoreBlockSelection:!0,restoreSelection:!0,focusOffscreenInput:!1,render:()=>r.a.createElement(Xe,Object.assign({sidebar:this.renderSidebar(),sidebarStyle:{width:200}},t),e[A.a.state.currentTab]())})})},this.renderProfile=()=>r.a.createElement(Ye,{isEducationPlan:fe.x(mt.a.state.data),spaceProfileSettingsStore:this.stores.spaceProfileSettingsStore}),this.renderLanguageAndRegion=()=>r.a.createElement(Zr,null),this.renderNotifications=()=>r.a.createElement(q.a,null,r.a.createElement(Pt.a,null)),this.renderSettings=()=>r.a.createElement(wt,{spaceStore:this.props.spaceStore,spaceBasicSettingsStore:this.stores.spaceBasicSettingsStore}),this.renderMembers=()=>r.a.createElement(kt.a,{store:this.props.spaceStore}),this.renderPlans=()=>{const{data:e}=mt.a.state;if(e)return r.a.createElement(Gn,{spaceStore:this.props.spaceStore,data:e})},this.renderBilling=()=>{const{data:e}=mt.a.state,t=fe.o(e);return e&&"subscribed_admin"===e.type&&t?r.a.createElement(Oa,{spaceStore:this.props.spaceStore,subscriptionData:e,customerData:t}):e&&"unsubscribed_admin"===e.type?r.a.createElement(ka,{spaceStore:this.props.spaceStore,data:e}):void 0},this.renderAppearance=()=>r.a.createElement(q.a,null,r.a.createElement(Xr.a,null)),this.renderSubscription=()=>r.a.createElement(q.a,null,r.a.createElement($r.a,null)),this.renderCredit=()=>{const{data:e}=mt.a.state;if(e)return r.a.createElement(_a,{data:e})},this.renderConnectedApps=()=>r.a.createElement(Qa,null),this.renderBotSettings=()=>{const{spaceStore:e,userStore:t}=this.props;return r.a.createElement(Mr,{spaceStore:e,userStore:t})},this.renderSecuritySaml=()=>r.a.createElement(Ar,{spaceStore:this.props.spaceStore,securitySettingsStore:this.stores.securitySettingsStore,samlConfigStore:this.stores.spaceSecuritySamlSettingsStore}),this.handleModalOpen=()=>{v.e(this.environment)},this.handleModalDismiss=()=>this.attemptCloseCurrentTab(()=>{A.a.setState(ei({},A.a.state,{open:!1}))})}willMount(e){super.willMount(e);const{spaceStore:t}=this.props,{securitySettingsStore:n}=this.stores,a=n.getValueForSpace(t);a&&n.setState(a)}willMountOrUpdate(e){super.willMountOrUpdate(e);const{open:t}=A.a.state,n=A.a.state;this.lastSpaceSettingsModalStoreOpen===t&&s.a.isEqual(this.lastSpaceSettingsStoreState,n)||t&&m.Vc(this.environment,{tab:n.currentTab}),this.lastSpaceSettingsModalStoreOpen=t,this.lastSpaceSettingsStoreState=s.a.clone(n)}renderComponent(){const{open:e}=A.a.state;return r.a.createElement(L.a,{open:e,innerStyle:{width:960,maxWidth:"calc(100vw - 100px)",height:"calc(100vh - 100px)",overflow:"hidden",borderRadius:3,maxHeight:695},onOpen:this.handleModalOpen,onDismiss:this.handleModalDismiss,render:this.renderContent,className:Za.ib})}renderSidebar(){const{spaceStore:e}=this.props,{data:t}=mt.a.state,n=Object(me.g)(this.environment),a=e.canAdmin()&&"has-alpha-api"===xe.a.getGroup(this.environment,"alpha-api"),i="on"===xe.a.getGroup(this.environment,"lion-tamer"),s=fe.y(t);return r.a.createElement("div",{style:ni.sidebarStyle},r.a.createElement("div",null,r.a.createElement("div",{style:this.getSidebarHeader()},n&&n.email||r.a.createElement(g.a,{id:"spaceSettings.sidebar.personalSettingsSection.title",defaultMessage:"Me"})),this.renderTabButton("profile"),this.renderTabButton("notifications"),this.renderTabButton("connected_apps"),i&&this.renderTabButton("language_and_region"),this.renderTabButton("appearance"),t&&t.creditEnabled&&this.renderTabButton("credit"),r.a.createElement(R.a,{size:18,isHidden:!0}),r.a.createElement("div",{style:this.getSidebarHeader()},r.a.createElement(g.a,{id:"spaceSettings.sidebar.workspaceSettingsSection.title",defaultMessage:"Workspace"})),this.renderTabButton("settings"),e.canRead()&&this.renderTabButton("members"),e.canRead()&&this.renderTabButton("plans"),e.canAdmin()&&t&&("subscribed_admin"===t.type||"unsubscribed_admin"===t.type)&&!s&&this.renderTabButton("billing"),s&&this.renderTabButton("subscription"),e.canAdmin()&&this.renderTabButton("security_saml"),a&&this.renderTabButton("bots"),r.a.createElement(R.a,{size:21,style:ni.dividerStyle}),e.canRead()&&r.a.createElement(Lr,{source:"settings"})))}renderTabButton(e){const t=A.a.state.currentTab===e,n=A.b[e](this.environment),a=A.c[e]();return r.a.createElement(Ka.a,{hovered:t,style:ei({display:"flex",alignItems:"center",padding:"5px 15px"},t&&{fontWeight:K.a.fontWeight.semibold}),onClick:t=>{this.attemptCloseCurrentTab(()=>{A.a.setState(ei({},A.a.state,{currentTab:e})),m.we(this.environment,{tab:e})})}},r.a.createElement("div",{style:this.getIconWrapStyle()},n),r.a.createElement(pe.a,null,a))}async attemptCloseCurrentTab(e){const{spaceStore:t}=this.props,{spaceProfileSettingsStore:n}=this.stores,{currentUserStore:a,currentUserSettingsStore:i}=p.a.state;if(!a||!i)throw new Error("No user or settings store.");const o=r.a.createElement(g.a,{id:"spaceSettings.closeSettingsDialog.confirmationMessage",defaultMessage:"Do you want to update your changes?"}),c=r.a.createElement(g.a,{id:"spaceSettings.closeSettingsDialog.confirmationButton.label",defaultMessage:"Yes",description:"Label for button that appears below the question, 'Do you want to update your changes?' to confirm that the user would like to apply updates."}),{currentTab:u}=A.a.state;if("profile"===u){if(!s.a.isEqual(n.state,n.getValueForUser(a,i))){const{givenName:t,familyName:a,profilePhoto:s,startDayOfWeek:l}=n.state;return d.c({message:o,showCancel:!0,keepFocus:!0,items:[{label:r.a.createElement(g.a,{id:"spaceSettings.closeSettingsDialog.updateSettingsButton.label",defaultMessage:"Update"}),color:"blue",onAccept:()=>{Y.d(this.environment,e=>{const{currentUserStore:n}=p.a.state;if(n&&y({userStore:n,data:{givenName:t,familyName:a,profilePhoto:s},transaction:e}),i){i.getSettings().start_day_of_week!==l&&Object(_.e)({userSettingsStore:i,data:{start_day_of_week:l},transaction:e})}}),e()}}],handleCancel:()=>{e()}}),!0}e()}else if("settings"===u&&t.canEdit()){const{spaceBasicSettingsStore:n}=this.stores;if(!s.a.isEqual(n.state,n.getValueForSpace(t))){return await d.a({message:o,acceptLabel:c})?(S.z({environment:this.environment,spaceStore:this.props.spaceStore,spaceBasicSettingsStore:n}),e()):e(),!0}e()}else if("security_saml"===u&&t.canAdmin()){const{securitySettingsStore:n,spaceSecuritySamlSettingsStore:a}=this.stores,r=!s.a.isEqual(n.state,n.getValueForSpace(t)),i=await a.getValueForSpace(this.environment,t),u=(a.state.emailDomains.length>0||"enterprise"===fe.i(this.environment))&&(!a.state.id||a.state.id===t.id)&&!s.a.isEqual(a.state,i);if(r||u){if(await d.a({message:o,acceptLabel:c})){const{disablePublicAccess:t,disableGuests:i,disableMoveToSpace:s,disableExport:o,disableSpacePageEdits:c,disablePublicAccessRequests:p}=n.state;if(r&&Y.d(this.environment,e=>{S.x({environment:this.environment,disablePublicAccess:t,disableGuests:i,disableMoveToSpace:s,disableExport:o,disableSpacePageEdits:c,disablePublicAccessRequests:p,transaction:e,spaceStore:this.props.spaceStore})}),u){const{state:e}=a,t=await l.b(this.environment,{spaceId:this.props.spaceStore.id,status:e.status,useMetadataUrl:e.useMetadataUrl,idpMetadataUrl:e.idpMetadataUrl,idpMetadata:e.idpMetadata,createAccount:e.createAccount});"failed"===t.type&&d.d(t)}e()}else e();return!0}e()}else e();return!1}getSidebarHeader(){return{letterSpacing:"0.03em",textTransform:"uppercase",fontSize:11,lineHeight:1,marginBottom:1,color:this.theme.mediumTextColor,fontWeight:K.a.fontWeight.medium,padding:"5px 15px",textOverflow:"ellipsis",overflow:"hidden"}}getIconWrapStyle(){return{width:20,height:20,marginRight:8,color:this.theme.regularIconColor,fill:this.theme.regularIconColor}}}ni.dividerStyle={paddingLeft:14,paddingRight:14},ni.sidebarStyle={display:"flex",flexDirection:"column",height:"100%",paddingTop:10,paddingBottom:12,justifyContent:"space-between"};t.default=ni},1101:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(842),s=n(43),o=n(3),l=n(190);class c extends o.a{constructor(){super(...arguments),this.handleContextMenu=e=>{const{device:t}=this.environment;t.isAndroid||l.b.isOnboarding||Object(s.d)({event:e,context:s.a.EditorContextMenu,callback:()=>{t.isElectron||this.environment.currentUser.isLoggedIn()&&e.preventDefault()}})},this.handleDragStart=e=>{e.preventDefault()}}didMount(){window.addEventListener("contextmenu",this.handleContextMenu),window.addEventListener("dragstart",this.handleDragStart)}willUnmount(){window.removeEventListener("contextmenu",this.handleContextMenu),window.removeEventListener("dragstart",this.handleDragStart)}}var d=c,u=(n(15),n(11),n(2)),p=n.n(u),m=n(25),h=n(88),g=n(130),b=n(27),f=n(10),y=n(348),S=n(33),v=n(78),E=n(433),M=n(347),C=n(242),O=n(332),w=n(330),k=n(71),P=n(834),T=n(83),I=n(145),j=n(633),D=n(9);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class F extends o.a{constructor(){super(...arguments),this.didTouchEnd=!1,this.handleWindowMouseMove=e=>{if(this.didTouchEnd)return void(this.didTouchEnd=!1);const{isDragging:t}=h.b.state;t?this.updateDragState():this.updateHoverState(e.target,e.clientX,e.clientY)},this.handleWindowKeyEvent=e=>{const{isDragging:t}=h.b.state;t&&this.updateDragState()},this.handleWindowMouseMoveThrottled=p.a.throttle(this.handleWindowMouseMove,60),this.handleWindowTouchEnd=e=>{this.didTouchEnd=!0},this.handleWindowScroll=()=>{m.i(),this.clearHoverState()},this.handleWindowResize=()=>{m.i(),this.clearHoverState()},this.handleGlobalMenuIsOpenChange=()=>{const e=C.a.state,t=T.n.state;e.isOpen&&!e.menuIsOpen&&t&&C.a.reset()},this.memoizedCanDragCache=new WeakMap,this.memoizedCanDrag=e=>{const t=this.memoizedCanDragCache.get(e);if(this.memoizedCanDragCache.has(e))return t;const n=Object(D.o)({environment:this.environment,blocks:e,publicEditMode:this.pageContext&&this.pageContext.publicEditModeStore.state});return this.memoizedCanDragCache.set(e,n),n}}leftRightLeeway(){const{device:e}=this.environment;return e.isMobile?9999:0}didMount(){super.didMount();const{device:e}=this.environment;g.a(window,"mousemove",this.handleWindowMouseMoveThrottled),e.isIOS&&g.a(window,"touchend",this.handleWindowTouchEnd),g.a(window,"keydown",this.handleWindowKeyEvent),g.a(window,"keyup",this.handleWindowKeyEvent),h.b.addListener(this.handleWindowMouseMoveThrottled),g.a(window,"scroll",this.handleWindowScroll,!0),g.a(window,"resize",this.handleWindowResize),T.n.addListener(this.handleGlobalMenuIsOpenChange),m.h()}willUnmount(){super.willUnmount();const{device:e}=this.environment;g.b(window,"mousemove",this.handleWindowMouseMoveThrottled),e.isIOS&&g.b(window,"touchend",this.handleWindowTouchEnd),g.b(window,"keydown",this.handleWindowKeyEvent),g.b(window,"keyup",this.handleWindowKeyEvent),h.b.removeListener(this.handleWindowMouseMoveThrottled),g.b(window,"scroll",this.handleWindowScroll,!0),g.b(window,"resize",this.handleWindowResize),T.n.removeListener(this.handleGlobalMenuIsOpenChange)}updateDragState(){const e=h.b.state;if(!e.isDragging)return;const{draggedStores:t,currentX:n,currentY:a,offsetX:r,offsetY:i,isNativeDrag:s}=e,o={x:n,y:a},l={x:n-r,y:a-i},c=this.findNearbyDropZones({mousePoint:o,originPoint:l},t[0],s);if(c.ontoDropZone)h.b.setState(B({},e,{currentDropZone:c.ontoDropZone,currentHintDropZones:[],currentParentStore:void 0}));else if(c.verticalDropZone)h.b.setState(B({},e,{currentDropZone:c.verticalDropZone,currentHintDropZones:[],currentParentStore:void 0}));else{if(c.horizontalDropZones.length>0){const t=c.horizontalDropZones[0],n=p.a.tail(c.horizontalDropZones),a=v.a.findSelectableFromStore(t.store);if(a){const r=a.getContextClosestSelectable();let i;return r&&r.props.store!==t.store&&r.props.shouldShowParentHalo&&(i=r.props.store),void h.b.setState(B({},e,{currentDropZone:t,currentHintDropZones:n,currentParentStore:i}))}}h.b.setState(B({},e,{currentDropZone:void 0,currentHintDropZones:[],currentParentStore:void 0}))}}clearHoverState(){const e=C.a.state;e.isOpen&&!e.menuIsOpen&&C.a.reset()}updateHoverState(e,t,n){const a=C.a.state;if(!a.isOpen||!a.menuIsOpen){const r=this.findHoverMenuTarget(e,t,n);r?a.isOpen&&r.selectable.props.store===a.currentStore||C.a.setState({isOpen:!0,currentStore:r.selectable.props.store,container:r.container,menuIsOpen:!1}):C.a.reset()}}findNearbyDropZones(e,t,n){const{device:a}=this.environment,r=y.a(),{selectableRectMap:i}=M.a.state,s=i.keys();let o=s.next();const l=v.a.findSelectableFromStore(t),c=l?l.getContextSelectableContainer():void 0,d=[];for(;!o.done;){const t=o.value;o=s.next();const l=i.get(t),u=t.getContextSelectableContainer(),p=t.props.dropzoneMustBeWithinHorizontalBound?0:this.leftRightLeeway();if(a.isMobile&&u!==c)continue;if(!u||u.props.disable)continue;const m=t.getReferencePoint(e);if(l&&e.mousePoint.x>=l.left&&e.mousePoint.x<=l.right&&e.mousePoint.y>=l.top&&e.mousePoint.y<=l.bottom&&this.selectableIsDragging(t)&&!r.option)return{ontoDropZone:void 0,verticalDropZone:void 0,horizontalDropZones:[]};const{mousePoint:g}=e;(n?t.props.canNativeDropOnto:t.props.canDropOnto)&&l&&g.x>=l.left&&g.x<=l.right&&g.y>=l.top&&g.y<=l.bottom&&!this.selectableIsDragging(t)&&this.selectableCanAcceptDrop(t,h.a.Onto)&&d.push({selectable:t,direction:h.a.Onto,left:l.left,top:l.top,width:l.width,height:l.height}),(n?t.props.canNativeDropLeft:t.props.canDropLeft)&&l&&m.y>=l.top&&m.y<=l.bottom&&Math.abs(m.x-l.left)<=F.verticalDropZoneMaxHorizontalOffset&&(r.option||!this.selectableIsDragging(t))&&this.selectableCanAcceptDrop(t,h.a.Left)&&d.push({selectable:t,direction:h.a.Left,left:l.left,top:l.top,width:0,height:l.height}),(n?t.props.canNativeDropRight:t.props.canDropRight)&&l&&m.y>=l.top&&m.y<=l.bottom&&Math.abs(m.x-l.right)<=F.verticalDropZoneMaxHorizontalOffset&&(r.option||!this.selectableIsDragging(t))&&this.selectableCanAcceptDrop(t,h.a.Right)&&d.push({selectable:t,direction:h.a.Right,left:l.right,top:l.top,width:0,height:l.height}),(n?t.props.canNativeDropAbove:t.props.canDropAbove)&&l&&m.x>=l.left-F.verticalDropZoneExtraLeftEdgeOffset-p&&m.x<=l.right+p&&(r.option||!this.selectableIsDragging(t))&&this.selectableCanAcceptDrop(t,h.a.Above)&&d.push({selectable:t,direction:h.a.Above,left:l.left,top:l.top,width:l.width,height:0}),(n?t.props.canNativeDropBelow:t.props.canDropBelow)&&l&&m.x>=l.left-F.verticalDropZoneExtraLeftEdgeOffset-p&&m.x<=l.right+p&&(r.option||!this.selectableIsDragging(t))&&this.selectableCanAcceptDrop(t,h.a.Below)&&d.push({selectable:t,direction:h.a.Below,left:l.left,top:l.bottom,width:l.width,height:0})}const u=d.filter(e=>e.direction===h.a.Above||e.direction===h.a.Below),m=p.a.minBy(u,t=>{let{selectable:n,top:a}=t;return Math.abs(a-n.getReferencePoint(e).y)});let g=u.filter(e=>{let{top:t}=e;return Math.abs(t-(m?m.top:0))<=F.competingHorizontalDropZoneMinDist});if(g.length>1){g=g.filter(t=>{let{selectable:n,left:a,width:r}=t;const i=n.getReferencePoint(e).x;return i>=a-this.leftRightLeeway()&&i<=a+r+this.leftRightLeeway()}),g=p.a.sortBy(g,e=>{let{left:t}=e;return t});let t=0;for(;t<g.length-1;t++){const n=g[t+1],a=n.selectable.getReferencePoint(e).x;if(n.left>a)break}g=g.slice(0,t+1),g.reverse()}const b=p.a.map(g,e=>{let{selectable:t,direction:n}=e;return{store:t.props.store,direction:n}});let f;const S=d.filter(e=>e.direction===h.a.Onto),E=p.a.minBy(S,e=>e.height);if(E){u.some(t=>{const n=t.selectable.getReferencePoint(e).y;return Math.abs(t.top-n)<F.competingOntoDropZoneVerticalOffset})||(f={store:E.selectable.props.store,direction:E.direction})}let C;const O=d.filter(e=>e.direction===h.a.Left||e.direction===h.a.Right);let w=p.a.minBy(O,t=>{const n=t.selectable.getReferencePoint(e).x;return Math.abs(t.left-n)});if(w){const e=w,t=O.filter(t=>Math.abs(t.left-e.left)<F.verticalDropZoneAmbiguousDist);t.length>0&&(w=p.a.minBy(t,e=>e.left))}if(w){const e=w;u.some(t=>t.top>=e.top&&t.top+t.height<=e.top+e.height)||(C={store:w.selectable.props.store,direction:w.direction})}return{ontoDropZone:f,verticalDropZone:C,horizontalDropZones:b}}findHoverMenuTarget(e,t,n){if(h.b.state.isDragging||I.a.state.isActive||T.n.state)return;const{selectableRectMap:a}=M.a.state,r=j.a.getSortedComponents().find(t=>{const n=t.getNode();return Boolean(n&&n.contains(e))}),{defaultContainer:i}=S.b.state,s=r||i;if(!s)return;const o=a.keys();let l=o.next();const c=[];for(;!l.done;){const e=l.value,r=a.get(e);(e.props.shouldShowHoverMenu||e.props.shouldShowCommentMenu)&&e.getContextSelectableContainer()===s&&r&&n>=r.top&&n<=r.bottom&&t>=r.left-F.hoverMaxHorizontalOffset&&t<=r.right&&c.push(e),l=o.next()}const d=p.a.sortBy(c,e=>{const t=a.get(e);return t?-t.left:1/0}),u=d.find(e=>{const t=e.getNode();if(t){if(d.find(n=>{if(n!==e){const e=n.getNode();return Boolean(e&&t.contains(e))}return!1}))return!1}return!0});return u?{selectable:u,container:s}:void 0}selectableIsDragging(e){const t=h.b.state;if(!t.isDragging)return;const{draggedStores:n}=t;for(;e;){if(n.indexOf(e.props.store)>=0)return!0;e=e.getContextClosestSelectable()}return!1}selectableCanAcceptDrop(e,t){if(w.a.state.isOpen&&!k.c.state.open)return!1;if(O.a.state.isOpen)return!1;const n=h.b.state,a=n.isDragging?n.draggedStores:[],r=!!n.isDragging&&n.isNativeDrag,i=e.props.store;let s,o,l=!1,c=!1;if(a.find(e=>{const t=E.a.findOutlinerItemFromStore(e);return!!t&&(s=t.props.type,l=t.props.isTopLevelItem,!0)}),t===h.a.Onto&&"collection"===i.getParentTable()){const e=i.getParentId();if(a.find(t=>Boolean(t instanceof b.a&&"collection"===t.getParentTable()&&t.getParentId()===e)))return!1}const d=Boolean(a.find(e=>e.isCollectionView()));if(d&&"collection"===i.getParentTable()&&t!==h.a.Onto&&"bookmarks"!==s)return!1;if(d&&i.isCollectionView()&&t===h.a.Onto)return!1;if(d&&i.isCollectionView()&&!i.recordStoreParent()&&t!==h.a.Onto)return!1;const u=E.a.findOutlinerItemFromStore(i);if(u&&(o=u.props.type,c=u.props.isTopLevelItem),o&&r)return!1;if("bookmarks"===s&&l&&("bookmarks"!==o||!c||t===h.a.Onto))return!1;if("bookmarks"===o&&c&&t!==h.a.Onto&&("bookmarks"!==s||!l))return!1;if("shared"===o&&"shared"!==s&&t!==h.a.Onto)return!1;if("shared"===s&&"shared"!==o&&a.some(e=>!e.isTopLevel()))return!1;if(o&&c&&t!==h.a.Onto){if(a.find(e=>{const t=e.getType();return Boolean(!t||!f.q[t])}))return!1}const{device:p}=this.environment;return!(o&&p.isMobile&&t===h.a.Onto&&c)&&((!a.find(e=>Boolean(e instanceof b.a&&e.isInlineCollectionView()))||t!==h.a.Left&&t!==h.a.Right)&&(a.some(e=>Boolean(P.a.findCollectionTemplatePickerItemFromStore(e)))===Boolean(P.a.findCollectionTemplatePickerItemFromStore(i))&&(!(t===h.a.Onto&&i&&!Object(D.p)({environment:this.environment,blocks:[i],publicEditMode:this.pageContext&&this.pageContext.publicEditModeStore.state}))&&!!this.memoizedCanDrag(a))))}}F.verticalDropZoneMaxHorizontalOffset=200,F.hoverMaxHorizontalOffset=150,F.competingOntoDropZoneVerticalOffset=7,F.verticalDropZoneExtraLeftEdgeOffset=14,F.verticalDropZoneAmbiguousDist=20,F.competingHorizontalDropZoneMinDist=2;var R=F,L=n(221),U=n(17),_=n(423),W=n(265);class N extends o.a{constructor(){super(...arguments),this.mouseSpeed=1/0,this.setPreviousMousePosition=(e,t)=>{this.previousMousePosition={x:e,y:t},clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.previousMousePosition=void 0},100)},this.handleWindowMouseMove=e=>{Object(s.d)({event:e,context:s.a.SidebarMouseMove,callback:()=>{if(this.updatePageViewRectThrottled(),void 0!==this.previousMousePosition&&(this.mouseSpeed=Math.sqrt(Math.pow(e.clientX-this.previousMousePosition.x,2)+Math.pow(e.clientY-this.previousMousePosition.y,2))),this.setPreviousMousePosition(e.clientX,e.clientY),this.cachedPageViewRect){const{sidebarMinTriggerWidth:t,sidebarOpenWidthPercent:n}=N,a=W.b.state,r=W.d.state,i=e.clientX,s=this.cachedPageViewRect.left,o=Math.max(s*n,t);i<o&&!k.c.state.open&&this.mouseSpeed<N.mouseSpeedThreshold&&0!==this.mouseSpeed&&!a&&L.d(),i>r&&i>o&&a&&L.b()}}})},this.handleWindowMouseOut=e=>{e.toElement||e.relatedTarget||L.b()},this.updatePageViewRectThrottled=p.a.throttle(this.updatePageViewRect,500)}didMount(){window.addEventListener("mousemove",this.handleWindowMouseMove),window.addEventListener("mouseout",this.handleWindowMouseOut)}willUnmount(){window.removeEventListener("mousemove",this.handleWindowMouseMove),window.removeEventListener("mouseout",this.handleWindowMouseOut)}updatePageViewRect(){const e=this.getPageViewWrapEl();this.cachedPageViewRect=e?e.getBoundingClientRect():document.body.getBoundingClientRect()}getPageViewWrapEl(){const{currentBlockStore:e}=U.a.state,t=_.a.findComponent(t=>t.props.store===e);if(t){const e=t.getContentWrapEl();if(e)return e}}}N.sidebarOpenWidthPercent=.38,N.sidebarMinTriggerWidth=18,N.mouseSpeedThreshold=5;var z=N,V=n(336),q=n(52),H=n(39),G=n(243),Y=n(32),Q=n(41),K=n(733),Z=n(120),X=n(13),$=n(552),J=n(16);function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ne extends J.a{constructor(){super(...arguments),this.pause=()=>{this.setState({active:!1,onActive:[]})},this.resume=()=>{this.state.onActive.map(e=>e()),this.setState({active:!0,onActive:[]})}}getInitialState(){return{active:!0,onActive:[]}}whenActive(e){this.state.active?e():this.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){te(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.state,{onActive:p.a.uniq([...this.state.onActive,e])}))}}var ae=new ne,re=n(179),ie=n(246),se=n(1),oe=n(91),le=n(170);class ce extends o.a{constructor(){super(...arguments),this.lastEmitValue=-1,this.handleNotificationEmit=async(e,t)=>{if(t===this.lastEmitValue)return;this.lastEmitValue=t;const n=await H.ib(this.environment,{size:21});if("failed"===n.type)return;const{results:a}=n.data;$.a.setState({results:a}),this.syncInitialBadgeNumber();const r=p.a.union.apply(null,a.map(e=>e.unreceived.notificationIds));for(const i of r)this.displayNotification(i)},this.handleNotificationEmitThrottled=p.a.throttle(this.handleNotificationEmit,1e3),this.handleNotificationEmitWhenActive=(e,t)=>{ae.whenActive(()=>{this.handleNotificationEmitThrottled(e,t)})},this.updateBadgeNumbers=()=>{const{results:e}=$.a.state,{reactNative:t}=this.environment,n=e.reduce((e,t)=>e+t.unread.mentions,0);t&&t.setBadgeNumber(n),n>0?Z.q("".concat(n)):Z.q("")},this.syncInitialBadgeNumber=p.a.once(this.updateBadgeNumbers)}willMount(){this.startMessageListeners(),$.a.addListener(this.updateBadgeNumbers)}willUnmount(){this.stopMessageListeners(),$.a.removeListener(this.updateBadgeNumbers)}startMessageListeners(){const{currentUserStore:e}=U.a.state;if(e){const t=Object(ie.f)(e.id);this.listenerReference=re.a.addListener(t,this.handleNotificationEmitWhenActive,void 0)}}stopMessageListeners(){this.listenerReference&&re.a.removeListener(this.listenerReference)}async displayNotification(e){const t=Object(q.c)(this.props.rootStore,{table:V.a,id:e});await t.load();const n=t.getValue();if(!n)return;const a=Object(oe.b)(t,n.activity_id,n.space_id);await a.load();const r=a.getValue(),{currentUserStore:i,currentSpaceViewStore:s}=U.a.state;if(i&&s&&r&&!r.invalid&&!G.k(r,i.id)&&await Z.s()&&"undefined"!=typeof Notification){await s.load();const e=s.getValue();if(!e)return;if(!G.l(r))return;if(!e.notify_desktop)return;if(!this.environment.device.isDesktop)return;const n=(0,(await le.m.desktop.loader()).PushNotification)({activity:r,getRecordValue:t.getRecordValue,userTimeZone:X.m,intl:this.props.intl});if(!n)return;const{subject:a,body:i}=n;new Notification(a,{body:i,silent:!0}).addEventListener("click",()=>{const e=G.j({activity:r,getRecordValue:t.getRecordValue,baseUrl:Y.a.baseURL}),n=G.f(r),a=Object(K.b)(e,[n,"desktop_push"]);Q.f({environment:this.environment,url:a})})}}}var de=Object(se.g)(ce),ue=n(850);class pe extends o.a{constructor(){super(...arguments),this.handleOpen=()=>{ue.a.setState({open:!0})},this.handleClose=()=>{ue.a.setState({open:!1})}}willMount(){Z.j.started.addListener(this.handleOpen),Z.j.stopped.addListener(this.handleClose)}willUnmount(){Z.j.started.removeListener(this.handleOpen),Z.j.stopped.removeListener(this.handleClose)}}var me=pe,he=n(222),ge=n(344),be=n(45),fe=n(14),ye=n(24),Se=n(169),ve=n(22),Ee=n(103),Me=n(634),Ce=n(439),Oe=n(359),we=n(94),ke=n(133),Pe=n(832);function Te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class je extends o.a{constructor(){super(...arguments),this.renderOverlay=()=>{const{device:e}=this.environment,t=Ce.a.state;if(!t.isActive)return;const{originBlockRect:n,actions:a,inputValue:i}=t,s={environment:this.environment,blocks:t.stores,originRect:n},o=t.showInput&&this.renderInputSection(),l=t.stores[0];let c;return c=e.isPhone?{menuType:ve.b.MenuType.Modal,title:r.a.createElement(se.a,{defaultMessage:"Actions",id:"blockMenu.actionButton.label"}),right:r.a.createElement(we.DoneMenuText,null),onClickRight:this.handleOverlayBgClick,header:o}:{menuType:ve.b.MenuType.Popup,width:220,header:o},r.a.createElement(Ee.a,{capture:!0,onBackspace:p.a.identity},r.a.createElement(ve.b,Object.assign({},c),r.a.createElement(ge.a,{filter:i,context:s,sections:a,onAccept:this.handleAccept,initialFocus:i?0:void 0}),!i&&this.renderBlockAuthorInfo(),!i&&r.a.createElement(Pe.a,{store:l}),!i&&l.isCollectionView()&&this.renderCollectionHelpButton()))},this.handleOverlayBgClick=()=>{he.a()},this.handleAccept=e=>{const t=Ce.a.state;if(!t.isActive)return;const{stores:n}=S.b.state,{analyticsFrom:a}=t,r=n[0];if(r){const t=r.getValue();t&&fe.p(this.environment,{analyticsName:e.analyticsName,from:a,block_type:t.type})}e.closeParentMenu&&he.a()},this.handleInputChange=e=>{Ce.a.state.isActive&&Ce.a.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(n),!0).forEach((function(t){Ie(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Ce.a.state,{inputValue:e.target.value}))}}renderComponent(){const{device:e}=this.environment,t=Ce.a.state;return r.a.createElement(be.c,{popupType:e.isPhone?be.c.PopupType.SlideUp:be.c.PopupType.Popup,open:t.isActive,originRect:t.isActive?t.originBlockRect:void 0,onDismiss:this.handleOverlayBgClick,placementToOrigin:be.c.Placement.Bottom,alignmentToOrigin:be.c.Alignment.Start,originGap:0,preventScaleTransition:!0,render:this.renderOverlay,preventBlockRenderQueueOnEnter:e.isMobile})}renderBlockAuthorInfo(){const e=Ce.a.state;if(e.isActive&&!(e.stores.length>1))return r.a.createElement(Me.a,{store:e.stores[0],isPageMoreButton:!1})}renderInputSection(){const{device:e}=this.environment,{intl:t}=this.props,n=Ce.a.state;if(!n.isActive||e.isPhone)return;const{inputValue:a}=n;return r.a.createElement(ye.a,{isInput:!0},r.a.createElement(Se.a,{value:a,onChange:this.handleInputChange,focus:!0,focusAfterAnimation:!0,placeholder:t.formatMessage({defaultMessage:"Filter actions…",id:"blockMenu.filterForActions.placeholder"}),allowDelete:!0}))}renderCollectionHelpButton(){return r.a.createElement(ye.a,{topBorder:!0,disableDesktopPadding:!0},r.a.createElement(Oe.a,{title:r.a.createElement(se.a,{defaultMessage:"Learn about databases",id:"blocks.blockMenu.collectionHelpButton"}),href:Object(ke.a)("guides.database"),analyticsFrom:"block_menu"}))}}var De=Object(se.g)(je),xe=n(153),Be=n(731),Ae=n(86);function Fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Le extends o.a{constructor(){super(...arguments),this.handleOverlayBgClick=e=>{Be.a.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(n),!0).forEach((function(t){Re(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Be.a.state,{active:!1,stringValue:""}))}}renderComponent(){const{device:e}=this.environment,{active:t,stringValue:n}=Be.a.state,a=window.innerWidth/2-150,i=window.innerHeight/2;return r.a.createElement(be.c,{popupType:e.isReactNative?be.c.PopupType.SlideUp:be.c.PopupType.Popup,open:t,originRect:{top:i,left:a},onDismiss:this.handleOverlayBgClick,placementToOrigin:be.c.Placement.Bottom,alignmentToOrigin:be.c.Alignment.Start,originGap:0,render:()=>r.a.createElement(Ee.a,{capture:!0,onEnter:p.a.identity,onCommandEnter:p.a.identity,onCommandShiftEnter:p.a.identity,onCommandSlash:p.a.identity,onDelete:p.a.identity,onBackspace:p.a.identity,onEsc:p.a.identity,onLeft:p.a.identity,onRight:p.a.identity,onUntab:p.a.identity,onTab:p.a.identity,onSelectAll:p.a.identity,onRedo:p.a.identity,onUndo:p.a.identity,onToggleBold:p.a.identity,onToggleItalics:p.a.identity,onToggleStrike:p.a.identity,onToggleCode:p.a.identity,onCut:p.a.identity,onCopy:p.a.identity,onPaste:p.a.identity,onKeypress:p.a.identity},r.a.createElement("div",{style:{padding:8,width:300}},r.a.createElement(xe.b,{style:{width:"100%",fontSize:12},value:n,focus:!0,textarea:!0,selectAll:!0,readOnly:!0}),r.a.createElement(Ae.a,{isSmall:!0,style:{marginTop:6,pointerEvents:"none"}},r.a.createElement(se.a,{defaultMessage:"Right click and copy the link above",id:"clipboardInputRenderer.copyLink.message"}))))})}}var Ue=Le,_e=n(60),We=n.n(_e);class Ne extends o.a{didMount(){super.didMount();const e=We.a.findDOMNode(this);e&&e instanceof Element&&this.props.ghostElement.forEach((t,n)=>{let{cloned:a}=t;e.children[n].appendChild(a)})}renderComponent(){return r.a.createElement("div",null,this.props.ghostElement.map((e,t)=>{let{rect:{left:n,top:a,width:i,height:s}}=e;return r.a.createElement("div",{key:t,style:{position:"absolute",top:a,left:n,width:i,height:s,opacity:this.environment.device.isMobile?.25:.4,pointerEvents:"none"}})}))}}var ze=Ne,Ve=n(362);class qe extends o.a{constructor(){super(...arguments),this.renderGhost=()=>{const e=h.b.state;if(!e.isDragging)return;const t=e.draggedStores.map((t,n)=>r.a.createElement(ze,{key:"".concat(n),store:t,ghostElement:e.ghostElements[n]}));return r.a.createElement("div",{style:this.getGhostStyle()},t)},this.isDragging=this.createComputedStore(()=>h.b.state.isDragging)}renderComponent(){return r.a.createElement(Ve.a,{open:this.isDragging.state,render:this.renderGhost})}getGhostStyle(){const e=h.b.state;if(!e.isDragging)return;const{startX:t,startY:n,currentX:a,currentY:r}=e,i=r-n;return{position:"absolute",top:0,left:0,transform:"translate3d(".concat(a-t,"px, ").concat(i,"px, 0)")}}}var He=qe,Ge=n(230),Ye=n(174),Qe=n(127),Ke=n(755),Ze=n(462),Xe=n(23),$e=n(578),Je=n(19),et=n(76),tt=n(510);function nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function at(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(n),!0).forEach((function(t){rt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function rt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class it extends o.a{constructor(){super(...arguments),this.renderOverlay=()=>{const{isOpen:e,renderFullScreenNode:t,fullScreenNodeRect:n}=$e.a.state;if(!n)return;const a=window.innerWidth,i=window.innerHeight,s=a-2*it.edgePadding,o=i-2*it.edgePadding;let l=s,c=l/n.width*n.height;if(c>o){const e=c/o;c/=e,l/=e}const d=(a-l)/2,u=(i-c)/2,m={translateX:n.left,translateY:n.top,width:n.width,height:n.height},h={translateX:d,translateY:u,width:l,height:c};let g;return t&&(g=t()),Object(Ge.a)(t=>r.a.createElement(Ee.a,{capture:e,onEsc:this.handleClose,onEnter:p.a.identity,onSpace:this.handleClose,onCommandEnter:this.handleClose,onCommandShiftEnter:p.a.identity,onCommandSlash:p.a.identity,onUp:p.a.identity,onDown:p.a.identity,onDelete:p.a.identity,onBackspace:p.a.identity,onLeft:p.a.identity,onRight:p.a.identity,onUntab:p.a.identity,onTab:p.a.identity,onSelectAll:p.a.identity,onRedo:p.a.identity,onUndo:p.a.identity,onToggleBold:p.a.identity,onToggleItalics:p.a.identity,onToggleStrike:p.a.identity,onToggleCode:p.a.identity,onCut:p.a.identity,onCopy:p.a.identity,onPaste:p.a.identity,onKeypress:p.a.identity},r.a.createElement(Ke.a,{capture:e},r.a.createElement("div",Object.assign({onClick:this.handleClose,ref:e=>{this.rootEl=e},style:this.getStyle(e)},t),r.a.createElement(Qe.a,{isVisible:e,enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},animationStyle:{opacity:.8},render:()=>r.a.createElement("div",{style:it.backgroundStyle}),onAnimationEnd:this.handleBackgroundAnimationEnd}),r.a.createElement(Qe.a,{ref:e=>{this.animatedEl=e},isVisible:e,enterAnimationStyle:m,exitAnimationStyle:m,animationStyle:h,springConfig:{translateX:it.springConfig,translateY:it.springConfig,width:it.springConfig,height:it.springConfig},render:()=>r.a.createElement("div",{style:it.fullScreenNodeWrapStyle},g),onAnimationEnd:this.handleFullscreenNodeAnimationEnd}),r.a.createElement("div",{style:this.getCloseButtonStyle(e)},r.a.createElement(et.a,{onClick:this.handleClose,style:{color:"#fff"}},r.a.createElement(se.a,{defaultMessage:"Close",id:"fullscreenRenderer.closeButton.label",description:"Shown in the top right corner when viewing an asset (image, file, etc.) in full screen mode, to close out of full screen mode."})))))))},this.handleClose=()=>{tt.a(),m.e(this.environment)},this.handleResize=()=>{const{isOpen:e}=$e.a.state;e&&this.enqueueForceUpdate()},this.handleFrameScrollerUpdate=()=>{this.updateRootElFromScroll()},this.handleBackgroundAnimationEnd=()=>{const{isOpen:e}=$e.a.state;e||$e.a.setState(at({},$e.a.state,{backgroundAnimationComplete:!0}))},this.handleFullscreenNodeAnimationEnd=()=>{const{isOpen:e}=$e.a.state;e||$e.a.setState(at({},$e.a.state,{fullscreenNodeAnimationComplete:!0}))}}didMount(){super.didMount(),window.addEventListener("resize",this.handleResize),Ze.a.addListener(this.handleFrameScrollerUpdate)}didMountOrUpdate(){super.didMountOrUpdate(),this.updateRootElFromScroll()}willUnmount(){super.willUnmount(),window.removeEventListener("resize",this.handleResize),Ze.a.removeListener(this.handleFrameScrollerUpdate)}renderComponent(){const{isOpen:e,fullscreenNodeAnimationComplete:t,backgroundAnimationComplete:n}=$e.a.state;return r.a.createElement(Ve.a,{open:e||!t||!n,render:this.renderOverlay})}getRenderedEl(){const e=We.a.findDOMNode(this.animatedEl);if(e)return e.childNodes[0]}updateRootElFromScroll(){if(this.getRenderedEl()){const{scrollTop:e}=Ze.a.state,{startScrollTop:t}=$e.a.state,n=e-t;this.rootEl.style.transform="translateY(".concat(-n,"px)")}}getStyle(e){return{zIndex:Ye.i,position:"fixed",top:0,left:0,right:0,bottom:0,pointerEvents:e?"auto":"none",cursor:"zoom-out"}}getCloseButtonStyle(e){const{WindowSizeStore:t}=this.environment;return{position:"absolute",top:t.getSafePaddingBottomCSS(16),right:t.getSafePaddingRightCSS(18),display:e?"block":"none",fontWeight:Xe.a.fontWeight.medium}}}it.edgePadding=32,it.springConfig={stiffness:65,damping:10,precision:.001},it.fullScreenNodeWrapStyle={position:"absolute",top:0,left:0,display:"flex"},it.backgroundStyle={position:"absolute",top:0,left:0,right:0,bottom:0,background:Je.f.black};var st=it,ot=n(150),lt=n(443),ct=n(724),dt=n(200),ut=n(820),pt=n(774),mt=n(233),ht=n(40),gt=n(752),bt=n(250),ft=n(1244),yt=n(1363),St=n(758),vt=n(8),Et=n(89),Mt=n(581),Ct=n(119),Ot=n(626),wt=n(34),kt=n(257),Pt=n(184),Tt=n(194),It=n(183),jt=n(171),Dt=n(102),xt=n(487),Bt=n(53),At=n(512),Ft=n(68),Rt=n(6),Lt=n(305),Ut=n(97);function _t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_t(Object(n),!0).forEach((function(t){Nt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Nt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const zt=Object(se.f)({embedPlaceholder:{id:"mediaPicker.embedPlaceholder.text",defaultMessage:"Paste in https://…"},filterPlaceholder:{id:"mediaPicker.emojiFilter.text",defaultMessage:"Filter…"},unsplashPlaceholder:{id:"mediaPicker.unsplashPlaceholder.text",defaultMessage:"Search for an image…"}});class Vt extends o.a{constructor(){super(...arguments),this.storeTypes={embedInputStore:dt.a,emojiInputStore:dt.a,emojiPickerStore:Mt.a,unsplashInputStore:dt.a},this.renderUnsplashResults=(e,t,n,i)=>i?!n||n&&!n.length?r.a.createElement(ut.a,{shouldWrapCaption:!0,caption:r.a.createElement(se.a,{defaultMessage:"No results found.",id:"mediaPicker.unsplash.noResultsText"}),style:{textAlign:this.props.isSmallWidth?"left":"center",color:this.theme.mediumTextColor}}):r.a.createElement(a.Fragment,null,n.map(t=>this.renderUnsplashImage(e,t)),r.a.createElement(ut.a,{shouldWrapCaption:!0,caption:r.a.createElement(se.a,{defaultMessage:"Search to find more results.",id:"mediaPicker.unsplash.searchText"}),style:{textAlign:this.props.isSmallWidth?"left":"center",color:this.theme.mediumTextColor}})):r.a.createElement("div",{style:this.getLoadingContainerStyle()},r.a.createElement(Dt.a,null)),this.renderUnsplashImage=(e,t)=>{const{device:n}=this.environment;return r.a.createElement("div",{key:t.id,style:{width:n.isMobile?"33%":"25%",padding:3}},r.a.createElement(wt.a,{hoveredStyle:{opacity:.85},onClick:()=>this.handleSelectUnsplashImage(e,t)},r.a.createElement(mt.a,{src:t.thumbUrl,style:{width:"100%",height:64,objectFit:"cover",objectPosition:"center 0%",borderRadius:3}})),r.a.createElement(Ae.a,{isSmall:!0,isSecondaryColor:!0,style:{marginTop:2,marginBottom:4}},r.a.createElement(se.a,{defaultMessage:"by <inlinetextlink>{authorName}</inlinetextlink>",id:"mediaPicker.unsplash.byAuthor",description:"Caption attributing the author of the Unsplash image",values:{authorName:t.authorName,inlinetextlink:function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return r.a.createElement(xt.a,{external:!0,href:t.unsplashUrl},n)}}})))},this.handleEmbedSubmit=e=>()=>{const t=this.stores.embedInputStore.state.inputValue;t&&e.onChange(t)},this.handleSelectUnsplashImage=async(e,t)=>{const n=await Object(Lt.b)({environment:this.environment,url:t.downloadUrl,method:"GET",json:!0});"success"===n.type&&e.onChange({url:n.data.url})},this.handleSwipeLeft=()=>{if(!Ot.a.state.isActive)return;const e=this.getTabs(),t=e.map(e=>e.type).indexOf(Ot.a.state.currentTab),n=e[t+1];void 0!==n&&this.handleTabChange(n.type)},this.handleSwipeRight=()=>{if(!Ot.a.state.isActive)return;const e=this.getTabs(),t=e.map(e=>e.type).indexOf(Ot.a.state.currentTab),n=e[t-1];void 0!==n&&this.handleTabChange(n.type)},this.handleTabChange=e=>{Ot.a.state.isActive&&Ot.a.setState(Wt({},Ot.a.state,{currentTab:e}))},this.handleRandomEmojiClick=()=>{const{device:e}=this.environment,t=this.getTabs().find(e=>e.type===this.props.currentTab);if(t&&"emoji"===t.type){const n=Object(Ut.c)();t.onChange(n,{keepVisible:!e.isMobile})}},this.handleEmojiFilterChange=e=>{const{emojiInputStore:t,emojiPickerStore:n}=this.stores;t.setState(Wt({},t.state,{inputValue:e.currentTarget.value})),n.setState(Wt({},n.state,{loadEmojiCount:Mt.a.emojisPerPage}))}}renderComponent(){const{device:e}=this.environment,t=this.renderTabsHeader(),n=this.renderInputHeader(),i=(t||n)&&r.a.createElement(a.Fragment,null,t,n);let s;return e.isMobile?s={menuType:ve.b.MenuType.Modal,title:this.props.title,header:i,right:r.a.createElement(se.a,{defaultMessage:"Close",id:"mediaPicker.mobileCloseButton.label"}),onClickRight:this.props.onCancel,left:this.props.onDelete&&r.a.createElement(se.a,{defaultMessage:"Remove",id:"mediaPicker.mobileRemoveButton.label"}),onClickLeft:this.props.onDelete}:(s={menuType:ve.b.MenuType.Popup,header:i},s.width=this.props.popupWidth||300,s.height=this.props.popupHeight,s.maxHeight=this.props.maxHeight,s.maxWidth=this.props.maxWidth),r.a.createElement(yt.a,{onSwipeLeft:this.handleSwipeLeft,onSwipeRight:this.handleSwipeRight,render:e=>r.a.createElement(ve.b,Object.assign({},s,e,{className:Ft.D}),this.renderCurrentTab())})}renderTabsHeader(){const{device:e}=this.environment;if(!(this.getTabs().length<=1)||this.props.onDelete){const t={gallery:r.a.createElement(se.a,{id:"mediaPicker.tabs.gallery",defaultMessage:"Gallery"}),embed:r.a.createElement(se.a,{id:"mediaPicker.tabs.embedLink",defaultMessage:"Embed link"}),file:r.a.createElement(se.a,{id:"mediaPicker.tabs.upload",defaultMessage:"Upload"}),emoji:r.a.createElement(se.a,{id:"mediaPicker.tabs.emoji",defaultMessage:"Emoji"}),unsplash:r.a.createElement(a.Fragment,null,vt.a.unsplashLogo({width:12,marginRight:4,height:12}),r.a.createElement("span",null,"Unsplash")),drive:r.a.createElement(se.a,{id:"mediaPicker.tabs.browse",defaultMessage:"Browse"})},n=this.getTabs(),i=n.findIndex(e=>e.type===this.props.currentTab),s=n.map(e=>e.title||t[e.type]),o=n.find(e=>e.type===this.props.currentTab),l=o&&"emoji"!==o.type&&e.isAndroid;return r.a.createElement(ft.a,{tabs:s,selectedIndex:i,onChange:e=>{const t=n[e];this.handleTabChange(t.type)},right:r.a.createElement(a.Fragment,null,o&&"emoji"===o.type&&r.a.createElement(et.a,{isGray:!0,icon:vt.a.random,onClick:this.handleRandomEmojiClick},r.a.createElement(se.a,{id:"mediaPicker.emojiTab.random",defaultMessage:"Random"})),this.props.onDelete&&!e.isMobile&&r.a.createElement(et.a,{isGray:!0,onClick:this.props.onDelete},r.a.createElement(se.a,{id:"mediaPicker.tabs.remove",defaultMessage:"Remove"}))),style:Wt({},l&&{borderBottom:"none"})})}}renderInputHeader(){const{device:e}=this.environment,t=this.getTabs().find(e=>e.type===this.props.currentTab),n=!e.isMobile||void 0;if(t&&"emoji"===t.type)return r.a.createElement("div",{style:{margin:e.isMobile?0:"10px 0"}},r.a.createElement(Se.a,{value:this.stores.emojiInputStore.state.inputValue,focusInitial:n,placeholder:Rt.a.formatMessage(zt.filterPlaceholder),showClearButton:!0,left:vt.a.searchThick(this.getSearchIconStyle()),onChange:this.handleEmojiFilterChange,style:Wt({},e.isAndroid&&{borderBottom:"none"})}))}renderCurrentTab(){const e=this.getTabs().find(e=>e.type===this.props.currentTab);if(!e)return r.a.createElement(se.a,{defaultMessage:"Uh oh! Something went wrong.",id:"mediaPicker.errorMessage"});switch(e.type){case"embed":return this.renderEmbedTab(e);case"file":return this.renderUploadTab(e);case"emoji":return this.renderEmojiTab(e);case"gallery":return this.renderGalleryTab(e);case"unsplash":return this.renderUnsplashTab(e);case"drive":return this.renderGoogleDriveTab(e)}}renderEmojiTab(e){return r.a.createElement(pt.a,{onSubmit:e.onChange,filter:this.stores.emojiInputStore.state.inputValue,store:this.stores.emojiPickerStore,isCallout:this.props.isCallout})}renderGalleryTab(e){return r.a.createElement("div",{style:{paddingBottom:8}},p.a.map(ct.a,(t,n)=>r.a.createElement(ye.a,{key:n,title:r.a.createElement(Pt.a,{style:{marginLeft:-5},href:t.url,external:!0},r.a.createElement(kt.a,null,Rt.a.formatMessage(t.title))),isTitleUppercase:!0,noTextOverflow:!0},r.a.createElement("div",{style:this.getGalleryWrapStyle()},t.items.map((t,n)=>{let{coverUrl:a,title:i,subtitle:s,position:o}=t;return r.a.createElement("div",{key:n,style:{width:"25%",padding:3}},r.a.createElement(ht.a,{originGap:0,placement:ht.a.Placement.Bottom,delayThreshold:600,renderTooltip:()=>r.a.createElement("div",{style:{maxWidth:180,whiteSpace:"normal"}},r.a.createElement("span",{style:{color:this.theme.regularInvertedTextColor}},Rt.a.formatMessage(i))," ",r.a.createElement("span",{style:{color:this.theme.mediumInvertedTextColor}},s&&Rt.a.formatMessage(s))),render:t=>r.a.createElement(wt.a,Object.assign({hoveredStyle:{opacity:.85}},t,{onClick:()=>{e.onChange({url:a,position:o})}}),r.a.createElement(Tt.a,{url:a,width:200,isAuthenticated:!1,render:(e,t)=>t&&r.a.createElement(mt.a,{src:t,style:{width:"100%",height:64,objectFit:"cover",objectPosition:"center ".concat(100*(o||0),"%"),borderRadius:3}})}))}))})))))}renderUnsplashTab(e){const{device:t}=this.environment;return r.a.createElement("div",{style:{paddingBottom:8}},r.a.createElement(ye.a,{desktopStyle:{marginTop:8,marginBottom:6}},r.a.createElement(Se.a,{value:this.stores.unsplashInputStore.state.inputValue,placeholder:Rt.a.formatMessage(zt.unsplashPlaceholder),showClearButton:!0,focus:!t.isMobile||void 0,onChange:e=>{this.stores.unsplashInputStore.setState(Wt({},this.stores.unsplashInputStore.state,{inputValue:e.target.value}))}})),r.a.createElement("div",{style:this.getGalleryWrapStyle()},r.a.createElement(It.a,{request:this.stores.unsplashInputStore.state.inputValue,debounce:jt.b,performRequest:async e=>{const t=await H.Xb(this.environment,{query:e,page:0});if("success"===t.type)return t.data.results;throw t.error},render:(t,n,a)=>this.renderUnsplashResults(e,t,n,a)})))}renderUploadTab(e){const{data:t}=Ct.a.state;return r.a.createElement(a.Fragment,null,e.fileUpload&&r.a.createElement(ye.a,{desktopStyle:{marginTop:this.props.isSmallWidth?8:24}},r.a.createElement(St.a,{title:r.a.createElement(se.a,{defaultMessage:"Choose a file",id:"mediaPicker.chooseFile.button.label"}),focused:!1,onClick:()=>this.handleUpload(e),fullWidth:this.props.isSmallWidth})),this.renderMediaCapture(e),e.caption&&r.a.createElement(ut.a,{shouldWrapCaption:!0,caption:e.caption,style:{textAlign:this.props.isSmallWidth?"left":"center",color:this.theme.mediumTextColor}}),e.preventUploadLimitFreeFileSize||t&&Et.D(t)&&r.a.createElement("div",{style:{height:8}}),t&&!e.preventUploadLimitFreeFileSize&&!Et.D(t)&&r.a.createElement(ut.a,{shouldWrapCaption:!0,caption:r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:this.props.isSmallWidth?"flex-start":"center"}},r.a.createElement("div",{style:{marginRight:6,color:this.theme.mediumTextColor}},r.a.createElement(se.a,{defaultMessage:"The maximum size per file is {filesize} MB.",id:"mediaPicker.maximumFileSize.notice",values:{filesize:bt.a}})),!l.b.isOnboarding.state&&r.a.createElement(gt.a,{subscriptionTier:Et.k(this.environment)||"team",onClick:()=>{this.props.onCancel&&this.props.onCancel()},analyticsName:"media_picker",desktopStyle:{marginBottom:1}}))}))}renderMediaCapture(e){if(e.imageUpload||e.videoUpload)return r.a.createElement(ye.a,{desktopStyle:{marginTop:this.props.isSmallWidth?8:24}},e.imageUpload&&r.a.createElement(St.a,{title:r.a.createElement(se.a,{defaultMessage:"Choose an image",id:"mediaPicker.chooseImage.buttonText"}),focused:!1,onClick:()=>this.handleUpload(e,"image/*"),fullWidth:this.props.isSmallWidth}),e.videoUpload&&r.a.createElement(St.a,{title:r.a.createElement(se.a,{defaultMessage:"Choose a video",id:"mediaPicker.chooseVideo.buttonText"}),focused:!1,onClick:()=>this.handleUpload(e,"video/*"),fullWidth:this.props.isSmallWidth}))}renderEmbedTab(e){const{device:t}=this.environment;return r.a.createElement(a.Fragment,null,r.a.createElement(ye.a,{desktopStyle:{marginTop:8,marginBottom:6}},r.a.createElement(Se.a,{type:"url",value:this.stores.embedInputStore.state.inputValue,placeholder:e.inputPlaceholder||Rt.a.formatMessage(zt.embedPlaceholder),showClearButton:!0,focus:!t.isMobile||void 0,onSubmit:this.handleEmbedSubmit(e),onChange:e=>{this.stores.embedInputStore.setState(Wt({},this.stores.embedInputStore.state,{inputValue:e.target.value}))}})),r.a.createElement(ye.a,null,r.a.createElement(St.a,{onClick:this.handleEmbedSubmit(e),focused:!1,title:e.buttonText||r.a.createElement(se.a,{defaultMessage:"Embed link",id:"mediaPicker.embedTab.embedLinkButtonText"}),fullWidth:this.props.isSmallWidth})),e.caption&&r.a.createElement(ut.a,{shouldWrapCaption:!0,caption:e.caption,style:{textAlign:t.isMobile?"left":"center"}}))}renderGoogleDriveTab(e){return r.a.createElement(It.a,{request:this.environment,performRequest:lt.b,render:(t,n,a)=>{if(!a)return r.a.createElement(ye.a,null,r.a.createElement(At.a,null));const i=n&&n.accounts?n.accounts:[];return this.renderGoogleDriveAccounts(e,i)}})}renderGoogleDriveAccounts(e,t){return 0===t.length?r.a.createElement(ye.a,null,r.a.createElement(Bt.a,{title:r.a.createElement(se.a,{defaultMessage:"Connect Google account",id:"mediaPicker.menuItem.connectFirstGoogleAccount.label"}),onClick:()=>e.onSelect(),focused:!1,style:{color:this.theme.blueColor}}),r.a.createElement(ut.a,{shouldWrapCaption:!1,caption:r.a.createElement(se.a,{defaultMessage:"Find and embed your Google Drive files.",id:"mediaPicker.menuItem.connectFirstGoogleAccount.caption"})})):r.a.createElement(a.Fragment,null,r.a.createElement(ye.a,null,t.map((t,n)=>r.a.createElement(Bt.a,{key:t.accountId,title:r.a.createElement(se.a,{defaultMessage:"Choose from {accountName}",id:"mediaPicker.menuItem.choosePagesFromAccount.label",values:{accountName:t.accountName}}),onClick:()=>e.onSelect(t),focused:!1}))),r.a.createElement(ye.a,{topBorder:!0},r.a.createElement(Bt.a,{title:r.a.createElement(se.a,{defaultMessage:"Connect another account",id:"mediaPicker.menuItem.connectMoreGoogleAccounts.label"}),onClick:()=>e.onSelect(),style:{color:this.theme.mediumTextColor},focused:!1})))}getTabs(){return this.props.tabs}async handleUpload(e,t){const n=await bt.b({multiple:!1,accept:t});n.length&&e.onUpload(n[0])}getLoadingContainerStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",minHeight:320,flex:1}}getSearchIconStyle(){return{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:this.theme.regularIconColor}}getGalleryWrapStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexWrap:"wrap",alignContent:"flex-start",background:this.theme.popoverBackground,paddingTop:e.isMobile?12:0,paddingBottom:e.isMobile?12:0,paddingLeft:e.isMobile?t.getSafePaddingLeftCSS(14):12,paddingRight:e.isMobile?t.getSafePaddingRightCSS(14):12,boxShadow:e.isMobile?"0 1px 0 ".concat(this.theme.regularDividerColor):""}}}var qt=Vt;class Ht extends o.a{constructor(){super(...arguments),this.handleCloseOverlay=()=>{ot.a()}}renderComponent(){const{device:e}=this.environment,{state:t}=Ot.a;return r.a.createElement(be.c,{popupType:e.isMobile?be.c.PopupType.SlideUp:be.c.PopupType.Popup,open:t.isActive,originRect:t.isActive?t.originRect:void 0,originGap:t.isActive?t.originGap:void 0,placementToOrigin:be.c.Placement.Bottom,alignmentToOrigin:be.c.Alignment.Center,preventScaleTransition:!0,onDismiss:this.handleCloseOverlay,render:()=>{if(t.isActive)return r.a.createElement(qt,Object.assign({},t,{onCancel:this.handleCloseOverlay}))}})}}var Gt=Ht,Yt=n(214),Qt=n(12);class Kt extends o.a{constructor(){super(...arguments),this.handleDragOver=e=>{e.preventDefault(),this.startDrag(e),this.continueDragThrottled(e)},this.handleDrop=e=>{e.preventDefault();const t=Array.from(e.dataTransfer.files);t.length>0&&Qt.d(this.environment,e=>{Yt.d({environment:this.environment,files:t,analyticsFrom:"native_drag",transaction:e})})},this.startDrag=e=>{Yt.g(this.environment,{startX:e.clientX,startY:e.clientY,stores:[],isNativeDrag:!0,getGhostElement:void 0})&&m.e(this.environment)},this.continueDrag=e=>{this.cancelDragTimeout&&window.clearTimeout(this.cancelDragTimeout),this.cancelDragTimeout=window.setTimeout(this.cancelDrag,this.getCancelDragTimeoutMS()),Yt.e(this.environment,{currentX:e.clientX,currentY:e.clientY})},this.continueDragThrottled=p.a.throttle(this.continueDrag,Kt.dragOverThrottleMS),this.cancelDrag=()=>{Yt.a(this.environment)}}didMount(){super.didMount(),window.addEventListener("dragover",this.handleDragOver),window.addEventListener("drop",this.handleDrop)}willUnmount(){super.willUnmount(),window.removeEventListener("dragover",this.handleDragOver),window.removeEventListener("drop",this.handleDrop)}getCancelDragTimeoutMS(){const{device:e}=this.environment;return e.isLinux?2e3:200}}Kt.dragOverThrottleMS=62.5;var Zt=Kt,Xt=n(513),$t=n(90),Jt=n(123),en=n(28),tn=n(421),nn=n(48);class an extends o.a{constructor(){super(...arguments),this.renderPopupContent=()=>r.a.createElement(sn,null)}renderComponent(){const{device:e}=this.environment,{blockStore:t,originRect:n}=tn.a.state;return r.a.createElement(be.c,{popupType:e.isMobile?be.c.PopupType.SlideUp:be.c.PopupType.Popup,open:Boolean(t),originRect:n,placementToOrigin:be.c.Placement.Bottom,alignmentToOrigin:be.c.Alignment.Center,originGap:4,onDismiss:()=>Xt.a(this.environment),render:this.renderPopupContent})}}class rn extends o.a{constructor(){super(...arguments),this.handleRecordIconChange=e=>{const{blockStore:t}=tn.a.state;if(t){const n=t.getIconStore();n&&Qt.d(this.environment,t=>{en.c({store:n,value:e,transaction:t})})}}}didMount(){const{blockStore:e}=tn.a.state;if(!e)return;const t=e.getTitleStore();t&&nn.j({environment:this.environment,store:t,canSelectAllBlocks:!1})}renderComponent(){const{device:e}=this.environment,{blockStore:t}=tn.a.state;if(!t)return;const n=t.getTitleStore();if(!n)return;let a;return a=e.isMobile?{menuType:ve.b.MenuType.ActionSheet}:{menuType:ve.b.MenuType.Popup,width:380},r.a.createElement(ve.b,Object.assign({},a),r.a.createElement("div",{style:this.getWrapStyle()},this.renderIcon(t),r.a.createElement(Jt.a,{store:n,disabled:!t.canEdit(),onEsc:()=>Xt.a(this.environment),onEnter:()=>Xt.a(this.environment),disableSlashCommands:!0,disableEmojiCommands:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,placeholder:this.props.intl.formatMessage({defaultMessage:"Untitled",id:"renamePageMenuPopup.input.placeholder"}),style:this.getInputStyle()})))}renderIcon(e){const t={width:28,height:28,marginRight:6,flexShrink:0,flexGrow:0,boxShadow:"inset 0 0 0 1px ".concat(this.theme.darkDividerColor)};return e.canEdit()?r.a.createElement($t.a,{disabled:!1,bucket:"secure",store:e,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:18,style:t,onChange:this.handleRecordIconChange}):r.a.createElement($t.a,{disabled:!0,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:18,style:t})}getWrapStyle(){return{display:"flex",alignItems:"center",color:this.theme.regularTextColor,fontSize:"13px",padding:"4px 8px"}}getInputStyle(){return{display:"flex",alignItems:"center",flexGrow:1,fontSize:14,lineHeight:"20px",paddingTop:4,paddingBottom:4,paddingLeft:10,paddingRight:10,width:"100%",borderRadius:3,boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,cursor:"text",position:"relative"}}}const sn=Object(se.g)(rn);var on=an,ln=n(851),cn=n(291),dn=n(568),un=n(273),pn=n(567),mn=n(220);function hn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function gn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hn(Object(n),!0).forEach((function(t){bn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function bn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const fn=[cn.a.Open,cn.a.Resolved];class yn extends o.a{constructor(){super(...arguments),this.handleChangeTab=e=>{const t=cn.b.state;t.open&&cn.b.setState(gn({},t,{tab:fn[e]}))}}renderComponent(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:ve.b.MenuType.Modal,title:r.a.createElement(se.a,{defaultMessage:"Discussion",id:"blockDiscussionMenu.mobileMenu.title"}),header:this.renderMenuHeader(),right:r.a.createElement(we.DoneMenuText,null),onClickRight:un.a,whiteBackground:!0}:{menuType:ve.b.MenuType.Popup,header:this.renderMenuHeader(),width:480,maxHeight:"50vh",onClickOutside:un.a},r.a.createElement(Ke.a,{capture:!0},r.a.createElement(mn.a,{capture:!0,render:()=>r.a.createElement(Ee.a,{capture:!0,onEsc:un.a},r.a.createElement(ve.b,Object.assign({},t),this.renderMenuContent()))}))}renderMenuHeader(){const{device:e}=this.environment,t=oe.m(this.props.blockStore).length,n=oe.l(this.props.blockStore).length;return r.a.createElement(ft.a,{tabs:[t?r.a.createElement(se.a,{defaultMessage:"Open ({numberOfOpenDiscussions})",id:"blockDiscussionMenu.openDiscussionsTab.title",values:{numberOfOpenDiscussions:t}}):r.a.createElement(se.a,{defaultMessage:"Open",id:"blockDiscussionMenu.openDiscussionsTabEmpty.title"}),n?r.a.createElement(se.a,{defaultMessage:"Resolved ({numberOfResolvedDiscussions})",id:"blockDiscussionMenu.resolvedDiscussionsTab.title",values:{numberOfResolvedDiscussions:n}}):r.a.createElement(se.a,{defaultMessage:"Resolved",id:"blockDiscussionMenu.resolvedDiscussionsTabEmpty.title"})],selectedIndex:fn.indexOf(this.props.tab),onChange:this.handleChangeTab,style:gn({},e.isAndroid&&{borderBottom:"none"})})}renderMenuContent(){const{device:e}=this.environment;if(this.props.tab===cn.a.Open){const t=oe.m(this.props.blockStore);if(t.length){const n=t.map((e,t,n)=>r.a.createElement(dn.a,{key:e.id,store:e,format:dn.a.Format.Menu,isFirst:0===t,isOnly:1===n.length,discussionLocation:"block_menu",alwaysShowResolve:!0,blockStore:this.props.blockStore,onDismiss:un.a})),i=this.props.blockStore.getType(),s=i&&f.p[i];if(e.isMobile&&s){const e=pn.a(this.props.blockStore);return e?r.a.createElement(a.Fragment,null,r.a.createElement("div",{style:{padding:"12px 16px",boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor),marginBottom:1}},r.a.createElement(e,{store:this.props.blockStore,disabled:!0,hideContent:!0,style:{fontSize:14,pointerEvents:"none"},isQuickFind:!0})),n):n}return n}return this.renderEmptyState(r.a.createElement(se.a,{defaultMessage:"No comments to show.",id:"blockDiscussionMenu.emptyState.noCommentsMessage"}))}{const e=oe.l(this.props.blockStore);return e.length?e.map((e,t,n)=>r.a.createElement(dn.a,{key:e.id,store:e,format:dn.a.Format.Menu,isFirst:0===t,isOnly:1===n.length,discussionLocation:"block_menu",alwaysShowResolve:!0,blockStore:this.props.blockStore,onDismiss:un.a})):this.renderEmptyState(r.a.createElement(se.a,{defaultMessage:"No resolved comments.",id:"blockDiscussionMenu.emptyStatte.noResolvedCommentsMessage"}))}}renderEmptyState(e){const{device:t}=this.environment;return r.a.createElement("div",{style:{textAlign:"center",padding:t.isMobile?"64px 18px":"32px 18px 36px",fontSize:14,color:this.theme.mediumTextColor}},e)}}var Sn=yn;class vn extends o.a{constructor(){super(...arguments),this.renderDiscussionMenu=()=>{if(cn.b.state.open)return r.a.createElement(Sn,{rect:cn.b.state.rect,tab:cn.b.state.tab,blockStore:cn.b.state.blockStore})}}renderComponent(){const{device:e}=this.environment,{open:t,rect:n}=cn.b.state;return r.a.createElement(be.c,{popupType:e.isMobile?be.c.PopupType.SlideUp:be.c.PopupType.Popup,open:t,originRect:n,placementToOrigin:be.c.Placement.Bottom,alignmentToOrigin:be.c.Alignment.Center,disableMouseCapture:!0,originGap:4,render:this.renderDiscussionMenu,preventScaleTransition:!0,preventOpacityTransition:!0,onDismiss:un.a})}}var En=vn,Mn=n(54),Cn=n(516),On=n(394),wn=n(856),kn=n(293);class Pn extends o.a{constructor(){super(...arguments),this.renderDiscussionInput=()=>{if(kn.a.state.open){const{blockStore:e,discussionInputStore:t}=kn.a.state;return r.a.createElement(wn.a,{capture:!0},r.a.createElement(mn.a,{capture:!0,render:()=>r.a.createElement("div",{style:this.getStyle()},r.a.createElement(Cn.a,{parentStore:e,onCancel:this.handleDismiss,onSubmit:this.handleSubmit,discussionInputStore:t,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1}))}))}},this.handleSubmit=()=>{const e=kn.a.state;if(e.open){const t=e.discussionInputStore.state.textStore.getValue();t&&t.length>0&&("inline"===e.type?Qt.d(this.environment,n=>{On.c({environment:this.environment,textStore:e.textStore,selection:e.selection,commentTextValue:t,transaction:n})}):"block"===e.type&&Qt.d(this.environment,n=>{On.b({environment:this.environment,blockStore:e.blockStore,commentTextValue:t,transaction:n})})),On.a(this.environment)}},this.handleDismiss=()=>{const e=kn.a.state;if(e.open){const t=e.discussionInputStore.state.textStore.getValue();t&&t.length>0?Mn.c({message:r.a.createElement(se.a,{id:"newDiscussionMenu.discardCommentConfirmationDialog.prompt",defaultMessage:"Do you want to discard the comment?"}),showCancel:!0,keepFocus:!0,items:[{label:r.a.createElement(se.a,{id:"newDiscussionMenu.discardCommentConfirmationDialog.discardButton.label",defaultMessage:"Discard"}),color:"red",onAccept:()=>On.a(this.environment)}]}):On.a(this.environment)}}}renderComponent(){const{device:e}=this.environment,{open:t,rect:n}=kn.a.state;return r.a.createElement(be.c,{popupType:e.isReactNative?be.c.PopupType.SlideUp:be.c.PopupType.Popup,keepFocus:!0,open:t,originRect:n,placementToOrigin:be.c.Placement.Bottom,alignmentToOrigin:be.c.Alignment.Center,originGap:4,onDismiss:this.handleDismiss,render:this.renderDiscussionInput})}getStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{width:e.isReactNative?"100%":470,maxWidth:e.isMobileBrowser?"90vw":"100%",paddingTop:8,paddingBottom:e.isAndroid?12:8,paddingLeft:e.isReactNative?t.getSafePaddingLeftCSS(10):10,paddingRight:e.isReactNative?t.getSafePaddingRightCSS(10):10}}}var Tn=Pn,In=n(469),jn=n(478);class Dn extends o.a{constructor(){super(...arguments),this.renderDiscussion=()=>{const{device:e}=this.environment;if(jn.a.state.open){const{discussionStore:t,discussionInputStore:n,blockStore:a}=jn.a.state;let i;return i=e.isMobile?{menuType:ve.b.MenuType.Modal,title:r.a.createElement(se.a,{defaultMessage:"Discussion",id:"discussion.mobileReplyMenu.title"}),right:r.a.createElement(se.a,{defaultMessage:"Close",id:"discussion.mobileReplyMenu.closeButton.label"}),onClickRight:()=>In.a(this.environment),whiteBackground:!0}:{menuType:ve.b.MenuType.Popup,width:420,maxWidth:e.isMobileBrowser?"80vw":"100%"},r.a.createElement(ve.b,Object.assign({},i),r.a.createElement(mn.a,{capture:!0,render:()=>r.a.createElement(dn.a,{store:t,discussionInputStore:n,onDismiss:()=>In.a(this.environment),format:dn.a.Format.Menu,isFirst:!0,isOnly:!0,discussionLocation:"reply_menu",alwaysShowResolve:!0,blockStore:a})}))}}}renderComponent(){const{device:e}=this.environment,{open:t,rect:n}=jn.a.state;return r.a.createElement(be.c,{popupType:e.isMobile?be.c.PopupType.SlideUp:be.c.PopupType.Popup,open:t,originRect:n,placementToOrigin:be.c.Placement.Bottom,alignmentToOrigin:be.c.Alignment.Center,originGap:4,onDismiss:()=>In.a(this.environment),render:this.renderDiscussion})}}var xn=Dn,Bn=(n(302),n(363)),An=n(55),Fn=n(589),Rn=n(287),Ln=n(155),Un=n(301),_n=n(748),Wn=n(760),Nn=n(4),zn=n(694),Vn=n(205),qn=n(81),Hn=n(843),Gn=n(188),Yn=n(691),Qn=n(30),Kn=n(37),Zn=n(42),Xn=n(149),$n=n(231),Jn=n(367),ea=n(74),ta=n(590),na=(n(365),n(82));function aa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ra(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const ia=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aa(Object(n),!0).forEach((function(t){ra(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Xe.a.textOverflowStyle,{fontWeight:Xe.a.fontWeight.medium,maxWidth:160,display:"inline-block",verticalAlign:"bottom"});function sa(e){const{pageTitle:t}=e;return t?r.a.createElement(se.a,{defaultMessage:"New “{filterText}” page in…",id:"createPageMenuItem.title.withPageName",values:{filterText:r.a.createElement("span",{style:ia},t)}}):r.a.createElement(se.a,{defaultMessage:"Add new page in…",id:"createPageMenuItem.title.withoutPageName"})}function oa(e){const{pageTitle:t}=e;return t?r.a.createElement(se.a,{defaultMessage:"New “{filterText}” sub-page",id:"createSubpageMenuItem.title.withPageName",values:{filterText:r.a.createElement("span",{style:ia},t)}}):r.a.createElement(se.a,{defaultMessage:"Add new sub-page",id:"createSubpageMenuItem.title.withoutPageName"})}o.a;var la=n(258),ca=n(20),da=n(95),ua=n(167),pa=n(1247),ma=n(255),ha=n(132);function ga(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ba(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ga(Object(n),!0).forEach((function(t){fa(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ga(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const ya=Object(se.f)({mentionAll:{defaultMessage:"Mention a person, page, or date…",id:"mentionMenu.personPageDate.prompt2"},mentionPersonPage:{defaultMessage:"Mention a person or page…",id:"mentionMenu.personPage.prompt2"},mentionPersonDate:{defaultMessage:"Mention a person or date…",id:"mentionMenu.personDate.prompt2"},mentionPageDate:{defaultMessage:"Mention a page or date…",id:"mentionMenu.pageDate.prompt2"},mentionPerson:{defaultMessage:"Mention a person…",id:"mentionMenu.person.prompt2"},mentionDate:{defaultMessage:"Mention a date…",id:"mentionMenu.date.prompt2"},mentionPage:{defaultMessage:"Type to link or add page…",id:"mentionMenu.page.prompt2"},addPage:{defaultMessage:"Type to add or link page…",id:"mentionMenu.addPage.prompt2"}}),Sa=Object(se.f)({autocompleteToday:{defaultMessage:"Today",id:"mentionMenu.date.autocomplete.today"},autocompleteNextTuesday:{defaultMessage:"Next Tuesday 3pm",id:"mentionMenu.date.autocomplete.nextTuesday"},autocompleteReminder:{defaultMessage:"Remind tomorrow 9am",id:"mentionMenu.date.autocomplete.reminder"},reminder:{defaultMessage:"Remind {dateTime}",id:"mentionMenu.date.remindAtDateTime",description:"dateTime will be a message representing the date (with or without time) that the user wants to be reminded at, like 'Tomorrow 3pm' or 'Mar 1, 2020'"},noResults:{defaultMessage:"No results",id:"mentionMenu.noSearchResults.title",description:"A label describing that no results have been found."}});class va extends o.a{constructor(){super(...arguments),this.storeTypes={ignoreSelectionAreaStore:ta.a,localPageMentionRequestStore:ma.a,localCachePageMentionRequestStore:ma.a},this.renderMentionResult=(e,t)=>{const{intl:n}=this.props,a=Gn.a.state,i=a.open&&a.insertionType,s={sections:[],nextSectionShouldHaveTopBorder:()=>s.sections.length>0,addSection(e){e&&this.sections.push(e)}};"+"===i&&s.addSection(this.getCreatePageMenuSection(s.nextSectionShouldHaveTopBorder())),s.addSection(this.getDateResultsMenuSection(t,s.nextSectionShouldHaveTopBorder())),s.addSection(this.getUserResultsMenuSection(t,s.nextSectionShouldHaveTopBorder())),s.addSection(this.getPageResultsMenuSection(t,s.nextSectionShouldHaveTopBorder())),("@"===i&&this.filterStore.state||"[["===i)&&s.addSection(this.getCreatePageMenuSection(s.nextSectionShouldHaveTopBorder()));const{sections:o}=s;let l,c;if(qn.a.state.online){const e=a.mentionTypes.user,t=a.mentionTypes.page,r=a.mentionTypes.date;let i="";const s=ya;e&&t&&r?i=n.formatMessage(s.mentionAll):e&&t?i=n.formatMessage(s.mentionPersonPage):e&&r?i=n.formatMessage(s.mentionPersonDate):t&&r?i=n.formatMessage(s.mentionPageDate):e?i=n.formatMessage(s.mentionPerson):r?i=n.formatMessage(s.mentionDate):t&&a&&(i=a.open&&"+"===a.insertionType?n.formatMessage(ya.addPage):n.formatMessage(s.mentionPage)),this.setTemporaryInputData({title:i,icon:this.renderTemporaryInputEmptyIcon(),allowTabCompletion:!1}),l=void 0}else l=r.a.createElement(Ln.a,{title:r.a.createElement(se.a,{defaultMessage:"Please go online to mention a person or page.",id:"mentionMenu.offlineMessage"})});0===o.length&&(c=r.a.createElement(ye.a,null,r.a.createElement(Ln.a,{title:r.a.createElement(se.a,Object.assign({},Sa.noResults))})));const{device:d}=this.environment;let u;return u=this.isActionSheet()?{menuType:ve.b.MenuType.ActionSheet,disableBottomPadding:!0}:{menuType:ve.b.MenuType.Popup,width:this.getMenuDesktopWidth(),maxHeight:d.isMobile?"30vh":"40vh",onClickOutside:Bn.d},r.a.createElement(ve.b,Object.assign({},u,{header:l}),r.a.createElement(Ee.a,{capture:Gn.a.state.open,onBackspace:this.shouldCaptureBackspace()?this.handleEmptyBackspace:void 0,onTab:this.handleTab}),r.a.createElement(An.a,{type:An.a.Type.Vertical,initialFocus:this.getMenuInitialFocus(),sections:o,onEmptyEnter:this.handleCancel}),c)},this.handleCreateInAutocompleteQueryChange=e=>{this.updateOpenState({createInQuery:e})},this.renderCreateInMenu=()=>{const e=Gn.a.state;if(!e.open)return;const t="block"===e.textStore.table?e.textStore.id:void 0;return r.a.createElement(_n.a,{targets:[],isAddTo:!0,isCreateIn:!0,onAccept:e=>{Bn.b({environment:this.environment,titleText:this.getNormalizedFilter(),ignoreSelectionAreaStore:this.stores.ignoreSelectionAreaStore,createInValue:e})},captureSelection:!0,restoreSelection:!0,parentBlockId:t,onAutocompleteQueryChange:this.handleCreateInAutocompleteQueryChange,ignoreSelectionAreaStore:this.stores.ignoreSelectionAreaStore,autocompleteQuery:e.createInQuery,desktopWidth:this.getMenuDesktopWidth(),onCancel:this.handleCreateInCancel})},this.handleCreateInStart=()=>{this.updateOpenState({showCreateIn:!0})},this.handleCreateInCancel=()=>{this.updateOpenState({showCreateIn:!1,createInQuery:""})},this.handleEmptyBackspace=e=>{this.shouldCaptureBackspace()&&e.preventDefault(),this.handleCancel()},this.handleCancel=()=>{Bn.d()},this.handleTab=e=>{e.preventDefault();const t=this.tabCompletionString;if(!t)return;const n=Qn.a.state;if("editing"!==n.mode)return;const a=Gn.a.state;a.open&&a.textStore===n.store&&Qt.d(this.environment,e=>{ea.n({environment:this.environment,transaction:e,string:t,store:n.store,selection:n.selection,disableMentions:!0,disableDateMentions:!0,disableEmojiCommands:!0,disableSlashCommands:!0})})},this.tabCompletionString=void 0,this.letterCharacterClass=(()=>{try{return/[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEF\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7C6\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB67\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\u{10000}-\u{1000B}\u{1000D}-\u{10026}\u{10028}-\u{1003A}\u{1003C}\u{1003D}\u{1003F}-\u{1004D}\u{10050}-\u{1005D}\u{10080}-\u{100FA}\u{10280}-\u{1029C}\u{102A0}-\u{102D0}\u{10300}-\u{1031F}\u{1032D}-\u{10340}\u{10342}-\u{10349}\u{10350}-\u{10375}\u{10380}-\u{1039D}\u{103A0}-\u{103C3}\u{103C8}-\u{103CF}\u{10400}-\u{1049D}\u{104B0}-\u{104D3}\u{104D8}-\u{104FB}\u{10500}-\u{10527}\u{10530}-\u{10563}\u{10600}-\u{10736}\u{10740}-\u{10755}\u{10760}-\u{10767}\u{10800}-\u{10805}\u{10808}\u{1080A}-\u{10835}\u{10837}\u{10838}\u{1083C}\u{1083F}-\u{10855}\u{10860}-\u{10876}\u{10880}-\u{1089E}\u{108E0}-\u{108F2}\u{108F4}\u{108F5}\u{10900}-\u{10915}\u{10920}-\u{10939}\u{10980}-\u{109B7}\u{109BE}\u{109BF}\u{10A00}\u{10A10}-\u{10A13}\u{10A15}-\u{10A17}\u{10A19}-\u{10A35}\u{10A60}-\u{10A7C}\u{10A80}-\u{10A9C}\u{10AC0}-\u{10AC7}\u{10AC9}-\u{10AE4}\u{10B00}-\u{10B35}\u{10B40}-\u{10B55}\u{10B60}-\u{10B72}\u{10B80}-\u{10B91}\u{10C00}-\u{10C48}\u{10C80}-\u{10CB2}\u{10CC0}-\u{10CF2}\u{10D00}-\u{10D23}\u{10F00}-\u{10F1C}\u{10F27}\u{10F30}-\u{10F45}\u{10FE0}-\u{10FF6}\u{11003}-\u{11037}\u{11083}-\u{110AF}\u{110D0}-\u{110E8}\u{11103}-\u{11126}\u{11144}\u{11150}-\u{11172}\u{11176}\u{11183}-\u{111B2}\u{111C1}-\u{111C4}\u{111DA}\u{111DC}\u{11200}-\u{11211}\u{11213}-\u{1122B}\u{11280}-\u{11286}\u{11288}\u{1128A}-\u{1128D}\u{1128F}-\u{1129D}\u{1129F}-\u{112A8}\u{112B0}-\u{112DE}\u{11305}-\u{1130C}\u{1130F}\u{11310}\u{11313}-\u{11328}\u{1132A}-\u{11330}\u{11332}\u{11333}\u{11335}-\u{11339}\u{1133D}\u{11350}\u{1135D}-\u{11361}\u{11400}-\u{11434}\u{11447}-\u{1144A}\u{1145F}\u{11480}-\u{114AF}\u{114C4}\u{114C5}\u{114C7}\u{11580}-\u{115AE}\u{115D8}-\u{115DB}\u{11600}-\u{1162F}\u{11644}\u{11680}-\u{116AA}\u{116B8}\u{11700}-\u{1171A}\u{11800}-\u{1182B}\u{118A0}-\u{118DF}\u{118FF}\u{119A0}-\u{119A7}\u{119AA}-\u{119D0}\u{119E1}\u{119E3}\u{11A00}\u{11A0B}-\u{11A32}\u{11A3A}\u{11A50}\u{11A5C}-\u{11A89}\u{11A9D}\u{11AC0}-\u{11AF8}\u{11C00}-\u{11C08}\u{11C0A}-\u{11C2E}\u{11C40}\u{11C72}-\u{11C8F}\u{11D00}-\u{11D06}\u{11D08}\u{11D09}\u{11D0B}-\u{11D30}\u{11D46}\u{11D60}-\u{11D65}\u{11D67}\u{11D68}\u{11D6A}-\u{11D89}\u{11D98}\u{11EE0}-\u{11EF2}\u{12000}-\u{12399}\u{12480}-\u{12543}\u{13000}-\u{1342E}\u{14400}-\u{14646}\u{16800}-\u{16A38}\u{16A40}-\u{16A5E}\u{16AD0}-\u{16AED}\u{16B00}-\u{16B2F}\u{16B40}-\u{16B43}\u{16B63}-\u{16B77}\u{16B7D}-\u{16B8F}\u{16E40}-\u{16E7F}\u{16F00}-\u{16F4A}\u{16F50}\u{16F93}-\u{16F9F}\u{16FE0}\u{16FE1}\u{16FE3}\u{17000}-\u{187F7}\u{18800}-\u{18AF2}\u{1B000}-\u{1B11E}\u{1B150}-\u{1B152}\u{1B164}-\u{1B167}\u{1B170}-\u{1B2FB}\u{1BC00}-\u{1BC6A}\u{1BC70}-\u{1BC7C}\u{1BC80}-\u{1BC88}\u{1BC90}-\u{1BC99}\u{1D400}-\u{1D454}\u{1D456}-\u{1D49C}\u{1D49E}\u{1D49F}\u{1D4A2}\u{1D4A5}\u{1D4A6}\u{1D4A9}-\u{1D4AC}\u{1D4AE}-\u{1D4B9}\u{1D4BB}\u{1D4BD}-\u{1D4C3}\u{1D4C5}-\u{1D505}\u{1D507}-\u{1D50A}\u{1D50D}-\u{1D514}\u{1D516}-\u{1D51C}\u{1D51E}-\u{1D539}\u{1D53B}-\u{1D53E}\u{1D540}-\u{1D544}\u{1D546}\u{1D54A}-\u{1D550}\u{1D552}-\u{1D6A5}\u{1D6A8}-\u{1D6C0}\u{1D6C2}-\u{1D6DA}\u{1D6DC}-\u{1D6FA}\u{1D6FC}-\u{1D714}\u{1D716}-\u{1D734}\u{1D736}-\u{1D74E}\u{1D750}-\u{1D76E}\u{1D770}-\u{1D788}\u{1D78A}-\u{1D7A8}\u{1D7AA}-\u{1D7C2}\u{1D7C4}-\u{1D7CB}\u{1E100}-\u{1E12C}\u{1E137}-\u{1E13D}\u{1E14E}\u{1E2C0}-\u{1E2EB}\u{1E800}-\u{1E8C4}\u{1E900}-\u{1E943}\u{1E94B}\u{1EE00}-\u{1EE03}\u{1EE05}-\u{1EE1F}\u{1EE21}\u{1EE22}\u{1EE24}\u{1EE27}\u{1EE29}-\u{1EE32}\u{1EE34}-\u{1EE37}\u{1EE39}\u{1EE3B}\u{1EE42}\u{1EE47}\u{1EE49}\u{1EE4B}\u{1EE4D}-\u{1EE4F}\u{1EE51}\u{1EE52}\u{1EE54}\u{1EE57}\u{1EE59}\u{1EE5B}\u{1EE5D}\u{1EE5F}\u{1EE61}\u{1EE62}\u{1EE64}\u{1EE67}-\u{1EE6A}\u{1EE6C}-\u{1EE72}\u{1EE74}-\u{1EE77}\u{1EE79}-\u{1EE7C}\u{1EE7E}\u{1EE80}-\u{1EE89}\u{1EE8B}-\u{1EE9B}\u{1EEA1}-\u{1EEA3}\u{1EEA5}-\u{1EEA9}\u{1EEAB}-\u{1EEBB}\u{20000}-\u{2A6D6}\u{2A700}-\u{2B734}\u{2B740}-\u{2B81D}\u{2B820}-\u{2CEA1}\u{2CEB0}-\u{2EBE0}\u{2F800}-\u{2FA1D}]/u}catch(e){return/[a-zA-Z]/}})(),this.inputSelectionsStore=this.createComputedStore(()=>{const e=Gn.a.state;if(e.open)return Wn.c(e.textStore,e.oldTextValue,e.insertionType)}),this.filterStore=this.createComputedStore(()=>{const e=this.inputSelectionsStore.state,t=Gn.a.state;if(e&&t.open)return Wn.b(t.textStore,e)}),this.popupOpenStore=this.createComputedStore(()=>{const e=Gn.a.state;return!!e.open&&("+"!==e.insertionType||""!==this.getNormalizedFilter())}),this.performUserMentionRequest=async e=>{const t=Gn.a.state;if(!t.open)return;const n=t.mentionTypes.user?await this.getUserResults(e):[];return""===e?n.slice(0,2):n.slice(0,20)},this.performLocalCachePageMentionRequest=async()=>{const{currentSpaceStore:e,currentSpaceViewStore:t}=U.a.state;if(e)return Yn.h({environment:this.environment,currentSpaceStore:e,currentSpaceViewStore:t})},this.performLocalPageMentionRequest=e=>{const{localCachePageMentionRequestStore:t}=this.stores,n=t.state.result;if(!n)return;const a=Yn.g({input:e,cache:n});if(!a)return;if(0===a.results.length)return{error:ua.d.NoResults};const r=T.d();if(!r)return;const i=Yn.n({sort:e.query.sort,unsorted:a.results,batchSize:pa.b,currentUserId:this.environment.currentUser.id}).results.map(e=>ba({},e,{store:b.a.createChildStore(r,{table:f.a,id:e.id})}));return{value:{total:i.length,results:i}}},this.performPageMentionRequest=async e=>{const t=Gn.a.state;if(!t.open)return[];const n=t.mentionTypes.page?await this.getPageResults(e):[];return""===e?n.slice(0,2):n.slice(0,20)},this.getUserResults=async e=>{if(qn.a.state.online){return await jt.l({environment:this.environment,query:e,membersOnly:!1})}return[]},this.getPageResults=async e=>{if(!qn.a.state.online)return[];const t=Gn.a.state,n=t.open&&Object(oe.n)(t.textStore)&&t.textStore;return await jt.e({nearBlock:n||void 0,environment:this.environment,query:e,source:"mention_menu",limit:20})},this.getDateResults=e=>{const t=Gn.a.state;if(!t.open)return[];const{intl:n}=this.props,a=t.mentionTypes.reminder;return t.mentionTypes.date?function(e,t,n){if(0===e.length)return p.a.compact([{label:n.formatMessage(Sa.autocompleteToday),value:()=>X.nb(X.m)},t?void 0:{label:n.formatMessage(Sa.autocompleteNextTuesday),value:()=>{const e=X.ob(X.m),t=e.clone().day(2);return t.isSameOrBefore(e)&&t.add(1,"week"),t.add(1,"week"),t.hour(15),{type:"datetime",start_date:t.format(X.ib),start_time:t.format(X.kb),time_zone:X.m}}},t?{label:n.formatMessage(Sa.autocompleteReminder),value:()=>({type:"datetime",start_date:X.pb(X.m).start_date,start_time:"09:00",reminder:{unit:"day",value:0,time:X.w},time_zone:X.m})}:void 0]);const a=t?Object(zn.e)(e,n):Object(zn.d)(e,n);if(a){let e=Object(Vn.a)({value:a,date_format:"relative",userTimeZone:X.m,intl:n,allowRelativeDates:!0});return a.reminder&&(e=n.formatMessage(Sa.reminder,{dateTime:e})),[{label:e,value:()=>a}]}return[]}(e,a,n).slice(0,6):[]}}willMountOrUpdate(){const e=Gn.a.state,t=this.filterStore.state;if(e.open){const n=Qn.a.state,a="editing"===n.mode&&n.store===e.textStore,r=this.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState,i=r&&"editing"===r.mode&&r.store===e.textStore;if(!a&&!i)return void Bn.d();const s=a&&"editing"===n.mode&&n.selection,o=this.inputSelectionsStore.state;if(o&&s&&(s.startIndex<o.filter.startIndex||s.endIndex>o.filter.endIndex))return void Bn.d();const l=this.filterStore.state&&this.filterStore.state[0];if("+"===e.insertionType&&l&&!l.match(this.letterCharacterClass))return void Bn.d();if(void 0===t)return void Bn.d()}}renderComponent(){const{device:e}=this.environment,t=Gn.a.state,n=Hn.a.findComponent(e=>e.props.capture),a=this.popupOpenStore.state;let i;if(n&&e.isMobile){const e=n.stores.store.state.rect;e&&(i={height:"calc(100vh - ".concat(e.height,"px)")})}const s=t.open&&t.showCreateIn;return r.a.createElement(be.c,{popupType:this.isActionSheet()?be.c.PopupType.SlideUp:be.c.PopupType.Popup,open:a,originRect:t.open?t.selectionRect:void 0,slideUpWrapStyle:i,placementToOrigin:be.c.Placement.Bottom,alignmentToOrigin:be.c.Alignment.Start,originGap:8,disableMouseCapture:!0,disableContentScroll:!0,onDismiss:this.handleCancel,disableDarkOverlayBackground:e.isMobile&&!n,keepFocus:!0,render:()=>e.isMobile?r.a.createElement(r.a.Fragment,null,this.renderMentionSearch(),r.a.createElement(be.c,{popupType:be.c.PopupType.SlideUp,render:this.renderCreateInMenu,open:s,keepFocus:!0})):s?this.renderCreateInMenu():this.renderMentionSearch()})}renderMentionSearch(){var e=this;const t=this.getNormalizedFilter(),n=Gn.a.state,a=ha.a.createMetric("rum.mention_menu_ready");return r.a.createElement(It.a,{requestStore:n.userRequestStore,request:t,performRequest:this.performUserMentionRequest,render:i=>r.a.createElement(It.a,{requestStore:n.pageRequestStore,request:t,performRequest:this.performPageMentionRequest,debounce:jt.b,render:n=>r.a.createElement(It.a,{requestStore:this.stores.localCachePageMentionRequestStore,request:U.a.state.currentSpaceStore&&U.a.state.currentSpaceStore.id,performRequest:this.performLocalCachePageMentionRequest,render:s=>r.a.createElement(It.a,{requestStore:this.stores.localPageMentionRequestStore,debounce:jt.a,request:{query:{text:t,filters:ua.f({isDeletedOnly:!1,isNavigableOnly:!0,excludeTemplates:!0,requireEditPermissions:void 0}),sort:ua.e.Relevance},limit:5},performRequest:function(){return Promise.resolve(e.performLocalPageMentionRequest(...arguments))},render:e=>this.renderMentionResult(i||n||e,this.getCurrentMentionResults(a))})})})})}getDateResultsMenuSection(e,t){const{dateResults:n}=e;if(0!==n.length)return this.applySectionLimit("date",{key:"date results",render:e=>r.a.createElement(ye.a,Object.assign({},e,{title:r.a.createElement(se.a,{defaultMessage:"Date",id:"mentionMenu.dateSection.title"}),topBorder:t,isTitleUppercase:!0})),items:n.map(e=>{let{label:t,value:n}=e;return{key:t,render:e=>(e.focused&&this.setTemporaryInputData({title:t,icon:this.renderTemporaryInputAtMentionIcon(),allowTabCompletion:!0}),r.a.createElement(Bt.a,Object.assign({},e,{title:t}))),action:()=>{Qt.d(this.environment,e=>{Bn.a({environment:this.environment,annotation:["d",ba({},n(),{date_format:"relative"})],transaction:e})})}}})})}renderSpinner(e){return r.a.createElement(Un.a,{show:e,showDelay:500,showHold:300,render:e=>r.a.createElement(Dt.a,{style:{textAlign:"center",visibility:e?"visible":"hidden",display:"inline",marginLeft:8}})})}renderTemporaryInputEmptyIcon(){const e=Gn.a.state;if(e.open)return"+"===e.insertionType?this.renderTemporaryInputAddIcon():r.a.createElement("span",{style:{width:"1em",display:"inline-block",verticalAlign:"-0.15em",fill:this.theme.mediumIconColor,marginRight:"0.2em"}},vt.a.searchThick())}renderTemporaryInputAddIcon(){return r.a.createElement("span",{style:{width:"1em",display:"inline-block",verticalAlign:"-0.15em",fill:this.theme.mediumIconColor,marginRight:"0.2em"}},vt.a.plus())}renderTemporaryInputPageIcon(e){const t=e.getValue();if(t)return Object(Xn.h)({pageValue:t,showEmojiInline:!0,emojiType:Object($n.a)(this.environment),baseUrl:Y.a.baseURL,getRecordValue:e.getRecordValue,isClient:!0,isSafariOrIOS:this.environment.device.isSafari||this.environment.device.isIOS,currentUserId:this.environment.currentUser.id})}renderTemporaryInputAtMentionIcon(){return r.a.createElement("span",{style:{width:"1em",display:"inline-block",verticalAlign:"-0.15em",fill:this.theme.mediumIconColor,marginRight:"0.2em"}},vt.a.at())}getUserResultsMenuSection(e,t){const{userResults:n}=e;if(0!==n.length)return this.applySectionLimit("user",{key:"user results",render:e=>r.a.createElement(ye.a,Object.assign({},e,{title:r.a.createElement(se.a,{defaultMessage:"People",id:"mentionMenu.peopleSection.title"}),topBorder:t,isTitleUppercase:!0})),items:p.a.compact(n.map(e=>({key:e.id,render:t=>(t.focused&&this.setTemporaryInputData({title:Object(Kn.d)(e),icon:this.renderTemporaryInputAtMentionIcon(),allowTabCompletion:!0}),r.a.createElement(Fn.a,Object.assign({},t,{user:e}))),action:()=>{Qt.d(this.environment,t=>{Bn.a({environment:this.environment,annotation:Object(Nn.o)(e.id),transaction:t})})}})))})}getPageResultsMenuSection(e,t){const{pageResults:n}=e,a=r.a.createElement(r.a.Fragment,null,0===n.length?r.a.createElement(se.a,Object.assign({},Sa.noResults)):r.a.createElement(se.a,{defaultMessage:"Link to page",id:"mentionMenu.pagesSection.title2"}),this.renderSpinner(Gn.a.state.pageRequestStore.state.loading));return this.applySectionLimit("page",{key:"page results",render:e=>r.a.createElement(ye.a,Object.assign({},e,{title:a,topBorder:t,isTitleUppercase:!0})),items:p.a.compact(n.map(e=>{const t=T.d();if(!t)return;const n=b.a.createChildStore(t,{table:f.a,id:e});return{key:e,render:e=>{if(e.focused){const e=n.getValue();if(e){const t=Object(Zn.h)({table:n.table,value:e,getRecordValue:n.getRecordValue,userTimeZone:X.m,intl:this.props.intl});this.setTemporaryInputData({title:t||"",icon:this.renderTemporaryInputPageIcon(n),allowTabCompletion:!0})}}return r.a.createElement(Rn.a,Object.assign({},e,{store:n}))},action:()=>{Qt.d(this.environment,t=>{Bn.a({environment:this.environment,annotation:["p",e],transaction:t})})}}}))})}getCreatePageMenuSection(e){if(!this.canCreatePage())return;const t=Gn.a.state;if(!t.open)return;const{intl:n}=this.props,a=this.getNormalizedFilter(),i="@"===t.insertionType?r.a.createElement(se.a,{id:"mentionMenu.createPageSection.title",defaultMessage:"New page"}):void 0;return{key:"create page",render:t=>r.a.createElement(ye.a,Object.assign({title:i,isTitleUppercase:!0},t,{topBorder:e})),items:[{key:"add new subpage",action:async()=>{const e=Object(Jn.c)(t.textStore);e&&await Bn.b({environment:this.environment,ignoreSelectionAreaStore:this.stores.ignoreSelectionAreaStore,titleText:this.getNormalizedFilter(),createInValue:e.createInValue,onPageCreated:e=>{e&&""===Nn.Y(e.getTitleValue())&&Q.h({environment:this.environment,store:e})}})},render:e=>{e.focused&&this.setTemporaryInputData({title:0===a.length?n.formatMessage(ya.addPage):"",icon:this.renderTemporaryInputAddIcon(),allowTabCompletion:!1});const t=t=>r.a.createElement(Bt.a,Object.assign({},Object(da.a)(t||{},e),{icon:vt.a.plus({width:16}),title:r.a.createElement(oa,{pageTitle:this.getNormalizedFilter()})}));return this.environment.device.isMobile?t():r.a.createElement(ht.a,{renderTooltip:()=>r.a.createElement(la.a,{imageURL:ca.a.images.tooltips.pageMenu.newSubpagePng,imageWidth:140,imageHeight:100,caption:r.a.createElement(se.a,Object.assign({},_n.b.createSubpage))}),placement:ht.a.Placement.Right,delayThreshold:0,render:e=>t(e)})}},{key:"open create in menu",action:this.handleCreateInStart,render:e=>{e.focused&&this.setTemporaryInputData({title:0===a.length?n.formatMessage(ya.addPage):"",icon:this.renderTemporaryInputAddIcon(),allowTabCompletion:!1});const t=r.a.createElement(sa,{pageTitle:this.getNormalizedFilter()}),i=n=>r.a.createElement(Bt.a,Object.assign({},Object(da.a)(n||{},e),{icon:vt.a.alias({width:16}),title:t}));return this.environment.device.isMobile?i():r.a.createElement(ht.a,{renderTooltip:()=>r.a.createElement(la.a,{imageURL:ca.a.images.tooltips.pageMenu.newPageInPng,imageWidth:140,imageHeight:100,caption:r.a.createElement(se.a,Object.assign({},_n.b.newPageIn))}),placement:ht.a.Placement.Right,delayThreshold:0,render:e=>i(e)})}}]}}applySectionLimit(e,t){const n=Gn.a.state;if(!n.open)return t;if(n.expandSection&&n.expandSection===e)return t;const{items:a}=t,i=this.environment.device.isPhone?3:5;return a.length<=i?t:ba({},t,{items:[...a.slice(0,i),{key:"show more",render:e=>r.a.createElement(Bt.a,Object.assign({},e,{icon:vt.a.dots({width:16,fill:this.theme.mediumTextColor}),title:r.a.createElement("span",{style:{color:this.theme.mediumTextColor}},r.a.createElement(se.a,{defaultMessage:"{numberMore} more results",id:"mentionMenu.showMoreResultsButton.title",values:{numberMore:a.length-i}}))})),action:()=>{this.updateOpenState({expandSection:e})}}]})}updateOpenState(e){const t=Gn.a.state;t.open&&Gn.a.setState(ba({},t,{},e))}getNormalizedFilter(){const e=this.filterStore.state;return e?Gn.a.state.open&&"[["===Gn.a.state.insertionType&&e.endsWith("]]")?e.slice(0,-2).trim():e.trim():""}setTemporaryInputData(e){const t=Gn.a.state;if(!t.open)return;if(!e)return void t.temporaryInputData.set(void 0);const{device:n}=this.environment,{title:a,icon:r,allowTabCompletion:i}=e,s=this.filterStore.state||"",o=a.toLowerCase().startsWith(s)?a.slice(s.length):"";this.tabCompletionString=i?o:void 0;const l=n.isFirefox?void 0:r;t.temporaryInputData.set({prefix:t.insertionType,suffix:"[["===t.insertionType&&s.endsWith("]]")?"]]":"",completion:o,prefixIcon:l})}getCurrentMentionResults(e){const t=Gn.a.state,n=t.userRequestStore.state.result||[],a=t.pageRequestStore.state.result||[],r=this.getDateResults(this.getNormalizedFilter());let i=a;const{result:s}=this.stores.localPageMentionRequestStore.state;if(s&&!s.error){const e=s.value.results,t=T.d();i=t?Yn.b({environment:this.environment,isOnline:qn.a.state.online,results:{local:e,server:a.map(e=>ba({},e,{store:b.a.createChildStore(t,{table:f.a,id:e.id})}))}})||[]:e}const o=t.userRequestStore.state.ready&&t.pageRequestStore.state.ready;return o&&ha.a.emit(this.environment,e),{userResults:n,pageResults:i.map(e=>e.id),dateResults:r,ready:o}}canCreatePage(){return!!Gn.a.state.mentionTypes.createPage}isActionSheet(){const{device:e}=this.environment;return e.isReactNative&&!e.isTablet}shouldCaptureBackspace(){return""===this.filterStore.state}getMenuInitialFocus(){if(""!==this.getNormalizedFilter())return 0}getMenuDesktopWidth(){return 330}}var Ea=Object(se.g)(va);var Ma=n(467),Ca=n(563),Oa=n(175),wa=n(241);class ka extends o.a{constructor(){super(...arguments),this.renderMenu=()=>{const{device:e}=this.environment,t=wa.a.state;if(!t.open)return;const n=this.getSections(t),a=this.getFilter(t);let i;return i=e.isReactNative&&!e.isTablet?{menuType:ve.b.MenuType.ActionSheet}:{menuType:ve.b.MenuType.Popup,width:324,maxHeight:"40vh",onClickOutside:Ma.d},r.a.createElement(ve.b,Object.assign({},i),r.a.createElement(ge.a,{sections:n,onAccept:this.handleAccept,context:{environment:this.environment,blocks:S.b.state.stores,originRect:t.selectionRect},filter:a,initialFocus:0,onEmptyEnter:this.handleCancel,useLimit:!0}))},this.handleCancel=()=>{Ma.d()},this.handleAccept=e=>{const t=S.b.state.stores[0];t&&fe.p(this.environment,{analyticsName:e.analyticsName,from:"slash_menu",block_type:t.getType()}),Qt.d(this.environment,e=>{Ma.a({environment:this.environment,transaction:e})})}}willMountOrUpdate(){const e=wa.a.state;if(e.open){const t=Qn.a.state,n=this.getFilter(e),a=Object(Ca.a)(this.getSections(e),{blocks:S.b.state.stores,environment:this.environment},n||"");("editing"!==t.mode||t.store!==e.textStore||Wn.d(n,!0,a.length))&&Ma.d()}}renderComponent(){const{device:e}=this.environment,t=wa.a.state;return r.a.createElement(be.c,{popupType:e.isReactNative&&!e.isTablet?be.c.PopupType.SlideUp:be.c.PopupType.Popup,open:t.open,originRect:t.open?t.selectionRect:void 0,placementToOrigin:be.c.Placement.Bottom,alignmentToOrigin:be.c.Alignment.Start,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,onDismiss:this.handleCancel,render:this.renderMenu})}getFilter(e){return Wn.a(e.textStore,e.oldTextValue,!e.isAddMenu)}getSections(e){return e.isAddMenu?Oa.i:Oa.n}}var Pa=ka,Ta=n(637),Ia=n(166),ja=n(7),Da=n(31),xa=n(266),Ba=n(176);const Aa=Object(se.f)({image:{defaultMessage:"Embed image",id:"embedMenu.action.image"},video:{defaultMessage:"Embed video",id:"embedMenu.action.video"},tweet:{defaultMessage:"Embed Tweet",id:"embedMenu.action.tweet"},drive:{defaultMessage:"Embed Google Drive",id:"embedMenu.action.drive"},gist:{defaultMessage:"Embed GitHub Gist",id:"embedMenu.action.gist"},figma:{defaultMessage:"Embed Figma",id:"embedMenu.action.figma"},invision:{defaultMessage:"Embed Invision project",id:"embedMenu.action.invision"},abstract:{defaultMessage:"Embed Abstract project",id:"embedMenu.action.abstract"},framer:{defaultMessage:"Embed Framer prototype",id:"embedMenu.action.framer"},whimsical:{defaultMessage:"Embed Whimsical board",id:"embedMenu.action.whimsical"},miro:{defaultMessage:"Embed Miro board",id:"embedMenu.action.miro"},audio:{defaultMessage:"Embed audio",id:"embedMenu.action.audio"},maps:{defaultMessage:"Embed Google Map",id:"embedMenu.action.maps"},loom:{defaultMessage:"Embed Loom",id:"embedMenu.action.loom"},typeform:{defaultMessage:"Embed Typeform",id:"embedMenu.action.typeform"},codepen:{defaultMessage:"Embed CodePen",id:"embedMenu.action.codepen"},pdf:{defaultMessage:"Embed PDF",id:"embedMenu.action.pdf"},embed:{defaultMessage:"Create embed",id:"embedMenu.action.createEmbed"}}),Fa=Object(se.f)({linkToPage:{defaultMessage:"Link to page",id:"embedMenu.actions.linkToPage.title"},mentionPage:{defaultMessage:"Mention page",id:"embedMenu.actions.mentionPage.title"},createLinkedDatabase:{defaultMessage:"Create linked database",id:"embedMenu.actions.createLinkedDatabase.title"},bookmarkMenuItem:{defaultMessage:"Create bookmark",id:"embedMenu.actions.createBookmark.title"},dismissItem:{defaultMessage:"Dismiss",id:"embedMenu.actions.dismiss.title"}}),Ra={image:Rt.a.formatMessage(Aa.image),video:Rt.a.formatMessage(Aa.video),tweet:Rt.a.formatMessage(Aa.tweet),drive:Rt.a.formatMessage(Aa.drive),gist:Rt.a.formatMessage(Aa.gist),figma:Rt.a.formatMessage(Aa.figma),invision:Rt.a.formatMessage(Aa.invision),abstract:Rt.a.formatMessage(Aa.abstract),framer:Rt.a.formatMessage(Aa.framer),whimsical:Rt.a.formatMessage(Aa.whimsical),miro:Rt.a.formatMessage(Aa.miro),audio:Rt.a.formatMessage(Aa.audio),maps:Rt.a.formatMessage(Aa.maps),loom:Rt.a.formatMessage(Aa.loom),typeform:Rt.a.formatMessage(Aa.typeform),codepen:Rt.a.formatMessage(Aa.codepen),pdf:Rt.a.formatMessage(Aa.pdf),embed:Rt.a.formatMessage(Aa.embed)};class La extends o.a{constructor(){super(...arguments),this.renderMenu=()=>{const{device:e}=this.environment,t=xa.a.state;if(!t.open)return;const n=this.getSections(t);let a;return a=e.isMobile?{menuType:ve.b.MenuType.ActionSheet}:{menuType:ve.b.MenuType.Popup,width:320,maxHeight:"40vh"},r.a.createElement(ve.b,Object.assign({},a,{className:Ft.s}),r.a.createElement(An.a,{type:An.a.Type.Vertical,sections:n,initialFocus:0}))},this.handleDismiss=()=>{Ta.c()},this.handleAccept=e=>{Ta.a({environment:this.environment,blockType:e})}}willMountOrUpdate(){const e=xa.a.state;if(e.open){const t=Qn.a.state;"empty"!==t.mode&&"readOnly"!==t.mode&&t.store.id===e.textStore.id&&t.selection.endIndex===e.urlSelection.endIndex||Ta.c()}}renderComponent(){const{device:e}=this.environment,t=xa.a.state;return r.a.createElement(be.c,{popupType:e.isReactNative&&!e.isTablet?be.c.PopupType.SlideUp:be.c.PopupType.Popup,open:t.open,originRect:t.open?t.selectionRect:void 0,placementToOrigin:be.c.Placement.Bottom,alignmentToOrigin:be.c.Alignment.Start,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,disableDarkOverlayBackground:e.isMobile,keepFocus:e.isMobile,render:this.renderMenu,onDismiss:this.handleDismiss})}getSections(e){const{device:t}=this.environment,{url:n,textStore:a}=e,i=[],s=Object(Ba.k)({url:n,baseUrl:Y.a.baseURL,isMobile:t.isMobile,protocol:Y.a.protocol,currentUrl:window.location.href});if("page"===s.name){const e=b.a.createChildStore(a,{table:f.a,id:s.blockId});i.push({name:Rt.a.formatMessage(Fa.mentionPage),validator:()=>!0,type:"mention-page"}),i.push({name:Rt.a.formatMessage(Fa.linkToPage),validator:()=>!e.isCollectionView(),type:ja.a.page}),i.push({name:Rt.a.formatMessage(Fa.createLinkedDatabase),validator:()=>e.isCollectionView(),type:ja.a.collectionViewPage})}const o=Da.j(Ra);for(const r of o)"embed"!==r&&i.push({name:Ra[r],validator:Ia.b[r],type:r});return i.push({name:Rt.a.formatMessage(Fa.bookmarkMenuItem),validator:Ia.i,type:ja.a.bookmark}),i.push({name:Ra.embed,validator:Ia.b.embed,type:"embed"}),[{key:"embed section",render:e=>r.a.createElement(ye.a,Object.assign({},e)),items:[{key:"dismiss",render:e=>r.a.createElement(Bt.a,Object.assign({},e,{title:Rt.a.formatMessage(Fa.dismissItem)})),action:this.handleDismiss},...p.a.compact(i.map(e=>{let{name:t,validator:a,type:i}=e;if(a({url:n,baseUrl:Y.a.baseURL})){return{key:"embed ".concat(t),render:e=>r.a.createElement(Bt.a,Object.assign({},e,{title:t})),action:()=>this.handleAccept(i)}}}))]}]}}var Ua=La,_a=n(98),Wa=n(323),Na=n(47),za=n(1452),Va=n(1453),qa=n(1454),Ha=n(202),Ga=n(1241),Ya=n(407),Qa=n(1458),Ka=n(185),Za=n(49),Xa=n(826),$a=n(279),Ja=n(841),er=n(1459),tr=n(418),nr=n(727),ar=n(525);class rr extends J.a{getInitialState(){return{open:!1}}}var ir=new rr,sr=n(629),or=n(1460),lr=n(213),cr=n(268);function dr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ur(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dr(Object(n),!0).forEach((function(t){pr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class mr extends o.a{constructor(){super(...arguments),this.mouseIsDownExternally=!1,this.renderOverlay=()=>{const{isActive:e}=ar.a.state;return r.a.createElement(Qe.a,{isVisible:e,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:{stiffness:100,damping:10,precision:1e-4}},render:this.renderAnimated,onAnimationEnd:this.handleAnimationEnd})},this.renderAnimated=()=>{const{top:e,left:t}=ar.a.state;return r.a.createElement("div",{className:Ft.nb,style:{pointerEvents:"none",position:"absolute",top:e,left:0,display:"flex",width:"100%"}},r.a.createElement("div",{style:{flexShrink:1,width:Math.max(t-mr.leftOffset,0),minWidth:24}}),Object(Ge.a)(e=>r.a.createElement("div",Object.assign({style:{pointerEvents:"none",padding:12}},e),this.lastRenderState&&this.renderMenu(this.lastRenderState))),r.a.createElement("div",{style:{flexGrow:1,flexShrink:1,minWidth:36}}))},this.updateRichTextState=()=>{const e=ar.a.state;if(tr.a.state.open||nr.a.state.open)return;if(lr.b.state)return Xa.a();const t=Qn.a.state;if("editing"!==t.mode)return Xa.a();const n=t.store;if(n.table!==f.a&&n.table!==Ka.a&&n.table!==Za.a)return Xa.a();if(!this.environment.currentUser.isLoggedIn()||!n.canComment())return;const a=_a.b();if(!n||T.k())return Xa.a();const r=$a.a.findEditableWithStore(n);if(r&&r.props.disableAnnotation)return Xa.a();if(r&&r.props.disabled)return Xa.a();const i=r?r.getContextClosestSelectable():void 0,s=i?i.props.store:void 0;if(s&&(s.isLocked()||s.isNavigableAncestorLocked()))return Xa.a();if(this.mouseIsDownExternally&&e.blockTarget!==s)return Xa.a();let o=!1;if(n.table===f.a){const e=n.getRecordStoreAtRootPath().getValue();e&&(o=mr.richTextMenuBlockTypesBlacklist[e.type])}if(!n||tn.a.isActive()||sr.a.isActive()||cr.b.isOpen()||o||!a||!this.hasNonCollapsedTextSelection()||ir.state.open)Xa.a();else{let e=0,t=0;const n=_a.c(a);if(n&&(e=n.left,t=n.top-mr.height-25,t<this.getTopbarHeight()))return Xa.a();0===Math.abs(ar.a.state.top-t)&&Math.abs(ar.a.state.left-e)<10&&(t=ar.a.state.top,e=ar.a.state.left),ar.a.setState(ur({},ar.a.state,{isActive:!0,isAnimatingClosed:!1,top:t,left:e,blockTarget:S.b.state.stores[0]}))}},this.updateRichTextStateThrottled=p.a.throttle(this.updateRichTextState,200,{leading:!1}),this.handleAnimationEnd=()=>{ar.a.state.isActive||ar.a.setState(ur({},ar.a.state,{isAnimatingClosed:!1})),this.lastRenderState=this.renderStateStore.state},this.renderStateStore=this.createComputedStore(()=>{const{isActive:e,blockTarget:t}=ar.a.state,n=Qn.a.state;if(e&&"editing"===n.mode){const e=Qn.a.isEditingComment(),a=Qn.a.isEditingCaption(),r=t&&t.getParentTable()===Za.a,i=this.pageContext&&this.pageContext.publicEditModeStore.state,s=(!i||"edit"===i)&&n.store.canEdit(),o=t&&t.getType(),l=o&&mr.richTextMenuActionsBlacklist[o],c={showTurnInto:Boolean(!e&&!r&&!a&&t&&s),showBold:Boolean(s),showItalic:Boolean(s),showStrikethrough:Boolean(s),showUnderline:Boolean(s),showCode:Boolean(s),showLink:Boolean(s),showHighlight:Boolean(s&&!e),showDiscuss:Boolean(!e&&t&&!r),showEquation:Boolean(s),showMention:Boolean(!e&&t&&!r&&s),showActionButton:Boolean(!e&&!a&&t&&!r),blockTarget:t,isComment:e};if(l&&l.size>0)for(const t of l)c[t]=!1;return c}})}didMount(){S.b.addListener(this.updateRichTextStateThrottled),Qn.a.addListener(this.updateRichTextStateThrottled),Ze.a.addListener(this.updateRichTextState),Ja.a.addListener(this.updateRichTextState),er.a.addListener(this.updateRichTextState)}willUnmount(){Qn.a.removeListener(this.updateRichTextStateThrottled),S.b.removeListener(this.updateRichTextStateThrottled),Ze.a.removeListener(this.updateRichTextState),Ja.a.removeListener(this.updateRichTextState),er.a.removeListener(this.updateRichTextState)}willMountOrUpdate(){const e=this.renderStateStore.state;e&&(this.lastRenderState=e)}renderComponent(){const{isActive:e,isAnimatingClosed:t}=ar.a.state;return r.a.createElement(Ve.a,{open:e||t,render:this.renderOverlay})}renderMenu(e){const{isActive:t}=ar.a.state;return r.a.createElement("div",{style:{display:"inline-flex",alignItems:"stretch",height:mr.height,background:this.theme.popoverBackground,overflow:"hidden",fontSize:14,lineHeight:1.2,borderRadius:3,boxShadow:this.theme.mediumBoxShadow,pointerEvents:t?"auto":"none"},onMouseDown:e=>e.preventDefault()},e.showTurnInto&&e.blockTarget&&this.renderTurnInto(e.blockTarget),e.showLink&&this.renderLinkButton(!0),e.showDiscuss&&e.blockTarget&&this.renderCommentButton(e.blockTarget),r.a.createElement("div",{style:{display:"flex"}},e.showBold&&this.renderBoldButton(),e.showItalic&&this.renderItalicButton(),e.showUnderline&&this.renderUnderlineButton(),e.showStrikethrough&&this.renderStrikethroughButton(),e.showCode&&this.renderCodeButton(),e.showEquation&&this.renderEquationButton()),e.showHighlight&&r.a.createElement(or.a,{style:this.getBorderRight()}),e.showMention&&this.renderMention(),e.showActionButton&&e.blockTarget&&this.renderActionButton(e.blockTarget))}renderTurnInto(e){let t=r.a.createElement(se.a,{defaultMessage:"Turn into",id:"richTextMenu.turnIntoButton.label"});const{intl:n}=this.props,a=e.getType();if(a){const e=Wa.b[a];t=e&&e.displayName||t}return r.a.createElement(Na.a,{popupType:Na.a.PopupType.Popup,buttonPopupStore:nr.a,originGap:4,renderOrigin:e=>r.a.createElement(ht.a,{renderTooltip:()=>n.formatMessage({defaultMessage:"Turn into",id:"richTextMenu.turnIntoButton.tooltip"}),render:n=>r.a.createElement(wt.a,Object.assign({style:ur({display:"flex",alignItems:"center",padding:"0 8px",whiteSpace:"nowrap"},this.getBorderRight())},Object(da.a)(e,n)),t,vt.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor}))}),render:()=>r.a.createElement(ve.b,{menuType:ve.b.MenuType.Popup},r.a.createElement(ge.a,{context:{blocks:[e],environment:this.environment},sections:[Oa.r],onAccept:t=>{Xa.a(),fe.p(this.environment,{analyticsName:t.analyticsName,from:"rich_text_menu",block_type:e.getType()})}})),onClick:()=>{fe.Ld(this.environment,{action:"turn_into"})}})}renderBoldButton(){return r.a.createElement(za.a,{type:"b",tooltipLabel:r.a.createElement(a.Fragment,null,r.a.createElement("div",null,r.a.createElement(se.a,{defaultMessage:"Bold",id:"richTextMenu.boldButton.tooltip"})),r.a.createElement("div",null,r.a.createElement(Ya.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleBold"})))},"B")}renderItalicButton(){return r.a.createElement(za.a,{type:"i",tooltipLabel:r.a.createElement(a.Fragment,null,r.a.createElement("div",null,r.a.createElement(se.a,{defaultMessage:"Italicize",id:"richTextMenu.italicsButton.tooltip"})),r.a.createElement("div",null,r.a.createElement(Ya.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleItalics"})))},r.a.createElement("span",{style:{fontStyle:"italic"}},"i"))}renderStrikethroughButton(){return r.a.createElement(za.a,{type:"s",tooltipLabel:r.a.createElement(a.Fragment,null,r.a.createElement("div",null,r.a.createElement(se.a,{defaultMessage:"Strike-through",id:"richTextMenu.strikeThroughButton.tooltip"})),r.a.createElement("div",null,r.a.createElement(Ya.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleStrike"})))},r.a.createElement("span",{style:{textDecoration:"line-through"}},"S"))}renderUnderlineButton(){return r.a.createElement(za.a,{type:"_",tooltipLabel:r.a.createElement(a.Fragment,null,r.a.createElement("div",null,r.a.createElement(se.a,{defaultMessage:"Underline",id:"richTextMenu.underlineButton.tooltip"})),r.a.createElement("div",null,r.a.createElement(Ya.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleUnderline"})))},r.a.createElement("span",{style:{textDecoration:"underline"}},"U"))}renderCodeButton(){return r.a.createElement(za.a,{type:"c",style:{padding:"0 6px"},tooltipLabel:r.a.createElement(a.Fragment,null,r.a.createElement("div",null,r.a.createElement(se.a,{defaultMessage:"Mark as code",id:"richTextMenu.markAsCodeButton.tooltip"})),r.a.createElement("div",null,r.a.createElement(Ya.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleCode"})))},vt.a.code({width:15,height:15}))}renderLinkButton(e){const t=this.environment.device.isMobile;return r.a.createElement(Va.a,{style:this.getBorderRight()},e&&vt.a.alias({width:t?18:16,height:t?18:16,marginRight:4,fill:this.theme.regularIconColor}),r.a.createElement("span",{style:{borderBottom:"1px solid ".concat(this.theme.linkDecorationColor)}},r.a.createElement(se.a,{defaultMessage:"Link",id:"richTextMenu.linkButton.tooltip"})),e&&vt.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor}))}renderEquationButton(){return r.a.createElement(qa.a,{style:this.getBorderRight(),onClick:()=>{fe.Ld(this.environment,{action:"e"}),Xa.a()}},vt.a.equation({width:16,height:16}))}renderMention(){return r.a.createElement(ht.a,{renderTooltip:()=>r.a.createElement(a.Fragment,null,r.a.createElement("div",null,r.a.createElement(se.a,{defaultMessage:"Mention a person,{br}page, or date",id:"richTextMenu.mentionButton.tooltip",values:{br:r.a.createElement("br",null)}})),r.a.createElement("div",{style:{color:this.theme.mediumInvertedTextColor}},"@")),render:e=>r.a.createElement(wt.a,Object.assign({style:ur({},this.getBorderRight(),{padding:"0 8px"})},e,{onClick:()=>{Bn.e(this.environment,{page:!0,createPage:!0,user:!0,bot:!0,date:!0,reminder:!0}),fe.Ld(this.environment,{action:"mention"})}}),vt.a.mention({width:14,fill:this.theme.regularTextColor}))})}renderCommentButton(e){return r.a.createElement(Qa.a,{style:this.getBorderRight(),blockStore:e})}renderActionButton(e){return r.a.createElement(Ha.a,{store:e,style:{borderRight:"none",borderRadius:0,padding:0,width:30,height:"none"},iconStyle:{fill:this.theme.regularTextColor},fadeIn:!1,onClick:()=>{fe.Ld(this.environment,{action:"more"})}})}hasNonCollapsedTextSelection(){const e=_a.b();return!!e&&!e.collapsed&&"editing"===Qn.a.state.mode&&Qn.a.state.selection.startIndex!==Qn.a.state.selection.endIndex}getTopbarHeight(){const{device:e}=this.environment;return e.isElectronMac?Ga.a.desktopMacHeight:Ga.a.defaultHeight}getBorderRight(){return{boxShadow:"1px 0 0 ".concat(this.theme.regularDividerColor),marginRight:1}}}mr.richTextMenuBlockTypesBlacklist={[ja.a.factory]:!0},mr.richTextMenuActionsBlacklist={[ja.a.code]:new Set(["showMention","showCode"])},mr.leftOffset=60,mr.height=32;var hr=Object(se.g)(mr),gr=n(131),br=n(408),fr=new(n(798).a),yr=n(38);function Sr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function vr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Er extends o.a{constructor(){super(...arguments),this.handleContextMenu=(e,t)=>{if(e.preventDefault(),t.misspelledWord){const e=Qn.a.state;if("editing"===e.mode&&e.selection.startIndex===e.selection.endIndex){const n=Nn.t(e.store.getValue()||[],t.misspelledWord),a=e.selection.startIndex,r=Nn.v(n,a);r&&nn.l({store:e.store,selection:r})}}ir.setState({open:!0,menuInfo:t})},this.handleDismiss=()=>{ir.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sr(Object(n),!0).forEach((function(t){vr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},ir.state,{open:!1}))}}willMount(){Z.e&&Z.e.contextMenu&&Z.e.contextMenu.addListener(this.handleContextMenu)}willUnmount(){Z.e&&Z.e.contextMenu&&Z.e.contextMenu.removeListener(this.handleContextMenu)}renderComponent(){const{menuInfo:e,open:t}=ir.state,{device:n}=this.environment,{x:a,y:i}=this.getClickPosition(e),s={bottom:i,top:i,height:0,left:a,right:a,width:0},o=e?this.getMenuSections(e):[],l=document.activeElement,c=_a.b();let d=null,u=null;(l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement)&&(d=l.selectionStart,u=l.selectionEnd);for(const r of o)for(const e of r.items){const t=e.action;e.action=e=>{l.focus(),l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement?(l.selectionStart=d,l.selectionEnd=u):c&&_a.g(c,n),yr.a.afterNextFlush(()=>{t(e)})}}return r.a.createElement(be.c,{open:t&&o.length>0,popupType:be.c.PopupType.Popup,originRect:s,render:()=>r.a.createElement(br.a,{capture:!0,allowEsc:!0},r.a.createElement(ve.b,{menuType:ve.b.MenuType.Popup},r.a.createElement(An.a,{type:An.a.Type.Vertical,sections:o,initialFocus:void 0,onAccept:this.handleDismiss}))),onDismiss:this.handleDismiss,overlayContainerStore:fr})}getClickPosition(e){const t=Object(Z.g)();return{x:e?e.x/t:0,y:e?e.y/t:0}}getMenuSections(e){const t=[],n=this.getSpellingCorrectionItems(e);if(n.length>0){const e=t.length>0;t.push({key:"spellingCorrectionItems",items:n,render:t=>r.a.createElement(ye.a,Object.assign({},t,{topBorder:e}))})}const a=this.getDisableSpellCheckItems(e);if(a.length>0){const e=t.length>0;t.push({key:"disableSpellCheckItems",items:a,render:t=>r.a.createElement(ye.a,Object.assign({},t,{topBorder:e}))})}const i=this.getSearchItems(e);if(i.length>0){const e=t.length>0;t.push({key:"searchItems",items:i,render:t=>r.a.createElement(ye.a,Object.assign({},t,{topBorder:e}))})}const s=this.getLinkMenuItems(e);if(s.length>0){const e=t.length>0;t.push({key:"linkMenuItems",items:s,render:t=>r.a.createElement(ye.a,Object.assign({},t,{topBorder:e}))})}const o=this.getImageMenuItems(e);if(o.length>0){const e=t.length>0;t.push({key:"imageMenuItems",items:o,render:t=>r.a.createElement(ye.a,Object.assign({},t,{topBorder:e}))})}const l=this.getTextEditingItems(e);if(l.length>0){const e=t.length>0;t.push({key:"textEditingItems",items:l,render:t=>r.a.createElement(ye.a,Object.assign({},t,{topBorder:e}))})}const c=this.getEnableSpellCheckItem(e);if(c.length>0){const e=t.length>0;t.push({key:"enableSpellCheckItems",items:c,render:t=>r.a.createElement(ye.a,Object.assign({},t,{topBorder:e}))})}return t}getLinkMenuItems(e){const t=[];return e.linkURL&&e.linkURL.length>0&&(e.linkURL.startsWith("mailto:")?t.push({key:"copy-email",action:()=>{Z.e&&Z.e.copyText&&Z.e&&Z.e.copyText(e.linkText)},render:e=>r.a.createElement(Bt.a,Object.assign({},e,{title:r.a.createElement(se.a,{defaultMessage:"Copy email address",id:"desktop.rightClickMenu.copyEmailAddress"})}))}):t.push({key:"copy-link",action:()=>{Z.e&&Z.e.copyText&&Z.e&&Z.e.copyText(e.linkURL)},render:e=>r.a.createElement(Bt.a,Object.assign({},e,{title:r.a.createElement(se.a,{defaultMessage:"Copy link",id:"desktop.rightClickMenu.copyLink"})}))}),t.push({key:"open-link",action:()=>{Z.e&&Z.e.openExternalUrl(e.linkURL)},render:e=>r.a.createElement(Bt.a,Object.assign({},e,{title:r.a.createElement(se.a,{defaultMessage:"Open link",id:"desktop.rightClickMenu.openLink"})}))})),t}getImageMenuItems(e){const t=[];return e.hasImageContents&&e.srcURL&&e.srcURL.length>0&&(t.push({key:"copy-image",action:()=>{Z.e&&Z.e.copyImage&&Z.e.copyImage(e.srcURL)},render:e=>r.a.createElement(Bt.a,Object.assign({},e,{title:r.a.createElement(se.a,{defaultMessage:"Copy image",id:"desktop.rightClickMenu.copyImage"})}))}),t.push({key:"copy-image-address",action:()=>{Z.e&&Z.e.copyText&&Z.e.copyText(e.srcURL)},render:e=>r.a.createElement(Bt.a,Object.assign({},e,{title:r.a.createElement(se.a,{defaultMessage:"Copy image address",id:"desktop.rightClickMenu.copyImageAddress"})}))})),t}isEditing(e){return e.isEditable||e.inputFieldType&&"none"!==e.inputFieldType}hasMisspelling(e){return this.isEditing(e)&&e.misspelledWord&&e.misspelledWord.length>0}getSpellingCorrectionItems(e){const t="SpellCheckStore"in this.environment&&this.environment.SpellCheckStore,n=[];if(this.hasMisspelling(e)&&t&&t.isEnabled()){const a=t.getCorrections(e);for(const e of a)n.push({key:e,action:()=>{Z.e&&Z.e.replaceMisspelling&&Z.e.replaceMisspelling(e)},render:t=>r.a.createElement(Bt.a,Object.assign({},t,{title:e}))})}return n}getDisableSpellCheckItems(e){const t="SpellCheckStore"in this.environment&&this.environment.SpellCheckStore,n=[];return this.hasMisspelling(e)&&t&&t.isEnabled()&&n.push({key:"disable",action:()=>{t.setEnabled(!1)},render:e=>r.a.createElement(Bt.a,Object.assign({},e,{title:r.a.createElement(se.a,{defaultMessage:"Disable spell check",id:"desktop.spellcheckMenuItem.disableSpellcheck.title"})}))}),n}getEnableSpellCheckItem(e){const t="SpellCheckStore"in this.environment&&this.environment.SpellCheckStore,n=[];return this.isEditing(e)&&t&&!t.isEnabled()&&n.push({key:"enable",action:()=>{t.setEnabled(!0)},render:e=>r.a.createElement(Bt.a,Object.assign({},e,{title:r.a.createElement(se.a,{defaultMessage:"Enable spell check",id:"desktop.spellcheckMenuItem.enableSpellcheck.title"})}))}),n}getSearchItems(e){const t=[];return e.selectionText&&e.selectionText.length>0&&t.push({key:"google",action:()=>{if(Z.e){const t="https://www.google.com/#q=".concat(encodeURIComponent(e.selectionText.trim()));Z.e.openExternalUrl(t)}},render:e=>r.a.createElement(Bt.a,Object.assign({},e,{title:r.a.createElement(se.a,{defaultMessage:"Search with Google",id:"desktop.searchMenuItem.searchWithGoogle.title"})}))}),t}getTextEditingItems(e){const t=[];return this.isEditing(e)&&(e.editFlags.canCut&&t.push({key:"cut",action:()=>{Z.e&&Z.e.cut&&Z.e.cut()},render:e=>r.a.createElement(gr.a,Object.assign({},e,{title:r.a.createElement(se.a,{defaultMessage:"Cut",id:"desktop.textEditingMenuItem.cutAction.title"}),shortcuts:["cut"]}))}),e.editFlags.canCopy&&t.push({key:"copy",action:()=>{Z.e&&Z.e.copy&&Z.e.copy()},render:e=>r.a.createElement(gr.a,Object.assign({},e,{title:r.a.createElement(se.a,{defaultMessage:"Copy",id:"desktop.textEditingMenuItem.copyAction.title"}),shortcuts:["copy"]}))}),e.editFlags.canPaste&&t.push({key:"paste",action:()=>{Z.e&&Z.e.paste&&Z.e.paste()},render:e=>r.a.createElement(gr.a,Object.assign({},e,{title:r.a.createElement(se.a,{defaultMessage:"Paste",id:"desktop.textEditingMenuItem.pasteAction.title"}),shortcuts:["paste"]}))})),t}}var Mr=Er,Cr=n(844),Or=n(678);function wr(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function kr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Pr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kr(Object(n),!0).forEach((function(t){Tr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Tr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ir extends o.a{constructor(){super(...arguments),this.handleChangeValue=e=>{if(!e)return void this.removeDateAnnotation();const t=this.getEverythingIWant();if(!t)return;const{date_format:n,time_format:a}=t;this.setDateAnnotationData(Pr({date_format:n,time_format:a},e))},this.handleChangeDateFormat=e=>{const t=this.getEverythingIWant();if(!t)return;const{dateValue:n,time_format:a}=t;this.setDateAnnotationData(Pr({date_format:e,time_format:a},n))},this.handleChangeTimeFormat=e=>{const t=this.getEverythingIWant();if(!t)return;const{dateValue:n,date_format:a}=t;this.setDateAnnotationData(Pr({date_format:a,time_format:e},n))},this.setDateAnnotationData=e=>{const t=this.getEverythingIWant();if(!t)return;const{textStore:n,textValue:a,tokenIndex:r,annotations:i}=t,s=a.map((t,n)=>{if(n===r){const n=i.map(t=>Nn.qb(t)?["d",e]:t);return Nn.n(t[0],n)}return t});Qt.d(this.environment,e=>{en.c({store:n,value:s,transaction:e})})},this.removeDateAnnotation=()=>{const e=this.getEverythingIWant();if(!e)return;const{textStore:t,textValue:n,tokenIndex:a}=e,r=n.filter((e,t)=>t!==a);Qt.d(this.environment,e=>{en.c({store:t,value:r,transaction:e})})}}renderComponent(){const{device:e}=this.environment,t=Or.a.state;return r.a.createElement(be.c,{popupType:e.isMobile?be.c.PopupType.SlideUp:be.c.PopupType.Popup,open:t.open,originRect:t.originRect,onDismiss:Cr.a,render:()=>{const e=this.getEverythingIWant();if(!e)return null;const{date_format:n,time_format:a,dateValue:i}=e;return r.a.createElement(le.a,{dependency:le.m.menus},e=>{let{DatePropertyMenu:s}=e;return r.a.createElement(s,{firstDayOfWeek:T.q.state,value:i,locked:!1,onChangeValue:this.handleChangeValue,dateFormat:n,onChangeDateFormat:this.handleChangeDateFormat,timeFormat:a,onChangeTimeFormat:this.handleChangeTimeFormat,onDismiss:Cr.a,disabled:!1,shouldShowReminder:!!t.open&&t.allowReminders})})}})}getEverythingIWant(){const e=Or.a.state;if(e.open){const{textStore:t,tokenIndex:n}=e,a=t.getValue();if(a){const e=a[n];if(e){const r=Nn.db(e),i=Nn.x(r);if(i){const s=Nn.J(i),{date_format:o,time_format:l}=s;return{textStore:t,textValue:a,tokenIndex:n,token:e,annotations:r,date_format:o,time_format:l,dateValue:wr(s,["date_format","time_format"])}}}}}}}var jr=Ir,Dr=n(743),xr=n(129),Br=n(818),Ar=n(154),Fr=n(118),Rr=n(110);function Lr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ur(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lr(Object(n),!0).forEach((function(t){_r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Wr extends o.a{constructor(){super(...arguments),this.storeTypes={mouseStore:Rr.a},this.handleMouseEnter=()=>{this.stores.mouseStore.setState(Ur({},this.stores.mouseStore.state,{mouseEntered:!0}))},this.handleMouseLeave=()=>{this.stores.mouseStore.setState(Ur({},this.stores.mouseStore.state,{mouseEntered:!1}))},this.handleMouseDown=()=>{this.stores.mouseStore.setState(Ur({},this.stores.mouseStore.state,{mousePressed:!0}))},this.handleMouseUp=()=>{this.stores.mouseStore.setState(Ur({},this.stores.mouseStore.state,{mousePressed:!1}))},this.handleWindowMouseUp=()=>{this.stores.mouseStore.setState(Ur({},this.stores.mouseStore.state,{mousePressed:!1,mouseEntered:!1}))}}willMount(){Object(g.a)(window,"mouseup",this.handleWindowMouseUp)}willUnmount(){Object(g.b)(window,"mouseup",this.handleWindowMouseUp)}renderComponent(){const{mouseEntered:e,mousePressed:t}=this.stores.mouseStore.state;return this.props.render({mouseEntered:e,mousePressed:t,events:{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp}})}}var Nr=Wr;function zr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Vr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zr(Object(n),!0).forEach((function(t){qr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Hr extends o.a{renderComponent(){const{device:e}=this.environment,{title:t,caption:n,image:a,onClick:i}=this.props;return r.a.createElement(Nr,{render:s=>{let{mouseEntered:o,events:l}=s;return r.a.createElement("div",Object.assign({},l,{onClick:i,style:this.getWrapStyle(o)}),r.a.createElement("img",{src:a,style:this.getImageStyle(o)}),r.a.createElement("div",{style:this.getInfoStyle()},r.a.createElement("div",{style:this.getTitleStyle()},r.a.createElement("span",{style:this.getMobileTitleStyle()},t)),!e.isMobile&&r.a.createElement("div",{style:this.getCaptionStyle()},n)))}})}getWrapStyle(e){const{device:t}=this.environment;return Vr({display:"flex",flexDirection:t.isMobile?"column":"row",alignItems:"center",flexGrow:0},e&&{cursor:"pointer"},{},t.isMobile?{padding:"12px 4px 16px"}:{marginBottom:8})}getImageStyle(e){const{device:t}=this.environment,{selected:n}=this.props,a=(()=>n?"0 0 0 2px ".concat(Je.f.blue):e?"0 0 0 2px ".concat(this.theme.darkDividerColor):"0 0 0 1px ".concat(this.theme.darkDividerColor))(),r=t.isMobile?"42vw":"169px";return{display:"flex",flexDirection:"column",borderRadius:3,boxShadow:a,transition:"box-shadow 200ms ease-out",marginTop:8,marginBottom:t.isMobile?12:8,height:"calc(".concat(r," / (169 / 97))"),maxHeight:97,maxWidth:r}}getInfoStyle(){const{device:e}=this.environment;return Vr({display:"flex",flexDirection:"column"},!e.isMobile&&{marginLeft:16})}getTitleStyle(){const{device:e}=this.environment,{selected:t}=this.props;return Vr({display:"flex",fontSize:14},t&&!e.isMobile&&{fontWeight:600},{marginBottom:2},e.isMobile&&{justifyContent:"center"})}getMobileTitleStyle(){const{device:e}=this.environment,{selected:t}=this.props;return e.isMobile?Vr({fontSize:12,padding:"2px 10px",borderRadius:20,textAlign:"center"},t&&{background:Je.f.blue,color:Je.f.white}):{}}getCaptionStyle(){return{fontSize:12,color:this.theme.mediumTextColor}}}var Gr=Hr,Yr=n(548),Qr=n(285),Kr=n(299),Zr=n(1150);function Xr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function $r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xr(Object(n),!0).forEach((function(t){Jr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Jr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ei extends o.a{constructor(){super(...arguments),this.storeTypes={databaseSearchButtonPopupStore:na.a},this.renderDesktopModalContent=()=>{const{currentBlockStore:e}=U.a.state,t=Yr.a.state;if(t.open&&e)return r.a.createElement("div",{style:ei.modalStyle},r.a.createElement("div",{style:ei.modalHeaderStyle},r.a.createElement(se.a,{id:"database.relationProperty.createModal.header",defaultMessage:"Create a relation to another database"})),r.a.createElement("div",{style:ei.sourceSectionStyle},r.a.createElement("div",{style:ei.defaultTextStyle},r.a.createElement(se.a,{id:"database.relationProperty.createModal.description",defaultMessage:"A relation allows you to link pages from other databases."})),this.renderDatabaseButtonPopup()),t.relationCollectionId===t.targetCollectionId&&r.a.createElement("div",{style:ei.selfRelationSectionStyle},r.a.createElement("div",{style:ei.defaultTextStyle},r.a.createElement(se.a,{id:"database.relationProperty.createModal.selfRelationPrompt",defaultMessage:"You selected the same database. In which property should the linked pages appear?"})),this.renderSelfRelationConfigure()),r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement(Zr.a,{title:r.a.createElement(se.a,{id:"database.relationProperty.createModal.helpCenterLink",defaultMessage:"Learn about relations"}),href:Object(ke.a)("guides.relations"),analyticsFrom:"configure_relation_modal"}),r.a.createElement(Kr.a,{isLarge:!0,style:{marginLeft:"auto",marginRight:12},onClick:this.handleCancelClick},r.a.createElement(se.a,{id:"database.relationProperty.createModal.cancelButton",defaultMessage:"Cancel"})),r.a.createElement(Qr.a,{isLarge:!0,onClick:this.handleDoneClick,disabled:!this.canAccept()},r.a.createElement(se.a,{id:"database.relationProperty.createModal.confirmButton",defaultMessage:"Create relation"}))))},this.renderMobilePopupContent=()=>{const e=Yr.a.state;if(e.open)return r.a.createElement(ve.b,{menuType:ve.b.MenuType.Modal,right:r.a.createElement(we.DoneMenuText,null),left:r.a.createElement(we.CancelMenuText,null),title:r.a.createElement(se.a,{id:"database.relationProperty.createModal.databaseSelect.label",defaultMessage:"Select a database"}),onClickRight:this.handleDoneClick,onClickLeft:this.handleCancelClick,rightDisabled:!this.canAccept()},r.a.createElement(ye.a,{title:r.a.createElement(se.a,{id:"database.relationProperty.createModal.databaseSelect.mobile.title",defaultMessage:"Database source"})},r.a.createElement(Ar.a,{title:this.renderDatabaseButtonPopup()})),r.a.createElement("div",{style:this.getMobileSectionCaption()},r.a.createElement(se.a,{id:"database.relationProperty.createModal.databaseSelect.mobile.caption",defaultMessage:"The database you wish to link to."})),e.relationCollectionId===e.targetCollectionId&&r.a.createElement(a.Fragment,null,r.a.createElement("div",{style:$r({},this.getMobileSectionHeading(),{marginTop:28})},r.a.createElement(se.a,{id:"database.relationProperty.createModal.selfRelationPrompt.mobileTitle",defaultMessage:"Self-relation type"})),r.a.createElement("div",{style:this.getMobileSectionCaption()},r.a.createElement(se.a,{id:"database.relationProperty.createModal.selfRelationPrompt",defaultMessage:"You selected the same database. In which property should the linked pages appear?"})),r.a.createElement(ye.a,{disableMobilePadding:!0},r.a.createElement(Ar.a,{title:this.renderSelfRelationConfigure()})),r.a.createElement("div",{style:this.getMobileSectionCaption()},this.renderSelfRelationCaption(e.selfRelationType))),r.a.createElement(ye.a,null,r.a.createElement(Oe.a,{title:r.a.createElement(se.a,{id:"database.relationProperty.createModal.helpCenterLinkMobile",defaultMessage:"Learn about relations"}),href:Object(ke.a)("guides.relations"),analyticsFrom:"configure_relation_modal"})))},this.renderDatabaseButtonPopupOrigin=e=>{const{device:t}=this.environment,{currentBlockStore:n}=U.a.state;if(Yr.a.state.open&&n)return t.isMobile?r.a.createElement(wt.a,Object.assign({mobileFeedback:!0,style:{width:"100%"}},e),this.getButtonTitle()):r.a.createElement(Kr.a,Object.assign({isLarge:!0,style:{width:"100%"}},e),this.getButtonTitle(),vt.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor}))},this.renderDatabaseButtonPopupContent=()=>{const{device:e}=this.environment,{currentBlockStore:t}=U.a.state,n=Yr.a.state;if(!n.open||!t)return;const i={request:n.collectionSearchQuery,debounce:jt.b,performRequest:this.getCollectionAutocompleteItems,render:(i,s,o)=>{let l;if(i&&(l=r.a.createElement(ye.a,null,r.a.createElement(Ln.a,{title:"Something went wrong."}))),o||(l=r.a.createElement(ye.a,null,r.a.createElement(Ln.a,{title:"Loading..."}))),s&&0===s.length)l=r.a.createElement(ye.a,null,r.a.createElement(Ln.a,{title:this.props.intl.formatMessage({id:"database.relationProperty.createModal.noResults",defaultMessage:"No results"})}));else{const e=(s||[]).map(e=>{const n=xr.a.createChildStore(t,{table:Za.a,id:e});return{key:e,render:e=>r.a.createElement(Rn.a,Object.assign({store:n},e)),action:()=>{this.handleSelectCollection(e)}}});l=r.a.createElement(An.a,{type:An.a.Type.Vertical,initialFocus:n.collectionSearchQuery?0:void 0,sections:[{key:"results",render:e=>r.a.createElement(ye.a,Object.assign({},e)),items:e}]})}return e.isMobile?r.a.createElement(a.Fragment,null,l):r.a.createElement("div",{style:ei.customPopupStyle},l)}},s=r.a.createElement(ye.a,{isInput:!0},this.renderDatabaseInputMenuItem());let o;return o=e.isMobile?{menuType:ve.b.MenuType.Modal,title:r.a.createElement(se.a,{id:"database.relationProperty.createModal.databaseSelect.label",defaultMessage:"Select a database"}),right:r.a.createElement(we.DoneMenuText,null),header:s,onClickRight:this.handleDatabaseSearchDoneClick}:{menuType:ve.b.MenuType.Popup,width:"100%",header:s},r.a.createElement(ve.b,Object.assign({},o),r.a.createElement(It.a,Object.assign({},i)))},this.handleSamePropertyClick=()=>{const e=Yr.a.state;e.open&&Yr.a.setState($r({},e,{selfRelationType:"same_property"}))},this.handleSeparatePropertyClick=()=>{const e=Yr.a.state;e.open&&Yr.a.setState($r({},e,{selfRelationType:"separate_property"}))},this.getCollectionAutocompleteItems=async e=>jt.c(this.environment,{query:e,limit:20,source:"relation_setup_menu"}),this.handleDatabaseSearchInputChange=e=>{const t=Yr.a.state;t.open&&Yr.a.setState($r({},t,{collectionSearchQuery:e.target.value}))},this.handleSelectCollection=e=>{const t=Yr.a.state;t.open&&(Yr.a.setState($r({},t,{targetCollectionId:e})),this.stores.databaseSearchButtonPopupStore.setState({open:!1}))},this.handleDatabaseSearchDoneClick=()=>{this.stores.databaseSearchButtonPopupStore.setState({open:!1})},this.handleCancelClick=()=>{Br.b()},this.handleDoneClick=()=>{Br.a(this.environment)},this.handleDatabaseButtonPopupClick=()=>{const e=Yr.a.state;e.open&&Yr.a.setState($r({},e,{collectionSearchQuery:""}))}}renderComponent(){const{device:e}=this.environment,{open:t}=Yr.a.state;return e.isMobile?r.a.createElement(be.a,{popupType:be.b.SlideUp,alignmentToOrigin:be.a.Alignment.Start,open:t,render:this.renderMobilePopupContent,onDismiss:Br.b}):r.a.createElement(Dr.a,{open:t,render:this.renderDesktopModalContent,onDismiss:Br.b})}renderSelfRelationConfigure(){const e=Yr.a.state;if(e.open)return r.a.createElement("div",{style:this.getSelfRelationButtonWrapStyle()},r.a.createElement(Gr,{title:r.a.createElement(se.a,{id:"database.relationProperty.createModal.selfRelationPrompt.createNewPropertyOption.title",defaultMessage:"Create a new property"}),caption:this.renderSelfRelationCaption("separate_property"),image:ca.a.images.selfRelationSeparateSvg,selected:"separate_property"===e.selfRelationType,onClick:this.handleSeparatePropertyClick}),r.a.createElement(Gr,{title:r.a.createElement(se.a,{id:"database.relationProperty.createModal.selfRelationPrompt.samePropertyOption.title",defaultMessage:"Use the same property"}),caption:this.renderSelfRelationCaption("same_property"),image:ca.a.images.selfRelationSameSvg,selected:"same_property"===e.selfRelationType,onClick:this.handleSamePropertyClick}))}getButtonTitle(){const{currentBlockStore:e}=U.a.state,t=Yr.a.state;if(t.open&&e){if(t.targetCollectionId){const n=xr.a.createChildStore(e,{table:Za.a,id:t.targetCollectionId});return r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement($t.a,{disabled:!0,icon:n.getIcon(),isEmptyPage:!1,size:20}),r.a.createElement(Fr.a,{store:n,style:{margin:"0 6px"}}))}return r.a.createElement("span",{style:{color:this.theme.mediumTextColor}},r.a.createElement(se.a,{id:"database.relationProperty.createModal.databaseSelect.label",defaultMessage:"Select a database"}))}}renderDatabaseButtonPopup(){const{device:e}=this.environment;return r.a.createElement(Na.a,{popupType:e.isMobile?be.b.SlideUp:be.b.Popup,renderOrigin:this.renderDatabaseButtonPopupOrigin,render:this.renderDatabaseButtonPopupContent,buttonPopupStore:this.stores.databaseSearchButtonPopupStore,onClick:this.handleDatabaseButtonPopupClick,style:{width:440}})}renderDatabaseInputMenuItem(){const e=Yr.a.state;if(e.open)return r.a.createElement(Se.a,{focus:!0,focusAfterAnimation:!0,value:e.collectionSearchQuery,onChange:this.handleDatabaseSearchInputChange,placeholder:this.props.intl.formatMessage({id:"database.relationProperty.createModal.databaseSelect.placeholder",defaultMessage:"Search for a database…"})})}renderSelfRelationCaption(e){var t=this;return"same_property"===e?r.a.createElement(a.Fragment,null,r.a.createElement(se.a,{id:"database.relationProperty.createModal.selfRelationPrompt.createNewPropertyOption.caption",defaultMessage:'<b>No syncing.</b> Use this option when modeling a "Related tasks" property in a "Task" database.',values:{b:function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return r.a.createElement("b",{style:{color:t.theme.regularTextColor}},n)}}})):r.a.createElement(a.Fragment,null,r.a.createElement(se.a,{id:"database.relationProperty.createModal.selfRelationPrompt.samePropertyOption.caption",defaultMessage:'<b>Sync both ways.</b> Use this option when modeling "Parent Task" and "Child Task" properties in a "Task" database.',values:{b:function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return r.a.createElement("b",{style:{color:t.theme.regularTextColor}},n)}}}))}canAccept(){const e=Yr.a.state;return e.open&&e.targetCollectionId}getSelfRelationButtonWrapStyle(){const{device:e}=this.environment;return{display:"flex",flexDirection:e.isMobile?"row":"column",justifyContent:"space-between"}}getMobileSectionHeading(){return{marginTop:8,marginRight:16,marginBottom:8,marginLeft:16,fontSize:12,textTransform:"uppercase",color:this.theme.mediumTextColor}}getMobileSectionCaption(){return{marginTop:8,marginRight:16,marginBottom:8,marginLeft:16,fontSize:12,color:this.theme.mediumTextColor}}}ei.defaultTextStyle={marginBottom:8,fontSize:14},ei.modalStyle={padding:30,width:538},ei.modalHeaderStyle={fontWeight:600,marginBottom:20},ei.sourceSectionStyle={marginBottom:30},ei.selfRelationSectionStyle={marginBottom:30},ei.customPopupStyle={maxHeight:"24vh"};var ti=Object(se.g)(ei),ni=(n(160),n(1443)),ai=n(1352);function ri(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ii(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ri(Object(n),!0).forEach((function(t){si(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ri(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function si(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class oi extends o.a{constructor(){super(...arguments),this.renderModal=()=>{if(!this.lastOpenState)return;const{acceptLabel:e,requiredInputValue:t}=this.lastOpenState,n=[{key:"accept",render:t=>r.a.createElement(Kr.a,Object.assign({isRed:!0,isLarge:!0,style:oi.buttonStyle,hovered:t.focused},t),e),action:this.handleAccept},{key:"cancel",render:e=>r.a.createElement(Kr.a,Object.assign({isLarge:!0,style:oi.buttonStyle,hovered:e.focused},e),r.a.createElement(se.a,{id:"confirmationInputDialog.cancelButton.label",defaultMessage:"Cancel"})),action:this.handleCancel}];return r.a.createElement(Ke.a,{capture:!0},r.a.createElement("div",null,r.a.createElement("div",{style:{minHeight:64,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:16}},this.lastOpenState.message),r.a.createElement(xe.b,{value:this.lastOpenState.inputValue,onChange:this.handleInputChange,style:{height:38,marginBottom:2},placeholder:t}),r.a.createElement(An.a,{type:An.a.Type.Vertical,initialFocus:void 0,sections:[{key:"dialog",render:e=>r.a.createElement(ye.a,Object.assign({},e)),items:n}]})))},this.handleAccept=()=>{const e=ni.a.state;e.open&&(this.cleanAcceptInput(e.inputValue)===this.cleanAcceptInput(e.requiredInputValue)?ai.a({didConfirm:!0}):Mn.e(r.a.createElement(se.a,{id:"confirmDialogInput.incorrectInputError.message",defaultMessage:'Please type "{requiredInputValue}" to continue',values:{requiredInputValue:e.requiredInputValue}})))},this.cleanAcceptInput=e=>e.trim().toLowerCase().replace(/’/g,"'"),this.handleCancel=()=>{ai.a({didConfirm:!1})},this.handleInputChange=e=>{const t=ni.a.state;t.open&&ni.a.setState(ii({},t,{inputValue:e.target.value}))}}renderComponent(){const e=ni.a.state;return e.open&&(this.lastOpenState=ii({},e)),r.a.createElement(Dr.a,{open:e.open,keepFocus:!0,overlayZIndex:Ye.a,onDismiss:this.handleCancel,preventHideChildrenWhileOpening:!0,innerStyle:{borderRadius:3,paddingTop:24,paddingBottom:16,paddingLeft:32,paddingRight:32,width:this.lastOpenState&&this.lastOpenState.width||336,fontSize:16,boxShadow:this.theme.largeBoxShadow,background:this.theme.contentBackground,maxHeight:"90vh",overflowY:"scroll",marginLeft:24,marginRight:24},render:this.renderModal})}}oi.buttonStyle={width:"100%",marginTop:16};var li=oi,ci=n(612),di=n(69),ui=n(351),pi=n(56),mi=n(173),hi=n(491),gi=n(207),bi=n(143),fi=n(51),yi=n(193),Si=n(165);function vi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ei(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vi(Object(n),!0).forEach((function(t){Mi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Mi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ci extends o.a{constructor(){super(...arguments),this.handleOverrideLinkClick=e=>{Object(ci.b)(),Q.f({environment:this.environment,url:e})},this.loadSnapshot=async e=>{const{timestamp:t}=e,n=e.block?e.block.id:e.blockId;if(!n)throw new Error("Could not construct a pointer.");const a=await H.ab(this.environment,e);if("failed"===a.type)throw a.error;const r=new pi.a(a.data.contentMap),i=this.environment.currentUser.id,s=new ui.a;for(const{pointer:p,value:g}of r)g&&s.setRecord({pointer:p,userId:i},Ei({},g,{role:"reader"}));s.snapshotData={blockId:n,timestamp:t};const o=new Set,l=[];for(const{pointer:p,value:g}of r){if(p.table!==f.a||!g||!g.value)continue;const{value:e}=g,t=e,n=[...Zn.e(t),...Zn.z(t)?[]:t.content||[]];for(const a of n){if(!s.getRecord({pointer:{table:f.a,id:a},userId:i})&&Object(fi.f)(a)&&!o.has(a)){o.add(a);const e=Object(q.c)(this.props.blockStore,{table:f.a,id:a});e&&l.push(e)}}}const c=new Set,d=new Set;for(const{pointer:p,value:g}of r){if(!g||!g.value)continue;const{table:e}=p,{value:t}=g;if(e===f.a){const e=t;for(const t of Zn.k(e))c.add(t);e.created_by_table&&e.created_by_id&&(e.created_by_table===Kn.a?c.add(e.created_by_id):d.add(e.created_by_id)),e.last_edited_by_table&&e.last_edited_by_id&&(e.last_edited_by_table===Kn.a?c.add(e.last_edited_by_id):d.add(e.last_edited_by_id))}else if(e===Ka.a){const e=t;e.created_by_id&&e.created_by_table&&(e.created_by_table===Kn.a?c.add(e.created_by_id):d.add(e.created_by_id))}}const u=p.a.compact(Array.from(c).map(e=>Object(q.c)(this.props.blockStore,{table:Kn.a,id:e}))),m=p.a.compact(Array.from(d).map(e=>Object(q.c)(this.props.blockStore,{table:yi.a,id:e}))),h=[...l,...u,...m];return await Promise.all(h.map(async e=>{await e.load();const t=e.getValue();t&&s.setRecord({pointer:{table:e.table,id:t.id},userId:i},{role:"reader",value:t})})),{blockStore:new b.a(this.environment,{table:f.a,id:n},{inMemoryRecordCache:s}),timestamp:t}}}getChildContext(){return Ei({},this.context,{overrideLinkClick:this.handleOverrideLinkClick})}renderComponent(){const e={request:{blockId:this.props.blockStore.id,timestamp:this.props.timestamp},performRequest:this.loadSnapshot,render:(e,t,n)=>r.a.createElement(Un.a,{show:!n||!t,showDelay:400,showHold:400,render:n=>n?r.a.createElement("div",{style:this.getSpinnerWrapperStyles()},r.a.createElement(Dt.a,null)):e?r.a.createElement("div",{style:{padding:32}},r.a.createElement(se.a,{defaultMessage:"Something went wrong.",id:"pageSnapshotPreview.unknownPreviewLoadError.message"})):t?r.a.createElement(hi.a,{key:t.timestamp,store:t.blockStore,isDefaultContainer:!0,render:e=>r.a.createElement(mi.b,Object.assign({style:{background:this.theme.contentBackground,zIndex:1,flexGrow:1},type:this.useSeparateHorizontalScroller(t.blockStore)?mi.a.Y:mi.a.All},e),r.a.createElement(gi.b,{store:t.blockStore,disabled:!0,loadingContainerStore:void 0,context:gi.a.InAppTemplatePreview,paddingBottom:gi.b.paddingBottom(this.environment),paddingLeft:gi.b.defaultPaddingLeftRight(this.environment),paddingRight:gi.b.defaultPaddingLeftRight(this.environment),pageCoverHeight:gi.b.defaultPageCoverHeight(this.environment)}))}):void 0})};return r.a.createElement(It.a,Object.assign({},e))}useSeparateHorizontalScroller(e){return!e.isCollectionView()||!bi.b(this.environment)}getSpinnerWrapperStyles(){return{padding:32,display:"flex",alignItems:"center",justifyContent:"center"}}}Ci.contextTypes=o.b,Ci.childContextTypes=Si.a;var Oi=Ci,wi=n(199);class ki extends o.a{constructor(){super(...arguments),this.handleScroll=e=>{if(this.props.loading)return;e>(this.props.loadMoreOffsetThreshold||200)||this.props.resultSize>=this.props.fetchSize&&this.props.onLoadMore()}}renderComponent(){return r.a.createElement(wi.a,{onChange:this.handleScroll})}}var Pi=ki,Ti=n(360),Ii=n(312),ji=n(587),Di=n(553);function xi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Bi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xi(Object(n),!0).forEach((function(t){Ai(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ai(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Fi extends o.a{constructor(){super(...arguments),this.renderSnapshotsListRequest=()=>{const{device:e}=this.environment,t=Ii.a.state;if(!t.open)return;const n={request:{blockId:t.blockStore.id,size:t.size},performRequest:e=>this.loadSnapshotsList(e,t),render:(n,a,i)=>r.a.createElement(Un.a,{show:Boolean(!a||a.snapshots.length>=t.size&&t.openSnapshotNearTimestamp),showDelay:400,showHold:100,render:r=>e.isMobile?this.renderMobileHistory({snapshotValues:a?a.snapshots:[],menuState:t,error:n,initialLoading:r,loadingMore:!i}):this.renderDesktopHistory({snapshotValues:a?a.snapshots:[],menuState:t,error:n,initialLoading:r,loadingMore:!i})})};return r.a.createElement(It.a,Object.assign({},n))},this.renderMobileHistory=e=>{let t,n;return this.historyIsEnabled()?e.loadingMore||0!==e.snapshotValues.length||(t=this.renderUnavailableMessage(Fi.noSnapshotsMessage,!1)):t=this.renderUnavailableMessage(this.getUnavailableMessage(),Et.k(this.environment)||"team"),n=e.error?r.a.createElement("div",{style:Fi.wrapStyle},r.a.createElement(se.a,{defaultMessage:"Something went wrong",id:"historyModal.errorMessage"})):e.initialLoading?r.a.createElement("div",{style:Fi.wrapStyle},r.a.createElement(Dt.a,null)):r.a.createElement(a.Fragment,null,r.a.createElement(mi.b,{type:mi.a.Y},this.renderSnapshotsMenuList(e)),this.renderMobileSnapshotPreview(e.menuState)),r.a.createElement(ve.b,{menuType:ve.b.MenuType.Modal,title:r.a.createElement(se.a,{defaultMessage:"History",id:"historyModal.mobileHistoryMenu.title"}),left:this.renderMobileHelpButton(),right:r.a.createElement(we.DoneMenuText,null),onClickRight:ci.b,header:t},n)},this.renderDesktopHistory=e=>{let t;return t=e.error?r.a.createElement("div",{style:Fi.wrapStyle},r.a.createElement(se.a,{defaultMessage:"Something went wrong",id:"historyModal.desktopModal.errorMessage"})):e.initialLoading?r.a.createElement("div",{style:Fi.wrapStyle},r.a.createElement(Dt.a,null)):this.historyIsEnabled()?e.menuState.snapshot&&!this.snapshotIsAvailable(e.menuState.snapshot)?this.renderUnavailableMessage(Fi.restrictedMessage,"enterprise"):e.loadingMore||0!==e.snapshotValues.length?this.renderDesktopSnapshotPreview(e.menuState):this.renderUnavailableMessage(Fi.noSnapshotsMessage,!1):this.renderUnavailableMessage(this.getUnavailableMessage(),Et.k(this.environment)||"team"),r.a.createElement(a.Fragment,null,r.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"calc(100% - ".concat(Fi.sidebarWidth,"px)"),boxShadow:"1px 0 0 ".concat(this.theme.regularDividerColor)}},t),this.renderDesktopSidebar(e))},this.renderSnapshotsMenuList=e=>{const{device:t}=this.environment,{menuState:n,loadingMore:i}=e,s=p.a.compact(e.snapshotValues.map(e=>{const a=this.snapshotIsAvailable(e);return{key:e.id,action:()=>{ci.f(this.environment,e)},render:i=>{const s=e.authors||[],o=this.props.intl.formatList(p.a.compact(s.map((e,t)=>{if(e.table===Kn.a){const t=Object(q.c)(n.blockStore,e).getValue();if(!t)return;return Object(Kn.d)(t)}{const t=Object(q.c)(n.blockStore,e).getValue();if(!t)return;return t.name}})),{type:"conjunction",style:"narrow"}),l=r.a.createElement("div",{style:Bi({},Xe.a.textOverflowStyle)},o),c=Boolean(n.snapshot&&n.snapshot.id===e.id);if(a){const n=Object(di.a)(parseInt(e.timestamp)).format("lll");return r.a.createElement(ht.a,{key:i.key,render:n=>r.a.createElement(Bt.a,Object.assign({},Object(da.a)(i,n),{title:Object(di.a)(parseInt(e.timestamp)).calendar(),focused:!t.isMobile&&c,caption:l})),renderTooltip:()=>r.a.createElement("div",{style:{maxWidth:270,whiteSpace:"normal"}},r.a.createElement("div",null,n),r.a.createElement("div",null,o))})}{const n=!this.historyIsEnabled();return r.a.createElement(ht.a,{key:i.key,render:a=>r.a.createElement(Bt.a,Object.assign({},Object(da.a)(a,i),{title:r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("div",{style:Bi({},t.isMobile&&{display:"flex",flex:1},{},Xe.a.textOverflowStyle)},Object(di.a)(parseInt(e.timestamp)).calendar()),!n&&r.a.createElement(gt.a,{subscriptionTier:"enterprise",analyticsName:"history_modal",desktopStyle:{marginLeft:8},onClick:()=>this.handleUpgrade("enterprise")})),focused:!t.isMobile&&c,disabled:n,caption:l})),renderTooltip:()=>r.a.createElement(se.a,{defaultMessage:"Upgrade to view this snapshot.",id:"historyModal.snapshotsMenuList.upgrade.tooltip"}),disableTooltip:!n})}}}})),o=n.snapshot&&n.snapshot.id,l=s.findIndex(e=>o===e.key),c=[{key:"snapshots",render:e=>r.a.createElement(ye.a,Object.assign({},e)),items:s}];return r.a.createElement(a.Fragment,null,r.a.createElement(An.a,{type:An.a.Type.Vertical,initialFocus:l,sections:c}),r.a.createElement(Pi,{loading:i,fetchSize:n.size,resultSize:e.snapshotValues.length,onLoadMore:ci.c}),r.a.createElement(Un.a,{show:i,showDelay:300,showHold:100,render:e=>e&&r.a.createElement("div",{style:Fi.wrapStyle},r.a.createElement(Dt.a,null))}))},this.handleUpgrade=e=>{Ti.a(this.environment,{from:"history_modal",for:e})},this.loadSnapshotsList=async(e,t)=>{const{device:n}=this.environment,a=await H.bb(this.environment,e);if("failed"===a.type)throw a.error;const{snapshots:r}=a.data;if(t.openSnapshotNearTimestamp){const e=parseInt(t.openSnapshotNearTimestamp),n=r.findIndex(t=>parseInt(t.timestamp)<e);0===r.length||(0===n?ci.f(this.environment,r[n]):n>0?ci.f(this.environment,r[n-1]):r.length<t.size?ci.f(this.environment,r[r.length-1]):ci.c())}else Boolean(t.snapshot)||n.isMobile||Ii.a.setState(Bi({},t,{snapshot:r[0]}));return a.data},this.iconSize=()=>{const{device:e}=this.environment;return e.isMobile?24:20}}renderComponent(){const{device:e}=this.environment,t=Ii.a.state;return e.isMobile?r.a.createElement(be.c,{popupType:be.c.PopupType.SlideUp,open:t.open,render:this.renderSnapshotsListRequest,onDismiss:ci.b}):r.a.createElement(Dr.a,{open:t.open,innerStyle:{height:"80vh",width:"80vw",overflow:"hidden",display:"flex"},onDismiss:ci.b,render:this.renderSnapshotsListRequest,className:Ft.y})}renderMobileSnapshotPreview(e){if(this.historyIsEnabled())return r.a.createElement(be.c,{popupType:be.c.PopupType.SlideUp,open:Boolean(e.snapshot),forceFullScreenSlideUp:!0,render:()=>{if(!e.snapshot)return;const t=this.snapshotIsAvailable(e.snapshot),n=t?r.a.createElement(Oi,{blockStore:e.blockStore,timestamp:e.snapshot.timestamp}):this.renderUnavailableMessage(Fi.restrictedMessage,"enterprise");return r.a.createElement(ve.b,{menuType:ve.b.MenuType.Modal,title:Object(di.a)(parseInt(e.snapshot.timestamp)).calendar(),right:r.a.createElement(we.DoneMenuText,null),onClickRight:ci.a,leftDisabled:!t,left:r.a.createElement(se.a,{defaultMessage:"Restore",id:"historyModal.mobileSnapshotMenu.restoreButton.label"}),onClickLeft:()=>ci.e(this.environment),whiteBackground:t,forceFullScreenSlideUp:!0},n)}})}renderDesktopSidebar(e){const{menuState:t}=e,n=Boolean(t.snapshot&&this.snapshotIsAvailable(t.snapshot)),a=!this.historyIsEnabled();return r.a.createElement("div",{style:this.getSidebarStyle()},r.a.createElement(mi.b,{type:mi.a.Y,style:{flex:1}},this.renderSnapshotsMenuList(e)),r.a.createElement("div",{style:{display:"flex",padding:14,borderTop:"\n\t\t\t\t\t\t\t1px solid ".concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t")}},r.a.createElement(ht.a,{disableTooltip:!a,renderTooltip:()=>r.a.createElement(se.a,{defaultMessage:"Upgrade to restore snapshots.",id:"historyModal.desktopModal.sidebar.upgradeMessage.tooltip"}),render:e=>r.a.createElement(Qr.a,Object.assign({isLarge:!0,onClick:()=>ci.e(this.environment),disabled:!n},e),r.a.createElement(se.a,{defaultMessage:"Restore version",id:"historyModal.desktopModal.restoreButton.label"}))}),r.a.createElement(Kr.a,{isLarge:!0,style:{marginLeft:12},onClick:ci.b},r.a.createElement(se.a,{defaultMessage:"Cancel",id:"historyModal.desktopModal.cancelButton.label"}))),r.a.createElement(ye.a,{topBorder:!0,disableDesktopPadding:!0},r.a.createElement(Oe.a,{title:r.a.createElement(se.a,{id:"historyModal.desktopModal.learnMoreButton.label",defaultMessage:"Learn about page history"}),href:Object(ke.a)("guides.pageHistory"),analyticsFrom:"page_history"})))}renderDesktopSnapshotPreview(e){if(e.snapshot)return r.a.createElement(a.Fragment,null,r.a.createElement("div",{style:{display:"flex",alignItems:"center",flexShrink:0,height:45,fontSize:14,paddingLeft:14}},e.blockStore.hasIcon()&&r.a.createElement($t.a,{disabled:!0,icon:e.blockStore.getIcon(),isEmptyPage:e.blockStore.isEmptyPage(),size:this.iconSize(),style:{marginRight:6}}),r.a.createElement(Fr.a,{store:e.blockStore})),r.a.createElement(Oi,{blockStore:e.blockStore,timestamp:e.snapshot.timestamp}))}deviceSupportsUpgrade(e){const{device:t}=this.environment;return!t.isMobile||"personal"===e&&Object(Di.b)({environment:this.environment})}renderUnavailableMessage(e,t){const{device:n}=this.environment,a=Ct.a.state.data;let i=this.deviceSupportsUpgrade(t);const s=a&&Et.w(a);return i&&Object(Di.b)({environment:this.environment})&&"personal"===t&&!s&&(i=!1),r.a.createElement("div",{style:this.getUnavailableMessageStyle()},this.deviceSupportsUpgrade(t)&&this.renderVersionHistoryIcon(),r.a.createElement("div",{style:Bi({},!n.isMobile&&{maxWidth:340})},e),i&&t&&r.a.createElement(Qr.a,{isLarge:!0,onClick:()=>this.handleUpgrade(t),style:{marginTop:16}},r.a.createElement(se.a,{defaultMessage:"Upgrade",id:"historyModal.upgradeForHistoryButton.label"})))}renderVersionHistoryIcon(){return vt.a.versionHistory({width:64,height:"auto",fill:this.theme.lightIconColor,marginBottom:12})}renderMobileHelpButton(){return r.a.createElement(ji.a,{href:Object(ke.a)("guides.pageHistory"),analyticsFrom:"page_history"})}snapshotIsAvailable(e){return!!Y.a.isAdminMode||!!this.historyIsEnabled()&&(!!Et.P(this.environment,"enterprise")||parseInt(e.timestamp)>Date.now()-30*Da.a)}historyIsEnabled(){return!!Y.a.isAdminMode||Et.I(this.environment)}getUnavailableMessage(){return r.a.createElement(a.Fragment,null,r.a.createElement(se.a,{defaultMessage:"Version history is not available for free workspaces.",id:"historyModal.unavailableForFreeWorkspaces.messagePart1"}),r.a.createElement("br",null),r.a.createElement(se.a,{defaultMessage:"Please upgrade to one of our paid plans.",id:"historyModal.unavailableForFreeWorkspaces.messagePart2"}))}getSidebarStyle(){return{display:"flex",flexDirection:"column",flexShrink:0,width:Fi.sidebarWidth}}getUnavailableMessageStyle(){const{device:e}=this.environment;return Bi({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",marginTop:28,padding:16,textAlign:"center",fontSize:14},e.isMobile?{position:"relative",zIndex:1,background:this.theme.popoverBackground,boxShadow:"\n\t\t\t\t\t\t\t0 -1px 0 ".concat(this.theme.regularDividerColor,",\n\t\t\t\t\t\t\t0 1px 0 ").concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t")}:{height:"100%"})}}Fi.sidebarWidth=240,Fi.restrictedMessage=r.a.createElement(se.a,{defaultMessage:"Please upgrade to the Enterprise Plan to access versions older than 30 days.",id:"historyModal.upgradeToEnterprise.message"}),Fi.noSnapshotsMessage=r.a.createElement(se.a,{defaultMessage:"This page does not have any snapshots yet. Allow up to 10 minutes for the first snapshot to be generated.",id:"historyModal.noSnapshotsYet.message"}),Fi.wrapStyle={display:"flex",justifyContent:"center",padding:32};var Ri=Object(se.g)(Fi),Li=n(628);class Ui extends o.a{constructor(){super(...arguments),this.renderPopupContent=()=>r.a.createElement(Wi,null)}renderComponent(){const{device:e}=this.environment,{blockStore:t,originRect:n}=sr.a.state;return r.a.createElement(be.c,{popupType:e.isMobile?be.c.PopupType.SlideUp:be.c.PopupType.Popup,open:Boolean(t),originRect:n,placementToOrigin:be.c.Placement.Bottom,alignmentToOrigin:be.c.Alignment.Center,originGap:4,onDismiss:()=>Li.a(this.environment),render:this.renderPopupContent})}}class _i extends o.a{didMount(){const{blockStore:e}=sr.a.state;if(!e)return;const t=e.getTitleStore();t&&nn.j({environment:this.environment,store:t,canSelectAllBlocks:!1})}renderComponent(){const{device:e}=this.environment,{blockStore:t}=sr.a.state;if(!t)return;const n=t.getTitleStore();if(!n)return;let a;return a=e.isMobile?{menuType:ve.b.MenuType.ActionSheet}:{menuType:ve.b.MenuType.Popup,width:380},r.a.createElement(ve.b,Object.assign({},a),r.a.createElement("div",{style:this.getWrapStyle()},r.a.createElement(Jt.a,{store:n,disabled:!t.canEdit(),onEsc:()=>Li.a(this.environment),onEnter:()=>Li.a(this.environment),disableSlashCommands:!0,disableEmojiCommands:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,placeholder:this.props.intl.formatMessage({defaultMessage:"Untitled",id:"renameFileMenuPopup.input.placeholder"}),style:this.getInputStyle()})))}getWrapStyle(){return{display:"flex",alignItems:"center",color:this.theme.regularTextColor,fontSize:"13px",padding:"4px 8px"}}getInputStyle(){return{display:"flex",alignItems:"center",flexGrow:1,fontSize:14,lineHeight:"20px",paddingTop:4,paddingBottom:4,paddingLeft:10,paddingRight:10,width:"100%",borderRadius:3,boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,cursor:"text",position:"relative"}}}const Wi=Object(se.g)(_i);var Ni=Ui,zi=n(631),Vi=n(290);class qi extends o.a{constructor(){super(...arguments),this.renderMenu=()=>{const{device:e}=this.environment,t=Vi.a.state;if(!t.open)return;let n;return n=e.isReactNative&&!e.isTablet?{menuType:ve.b.MenuType.ActionSheet}:{menuType:ve.b.MenuType.Popup,width:410,maxHeight:270,onClickOutside:zi.c},r.a.createElement(ve.b,Object.assign({},n),r.a.createElement(pt.a,{filter:this.getFilter(t)||"",onSubmit:this.handleSubmit,onNoResults:this.handleNoResults,isCallout:!1}))},this.handleNoResults=()=>{const e=Vi.a.state;if(!e.open)return;const t=this.getFilter(e),n=p.a.last(t);n&&/\s/g.test(n)&&zi.c()},this.handleSubmit=e=>{Qt.d(this.environment,t=>{zi.a({environment:this.environment,emoji:e,transaction:t})})},this.handleCancel=()=>{zi.c()}}willMountOrUpdate(){const e=Vi.a.state;if(e.open){const t=Qn.a.state,n=this.getFilter(e);("editing"!==t.mode||t.store!==e.textStore||void 0===n||":"===n||n.startsWith("\n")||n.startsWith(" "))&&zi.c()}}renderComponent(){const{device:e}=this.environment,t=Vi.a.state;let n=!1;if(t.open){const e=this.getFilter(t);e&&e.length>0&&(n=!0),t.showPopupWithEmptyFilter&&(n=!0)}return r.a.createElement(be.c,{popupType:e.isReactNative&&!e.isTablet?be.c.PopupType.SlideUp:be.c.PopupType.Popup,open:n,originRect:t.open?t.selectionRect:void 0,placementToOrigin:be.c.Placement.Bottom,alignmentToOrigin:be.c.Alignment.Start,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,onDismiss:this.handleCancel,render:this.renderMenu,keepFocus:!0})}getFilter(e){return Wn.a(e.textStore,e.oldTextValue,!0)}}var Hi=qi,Gi=n(732),Yi=n(396),Qi=n(831),Ki=n(122),Zi=n(140);function Xi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function $i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ji extends o.a{constructor(){super(...arguments),this.input=r.a.createRef(),this.handleInputChange=(e,t)=>{cr.b.isOpen()&&cr.b.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xi(Object(n),!0).forEach((function(t){$i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},cr.b.state,{value:e,error:t}))},this.handleSubmit=()=>{Qt.d(this.environment,e=>{Yi.c({environment:this.environment,equationStore:cr.b,transaction:e})})},this.handleClose=()=>{Yi.a()},this.handleLeft=e=>{if(!this.input.current)return;const t=this.input.current.getSelection();t&&"altKey"in e&&!e.altKey&&"shiftKey"in e&&!e.shiftKey&&0===t.startIndex&&0===t.endIndex&&(this.handleSubmit(),Yi.a(cr.a.Backward))},this.handleRight=e=>{if(!cr.b.isOpen())return;if(!this.input.current)return;const t=this.input.current.getSelection();if(!t)return;const n=cr.b.state.value.length;"altKey"in e&&!e.altKey&&"shiftKey"in e&&!e.shiftKey&&t.startIndex===n&&t.endIndex===n&&(this.handleSubmit(),Yi.a())},this.isDisabled=()=>{if("editing"!==Qn.a.state.mode&&!cr.b.isOpen())return!0;if(cr.b.isOpen()&&!cr.b.state.savedTextSelectionState.store.canEdit())return!0;if(cr.b.isOpen()){const e=Object(Ki.b)(cr.b.state.savedTextSelectionState.store);if(e&&e.isLocked())return!0}if(cr.b.isOpen()&&cr.b.state.savedTextSelectionState.store.table===Ka.a){const e=this.getCommentValue(cr.b.state.savedTextSelectionState.store),{currentUserStore:t}=U.a.state;if(!e||!t)return!0;if(e.created_by_table!==Kn.a||t.id!==e.created_by_id)return!0}const e={[Nn.b.User]:Nn.b.User,[Nn.b.Page]:Nn.b.Page,[Nn.b.Bot]:Nn.b.Bot,[Nn.b.Date]:Nn.b.Date,[Nn.b.TemporaryPage]:Nn.b.TemporaryPage};for(const t of Object.values(e))if(Object(Zi.o)(t))return!0;return!1},this.INPUT_ORIGIN_GAP_PX=8}renderComponent(){if(cr.b.isOpen())return r.a.createElement(le.a,{dependency:le.m.prismjs},e=>{if(cr.b.isOpen())return r.a.createElement(Qi.a,{Prism:e,ref:this.input,isOpen:!0,equationValue:cr.b.state.value,error:cr.b.state.error,displayMode:"inline",disabled:this.isDisabled(),originRect:this.getInputOriginRect(),originGap:this.INPUT_ORIGIN_GAP_PX,onDismiss:this.handleClose,onChange:this.handleInputChange,onSubmit:this.handleSubmit,onLeft:this.handleLeft,onRight:this.handleRight})})}getCommentValue(e){return Gi.a.createChildStore(e,{table:Ka.a,id:e.id}).getValue()}getInputOriginRect(){if(cr.b.isOpen())return cr.b.state.savedTextSelectionRect}}var es=Ji,ts=n(223);class ns extends o.a{constructor(){super(...arguments),this.renderTooltip=()=>r.a.createElement(Ee.a,{capture:!0,onEnter:this.handleEnter,onCommandEnter:this.handleCommandEnter},r.a.createElement(r.a.Fragment,null,r.a.createElement(se.a,{defaultMessage:"Open page",id:"pageMentionOverlay.openPage"}),r.a.createElement("div",null,r.a.createElement(Ya.a,{onlyShowFirst:!0,name:"enter",style:{color:this.theme.mediumInvertedTextColor}})))),this.handleEnter=e=>{const t=this.pageMentionTokenStore.state;if(!t)return;const{pageId:n,store:a}=t;if(!n)return;e.preventDefault&&e.preventDefault();const r=b.a.createChildStore(a,{table:f.a,id:n});Q.h({store:r,environment:this.environment,visitType:ts.c.Link})},this.handleCommandEnter=e=>{const t=this.pageMentionTokenStore.state;if(!t)return;const{pageId:n,store:a}=t;if(!n)return;e.preventDefault();const r=b.a.createChildStore(a,{table:f.a,id:n});Q.h({store:r,environment:this.environment,visitType:ts.c.Link,metaClick:!0})},this.pageMentionTokenStore=this.createComputedStore(()=>{const e=Qn.a.state;if("editing"!==e.mode)return;const{selection:t,store:n}=e;if(t.endIndex!==t.startIndex+1)return;const a=n.getValue(),r=Nn.gb(a,t.startIndex);if(!r||!Nn.Ab(r))return;const[i]=Nn.W([r]);return{pageId:i,store:n}})}renderComponent(){if(this.environment.device.isMobile)return;const e=_a.d(),t=this.pageMentionTokenStore.state;return r.a.createElement(ht.a,{render:()=>{},renderTooltip:this.renderTooltip,originRect:e,forceVisibleState:Boolean(t&&e),placement:ht.a.Placement.Bottom})}}var as=ns,rs=n(260);class is extends o.a{constructor(){super(...arguments),this.handleKey=e=>{I.a.state.isActive&&(e.preventDefault(),Object(rs.b)({environment:this.environment,currentX:I.a.state.currentX,currentY:I.a.state.currentY,toggle:e.shiftKey}))},this.handleMouseMove=e=>{I.a.state.isActive&&(e.preventDefault(),Object(rs.b)({environment:this.environment,currentX:e.clientX,currentY:e.clientY,toggle:e.shiftKey}))},this.handleMouseUp=e=>{I.a.state.isActive&&(e.preventDefault(),Object(rs.a)(this.environment))}}willMount(){window.addEventListener("keydown",this.handleKey),window.addEventListener("keyup",this.handleKey),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mouseup",this.handleMouseUp)}willUnmount(){window.removeEventListener("keydown",this.handleKey),window.removeEventListener("keyup",this.handleKey),window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mouseup",this.handleMouseUp)}renderComponent(){return null}}var ss=is,os=n(406),ls=n(486),cs=n(561),ds=n(84),us=n(275),ps=n(692),ms=n(64),hs=n(625),gs=n(690),bs=n(29),fs=n(304),ys=n(251),Ss=n(264);function vs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Es(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vs(Object(n),!0).forEach((function(t){Ms(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ms(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Cs(e){const[t]=Object(os.b)(tr.a),n=Object(ls.a)(),i=Object(os.a)(()=>{if(!t.open)return!1;if(t.focusMenu)return!1;const e=Qn.a.state;if("editing"!==e.mode)return!0;const{store:n,selection:a}=e;return Object(Zi.m)(a)?!Nn.mb(n.getValue(),a.startIndex,a.endIndex,Nn.b.Link):!Object(Zi.n)(e.selection,t.savedTextSelectionState.selection)},[t]);return Object(a.useEffect)(()=>{i&&cs.a()},[i]),r.a.createElement(be.c,{popupType:n.isMobile?n.isTablet?be.c.PopupType.Popup:be.c.PopupType.SlideUp:be.c.PopupType.Popup,style:{width:330},keepFocus:n.isPhone,open:t.open,originRect:t.open?t.selectionRect:void 0,placementToOrigin:be.c.Placement.Bottom,alignmentToOrigin:be.c.Alignment.Center,originGap:8,disableContentScroll:!0,onDismiss:cs.a,render:()=>t.open?r.a.createElement(Os,{state:t}):void 0})}function Os(e){const{state:t}=e,n=Object(ls.d)(),i=Object(se.h)(),s=i.formatMessage({defaultMessage:"Paste link or search pages",id:"selectionLinkButton.search.createNewLinkPlaceholder",description:"Placeholder text in the link input field when there is no current link"}),o=i.formatMessage({defaultMessage:"Edit link or search pages",id:"selectionLinkButton.search.editLinkPlaceholder",description:"Placeholder text in the link input field when there is an existing link that will be modified"}),[l,c]=Object(a.useState)(!0);if(Object(a.useEffect)(()=>c(!1),[]),t.showCreateIn&&!n)return r.a.createElement(ws,{state:t});const d=!n||!t.showCreateIn,u=n?void 0:!t.showCreateIn&&t.focusMenu,p=t.editingToken?o:s,m=r.a.createElement(ye.a,{isInput:!0,desktopStyle:Fs(t)?{marginBottom:8}:void 0},d&&r.a.createElement(Se.a,{onFocus:xs,placeholder:p,value:t.url,onChange:Ds,focus:u,focusInitial:n,focusAfterAnimation:!0,allowArrows:!0}));let h;return h=n?{menuType:ve.b.MenuType.Modal,title:r.a.createElement(se.a,{defaultMessage:"Link",id:"selectionLinkButton.mobile.title"}),right:r.a.createElement(we.CancelMenuText,null),onClickRight:cs.a,header:m,footer:r.a.createElement(be.c,{popupType:be.c.PopupType.SlideUp,open:t.showCreateIn||!1,render:()=>r.a.createElement(ws,{state:t})})}:{menuType:ve.b.MenuType.Popup,header:m},r.a.createElement(br.a,{capture:t.open&&(l||t.focusMenu),allowEsc:!0},r.a.createElement(ve.b,Object.assign({},h),r.a.createElement(ks,{state:t})),r.a.createElement(Ee.a,{capture:!0,onCommandSlash:xs}))}function ws(e){const{state:t}=e,n=Object(ls.b)(),i=Object(a.useCallback)(async e=>{if(!ds.j(n))return;const a=Qt.c(n),r=Object(Jn.e)({environment:n,transaction:a,titleText:t.url||"",createInValue:e,recordStoreParent:t.savedTextSelectionState.store}),[i]=r.createdPages;i&&cs.b({environment:n,url:Object(us.a)({pageId:i.id}),transaction:a,editingToken:t.editingToken,savedTextSelectionState:t.savedTextSelectionState}),await r.moveToStorePromise,await Qt.b({environment:n,transaction:a}),await Object(Jn.a)({analyticsFrom:"link_menu",createInState:r})},[t,n]),s="block"===t.savedTextSelectionState.store.table?t.savedTextSelectionState.store.id:void 0;return r.a.createElement(_n.a,{targets:[],isAddTo:!0,isCreateIn:!0,onAccept:i,captureSelection:!1,restoreSelection:!1,parentBlockId:s,onAutocompleteQueryChange:Ps,autocompleteQuery:t.createInQuery||"",desktopWidth:330,onCancel:Is})}function ks(e){const{state:t}=e,n=Object(ls.b)(),i=Object(ls.d)(),s=Object(gs.b)(),[{online:o}]=Object(os.b)(qn.a),l=Object(a.useMemo)(()=>As(t),[t]),c=Object(a.useMemo)(()=>Rs(l),[l]),d=Object(a.useMemo)(()=>{const{store:e}=t.savedTextSelectionState;if(Object(oe.n)(e))return e},[t]),[{value:u,status:m}]=Object(ps.a)(async()=>{if(!l||!o)return[];return(await Object(jt.e)({nearBlock:d,environment:n,query:l,source:"mention_menu",limit:10})).map(e=>e.id)},[l,d,n,o]),h=Object(a.useMemo)(()=>{if(c&&"notion"===c.type){const e=u?p.a.without(u,c.notionPage.blockId):[];return[c,...e]}return u},[u,c]),g=Object(a.useMemo)(()=>{if(!h||0===h.length)return;if(c&&"web"===c.type&&c.url===l)return;const e=fs.a.withListenerIgnored(T.d);if(!e)return;const a=t.url?5:3,i=r.a.createElement(se.a,{id:"selectionLinkButton.linkToPage.linkToBlock",defaultMessage:"Link to block",description:"Shown beneath a page title if linking to a block inside that page"}),s=r.a.createElement(se.a,{defaultMessage:"Link to page",id:"selectionLinkButton.linkToPageSection.title"}),o=p.a.compact(h.map(a=>{const s="object"==typeof a?a.notionPage.peekViewBlockId||a.notionPage.blockId:a,o=b.a.createChildStore(e,{table:f.a,id:s});return{key:s,action:()=>{if("object"==typeof a){const e=Object(us.a)({pageId:a.notionPage.blockId,peekViewBlockId:a.notionPage.peekViewBlockId,discussionId:a.notionPage.discussionId,collectionViewId:a.notionPage.collectionViewId,scrollToBlockId:a.notionPage.scrollToBlockId});js(n,t,e)}else js(n,t,Object(us.a)({pageId:s}))},render:e=>{const t="object"==typeof a&&a.notionPage.scrollToBlockId;return r.a.createElement(Rn.a,Object.assign({},e,{store:o,caption:t?i:void 0,placeholder:r.a.createElement(Un.a,{showHold:300,showDelay:300,show:"resolved"===m,render:e=>e?r.a.createElement(se.a,{id:"selectionLinkButton.linkToPage.unknownBlock",defaultMessage:"Unknown block"}):r.a.createElement(se.a,{id:"selectionLinkButton.linkToPage.loading",defaultMessage:"Loading..."})})}))}}})).slice(0,a),d=h.some(e=>Boolean("object"==typeof e&&e.notionPage.scrollToBlockId));return{key:"mention results",items:o,render:e=>r.a.createElement(ye.a,Object.assign({},e,{title:d?s:i,isTitleUppercase:!0}))}},[h,t,n,l,c,m]),y=Object(a.useMemo)(()=>{const e=r.a.createElement(se.a,{defaultMessage:"Linked to",id:"selectionLinkButton.linkedToSection.title"}),a=Bs(t),i=a?Object(us.c)(a):void 0;if(i&&a){const t=fs.a.withListenerIgnored(T.d);if(!t)return;const s=b.a.createChildStore(t,{table:f.a,id:i});return{key:"linked to",render:t=>r.a.createElement(ye.a,Object.assign({title:e,isTitleUppercase:!0},t)),items:[{key:"linked to page",action:e=>{let{event:t}=e;const r=t&&t.metaKey;r||tr.a.setState({open:!1}),Object(Q.f)({environment:n,url:a,metaClick:r})},render:e=>r.a.createElement(Rn.a,Object.assign({},e,{store:s}))}]}}if(a)return{key:"linked to",render:t=>r.a.createElement(ye.a,Object.assign({title:e,isTitleUppercase:!0},t)),items:[{key:"linked to web",action:e=>{let{event:t}=e;return Object(Q.f)({environment:n,url:a,metaClick:t&&t.metaKey})},render:e=>r.a.createElement(Bt.a,Object.assign({},e,{title:a,caption:r.a.createElement(se.a,{defaultMessage:"Web page",id:"selectionLinkButton.linkedToSection.webPage"}),icon:vt.a.globe2({width:16,fill:s.mediumIconColor})}))}]}},[n,t,s]),S=Object(a.useMemo)(()=>{if(!c)return;if("notion"===c.type&&o)return;let e;return"web"===c.type?e=r.a.createElement(se.a,{id:"selectionLinkButton.linkToWebPage",defaultMessage:"Link to web page"}):"notion"===c.type?e=r.a.createElement(se.a,{id:"selectionLinkButton.linkToPage",defaultMessage:"Link to page"}):"other"===c.type?e=r.a.createElement(se.a,{id:"selectionLinkButton.linkToURL",defaultMessage:"Link to URL"}):Object(bs.e)(c),{key:"link to url",action:()=>js(n,t,l),render:t=>r.a.createElement(Bt.a,Object.assign({},t,{title:e,icon:vt.a.link({width:16})}))}},[t,l,n,o,c]),v=Object(a.useMemo)(()=>{if(t.editingToken)return{key:"copy link",action:()=>function(e,t){const n=Bs(t);if(!n)return;const a=Object(us.c)(n),r=a?Object(Ss.a)({pageId:a,baseUrl:Y.a.baseURL}):n;ys.c({environment:e,stringValue:r}),cs.a()}(n,t),render:e=>r.a.createElement(Bt.a,Object.assign({},e,{title:r.a.createElement(se.a,{id:"selectionLinkButton.copyLink",defaultMessage:"Copy link",description:"Copies the URL for the focused link to the user's clipboard"}),icon:vt.a.copy({width:16})}))}},[t,n]),E=Object(a.useMemo)(()=>{if(t.editingToken)return{key:"unlink",action:()=>cs.d(n),render:e=>r.a.createElement(Bt.a,Object.assign({},e,{title:r.a.createElement(se.a,{id:"selectionLinkButton.removeLink",defaultMessage:"Remove link"}),icon:vt.a.trash({width:16})}))}},[t.editingToken,n]),M=Object(a.useMemo)(()=>{if(!l)return;if(!t.savedTextSelectionState.store.isDefaultRecordCache())return;const e=Rs(l);return!e||e.url!==l&&!e.notionPage?{key:"create page",action:Ts,render:e=>r.a.createElement(Bt.a,Object.assign({},e,{icon:vt.a.alias({width:16}),title:r.a.createElement(sa,{pageTitle:l})}))}:void 0},[l,t.savedTextSelectionState.store]),C=p.a.compact([g,y]),O=C.length>0,w=Object(a.useMemo)(()=>{const e=p.a.compact([S,v,E,M]);if(0!==e.length)return{key:"link actions",render:e=>r.a.createElement(ye.a,Object.assign({topBorder:O},e)),items:e}},[O,S,v,E,M]),k=p.a.compact([...C,w]),P=Object(a.useMemo)(()=>{if(i)return;if(!c||!w||!S)return 0===k.length?void 0:0;const e=p.a.sum(C.map(e=>e.items.length))+w.items.indexOf(S);return Math.max(e,0)},[i,c,w,S,k,C]);return r.a.createElement(An.a,{type:An.a.Type.Vertical,initialFocus:P,sections:k})}function Ps(e){const t=tr.a.state;t.open&&tr.a.setState(Es({},t,{createInQuery:e}))}function Ts(){const e=tr.a.state;e.open&&tr.a.setState(Es({},e,{showCreateIn:!0}))}function Is(){const e=tr.a.state;e.open&&tr.a.setState(Es({},e,{showCreateIn:!1,createInQuery:""}))}function js(e,t,n){const a=Object(hs.a)(n);a&&Qt.d(e,n=>{cs.b({environment:e,transaction:n,url:a,editingToken:t.editingToken,savedTextSelectionState:t.savedTextSelectionState})})}const Ds=e=>{const t=tr.a.state;t.open&&tr.a.setState(Es({},t,{url:e.target.value,focusMenu:!0}))};function xs(){const e=tr.a.state;e.open&&(e.focusMenu||tr.a.setState(Es({},e,{focusMenu:!0})))}function Bs(e){const{editingToken:t}=e;if(!t)return;const n=Nn.db(t),a=Nn.A(n);return a?Nn.R(a):void 0}function As(e){return e.url||""}function Fs(e){return""===As(e)&&void 0===Bs(e)}function Rs(e){const t=Nn.T(e);if(t&&"url"===t.type){const e=Object(Ba.k)({url:t.href,baseUrl:Y.a.baseURL,isMobile:!1,protocol:void 0,currentUrl:void 0});return"page"===e.name?{type:"notion",url:t.href,notionPage:e}:{type:"web",url:t.href}}const n=Object(ms.h)({str:e,allowNoProtocol:!1});if(n)return{type:"other",url:n}}var Ls=n(528),Us=n(135),_s=n(759),Ws=n(308),Ns=n(437);function zs(e){const[t]=Object(os.b)(Ls.a),n="on"===Object(ls.c)("link-hover-preview"),i=Object(os.c)(Us.a),s=Object(Ws.b)(t,400,Object.is),o=t&&t===s,l=Object(a.useMemo)(()=>s&&s.token.node.getBoundingClientRect(),[s]);return n?r.a.createElement(be.c,{disableMouseCapture:!0,preventCaptureEsc:!0,preventPointerEvents:!0,preventScaleTransition:!0,preventOpacityTransition:!0,popupType:be.c.PopupType.Popup,open:Boolean(!i&&o),originRect:l,originGap:8,alignmentToOrigin:be.c.Alignment.Start,placementToOrigin:be.c.Placement.Bottom,useLightBoxShadow:!0,render:()=>s&&r.a.createElement(Vs,{state:s})}):null}function Vs(e){const{annotation:t,store:n}=e.state,i=Object(ls.b)(),s=Object(gs.b)(),o=Nn.R(t),l=Object(us.c)(o),c=Object(gs.a)(e=>({wrapper:{fontSize:Xe.a.fontSize.UISmall.desktop,padding:"4px 8px",color:e.mediumTextColor,fontWeight:Xe.a.fontWeight.medium,fill:e.mediumIconColor,maxWidth:450},icon:{height:"1em",width:"1em",marginRight:"0.25em",fill:e.mediumIconColor}}),[]),d=Object(os.a)(()=>{if(!l)return;const e=b.a.createChildStore(n,{table:f.a,id:l}),t=e.getValue(),a=t&&Object(Xn.h)({pageValue:t,baseUrl:Y.a.baseURL,getRecordValue:n.getRecordValue,emojiType:Object($n.a)(i),isSafariOrIOS:i.device.isSafari||i.device.isIOS,isClient:!0,showEmojiInline:i.device.isWindows,currentUserId:i.currentUser.id}),s=t&&t.parent_id!==n.id?vt.a.alias(c.icon):void 0;return r.a.createElement(r.a.Fragment,null,a,s,r.a.createElement(Fr.a,{style:Xe.a.textOverflowStyle,store:e}))},[l,s,c]);return Object(a.useEffect)(()=>{const e=p.a.throttle(Ns.a,200,{leading:!0});return g.a(window,"scroll",e,!0),()=>g.b(window,"scroll",e,!0)},[]),r.a.createElement(_s.a,{style:c.wrapper,alignItems:"center"},d||r.a.createElement(r.a.Fragment,null,vt.a.globe2(c.icon),r.a.createElement("div",{style:Xe.a.textOverflowStyle},o)))}class qs extends o.a{willMount(){this.environment.device.isMobile&&document.addEventListener("gesturestart",(function(e){e.preventDefault()}))}renderComponent(){const e=this.environment.currentUser.isLoggedIn(),{isMobile:t,isElectron:n}=this.environment.device,{currentSpaceStore:s}=U.a.state;return r.a.createElement(a.Fragment,null,r.a.createElement(me,null),r.a.createElement(En,null),r.a.createElement(Tn,null),r.a.createElement(xn,null),r.a.createElement(d,null),r.a.createElement(i.a,{isRoot:!0,capture:!0}),r.a.createElement(R,null),e&&!t&&r.a.createElement(z,null),e&&s&&r.a.createElement(de,{rootStore:s}),r.a.createElement(He,null),r.a.createElement(Zt,null),r.a.createElement(De,null),r.a.createElement(on,null),r.a.createElement(Ni,null),r.a.createElement(st,null),r.a.createElement(Ue,null),!t&&r.a.createElement(hr,null),r.a.createElement(es,null),r.a.createElement(as,null),r.a.createElement(Gt,null),r.a.createElement(ln.a,{store:w.a}),r.a.createElement(ln.a,{store:O.a}),r.a.createElement(Ea,null),r.a.createElement(Pa,null),r.a.createElement(Hi,null),r.a.createElement(Ua,null),r.a.createElement(Cs,null),n&&r.a.createElement(Mr,null),r.a.createElement(jr,null),r.a.createElement(ti,null),r.a.createElement(li,null),r.a.createElement(ss,null),e&&r.a.createElement(Ri,null),r.a.createElement(zs,null))}}t.default=qs},1103:function(e,t,n){"use strict";n.r(t);n(15),n(11);var a=n(2),r=n.n(a),i=n(0),s=n.n(i),o=n(14),l=n(171),c=n(17),d=n(27),u=n(10),p=n(68),m=n(8),h=n(220),g=n(749),b=n(155),f=n(22),y=n(55),S=n(245),v=n(1463),E=n(72),M=n(161),C=n(693),O=n(53),w=n(314),k=n(118),P=n(691),T=n(3),I=n(23),j=n(192),D=n(37),x=n(1);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){F(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class L extends T.a{constructor(){super(...arguments),this.createBlockStore=e=>{const{parentStore:t}=this.props;return d.a.createChildStore(t,{table:u.a,id:e})},this.createUserStore=e=>{const{parentStore:t}=this.props;return j.a.createChildStore(t,{table:D.a,id:e})},this.getUserValue=e=>this.createUserStore(e).getValue(),this.getCreatedTimeDetail=e=>{const{intl:t}=this.props,{starting:n,ending:a}=e;return n&&a?s.a.createElement(x.a,{defaultMessage:"Created {startDate} to {endDate}",id:"search.recentMenuItem.createdDateWithRange.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content created in a specific date range. {startDate} and {endDate} are dates including the month, day, and year.",values:{startDate:P.c(n,t),endDate:P.c(a,t)}}):n?s.a.createElement(x.a,{defaultMessage:"Created after {startDate}",id:"search.recentMenuItem.createdDateAfter.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content created after a specific date. {startDate} is a date including the month, day, and year.",values:{startDate:P.c(n,t)}}):a?s.a.createElement(x.a,{defaultMessage:"Created before {endDate}",description:"Shown as part of the subtitle if the recent search involved searching for content created before a specific date. {endDate} is a date including the month, day, and year.",id:"search.recentMenuItem.createdDateBefore.subtitle",values:{endDate:P.c(a,t)}}):void 0},this.getLastEditedTimeDetail=e=>{const{intl:t}=this.props,{starting:n,ending:a}=e;return n&&a?s.a.createElement(x.a,{defaultMessage:"Last edited {startDate} to {endDate}",id:"search.recentMenuItem.lastEditedDateWithRange.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content last edited in a specific date range. {startDate} and {endDate} are dates including the month, day, and year.",values:{startDate:P.c(n,t),endDate:P.c(a,t)}}):n?s.a.createElement(x.a,{defaultMessage:"Last edited after {startDate}",id:"search.recentMenuItem.lastEditedDateAfter.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content last edited after a specific date. {startDate} is a date including the month, day, and year.",values:{startDate:P.c(n,t)}}):a?s.a.createElement(x.a,{defaultMessage:"Last edited before {endDate}",description:"Shown as part of the subtitle if the recent search involved searching for content last edited before a specific date. {endDate} is a date including the month, day, and year.",id:"search.recentMenuItem.lastEditedDateBefore.subtitle",values:{endDate:P.c(a,t)}}):void 0},this.styles={recentSearchItem:()=>{const{device:e}=this.environment;return{minHeight:void 0,paddingTop:e.isMobile?12:8,paddingBottom:e.isMobile?12:8}},inlineCaption:{display:"block",marginTop:1},queryText:{flexShrink:0},detailEmphasis:{fontWeight:I.a.fontWeight.medium},enterIcon:{height:14,width:14},textWrapper:{marginLeft:8},iconWrapper:{height:19,width:19,display:"flex",alignItems:"center"}}}renderComponent(){const{device:e}=this.environment,t=this.props,{query:n}=t,a=R(t,["query"]),r=this.styles,i=this.getThemeColors(),o=s.a.createElement("div",{style:r.queryText},n.text.trim()),l=A({},r.recentSearchItem(),{},this.environment.device.isMobile&&i.menuItemMobile),c=!e.isMobile;return s.a.createElement(O.a,Object.assign({},a,{style:l,inline:c,icon:this.renderIcon(),title:o,caption:this.renderRecentSearchCaption(),captionStyle:c?r.inlineCaption:void 0,right:this.renderEnterIcon(),disableTransition:!0,dontShrinkRight:!0,textWrapperStyle:r.textWrapper,className:"notranslate"}))}renderRecentSearchCaption(){const{query:e}=this.props,{isNavigableOnly:t,ancestors:n,createdBy:a,editedBy:r,lastEditedTime:i,createdTime:o}=e.filters,l=[];if(t&&l.push(s.a.createElement(x.a,{defaultMessage:"Only match titles",id:"search.recentMenuItem.onlyMatchTitles.subtitle"})),n.length>0){const e=this.renderRecentSearchAncestors(n);l.push(s.a.createElement(x.a,{defaultMessage:"In {pages}",id:"search.recentMenuItemDetail.inPage.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content in specific pages. {pages} is the title of the first page that the search was conducted in, with something like '+ 1' or '+ 2' following it, depending on the number of additional pages that were searched.",values:{pages:this.renderListItems(e)}}))}if(a.length>0){const e=this.renderRecentSearchUsers(a);l.push(s.a.createElement(x.a,{defaultMessage:"Created by {people}",id:"search.recentMenuItemDetail.createdBy.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content created by specific people. {people} is the name of the first person, with something like '+ 1' or '+ 2' following it, depending on the number of additional people in the search.",values:{people:this.renderListItems(e)}}))}if(r.length>0){const e=this.renderRecentSearchUsers(r);l.push(s.a.createElement(x.a,{defaultMessage:"Edited by {people}",id:"search.recentMenuItemDetail.editedBy.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content edited by specific people. {people} is the name of the first person, with something like '+ 1' or '+ 2' following it, depending on the number of additional people in the search.",values:{people:this.renderListItems(e)}}))}if(o.starting||o.ending){const e=this.getCreatedTimeDetail(o);l.push(e)}if(i.starting||i.ending){const e=this.getLastEditedTimeDetail(i);l.push(e)}if(l.length>0)return Object(w.a)(l,()=>" · ")}renderListItems(e){if(0===e.length)return;if(1===e.length)return e;const[t,...n]=e,a=n.length;return s.a.createElement(x.a,{defaultMessage:"{firstPageOrPerson} + {numberRemaining}",id:"search.recentMenuItem.listOfPeopleOrPages.label",values:{firstPageOrPerson:t,numberRemaining:a},description:"This shows the people or pages the recent search item was conducted against. The '+' symbol means 'and'."})}renderRecentSearchAncestors(e){const t=this.styles;return e.map(e=>s.a.createElement(s.a.Fragment,{key:e}," ",s.a.createElement(k.a,{key:e,store:this.createBlockStore(e),style:t.detailEmphasis,shouldWrap:!0})))}renderRecentSearchUsers(e){const t=this.styles;return e.map(e=>{const n=this.getUserValue(e);return s.a.createElement(s.a.Fragment,{key:e}," ",s.a.createElement("span",{style:t.detailEmphasis},Object(D.d)(n)))})}renderEnterIcon(){const{device:e}=this.environment,{focused:t}=this.props,n=this.styles,a=this.getThemeColors();if(e.isMobile)return;const r=A({},n.enterIcon,{},a.enterIcon);return t?m.a.enter(r):void 0}renderIcon(){const{icon:e}=this.props;return s.a.createElement("div",{style:this.styles.iconWrapper},e)}getThemeColors(){return{menuItemMobile:{boxShadow:"0 1px 0 ".concat(this.theme.lightDividerColor)},enterIcon:{fill:this.theme.mediumIconColor}}}}L.contextTypes=f.c;var U=Object(x.g)(L),_=n(183),W=n(255),N=n(41),z=n(199),V=n(154),q=n(29);const H={listStyleType:"none",padding:0,margin:0};I.a.fontWeight.regular;function G(e,t){const n="UIRegular"===t?I.a.fontSize.UIRegular:"UISmall"===t?I.a.fontSize.UISmall:Object(q.e)(t);return e.device.isMobile?n.mobile:n.desktop}function Y(e,t){const n="UIRegular"===t?I.a.lineHeight.UIRegular:"UISmall"===t?I.a.lineHeight.UISmall:Object(q.e)(t);return e.device.isMobile?n.mobile:n.desktop}function Q(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){X(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class $ extends T.a{constructor(){super(...arguments),this.styles={menuItem:Z({minHeight:void 0},this.environment.device.isMobile&&{background:void 0,boxShadow:void 0},{paddingTop:32,paddingBottom:32}),text:{textAlign:"center"},title:{margin:0,fontWeight:I.a.fontWeight.medium,fontSize:G(this.environment,"UIRegular"),lineHeight:Y(this.environment,"UIRegular")},caption:{fontSize:G(this.environment,"UIRegular")}}}renderComponent(){const e=this.props,{style:t}=e,n=Q(e,["style"]),a=t?Z({},this.styles.menuItem,{},t):this.styles.menuItem;return s.a.createElement(V.a,Object.assign({},n,{title:this.renderTitle(),caption:this.renderCaption(),textWrapperStyle:this.styles.text,style:a}))}renderTitle(){const{title:e}=this.props;if(!e)return;const t=this.styles,n=this.getThemeColors(),a=Z({},t.title,{},n.title);return s.a.createElement("h4",{role:"alert",style:a},e)}renderCaption(){const{caption:e}=this.props;if(!e)return;const t=this.styles,n=this.getThemeColors(),a=Z({},t.caption,{},n.caption);return s.a.createElement("div",{style:a},e)}getThemeColors(){return{title:{color:this.theme.mediumTextColor},caption:{color:this.theme.lightTextColor}}}}$.contextTypes=Z({},f.c);var J=$,ee=n(184),te=n(167),ne=n(746);function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){ie(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class se extends T.a{constructor(){super(...arguments),this.handleSendMessageClick=()=>{ne.a({environment:this.environment,from:"quick_find"})},this.styles={menuItem:{marginTop:"auto",marginBottom:"auto"},reportProblemButton:{display:"inline"}}}renderComponent(){return s.a.createElement(J,Object.assign({},this.getErrorMessage(),{style:this.styles.menuItem}))}renderNoResults(){const{searchStore:e}=this.props,t=P.l(e.state.query.filters);return{title:se.noResultsTitle,caption:t?s.a.createElement(x.a,{defaultMessage:"Try different search terms or filters",id:"searchErrorMenuItem.errorPrompt.searchTermsAndFilters"}):s.a.createElement(x.a,{defaultMessage:"Try different search terms",id:"searchErrorMenuItem.errorPrompt.searchTerms"})}}renderOffline(){return{title:se.noResultsTitle,caption:s.a.createElement(x.a,{defaultMessage:"Go online for more results.",id:"searchErrorMenuItem.errorPrompt.goOnline"})}}renderRequestFailed(){var e=this;const t=this.styles,n=this.getThemeColors(),a=re({},t.reportProblemButton,{},n.reportProblemButton);return{title:s.a.createElement(x.a,{id:"searchErrorMenuItem.error.genericErrorMessage",defaultMessage:"Something went wrong"}),caption:s.a.createElement(x.a,{id:"searchErrorMenuItem.errorPrompt.refreshOrReport",defaultMessage:"Try refreshing or <reportlink>report a problem</reportlink>.",values:{reportlink:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return s.a.createElement(ee.a,{onClick:e.handleSendMessageClick,style:a},n)}}})}}getErrorMessage(){const{error:e}=this.props;switch(e.type){case te.d.NoResults.type:return this.renderNoResults();case te.d.Offline.type:return this.renderOffline();case te.d.RequestFailed.type:return this.renderRequestFailed();default:Object(q.e)(e)}}getThemeColors(){return{reportProblemButton:{color:this.theme.blueColor}}}}se.contextTypes=re({},f.c),se.noResultsTitle=s.a.createElement(x.a,{defaultMessage:"No results",id:"searchErrorMenuItem.error.noResults"});var oe=se,le=n(307),ce=n(102),de=n(1247),ue=n(24),pe=n(301);function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){ge(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class be extends T.a{constructor(){super(...arguments),this.renderKeyboardShortcut=(e,t)=>{const n=this.styles,a=this.getThemeColors(),r=he({},n.keyboardShortcut,{},a.keyboardShortcut,{},t);return s.a.createElement("span",{style:r},e)},this.styles={footer:()=>{const{device:e}=this.environment;return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:e.isMobile?I.a.fontSize.UIRegular.mobile:I.a.fontSize.UIRegular.desktop}},footerText:he({fontSize:G(this.environment,"UISmall")},I.a.textOverflowStyle),inlineHint:{display:"inline",marginRight:16},resultCountWrapper:he({display:"flex",alignItems:"center"},I.a.textOverflowStyle),resultCount:{fontWeight:I.a.fontWeight.medium},resultText:{verticalAlign:"middle",marginRight:6},spinner:{display:"inline",width:12,height:12,verticalAlign:"middle"},keyboardShortcut:{marginRight:4,marginBottom:1,fontVariant:"all-small-caps",fontSize:1.1*G(this.environment,"UISmall")},commandGlyph:{fontSize:.75*G(this.environment,"UIRegular")}}}renderComponent(){return this.props.mode===de.c.Mode.Results?this.renderResultState(this.props.results):this.renderSection(this.renderHelpText())}renderResultState(e){const t=this.styles,n=this.getThemeColors(),a=he({},t.resultCount,{},n.resultCount),{count:r,isLowerBound:i}=this.getResultCount(e),o=s.a.createElement("span",{style:t.resultText},i?this.props.intl.formatMessage({id:"searchFooter.helpText.resultCountApproximate",description:"Approximate number of results displayed in footer of search modal.",defaultMessage:"{resultCount, plural, other {<resultwrapper>{resultCount}+</resultwrapper> results}}"},{resultCount:r,resultwrapper:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return s.a.createElement("span",{style:a},t)}}):this.props.intl.formatMessage({id:"searchFooter.helpText.resultCount",description:"Exact number of results displayed in footer of search modal.",defaultMessage:"{resultCount, plural, one {<resultwrapper>{resultCount}</resultwrapper> result} other {<resultwrapper>{resultCount}</resultwrapper> results}}"},{resultCount:r,resultwrapper:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return s.a.createElement("span",{style:a},t)}})),l=s.a.createElement("div",{style:t.resultCountWrapper},o,this.props.mode===de.a.Results&&this.renderSpinner(this.props.showSpinner));return this.renderSection(l)}renderSpinner(e){const t=this.styles;return s.a.createElement(pe.a,{show:e,showDelay:500,showHold:200,render:e=>e&&s.a.createElement(ce.a,{style:t.spinner})})}renderSection(e){const t=this.styles,n=this.getThemeColors(),a=he({},t.footerText,{},n.footerText);return s.a.createElement(ue.a,{topBorder:!0,style:t.footer(),disableDesktopPadding:!0},s.a.createElement(V.a,{title:e,style:a}))}renderHelpText(){const e=this.styles,t=this.getThemeColors(),n=he({},H,{},e.footerText,{},t.footerText),a=he({},e.commandGlyph,{},t.keyboardShortcut),{command:r}=le.a(this.environment),{device:i}=this.environment;return s.a.createElement("ul",{style:n},s.a.createElement("li",{style:e.inlineHint},this.renderKeyboardShortcut("↑↓"),this.props.intl.formatMessage({id:"searchFooter.helpText.selectHint",defaultMessage:"Select"})),s.a.createElement("li",{style:e.inlineHint},this.renderKeyboardShortcut("Enter"),this.props.intl.formatMessage({id:"searchFooter.helpText.openHint",defaultMessage:"Open"})),s.a.createElement("li",{style:e.inlineHint},s.a.createElement("span",{style:a},r),this.renderKeyboardShortcut("+Enter"),i.isElectron?this.props.intl.formatMessage({id:"searchFooter.helpText.openNewWindow",defaultMessage:"Open in a new window"}):this.props.intl.formatMessage({id:"searchFooter.helpText.openNewTab",defaultMessage:"Open in a new tab"})))}getResultCount(e){const t=e.server?e.server.total:e.local.total;return{count:t,isLowerBound:Boolean(e.server&&e.local&&t<de.b)}}getThemeColors(){return{footerText:{color:this.theme.lightTextColor},resultCount:{color:this.theme.mediumTextColor},keyboardShortcut:{color:this.theme.mediumTextColor}}}}var fe=Object(x.g)(be),ye=n(76),Se=n(47),ve=n(82),Ee=n(13),Me=n(19),Ce=n(16);const Oe="Invalid date",we="Invalid range";class ke extends Ce.a{getInitialState(){return{edited:!1,temporary:"",error:void 0}}}var Pe=ke,Te=n(153),Ie=n(169),je=n(694),De=n(40);function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach((function(t){Ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Fe(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class Re extends T.a{constructor(){super(...arguments),this.storeTypes={store:Pe},this.renderInput=()=>{const{device:e}=this.environment,t=this.props,{store:n,hideClearButton:a,focused:r}=t,i=Fe(t,["store","hideClearButton","focused"]),o=e.isMobile?"date":"text",l="date"===o?Te.b.Format.Transparent:Te.b.Format.Large,c=e.isMobile?void 0:r;return s.a.createElement(Ie.a,Object.assign({},i,{type:o,format:l,left:this.renderMobilePlaceholder(o),showClearButton:this.showClearButton(),focus:c,onFocus:this.handleFocus,onClearButtonClick:this.handleClear,onChange:this.handleChange,onSubmit:this.handleSubmit,onBlur:this.handleBlur,value:this.getInputValue()},this.getInputStyles()))},this.handleFocus=e=>{const{onFocus:t}=this.props,{store:n}=this.stores;n.setState(Be({},n.state,{edited:!1})),t&&t(e)},this.handleClear=()=>{const{onClear:e,onUpdate:t}=this.props,{store:n}=this.stores;n.setState(Be({},n.state,{edited:!0,temporary:"",error:void 0}));const a=this.validateCurrent();a&&t(a),n.setState(Be({},n.state,{edited:!1})),e&&e()},this.handleChange=e=>{const{device:t}=this.environment,{store:n}=this.stores;n.setState(Be({},n.state,{edited:!0,temporary:e.target.value||""})),t.isAndroid&&this.handleBlur()},this.handleSubmit=e=>{const{onUpdate:t,onSubmit:n}=this.props,{store:a}=this.stores,r=this.validateCurrent();r&&(t(r),r.error?a.setState(Be({},a.state,{edited:!1,error:r.error})):a.reset()),n&&n(e,r)},this.handleBlur=e=>{const{onUpdate:t,onBlur:n}=this.props,{store:a}=this.stores,r=this.validateCurrent();r?(t(r),r.error?a.setState(Be({},a.state,{edited:!1,error:r.error})):a.reset()):a.setState(Be({},a.state,{edited:!1})),e&&n&&n(e)},this.styles={menuItem:{marginBottom:this.environment.device.isMobile?1:12},inputWrapper:{borderRadius:3,height:28,paddingRight:this.showClearButton()?6:0,position:"relative"},inputEditRegion:{width:this.showClearButton()?"calc(100% - 14px)":"100%"},inputEditRegionMobile:{padding:"2px 6px",position:"relative"},placeholder:{position:"absolute",left:6,top:"50%",transform:"translateY(-50%)"},tooltipOriginGap:-8}}didUpdate(e){const{store:t}=this.stores;r.a.isEqual(e.value,this.props.value)||t.reset()}renderComponent(){const e=this.styles,t=this.getError();return t?s.a.createElement(De.a,{renderTooltip:()=>t,forceVisibleState:!0,placement:De.a.Placement.Left,render:this.renderInput,originGap:e.tooltipOriginGap}):this.renderInput()}renderMobilePlaceholder(e){const{placeholder:t,value:n}=this.props,a=this.styles,r=this.getThemeColors();if("date"===e&&!n)return s.a.createElement("div",{style:Be({},a.placeholder,{},r.placeholder)},t)}getInputValue(){const{device:e}=this.environment,{value:t,dateFormat:n,intl:a}=this.props,{store:r}=this.stores;return e.isMobile?t?P.c(t,a,"YYYY-MM-DD"):"":r.state.temporary?r.state.temporary:r.state.edited?r.state.temporary:t?P.c(t,a,n):""}getError(){const{store:e}=this.stores,{intl:t}=this.props;if(e.state.error)switch(e.state.error){case Oe:return t.formatMessage({id:"dateInputError.invalidDateError.tooltip",defaultMessage:"Invalid date"});case we:return t.formatMessage({id:"dateInputError.invalidDateRangeError.tooltip",defaultMessage:"Invalid range"});default:Object(q.e)(e.state.error)}}validateCurrent(){const{validate:e}=this.props,t=this.parseCurrentValue();if(t)return e?e(t):t}parseCurrentValue(){const{store:e}=this.stores;if(!e.state.edited)return;if(!e.state.temporary)return{value:void 0};const t=Object(je.a)(e.state.temporary,this.props.intl);return t?{value:{type:"date",start_date:t}}:{error:Oe}}showClearButton(){const{device:e}=this.environment,{hideClearButton:t}=this.props;return!!e.isMobile||!t}getInputStyles(){const{device:e}=this.environment,{inputStyle:t,inputOuterStyle:n,style:a}=this.props,r=this.styles;return{style:Be({},r.menuItem,{},a),inputOuterStyle:Be({},this.getInputBorders(),{},r.inputWrapper,{},n),inputStyle:Be({},r.inputEditRegion,{},e.isMobile&&r.inputEditRegionMobile,{},t)}}getInputBorders(){const{disabled:e,focused:t}=this.props,n=this.getThemeColors(),a=this.getError();if(!e)return a?n.inputError:t?n.inputFocused:n.inputDefault}getThemeColors(){return{inputDefault:{background:this.theme.inputBackground,boxShadow:this.theme.inputBoxShadow},inputFocused:{background:Me.f.blueWithAlpha(.15),boxShadow:"inset 0 0 0 2px ".concat(Me.f.blue)},inputError:{background:Me.f.redWithAlpha(.15),boxShadow:"inset 0 0 0 2px ".concat(Me.f.red)},placeholder:{color:this.theme.lightTextColor}}}}var Le=Object(x.g)(Re),Ue=n(766),_e=n.n(Ue),We=n(151),Ne=n(69),ze=n(83),Ve=n(172),qe=n(1464);function He(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?He(Object(n),!0).forEach((function(t){Ye(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):He(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Qe extends T.a{constructor(){super(...arguments),this.renderMonthControl=e=>{const{device:t}=this.environment,n=this.styles;return s.a.createElement("div",{style:n.monthControl},s.a.createElement(We.a,{mobileFeedback:t.isMobile,icon:m.a.chevronLeft,onClick:()=>e.onPreviousClick()}),s.a.createElement(We.a,{mobileFeedback:t.isMobile,icon:m.a.chevronRight,onClick:()=>e.onNextClick()}))},this.handleDayClick=e=>{const{disabled:t,store:n,value:a,validate:r,onUpdate:i}=this.props,s=n.getFocus(),o=Ee.i.toPersistedDate(e);if(t)return;const l="starting"===s?"ending":"starting",c=a[l];if(c&&o.start_date===c.start_date)n.setState(Ge({},n.state,{focus:l}));else{const e=r(s,{value:o});if(i(e.error?e:{value:{[s]:e.value[s]}}),n.setState(Ge({},n.state,{hovered:void 0})),e.error)return;"starting"!==s||a.ending||n.setState(Ge({},n.state,{focus:"ending"}))}},this.handleDayMouseEnter=e=>{const{disabled:t,store:n,value:a}=this.props,r=n.getFocus(),i=Ee.i.toMoment(e);if(!t)if("starting"===r&&a.ending&&!a.starting){Ee.i.toMoment(a.ending).isSameOrAfter(i)&&n.setState(Ge({},n.state,{hovered:e}))}else if("ending"===r&&a.starting&&!a.ending){Ee.i.toMoment(a.starting).isSameOrBefore(i)&&n.setState(Ge({},n.state,{hovered:e}))}},this.handleMonthChange=e=>{const{store:t}=this.props;t.setState(Ge({},t.state,{displayMonth:Object(Ne.a)(e)}))},this.styles={dayPickerWrapper:{display:"block"},monthControl:{position:"absolute",top:0,right:0,display:"flex"},selectedRange:{backgroundColor:Me.f.blueWithAlpha(.15)},active:{backgroundColor:Me.f.blue,color:Me.f.white},inactive:{backgroundColor:Me.f.blueWithAlpha(.5)},disabled:{pointerEvents:"none"},today:{fontWeight:I.a.fontWeight.regular}}}renderComponent(){const e=this.styles,t=this.getDisplayMonth();return s.a.createElement(_e.a,{className:"notion-calendar-picker",containerProps:{style:e.dayPickerWrapper},initialMonth:t,month:t,numberOfMonths:1,firstDayOfWeek:this.getFirstDayOfWeek(),locale:Ve.a,localeUtils:qe.a,showOutsideDays:!0,fixedWeeks:!0,navbarElement:this.renderMonthControl,onDayClick:this.handleDayClick,onDayMouseEnter:this.handleDayMouseEnter,onMonthChange:this.handleMonthChange,modifiers:this.getModifiers(),modifiersStyles:this.getModifiersStyles()})}getCurrentDate(){if(!this.currentDate){const e=Ee.nb(Ee.m);this.currentDate=Ee.i.toNative(e)}return this.currentDate}getDisplayMonth(){const{value:e,store:t}=this.props;if(t.state.displayMonth)return t.state.displayMonth.toDate();if("starting"===t.getFocus()){if(e.starting)return Ee.i.toNative(e.starting);if(e.ending)return Ee.i.toNative(e.ending)}if("ending"===t.getFocus()){if(e.ending)return Ee.i.toNative(e.ending);if(e.starting)return Ee.i.toNative(e.starting)}return this.getCurrentDate()}getFirstDayOfWeek(){return ze.q.state}getModifiers(){const{store:e,disabled:t,value:n}=this.props,a=this.getDisabledModifier(),{hovered:r}=e.state;if(t)return{disabled:a};if(n.starting&&n.ending){const e=Ee.i.toNative(n.starting),t=Ee.i.toNative(n.ending);return{range:{from:e,to:t},start:e,end:t,disabled:a}}if(n.starting){const e=Ee.i.toNative(n.starting);return{range:r&&{from:e,to:r},start:e,end:r,disabled:a,selected:[e,r]}}if(n.ending){const e=Ee.i.toNative(n.ending);return{range:r&&{from:r,to:e},start:r,end:e,disabled:a,selected:[e,r]}}}getDisabledModifier(){const{value:e,disabled:t,store:n}=this.props;if(t)return e=>!0;const a=e=>"ending"===n.getFocus()?{before:e}:void 0,r=e=>"starting"===n.getFocus()?{after:e}:void 0;if(e.starting&&e.ending){const t=Ee.i.toNative(e.starting),n=Ee.i.toNative(e.ending);return a(t)||r(n)}if(e.starting){return a(Ee.i.toNative(e.starting))}if(e.ending){return r(Ee.i.toNative(e.ending))}}getModifiersStyles(){const{store:e}=this.props,t=this.styles,n=this.getThemeColors(),a=e.getFocus(),r=t.selectedRange,i=Ge({},t.disabled,{},n.disabled),s=Ge({},t.today,{},n.today);return{range:r,start:"starting"===a?t.active:t.inactive,end:"ending"===a?t.active:t.inactive,disabled:i,today:s}}getThemeColors(){return{disabled:{color:this.theme.lightTextColor},today:{color:Me.f.white}}}}var Ke=Qe,Ze=n(6),Xe=n(94);function $e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(n),!0).forEach((function(t){et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function et(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const tt=Object(x.f)({startingMessage:{defaultMessage:"Starting",id:"search.dateRangeMenu.startingMessage"},endingMessage:{defaultMessage:"Ending",id:"search.dateRangeMenu.endingMessage"}});class nt extends T.a{constructor(){super(...arguments),this.renderInputs=()=>{const{value:e,store:t,disabled:n}=this.props,a=t.getFocus(),r=this.getRangeBounds();return s.a.createElement(s.a.Fragment,null,s.a.createElement(Le,{disabled:n,placeholder:Ze.a.formatMessage(tt.startingMessage),focused:"starting"===a,value:e.starting,validate:this.validateStart,onUpdate:this.handleUpdateStart,onFocus:()=>this.handleFocus("starting"),onSubmit:this.handleStartSubmit,inputElementAttributes:{max:r.latestValidStarting},inputOuterStyle:this.styles.firstDateInput}),s.a.createElement(Le,{disabled:n,placeholder:Ze.a.formatMessage(tt.endingMessage),focused:"ending"===a,value:e.ending,validate:this.validateEnd,onUpdate:this.handleUpdateEnd,onFocus:()=>this.handleFocus("ending"),onSubmit:this.handleEndSubmit,inputElementAttributes:{min:r.earliestValidEnding}}))},this.renderCalendar=()=>{const{device:e}=this.environment,{value:t,store:n,onUpdate:a}=this.props,r=this.styles,i=this.getThemeColors(),o=Je({},r.pickerSection,{},e.isMobile&&r.pickerSectionMobile,{},e.isMobile&&i.pickerSectionMobile);return s.a.createElement(ue.a,null,s.a.createElement("div",{style:o},s.a.createElement(Ke,{value:t,store:n,onUpdate:a,validate:this.validateField})))},this.handleFocus=e=>{const{store:t}=this.props;t.setState(Je({},t.state,{focus:e}))},this.handleUpdateStart=e=>{const{onUpdate:t}=this.props;e.error||t({value:{starting:e.value}})},this.handleUpdateEnd=e=>{const{onUpdate:t}=this.props;e.error||t({value:{ending:e.value}})},this.handleStartSubmit=(e,t)=>{const{store:n}=this.props;t&&t.error||n.setState(Je({},n.state,{focus:"ending"}))},this.handleEndSubmit=(e,t)=>{const{onDismiss:n}=this.props;t&&t.error||n&&n(e)},this.validateStart=e=>{const t=this.validateField("starting",e);return t.error?t:{value:t.value.starting}},this.validateEnd=e=>{const t=this.validateField("ending",e);return t.error?t:{value:t.value.ending}},this.validateField=(e,t)=>{const{value:n}=this.props;return t.error?t:this.validateRange(Je({},n,{[e]:t.value}))},this.validateRange=e=>{if(e.starting&&e.ending){const t=Ee.i.toMoment(e.starting);return Ee.i.toMoment(e.ending).isSameOrAfter(t)?{value:e}:{error:we}}return{value:e}},this.getMenuProps=()=>{const{device:e}=this.environment,{onDismiss:t,title:n}=this.props;if(e.isMobile){return{menuType:f.b.MenuType.Modal,title:n,right:s.a.createElement(Xe.DoneMenuText,null),onClickRight:t,header:this.renderInputs()}}return{menuType:f.b.MenuType.Popup,onClickOutside:t}},this.styles={pickerSection:{paddingLeft:16,paddingRight:16},pickerSectionMobile:{paddingTop:16,paddingBottom:8},firstDateInput:{marginTop:2}}}renderComponent(){const{device:e}=this.environment;return s.a.createElement(f.b,Object.assign({},this.getMenuProps()),!e.isMobile&&this.renderInputs(),this.renderCalendar())}getRangeBounds(){const{value:e,intl:t}=this.props;return{earliestValidEnding:e.starting&&P.c(e.starting,t,Ee.ib),latestValidStarting:e.ending&&P.c(e.ending,t,Ee.ib)}}getThemeColors(){return{pickerSectionMobile:{background:this.theme.popoverBackground,boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor),marginBottom:1}}}}var at=Object(x.g)(nt),rt=n(103);function it(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ot extends T.a{constructor(){super(...arguments),this.styles={removeFilterButton:{height:void 0,width:void 0},removeFilterButtonMobile:{marginRight:-12,marginTop:-12,marginBottom:-12,paddingRight:12,paddingTop:12,paddingBottom:12}}}renderComponent(){const{onClick:e,disabled:t}=this.props,n=this.styles,{device:a}=this.environment,r=a.isMobile?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?it(Object(n),!0).forEach((function(t){st(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):it(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n.removeFilterButton,{},n.removeFilterButtonMobile):n.removeFilterButton;return s.a.createElement(We.a,{icon:m.a.clearInput,onClick:e,disabled:t,disableBackground:!0,style:r})}}var lt=ot,ct=n(45);class dt extends Ce.a{getInitialState(){return{isOpen:!1,focus:"starting",temporary:{},displayMonth:void 0,hovered:void 0}}getFocus(){return this.state.focus}}var ut=dt,pt=n(256);function mt(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class ht extends T.a{constructor(){super(...arguments),this.styles={menuItem:{background:void 0,minHeight:void 0,fontSize:this.environment.device.isMobile?I.a.fontSize.UISmall.mobile:I.a.fontSize.UIRegular.desktop,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginTop:0},rightWrapper:{display:"flex",alignItems:"center",marginTop:"-50%",marginBottom:"-50%",height:44}}}renderComponent(){const e=this.props,{disabled:t,label:n,title:a,onClick:r,isToggle:i}=e,o=mt(e,["disabled","label","title","onClick","isToggle"]),l=this.getThemeColors(),c=this.styles,d=s.a.createElement("span",{style:l.menuItemLabel},n);return s.a.createElement(O.a,Object.assign({focused:!1},o,{inline:i,disabled:t,icon:d,title:a,right:this.renderRight(),onClick:r,dontShrinkIcon:!0,dontShrinkRight:!0,shouldWrapTitle:!0,style:c.menuItem,desktopIconStyle:c.menuItemLabel}))}renderRight(){const{disabled:e}=this.props,t=this.styles.rightWrapper;return this.props.isToggle?s.a.createElement("div",{style:t},s.a.createElement(pt.a,{on:this.props.isToggleActive,onClick:this.props.onClick})):s.a.createElement(lt,{disabled:e,onClick:this.props.onClickClear})}getThemeColors(){return{menuItemLabel:{color:this.theme.lightTextColor}}}}var gt,bt=ht,ft=n(1220),yt=n(50),St=n(506),vt=n(73);function Et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.Token="token",e.Text="text"}(gt||(gt={}));class Ct extends T.a{constructor(){super(...arguments),this.storeTypes={requestStore:W.a,menuListStore:S.a},this.renderRequest=(e,t,n)=>{const{labelText:a,value:r}=this.props,{menuListStore:i}=this.stores,o=e=>s.a.createElement(ue.a,Object.assign({},e,{title:a.resultSectionTitle,loading:!n}));if(e)return yt.c({level:"error",from:a.componentDebugName,type:"requestFailed",error:Object(vt.a)(e),data:{miscDataToConvertToString:{query:r}}}),s.a.createElement(o,null,s.a.createElement(b.a,{title:s.a.createElement(x.a,{defaultMessage:"Something went wrong.",id:"search.inputMenu.errorMessage"})}));if(!t)return s.a.createElement(o,null,s.a.createElement(b.a,{title:s.a.createElement(x.a,{defaultMessage:"Loading…",id:"search.inputMenu.loading.message"})}));if(t&&0===t.length)return s.a.createElement(o,null,s.a.createElement(b.a,{title:s.a.createElement(x.a,{defaultMessage:"No results found.",id:"search.inputMenu.noResults.message"})}));const l={key:"results",items:t.map(this.getResultMenuItem),render:o};return s.a.createElement(y.a,{type:y.a.Type.Vertical,store:i,initialFocus:0,sections:[l]})},this.handleMenuInputRemoveLast=()=>{if(this.props.inputType!==gt.Token)return;const{items:e,onRemove:t}=this.props,n=r.a.last(e);n&&t(n)},this.getResultMenuItem=e=>{const{renderResultMenuItem:t,onConfirm:n}=this.props;return{key:e,action:()=>n(e),render:n=>t(e,n)}},this.styles={input:{borderBottomLeftRadius:0,borderBottomRightRadius:0,boxShadow:this.theme.borderBoxShadow},menu:{width:250,maxHeight:"40vh"}}}renderComponent(){const{value:e,items:t,performRequest:n}=this.props,{requestStore:a}=this.stores,r={query:e,current:t};return s.a.createElement(f.b,Object.assign({},this.getMenuProps()),s.a.createElement(_.a,{debounce:100,requestStore:a,request:r,performRequest:n,render:this.renderRequest}))}renderSearchInput(){return this.props.inputType===gt.Token?this.renderTokenInput(this.props):this.props.inputType===gt.Text?this.renderTextInput(this.props):void Object(q.e)(this.props)}renderTokenInput(e){const{labelText:t,value:n,items:a,disabled:r,onChange:i,renderToken:o,onRemove:l}=e,c=a.map(e=>o(e,{onRemove:()=>l(e)}));return s.a.createElement(St.a,{format:St.a.Format.Group,focus:!this.isMobile()||void 0,focusInitial:this.isMobile(),focusAfterAnimation:!0,placeholder:t.tokenInputPlaceholder,value:n,tokens:c,disabled:Boolean(r),onChange:i,onRemoveLastToken:this.handleMenuInputRemoveLast})}renderTextInput(e){const{labelText:t,value:n,disabled:a,onChange:r,onClear:i}=e,o=this.styles,l=this.isMobile()?Ie.a:Te.b;return s.a.createElement(l,{format:Te.b.Format.Large,disabled:a,showClearButton:!0,placeholder:t.tokenInputPlaceholder,value:n,onChange:r,onClearButtonClick:i,focus:!this.isMobile()||void 0,focusInitial:this.isMobile(),focusAfterAnimation:!0,style:this.isMobile()?void 0:o.input})}getMenuProps(){const{onDismiss:e,labelText:t}=this.props,n=this.styles;if(this.isMobile()){return{menuType:f.b.MenuType.Modal,title:t.title,right:s.a.createElement(Xe.DoneMenuText,null),onClickRight:e,header:this.renderSearchInput()}}return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Et(Object(n),!0).forEach((function(t){Mt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({menuType:f.b.MenuType.Popup,onClickOutside:e,header:this.renderSearchInput()},n.menu)}isMobile(){const{device:e}=this.environment;return e.isMobile}}Ct.InputType=gt;var Ot=Ct;class wt extends Ce.a{getInitialState(){return{isMenuOpen:!1,inputTemporaryValue:"",indexToReplace:void 0,popupOriginRect:void 0}}}var kt,Pt=wt;function Tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function It(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tt(Object(n),!0).forEach((function(t){jt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function jt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.Button="Button",e.Section="Section"}(kt||(kt={}));class Dt extends T.a{constructor(){super(...arguments),this.origin=s.a.createRef(),this.storeTypes={componentStore:Pt},this.renderMobileFilterSummary=e=>{const{title:t,items:n,renderItemForSummary:a}=this.props,{disableFilters:r}=e,i=this.styles,o=It({},H,{},i.summary),l=n.length-1,c=s.a.createElement("ul",{style:o},n.map((e,t)=>s.a.createElement("li",{key:e,style:i.summaryItem},s.a.createElement(s.a.Fragment,null,a(e),t!==l&&","," "))));return s.a.createElement(bt,{disabled:r,onClick:this.handleMenuOpenMobile,onClickClear:this.clearItems,label:t,title:c})},this.renderMenu=()=>{const{renderToken:e}=this.props,{componentStore:{state:t}}=this.stores,n={inputType:Ot.InputType.Token,onRemove:this.handleFilterRemove,renderToken:e},a={inputType:Ot.InputType.Text},r=this.getMenuType()===Ot.InputType.Token?n:a;return s.a.createElement(Ot,Object.assign({},this.props,{value:t.inputTemporaryValue,onChange:this.handleMenuInputChange,onDismiss:this.handleMenuClose,onConfirm:this.handleItemConfirm,onClear:this.handleClearTemporary},r))},this.handleMenuOpen=e=>{this.scheduleMeasurement(void 0,t=>It({},t,{isMenuOpen:!0,indexToReplace:e}))},this.handleMenuOpenMobile=()=>{const{componentStore:e}=this.stores;e.setState(It({},e.state,{isMenuOpen:!0}))},this.handleMenuClose=()=>{const{onMenuDismiss:e}=this.props,{componentStore:t}=this.stores;t.setState(It({},t.state,{isMenuOpen:!1,indexToReplace:void 0})),e&&e()},this.handleClearTemporary=()=>{const{componentStore:e}=this.stores;e.setState(It({},e.state,{inputTemporaryValue:""}))},this.handleItemConfirm=e=>{const{items:t}=this.props,{componentStore:n}=this.stores,{indexToReplace:a}=n.state;"number"==typeof a&&a<t.length?this.replaceItem(a,e):this.addItem(e),this.clearInput(),this.getMenuType()===Ot.InputType.Text&&this.handleMenuClose()},this.handleFilterRemove=e=>{this.removeItem(e)},this.handleMenuInputChange=e=>{const{componentStore:t}=this.stores,{target:n}=e;t.setState(It({},t.state,{inputTemporaryValue:String(n.value)}))},this.scheduleMeasurement=(e,t)=>{this.animationFrame=requestAnimationFrame(this.measureOriginRect(t))},this.measureOriginRect=e=>t=>{const{componentStore:n}=this.stores;if(!this.origin)return;if(!this.origin.current)return;const a=e?e(n.state):n.state;n.setState(It({},a,{popupOriginRect:this.origin.current.getBoundingClientRect()}))},this.isMenuOpen=()=>{const{componentStore:{state:e}}=this.stores;return e.isMenuOpen},this.removeItem=e=>{const{items:t,onChange:n}=this.props;n(t.filter(t=>t!==e))},this.clearItems=()=>{const{onChange:e}=this.props;e([])},this.replaceItem=(e,t)=>{const{items:n,onChange:a}=this.props;a(n.slice(0,e).concat(t,n.slice(e+1)))},this.clearInput=()=>{const{componentStore:e}=this.stores;e.setState(It({},e.state,{inputTemporaryValue:"",indexToReplace:void 0}))},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},appendListItemButton:{minHeight:void 0,paddingTop:4,paddingBottom:4,fontSize:G(this.environment,"UIRegular")},icon:{height:14,width:14,fill:"currentColor"},iconSmall:{height:12,width:12},summary:{display:"inline"},summaryItem:{display:"inline"}}}didMount(){window.addEventListener("resize",this.scheduleMeasurement)}willUnmount(){window.removeEventListener("resize",this.scheduleMeasurement),this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0)}didUpdate(e){(e.items.length!==this.props.items.length||e.mode!==this.props.mode)&&this.scheduleMeasurement()}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const{title:t,disabled:n}=this.props,{componentStore:{state:a}}=this.stores,r=n||a.isMenuOpen,i=e===Dt.Mode.Section,o=i?t:void 0,l=i?this.renderSectionOrigin():this.renderButtonOrigin();return s.a.createElement(ft.a,{title:o,marginAfter:i},this.renderFilters({disableFilters:r,showLabel:!1}),l,s.a.createElement(ct.c,{popupType:ct.c.PopupType.Popup,placementToOrigin:ct.c.Placement.Bottom,alignmentToOrigin:ct.c.Alignment.Start,open:this.isMenuOpen(),originRect:a.popupOriginRect,render:this.renderMenu,onDismiss:this.handleMenuClose,keepFocus:!0,preventScaleTransition:!0}))}renderButtonOrigin(){const{icon:e,title:t,disabled:n,focused:a}=this.props,r=this.styles,i=this.getThemeColors(),o=It({},r.menuItem,{},i.buttonMenuItem);return s.a.createElement("div",{ref:this.origin},s.a.createElement(O.a,{disabled:n||this.isMenuOpen(),icon:e(r.icon),title:t,focused:a,onClick:e=>this.handleMenuOpen(),style:o}))}renderSectionOrigin(){const{addItemLabel:e,disabled:t}=this.props,n=this.styles,a=this.getThemeColors();return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{ref:this.origin}),s.a.createElement(O.a,{disabled:t||this.isMenuOpen(),icon:m.a.plus(n.iconSmall),title:e,focused:!1,onClick:e=>this.handleMenuOpen(),style:It({},n.appendListItemButton,{},a.appendListItemButton)}))}renderMobile(e){const{disabled:t}=this.props,n=t||this.isMenuOpen(),a=e===Dt.Mode.Section?this.renderMobileFilterSummary({disableFilters:n}):this.renderMobileButtonOrigin({disableFilters:n});return s.a.createElement(ct.c,{popupType:ct.c.PopupType.SlideUp,open:this.isMenuOpen(),origin:a,render:this.renderMenu,onDismiss:this.handleMenuClose,keepFocus:!0})}renderMobileButtonOrigin(e){const{icon:t,title:n}=this.props,a=this.styles;return s.a.createElement(O.a,{disabled:e.disableFilters,focused:!1,icon:t(a.icon),title:n,onClick:e=>this.handleMenuOpenMobile()})}renderFilters(e){const{items:t,renderFilter:n}=this.props,{device:a}=this.environment,r=t.map((t,r)=>s.a.createElement("li",{key:"".concat(t,"_").concat(r)},n(t,{disabled:e.disableFilters,onRemove:()=>this.handleFilterRemove(t),onClick:()=>a.isMobile?this.handleMenuOpenMobile():this.handleMenuOpen(r)})));return s.a.createElement("ul",{style:H},r)}getMenuType(){const{device:e}=this.environment;return e.isMobile?Ot.InputType.Token:Ot.InputType.Text}addItem(e){const{items:t,onChange:n}=this.props,a=t.concat(e);n(r.a.uniq(a))}getThemeColors(){return{buttonMenuItem:{color:this.theme.mediumTextColor},appendListItemButton:{color:this.theme.lightTextColor}}}}Dt.Mode=kt;var xt=Dt;function Bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function At(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bt(Object(n),!0).forEach((function(t){Ft(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ft(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Rt extends T.a{constructor(){super(...arguments),this.storeTypes={store:ut},this.renderActiveButtonOrigin=()=>{const{value:e,dateFormat:t,disabled:n,focused:a,intl:r}=this.props,i=this.styles,o=this.getThemeColors(),l=At({},i.menuItem,{},o.activeMenuItem),c=P.d(e,r,t),d=s.a.createElement(lt,{onClick:this.handleClear,disabled:n});return s.a.createElement(O.a,{focused:a,disabled:n,icon:m.a.calendar(i.iconActiveDesktop),title:c,right:d,isTokenTitle:!0,alignIconTop:!0,onClick:this.handleOriginActivate,desktopTitleStyle:i.menuItemTitleDesktop,desktopIconStyle:i.iconActiveDesktopWrapper,style:l})},this.renderInactiveButtonOrigin=()=>{const{title:e,icon:t,disabled:n,focused:a}=this.props,r=this.styles,i=this.getThemeColors(),o=At({},r.menuItem,{},i.buttonMenuItem);return s.a.createElement(O.a,{focused:a,disabled:n,icon:t(r.icon),title:e,onClick:this.handleOriginActivate,style:o})},this.renderPopupContents=()=>{const{title:e}=this.props,{store:t}=this.stores;return s.a.createElement(at,{title:e,value:this.getCurrentValue(),onUpdate:this.updateTemporary,store:t,onDismiss:this.handleMenuClose})},this.handleOriginActivate=()=>{const{disabled:e}=this.props,{store:t}=this.stores;e||t.setState(At({},t.state,{isOpen:!0,focus:"starting"}))},this.handleMenuClose=e=>{const{onChange:t,onMenuDismiss:n}=this.props,{store:a}=this.stores,{temporary:r}=a.state;P.a(e)||(t(r),a.setState(At({},a.state,{isOpen:!1,temporary:{}})),n&&n())},this.handleClear=()=>{const{onChange:e}=this.props;e({starting:void 0,ending:void 0})},this.handleMenuListKey=e=>{e.preventDefault&&e.preventDefault()},this.updateTemporary=e=>{const{store:t}=this.stores;if(!e.error)return t.setState(At({},t.state,{temporary:At({},t.state.temporary,{},e.value)}))},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"},iconActiveDesktop:{height:14,width:14,fill:"currentColor",alignSelf:"flex-start",marginTop:2,marginRight:2},iconActiveDesktopWrapper:{marginTop:0},iconActiveMobile:{height:14,width:14,fill:"currentColor",marginTop:1,marginRight:6},popup:{paddingTop:12,paddingBottom:8},menuItemTitleDesktop:{width:"100%"},summary:{display:"inline-flex"}}}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const{title:t}=this.props,{store:n}=this.stores,a=this.styles,r=e===kt.Section,i=r?t:void 0,o=r?this.renderActiveButtonOrigin():this.renderInactiveButtonOrigin();return s.a.createElement(ft.a,{title:i,marginAfter:r},s.a.createElement(rt.a,{capture:n.state.isOpen,onUp:this.handleMenuListKey,onDown:this.handleMenuListKey,onEnter:this.handleMenuListKey},s.a.createElement(ct.c,{popupType:this.getPopupType(),open:n.state.isOpen,origin:o,render:this.renderPopupContents,onDismiss:this.handleMenuClose,placementToOrigin:ct.c.Placement.Bottom,alignmentToOrigin:ct.c.Alignment.Start,keepFocus:!0,style:a.popup})))}renderMobile(e){const{store:t}=this.stores,n=e===kt.Section?this.renderMobileFilterSummary():this.renderMobileButtonOrigin();return s.a.createElement(ct.c,{popupType:ct.c.PopupType.SlideUp,open:t.state.isOpen,origin:n,render:this.renderPopupContents,onDismiss:this.handleMenuClose,preventScaleTransition:!0})}renderMobileButtonOrigin(){const{icon:e,title:t,disabled:n}=this.props,a=this.styles;return s.a.createElement(O.a,{disabled:n,focused:!1,icon:e(a.icon),title:t,onClick:this.handleOriginActivate})}renderMobileFilterSummary(){const{title:e,value:t,dateFormat:n,disabled:a,intl:r}=this.props,i=this.styles,o=s.a.createElement("div",{style:i.summary},m.a.calendar(i.iconActiveMobile),P.d(t,r,n));return s.a.createElement(bt,{disabled:a,onClick:this.handleOriginActivate,onClickClear:this.handleClear,label:e,title:o})}getCurrentValue(){const{value:e}=this.props,{store:t}=this.stores,{temporary:n}=t.state;return At({},e,{},n)}getPopupType(){const{device:e}=this.environment;return e.isMobile?Se.a.PopupType.SlideUp:Se.a.PopupType.Popup}getThemeColors(){return{buttonMenuItem:{color:this.theme.mediumTextColor},activeMenuItem:{color:this.theme.regularTextColor}}}}var Lt,Ut=Object(x.g)(Rt),_t=n(34);function Wt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wt(Object(n),!0).forEach((function(t){zt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Button=0]="Button",e[e.MenuItem=1]="MenuItem"}(Lt||(Lt={}));class Vt extends T.a{constructor(){super(...arguments),this.handleFilterClick=e=>{const{onMenuDismiss:t}=this.props;this.applyFilter(e),this.openSidebar(),t&&t()},this.applyFilter=e=>{const{searchStore:t}=this.props;t.updateFilters(e)},this.openSidebar=()=>{const{searchStore:e}=this.props;e.isSidebarOpen()||e.setState(Nt({},e.state,{isSidebarOpen:!0}))},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},buttonFilter:{padding:"4px 8px",display:"flex",alignItems:"center",overflow:"hidden"},buttonText:Nt({},I.a.textOverflowStyle),icon:{display:"inline-block",height:14,width:14,fill:"currentColor"},buttonIcon:{marginRight:6}}}renderComponent(){const{mode:e}=this.props;return e===Lt.Button?this.renderAsButton():e===Lt.MenuItem?this.renderAsMenuItem():void Object(q.e)(e)}renderAsButton(){const{icon:e,title:t,filter:n}=this.props,a=this.styles,r=this.getThemeColors();return s.a.createElement(_t.a,{style:Nt({},a.buttonFilter,{},r.buttonFilter),onClick:()=>this.handleFilterClick(n)},e&&e(Nt({},a.icon,{},a.buttonIcon)),s.a.createElement("span",{style:a.buttonText},t))}renderAsMenuItem(){const{icon:e,title:t,filter:n,focused:a}=this.props,r=this.styles,i=this.getThemeColors(),o=Nt({},r.menuItem,{},i.menuItem);return s.a.createElement(O.a,{icon:e&&e(r.icon),focused:a,title:t,onClick:()=>this.handleFilterClick(n),style:o})}getThemeColors(){const{device:e}=this.environment;return{menuItem:Nt({color:e.isDesktop?this.theme.mediumTextColor:void 0},this.props.isLastInSection&&{boxShadow:void 0}),buttonFilter:{color:this.theme.mediumTextColor}}}}Vt.Mode=Lt;class qt extends T.a{renderComponent(){const e=qt.getCurrentPageFilter();if(e)return s.a.createElement(Vt,Object.assign({icon:m.a.searchInPage,title:s.a.createElement(x.a,{id:"search.filterMenu.quickFilters.inCurrentPage",defaultMessage:"In current page"}),filter:e},this.props))}static isActive(e){const t=qt.getCurrentPageFilter();if(!t)return!1;if(!t.ancestors)return!1;const n=t.ancestors[0];return-1!==e.ancestors.indexOf(n)}}qt.getCurrentPageFilter=()=>{const{currentBlockStore:e}=c.a.state;if(e&&e.id)return{ancestors:[e.id]}};class Ht extends T.a{renderComponent(){const e=Ht.getCurrentUserFilter(this.environment);if(e)return s.a.createElement(Vt,Object.assign({icon:m.a.person,title:s.a.createElement(x.a,{id:"search.filterMenu.quickFilters.createdByMe",defaultMessage:"Created by me"}),filter:e},this.props))}static isActive(e,t){const n=Ht.getCurrentUserFilter(e);if(!n)return!1;if(!n.createdBy)return!1;const a=n.createdBy[0];return-1!==t.createdBy.indexOf(a)}}Ht.getCurrentUserFilter=e=>{const{id:t}=e.currentUser;if(t)return{createdBy:[t]}};class Gt extends T.a{renderComponent(){const e=Gt.getPastWeekFilter();if(e)return s.a.createElement(Vt,Object.assign({icon:m.a.calendar,title:s.a.createElement(x.a,{id:"search.filterMenu.quickFilters.editedLastWeek",defaultMessage:"Edited last week"}),filter:e},this.props))}static isActive(e){const{lastEditedTime:t}=Gt.getPastWeekFilter();return r.a.isEqual(t,e.lastEditedTime)}}Gt.getPastWeekFilter=()=>({lastEditedTime:{starting:Ee.bb(Ee.m),ending:Ee.nb(Ee.m)}});var Yt=n(287),Qt=n(146),Kt=n(90);const Zt=Object(x.f)({searchPages:{defaultMessage:"Search pages",id:"searchPageFilter.searchTokenFilter.tokenInput.placeholder"},selectAPage:{defaultMessage:"Select a page",id:"searchPageFilter.searchTokenFilter.resultSection.title"}});class Xt extends T.a{constructor(){super(...arguments),this.renderFilterListItem=(e,t)=>{let{disabled:n,onRemove:a,onClick:r}=t;const i=this.styles,o=this.createBlockStore(e),l=s.a.createElement(lt,{disabled:n,onClick:a});return s.a.createElement(Yt.a,{disabled:n,focused:!1,store:o,right:l,style:i.menuItem,desktopTitleStyle:i.menuItemTitle,onClick:r})},this.renderItemForSummary=e=>s.a.createElement(k.a,{store:this.createBlockStore(e),shouldWrap:!0,maxLength:50}),this.renderToken=(e,t)=>{const{blockIds:n}=this.props,a=this.tokenStyles,r=1===n.length,i=this.createBlockStore(e),o=s.a.createElement("div",{style:a.token},s.a.createElement(Kt.a,{disabled:!0,icon:i.getIcon(),isEmptyPage:!1,size:20,style:a.icon}),s.a.createElement(k.a,{store:i}));return s.a.createElement(Qt.b,{key:e,format:Qt.b.Format.Large,value:o,showRemoveButton:!0,onClickRemove:t.onRemove,isSingle:r,shouldShrink:!0})},this.renderResultMenuItem=(e,t)=>{const n=this.createBlockStore(e);return s.a.createElement(Yt.a,Object.assign({},t,{key:e,store:n}))},this.performRequest=async e=>{let{query:t,current:n}=e;const{currentSpaceStore:a}=c.a.state;if(!a)return[];const{results:r}=await l.f({environment:this.environment,query:t,limit:20,spaceId:a.id,requireEditPermissions:!1,excludeTemplates:!1,source:"quick_find_ancestor_filter"}),i=new Set(n);return r.filter(e=>!i.has(e))},this.createBlockStore=e=>{const{parentStore:t}=this.props;return d.a.createChildStore(t,{table:u.a,id:e})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:4}},this.tokenStyles={token:{display:"flex",alignItems:"center"},icon:{marginRight:4}}}renderComponent(){const{mode:e,title:t,blockIds:n,onChange:a,disabled:r,focused:i,onMenuDismiss:o}=this.props;return s.a.createElement(xt,{mode:e,title:t,icon:m.a.searchInPage,items:n,onChange:a,focused:i,renderFilter:this.renderFilterListItem,renderToken:this.renderToken,renderItemForSummary:this.renderItemForSummary,addItemLabel:s.a.createElement(x.a,{defaultMessage:"Add a page",id:"searchPageFilter.searchTokenFilter.addAPage.button"}),labelText:{title:t,tokenInputPlaceholder:Ze.a.formatMessage(Zt.searchPages),resultSectionTitle:Ze.a.formatMessage(Zt.selectAPage),componentDebugName:"SearchPageFilter"},performRequest:this.performRequest,renderResultMenuItem:this.renderResultMenuItem,disabled:r,onMenuDismiss:o})}}var $t=Xt,Jt=n(208),en=n(589),tn=n(96);class nn extends T.a{constructor(){super(...arguments),this.renderFilterListItem=(e,t)=>{let{disabled:n,onRemove:a,onClick:r}=t;const i=this.styles,o=this.getUserValue(e),l=s.a.createElement(lt,{disabled:n,onClick:a});return s.a.createElement(en.a,{key:e,disabled:n,focused:!1,user:o,right:l,style:i.menuItem,desktopTitleStyle:i.menuItemTitle,onClick:r})},this.renderItemForSummary=e=>Object(D.d)(this.getUserValue(e)),this.renderToken=(e,t)=>{const{userIds:n}=this.props,a=1===n.length,r=this.getUserValue(e);if(r)return s.a.createElement(Jt.c,{key:e,format:Jt.c.Format.Large,showRemoveButton:!0,isSingle:a,onClickRemove:t.onRemove,actor:Object(tn.i)(r)})},this.renderResultMenuItem=(e,t)=>{const n=this.getUserValue(e);return s.a.createElement(en.a,Object.assign({},t,{key:e,user:n}))},this.performRequest=async e=>{let{query:t,current:n}=e;const a=new Set(n);return(await l.l({environment:this.environment,query:t,membersOnly:!1})).filter(e=>!a.has(e.id)).slice(0,20).map(e=>e.id)},this.getUserValue=e=>this.createUserStore(e).getValue(),this.createUserStore=e=>{const{parentStore:t}=this.props;return j.a.createChildStore(t,{table:D.a,id:e})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:4}}}renderComponent(){const{mode:e,title:t,userIds:n,onChange:a,disabled:r,focused:i,onMenuDismiss:o,intl:l}=this.props;return s.a.createElement(xt,{mode:e,title:t,icon:m.a.person,items:n,onChange:a,disabled:r,focused:i,renderFilter:this.renderFilterListItem,renderToken:this.renderToken,renderItemForSummary:this.renderItemForSummary,addItemLabel:s.a.createElement(x.a,{defaultMessage:"Add a person",id:"search.filterMenu.addAPersonButton.label"}),labelText:{title:t,tokenInputPlaceholder:l.formatMessage({defaultMessage:"Search people",id:"search.filterMenu.searchPeople.placeholder"}),resultSectionTitle:l.formatMessage({defaultMessage:"Select a person",id:"search.filterMenu.searchPeople.resultsTitle"}),componentDebugName:"SearchPersonFilter"},performRequest:this.performRequest,renderResultMenuItem:this.renderResultMenuItem,onMenuDismiss:o})}}var an=Object(x.g)(nn);function rn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function sn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class on extends T.a{renderComponent(){return s.a.createElement(V.a,Object.assign({},this.props,{right:s.a.createElement(pt.a,Object.assign({},this.props)),dontShrinkRight:!0}))}}on.contextTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rn(Object(n),!0).forEach((function(t){sn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},f.c);var ln=on;function cn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function dn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function un(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class pn extends T.a{constructor(){super(...arguments),this.handleToggle=()=>{const{value:e,onChange:t}=this.props;t(!e)},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"}}}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const t=e===kt.Section;return s.a.createElement(ft.a,{marginAfter:t},this.renderSwitcherMenuItem())}renderMobile(e){const{title:t,value:n,disabled:a}=this.props;return e===kt.Button?this.renderSwitcherMenuItem():s.a.createElement(bt,{disabled:a,onClick:this.handleToggle,label:t,isToggle:!0,isToggleActive:n})}renderSwitcherMenuItem(){const e=this.props,{title:t,icon:n,value:a,style:r}=e,i=un(e,["title","icon","value","style"]),o=this.styles,l=this.getThemeColors(),c=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cn(Object(n),!0).forEach((function(t){dn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o.menuItem,{},l.menuItem,{},r);return s.a.createElement(ln,Object.assign({title:t,icon:n(o.icon),on:a,onClick:this.handleToggle,style:c},i))}getThemeColors(){return{menuItem:{color:this.theme.mediumTextColor}}}}pn.Mode=kt;var mn,hn=pn;function gn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function bn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gn(Object(n),!0).forEach((function(t){fn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.Button="Button",e.Section="Section"}(mn||(mn={}));class yn extends T.a{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:ve.a},this.renderAddFilterOrigin=e=>{const t=this.styles;return s.a.createElement(ye.a,Object.assign({},e,{style:t.addFilterButtonMobile,icon:m.a.filterCircled,isBlue:!0}),s.a.createElement(x.a,{defaultMessage:"Add filter",id:"search.addFilter.button.label"}))},this.renderAddFilterMenu=()=>s.a.createElement(f.b,{menuType:f.b.MenuType.ActionSheet},this.renderSuggestedFilters(),s.a.createElement(ft.a,{title:this.renderMoreFiltersTitle()},this.renderCreatedByFilter(xt.Mode.Button),this.renderCreatedTimeFilter(xt.Mode.Button),this.renderLastEditedTimeFilter(xt.Mode.Button),this.renderAncestorFilter(xt.Mode.Button))),this.closeAddFilterMenu=()=>{const{buttonPopupStore:e}=this.stores;e.setState(bn({},e.state,{open:!1}))},this.styles={sidebar:{paddingTop:12,paddingBottom:24,overflowY:"auto",overflowX:"hidden",flex:"0 0 220px",minHeight:400},sidebarHidden:{display:"none"},addFilterButtonMobile:{fontSize:this.props.isMobile?I.a.fontSize.UISmall.mobile:I.a.fontSize.UISmall.desktop,fontWeight:I.a.fontWeight.medium,marginRight:-8}}}renderComponent(){return this.props.isMobile?this.props.mode===mn.Button?this.renderAddButtonMobile():this.props.mode===mn.Section?this.renderActiveFiltersMobile():void Object(q.e)(this.props.mode):this.renderSidebar()}renderActiveFiltersMobile(){const{searchStore:{state:e}}=this.props,t=P.e(e.query.filters);return s.a.createElement(ue.a,{disableMobilePadding:!0,disableMobileBorders:!0},this.renderTitlesOnlyFilter(kt.Section),this.renderActiveFilters(t,xt.Mode.Section))}renderAddButtonMobile(){const{buttonPopupStore:e}=this.stores;return s.a.createElement(Se.a,{popupType:Se.a.PopupType.SlideUp,buttonPopupStore:e,renderOrigin:this.renderAddFilterOrigin,render:this.renderAddFilterMenu})}renderSidebar(){const{searchStore:e,searchStore:{state:t}}=this.props,n=this.styles,a=this.getThemeColors(),r=P.e(t.query.filters),i=bn({},n.sidebar,{},a.sidebar,{},!e.isSidebarOpen()&&n.sidebarHidden);return s.a.createElement("aside",{style:i},this.renderTitlesOnlyFilter(kt.Section),this.renderActiveFilters(r,xt.Mode.Section),this.renderSuggestedFilters(),this.renderInactiveFilters(r))}renderActiveFilters(e,t){return s.a.createElement(s.a.Fragment,null,e.createdBy&&this.renderCreatedByFilter(t),e.createdTime&&this.renderCreatedTimeFilter(t),e.lastEditedTime&&this.renderLastEditedTimeFilter(t),e.ancestors&&this.renderAncestorFilter(t))}renderInactiveFilters(e){if(!(e.ancestors&&e.createdBy&&e.createdTime&&e.lastEditedTime))return s.a.createElement(ft.a,{title:this.renderMoreFiltersTitle(),marginAfter:!0},!e.ancestors&&this.renderAncestorFilter(xt.Mode.Button),!e.createdBy&&this.renderCreatedByFilter(xt.Mode.Button),!e.createdTime&&this.renderCreatedTimeFilter(kt.Button),!e.lastEditedTime&&this.renderLastEditedTimeFilter(kt.Button))}renderSuggestedFilters(){const{searchStore:e}=this.props,{filters:t}=e.state.query,n=Ht.isActive(this.environment,t),a=Gt.isActive(t),r=qt.isActive(t);if(!(n&&a&&r))return s.a.createElement(ft.a,{title:s.a.createElement(x.a,{id:"search.filterMenu.quickFiltersSection.title",defaultMessage:"Quick filters"}),marginAfter:!0},!n&&s.a.createElement(Ht,{mode:Lt.MenuItem,searchStore:e,focused:!1,onMenuDismiss:this.closeAddFilterMenu}),!a&&s.a.createElement(Gt,{mode:Lt.MenuItem,searchStore:e,focused:!1,onMenuDismiss:this.closeAddFilterMenu}),!r&&s.a.createElement(qt,{mode:Lt.MenuItem,searchStore:e,focused:!1,onMenuDismiss:this.closeAddFilterMenu,isLastInSection:!0}))}renderTitlesOnlyFilter(e){const{searchStore:t}=this.props,{filters:n}=t.state.query;return s.a.createElement(hn,{mode:e,focused:!1,title:s.a.createElement(x.a,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Only match titles",description:"Label for only match titles toggle in search modal"}),icon:m.a.typesTitle,value:n.isNavigableOnly,onChange:this.createUpdateFunction("isNavigableOnly")})}renderMoreFiltersTitle(){return s.a.createElement(x.a,{id:"search.filterMenu.moreFiltersSection.title",defaultMessage:"More filters"})}renderAncestorFilter(e){const{searchStore:t,parentStore:n}=this.props,{filters:a}=t.state.query;return s.a.createElement($t,{mode:e,focused:!1,title:s.a.createElement(x.a,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In page"}),parentStore:n,blockIds:a.ancestors,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("ancestors")})}renderCreatedByFilter(e){const{searchStore:t,parentStore:n}=this.props,{filters:a}=t.state.query;return s.a.createElement(an,{mode:e,focused:!1,title:s.a.createElement(x.a,{id:"search.filterMenu.moreFilters.createdBy",defaultMessage:"Created by"}),parentStore:n,userIds:a.createdBy,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("createdBy")})}renderCreatedTimeFilter(e){const{searchStore:t}=this.props,{filters:n}=t.state.query;return s.a.createElement(Ut,{mode:e,focused:!1,title:s.a.createElement(x.a,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"}),icon:m.a.calendar,value:n.createdTime,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("createdTime")})}renderLastEditedTimeFilter(e){const{searchStore:t}=this.props,{filters:n}=t.state.query;return s.a.createElement(Ut,{mode:e,focused:!1,title:s.a.createElement(x.a,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),icon:m.a.calendar,value:n.lastEditedTime,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("lastEditedTime")})}createUpdateFunction(e){const{searchStore:t}=this.props;return n=>t.updateFilters({[e]:n})}getThemeColors(){return{sidebar:{backgroundColor:this.theme.sidebarSecondaryBackground,borderLeft:"1px solid ".concat(this.theme.regularDividerColor)}}}}var Sn=yn,vn=n(1465);function En(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?En(Object(n),!0).forEach((function(t){Cn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):En(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class On extends T.a{constructor(){super(...arguments),this.openSidebar=()=>{const{searchStore:e}=this.props;e.setState(Mn({},e.state,{isSidebarOpen:!0}))},this.styles={menuItem:{minHeight:0},menuItemMobile:{paddingBottom:8},titleWrapper:{flex:void 0},showSidebarButton:()=>{const{device:e}=this.environment;return{padding:"0 4px",fontSize:e.isMobile?I.a.fontSize.UISmall.mobile:I.a.fontSize.UISmall.desktop,fontWeight:I.a.fontWeight.medium,borderRadius:3,height:20,lineHeight:"20px"}}}}renderComponent(){const{device:e}=this.environment,t=this.styles,n=Mn({},t.menuItem,{},e.isMobile&&t.menuItemMobile),a=this.shouldAllowFilters()&&this.renderAddFilterButton();return s.a.createElement(V.a,{title:this.renderSortMenu(),right:a,textWrapperStyle:t.titleWrapper,style:n})}renderSortMenu(){const{searchStore:e}=this.props;return s.a.createElement(vn.a,{currentSortBy:e.state.query.sort,setSortBy:t=>{e.state.mode===de.c.Mode.Default?e.setState(Mn({},e.state,{query:Mn({},e.state.query,{sort:t})})):e.state.mode===de.c.Mode.Results&&e.setState(Mn({},e.state,{query:Mn({},e.state.query,{sort:t})}))},sortOptions:this.sortOptions})}renderAddFilterButton(){const{device:e}=this.environment,{parentStore:t,searchStore:n}=this.props,a=this.styles;return e.isMobile?s.a.createElement(Sn,{parentStore:t,searchStore:n,isMobile:!0,mode:mn.Button}):n.isSidebarOpen()?void 0:s.a.createElement(ye.a,{icon:m.a.filterCircled,onClick:this.openSidebar,style:a.showSidebarButton(),isBlue:!0},s.a.createElement(x.a,{defaultMessage:"Add filter",id:"search.header.addFilter.button.label"}))}shouldAllowFilters(){const{isPublicPageSearch:e}=this.props;return!e}get sortOptions(){return[{key:te.e.Relevance,formattedName:s.a.createElement(x.a,{id:"search.sort.sortOrder.bestMatches",defaultMessage:"Best matches"})},{key:te.e.LastEditedNewest,formattedName:s.a.createElement(x.a,{id:"search.sort.sortOrder.lastEdited.newestFirst",defaultMessage:"Last edited: Newest first"})},{key:te.e.LastEditedOldest,formattedName:s.a.createElement(x.a,{id:"search.sort.sortOrder.lastEdited.oldestFirst",defaultMessage:"Last edited: Oldest first"})},{key:te.e.CreatedNewest,formattedName:s.a.createElement(x.a,{id:"search.sort.sortOrder.created.newestFirst",defaultMessage:"Created: Newest first"})},{key:te.e.CreatedOldest,formattedName:s.a.createElement(x.a,{id:"search.sort.sortOrder.created.oldestFirst",defaultMessage:"Created: Oldest first"})}]}}var wn=On,kn=n(770),Pn=n(4),Tn=n(116);function In(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function jn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?In(Object(n),!0).forEach((function(t){Dn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):In(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Dn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class xn extends T.a{constructor(){super(...arguments),this.renderSpinner=()=>{const{showSpinner:e}=this.props,t=this.styles,n=jn({},this.getThemeColors().searchIcon,{},t.searchIcon());return s.a.createElement(pe.a,{show:e,showDelay:500,showHold:200,render:e=>e?s.a.createElement(ce.a,{style:n}):m.a.searchThick(n)})},this.handleQueryChange=e=>{const{searchStore:t,resultListStore:n}=this.props;this.handleTyping();const a=String(e.target.value);""===a?t.resetQuery({resetFilters:!1}):t.setState(jn({},t.state,{mode:de.c.Mode.Results,query:jn({},t.state.query,{text:a}),limit:de.b,allResultsLoaded:!1})),n.setState(jn({},n.state,{focus:{section:0,indexLocal:0,indexGlobal:0}}))},this.handleClearButtonClick=()=>{const{searchStore:e}=this.props;e.resetQuery({resetFilters:!0}),e.setState(jn({},e.state,{isSidebarOpen:!1}))},this.handleFocus=()=>{const{isFocusedStore:e}=this.props;e.get()||e.set(!0)},this.handleBlur=()=>{const{isFocusedStore:e}=this.props,{device:t}=this.environment;e.get()&&(e.set(!1),t.isReactNative&&kn.b.updateKeyboardPhase(kn.a.willHide))},this.setTypingStart=()=>{const{isTypingStore:e}=this.props;e.get()||e.set(!0)},this.setTypingEnd=()=>{const{isTypingStore:e}=this.props;e.set(!1)},this.styles={inputDesktop:{fontSize:18,height:xn.DESKTOP_INPUT_HEIGHT,paddingLeft:16,paddingRight:16,flexGrow:0,flexShrink:0,zIndex:1},inputMobile:{fontSize:16,border:"none",boxShadow:"none",borderRadius:7,lineHeight:"1.2",padding:"6px 8px"},searchIcon:()=>{const{device:e}=this.environment;return{width:e.isMobile?16:18,height:e.isMobile?16:18,marginRight:e.isMobile?12:10,flexGrow:0,flexShrink:0}},input:jn({minWidth:0},I.a.textOverflowStyle),clearButton:{marginLeft:8}}}willUnmount(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=void 0)}renderComponent(){const{device:e}=this.environment,{isOpen:t,searchStore:{state:n}}=this.props,a=this.styles,r=this.getThemeColors(),i=e.isMobile?Te.b.Format.ExtraLarge:Te.b.Format.Transparent,o=e.isMobile?jn({},a.inputMobile,{},r.inputMobile):jn({},a.inputDesktop,{},r.inputDesktop);return s.a.createElement(Te.b,{format:i,placeholder:this.getPlaceholderText(),left:this.renderSpinner(),value:n.query.text,focus:e.isMobile?void 0:t,focusInitial:e.isMobile,focusAfterAnimation:!0,showClearButton:!0,selectAll:!0,onChange:this.handleQueryChange,onClearButtonClick:this.handleClearButtonClick,onFocus:this.handleFocus,onBlur:this.handleBlur,style:o,inputStyle:a.input,clearButtonStyle:a.clearButton})}handleTyping(){this.typingTimer&&window.clearTimeout(this.typingTimer),this.setTypingStart(),this.typingTimer=window.setTimeout(this.setTypingEnd,xn.TYPING_DEBOUNCE_MS)}getPlaceholderText(){const{currentSpaceStore:e,currentBlockStore:t}=c.a.state,n=e&&Object(Tn.getSpaceName)(this.environment,e);if(n)return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.namedSpace",defaultMessage:"Search {spaceName}…"},{spaceName:n});if(t){const e=Pn.cb(t.getTitleValue()).slice(0,xn.MAX_PLACEHOLDER_TITLE_LENGTH);return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.namedPage",defaultMessage:"Search in {pageTitle}…"},{pageTitle:e})}return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.unnamedPage",defaultMessage:"Search in page…"})}getThemeColors(){return{inputDesktop:{boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor)},inputMobile:{background:this.theme.inputBackground},searchIcon:{fill:this.theme.mediumIconColor}}}}xn.TYPING_DEBOUNCE_MS=300,xn.DESKTOP_INPUT_HEIGHT=52,xn.MAX_PLACEHOLDER_TITLE_LENGTH=100;var Bn=Object(x.g)(xn),An=n(667),Fn=n(564),Rn=n(821);function Ln(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Un(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ln(Object(n),!0).forEach((function(t){_n(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ln(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Wn extends T.a{constructor(){super(...arguments),this.styles={title:{fontWeight:I.a.fontWeight.medium,lineHeight:"20px"},menuItem:{minHeight:36,paddingTop:this.environment.device.isMobile?12:8,paddingBottom:this.environment.device.isMobile?12:8},textWrapper:{marginLeft:8,alignItems:void 0,flex:void 0},inlineTextWrapper:{alignItems:"baseline"},highlight:{fontWeight:I.a.fontWeight.medium},enterIcon:{height:14,width:14},caption:{marginTop:1}}}renderComponent(){const{focused:e,isLastInSection:t,isBeforeFocused:n,inline:a}=this.props,r=this.styles,i=this.getThemeColors(),o=Un({},r.menuItem,{},!a&&!t&&!n&&!e&&i.menuItemBorder),l=Un({},r.caption,{},i.caption),c=Un({},r.textWrapper,{},this.props.inline&&r.inlineTextWrapper);return s.a.createElement(O.a,Object.assign({},this.props,{title:this.renderTitle(),icon:this.renderIcon(),caption:this.renderCaption(),body:this.renderPreview(),right:this.renderEnterIcon(),disableTransition:!0,dontShrinkRight:!0,ignoreLocalHoverState:!0,captionStyle:l,style:o,textWrapperStyle:c,className:"notranslate"}))}renderTitle(){const{store:e,result:t,placeholder:n}=this.props,a=this.styles,r=this.getThemeColors(),i=Un({},a.title,{},this.hasAnyHighlight()&&r.highlightedTitle),o=this.getHighlightedWordsFromText(t&&t.highlight&&t.highlight.pathText);t&&t.isNavigable&&o.push(...this.getHighlightedWordsFromText(t&&t.highlight&&t.highlight.text));const l=this.getWordHighlighter(o);return s.a.createElement(k.a,{style:i,store:e,placeholder:n,highlighter:l})}renderIcon(){const{store:e}=this.props;return s.a.createElement(Kt.a,{disabled:!0,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:19})}renderCaption(){const{store:e,result:t,inline:n}=this.props;if(!this.hasPath())return;const a=this.getWordHighlighter(this.getHighlightedWordsFromText(t&&t.highlight&&t.highlight.pathText)),{device:r}=this.environment,i=n||r.isMobile?0:2;return s.a.createElement(Fn.a,{store:e,extraLength:i,showFullPathInTooltip:!0,highlighter:a})}renderPreview(){const{result:e}=this.props;if(!e)return;if(!e.highlight)return;if(e.isNavigable)return;if(!e.highlight.text)return;const t=this.styles,n=this.getThemeColors(),a=e.highlight.text;return s.a.createElement(Rn.a,{text:a,highlighter:{tokenize:e=>Object(An.a)(Object(An.b)(e)),style:Un({},t.highlight,{},n.highlight)}})}getHighlightedWordsFromText(e){if(!e)return[];let t=Object(An.b)(e);return t.some(e=>Object(An.e)(e)&&1===Object(An.c)(e).length)&&(t=Object(An.a)(t)),r()(t).filter(An.e).map(An.c).uniq().value()}getWordHighlighter(e){if(0===e.length)return;const t=this.styles,n=this.getThemeColors();return{tokenize:t=>Object(An.d)(t,e),style:Un({},t.highlight,{},n.highlight)}}renderEnterIcon(){const{device:e}=this.environment,{focused:t}=this.props,n=this.styles,a=this.getThemeColors();if(e.isMobile)return;const r=Un({},n.enterIcon,{},a.enterIcon,{opacity:t?1:0});return m.a.enter(r)}hasPath(){const{hidePath:e,store:t}=this.props;return!e&&Object(Fn.b)(t)}hasAnyHighlight(){const{result:e}=this.props;if(!e)return!1;const{highlight:t}=e;return!!t&&Boolean(t.text||t.pathText)}getThemeColors(){return{highlightedTitle:{color:this.theme.mediumTextColor},menuItemBorder:{boxShadow:"0 1px 0 ".concat(this.theme.lightDividerColor)},highlight:{color:this.theme.regularTextColor},enterIcon:{fill:this.theme.mediumIconColor},caption:{color:this.theme.mediumTextColor}}}}Wn.contextTypes=f.c;var Nn=Wn,zn=n(320),Vn=n(221),qn=n(80),Hn=n(31),Gn=n(61),Yn=n(81),Qn=n(132);function Kn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Zn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kn(Object(n),!0).forEach((function(t){Xn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class $n extends T.a{constructor(){var e;super(...arguments),e=this,this.isOpen=!1,this.storeTypes={searchStore:de.c,resultListStore:S.a,serverRequestStore:W.a,localRequestStore:W.a,localCacheRequestStore:W.a,isTypingStore:Gn.a.of(!1),isInputFocusedStore:Gn.a.of(!1),numQueriesIssued:Gn.a.of(0),selectedQueryResult:Gn.a.of(!1)},this.renderBody=e=>{const{device:t}=this.environment,{searchStore:{state:n}}=this.stores,a=this.layoutStyles,{currentSpaceStore:r}=c.a.state;return s.a.createElement(f.b,Object.assign({},this.getMenuProps(e),{className:p.W}),s.a.createElement("div",{style:a.body},!t.isMobile&&this.renderInput(),s.a.createElement(_.a,{requestStore:this.stores.localCacheRequestStore,request:r&&r.id,performRequest:this.performLocalCacheRequest,render:n.mode===de.c.Mode.Results?this.renderResults:this.renderDefaultBody})),this.shouldShowSidebar()&&this.renderFilterMenu())},this.renderDefaultBody=()=>{const{device:e}=this.environment,{resultListStore:t}=this.stores,n=this.defaultViewStyles;if(!this.recentPageStores.state)return;const a=this.getInitialFocus(),i={mode:de.c.Mode.Default,isMobile:e.isMobile,recentSearches:this.recentSearches.state,recentPages:this.recentPageStores.state};return s.a.createElement(s.a.Fragment,null,s.a.createElement("main",{style:n.wrapper},s.a.createElement(y.a,{type:y.a.Type.Vertical,store:t,initialFocus:a,disableKeyboardArrowWrap:!0,sections:r.a.compact([this.getRecentPagesSection(),this.getRecentSearchesSection()])})),this.shouldShowFooter(i)&&this.renderFooter())},this.renderResults=()=>{const{device:t}=this.environment,{searchStore:n,serverRequestStore:a,localRequestStore:r}=this.stores,i={query:n.state.query,limit:n.state.limit};return s.a.createElement(_.a,{debounce:l.b,requestStore:a,request:i,performRequest:this.performServerRequest,render:(n,a)=>s.a.createElement(_.a,{debounce:l.a,requestStore:r,request:i,performRequest:function(){return Promise.resolve(e.performLocalRequest(...arguments))},render:(e,n)=>s.a.createElement(s.a.Fragment,null,t.isMobile&&this.renderFilterMenu(),this.renderRequestResults({localResponse:n,serverResponse:a}))})})},this.renderRequestResults=e=>{const{device:t}=this.environment,{serverResponse:n,localResponse:a}=e,{serverRequestStore:r}=this.stores;if(!n&&!a)return;const i=P.f({localResponse:a,serverResponse:n,serverRequestStore:r});this.incrementNumQueriesIssued();const o={mode:de.c.Mode.Results,isMobile:t.isMobile,errorState:i};return s.a.createElement(s.a.Fragment,null,this.shouldShowHeaderDesktop(o)&&this.renderHeader(),this.renderResultsSection({errorState:i,localResponse:a,serverResponse:n}),this.shouldShowFooter(o)&&this.renderFooter({localResponse:a,serverResponse:n}))},this.renderSearchResult=(e,t)=>{const{store:n}=e,a=n.isNavigableBlock()?n:n.getNavigableBlockStore();if(a)return{key:"".concat(n.id,":").concat(t),action:e=>this.handleSelectResult(n,e,"query_results"),render:n=>s.a.createElement(Nn,Object.assign({},n,{isFirstInSection:0===t,store:a,hidePath:!1,result:e}))}},this.handleComponentOpenClose=()=>{this.isOpen!==zn.a.state.open&&(this.isOpen=zn.a.state.open,zn.a.state.open?clearTimeout(this.inactiveTimer):this.addRecentSearch())},this.handleComponentClose=()=>{const{device:e}=this.environment,{searchStore:t,numQueriesIssued:n,selectedQueryResult:a}=this.stores,r=a.get(),i=n.get(),{query:s}=t.state;C.a(),i>0&&!r&&o.c(this.environment,{numQueriesIssued:i}),""===s.text.trim()?t.reset():P.l(s.filters)||t.setState(Zn({},t.state,{isSidebarOpen:!1})),this.inactiveTimer=window.setTimeout(this.resetState,2*Hn.d),e.isMobile&&Vn.b()},this.handleRecentSearch=(e,t)=>{const{searchStore:n}=this.stores;n.setState(Zn({},n.state,{query:e,mode:de.c.Mode.Results,isSidebarOpen:!0}))},this.handleSelectResult=(e,t,n)=>{const{searchStore:a,numQueriesIssued:r,selectedQueryResult:i}=this.stores,{event:s}=t,l=s.metaKey||s.ctrlKey;"query_results"===n&&i.set(!0);const{query:c}=a.state;o.Nd(this.environment,{context:n,queryStringLength:c.text.trim().length,hasFilters:P.l(c.filters),selectedItemIndex:t.index,isNavigable:e.isNavigableBlock(),numQueriesIssued:r.get()}),N.j(e,l,this.environment),l||this.handleComponentClose()},this.handleScrollOffsetChange=e=>{const{searchStore:t,searchStore:{state:n},serverRequestStore:{state:a}}=this.stores;!(e<=$n.LOAD_MORE_RESULTS_SCROLL_OFFSET_PX)||a.loading||n.allResultsLoaded||t.setState(Zn({},n,{limit:n.limit+de.b}))},this.handleScrollResults=()=>{this.stores.isInputFocusedStore.get()&&this.blurInputDebounced()},this.handleSpaceChange=()=>{const e=c.a.state.currentSpaceStore&&c.a.state.currentSpaceStore.id;this.spaceId!==e&&(this.spaceId=e,this.resetState())},this.performLocalCacheRequest=async()=>{const{currentSpaceStore:e,currentSpaceViewStore:t}=c.a.state;if(!this.getPublicAccessPermissionForPage()&&e)return P.h({environment:this.environment,currentSpaceStore:e,currentSpaceViewStore:t})},this.performLocalRequest=e=>{const{query:t}=e,{localCacheRequestStore:n}=this.stores,a=n.state.result;if(!a)return;if(!t.text.trim())return;if(this.getPublicAccessPermissionForPage())return;const r=Qn.a.createMetric("rum.local_quick_search_query"),i=P.g({input:e,cache:a});if(!i)return;if(0===i.results.length)return{error:te.d.NoResults};const s=P.n({sort:t.sort,unsorted:i.results,batchSize:de.b,currentUserId:this.environment.currentUser.id}).results.map(e=>Zn({},e,{store:this.createBlockStore(e.id)})),o=this.isOnline()?P.m(this.environment,s):s,l=this.isOnline()?o.length:i.total;if(0===l)return{error:te.d.NoResults};const c={value:{total:l,results:o}};return Qn.a.emit(this.environment,r),c},this.performServerRequest=async e=>{const{searchStore:t}=this.stores,{currentSpaceStore:n}=c.a.state,{query:a,limit:r}=e;if(!a.text.trim()&&!P.l(a.filters))return;if(!this.isOnline())return{error:te.d.Offline};const i=Qn.a.createMetric("rum.server_quick_search_query"),s=await P.k({environment:this.environment,input:e,currentSpaceStore:n,publicAccessPermission:this.getPublicAccessPermissionForPage()});if(!s)return;if("failed"===s.type)return s.offline?{error:te.d.Offline}:{error:te.d.RequestFailed};if(0===s.data.results.length)return{error:te.d.NoResults};const{results:o,total:l}=P.n({sort:a.sort,unsorted:s.data.results,batchSize:de.b,currentUserId:this.environment.currentUser.id});return t.setState(Zn({},t.state,{allResultsLoaded:l<r})),Qn.a.emit(this.environment,i),{value:{results:o.map(e=>Zn({},e,{store:this.createBlockStore(e.id)})),total:s.data.total}}},this.recentPageStores=this.createComputedStore(()=>{const{currentSpaceStore:e}=c.a.state,t=(e?qn.t({currentUserId:this.environment.currentUser.id,spaceId:e.id}).slice(0,this.getMaxRecentPages()):[]).map(this.createBlockStore),n=t.map(E.m);return r.a.every(n)&&t.filter(e=>e.pathIsAlive())}),this.clearRecentlyVisitedPages=()=>{const{currentSpaceStore:e}=c.a.state;e&&(qn.i({currentUserId:this.environment.currentUser.id,spaceId:e.id}),this.recentPageStores.recompute())},this.recentSearches=this.createComputedStore(()=>{const{currentSpaceStore:e}=c.a.state;return e?qn.s({currentUserId:this.environment.currentUser.id,spaceId:e.id}).slice(0,$n.MAX_RECENT_SEARCHES):[]}),this.clearRecentSearches=()=>{const{currentSpaceStore:e}=c.a.state;e&&(qn.h({currentUserId:this.environment.currentUser.id,spaceId:e.id}),this.recentSearches.recompute())},this.addRecentSearch=()=>{const{searchStore:e,serverRequestStore:t,localRequestStore:n}=this.stores,{currentSpaceStore:a}=c.a.state;if(!a)return;const{query:r}=e.state;if(!r.text.trim())return;const i=this.getCurrentResults(),s=i.local&&!n.state.loading,o=i.server&&!t.state.loading;(s||o)&&qn.c({currentUserId:this.environment.currentUser.id,spaceId:a.id,query:r})},this.createBlockStore=e=>{const{parentStore:t}=this.props;return d.a.createChildStore(t,{table:u.a,id:e})},this.shouldDismissKeyboardOnScroll=()=>{const{device:e}=this.environment;return!!e.isMobile&&(!e.isIOS||e.isReactNative)},this.blurInput=()=>{const{activeElement:e}=document;e instanceof HTMLInputElement&&e.blur()},this.blurInputDebounced=r.a.debounce(this.blurInput,500,{leading:!0}),this.resetState=()=>{const{searchStore:e,resultListStore:t,serverRequestStore:n,localRequestStore:a,localCacheRequestStore:r}=this.stores;e.reset(),t.reset(),n.reset(),a.reset(),r.reset(),zn.a.reset()},this.incrementNumQueriesIssued=r.a.debounce(()=>this.stores.numQueriesIssued.update(e=>e+1),500),this.searchIcon=()=>m.a.searchThick({height:14,width:14,marginLeft:2,marginRight:6,flexGrow:0,flexShrink:0,fill:this.theme.mediumIconColor}),this.layoutStyles={modal:{width:"75%",maxWidth:600,minHeight:$n.MIN_MENU_HEIGHT,maxHeight:$n.MAX_MENU_HEIGHT},modalWithSidebar:{maxWidth:820},body:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},scroller:{display:"flex",flexDirection:"row",flexWrap:"nowrap",justifyContent:"space-between",maxHeight:$n.MAX_MENU_HEIGHT},footer:{flexShrink:0}},this.modalMenuStyles={topbar:{height:void 0},topbarLeftInput:{marginLeft:10,marginTop:10,marginBottom:10},topbarRightButtonWrapper:{flex:void 0},topbarButton:{fontWeight:void 0}},this.defaultViewStyles={wrapper:{width:"100%",height:"100%",overflowX:"hidden",overflowY:"auto"},recentSection:{paddingTop:0,paddingBottom:8},recentTitle:{margin:0,padding:"0 14px",height:32,alignItems:"center",paddingTop:2},clearButton:{fontWeight:I.a.fontWeight.medium,padding:0,background:"none",fontSize:12,height:void 0},clearButtonDesktop:{textTransform:"none",letterSpacing:"normal",padding:"0 4px",fontSize:I.a.fontSize.UISmall.desktop,height:20,lineHeight:"20px",borderRadius:3}},this.resultStyles={results:{flex:1,display:"flex",flexDirection:"column",overflow:"auto",height:"100%"},messageMenuItem:Zn({},this.environment.device.isMobile&&{background:void 0,boxShadow:void 0})}}getMaxRecentPages(){const{device:e}=this.environment;return e.isMobile?5:7}didMount(){zn.a.addListener(this.handleComponentOpenClose),c.a.addListener(this.handleSpaceChange),this.recentPageStores.addListener(r.a.noop)}willUnmount(){zn.a.removeListener(this.handleComponentOpenClose),c.a.removeListener(this.handleSpaceChange),this.recentPageStores.removeListener(r.a.noop),this.inactiveTimer&&(clearTimeout(this.inactiveTimer),this.inactiveTimer=void 0)}renderComponent(){const{device:e}=this.environment,t=this.layoutStyles,n=Boolean(zn.a.state.open),a=Zn({},t.modal,{},this.shouldShowSidebar()&&t.modalWithSidebar);return s.a.createElement(v.a,{open:n,onDismiss:this.handleComponentClose,modalStyle:a,disableAnimation:!e.isMobile,renderContent:()=>s.a.createElement(g.a,{capture:!0,ignoreBlockSelection:!0,focusOffscreenInput:!1,restoreSelection:!e.isMobile,render:()=>s.a.createElement(h.a,{capture:!0,allowMenuList:!0,render:this.renderBody})})})}getMenuProps(e){const{device:t}=this.environment,{searchStore:n}=this.stores,a=this.modalMenuStyles,r=this.getThemeColors();if(t.isMobile){const{mode:t}=n.state,i=Zn({},a.topbarButton,{},r.topbarButton);return Zn({menuType:f.a.Modal,left:this.renderInput(),shouldRenderLeftDirectly:!0,leftOuterStyle:a.topbarLeftInput,right:s.a.createElement(Xe.CancelMenuText,null),onClickRight:this.handleComponentClose,rightOuterStyle:a.topbarRightButtonWrapper,header:this.shouldShowHeaderMobile({mode:t})&&this.renderHeader(),disableHeaderShadow:!0,topbarStyle:a.topbar,leftRightButtonStyle:i,onScroll:this.shouldDismissKeyboardOnScroll()?this.handleScrollResults:void 0},e)}return Zn({menuType:f.a.Popup,maxHeight:$n.MAX_MENU_HEIGHT,minHeight:$n.MIN_MENU_HEIGHT,disableScroller:!0,scrollerStyle:this.layoutStyles.scroller},e)}renderHeader(){const{parentStore:e}=this.props,{searchStore:t}=this.stores,n=Boolean(this.getPublicAccessPermissionForPage());return s.a.createElement(wn,{parentStore:e,searchStore:t,isPublicPageSearch:n})}renderInput(){const{searchStore:e,resultListStore:t,isTypingStore:n,isInputFocusedStore:a}=this.stores;return s.a.createElement(Bn,{isOpen:Boolean(zn.a.state.open),searchStore:e,resultListStore:t,isTypingStore:n,isFocusedStore:a,showSpinner:this.showSpinner()})}getRecentPagesSection(){const{device:e}=this.environment,t=this.defaultViewStyles,n=this.recentPageStores.state;if(n&&0!==n.length)return{key:"recentlyVisitedPages",items:n.map((t,n)=>({key:"".concat(t.id,":").concat(n),action:e=>this.handleSelectResult(t,e,"recent_pages"),render:a=>s.a.createElement(Nn,Object.assign({},a,{isFirstInSection:0===n,inline:!e.isMobile,store:t,hidePath:!1}))})),render:n=>s.a.createElement(ft.a,{key:n.key,title:s.a.createElement(x.a,{id:"search.recentlyVisitedPages.title",defaultMessage:"Recent pages",description:"Title text for recently visited pages"}),desktopTitleStyle:t.recentTitle,desktopStyle:t.recentSection,right:(void 0!==n.focusedIndex||e.isMobile)&&this.renderClearRecentsButton(this.clearRecentlyVisitedPages)},s.a.createElement("ul",{style:H},n.children))}}getRecentSearchesSection(){const{device:e}=this.environment,{parentStore:t}=this.props,n=this.defaultViewStyles,a=this.recentSearches.state;if(0!==a.length)return{key:"recentSearches",items:a.slice(0,$n.MAX_RECENT_SEARCHES).map((e,n)=>({key:n,action:t=>this.handleRecentSearch(e,t),render:a=>s.a.createElement("li",{key:a.key},s.a.createElement(U,Object.assign({},a,{isFirstInSection:0===n,parentStore:t,query:e,icon:this.searchIcon()})))})),render:t=>s.a.createElement(ft.a,{key:t.key,title:s.a.createElement(x.a,{id:"search.recentSearches.title",defaultMessage:"Recent searches",description:"Title text for recent searches"}),desktopTitleStyle:n.recentTitle,desktopStyle:n.recentSection,right:(void 0!==t.focusedIndex||e.isMobile)&&this.renderClearRecentsButton(this.clearRecentSearches)},s.a.createElement("ul",{style:H},t.children))}}getInitialFocus(){if(this.stores.searchStore.state.query.text.trim())return;const e=this.recentPageStores.state;return e&&e.length>0?1:0}renderFooter(e){const{searchStore:t}=this.stores,n=this.layoutStyles,{mode:a}=t.state;if(a===de.c.Mode.Default)return s.a.createElement("footer",{style:n.footer},s.a.createElement(fe,{mode:a}));const r=this.getCurrentResultsWithCount(e);return r?s.a.createElement("footer",{style:n.footer},s.a.createElement(fe,{mode:a,results:r,showSpinner:this.showSpinner()})):void 0}renderClearRecentsButton(e){const{device:t}=this.environment,n=this.defaultViewStyles,a=this.getThemeColors(),r=Zn({},n.clearButton,{},a.clearButton,{},!t.isMobile&&n.clearButtonDesktop);return s.a.createElement(ye.a,{onClick:e,style:r},s.a.createElement(x.a,{id:"search.clearRecentsButton.text",defaultMessage:"Clear",description:"Button text for clearing recent searches and pages"}))}renderResultsSection(e){const{localResponse:t,serverResponse:n,errorState:a}=e,{resultListStore:i}=this.stores,o=this.resultStyles,l=P.b({environment:this.environment,results:this.getCurrentResults({localResponse:t,serverResponse:n}),isOnline:this.isOnline()}),c=l&&{key:"results",render:e=>s.a.createElement(ue.a,Object.assign({},e,{shouldShowBottomDivider:!1,disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0})),items:r.a.compact(l.map(this.renderSearchResult))};return s.a.createElement("section",{style:o.results},c&&s.a.createElement(y.a,{type:y.a.Type.Vertical,initialFocus:0,store:i,disableKeyboardArrowWrap:!0,sections:[c]}),this.renderError(a)||s.a.createElement(z.a,{onChange:this.handleScrollOffsetChange}))}renderError(e){const{searchStore:t}=this.stores;if(!e.isLoading)return e.showMajorError?s.a.createElement(oe,{error:e.serverError,searchStore:t}):e.serverError&&e.serverError!==te.d.NoResults?this.renderMessage(e.serverError.message):void 0}renderFilterMenu(){const{device:e}=this.environment,{parentStore:t}=this.props,{searchStore:n}=this.stores,a=e.isMobile?{isMobile:!0,mode:mn.Section}:void 0;return s.a.createElement(Sn,Object.assign({parentStore:t,searchStore:n},a))}renderMessage(e){const t=this.resultStyles;return s.a.createElement(ue.a,{disableMobilePadding:!0,disableMobileBorders:!0},s.a.createElement(b.a,{title:e,style:t.messageMenuItem}))}getCurrentResults(e){const{serverRequestStore:t,localRequestStore:n}=this.stores,a=e&&e.localResponse||n.state.result,r=e&&e.serverResponse||t.state.result;return{local:P.i(a),server:P.i(r)}}getCurrentResultsWithCount(e){const{serverRequestStore:t,localRequestStore:n}=this.stores,a=e&&e.localResponse||n.state.result,r=e&&e.serverResponse||t.state.result,i=P.j(a),s=P.j(r);return s&&i?{server:s,local:i}:s?{server:s,local:void 0}:i?{server:void 0,local:i}:void 0}getPublicAccessPermissionForPage(){const{currentBlockStore:e}=c.a.state;return e&&M.g(this.environment,e)}isOnline(){return Boolean(Yn.a.state.online)}shouldShowSidebar(){const{device:e}=this.environment,{searchStore:t}=this.stores;if(!this.getPublicAccessPermissionForPage()&&!e.isMobile)return t.isSidebarOpen()}shouldShowHeaderDesktop(e){const{errorState:t,mode:n,isMobile:a}=e;if(a)return!1;if(n===de.c.Mode.Default)return!1;if(t.isLoading){const e=this.getCurrentResults();return Boolean(e.local||e.server)}return!t.showMajorError}shouldShowHeaderMobile(e){const{mode:t}=e;return t===de.c.Mode.Results}shouldShowFooter(e){const{isMobile:t}=e;if(t)return!1;if(e.mode===de.c.Mode.Default){const t=e.recentSearches.length>0,n=e.recentPages.length>0;return Boolean(t||n)}if(e.errorState.isLoading){const e=this.getCurrentResults();return Boolean(e.local||e.server)}return!e.errorState.showMajorError}showSpinner(){const{searchStore:e,serverRequestStore:t,isTypingStore:n}=this.stores;return this.isOnline()&&e.state.mode===de.c.Mode.Results&&!t.state.ready&&!n.get()}getThemeColors(){return{topbarButton:{color:this.theme.mediumTextColor},clearButton:{color:this.theme.lightTextColor}}}}$n.MAX_RECENT_SEARCHES=5,$n.LOAD_MORE_RESULTS_SCROLL_OFFSET_PX=200,$n.MIN_MENU_HEIGHT=50,$n.MAX_MENU_HEIGHT="80vh";t.default=$n},1104:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(3),s=n(17),o=n(490),l=(n(15),n(11),n(184)),c=n(151),d=n(53),u=n(47),p=n(81),m=n(34),h=n(19),g=n(23);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class S extends i.a{renderComponent(){const{title:e,actionButton:t,onClick:n}=this.props;return r.a.createElement(m.a,{onClick:n,style:this.getButtonStyle()},this.renderIcon(),r.a.createElement("div",{style:{minWidth:0,width:"100%"}},r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{style:S.titleStyle},e),r.a.createElement("div",{style:{marginLeft:"auto"}},t)),this.renderCaption()))}renderIcon(){const{icon:e,logo:t}=this.props;return t?r.a.createElement("img",{style:S.imageIconStyle,src:t}):e?r.a.createElement("div",{style:this.getIconWrapStyle()},e(this.getIconStyle())):void 0}renderCaption(){const{caption:e}=this.props;if(e)return r.a.createElement("div",{style:this.getCaptionStyle()},e)}getButtonStyle(){return{display:"flex",alignItems:this.props.caption?"flex-start":"center",padding:10,paddingRight:8,borderRadius:3,marginBottom:12,cursor:"pointer",boxShadow:this.theme.lightBoxShadow,transition:"background 200ms ease-out",background:this.theme.contentBackground}}getIconWrapStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",width:S.iconSize,height:S.iconSize,borderRadius:3,marginRight:8,color:this.theme.mediumTextColor,background:this.theme.sidebarBackground}}getIconStyle(){return{flexShrink:0,width:S.iconSize,height:S.iconSize}}getCaptionStyle(){return f({fontSize:12,color:this.theme.mediumTextColor,wordBreak:"keep-all"},!this.props.shouldWrapCaption&&f({},g.a.textOverflowStyle))}}S.iconSize=28,S.imageIconStyle={flexShrink:0,width:S.iconSize,height:S.iconSize,borderRadius:3,marginRight:10,background:h.f.white},S.titleStyle={fontSize:16,fontWeight:g.a.fontWeight.medium};var v=S,E=n(102),M=n(22),C=n(55),O=n(183),w=n(255),k=n(24),P=n(40),T=n(45),I=n(14),j=(n(303),n(69)),D=n(75),x=n(27),B=n(39),A=n(28),F=n(12),R=n(250),L=n(128),U=n(114),_=n(54),W=n(66),N=n(1358),z=n(1359),V=n(2),q=n.n(V),H=n(10),G=n(7),Y=n(1357),Q=n(1),K=n(6);const Z=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],X=["text/plain",".md",".mdown",".markdown",".mkdn",".mkd",".Rmd",".md.txt"],$={markdown:X,csv:["text/plain",".csv"],html:["text/html"],docx:Z,gdocs:Z,dropbox:Z,quip:["text/html",X],workflowy:["text/plain"],confluence:["application/zip"]};var J=n(224);function ee(e){var t;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(t=e[Symbol.asyncIterator]))return t.call(e);if(Symbol.iterator&&null!=(t=e[Symbol.iterator]))return t.call(e)}throw new TypeError("Object is not async iterable")}const te=Object(Q.f)({uploadingOneFile:{id:"importActions.uploadingOneFile.loadingMessage",defaultMessage:"Uploading… ({percentComplete}%)"},uploadingMultipleFilesNotStarted:{id:"importActions.uploadingMultipleFilesNotStarted.loadingMessage",defaultMessage:"Uploaded 0 of {totalNumberOfFiles}"},uploadingMultipleFilesInProgress:{id:"importActions.uploadingMultipleFilesInProgress.loadingMessage",defaultMessage:"Uploaded {numberOfUploadedFiles} of {totalNumberOfFiles}"},uploadingMultipleFilesComplete:{id:"importActions.uploadingMultipleFilesComplete.loadingMessage",defaultMessage:"Uploaded {totalNumberOfFiles} of {totalNumberOfFiles}"},importingOneFile:{id:"importActions.importingOneFile.loadingMessage",defaultMessage:"Importing…"},importingMultipleFilesNotStarted:{id:"importActions.importingMultipleFilesNotStarted.loadingMessage",defaultMessage:"Imported 0 of {totalNumberOfFiles}"},importingMultipleFilesInProgress:{id:"importActions.importingMultipleFilesInProgress.loadingMessage",defaultMessage:"Imported {numberOfImportedFiles} of {totalNumberOfFiles}"},importingMultipleFilesComplete:{id:"importActions.importingMultipleFilesComplete.loadingMessage",defaultMessage:"Imported {totalNumberOfFiles} of {totalNumberOfFiles}"},importingFromTrelloMessage:{id:"importActions.importingFromTrello.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} board from Trello} other {Importing {importingCount} boards from Trello}}"},importingFromAsanaMessage:{id:"importActions.importingFromAsana.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} project from Asana} other {Importing {importingCount} projects from Asana}}"},importingFromEvernoteMessage:{id:"importActions.importingFromEvernote.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} notebook from Evernote} other {Importing {importingCount} notebooks from Evernote}}"},importFailed:{id:"importActions.importFailedError.message",defaultMessage:"Import failed."},trelloImportFailed:{id:"importActions.trelloImportFailedError.message",defaultMessage:"Trello import failed."},asanaImportFailed:{id:"importActions.asanaImportFailedError.message",defaultMessage:"Asana import failed."},evernoteImportFailed:{id:"importActions.evernoteImportFailedError.message",defaultMessage:"Evernote import failed."},importTitle:{id:"importActions.importTitle",defaultMessage:"Import {date}",description:"'Import' is a noun"}});async function ne(e){const{environment:t,spaceStore:n,spaceViewStore:a,notebooks:r,userSettingsStore:i}=e;if(0===r.length)throw new Error("Expected at least one notebook");U.b({message:te.importingFromEvernoteMessage,interpolatedValues:{importingCount:r.length}}),Y.a.setState({open:!1});const s=await async function(e){const{environment:t,spaceStore:n,spaceViewStore:a,notebooks:r}=e,i=F.c(t),s=q.a.uniq(q.a.compact(r.map(e=>e.stack))).sort().reverse(),o={};let l=e=>!0;r.length>1&&s.length>0&&(s.forEach(e=>{const s=L.b({environment:t,spaceStore:n,spaceViewStore:a,isPrivate:!0,prepend:!0,loading:!1,title:e,transaction:i}),l=s.getContentStore();r.filter(t=>t.stack===e).forEach(e=>{const n=A.a({environment:t,type:G.a.copyIndicator,inMemoryRecordCache:s.inMemoryRecordCache,transaction:i});W.a({parent:l,append:n,transaction:i}),o[e.guid]=n})}),l=e=>!Boolean(e.stack));return r.filter(l).reverse().forEach(e=>{const r=L.b({environment:t,spaceStore:n,spaceViewStore:a,isPrivate:!0,prepend:!0,loading:!0,title:e.title,transaction:i});o[e.guid]=r}),await F.b({environment:t,transaction:i}),o}({environment:t,spaceStore:n,spaceViewStore:a,notebooks:r}),o=s[r[0].guid];try{return await async function(e){const{environment:t,spaceStore:n,spaceViewStore:a,notebooks:r,waitForNotebook:i,notebookMapping:s,userSettingsStore:o}=e;let l;if(D.b(r,2,async e=>{await Promise.all(e.map(async e=>{const n=s[e.guid];if(!n)throw new Error("Missing notebook page ".concat(e.guid));const a=D.c();n===i&&(l=a),await async function(e){const{environment:t,notebookStore:n,notebook:a,firstCompleted:r}=e,i=B.mb(t,{notebookId:a.guid,blockId:n.id,spaceId:n.pointer.spaceId,timestamp:Date.now(),parentTable:H.a}),{value:s}=await i.next();if(s.error)throw console.error(s.error),F.d(t,e=>{const t=n.getParentBlockStore();if(t){const a=t.getContentStore();W.e({parent:a,remove:n,transaction:e})}}),s.error;r.resolve(void 0)}({environment:t,notebookStore:n,notebook:e,firstCompleted:a})}))}),!l)throw new Error("waitForNotebookFirstCompleted not defined.");o.getSettings().created_evernote_getting_started||await L.c({environment:t,type:"evernote",spaceStore:n,spaceViewStore:a,userSettingsStore:o});await l.promise}({environment:t,waitForNotebook:o,notebookMapping:s,notebooks:r,spaceStore:n,spaceViewStore:a,userSettingsStore:i}),U.a(),o}catch(l){throw _.e(K.a.formatMessage(te.evernoteImportFailed)),U.a(),l}}var ae=n(8),re=n(20),ie=n(155),se=n(16);class oe extends se.a{getInitialState(){return{searchQuery:"",selection:new Set}}}var le=oe,ce=n(169),de=n(315),ue=n(271),pe=n(285),me=n(154),he=n(257);class ge extends i.a{renderComponent(){return r.a.createElement("div",{style:this.getStyle()},"·")}getStyle(){return{display:"inline-block",textAlign:"center",color:this.props.disabled?this.theme.lightTextColor:this.theme.mediumTextColor,userSelect:"none",WebkitUserSelect:"none",width:8}}}var be=ge,fe=n(86);function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){ve(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ee extends i.a{constructor(){super(...arguments),this.storeTypes={store:le},this.handleSelectAllClick=()=>{const{sections:e,analyticsName:t}=this.props,{store:n}=this.stores,{selection:a}=n.state;for(const r of e)for(const e of r.items)a.add(e.key);n.emit(),I.Xb(this.environment,{name:t})},this.handleDeselectAllClick=()=>{const{analyticsName:e}=this.props,{store:t}=this.stores,{selection:n}=t.state;n.clear(),t.emit(),I.Vb(this.environment,{name:e})},this.handleToggleItem=e=>{const{analyticsName:t}=this.props,{store:n}=this.stores,{selection:a}=n.state;a.has(e.key)?(a.delete(e.key),I.Yb(this.environment,{name:t})):(a.add(e.key),I.Wb(this.environment,{name:t})),n.emit()},this.handleImport=()=>{const{sections:e}=this.props,{selection:t}=this.stores.store.state,n=q.a.flatten(e.map(e=>e.items)),a=[];t.forEach(e=>{const t=n.find(t=>t.key===e);t&&a.push(t)}),this.props.onComplete(a)}}willMount(e){const t=this.stores.store.state.selection,[n]=e.sections;if(n){const[e]=n.items;e&&t.add(e.key)}this.stores.store.emit()}renderComponent(){return r.a.createElement(M.b,{menuType:M.b.MenuType.Popup,header:this.renderMenuHeader(),footer:this.renderMenuFooter(),width:280,maxHeight:350},this.renderMenuList())}renderMenuHeader(){const{searchInputPlaceholder:e}=this.props,{searchQuery:t}=this.stores.store.state,n=Boolean(t);return r.a.createElement(k.a,{isInput:!0,desktopStyle:{paddingBottom:2}},r.a.createElement(ce.a,{focus:!0,focusAfterAnimation:!0,value:t,onChange:e=>{const{store:t}=this.stores;t.setState(Se({},t.state,{searchQuery:e.target.value}))},placeholder:e}),r.a.createElement(me.a,{isTokenTitle:!0,style:{marginTop:2},title:r.a.createElement("div",{style:{marginLeft:-3}},r.a.createElement(he.a,{onClick:this.handleSelectAllClick,disabled:n,disabledFeedback:!0},r.a.createElement(Q.a,{id:"importPopup.selectAll",defaultMessage:"Select all"})),r.a.createElement(be,{disabled:n}),r.a.createElement(he.a,{onClick:this.handleDeselectAllClick,disabled:n,disabledFeedback:!0},r.a.createElement(Q.a,{id:"importPopup.deselectAll",defaultMessage:"Deselect all"})))}))}renderMenuFooter(){const e=0===this.stores.store.state.selection.size;return r.a.createElement(k.a,{topBorder:!0,desktopStyle:{paddingTop:8,paddingBottom:8}},r.a.createElement(me.a,{title:r.a.createElement(pe.a,{disabled:e,onClick:this.handleImport},r.a.createElement(Q.a,{id:"integrationImportPopup.importButton.label",defaultMessage:"Import"}))}))}renderMenuList(){const{sections:e,noSearchResultsPlaceholder:t}=this.props,{store:n}=this.stores,{searchQuery:a,selection:i}=n.state,s=e.map(e=>{const t=Object(ue.b)(a,e.items,t=>"".concat(t.name," ").concat(e.name));return Se({},e,{items:t})}).filter(e=>e.items.length>0);if(0===s.length)return r.a.createElement(k.a,null,r.a.createElement(ie.a,{title:t}));const o=s.map(t=>({key:t.name,render:n=>r.a.createElement(k.a,Object.assign({},n,{title:e.length>1?t.name:void 0})),items:t.items.map(e=>{const t=()=>this.handleToggleItem(e);return{key:e.key,render:n=>r.a.createElement(d.a,Object.assign({},n,{title:e.name,icon:r.a.createElement(de.a,{checked:i.has(e.key),size:16,onClick:t}),right:void 0!==e.count&&r.a.createElement(fe.a,{isSmall:!0},e.count)})),action:t}})}));return r.a.createElement(C.a,{type:C.a.Type.Vertical,initialFocus:void 0,sections:o})}}var Me=Ee,Ce=n(1449);class Oe extends i.a{constructor(){super(...arguments),this.handleClickImportTrello=()=>{I.D(this.environment,{name:"trello",from:this.props.analyticsFrom})},this.handleTrelloAuth=async()=>{await Ce.a({environment:this.environment,requestStore:this.props.requestStore})},this.handleRemoveTrello=async()=>{await B.x(this.environment,{}),await this.props.requestStore.refresh(),I.Bd(this.environment,{name:"trello"})},this.handleImportTrelloComplete=async(e,t)=>{const{boards:n}=e,a=n.filter(e=>Boolean(t.find(t=>t.key===e.id)));I.Rb(this.environment,{name:"trello",count:t.length});const r=await async function(e){const{environment:t,boards:n,spaceStore:a,spaceViewStore:r}=e;U.b({message:te.importingFromTrelloMessage,interpolatedValues:{importingCount:n.length}}),z.a.setState({open:!1});const i=F.c(t),s=n.map(e=>L.b({environment:t,spaceStore:a,spaceViewStore:r,isPrivate:!0,prepend:!0,loading:!0,title:e.name,transaction:i}));await new Promise(e=>{i.postSubmitCallbacks.push(e),F.b({environment:t,transaction:i})});try{return await Promise.all(s.map(async(e,a)=>{const r=n[a],{value:i}=await B.ob(t,{boardId:r.id,blockId:e.id,spaceId:e.pointer.spaceId}).next();if(i.error)throw i.error})),U.a(),s[0]}catch(o){throw F.d(t,e=>{for(const t of s)W.e({parent:a.getPagesStore(),remove:t,transaction:e})}),_.e(K.a.formatMessage(te.trelloImportFailed)),U.a(),new Error(o)}}({environment:this.environment,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,boards:a});this.props.onComplete(r)}}renderComponent(){const{device:e}=this.environment,{trelloResult:t,intl:n}=this.props,{account:a,boards:i}=t,s={key:"default",name:n.formatMessage({id:"trelloImportOption.boardProperty.defaultName",defaultMessage:"Boards"}),items:i.map(e=>({key:e.id,name:e.name}))},o={title:"Trello",logo:re.a.images.import.trelloPng,actionButton:a&&this.props.renderItemActionsButton([{name:n.formatMessage({id:"trelloImportOption.actionsMenu.import",defaultMessage:"Import"}),action:()=>z.a.setState({open:!0})},{name:n.formatMessage({id:"trelloImportOption.actionsMenu.connectAnotherAccount",defaultMessage:"Connect another account"}),action:this.handleTrelloAuth},{name:n.formatMessage({id:"trelloImportOption.actionsMenu.removeIntegration",defaultMessage:"Remove"}),action:this.handleRemoveTrello}]),onClick:()=>{}};return r.a.createElement(u.a,{popupType:e.isMobile?u.a.PopupType.SlideUp:u.a.PopupType.Popup,buttonPopupStore:z.a,onClick:this.handleClickImportTrello,render:()=>r.a.createElement(Me,{searchInputPlaceholder:n.formatMessage({id:"trelloImportOption.search.placeholder",defaultMessage:"Search for a board…",description:"'Board' is a Trello term."}),noSearchResultsPlaceholder:n.formatMessage({id:"trelloImportOption.search.noResultsPlaceholder",defaultMessage:"No boards",description:"'Board' is a Trello term."}),analyticsName:"trello",sections:[s],onComplete:e=>this.handleImportTrelloComplete(t,e)}),renderOrigin:e=>{let{onClick:t}=e;return r.a.createElement(v,Object.assign({},o,{onClick:a?t:this.handleTrelloAuth}))}})}}var we=Object(Q.g)(Oe),ke=n(119),Pe=n(41),Te=n(1447),Ie=n(133);class je extends i.a{constructor(){super(...arguments),this.handleClickImportEvernote=()=>{I.D(this.environment,{name:"evernote",from:this.props.analyticsFrom})},this.handleRemoveEvernote=async()=>{await B.w(this.environment,{}),await this.props.requestStore.refresh(),I.Bd(this.environment,{name:"evernote"})},this.handleEvernoteAuth=async()=>{await Te.a({environment:this.environment,requestStore:this.props.requestStore})},this.handleImportEvernoteComplete=async(e,t)=>{const{notebooks:n}=e,a=n.filter(e=>Boolean(t.find(t=>t.key===e.guid)));I.Rb(this.environment,{name:"evernote",count:t.length});const r=await ne({environment:this.environment,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore,notebooks:a});this.props.onComplete(r)},this.handleEvernoteHelpClick=()=>{Pe.i({environment:this.environment,url:Object(Ie.a)("guides.importEvernote")})}}renderComponent(){const{device:e}=this.environment,{evernoteResult:t,intl:n}=this.props,{userInfo:a,notebooks:i}=t,s=q.a.groupBy(i,e=>e.stack||""),o=Object.keys(s).map(e=>{const t=e||"Top-Level";return{key:t,name:t,items:(s[e]||[]).map(e=>({key:e.guid,name:e.title,count:e.noteCount}))}}),{data:l}=ke.a.state,c=Boolean(l&&l.credits.find(e=>"import_evernote"===e.type&&e.activated)),d={title:"Evernote",logo:re.a.images.import.evernotePng,shouldWrapCaption:!a&&!c,caption:a?a.name||a.username||a.email:c?void 0:n.formatMessage({id:"evernoteImportOption.caption.getCredit",defaultMessage:"Get $5 in credit on import"}),actionButton:a?this.props.renderItemActionsButton([{name:n.formatMessage({id:"evernoteImportOption.actionsMenu.learnMore",defaultMessage:"Learn more"}),action:this.handleEvernoteHelpClick},{name:n.formatMessage({id:"evernoteImportOption.actionsMenu.import",defaultMessage:"Import"}),action:()=>Y.a.setState({open:!0})},{name:n.formatMessage({id:"evernoteImportOption.actionsMenu.connectAnotherAccount",defaultMessage:"Connect another account"}),action:this.handleEvernoteAuth},{name:n.formatMessage({id:"evernoteImportOption.actionsMenu.removeIntegration",defaultMessage:"Remove"}),action:this.handleRemoveEvernote}]):this.props.defaultActionButton,onClick:()=>{}};return r.a.createElement(u.a,{popupType:e.isMobile?u.a.PopupType.SlideUp:u.a.PopupType.Popup,buttonPopupStore:Y.a,onClick:this.handleClickImportEvernote,render:()=>r.a.createElement(Me,{searchInputPlaceholder:n.formatMessage({id:"evernoteImportOption.search.placeholder",defaultMessage:"Search for a notebook…",description:"'Notebook' is an Evernote term."}),noSearchResultsPlaceholder:n.formatMessage({id:"evernoteImportOption.search.noResultsPlaceholder",defaultMessage:"No notebooks",description:"'Notebook' is an Evernote term."}),analyticsName:"evernote",sections:o,onComplete:e=>this.handleImportEvernoteComplete(t,e)}),renderOrigin:e=>{let{onClick:t}=e;return r.a.createElement(v,Object.assign({},d,{onClick:a?t:this.handleEvernoteAuth}))}})}}var De=Object(Q.g)(je),xe=(n(168),n(1448));class Be extends i.a{constructor(){super(...arguments),this.handleClickImportAsana=()=>{I.D(this.environment,{name:"asana",from:this.props.analyticsFrom})},this.handleAsanaAuth=async()=>{await xe.a({environment:this.environment,requestStore:this.props.requestStore})},this.handleRemoveAsana=async()=>{await B.u(this.environment,{}),await this.props.requestStore.refresh(),I.Bd(this.environment,{name:"asana"})},this.handleImportAsanaComplete=async(e,t)=>{const n=q.a.flatten(q.a.values(e.projects)).filter(e=>Boolean(t.find(t=>t.key===e.gid.toString())));I.Rb(this.environment,{name:"asana",count:t.length});const a=await async function(e){const{environment:t,projects:n,spaceStore:a,spaceViewStore:r}=e;U.b({message:te.importingFromAsanaMessage,interpolatedValues:{importingCount:n.length}}),N.a.setState({open:!1});const i=F.c(t),s=n.map(e=>L.b({environment:t,spaceStore:a,spaceViewStore:r,isPrivate:!0,prepend:!0,loading:!0,title:e.name,transaction:i}));await F.b({environment:t,transaction:i});try{return await Promise.all(s.map(async(e,a)=>{const r=n[a],{value:i}=await B.kb(t,{blockId:e.id,spaceId:e.pointer.spaceId,projectId:r.gid}).next();if(i.error)throw i.error})),U.a(),s[0]}catch(o){throw F.d(t,e=>{for(const t of s)W.e({parent:a.getPagesStore(),remove:t,transaction:e})}),_.e(K.a.formatMessage(te.asanaImportFailed)),U.a(),new Error(o)}}({environment:this.environment,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,projects:n});this.props.onComplete(a)}}renderComponent(){const{asanaResult:e,intl:t}=this.props,{account:n,workspaces:a,projects:i}=e,s=a.map(e=>{const t=i[e.gid]||[];return{key:e.gid.toString(),name:e.name,items:t.map(e=>({key:e.gid.toString(),name:e.name}))}}),o={title:"Asana",logo:re.a.images.import.asanaPng,caption:n&&n,actionButton:n&&this.props.renderItemActionsButton([{name:t.formatMessage({id:"asanaImportOption.actionsMenu.import",defaultMessage:"Import"}),action:()=>N.a.setState({open:!0})},{name:t.formatMessage({id:"asanaImportOption.actionsMenu.connectAnotherAccount",defaultMessage:"Connect another account"}),action:this.handleAsanaAuth},{name:t.formatMessage({id:"asanaImportOption.actionsMenu.removeIntegration",defaultMessage:"Remove"}),action:this.handleRemoveAsana}]),onClick:()=>{}},{device:l}=this.environment;return r.a.createElement(u.a,{popupType:l.isMobile?u.a.PopupType.SlideUp:u.a.PopupType.Popup,buttonPopupStore:N.a,onClick:this.handleClickImportAsana,render:()=>r.a.createElement(Me,{searchInputPlaceholder:t.formatMessage({id:"asanaImportOption.search.placeholder",defaultMessage:"Search for a project…",description:"'Project' is an Asana term."}),noSearchResultsPlaceholder:t.formatMessage({id:"asanaImportOption.search.noResultsPlaceholder",defaultMessage:"No projects",description:"'Project' is an Asana term."}),analyticsName:"asana",sections:s,onComplete:t=>this.handleImportAsanaComplete(e,t)}),renderOrigin:e=>{let{onClick:t}=e;return r.a.createElement(v,Object.assign({},o,{onClick:n?t:this.handleAsanaAuth}))}})}}var Ae=Object(Q.g)(Be);async function Fe(e){const t=await B.eb(e,{});return"success"===t.type?t.data:(console.error(t.error),{boards:[]})}async function Re(e){const t=await B.D(e,{});if("success"===t.type){const{account:e}=t.data;return e?t.data:{workspaces:[],projects:{}}}return console.error(t.error),{workspaces:[],projects:{}}}async function Le(e){try{const t=await B.M(e,{});if("success"===t.type){const{notebooks:e,userInfo:n}=t.data;return{notebooks:e,userInfo:n}}return console.error(t.error),{notebooks:[],userInfo:void 0}}catch(t){return console.error(t),{notebooks:[],userInfo:void 0}}}var Ue=n(100);function _e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function We(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_e(Object(n),!0).forEach((function(t){Ne(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_e(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ze extends i.a{constructor(){super(...arguments),this.storeTypes={trelloRequestStore:w.a,asanaRequestStore:w.a,evernoteRequestStore:w.a},this.handleFileUploadClick=async e=>{I.D(this.environment,{name:e,from:this.props.analyticsFrom});const t=await async function(e){const{environment:t,pageStore:n,spaceStore:a,isTeamPage:r,spaceViewStore:i,uploadType:s}=e;let o;try{const e=await R.b({multiple:!0,accept:$[s].join(",")});if(0===e.length)return;const g=1===e.length,b=await new Promise((n,a)=>{R.f({environment:t,files:e,bucket:"temporary",preventLimitFreeFileSize:!0,onStart:()=>{U.b({message:g?te.uploadingOneFile:te.uploadingMultipleFilesNotStarted,interpolatedValues:{totalNumberOfFiles:e.length,percentComplete:0}})},onProgress:t=>{let{uploadedFiles:n,progressPercent:a}=t;U.b({message:g?te.uploadingOneFile:te.uploadingMultipleFilesInProgress,interpolatedValues:{numberOfUploadedFiles:n,totalNumberOfFiles:e.length,percentComplete:a}})},onComplete:t=>{U.b({message:g?te.uploadingOneFile:te.uploadingMultipleFilesComplete,interpolatedValues:{totalNumberOfFiles:e.length,percentComplete:100}}),n(t)},onError:a})});let f,y;if(n&&n.isEmptyPage())e.length>1||n.isInsideCollection()?(f=n.id,y="AppendToBlock"):(f=n.id,y="ReplaceBlock");else{const n=F.c(t),s=K.a.formatMessage(te.importTitle,{date:Object(j.a)().format("ll")}),l=L.b({environment:t,spaceStore:a,spaceViewStore:i,isPrivate:!r,prepend:!r,title:s,transaction:n});o=l,f=l.id,y=e.length>1?"AppendToBlock":"ReplaceBlock";const c=D.c();n.postSubmitCallbacks.push(c.resolve),F.b({environment:t,transaction:n}),await c.promise}const S=b.map((t,n)=>({fileURL:t,fileName:e[n].name}));let v=0;U.b({message:g?te.importingOneFile:te.importingMultipleFilesInProgress,interpolatedValues:{numberOfImportedFiles:v,totalNumberOfFiles:e.length}});for(const{fileURL:n,fileName:r}of S){if("confluence"===s){const e=B.lb(t,{fileURL:n,fileName:r,pageId:f,spaceId:a.id});var l,c=!0,d=!1;try{for(var u,p,m=ee(e);c=(u=await m.next()).done,p=await u.value,!c;c=!0){const e=p;if(e.error)throw e.error;e.value.isComplete||U.b(e.value.status)}}catch(h){d=!0,l=h}finally{try{c||null==m.return||await m.return()}finally{if(d)throw l}}}else if("AppendToBlock"===y){const{value:e}=await B.nb(t,{fileURL:n,fileName:r,importType:y,pageId:f,spaceId:a.id}).next();if(e.error)throw e.error}else if("ReplaceBlock"===y){const{value:e}=await B.nb(t,{fileURL:n,fileName:r,importType:y,pageId:f,spaceId:a.id}).next();if(e.error)throw e.error}v++,U.b({message:g?te.importingOneFile:te.importingMultipleFilesInProgress,interpolatedValues:{numberOfImportedFiles:v,totalNumberOfFiles:e.length}})}return U.a(),x.a.createChildStore(a,{table:H.a,id:f})}catch(g){let e;throw U.a(),F.d(t,e=>{o&&W.e({parent:a.getPagesStore(),remove:o,transaction:e})}),e=g.clientData&&g.clientData.type&&J.a[g.clientData.type]?K.a.formatMessage(J.a[g.clientData.type],g.clientData.messageValues):K.a.formatMessage(te.importFailed),_.e(e),g}}({environment:this.environment,pageStore:this.props.pageStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,uploadType:e});t&&this.props.onComplete(t)}}renderComponent(){if(!p.a.state.online)return r.a.createElement("div",{style:We({},ze.wrapStyle,{fontSize:14,color:this.theme.mediumTextColor})},r.a.createElement(Q.a,{id:"importOptions.offlineErrorMessage",defaultMessage:"Please go online to import."}));const{analyticsFrom:e}=this.props;return this.renderRequests(t=>t?r.a.createElement("div",{style:ze.wrapStyle},this.renderOptions(t)):r.a.createElement("div",{style:"onboarding"===e?{}:ze.wrapStyle},r.a.createElement(E.a,null)))}renderOptions(e){return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{style:We({},ze.optionsColumnStyle,{marginRight:16})},this.renderEvernoteImportOption(e.evernoteResult),this.renderTrelloImportOption(e.trelloResult),this.renderAsanaImportOption(e.asanaResult),this.renderConfluenceImportOption()),r.a.createElement("div",{style:We({},ze.optionsColumnStyle,{marginRight:16})},r.a.createElement(v,{title:r.a.createElement(Q.a,{id:"importOptions.textMarkdown.title",defaultMessage:"Text & Markdown",description:"Button title for importing plain text and/or Markdown content into Notion"}),icon:ae.a.importText,onClick:()=>this.handleFileUploadClick("markdown")}),r.a.createElement(v,{title:"CSV",icon:ae.a.importCSV,onClick:()=>this.handleFileUploadClick("csv")}),r.a.createElement(v,{title:"HTML",icon:ae.a.importHTML,onClick:()=>this.handleFileUploadClick("html")}),r.a.createElement(v,{title:"Word",logo:re.a.images.import.wordPng,onClick:()=>this.handleFileUploadClick("docx")})),r.a.createElement("div",{style:ze.optionsColumnStyle},r.a.createElement(v,{title:"Google Docs",logo:re.a.images.import.googleDocsPng,actionButton:this.renderHelpButtonToURL(Object(Ie.a)("guides.importGoogleDocs")),onClick:()=>this.handleFileUploadClick("gdocs")}),r.a.createElement(v,{title:"Dropbox Paper",logo:re.a.images.import.dropboxPaperPng,actionButton:this.renderHelpButtonToURL(Object(Ie.a)("guides.importDropboxPaper")),onClick:()=>this.handleFileUploadClick("dropbox")}),r.a.createElement(v,{title:"Quip",logo:re.a.images.import.quipPng,actionButton:this.renderHelpButtonToURL(Object(Ie.a)("guides.importQuip")),onClick:()=>this.handleFileUploadClick("quip")}),r.a.createElement(v,{title:"Workflowy",logo:re.a.images.import.workflowyPng,actionButton:this.renderHelpButtonToURL(Object(Ie.a)("guides.importWorkflowy")),onClick:()=>this.handleFileUploadClick("workflowy")})))}renderRequests(e){return r.a.createElement(O.a,{request:this.environment,performRequest:Fe,requestStore:this.stores.trelloRequestStore,render:(t,n)=>r.a.createElement(O.a,{request:this.environment,performRequest:Re,requestStore:this.stores.asanaRequestStore,render:(t,a)=>r.a.createElement(O.a,{request:this.environment,performRequest:Le,requestStore:this.stores.evernoteRequestStore,render:(t,r)=>e(n&&a&&r?{trelloResult:n,asanaResult:a,evernoteResult:r}:void 0)})})})}renderTrelloImportOption(e){return r.a.createElement(we,{trelloResult:e,analyticsFrom:this.props.analyticsFrom,renderItemActionsButton:this.renderItemActionsButton,onComplete:this.props.onComplete,requestStore:this.stores.trelloRequestStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore})}renderAsanaImportOption(e){return r.a.createElement(Ae,{asanaResult:e,analyticsFrom:"onboarding",renderItemActionsButton:this.renderItemActionsButton,onComplete:this.props.onComplete,requestStore:this.stores.asanaRequestStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore})}renderConfluenceImportOption(){var e;if(e=this.environment,"on"===Ue.a.getGroup(e,"confluence-import"))return r.a.createElement(v,{title:"Confluence",logo:re.a.images.import.confluencePng,onClick:()=>this.handleFileUploadClick("confluence"),actionButton:this.renderHelpButtonToURL(Object(Ie.a)("guides.importConfluence"))})}renderEvernoteImportOption(e){return r.a.createElement(De,{evernoteResult:e,analyticsFrom:"onboarding",renderItemActionsButton:this.renderItemActionsButton,defaultActionButton:this.renderHelpButtonToURL(Object(Ie.a)("guides.importEvernote")),onComplete:this.props.onComplete,requestStore:this.stores.evernoteRequestStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore})}renderHelpButtonToURL(e){return r.a.createElement(P.a,{renderTooltip:()=>r.a.createElement(Q.a,{id:"importOptions.helpButton.tooltip",defaultMessage:"Learn about how to import"}),render:t=>r.a.createElement(l.a,Object.assign({external:!0,href:e,style:{marginLeft:"auto"}},t),r.a.createElement(c.a,{icon:ae.a.help}))})}renderItemActionsButton(e){return r.a.createElement(u.a,{popupType:T.b.Popup,renderOrigin:e=>r.a.createElement(c.a,Object.assign({icon:ae.a.dots},e)),render:t=>{const n={key:"section",render:e=>r.a.createElement(k.a,Object.assign({},e)),items:e.map(e=>{let{name:n,action:a}=e;return{key:n,render:e=>r.a.createElement(d.a,Object.assign({},e,{title:n})),action:()=>{a(),t.close()}}})};return r.a.createElement(M.b,{menuType:M.b.MenuType.Popup,width:200},r.a.createElement(C.a,{type:C.a.Type.Vertical,initialFocus:void 0,sections:[n]}))}})}}ze.wrapStyle={display:"flex",alignItems:"center",justifyContent:"center",width:752,minHeight:240},ze.optionsColumnStyle={width:240};var Ve=ze,qe=n(743),He=n(76);class Ge extends i.a{constructor(){super(...arguments),this.handleModalDismiss=()=>{o.a.setState({open:!1})},this.handleImportComplete=e=>{o.a.setState({open:!1}),Pe.h({environment:this.environment,store:e})}}renderComponent(){const e=o.a.state;return r.a.createElement(qe.a,{open:e.open,innerStyle:Ge.wrapStyle,preventHideChildrenWhileOpening:!0,render:()=>r.a.createElement(a.Fragment,null,r.a.createElement("div",{style:Ge.modalTopbarWrapStyle},r.a.createElement("div",{style:Ge.modalTopbarHeaderStyle},r.a.createElement(Q.a,{id:"importModal.importButton.label",defaultMessage:"Import"})),this.renderHelpButton()),r.a.createElement("div",null,this.renderImportOptions(e))),onDismiss:this.handleModalDismiss})}renderHelpButton(){return r.a.createElement(l.a,{href:Object(Ie.a)("guides.import"),onClick:()=>I.B(this.environment,{from:"import"}),external:!0},r.a.createElement(He.a,{isSmall:!0,icon:ae.a.help,isGray:!0},r.a.createElement(Q.a,{id:"importModal.helpButton.label",defaultMessage:"Learn about importing"})))}renderImportOptions(e){const{currentBlockStore:t,currentSpaceStore:n,currentSpaceViewStore:a,currentUserSettingsStore:i}=s.a.state;if(t&&n&&a&&i)return r.a.createElement(Ve,{pageStore:e.open&&e.pageStore?e.pageStore:t,spaceStore:n,spaceViewStore:a,userSettingsStore:i,analyticsFrom:"modal",onComplete:this.handleImportComplete,readOnlyCreditButton:!1})}}Ge.wrapStyle={padding:"24px 36px 24px",minWidth:300},Ge.modalTopbarWrapStyle={display:"flex",alignItems:"center",marginTop:8,marginBottom:18},Ge.modalTopbarHeaderStyle={fontSize:24,lineHeight:1.2,marginBottom:6,fontWeight:g.a.fontWeight.bold,marginRight:"auto"};t.default=Ge},1105:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(3),s=n(743),o=(n(15),n(11),n(183)),l=n(27),c=n(39),d=n(207),u=n(491),p=n(16);class m extends p.a{getInitialState(){return{}}}var h=m,g=n(173),b=n(757),f=n(102),y=n(2),S=n.n(y),v=n(835),E=n(174),M=n(853),C=n(19),O=n(1241),w=n(1),k=n(14);class P extends i.a{renderComponent(){let e;return k.oc(this.environment,{type:"page"}),e=this.environment.PersistedRecordCache?r.a.createElement(w.a,{defaultMessage:"Please go online to load this page, then you'll be able to access it while offline.",id:"pageOfflineIndicator.hasLocalData.message"}):r.a.createElement(w.a,{defaultMessage:"Oops, you seem to be offline. Please go online to view this page.",id:"pageOfflineIndicator.noLocalData.message"}),r.a.createElement("div",{style:this.getContainerStyle()},r.a.createElement("div",{style:this.getGreetingStyle()},e))}isLoggedIn(){return this.environment.currentUser.isLoggedIn()}getTopbarHeight(){const{device:e}=this.environment;return e.isElectronMac?O.a.desktopMacHeight:O.a.defaultHeight}getContainerStyle(){const{device:e}=this.environment;return{height:"100%",minHeight:this.isLoggedIn()?"calc(100vh - ".concat(2*this.getTopbarHeight(),"px)"):"100vh",paddingLeft:e.isMobile?16:32,paddingRight:e.isMobile?16:32,display:"flex",justifyContent:"center",alignItems:"center"}}getGreetingStyle(){const{device:e}=this.environment;return{fontSize:e.isMobile?18:32,marginBottom:8,textAlign:"center",color:C.f.uiBlack,maxWidth:640,lineHeight:1.3}}}var T=P,I=n(840),j=n(147),D=n(301),x=n(7),B=n(847),A=n(143),F=n(17),R=n(462),L=n(265),U=n(364),_=n(71),W=n(237),N=n(636),z=n(68),V=n(277),q=n(81),H=n(391),G=n(127),Y=n(481),Q=n(622),K=n(170),Z=n(553),X=n(259);function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){ee(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class te extends i.a{constructor(){super(...arguments),this.pageContextStore=this.createComputedStore(()=>{const{presenceStore:e,pageVisitStore:t,currentSpaceStore:n,currentSpaceViewStore:a}=F.a.state;return{pageStore:this.props.store,spaceStore:n,spaceViewStore:a,presenceStore:e,pageVisitStore:t,publicEditModeStore:this.publicEditModeStore}}),this.publicEditModeStore=this.createComputedStore(()=>X.a.getMode(this.environment,this.props.store)),this.renderPageSpinner=e=>{if(!e)return;return r.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:0,display:"flex",alignItems:"center",justifyContent:"center"},key:"spinner"},r.a.createElement(f.a,{style:{opacity:.5,width:te.spinnerSize,height:te.spinnerSize}}))},this.renderContent=e=>{const{store:t}=this.props,{pageVisitStore:n,presenceStore:i,currentLoadingContainerStore:s}=F.a.state,o=t.getValue();return o&&o.type===x.a.copyIndicator?r.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:16,marginTop:"12vh"}},r.a.createElement(f.a,null),r.a.createElement("div",{style:{fontSize:14,marginTop:8,color:this.theme.mediumTextColor}},r.a.createElement(w.a,{defaultMessage:"Importing…",id:"frame.importingMessage"}))):this.shouldShowOfflineIndicator(e)?r.a.createElement(T,{store:t}):r.a.createElement(a.Fragment,null,r.a.createElement(d.b,{context:d.a.Frame,store:t,loadingContainerStore:s,paddingBottom:d.b.paddingBottom(this.environment),paddingLeft:d.b.defaultPaddingLeftRight(this.environment),paddingRight:d.b.defaultPaddingLeftRight(this.environment),pageCoverHeight:d.b.defaultPageCoverHeight(this.environment),disabled:!1}),r.a.createElement(I.a,{pageVisitStore:n,presenceStore:i}))},this.handleScrollerMount=e=>{U.a.PageScroller=e},this.isOffline=this.createComputedStore(()=>!q.a.state.online)}willUnmount(){v.a({rootStore:this.props.store})}renderComponent(){const{device:e,RouterStore:t}=this.environment,{isMobile:n}=e,{store:i,collectionViewStore:s,routerState:o}=this.props,{historyState:l}=o,{currentLoadingContainerStore:c,pageVisitStore:d,presenceStore:p,currentSpaceStore:m,currentSpaceViewStore:h}=F.a.state,b=this.shouldShowOfflineIndicator(void 0),y=this.environment.currentUser.isLoggedIn(),v=l&&S.a.isNumber(l.scrollTop)?l.scrollTop:void 0,{currentBlockStore:E}=F.a.state;return r.a.createElement(Q.a,{value:this.pageContextStore.state},r.a.createElement(G.a,{isVisible:!0,animationStyle:{width:this.environment.WindowSizeStore.state.width-Object(H.b)(this.environment)},render:()=>r.a.createElement("div",{style:this.getStyle(),className:z.w},!n&&r.a.createElement(O.a,{store:i,collectionViewStore:s,spaceStore:m,spaceViewStore:h,pageVisitStore:d,presenceStore:p,showSidebarButton:!Object(H.f)(this.environment),isElectron:e.isElectron,isInvalidPage:b,banners:V.a.state.banners}),n&&r.a.createElement(K.k,{store:i,collectionViewStore:s,spaceStore:m,spaceViewStore:h,pageVisitStore:d,presenceStore:p,isInvalidPage:b,shouldShowMoveTo:Boolean(o.route.showMoveTo&&i.canEdit()&&i.isEmptyPage()&&i.isEmptyTitle()&&y),saveParent:Boolean(o.route.saveParent),banners:V.a.state.banners,isOffline:this.isOffline.state}),r.a.createElement(u.a,{store:i,key:i.id,isDefaultContainer:!0,disable:Boolean(_.c.state.open||W.a.state.open),render:e=>r.a.createElement(M.a,{pageStore:i,pageVisitStore:d,scrollToBlockIds:N.a(t),scrollToPosition:v,store:c,onReady:()=>{B.a(this.environment)},onDone:()=>{this.props.store.isCollectionView()||"rendered"===F.a.state.renderPhase||F.a.setState(J({},F.a.state,{renderPhase:"rendered"}))},initialChunkSize:30,incrementChunkSize:30,render:t=>{let{error:n,ready:i,initialRequestCompleted:s,endOfResultsReached:o}=t;return r.a.createElement(a.Fragment,null,r.a.createElement(g.b,Object.assign({ref:this.handleScrollerMount,disableScroll:j.e(this.environment)||!i,type:this.useSeparateHorizontalScroller()?g.a.Y:g.a.All,style:this.getScrollerStyle(i),store:R.a},e),s&&this.renderContent(n),i&&!o&&r.a.createElement(f.a,{style:this.getSpinnerStyle()})),r.a.createElement(D.a,{show:!i,showDelay:100,showHold:0,render:this.renderPageSpinner}))}})}),y&&n&&r.a.createElement(K.e,{position:e.isReactNative?Z.a.Bottom:Z.a.Floating,currentBlockStore:this.props.store}),this.shouldShowMobileBottomBar()&&y&&E&&r.a.createElement(K.f,{store:E}))}))}shouldShowOfflineIndicator(e){const{store:t}=this.props,{currentLoadingContainerStore:n}=F.a.state;return!(!e||!n||n.state.endOfResultsReached)||(!t.getValue()||!t.canRead())}getPageViewBlockBottomPadding(){return"number"==typeof d.b.paddingBottom(this.environment)?"".concat(d.b.paddingBottom(this.environment),"px"):d.b.paddingBottom(this.environment)}shouldShowMobileBottomBar(){const{isTablet:e,isReactNative:t,isAndroid:n}=this.environment.device;return t&&(e||n)}getStyle(){const{device:e}=this.environment,t=J({flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",background:this.theme.contentBackground,zIndex:E.d,height:"100vh",maxHeight:"100%"},e.isTablet&&{position:"relative"},{},_.c.state.open&&Y.a.getMode(this.environment)===_.a?{paddingRight:700}:{});if(!Object(H.a)(this.environment)){const e=L.b.state;Object(H.g)(this.environment)||(t.boxShadow=this.theme.mediumBoxShadow),t.pointerEvents=e?"none":"auto",t.transform="translateX(0)"}return t}useSeparateHorizontalScroller(){return this.props.store.isCollectionView()&&!A.b(this.environment)}getScrollerStyle(e){const t=J({display:"flex",flexDirection:"column",zIndex:1,flexGrow:1,position:"relative"},e?{}:te.hiddenStyle);return this.props.store.isCollectionView()?t:J({},t,{alignItems:"center"})}getSpinnerStyle(){return{zIndex:1,opacity:.5,width:te.spinnerSize,height:te.spinnerSize,marginTop:"calc(-".concat(te.spinnerSize," / 2 - ").concat(this.getPageViewBlockBottomPadding()," / 2)"),marginBottom:24,marginLeft:"auto",marginRight:"auto"}}}te.spinnerSize="1.375em",te.hiddenStyle={opacity:0,pointerEvents:"none",height:0};var ne=te,ae=n(10),re=n(4),ie=n(32),se=n(192),oe=n(1459),le=n(119),ce=n(176),de=n(89),ue=n(165),pe=n(86),me=n(37),he=n(193),ge=n(52),be=n(56),fe=n(351);class ye extends p.a{getInitialState(){return{inMemoryRecordCache:new fe.a}}}function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){Ee(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Me extends i.a{constructor(){super(...arguments),this.storeTypes={store:h,templateRecordCacheStore:ye},this.renderResult=(e,t)=>{const{device:n,WindowSizeStore:a}=this.environment,{navigatedRootId:i}=this.stores.store.state;if(t){let e;return e=i?l.a.createChildStore(t,{table:ae.a,id:i}):t,r.a.createElement("div",{style:this.props.style},r.a.createElement("div",{style:ve({fontSize:14,paddingTop:n.isMobile?4:8,paddingBottom:n.isMobile?4:8,paddingLeft:n.isMobile?10:12,paddingRight:n.isMobile?10:12,height:48,display:"flex",alignItems:"center",flexShrink:0},n.isMobile?{height:44,borderBottom:"\n\t\t\t\t\t\t\t\t\t\t\t1px solid ".concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t\t\t\t\t")}:{})},r.a.createElement(b.a,{store:e,maxAncestorCount:2,ancestorMaxWidth:240,currentPageMaxWidth:240,showCurrentPageControls:!1,isMobile:n.isMobile,style:{flexGrow:1,flexShrink:1,minWidth:0,paddingLeft:a.state.paddingLeftCSS,paddingRight:a.state.paddingRightCSS}}),this.props.topbarRightActionButton),r.a.createElement(u.a,{key:e.id,store:e,isDefaultContainer:!0,render:n=>r.a.createElement(g.b,Object.assign({style:this.getScrollerStyle(),key:e.id,type:this.useSeparateHorizontalScroller(t)?g.a.Y:g.a.All,store:oe.a,disableScroll:j.e(this.environment)},n),r.a.createElement(d.b,{store:e,loadingContainerStore:void 0,context:this.props.isFrontPage?d.a.FrontPageTemplatePreview:d.a.InAppTemplatePreview,paddingBottom:d.b.paddingBottom(this.environment),paddingLeft:d.b.defaultPaddingLeftRight(this.environment),paddingRight:d.b.defaultPaddingLeftRight(this.environment),pageCoverHeight:d.b.defaultPageCoverHeight(this.environment),disabled:this.props.disabled}))}))}return r.a.createElement("div",{style:ve({display:"flex",alignItems:"center",justifyContent:"center"},this.props.style)},r.a.createElement(f.a,{style:{width:ne.spinnerSize,height:ne.spinnerSize}}))},this.handleOverrideLinkClick=e=>{const{device:t}=this.environment,n=Object(ce.k)({url:e,isMobile:t.isMobile,baseUrl:ie.a.baseURL,protocol:ie.a.protocol,currentUrl:window.location.href});"page"===n.name&&(n.peekViewBlockId?this.stores.store.setState(ve({},this.stores.store.state,{navigatedRootId:n.peekViewBlockId})):this.stores.store.setState(ve({},this.stores.store.state,{navigatedRootId:n.blockId})))},this.performRequest=async e=>{const t=await c.wb(this.environment,{blockId:e,shallow:!1});if("failed"===t.type)throw t.error;const{currentSpaceStore:n}=F.a.state,{data:a}=le.a.state,{inMemoryRecordCache:r}=this.stores.templateRecordCacheStore.state;r.reset(),r.isTemplatePreview=!0;const i=new Set,s=new Set,o=new be.a(t.data.subtreeRecordMap);for(const{pointer:l,value:c}of o){if(!c)return;if(r.setRecord({pointer:l,userId:this.environment.currentUser.id},{role:"editor",value:c.value}),"block"===l.table){const e=c.value;if(e){const t=e.properties||{};for(const e of Object.keys(t)){const n=Object(re.kb)(t[e]);for(const e of n)i.add(e);const a=Object(re.H)(t[e]);for(const e of a)s.add(e)}e.created_by_table&&e.created_by_id&&(e.created_by_table===me.a?i.add(e.created_by_id):s.add(e.created_by_id)),e.last_edited_by_table&&e.last_edited_by_id&&(e.last_edited_by_table===me.a?i.add(e.last_edited_by_id):s.add(e.last_edited_by_id))}}}if(a)for(const l of Object(de.v)(a))i.add(l.userId);const d=await Promise.all(Array.from(i).map(async e=>{if(n){const t=se.a.createChildStore(n,{table:me.a,id:e});return await t.load(),t.getValue()}{const t=await c.jc(this.environment,{table:me.a,id:e,userId:this.environment.currentUser.id,version:-1});return t&&t.value}}));for(const l of d)l&&r.setRecord({pointer:{table:me.a,id:l.id},userId:this.environment.currentUser.id},{role:"reader",value:l});const u=await Promise.all(Array.from(s).map(async e=>{if(n){const t=Object(ge.c)(n,{table:he.a,id:e});return await t.load(),t.getValue()}{const t=await c.jc(this.environment,{table:he.a,id:e,userId:this.environment.currentUser.id,version:-1});return t&&t.value}}));for(const l of u)l&&r.setRecord({pointer:{table:he.a,id:l.id},userId:this.environment.currentUser.id},{role:"reader",value:l});const{currentUserStore:p}=F.a.state;return p&&(await p.load(),r.setRecord({pointer:p.pointer,userId:this.environment.currentUser.id},{role:"editor",value:p.getValue()})),new l.a(this.environment,{table:ae.a,id:e},{inMemoryRecordCache:r})}}getChildContext(){return ve({},this.context,{overrideLinkClick:this.handleOverrideLinkClick})}renderComponent(){return q.a.state.online?r.a.createElement(o.a,{request:this.props.previewRootId,performRequest:this.performRequest,render:this.renderResult}):r.a.createElement("div",{style:ve({display:"flex",alignItems:"center",justifyContent:"center"},this.props.style)},r.a.createElement(pe.a,{isSmall:!0},r.a.createElement(w.a,{defaultMessage:"Please go online to view this template.",id:"pageTemplatePreview.offline.message"})))}useSeparateHorizontalScroller(e){return e.isCollectionView()&&!A.b(this.environment)}getScrollerStyle(){const{device:e}=this.environment;return ve({flex:1},e.isSafari&&{zIndex:1})}}Me.contextTypes=i.b,Me.childContextTypes=ue.a;var Ce=Me,Oe=n(247),we=n(639),ke=n(1145),Pe=n(23),Te=n(412),Ie=n(12),je=n(94),De=n(45),xe=n(273),Be=n(54),Ae=n(285),Fe=n(34),Re=n(8),Le=n(110);function Ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(n),!0).forEach((function(t){We(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function We(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ne extends i.a{constructor(){super(...arguments),this.storeTypes={mouseStore:Le.a,labelMouseStore:Le.a},this.handleToggleClick=()=>{const{section:e}=this.props;this.isOpen()?Te.e(e.sectionName):Te.g(e.sectionName)},this.handleMouseMove=()=>this.stores.mouseStore.setState(_e({},this.stores.mouseStore.state,{mouseEntered:!0})),this.handleMouseLeave=()=>this.stores.mouseStore.setState(_e({},this.stores.mouseStore.state,{mouseEntered:!1})),this.handleLabelMouseMove=()=>{const{labelMouseStore:e}=this.stores;e.setState(_e({},e.state,{mouseEntered:!0}))},this.handleLabelMouseLeave=()=>{const{labelMouseStore:e}=this.stores;e.setState(_e({},e.state,{mouseEntered:!1}))}}renderComponent(){const{renderSection:e}=this.props,t=!this.isOpen();return r.a.createElement("div",{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,style:this.getButtonContainerStyle()},this.renderLabel(),!t&&e())}renderLabel(){const e=!this.isOpen();return r.a.createElement(ke.a,{isMobile:this.props.isMobile,disableMobileBorder:e,shouldShowMobileMarginBotton:e,style:this.getSectionSidebarItemStyle(),childrenStyle:{overflow:"visible"}},r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement(Fe.a,{onClick:this.handleToggleClick,onMouseMove:this.handleLabelMouseMove,onMouseLeave:this.handleLabelMouseLeave,style:this.getLabelButtonStyle()},!Boolean(this.props.forceOpen)&&Re.a.triangle(this.getArrowStyle()),r.a.createElement("span",{style:this.getToggleButtonStyle()},this.props.icon&&r.a.createElement("span",{style:{paddingRight:4,display:"inline-block"}},this.props.icon),this.props.section.name))))}isOpen(){const{section:e,expandedSections:t}=this.props;return!!t&&-1!==t.indexOf(e.sectionName)}getSectionSidebarItemStyle(){return{minHeight:24,padding:0}}getSectionLabelStyle(){return{lineHeight:1,marginBottom:1,color:this.theme.sidebarTextColor,fontWeight:Pe.a.fontWeight.semibold,marginLeft:9}}getMobileSectionLabelStyle(){return{lineHeight:1,color:this.theme.sidebarTextColor,fontWeight:Pe.a.fontWeight.semibold,marginLeft:9}}getLabelButtonStyle(){return _e({display:"flex",alignItems:"center",paddingBottom:12,paddingTop:12,paddingLeft:25},this.props.isMobile&&{marginBottom:8},{width:"100%"})}getToggleButtonStyle(){const{labelMouseStore:e}=this.stores,{mouseEntered:t}=e.state;return _e({},this.props.isMobile?this.getMobileSectionLabelStyle():this.getSectionLabelStyle(),{color:t?this.theme.regularTextColor:this.theme.mediumTextColor,transition:"color 100ms ease-out"})}getButtonContainerStyle(){const e=!this.isOpen(),{first:t}=this.props;return _e({},t?{borderTop:"1px solid ".concat(this.theme.regularDividerColor)}:{},{borderBottom:"1px solid ".concat(this.theme.regularDividerColor),width:"100%",paddingBottom:e?0:10})}getArrowStyle(){return{width:"0.6875em",height:"0.6875em",transition:"transform 200ms ease-out",transform:"rotateZ(".concat(this.isOpen()?180:90,"deg)"),fill:this.theme.regularIconColor}}}var ze=Ne,Ve=n(41),qe=n(79),He=n(100);class Ge extends i.a{constructor(){super(...arguments),this.storeTypes={templateRecordCacheStore:ye},this.renderMobilePopup=()=>{const e=W.a.state;if(e.open)return r.a.createElement(je.default,{title:r.a.createElement(w.a,{defaultMessage:"Try this template",id:"pageTemplateModal.mobileModal.title"}),left:r.a.createElement(je.CancelMenuText,null),onClickLeft:this.handleDismiss,right:e.isLoading?r.a.createElement(f.a,null):r.a.createElement(w.a,{defaultMessage:"Use",id:"pageTemplateModal.mobileModal.useButton.label",description:"'Use' is utilized as a verb for a button label on the top right of a mobile menu, indicating to the user to click on the button to use the template they are previewing."}),onClickRight:this.handleUseTemplateClick,forceFullScreenSlideUp:!0},this.renderPreview(e))},this.renderModal=()=>{const e=W.a.state;if(e.open)return r.a.createElement("div",{style:Ge.modalStyle,className:z.S},this.renderPreview(e),this.renderSidebar(e))},this.handleDismiss=async()=>{const{inMemoryRecordCache:e}=this.stores.templateRecordCacheStore.state;if(e.appliedTransaction){await this.showEditConfirmDialog()?this.accept(!0):this.close()}else this.close()},this.handleUseTemplateClick=async()=>{const{inMemoryRecordCache:e}=this.stores.templateRecordCacheStore.state;if(e.appliedTransaction){await this.showEditConfirmDialog()?this.accept(!0):this.accept(!1)}else this.accept(!1)},this.handleItemClick=async e=>{const{inMemoryRecordCache:t}=this.stores.templateRecordCacheStore.state;if(t.appliedTransaction){await this.showEditConfirmDialog()?this.accept(!0):this.setCurrentItem(e)}else this.setCurrentItem(e);k.ie(this.environment,{name:e.name})}}willMountOrUpdate(){const e=W.a.state,{currentSpaceViewStore:t}=F.a.state;e.open&&t&&Ie.d(this.environment,n=>{Te.j({item:e.item,spaceViewStore:t,transaction:n})})}renderComponent(){const{device:e}=this.environment,t=W.a.state;return e.isMobile?r.a.createElement(De.a,{open:t.open,render:this.renderMobilePopup,forceFullScreenSlideUp:!0,onDismiss:this.handleDismiss,popupType:e.isMobile?De.a.PopupType.SlideUp:De.a.PopupType.Popup}):r.a.createElement(s.a,{open:t.open,render:this.renderModal,onDismiss:this.handleDismiss})}renderSidebar(e){const{currentSpaceViewStore:t,currentSpaceStore:n}=F.a.state;if(!t||!n)return;const i=Te.d(),s=Object(Oe.a)(this.props.intl),o="on"===He.a.getGroup(this.environment,"suggested-templates");return r.a.createElement("div",{style:this.getSidebarStyle()},r.a.createElement(Ae.a,{isLarge:!0,onClick:this.handleUseTemplateClick,style:Ge.useTemplateButtonStyle,disabled:e.isLoading||!q.a.state.online},e.isLoading&&r.a.createElement(f.a,{isWhite:!0,style:{marginRight:6}}),r.a.createElement(w.a,{defaultMessage:"Use this template",id:"pageTemplateModal.useTemplateButton.label"})),r.a.createElement(g.b,{style:Ge.scrollerStyle,type:g.a.Y},o&&r.a.createElement(ze,{isMobile:!1,key:"suggested",section:s,expandedSections:[...i||[],"suggested"],spaceStore:n,spaceViewStore:t,showAddPageButton:!1,first:!0,forceOpen:!0,icon:Re.a.sparkles({width:12}),renderSection:()=>r.a.createElement(a.Fragment,null,s.items.map((t,n)=>{const a=e.item.rootId===t.rootId,i=a?this.hoveredButtonStyle():{};return r.a.createElement(Fe.a,Object.assign({hovered:a,style:i,key:n},this.props,{onClick:()=>this.handleItemClick(t)}),this.renderSidebarItem(t))}))}),e.sections.map((s,l)=>r.a.createElement(ze,{isMobile:!1,key:s.sectionName,section:s,expandedSections:i,spaceStore:n,spaceViewStore:t,showAddPageButton:!1,first:!o&&0===l,renderSection:()=>r.a.createElement(a.Fragment,null,s.items.map((t,n)=>{const a=e.item.rootId===t.rootId,i=a?this.hoveredButtonStyle():{};return r.a.createElement(Fe.a,Object.assign({hovered:a,style:i,key:n},this.props,{onClick:()=>this.handleItemClick(t)}),this.renderSidebarItem(t))}))})),r.a.createElement(Fe.a,{onClick:()=>Object(Ve.i)({environment:this.environment,url:qe.d.templates}),style:this.fixedLinkStyle(),hoveredStyle:{background:this.theme.sidebarHideButtonHoveredBackground},pressedStyle:{background:this.theme.sidebarHideButtonPressedBackground}},Re.a.typesRelation(this.fixedLinkIconStyle()),r.a.createElement(w.a,{defaultMessage:"Browse more templates",id:"pageTemplateModal.goToFullTemplateGalleryButton.label"}))))}renderSidebarItem(e){return r.a.createElement(ke.a,{style:{paddingLeft:30,fontWeight:Pe.a.fontWeight.semibold},isMobile:!1,icon:r.a.createElement("div",{style:this.getIconWrapStyle()},r.a.createElement(we.a,{size:20,emoji:e.emoji}))},e.name)}renderPreview(e){const{device:t}=this.environment;return r.a.createElement(Ce,{key:e.item.previewRootId,previewRootId:e.item.previewRootId,isFrontPage:!1,style:t.isMobile?Ge.previewMobileStyle:Ge.previewStyle,templateRecordCacheStore:this.stores.templateRecordCacheStore,disabled:!1})}accept(e){const{inMemoryRecordCache:t}=this.stores.templateRecordCacheStore.state,n=W.a.state,{currentSpaceViewStore:a,currentSpaceStore:r,currentBlockStore:i}=F.a.state;if(n.open&&a&&r){const s=i&&i.isEmptyPage()?i:void 0,o=_.c.state.open&&_.c.state.target&&_.c.state.target.isEmptyPage()?_.c.state.target:void 0;Te.a({environment:this.environment,item:n.item,spaceStore:r,spaceViewStore:a,useRecordCache:e?t:void 0,initializeStore:n.createNewPage?void 0:s||o,isPrivate:n.isPrivate})}}close(){Te.b(this.environment),xe.a()}setCurrentItem(e){W.a.state.open&&Te.i({templateItem:e,currentUserId:this.environment.currentUser.id})}showEditConfirmDialog(){return new Promise((e,t)=>{Be.c({message:r.a.createElement(w.a,{id:"pageTemplateModal.modifiedTemplateDialog.prompt",defaultMessage:"It looks like you've modified the template. Would you like to save your edits?"}),showCancel:!1,keepFocus:!0,items:[{label:r.a.createElement(w.a,{id:"pageTemplateModal.modifiedTemplateDialog.saveButton.label",defaultMessage:"Save edits"}),onAccept:()=>{e(!0)}},{label:r.a.createElement(w.a,{id:"pageTemplateModal.modifiedTemplateDialog.discardEditsButton.label",defaultMessage:"Discard"}),color:"red",onAccept:()=>{e(!1)}}]})})}getSidebarStyle(){return{width:Ge.sidebarWidth,color:this.theme.mediumTextColor,background:this.theme.sidebarBackground,display:"flex",flexDirection:"column",borderTopRightRadius:Ge.borderRadius,borderBottomRightRadius:Ge.borderRadius}}getIconWrapStyle(){return{color:this.theme.regularTextColor,position:"relative"}}hoveredButtonStyle(){return{color:this.theme.regularTextColor,fontWeight:Pe.a.fontWeight.medium}}fixedLinkStyle(){return{padding:12,color:this.theme.mediumTextColor,background:this.theme.sidebarBackground,fontSize:13,fontWeight:Pe.a.fontWeight.medium,display:"flex",alignItems:"center",position:"absolute",bottom:0,right:0,height:45,width:Ge.sidebarWidth,borderTop:"1px solid ".concat(this.theme.regularDividerColor)}}fixedLinkIconStyle(){return{width:12,height:12,marginLeft:8,marginRight:10,marginBottom:0,fill:this.theme.regularIconColor,fontWeight:Pe.a.fontWeight.medium}}}Ge.sidebarWidth=240,Ge.borderRadius=3,Ge.modalStyle={display:"flex",width:"85vw",height:"85vh",borderRadius:Ge.borderRadius},Ge.useTemplateButtonStyle={position:"relative",marginTop:16,marginLeft:20,marginRight:20,marginBottom:16,whiteSpace:"nowrap"},Ge.previewStyle={width:"calc(100% - ".concat(Ge.sidebarWidth,"px)"),flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",overflow:"hidden"},Ge.previewMobileStyle={width:"100%",flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",overflow:"hidden"},Ge.scrollerStyle={flexGrow:1,flexShrink:1,paddingBottom:44};t.default=Object(w.g)(Ge)},1106:function(e,t,n){"use strict";n.r(t);n(15),n(11);var a=n(2),r=n.n(a),i=n(0),s=n.n(i),o=n(8),l=n(288),c=n(171),d=n(3),u=n(696),p=n(14),m=n(734),h=n(19),g=n(23),b=n(40),f=n(183),y=n(55),S=n(24),v=n(589),E=n(53),M=n(22),C=n(155),O=n(506),w=n(89),k=n(84),P=n(119),T=n(285),I=n(68),j=n(695),D=n(359),x=n(37),B=n(146),A=n(156),F=n(747),R=n(1),L=n(29);class U extends d.a{constructor(){super(...arguments),this.handleClickRemove=()=>{this.props.onClickRemove(this.props.target)}}renderComponent(){const{device:e}=this.environment;return s.a.createElement(B.b,{showRemoveButton:!0,isSingle:!1,format:e.isMobile?B.b.Format.Large:B.b.Format.Medium,onClickRemove:this.handleClickRemove,value:this.getTokenText()})}getTokenText(){const{target:e}=this.props;switch(e.type){case"newUser":return e.value.email.trim();case"existingUser":return Object(x.d)(e.value);case"bot":return Object(A.a)(e.value);case"group":return Object(F.a)({intl:this.props.intl,group:e.value});default:Object(L.e)(e)}}}var _=Object(R.g)(U),W=n(96),N=n(36),z=n(139),V=n(822),q=n(94),H=n(161),G=n(360);class Y extends d.a{renderComponent(){return s.a.createElement(S.a,Object.assign({},this.props,{title:s.a.createElement(R.a,{id:"inviteUserModal.searchDropdown.selectPersonTitle",defaultMessage:"Select a person"})}))}}var Q=n(159),K=n(133),Z=n(258),X=n(20),$=n(1463),J=n(34);function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){ne(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ae extends d.a{renderComponent(){return s.a.createElement(J.a,{hovered:this.props.hovered,onClick:this.props.onClick,disabled:this.props.disabled,disabledFeedback:!0,style:te({},this.getButtonStyle(),{},this.props.isLarge&&{height:32},{},this.props.style),hoveredStyle:{background:this.theme.buttonHoveredBackground},pressedStyle:{background:this.theme.buttonPressedBackground},onMouseDown:this.props.onMouseDown,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,className:this.props.className},this.props.children)}getButtonStyle(){return{display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,whiteSpace:"nowrap",height:28,borderRadius:3,boxShadow:this.theme.plainButtonBoxShadow,background:this.theme.inputBackground,color:this.theme.mediumTextColor,fill:h.f.white,lineHeight:1.2,paddingLeft:12,paddingRight:12,fontSize:14}}}var re=ae,ie=n(90),se=n(17),oe=n(91),le=n(58),ce=n(10);function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(Object(n),!0).forEach((function(t){pe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class me extends d.a{constructor(){super(...arguments),this.storeTypes={permissionsInviteStore:m.a},this.renderOverlay=()=>{const{permissionsInviteStore:e}=this.stores,{tokenQuery:t}=e.state,n=Object(oe.n)(this.props.store),a=e.state.inviteTargets.map(e=>{const t="newUser"===e.type?e.value.email:"".concat(e.type,"-").concat(e.value.id);return s.a.createElement(_,{key:t,target:e,onClickRemove:this.handleClickRemoveToken})}),l={request:t,performRequest:async e=>{const[t,a,i,{user:s,email:o}]=await Promise.all([c.l({environment:this.environment,query:e,membersOnly:this.props.membersOnly}),c.j({environment:this.environment,query:e}),n?c.k({query:e,intl:this.props.intl}):[],c.d(this.environment,e)]),l=t.slice(0,10).map(e=>({type:"existingUser",value:e})),d=a.slice(0,10).map(e=>({type:"bot",value:e})),u=i.slice(0,10).map(e=>({type:"group",value:e}));return s&&l.push({type:"existingUser",value:s}),o&&l.push({type:"newUser",value:{email:o}}),{inviteUsers:r.a.uniqBy(l,e=>e.value.email),inviteBots:d,inviteGroups:u}},render:(e,a,r)=>{if(e)return s.a.createElement(Y,{loading:!r},s.a.createElement(C.a,{title:s.a.createElement(R.a,{id:"inviteUserModal.searchInput.errorMessage",defaultMessage:"Something went wrong"})}));const i=(a&&a.inviteUsers||[]).filter(e=>!this.alreadyInvitingTarget(e)&&!("existingUser"===e.type&&this.targetHasPermission(e))),l=(a&&a.inviteBots||[]).filter(e=>!this.alreadyInvitingTarget(e)&&!this.targetHasPermission(e)),c=(a&&a.inviteGroups||[]).filter(e=>!this.alreadyInvitingTarget(e)&&!this.targetHasPermission(e)),{data:d}=P.a.state,u=i.map(e=>({key:"newUser"===e.type?e.value.email:e.value.id,render:t=>{const n=d?w.v(d):[],a="existingUser"===e.type&&n.find(t=>t.userId===e.value.id);let r;return a&&Object(N.a)(a.role)?r=s.a.createElement(b.a,{renderTooltip:()=>s.a.createElement(R.a,{id:"inviteUserModal.userRole.adminBadge.tooltip",defaultMessage:"This person is an admin in this workspace"}),render:e=>s.a.createElement("div",Object.assign({style:this.getBadgeStyle()},e),s.a.createElement(R.a,{id:"inviteUserModal.userRole.adminBadge.label",defaultMessage:"Admin"}))}):a&&Object(N.c)(a.role)?r=s.a.createElement(b.a,{renderTooltip:()=>s.a.createElement(R.a,{id:"inviteUserModal.userRole.memberBadge.tooltip",defaultMessage:"This person is a member in this workspace"}),render:e=>s.a.createElement("div",Object.assign({style:this.getBadgeStyle()},e),s.a.createElement(R.a,{id:"inviteUserModal.userRole.memberBadge.label",defaultMessage:"Member"}))}):a&&(r=s.a.createElement(b.a,{renderTooltip:()=>s.a.createElement(R.a,{id:"inviteUserModal.userRole.guest.tooltip",defaultMessage:"This person is a guest in this workspace"}),render:e=>s.a.createElement("div",Object.assign({style:this.getBadgeStyle()},e),s.a.createElement(R.a,{id:"inviteUserModal.userRole.guestBadge.label",defaultMessage:"Guest"}))})),"existingUser"===e.type?s.a.createElement(v.a,Object.assign({},t,{user:e.value,right:r})):s.a.createElement(E.a,Object.assign({},t,{icon:o.a.mail({width:me.avatarSize,height:me.avatarSize}),right:r,title:e.value.email.trim()}))},action:()=>{const{permissionsInviteStore:t}=this.stores;!t.state.isInviteTargetsEmpty&&Object(m.c)(t.state)||t.setState(ue({},t.state,{inviteTargets:[...t.state.inviteTargets,e],isInviteTargetsEmpty:!1,tokenQuery:""}))}})),p=l.map(e=>{const{value:t}=e;return{key:t.id,render:e=>{const n=(d?w.n(d):[]).find(e=>e.botId===t.id);let a;return n&&Object(N.a)(n.role)?a=s.a.createElement(b.a,{renderTooltip:()=>"This bot is an admin in this workspace",render:e=>s.a.createElement("div",Object.assign({style:this.getBadgeStyle()},e),"Admin")}):n&&Object(N.c)(n.role)?a=s.a.createElement(b.a,{renderTooltip:()=>"This bot is a member in this workspace",render:e=>s.a.createElement("div",Object.assign({style:this.getBadgeStyle()},e),"Member")}):n&&(a=s.a.createElement(b.a,{renderTooltip:()=>"This bot is a guest in this workspace",render:e=>s.a.createElement("div",Object.assign({style:this.getBadgeStyle()},e),"Guest")})),s.a.createElement(V.a,Object.assign({},e,{bot:t,right:a}))},action:()=>{const{permissionsInviteStore:t}=this.stores;(t.state.isInviteTargetsEmpty||Object(m.c)(t.state))&&(t.state.table===ce.a?this.stores.permissionsInviteStore.setState(ue({},t.state,{inviteTargets:[...t.state.inviteTargets,e],inviteRole:this.getDefaultRoleForBlockBot(),isInviteTargetsEmpty:!1,tokenQuery:"",table:t.state.table})):t.state.table===le.a?this.stores.permissionsInviteStore.setState(ue({},t.state,{inviteTargets:[...t.state.inviteTargets,e],inviteRole:this.getDefaultRoleForSpaceBot(),isInviteTargetsEmpty:!1,tokenQuery:"",table:t.state.table})):Object(L.e)(t.state.table))}}}),{currentSpaceStore:h}=se.a.state,f=c.map(e=>{const{value:t}=e,n=Object(F.a)({intl:this.props.intl,group:t}),a=h&&t.icon?{table:h.table,id:h.id,icon:t.icon}:void 0;return{key:t.id,render:e=>s.a.createElement(E.a,Object.assign({},e,{icon:s.a.createElement(ie.a,{disabled:!0,size:22,icon:a,isEmptyPage:!1,title:n}),title:n})),action:()=>{const{permissionsInviteStore:t}=this.stores;!t.state.isInviteTargetsEmpty&&Object(m.c)(t.state)||t.setState(ue({},t.state,{inviteTargets:[...t.state.inviteTargets,e],isInviteTargetsEmpty:!1,tokenQuery:""}))}}}),M=[],{permissionsInviteStore:O}=this.stores;if(u.length>0&&(O.state.isInviteTargetsEmpty||!Object(m.c)(O.state))&&M.push({key:"user results",render:e=>s.a.createElement(Y,Object.assign({},e,{loading:!r})),items:u}),p.length>0&&(O.state.isInviteTargetsEmpty||Object(m.c)(O.state))&&M.push({key:"bot results",render:e=>s.a.createElement(S.a,Object.assign({},e,{title:"Select a bot",loading:!r})),items:p}),n&&f.length>0&&(O.state.isInviteTargetsEmpty||!Object(m.c)(O.state))&&M.push({key:"group results",render:e=>s.a.createElement(S.a,Object.assign({},e,{title:s.a.createElement(R.a,{id:"inviteUserModal.searchDropdown.selectGroupTitle",defaultMessage:"Select a group"}),loading:!r})),items:f}),0===M.length&&(O.state.isInviteTargetsEmpty||!Object(m.c)(O.state))){const e=Object(j.b)(O.state.tokenQuery);if(e){const t={type:"newUser",value:{email:e}},n=this.alreadyInvitingTarget(t);if(!n)return;if(n)return s.a.createElement(Y,{loading:!r},s.a.createElement(C.a,{title:s.a.createElement(R.a,{id:"inviteUserModal.userAlreadyInvitedMessage",defaultMessage:"Already inviting {user}.",values:{user:s.a.createElement("span",{style:{fontWeight:g.a.fontWeight.bold}},this.getTargetName(n))}})}));const i=(a&&a.inviteUsers||[]).find(t=>"existingUser"===t.type&&t.value.email===e);if(i&&"existingUser"===i.type&&this.targetHasPermission(i))return s.a.createElement(Y,{loading:!r},s.a.createElement(C.a,{title:s.a.createElement(R.a,{id:"inviteUserModal.userAlreadyHasPermissionMessage",defaultMessage:"{user} already has permission.",values:{user:s.a.createElement("span",{style:{fontWeight:g.a.fontWeight.bold}},Object(x.d)(i.value))}})}))}return s.a.createElement(Y,{loading:!r},s.a.createElement(C.a,{title:s.a.createElement(R.a,{id:"inviteUserModal.searchPersonDropdown.noSearchResultsMessage",defaultMessage:"Type or paste in emails above, separated by commas."})}))}return s.a.createElement(y.a,{type:y.a.Type.Vertical,initialFocus:t.length>0?0:void 0,sections:M})}},{device:d}=this.environment,u=Object(oe.p)(this.props.store)?this.props.intl.formatMessage({id:"inviteUserModal.searchInput.placeholder",defaultMessage:"Search name or emails"}):this.props.intl.formatMessage({id:"permissionsInvite.searchInput.placeholder",defaultMessage:"Search emails, names, or groups"}),p=s.a.createElement(O.a,{focus:!d.isMobile||void 0,focusInitial:d.isMobile,focusAfterAnimation:!0,format:O.a.Format.Share,value:t,onChange:this.handleInputChange,type:"email",tokens:a,disabled:!1,placeholder:u,onRemoveLastToken:()=>{const e=ue({},this.stores.permissionsInviteStore.state);e.inviteTargets=e.inviteTargets.slice(0,-1),0===e.inviteTargets.length&&(e.isInviteTargetsEmpty=!0,e.inviteRole=this.getDefaultRoleForNonBot()),this.stores.permissionsInviteStore.setState(e)},right:!d.isMobile&&this.renderDesktopInputRightInner(),onEmptyEnter:this.handleInviteClick,dontShowBorderBottom:d.isAndroid});let k;return k=d.isMobile?{menuType:M.b.MenuType.Modal,title:Object(oe.p)(this.props.store)?s.a.createElement(R.a,{id:"inviteUserModal.addMemberMenu.title",defaultMessage:"Add members"}):s.a.createElement(R.a,{id:"inviteUserModal.invitePersonMenu.title",defaultMessage:"Invite a person"}),right:s.a.createElement("div",{style:{color:h.f.blue}},s.a.createElement(R.a,{id:"inviteUserModal.mobile.inviteButton.label",defaultMessage:"Invite"})),left:s.a.createElement(q.CancelMenuText,null),onClickLeft:this.handleModalDismiss,onClickRight:this.handleInviteClick,header:p}:{menuType:M.b.MenuType.Popup,width:480,height:"60vh",header:p,tokenInputHeader:!0,footer:this.renderHelpButton()},s.a.createElement(M.b,Object.assign({},k,{className:I.z}),s.a.createElement(i.Fragment,null,d.isMobile&&s.a.createElement(S.a,{title:s.a.createElement(R.a,{id:"inviteUserModal.permissionLevel.title",defaultMessage:"Permission level"})},this.renderDesktopInputRightInnerSelect()),s.a.createElement(f.a,Object.assign({},l)),d.isMobile&&this.renderHelpButton()))},this.handleTrialClick=()=>{G.a(this.environment,{from:this.props.upgradeButtonName,for:"team_free"}),this.props.onUpgradeButtonClick&&this.props.onUpgradeButtonClick()},this.handleUpgradeClick=()=>{G.a(this.environment,{from:this.props.upgradeButtonName,for:"team"}),this.props.onUpgradeButtonClick&&this.props.onUpgradeButtonClick()},this.handleButtonClick=()=>{this.stores.permissionsInviteStore.setState({modalOpen:!0,tokenQuery:"",inviteTargets:[],inviteRole:this.getDefaultRoleForNonBot(),isInviteTargetsEmpty:!0,table:Object(oe.p)(this.props.store)?le.a:ce.a}),Object(oe.p)(this.props.store)?p.Xc(this.environment):p.Pc(this.environment)},this.handleInviteClick=async()=>{const{store:e}=this.props,{permissionsInviteStore:t}=this.stores,{tokenQuery:n}=t.state;if(Object(j.c)(n.trim())&&(t.state.isInviteTargetsEmpty||!Object(m.c)(t.state))){const e={type:"newUser",value:{email:n.trim()}};this.alreadyInvitingTarget(e)||t.setState(ue({},t.state,{inviteTargets:[...t.state.inviteTargets,e],isInviteTargetsEmpty:!1,tokenQuery:""}))}if(!t.state.isInviteTargetsEmpty&&t.state.inviteTargets.length>0)if(this.props.onInviteClick&&this.props.onInviteClick(),Object(m.c)(t.state))if(t.state.table===ce.a){if(!Object(oe.n)(e))throw new Error("Table mismatch.");const{inviteTargets:n,inviteRole:a}=t.state;t.reset(),await l.c({environment:this.environment,store:e,inviteTargets:n,inviteRole:a,isOnboarding:!1})}else if(t.state.table===le.a){if(!Object(oe.p)(e))throw new Error("Table mismatch.");const{inviteTargets:n,inviteRole:a}=t.state;t.reset(),await l.c({environment:this.environment,store:e,inviteTargets:n,inviteRole:a,isOnboarding:!1})}else Object(L.e)(t.state);else{const{inviteTargets:n,inviteRole:a}=t.state;t.reset(),await l.c({environment:this.environment,store:e,inviteTargets:n,inviteRole:a,isOnboarding:!1})}this.props.onInviteComplete&&this.props.onInviteComplete()},this.handleModalDismiss=()=>{this.stores.permissionsInviteStore.setState(ue({},this.stores.permissionsInviteStore.state,{modalOpen:!1}))},this.handleInputChange=e=>{if(!this.stores.permissionsInviteStore.state.isInviteTargetsEmpty&&Object(m.c)(this.stores.permissionsInviteStore.state))return;const t=e.target.value,{extractedEmails:n,newInputValue:a}=Object(j.a)(t),r=n.map(e=>({type:"newUser",value:{email:e}})).filter(e=>!this.alreadyInvitingTarget(e)),i=[...this.stores.permissionsInviteStore.state.inviteTargets,...r];i.length>0?this.stores.permissionsInviteStore.setState(ue({},this.stores.permissionsInviteStore.state,{inviteTargets:i,isInviteTargetsEmpty:!1,tokenQuery:a})):this.stores.permissionsInviteStore.setState(ue({},this.stores.permissionsInviteStore.state,{inviteTargets:[],isInviteTargetsEmpty:!0,tokenQuery:a}))},this.handleClickRemoveToken=e=>{const{permissionsInviteStore:t}=this.stores;if(!t.state.isInviteTargetsEmpty)if(Object(m.c)(t.state))if(Object(m.c)(t.state)){const n=t.state.inviteTargets.filter(t=>t!==e);0===n.length?t.setState(ue({},t.state,{inviteTargets:[],inviteRole:this.getDefaultRoleForNonBot(),isInviteTargetsEmpty:!0})):t.setState(ue({},t.state,{inviteTargets:n}))}else Object(L.e)(t.state);else{const n=t.state.inviteTargets.filter(t=>t!==e);0===n.length?t.setState(ue({},t.state,{inviteTargets:[],inviteRole:this.getDefaultRoleForNonBot(),isInviteTargetsEmpty:!0})):t.setState(ue({},t.state,{inviteTargets:n}))}}}async willMount(){await k.e(this.environment)}renderComponent(){const{store:e}=this.props,{device:t}=this.environment,{modalOpen:n}=this.stores.permissionsInviteStore.state;let a,r,i=!1;return e.canAdmin()?e.canAdmin()&&Object(oe.p)(e)&&P.a.state.data&&!w.J(this.environment)?(a=!1,i=!0,r=s.a.createElement(Z.a,{imageURL:X.a.images.tooltips.upsells.spaceReadAndWritePng,imageWidth:240,imageHeight:100,caption:s.a.createElement(R.a,{defaultMessage:"Members are teammates you invite to your workspace. They can access and add pages for all members to see, or be added to pages with permissions for private collaboration.",id:"permissionsInvite.spaceAddMemberUpgradeTooltip.caption"}),title:s.a.createElement(R.a,{defaultMessage:"Upgrade to add members",id:"permissionsInvite.spaceAddMemberUpgradeTooltip.title"})})):a=!0:(a=!1,r=Object(oe.p)(e)?s.a.createElement(R.a,{id:"inviteUserButton.tooltip.adminsOnlyMessage",defaultMessage:"Only admins can add members."}):s.a.createElement(R.a,{id:"inviteUserButton.tooltip.fullAccessOnlyMessage",defaultMessage:"Only those with full access can add people."})),s.a.createElement("div",null,Object(oe.p)(e)?s.a.createElement($.a,{open:n,onDismiss:this.handleModalDismiss,renderContent:this.renderOverlay,origin:s.a.createElement(b.a,{renderTooltip:()=>r,disableTooltip:a,render:e=>s.a.createElement(T.a,Object.assign({isLarge:!0,onClick:i?this.handleTrialClick:this.handleButtonClick,disabled:!a&&!i,style:ue({flex:this.props.shouldGrow?1:0},this.props.buttonStyle)},e),s.a.createElement(R.a,{id:"inviteUserButton.addMemberLabel",defaultMessage:"Add members"}))})}):s.a.createElement($.a,{open:n,onDismiss:this.handleModalDismiss,renderContent:this.renderOverlay,origin:s.a.createElement(b.a,{renderTooltip:()=>r,disableTooltip:a,render:e=>s.a.createElement("div",{style:{display:"flex",alignItems:"center"}},s.a.createElement(re,{onClick:i?this.handleTrialClick:this.handleButtonClick,disabled:!a&&!i,style:{flex:1,justifyContent:"flex-start",height:t.isMobile?34:26,borderTopRightRadius:0,borderBottomRightRadius:0}},s.a.createElement(R.a,{defaultMessage:"Add people, groups, or emails",id:"inviteUserButton.addGuestsAndGroupsLabel"})),s.a.createElement(T.a,Object.assign({onClick:i?this.handleTrialClick:this.handleButtonClick,disabled:!a&&!i,style:{height:t.isMobile?36:28,borderTopLeftRadius:0,borderBottomLeftRadius:0}},e),s.a.createElement(R.a,{id:"inviteUserButton.invitePersonLabel",defaultMessage:"Add people"})))})}))}renderHelpButton(){return s.a.createElement(S.a,{topBorder:!0,disableDesktopPadding:!0},s.a.createElement(D.a,{title:s.a.createElement(R.a,{id:"inviteUserModal.helpButton.caption",defaultMessage:"Learn how to invite people and set permissions"}),href:Object(K.a)("guides.invitePerson"),analyticsFrom:"invite_person"}))}renderDesktopInputRightInner(){return s.a.createElement("div",{style:{marginLeft:8,display:"flex",alignItems:"center"}},this.renderDesktopInputRightInnerSelect(),this.renderDesktopInputRightInnerButton())}renderDesktopInputRightInnerButton(){const{disabled:e}=this.props,{permissionsInviteStore:t}=this.stores,n=t.state.inviteTargets,a=n.filter(e=>{let{type:t}=e;return"newUser"===t}).map(e=>{let{value:t}=e;return t.email}),r=n.filter(e=>{let{type:t}=e;return"existingUser"===t}).map(e=>{let{value:t}=e;return t.id}),i=e||Object(H.d)({environment:this.environment,userIds:[...a,...r],includesOwner:!0});return s.a.createElement(b.a,{textWrap:!0,alignment:Q.a.Center,disableTooltip:!i,renderTooltip:()=>s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{style:{width:280}},s.a.createElement(R.a,{id:"inviteUserButton.modalTooltip.guestLimitLine1",defaultMessage:"Your personal plan allows up to 5 unique guests."})),s.a.createElement("div",null,s.a.createElement(R.a,{id:"inviteUserButton.modalTooltip.guestLimitLine2",defaultMessage:"Upgrade to go unlimited."}))),render:e=>s.a.createElement(T.a,Object.assign({style:{minWidth:me.inviteButtonWidth},onClick:i?this.handleUpgradeClick:this.handleInviteClick},e),i?s.a.createElement(R.a,{id:"inviteUserModal.inviteButton.upgradeLabel",defaultMessage:"Upgrade"}):s.a.createElement(R.a,{id:"inviteUserModal.inviteButton.label",defaultMessage:"Invite"}))})}renderDesktopInputRightInnerSelect(){const{device:e}=this.environment,{isSubscribed:t}=this.props,{permissionsInviteStore:n}=this.stores;return n.state.isInviteTargetsEmpty||!Object(m.c)(n.state)?s.a.createElement(u.a,{role:n.state.inviteRole,table:n.state.table,type:"user_permission",isSubscribed:t,isInvite:!0,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonStyle:{display:"flex",whiteSpace:"nowrap",marginTop:e.isMobile?4:0,color:h.f.uiGray},isMenuItem:e.isMobile,onChange:e=>{!n.state.isInviteTargetsEmpty&&Object(m.c)(n.state)||n.setState(ue({},n.state,{inviteRole:e}))}}):n.state.table===ce.a?s.a.createElement(u.a,{role:n.state.inviteRole,table:n.state.table,type:"bot_permission",isSubscribed:t,isInvite:!0,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonStyle:{display:"flex",whiteSpace:"nowrap",marginTop:e.isMobile?4:0,color:h.f.uiGray},isMenuItem:e.isMobile,onChange:e=>{(n.state.isInviteTargetsEmpty||Object(m.c)(n.state))&&n.state.table===ce.a&&n.setState(ue({},n.state,{inviteRole:e}))}}):n.state.table===le.a?s.a.createElement(u.a,{role:n.state.inviteRole,table:n.state.table,type:"bot_permission",isSubscribed:t,isInvite:!0,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonStyle:{display:"flex",whiteSpace:"nowrap",marginTop:e.isMobile?4:0,color:h.f.uiGray},isMenuItem:e.isMobile,onChange:e=>{(n.state.isInviteTargetsEmpty||Object(m.c)(n.state))&&n.state.table===le.a&&n.setState(ue({},n.state,{inviteRole:e}))}}):void Object(L.e)(n.state)}getDefaultRoleForNonBot(){const{store:e,isSubscribed:t}=this.props;return Object(oe.p)(e)?t?"read_and_write":"editor":w.O(this.environment)?"editor":"read_and_write"}getDefaultRoleForBlockBot(){return"read_and_write"}getDefaultRoleForSpaceBot(){return"editor"}alreadyInvitingTarget(e){return this.stores.permissionsInviteStore.state.inviteTargets.find(t=>"newUser"===e.type?"newUser"===t.type&&e.value.email===t.value.email:t.type===e.type&&t.value.id===e.value.id)}targetHasPermission(e){const t=this.props.store.getValue();return!!t&&Object(z.h)(t).some(t=>{switch(e.type){case"existingUser":return Object(N.q)(t)&&t.user_id===e.value.id;case"bot":return Object(N.g)(t)&&t.bot_id===e.value.id;case"group":return Object(N.i)(t)&&t.group_id===e.value.id;default:return!1}})}getTargetName(e){const{intl:t}=this.props;switch(e.type){case"newUser":return e.value.email;case"existingUser":return Object(W.d)(t,e.value);case"bot":return Object(A.a)(e.value);case"group":return Object(F.a)({intl:t,group:e.value});default:Object(L.e)(e)}}getBadgeStyle(){const{device:e}=this.environment;return{display:"inline-flex",height:18,textTransform:"uppercase",fontSize:10,marginBottom:2,fontWeight:g.a.fontWeight.medium,letterSpacing:1,color:h.f.uiLightGray,border:"1px solid ".concat(h.f.uiLightGray),minWidth:me.inviteButtonWidth,alignItems:"center",justifyContent:"center",paddingTop:e.isAndroid?2:1,paddingBottom:1,paddingLeft:3,paddingRight:3,borderRadius:3}}}me.avatarSize=24,me.inviteButtonWidth=70;t.default=Object(R.g)(me)},1108:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(502),s=n(3),o=n(45),l=n(1),c=n(728),d=(n(15),n(11),n(12)),u=n(97),p=n(24),m=n(157),h=n(44),g=n(321),b=n(22),f=n(154),y=n(215),S=n(334),v=n(771),E=n(108),M=n(8),C=n(368),O=n(133),w=n(94),k=n(90),P=n(118),T=n(61),I=n(163),j=n(82);class D extends s.a{constructor(){super(...arguments),this.storeTypes={hovered:T.a.of(!1),buttonPopupStore:T.a.of(new j.a)}}renderComponent(){const{schema:e,property:t,format:n}=this.props,a=e[t];if(!a)return;const s=this.getPropertyVisibility(a);return r.a.createElement(I.b,{onMouseEnter:()=>this.stores.hovered.set(!0),onMouseLeave:()=>this.stores.hovered.set(!1),focused:this.stores.hovered.get(),key:t,showDragHandle:!this.environment.device.isMobile,showExtensionArrow:!1,propertySchema:a,format:I.b.DisplayFormat.Name,dontShrinkRight:!0,ignoreLocalHoverState:!0,locked:this.props.locked,onClick:()=>{if(!this.props.locked){const e=this.stores.buttonPopupStore.get();e.setState({open:!e.state.open})}},right:r.a.createElement(v.a,{buttonPopupStore:this.stores.buttonPopupStore.get(),visibility:s,locked:this.props.locked,onSelect:e=>{i.e({environment:this.environment,property:t,visibility:e,format:n,store:this.props.store})},onClose:()=>this.stores.hovered.set(!1),type:"property",propertySchema:a})})}getPropertyVisibility(e){const{visibility:t}=this.props;switch(t){case"hide_if_empty":return g.d({propertySchema:e})?"hide_if_empty":"show";default:return t}}}var x=D,B=n(23),A=n(76),F=n(837),R=n(112),L=n(67);function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){W(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class N extends s.a{constructor(){super(...arguments),this.storeTypes={lockStore:F.a},this.handleDraggableDrop=e=>{const t=this.getCollectionPageProperties();if(t){const n=e.map(e=>t.find(t=>t.property===e));i.c({environment:this.environment,properties:n,store:this.props.store})}},this.handleToggleLockClick=()=>{const e=g.a();if(!e)return!1;const t=e.getParentBlockStore();t&&(d.d(this.environment,e=>{u.e({environment:this.environment,store:t,isLocked:!g.b(),transaction:e})}),this.stores.lockStore.setState({justUnlocked:!this.stores.lockStore.state.justUnlocked}))}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:b.b.MenuType.Modal,right:r.a.createElement(w.DoneMenuText,null),onClickRight:i.a,title:this.props.intl.formatMessage({id:"customizePageMenu.mobileHeader.label",defaultMessage:"Customize page"})}:{menuType:b.b.MenuType.Popup,minWidth:400};const n=this.getNormalizedFormat();return r.a.createElement(b.b,Object.assign({},t,{header:this.renderHeader()}),(this.props.locked||this.stores.lockStore.state.justUnlocked)&&this.renderLockControls(),this.renderPageSectionsSectionMenuItem(n),this.renderPropertiesSectionMenuItem(n))}renderLockControls(){return r.a.createElement("div",{style:{fontSize:12,display:"flex",justifyContent:"center",alignItems:"center",borderTop:"1px solid ".concat(this.theme.regularDividerColor),borderBottom:"1px solid ".concat(this.theme.regularDividerColor),background:this.theme.sidebarBackground,color:this.theme.mediumTextColor,paddingTop:6,paddingBottom:6}},r.a.createElement("span",{style:{display:"inline-block",verticalAlign:"middle",paddingRight:6}},this.stores.lockStore.state.justUnlocked?M.a.unlocked({height:12,width:12,fill:this.theme.mediumIconColor}):M.a.locked({height:12,width:12,fill:this.theme.mediumIconColor})),this.stores.lockStore.state.justUnlocked?r.a.createElement(l.a,{id:"customizePageMenu.unlocked.header",defaultMessage:"Settings unlocked on parent database."}):r.a.createElement(l.a,{id:"customizePageMenu.locked.header",defaultMessage:"Settings locked on parent database."}),r.a.createElement(A.a,{style:{fontSize:12,color:this.theme.mediumTextColor,fontWeight:B.a.fontWeight.semibold,marginLeft:2,paddingLeft:4,paddingRight:4,height:20},onClick:this.handleToggleLockClick},this.stores.lockStore.state.justUnlocked?r.a.createElement(l.a,{id:"customizePageMenu.lock.label",defaultMessage:"Re-lock"}):r.a.createElement(l.a,{id:"customizePageMenu.unlock.label",defaultMessage:"Unlock"})))}renderPropertiesSectionMenuItem(e){const t=this.getSchema();if(!t||"page"===this.props.type)return;const n=this.getPageCustomization(e);if(!n)return;const{propertyVisibility:a}=n;if(!a)return;const i=a.reduce((e,t)=>(e[t.property]=t.visibility,e),{});return r.a.createElement(p.a,{style:{opacity:this.props.locked?.5:1},isTitleUppercase:!0,title:r.a.createElement(l.a,{id:"customizePageMenu.propertiesSection.header",defaultMessage:"Properties"})},r.a.createElement(m.b,{direction:m.a.Vertical,keys:this.getCollectionPageProperties().map(e=>e.property),renderKey:n=>{if("collection"===this.props.type)return r.a.createElement(x,{schema:t,visibility:i[n],property:n,format:e,store:this.props.store,locked:this.props.locked})},onDrop:this.handleDraggableDrop}))}renderPageSectionsSectionMenuItem(e){const t=this.getPageCustomization(e);if(!t)return;const{pageSectionVisibility:n}=t;return n?r.a.createElement(p.a,{style:{opacity:this.props.locked?.5:1},title:r.a.createElement(l.a,{id:"customizePageMenu.sectionsSection.header",defaultMessage:"Sections"}),isTitleUppercase:!0,topBorder:!this.props.locked&&!this.stores.lockStore.state.justUnlocked},r.a.createElement(f.a,{title:r.a.createElement(l.a,{id:"customizePageMenu.pageSections.backlinksTitle",defaultMessage:"Backlinks"}),icon:M.a.alias({height:16,width:16,transform:"rotate(180deg)"}),right:r.a.createElement(v.a,{visibility:n.backlinks,locked:this.props.locked,onSelect:t=>{i.d({environment:this.environment,pageSection:"backlinks",visibility:t,store:this.props.store,format:e})},type:"page"})}),r.a.createElement(f.a,{title:r.a.createElement(l.a,{id:"customizePageMenu.pageSections.commentsTitle",defaultMessage:"Page comments"}),icon:M.a.speechBubbleThick({height:16,width:16}),right:r.a.createElement(v.a,{visibility:n.comments,visibilityLevels:["section_show","section_hide"],locked:this.props.locked,onSelect:t=>{i.d({environment:this.environment,pageSection:"comments",visibility:t,store:this.props.store,format:e})},type:"page"})})):void 0}renderHeader(){if(this.environment.device.isMobile)return;const{store:e}=this.props;if(e){const t=e.getIcon(),n="collection"===this.props.type?this.props.store.getParentBlockStore():void 0,a=t&&r.a.createElement(k.a,{icon:t,isEmptyPage:!1,size:14,disabled:!0,style:{display:"inline-flex",marginRight:2}}),s=r.a.createElement(P.a,{store:e,style:{display:"inline"}}),o=r.a.createElement(S.a,{prefix:r.a.createElement(l.a,{id:"customizePageMenu.header.label",defaultMessage:"Page view for "}),viewName:n?r.a.createElement(r.a.Fragment,null,r.a.createElement(R.a,{onClick:i.a,href:Object(L.a)({store:n,fullyQualified:!1}),inline:!0},a,s)):r.a.createElement(r.a.Fragment,null,a,s)});return r.a.createElement(f.a,{style:_({},y.d.headingStyle),title:o,right:r.a.createElement(C.a,{helpButtonContext:"collection_properties_menu",href:Object(O.a)("guides.databaseProperties")})})}}getSchema(){if("collection"!==this.props.type)return this.props.store.getSchema();{const e=this.props.store.getValue();if(e)return h.e(e.schema)}}getNormalizedFormat(){const e=this.props.store.getFormat(),t=this.getSchema();return t?E.i(e,t,void 0,[],E.a.Collection):{}}getCollectionPageProperties(){if("collection"!==this.props.type)return[];return this.getNormalizedFormat().collection_page_properties||[]}getPageCustomization(e){return{propertyVisibility:e.property_visibility,pageSectionVisibility:e.page_section_visibility}}}var z=N,V=n(71),q=n(17);class H extends s.a{constructor(){super(...arguments),this.renderModal=()=>{if(!c.a.state.isOpen)return;const e=g.a(),{currentBlockStore:t}=q.a.state,n=V.c.state.open&&V.c.state.target||t;return e?r.a.createElement(z,{store:e,type:"collection",intl:this.props.intl,locked:g.b()}):n?r.a.createElement(z,{store:n,type:"page",intl:this.props.intl,locked:!1}):void 0}}renderComponent(){const{device:e}=this.environment,t=c.a.state;return r.a.createElement(o.c,{popupType:e.isMobile?o.c.PopupType.SlideUp:o.c.PopupType.Popup,alignmentToOrigin:o.c.Alignment.Center,open:t.isOpen,render:this.renderModal,originRect:t.isOpen?t.rect:void 0,onDismiss:()=>i.a()})}}t.default=Object(l.g)(H)},1109:function(e,t,n){"use strict";n.r(t);n(15),n(11);var a=n(0),r=n.n(a),i=n(3),s=n(1462),o=n(174),l=n(8),c=n(1),d=n(23),u=n(16);class p extends u.a{getInitialState(){return{starRating:void 0,step:"rate"}}}var m=p,h=n(2),g=n.n(h),b=n(127),f=n(153),y=n(6),S=n(762),v=n(247);function E(e,t,n){if(n){const{templateId:a}=n;return e.some(e=>e.milestone===t&&e.template_id===a)}return e.some(e=>e.milestone===t)}var M=n(285),C=n(20),O=n(39),w=n(17),k=n(103),P=n(34),T=n(89),I=n(90),j=n(759),D=n(304);function x(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){F(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const R=Object(c.f)({additionalFeedbackPlaceholder:{id:"csatPopup.additionalFeedback.placeholder",defaultMessage:"Tell us more..."}});class L extends i.a{constructor(){super(...arguments),this.storeTypes={csatPopupStore:m},this.renderCancel=()=>r.a.createElement(P.a,{onClick:this.handleCancel,style:this.getCancelStyle(),hoveredStyle:{background:this.theme.buttonPressedBackground}},l.a.closeSmall({width:14,fill:this.theme.mediumTextColor})),this.renderStep=()=>{const{step:e}=this.stores.csatPopupStore.state,{currentSpaceStore:t}=w.a.state;let n;if(t){const e=t.getValue();e&&e.initial_use_cases&&(n=g.a.sample(e.initial_use_cases))}return r.a.createElement(r.a.Fragment,null,r.a.createElement(b.a,{isVisible:"rate"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0,translateY:-120},render:()=>r.a.createElement("div",{style:{paddingBottom:40}},this.renderIcon(),this.renderFeedbackPrompt(n))}),r.a.createElement(b.a,{isVisible:"rate"===e||"send"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>r.a.createElement("div",{style:this.getSlideContainerStyle()},this.renderStars(n),this.renderInput(),this.renderSendButton())}),r.a.createElement(b.a,{isVisible:"thanks"===e,animationStyle:this.getAnimationStyle("thanks"===e),enterAnimationStyle:this.getEnterExitAnimationStyle(),exitAnimationStyle:this.getEnterExitAnimationStyle(),render:this.renderThanks}))},this.renderThanks=()=>r.a.createElement("div",null,r.a.createElement("img",{style:{width:165,height:80},src:C.a.images.feedbackThankYouPng}),r.a.createElement("div",{style:this.getThanksHeaderStyle()},r.a.createElement(c.a,{defaultMessage:"Thanks for your feedback!",id:"csatPopup.thanks.header"})),r.a.createElement("div",{style:this.getThanksDescriptionStyle()},r.a.createElement(c.a,{defaultMessage:"Your feedback will help us make Notion better.",id:"csatPopup.thanks.description"}))),this.renderIcon=()=>{const{currentBlockStore:e}=w.a.state;if(e){const t=e.getIcon();if(t)return r.a.createElement(j.a,{justifyContent:"center",alignItems:"center"},r.a.createElement(I.a,{icon:t,isEmptyPage:!1,size:32,disabled:!0}))}return r.a.createElement(j.a,{justifyContent:"center",alignItems:"center"},l.a.notionLogo({width:32,height:32}))},this.renderFeedbackPrompt=e=>{switch(e){case"doc_notes":return r.a.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.a.createElement(c.a,{defaultMessage:"How satisfied are you with using Notion for notes & docs?",id:"csatPopup.feedbackPrompt.docNotesLabel"}));case"project_management":return r.a.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.a.createElement(c.a,{defaultMessage:"How satisfied are you with managing projects and tasks in Notion?",id:"csatPopup.feedbackPrompt.projManagementLabel"}));case"wiki":return r.a.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.a.createElement(c.a,{defaultMessage:"How satisfied are you with using Notion for team wikis?",id:"csatPopup.feedbackPrompt.wikiLabel"}));default:return this.shouldRenderAsNPS(e)?r.a.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.a.createElement(c.a,{defaultMessage:"How likely are you to recommend Notion to a friend?",id:"csatPopup.feedbackPrompt.enterpriseDefaultLabel"})):r.a.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.a.createElement(c.a,{defaultMessage:"How satisfied are you with using Notion? ",id:"csatPopup.feedbackPrompt.defaultlabel"}))}},this.renderInput=()=>{const{step:e,additionalFeedback:t}=this.stores.csatPopupStore.state;return r.a.createElement(k.a,{capture:!0,onBackspace:g.a.identity,onLeft:g.a.identity,onRight:g.a.identity,onSelectAll:g.a.identity,onRedo:g.a.identity,onUndo:g.a.identity,onCut:g.a.identity,onCopy:g.a.identity,onPaste:g.a.identity,onKeypress:g.a.identity,onDelete:g.a.identity,onTab:g.a.identity},r.a.createElement(f.b,{textarea:!0,style:this.getInputContainerStyle(),focus:"send"===e,value:t,placeholder:y.a.formatMessage(R.additionalFeedbackPlaceholder),onChange:e=>{this.stores.csatPopupStore.setState(A({},this.stores.csatPopupStore.state,{additionalFeedback:e.target.value}))}}))},this.renderSendButton=()=>r.a.createElement(M.a,{isLarge:!0,style:this.getButtonStyle(),onClick:this.handleSend},r.a.createElement(c.a,{id:"csatPopup.sendButton.label",defaultMessage:"Send"})),this.renderStars=e=>{const{starRating:t,step:n}=this.stores.csatPopupStore.state,a=e=>{let{rating:a}=e;return r.a.createElement("div",{style:this.getStarStyle(),onMouseEnter:()=>{"rate"===n&&this.stores.csatPopupStore.setState(A({},this.stores.csatPopupStore.state,{starRating:a}))},onClick:()=>{this.stores.csatPopupStore.setState({starRating:a,step:"send"})}},l.a.star({width:18,fill:this.theme.mediumIconColor,position:"absolute",opacity:t&&t>=a?0:1}),l.a.starFilled({width:18,fill:"#F6C050",position:"absolute",opacity:t&&t>=a?1:0}))};return r.a.createElement("div",{onMouseLeave:()=>{g.a.delay(()=>{"rate"===this.stores.csatPopupStore.state.step&&this.stores.csatPopupStore.setState(A({},this.stores.csatPopupStore.state,{starRating:void 0}))},500)},style:this.getStarsContainerStyle()},r.a.createElement("div",{style:this.getStarsStyle()},r.a.createElement(a,{rating:1}),r.a.createElement(a,{rating:2}),r.a.createElement(a,{rating:3}),r.a.createElement(a,{rating:4}),r.a.createElement(a,{rating:5})),r.a.createElement("div",{style:this.getStarLabelStyle()},r.a.createElement(()=>{const n=this.shouldRenderAsNPS(e);switch(t){case 1:return n?r.a.createElement(c.a,{defaultMessage:"Very unlikely",id:"csatPopup.stars.1StarLabelNps"}):r.a.createElement(c.a,{defaultMessage:"Very dissatisfied",id:"csatPopup.stars.1StarLabel"});case 2:return n?r.a.createElement(c.a,{defaultMessage:"Somewhat unlikely",id:"csatPopup.stars.2StarLabelNps"}):r.a.createElement(c.a,{defaultMessage:"Somewhat dissatisfied",id:"csatPopup.stars.2StarLabel"});case 3:return n?r.a.createElement(c.a,{defaultMessage:"Not likely nor unlikely",id:"csatPopup.stars.3StarLabelNps"}):r.a.createElement(c.a,{defaultMessage:"Not dissatisfied nor satisfied",id:"csatPopup.stars.3StarLabel"});case 4:return n?r.a.createElement(c.a,{defaultMessage:"Somewhat likely",id:"csatPopup.stars.4StarLabelNps"}):r.a.createElement(c.a,{defaultMessage:"Somewhat satisfied",id:"csatPopup.stars.4StarLabel"});case 5:return n?r.a.createElement(c.a,{defaultMessage:"Very likely",id:"csatPopup.stars.5StarLabelNps"}):r.a.createElement(c.a,{defaultMessage:"Very satisfied",id:"csatPopup.stars.5StarLabel"});default:return r.a.createElement(c.a,{defaultMessage:"Select an option",id:"csatPopup.stars.notSpecifiedLabel"})}},null)))},this.handleCancel=async()=>{const{state:e}=s.a;if(!e.open)return;const{open:t}=e,n=x(e,["open"]);if(t&&"trigger"===n.type){const{currentSpaceStore:e}=w.a.state;if(!e)return;await O.ic(this.environment,A({spaceId:e.id,rating:void 0,additionalFeedback:void 0,templateId:void 0},n,{useCase:"legacy"===n.useCase?void 0:n.useCase}))}s.a.setState(A({},s.a,{open:!1}))},this.handleSend=async()=>{const{additionalFeedback:e,starRating:t}=this.stores.csatPopupStore.state,{currentSpaceStore:n}=w.a.state;if(!n||!t)return;const{state:a}=s.a;if(!a.open)return;const{open:r}=a,i=x(a,["open"]),o="passive"===i.type?await O.ic(this.environment,{spaceId:n.id,rating:t,additionalFeedback:e,type:i.type,milestone:void 0,templateId:void 0}):await O.ic(this.environment,A({spaceId:n.id,rating:t,additionalFeedback:e,templateId:void 0},i,{useCase:"legacy"===i.useCase?void 0:i.useCase}));if("success"!==o.type)throw o.error;this.stores.csatPopupStore.setState(A({},this.stores.csatPopupStore.state,{step:"thanks"})),g.a.delay(()=>{s.a.setState(A({},s.a,{open:!1})),g.a.delay(()=>{this.stores.csatPopupStore.reset()},1e3)},2e3)},this.flexCenteredStyle={display:"flex",alignItems:"center",flexDirection:"column"}}willMount(){const{userSettingsStore:e,blockStore:t,spaceStore:n}=this.props;if(e&&t&&n){const a=this.environment;if("CsatMilestoneStore"in a){const r=D.a.withListenerIgnored(()=>function(e,t){const{userSettingsStore:n,blockStore:a,spaceStore:r}=t,i=n.getSettings(),{signup_time:s}=i,{CsatMilestoneStore:o}=e,{data:l}=o.state,c=e=>Math.floor((Date.now()-e)/864e5),d=r.getValue();if(!d||!l)return;const{milestones:u}=l;if(!u)return;if(Math.max(...u.map(e=>e.created_time))>Date.now()-24192e5)return;if(s){const e=c(s),t=g.a.sample(d.initial_use_cases)||"legacy";if(e>=180){if(!E(u,S.b))return{milestone:S.b,useCase:t}}else if(e>=90){if(!E(u,S.e))return{milestone:S.e,useCase:t}}else if(e>=28){if(!E(u,S.c))return{milestone:S.c,useCase:t}}else if(e>=7&&!E(u,S.d))return{milestone:S.d,useCase:t}}const p=a.getValue();return p&&p.copied_from&&Object(v.h)(p.copied_from)&&c(p.created_time)>=7&&!E(u,S.a,{templateId:p.copied_from})?{milestone:S.a,useCase:"legacy",templateId:p.copied_from}:void 0}(a,{userSettingsStore:e,blockStore:t,spaceStore:n}));if(r){const{milestone:e,useCase:t,templateId:n}=r;g.a.delay(()=>{s.a.setState({open:!0,milestone:e,type:"trigger",useCase:t,templateId:n})},2e3)}}}}renderComponent(){const{device:e}=this.environment;if(e.isMobile)return;const{currentSpaceStore:t}=w.a.state;return t&&t.canRead()?r.a.createElement(b.a,{isVisible:s.a.state.open,animationStyle:this.getAnimationStyle(s.a.state.open),enterAnimationStyle:this.getEnterExitAnimationStyle(),exitAnimationStyle:this.getEnterExitAnimationStyle(),springConfig:this.getSpringConfig(),render:()=>r.a.createElement("div",{style:this.getContainerStyle()},this.renderCancel(),r.a.createElement("div",{style:this.getInnerContainerStyle()},this.renderStep()))}):void 0}shouldRenderAsNPS(e){const t=T.i(this.environment),{state:n}=s.a,a=n.open&&"trigger"===n.type;return"enterprise"===t&&!e&&a}getSpringConfig(){return{scale:{stiffness:58,damping:4.3}}}getAnimationStyle(e){return{opacity:e?1:0,scale:e?1:.96}}getEnterExitAnimationStyle(){return{opacity:0,scale:.96}}getThanksHeaderStyle(){return{color:this.theme.regularTextColor,fontWeight:d.a.fontWeight.semibold,fontSize:14}}getThanksDescriptionStyle(){return{color:this.theme.mediumTextColor,fontSize:12}}getButtonStyle(){return{width:"calc(100% - 30px)"}}getInputContainerStyle(){const{step:e}=this.stores.csatPopupStore.state;return{width:"calc(100% - 30px)",display:"block",background:this.theme.popoverBackground,height:80,marginTop:10,marginBottom:10,opacity:"rate"===e?0:1}}getStarLabelStyle(){return{fontSize:12,color:this.theme.mediumTextColor,paddingTop:4}}getFeedbackPromptStyle(){return{paddingTop:12,paddingBottom:12,color:this.theme.regularTextColor,fontWeight:d.a.fontWeight.semibold,fontSize:14,lineHeight:1.4,width:188}}getStarStyle(){return{display:"inline-flex",position:"relative",width:20,height:20,marginRight:3}}getSlideContainerStyle(){const{step:e}=this.stores.csatPopupStore.state;return A({},this.flexCenteredStyle,{position:"absolute",transition:"transform 200ms ease",width:240,transform:"rate"===e?"translateY(120px)":"translateY(0px)"})}getStarsContainerStyle(){return A({width:"100%"},this.flexCenteredStyle)}getStarsStyle(){return{display:"flex",cursor:"pointer"}}getContainerStyle(){const{device:e}=this.environment;return{background:this.theme.popoverBackground,borderRadius:5,boxShadow:this.theme.mediumBoxShadow,position:"absolute",bottom:65+e.scrollbarWidth,right:16+e.scrollbarWidth,zIndex:o.e}}getInnerContainerStyle(){return A({},this.flexCenteredStyle,{width:240,height:195,overflow:"hidden",position:"relative",padding:12,cursor:"default",textAlign:"center",justifyContent:"center"})}getCancelStyle(){return{position:"absolute",top:"10px",right:"10px",background:this.theme.buttonHoveredBackground,borderRadius:"100%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",zIndex:10}}}t.default=Object(c.g)(L)},1110:function(e,t,n){"use strict";n.r(t);n(15),n(11);var a=n(0),r=n.n(a),i=n(3),s=n(1245),o=n(743),l=n(34),c=n(8),d=n(759),u=n(23),p=n(19),m=n(153),h=n(76),g=n(285),b=n(1),f=n(333),y=n(53),S=n(299);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){M(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class C extends i.a{renderComponent(){const{intl:e,question:t}=this.props,n={setup_trial:r.a.createElement(b.a,{id:"enterpriseContactModalQuestionSelect.question.setup_trial",defaultMessage:"Setup an enterprise trial"}),live_demo:r.a.createElement(b.a,{id:"enterpriseContactModalQuestionSelect.question.live_demo",defaultMessage:"Schedule a live demo"}),plan_help:r.a.createElement(b.a,{id:"enterpriseContactModalQuestionSelect.question.plan_help",defaultMessage:"Need help choosing a plan"}),other:r.a.createElement(b.a,{id:"enterpriseContactModalQuestionSelect.question.other",defaultMessage:"Other"})},a={menuTitle:e.formatMessage({defaultMessage:"Your question",id:"enterpriseContactModal.yourQuestion.title"}),items:["setup_trial","live_demo","plan_help","other"],width:280,getKey:e=>e,selectedItem:t,originGap:4,onSelect:e=>{this.props.onSelect(e)},renderItem:e=>r.a.createElement(y.a,Object.assign({title:n[e.key]},e)),renderOrigin:e=>r.a.createElement(S.a,{isLarge:!0,onClick:t=>e.onClick(t),style:E({},this.getInputStyle(),{},this.props.invalid&&{border:"1px solid ".concat(p.f.red)})},r.a.createElement("div",{style:{display:"flex",alignItems:"center",color:t?this.theme.regularTextColor:this.theme.lightTextColor}},t?n[t]:r.a.createElement(b.a,{defaultMessage:"Select question",id:"enterpriseContactModal.selectQuestion.label"})),c.a.expand({width:10,fill:this.theme.lightIconColor}))};return r.a.createElement(f.a,Object.assign({key:"onboarding"},a))}getInputStyle(){const{device:e}=this.environment;return E({backgroundColor:this.theme.whiteButtonBackground,height:31},e.isMobile&&{height:42},{padding:"2px 10px",display:"flex",alignItems:"center",justifyContent:"space-between",borderRadius:3,border:0,transition:"box-shadow 0.3s ease",boxShadow:"0 0 0 1px ".concat(this.theme.outlineButtonBorder),background:this.theme.buttonBackground})}}var O=Object(b.g)(C),w=n(16);class k extends w.a{getInitialState(){return{step:"initial"}}}var P=k,T=n(20),I=n(127),j=n(103),D=n(2),x=n.n(D),B=n(6),A=n(14),F=n(263);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){U(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const _=Object(b.f)({additionalFeedbackPlaceholder:{id:"enterpriseContactModal.additionalFeedback.placeholder",defaultMessage:"What would you like to learn more about?"}});class W extends i.a{constructor(){super(...arguments),this.storeTypes={store:P},this.renderMenu=()=>r.a.createElement("div",{style:this.getContainerStyle()},this.renderCancel(),r.a.createElement(d.a,{style:this.getInnerContainerStyle(),alignItems:"center",alignContent:"center"},this.renderStep())),this.renderInitial=()=>{const{invalidField:e}=this.stores.store.state;if(s.a.state.open)return r.a.createElement("div",{style:L({},this.getSlideUpStyle(),{padding:20})},c.a.speechBubbleThin({width:"100%",height:24}),r.a.createElement("div",{style:{fontSize:14,fontWeight:u.a.fontWeight.semibold,paddingTop:6,paddingBottom:4}},r.a.createElement(b.a,{id:"enterpriseContactModal.initial.header",defaultMessage:"Get in touch with sales"})),r.a.createElement("div",{style:{fontSize:12,color:this.theme.mediumTextColor,width:200,margin:"0 auto"}},r.a.createElement(b.a,{id:"enterpriseContactModal.initial.caption",defaultMessage:"We'll work with you on your setup and help you land on the best plan."})),r.a.createElement("div",{style:L({},this.getLabelStyle(),{marginTop:24})},r.a.createElement(b.a,{id:"enterpriseContactModal.initial.nameLabel",defaultMessage:"Your name"})),r.a.createElement(m.b,{focusInitial:!0,value:this.getName(),placeholder:"Ada Lovelace",style:L({marginRight:4},this.getInputStyle(),{},"name"===e&&this.getInvalidInputStyle()),onChange:e=>{s.a.setState(L({},s.a.state,{open:!0,name:void 0})),this.stores.store.setState(L({},this.stores.store.state,{name:e.target.value}))}}),r.a.createElement("div",{style:this.getLabelStyle()},r.a.createElement(b.a,{id:"enterpriseContactModal.initial.emailLabel",defaultMessage:"Your work email"})),r.a.createElement(m.b,{value:this.getEmail(),placeholder:"ada@lovelace.app",type:"email",style:L({marginRight:4},this.getInputStyle(),{},"email"===e&&this.getInvalidInputStyle()),onChange:e=>{s.a.setState(L({},s.a.state,{open:!0,email:void 0})),this.stores.store.setState(L({},this.stores.store.state,{email:e.target.value}))}}),r.a.createElement("div",{style:this.getLabelStyle()},r.a.createElement(b.a,{id:"enterpriseContactModal.initial.companySizeLabel",defaultMessage:"Company size"})),r.a.createElement(d.a,null,this.getCompanySizeButtonData().map(e=>{let{type:t,message:n,style:a}=e;return r.a.createElement(h.a,{isLightGray:!0,isLarge:!0,style:L({},this.getBaseButtonStyle(),{},this.stores.store.state.companySize===t&&this.getSelectedButtonStyle(),{},a),onClick:()=>{this.stores.store.setState(L({},this.stores.store.state,{companySize:t}))}},n)})),r.a.createElement("div",{style:this.getLabelStyle()},r.a.createElement(b.a,{id:"enterpriseContactModal.initial.questionLabel",defaultMessage:"Your question"})),r.a.createElement(O,{question:this.stores.store.state.question,invalid:"question"===e,onSelect:e=>{this.stores.store.setState(L({},this.stores.store.state,{question:e,step:"other"===e?"additional_input":"initial"}))}}),r.a.createElement(m.b,{textarea:!0,style:this.getTextAreaStyle(),focus:"additional_input"===this.stores.store.state.step,value:this.stores.store.state.additionalFeedback,placeholder:B.a.formatMessage(_.additionalFeedbackPlaceholder),onChange:e=>{this.stores.store.setState(L({},this.stores.store.state,{additionalFeedback:e.target.value}))}}))},this.renderCancel=()=>r.a.createElement(l.a,{onClick:this.handleCancel,style:this.getCancelStyle(),hoveredStyle:{background:this.theme.buttonPressedBackground}},c.a.closeSmall({width:14,fill:this.theme.mediumTextColor})),this.renderThanks=()=>r.a.createElement("div",null,r.a.createElement("img",{style:{width:165,height:80},src:T.a.images.feedbackThankYouPng}),r.a.createElement("div",{style:this.getThanksHeaderStyle()},r.a.createElement(b.a,{id:"enterpriseContactModal.thanks.caption",defaultMessage:"We've received your inquiry and will be contacting you via email shortly."}))),this.handleCancel=()=>{s.a.setState({open:!1})}}renderComponent(){return r.a.createElement(o.a,{preventHideChildrenWhileOpening:!0,open:s.a.state.open,render:this.renderMenu,onDismiss:this.handleCancel})}renderStep(){const{step:e}=this.stores.store.state;return r.a.createElement(r.a.Fragment,null,r.a.createElement(I.a,{isVisible:"initial"===e||"additional_input"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>r.a.createElement(j.a,{capture:!0,onBackspace:x.a.identity,onLeft:x.a.identity,onRight:x.a.identity,onSelectAll:x.a.identity,onRedo:x.a.identity,onUndo:x.a.identity,onCut:x.a.identity,onCopy:x.a.identity,onPaste:x.a.identity,onKeypress:x.a.identity,onDelete:x.a.identity,onTab:x.a.identity},this.renderInitial())}),r.a.createElement(I.a,{isVisible:"thanks"===e,animationStyle:this.getAnimationStyle("thanks"===e),enterAnimationStyle:this.getEnterExitAnimationStyle(),exitAnimationStyle:this.getEnterExitAnimationStyle(),render:this.renderThanks}),r.a.createElement(I.a,{isVisible:"initial"===e||"additional_input"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>r.a.createElement(g.a,{isLarge:!0,style:{marginTop:17,width:284,position:"absolute",bottom:20},onClick:()=>{const e=this.getInvalidField();if(e){const{question:t}=this.stores.store.state;this.stores.store.setState(L({},this.stores.store.state,{step:"initial",invalidField:e,question:"other"===t?void 0:t}))}else this.stores.store.setState(L({},this.stores.store.state,{invalidField:void 0,step:"thanks"})),s.a.state.open&&A.Hb(this.environment,L({email:s.a.state.email,name:s.a.state.name},this.stores.store.state)),x.a.delay(()=>{s.a.reset(),x.a.delay(()=>{this.stores.store.reset()},1e3)},2e3)}},r.a.createElement(b.a,{id:"enterpriseContactModal.initial.sendLabel",defaultMessage:"Send"}))}))}getName(){if(s.a.state.open)return this.stores.store.state.name||s.a.state.name}getEmail(){if(s.a.state.open)return this.stores.store.state.email||s.a.state.email}getInvalidField(){const e=this.getEmail(),t=this.getName(),{question:n,companySize:a}=this.stores.store.state;return t?e&&F.b(e,"email")?a?n?void 0:"question":"company_size":"email":"name"}getCompanySizeButtonData(){return[{type:"1_100",message:r.a.createElement(b.a,{id:"enterpriseContactModal.initial.1_100Label",defaultMessage:"1-100"})},{type:"101_1000",message:r.a.createElement(b.a,{id:"enterpriseContactModal.initial.101_1000Label",defaultMessage:"101-1,000"}),style:{marginLeft:8,marginRight:8}},{type:"1001+",message:r.a.createElement(b.a,{id:"enterpriseContactModal.initial.1000PlusLabel",defaultMessage:"1,001+"})}]}getThanksHeaderStyle(){return{color:this.theme.regularTextColor,fontWeight:u.a.fontWeight.semibold,fontSize:14}}getContainerStyle(){return{background:this.theme.popoverBackground,borderRadius:5,boxShadow:this.theme.mediumBoxShadow}}getCancelStyle(){return{position:"absolute",top:"10px",right:"10px",background:this.theme.buttonHoveredBackground,borderRadius:"100%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",zIndex:10}}getInnerContainerStyle(){return{width:320,height:470,overflow:"hidden",position:"relative",padding:20,cursor:"default",textAlign:"center",justifyContent:"center"}}getLabelStyle(){return{marginTop:17,fontSize:12,color:this.theme.mediumTextColor,fontWeight:u.a.fontWeight.medium,lineHeight:"135%",marginBottom:4,textAlign:"left"}}getInputStyle(){return{backgroundColor:this.theme.whiteButtonBackground,height:31}}getInvalidInputStyle(){return{border:"1px solid ".concat(p.f.red)}}getAnimationStyle(e){return{opacity:e?1:0,scale:e?1:.96}}getEnterExitAnimationStyle(){return{opacity:0,scale:.96}}getBaseButtonStyle(){return{border:"1px solid #E7E6E5",flexGrow:1,justifyContent:"center"}}getSelectedButtonStyle(){return{color:p.f.blue,border:"1px solid ".concat(p.f.blue)}}getSlideUpStyle(){const{step:e}=this.stores.store.state;return{position:"absolute",transition:"transform 200ms ease",transform:"initial"===e?"translateY(153px)":"translateY(-180px)"}}getTextAreaStyle(){return{width:"100%",background:this.theme.popoverBackground,display:"block",padding:"7px 10px",height:310,marginTop:17,marginBottom:17,transition:"opacity 200ms ease-in",opacity:"additional_input"===this.stores.store.state.step?1:.001}}}t.default=W},1111:function(e,t,n){"use strict";n.r(t);n(15),n(11);var a=n(0),r=n.n(a),i=n(2),s=n.n(i),o=n(3),l=n(13),c=(n(881),n(882),n(766)),d=n.n(c),u=n(69),p=n(333),m=n(256),h=(n(160),n(57));const g=h.default.tz.names().map(e=>{const t=h.default.tz(e);return{name:e,displayName:"GMT".concat(t.format("Z")," - ").concat(e.replace(/_/g," ")," (").concat(t.format("z"),")"),utcOffset:t.utcOffset()}}).sort((e,t)=>e.utcOffset-t.utcOffset);g.map(e=>e.displayName),s.a.memoize(e=>{if(0===e)return h.default.utc("1990-12-28").zoneAbbr();const t=g.find(t=>e===t.utcOffset);return t?t.name:void 0});var b,f,y=n(16);!function(e){e.StartDate="startDate",e.StartTime="startTime",e.EndDate="endDate",e.EndTime="endTime"}(b||(b={})),function(e){e.InvalidDate="Invalid date",e.InvalidTime="Invalid time",e.InvalidRange="Invalid range"}(f||(f={}));class S extends y.a{getInitialState(){return{focus:b.StartDate,inputIsFocused:!1,inputTemporaryValue:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0},error:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0}}}}var v=S,E=n(47),M=n(153),C=n(40),O=n(31),w=n(271),k=n(408),P=n(53),T=n(24),I=n(61),j=n(22),D=n(169),x=n(55),B=n(155),A=n(8),F=n(174),R=n(635),L=n(694),U=n(205),_=n(415),W=n(14),N=n(19),z=n(151),V=n(359),q=n(587),H=n(86),G=n(1),Y=n(94),Q=n(133),K=n(609),Z=n(172),X=n(1464);function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){ee(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class te extends o.a{constructor(){super(...arguments),this.storeTypes={store:v,timezoneQuery:I.a.of("")},this.renderNavbarElement=e=>{let{onPreviousClick:t,onNextClick:n}=e;const{device:a}=this.environment;return r.a.createElement("div",{style:a.isMobile?te.mobileNavStyle:te.desktopNavStyle},r.a.createElement(z.a,{mobileFeedback:a.isMobile,icon:A.a.chevronLeft,onClick:()=>t()}),r.a.createElement(z.a,{mobileFeedback:a.isMobile,icon:A.a.chevronRight,onClick:()=>n()}))},this.handleDateFormatChange=e=>{this.props.onChangeDateFormat(e)},this.handleTimeFormatChange=e=>{const t=this.getTimeFormatOptions()[e];this.props.onChangeTimeFormat(t)},this.handleChangeReminder=e=>{const t=this.getDateValue();e?l.X(e)?this.props.onChangeValue(J({},t,{reminder:e})):"datetime"!==t.type&&"datetimerange"!==t.type||this.props.onChangeValue(J({},t,{reminder:e})):this.props.onChangeValue(J({},t,{reminder:e})),W.Td(this.environment,{date:t,reminder:e})},this.handleInputChange=e=>{const{device:t}=this.environment,{store:n}=this.stores;n.setState(J({},n.state,{inputTemporaryValue:J({},n.state.inputTemporaryValue,{[n.state.focus]:e.target.value||""})})),t.isAndroid&&this.handleInputBlur()},this.handleStartDateInputChange=()=>{const{inputTemporaryValue:e}=this.stores.store.state,t=e.startDate;if(!t)return;const n=this.parseInputDateValue(t);if(!n)return f.InvalidDate;const a=this.getDateValue();if(l.W(a)||l.Y(a)){const{newDate:e,currentMonth:t}=l.N({previous:a,updatedStartDate:n});this.applyValidDateState({newDate:e,currentMonth:t,resetField:b.StartDate})}else{const e=J({},a,{start_date:n}),t=l.L(e);this.applyValidDateState({newDate:e,currentMonth:t.start,resetField:b.StartDate})}},this.handleStartTimeInputChange=()=>{const{inputTemporaryValue:e}=this.stores.store.state,t=e.startTime;if(!t)return;const n=this.parseInputTimeValue(t);if(!n)return f.InvalidTime;const a=this.getDateValue();if(l.Y(a)){const{newDate:e,currentMonth:t}=l.O({previous:a,updatedStartTime:n});this.applyValidDateState({newDate:e,currentMonth:t,resetField:b.StartTime}),this.resetInputState(b.EndDate),this.resetInputState(b.EndTime)}else{const e=J({},a,{start_time:n}),t=l.L(e);this.applyValidDateState({newDate:e,currentMonth:t.start,resetField:b.StartTime})}},this.handleEndDateInputChange=()=>{const{inputTemporaryValue:e}=this.stores.store.state,t=e.endDate;if(!t)return;const n=this.parseInputDateValue(t);if(!n)return f.InvalidDate;const a=J({},this.getDateValue(),{end_date:n}),r=l.L(a);if(!r)return f.InvalidRange;this.applyValidDateState({newDate:a,currentMonth:r.end,resetField:b.EndDate})},this.handleEndTimeInputChange=()=>{const{inputTemporaryValue:e}=this.stores.store.state,t=e.endTime;if(!t)return;const n=this.parseInputTimeValue(t);if(!n)return f.InvalidTime;const a=J({},this.getDateValue(),{end_time:n}),r=l.L(a);if(!r)return f.InvalidRange;this.applyValidDateState({newDate:a,currentMonth:r.end,resetField:b.EndTime})},this.handleInputBlur=e=>{const{focus:t}=this.stores.store.state;let n=void 0;t===b.StartDate?n=this.handleStartDateInputChange():t===b.StartTime?n=this.handleStartTimeInputChange():t===b.EndDate?n=this.handleEndDateInputChange():t===b.EndTime&&(n=this.handleEndTimeInputChange()),n?this.stores.store.setState(J({},this.stores.store.state,{error:J({},this.stores.store.state.error,{[t]:n})})):this.stores.store.setState(J({},this.stores.store.state,{inputTemporaryValue:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0},inputIsFocused:!1,error:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0}}))},this.handleInputSubmit=()=>{const{focus:e}=this.stores.store.state;let t=void 0;e===b.StartDate?t=this.handleStartDateInputChange():e===b.StartTime?t=this.handleStartTimeInputChange():e===b.EndDate?t=this.handleEndDateInputChange():e===b.EndTime&&(t=this.handleEndTimeInputChange()),t?this.stores.store.setState(J({},this.stores.store.state,{error:J({},this.stores.store.state.error,{[e]:t})})):this.stores.store.setState(J({},this.stores.store.state,{inputTemporaryValue:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0},error:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0}}))},this.handleDayPickerDayClick=e=>{if(this.props.disabled)return;const t=s.a.cloneDeep(this.getDateValue()),{focus:n}=this.stores.store.state,a=Object(u.a)(e).locale(l.jb).format(l.ib);if("daterange"===t.type||"datetimerange"===t.type){const e=n===b.StartDate||n===b.StartTime?b.EndDate:b.StartDate;if(a===t[e===b.StartDate?"start_date":"end_date"])return void this.stores.store.setState(J({},this.stores.store.state,{focus:e}));n===b.StartDate||n===b.StartTime?t.start_date=a:n!==b.EndDate&&n!==b.EndTime||(t.end_date=a);const r=l.K(t,l.m);if(r.end&&r.end.isBefore(r.start)){if("datetimerange"===t.type){const{start_date:e,start_time:n,end_date:a,end_time:r}=t;t.start_date=a,t.start_time=r,t.end_date=e,t.end_time=n}else{const{start_date:e,end_date:n}=t;t.start_date=n,t.end_date=e}this.stores.store.setState(J({},this.stores.store.state,{focus:n===b.StartDate||n===b.StartTime?b.EndDate:b.StartDate}))}this.props.onChangeValue(t),this.resetInputState(n)}else t.start_date=a,this.props.onChangeValue(t),this.resetInputState(n)},this.handleDayPickerMonthChange=e=>{this.stores.store.setState(J({},this.stores.store.state,{currentMonth:Object(u.a)(e)}))},this.handleEndDateControlChange=()=>{const e=this.getDateValue();if("datetimerange"===e.type){const t={type:"datetime",start_date:e.start_date,start_time:e.start_time,time_zone:e.time_zone,reminder:e.reminder};this.props.onChangeValue(t)}else if("daterange"===e.type){const t={type:"date",start_date:e.start_date,reminder:e.reminder};this.props.onChangeValue(t)}else if("datetime"===e.type){const t={type:"datetimerange",start_date:e.start_date,start_time:e.start_time,end_date:e.start_date,end_time:e.start_time,time_zone:e.time_zone,reminder:e.reminder};this.props.onChangeValue(t),this.stores.store.setState(J({},this.stores.store.state,{focus:b.EndDate}))}else{const t={type:"daterange",start_date:e.start_date,end_date:e.start_date,reminder:e.reminder};this.props.onChangeValue(t),this.stores.store.setState(J({},this.stores.store.state,{focus:b.EndDate}))}},this.handleAllDayChange=()=>{const e=this.getDateValue();if("date"===e.type){const t={type:"datetime",start_date:e.start_date,start_time:"00:00",time_zone:l.m,reminder:e.reminder&&l.k(e.reminder)};this.props.onChangeValue(t)}else if("daterange"===e.type){const t={type:"datetimerange",start_date:e.start_date,start_time:"00:00",end_date:e.end_date,end_time:"00:00",time_zone:l.m,reminder:e.reminder&&l.k(e.reminder)};this.props.onChangeValue(t)}else if("datetime"===e.type){const t={type:"date",start_date:e.start_date,reminder:e.reminder&&l.j(e.reminder)};this.props.onChangeValue(t)}else{const t={type:"daterange",start_date:e.start_date,end_date:e.end_date,reminder:e.reminder&&l.j(e.reminder)};this.props.onChangeValue(t)}},this.handleTimeZoneChange=e=>{const t=g.find(t=>t.displayName===e);if(!t)return;const n=t.name,a=this.getDateValue();if("datetime"===a.type||"datetimerange"===a.type){const e=J({},a,{time_zone:n});this.props.onChangeValue(e)}},this.handleStartInputDateFocus=()=>{const e=this.getDateValue(),t=l.K(e,l.m);this.stores.store.setState(J({},this.stores.store.state,{focus:b.StartDate,inputIsFocused:!0,currentMonth:t.start}))},this.handleStartInputTimeFocus=()=>{const e=this.getDateValue(),t=l.K(e,l.m);this.stores.store.setState(J({},this.stores.store.state,{focus:b.StartTime,inputIsFocused:!0,currentMonth:t.start}))},this.handleEndInputDateFocus=()=>{const e=this.getDateValue(),t=l.K(e,l.m);t.end&&this.stores.store.setState(J({},this.stores.store.state,{focus:b.EndDate,inputIsFocused:!0,currentMonth:t.end}))},this.handleEndInputTimeFocus=()=>{const e=this.getDateValue(),t=l.K(e,l.m);t.end&&this.stores.store.setState(J({},this.stores.store.state,{focus:b.EndTime,inputIsFocused:!0,currentMonth:t.end}))},this.handleClearClick=()=>{this.props.onChangeValue(void 0)},this.getTimeFormatOptions=()=>Object(K.a)(Z.a).time,this.getSelectedTimeFormatType=()=>{const e=this.getTimeFormat(),t=this.getTimeFormatOptions();for(const n in t)if(t[n]===e)return n;return"12h"},this.getTimeZoneItemsSync=e=>Object(w.b)(e,g,e=>e.displayName).map((e,t)=>({key:e.displayName,render:t=>r.a.createElement(P.a,Object.assign({},t,{title:e.displayName})),action:()=>{this.handleTimeZoneChange(e.displayName)}})),this.tooltipOriginGap=12}willMount(e){super.willMount(e),this.openTimeFormat=l.nb(l.m)}renderComponent(){const{device:e,WindowSizeStore:t}=this.environment,{disabled:n,locked:a,shouldShowReminder:i}=this.props,{inputIsFocused:s}=this.stores.store.state,o=this.getDateValue(),l="datetime"===o.type||"datetimerange"===o.type,c="daterange"===o.type||"datetimerange"===o.type,d=r.a.createElement("div",{style:J({paddingTop:e.isMobile?16:8,paddingBottom:e.isMobile?16:8,paddingLeft:e.isMobile?t.getSafePaddingLeftCSS(16):14,paddingRight:e.isMobile?t.getSafePaddingRightCSS(16):14,display:l?"block":"flex"},e.isMobile&&{boxShadow:"\n\t\t\t\t\t\t\t0 1px 0 ".concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t"),position:"relative",zIndex:2},{background:e.isMobile?this.theme.popoverBackground:void 0})},this.renderStartInput(),c&&r.a.createElement("div",{style:{width:12,height:8}}),this.renderEndInput(),this.renderTimeZone());let u;return u=e.isMobile?{menuType:j.b.MenuType.Modal,title:r.a.createElement(G.a,{defaultMessage:"Date",id:"datePropertyMenu.mobileDate.title"}),right:r.a.createElement(G.a,{defaultMessage:"Done",id:"datePropertyMenu.mobileDoneButton.label"}),left:i?this.renderRemindersHelp():void 0,onClickRight:this.props.onDismiss,header:d}:{menuType:j.b.MenuType.Popup,maxHeight:"none",width:270},r.a.createElement(k.a,{capture:s,allowEsc:!0,allowTabUntab:!1},r.a.createElement(k.a,{capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1},r.a.createElement(j.b,Object.assign({},u),r.a.createElement(_.a,{show:s}),r.a.createElement(T.a,null,!e.isMobile&&d,r.a.createElement("div",{style:J({padding:e.isMobile?"16px 14px 16px":"4px 0 4px",textAlign:"center"},e.isMobile&&{borderBottom:"1px solid ".concat(this.theme.regularDividerColor),background:this.theme.popoverBackground})},this.renderCalendar())),!n&&this.renderControls(),!n&&!a&&r.a.createElement(T.a,{topBorder:!0},this.renderFormatPopup()),!n&&r.a.createElement(T.a,{topBorder:!0},this.renderClearButton()),!n&&!e.isMobile&&i&&r.a.createElement(T.a,{topBorder:!0},this.renderRemindersHelp()))))}renderStartInput(){const{device:e}=this.environment,{disabled:t}=this.props,{focus:n,inputTemporaryValue:a,error:i}=this.stores.store.state,s=this.getDateValue(),o=l.K(s,l.m),c=Boolean(i.startDate||i.startTime),d="datetime"===s.type||"datetimerange"===s.type,u="daterange"===s.type||"datetimerange"===s.type,p=n===b.StartDate||n===b.StartTime,m=Object(O.h)(a.startDate)?o.start.locale(!1).format(this.getDateDisplayFormat()):a.startDate,h=Object(O.h)(a.startTime)?o.start.locale(!1).format(this.getTimeFormat()):a.startTime,g=Object(O.h)(a.startDate)?o.start.format(l.ib):a.startDate,f=Object(O.h)(a.startTime)?o.start.format(l.kb):a.startTime;return r.a.createElement("div",{style:J({},c?this.getInputWrapErrorStyle():p&&u?this.getInputWrapActiveStyle():this.getInputWrapInactiveStyle(),{fontSize:e.isMobile?16:14})},r.a.createElement(C.a,{renderTooltip:()=>this.getInputErrorMessage(i.startDate),originGap:this.tooltipOriginGap,forceVisibleState:Boolean(i.startDate),placement:C.a.Placement.Left,render:()=>e.isMobile?r.a.createElement(M.b,{type:"date",format:M.a.Transparent,value:g,onChange:this.handleInputChange,onFocus:this.handleStartInputDateFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,disabled:t,size:1}):r.a.createElement(M.b,{format:M.a.Transparent,value:m,focusInitial:n===b.StartDate,onChange:this.handleInputChange,onFocus:this.handleStartInputDateFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,disabled:t,size:1})}),d&&this.getInputSeparator(),d&&r.a.createElement(C.a,{renderTooltip:()=>this.getInputErrorMessage(i.startTime),originGap:this.tooltipOriginGap,forceVisibleState:Boolean(i.startTime),placement:C.a.Placement.Right,render:()=>e.isMobile?r.a.createElement(M.b,{type:"time",format:M.a.Transparent,value:f,onChange:this.handleInputChange,onFocus:this.handleStartInputTimeFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t}):r.a.createElement(M.b,{format:M.a.Transparent,value:h,focusInitial:n===b.StartTime,onChange:this.handleInputChange,onFocus:this.handleStartInputTimeFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t})}))}renderEndInput(){const{device:e}=this.environment,{disabled:t}=this.props,n=this.getDateValue(),a=l.K(n,l.m),i="datetime"===n.type||"datetimerange"===n.type;if(a.end){const{focus:n,error:s,inputTemporaryValue:o}=this.stores.store.state,c=Boolean(s.endDate||s.endTime),d=n===b.EndDate||n===b.EndTime,u=Object(O.h)(o.endDate)?a.end.locale(!1).format(this.getDateDisplayFormat()):o.endDate,p=Object(O.h)(o.endTime)?a.end.locale(!1).format(this.getTimeFormat()):o.endTime,m=Object(O.h)(o.endDate)?a.end.format(l.ib):o.endDate,h=Object(O.h)(o.endTime)?a.end.format(l.kb):o.endTime,g=this.getDateRangeBounds(),f=g&&g.earliestValidEnd;return r.a.createElement("div",{style:J({},c?this.getInputWrapErrorStyle():d?this.getInputWrapActiveStyle():this.getInputWrapInactiveStyle(),{fontSize:e.isMobile?16:14})},r.a.createElement(C.a,{renderTooltip:()=>this.getInputErrorMessage(s.endDate),originGap:this.tooltipOriginGap,forceVisibleState:Boolean(s.endDate),placement:C.a.Placement.Left,render:()=>e.isMobile?r.a.createElement(M.b,{type:"date",format:M.a.Transparent,value:m,onChange:this.handleInputChange,onFocus:this.handleEndInputDateFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t,inputElementAttributes:{min:f}}):r.a.createElement(M.b,{format:M.a.Transparent,value:u,focusInitial:n===b.EndDate,onChange:this.handleInputChange,onFocus:this.handleEndInputDateFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t})}),i&&this.getInputSeparator(),i&&r.a.createElement(C.a,{renderTooltip:()=>this.getInputErrorMessage(s.endTime),originGap:this.tooltipOriginGap,forceVisibleState:Boolean(s.endTime),placement:C.a.Placement.Right,render:()=>e.isMobile?r.a.createElement(M.b,{type:"time",format:M.a.Transparent,value:h,onChange:this.handleInputChange,onFocus:this.handleEndInputTimeFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t}):r.a.createElement(M.b,{format:M.a.Transparent,value:p,focusInitial:n===b.EndTime,onChange:this.handleInputChange,onFocus:this.handleEndInputTimeFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t})}))}}renderTimeZone(){const{device:e}=this.environment,t=this.getDateValue(),n=l.K(t,l.m),a=u.a.tz(n.start,l.m);if(("datetime"===t.type||"datetimerange"===t.type)&&a.utcOffset()!==n.start.utcOffset()){const n=g.find(e=>e.name===t.time_zone);if(n)return r.a.createElement(H.a,{isSmall:!0,isMobile:e.isMobile,style:{marginTop:8}},n.displayName)}}renderCalendar(){const{firstDayOfWeek:e}=this.props,t=this.getDateValueForceCurrentTimeZone(),n=l.K(t,l.m),a=this.stores.store.state.currentMonth||n.start,{focus:i}=this.stores.store.state;if(n.end){const t=n.start.toDate(),s=n.end.toDate(),o=i===b.StartDate||i===b.StartTime;return r.a.createElement(d.a,{className:"notion-calendar-picker notranslate",firstDayOfWeek:e,numberOfMonths:1,initialMonth:a.toDate(),month:a.toDate(),locale:Z.a,localeUtils:X.a,modifiers:J({range:{from:t,to:s}},o?{end:s,start:t}:{start:t,end:s}),modifiersStyles:{range:te.dayPickerRangeDayStyle,start:o?this.getDayPickerActiveDayStyle():this.getDayPickerInactiveDayStyle(),end:o?this.getDayPickerInactiveDayStyle():this.getDayPickerActiveDayStyle()},showOutsideDays:!0,fixedWeeks:!0,onDayClick:this.handleDayPickerDayClick,navbarElement:this.renderNavbarElement,onMonthChange:this.handleDayPickerMonthChange})}{const t=n.start.toDate();return r.a.createElement(d.a,{className:"notion-calendar-picker notranslate",numberOfMonths:1,firstDayOfWeek:e,initialMonth:a.toDate(),month:a.toDate(),locale:Z.a,localeUtils:X.a,selectedDays:[t],modifiers:{start:t},modifiersStyles:{start:this.getDayPickerActiveDayStyle()},showOutsideDays:!0,fixedWeeks:!0,navbarElement:this.renderNavbarElement,onDayClick:this.handleDayPickerDayClick,onMonthChange:this.handleDayPickerMonthChange})}}renderControls(){const{device:e}=this.environment,{shouldShowReminder:t}=this.props;return e.isMobile?r.a.createElement(T.a,{topBorder:!0},t&&this.renderReminderControl(),this.renderEndDateControl(),this.renderAllDayControl()):r.a.createElement(a.Fragment,null,t&&r.a.createElement(T.a,{topBorder:!0},this.renderReminderControl()),r.a.createElement(T.a,{topBorder:!0},this.renderEndDateControl(),this.renderAllDayControl()))}renderEndDateControl(){const{device:e}=this.environment,t=this.getDateValue();return r.a.createElement(P.a,{focused:!1,onClick:this.handleEndDateControlChange,title:r.a.createElement(G.a,{defaultMessage:"End date",id:"datePropertyMenu.menuItem.endDate.label"}),right:r.a.createElement(m.a,{on:"daterange"===t.type||"datetimerange"===t.type,onClick:this.handleEndDateControlChange,isAndroid:e.isAndroid})})}renderAllDayControl(){const{device:e}=this.environment,t=this.getDateValue();return r.a.createElement(P.a,{focused:!1,onClick:this.handleAllDayChange,title:r.a.createElement(G.a,{defaultMessage:"Include time",id:"datePropertyMenu.menuItem.includeTime.label",description:"Shown in the date property menu as an option for whether this date includes a time."}),right:r.a.createElement(m.a,{on:"date"!==t.type&&"daterange"!==t.type,onClick:this.handleAllDayChange,isAndroid:e.isAndroid})})}renderReminderControl(){const{device:e}=this.environment,{intl:t}=this.props,n=this.getDateValue();return r.a.createElement(E.a,{popupType:e.isMobile?E.a.PopupType.SlideUp:E.a.PopupType.Popup,placementToOrigin:E.a.Placement.Right,renderOrigin:a=>r.a.createElement(R.a,Object.assign({},a,{icon:A.a.alarmClock({width:14}),title:r.a.createElement(G.a,{defaultMessage:"Remind",id:"datePropertyMenu.menuItem.remind.label"}),focused:!1,showExtensionArrow:e.isMobile,right:Object(U.b)({reminder:n.reminder,intl:t})})),render:a=>{let i;i=e.isMobile?{menuType:j.b.MenuType.Modal,title:r.a.createElement(G.a,{defaultMessage:"Remind",id:"datePropertyMenu.mobileRemindModal.title"}),right:r.a.createElement(G.a,{defaultMessage:"Done",id:"datePropertyMenu.mobileDoneReminderButton.label"}),onClickRight:a.close}:{menuType:j.b.MenuType.Popup,width:250};const s=("date"===n.type||"daterange"===n.type?l.q:l.t).map(e=>{const n=Object(U.b)({reminder:e,shouldShowTime:!0,intl:t});return{key:n,action:t=>{this.handleChangeReminder(e),a.close()},render:(e,t)=>r.a.createElement(P.a,Object.assign({},e,{title:n}))}});return r.a.createElement(j.b,Object.assign({},i),r.a.createElement(x.a,{type:x.a.Type.Vertical,sections:[{key:"reminder section",render:e=>r.a.createElement(T.a,Object.assign({},e)),items:s}],initialFocus:void 0}))}})}renderFormatPopup(){const{device:e}=this.environment;return r.a.createElement(E.a,{popupType:e.isMobile?E.a.PopupType.SlideUp:E.a.PopupType.Popup,placementToOrigin:E.a.Placement.Right,renderOrigin:t=>r.a.createElement(P.a,Object.assign({},t,{icon:A.a.sidebarSettings({width:14}),title:r.a.createElement(G.a,{defaultMessage:"Date format & timezone",id:"datePropertyMenu.menuItem.formatAndTimezone.label"}),focused:!1,showExtensionArrow:e.isMobile})),render:t=>{let n;return n=e.isMobile?{menuType:j.b.MenuType.Modal,title:r.a.createElement(G.a,{defaultMessage:"Date format",id:"datePropertyMenu.mobileDateFormatModal.title"}),right:r.a.createElement(G.a,{defaultMessage:"Done",id:"datePropertyMenu.mobileDoneButton.label"}),onClickRight:t.close}:{menuType:j.b.MenuType.Popup,width:250},r.a.createElement(j.b,Object.assign({},n),r.a.createElement(T.a,null,this.renderDateFormatControl(),this.renderTimeFormatControl(),this.renderTimeZoneControl()))}})}renderDateFormatControl(){const e=this.props.dateFormat||l.v,{intl:t}=this.props,n={menuTitle:t.formatMessage({defaultMessage:"Date format",id:"datePropertyMenu.dateFormatDropdownButton.label"}),items:l.c,getKey:e=>e,selectedItem:e,onSelect:this.handleDateFormatChange,renderItem:e=>r.a.createElement(P.a,Object.assign({},e,{title:t.formatMessage(l.b[e.value])})),renderOrigin:n=>r.a.createElement(R.a,Object.assign({focused:!1,title:r.a.createElement(G.a,{defaultMessage:"Date format",id:"datePropertyMenu.menuItem.format.label"}),right:e?t.formatMessage(l.b[e]):r.a.createElement(G.a,{defaultMessage:"Empty",id:"datePropertyMenu.formatMenu.emptyButton.label"})},n))};return r.a.createElement(p.a,Object.assign({},n))}renderTimeFormatControl(){const e=this.getDateValue(),t="date"===e.type||"daterange"===e.type,n=this.getTimeFormat(),{intl:a}=this.props,i=this.getSelectedTimeFormatType(),s={menuTitle:a.formatMessage({defaultMessage:"Time format",id:"datePropertyMenu.timeFormatMenu.title"}),items:l.e,getKey:e=>e,selectedItem:i,onSelect:this.handleTimeFormatChange,renderItem:e=>r.a.createElement(P.a,Object.assign({},e,{title:a.formatMessage(l.a[e.value])})),disabled:t,renderOrigin:e=>r.a.createElement(R.a,Object.assign({focused:!1,title:r.a.createElement(G.a,{defaultMessage:"Time format",id:"datePropertyMenu.menuItem.timeFormat.label"}),disabled:t,right:!t&&(n?a.formatMessage(l.a[i]):r.a.createElement(G.a,{defaultMessage:"Empty",id:"datePropertyMenu.timeFormatMenu.emptyButton.label"}))},e))};return r.a.createElement(p.a,Object.assign({},s))}renderTimeZoneControl(){const{device:e}=this.environment,t=this.getDateValue(),n="date"===t.type||"daterange"===t.type,a=this.getCurrentTimeZone(),i=g.find(e=>e.name===a),{intl:s}=this.props;if(i)return r.a.createElement(E.a,{popupType:e.isMobile?E.a.PopupType.SlideUp:E.a.PopupType.Popup,disabled:n,onClick:()=>this.stores.timezoneQuery.set(""),renderOrigin:e=>r.a.createElement(R.a,Object.assign({focused:!1,title:r.a.createElement(G.a,{defaultMessage:"Timezone",id:"datePropertyMenu.menuItem.time.label"}),disabled:n,right:!n&&u.a.tz.zone(i.name).abbr(Date.now())},e)),render:t=>{const n=this.stores.timezoneQuery.get(),a=this.getTimeZoneItemsSync(n),i=r.a.createElement(T.a,{isInput:!0},r.a.createElement(D.a,{focus:!e.isMobile||void 0,focusAfterAnimation:!0,value:this.stores.timezoneQuery.get(),onChange:e=>this.stores.timezoneQuery.set(e.target.value),placeholder:s.formatMessage({defaultMessage:"Search for a timezone…",id:"datePropertyMenu.timeSearch.placeholder"})}));let o;return o=e.isMobile?{menuType:j.b.MenuType.Modal,title:r.a.createElement(G.a,{defaultMessage:"Timezone",id:"datePropertyMenu.mobileTimezoneMenu.title"}),right:r.a.createElement(Y.CancelMenuText,null),onClickRight:t.close,header:i}:{menuType:j.b.MenuType.Popup,header:i},r.a.createElement(j.b,Object.assign({},o),0===a.length?r.a.createElement(T.a,{title:r.a.createElement(G.a,{defaultMessage:"Select a timezone",id:"datePropertyMenu.timezoneMenu.select.placeholder"})},r.a.createElement(B.a,{title:r.a.createElement(G.a,{defaultMessage:"No results",id:"datePropertyMenu.timezoneMenu.noResults"})})):r.a.createElement(x.a,{type:x.a.Type.Vertical,initialFocus:0,sections:[{key:"timezone section",render:e=>r.a.createElement(T.a,Object.assign({},e,{title:r.a.createElement(G.a,{defaultMessage:"Select a timezone",id:"datePropertyMenu.menuItem.select.title"})})),items:a}],onAccept:t.close}))}})}renderClearButton(){return r.a.createElement(P.a,{focused:!1,onClick:this.handleClearClick,title:r.a.createElement(G.a,{defaultMessage:"Clear",id:"datePropertyMenu.clearButton.label"})})}renderRemindersHelp(){const{device:e}=this.environment;return e.isMobile?r.a.createElement(q.a,{href:Object(Q.a)("guides.reminders"),analyticsFrom:"date_selector"}):r.a.createElement(V.a,{title:r.a.createElement(G.a,{defaultMessage:"Learn about reminders",id:"datePropertyMenu.learnMore.helpButton.label"}),href:Object(Q.a)("guides.reminders"),analyticsFrom:"date_selector"})}getDateValue(){const{value:e}=this.props;return e&&!s.a.isNaN(e)?e:this.openTimeFormat}getDateRangeBounds(){const e=this.getDateValue();if(l.W(e)||l.Y(e)){const t=l.K(e,l.m);return{earliestValidEnd:t.start.format(l.ib),latestValidStart:t.end.format(l.ib)}}}getDateValueForceCurrentTimeZone(){const{value:e}=this.props;return e&&!s.a.isNaN(e)?"datetime"===e.type||"datetimerange"===e.type?J({},e,{time_zone:l.m}):e:this.openTimeFormat}getDateDisplayFormat(){const e=this.props.dateFormat||l.v;return"relative"===e?l.v:e}getTimeFormat(){return this.props.timeFormat||l.x}getCurrentTimeZone(){const e=this.getDateValue();return"datetime"===e.type||"datetimerange"===e.type?e.time_zone:l.m}parseInputDateValue(e){const{intl:t}=this.props;return this.environment.device.isMobile?Object(L.b)(e,l.ib,t):Object(L.b)(e,this.getDateDisplayFormat(),t)}parseInputTimeValue(e){const t=Object(u.a)(e,this.getTimeFormat(),!0);return t.isValid()?t.locale(l.jb).format(l.kb):Object(L.f)(e,this.props.intl)}applyValidDateState(e){const{newDate:t,currentMonth:n,resetField:a}=e;this.props.onChangeValue(t),this.stores.store.setState(J({},this.stores.store.state,{currentMonth:n})),this.resetInputState(a)}resetInputState(e){const{state:t}=this.stores.store;this.stores.store.setState(J({},t,{error:J({},t.error,{[t.focus]:void 0}),inputTemporaryValue:J({},t.inputTemporaryValue,{[t.focus]:void 0})}))}getInputErrorMessage(e){const{intl:t}=this.props;switch(e){case f.InvalidDate:return t.formatMessage({id:"datePropertyMenu.invalidDateError.tooltip",defaultMessage:"Invalid date"});case f.InvalidRange:return t.formatMessage({id:"datePropertyMenu.invalidDateOrTimeRangeError.tooltip",defaultMessage:"Invalid range"});case f.InvalidTime:return t.formatMessage({id:"datePropertyMenu.invalidTimeError.tooltip",defaultMessage:"Invalid time"});default:return}}getInputSeparator(){return r.a.createElement("div",{style:{height:14,width:1,background:this.theme.regularDividerColor,marginLeft:6,marginRight:12,flexShrink:0}})}getInputWrapStyle(){return{display:"flex",alignItems:"center",borderRadius:3,height:28,lineHeight:1.2,background:this.theme.inputBackground,paddingLeft:8,paddingRight:8,flexBasis:"50%"}}getInputWrapInactiveStyle(){return J({},this.getInputWrapStyle(),{boxShadow:this.theme.inputBoxShadow,flexGrow:1})}getInputWrapErrorStyle(){return J({},this.getInputWrapStyle(),{boxShadow:"inset 0 0 0 2px ".concat(N.f.red),background:N.f.redWithAlpha(.15),flexGrow:1})}getInputWrapActiveStyle(){return J({},this.getInputWrapStyle(),{boxShadow:"inset 0 0 0 2px ".concat(N.f.blue),background:N.f.blueWithAlpha(.15),flexGrow:1})}getDayPickerActiveDayStyle(){return{backgroundColor:N.f.blue,color:N.f.white}}getDayPickerInactiveDayStyle(){return{backgroundColor:N.f.blueWithAlpha(.5)}}}te.dayPickerRangeDayStyle={backgroundColor:N.f.blueWithAlpha(.15)},te.desktopNavStyle={display:"flex",position:"absolute",top:0,right:4,zIndex:F.i},te.mobileNavStyle={display:"flex",position:"absolute",top:-2,right:4,zIndex:F.i};t.default=Object(G.g)(te)},1112:function(e,t,n){"use strict";n.r(t);n(15),n(11);var a,r=n(2),i=n.n(r),s=n(0),o=n.n(s),l=n(36),c=n(251),d=n(8),u=n(288),p=n(72),m=n(27),h=n(67),g=n(192),b=n(3),f=n(82),y=n(112),S=n(696),v=n(118),E=n(14),M=n(256),C=n(40),O=n(34),w=n(20),k=n(258),P=n(86),T=n(1),I=n(299),j=n(153),D=n(61),x=n(76),B=n(89),A=n(618),F=n(10);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){U(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Web=0]="Web",e[e.Workspace=1]="Workspace",e[e.User=2]="User"}(a||(a={}));class _ extends b.a{constructor(){super(...arguments),this.copiedLink=new D.a(!1),this.showLinkOptions=new D.a(!1),this.storeTypes={buttonPopupStore:f.a},this.renderLinkOptionsButton=()=>o.a.createElement(x.a,{onClick:this.handleShowLinkOptionsClick,style:L({},this.getPublicAccessOptionStyle())},o.a.createElement(P.a,{isSmall:!0},o.a.createElement(T.a,{defaultMessage:"Show link options",id:"pagePermissionItem.showLinkOptions.label"}),d.a.chevronDown({width:9,height:9,marginLeft:4,display:"inline"}))),this.renderAllowEditsTooltip=()=>o.a.createElement(k.a,{caption:o.a.createElement(T.a,{defaultMessage:"Any logged in Notion user can edit this page. Share the secret link with people you trust.",id:"pagePermissionItem.allowEdits.tooltip"}),imageHeight:120,imageWidth:240,imageURL:w.a.images.tooltips.share.allowEditingPng}),this.renderAllowCommentsTooltip=()=>o.a.createElement(k.a,{caption:o.a.createElement(T.a,{defaultMessage:"Any logged in Notion user can comment on this page.",id:"pagePermissionItem.allowComments.tooltip"}),imageHeight:120,imageWidth:240,imageURL:w.a.images.tooltips.share.allowCommentsPng}),this.renderAllowSearchEngineTooltip=()=>o.a.createElement(k.a,{caption:o.a.createElement(T.a,{defaultMessage:"If allowed, your public page may appear in search engines such as Google, but only if you or someone else links to it elsewhere on the web.",id:"pagePermissionItem.allowSearchEngine.tooltip"}),imageHeight:120,imageWidth:240,imageURL:w.a.images.tooltips.share.allowSearchEnginesPng}),this.renderAllowSearchEngineUpgradeTooltip=()=>o.a.createElement(k.a,{imageURL:w.a.images.tooltips.upsells.searchEngineIndexingPng,imageWidth:240,imageHeight:100,title:o.a.createElement(T.a,{defaultMessage:"Upgrade for search engine indexing",id:"pagePermissionItem.searchEngineUpgradeTooltip.title"}),caption:o.a.createElement(T.a,{defaultMessage:"Have your page appear in search engine results.",id:"pagePermissionItem.searchEngineUpgradeTooltip.caption"})}),this.renderAllowDuplicateTooltip=()=>o.a.createElement(k.a,{caption:o.a.createElement(T.a,{defaultMessage:"If allowed, this will allow other people to duplicate your public page to their workspace.",id:"pagePermissionItem.allowDuplicateTemplate.tooltip"}),imageHeight:120,imageWidth:240,imageURL:w.a.images.tooltips.share.allowDuplicatePng}),this.handleCopy=()=>{const e=Object(h.a)({store:this.props.currentBlockStore});c.c({environment:this.environment,stringValue:e}),clearTimeout(this.copiedLinkTimeout),this.copiedLink.set(!0),this.copiedLinkTimeout=window.setTimeout(()=>{this.copiedLink.set(!1)},1e3)},this.handleShowLinkOptionsClick=()=>{this.showLinkOptions.set(!0)},this.handleToggleAllowEdits=()=>{const{permissionItem:e}=this.props;"public_permission"===e.type&&this.props.onChange(L({},e,{role:"read_and_write"===e.role?"comment_only":"read_and_write"}))},this.handleToggleAllowComments=()=>{const{permissionItem:e}=this.props;"public_permission"===e.type&&this.props.onChange(L({},e,{role:"comment_only"===e.role||"read_and_write"===e.role?"reader":"comment_only"}))},this.handleToggleSearchEngine=()=>{const{permissionItem:e}=this.props;if("public_permission"===e.type){const t=e,n=Boolean(t.allow_search_engine_indexing),a=i.a.clone(t),r=!n;a.allow_search_engine_indexing=r,this.props.onChange(a),E.te(this.environment,{allow_search_engine_indexing:r})}},this.handleToggleDuplicate=()=>{const{permissionItem:e}=this.props;if("public_permission"===e.type){const t=e,n=void 0===t.allow_duplicate||!0===t.allow_duplicate,a=i.a.clone(t),r=!n;a.allow_duplicate=r,this.props.onChange(a),E.se(this.environment,{allow_duplicate:r})}},this.handleRoleSelect=e=>{const t=i.a.clone(this.props.permissionItem);t.role=e,this.props.onChange(t)},this.handleSwitcherButtonClick=()=>{"none"===this.role?this.handleRoleSelect(this.props.switcherRole||"editor"):this.handleRoleSelect("none")},this.handleUserItemClick=()=>{this.stores.buttonPopupStore.setState(L({},this.stores.buttonPopupStore.state,{open:!0}))}}willMount(e){super.willMount(e),l.n(e.permissionItem)&&"none"===e.permissionItem.role&&this.showLinkOptions.set(!0)}renderComponent(){const{device:e}=this.environment,{tooltip:t}=this.props,n=this.isUserItem()||!this.isPublicPermissionItem?this.handleUserItemClick:this.handleSwitcherButtonClick;return t?o.a.createElement(s.Fragment,null,o.a.createElement(C.a,{delayThreshold:0,renderTooltip:()=>t,render:t=>o.a.createElement(O.a,Object.assign({disabled:this.props.disabled,mobileFeedback:e.isMobile,style:L({},this.props.disabled?{cursor:"not-allowed"}:{}),onClick:n},t),this.renderMenuItem()),placement:C.a.Placement.Left}),this.renderPublicPermissionSettings()):o.a.createElement(s.Fragment,null,o.a.createElement(O.a,{disabled:this.props.disabled,style:L({},this.props.disabled?{cursor:"not-allowed"}:{}),onClick:n},this.renderMenuItem()),this.renderPublicPermissionSettings())}renderMenuItem(){const{device:e}=this.environment,{isInherited:t,permissionItem:n}=this.props,a=this.isUserItem(),r=this.isBotPermissionItem(),i=!a&&!r,s=l.p(n)||l.i(n),c=!(this.isPublicPermissionItem||s&&"none"===this.role);return o.a.createElement("div",{className:"notranslate",style:this.getMenuItemStyle(a)},o.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,marginRight:e.isMobile?12:10}},this.props.icon),o.a.createElement("div",{style:{marginRight:"auto",minWidth:0}},o.a.createElement(P.a,{style:L({},!a&&{fontWeight:400})},this.props.title),this.props.subtitle&&o.a.createElement(P.a,{isSmall:!0},this.props.subtitle),t&&this.renderInheritedRecordTitle()),o.a.createElement("div",{style:{display:"flex",alignItems:"center",flexShrink:0,marginLeft:8}},this.isPublicPermissionItem?o.a.createElement(o.a.Fragment,null,c&&!s&&o.a.createElement(S.a,{role:this.role,table:F.a,type:n.type,disabled:this.props.disabled,isSubscribed:this.props.isSubscribed,isUserPermission:this.permissionItemIsUserItem(n),onChange:this.handleRoleSelect,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonPopupStore:this.stores.buttonPopupStore,buttonStyle:{marginRight:e.isMobile||a||r?-6:8,color:this.theme.mediumTextColor,fontSize:e.isMobile?14:12}}),i&&o.a.createElement(M.a,{on:"none"!==this.role,onClick:this.handleSwitcherButtonClick,disabled:this.props.disabled,isAndroid:e.isAndroid})):o.a.createElement(S.a,{role:this.role,table:F.a,type:n.type,disabled:this.props.disabled,isSubscribed:this.props.isSubscribed,isUserPermission:this.permissionItemIsUserItem(n),onChange:this.handleRoleSelect,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonPopupStore:this.stores.buttonPopupStore,buttonStyle:{marginRight:-6,color:this.theme.mediumTextColor,fontSize:e.isMobile?14:12},showPermissionOverrideWarning:this.props.isInherited})))}getPublicPermissionSettingsHeight(e){const{device:t}=this.environment;return e?0:t.isMobile?this.showLinkOptions.get()?214:94:this.showLinkOptions.get()?184:88}renderPublicPermissionSettings(){const{device:e}=this.environment,{permissionItem:t}=this.props;if(l.n(t)){const n="none"===this.role;return o.a.createElement("div",{style:{maxHeight:this.getPublicPermissionSettingsHeight(n),transition:"max-height ease 200ms, padding-bottom ease 200ms",overflow:"hidden",paddingBottom:n?0:this.showLinkOptions.get()?12:8}},!e.isMobile&&this.renderPageLinkButton(),this.showLinkOptions.get()?o.a.createElement(o.a.Fragment,null,o.a.createElement(o.a.Fragment,null,o.a.createElement(C.a,{placement:C.a.Placement.Left,renderTooltip:this.renderAllowEditsTooltip,render:n=>o.a.createElement(O.a,Object.assign({onClick:this.handleToggleAllowEdits,style:this.getPublicAccessOptionStyle(),disabled:this.props.disabled},n),o.a.createElement(P.a,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},o.a.createElement(T.a,{defaultMessage:"Allow editing",id:"pagePermissionItem.allowEdits.setting"})),o.a.createElement(M.a,{on:"read_and_write"===t.role,onClick:this.handleToggleAllowEdits,disabled:this.props.disabled,isAndroid:e.isAndroid}))}),o.a.createElement(C.a,{placement:C.a.Placement.Left,renderTooltip:this.renderAllowCommentsTooltip,render:t=>o.a.createElement(O.a,Object.assign({onClick:this.handleToggleAllowComments,style:this.getPublicAccessOptionStyle(),disabled:this.props.disabled},t),o.a.createElement(P.a,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},o.a.createElement(T.a,{defaultMessage:"Allow comments",id:"pagePermissionItem.allowComments.setting"})),o.a.createElement(M.a,{on:"comment_only"===this.role||"read_and_write"===this.role,onClick:this.handleToggleAllowComments,disabled:this.props.disabled,isAndroid:e.isAndroid}))})),o.a.createElement(C.a,{placement:C.a.Placement.Left,renderTooltip:this.renderAllowDuplicateTooltip,render:n=>o.a.createElement(O.a,Object.assign({onClick:this.handleToggleDuplicate,disabled:this.props.disabled,style:this.getPublicAccessOptionStyle()},n),o.a.createElement(P.a,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},o.a.createElement(T.a,{defaultMessage:"Allow duplicate as template",id:"pagePermissionItem.allowDuplicateTemplate.setting"})),o.a.createElement(M.a,{on:!1!==t.allow_duplicate,onClick:this.handleToggleDuplicate,disabled:this.props.disabled,isAndroid:e.isAndroid}))}),o.a.createElement(A.a,{requireUpgradeToTier:!Object(B.K)(this.environment)&&Object(B.k)(this.environment),alwaysAllowClick:t.allow_search_engine_indexing,analyticsName:"allow_search_engine_indexing",onClick:this.handleToggleSearchEngine,onUpgradeClick:this.props.onUpgradeButtonClick,tooltipPlacement:C.a.Placement.Left,renderTooltip:this.renderAllowSearchEngineTooltip,renderUpgradeTooltip:this.renderAllowSearchEngineUpgradeTooltip,render:(n,a)=>o.a.createElement(O.a,Object.assign({style:this.getPublicAccessOptionStyle(),disabled:this.props.disabled},n),o.a.createElement(P.a,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},o.a.createElement(T.a,{defaultMessage:"Search engine indexing",id:"pagePermissionItem.allowSearchEngines.setting"})," ",a),o.a.createElement(M.a,{on:Boolean(t.allow_search_engine_indexing),onClick:this.handleToggleSearchEngine,disabled:this.props.disabled||Boolean(a),isAndroid:e.isAndroid}))})):this.renderLinkOptionsButton())}}renderPageLinkButton(){const e=Object(h.a)({store:this.props.currentBlockStore});return o.a.createElement("div",{style:L({},this.getPublicAccessOptionStyle(),{height:"auto"})},o.a.createElement("div",{style:{flex:1}},o.a.createElement("div",{style:{display:"flex",padding:"1px 0"}},o.a.createElement(j.b,{value:e,disabled:!0,style:{flex:1,borderTopRightRadius:0,borderBottomRightRadius:0,paddingRight:0}}),o.a.createElement(I.a,{onClick:this.handleCopy,style:{height:28,borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",minWidth:88}},this.copiedLink.get()?o.a.createElement(T.a,{id:"pageShareMenu.copiedLinkButton.label",defaultMessage:"✓ Copied"}):o.a.createElement(T.a,{id:"pageShareMenu.copyLinkButton.label",defaultMessage:"Copy link"})))))}renderInheritedRecordTitle(){const e=this.props.store,t=Object(h.a)({store:e,fullyQualified:!1});return o.a.createElement(P.a,{isSmall:!0,style:{lineHeight:1.4}},o.a.createElement(T.a,{defaultMessage:"Based on {linkBoxWithPageTitle}",description:"This text tells the user that this permission setting for the page is inherited from the parent page. ",id:"pagePermissionItem.inheritedRecordPermissions.setting",values:{linkBoxWithPageTitle:o.a.createElement(y.a,{underline:!0,inline:!0,href:t},o.a.createElement(v.a,{store:e,style:{display:"inline"}}))}}))}permissionItemIsUserItem(e){const t=this.environment.currentUser.id;return"user_permission"===e.type&&e.user_id===t}isUserItem(){return this.props.format===a.User}get role(){return this.props.permissionItem.role}get isPublicPermissionItem(){return l.n(this.props.permissionItem)}isBotPermissionItem(){return l.g(this.props.permissionItem)}getMenuItemStyle(e){const{WindowSizeStore:t}=this.environment;return{display:"flex",alignItems:"center",minHeight:52,paddingTop:8,paddingBottom:8,paddingLeft:t.getSafePaddingLeftCSS(14),paddingRight:t.getSafePaddingRightCSS(14)}}getPublicAccessOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;let n;return n=e.isMobile?36:30,{display:"flex",alignItems:"center",width:"100%",height:n,paddingTop:5,paddingBottom:5,paddingLeft:t.getSafePaddingLeftCSS(14),paddingRight:t.getSafePaddingRightCSS(14)}}getPublicAccessOptionLabelStyle(e){return{marginRight:"auto",opacity:e?.6:1}}}_.Format=a,_.iconSize=32;var W=_,N=n(173),z=n(22),V=n(749),q=n(12),H=n(90),G=n(23),Y=n(37),Q=n(408),K=n(747),Z=n(466),X=n(17),$=n(81),J=n(119),ee=n(32),te=n(68),ne=n(161),ae=n(139),re=n(52),ie=n(193),se=n(210),oe=n(54),le=n(83),ce=n(94),de=n(587),ue=n(133),pe=n(116),me=n(833),he=n(184);class ge extends b.a{renderComponent(){const{device:e,WindowSizeStore:t}=this.environment;return o.a.createElement(he.a,{href:Object(ue.a)("guides.sharing"),onClick:()=>E.B(this.environment,{from:"sharing"}),style:{width:e.isMobile?"100%":void 0},external:!0},o.a.createElement(x.a,{mobileFeedback:e.isMobile,isSmall:!0,style:{display:"flex",alignItems:"center",width:e.isMobile?"100%":void 0,height:e.isMobile?44:24,paddingTop:e.isMobile?12:4,paddingBottom:e.isMobile?12:4,paddingLeft:t.getSafePaddingLeftCSS(8),paddingRight:t.getSafePaddingRightCSS(12)}},o.a.createElement("div",{style:{marginLeft:e.isMobile?2:0,marginRight:e.isMobile?8:6}},d.a.help({width:e.isMobile?16:14,height:e.isMobile?16:14,fill:e.isMobile?this.theme.mediumIconColor:this.theme.lightIconColor})),o.a.createElement(P.a,{isSmall:!0,isMobile:e.isMobile,isSecondaryColor:!e.isMobile},o.a.createElement(T.a,{defaultMessage:"Learn about sharing",id:"blockPermissionsSettings.learnMore.prompt"}))))}}var be=ge,fe=n(505),ye=n(9),Se=n(586),ve=n(419),Ee=n(170);function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(n),!0).forEach((function(t){Oe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class we extends b.a{constructor(){super(...arguments),this.sidebarState=this.createComputedStore(()=>Object(le.i)(this.environment)),this.storeTypes={restrictConfirmationModalStore:D.a.of({open:!1,onClose:void 0})},this.renderBotPermissionTooltip=()=>o.a.createElement(k.a,{imageWidth:240,caption:o.a.createElement(T.a,{defaultMessage:"This is a bot inside your workspace.",id:"blockPermissionsSettings.botPermission.tooltip"})}),this.renderPublicPermissionTooltip=()=>o.a.createElement(k.a,{imageURL:w.a.images.tooltips.share.publicPagePng,imageWidth:240,imageHeight:120,caption:o.a.createElement(T.a,{defaultMessage:"Anybody with the link can access the page.",id:"blockPermissionsSettings.publicPermission.tooltip"})}),this.renderSpacePermissionTooltip=()=>o.a.createElement(k.a,{imageURL:w.a.images.tooltips.share.workspacePng,imageWidth:240,imageHeight:180,caption:o.a.createElement(T.a,{defaultMessage:"For all members in your workspace, this page will show up in the <boldtext>Workspace</boldtext> section in their sidebar.",values:{boldtext:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return o.a.createElement("span",{style:{fontWeight:G.a.fontWeight.bold}},t)}},id:"blockPermissionsSettings.spacePermission.tooltip"})}),this.renderGroupPermissionTooltip=e=>{const{currentSpaceStore:t}=X.a.state,{countRemainingUsers:n,limitedUserValues:a}=K.b({group:e,spaceStore:t,limit:15});if(a.length>0)return o.a.createElement("div",{style:{marginBottom:4}},a.map(e=>o.a.createElement("div",{key:e.id,style:{display:"flex",alignContent:"flex-end",minWidth:140,width:"100%",marginTop:4}},o.a.createElement(fe.a,{style:{flexGrow:1},userValue:e,avatarSize:18}))),n>0&&o.a.createElement("div",{style:{marginLeft:2,marginTop:2,color:this.theme.mediumInvertedTextColor}},o.a.createElement(T.a,{id:"blockPermissionsSettings.groupPermissionUsers.tooltip",defaultMessage:"{countRemainingUsers} more…",values:{countRemainingUsers:n}})));const r=Object(K.a)({intl:this.props.intl,group:e});return o.a.createElement(k.a,{imageURL:w.a.images.tooltips.share.sharedPng,imageWidth:240,imageHeight:120,caption:o.a.createElement(T.a,{defaultMessage:"For all members of the {groupName} group, this page will show up in the <boldtext>Shared</boldtext> section in their sidebar.",values:{boldtext:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return o.a.createElement("span",{style:{fontWeight:G.a.fontWeight.bold}},t)},groupName:r},id:"blockPermissionsSettings.groupPermission.tooltip"})})},this.renderUserPermissionItem=e=>{const{store:t}=this.props,n=m.a.createChildStore(t,{table:F.a,id:e.blockId}),a=g.a.createChildStore(t,{table:Y.a,id:e.permissionItem.user_id}).getValue(),r=n.id!==t.id,i=e=>o.a.createElement("div",{style:Ce({},e.style,{background:this.theme.lightDividerColor})}),s=a?o.a.createElement(se.a,{userValue:a,size:W.iconSize}):o.a.createElement(i,{style:{height:W.iconSize,width:W.iconSize,borderRadius:20}}),{data:c}=J.a.state,u=(c?B.v(c):[]).find(t=>t.userId===e.permissionItem.user_id),p=Boolean(u&&!l.a(u.role)&&!l.c(u.role)),h=a&&a.email?p?o.a.createElement("div",{style:G.a.textOverflowStyle},d.a.globe2({width:14,fill:"#CF8807",display:"inline",verticalAlign:"middle"})," ",o.a.createElement("span",{style:{color:"#CF8807",fontWeight:500}},o.a.createElement(T.a,{defaultMessage:"Guest",id:"blockPermissionsSettings.permissionsForUserGuest.label"}))," • ",a.email):a.email:void 0;return o.a.createElement("div",{key:e.permissionItem.user_id},o.a.createElement(W,{format:W.Format.User,currentBlockStore:t,store:n,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:s,title:a?Object(Y.d)(a)||o.a.createElement(T.a,{defaultMessage:"Invitation sent",id:"blockPermissionsSettings.sentInvitation.message"}):o.a.createElement(i,{style:{height:8,width:81,borderRadius:3}}),subtitle:a?h:o.a.createElement(i,{style:{height:8,width:139,borderRadius:3,marginTop:10}}),isSubscribed:this.isSubscribed(),isInherited:r,tooltip:r?this.renderInheritedPermissionTooltip(n):void 0,upgradeButtonName:"user_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:r,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))},this.renderBotPermissionItem=e=>{const{store:t}=this.props,n=m.a.createChildStore(t,{table:F.a,id:e.blockId}),a=Object(re.c)(t,{table:ie.a,id:e.permissionItem.bot_id}),r=a.getValue(),i=n.id!==t.id,s=r&&r.name||o.a.createElement(T.a,{id:"blockPermissionsSetings.untitledBotPlaceholder",defaultMessage:"Untitled Bot"}),l=o.a.createElement("div",{style:G.a.textOverflowStyle},d.a.bot({width:12,display:"inline",verticalAlign:"middle"})," ",o.a.createElement(T.a,{defaultMessage:"Bot",id:"blockPermissionsSettings.permissionsForBot.label",description:"Inform user that this page is shared with a bot."})),c=o.a.createElement(ve.a,{botValue:r,size:W.iconSize});return o.a.createElement("div",{key:a.id,style:this.getPermissionItemWrapStyle()},o.a.createElement(W,{format:W.Format.Workspace,currentBlockStore:t,store:n,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:c,title:s,tooltip:i?this.renderInheritedPermissionTooltip(n):this.renderBotPermissionTooltip(),subtitle:l,isSubscribed:this.isSubscribed(),isInherited:i,upgradeButtonName:"bot_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:i,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))},this.handleCopy=()=>{const e=Object(h.a)({store:this.props.store});c.c({environment:this.environment,stringValue:e}),this.props.buttonPopupStore.setState({open:!1})},this.handleReactNativeShareClick=()=>{const{reactNative:e}=this.environment,t=Z.a({schemeUrl:window.location.href,baseUrl:ee.a.baseURL});e&&e.share(t)},this.handleCloseRestrictConfirmationModal=()=>{this.stores.restrictConfirmationModalStore.setState({open:!1,onClose:void 0})},this.handlePermissionItemChange=async e=>{const{isInherited:t,oldPermissionItem:n,newPermissionItem:a}=e;if(!Object(ae.m)(n,a))throw new Error("Permission type mismatch.");const r=Object(ae.e)(n.role,a.role);if(t&&r!==a.role)return void this.handleRestrictPermission(a);const i=this.props.store.isTopLevel();if(i&&l.p(a)){const{data:e}=J.a.state,t=e?B.u(e):1;if(l.d(n.role)&&!l.d(a.role)&&t>1){if(!(await oe.a({message:o.a.createElement("span",null,o.a.createElement(T.a,{defaultMessage:"Are you sure you want to make this page private? <semibold>Only you will be able to access it.</semibold>",values:{semibold:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return o.a.createElement("span",{style:{fontWeight:G.a.fontWeight.semibold}},t)}},id:"blockPermissionsSettings.confirmationDialog.private.message"})),acceptLabel:o.a.createElement(T.a,{defaultMessage:"Move to Private",id:"blockPermissionsSettings.confirmationDialog.privateButton.label"})})))return}else if(i&&!l.d(n.role)&&l.d(a.role)){if(!(await oe.a({message:o.a.createElement("span",null,o.a.createElement(T.a,{defaultMessage:"Are you sure you want to share this page with the workspace? <semibold>It will be accessible by all {memberCount} members.</semibold>",id:"blockPermissionsSettings.confirmationDialog.workspace.message",values:{semibold:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return o.a.createElement("span",{style:{fontWeight:G.a.fontWeight.semibold}},t)},memberCount:t}})),acceptLabel:o.a.createElement(T.a,{defaultMessage:"Move to workspace",id:"blockPermissionsSettings.confirmationDialog.workspaceButton.label"})})))return}}!i&&n.role!==a.role&&r!==n.role&&E.Ie(this.environment),q.d(this.environment,e=>{u.f({environment:this.environment,store:this.props.store,permissionItems:[a],transaction:e})})},this.handleRestrictPermission=e=>{const t=()=>{q.d(this.environment,async t=>{await u.e({environment:this.environment,store:this.props.store,permissionItem:e,transaction:t})})};"none"===e.role?this.stores.restrictConfirmationModalStore.setState({open:!0,onClose:this.handleCloseRestrictConfirmationModal,type:"remove",permissionItem:e,onAccept:t}):this.stores.restrictConfirmationModalStore.setState({open:!0,onClose:this.handleCloseRestrictConfirmationModal,type:"restrict",onAccept:t})}}renderComponent(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:z.b.MenuType.Modal,title:o.a.createElement(T.a,{defaultMessage:"Share",id:"blockPermissionsSettings.mobileShareMenu.title"}),left:this.renderMobileHelpButton(),right:o.a.createElement(ce.DoneMenuText,null),onClickRight:this.props.onClose}:{menuType:z.b.MenuType.Popup},o.a.createElement(o.a.Fragment,null,o.a.createElement(me.a,Object.assign({},this.stores.restrictConfirmationModalStore.state)),o.a.createElement(z.b,Object.assign({},t,{className:te.db}),o.a.createElement(Q.a,{capture:!0,allowEsc:!0},o.a.createElement(V.a,{capture:!0,ignoreBlockSelection:!0,restoreSelection:!1,focusOffscreenInput:!1,render:()=>$.a.state.online?this.renderPermissions():this.renderOfflineMessage()}))))}renderMobileHelpButton(){return o.a.createElement(de.a,{href:Object(ue.a)("guides.sharing"),analyticsFrom:"sharing"})}renderOfflineMessage(){const{device:e}=this.environment;return o.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:160}},o.a.createElement(P.a,{isMobile:e.isMobile,isSecondaryColor:!0,isMultiline:!0,style:{textAlign:"center"}},o.a.createElement(T.a,{defaultMessage:"Please go online to publish & share.",id:"blockPermissionsSettings.offline.prompt"})))}renderPermissions(){const{device:e,WindowSizeStore:t}=this.environment,{currentSpaceStore:n}=X.a.state,{store:a}=this.props,r=Object(ne.b)(a);let c=[];if(n){const e=n.getValue();e&&e.permission_groups&&(c=e.permission_groups)}let u={permissionItem:{type:"public_permission",role:"none"},blockId:a.id},p={permissionItem:{type:"space_permission",role:"none"},blockId:a.id};for(const i of r)if(l.n(i.permissionItem)){u=i}else if(l.p(i.permissionItem)){p=i}let m=r.filter(e=>{let{permissionItem:t}=e;return l.i(t)});m=i.a.sortBy(m,e=>{if(n){const t=n.getValue();if(t&&t.permission_groups)return t.permission_groups.findIndex(t=>t.id===e.permissionItem.group_id)}return e.permissionItem.group_id});const h=r.filter(e=>{let{permissionItem:t}=e;return l.q(t)}),g=r.filter(e=>{let{permissionItem:t}=e;return l.g(t)}),b={};let f=N.a.Y;e.isMobile?(b.backgroundColor=this.theme.contentBackground,f=N.a.None):b.maxHeight="calc(70vh - 80px)";const y=n&&!n.getDisablePublicAccess(),S=this.sidebarState.state,v=S&&S.showWorkspaceSection||n&&"team"===n.getPlanType(),E=v||h.length>1||h.length&&!l.a(h[0].permissionItem.role)||m.length||l.d(p.permissionItem.role),M=r.some(e=>l.o(e.permissionItem)&&e.blockId===a.id);return o.a.createElement("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column"}},e.isMobile&&o.a.createElement(s.Fragment,null,M&&this.renderRestrictedPermissionBanner(),o.a.createElement("div",{style:{display:"flex",paddingTop:10,paddingBottom:10,paddingRight:t.getSafePaddingRightCSS(14),background:this.theme.sidebarBackground}},this.renderPageLinkButton()),o.a.createElement("div",{style:{borderBottom:"1px solid ".concat(this.theme.regularDividerColor)}})),o.a.createElement(N.b,{style:b,type:f},!e.isMobile&&M&&this.renderRestrictedPermissionBanner(),y&&this.renderPublicPermissionItem(u),this.renderAddGuests(),v&&this.renderSpacePermissionItem(p),o.a.createElement("div",{style:this.getPermissionItemWrapStyle()},this.renderGroupPermissions({spacePermissionGroups:c,mostPermissiveGroupPermissions:m}),E&&o.a.createElement("div",{style:{paddingBottom:h.length>0?8:void 0}},h.map(this.renderUserPermissionItem))),g.map(this.renderBotPermissionItem)),o.a.createElement("div",{style:Ce({display:"flex",alignItems:e.isMobile?"flex-start":"center",boxShadow:"0 -1px 0 ".concat(this.theme.regularDividerColor),paddingLeft:t.getSafePaddingRightCSS(8),paddingRight:t.getSafePaddingRightCSS(8),flexDirection:"column-reverse"},!e.isMobile&&{flexDirection:"row",justifyContent:"space-between",padding:"4px 4px"})},!e.isMobile&&o.a.createElement(s.Fragment,null,o.a.createElement(be,null),o.a.createElement(C.a,{delayThreshold:0,placement:C.a.Placement.Bottom,renderTooltip:()=>this.getPageLinkInfoTooltip(),render:t=>o.a.createElement(x.a,Object.assign({isSmall:!0,onClick:e.isReactNative?this.handleReactNativeShareClick:this.handleCopy,mobileFeedback:e.isMobile,style:{height:e.isMobile?44:24,width:e.isMobile?"100%":void 0,paddingLeft:8,paddingRight:8,color:this.theme.regularTextColor}},t),d.a.link({width:e.isMobile?16:14,height:e.isMobile?16:14,fill:this.theme.regularIconColor,marginLeft:e.isMobile?2:0,marginRight:e.isMobile?8:6}),o.a.createElement(P.a,{isSmall:!0,isMobile:e.isMobile,style:{color:this.theme.regularTextColor}},o.a.createElement(T.a,{id:"blockPermissionsSettings.copyLinkButton.label",defaultMessage:"Copy link"})))}))))}renderInviteButton(){const{currentSpaceStore:e}=X.a.state,{device:t}=this.environment,{store:n}=this.props;return o.a.createElement(Ee.i,{store:n,disabled:!this.canEdit(),membersOnly:Boolean(e&&e.getDisableGuests()),isSubscribed:this.isSubscribed(),onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:"invite_permission_block",shouldGrow:!0,buttonStyle:{height:t.isMobile?36:28}})}renderPageLinkButton(){const{device:e}=this.environment;return o.a.createElement(C.a,{delayThreshold:0,placement:C.a.Placement.Bottom,renderTooltip:()=>this.getPageLinkInfoTooltip(),render:t=>o.a.createElement(I.a,Object.assign({isLarge:!0,onClick:e.isReactNative?this.handleReactNativeShareClick:this.handleCopy,style:{marginLeft:12,flex:1,height:this.environment.device.isMobile?36:void 0,background:this.theme.contentBackground}},t),e.isReactNative?o.a.createElement(T.a,{id:"pageShareMenu.sharePageLinkButton.label",defaultMessage:"Share page link"}):o.a.createElement(T.a,{id:"pageShareMenu.copyPageLinkButton.label",defaultMessage:"Copy page link"}))})}renderRestrictedPermissionBanner(){const{device:e}=this.environment,{store:t}=this.props,n=p.c(t,1),a=ye.Fb([ye.l,ye.b([ye.Ab,ye.Eb(ye.l)])])({environment:this.environment,blocks:[t]});if(n&&n.canRead())return o.a.createElement("div",null,o.a.createElement("div",{style:Ce({},this.getPermissionItemWrapStyle(),{},this.getMenuItemStyle(),{backgroundColor:e.isMobile?this.theme.darkBannerBackground:this.theme.sidebarSecondaryBackground,flexDirection:e.isMobile?"column":"row",alignItems:e.isMobile?"flex-start":"center",paddingTop:e.isMobile?14:10})},o.a.createElement("div",{style:{display:"flex",alignItems:"flex-start",marginRight:e.isMobile?void 0:6}},d.a.eyeHide({width:e.isMobile?20:16,marginTop:e.isMobile?3:2,marginRight:e.isMobile?10:8,marginLeft:e.isMobile?2:0,fill:this.theme.regularIconColor}),o.a.createElement(P.a,{isMultiline:!0,isMobile:e.isMobile,isSmall:!0,style:{color:this.theme.regularTextColor}},o.a.createElement(T.a,{id:"pageShareMenu.restrictedAccessBanner.label",defaultMessage:"Access restricted. May not be shared with everyone from {linkBoxWithPageTitle}.",description:"This text tells the user that this permission setting for the page is NOT inherited from the parent page.",values:{linkBoxWithPageTitle:o.a.createElement(y.a,{style:{color:this.theme.mediumTextColor},underline:!0,inline:!0,href:Object(h.a)({store:n,fullyQualified:!1})},o.a.createElement(v.a,{shouldWrap:!0,maxLength:30,store:n,style:{display:"inline"}}))}}))),a&&o.a.createElement(x.a,{isSmall:!e.isMobile||void 0,style:{fontSize:e.isMobile?14:12,marginTop:e.isMobile?2:void 0,marginLeft:e.isMobile?24:void 0,fontWeight:e.isMobile?G.a.fontWeight.medium:void 0},onClick:()=>{const e=t.getPermissionItems(),n=p.f(t),a=n?Object(ae.c)(p.h(n)):[],r=Object(ae.g)(e,a);this.stores.restrictConfirmationModalStore.setState({open:!0,onClose:this.handleCloseRestrictConfirmationModal,type:"restore",permissionChanges:r,onAccept:()=>{t.getPermissionsStore().canAdmin()?q.d(this.environment,async e=>{await u.d({environment:this.environment,store:t,transaction:e})}):u.a({environment:this.environment,store:t})}})}},o.a.createElement(T.a,{id:"pageShareMenu.restrictedAccessBanner.restore",defaultMessage:"Restore",description:"Action for when user wants to remove restricted access to a page."}))),e.isMobile?o.a.createElement(Se.a,{size:1,style:{opacity:"75%"}}):void 0)}renderPublicPermissionItem(e){const{store:t}=this.props,n=m.a.createChildStore(t,{table:F.a,id:e.blockId}),a=n.id!==t.id;return o.a.createElement("div",{style:this.getPermissionItemWrapStyle(),className:te.f},o.a.createElement(W,{format:W.Format.Web,currentBlockStore:t,store:n,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:d.a.globe({width:26,height:26,fill:this.theme.lightIconColor}),title:o.a.createElement(T.a,{defaultMessage:"Share to web",id:"blockPermissionsSettings.permissionItem.linkSharing"}),subtitle:l.c(e.permissionItem.role)?o.a.createElement(T.a,{defaultMessage:"Anyone with the link can edit and comment",id:"blockPermissionsSettings.publicPermission.canEdit"}):l.b(e.permissionItem.role)?o.a.createElement(T.a,{defaultMessage:"Anyone with the link can comment",id:"blockPermissionsSettings.publicPermission.canComment"}):l.d(e.permissionItem.role)?o.a.createElement(T.a,{defaultMessage:"Anyone with the link can view",id:"blockPermissionsSettings.publicPermission.canRead"}):o.a.createElement(T.a,{defaultMessage:"Publish and share link with anyone",id:"blockPermissionsSettings.publicPermission.none"}),tooltip:a?this.renderInheritedPermissionTooltip(n):this.renderPublicPermissionTooltip(),isSubscribed:this.isSubscribed(),isInherited:a,upgradeButtonName:"public_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,switcherRole:"reader",onChange:async t=>{await this.handlePermissionItemChange({isInherited:a,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))}renderSpacePermissionItem(e){const{store:t}=this.props,n=m.a.createChildStore(t,{table:F.a,id:e.blockId}),a=p.i(t)||X.a.state.currentSpaceStore;if(!a||!a.getValue())return;const r=Object(pe.getSpacePermissionItems)(a).filter(e=>l.c(l.f(e))),i=n.id!==t.id;return o.a.createElement("div",{style:{width:"100%"},className:te.g},o.a.createElement(W,{format:W.Format.Workspace,currentBlockStore:t,store:n,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:this.renderSpaceIcon(),title:o.a.createElement(T.a,{defaultMessage:"Everyone at {workspaceName}",id:"blockPermissionsSettings.permissionItem.workspaceAccessNew",values:{workspaceName:Object(pe.getSpaceName)(this.environment,a)}}),tooltip:i?this.renderInheritedPermissionTooltip(n):this.renderSpacePermissionTooltip(),subtitle:o.a.createElement(T.a,{defaultMessage:"{numberOfWorkspaceMembers, plural, one {{numberOfWorkspaceMembers} workspace member} other {{numberOfWorkspaceMembers} workspace members}}",id:"blockPermissionsSettings.spacePermission.none",values:{numberOfWorkspaceMembers:r.length}}),isSubscribed:this.isSubscribed(),isInherited:i,upgradeButtonName:"space_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:i,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))}renderInheritedPermissionTooltip(e){const t=e.getIcon();return o.a.createElement("div",{style:{whiteSpace:"normal",width:180}},o.a.createElement(T.a,{defaultMessage:"This access is based on {inlineIconAndName}. Changing this access will restrict permissions of this page.",id:"blockPermissionsSettings.restrictedPermissions.tooltip",values:{inlineIconAndName:o.a.createElement("span",{style:{whiteSpace:"nowrap",fontWeight:G.a.fontWeight.bold}},t&&o.a.createElement(H.a,{disabled:!0,icon:t,isEmptyPage:!1,size:12,style:{marginRight:4,display:"inline-block"}}),o.a.createElement(v.a,{store:e,style:{display:"inline"}}))}}))}renderSpaceIcon(){const{currentSpaceStore:e}=X.a.state;return e?o.a.createElement(H.a,{disabled:!0,title:Object(pe.getSpaceName)(this.environment,e),icon:Object(pe.getSpaceIcon)(this.environment,e),isEmptyPage:!1,size:W.iconSize}):d.a.team()}renderGroupPermissions(e){const{currentSpaceStore:t}=X.a.state,{spacePermissionGroups:n,mostPermissiveGroupPermissions:a}=e;return a.map(e=>{const a=e.permissionItem.group_id,r=n.find(e=>e.id===a);if(r&&t)return this.renderGroupPermissionItem(e,r,t.id)})}renderGroupPermissionItem(e,t,n){const{store:a,intl:r}=this.props,i=m.a.createChildStore(a,{table:F.a,id:e.blockId}),s=t.user_ids||[],l=Object(K.a)({intl:r,group:t}),c=i.id!==a.id,d=o.a.createElement(H.a,{disabled:!0,title:l,icon:t.icon?{table:"space",id:n,icon:t.icon}:void 0,isEmptyPage:!1,size:W.iconSize});return o.a.createElement("div",{key:t.id,style:{fontWeight:400},className:te.e},o.a.createElement(W,{format:W.Format.Workspace,currentBlockStore:a,store:i,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:d,title:l,tooltip:c?this.renderInheritedPermissionTooltip(i):this.renderGroupPermissionTooltip(t),subtitle:o.a.createElement(T.a,{defaultMessage:"{numberOfGroupMembers, plural, one {{numberOfGroupMembers} group member} other {{numberOfGroupMembers} group members}}",id:"blockPermissionsSettings.groupPermission.none",values:{numberOfGroupMembers:s.length}}),isSubscribed:this.isSubscribed(),isInherited:c,upgradeButtonName:"group_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:c,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))}renderAddGuests(){const{device:e}=this.environment,{WindowSizeStore:t}=this.environment;return o.a.createElement(O.a,{mobileFeedback:e.isMobile,disabled:!0},o.a.createElement("div",{style:Ce({},this.getMenuItemStyle(),{paddingTop:e.isMobile?12:10,paddingBottom:e.isMobile?12:10,paddingLeft:t.getSafePaddingLeftCSS(14),paddingRight:t.getSafePaddingRightCSS(14)})},o.a.createElement("div",{style:{width:"100%"}},this.renderInviteButton())))}getPermissionItemWrapStyle(){return{boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor),width:"100%"}}getMenuItemStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",minHeight:52,paddingTop:10,paddingBottom:10,paddingLeft:e.getSafePaddingLeftCSS(16),paddingRight:e.getSafePaddingRightCSS(12)}}isSubscribed(){const{data:e}=J.a.state;return Boolean(e&&B.D(e))}canEdit(){return l.a(this.props.store.getRole()||"editor")}getPageLinkInfoTooltip(){const e=Object(ne.b)(this.props.store).map(e=>{let{permissionItem:t}=e;return t}),t=e.find(e=>"public_permission"===e.type),n=e.find(e=>"space_permission"===e.type),a=e.filter(e=>"user_permission"===e.type);return t?o.a.createElement("div",null,o.a.createElement(T.a,{defaultMessage:"This page has public link access, so anyone{br}with the link will be able to view the page.",id:"blockPermissionsSettings.publicLinkInfo.tooltip",values:{br:o.a.createElement("br",null)}})):n?o.a.createElement("div",null,o.a.createElement(T.a,{defaultMessage:"This page has workspace access, so anyone{br}in the workspace will be able to view the link.",id:"blockPermissionsSettings.workspacePermissions.tooltip",values:{br:o.a.createElement("br",null)}})):a.length>1?o.a.createElement("div",null,o.a.createElement(T.a,{defaultMessage:"Only you and other invited members{br}and guests will be able to view the link.",id:"blockPermissionsSettings.userPermissions.tooltip",values:{br:o.a.createElement("br",null)}})):o.a.createElement("div",null,o.a.createElement(T.a,{defaultMessage:"Only you can access this page,{br}so the link will only work for you.",id:"blockPermissionsSettings.privatePermissions.tooltip",values:{br:o.a.createElement("br",null)}}))}}t.default=Object(T.g)(we)},1115:function(e,t,n){"use strict";n.r(t);n(15),n(11);var a=n(0),r=n.n(a),i=n(3),s=n(743),o=n(764),l=n(1),c=n(8),d=n(23),u=n(40),p=n(745),m=n(300),h=n(721),g=n(89),b=n(19),f=n(32);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class E extends i.a{renderComponent(){return r.a.createElement(r.a.Fragment,null,c.a.notionLogoStroked({width:34,height:34,marginBottom:18}),r.a.createElement("div",{style:S({},this.getPrimaryTextStyle(),{marginBottom:6})},this.getPlanTitle()),r.a.createElement("div",{style:this.getSecondaryTextStyle()},this.getOneLiner()),this.renderPriceAndTerms(),this.renderBlockLimit(),this.renderPlanFeatures(),this.renderLearnMore())}renderBlockLimit(){const{planInfo:e}=this.props;if("team_free"===e.subscriptionTier)return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{fontWeight:d.a.fontWeight.semibold,fontSize:24}},r.a.createElement(l.a,{id:"spaceSubscriptionUpgradePlanFeatures.blockLimit.title",defaultMessage:"Free"})),r.a.createElement("div",{style:this.getSecondaryTextStyle()},r.a.createElement(l.a,{id:"spaceSubscriptionUpgradePlanFeatures.blockLimit.description",defaultMessage:"For the first 1,000 blocks"}),r.a.createElement(u.a,{renderTooltip:()=>r.a.createElement(l.a,{id:"spaceSubscriptionUpgradePlanFeatures.blockLimit.tooltip",defaultMessage:"Blocks are pieces of content you add to a page, like a paragraph or to-do item.{br}Some features on the Team Plan are not available on the Team Trial.",values:{br:r.a.createElement("br",null)}}),placement:u.a.Placement.Top,render:e=>r.a.createElement("span",Object.assign({},e),c.a.help({marginLeft:6,width:14,fill:b.f.mediumIconColor,verticalAlign:"middle",display:"inline-block"}))})))}renderPriceAndTerms(){const{planInfo:e,intl:t}=this.props;if("team_free"!==e.subscriptionTier)return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:this.getPrimaryTextStyle()},r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.price",defaultMessage:"{price}",description:"Price is already formatted, e.g. $10",values:{price:Object(g.j)({subscriptionTier:e.subscriptionTier,billingInterval:e.billingInterval,intl:t})}})),r.a.createElement("div",{style:this.getSecondaryTextStyle()},this.getFormattedTerm()))}getFormattedTerm(){const{planInfo:e,intl:t}=this.props,n=Object(h.d)(f.a,t),a={personal:n.terms.pro,team:n.terms.team,enterprise:n.terms.enterprise}[e.subscriptionTier];return{per_month:r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.perMonthPricing.label",defaultMessage:"per month",description:"Appears after the price per month for a given plan, e.g. $10 per month"}),per_member_per_month:r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.perUserPerMonthPricing.label",defaultMessage:"per member, per month",description:"Appears after the price per member, per month for a given plan, e.g. $10 per member, per month"})}[a]}renderPlanFeatures(){var e=this;const{planInfo:t}=this.props;return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{delayThreshold:0,placement:u.a.Placement.Left,renderTooltip:()=>this.renderPreviousPlanTierFeatures(),render:t=>r.a.createElement("span",Object.assign({},t,{style:{cursor:"help",fontSize:14}}),r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.features",defaultMessage:"<span>Everything in {planName},</span> plus:",description:"Shown when comparing plan tier features in upgrade modal; 'planName' will be Personal, Team Trial, or Team",values:{span:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return r.a.createElement("span",{style:{paddingBottom:1,borderBottom:"1px dotted ".concat(e.theme.lightTextColor)}},n)},planName:this.getPreviousPlanName()}}))}),this.getFeaturesByPlanKey(t.subscriptionTier).map((e,n)=>r.a.createElement("div",{key:"".concat(t.subscriptionTier,"-feature-").concat(n),style:{display:"flex",alignItems:"center",padding:"4px 0px",fontSize:14}},c.a.thinCheck({width:14,height:14,marginRight:5,color:this.theme.lightTextColor}),e.label,e.isComingSoon&&r.a.createElement("div",{style:{background:this.theme.buttonHoveredBackground,fontSize:10,fontWeight:500,letterSpacing:"0.015em",color:this.theme.mediumTextColor,display:"inline",textTransform:"uppercase",padding:"2px 4px",marginLeft:6,borderRadius:3,whiteSpace:"nowrap"}},h.b))))}renderPreviousPlanTierFeatures(){const e=this.getTierBelowKey();return this.getFeaturesByPlanKey(e).map((t,n)=>r.a.createElement("div",{key:"".concat(e,"-feature-").concat(n),style:{display:"flex",alignItems:"center",padding:"4px 0px",fontSize:14}},c.a.thinCheck({width:14,height:14,marginRight:5,color:this.theme.regularInvertedTextColor}),t.label))}renderLearnMore(){return r.a.createElement("div",{style:{fontWeight:d.a.fontWeight.regular,fontSize:14,marginBottom:16,color:this.theme.mediumTextColor,textDecoration:"underline",marginTop:8,cursor:"pointer"},onClick:()=>{p.a.reset(),o.a.reset(),m.a.setState({open:!0,currentTab:"plans"})}},r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.learnMore",defaultMessage:"Learn more"}))}getPlanTitle(){const{planInfo:e}=this.props;return{personal:r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.title.personal",defaultMessage:"Upgrade to Personal Pro"}),team:r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.title.team",defaultMessage:"Upgrade to Team"}),enterprise:r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.title.enterprise",defaultMessage:"Upgrade to Enterprise"}),team_free:r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.title.teamFree",defaultMessage:"Upgrade to Team Trial"})}[e.subscriptionTier]}getOneLiner(){const{planInfo:e}=this.props;switch(e.subscriptionTier){case"personal":return r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.oneLiner.personal",defaultMessage:"For power users who want to do even more."});case"team":case"team_free":return r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.oneLiner.team",defaultMessage:"For teams to write, plan, and work together in one spot."});case"enterprise":return r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.oneLiner.enterprise",defaultMessage:"Controls and support to run your company."})}}getPreviousPlanName(){return{personal:r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.planName.personal",defaultMessage:"Pro"}),personal_free:r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.planName.free",defaultMessage:"Personal"}),team_free:r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.planName.teamTrial",defaultMessage:"Team Trial"}),team:r.a.createElement(l.a,{id:"subscriptionUpgradeDetails.planName.team",defaultMessage:"Team"})}[this.getTierBelowKey()]}getTierBelowKey(){const{planInfo:e}=this.props;return{personal:"personal_free",team:"team_free",team_free:"personal",enterprise:"team"}[e.subscriptionTier]}getFeaturesByPlanKey(e){return{personal_free:[h.a.unlimitedBlocks,h.a.shareWithLimitedGuests,h.a.syncAcrossDevices],personal:[h.a.unlimitedFileUploads,h.a.unlimitedGuests,h.a.versionHistory,h.a.contentApi],team_free:[h.a.unlimitedTeamMembers,h.a.collaborativeWorkspace,h.a.adminTools],team:[h.a.unlimitedBlocks,h.a.unlimitedFileUploads,h.a.versionHistory,h.a.advancedPermissions],enterprise:[h.a.sso,h.a.scimApi,h.a.advancedSecurity,h.a.dedicatedManager,h.a.customContract]}[e]}getPrimaryTextStyle(){return{fontWeight:d.a.fontWeight.bold,fontSize:22,lineHeight:1.1,marginBottom:2}}getSecondaryTextStyle(){return{fontWeight:d.a.fontWeight.regular,fontSize:14,lineHeight:1.4,marginBottom:22,color:this.theme.mediumTextColor}}}var M=Object(l.g)(E),C=n(285),O=n(299),w=n(84),k=n(17);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class I extends i.a{constructor(){super(...arguments),this.storeTypes={},this.renderModal=()=>r.a.createElement("div",{style:this.getModalStyle()},r.a.createElement(M,{planInfo:{subscriptionTier:"team_free"}}),r.a.createElement("div",{style:this.getButtonContainerStyle()},r.a.createElement(O.a,{isLarge:!0,style:{marginLeft:"auto",marginRight:12},onClick:this.handleModalClose},r.a.createElement(l.a,{id:"spacePermissionSettingsTrialModal.cancel.label",defaultMessage:"Cancel"})),r.a.createElement(C.a,{onClick:this.handleTrialAccept,isLarge:!0},r.a.createElement(l.a,{id:"spacePermissionSettingsTrialModal.tryItFree.label",defaultMessage:"Try it free"})))),this.handleTrialAccept=async()=>{const{currentSpaceStore:e}=k.a.state;e&&(await w.a({environment:this.environment,spaceStore:e,planType:"team"}),this.handleModalClose())},this.handleModalClose=()=>{o.a.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){T(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o.a.state,{open:!1}))}}renderComponent(){return r.a.createElement(s.a,{open:o.a.state.open,render:this.renderModal,onDismiss:this.handleModalClose})}getButtonContainerStyle(){return{display:"flex",marginTop:40}}getModalStyle(){return{background:this.theme.popoverBackground,borderRadius:3,width:349,padding:24}}}t.default=I},1116:function(e,t,n){"use strict";n.r(t);n(15),n(11);var a=n(0),r=n.n(a),i=n(3),s=n(725),o=n(1),l=n(1461),c=n(81),d=n(299),u=n(23),p=n(819),m=n(682),h=n(39),g=n(83),b=n(479),f=n(55),y=n(22),S=n(24),v=n(758),E=n(8),M=n(54);const C=Object(o.f)({phishing_or_spam:{id:"reportPage.reportReasons.phishing_or_spam",defaultMessage:"Phishing or spam"},inappropriate_content:{id:"reportPage.reportReasons.inappropriate_content",defaultMessage:"Inappropriate content"}});var O=n(6),w=n(19),k=n(1150),P=n(133),T=n(153),I=n(154),j=n(220);function D(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const F=Object(o.f)({additionalInformationPlaceholder:{id:"reportPage.additionalInformation.placeholder",defaultMessage:"Add additional information (optional)"}});class R extends i.a{constructor(e){super(e),this.handleCancel=()=>{Object(p.a)()},this.renderContent=()=>{const{device:e}=this.environment;if(!c.a.state.online)return this.renderOffline();const t=s.a.state;return t.open?e.isMobile?this.renderMobileModal(t):this.renderDesktopModal(t):void 0},this.onSubmit=async()=>{const e=this.environment,t=s.a.getState();if(!t.open)return;const{additionalInformation:n,reason:a}=t,i=Object(g.c)();if(!a||!i)return void M.e(r.a.createElement(o.a,{defaultMessage:"Something went wrong.",id:"reportPageModal.somethingWentWrong.label"}));const l=await(c=Object(b.a)(),Object(h.Qb)(e,{reason:a,pageId:i,intercomVisitorId:c,additionalInformation:n}));var c;"failed"===l.type?M.d(l):(s.a.setState({open:!1}),M.f({message:r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},E.a.thanksShield({width:40}),r.a.createElement("div",{style:{paddingTop:12,paddingBottom:8,fontSize:"large",textAlign:"center"}},r.a.createElement(o.a,{id:"reportPageModal.thanksForReporting",defaultMessage:"Thanks for reporting this page, our team will take a look."}))))}))},this.modalTitleStyle={fontSize:16,marginBottom:12,fontWeight:u.a.fontWeight.medium}}renderComponent(){return r.a.createElement(l.a,{onDismiss:this.handleCancel,render:this.renderContent,requireOnline:!0,modalStore:s.a})}renderOptionButtons(e){const{reason:t}=e;return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{key:"phishing_or_spam",title:r.a.createElement(o.a,{id:"reportPageModal.reportReasons.phishing_or_spam",defaultMessage:"Phishing or spam"}),isSelected:"phishing_or_spam"===t,onClick:()=>s.a.setState(B({},e,{reason:"phishing_or_spam"}))}),r.a.createElement(m.a,{key:"inappropriate_content",title:O.a.formatMessage(C.inappropriate_content),isSelected:"inappropriate_content"===t,onClick:()=>s.a.setState(B({},e,{reason:"inappropriate_content"}))}))}renderMobileModal(e){if(!e.open)return;const{reason:t}=e,n={menuType:y.a.Modal,title:r.a.createElement(o.a,{id:"reportPageModal.mobile.title",defaultMessage:"Report page"}),right:r.a.createElement(o.a,{id:"reportPageModal.closeButton.label",defaultMessage:"Close"}),onClickRight:this.handleCancel};return r.a.createElement(y.b,Object.assign({},n),r.a.createElement(f.a,{key:"main list",type:f.a.Type.Vertical,initialFocus:void 0,sections:[{key:"help",render:e=>{let{children:t}=e,n=D(e,["children"]);return r.a.createElement(S.a,Object.assign({},n),t)},items:[{key:"help",render:()=>r.a.createElement(I.a,{title:r.a.createElement(k.a,{title:r.a.createElement(o.a,{id:"reportPage.helpButton.caption",defaultMessage:"Notion's content policy"}),href:Object(P.a)("contentPolicy"),analyticsFrom:"report_page"}),right:r.a.createElement(r.a.Fragment,null),onClick:()=>{}}),action:()=>{}}]},{key:"reportOptions",render:e=>{let{children:t}=e,n=D(e,["children"]);return r.a.createElement(S.a,Object.assign({},n),t)},items:[{key:"options",render:()=>this.renderOptionButtons(e),action:()=>{}},{key:"additionalInfo",render:()=>t&&r.a.createElement(T.b,{textarea:!0,style:this.getTextAreaStyle(),focus:!1,value:e.additionalInformation,placeholder:O.a.formatMessage(F.additionalInformationPlaceholder),onChange:t=>{s.a.setState(B({},e,{additionalInformation:t.target.value}))}}),action:()=>{}}]},{key:"actions",render:e=>{let{children:t}=e,n=D(e,["children"]);return r.a.createElement(S.a,Object.assign({isSubmitButton:!0},n),t)},items:[{key:"submit",render:e=>{const{onClick:t}=e,n=D(e,["onClick"]);return r.a.createElement(v.a,Object.assign({},n,{disabled:!this.canSubmit(),title:r.a.createElement("div",{style:{color:w.f.red}},r.a.createElement(o.a,{id:"reportPageModal.reportButton.label",defaultMessage:"Report"})),onClick:t||this.onSubmit}))},action:this.onSubmit}]}]}))}canSubmit(){const{state:e}=s.a;if(e.open){const{reason:t}=e;return void 0!==t}return!1}renderDesktopModal(e){if(!e.open)return;const{reason:t}=e;return r.a.createElement(j.a,{capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1,render:()=>r.a.createElement("div",{style:this.getModalWrapStyle()},r.a.createElement("div",{style:this.modalTitleStyle},r.a.createElement(o.a,{id:"reportPageModal.title",defaultMessage:"Why are you reporting this page?"})),r.a.createElement("div",{style:{paddingBottom:12}},r.a.createElement(k.a,{title:r.a.createElement(o.a,{id:"reportPage.helpButton.caption",defaultMessage:"Notion's content policy"}),href:Object(P.a)("contentPolicy"),analyticsFrom:"report_page"})),r.a.createElement("div",null,this.renderOptionButtons(e)),t&&r.a.createElement(T.b,{textarea:!0,style:this.getTextAreaStyle(),focus:Boolean(e.reason),value:e.additionalInformation,placeholder:O.a.formatMessage(F.additionalInformationPlaceholder),onChange:t=>{s.a.setState(B({},e,{additionalInformation:t.target.value}))}}),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:18}},r.a.createElement(d.a,{isLarge:!0,onClick:this.handleCancel,style:{marginRight:12}},r.a.createElement(o.a,{id:"reportPageModal.cancelButton.label",defaultMessage:"Cancel"})),r.a.createElement(d.a,{isRed:!0,isLarge:!0,onClick:this.onSubmit,disabled:!this.canSubmit(),disabledFeedback:!0},r.a.createElement(o.a,{id:"reportPageModal.reportButton.label",defaultMessage:"Report"}))))})}renderOffline(){return r.a.createElement("div",{style:this.getOfflineStyle()},r.a.createElement(o.a,{defaultMessage:"Please go online to make a report.",id:"reportPageModal.offlineMessage.description"}))}getModalWrapStyle(){return{width:360,padding:24,fontSize:14}}getOfflineStyle(){return B({},this.getModalWrapStyle(),{color:this.theme.mediumTextColor})}getTextAreaStyle(){const{device:e}=this.environment;return{width:"100%",background:this.theme.popoverBackground,display:"block",padding:e.isMobile?16:"10px 12px",height:e.isMobile?150:130,marginTop:17,marginBottom:17,fontSize:e.isMobile?16:14}}}t.default=R},1246:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));n(2);function a(e){return e.country&&!r(e.country)?"skip":e.line1&&e.zipCode||e.line1&&e.city&&e.state||e.zipCode?"should_resolve":"insuffcient_data"}function r(e){return["US","CA"].includes(e)}},1247:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return c}));n(15),n(11);var a=n(167),r=n(16);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const l=20;var c;!function(e){e.Default="Default",e.Results="Results"}(c||(c={}));class d extends r.a{constructor(){super(...arguments),this.resetQuery=e=>{let{resetFilters:t}=e;this.setState(s({},this.state,{mode:c.Default,query:s({},this.state.query,{text:""},t&&{filters:Object(a.f)()}),limit:l,allResultsLoaded:!1}))},this.updateFilters=e=>{const t=this.state.query.filters,n=Object(a.g)(t,e);this.state.mode,c.Default,this.setState(s({},this.state,{query:s({},this.state.query,{filters:n})}))}}getInitialState(){return{mode:c.Default,isSidebarOpen:!1,query:{text:"",filters:Object(a.f)(),sort:a.e.Relevance},limit:l,allResultsLoaded:!1}}isSidebarOpen(){if(this.state.isSidebarOpen){const{state:e}=this;return!0}return!1}}d.Mode=c,t.c=d},1279:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return d}));n(15),n(11);var a=n(0),r=n.n(a),i=n(690);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){return{backgroundColor:e.groupedFormBackground,borderWidth:1,borderStyle:"solid",borderColor:e.groupedFormBorder,borderRadius:3,borderBottomWidth:0}}function d(e){const t=Object(i.a)(t=>({group:o({display:"flex",borderBottomColor:t.groupedFormBorder,borderBottomWidth:1,borderBottomStyle:"solid",alignItems:"center",flex:1},e.style)}),[e.style]);return r.a.createElement("div",{style:t.group},e.children)}},1352:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return l}));n(15),n(11);var a=n(75),r=n(1443);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const o=function(e){const t=a.c();return r.a.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{open:!0,onComplete:t.resolve,inputValue:""})),t.promise},l=function(e){const t=r.a.state;t.open&&(t.onComplete(e.didConfirm),r.a.reset())}},1354:function(e,t,n){"use strict";var a=n(0),r=n.n(a),i=n(3),s=n(1140),o=n(86),l=n(1);class c extends i.a{renderComponent(){return r.a.createElement(s.a,null,r.a.createElement(o.a,{isSmall:!0,style:{textAlign:"center"}},r.a.createElement(l.a,{id:"spaceSubscriptionPlans.offlineMessage",defaultMessage:"Please go online to manage your plan."})))}}t.a=c},1355:function(e,t,n){"use strict";n.d(t,"a",(function(){return C}));n(15),n(11);var a=n(0),r=n.n(a),i=n(690),s=n(1),o=n(486),l=n(153),c=n(22),d=n(55),u=n(24),p=n(271),m=n(692),h=n(29),g=n(39),b=n(53),f=n(45),y=n(1246),S=n(745),v=n(1279);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e){const t=Object(i.a)(e=>({container:Object(v.b)(e),cityZipRow:{display:"flex"},verticalDivider:{display:"flex",borderLeft:"1px solid",borderLeftColor:e.groupedFormBorder},zipRow:{display:"flex",flex:2},stateRow:{display:"flex",flex:3}}),[]),n=Object(s.h)(),[o,l]=Object(a.useState)(void 0);return r.a.createElement("div",null,r.a.createElement("div",{style:t.container},r.a.createElement(w,{placeholder:n.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.fullName",defaultMessage:"Full name"}),address:e.address,updateAddressField:e.updateAddressField,addressKey:"name"}),e.shouldShowBusinessName&&r.a.createElement(w,{placeholder:n.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.businessName",defaultMessage:"Business name (optional)"}),address:e.address,updateAddressField:e.updateAddressField,addressKey:"businessName"}),r.a.createElement(O,{updateAddressField:e.updateAddressField,address:e.address,setCountry:l}),o&&Object(y.b)(o.countryCode)&&r.a.createElement(r.a.Fragment,null,r.a.createElement(w,{placeholder:n.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.address",defaultMessage:"Address"}),address:e.address,addressKey:"addressLine1",updateAddressField:e.updateAddressField}),r.a.createElement(w,{placeholder:n.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.city",defaultMessage:"City"}),addressKey:"city",address:e.address,updateAddressField:e.updateAddressField}),r.a.createElement("div",{style:t.cityZipRow},r.a.createElement("div",{style:t.zipRow},r.a.createElement(w,{placeholder:n.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.zipCode",defaultMessage:"Zip code"}),address:e.address,addressKey:"zipCode",updateAddressField:e.updateAddressField})),r.a.createElement("div",{style:t.verticalDivider}),r.a.createElement("div",{style:t.stateRow},r.a.createElement(w,{placeholder:n.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.state",defaultMessage:"State / Province"}),address:e.address,addressKey:"state",updateAddressField:e.updateAddressField}))))))}function O(e){const t=Object(o.b)(),[n,y]=Object(a.useState)(!1),C=Object(s.h)(),O=Object(i.a)(()=>({input:{background:"none",boxShadow:"none",padding:8}}),[]),[w,k]=r.a.useState(""),[P]=Object(m.a)(async()=>{const e=await g.E(t,{});return"success"===e.type?e.data.countries:"failed"===e.type?[]:void Object(h.e)(e)},[t]),T=P.value;if(!T)return null;const I=Object(p.b)(w,T,e=>e.name).map((t,n)=>({key:n,render:e=>r.a.createElement(b.a,Object.assign({},e,{title:t.name})),action:()=>{e.updateAddressField("country",t.countryCode),e.setCountry(t);const n=S.a.state;n.open&&S.a.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){M(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n,{vatApplicable:Boolean(t.vatApplicable)})),k(t.name),y(!1)}}));return r.a.createElement(v.a,null,r.a.createElement(f.c,{popupType:f.c.PopupType.Popup,alignmentToOrigin:f.c.Alignment.End,placementToOrigin:f.c.Placement.Right,originGap:0,open:n,origin:r.a.createElement(l.b,{value:w,placeholder:C.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.country",defaultMessage:"Country or region"}),style:O.input,onChange:e=>{k(e.target.value)},onFocus:()=>{y(!0)}}),onDismiss:()=>{y(!1),k("")},render:()=>r.a.createElement(c.b,{menuType:c.b.MenuType.Popup,width:"100%"},r.a.createElement(d.a,{type:d.a.Type.Vertical,initialFocus:w.length>0?0:void 0,sections:[{key:0,render:e=>r.a.createElement(u.a,Object.assign({},e,{title:r.a.createElement(s.a,{id:"spaceSubscriptionBillingInfoForm.countryDropdown.title",defaultMessage:"Select a country or region"})})),items:I}]}))}))}function w(e){const t=Object(i.a)(()=>({input:{background:"none",boxShadow:"none",padding:8}}),[]);return r.a.createElement(v.a,null,r.a.createElement(l.b,{value:e.address[e.addressKey],style:t.input,placeholder:e.placeholder,onChange:(n=e.updateAddressField,a=e.addressKey,e=>{n(a,e.target.value)})}));var n,a}},1356:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(39),r=n(1246);async function i(e,t){const n=Object(r.a)({line1:t.addressLine1,city:t.city,state:t.state,zipCode:t.zipCode,country:t.country});if("skip"===n)return{valid:!0};if("insuffcient_data"===n)return{valid:!1};const i=await Object(a.Rb)(e,{address:{line1:t.addressLine1,city:t.city,zip:t.zipCode,state:t.state,country:t.country}});return"failed"===i.type?{valid:!1}:i.data}},1357:function(e,t,n){"use strict";var a=n(82);t.a=new a.a},1358:function(e,t,n){"use strict";var a=n(82);t.a=new a.a},1359:function(e,t,n){"use strict";var a=n(82);t.a=new a.a},1437:function(e,t,n){"use strict";n(15),n(11);var a=n(0),r=n.n(a),i=n(3),s=n(1),o=n(153),l=n(6),c=n(299),d=n(413),u=n(183),p=n(39),m=n(16);class h extends m.a{getInitialState(){return{temporaryCouponCode:void 0,couponCodeInput:void 0,error:void 0}}}var g=h,b=n(588),f=n(86),y=n(19),S=n(29),v=n(14);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){C(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const O=Object(s.f)({couponCodePlaceholder:{id:"couponEntryInput.placeholder",defaultMessage:"Coupon code"},couponCodeNotFoundError:{id:"couponEntryInput.error.noPromo",defaultMessage:"Invalid coupon code"}});class w extends i.a{constructor(){super(...arguments),this.storeTypes={couponCode:g}}didMount(){const e=Object(d.a)(this.environment.currentUser.id);e&&this.stores.couponCode.setState(M({},this.stores.couponCode.state,{temporaryCouponCode:e}))}renderComponent(){return r.a.createElement("div",{style:this.getContainerStyle()},r.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},r.a.createElement(o.b,{textarea:!1,value:this.stores.couponCode.state.couponCodeInput,placeholder:l.a.formatMessage(O.couponCodePlaceholder),onSubmit:()=>this.checkCouponCode(),onChange:e=>{this.stores.couponCode.setState(M({},this.stores.couponCode.state,{couponCodeInput:e.target.value}))},style:{height:32,paddingLeft:10,marginRight:this.props.hideApply?0:10}}),r.a.createElement(u.a,{request:this.stores.couponCode.state.temporaryCouponCode||null,performRequest:async e=>{if(e)return this.applyCouponCode(e)},render:(e,t,n)=>{if(!this.props.hideApply)return r.a.createElement(c.a,{isLarge:!1,onClick:()=>this.checkCouponCode()},r.a.createElement(b.a,{loaded:n,spinnerSize:16,showSpinnerTimeout:500},r.a.createElement(s.a,{id:"couponEntryInput.button.apply",defaultMessage:"Apply"})))}})),this.stores.couponCode.state.error&&r.a.createElement(f.a,{isMultiline:!1,style:{paddingTop:8,color:y.f.red}},this.stores.couponCode.state.error))}checkCouponCode(){const e=this.stores.couponCode.state.couponCodeInput;e&&(this.stores.couponCode.setState(M({},this.stores.couponCode.state,{temporaryCouponCode:e})),this.stores.couponCode.setState(M({},this.stores.couponCode.state,{couponCodeInput:""})))}async applyCouponCode(e){const t=await p.T(this.environment,{code:e});if("success"===t.type){if(t.data.promo)return this.stores.couponCode.setState(M({},this.stores.couponCode.state,{error:void 0})),this.props.handlePromo(t.data.promo),v.ab(this.environment,{code:e,valid:!0,id:t.data.promo.id}),t.data.promo;this.stores.couponCode.setState(M({},this.stores.couponCode.state,{error:l.a.formatMessage(O.couponCodeNotFoundError)})),v.ab(this.environment,{code:e,valid:!1,id:void 0})}else if("failed"===t.type){const e=t.error.name;this.stores.couponCode.setState(M({},this.stores.couponCode.state,{error:e}))}else Object(S.e)(t)}getContainerStyle(){return M({display:"flex",flexDirection:"column"},this.props.style?this.props.style:void 0)}}t.a=w},1443:function(e,t,n){"use strict";var a=n(16);class r extends a.a{getInitialState(){return{open:!1}}}t.a=new r},1447:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var a=n(39),r=n(496),i=n(64),s=n(176),o=n(32),l=n(346),c=n(114),d=n(54),u=n(14),p=n(1357),m=n(490),h=n(1);const g=Object(h.f)({authenticatingWithEvernote:{id:"evernoteActions.authenticatingWithEvernote.loadingMessage",defaultMessage:"Authenticating with Evernote…"},titleMessage:{defaultMessage:"Evernote login",id:"evernoteActions.loginPopupModal.title"}});async function b(e){const{environment:t,requestStore:n}=e,h=Object(l.b)(t);let b=Object(s.d)(o.a.baseURL,{authType:h,userId:t.currentUser.id});b=h.redirectToAuth?b:await Object(l.c)(t,b);const f=await r.a(t,{width:580,height:700,url:b,titleMessage:g.titleMessage});if(!f)return;const y=i.d(f),S=y.query.oauth_token,v=y.query.oauth_verifier;if(!S||!v)return;c.b({message:g.authenticatingWithEvernote});const E=await a.g(t,{requestToken:S,verifier:v});if("failed"===E.type)return console.error(E.error),d.d(E),void c.a();u.o(t,{name:"evernote"}),await n.refresh(),p.a.setState({open:!0}),m.a.setState({open:!0}),c.a()}},1448:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var a=n(39),r=n(496),i=n(64),s=n(176),o=n(32),l=n(346),c=n(114),d=n(54),u=n(14),p=n(1358),m=n(490),h=n(1);const g=Object(h.f)({authenticatingWithAsana:{id:"asanaActions.authenticatingWithAsana.loadingMessage",defaultMessage:"Authenticating with Asana…"},titleMessage:{defaultMessage:"Asana login",id:"asanaActions.loginWithAsanaPopupModal.title"}});async function b(e){const{environment:t,requestStore:n}=e,h=Object(l.b)(t);let b=Object(s.c)(o.a.baseURL,{authType:h,userId:t.currentUser.id});b=h.redirectToAuth?b:await Object(l.c)(t,b);const f=await r.a(t,{width:580,height:800,url:b,titleMessage:g.titleMessage});if(!f)return;const y=i.d(f);if(!y.query.code||!y.query.state)return;c.b({message:g.authenticatingWithAsana});const S=await a.f(t,{code:y.query.code,encryptedState:y.query.state});"failed"===S.type?(console.error(S.error),d.d(S),c.a()):(u.o(t,{name:"asana"}),await n.refresh(),p.a.setState({open:!0}),m.a.setState({open:!0}),c.a())}},1449:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var a=n(39),r=n(496),i=n(64),s=n(176),o=n(32),l=n(346),c=n(114),d=n(54),u=n(14),p=n(1359),m=n(490),h=n(1);const g=Object(h.f)({authenticatingWithTrello:{id:"trelloActions.authenticatingWithTrello.loadingMessage",defaultMessage:"Authenticating with Trello…"},titleMessage:{defaultMessage:"Trello login",id:"trelloActions.loginPopupModal.title"}});async function b(e){const{environment:t,requestStore:n}=e,h=Object(l.b)(t);let b=Object(s.j)(o.a.baseURL,{authType:h,userId:t.currentUser.id});b=h.redirectToAuth?b:await Object(l.c)(t,b);const f=await r.a(t,{width:580,height:700,url:b,titleMessage:g.titleMessage});if(!f)return;const y=i.d(f),S=y.query.oauth_token,v=y.query.oauth_verifier;if(!S||!v)return;c.b({message:g.authenticatingWithTrello});const E=await a.j(t,{requestToken:S,verifier:v});"failed"===E.type?(console.error(E.error),d.d(E),c.a()):(u.o(t,{name:"trello"}),await n.refresh(),p.a.setState({open:!0}),m.a.setState({open:!0}),c.a())}},1459:function(e,t,n){"use strict";var a=n(504);t.a=new a.a},1461:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(0),r=n.n(a),i=n(3),s=n(45),o=n(743);class l extends i.a{renderComponent(){const{render:e}=this.props,{device:t}=this.environment,n=this.props.modalStore.state;return t.isMobile?r.a.createElement(s.c,{open:n.open,popupType:s.c.PopupType.SlideUp,origin:this.props.origin,onDismiss:this.props.onDismiss,render:e}):r.a.createElement(o.a,{open:n.open,preventHideChildrenWhileOpening:!0,render:e,onDismiss:this.props.onDismiss})}}},1463:function(e,t,n){"use strict";n(15),n(11);var a=n(0),r=n.n(a),i=n(3),s=n(743),o=n(45),l=n(1241);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class u extends i.a{renderComponent(){const{device:e}=this.environment;return e.isMobile?r.a.createElement(o.c,{popupType:e.isMobile?o.c.PopupType.SlideUp:o.c.PopupType.Popup,open:this.props.open,render:this.props.renderContent,onDismiss:this.props.onDismiss,origin:this.props.origin}):r.a.createElement(s.a,{open:this.props.open,preventHideChildrenWhileOpening:!0,style:{alignItems:"flex-start"},innerStyle:this.getModalStyle(),onDismiss:this.props.onDismiss,render:this.props.renderContent,origin:this.props.origin,disableAnimation:this.props.disableAnimation})}getTopbarHeight(){const{device:e}=this.environment;return e.isElectronMac?l.a.desktopMacHeight:l.a.defaultHeight}getModalStyle(){const{modalStyle:e}=this.props;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({top:2*this.getTopbarHeight(),borderRadius:3,overflow:"hidden",boxShadow:this.theme.largeBoxShadow,background:this.theme.contentBackground},e)}}t.a=u},1464:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(69),r=n(609),i=n(172);const s={getMonths:function(){for(var e=[],t=0;t<12;)e.push(Object(a.a)().month(t).format("MMMM")),t+=1;return e},formatDay:function(e){return Object(a.a)(e).format("ddd ll")},formatMonthTitle:function(e){const t=Object(r.a)(i.a).month;return Object(a.a)(e).format(t)},formatWeekdayShort:function(e){return a.a.weekdaysMin()[e]},formatWeekdayLong:function(e){return a.a.weekdays()[e]},getFirstDayOfWeek:function(){return a.a.localeData().firstDayOfWeek()}}}}]);