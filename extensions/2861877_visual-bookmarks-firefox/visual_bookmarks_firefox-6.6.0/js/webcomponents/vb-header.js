"use strict";(globalThis.webpackChunkvisual_bookmarks_dev=globalThis.webpackChunkvisual_bookmarks_dev||[]).push([[971],{146:(e,t,s)=>{s.r(t);s(164),s(194);var i=s(339),n=s(856),o=s(594),h=s(485);class a extends HTMLElement{initialFolderId=null;folderId=null;initialHash=window.location.hash;backNode=null;headerNode=null;formNode=null;inputNode=null;suggestNode=null;resetNode=null;selectNode=null;vbPopup=null;vbPopupBtn=null;vbPopupContent=null;vbPopupActive=!1;engineNodes=[];engineIndex=0;prevEngineIndex=0;inputValue="";suggestIndex=-1;suggestList=[];abortController=null;connectedCallback(){this.#e()}disconnectedCallback(){this.#t()}async#e(){this.insertAdjacentHTML("afterbegin",'<div class="header"> <div class="header__items header__items--search"> <div class="search-wrap"> <form method="get" action="" id="searchForm"> <input type="text" id="bookmarkSearch" class="form-control" placeholder="Search" spellcheck="false" data-locale-message="placeholder_input_search" autocomplete="off"> </form> <vb-popup class="header__engine"> <span class="header__engine-button" slot="button"></span> <div class="header__engine-content" slot="content"></div> </vb-popup> <div class="search-actions"> <button class="search-button search-reset-btn" id="searchReset" data-locale-message="clear_search.aria-label" aria-label="Clear search"> <svg class="search-icon" width="20" height="20"> <use xlink:href="/img/symbol.svg#close"/> </svg> </button> <button class="search-button" form="searchForm" id="searchSubmit" data-locale-message="search.aria-label" aria-label="Search"> <svg class="search-icon" width="20" height="20"> <use xlink:href="/img/symbol.svg#search"/> </svg> </button> </div> </div> </div> <div class="header__items header__items--select"> <vb-select-folders id="selectFolders"></vb-select-folders> </div> </div> '),this.initialFolderId=this.getAttribute("initial-folder-id"),this.folderId=this.getAttribute("folder-id"),this.headerNode=this.querySelector(".header"),this.formNode=this.querySelector("form"),this.inputNode=this.querySelector("input"),this.resetNode=this.querySelector("#searchReset"),this.buttonSubmitNode=this.querySelector("#searchSubmit"),this.selectNode=this.querySelector("vb-select-folders"),this.selectNode.setAttribute("folder-id",this.folderId),this.selectNode.folders=await(0,n.xh)(),this.vbPopup=this.querySelector("vb-popup"),this.vbPopup.setAttribute("label",browser.i18n.getMessage("toggle_search_popup")),this.vbPopupBtn=this.vbPopup.popupTriger,this.vbPopupSlotBtn=this.vbPopup.querySelector('[slot="button"]'),this.vbPopupContent=this.vbPopup.querySelector('[slot="content"]'),this.#s(),this.#i(),this.hashchange(),h.X.$.search_autofocus&&this.inputNode.focus()}get isBookmarksEngine(){return"bookmarks"===h.X.$.search_engine}set engine(e){this.engineNodes[this.prevEngineIndex].classList.remove("is-active");const t=o.uM.find(((t,s)=>t.value===e&&(this.engineIndex=s,!0)));this.engineNodes[this.engineIndex].classList.add("is-active"),this.vbPopupSlotBtn.innerHTML=`<svg width="16" height="16"><use xlink:href="/img/symbol.svg#${t.value}"/></svg>`;const s="bookmarks"===t.value?browser.i18n.getMessage("placeholder_input_search_bookmarks"):t.title;h.X.updateKey("search_engine",e).then((()=>{this.inputNode.placeholder=browser.i18n.getMessage("placeholder_input_search",[s]),this.inputNode.name=t.name??"bookmarks",this.formNode.action=t.url??"",this.buttonSubmitNode.hidden=this.isBookmarksEngine,this.isBookmarksEngine?(this.suggestNode?.remove(),this.suggestNode=null):(this.suggestNode=(0,i.xX)("div",{id:"suggest",class:"suggest",hidden:"hidden"}),this.formNode.append(this.suggestNode)),h.X.$.open_link_newtab&&(this.isBookmarksEngine?this.formNode.removeAttribute("target"):this.formNode.setAttribute("target","_blank")),this.inputNode.value.trim()&&this.dispatchEvent(new CustomEvent("vb:search",{detail:{search:this.isBookmarksEngine?this.inputNode.value:""},bubbles:!0,cancelable:!0}))}))}#s(){this.vbPopupContent.innerHTML=o.uM.map((e=>`<div class="header__engine-item${e.value===h.X.$.search_engine?" is-active":""}" data-engine="${e.value}">\n          ${e.title}\n        </div>`)).join(""),this.engineNodes=Array.from(this.vbPopupContent.children),this.engine=h.X.$.search_engine}#i(){this.handleInput=this.handleInput.bind(this),this.inputNode.addEventListener("input",this.handleInput),this.handleReset=this.handleReset.bind(this),this.resetNode.addEventListener("click",this.handleReset),this.handleSelectHash=this.handleSelectHash.bind(this),this.selectNode.addEventListener("vb:select:change",this.handleSelectHash),this.handleSubmit=this.handleSubmit.bind(this),this.formNode.addEventListener("submit",this.handleSubmit),this.handleClickEngine=this.handleClickEngine.bind(this),this.vbPopupContent.addEventListener("click",this.handleClickEngine),this.handleKeydownEngine=this.handleKeydownEngine.bind(this),this.vbPopup.addEventListener("keydown",this.handleKeydownEngine),this.handlePopupState=this.handlePopupState.bind(this),this.vbPopup.addEventListener("vb:popup:open",this.handlePopupState),this.vbPopup.addEventListener("vb:popup:close",this.handlePopupState),this.handleHash=this.hashchange.bind(this),document.addEventListener("changeFolder",this.handleHash),this.handleUpdateFolders=this.handleUpdateFolders.bind(this),document.addEventListener("updateFolderList",this.handleUpdateFolders),this.handleKeydown=this.handleKeydown.bind(this),this.inputNode.addEventListener("keydown",this.handleKeydown),this.handleClickSuggest=this.handleClickSuggest.bind(this),this.formNode.addEventListener("click",this.handleClickSuggest),this.handleDocumentKeydown=this.handleDocumentKeydown.bind(this),document.addEventListener("keydown",this.handleDocumentKeydown),this.handleDocClick=this.handleDocClick.bind(this),document.addEventListener("click",this.handleDocClick)}#t(){this.inputNode.removeEventListener("input",this.handleInput),this.resetNode.removeEventListener("click",this.handleReset),this.selectNode.removeEventListener("vb:select:change",this.handleSelectHash),this.formNode.removeEventListener("submit",this.handleSubmit),this.vbPopupContent.removeEventListener("click",this.handleClickEngine),this.vbPopup.removeEventListener("keydown",this.handleKeydownEngine),this.vbPopup.removeEventListener("vb:popup:open",this.handlePopupState),this.vbPopup.removeEventListener("vb:popup:close",this.handlePopupState),this.inputNode.removeEventListener("keydown",this.handleKeydown),this.formNode.removeEventListener("click",this.handleClickSuggest),document.removeEventListener("changeFolder",this.handleHash),document.removeEventListener("updateFolderList",this.handleUpdateFolders),document.removeEventListener("keydown",this.handleEscape),document.removeEventListener("click",this.handleDocClick)}async handleUpdateFolders(e){e.detail?.isFolder&&this.selectNode&&(this.selectNode.folders=await(0,n.xh)())}handlePopupState({type:e}){this.vbPopupActive="vb:popup:open"===e}hashchange(){const e=window.location.hash.slice(1);e&&e!==this.initialFolderId?this.backNode||(this.backNode=(0,i.xX)("button",{class:"back","aria-label":browser.i18n.getMessage("history_back")},{html:'<svg width="20" height="20"><use xlink:href="/img/symbol.svg#arrow_back"/></svg>'}),this.handleBack=this.handleBack.bind(this),this.headerNode.insertAdjacentElement("afterbegin",this.backNode),this.backNode.addEventListener("click",this.handleBack)):this.backNode&&(this.backNode.removeEventListener("click",this.handleBack),this.backNode.remove(),this.backNode=null),this.selectNode.setAttribute("folder-id",e||this.initialFolderId)}handleKeydownEngine(e){switch(e.code){case"ArrowUp":e.preventDefault(),this.prevEngineIndex=this.engineIndex,this.engineIndex=this.engineIndex-1,this.engineIndex<0&&(this.engineIndex=this.engineNodes.length-1),this.engine=o.uM[this.engineIndex].value;break;case"ArrowDown":e.preventDefault(),this.prevEngineIndex=this.engineIndex,this.engineIndex=(this.engineIndex+1)%this.engineNodes.length,this.engine=o.uM[this.engineIndex].value;break;case"Enter":case"Space":this.vbPopupActive&&this.inputNode.focus()}}handleSubmit(e){return!(this.isBookmarksEngine||!this.inputNode.value.trim())||(e.preventDefault(),void this.inputNode.focus())}handleClickEngine(e){const t=e.target.closest(".header__engine-item");t&&(this.prevEngineIndex=this.engineNodes.findIndex((e=>e.classList.contains("is-active"))),this.engine=t.dataset.engine,this.vbPopup.hide(),this.inputNode.focus())}handleSelectHash(e){window.location.hash=e.detail}handleBack(){this.initialHash===window.location.hash?window.location.hash=this.initialFolderId:window.history.back()}handleReset(){this.inputNode.value="",this.isBookmarksEngine?this.inputNode.dispatchEvent(new CustomEvent("vb:searchreset",{bubbles:!0,cancelable:!0})):this.closeSuggest(),this.resetNode.classList.remove("is-show"),this.inputNode.focus()}handleInput(e){const t=e.target.value;this.isBookmarksEngine?this.dispatchEvent(new CustomEvent("vb:search",{detail:{search:t},bubbles:!0,cancelable:!0})):(this.inputValue=e.target.value,this.suggestSearch(e.target.value.trim())),this.resetNode.classList.toggle("is-show",t.trim().length)}handleDocumentKeydown(e){"Escape"===e.code&&this.suggestList.length?this.closeSuggest():"Slash"===e.code&&"INPUT"!==document.activeElement?.tagName&&(e.preventDefault(),this.inputNode.focus())}handleDocClick(e){e.target.closest("#searchForm")||this.closeSuggest()}handleKeydown(e){if(!this.suggestList.length)return!0;switch(e.key){case"ArrowUp":case"ArrowDown":this.gotoSuggest(e);break;case"Enter":this.handleEnterSuggest(e)}}async suggestSearch(e){if(this.suggestIndex=-1,this.abortController&&this.abortController.abort(),e.length>0)try{this.suggestList=await this.suggestRequest(e)}catch(e){}else this.suggestList=[],this.suggestIndex=-1;this.suggestNode.innerHTML=this.suggestList.map(((e,t)=>`<div data-suggest="${t}">${e}</div>`)).join(""),this.suggestNode.hidden=!this.suggestList.length}suggestRequest(e){this.abortController=new AbortController;const t=this.abortController.signal;return fetch(`https://google.com/complete/search?output=toolbar&q=${e}`,{signal:t}).then((e=>{if(e.ok)return e.text();throw new Error(e.statusText)})).then((e=>{const t=(new DOMParser).parseFromString(e,"text/xml");return Array.from(t.querySelectorAll("[data]")).map((e=>e.getAttribute("data")))}))}gotoSuggest(e){e.preventDefault();const t=Array.from(this.suggestNode.querySelectorAll("[data-suggest]")),s=this.suggestIndex;this.suggestIndex="ArrowUp"===e.key?this.suggestIndex-1:this.suggestIndex+1,this.suggestIndex>this.suggestList.length-1?this.suggestIndex=-1:this.suggestIndex<-1&&(this.suggestIndex=this.suggestList.length-1),this.inputNode.value=this.suggestIndex<0?this.inputValue:this.suggestList[this.suggestIndex],t[s]?.classList.remove("is-active"),t[this.suggestIndex]?.classList.add("is-active")}handleEnterSuggest(e){this.suggestIndex>-1&&(e.preventDefault(),this.inputNode.value=this.suggestList[this.suggestIndex],this.inputNode.focus(),this.formNode.submit()),this.closeSuggest()}handleClickSuggest(e){const t=e.target.closest("[data-suggest]");if(!t)return!0;e.preventDefault();const s=parseInt(t.dataset.suggest);this.inputNode.value=this.suggestList[s],this.inputNode.focus(),this.formNode.submit(),this.closeSuggest()}closeSuggest(){this.suggestNode&&!this.suggestNode.hidden&&(this.suggestNode.hidden=!0,this.suggestList=[],this.suggestIndex=-1)}}window.customElements.define("vb-header",a)},194:(e,t,s)=>{var i=s(614),n=s(339);class o extends HTMLElement{popupTriger=null;popupContent=null;isActive=!1;isTransition=!1;connectedCallback(){this.#e(),this.#i()}disconnectedCallback(){this.#t()}static get observedAttributes(){return["label"]}get label(){return this.getAttribute("label")}attributeChangedCallback(e,t,s){"label"===e&&this.popupTriger?.setAttribute("aria-label",s)}#e(){this.classList.add("popup"),this.popupTriger=(0,n.xX)("button",{type:"button",class:"button","aria-label":this.label},{html:'<slot name="button"></slot>'}),this.popupContent=(0,n.xX)("div",{class:"content"},{html:'<slot name="content"></<slot>'}),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`<style>${i.Z}</style>`,this.shadowRoot.append(this.popupTriger),this.shadowRoot.append(this.popupContent)}#i(){this.handleToggle=this.toggle.bind(this),this.handleHideByDocument=this.handleHideByDocument.bind(this),this.closeByEsc=e=>{"Escape"===e.code&&this.isActive&&!this.isTransition&&this.hide()},this.handleFocusout=this.handleFocusout.bind(this),this.popupTriger.addEventListener("click",this.handleToggle),document.addEventListener("click",this.handleHideByDocument),document.addEventListener("keydown",this.closeByEsc),this.addEventListener("focusout",this.handleFocusout)}#t(){this.popupTriger.removeEventListener("click",this.handleToggle),document.removeEventListener("click",this.handleHideByDocument),document.removeEventListener("keydown",this.closeByEsc)}transitionEnd(e){const t=s=>{this.popupContent.removeEventListener(s.type,t),e()};this.popupContent.addEventListener("transitionend",t)}handleFocusout(e){e.relatedTarget&&!this.contains(e.relatedTarget)&&this.isActive&&this.hide()}handleHideByDocument(e){e.stopPropagation();const t=e.composedPath()[0];!this.isActive||this.contains(t)||event.composedPath().includes(this)||this.hide()}toggle(e){e.preventDefault(),!this.isActive&&this.popupTriger.focus(),this[this.isActive?"hide":"show"]()}show(){if(this.isActive||this.isTransition)return!1;this.popupContent.classList.remove("is-below","is-above"),this.popupContent.style.display="block";const{top:e,height:t}=this.popupTriger.getBoundingClientRect(),s=e+t+this.popupContent.offsetHeight>window.innerHeight?"is-below":"is-above";this.popupContent.classList.add(s),this.transitionEnd((()=>{this.isTransition=!1,this.isActive=!0,this.dispatchEvent(new CustomEvent("vb:popup:open",{bubbles:!0,cancelable:!0}))})),this.isTransition=!0,this.popupContent.classList.add("is-show")}hide(){if(!this.isActive||this.isTransition)return!1;this.transitionEnd((()=>{this.popupContent.style.display="none",this.isTransition=!1,this.isActive=!1,this.dispatchEvent(new CustomEvent("vb:popup:close",{bubbles:!0,cancelable:!0}))})),this.isTransition=!0,this.popupContent.classList.remove("is-show")}}window.customElements.define("vb-popup",o)},614:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(81),n=s.n(i),o=s(645),h=s.n(o)()(n());h.push([e.id,":host{position:relative;z-index:100;display:block}.button{display:inline-block;width:100%;height:100%;padding:0;border:0;border-radius:var(--vb-popup-btn-radius, var(--base-radius));background-color:transparent;outline:0;cursor:pointer;overflow:hidden}.button:focus-visible{outline:2px solid var(--color-primary);outline-offset:1px}.content{display:none;position:absolute;left:var(--vb-popup-left, 0);right:var(--vb-popup-right, auto);max-width:300px;opacity:0;color:var(--theme-text-color);background-color:var(--theme-background-2);border-radius:var(--vb-popup-radius, var(--base-radius));box-shadow:var(--vb-popup-shadow, none);transform:translateY(10px);visibility:hidden;transition-property:visibility,opacity,transform;transition-duration:.15s,.15s,.15s;transition-timing-function:ease-in-out}.content.is-below{bottom:var(--vb-popup-bottom, 100%)}.content.is-above{top:var(--vb-popup-top, 100%)}.content.is-show{opacity:1;visibility:visible;transform:none}",""]);const a=h}}]);