"use strict";var _as=(()=>{var I=Object.create;var q=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var z=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty;var V=(m,s)=>()=>(s||m((s={exports:{}}).exports,s),s.exports);var Z=(m,s,g,n)=>{if(s&&typeof s=="object"||typeof s=="function")for(let o of H(s))!K.call(m,o)&&o!==g&&q(m,o,{get:()=>s[o],enumerable:!(n=U(s,o))||n.enumerable});return m};var G=(m,s,g)=>(g=m!=null?I(z(m)):{},Z(s||!m||!m.__esModule?q(g,"default",{value:m,enumerable:!0}):g,m));var D=V((L,$)=>{(function(m,s){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],s);else if(typeof L<"u")s($);else{var g={exports:{}};s(g),m.browser=g.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:L,function(m){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let s="The message port closed before a response was received.",g=n=>{let o={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(o).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class c extends WeakMap{constructor(r,i=void 0){super(i),this.createItem=r}get(r){return this.has(r)||this.set(r,this.createItem(r)),super.get(r)}}let u=e=>e&&typeof e=="object"&&typeof e.then=="function",x=(e,r)=>(...i)=>{n.runtime.lastError?e.reject(new Error(n.runtime.lastError.message)):r.singleCallbackArg||i.length<=1&&r.singleCallbackArg!==!1?e.resolve(i[0]):e.resolve(i)},l=e=>e==1?"argument":"arguments",k=(e,r)=>function(a,...d){if(d.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${l(r.minArgs)} for ${e}(), got ${d.length}`);if(d.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${l(r.maxArgs)} for ${e}(), got ${d.length}`);return new Promise((p,h)=>{if(r.fallbackToNoCallback)try{a[e](...d,x({resolve:p,reject:h},r))}catch(t){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,t),a[e](...d),r.fallbackToNoCallback=!1,r.noCallback=!0,p()}else r.noCallback?(a[e](...d),p()):a[e](...d,x({resolve:p,reject:h},r))})},f=(e,r,i)=>new Proxy(r,{apply(a,d,p){return i.call(d,e,...p)}}),b=Function.call.bind(Object.prototype.hasOwnProperty),C=(e,r={},i={})=>{let a=Object.create(null),d={has(h,t){return t in e||t in a},get(h,t,y){if(t in a)return a[t];if(!(t in e))return;let A=e[t];if(typeof A=="function")if(typeof r[t]=="function")A=f(e,e[t],r[t]);else if(b(i,t)){let M=k(t,i[t]);A=f(e,e[t],M)}else A=A.bind(e);else if(typeof A=="object"&&A!==null&&(b(r,t)||b(i,t)))A=C(A,r[t],i[t]);else if(b(i,"*"))A=C(A,r[t],i["*"]);else return Object.defineProperty(a,t,{configurable:!0,enumerable:!0,get(){return e[t]},set(M){e[t]=M}}),A;return a[t]=A,A},set(h,t,y,A){return t in a?a[t]=y:e[t]=y,!0},defineProperty(h,t,y){return Reflect.defineProperty(a,t,y)},deleteProperty(h,t){return Reflect.deleteProperty(a,t)}},p=Object.create(e);return new Proxy(p,d)},v=e=>({addListener(r,i,...a){r.addListener(e.get(i),...a)},hasListener(r,i){return r.hasListener(e.get(i))},removeListener(r,i){r.removeListener(e.get(i))}}),T=new c(e=>typeof e!="function"?e:function(i){let a=C(i,{},{getContent:{minArgs:0,maxArgs:0}});e(a)}),w=new c(e=>typeof e!="function"?e:function(i,a,d){let p=!1,h,t=new Promise(P=>{h=function(S){p=!0,P(S)}}),y;try{y=e(i,a,h)}catch(P){y=Promise.reject(P)}let A=y!==!0&&u(y);if(y!==!0&&!A&&!p)return!1;let M=P=>{P.then(S=>{d(S)},S=>{let O;S&&(S instanceof Error||typeof S.message=="string")?O=S.message:O="An unexpected error occurred",d({__mozWebExtensionPolyfillReject__:!0,message:O})}).catch(S=>{console.error("Failed to send onMessage rejected reply",S)})};return M(A?y:t),!0}),E=({reject:e,resolve:r},i)=>{n.runtime.lastError?n.runtime.lastError.message===s?r():e(new Error(n.runtime.lastError.message)):i&&i.__mozWebExtensionPolyfillReject__?e(new Error(i.message)):r(i)},_=(e,r,i,...a)=>{if(a.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${l(r.minArgs)} for ${e}(), got ${a.length}`);if(a.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${l(r.maxArgs)} for ${e}(), got ${a.length}`);return new Promise((d,p)=>{let h=E.bind(null,{resolve:d,reject:p});a.push(h),i.sendMessage(...a)})},j={devtools:{network:{onRequestFinished:v(T)}},runtime:{onMessage:v(w),onMessageExternal:v(w),sendMessage:_.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:_.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},B={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return o.privacy={network:{"*":B},services:{"*":B},websites:{"*":B}},C(n,j,o)};m.exports=g(chrome)}else m.exports=globalThis.browser})});var W=G(D());var R=class{static{this.currentContext=0}static set CurrentContext(s){this.currentContext=s}static isBackgroundScript(){return this.currentContext===1}static isContentScript(){return this.currentContext===2}static isOptions(){return this.currentContext===3}};var N=class{static escapeRegExp(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static clearSpecialSymbols(s){return s.replace(/[\u00AE\u00A9\u2122]/g,"")}static levenshtein(s,g){let n=s.length,o=g.length;if(n===0)return o;if(o===0)return n;let c,u,x,l,k,f,b,C,v,T,w;for(n>o&&(c=s,s=g,g=c),f=new Int8Array(n+1),u=0;u<=n;u++)f[u]=u;for(u=1;u<=o;u++){for(l=u,w=g[u-1],x=1;x<=n;x++)w===s[x-1]?k=f[x-1]:(b=l+1,C=f[x]+1,v=b-(b-C&C-b>>7),T=f[x-1]+1,k=v-(v-T&T-v>>7)),f[x-1]=l,l=k;f[n]=l}return f[n]}};var F=class{constructor(){this.parser=new DOMParser}dom(s){return this.parser.parseFromString(s,"text/html")}parseCurrencyFromWallet(s){return this.dom(s).querySelector("input[name=currency]")?.value??null}parseCurrencyFromApp(s){return this.dom(s).querySelector("meta[itemprop=priceCurrency][content]")?.getAttribute("content")??null}parseWorkshopFileSize(s){let g=this.dom(s).querySelector(".detailsStatRight")?.textContent;if(!g)return-1;let n=g.match(/(\d+(?:[.,]\d+)?) (MB|KB|B)/);if(!n)return-2;let o=parseFloat(n[1].replace(/,/g,""));if(Number.isNaN(o))return-2;let c=n[2];return o*{MB:1e3,KB:1,B:.001}[c]}parseReviews(s){let g=[];for(let n of this.dom(s).querySelectorAll(".review_box")){let o=n.querySelector("[src*=thumbsUp]")?1:0,[c=0,u=0]=Array.from(n.querySelector(".header")?.childNodes??[]).filter(w=>w.nodeType===Node.TEXT_NODE).map(w=>{let E=w.textContent?.match(/(?:\d+,)?\d+/);return E?Number(E[0].replace(/,/g,"")):0}),x=n.querySelector(".content").textContent.trim().length,l=n.querySelector("input[id^=ReviewVisibility]"),k=l?Number(l.value):0,f=l?l.id.replace("ReviewVisibility",""):n.querySelector(".control_block > a").id.replace("RecommendationVoteUpBtn",""),b=n.querySelector(".hours").textContent.match(/(?:\d+,)?\d+\.\d+/),C=b?parseFloat(b[0].replace(/,/g,"")):0,v=Array.from(n.querySelectorAll(".review_award")).reduce((w,E)=>{let _=E.classList.contains("more_btn")?0:Number(E.querySelector(".review_award_count").textContent.trim());return w+_},0),T=n.nextElementSibling?.classList.contains("review_developer_response_container")?n.nextElementSibling.outerHTML:"";g.push({default:0,rating:o,helpful:c,funny:u,length:x,visibility:k,playtime:C,awards:v,node:n.outerHTML+T,id:f})}return g}parsePurchaseDates(s){let g=[/- Complete Pack/ig,/Standard Edition/ig,/Steam Store and Retail Key/ig,/- Hardware Survey/ig,/ComputerGamesRO -/ig,/Founder Edition/ig,/Retail( Key)?/ig,/Complete$/ig,/Launch$/ig,/Free$/ig,/(RoW)/ig,/ROW/ig,/:/ig],n=[],c=this.dom(s).querySelectorAll("#main_content td.license_date_col");for(let u of c){let x=u.nextElementSibling;if(!x)continue;x.querySelector("div")?.remove();let l=N.clearSpecialSymbols(x.textContent.trim());for(let k of g)l=l.replace(k,"");l=l.trim(),n.push([l,u.textContent])}return n}};R.CurrentContext=4;W.default.runtime.onMessage.addListener((m,s,g)=>{if(!m||!m.domparser)return;let{op:n,html:o}=m.domparser,c=new F;switch(n){case"currencyFromWallet":g(c.parseCurrencyFromWallet(o));return;case"currencyFromApp":g(c.parseCurrencyFromApp(o));return;case"workshopFileSize":g(c.parseWorkshopFileSize(o));return;case"reviews":g(c.parseReviews(o));return;case"purchaseDates":g(c.parsePurchaseDates(o));return}throw new Error("Unknown operation")});})();
//# sourceMappingURL=offscreen_domparser.js.map
