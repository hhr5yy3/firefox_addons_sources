import{S as J,i as Q,s as V,e as w,a as F,f as h,j as k,h as z,t as S,k as j,m as O,n as y,o as X,A as Y,p as H,b as m,l as B,T as P,q as D,u as A,v as Z,w as I,x as R,y as W,z as T,B as K,C as v,F as x}from"./utils-CNNLZU9x.js";function $(u){let t,e,r,o,s,c,f,a,g,l,d,E,G;e=new P({props:{checked:u[0],label:"Enable aiBlock globally",onChange:u[9]}}),o=new P({props:{checked:u[8],label:"Enable on "+u[1],onChange:u[10]}});let b=u[2]>0&&q(u);const N=[re,ne],L=[];function U(i,n){return i[3].length>0?0:1}return f=U(u),a=L[f]=N[f](u),{c(){t=w("div"),D(e.$$.fragment),r=F(),D(o.$$.fragment),s=F(),b&&b.c(),c=F(),a.c(),g=F(),l=w("button"),l.textContent="Open Options",h(t,"class","toggle-container svelte-kz6yme"),h(l,"class","options-btn neon-effect svelte-kz6yme")},m(i,n){k(i,t,n),A(e,t,null),z(t,r),A(o,t,null),k(i,s,n),b&&b.m(i,n),k(i,c,n),L[f].m(i,n),k(i,g,n),k(i,l,n),d=!0,E||(G=Z(l,"click",u[12]),E=!0)},p(i,n){const _={};n&1&&(_.checked=i[0]),e.$set(_);const p={};n&256&&(p.checked=i[8]),n&2&&(p.label="Enable on "+i[1]),o.$set(p),i[2]>0?b?b.p(i,n):(b=q(i),b.c(),b.m(c.parentNode,c)):b&&(b.d(1),b=null);let M=f;f=U(i),f===M?L[f].p(i,n):(H(),S(L[M],1,1,()=>{L[M]=null}),j(),a=L[f],a?a.p(i,n):(a=L[f]=N[f](i),a.c()),O(a,1),a.m(g.parentNode,g))},i(i){d||(O(e.$$.fragment,i),O(o.$$.fragment,i),O(a),d=!0)},o(i){S(e.$$.fragment,i),S(o.$$.fragment,i),S(a),d=!1},d(i){i&&(y(t),y(s),y(c),y(g),y(l)),I(e),I(o),b&&b.d(i),L[f].d(i),E=!1,G()}}}function ee(u){let t,e;return{c(){t=w("p"),e=R(u[6]),h(t,"class","error svelte-kz6yme")},m(r,o){k(r,t,o),z(t,e)},p(r,o){o&64&&W(e,r[6])},i:T,o:T,d(r){r&&y(t)}}}function te(u){let t;return{c(){t=w("div"),t.innerHTML=`<span class="error svelte-kz6yme">Unable to access tab data. This may be because this tab was open before
        the extension was installed or the extension is not allowed to access
        this page. <b>Please refresh the page.</b></span>`,h(t,"class","error-container svelte-kz6yme")},m(e,r){k(e,t,r)},p:T,i:T,o:T,d(e){e&&y(t)}}}function se(u){let t;return{c(){t=w("p"),t.textContent="Loading...",h(t,"class","loading svelte-kz6yme")},m(e,r){k(e,t,r)},p:T,i:T,o:T,d(e){e&&y(t)}}}function q(u){let t,e,r,o;return{c(){t=w("p"),e=R("Elements blocked on this page: "),r=w("span"),o=R(u[2]),h(r,"class","svelte-kz6yme"),K(r,"active",u[2]>0),h(t,"class","blocked-count svelte-kz6yme")},m(s,c){k(s,t,c),z(t,e),z(t,r),z(r,o)},p(s,c){c&4&&W(o,s[2]),c&4&&K(r,"active",s[2]>0)},d(s){s&&y(t)}}}function ne(u){let t;return{c(){t=w("p"),t.textContent="No filters available for this domain.",h(t,"class","no-filters svelte-kz6yme")},m(e,r){k(e,t,r)},p:T,i:T,o:T,d(e){e&&y(t)}}}function re(u){let t,e,r,o;return r=new x({props:{filters:u[3],activeFilters:u[4],onToggle:u[11]}}),{c(){t=w("h2"),t.textContent="Filters",e=F(),D(r.$$.fragment),h(t,"class","svelte-kz6yme")},m(s,c){k(s,t,c),k(s,e,c),A(r,s,c),o=!0},p(s,c){const f={};c&8&&(f.filters=s[3]),c&16&&(f.activeFilters=s[4]),r.$set(f)},i(s){o||(O(r.$$.fragment,s),o=!0)},o(s){S(r.$$.fragment,s),o=!1},d(s){s&&(y(t),y(e)),I(r,s)}}}function oe(u){let t,e,r,o,s,c;const f=[se,te,ee,$],a=[];function g(l,d){return l[5]?0:l[7]?1:l[6]?2:3}return o=g(u),s=a[o]=f[o](u),{c(){t=w("main"),e=w("div"),e.innerHTML='<div class="logo-container svelte-kz6yme"><img src="/icon/256.png" alt="aiBlock Logo" class="logo svelte-kz6yme"/></div>',r=F(),s.c(),h(e,"class","logo-wrapper svelte-kz6yme"),h(t,"class","svelte-kz6yme")},m(l,d){k(l,t,d),z(t,e),z(t,r),a[o].m(t,null),c=!0},p(l,[d]){let E=o;o=g(l),o===E?a[o].p(l,d):(H(),S(a[E],1,1,()=>{a[E]=null}),j(),s=a[o],s?s.p(l,d):(s=a[o]=f[o](l),s.c()),O(s,1),s.m(t,null))},i(l){c||(O(s),c=!0)},o(l){S(s),c=!1},d(l){l&&y(t),a[o].d()}}}function le(u,t,e){let r=!0,o="",s=0,c=[],f=[],a,g=!0,l="",d=!1,E=!0;const G=v(b,1e3);async function b(){var n;e(5,g=!0),e(6,l=""),e(7,d=!1);try{const _=await m.runtime.sendMessage({type:"GET_USER_PREFERENCES"});e(0,r=_.globalEnabled);const p=await m.tabs.query({active:!0,currentWindow:!0});if((n=p[0])!=null&&n.url){a=p[0].id,e(1,o=new URL(p[0].url).hostname);const M=await m.runtime.sendMessage({type:"GET_SITE_STATE",domain:o});e(8,E=M.enabled),e(3,c=await m.runtime.sendMessage({type:"GET_FILTERS_FOR_DOMAIN",domain:o})),e(4,f=c.filter(C=>C.enabled)),a&&e(2,s=await m.tabs.sendMessage(a,{type:"GET_BLOCKED_COUNT"}))}}catch(_){const p=_ instanceof Error?_.message:String(_);p.includes("Could not establish connection. Receiving end does not exist.")?e(7,d=!0):(e(6,l=`Error updating popup state: ${p}`),console.error("Full error object:",_),B(l,_))}finally{e(5,g=!1)}}async function N(){e(5,g=!0),e(6,l="");try{e(0,r=!r),await m.runtime.sendMessage({type:"UPDATE_PREFERENCES",preferences:{globalEnabled:r}}),a&&(await m.tabs.sendMessage(a,{type:"SET_GLOBAL_ENABLED",enabled:r}),e(2,s=await m.tabs.sendMessage(a,{type:"GET_BLOCKED_COUNT"})))}catch(n){const _=n instanceof Error?n.message:String(n);e(6,l=`Error toggling global enabled state: ${_}`),B(l,n),e(0,r=!r)}finally{e(5,g=!1)}}async function L(){e(5,g=!0),e(6,l="");try{e(8,E=!E),await m.runtime.sendMessage({type:"SET_SITE_STATE",domain:o,enabled:E}),a&&(await m.tabs.sendMessage(a,{type:"SET_SITE_ENABLED",enabled:E}),e(2,s=await m.tabs.sendMessage(a,{type:"GET_BLOCKED_COUNT"})))}catch(n){const _=n instanceof Error?n.message:String(n);e(6,l=`Error toggling site enabled state: ${_}`),B(l,n),e(8,E=!E)}finally{e(5,g=!1)}}async function U(n,_){e(5,g=!0),e(6,l="");try{await m.runtime.sendMessage({type:"TOGGLE_FILTER",filterId:n,enabled:_}),e(3,c=c.map(p=>p.id===n?{...p,enabled:_}:p)),_?e(4,f=[...f,c.find(p=>p.id===n)]):e(4,f=f.filter(p=>p.id!==n)),a&&(await m.tabs.sendMessage(a,{type:"TOGGLE_FILTER",filterId:n,enabled:_}),e(2,s=await m.tabs.sendMessage(a,{type:"GET_BLOCKED_COUNT"})))}catch(p){const M=p instanceof Error?p.message:String(p);e(6,l=`Error toggling filter: ${M}`),B(l,p),e(3,c=c.map(C=>C.id===n?{...C,enabled:!_}:C)),_?e(4,f=f.filter(C=>C.id!==n)):e(4,f=[...f,c.find(C=>C.id===n)])}finally{e(5,g=!1)}}return X(()=>{b(),m.tabs.onUpdated.addListener((n,_,p)=>{n===a&&_.status==="complete"&&G()}),m.runtime.onMessage.addListener(n=>{n.type==="UPDATE_BLOCKED_COUNT"&&e(2,s=n.count)})}),Y(()=>{m.tabs.onUpdated.removeListener(G)}),[r,o,s,c,f,g,l,d,E,N,L,U,()=>m.runtime.openOptionsPage()]}class ae extends J{constructor(t){super(),Q(this,t,le,oe,V,{})}}new ae({target:document.getElementById("app")});
