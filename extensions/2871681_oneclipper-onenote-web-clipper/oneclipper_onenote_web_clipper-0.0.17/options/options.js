var v=Object.create;var m=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var T=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var L=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of E(t))!A.call(e,o)&&o!==r&&m(e,o,{get:()=>t[o],enumerable:!(n=_(t,o))||n.enumerable});return e};var M=(e,t,r)=>(r=e!=null?v(S(e)):{},L(t||!e||!e.__esModule?m(r,"default",{value:e,enumerable:!0}):r,e));var u=T(b=>{globalThis.$on=(e,t,r)=>e.addEventListener(t,r);globalThis.eId=document.getElementById.bind(document);globalThis.$=(e,t)=>(t||document).querySelector(e);globalThis.i18n=chrome.i18n.getMessage.bind(b);globalThis.setLang=e=>eId(e).textContent=chrome.i18n.getMessage(e);globalThis.getStore=chrome.storage.local.get.bind(chrome.storage.local);globalThis.setStore=chrome.storage.local.set.bind(chrome.storage.local);var c=eId("snackbar");globalThis.toast=e=>{c.hidden=!1,c.innerText=e,setTimeout(()=>c.hidden=!0,5100)}});var Y=M(u());var{version:C,short_name:I,update_url:O}=chrome.runtime.getManifest(),p=!O;function a(e){if(p)return console.error(e);let t="https://bug-collector.noterail.workers.dev/collect-bug",r={id:1,extId:chrome.runtime.id,extName:I,extVersion:C,message:e.message??e.reason,stack:e.stack,browserOs:navigator.userAgent,catchedAt:new Date().toISOString()},n=new Request(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});fetch(n).then(o=>o.text()).then(o=>console.log(o)).catch(o=>console.log(o))}if(!p){self.addEventListener("error",a),self.addEventListener("unhandledrejection",a);let e={apply:function(r,n,o){return a(o[0]),r.call(n,...o)}};console.error=new Proxy(console.error,e)}var F=chrome.tabs.query.bind(chrome.tabs),f=chrome.storage.sync.get.bind(chrome.storage.sync),d=chrome.storage.sync.set.bind(chrome.storage.sync),H=chrome.storage.session.get.bind(chrome.storage.session),N=chrome.storage.session.set.bind(chrome.storage.session);var q=["hightlightOn","fileNameFormat"],x=await f(q),k=eId("toggle_highlight");k.checked=x.hightlightOn;$on(k,"change",({target:e})=>{d({hightlightOn:e.checked}),chrome.runtime.sendMessage({msg:"toggle_highlight",hightlightOn:e.checked})});var g=eId("filename-format");g.value=x.fileNameFormat;$on(g,"change",()=>d({fileNameFormat:g.value}));var h=eId("send-mail-buttons");$on(h.lastElementChild,"click",j);$on(h.children[2],"click",B);$on(h.children[1],"click",()=>alert("Coming soon"));function y(){let{version:e,short_name:t}=chrome.runtime.getManifest();return`%0A%0AExtensionId:%20${chrome.runtime.id}%0AExtension%20Name:%20${t}%0AExtension%20Version:%20${e}%0ABrowser%20Info:%20${navigator.userAgent}`}function B(){let e=$(".contact-form"),t="mailto:noterailhelp@gmail.com?";t+=`subject=${$("#subject",e).value}`,t+=`&body=${$("#mailbody",e).value.replaceAll(`
`,"%0A")}`,t+=y(),w(t)}function j(){let e=$(".contact-form"),t="https://mail.google.com/mail/u/0/?to=noterailhelp@gmail.com";t+=`&su=${$("#subject",e).value}`,t+=`&body=${$("#mailbody",e).value.replaceAll(`
`,"%0A")}`,t+=y(),t+="&tf=cm",w(t)}function w(e){e=encodeURI(e);let t=document.createElement("a");t.href=e,t.click()}var s=class extends HTMLDialogElement{constructor(t){super(),this.error=t,this.gmailUrl="https://mail.google.com/mail/u/0/",this.mailTo="noterailhelp@gmail.com"}async reportBug(){let{version:t,short_name:r}=chrome.runtime.getManifest(),n=this.error.stack?.replaceAll(`
`,"%0A"),o=`${this.gmailUrl}?to=${this.mailTo}&su=${this.error.message}&body=Error:%20${this.error.message}%0AStack:%20${n}%0AExtensionId:%20${chrome.runtime.id}%0AExtension%20Name:%20${r}%0AExtension%20Version:%20${t}%0ABrowser%20Info:%20${navigator.userAgent}&fs=1&tf=cm`;await chrome.tabs.create({url:o})}render(){return`<h2>\u{1F62A} ${chrome.i18n.getMessage("sorry_something_went_wrong")} \u{1F41B}</h2>
			<p style="max-width: 50ch;overflow-wrap: break-word;">\u274C ${this.error.message?.replaceAll("<","&lt;")?.replaceAll(">","&gt;")}</p>
			<button style="font-size: 1rem;margin-inline: auto;display: block;"> 
				\u{1F41E} <span>${chrome.i18n.getMessage("report_bug")}</span>
			</button>
			<div style="text-align:center;font-size:x-small;">${chrome.i18n.getMessage("just_one_click")}</div>`}connectedCallback(){this.id="report-bug",this.innerHTML=this.render(),this.showModal(),this.lastElementChild.previousElementSibling.addEventListener("click",this.reportBug.bind(this))}};customElements.define("report-bug",s,{extends:"dialog"});setLang("keyboard_shortcuts");setLang("changelog");setLang("contact_us");setLang("contactus");setLang("starter_guide");setLang("more_extensions");setLang("enable_highlighter");setLang("create_new_note_title_format");setLang("permission_required");setLang("permission_required_to_write");setLang("grant_permission");var l=eId("host-permission");chrome.runtime.onMessage.addListener((e,t,r)=>{if(e==="requestHostPermission"){l.showModal();let n=l.querySelector("button");$on(n,"click",o);async function o(){chrome.permissions.request({origins:["<all_urls>"]}).then(i=>{r(i),n.textContent=`permission ${i?"Granted":"Denied"}`,n.style.backgroundColor=i?"green":"red",i&&(chrome.storage.sync.set({hightlightOn:!0}),chrome.runtime.sendMessage({msg:"toggle_highlight",hightlightOn:!0}),setTimeout(close,4e3))})}return!0}if(e==="requestChatGPTPermission"){l.showModal();l.querySelector("dt").textContent = "chatgpt.com";let n=l.querySelector("button");$on(n,"click",o);async function o(){chrome.permissions.request({origins:["https://chatgpt.com/*"]}).then(i=>{r(i),n.textContent=`permission ${i?"Granted":"Denied"}`,n.style.backgroundColor=i?"green":"red",i&&(chrome.storage.sync.set({hightlightOn:!0}),chrome.runtime.sendMessage({msg:"toggle_highlight",hightlightOn:!0}),setTimeout(close,4e3))})}return!0}e.msg==="reportBug"&&document.body.appendChild(new s(e.error))});
