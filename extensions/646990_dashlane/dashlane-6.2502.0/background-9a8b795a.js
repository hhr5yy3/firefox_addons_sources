"use strict";(self.webpackChunk_dashlane_amphora=self.webpackChunk_dashlane_amphora||[]).push([[394],{41711:(e,t,s)=>{s.d(t,{KV:()=>a,co:()=>o,td:()=>n});var i=s(30504),r=s(83307);const n={participateToUserABTest:(0,i.slot)()},o={getUserABTestVariant:(0,i.slot)()},a={liveUserABTestVariant:(0,r.H)()}},16835:(e,t,s)=>{s.d(t,{PG:()=>o,PO:()=>n,cN:()=>a});var i=s(30504),r=s(83307);const n={editContactInfo:(0,i.slot)(),refreshContactInfo:(0,i.slot)()},o={getContactInfo:(0,i.slot)()},a={liveContactInfo:(0,r.H)()}},60268:(e,t,s)=>{s.d(t,{f:()=>i});const i={livePhishingURLList:(0,s(83307).H)()}},72490:(e,t,s)=>{s.d(t,{KM:()=>n,b6:()=>o,ud:()=>a});var i=s(30504),r=s(83307);const n={refreshU2FDevicesList:(0,i.slot)(),removeU2FAuthenticator:(0,i.slot)(),refreshTwoFactorAuthenticationInfo:(0,i.slot)(),startTwoFactorAuthenticationEnableFlow:(0,i.slot)(),stopTwoFactorAuthenticationEnableFlow:(0,i.slot)(),continueTwoFactorAuthenticationEnableFlow:(0,i.slot)(),backTwoFactorAuthenticationEnableFlow:(0,i.slot)(),startTwoFactorAuthenticationDisableFlow:(0,i.slot)(),stopTwoFactorAuthenticationDisableFlow:(0,i.slot)(),continueTwoFactorAuthenticationDisableFlow:(0,i.slot)(),backTwoFactorAuthenticationDisableFlow:(0,i.slot)()},o={getU2FDevicesList:(0,i.slot)(),getTwoFactorAuthenticationEnableStage:(0,i.slot)(),getTwoFactorAuthenticationDisableStage:(0,i.slot)()},a={liveU2FDevicesList:(0,r.H)(),liveTwoFactorAuthenticationEnableStage:(0,r.H)(),liveTwoFactorAuthenticationDisableStage:(0,r.H)()}},91652:(e,t,s)=>{s.d(t,{M2:()=>d,O6:()=>h,Ok:()=>p,Oq:()=>a,Pb:()=>r,Rr:()=>c,bL:()=>l,dc:()=>n,fl:()=>o,tv:()=>g,vW:()=>u,vz:()=>i});const i=Object.freeze({CREATE:"webauthn.create",GET:"webauthn.get"});var r=function(e){return e.UNKNOWN_ERROR="UNKNOWN_ERROR",e}({}),n=function(e){return e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.USER_HAS_OTP="USER_HAS_OTP",e.WEBAUTHN_SERVICE_INIT_FAILED="WEBAUTHN_SERVICE_INIT_FAILED",e}({}),o=function(e){return e.UNKNOWN_ERROR="UNKNOWN_ERROR",e}({}),a=function(e){return e.USER_HAS_OTP="USER_HAS_OTP",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e}({}),c=function(e){return e.UNKNOWN_ERROR="UNKNOWN_ERROR",e}({}),d=function(e){return e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.MISSING_SESSION_KEYS_IN_STORE="MISSING_SESSION_KEYS_IN_STORE",e}({}),l=function(e){return e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.UNAVAILABLE_AUTHENTICATORS="UNAVAILABLE_AUTHENTICATORS",e.CANNOT_TRIGGER_WEBAUTHN_AUTHENTICATION="CANNOT_TRIGGER_WEBAUTHN_AUTHENTICATION",e}({}),u=function(e){return e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.MP_MISSING_IN_SESSION_ERROR="MP_MISSING_IN_SESSION_ERROR",e}({}),p=function(e){return e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.WEBAUTHN_SERVICE_DEACTIVATE_FAILED="WEBAUTHN_SERVICE_DEACTIVATE_FAILED",e.MISSING_LOGIN="MISSING_LOGIN",e}({}),h=function(e){return e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.CANNOT_REMOVE_WEBAUTHN_AUTHENTICATOR="CANNOT_REMOVE_WEBAUTHN_AUTHENTICATOR",e}({}),g=function(e){return e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.LOGGED_OUT="LOGGED_OUT",e.CANNOT_REFRESH_WEBAUTHN_AUTHENTICATORS="CANNOT_REFRESH_WEBAUTHN_AUTHENTICATORS",e.CANNOT_FETCH_WEBAUTHN_CHALLENGE="CANNOT_FETCH_WEBAUTHN_CHALLENGE",e}({})},66460:(e,t,s)=>{s.d(t,{Ui:()=>o,jF:()=>a,qM:()=>n});var i=s(30504),r=s(83307);const n={enableWebAuthnAuthentication:(0,i.slot)(),initEnableWebAuthnAuthentication:(0,i.slot)(),refreshAvailableWebAuthnAuthenticators:(0,i.slot)(),refreshWebAuthnAuthenticators:(0,i.slot)(),initRegisterWebAuthnAuthenticator:(0,i.slot)(),registerWebAuthnAuthenticator:(0,i.slot)(),initOpenSessionWithWebAuthnAuthenticator:(0,i.slot)(),openSessionWithWebAuthnAuthenticator:(0,i.slot)(),disableWebAuthnAuthentication:(0,i.slot)(),removeWebAuthnAuthenticator:(0,i.slot)(),initUserVerificationWithWebAuthn:(0,i.slot)()},o={getWebAuthnAuthenticators:(0,i.slot)(),getWebAuthnAuthenticationOptedIn:(0,i.slot)()},a={liveWebAuthnAuthenticators:(0,r.H)(),liveWebAuthnAuthenticationOptedIn:(0,r.H)()}},43816:(e,t,s)=>{s.d(t,{QR:()=>d,ke:()=>c,zR:()=>a});var i=s(30504),r=s(66460),n=s(72490),o=s(83307);const a=(0,i.combineEvents)({openSessionWithMasterPassword:(0,i.slot)(),registerDevice:(0,i.slot)(),requestEmailToken:(0,i.slot)(),requestPaymentUpdateAuthenticationToken:(0,i.slot)(),setReactivationStatus:(0,i.slot)(),disableAutologin:(0,i.slot)()},r.qM,n.KM),c=(0,i.combineEvents)({getHasOtp2Type:(0,i.slot)(),getUserOtpType:(0,i.slot)(),getReactivationStatus:(0,i.slot)(),getAvailableUserVerificationMethods:(0,i.slot)()},r.Ui,n.b6),d=(0,i.combineEvents)({liveReactivationStatus:(0,o.H)()},r.jF,n.ud)},89238:(e,t,s)=>{s.d(t,{WQ:()=>o,Yp:()=>i,_V:()=>c,_g:()=>r,jP:()=>n,mE:()=>a});const i="SEND_TOKEN_FAILED";var r=function(e){return e.DISABLED="DISABLED",e.CLASSIC="CLASSIC",e.WEBAUTHN="WEBAUTHN",e}({}),n=function(e){return e[e.PERSIST_DATA_YES=0]="PERSIST_DATA_YES",e[e.PERSIST_DATA_NO=1]="PERSIST_DATA_NO",e}({});const o=Object.freeze({MasterPassword:"masterPassword",Webauthn:"webauthn"});var a=function(e){return e[e.NO_OTP=0]="NO_OTP",e[e.OTP_NEW_DEVICE=1]="OTP_NEW_DEVICE",e[e.OTP_LOGIN=2]="OTP_LOGIN",e}({}),c=function(e){return e[e.INVALID_LOGIN=0]="INVALID_LOGIN",e[e.EMPTY_LOGIN=1]="EMPTY_LOGIN",e[e.EMPTY_MASTER_PASSWORD=2]="EMPTY_MASTER_PASSWORD",e[e.EMPTY_ENCRYPTED_KEY=3]="EMPTY_ENCRYPTED_KEY",e[e.INVALID_ENCRYPTED_KEY=4]="INVALID_ENCRYPTED_KEY",e[e.EMPTY_TOKEN=5]="EMPTY_TOKEN",e[e.EMPTY_OTP=6]="EMPTY_OTP",e[e.SEND_TOKEN_FAILED=7]="SEND_TOKEN_FAILED",e[e.UKI_REGISTRATION_FAILED=8]="UKI_REGISTRATION_FAILED",e[e.REGISTER_DEVICE_FAILED=9]="REGISTER_DEVICE_FAILED",e[e.BUSINESS_ERROR=10]="BUSINESS_ERROR",e[e.USER_DOESNT_EXIST=11]="USER_DOESNT_EXIST",e[e.USER_DOESNT_EXIST_UNLIKELY_MX=12]="USER_DOESNT_EXIST_UNLIKELY_MX",e[e.USER_DOESNT_EXIST_INVALID_MX=13]="USER_DOESNT_EXIST_INVALID_MX",e[e.USER_UNAUTHORIZED=14]="USER_UNAUTHORIZED",e[e.WRONG_PASSWORD=15]="WRONG_PASSWORD",e[e.DATA_TAMPERED_ERROR=16]="DATA_TAMPERED_ERROR",e[e.LOGGEDIN=17]="LOGGEDIN",e[e.ASK_TOKEN=18]="ASK_TOKEN",e[e.ASK_OTP=19]="ASK_OTP",e[e.ASK_MASTER_PASSWORD=20]="ASK_MASTER_PASSWORD",e[e.USE_LOCAL_UKI=21]="USE_LOCAL_UKI",e[e.ASK_DASHLANE_AUTHENTICATOR=22]="ASK_DASHLANE_AUTHENTICATOR",e[e.OTP_NOT_VALID=23]="OTP_NOT_VALID",e[e.OTP_TOO_MANY_ATTEMPTS=24]="OTP_TOO_MANY_ATTEMPTS",e[e.OTP_ALREADY_USED=25]="OTP_ALREADY_USED",e[e.BACKUP_CODE_NOT_VALID=26]="BACKUP_CODE_NOT_VALID",e[e.TOKEN_NOT_VALID=27]="TOKEN_NOT_VALID",e[e.DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED=28]="DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED",e[e.SERVER_KEY_MISSING=29]="SERVER_KEY_MISSING",e[e.TOKEN_LOCKED=30]="TOKEN_LOCKED",e[e.TOKEN_TOO_MANY_ATTEMPTS=31]="TOKEN_TOO_MANY_ATTEMPTS",e[e.TOKEN_ACCOUNT_LOCKED=32]="TOKEN_ACCOUNT_LOCKED",e[e.TOKEN_EXPIRED=33]="TOKEN_EXPIRED",e[e.NO_ACTIVE_AUTHENTICATOR=34]="NO_ACTIVE_AUTHENTICATOR",e[e.FAILED_TO_CONTACT_AUTHENTICATOR_DEVICE=35]="FAILED_TO_CONTACT_AUTHENTICATOR_DEVICE",e[e.DASHLANE_AUTHENTICATOR_ASKED_FOR_LOCAL_SESSION=36]="DASHLANE_AUTHENTICATOR_ASKED_FOR_LOCAL_SESSION",e[e.DASHLANE_AUTHENTICATOR_LOGIN_CANCELLED=37]="DASHLANE_AUTHENTICATOR_LOGIN_CANCELLED",e[e.TOKEN_PROVIDED_FOR_LOCAL_SESSION=38]="TOKEN_PROVIDED_FOR_LOCAL_SESSION",e[e.DEVICE_ALREADY_REGISTERED=39]="DEVICE_ALREADY_REGISTERED",e[e.OTP_PROVIDED_FOR_LOCAL_NON_OTP_SESSION=40]="OTP_PROVIDED_FOR_LOCAL_NON_OTP_SESSION",e[e.DIFFERENT_LOGIN_PROVIDED_WITH_TOKEN_OR_OTP=41]="DIFFERENT_LOGIN_PROVIDED_WITH_TOKEN_OR_OTP",e[e.UNKNOWN_SYNC_ERROR=42]="UNKNOWN_SYNC_ERROR",e[e.INVALID_UKI=43]="INVALID_UKI",e[e.UNKNOWN_UKI=44]="UNKNOWN_UKI",e[e.UNKNOWN_ERROR=45]="UNKNOWN_ERROR",e[e.UNEXPECTED_OTP_TYPE=46]="UNEXPECTED_OTP_TYPE",e[e.UNAUTHORIZED=47]="UNAUTHORIZED",e[e.UNAUTHORIZED_NOT_VALID_CONTENT=48]="UNAUTHORIZED_NOT_VALID_CONTENT",e[e.NETWORK_ERROR=49]="NETWORK_ERROR",e[e.THROTTLED=50]="THROTTLED",e[e.SESSION_ALREADY_OPENED=51]="SESSION_ALREADY_OPENED",e[e.INVALID_SESSION=52]="INVALID_SESSION",e[e.DEVICE_NOT_REGISTERED=53]="DEVICE_NOT_REGISTERED",e[e.MISSING_APP_KEYS=54]="MISSING_APP_KEYS",e[e.PROVIDE_EXTRA_DEVICE_TOKEN=55]="PROVIDE_EXTRA_DEVICE_TOKEN",e[e.PROVIDE_MASTER_PASSWORD_FOR_EXTRA_DEVICE=56]="PROVIDE_MASTER_PASSWORD_FOR_EXTRA_DEVICE",e[e.PROVIDE_MASTER_PASSWORD_AND_SERVER_KEY_FOR_EXTRA_DEVICE=57]="PROVIDE_MASTER_PASSWORD_AND_SERVER_KEY_FOR_EXTRA_DEVICE",e[e.ASK_OTP_FOR_NEW_DEVICE=58]="ASK_OTP_FOR_NEW_DEVICE",e[e.TEAM_GENERIC_ERROR=59]="TEAM_GENERIC_ERROR",e[e.SSO_LOGIN_BYPASS=60]="SSO_LOGIN_BYPASS",e[e.SSO_VERIFICATION_FAILED=61]="SSO_VERIFICATION_FAILED",e[e.SSO_BLOCKED=62]="SSO_BLOCKED",e[e.CLIENT_VERSION_DOES_NOT_SUPPORT_SSO_MIGRATION=63]="CLIENT_VERSION_DOES_NOT_SUPPORT_SSO_MIGRATION",e[e.USER_DOESNT_EXIST_SSO=64]="USER_DOESNT_EXIST_SSO",e}({})},79791:(e,t,s)=>{s.d(t,{c:()=>r});var i=s(30504);const r={getSingleAddressForAutofill:(0,i.slot)(),getMultipleAddressesForAutofill:(0,i.slot)(),getSingleBankAccountForAutofill:(0,i.slot)(),getMultipleBankAccountsForAutofill:(0,i.slot)(),getSingleCompanyForAutofill:(0,i.slot)(),getMultipleCompaniesForAutofill:(0,i.slot)(),getSingleCredentialForAutofill:(0,i.slot)(),getMultipleCredentialsForAutofill:(0,i.slot)(),getSingleDriverLicenseForAutofill:(0,i.slot)(),getMultipleDriverLicensesForAutofill:(0,i.slot)(),getSingleEmailForAutofill:(0,i.slot)(),getMultipleEmailsForAutofill:(0,i.slot)(),getSingleFiscalIdForAutofill:(0,i.slot)(),getMultipleFiscalIdsForAutofill:(0,i.slot)(),getSingleGeneratedPasswordForAutofill:(0,i.slot)(),getMultipleGeneratedPasswordsForAutofill:(0,i.slot)(),getSingleIdCardForAutofill:(0,i.slot)(),getMultipleIdCardsForAutofill:(0,i.slot)(),getSingleIdentityForAutofill:(0,i.slot)(),getMultipleIdentitiesForAutofill:(0,i.slot)(),getSingleNoteForAutofill:(0,i.slot)(),getMultipleNotesForAutofill:(0,i.slot)(),getSinglePasskeyForAutofill:(0,i.slot)(),getSinglePassportForAutofill:(0,i.slot)(),getMultiplePassportsForAutofill:(0,i.slot)(),getSinglePaymentCardForAutofill:(0,i.slot)(),getMultiplePaymentCardsForAutofill:(0,i.slot)(),getSinglePersonalWebsiteForAutofill:(0,i.slot)(),getMultiplePersonalWebsitesForAutofill:(0,i.slot)(),getSinglePhoneForAutofill:(0,i.slot)(),getMultiplePhonesForAutofill:(0,i.slot)(),getSingleSocialSecurityIdForAutofill:(0,i.slot)(),getMultipleSocialSecurityIdsForAutofill:(0,i.slot)(),getAutofillSettingOnUrlForAutofill:(0,i.slot)()}},59327:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(30812),r=s(30309);const n={[i.k.Address]:r.dJ.KWAddress,[i.k.BankAccount]:r.dJ.KWBankStatement,[i.k.Company]:r.dJ.KWCompany,[i.k.Credential]:r.dJ.KWAuthentifiant,[i.k.DriverLicense]:r.dJ.KWDriverLicence,[i.k.Email]:r.dJ.KWEmail,[i.k.FiscalId]:r.dJ.KWFiscalStatement,[i.k.GeneratedPassword]:r.dJ.KWGeneratedPassword,[i.k.IdCard]:r.dJ.KWIDCard,[i.k.Identity]:r.dJ.KWIdentity,[i.k.Note]:r.dJ.KWSecureNote,[i.k.Passkey]:r.dJ.KWPasskey,[i.k.Passport]:r.dJ.KWPassport,[i.k.PaymentCard]:r.dJ.KWPaymentMean_creditCard,[i.k.PersonalWebsite]:r.dJ.KWPersonalWebsite,[i.k.Phone]:r.dJ.KWPhone,[i.k.SocialSecurityId]:r.dJ.KWSocialSecurityStatement,[i.k.Secret]:r.dJ.KWSecret}},8768:(e,t,s)=>{s.d(t,{X:()=>a});var i=s(30504),r=s(92541),n=s(66410),o=s(41571);const a=(0,i.combineEvents)(r.z,n.r,o.z)},92541:(e,t,s)=>{s.d(t,{z:()=>P});var i=s(30504),r=s(41711),n=s(43816),o=s(30551),a=s(16835),c=s(68946),d=s(21222),l=s(13310),u=s(18064),p=s(97414),h=s(29224),g=s(50169),m=s(7073),v=s(42247),y=s(68801),S=s(17065),w=s(41976),E=s(576),I=s(31760),A=s(65133),f=s(30195),b=s(8765),C=s(15314),O=s(6535),R=s(26332),T=s(38026),_=s(8186),D=s(53850),F=s(5725);const P=(0,i.combineEvents)(r.td,n.zR,o.v,a.PO,c.rU,d.I,l.fv,u.c,p.e,h.i,g.a,m.M,v.x,y._m,S.vq,w.U$,E.of,I.r,A._,f.gQ,b.$k,C.H9,O.uG,R.b,T.hO,_.Kr,D.lp,F.n)},41571:(e,t,s)=>{s.d(t,{z:()=>f});var i=s(30504),r=s(41711),n=s(60268),o=s(43816),a=s(30551),c=s(16835),d=s(68946),l=s(13310),u=s(74725),p=s(68801),h=s(17065),g=s(41976),m=s(576),v=s(30195),y=s(8765),S=s(15314),w=s(6535),E=s(38026),I=s(8186),A=s(53850);const f=(0,i.combineEvents)(r.KV,n.f,o.QR,a.F,c.cN,d.vF,l.QX,u.b,p.Rj,h._1,g.iX,m.K1,v.qN,y.EX,S.YW,w.Ll,E.dN,I.kh,A.fD)},66410:(e,t,s)=>{s.d(t,{r:()=>T});var i=s(30504),r=s(41711),n=s(43816),o=s(79791),a=s(16835),c=s(68946),d=s(13310),l=s(5725),u=s(95405),p=s(74725),h=s(68801),g=s(17065),m=s(41976),v=s(576),y=s(31760),S=s(65133),w=s(30195),E=s(8765),I=s(15314),A=s(6535),f=s(20194),b=s(26332),C=s(38026),O=s(8186),R=s(53850);const T=(0,i.combineEvents)(r.co,n.ke,o.c,a.PG,c.kQ,d.pz,l.C,u.i,p.c,h.Xz,g.xP,m.Ie,v.A2,y.H,S.P,w.UW,E.q9,I.JQ,A.i1,f.Q,b.N,C.XJ,O.Vz,R.T4)},83307:(e,t,s)=>{s.d(t,{H:()=>n});var i=s(30504);const r={noBuffer:!0},n=()=>(0,i.slot)(r)},25944:(e,t,s)=>{s.d(t,{o:()=>r});var i=s(30504);const r={log:(0,i.slot)(),info:(0,i.slot)(),warning:(0,i.slot)(),error:(0,i.slot)()}},30551:(e,t,s)=>{s.d(t,{F:()=>o,v:()=>n});var i=s(30504),r=s(83307);const n={changeMasterPassword:(0,i.slot)()},o={liveChangeMasterPasswordStatus:(0,r.H)()}},95075:(e,t,s)=>{s.d(t,{FD:()=>n,Ud:()=>r,pT:()=>i});var i=function(e){return e.USER_CHANGING_MP="USER_CHANGING_MP",e.MP_TO_SSO="MP_TO_SSO",e.SSO_TO_MP="SSO_TO_MP",e.TO_EMAIL_TOKEN="EMAIL_TOKEN",e.ADMIN_ASSISTED_RECOVERY="ADMIN_ASSISTED_RECOVERY",e.ACCOUNT_RECOVERY_KEY="ACCOUNT_RECOVERY_KEY",e}({}),r=function(e){return e.FEATURE_BLOCKED="feature_blocked",e.INNACTIVE_SESSION="inactive_session",e.INVALID_TOKEN="invalid_token",e.OTP_PROBLEM="otp_problem",e.MP_ERROR="mp_error",e.MP_STRENGTH_ERROR="mp_strength_error",e.SUCCESS="success",e.SYNC_PROGRESS="sync_in_progress",e.UNKNOWN_ERROR="unknown_error",e.WRONG_PASSWORD="wrong_password",e.UNEXPECTED_STATE="unexpected_state",e}({}),n=function(e){return e.DOWNLOAD="download",e.DECRYPTING="decrypting",e.ENCRYPTING="encrypting",e.UPLOADING="uploading",e.DONE="done",e.ERROR="error",e}({})},68946:(e,t,s)=>{s.d(t,{kQ:()=>o,rU:()=>n,vF:()=>a});var i=s(30504),r=s(83307);const n={changeUserCrypto:(0,i.slot)()},o={getCanUserChangeCrypto:(0,i.slot)(),getUserDerivationMethod:(0,i.slot)()},a={liveUserDerivationMethod:(0,r.H)()}},21222:(e,t,s)=>{s.d(t,{I:()=>r});var i=s(30504);const r={getDarkWebInsightsReportResults:(0,i.slot)(),getDarkWebInsightsSummary:(0,i.slot)()}},30309:(e,t,s)=>{s.d(t,{Bm:()=>n,D7:()=>d,Sw:()=>g,Ww:()=>c,XM:()=>u,cH:()=>r,dJ:()=>o,gD:()=>l,iU:()=>a,mg:()=>h,pt:()=>m,s5:()=>p});var i=s(50415),r=function(e){return e.NO_TYPE="NO_TYPE",e.UNIVERSAL="UNIVERSAL",e.AD="AD",e.AE="AE",e.AF="AF",e.AG="AG",e.AI="AI",e.AL="AL",e.AM="AM",e.AO="AO",e.AR="AR",e.AS="AS",e.AT="AT",e.AU="AU",e.AW="AW",e.AZ="AZ",e.BA="BA",e.BB="BB",e.BD="BD",e.BE="BE",e.BF="BF",e.BG="BG",e.BH="BH",e.BI="BI",e.BJ="BJ",e.BL="BL",e.BM="BM",e.BN="BN",e.BO="BO",e.BR="BR",e.BS="BS",e.BT="BT",e.BW="BW",e.BY="BY",e.BZ="BZ",e.CA="CA",e.CD="CD",e.CF="CF",e.CG="CG",e.CH="CH",e.CI="CI",e.CK="CK",e.CL="CL",e.CM="CM",e.CN="CN",e.CO="CO",e.CR="CR",e.CU="CU",e.CV="CV",e.CY="CY",e.CZ="CZ",e.DE="DE",e.DJ="DJ",e.DK="DK",e.DM="DM",e.DO="DO",e.DZ="DZ",e.EC="EC",e.EE="EE",e.EG="EG",e.ER="ER",e.ES="ES",e.ET="ET",e.FI="FI",e.FJ="FJ",e.FK="FK",e.FM="FM",e.FO="FO",e.FR="FR",e.GA="GA",e.GB="GB",e.GD="GD",e.GE="GE",e.GF="GF",e.GG="GG",e.GH="GH",e.GI="GI",e.GL="GL",e.GM="GM",e.GN="GN",e.GP="GP",e.GQ="GQ",e.GR="GR",e.GT="GT",e.GU="GU",e.GW="GW",e.GY="GY",e.HK="HK",e.HN="HN",e.HR="HR",e.HT="HT",e.HU="HU",e.ID="ID",e.IE="IE",e.IL="IL",e.IM="IM",e.IN="IN",e.IO="IO",e.IQ="IQ",e.IR="IR",e.IS="IS",e.IT="IT",e.JE="JE",e.JM="JM",e.JO="JO",e.JP="JP",e.KE="KE",e.KG="KG",e.KH="KH",e.KI="KI",e.KM="KM",e.KN="KN",e.KP="KP",e.KR="KR",e.KW="KW",e.KY="KY",e.KZ="KZ",e.LA="LA",e.LB="LB",e.LC="LC",e.LI="LI",e.LK="LK",e.LR="LR",e.LS="LS",e.LT="LT",e.LU="LU",e.LV="LV",e.LY="LY",e.MA="MA",e.MC="MC",e.MD="MD",e.ME="ME",e.MF="MF",e.MG="MG",e.MH="MH",e.MK="MK",e.ML="ML",e.MM="MM",e.MN="MN",e.MO="MO",e.MP="MP",e.MQ="MQ",e.MR="MR",e.MS="MS",e.MT="MT",e.MU="MU",e.MV="MV",e.MW="MW",e.MX="MX",e.MY="MY",e.MZ="MZ",e.NA="NA",e.NC="NC",e.NE="NE",e.NF="NF",e.NG="NG",e.NI="NI",e.NL="NL",e.NO="NO",e.NP="NP",e.NR="NR",e.NU="NU",e.NZ="NZ",e.OM="OM",e.PA="PA",e.PE="PE",e.PF="PF",e.PG="PG",e.PH="PH",e.PK="PK",e.PL="PL",e.PM="PM",e.PR="PR",e.PS="PS",e.PT="PT",e.PW="PW",e.PY="PY",e.QA="QA",e.RE="RE",e.RO="RO",e.RS="RS",e.RU="RU",e.RW="RW",e.SA="SA",e.SB="SB",e.SC="SC",e.SD="SD",e.SE="SE",e.SG="SG",e.SH="SH",e.SI="SI",e.SK="SK",e.SL="SL",e.SM="SM",e.SN="SN",e.SO="SO",e.SR="SR",e.ST="ST",e.SV="SV",e.SY="SY",e.SZ="SZ",e.TC="TC",e.TD="TD",e.TF="TF",e.TG="TG",e.TH="TH",e.TJ="TJ",e.TK="TK",e.TL="TL",e.TM="TM",e.TN="TN",e.TO="TO",e.TR="TR",e.TT="TT",e.TV="TV",e.TW="TW",e.TZ="TZ",e.UA="UA",e.UG="UG",e.US="US",e.UY="UY",e.UZ="UZ",e.VA="VA",e.VC="VC",e.VE="VE",e.VG="VG",e.VI="VI",e.VN="VN",e.VU="VU",e.WF="WF",e.WS="WS",e.XK="XK",e.YE="YE",e.YT="YT",e.ZA="ZA",e.ZM="ZM",e.ZW="ZW",e.AQ="AQ",e.AX="AX",e.BV="BV",e.CC="CC",e.CX="CX",e.EH="EH",e.GS="GS",e.HM="HM",e.PN="PN",e.SJ="SJ",e.UM="UM",e}({});function n(e){return e.LocaleFormat}const o=(0,i.Enum)("KWAddress","KWAuthentifiant","KWBankStatement","KWCollection","KWCompany","KWDataChangeHistory","KWDriverLicence","KWEmail","KWFiscalStatement","KWGeneratedPassword","KWIDCard","KWIdentity","KWMerchand","KWMiscData","KWPasskey","KWPassport","KWPaymentMean_creditCard","KWPaymentMean_paypal","KWPersonalWebsite","KWPhone","KWPurchaseAccount","KWPurchaseCategory","KWPurchasePaidBasket","KWPurchaseTrueArticle","KWSecret","KWSecureFileInfo","KWSecureNote","KWSecurityBreach","KWSettingsManagerApp","KWSocialSecurityStatement","KWWebSite"),a=(0,i.Enum)("ADDRESS","AUTHENTIFIANT","BANKACCESS","BANKACCOUNT","BANKCATEGORY","BANKINSTITUTION","BANKSITE","BANKSTATEMENT","BANKTRANSACTION","COLLECTION","COMPANY","DATA_CHANGE_HISTORY","DATA_USAGE_HISTORY","DEFAULT_AUTHENTIFIANT","DEFAULT_CONFIDENTIAL","DEFAULT_IDENTITY","DEFAULT_MISC","DEFAULT_PAYMENTMEANS","DEFAULT_REWARDCARD","DRIVERLICENCE","EMAIL","EMERGENCY_BUNDLE_FULL","EMERGENCY_BUNDLE_LITE","FULLBACKUP","FISCALSTATEMENT","GENERATED_PASSWORD","IDCARD","IDENTITY","INVOICEACCESS","INVOICEELEMENT","INVOICEINSTITUTION","MERCHANT","MISCDATA","PASSKEY","PASSPORT","PAYMENTMEANS_CREDITCARD","PAYMENTMEAN_PAYPAL","PERSONALWEBSITE","PHONE","POINTS","PURCHASEABANDONNEDBASKET","PURCHASEACCOUNT","PURCHASEARTICLE","PURCHASEBASKET","PURCHASEDELIVERYARTICLE","PURCHASEOPTIONARTICLE","PURCHASEPAIDBASKET","PURCHASE_CATEGORY","REWARDCARD","SECRET","SECUREFILEINFO","SECURENOTE","SECURITYALERT","SECURITYALERTS","SECURITYBREACH","SETTINGS","SHARING_GROUP","SOCIALSECURITYSTATEMENT","WEBSITE"),c={KWAddress:a.ADDRESS,KWAuthentifiant:a.AUTHENTIFIANT,KWCollection:a.COLLECTION,KWBankStatement:a.BANKSTATEMENT,KWCompany:a.COMPANY,KWDataChangeHistory:a.DATA_CHANGE_HISTORY,KWDriverLicence:a.DRIVERLICENCE,KWEmail:a.EMAIL,KWFiscalStatement:a.FISCALSTATEMENT,KWGeneratedPassword:a.GENERATED_PASSWORD,KWIDCard:a.IDCARD,KWIdentity:a.IDENTITY,KWMerchand:a.MERCHANT,KWMiscData:a.MISCDATA,KWPasskey:a.PASSKEY,KWPassport:a.PASSPORT,KWPaymentMean_creditCard:a.PAYMENTMEANS_CREDITCARD,KWPaymentMean_paypal:a.PAYMENTMEAN_PAYPAL,KWPersonalWebsite:a.PERSONALWEBSITE,KWPhone:a.PHONE,KWPurchaseAccount:a.PURCHASEACCOUNT,KWPurchaseCategory:a.PURCHASE_CATEGORY,KWPurchasePaidBasket:a.PURCHASEPAIDBASKET,KWPurchaseTrueArticle:a.PURCHASEARTICLE,KWSecret:a.SECRET,KWSecureFileInfo:a.SECUREFILEINFO,KWSecureNote:a.SECURENOTE,KWSecurityBreach:a.SECURITYBREACH,KWSettingsManagerApp:a.SETTINGS,KWSocialSecurityStatement:a.SOCIALSECURITYSTATEMENT,KWWebSite:a.WEBSITE},d=Object.values(o).reduce(((e,t)=>(e[c[t]]=t,e)),{});function l(e){const t=d[e];if(!t)throw new Error(`No DataModelType found for TransactionType '${e}'`);return t}function u(e){if(!c[e])throw new Error(`No TransactionType found for DataModelType ${e}`);return c[e]}const p=i.Enum.keys(a),h=i.Enum.keys(o),g=e=>!!e.LocaleFormat&&"string"==typeof e.SpaceId;function m(e){return Boolean(e)&&("KWPhone"===e.kwType||"KWIdentity"===e.kwType||"KWAddress"===e.kwType||"KWBankStatement"===e.kwType)}},96500:(e,t,s)=>{function i(e){return Boolean(e)&&"KWAuthentifiant"===e.kwType}s.d(t,{G:()=>i})},95502:(e,t,s)=>{s.d(t,{k:()=>i});var i=function(e){return e.Manual="manual",e.Remember="remember",e}({})},69956:(e,t,s)=>{s.d(t,{Q:()=>i,g:()=>r});const i=["GRAY","PURPLE","GREEN","BLUE","YELLOW","ORANGE","PINK","BROWN","RED"];function r(e){return Boolean(e)&&"KWSecureNote"===e.kwType}},9519:(e,t,s)=>{s.d(t,{T5:()=>n,_u:()=>o,aG:()=>i,p3:()=>r});var i=function(e){return e[e.CloudPasskey=-65537]="CloudPasskey",e[e.ES256=-7]="ES256",e}({});function r(e){return Boolean(e)&&"KWPasskey"===e.kwType}function n(e){return r(e)&&-65537===e.KeyAlgorithm}function o(e){return r(e)&&-7===e.KeyAlgorithm}},12144:(e,t,s)=>{s.d(t,{HQ:()=>o,LR:()=>n,Vc:()=>r});var i=s(50415);const r=(0,i.Enum)("PAYMENT_TYPE_VISA","PAYMENT_TYPE_MASTERCARD","PAYMENT_TYPE_AMEX","PAYMENT_TYPE_DISCOVER","PAYMENT_TYPE_JCB","PAYMENT_TYPE_DINERSCLUB"),n=(0,i.Enum)("BLACK","SILVER","WHITE","RED","ORANGE","GOLD","BLUE_1","BLUE_2","GREEN_1","GREEN_2");function o(e){return Boolean(e)&&"KWPaymentMean_creditCard"===e.kwType}},90294:(e,t,s)=>{s.d(t,{M:()=>r,z:()=>i});const i=(0,s(50415).Enum)("PHONE_TYPE_ANY","PHONE_TYPE_MOBILE","PHONE_TYPE_LANDLINE","PHONE_TYPE_FAX","PHONE_TYPE_WORK_MOBILE","PHONE_TYPE_WORK_LANDLINE","PHONE_TYPE_WORK_FAX");function r(e){return Boolean(e)&&"KWPhone"===e.kwType}},47380:(e,t,s)=>{function i(e){return Boolean(e)&&"KWSecret"===e.kwType}s.d(t,{k:()=>i})},5725:(e,t,s)=>{s.d(t,{C:()=>r,n:()=>n});var i=s(30504);const r={getAnonymousComputerId:(0,i.slot)(),getPlatformInfo:(0,i.slot)()},n={cleanRemotelyRemovedProfiles:(0,i.slot)()}},42986:(e,t,s)=>{s.d(t,{D:()=>i});const i={deviceLimitCapabilityUpdated:(0,s(30504).slot)()}},11910:(e,t,s)=>{s.d(t,{z:()=>r});var i=s(30504);const r={carbonLoginStatusChanged:(0,i.slot)({noBuffer:!0}),localAccountsListUpdated:(0,i.slot)({noBuffer:!0}),openSessionProgressChanged:(0,i.slot)({noBuffer:!0}),openSessionTokenSent:(0,i.slot)({noBuffer:!0}),openSessionDashlaneAuthenticator:(0,i.slot)({noBuffer:!0}),openSessionOTPSent:(0,i.slot)({noBuffer:!0}),openSessionOTPForNewDeviceRequired:(0,i.slot)({noBuffer:!0}),openSessionAskMasterPassword:(0,i.slot)({noBuffer:!0}),openSessionTokenWarning:(0,i.slot)({noBuffer:!0}),openSessionExtraDeviceTokenRequired:(0,i.slot)({noBuffer:!0}),openSessionMasterPasswordLess:(0,i.slot)({noBuffer:!0}),openSessionSsoRedirectionToIdpRequired:(0,i.slot)({noBuffer:!0}),openSessionFailed:(0,i.slot)({noBuffer:!0}),sessionSyncStatus:(0,i.slot)({noBuffer:!0}),accountFeaturesChanged:(0,i.slot)({noBuffer:!0}),webOnboardingModeUpdated:(0,i.slot)({noBuffer:!0}),askWebsiteInfo:(0,i.slot)({noBuffer:!0}),getAccountInfo:(0,i.slot)({noBuffer:!0}),getAnonymousLogsMetadata:(0,i.slot)({noBuffer:!0}),checkIfMasterPasswordIsValid:(0,i.slot)({noBuffer:!0}),openSession:(0,i.slot)({noBuffer:!0}),openSessionWithToken:(0,i.slot)({noBuffer:!0}),openSessionWithDashlaneAuthenticator:(0,i.slot)({noBuffer:!0}),cancelDashlaneAuthenticatorRegistration:(0,i.slot)(),openSessionWithOTP:(0,i.slot)({noBuffer:!0}),openSessionWithOTPForNewDevice:(0,i.slot)({noBuffer:!0}),openSessionResendToken:(0,i.slot)({noBuffer:!0}),sessionForceSync:(0,i.slot)({noBuffer:!0}),closeSession:(0,i.slot)({noBuffer:!0}),lockSession:(0,i.slot)({noBuffer:!0}),exceptionLog:(0,i.slot)({noBuffer:!0}),getDevicesList:(0,i.slot)({noBuffer:!0}),getLocalAccountsList:(0,i.slot)({noBuffer:!0}),reloadExtension:(0,i.slot)({noBuffer:!0}),updateWebOnboardingMode:(0,i.slot)({noBuffer:!0})}},29224:(e,t,s)=>{s.d(t,{i:()=>r});var i=s(30504);const r={getFamilyDetails:(0,i.slot)(),joinFamily:(0,i.slot)(),leaveFamily:(0,i.slot)(),removeFamilyMember:(0,i.slot)(),resetFamilyJoinToken:(0,i.slot)()}},95405:(e,t,s)=>{s.d(t,{i:()=>r});var i=s(30504);const r={getHasFeature:(0,i.slot)(),getFeatures:(0,i.slot)()}},15314:(e,t,s)=>{s.d(t,{H9:()=>n,JQ:()=>o,YW:()=>a});var i=s(30504),r=s(83307);const n={decipherRemoteFile:(0,i.slot)()},o={getFileContent:(0,i.slot)()},a={liveFileMeta:(0,r.H)()}},50169:(e,t,s)=>{s.d(t,{a:()=>r});var i=s(30504);const r={setGlobalExtensionSettings:(0,i.slot)(),getGlobalExtensionSettings:(0,i.slot)()}},7073:(e,t,s)=>{s.d(t,{M:()=>i});const i={evaluatePassword:(0,s(30504).slot)()}},74725:(e,t,s)=>{s.d(t,{b:()=>o,c:()=>n});var i=s(30504),r=s(83307);const n={getIsBrazeContentDisabled:(0,i.slot)(),getIsLoginFlowMigrationDisabled:(0,i.slot)(),getIsAutoSSOLoginDisabled:(0,i.slot)(),getKillSwitch:(0,i.slot)()},o={liveIsBrazeContentDisabled:(0,r.H)(),liveIsLoginFlowMigrationDisabled:(0,r.H)(),liveIsAutoSSOLoginDisabled:(0,r.H)(),liveKillSwitch:(0,r.H)()}},72683:(e,t,s)=>{s.d(t,{N:()=>r});var i=s(30504);const r={abTestingChanged:(0,i.slot)(),carbonLoginStatusChanged:(0,i.slot)({noBuffer:!0}),openSessionProgressChanged:(0,i.slot)({noBuffer:!0}),openSessionTokenSent:(0,i.slot)({noBuffer:!0}),openSessionDashlaneAuthenticator:(0,i.slot)({noBuffer:!0}),openSessionOTPSent:(0,i.slot)({noBuffer:!0}),openSessionOTPForNewDeviceRequired:(0,i.slot)({noBuffer:!0}),openSessionAskMasterPassword:(0,i.slot)({noBuffer:!0}),openSessionTokenWarning:(0,i.slot)({noBuffer:!0}),openSessionExtraDeviceTokenRequired:(0,i.slot)({noBuffer:!0}),openSessionSsoRedirectionToIdpRequired:(0,i.slot)({noBuffer:!0}),openSessionMasterPasswordLess:(0,i.slot)({noBuffer:!0}),openSessionFailed:(0,i.slot)({noBuffer:!0}),sessionSyncStatus:(0,i.slot)({noBuffer:!0}),localAccountsListUpdated:(0,i.slot)(),spaceDataUpdated:(0,i.slot)(),teamAdminDataUpdated:(0,i.slot)(),accountFeaturesChanged:(0,i.slot)(),updatePaymentCardTokenResult:(0,i.slot)(),webOnboardingModeUpdated:(0,i.slot)(),currentLocationUpdated:(0,i.slot)(),checkDirectorySyncKeyRequest:(0,i.slot)(),serverSidePairingStatusChanged:(0,i.slot)(),ssoSolutionChanged:(0,i.slot)({noBuffer:!0}),getUki:(0,i.slot)(),getAccountInfo:(0,i.slot)(),getDevicesList:(0,i.slot)(),getLocalAccountsList:(0,i.slot)(),getInvoices:(0,i.slot)(),getPersonalSettings:(0,i.slot)(),openSession:(0,i.slot)({noBuffer:!0}),openSessionWithToken:(0,i.slot)({noBuffer:!0}),openSessionWithDashlaneAuthenticator:(0,i.slot)({noBuffer:!0}),cancelDashlaneAuthenticatorRegistration:(0,i.slot)(),openSessionWithOTP:(0,i.slot)({noBuffer:!0}),openSessionWithOTPForNewDevice:(0,i.slot)({noBuffer:!0}),openSessionResendToken:(0,i.slot)({noBuffer:!0}),sessionForceSync:(0,i.slot)(),closeSession:(0,i.slot)(),lockSession:(0,i.slot)({noBuffer:!0}),cancelPremiumSubscription:(0,i.slot)(),createUserGroup:(0,i.slot)(),deleteUserGroup:(0,i.slot)(),renameUserGroup:(0,i.slot)(),inviteUserGroupMembers:(0,i.slot)(),revokeUserGroupMembers:(0,i.slot)(),updateUserGroupMembers:(0,i.slot)(),teamUpdated:(0,i.slot)(),createAccountStep1:(0,i.slot)(),createAccountStep2:(0,i.slot)(),checkLogin:(0,i.slot)(),savePersonalDataItem:(0,i.slot)(),savePaymentCard:(0,i.slot)(),getMasterPasswordResetDemandList:(0,i.slot)(),acceptMasterPasswordResetDemand:(0,i.slot)(),checkIfMasterPasswordIsValid:(0,i.slot)(),declineMasterPasswordResetDemand:(0,i.slot)(),getMembers:(0,i.slot)(),addTeamAdmin:(0,i.slot)(),removeTeamAdmin:(0,i.slot)(),setTeamSettings:(0,i.slot)(),updateWebOnboardingMode:(0,i.slot)(),checkDirectorySyncKeyResponse:(0,i.slot)(),queryStaticDataCollections:(0,i.slot)(),resumeSession:(0,i.slot)(),exceptionLog:(0,i.slot)({noBuffer:!0})}},51592:(e,t,s)=>{s.d(t,{M:()=>i});var i=function(e){return e[e.LEAVE_SHARING_FAILED=0]="LEAVE_SHARING_FAILED",e[e.FORBIDDEN_LAST_ADMIN=1]="FORBIDDEN_LAST_ADMIN",e[e.FORBIDDEN_GROUP_ITEM=2]="FORBIDDEN_GROUP_ITEM",e[e.NOT_AUTHORIZED=3]="NOT_AUTHORIZED",e[e.NOT_FOUND=4]="NOT_FOUND",e[e.INTERNAL_ERROR=5]="INTERNAL_ERROR",e}({})},18064:(e,t,s)=>{s.d(t,{c:()=>r});var i=s(30504);const r={logEvent:(0,i.slot)(),logPageView:(0,i.slot)()}},97414:(e,t,s)=>{s.d(t,{e:()=>i});const i={logException:(0,s(30504).slot)()}},51263:(e,t,s)=>{s.d(t,{w:()=>i});var i=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.WARNING=1]="WARNING",e[e.ERROR=2]="ERROR",e}({})},42247:(e,t,s)=>{s.d(t,{x:()=>r});var i=s(30504);const r={abortDeviceLimitFlow:(0,i.slot)(),loginViaSSO:(0,i.slot)(),unlinkPreviousDevice:(0,i.slot)(),unlinkMultipleDevices:(0,i.slot)()}},68801:(e,t,s)=>{s.d(t,{Rj:()=>a,Xz:()=>o,_m:()=>n});var i=s(30504),r=s(83307);const n={addLoginNotification:(0,i.slot)(),clearAllStoredLoginNotification:(0,i.slot)()},o={getLoginNotifications:(0,i.slot)()},a={liveLoginNotifications:(0,r.H)()}},17065:(e,t,s)=>{s.d(t,{_1:()=>a,vq:()=>n,xP:()=>o});var i=s(30504),r=s(83307);const n={updateLoginStepInfo:(0,i.slot)(),resetLoginStepInfo:(0,i.slot)()},o={getLoginStepInfo:(0,i.slot)()},a={liveLoginStepInfo:(0,r.H)()}},86055:(e,t,s)=>{s.d(t,{I:()=>r});var i=s(30504);const r={savePersonalDataItem:(0,i.slot)(),filledDataItem:(0,i.slot)(),updateWebOnboardingMode:(0,i.slot)()}},41976:(e,t,s)=>{s.d(t,{Ie:()=>o,U$:()=>n,iX:()=>a});var i=s(30504),r=s(83307);const n={markNotificationAsInteracted:(0,i.slot)(),markNotificationAsSeen:(0,i.slot)(),markNotificationAsUnseen:(0,i.slot)()},o={getNotificationStatus:(0,i.slot)()},a={liveNotificationStatus:(0,r.H)()}},39442:(e,t,s)=>{s.d(t,{H:()=>n,s:()=>r});var i=s(50415);const r=(0,i.Enum)("SHOW_LOGIN_USING_EXTENSION_NOTIFICATION","SHOW_SAVE_SITES_DIALOG","SHOW_PASSWORD_SAVE_SUCCESS","SHOW_WEB_SAVE_AND_AUTOLOGIN_COMPLETED","SHOW_PASSWORD_IMPORT","SHOW_GET_MOBILE_DIALOG"),n=(0,i.Enum)("SHOW_LOGIN_NOTIFICATION")},56186:(e,t,s)=>{s.d(t,{s:()=>i});var i=function(e){return e.OneDeviceLimitReached="OneDeviceLimitReached",e.MultipleDevicesLimitReached="MultipleDevicesLimitReached",e.UnlinkingAndOpeningSession="UnlinkingAndOpeningSession",e.UnlinkingMultipleDevicesError="UnlinkingMultipleDevicesError",e.RefreshingDeviceLimitStatus="RefreshingDeviceLimitStatus",e.OpeningSessionAfterDeviceLimitRemoval="OpeningSessionAfterDeviceLimitRemoval",e.DeviceLimitDone="DeviceLimitDone",e}({})},34445:(e,t,s)=>{s.d(t,{dN:()=>r,fr:()=>i,xX:()=>n});var i=function(e){return e.EMAIL_TOKEN="email_token",e.DEVICE_REGISTRATION="totp_device_registration",e.LOGIN="totp_login",e.SSO="sso",e}({}),r=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.PENDING=1]="PENDING",e[e.ERROR=2]="ERROR",e[e.READY=3]="READY",e}({});const n=["login","newDevice"]},576:(e,t,s)=>{s.d(t,{of:()=>u,K1:()=>l,A2:()=>d});var i=s(30504),r=s(83307);const n={getLoginDeviceLimitFlow:(0,i.slot)()},o={liveLoginDeviceLimitFlow:(0,r.H)()},a={getTwoFactorAuthenticationInfo:(0,i.slot)()},c={liveTwoFactorAuthenticationInfo:(0,r.H)()},d={getLoginStatus:(0,i.slot)(),getLocalAccounts:(0,i.slot)(),getIsSSOUser:(0,i.slot)(),getSSOMigrationInfo:(0,i.slot)(),getSessionInfo:(0,i.slot)(),getMasterPasswordAndServerKey:(0,i.slot)(),getUserCryptoSettings:(0,i.slot)(),getSyncInfo:(0,i.slot)(),getIsSyncInProgress:(0,i.slot)(),getPremiumStatus:(0,i.slot)(),getNodePremiumStatus:(0,i.slot)(),getSubscriptionInformation:(0,i.slot)(),getActiveSpaces:(0,i.slot)(),getSSOProviderInfo:(0,i.slot)(),getUserLogin:(0,i.slot)(),getPublicUserId:(0,i.slot)(),getAnalyticsInstallationId:(0,i.slot)(),getUserLoginStatus:(0,i.slot)(),getWebOnboardingMode:(0,i.slot)(),getIsPaymentFailureChurningDismissed:(0,i.slot)(),getCredentialSearchOrder:(0,i.slot)(),getDidOpen:(0,i.slot)(),getPlatformName:(0,i.slot)(),getAccountAuthenticationType:(0,i.slot)(),...n,...a},l={liveLoginStatus:(0,r.H)(),liveDidOpen:(0,r.H)(),liveIsSSOUser:(0,r.H)(),liveSSOMigrationInfo:(0,r.H)(),liveSessionInfo:(0,r.H)(),liveSyncInfo:(0,r.H)(),liveIsSyncInProgress:(0,r.H)(),livePremiumStatus:(0,r.H)(),liveServiceProviderUrl:(0,r.H)(),liveWebOnboardingMode:(0,r.H)(),liveSubscriptionInformation:(0,r.H)(),...o,...c},u={validateToken:(0,i.slot)(),validateMasterPassword:(0,i.slot)(),resetProtectedItemAutofillTimer:(0,i.slot)(),forceSync:(0,i.slot)(),updatePremiumChurningDismissDate:(0,i.slot)(),setCredentialSearchOrder:(0,i.slot)(),refreshSubscriptionInformation:(0,i.slot)(),updateAccountRecoveryKeyPersonalSettings:(0,i.slot)()}},95255:(e,t,s)=>{s.d(t,{Io:()=>a,LT:()=>d,LW:()=>l,Mr:()=>n,_B:()=>o,a1:()=>c,aX:()=>m,fE:()=>h,g3:()=>u,lU:()=>i,rR:()=>p,vV:()=>r,vX:()=>g});var i=function(e){return e[e.NO_PREMIUM=0]="NO_PREMIUM",e[e.PREMIUM=1]="PREMIUM",e[e.PREMIUM_CANCELLED=2]="PREMIUM_CANCELLED",e[e.OLD_ACCOUNT=3]="OLD_ACCOUNT",e[e.NEW_USER=4]="NEW_USER",e[e.GRACE_PERIOD=5]="GRACE_PERIOD",e}({});const r=["adminPolicies","autofillWithPhishingPrevention","collectionSharing","creditMonitoring","dataLeak","devicesLimit","identityRestoration","identityTheftProtection","multipleAccounts","nudges","passwordsLimit","phoneSupport","riskDetection","secretManagement","secureFiles","secureNotes","secureWiFi","securityBreach","sharingLimit","scim","sso","sync","yubikey"],n=Object.freeze({freeTrialGranted:"free_trial_granted",premiumGranted:"premium_granted",renewed:"renewed",subscribed:"subscribed",crosssellPurchased:"crosssell_purchased",setAsLegacy:"set_as_legacy",familyCreated:"family_created",familyRenewed:"family_renewed"}),o=Object.freeze({Amazon:"amazon",FreeTrial:"free_trial",Invoice:"invoice",IOS:"ios",IOSRenewable:"ios_renewable",Legacy:"legacy",Mac:"mac",MacRenewable:"mac_renewable",Offer:"offer",Partner:"partner",Paypal:"paypal",PaypalRenewable:"paypal_renewable",Playstore:"playstore",PlaystoreRenewable:"playstore_renewable",Stripe:"stripe"}),a=["GROUP_CREATE","GROUP_DELETE","GROUP_EDIT","GROUP_READ"],c=["FULL","BILLING",...a];var d=function(e){return e[e.UNPAIRED=0]="UNPAIRED",e[e.PAIRED=1]="PAIRED",e}({}),l=function(e){return e.READY="ready",e.IN_PROGRESS="in_progress",e.SUCCESS="success",e.FAILURE="failure",e}({});const u=Object.freeze({Premium:"premium",Essentials:"essentials",Premiumplus:"premiumplus",BackupForAll:"backup-for-all"}),p=Object.freeze({Team:"team",Business:"business",Legacy:"legacy",Entreprise:"entreprise",Free:"free",Starter:"starter",Standard:"standard",BusinessPlus:"businessplus"});var h=function(e){return e.Accepted="accepted",e.Pending="pending",e.Proposed="proposed",e.Refused="refused",e.Removed="removed",e.Revoked="revoked",e.Unproposed="unproposed",e}({}),g=function(e){return e[e.MP_TO_SSO=0]="MP_TO_SSO",e[e.MP_TO_SSO_WITH_INFO=1]="MP_TO_SSO_WITH_INFO",e[e.SSO_TO_MP=2]="SSO_TO_MP",e}({}),m=function(e){return e.NAME="name",e.DATE="date",e}({})},31760:(e,t,s)=>{s.d(t,{H:()=>n,r:()=>r});var i=s(30504);const r={generatePassword:(0,i.slot)(),generateAndSavePassword:(0,i.slot)(),savePasswordGenerationSettings:(0,i.slot)()},n={getPasswordGenerationSettings:(0,i.slot)()}},65133:(e,t,s)=>{s.d(t,{P:()=>n,_:()=>r});var i=s(30504);const r={cancelAutoRenew:(0,i.slot)(),fetchInvoiceList:(0,i.slot)()},n={getInvoicesCount:(0,i.slot)(),getInvoiceList:(0,i.slot)(),getInvoiceListYears:(0,i.slot)()}},30195:(e,t,s)=>{s.d(t,{UW:()=>o,gQ:()=>n,qN:()=>a});var i=s(30504),r=s(83307);const n={disableCredentialProtection:(0,i.slot)(),unlockProtectedItems:(0,i.slot)()},o={vaultLockDate:(0,i.slot)()},a={liveVaultLockDate:(0,r.H)()}},8765:(e,t,s)=>{s.d(t,{$k:()=>n,EX:()=>a,q9:()=>o});var i=s(30504),r=s(83307);const n={activateAccountRecovery:(0,i.slot)(),setupMasterPasswordForRecovery:(0,i.slot)(),deactivateAccountRecovery:(0,i.slot)(),registerDeviceForRecovery:(0,i.slot)(),startAccountRecovery:(0,i.slot)(),sendRecoveryRequest:(0,i.slot)(),cancelRecoveryRequest:(0,i.slot)(),checkRecoveryRequestStatus:(0,i.slot)(),recoverUserData:(0,i.slot)(),checkDoesLocalRecoveryKeyExist:(0,i.slot)(),isRecoveryRequestPending:(0,i.slot)()},o={getRecoveryOptInSetting:(0,i.slot)(),getAccountRecoveryRequestCount:(0,i.slot)()},a={liveAccountRecoveryRequestCount:(0,r.H)()}},17476:(e,t,s)=>{s.d(t,{LL:()=>n,Ou:()=>l,Up:()=>i,Zz:()=>d,bW:()=>a,ev:()=>c,ou:()=>r,yB:()=>o});var i=function(e){return e.MANUAL="MANUAL",e.MAV_DATACAPTURE="MAV_DATACAPTURE",e.MAV_SAVE_CREDENTIAL="MAV_SAVE_CREDENTIAL",e.IMPORT="IMPORT",e}({});function r(e){return["KWCompany","KWEmail","KWPersonalWebsite","KWIdentity","KWAddress","KWPhone"].some((t=>Boolean(e)&&e.kwType===t))}function n(e){return Boolean(e)&&"KWIdentity"===e.kwType}function o(e){return Boolean(e)&&"KWPhone"===e.kwType}function a(e){return Boolean(e)&&"KWAddress"===e.kwType}function c(e){return Boolean(e)&&"KWCompany"===e.kwType}function d(e){return Boolean(e)&&"KWEmail"===e.kwType}function l(e){return Boolean(e)&&"KWPersonalWebsite"===e.kwType}},6535:(e,t,s)=>{s.d(t,{Ll:()=>o,i1:()=>n,uG:()=>a});var i=s(30504),r=s(83307);const n={getAllSharedItemIds:(0,i.slot)(),getMyAcceptedUserGroups:(0,i.slot)(),getSharingCapacity:(0,i.slot)(),getUserGroups:(0,i.slot)(),getUserGroup:(0,i.slot)(),getUserGroupMembers:(0,i.slot)(),getSharingUsers:(0,i.slot)(),getSharingUserPermissionLevel:(0,i.slot)()},o={liveAllSharedItemIds:(0,r.H)(),liveMyAcceptedUserGroups:(0,r.H)(),liveSharingCapacity:(0,r.H)(),liveUserGroups:(0,r.H)(),liveSharingUsers:(0,r.H)(),liveSharingUserPermissionLevel:(0,r.H)()},a={convertItemToDashlaneXml:(0,i.slot)(),convertDashlaneXmlToItem:(0,i.slot)(),saveSharedItemsToVault:(0,i.slot)()}},20194:(e,t,s)=>{s.d(t,{Q:()=>r});var i=s(30504);const r={getAllBanks:(0,i.slot)(),getAllCallingCodes:(0,i.slot)(),getBanks:(0,i.slot)(),getSecureDocumentsExtensionsList:(0,i.slot)()}},26332:(e,t,s)=>{s.d(t,{N:()=>r,b:()=>n});var i=s(30504);const r={getIsRecoveryEnabled:(0,i.slot)()},n={getTeamInfo:(0,i.slot)(),computePlanPricing:(0,i.slot)()}},54591:(e,t,s)=>{s.d(t,{h:()=>i});var i=function(e){return e.SSO_CONNECTOR="sso_connector",e.ENCRYPTION_SERVICE="encryption_service",e.NITRO="nitro_encryption_service",e}({})},38026:(e,t,s)=>{s.d(t,{XJ:()=>n,dN:()=>o,hO:()=>a});var i=s(30504),r=s(83307);const n={getAdministrableUserGroup:(0,i.slot)(),getAdministrableUserGroups:(0,i.slot)(),isGroupNameAvailable:(0,i.slot)(),getAdminProvisioningKey:(0,i.slot)(),getMassDeploymentTeamKey:(0,i.slot)()},o={liveAdministrableUserGroup:(0,r.H)(),liveAdministrableUserGroups:(0,r.H)(),liveAdminProvisioningKey:(0,r.H)(),liveMassDeploymentTeamKey:(0,r.H)()},a={registerTeamDomain:(0,i.slot)(),completeTeamDomainRegistration:(0,i.slot)(),deactivateTeamDomain:(0,i.slot)(),getTeamDomains:(0,i.slot)(),getTeamDevice:(0,i.slot)(),listTeamDevices:(0,i.slot)(),deactivateTeamDevice:(0,i.slot)(),registerTeamDevice:(0,i.slot)(),registerTeamDeviceAccount:(0,i.slot)(),getEncryptionServiceConfig:(0,i.slot)(),generateAndSaveEncryptionServiceConfig:(0,i.slot)(),clearSelfHostedESSettings:(0,i.slot)(),getTeamDeviceEncryptedConfig:(0,i.slot)(),updateTeamDeviceEncryptedConfig:(0,i.slot)(),updateTeamSettings:(0,i.slot)(),parseMetadataFields:(0,i.slot)(),persistAdminProvisioningKey:(0,i.slot)(),persistMassDeploymentTeamKey:(0,i.slot)(),removeAdminProvisioningKey:(0,i.slot)(),createSSOConnectorConfig:(0,i.slot)(),generateSSOConnectorKey:(0,i.slot)(),getRecoveryCodesAsTeamCaptain:(0,i.slot)(),createInviteLink:(0,i.slot)(),changeInviteLinkTeamKey:(0,i.slot)(),toggleInviteLink:(0,i.slot)(),getInviteLink:(0,i.slot)(),requestInviteLinkToken:(0,i.slot)(),getInviteLinkForAdmin:(0,i.slot)(),getLastADSyncDate:(0,i.slot)(),getSpecialUserGroupInviteValuesForMemberInTeam:(0,i.slot)(),getSpecialUserGroupRevision:(0,i.slot)()}},8186:(e,t,s)=>{s.d(t,{Kr:()=>a,Vz:()=>n,kh:()=>o});var i=s(30504),r=s(83307);const n={getVisibleUserMessages:(0,i.slot)(),getUserMessages:(0,i.slot)()},o={liveUserMessages:(0,r.H)(),liveVisibleUserMessages:(0,r.H)()},a={dismissUserMessages:(0,i.slot)(),addUserMessage:(0,i.slot)()}},53850:(e,t,s)=>{s.d(t,{T4:()=>n,fD:()=>o,lp:()=>a});var i=s(30504),r=s(83307);const n={getVpnAccount:(0,i.slot)(),getVpnCapabilitySetting:(0,i.slot)()},o={liveVpnAccount:(0,r.H)()},a={activateVpnAccount:(0,i.slot)(),clearVpnAccountErrors:(0,i.slot)(),completeVpnAccountActivation:(0,i.slot)()}},14676:(e,t,s)=>{s.d(t,{W:()=>a});var i=s(75958),r=s(23063),n=s(40923),o=s(55228);const a=(0,i.Q)({name:"carbon-legacy",commands:r.CN,queries:o.o$,events:n.U3})},14122:(e,t,s)=>{s.d(t,{_:()=>n});var i=s(8260),r=s(14676);class n extends((0,i.E)(r.W)){}(0,i.K)(r.W,n)},23063:(e,t,s)=>{s.d(t,{CN:()=>u,Cc:()=>d,Ec:()=>a,wF:()=>l,y9:()=>c});var i=s(13385),r=s(62149),n=s(68804),o=s(92541);class a extends((0,i.A)({scope:r.F.Device})){}class c extends((0,i.A)({scope:r.F.Device})){}class d extends((0,i.g)({scope:r.F.Device})){}const l=(0,n.k)(o.z),u={...l,CarbonCommand:a,CarbonLegacyLeelooCommand:c,MitigationDeleteGrapheneUserDataCommand:d}},40923:(e,t,s)=>{s.d(t,{Dj:()=>o,E1:()=>a,Pe:()=>n,U3:()=>c});var i=s(446),r=s(62149);class n extends((0,i.d)({scope:r.F.Device})){}class o extends((0,i.d)({scope:r.F.Device})){}class a extends((0,i.d)({scope:r.F.Device})){}const c={CarbonCommandResultEvent:n,CarbonLegacyEvent:o,CarbonLegacyDeviceRemotelyDeleted:a}},55228:(e,t,s)=>{s.d(t,{QX:()=>c,Zh:()=>d,o$:()=>u,r$:()=>l});var i=s(77535),r=s(62149),n=s(68804),o=s(41571),a=s(66410);class c extends((0,i.k)({scope:r.F.Device,useCache:!0})){}class d extends((0,i.k)({scope:r.F.Device,useCache:!0})){}const l=(0,n.p)(a.r,o.z),u={...l,CarbonStateQuery:c,CarbonStateListQuery:d}},68804:(e,t,s)=>{s.d(t,{k:()=>o,p:()=>a});var i=s(13385),r=s(62149),n=s(77535);function o(e){return Object.keys(e).reduce(((e,t)=>({...e,[`${t[0].toUpperCase().concat(t.substring(1))}Command`]:(0,i.A)({scope:r.F.Device})})),{})}function a(e,t){const s=Object.keys(e),i=Object.keys(t),o=(e,t)=>[e,(0,n.k)({scope:r.F.Device,useCache:t})];return[...s.map((e=>o(e))),...i.map((e=>o(e,!0)))].reduce(((e,[t,s])=>({...e,[`${t[0].toUpperCase().concat(t.substring(1))}Query`]:s})),{})}},17018:(e,t,s)=>{s.d(t,{k:()=>a,lN:()=>n,o7:()=>o});var i=s(30504),r=s(83307);const n={getBreach:(0,i.slot)(),getBreaches:(0,i.slot)(),getBreachesPage:(0,i.slot)(),getBreachesPaginationToken:(0,i.slot)(),getBreachesUpdateStatus:(0,i.slot)()},o={liveBreach:(0,r.H)(),liveBreaches:(0,r.H)(),liveBreachesBatch:(0,r.H)(),liveBreachesUpdaterStatus:(0,r.H)()},a={updateBreachStatus:(0,i.slot)()}},15845:(e,t,s)=>{s.d(t,{X:()=>r});var i=s(30504);const r={addCollection:(0,i.slot)(),deleteCollection:(0,i.slot)(),removeItemsFromCollections:(0,i.slot)(),updateCollection:(0,i.slot)()}},73561:(e,t,s)=>{s.d(t,{Nv:()=>n,bK:()=>o,ml:()=>a});var i=s(30504),r=s(83307);const n={addCredential:(0,i.slot)(),updateCredential:(0,i.slot)(),updateLinkedWebsites:(0,i.slot)()},o={getCredential:(0,i.slot)(),getCredentials:(0,i.slot)(),getCredentialsByDomain:(0,i.slot)(),getCredentialsCount:(0,i.slot)(),getCredentialsPage:(0,i.slot)(),getCredentialsPaginationToken:(0,i.slot)(),getDashlaneDefinedLinkedWebsites:(0,i.slot)(),getShouldShowRequireMasterPassword:(0,i.slot)()},a={liveCredential:(0,r.H)(),liveCredentials:(0,r.H)(),liveCredentialsByDomain:(0,r.H)(),liveCredentialsBatch:(0,r.H)(),liveCredentialsCount:(0,r.H)()}},59299:(e,t,s)=>{s.d(t,{h:()=>i});const i={duplicateVaultItem:(0,s(30504).slot)()}},85940:(e,t,s)=>{s.d(t,{h:()=>r,z:()=>n});var i=s(30504);const r={getIsForcedDomainsEnabled:(0,i.slot)()},n={getPersonalDataExport:(0,i.slot)()}},8082:(e,t,s)=>{s.d(t,{Ob:()=>a,Rm:()=>n,nM:()=>o});var i=s(30504),r=s(83307);const n={getGeneratedPassword:(0,i.slot)(),getGeneratedPasswordsCount:(0,i.slot)(),getGeneratedPasswords:(0,i.slot)(),getGeneratedPasswordsPage:(0,i.slot)(),getGeneratedPasswordsPaginationToken:(0,i.slot)()},o={liveGeneratedPasswordsCount:(0,r.H)(),liveGeneratedPasswords:(0,r.H)()},a={saveGeneratedPassword:(0,i.slot)()}},8393:(e,t,s)=>{s.d(t,{M:()=>r});var i=s(30504);const r={addDriverLicense:(0,i.slot)(),editDriverLicense:(0,i.slot)()}},71044:(e,t,s)=>{s.d(t,{v:()=>r});var i=s(30504);const r={addFiscalId:(0,i.slot)(),editFiscalId:(0,i.slot)()}},92490:(e,t,s)=>{s.d(t,{S:()=>r});var i=s(30504);const r={addIdCard:(0,i.slot)(),editIdCard:(0,i.slot)()}},35058:(e,t,s)=>{s.d(t,{H:()=>r});var i=s(30504);const r={addPassport:(0,i.slot)(),editPassport:(0,i.slot)()}},16251:(e,t,s)=>{s.d(t,{i:()=>d});var i=s(30504),r=s(71044),n=s(8393),o=s(92490),a=s(35058),c=s(42297);const d=(0,i.combineEvents)(n.M,r.v,o.S,a.H,c.w)},42297:(e,t,s)=>{s.d(t,{w:()=>r});var i=s(30504);const r={addSocialSecurityId:(0,i.slot)(),editSocialSecurityId:(0,i.slot)()}},10799:(e,t,s)=>{s.d(t,{Qf:()=>o,WZ:()=>n,rW:()=>a});var i=s(30504),r=s(83307);const n={getImportPersonalDataStatus:(0,i.slot)()},o={liveImportPersonalDataStatus:(0,r.H)()},a={importPersonalData:(0,i.slot)(),previewPersonalData:(0,i.slot)(),dismissPersonalDataImportNotifications:(0,i.slot)()}},12642:(e,t,s)=>{s.d(t,{Ks:()=>a,T2:()=>n,zX:()=>o});var i=s(30504),r=s(83307);const n={getPasskey:(0,i.slot)(),getPasskeys:(0,i.slot)(),getPasskeysForDomain:(0,i.slot)()},o={livePasskey:(0,r.H)(),livePasskeys:(0,r.H)()},a={addPasskey:(0,i.slot)(),updatePasskey:(0,i.slot)()}},87815:(e,t,s)=>{s.d(t,{_:()=>o,m:()=>n});var i=s(30504),r=s(83307);const n={getHasPasswordHistory:(0,i.slot)(),getPasswordHistoryPage:(0,i.slot)(),getPasswordHistoryPaginationToken:(0,i.slot)()},o={livePasswordHistoryBatch:(0,r.H)()}},34202:(e,t,s)=>{s.d(t,{gM:()=>n,iT:()=>a,sJ:()=>o});var i=s(30504),r=s(83307);const n={getPaymentCard:(0,i.slot)(),getPaymentCards:(0,i.slot)()},o={livePaymentCard:(0,r.H)(),livePaymentCards:(0,r.H)()},a={addPaymentCard:(0,i.slot)(),updatePaymentCard:(0,i.slot)()}},96988:(e,t,s)=>{s.d(t,{W:()=>i});const i={liveSecrets:(0,s(83307).H)()}},44532:(e,t,s)=>{s.d(t,{JX:()=>o,Wk:()=>a,q:()=>n});var i=s(30504),r=s(83307);const n={getFileUploadProgress:(0,i.slot)()},o={liveFileUploadProgress:(0,r.H)()},a={addSecureFile:(0,i.slot)(),validateSecureFile:(0,i.slot)(),commitSecureFile:(0,i.slot)(),clearSecureFileState:(0,i.slot)()}},79009:(e,t,s)=>{s.d(t,{F:()=>o,j:()=>n});var i=s(30504),r=s(83307);const n={getNote:(0,i.slot)(),getNotes:(0,i.slot)(),getNotesPage:(0,i.slot)(),getNotesPaginationToken:(0,i.slot)()},o={liveNote:(0,r.H)(),liveNotes:(0,r.H)()}},15662:(e,t,s)=>{s.d(t,{dF:()=>a,k3:()=>o,nD:()=>n});var i=s(30504),r=s(83307);const n={getAnonymousUserId:(0,i.slot)(),getIsUrlBanished:(0,i.slot)(),arePasswordsProtected:(0,i.slot)(),areRichIconsEnabled:(0,i.slot)()},o={liveArePasswordsProtected:(0,r.H)(),liveAreRichIconsEnabled:(0,r.H)()},a={toggleDashlane:(0,i.slot)(),updateProtectPasswordsSetting:(0,i.slot)(),updateAutofillSettings:(0,i.slot)(),updateRichIconsSetting:(0,i.slot)()}},13310:(e,t,s)=>{s.d(t,{QX:()=>A,fv:()=>f,pz:()=>I});var i=s(30504),r=s(59299),n=s(17018),o=s(73561),a=s(85940),c=s(8082),d=s(10799),l=s(79009),u=s(12642),p=s(87815),h=s(34202),g=s(44532),m=s(15662),v=s(64785),y=s(16036),S=s(96988),w=s(15845),E=s(16251);const I=(0,i.combineEvents)(n.lN,o.bK,a.h,c.Rm,d.WZ,l.j,u.T2,p.m,h.gM,g.q,m.nD,v.c,y.P),A=(0,i.combineEvents)(n.o7,o.ml,c.nM,d.Qf,l.F,u.zX,p._,h.sJ,S.W,g.JX,m.k3),f=(0,i.combineEvents)(n.k,w.X,o.Nv,a.z,c.Ob,E.i,d.rW,u.Ks,h.iT,g.Wk,m.dF,y.e,r.h)},64785:(e,t,s)=>{s.d(t,{c:()=>r});var i=s(30504);const r={getSpace:(0,i.slot)(),getSpaces:(0,i.slot)()}},51424:(e,t,s)=>{s.d(t,{MS:()=>i,kY:()=>n,zC:()=>r});var i=function(e){return e[e.CannotDisable=0]="CannotDisable",e[e.DisableSpecificVaultItem=1]="DisableSpecificVaultItem",e[e.DisableGeneralSetting=2]="DisableGeneralSetting",e}({});const r=Object.freeze({NOT_FOUND:"NOT_FOUND"}),n={KWAddress:"addresses",KWAuthentifiant:"credentials",KWBankStatement:"bankAccounts",KWCollection:"collections",KWCompany:"companies",KWDataChangeHistory:"changeHistories",KWDriverLicence:"driverLicenses",KWEmail:"emails",KWFiscalStatement:"fiscalIds",KWGeneratedPassword:"generatedPasswords",KWIDCard:"idCards",KWIdentity:"identities",KWPasskey:"passkeys",KWPassport:"passports",KWPaymentMean_creditCard:"paymentCards",KWPaymentMean_paypal:"paypalAccounts",KWPersonalWebsite:"personalWebsites",KWPhone:"phones",KWSecureNote:"notes",KWSecurityBreach:"securityBreaches",KWSocialSecurityStatement:"socialSecurityIds",KWSecureFileInfo:"secureFileInfo",KWSecret:"secrets"}},16036:(e,t,s)=>{s.d(t,{P:()=>r,e:()=>n});var i=s(30504);const r={},n={deleteVaultModuleItem:(0,i.slot)(),deleteVaultModuleItemsBulk:(0,i.slot)(),disableVaultItemProtection:(0,i.slot)()}},45127:(e,t,s)=>{s.r(t),s.d(t,{AbortDeviceLimitFlowError:()=>Et,AccountCreationCode:()=>jt,AddIdResultErrorCode:()=>oe,ApiAuditLogsErrorType:()=>Ht,ApplicationBuildType:()=>st.P,AuthenticationCode:()=>f._V,AutofillOptions:()=>U,B2CPlanFeatures:()=>St.g3,BreachLeakedDataType:()=>q,BreachStatus:()=>ds,BreachesUpdaterStatus:()=>H,CapabilityKeys:()=>St.vV,CarbonApiConnector:()=>d.X,CarbonCommand:()=>Vs.Ec,CarbonCommandResultEvent:()=>js.Pe,CarbonDebugConnector:()=>g.o,CarbonLeelooConnector:()=>u.N,CarbonLegacyClient:()=>zs._,CarbonLegacyDeviceRemotelyDeleted:()=>js.E1,CarbonLegacyEvent:()=>js.Dj,CarbonLegacyLeelooCommand:()=>Vs.y9,CarbonMaverickConnector:()=>h.I,CarbonStateListQuery:()=>Ms.Zh,CarbonStateQuery:()=>Ms.QX,ChangeMPFlowPath:()=>x.pT,ChangeMasterPasswordCode:()=>x.Ud,ChangeMasterPasswordStepNeeded:()=>x.FD,ComputePlanPricingErrorType:()=>Wt,Country:()=>ps.cH,CredentialLimitStatus:()=>$,CredentialSearchOrder:()=>St.aX,CryptoMigrationApiErrorType:()=>k,DATAMODELOBJECT_TYPE_TO_CARBON_STORE_KEY:()=>Ne.kY,DATAMODEL_TYPE_TO_TRANSACTION_TYPE:()=>ps.Ww,DarkWebInsightsApiErrorType:()=>j,DarkWebInsightsBreachType:()=>V,DataModelType:()=>ps.dJ,DeletePasskeyErrorCode:()=>Re,DeletePaymentCardErrorCode:()=>Pe,DeleteSecretErrorCode:()=>ye,DeleteSecureNoteErrorCode:()=>fe,DeviceLimitCapabilityConnector:()=>ke.D,DisableCredentialProtectionStatus:()=>Lt,DisableWebAuthnAuthenticationError:()=>F.Ok,DomainStatus:()=>Xt,DomainStatusResponses:()=>$t,ENFORCE_TWO_FACTOR_AUTHENTICATION_ENABLED_VALUES:()=>Rt.xX,EditContactInfoErrorCode:()=>w,EmailIncidentViewStatuses:()=>W,EmailTokenApiError:()=>f.Yp,EnableWebAuthnAuthenticationError:()=>F.dc,EncryptionServiceRestartStatusCodes:()=>Zt,ExceptionCriticality:()=>ot.w,ExtensionCarbonConnector:()=>l.z,ExtensionDebugConnector:()=>v,ExtensionDebugEventType:()=>y,FILE_NOT_FOUND_HTTP_STATUS:()=>Ye,FILE_NOT_UPDATED:()=>Qe,FamilyMemberRoles:()=>Ve,FamilyRenewalPlatform:()=>We,FamilyStatusCode:()=>je,FileNamesList:()=>Ze,FileUploadStatus:()=>Ee,GeographicStateLevel:()=>ns,GetAuditLogQueryResultsStates:()=>Yt,GetPersonalDataExportErrorMessage:()=>Z,GetRecoveryCodesAsTeamCaptainErrorCode:()=>es,IDPMetadataParseErrors:()=>ss,IDPXmlParseErrors:()=>ts,IdErrorCode:()=>ne,ImportFormats:()=>ue,ImportPersonalDataErrorType:()=>pe,ImportPersonalDataStateType:()=>he,ImportSource:()=>le,InitEnableWebAuthnAuthenticationError:()=>F.Pb,InitOpenSessionWithWebAuthnAuthenticatorError:()=>F.bL,InitRegisterWebAuthnAuthenticatorError:()=>F.fl,InitUserVerificationWithWebAuthnError:()=>F.tv,InviteLinkResponseErrorCode:()=>Jt,JoinFamilyUserStatus:()=>Me,LEGACY_CARBON_LEELOO_USED_COMMANDS:()=>Ws,LinkedWebsiteSource:()=>Is.k,LoggingEventType:()=>r,LoginDeviceLimitFlowStage:()=>bt.s,LoginNotificationType:()=>ut,LoginResultEnum:()=>ct,LoginStep:()=>gt,LoginViaSsoCode:()=>lt,MitigationDeleteGrapheneUserDataCommand:()=>Vs.Cc,NO_CURRENT_UPDATE_HTTP_STATUS:()=>He,NoteTypes:()=>As.Q,NotificationName:()=>mt,NotificationStatus:()=>vt,OpenSessionWithWebAuthnAuthenticatorError:()=>F.vW,OrderDir:()=>Ft,OtpType:()=>f.mE,PasswordHistoryItemType:()=>_e,PaymentCardColor:()=>Cs.LR,PaymentCardSaveResultErrorCode:()=>Fe,PaymentCardType:()=>Cs.Vc,PersistData:()=>f.jP,PhoneType:()=>_s.z,PlanTypes:()=>St._B,Platform:()=>Ot,PlatformView:()=>Ct,PremiumLogTypes:()=>St.Mr,PremiumStatusCode:()=>St.lU,PreviewPersonalDataErrorType:()=>ge,ReactivationStatus:()=>f._g,RecoveryApiErrorType:()=>Gt,RefreshAvailableWebAuthnAuthenticatorsError:()=>F.M2,RefreshContactInfoErrorCode:()=>E,RefreshU2FErrorCode:()=>C,RefreshWebAuthnAuthenticatorsError:()=>F.Rr,RegisterWebAuthnAuthenticatorError:()=>F.Oq,RemovePersonalDataItemFailureReason:()=>p.M,RemoveU2FAuthenticatorError:()=>O,RemoveWebAuthnAuthenticatorError:()=>F.O6,RequestStatus:()=>kt,RequestTOTPActivationError:()=>_,SERVER_ERROR_HTTP_STATUS:()=>Xe,SSOMigrationType:()=>St.vX,SaveOrigin:()=>Us.Up,SecureFileResultErrorCode:()=>we,SecureNoteSaveResultErrorCode:()=>Ae,ServerSidePairingStatus:()=>St.LT,SpaceStatus:()=>St.fE,SpaceTiers:()=>St.rR,SsoMigrationServerMethod:()=>dt,StaticDataQueryType:()=>rs,StyxApiResult:()=>rt,SupportedDerivationMethods:()=>K,SupportedVaultTypes:()=>de,SyncStatuses:()=>St.LW,TRANSACTION_TYPE_TO_DATAMODEL_TYPE:()=>ps.D7,TeamDeviceEncryptedConfigNotFound:()=>zt,TeamDevicePlatform:()=>Qt.h,TeamMemberSSOStatuses:()=>qt,TransactionType:()=>ps.iU,TwoFactorAuthenticationDisableStages:()=>T,TwoFactorAuthenticationEnableStages:()=>R,TwoFactorAuthenticationInfoRequestStatus:()=>Rt.dN,TwoFactorAuthenticationType:()=>Rt.fr,UNEXPECTED_ERROR:()=>At,UNSPECIFIED_ERROR:()=>$e,UPDATE_AVAILABLE_HTTP_STATUS:()=>qe,USER_STILL_OVERFLOWING:()=>It,UnknownTeamAdminError:()=>Bt,UnlinkPreviousDeviceError:()=>ft,UnlockProtectedItemsStatus:()=>Ut,UpdateIdResultErrorCode:()=>ae,UpdateLinkedWebsitesError:()=>me,UserMessageTypes:()=>Ns,UserVerificationMethods:()=>f.WQ,VaultItemDisableProtectionMode:()=>Ne.MS,VpnAccountActivationErrorType:()=>Gs,VpnAccountStatusType:()=>xs,VpnDisabledReason:()=>ks,WebAuthnCallTypes:()=>F.vz,WebAuthnKeyAlgorithm:()=>fs.aG,WebOnboardingLeelooStep:()=>Tt.s,WebOnboardingPopoverStep:()=>Tt.H,abTestsCommandsSlots:()=>Mt.td,abTestsLiveQueriesSlots:()=>Mt.KV,abTestsQueriesSlots:()=>Mt.co,antiPhishingLiveQueriesSlots:()=>I.f,authenticationCommandsSlots:()=>A.zR,authenticationLiveQueriesSlots:()=>A.QR,authenticationQueriesSlots:()=>A.ke,autofillDataQueriesSlots:()=>P.c,breachesCommandsSlots:()=>z.k,breachesLiveQueriesSlots:()=>z.o7,breachesQueriesSlots:()=>z.lN,carbonCommandsSlots:()=>o.z,carbonLegacyApi:()=>Bs.W,carbonLiveQueriesSlots:()=>a.z,carbonQueriesSlots:()=>c.r,changeMasterPasswordCommandsSlots:()=>L.v,changeMasterPasswordLiveQueriesSlots:()=>L.F,collectionsCommandsSlots:()=>Y.X,commands:()=>Vs.CN,commandsFromCarbonAPI:()=>Vs.wF,contactInfoCommandsSlots:()=>S.PO,contactInfoLiveQueriesSlots:()=>S.cN,contactInfoQueriesSlots:()=>S.PG,credentialsCommandsSlots:()=>Q.Nv,credentialsLiveQueriesSlots:()=>Q.ml,credentialsQueriesSlots:()=>Q.bK,cryptoMigrationCommandsSlots:()=>G.rU,cryptoMigrationLiveQueriesSlots:()=>G.vF,cryptoMigrationQueriesSlots:()=>G.kQ,darkWebInsightsCommandsSlots:()=>M.I,dataManagementCommandsSlots:()=>B.fv,dataManagementLiveQueriesSlots:()=>B.QX,dataManagementQueriesSlots:()=>B.pz,dataModelTypes:()=>ps.mg,deleteVaultModuleItemFailureReason:()=>Ne.zC,deviceCommandsSlots:()=>Ge.n,deviceQueriesSlots:()=>Ge.C,driverLicensesCommandsSlots:()=>ee.M,duplicationCommandsSlots:()=>xe.h,eventLoggerCommandsSlots:()=>it.c,events:()=>js.U3,exceptionCommandsSlots:()=>nt.e,exportCommandsSlots:()=>X.z,exportQueriesSlots:()=>X.h,familyCommandsSlots:()=>Ke.i,featureQueriesSlots:()=>Be.i,fiscalsIdCommandsSlots:()=>te.v,generatedPasswordsCommandsSlots:()=>Ue.Ob,generatedPasswordsLiveQueriesSlots:()=>Ue.nM,generatedPasswordsQueriesSlots:()=>Ue.Rm,getDataModelTypeFromTransactionType:()=>ps.gD,getLocalFormat:()=>ps.Bm,getTransactionTypeFromDataModelType:()=>ps.XM,globalExtensionSettingsCommandsSlots:()=>Je.a,groupPermissions:()=>St.Io,healthCommandsSlots:()=>et.M,idCardsCommandsSlots:()=>se.S,idsCommandsSlots:()=>J.i,importCommandsSlots:()=>ce.rW,importLiveQueriesSlots:()=>ce.Qf,importQueriesSlots:()=>ce.WZ,isAddress:()=>as,isBankAccount:()=>cs,isBreach:()=>ls,isCloudPasskey:()=>fs.T5,isCollection:()=>us,isCompany:()=>hs,isCredential:()=>gs.G,isDataModelObject:()=>ps.Sw,isDriverLicense:()=>ms,isEmail:()=>vs,isFiscalId:()=>ys,isGeneratedPassword:()=>Ss,isIdCard:()=>ws,isIdentity:()=>Es,isLegacyPasskey:()=>fs._u,isNote:()=>As.g,isObjectLocalized:()=>ps.pt,isPIAddressEvent:()=>Us.bW,isPICompanyEvent:()=>Us.ev,isPIEmailEvent:()=>Us.Zz,isPIIdentityEvent:()=>Us.LL,isPIPersonalWebsiteEvent:()=>Us.Ou,isPIPhoneEvent:()=>Us.yB,isPasskey:()=>fs.p3,isPassport:()=>bs,isPaymentCard:()=>Cs.HQ,isPaypalAccount:()=>Os,isPersonalInfoEvent:()=>Us.ou,isPersonalSettings:()=>Rs,isPersonalWebsite:()=>Ts,isPhone:()=>_s.M,isSecret:()=>Ds.k,isSecureFileInfo:()=>Fs,isSocialSecurityId:()=>Ps,killswitchLiveQueriesSlots:()=>tt.b,killswitchQueriesSlots:()=>tt.c,liveSlot:()=>n.H,loginCommandsSlots:()=>at.x,loginNotificationsCommandsSlots:()=>pt._m,loginNotificationsLiveQueriesSlots:()=>pt.Rj,loginNotificationsQueriesSlots:()=>pt.Xz,loginStepInfoCommandsSlots:()=>ht.vq,loginStepInfoLiveQueriesSlots:()=>ht._1,loginStepInfoQueriesSlots:()=>ht.xP,noteLiveQueriesSlots:()=>Ie.F,noteQueriesSlots:()=>Ie.j,notificationsCommandsSlots:()=>yt.U$,notificationsLiveQueriesSlots:()=>yt.iX,notificationsQueriesSlots:()=>yt.Ie,openSessionCommandsSlots:()=>wt.of,openSessionLiveQueriesSlots:()=>wt.K1,openSessionQueriesSlots:()=>wt.A2,passkeyCommandsSlots:()=>Oe.Ks,passkeyLiveQueriesSlots:()=>Oe.zX,passkeyQueriesSlots:()=>Oe.T2,passportsCommandsSlots:()=>ie.H,passwordGeneratorCommandsSlots:()=>_t.r,passwordGeneratorQueriesSlots:()=>_t.H,passwordHistoryLiveQueriesSlots:()=>Te._,passwordHistoryQueriesSlots:()=>Te.m,paymentCardCommandsSlots:()=>De.iT,paymentCardLiveQueriesSlots:()=>De.sJ,paymentCardQueriesSlots:()=>De.gM,paymentsCommandsSlots:()=>Dt._,paymentsQueriesSlots:()=>Dt.P,possibleAdminPermissions:()=>St.a1,protectedItemsUnlockerCommandsSlots:()=>Pt.gQ,protectedItemsUnlockerLiveQueriesSlots:()=>Pt.qN,protectedItemsUnlockerQueriesSlots:()=>Pt.UW,queries:()=>Ms.o$,queriesFromCarbonAPI:()=>Ms.r$,recoveryCommandsSlots:()=>xt.$k,recoveryLiveQueriesSlots:()=>xt.EX,recoveryQueriesSlots:()=>xt.q9,remoteFileCommandsSlots:()=>ze.H9,remoteFilesLiveQueriesSlots:()=>ze.YW,remoteFilesQueriesSlots:()=>ze.JQ,secretLiveQueriesSlots:()=>ve.W,secureFilesCommandsSlots:()=>Se.Wk,secureFilesLiveQueriesSlots:()=>Se.JX,secureFilesQueriesSlots:()=>Se.q,settingsCommandsSlots:()=>be.dF,settingsLiveQueriesSlots:()=>be.k3,settingsQueriesSlots:()=>be.nD,sharingCommandsSlots:()=>Kt.uG,sharingLiveQueriesSlots:()=>Kt.Ll,sharingQueriesSlots:()=>Kt.i1,socialSecurityIdsCommandsSlots:()=>re.w,spacesQueriesSlots:()=>Ce.c,staticDataQueriesSlots:()=>os.Q,teamAdminCommandsSlots:()=>is.hO,teamAdminLiveQueriesSlots:()=>is.dN,teamAdminQueriesSlots:()=>is.XJ,teamCommandsSlots:()=>Vt.b,teamQueriesSlots:()=>Vt.N,transactionTypes:()=>ps.s5,twoFactorAuthenticationCommandsSlots:()=>b.KM,twoFactorAuthenticationLiveQueriesSlots:()=>b.ud,twoFactorAuthenticationQueriesSlots:()=>b.b6,unlockProtectedItemsWrongPasswordError:()=>Nt,userMessagesCommandsSlots:()=>Ls.Kr,userMessagesLiveQueriesSlots:()=>Ls.kh,userMessagesQueriesSlots:()=>Ls.Vz,vaultCommandsSlots:()=>Le.e,vaultQueriesSlots:()=>Le.P,vaultSourceTypeToDataModelTypeMap:()=>N.Z,vpnCommandsSlots:()=>Ks.lp,vpnLiveQueriesSlots:()=>Ks.fD,vpnQueriesSlots:()=>Ks.T4,webAuthnAuthenticationCommandsSlots:()=>D.qM,webAuthnAuthenticationLiveQueriesSlots:()=>D.jF,webAuthnAuthenticationQueriesSlots:()=>D.Ui});var i=s(50415);const r=(0,i.Enum)("EXCEPTION_LOG");var n=s(83307),o=s(92541),a=s(41571),c=s(66410),d=s(8768),l=s(11910),u=s(72683),p=s(51592),h=s(86055),g=s(25944),m=s(30504);const v={getExtensionId:(0,m.slot)(),switchExtensionToStandalone:(0,m.slot)(),showInput:(0,m.slot)(),showFormOnPage:(0,m.slot)(),signalTti:(0,m.slot)(),signalDatabasesSent:(0,m.slot)()},y=(0,i.Enum)("GET_EXTENSION_ID","SIGNAL_TTI","DATABASES_SEND","SHOW_INPUT","SHOW_FORM_ON_PAGE","SWITCH_TO_STANDALONE");var S=s(16835),w=function(e){return e[e.EMPTY_EMAIL=0]="EMPTY_EMAIL",e[e.INVALID_EMAIL=1]="INVALID_EMAIL",e[e.UNKNOWN_ERROR=2]="UNKNOWN_ERROR",e}({}),E=function(e){return e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",e}({}),I=s(60268),A=s(43816),f=s(89238),b=s(72490),C=function(e){return e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",e}({}),O=function(e){return e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.NO_KEYHANDLE_FOUND="NO_KEYHANDLE_FOUND",e.WRONG_AUTHENTICATION_CODE="WRONG_AUTHENTICATION_CODE",e}({}),R=function(e){return e.AUTHENTICATION_TYPE="AUTHENTICATION_TYPE",e.BACKUP_PHONE="BACKUP_PHONE",e.QR_CODE="QR_CODE",e.AUTHENTICATION_CODE="AUTHENTICATION_CODE",e.LOADING="LOADING",e.FINALIZING_CHANGES="FINALIZING_CHANGES",e.BACKUP_CODES="BACKUP_CODES",e.GENERIC_ERROR="GENERIC_ERROR",e.LOGOUT_REQUIRED="LOGOUT_REQUIRED",e.SUCCESS="SUCCESS",e}({}),T=function(e){return e.CONFIRMATION="CONFIRMATION",e.AUTHENTICATION_CODE="AUTHENTICATION_CODE",e.BACKUP_CODE="BACKUP_CODE",e.FINALIZING_CHANGES="FINALIZING_CHANGES",e.SUCCESS="SUCCESS",e.LOGOUT_REQUIRED="LOGOUT_REQUIRED",e.GENERIC_ERROR="GENERIC_ERROR",e}({}),_=function(e){return e.INTERNAL_ERROR="internal_error",e.CANNOT_SEED_FOR_USER_WITH_TOTP_ENABLED="cannot_seed_for_user_with_TOTP_enabled",e.OTP_FAILED="otp_failed",e.TOTP_TYPE_IS_NOT_SET_TO_EMAIL_TOKEN="totp_type_is_not_set_to_email_token",e.PHONE_VALIDATION_FAILED="phone_validation_failed",e}({}),D=s(66460),F=s(91652),P=s(79791),U=function(e){return e.ANALYSIS_ENABLED_ON_ALL_FORMS="ANALYSIS_ENABLED_ON_ALL_FORMS",e.ANALYSIS_ENABLED_ONLY_ON_LOGINS_AND_PASSWORDS="ANALYSIS_ENABLED_ONLY_ON_LOGINS_AND_PASSWORDS",e}({}),N=s(59327),L=s(30551),x=s(95075),G=s(68946),k=function(e){return e.ChangeUserCryptoFailed="CHANGE_USER_CRYPTO_FAILED",e}({}),K=function(e){return e.ARGON2D="argon2d",e.PBKDF2="pbkdf2",e.KWC3="kwc3",e}({}),M=s(21222),j=function(e){return e.GetDarkWebInsightsFailed="GET_DARK_WEB_INSIGHTS_FAILED",e.GetDarkWebInsightsSummaryFailed="GET_DARK_WEB_INSIGHTS_SUMMARY_FAILED",e}({}),V=function(e){return e.Password="password",e.CreditCard="creditcard",e.IPAddress="ip",e.MailingAddress="address",e.Phone="phone",e.Email="email",e.Social="social",e.GeoLocation="geolocation",e.UserName="username",e.PersonalInfo="personalinfo",e}({});const W=Object.freeze({New:"new",Viewed:"viewed"});var B=s(13310),z=s(17018),q=function(e){return e.Username="username",e.Password="password",e.Email="email",e.CreditCard="creditcard",e.Phone="phone",e.Address="address",e.SSN="ssn",e.IP="ip",e.Location="geolocation",e.PersonalInfo="personalinfo",e.SocialNetwork="social",e}({}),H=function(e){return e.UNKNOWN="unknown",e.SYNCING="syncing",e.SKIPPED="skipped",e.UNCHANGED="unchanged",e.UPDATED="updated",e.ERROR="error",e}({}),Y=s(15845),Q=s(73561),$=function(e){return e.Unlimited="unlimited",e.UnderLimit="underLimit",e.NearLimit="nearLimit",e.AtOrAboveLimit="atOrAboveLimit",e}({}),X=s(85940),Z=function(e){return e.UNSUPPORTED_DATATYPE_ERROR="Unsupported Data Export Type",e.UNDEFINED_PASSWORD_ERROR="Undefined Password",e}({}),J=s(16251),ee=s(8393),te=s(71044),se=s(92490),ie=s(35058),re=s(42297),ne=function(e){return e.INTERNAL_ERROR="INTERNAL_ERROR",e.NOT_AUTHENTICATED="NOT_AUTHENTICATED",e.NOT_FOUND="NOT_FOUND",e}({}),oe=function(e){return e.MISSING_ID_NUMBER="MISSING_ID_NUMBER",e}({}),ae=function(e){return e.MISSING_ID_NUMBER="MISSING_ID_NUMBER",e}({}),ce=s(10799),de=function(e){return e.CREDENTIAL="credentials",e.NOTE="notes",e.PAYMENT_CARD="paymentCards",e.BANK_ACCOUNT="bankAccounts",e.COLLECTION="collections",e}({}),le=function(e){return e["1Password"]="1password",e.Bitwarden="bitwarden",e.Chrome="chrome",e.Dash="dash",e.Edge="edge",e.Firefox="firefox",e.Keepass="keepass",e.Keeper="keeper",e.Lastpass="lastpass",e.Other="other",e.Safari="safari",e}({}),ue=function(e){return e.Csv="csv",e.Dash="dash",e}({}),pe=function(e){return e.Unavailable="unavailable",e.Unknown="unknown",e}({}),he=function(e){return e.Idle="idle",e.Processing="processing",e.Success="success",e.Error="error",e}({}),ge=function(e){return e.BadPassword="bad_password",e.Unavailable="unavailable",e.InvalidFormat="invalid",e.Unknown="unknown",e}({}),me=function(e){return e.CredentialUpdateError="credentialUpdateError",e}({}),ve=s(96988),ye=function(e){return e.NOT_FOUND="NOT_FOUND",e.INTERNAL_ERROR="INTERNAL_ERROR",e.LEAVE_SHARING_FAILED="LEAVE_SHARING_FAILED",e.LEAVE_SHARING_FORBIDDEN_LAST_ADMIN="LEAVE_SHARING_FORBIDDEN_LAST_ADMIN",e.LEAVE_SHARING_FORBIDDEN_GROUP_ITEM="LEAVE_SHARING_FORBIDDEN_GROUP_ITEM",e}({}),Se=s(44532),we=function(e){return e.MAX_CONTENT_LENGTH_EXCEEDED="MAX_CONTENT_LENGTH_EXCEEDED",e.QUOTA_EXCEEDED="QUOTA_EXCEEDED",e.HARD_QUOTA_EXCEEDED="HARD_QUOTA_EXCEEDED",e.SOFT_QUOTA_EXCEEDED="SOFT_QUOTA_EXCEEDED",e.INVALID_FILE_TYPE="INVALID_FILE_TYPE",e.INTERNAL_ERROR="INTERNAL_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.FILE_NOT_FOUND="FILE_NOT_FOUND",e}({}),Ee=function(e){return e.None="None",e.Initial="Initial",e.Uploading="Uploading",e.Ciphering="Ciphering",e.Done="Done",e.Error="Error",e}({}),Ie=s(79009),Ae=function(e){return e.NOT_FOUND="NOT_FOUND",e}({}),fe=function(e){return e.NOT_FOUND="NOT_FOUND",e.INTERNAL_ERROR="INTERNAL_ERROR",e.LEAVE_SHARING_FAILED="LEAVE_SHARING_FAILED",e.LEAVE_SHARING_FORBIDDEN_LAST_ADMIN="LEAVE_SHARING_FORBIDDEN_LAST_ADMIN",e.LEAVE_SHARING_FORBIDDEN_GROUP_ITEM="LEAVE_SHARING_FORBIDDEN_GROUP_ITEM",e}({}),be=s(15662),Ce=s(64785),Oe=s(12642),Re=function(e){return e[e.NOT_AUTHORIZED=0]="NOT_AUTHORIZED",e[e.NOT_FOUND=1]="NOT_FOUND",e[e.INTERNAL_ERROR=2]="INTERNAL_ERROR",e}({}),Te=s(87815),_e=function(e){return e.Credential="credential",e.Generated="generated",e}({}),De=s(34202),Fe=function(e){return e.EMPTY_CARD_NUMBER_AND_SECURITY_CODE="EMPTY_CARD_NUMBER_AND_SECURITY_CODE",e.NOT_FOUND="NOT_FOUND",e}({}),Pe=function(e){return e.NOT_AUTHORIZED="NOT_AUTHORIZED",e.NOT_FOUND="NOT_FOUND",e.INTERNAL_ERROR="INTERNAL_ERROR",e}({}),Ue=s(8082),Ne=s(51424),Le=s(16036),xe=s(59299),Ge=s(5725),ke=s(42986),Ke=s(29224),Me=function(e){return e.NEW_USER="NEW_USER",e.EXISTING_FREE_USER="EXISTING_FREE_USER",e.EXISTING_PREMIUM_USER="EXISTING_PREMIUM_USER",e}({}),je=function(e){return e[e.DISCONTINUED=0]="DISCONTINUED",e[e.PREMIUM=1]="PREMIUM",e[e.PREMIUM_PLUS=2]="PREMIUM_PLUS",e}({});const Ve=Object.freeze({ADMIN:"admin",REGULAR:"regular",REMOVED:"removed"});var We=function(e){return e.IOS_APP_STORE="ios",e.MAC_STORE="mac",e.PLAY_STORE="playstore",e}({}),Be=s(95405),ze=s(15314);const qe="update_available",He="unknown_revision",Ye="not_found",Qe="not_updated",$e="unspecified_error",Xe="error_server",Ze=["phishing_urls_test.json"];var Je=s(50169),et=s(7073),tt=s(74725),st=s(69259),it=s(18064),rt=function(e){return e[e.AllBatchesSent=0]="AllBatchesSent",e[e.SomeBatchesSent=1]="SomeBatchesSent",e[e.NoBatchesSent=2]="NoBatchesSent",e}({}),nt=s(97414),ot=s(51263),at=s(42247),ct=function(e){return e[e.MasterPasswordMissing=0]="MasterPasswordMissing",e[e.DeviceAuthenticationMissing=1]="DeviceAuthenticationMissing",e[e.TokenMissing=2]="TokenMissing",e[e.OTPMissing=3]="OTPMissing",e[e.AskPersistData=4]="AskPersistData",e[e.LoggedIn=5]="LoggedIn",e[e.ExtraDeviceTokenMissing=6]="ExtraDeviceTokenMissing",e[e.SSOLogin=7]="SSOLogin",e[e.DeviceLimitFlow=8]="DeviceLimitFlow",e[e.DashlaneAuthenticatorApprovalMissing=9]="DashlaneAuthenticatorApprovalMissing",e[e.DashlaneAuthenticatorApprovalCancelled=10]="DashlaneAuthenticatorApprovalCancelled",e[e.MasterPasswordLess=11]="MasterPasswordLess",e}({}),dt=function(e){return e.SSO="sso",e.MP="master_password",e}({}),lt=function(e){return e.SUCCESS="SUCCESS",e.ASK_NEW_MP="ASK_NEW_MP",e.EMPTY_LOGIN="EMPTY_LOGIN",e.INNACTIVE_SESSION="INNACTIVE_SESSION",e.SSO_VERIFICATION_FAILED="SSO_VERIFICATION_FAILED",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.UNSUPPORTED_TRANSITION="UNSUPPORTED_TRANSITION",e.WRONG_PASSWORD="WRONG_PASSWORD",e.SSO_LOGIN_CORRUPT="SSO_LOGIN_CORRUPT",e}({}),ut=function(e){return e.RELOGIN_NEEDED="RELOGIN_NEEDED",e.SSO_FEATURE_BLOCKED="SSO_FEATURE_BLOCKED",e.SSO_LOGIN_CORRUPT="SSO_LOGIN_CORRUPT",e.SSO_SETUP_ERROR="SSO_SETUP_ERROR",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.TEAM_ACCEPTANCE_SUCCESS="TEAM_ACCEPTANCE_SUCCESS",e.TEAM_ACCEPTANCE_ERROR="TEAM_ACCEPTANCE_ERROR",e}({}),pt=s(68801),ht=s(17065),gt=function(e){return e.Email="email",e.Welcome="welcome",e.OTP1="OTP1",e.OTP2="OTP2",e.BackupCodeOTP1="backupCodeOTP1",e.BackupCodeOTP2="backupCodeOTP2",e.OTPToken="token",e.Password="password",e.SSO="SSO",e.ActivateSSO="activateSSO",e.WebAuthn="webAuthn",e.WebAuthnError="webAuthnError",e.DeviceLimitReached="deviceLimitReached",e.DashlaneAuthenticator="dashlaneAuthenticator",e.PasswordLess="passwordLess",e}({}),mt=function(e){return e.PaymentFailureChurning="paymentFailureChurning",e.PaymentFailureChurned="paymentFailureChurned",e.SwitchToMlAnalysisEngine="switchToMlAnalysisEngine",e.DWMb2bAutoEnrollTooltip="dWMb2bAutoEnrollTooltip",e.TacGetTheExtensionBanner="tacGetTheExtensionBanner",e.TacEnableAccountRecoveryBanner="tacEnableAccountRecoveryBanner",e.TacOnlyOneAdminBanner="tacOnlyOneAdminBanner",e.TacDarkWebInsightsNewBadge="tacDarkWebInsightsNewBadge",e.PasswordHistoryBanner="passwordHistoryBanner",e.SharingCenterDisabledBanner="sharingCenterDisabledBanner",e.AccountRecoveryAvailableAdminTooltip="accountRecoveryAvailableAdminTooltip",e.ActivateInviteLink="activateInviteLink",e.MpToSsoMigrationDoneDialog="mpToSsoMigrationDoneDialog",e}({}),vt=function(e){return e.Interacted="interacted",e.Seen="seen",e.Unseen="unseen",e}({}),yt=s(41976),St=s(95255),wt=s(576),Et=function(e){return e.UnexpectedError="UNEXPECTED_ERROR",e}({});const It="USER_STILL_OVERFLOWING",At="UNEXPECTED_ERROR";var ft=function(e){return e.UnexpectedError="UNEXPECTED_ERROR",e}({}),bt=s(56186),Ct=function(e){return e.Android="android",e.DesktopMacOS="macosx",e.DesktopWindows="windows",e.IPad="ipad",e.IPhone="iphone",e.IPod="ipod",e.Other="other",e.StandaloneExtension="saex",e.TeamAdminConsole="tac",e.WebApp="webapp",e}({}),Ot=function(e){return e[e.Android=0]="Android",e[e.CarbonTests=1]="CarbonTests",e[e.CarbonUnknown=2]="CarbonUnknown",e[e.DesktopLegacyMacOS=3]="DesktopLegacyMacOS",e[e.DesktopLegacyWindows=4]="DesktopLegacyWindows",e[e.DesktopUWP=5]="DesktopUWP",e[e.IPad=6]="IPad",e[e.IPhone=7]="IPhone",e[e.IPod=8]="IPod",e[e.StandaloneExtension=9]="StandaloneExtension",e[e.TeamAdminConsole=10]="TeamAdminConsole",e[e.WebApp=11]="WebApp",e[e.WebAppDev=12]="WebAppDev",e}({}),Rt=s(34445),Tt=s(39442),_t=s(31760),Dt=s(65133),Ft=function(e){return e.ascending="ascending",e.descending="descending",e}({}),Pt=s(30195),Ut=function(e){return e.SUCCESS="success",e.ERROR="error",e}({});const Nt="WRONG PASSWORD";var Lt=function(e){return e.SUCCESS="success",e.ERROR="error",e}({}),xt=s(8765),Gt=function(e){return e.CheckRecoveryStatusFailed="CHECK_RECOVERY_STATUS_FAILED",e.RecoverySetupFailed="RECOVERY_SETUP_FAILED",e.RecoveryDeactivationFailed="RECOVERY_DEACTIVATION_FAILED",e.RecoveryRequestFailed="RECOVERY_REQUEST_FAILED",e.RegisterDeviceFailed="REGISTER_DEVICE_FAILED",e.SetupMasterPasswordForRecoveryFailed="SETUP_MASTERPASSWORD_FOR_RECOVERY_FAILED",e.CancelRecoveryRequestFailed="CANCEL_RECOVERY_REQUEST_FAILED",e.RecoverUserDataFailed="RECOVER_REQUEST_FAILED",e.CheckLocalRecoveryKeyFailed="CHECK_LOCAL_RECOVERY_KEY_FAILED",e.StartAccountRecoveryFailed="START_ACCOUNT_RECOVERY_FAILED",e.AccountRecoveryNotAvailableError="ACCOUNT_RECOVERY_NOT_AVAILABLE_ERROR",e.IsRecoveryRequestPendingFailed="IS_RECOVERY_REQUEST_PENDING_FAILED",e}({}),kt=function(e){return e.PENDING="PENDING",e.APPROVED="APPROVED",e.REFUSED="REFUSED",e.OVERRIDDEN="OVERRIDDEN",e.CANCELED="CANCELED",e}({}),Kt=s(6535),Mt=s(41711),jt=function(e){return e[e.USER_EXISTS=0]="USER_EXISTS",e[e.USER_DOESNT_EXIST=1]="USER_DOESNT_EXIST",e[e.USER_DOESNT_EXIST_UNLIKELY_MX=2]="USER_DOESNT_EXIST_UNLIKELY_MX",e[e.USER_DOESNT_EXIST_INVALID_MX=3]="USER_DOESNT_EXIST_INVALID_MX",e[e.USER_DOESNT_EXIST_SSO_NON_PROVISIONED=4]="USER_DOESNT_EXIST_SSO_NON_PROVISIONED",e[e.USER_SSO_PROVISIONED=5]="USER_SSO_PROVISIONED",e[e.USER_NITRO_SSO_PROVISIONED=6]="USER_NITRO_SSO_PROVISIONED",e[e.USER_NOT_PROPOSED=7]="USER_NOT_PROPOSED",e}({}),Vt=s(26332),Wt=function(e){return e.ComputePlanPricingFailed="COMPUTE_PLAN_PRICING_FAILED",e.NotBillingAdmin="NOT_BILLING_ADMIN",e}({});const Bt="UNKNOWN_ERROR",zt="TEAM_DEVICE_CONFIGURATION_NOT_FOUND",qt=Object.freeze({Activated:"activated",PendingActivation:"pending_activation",PendingDeactivation:"pending_deactivation"});var Ht=function(e){return e.StartAuditLogsQueryFailed="START_AUDIT_LOGS_QUERY_FAILED",e.GetAuditLogQueryResultsFailed="GET_AUDIT_LOG_QUERY_RESULTS_FAILED",e}({});const Yt=Object.freeze({Queued:"QUEUED",Running:"RUNNING",Succeeded:"SUCCEEDED",Failed:"FAILED",Cancelled:"CANCELLED"});var Qt=s(54591);const $t=Object.freeze({pending:"pending",valid:"valid",expired:"expired",invalid:"invalid"}),Xt=$t,Zt=Object.freeze({OK:"OK",ES_UNREACHABLE:"ES_UNREACHABLE",ES_CONFIG_RELOAD_FAILURE:"ES_CONFIG_RELOAD_FAILURE",ES_INTERNAL_NETWORK_ERROR:"ES_INTERNAL_NETWORK_ERROR"});var Jt=function(e){return e.NotAdmin="not_admin",e.TeamKeyNotFound="TEAM_KEY_NOT_FOUND",e.InviteLinkNotFound="TEAM_INVITE_LINK_NOT_FOUND",e.UserInviteLinkNotFound="USER_TEAM_INVITE_TOKEN_NOT_FOUND",e}({}),es=function(e){return e.NotAdmin="not_billing_admin",e.InternalError="internal_error",e.UnknownError="UNKNOWN_ERROR",e}({}),ts=function(e){return e.XML_PARSE_FAILED="xml_parse_failed",e}({}),ss=function(e){return e.KEY_DESCRIPTOR_NOT_FOUND="key_descriptor_not_found",e.IDP_ENTRYPOINT_NOT_FOUND="idp_entrypoint_not_found",e.INVALID_IDP_SSO_DESCRIPTOR="invalid_idp_sso_descriptor",e.MISSING_CERTIFICATE="missing_certificate",e.MULTIPLE_CERTIFICATES="multiple_certificates",e.CERTIFICATE_TOO_SHORT="certificate_too_short",e.CERTIFICATE_TOO_LONG="certificate_too_long ",e.CERTIFICATE_DECODE_FAILED="certificate_decode_failed",e.INVALID_ENTRYPOINT="invalid_entrypoint",e}({}),is=s(38026),rs=function(e){return e[e.GEOGRAPHIC_STATES=0]="GEOGRAPHIC_STATES",e}({}),ns=function(e){return e[e.LEVEL_0=0]="LEVEL_0",e[e.LEVEL_1=1]="LEVEL_1",e}({}),os=s(20194);function as(e){return Boolean(e)&&"KWAddress"===e.kwType}function cs(e){return Boolean(e)&&"KWBankStatement"===e.kwType}var ds=function(e){return e.PENDING="PENDING",e.VIEWED="VIEWED",e.ACKNOWLEDGED="ACKNOWLEDGED",e}({});function ls(e){return Boolean(e)&&"KWSecurityBreach"===e.kwType}function us(e){return Boolean(e)&&"KWCollection"===e.kwType}var ps=s(30309);function hs(e){return Boolean(e)&&"KWCompany"===e.kwType}var gs=s(96500);function ms(e){return Boolean(e)&&"KWDriverLicence"===e.kwType}function vs(e){return Boolean(e)&&"KWEmail"===e.kwType}function ys(e){return Boolean(e)&&"KWFiscalStatement"===e.kwType}function Ss(e){return Boolean(e)&&"KWGeneratedPassword"===e.kwType}function ws(e){return Boolean(e)&&"KWIDCard"===e.kwType}function Es(e){return Boolean(e)&&"KWIdentity"===e.kwType}var Is=s(95502),As=s(69956),fs=s(9519);function bs(e){return Boolean(e)&&"KWPassport"===e.kwType}var Cs=s(12144);function Os(e){return Boolean(e)&&"KWPaymentMean_paypal"===e.kwType}function Rs(e){return Boolean(e)&&"KWSettingsManagerApp"===e.kwType}function Ts(e){return Boolean(e)&&"KWPersonalWebsite"===e.kwType}var _s=s(90294),Ds=s(47380);function Fs(e){return Boolean(e)&&"KWSecureFileInfo"===e.kwType}function Ps(e){return Boolean(e)&&"KWSocialSecurityStatement"===e.kwType}var Us=s(17476),Ns=function(e){return e.DEFAULT="default",e.TRIAL_EXPIRED="trial_expired",e.WEB_STORE="web_store",e.DASHBOARD_UPRADE="dashboard_upgrade",e.SHARING_CENTER_FAMILY="sharing_center_family",e.SHARING_CENTER_WORK="sharing_center_work",e}({}),Ls=s(8186),xs=function(e){return e.Activated="Activated",e.Activating="Activating",e.Error="Error",e.NotFound="NotFound",e.Ready="Ready",e}({}),Gs=function(e){return e.ServerError="ServerError",e.AccountAlreadyExistError="AccountAlreadyExist",e}({}),ks=function(e){return e.InTeam="InTeam",e.NotPremium="NotPremium",e.NoPayment="NoPayment",e.Other="Other",e}({}),Ks=s(53850),Ms=s(55228),js=s(40923),Vs=s(23063);const Ws=["lockSession","closeSession","cancelDashlaneAuthenticatorRegistration","openSession","openSessionWithDashlaneAuthenticator","openSessionWithOTP","openSessionWithOTPForNewDevice","openSessionWithToken","openSessionResendToken","savePersonalDataItem","sessionForceSync","getLocalAccountsList"];var Bs=s(14676),zs=s(14122)},67051:(e,t,s)=>{s.d(t,{J:()=>c});var i=s(75958),r=s(16362),n=s(17380),o=s(84895),a=s(11280);const c=(0,i.Q)({name:"permissions",commands:{addGroupManager:r.B,removeGroupManager:n.d},events:{permissionsLoadedEvent:o.L},queries:{userPermissions:a.l}})},71991:(e,t,s)=>{s.d(t,{J:()=>n});var i=s(8260),r=s(67051);class n extends((0,i.E)(r.J)){}(0,i.K)(r.J,n)},16362:(e,t,s)=>{s.d(t,{B:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},17380:(e,t,s)=>{s.d(t,{d:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},84895:(e,t,s)=>{s.d(t,{L:()=>n});var i=s(446),r=s(62149);class n extends((0,i.d)({scope:r.F.User})){}},11280:(e,t,s)=>{s.d(t,{l:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},19272:(e,t,s)=>{s.d(t,{Iy:()=>n,K$:()=>o,fp:()=>r});var i=s(7165);const r=i.z.enum(["ALL","BILLING_EDIT","BILLING_READ","GROUP_CREATE","GROUP_DELETE","GROUP_EDIT","GROUP_READ"]),n=r,o=i.z.array(r)},38586:(e,t,s)=>{s.d(t,{B:()=>j});var i=s(92336),r=s(86006),n=s(67051),o=s(65862),a=s(41511),c=s(60399),d=s(92587),l=s(53344),u=s(14122),p=s(78346),h=s(33312),g=function(e){return e[e.GroupManager=0]="GroupManager",e}({});class m{async addRole({role:e,params:t}){if(0===e)return await this.addGroupManager(t)}async removeRole({role:e,params:t}){if(0===e)return await this.removeGroupManager(t)}async getSpecialUserGroupRevision(e){const{commands:{carbon:t}}=this.carbonLegacyClient,s=await t({name:"getSpecialUserGroupRevision",args:[{teamId:e}]});let i;if(!(0,p.d6)(s))throw s.error.error;{const{carbonResult:e}=s.data,{specialUserGroupRevision:t}=e;i=t}return i}async removeGroupManager({memberLogin:e,teamId:t}){const s=await this.getSpecialUserGroupRevision(t);return await(0,c.z)(this.serverApiClient.v1.teams.removeGroupManager({memberLogin:e,userGroupRevision:s}).pipe((0,h.DZ)((e=>{throw new Error(e.message)})),(0,h.lk)((e=>{if(e.data)return(0,p.Vp)(void 0);throw new Error("Unknown server error occurred while attempting to remove group manager")}))))}async addGroupManager({memberLogin:e,teamId:t}){const s=await this.getSpecialUserGroupRevision(t),{commands:{carbon:i}}=this.carbonLegacyClient,r=await i({name:"getSpecialUserGroupInviteValuesForMemberInTeam",args:[{memberLogin:e,teamId:t}]});let n="",o="";if(!(0,p.d6)(r))throw r.error.error;{const{carbonResult:e}=r.data,{groupKey:t,proposeSignature:s}=e;n=t,o=s}return await(0,c.z)(this.serverApiClient.v1.teams.addGroupManager({memberLogin:e,groupKey:n,proposeSignature:o,userGroupRevision:s}).pipe((0,h.DZ)((e=>{throw new Error(e.message)})),(0,h.lk)((e=>{if(e.data)return(0,p.Vp)(void 0);throw new Error("Unknown server error occurred while attempting to add group manager")}))))}constructor(e,t){this.serverApiClient=e,this.carbonLegacyClient=t}}m=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===l.l?Object:l.l,void 0===u._?Object:u._])],m);var v=s(63144),y=s(56618),S=s(60018),w=s(62149),E=s(19272);const I=e=>E.K$.safeParse(e).success;class A extends((0,v.Q)({storage:{schemaVersion:1,initialValue:[],typeGuard:I},persist:!0,scope:w.F.User,storeName:"permissions-store",capacity:y.Y._010KB,codec:S.E})){}var f=s(12723),b=s(85798),C=s(43978),O=s(69885),R=s(87065),T=s(82567),_=s(13800);class D extends _.f{}D=(0,i.gn)([(0,d.GS)()],D);class F{async refreshState(){const{getActiveSpaces:e}=this.carbon.queries;return await(0,c.z)(e().pipe((0,C.w)((e=>{if(!(0,p.d6)(e))throw new Error("Cannot retrieve user spaces from carbon");return e.data.length?this.serverApiClient.v1.teams.getUserPermissions().pipe((0,R.U)((e=>{if((0,p.hx)(e))throw new Error(`getUserPermissions failed with error: ${e}`);this.permissionsStore.set(this.serverToDomainPermissionsMapper(e.data.data.permissions))}))):(0,O.of)(void 0)})),(0,T.b)((()=>{this.eventEmitter.sendEvent("permissionsLoaded",void 0)}))))}getActiveUserPermissions(){return this.permissionsStore.state$.pipe((0,R.U)(p.Vp))}serverToDomainPermissionsMapper(e){return e.filter((e=>E.Iy.safeParse(e).success))}constructor(e,t,s,i){this.carbon=e,this.serverApiClient=t,this.permissionsStore=s,this.eventEmitter=i}}F=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===u._?Object:u._,void 0===l.l?Object:l.l,void 0===A?Object:A,void 0===D?Object:D])],F);class P{async handle(){await this.permissionsService.refreshState()}constructor(e){this.permissionsService=e}}P=(0,i.gn)([(0,b.b)(f.M),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===F?Object:F])],P);var U=s(82874),N=s(16362);class L{async execute({body:e}){return await this.roleService.addRole({role:g.GroupManager,params:e})}constructor(e){this.roleService=e}}L=(0,i.gn)([(0,U.W)(N.B),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===m?Object:m])],L);var x=s(17380);class G{async execute({body:e}){return await this.roleService.removeRole({role:g.GroupManager,params:e})}constructor(e){this.roleService=e}}G=(0,i.gn)([(0,U.W)(x.d),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===m?Object:m])],G);var k=s(11280),K=s(46449);class M{execute(){return this.permissionsService.getActiveUserPermissions()}constructor(e){this.permissionsService=e}}M=(0,i.gn)([(0,K.e)(k.l),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===F?Object:F])],M);class j{}j=(0,i.gn)([(0,r.Y)({api:n.J,imports:[a.n],providers:[D,F,m],stores:[A],handlers:{commands:{addGroupManager:L,removeGroupManager:G},events:{...(0,r.g)(o.Q,{sessionOpened:P})},queries:{userPermissions:M}}})],j)},78443:(e,t,s)=>{s.d(t,{j:()=>C});var i=s(75958),r=s(93807),n=s(22692),o=s(64261),a=s(97236),c=s(20715),d=s(88254),l=s(92043),u=s(31848),p=s(85986),h=s(22463),g=s(4842),m=s(92350),v=s(21382),y=s(38443),S=s(33608),w=s(37240),E=s(85606),I=s(31856),A=s(74062),f=s(92253),b=s(74564);const C=(0,i.Q)({name:"accountRecoveryKey",commands:{acknowledgeRecoveryActivation:r.yZ,goToActivationNextStep:n.Z,goToActivationPrevStep:o.H,requestActivation:a.e,resetActivationFlow:c.W,cancelGeneration:d.r,confirmActivation:l.W,confirmNewPassword:u.v,deactivate:p.E,submitRecoveryKey:h.Y,tryAgainRecovery:g.d,cancelRecoveryFlow:m.b,startRecoveryFlow:v.Q,clearWrongRecoveryKeyError:y.u,createPin:S.f,submitPin:w.W},queries:{shouldNotifyOfRecoveryActivation:E.a,activationFlowStatus:I.S,accountRecoveryKeyStatus:A.D,recoveryFlowStatus:f.y,recoveryMethodsInfo:b.V},events:{}})},93807:(e,t,s)=>{s.d(t,{yZ:()=>n});var i=s(13385),r=s(62149);(0,s(98124).Vj)("unable_to_acknowledge_notification","Unable to acknowledge notification");class n extends((0,i.g)({scope:r.F.User})){}},88254:(e,t,s)=>{s.d(t,{r:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},92350:(e,t,s)=>{s.d(t,{b:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},38443:(e,t,s)=>{s.d(t,{u:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},92043:(e,t,s)=>{s.d(t,{W:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},31848:(e,t,s)=>{s.d(t,{v:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},33608:(e,t,s)=>{s.d(t,{f:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},85986:(e,t,s)=>{s.d(t,{E:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},22692:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},64261:(e,t,s)=>{s.d(t,{H:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},97236:(e,t,s)=>{s.d(t,{e:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},20715:(e,t,s)=>{s.d(t,{W:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},21382:(e,t,s)=>{s.d(t,{Q:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},37240:(e,t,s)=>{s.d(t,{W:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},22463:(e,t,s)=>{s.d(t,{Y:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},4842:(e,t,s)=>{s.d(t,{d:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},74062:(e,t,s)=>{s.d(t,{D:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},31856:(e,t,s)=>{s.d(t,{S:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},92253:(e,t,s)=>{s.d(t,{y:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},74564:(e,t,s)=>{s.d(t,{V:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},85606:(e,t,s)=>{s.d(t,{a:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},57418:(e,t,s)=>{s.d(t,{D:()=>Xt});var i=s(92336),r=s(60399),n=s(78443),o=s(89742),a=s(86006),c=s(86213),d=s(50423),l=s(85045),u=s(63604),p=s(69259),h=s(41511),g=s(40416),m=s(78346),v=s(65862),y=s(90904),S=s(41842),w=s(87065),E=s(14122),I=s(53344),A=s(92587),f=s(33312),b=s(52477),C=s(17591),O=s(62149),R=s(63144),T=s(56618);const _=e=>!(!e||"object"!=typeof e)&&"isEnabled"in e;class D extends((0,R.Q)({initialValue:{isEnabled:void 0,login:void 0},persist:!1,scope:O.F.Device,storeName:"account-recovery-key",storeTypeGuard:_,capacity:T.Y._001KB})){}const F=["email_token","totp","duo_push","dashlane_authenticator"],P=e=>"object"==typeof e&&"type"in e;var U=s(98124),N=function(e){return e.GENERIC_ERROR="GENERIC_ERROR",e.NETWORK_ERROR="NETWORK_ERROR",e.PIN_MISMATCH_ERROR="PIN_MISMATCH_ERROR",e.INITIALIZE_MACHINE_ERROR="INITIALIZE_MACHINE_ERROR",e.WRONG_RECOVERY_KEY_ERROR="WRONG_RECOVERY_KEY_ERROR",e.CHANGE_MASTER_PASSWORD_ERROR="CHANGE_MASTER_PASSWORD_ERROR",e}({});class L extends((0,U.Hu)("NETWORK_ERROR","There is an issue with your connection")){}class x{getAuthTicketInfo(){const{carbonState:e}=this.carbon.queries;return(0,r.z)(e({path:"userSession.authTicketInfo"}).pipe((0,f.nb)({success:e=>e,failure:()=>{throw new Error("Failure getting auth ticket info")}})))}retrieveLocalAccounts(){const{carbonState:e}=this.carbon.queries;return(0,r.z)(e({path:"authentication.localAccounts"}).pipe((0,S.h)(m.d6),(0,S.h)((e=>e.data.accountsListInitialized)),(0,w.U)((e=>e.data.accountsList))))}async getCurrentPersonalSettings(){const{carbonStateList:e}=this.carbon.queries;return await(0,r.z)(e({paths:["userSession.personalSettings.AccountRecoveryKey","userSession.personalSettings.AccountRecoveryKeyId"]}).pipe((0,f.nb)({success:([e,t])=>({AccountRecoveryKey:e,AccountRecoveryKeyId:t}),failure:()=>{throw new Error("Failure getting state list")}})))}getCurrentRecoveryKey(){return this.getCurrentPersonalSettings()}getLastAuthenticatedUserRecoveryData(){return this.store.state$.pipe((0,w.U)((e=>({isEnabled:e.isEnabled,login:e.login}))))}async updateLastAuthenticatedUserRecoveryStatus(e){if(!e)throw new Error("No user login provided");const t=await(0,r.z)(this.serverApiClient.v1.accountrecovery.getStatus({login:e}));if((0,m.hx)(t))throw new Error("Server call failed");await this.store.set({isEnabled:t.data.data.enabled,login:e})}async generateRecoveryKey(){const{carbon:e}=this.carbon.commands,t={length:28,digits:!0,letters:!0,avoidAmbiguous:!0,symbols:!1};return await e({name:"generatePassword",args:[{settings:t}]})}async setPersonalSettings(e){const{updateAccountRecoveryKeyPersonalSettings:t}=this.carbon.commands;return await t(e)}async getAccountInfo(e){return await(0,r.z)(this.serverApiClient.v1.authentication.getAuthenticationMethodsForDevice({login:e,methods:F}).pipe((0,f.DZ)((e=>(0,b.EQ)(e,{BusinessError:()=>{throw new Error(N.GENERIC_ERROR)},FetchFailedError:()=>new L,InternalServerError:C.j,InvalidRequest:C.j,RateLimited:C.j,ServiceUnavailable:C.j,UnspecifiedBadStatus:C.j}))),(0,f.lk)((e=>{const t=e.data.verifications.find(P);if(t)return(0,m.Vp)({verificationMethod:t,accountType:e.data.accountType});throw new Error("Unsupported authentication method")}))))}async requestActivation(e){return await(0,r.z)(this.serverApiClient.v1.accountrecovery.requestActivation({encryptedVaultKey:e}).pipe((0,f.DZ)((e=>(0,b.EQ)(e,{BusinessError:()=>{throw new Error(N.GENERIC_ERROR)},FetchFailedError:()=>new L,UnspecifiedBadStatus:C.j,InternalServerError:C.j,InvalidRequest:C.j,RateLimited:C.j,ServiceUnavailable:C.j}))),(0,f.lk)((e=>{if(e.data.recoveryId)return(0,m.Vp)(e.data.recoveryId);throw new Error(N.GENERIC_ERROR)}))))}async confirmActivation(e){return await(0,r.z)(this.serverApiClient.v1.accountrecovery.confirmActivation({recoveryId:e}).pipe((0,f.DZ)((e=>(0,b.EQ)(e,{BusinessError:()=>{throw new Error(N.GENERIC_ERROR)},FetchFailedError:()=>new L,UnspecifiedBadStatus:C.j,InternalServerError:C.j,InvalidRequest:C.j,RateLimited:C.j,ServiceUnavailable:C.j}))),(0,f.lk)((()=>(0,m.Vp)(void 0)))))}async deactivate(e){return await(0,r.z)(this.serverApiClient.v1.accountrecovery.deactivate({reason:e}).pipe((0,f.DZ)((e=>(0,b.EQ)(e,{BusinessError:()=>{throw new Error(N.GENERIC_ERROR)},FetchFailedError:()=>new L,UnspecifiedBadStatus:C.j,InternalServerError:C.j,InvalidRequest:C.j,RateLimited:C.j,ServiceUnavailable:C.j}))),(0,f.lk)((()=>(0,m.Vp)(void 0)))))}async getEncryptedVaultKey(e,t){return await(0,r.z)(this.serverApiClient.v1.accountrecovery.getEncryptedVaultKey({login:e,authTicket:t}).pipe((0,f.DZ)((e=>(0,b.EQ)(e,{BusinessError:()=>{throw new Error(N.GENERIC_ERROR)},FetchFailedError:()=>new L,UnspecifiedBadStatus:C.j,InternalServerError:C.j,InvalidRequest:C.j,RateLimited:C.j,ServiceUnavailable:C.j}))),(0,f.lk)((e=>{const{encryptedVaultKey:t,recoveryId:s}=e.data;if(t&&s)return(0,m.Vp)({encryptedVaultKey:t,recoveryId:s});throw new Error(N.GENERIC_ERROR)}))))}constructor(e,t,s){this.store=e,this.serverApiClient=t,this.carbon=s}}x=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===D?Object:D,void 0===I.l?Object:I.l,void 0===E._?Object:E._])],x);var G=s(85603);class k{async decrypt(e,t){return(new TextDecoder).decode(await this.flexibleDecryptor.decrypt(e,t))}constructor(e){this.flexibleDecryptor=e}}k=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===G.a?Object:G.a])],k);var K=s(82059),M=s(63352),j=s(28868),V=s(93704);class W{makeDerivationConfig(e){const[,,t]=e.split("$");return"pbkdf2"===t?j.E1:j.mr}async getUserCryptoConfig(){const{carbonStateList:e}=this.carbon.queries;return await(0,r.z)(e({paths:["userSession.personalSettings.CryptoFixedSalt","userSession.personalSettings.CryptoUserPayload"]}).pipe((0,f.nb)({success:([e,t])=>{if("string"!=typeof e)throw new Error("Fixed salt is not a string");if("string"!=typeof t)throw new Error("Marker is not a string");return{fixedSalt:e,derivationConfig:this.makeDerivationConfig(t)}},failure:()=>{throw new Error("Failure getting state list")}})))}async getUserMasterPassword(){const{carbonState:e}=this.carbon.queries;return await(0,r.z)(e({path:"userSession.session.masterPassword"}).pipe((0,w.U)((e=>{if(!(0,m.d6)(e))throw new Error("Error when fetching master password from session");const t=e.data;if("string"!=typeof t)throw new Error("Result data is not a string");return(new TextEncoder).encode(t)}))))}async encrypt(e){const t=await this.getUserMasterPassword(),{derivationConfig:s,fixedSalt:i}=await this.getUserCryptoConfig();return await this.flexibleEncryptor.encrypt(e,t,s,V.Nw,{salt:(0,M.R)(i)})}constructor(e,t){this.carbon=e,this.flexibleEncryptor=t}}W=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E._?Object:E._,void 0===K._?Object:K._])],W);var B=s(19911),z=s(43651),q=s(60018),H=s(7165);const Y=H.z.object({lastCheckedIntegrityKeyId:H.z.optional(H.z.string())}),Q=e=>Y.safeParse(e).success;class $ extends((0,R.Q)({persist:!0,storeName:"integrity",codec:q.E,scope:O.F.User,storage:{initialValue:{},schemaVersion:0,typeGuard:Q},isCache:!1,capacity:T.Y._001KB})){}var X=s(48062),Z=s(90993),J=s(63696);class ee{async executeWithParams(e,t){const s=await this.accountRecoveryKeyService.getCurrentPersonalSettings(),i={AccountRecoveryKey:e,AccountRecoveryKeyId:t};if(await this.accountRecoveryKeyService.setPersonalSettings(i),(0,m.hx)(await this.syncService.waitForSync(X.Trigger.SettingsChange)))return await this.accountRecoveryKeyService.setPersonalSettings(s),(0,m.Rn)({tag:N.GENERIC_ERROR});const n=await this.accountRecoveryKeyService.confirmActivation(t);if((0,m.hx)(n))return await this.accountRecoveryKeyService.setPersonalSettings(s),(0,m.hx)(await this.syncService.waitForSync(X.Trigger.SettingsChange))?(0,m.Rn)({tag:N.GENERIC_ERROR}):(0,m.Rn)({tag:n.error.tag});const o=await(0,r.z)(this.session.queries.selectedOpenedSession());if(!(0,m.d6)(o)||!o.data)throw new Error("No users logged in");return await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(o.data),Promise.resolve((0,m.Vp)(void 0))}constructor(e,t,s){this.accountRecoveryKeyService=e,this.syncService=t,this.session=s}}ee=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===x?Object:x,void 0===Z._?Object:Z._,void 0===J.x?Object:J.x])],ee);class te extends((0,l.AJ)()){}const se="authentication_ark_integrity_fixup_web_dev";class ie{async shouldCheck(){const e=await this.arkService.getCurrentRecoveryKey();if(!e.AccountRecoveryKey)return!1;if((await this.store.getState()).lastCheckedIntegrityKeyId===e.AccountRecoveryKeyId)return!1;return await(0,r.z)(this.ffClient.queries.userFeatureFlip({featureFlip:se}).pipe((0,w.U)((e=>((0,m.d6)(e)&&e.data)??!1))))}async updateLastCheck(e){await this.store.set({lastCheckedIntegrityKeyId:e})}async renewEncryptedVaultKeyIfUnusuable(e,t=!1){if(!t&&!await this.shouldCheck())return;const{arkService:s,decryptor:i,encryptor:n}=this,o=await s.getCurrentRecoveryKey();if(!o.AccountRecoveryKey)return;const a=(new TextEncoder).encode(o.AccountRecoveryKey),c=await(0,r.z)(this.server.v1.accountrecovery.getAuthenticatedEncryptedVaultKey());if(!(0,m.d6)(c))throw new Error("Failed to check encrypted vault key on server side");const{data:{encryptedVaultKey:d}}=c.data,l=(0,M.R)(d);await i.decrypt(a,l)===e&&this.logger.log("ARK encryped key has been fixed!");const u=await n.encrypt(a),p=await s.requestActivation((0,B.s)(u));if(!(0,m.d6)(p))throw new Error("Could not get current encrypted VK");const h=p.data,g=await this.activationService.executeWithParams(o.AccountRecoveryKey,h);if(!(0,m.d6)(g))throw new Error("Failed to confirm");await this.updateLastCheck(h)}constructor(e,t,s,i,r,n,o,a){this.arkService=e,this.encryptor=t,this.decryptor=s,this.ffClient=i,this.server=r,this.store=n,this.logger=o,this.activationService=a}}ie=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===x?Object:x,void 0===W?Object:W,void 0===k?Object:k,void 0===z.P?Object:z.P,void 0===I.l?Object:I.l,void 0===$?Object:$,void 0===te?Object:te,void 0===ee?Object:ee])],ie);var re=s(86433),ne=s(85798),oe=s(12723);class ae{async handle({body:{sessionKey:e}}){if("mp"!==e.type)return;const{masterPassword:t}=e;await Promise.race([()=>new Promise((e=>setTimeout(e,100))),this.allowedToFail.doOne((()=>this.service.renewEncryptedVaultKeyIfUnusuable(t)),{methodName:"SessionOpenedEventHandler:handle",criticality:re.T.CRITICAL})])}constructor(e,t){this.service=e,this.allowedToFail=t}}ae=(0,i.gn)([(0,ne.b)(oe.M),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ie?Object:ie,void 0===d.J?Object:d.J])],ae);var ce=s(14160),de=s(24966),le=s(18330),ue=s(57357),pe=s(86051);const he=e=>!0;class ge extends((0,R.Q)({initialValue:void 0,persist:!1,scope:O.F.Device,storeName:"activation-flow-machine",storeTypeGuard:he})){}var me=s(47440),ve=s(7194);var ye=s(9497);class Se{async execute(){try{const e=await(0,r.z)(this.recoveryKeyService.getLastAuthenticatedUserRecoveryData());return Promise.resolve({isFeatureEnabled:e.isEnabled,recoveryKey:"",recoveryId:"",encryptedVaultKey:""})}catch(e){return Promise.reject(new Error("Unable to retrieve initialization data"))}}constructor(e){this.recoveryKeyService=e}}Se=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===x?Object:x])],Se);var we=s(59503),Ee=s(44647);class Ie{async executeWithParams(e){if(e.recoveryKey)return(0,m.Vp)({recoveryKey:e.recoveryKey,encryptedVaultKey:e.encryptedVaultKey,recoveryId:e.recoveryId});const t=await this.accountRecoveryKeyService.generateRecoveryKey();if((0,m.hx)(t))return(0,m.Rn)({tag:N.GENERIC_ERROR});const s=(0,we.u)(t.data.carbonResult.password.toUpperCase()),i=await this.recoveryKeyEncryptor.encrypt(s),r=(0,B.s)(i),n=await this.accountRecoveryKeyService.requestActivation(r);return(0,m.hx)(n)?(0,m.Rn)({tag:n.error.tag}):(0,m.Vp)({recoveryKey:(0,Ee.v)(s),encryptedVaultKey:r,recoveryId:n.data})}constructor(e,t){this.accountRecoveryKeyService=e,this.recoveryKeyEncryptor=t}}Ie=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===x?Object:x,void 0===W?Object:W])],Ie);class Ae{desc(e=!1){const t={config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"ActivationFlowMachine",context:{isFeatureEnabled:!1,recoveryKey:"",recoveryId:"",encryptedVaultKey:""},states:{Starting:{invoke:{src:"initializeMachine",onDone:[{actions:["assignInitialContext"],target:"InitAccountRecoveryKeyActivation",cond:"isActivationFlow"},{actions:["assignInitialContext"],target:"GenerateNewAccountRecoveryKey"}]}},InitAccountRecoveryKeyActivation:{on:{REQUEST_ACTIVATION:{target:"RequestingActivation"}}},RequestingActivation:{invoke:{src:"requestActivation",onDone:[{cond:"isFunctionalError",actions:["assignFunctionalError"],target:"AccountRecoveryKeyActivationError"},{actions:["assignKeys"],target:"DisplayAccountRecoveryKey"}],onError:{actions:["assignGenericError"],target:"AccountRecoveryKeyActivationError"}}},DisplayAccountRecoveryKey:{on:{GO_TO_NEXT_STEP:{target:"ConfirmAccountRecoveryKey"}}},ConfirmAccountRecoveryKey:{on:{GO_TO_NEXT_STEP:{target:"FinalisingAccountRecoveryKeyActivation"},GO_TO_PREV_STEP:{target:"DisplayAccountRecoveryKey"}}},FinalisingAccountRecoveryKeyActivation:{invoke:{src:"confirmActivation",onDone:[{cond:"isFunctionalError",actions:["assignFunctionalError"],target:"AccountRecoveryKeyActivationError"},{target:"AccountRecoveryKeyActivationDone"}],onError:{actions:["assignGenericError"],target:"AccountRecoveryKeyActivationError"}}},AccountRecoveryKeyActivationDone:{},GenerateNewAccountRecoveryKey:{on:{REQUEST_ACTIVATION:{target:"RequestingActivation"},CANCEL_GENERATION:{target:"CancelNewAccountRecoveryKey"}}},CancelNewAccountRecoveryKey:{on:{GO_TO_PREV_STEP:{target:"GenerateNewAccountRecoveryKey"}}},AccountRecoveryKeyActivationError:{on:{GO_TO_PREV_STEP:{target:"RequestingActivation"}}}},on:{RESET_FLOW:{actions:["clearContext"],target:"Starting"}}},options:{actions:{assignInitialContext:(0,me.f0)({encryptedVaultKey:(e,t)=>t.data.encryptedVaultKey,recoveryKey:(e,t)=>t.data.recoveryKey,recoveryId:(e,t)=>t.data.recoveryId,isFeatureEnabled:(e,t)=>t.data.isFeatureEnabled}),assignKeys:(0,me.f0)({recoveryKey:(e,t)=>t.data.data.recoveryKey,encryptedVaultKey:(e,t)=>t.data.data.encryptedVaultKey,recoveryId:(e,t)=>t.data.data.recoveryId}),assignFunctionalError:(0,me.f0)({error:(e,t)=>t.data.error.tag}),assignGenericError:(0,me.f0)({error:()=>N.GENERIC_ERROR}),clearContext:(0,me.f0)({encryptedVaultKey:()=>"",recoveryKey:()=>"",recoveryId:()=>"",error:()=>{}})},services:{initializeMachine:()=>this.initializeMachineService.execute(),requestActivation:e=>this.requestActivationService.executeWithParams(e),confirmActivation:e=>this.confirmActivationService.executeWithParams(e.recoveryKey,e.recoveryId)},guards:{isActivationFlow:(e,t)=>function(e){return e.type.startsWith("done.invoke.ActivationFlowMachine.Starting")}(t)&&!t.data.isFeatureEnabled,isFunctionalError:(e,t)=>(function(e){return e.type.startsWith("done.invoke.ActivationFlowMachine.RequestingActivation")}(t)||function(e){return e.type.startsWith("done.invoke.ActivationFlowMachine.FinalisingAccountRecoveryKeyActivation")}(t))&&(0,m.hx)(t.data)}}};return e&&(0,ye.G)(t.config),t}create(e=!1){const{config:t,options:s}=this.desc(e);return(0,ve.C)(t,s)}constructor(e,t,s){this.initializeMachineService=e,this.requestActivationService=t,this.confirmActivationService=s,this.initializeMachineService=e,this.requestActivationService=t,this.confirmActivationService=s}}Ae=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Se?Object:Se,void 0===Ie?Object:Ie,void 0===ee?Object:ee])],Ae);class fe{async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?pe.ZM.create(JSON.parse(t)):void 0})(this.activationMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[ARK Activation] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[ARK Activation] Unable to start machine",e)}}ready(){return new de.X(!0)}continue(e){if(!this.interpreter)throw new Error("Activation flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}constructor(e,t,s,i){this.activationMachineStore=s,this.allowedToFail=i,this.activationMachineStore=s;const r=e.create(t);this.interpreter=ce.kJ(r).onTransition((0,le.V)((e=>{this.allowedToFail.doOne((()=>{throw e}))}))).onEvent((0,ue.V)((e=>{this.allowedToFail.doOne((()=>{throw e}))}))).onTransition((async()=>{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.activationMachineStore,e)}))}}fe=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ae?Object:Ae,Boolean,void 0===ge?Object:ge,void 0===d.J?Object:d.J])],fe);var be=s(12824),Ce=s(61076);class Oe extends((0,R.Q)({initialValue:{},persist:!1,scope:O.F.Device,storeName:"admin-assisted-recovery-notification",capacity:T.Y._001KB})){}var Re=s(89394);class Te{async acknowledgeRecoveryActivation(){const{commands:e}=this.carbonLegacyClient;return await e.activateAccountRecovery(),await this.store.set({seenAt:Date.now()}),(0,m.Vp)(void 0)}constructor(e,t,s){this.store=e,this.carbonLegacyClient=t,this.vaultAccessClient=s,this.getShouldNotifyOfAARActivation$=()=>{const{carbonState:e}=this.carbonLegacyClient.queries,{queries:t}=this.carbonLegacyClient,s=e({path:"userSession.session.isFirstSessionAfterAccountCreation"}),i=this.vaultAccessClient.queries.isAllowed(),r=t.getIsRecoveryEnabled(),n=t.getNodePremiumStatus(),o=t.getIsSSOUser(),a=t.getRecoveryOptInSetting();return this.store.state$.pipe((0,Ce.V)(i,r,n,o,s,a),(0,w.U)((([e,t,s,i,r,n,o])=>{if((0,m.hx)(t)||(0,m.hx)(s)||(0,m.hx)(i)||(0,m.hx)(r)||(0,m.hx)(n)||(0,m.hx)(o))throw new Error("Failed to query recovery activation notification");const a=(e=>{const t=e.seenAt;return!(!t||(s=1,i=t,Date.now()-i>=36e5*s));var s,i})(e),c=!(d=(0,m.db)(t)).isAllowed&&d.reasons.includes(Re.Oq.Requires2FAEnforcement);var d;const l=Boolean((0,m.db)(n)),u=Boolean((0,m.db)(r)),p=Boolean((0,m.db)(o)),h=Boolean((0,m.db)(s)),g=(e=>!0===e.b2bStatus?.currentTeam?.isSoftDiscontinued)((0,m.db)(i)),v=(({isFirstSessionAfterAccountCreation:e,isSSOUser:t,requires2FAEnforcement:s,accountRecoveryNotificationAlreadyAcknowledged:i,isAdminAssistedRecoveryEnabled:r,isTeamSoftDiscontinued:n,userAdminAssistedRecoveryOptIn:o})=>!(e||t||s||n||i)&&r&&!o)({isFirstSessionAfterAccountCreation:l,isSSOUser:u,requires2FAEnforcement:c,accountRecoveryNotificationAlreadyAcknowledged:a,isAdminAssistedRecoveryEnabled:h,isTeamSoftDiscontinued:g,userAdminAssistedRecoveryOptIn:p});return(0,m.Vp)(v)})))}}}Te=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Oe?Object:Oe,void 0===E._?Object:E._,void 0===be.N?Object:be.N])],Te);const _e=e=>!0;class De extends((0,R.Q)({initialValue:void 0,persist:!1,scope:O.F.Device,storeName:"recovery-flow-machine",storeTypeGuard:_e})){}class Fe{async executeWithParams(e){try{const{authTicket:t}=await this.recoveryKeyService.getAuthTicketInfo(),s=await this.recoveryKeyService.getAccountInfo(e);if((0,m.hx)(s))throw new Error("Unable to retrieve verifications methods for login");return Promise.resolve({authTiket:t??"",accountType:s.data.accountType,verificationMethod:s.data.verificationMethod})}catch(e){return Promise.reject(new Error("Unable to retrieve initialization data"))}}constructor(e){this.recoveryKeyService=e}}Fe=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===x?Object:x])],Fe);class Pe{async executeWithParams({login:e,authTicket:t,recoveryKey:s}){try{const i=await this.accountRecoveryKeyService.getEncryptedVaultKey(e,t);if((0,m.hx)(i))return Promise.reject(N.GENERIC_ERROR);const r=(0,we.u)(s),n=(0,M.R)(i.data.encryptedVaultKey),o=await this.recoveryKeyDecryptor.decrypt(r,n);return Promise.resolve({oldPassword:o})}catch(e){return(i=e)instanceof Error&&i.message.includes("Signature cannot be verified")?Promise.reject(N.WRONG_RECOVERY_KEY_ERROR):Promise.reject(N.GENERIC_ERROR)}var i}constructor(e,t){this.accountRecoveryKeyService=e,this.recoveryKeyDecryptor=t}}Pe=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===x?Object:x,void 0===k?Object:k])],Pe);var Ue=s(95075),Ne=s(12100);class Le{async executeWithParams(e){const{commands:t}=this.carbon;try{const{cleanRemotelyRemovedProfiles:s,registerDevice:i}=this.deviceRegistration.commands,{localAccounts:n}=this.deviceRegistration.queries;await s();const o=await(0,r.z)(n());if((0,m.hx)(o))return Promise.reject(new Error(`[ARK] - Error while fetching local accounts: ${o.error}`));o.data.localAccounts.some((t=>t.login===e.login))||await i({with:"authTicket",login:e.login,authTicket:e.authTicket});const a=await t.openSessionWithMasterPassword({login:e.login,password:e.oldPassword,rememberPassword:!1,requiredPermissions:void 0,loginType:"MasterPasswordARK"});if((0,m.hx)(a))return Promise.reject(new Error(`[ARK] - Error while trying to open session with deciphered recovery key: ${a.error}`));const c=await t.changeMasterPassword({newPassword:e.newPassword,currentPassword:e.oldPassword,flow:Ue.pT.ACCOUNT_RECOVERY_KEY});return(0,m.hx)(c)||!c.data.success?Promise.reject(new Error(`[ARK] - Error while changing user Master Password (${"failure"===c.tag?c.error:""})`)):Promise.resolve(void 0)}catch(e){return Promise.reject(new Error(`[ARK] - Unable to change user Master Password: ${e}`))}}constructor(e,t){this.carbon=e,this.deviceRegistration=t}}Le=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E._?Object:E._,void 0===Ne.z?Object:Ne.z])],Le);var xe=s(54794),Ge=s(67651);class ke{executeWithParams(e,t){try{return this.identityVerification.commands.startIdentityVerification({login:e,verificationMethod:t.type}),Promise.resolve(void 0)}catch(e){return Promise.reject(new Error("Something went wrong..."))}}constructor(e){this.identityVerification=e,this.identityVerification=e}}ke=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===xe||void 0===Ge.l?Object:Ge.l])],ke);var Ke=s(16623);class Me{async executeWithParams(e){const{commands:t}=this.carbon;if(e.newPinCode!==e.confirmedPinCode)return Promise.reject(N.PIN_MISMATCH_ERROR);try{const{cleanRemotelyRemovedProfiles:s,registerDevice:i}=this.deviceRegistration.commands,{localAccounts:n}=this.deviceRegistration.queries;await s();const o=await(0,r.z)(n());if((0,m.hx)(o))return Promise.reject(new Error(`[ARK] - Error while fetching local accounts: ${o.error}`));o.data.localAccounts.some((t=>t.login===e.login))||await i({with:"authTicket",login:e.login,authTicket:e.authTicket});const a=await t.openSessionWithMasterPassword({login:e.login,password:e.oldPassword,rememberPassword:!1,requiredPermissions:void 0,loginType:"PasswordlessARK"});return(0,m.hx)(a)?Promise.reject(new Error(`[ARK] - Error while trying to open session with deciphered recovery key: ${a.error}`)):(await this.pinCode.commands.activate({pinCode:e.newPinCode}),Promise.resolve(void 0))}catch(e){return Promise.reject(N.GENERIC_ERROR)}}constructor(e,t,s){this.carbon=e,this.pinCode=t,this.deviceRegistration=s}}Me=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E._?Object:E._,void 0===Ke.u?Object:Ke.u,void 0===Ne.z?Object:Ne.z])],Me);class je{desc(e=!1){const t={config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Idle",id:"RecoveryFlowMachine",context:{login:"",authTicket:"",newPassword:"",recoveryKey:"",oldPassword:"",encryptedVaultKey:"",newPinCode:"",confirmedPinCode:""},states:{Idle:{entry:["clearContext"],on:{START_RECOVERY_FLOW:{target:"Starting",actions:["assignAccountEmail"]}}},Starting:{invoke:{src:"initializeMachine",onDone:[{actions:["assignInitialContext"],target:"IdentityVerification",cond:"isAuthTicketNeeded"},{actions:["assignInitialContext"],target:"EnterRecoveryKey"}]}},IdentityVerification:{entry:["triggerIdentityVerification"]},EnterRecoveryKey:{on:{SUBMIT_RECOVERY_KEY:{actions:["assignRecoveryKey"],target:"CheckAccountRecoveryKey"}}},CheckAccountRecoveryKey:{invoke:{src:"checkAccountRecoveryKey",onDone:[{actions:["assignOldPassword"],cond:"isPasswordlessUser",target:"EnterPin"},{actions:["assignOldPassword"],target:"ChangeMasterPassword"}],onError:[{actions:["assignError"],cond:"isWrongRecoveryKeyError",target:"EnterRecoveryKey"},{actions:["assignError"],target:"CheckAccountRecoveryKeyError"}]}},CheckAccountRecoveryKeyError:{on:{TRY_AGAIN:{actions:["clearError"],target:"EnterRecoveryKey"}}},EnterPin:{on:{CREATE_PIN:{actions:["assignNewPinCode"],target:"ConfirmPin"}}},ConfirmPin:{on:{SUBMIT_PIN:{actions:["assignConfirmedPinCode"],target:"OpenPasswordlessSession"}}},OpenPasswordlessSession:{invoke:{src:"openPasswordlessSession",onDone:{target:"RecoverySuccess"},onError:[{actions:["assignError"],cond:"isPinMismatchError",target:"ConfirmPin"},{actions:["assignError"],target:"OpenSessionError"}]}},ChangeMasterPassword:{on:{CONFIRM_NEW_PASSWORD:{actions:["assignNewPassword"],target:"FinalisingRecovery"}}},FinalisingRecovery:{invoke:{src:"changeMasterPassword",onDone:{target:"RecoverySuccess"},onError:{actions:["assignError"],target:"OpenSessionError"}}},OpenSessionError:{on:{TRY_AGAIN:[{cond:"isPasswordlessUser",target:"EnterPin"},{target:"ChangeMasterPassword"}]}},RecoverySuccess:{type:"final"}},on:{CLEAR_ERROR:{actions:["clearError"]},IDENTITY_VERIFICATION_COMPLETE:{actions:["assignAuthTicket"],target:"EnterRecoveryKey"},CANCEL_RECOVERY_FLOW:{actions:["clearError"],target:"Idle"}}},options:{actions:{assignAccountEmail:(0,me.f0)({login:(e,t)=>t.login}),assignInitialContext:(0,me.f0)({authTicket:(e,t)=>t.data.authTiket,accountType:(e,t)=>t.data.accountType,verificationMethod:(e,t)=>t.data.verificationMethod}),assignAuthTicket:(0,me.f0)({authTicket:(e,t)=>t.authTicket}),assignNewPassword:(0,me.f0)({newPassword:(e,t)=>t.password}),assignRecoveryKey:(0,me.f0)({recoveryKey:(e,t)=>t.recoveryKey}),assignOldPassword:(0,me.f0)({oldPassword:(e,t)=>t.data.oldPassword}),assignNewPinCode:(0,me.f0)({newPinCode:(e,t)=>t.pinCode}),assignConfirmedPinCode:(0,me.f0)({confirmedPinCode:(e,t)=>t.pinCode}),assignError:(0,me.f0)({error:(e,t)=>t.data}),clearError:(0,me.f0)({error:()=>{}}),triggerIdentityVerification:e=>{if(!e.verificationMethod)throw new Error("No verification method found, initialization went wrong");return this.triggerIdentityVerificationService.executeWithParams(e.login,e.verificationMethod)},clearContext:(0,me.f0)({login:()=>"",newPassword:()=>"",localAccounts:()=>[],recoveryKey:()=>"",oldPassword:()=>"",encryptedVaultKey:()=>"",authTicket:()=>""})},services:{initializeMachine:e=>this.initializeMachineService.executeWithParams(e.login),checkAccountRecoveryKey:e=>this.checkAccountRecoveryKeyService.executeWithParams(e),changeMasterPassword:e=>this.changeMasterPasswordService.executeWithParams(e),openPasswordlessSession:e=>this.openSessionPasswordLessService.executeWithParams(e)},guards:{isAuthTicketNeeded:(e,t)=>!t.data.authTiket,isPasswordlessUser:e=>"invisibleMasterPassword"===e.accountType,isWrongRecoveryKeyError:(e,t)=>t.data===N.WRONG_RECOVERY_KEY_ERROR,isPinMismatchError:(e,t)=>t.data===N.PIN_MISMATCH_ERROR}}};return e&&(0,ye.G)(t.config),t}create(e=!1){const{config:t,options:s}=this.desc(e);return(0,ve.C)(t,s)}constructor(e,t,s,i,r){this.initializeMachineService=e,this.checkAccountRecoveryKeyService=t,this.changeMasterPasswordService=s,this.triggerIdentityVerificationService=i,this.openSessionPasswordLessService=r}}je=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Fe?Object:Fe,void 0===Pe?Object:Pe,void 0===Le?Object:Le,void 0===ke?Object:ke,void 0===Me?Object:Me])],je);class Ve{async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?pe.ZM.create(JSON.parse(t)):void 0})(this.recoveryMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[ARK Recovery] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[ARK Recovery] Unable to start machine",e)}}ready(){return new de.X(!0)}continue(e){if(!this.interpreter)throw new Error("Recovery flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}constructor(e,t,s,i){this.recoveryMachineStore=s,this.allowedToFail=i,this.recoveryMachineStore=s;const r=e.create(t);this.interpreter=ce.kJ(r).onTransition((0,le.V)((e=>this.allowedToFail.doOne((()=>{throw e}))))).onEvent((0,ue.V)((e=>this.allowedToFail.doOne((()=>{throw e}))))).onTransition((async()=>{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.recoveryMachineStore,e)}))}}Ve=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===je?Object:je,Boolean,void 0===De?Object:De,void 0===d.J?Object:d.J])],Ve);var We=s(82874),Be=s(93807);class ze{execute(){return this.recoveryActivationNotification.acknowledgeRecoveryActivation()}constructor(e){this.recoveryActivationNotification=e}}ze=(0,i.gn)([(0,We.W)(Be.yZ),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Te?Object:Te])],ze);var qe=s(22692);class He{execute(){return this.activationFlow.continue({type:"GO_TO_NEXT_STEP"}),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.activationFlow=e}}He=(0,i.gn)([(0,We.W)(qe.Z),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===fe?Object:fe])],He);var Ye=s(64261);class Qe{execute(){return this.activationFlow.continue({type:"GO_TO_PREV_STEP"}),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.activationFlow=e}}Qe=(0,i.gn)([(0,We.W)(Ye.H),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===fe?Object:fe])],Qe);var $e=s(97236);class Xe{execute(){return this.activationFlow.continue({type:"REQUEST_ACTIVATION"}),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.activationFlow=e}}Xe=(0,i.gn)([(0,We.W)($e.e),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===fe?Object:fe])],Xe);var Ze=s(20715);class Je{execute(){return this.activationFlow.continue({type:"RESET_FLOW"}),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.activationFlow=e}}Je=(0,i.gn)([(0,We.W)(Ze.W),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===fe?Object:fe])],Je);var et=s(88254);class tt{execute(){return this.activationFlow.continue({type:"CANCEL_GENERATION"}),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.activationFlow=e}}tt=(0,i.gn)([(0,We.W)(et.r),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===fe?Object:fe])],tt);var st=s(92043);class it{execute(){return this.activationFlow.continue({type:"GO_TO_NEXT_STEP"}),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.activationFlow=e}}it=(0,i.gn)([(0,We.W)(st.W),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===fe?Object:fe])],it);var rt=s(31848);class nt{execute(e){return this.recoveryFlow.continue({type:"CONFIRM_NEW_PASSWORD",password:e.body.password}),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}}nt=(0,i.gn)([(0,We.W)(rt.v),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ve?Object:Ve])],nt);var ot=s(85986);class at{async execute(e){const{reason:t}=e.body,s=await this.accountRecoveryKeyService.deactivate(t);if((0,m.hx)(s))return this.logger.trace("Deactivate ARK: "+s.error.message),(0,m.Rn)({tag:s.error.tag});const i=await(0,r.z)(this.session.queries.selectedOpenedSession());return(0,m.hx)(i)||!i.data?(this.logger.trace("Deactivate ARK - No session opened",{location:"DeactivateCommandHandler",method:"execute()"}),(0,m.Rn)({tag:N.GENERIC_ERROR})):(await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(i.data),this.activationFlow.continue({type:"RESET_FLOW"}),await this.accountRecoveryKeyService.setPersonalSettings({AccountRecoveryKey:void 0,AccountRecoveryKeyId:void 0}),await this.allowedToFail.doOne((()=>this.syncService.waitForSync(X.Trigger.SettingsChange)),{methodName:"waitForSync"}),(0,m.Vp)(void 0))}constructor(e,t,s,i,r,n){this.accountRecoveryKeyService=e,this.activationFlow=t,this.syncService=s,this.logger=i,this.allowedToFail=r,this.session=n}}at=(0,i.gn)([(0,We.W)(ot.E),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===x?Object:x,void 0===fe?Object:fe,void 0===Z._?Object:Z._,void 0===te?Object:te,void 0===d.J?Object:d.J,void 0===J.x?Object:J.x])],at);var ct=s(22463);class dt{execute(e){return this.recoveryFlow.continue({type:"SUBMIT_RECOVERY_KEY",recoveryKey:e.body.recoveryKey}),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.recoveryFlow=e}}dt=(0,i.gn)([(0,We.W)(ct.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ve?Object:Ve])],dt);var lt=s(4842);class ut{execute(){return this.recoveryFlow.continue({type:"TRY_AGAIN"}),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.recoveryFlow=e}}ut=(0,i.gn)([(0,We.W)(lt.d),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ve?Object:Ve])],ut);var pt=s(92350),ht=s(53932);class gt{execute(){return this.recoveryFlow.continue({type:"CANCEL_RECOVERY_FLOW"}),this.cqrsClient.getClient(o.i).commands.cancelIdentityVerification(),Promise.resolve((0,m.Vp)(void 0))}constructor(e,t){this.recoveryFlow=e,this.cqrsClient=t,this.recoveryFlow=e}}gt=(0,i.gn)([(0,We.W)(pt.b),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ve?Object:Ve,void 0===ht.w?Object:ht.w])],gt);var mt=s(21382);class vt{execute(e){const{login:t}=e.body;return this.recoveryFlow.continue({type:"START_RECOVERY_FLOW",login:t}),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}}vt=(0,i.gn)([(0,We.W)(mt.Q),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ve?Object:Ve])],vt);var yt=s(38443);class St{execute(){return this.recoveryFlow.continue({type:"CLEAR_ERROR"}),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.recoveryFlow=e}}St=(0,i.gn)([(0,We.W)(yt.u),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ve?Object:Ve])],St);var wt=s(33608);class Et{execute(e){return this.recoveryFlow.continue({type:"CREATE_PIN",pinCode:e.body.pinCode}),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}}Et=(0,i.gn)([(0,We.W)(wt.f),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ve?Object:Ve])],Et);var It=s(37240);class At{execute(e){return this.recoveryFlow.continue({type:"SUBMIT_PIN",pinCode:e.body.pinCode}),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}}At=(0,i.gn)([(0,We.W)(It.W),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ve?Object:Ve])],At);var ft=s(7366);class bt{handle(e){const{authTicket:t}=e.body;return this.recoveryFlow.continue({type:"IDENTITY_VERIFICATION_COMPLETE",authTicket:t}),Promise.resolve()}constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}}bt=(0,i.gn)([(0,ne.b)(ft.w),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ve?Object:Ve])],bt);var Ct=s(46449),Ot=s(85606);class Rt{execute(){return this.recoveryActivationNotification.getShouldNotifyOfAARActivation$()}constructor(e){this.recoveryActivationNotification=e}}Rt=(0,i.gn)([(0,Ct.e)(Ot.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Te?Object:Te])],Rt);var Tt=s(85390),_t=s(37182),Dt=s(6136),Ft=s(31856),Pt=s(69885),Ut=s(6220),Nt=function(e){return e[e.InitActivation=0]="InitActivation",e[e.RequestActivation=1]="RequestActivation",e[e.DisplayKey=2]="DisplayKey",e[e.ConfirmKey=3]="ConfirmKey",e[e.FinaliseActivation=4]="FinaliseActivation",e[e.ActivationDone=5]="ActivationDone",e[e.ShowError=6]="ShowError",e[e.GenerateNewKey=7]="GenerateNewKey",e[e.CancelGenerateNewKey=8]="CancelGenerateNewKey",e}({}),Lt=function(e){return e[e.InitRecovery=0]="InitRecovery",e[e.IdentityVerification=1]="IdentityVerification",e[e.EnterRecoveryKey=2]="EnterRecoveryKey",e[e.ChangeMasterPassword=3]="ChangeMasterPassword",e[e.EnterPin=4]="EnterPin",e[e.ConfirmPin=5]="ConfirmPin",e[e.Finalising=6]="Finalising",e[e.Success=7]="Success",e[e.Failure=8]="Failure",e}({});const xt=e=>(0,Pt.of)((0,m.Vp)(function(e){if(!e.matches("Starting")){if(e.matches("InitAccountRecoveryKeyActivation"))return{step:Nt.InitActivation,isFeatureEnabled:e.context.isFeatureEnabled};if(e.matches("RequestingActivation"))return{step:Nt.RequestActivation,isFeatureEnabled:e.context.isFeatureEnabled};if(e.matches("DisplayAccountRecoveryKey"))return{step:Nt.DisplayKey,recoveryKey:e.context.recoveryKey,isFeatureEnabled:e.context.isFeatureEnabled};if(e.matches("ConfirmAccountRecoveryKey"))return{step:Nt.ConfirmKey,recoveryKey:e.context.recoveryKey,isFeatureEnabled:e.context.isFeatureEnabled};if(e.matches("FinalisingAccountRecoveryKeyActivation"))return{step:Nt.FinaliseActivation,isFeatureEnabled:e.context.isFeatureEnabled};if(e.matches("AccountRecoveryKeyActivationDone"))return{step:Nt.ActivationDone,isFeatureEnabled:e.context.isFeatureEnabled};if(e.matches("AccountRecoveryKeyActivationError"))return{step:Nt.ShowError,error:e.context.error,isFeatureEnabled:e.context.isFeatureEnabled};if(e.matches("GenerateNewAccountRecoveryKey"))return{step:Nt.GenerateNewKey,isFeatureEnabled:e.context.isFeatureEnabled};if(e.matches("CancelNewAccountRecoveryKey"))return{step:Nt.CancelGenerateNewKey,isFeatureEnabled:e.context.isFeatureEnabled};throw new Error(`[ARK Activation] - No view associated to state ${JSON.stringify(e.value)}`)}}(e))),Gt=e=>e.pipe((0,Ut.z)(xt));var kt=s(54389);const Kt=(e,t)=>{const s=t.matches(e.value),i=(0,kt.Z)(e.context,t.context);return s&&i};class Mt{execute(){return(0,Tt.a)([(e=this.activationFlowMachineStore,e.state$.pipe((0,w.U)((e=>e?pe.ZM.create(JSON.parse(e)):void 0)))),this.activationFlow.ready()],((e,t)=>{if(e&&t)return e})).pipe((0,S.h)(Boolean),(0,Dt.x)(((e,t)=>Kt(e,t))),Gt,(0,_t.K)(((e,t)=>(this.logger.error("Error retrieveing account recovery key activation view data",{location:"ActivationFlowStatusQueryHandler",method:"execute()",error:e}),t))));var e}constructor(e,t,s){this.activationFlow=e,this.activationFlowMachineStore=t,this.logger=s}}Mt=(0,i.gn)([(0,Ct.e)(Ft.S),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===fe?Object:fe,void 0===ge?Object:ge,void 0===te?Object:te])],Mt);var jt=s(43978),Vt=s(74062);class Wt{execute({body:e}){const{login:t}=e;return""===t?(0,Pt.of)((0,m.Vp)({isEnabled:!1})):this.accountRecoveryKeyService.getLastAuthenticatedUserRecoveryData().pipe((0,jt.w)((async e=>(void 0!==e.isEnabled&&t===e.login||await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(t),e))),(0,w.U)((e=>(0,m.Vp)({isEnabled:e.isEnabled}))))}constructor(e){this.accountRecoveryKeyService=e}}Wt=(0,i.gn)([(0,Ct.e)(Vt.D),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===x?Object:x])],Wt);var Bt=s(74564);class zt{execute(){const e=this.session.queries.selectedOpenedSession().pipe((0,jt.w)((e=>{if(!(0,m.d6)(e)||!e.data)throw new Error("no user provided ");return this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(e.data)})),(0,jt.w)((()=>this.carbonLegacyClient.queries.carbonState({path:"userSession.personalSettings.RecoveryOptIn"}))),(0,S.h)(m.d6),(0,w.U)((e=>"boolean"==typeof e.data&&e.data))),t=this.accountRecoveryKeyService.getLastAuthenticatedUserRecoveryData().pipe((0,w.U)((e=>void 0!==e.isEnabled&&e.isEnabled)));return(0,Tt.a)([e,t]).pipe((0,w.U)((([e,t])=>(0,m.Vp)({adminAssistedRecovery:e,accountRecoveryKey:t}))))}constructor(e,t,s){this.accountRecoveryKeyService=e,this.carbonLegacyClient=t,this.session=s}}zt=(0,i.gn)([(0,Ct.e)(Bt.V),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===x?Object:x,void 0===E._?Object:E._,void 0===J.x?Object:J.x])],zt);var qt=s(92253);const Ht=e=>(0,Pt.of)((0,m.Vp)(function(e){if(e.matches("Starting"))return{step:Lt.InitRecovery,error:e.context.error};if(e.matches("IdentityVerification"))return{step:Lt.IdentityVerification,login:e.context.login};if(e.matches("EnterRecoveryKey")||e.matches("CheckAccountRecoveryKey"))return{step:Lt.EnterRecoveryKey,error:e.context.error,accountType:e.context.accountType};if(e.matches("ChangeMasterPassword"))return{step:Lt.ChangeMasterPassword,error:e.context.error};if(e.matches("EnterPin"))return{step:Lt.EnterPin,error:e.context.error};if(e.matches("ConfirmPin"))return{step:Lt.ConfirmPin,error:e.context.error,pinCode:e.context.newPinCode};if(e.matches("FinalisingRecovery")||e.matches("OpenPasswordlessSession"))return{step:Lt.Finalising};if(e.matches("RecoverySuccess"))return{step:Lt.Success};if(e.matches("CheckAccountRecoveryKeyError")||e.matches("OpenSessionError"))return{step:Lt.Failure};throw new Error(`[ARK Recovery] - No view associated to state ${JSON.stringify(e.value)}`)}(e))),Yt=e=>e.pipe((0,Ut.z)(Ht));class Qt{execute(){return(0,Tt.a)([(e=this.recoveryFlowMachineStore,e.state$.pipe((0,w.U)((e=>e?pe.ZM.create(JSON.parse(e)):void 0)))),this.recoveryFlow.ready()],((e,t)=>{if(e&&t)return e})).pipe((0,S.h)(Boolean),(0,Dt.x)(((e,t)=>Kt(e,t))),Yt,(0,_t.K)(((e,t)=>(this.logger.error("Error retrieving account recovery view data",{location:"RecoveryFlowStatusQueryHandler",method:"execute()",error:e}),t))));var e}constructor(e,t,s){this.recoveryFlow=e,this.recoveryFlowMachineStore=t,this.logger=s}}Qt=(0,i.gn)([(0,Ct.e)(qt.y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ve?Object:Ve,void 0===De?Object:De,void 0===te?Object:te])],Qt);class $t{async executeWithParams(e,t){const s=await this.accountRecoveryKeyService.deactivate(t);return(0,m.hx)(s)?(this.logger.trace("Deactivate ARK: "+s.error.message),(0,m.Rn)({tag:s.error.tag})):(await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(e),this.activationFlow.continue({type:"RESET_FLOW"}),await this.accountRecoveryKeyService.setPersonalSettings({AccountRecoveryKey:void 0,AccountRecoveryKeyId:void 0}),await this.allowedToFail.doOne((()=>this.syncService.waitForSync(X.Trigger.SettingsChange)),{methodName:"waitForSync"}),(0,m.Vp)(void 0))}constructor(e,t,s,i,r){this.accountRecoveryKeyService=e,this.activationFlow=t,this.syncService=s,this.logger=i,this.allowedToFail=r}}$t=(0,i.gn)([(0,A.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===x?Object:x,void 0===fe?Object:fe,void 0===Z._?Object:Z._,void 0===te?Object:te,void 0===d.J?Object:d.J])],$t);class Xt{}Xt=(0,i.gn)([(0,a.Y)({api:n.j,stores:[ge,De,D,Oe,$],imports:[h.n,g.D,y.R],handlers:{commands:{acknowledgeRecoveryActivation:ze,goToActivationNextStep:He,goToActivationPrevStep:Qe,requestActivation:Xe,resetActivationFlow:Je,cancelGeneration:tt,confirmActivation:it,confirmNewPassword:nt,deactivate:at,submitRecoveryKey:dt,tryAgainRecovery:ut,cancelRecoveryFlow:gt,startRecoveryFlow:vt,clearWrongRecoveryKeyError:St,createPin:Et,submitPin:At},events:{...(0,a.g)(o.i,{identityVerificationCompleted:bt}),...(0,a.g)(v.Q,{sessionOpened:ae})},queries:{shouldNotifyOfRecoveryActivation:Rt,activationFlowStatus:Mt,accountRecoveryKeyStatus:Wt,recoveryMethodsInfo:zt,recoveryFlowStatus:Qt}},providers:[...(0,c.H)(fe,{inject:[Ae,ge,u.c,d.J],asyncFactory:async(e,t,s,i)=>{let n=!1;const o=await(0,r.z)(s.queries.platformInfo());!(0,m.d6)(o)||o.data.buildType!==p.P.DEV&&o.data.buildType!==p.P.NIGHTLY||(n=!0);const a=new fe(e,n,t,i);return await a.prepare(),a}}),...(0,c.H)(Ve,{inject:[je,De,u.c,d.J],asyncFactory:async(e,t,s,i)=>{let n=!1;const o=await(0,r.z)(s.queries.platformInfo());!(0,m.d6)(o)||o.data.buildType!==p.P.DEV&&o.data.buildType!==p.P.NIGHTLY||(n=!0);const a=new Ve(e,n,t,i);return await a.prepare(),a}}),Ae,je,Se,Fe,Pe,ke,x,Ie,ee,k,W,Le,Me,$t,ie,Te,(0,l.ND)(te)],requiredFeatureFlips:[se]})],Xt)},66811:(e,t,s)=>{s.d(t,{X:()=>d});var i=s(75958),r=s(45315),n=s(2551),o=s(43179),a=s(95822),c=s(6641);const d=(0,i.Q)({name:"accountCreation",commands:{createPasswordlessAccount:r.ck,markMassDeployFirstInitDone:n.$,requestTeamInviteTokenSending:o.V},events:{},queries:{accountCreationMassDeployPolicies:a.d,inviteLinkData:c.$}})},45315:(e,t,s)=>{s.d(t,{G2:()=>n,ck:()=>o});var i=s(13385),r=s(62149);const n=(0,s(98124).Vj)("NetworkError","The user appears offline");class o extends((0,i.g)({scope:r.F.Device})){}},2551:(e,t,s)=>{s.d(t,{$:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},43179:(e,t,s)=>{s.d(t,{V:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},95822:(e,t,s)=>{s.d(t,{d:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},6641:(e,t,s)=>{s.d(t,{$:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},57978:(e,t,s)=>{s.d(t,{v:()=>u});var i=s(75958),r=s(559),n=s(62508),o=s(25298),a=s(58402),c=s(30247),d=s(77588),l=s(52688);const u=(0,i.Q)({name:"accountManagement",commands:{acceptTeamInvite:r.c,initChangeLoginEmail:n.j,completeChangeLoginEmail:o.b,resendVerificationCode:a.h,changeTeamMembersLoginEmail:c.C},events:{},queries:{changeLoginEmailStatus:d.w,pendingLoginChangeRequests:l.A}})},559:(e,t,s)=>{s.d(t,{c:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},30247:(e,t,s)=>{s.d(t,{C:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},25298:(e,t,s)=>{s.d(t,{b:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},62508:(e,t,s)=>{s.d(t,{j:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},58402:(e,t,s)=>{s.d(t,{h:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},77588:(e,t,s)=>{s.d(t,{v:()=>n,w:()=>o});var i=s(77535),r=s(62149),n=function(e){return e.TOKEN_VALIDATION_FAILED="TOKEN_VALIDATION_FAILED",e.LOGIN_CHANGE_FAILED="LOGIN_CHANGE_FAILED",e}({});class o extends((0,i.k)({scope:r.F.Device})){}},52688:(e,t,s)=>{s.d(t,{A:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},35936:(e,t,s)=>{s.d(t,{l:()=>a});var i=s(75958),r=s(32389),n=s(59020),o=s(75449);const a=(0,i.Q)({name:"accountReferral",commands:{inviteByEmail:r.PI},events:{},queries:{getSharingLink:n.h,getInvitationsHistory:o.g}})},32389:(e,t,s)=>{s.d(t,{PI:()=>o,qM:()=>n});var i=s(13385),r=s(62149);const n=(0,s(98124).Vj)("user_already_exists","The user invited already exists");class o extends((0,i.g)({scope:r.F.User})){}},75449:(e,t,s)=>{s.d(t,{g:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},59020:(e,t,s)=>{s.d(t,{h:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},12892:(e,t,s)=>{s.d(t,{d:()=>c});var i=s(75958),r=s(84238),n=s(68817),o=s(81377),a=s(65104);const c=(0,i.Q)({name:"deleteOrResetAccount",commands:{completeFlow:r.I,initiateFlow:n.O},events:{},queries:{userAuthenticationMethod:o.c,isFlowCompleted:a.h}})},84238:(e,t,s)=>{s.d(t,{I:()=>a,O:()=>o});var i=s(13385),r=s(62149),n=s(7165),o=function(e){return e.INVALID_OTP_ALREADY_USED="INVALID_OTP_ALREADY_USED",e.INVALID_OTP_BLOCKED="INVALID_OTP_BLOCKED",e.VERIFICATION_FAILED="VERIFICATION_FAILED",e.ACCOUNT_BLOCKED_CONTACT_SUPPORT="ACCOUNT_BLOCKED_CONTACT_SUPPORT",e.VERIFICATION_REQUIRES_REQUEST="VERIFICATION_REQUIRES_REQUEST",e.VERIFICATION_TIMEOUT="VERIFICATION_TIMEOUT",e}({});n.z.object({tag:n.z.nativeEnum(o)});class a extends((0,i.g)({scope:r.F.Device})){}},68817:(e,t,s)=>{s.d(t,{O:()=>a,U:()=>o});var i=s(13385),r=s(62149),n=s(7165),o=function(e){return e.UNKNOWN_USER="user_not_found",e.SSO_BLOCKED="SSO_BLOCKED",e}({});n.z.object({tag:n.z.nativeEnum(o)});class a extends((0,i.g)({scope:r.F.Device})){}},65104:(e,t,s)=>{s.d(t,{h:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},81377:(e,t,s)=>{s.d(t,{c:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},20691:(e,t,s)=>{s.d(t,{N:()=>n});var i=s(75958),r=s(25200);const n=(0,i.Q)({name:"subscriptionCode",commands:{},events:{},queries:{getSubscriptionCode:r.aD}})},95115:(e,t,s)=>{s.d(t,{_:()=>n});var i=s(8260),r=s(20691);class n extends((0,i.E)(r.N)){}(0,i.K)(r.N,n)},25200:(e,t,s)=>{s.d(t,{KJ:()=>n,aD:()=>o});var i=s(77535),r=s(62149);const n=(0,s(98124).Vj)("no_key_for_user","The user appears offline");class o extends((0,i.k)({scope:r.F.User})){}},63481:(e,t,s)=>{s.d(t,{Z:()=>Ee});var i=s(92336),r=s(66811),n=s(86006),o=s(41511),a=s(40416),c=s(45368);var d=s(78346),l=s(92587);class u{}class p extends u{async retrieveAccountCreationBrowserPolicies(){try{const e=await(0,c.U)();return void 0===e?(0,d.Vp)({teamKey:"",isExtensionMassDeployed:!1}):(0,d.Vp)({teamKey:e.team_key||"",isExtensionMassDeployed:e.is_extension_mass_deployed||!1})}catch{return(0,d.Vp)({teamKey:"",isExtensionMassDeployed:!1})}}}p=(0,i.gn)([(0,l.GS)()],p);var h=s(62149),g=s(63144),m=s(56618),v=s(60018);const y=e=>!(!e||"object"!=typeof e)&&("firstMassDeployOpening"in e&&"teamKey"in e);class S extends((0,g.Q)({codec:v.E,persist:!0,scope:h.F.Device,storeName:"account-creation-browser-policies-store",capacity:m.Y._001KB,storage:{schemaVersion:1,initialValue:{firstMassDeployOpening:!0,teamKey:""},typeGuard:y}})){}class w{async onFrameworkInit(){const{firstMassDeployOpening:e}=await this.acBrowserPoliciesStore.getState(),t=await this.massDeployBrowserPoliciesService.retrieveAccountCreationBrowserPolicies();(0,d.ty)(t,(({teamKey:t,isExtensionMassDeployed:s})=>{this.acBrowserPoliciesStore.set({teamKey:t,firstMassDeployOpening:e&&s})}))}constructor(e,t){this.acBrowserPoliciesStore=e,this.massDeployBrowserPoliciesService=t}}w=(0,i.gn)([(0,l.ar)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S?Object:S,void 0===u?Object:u])],w);var E=s(7165),I=function(e){return e.LOADING="loading",e.NOT_LOADED="not_loaded",e.READY="ready",e}({}),A=function(e){return e.TEAM_DOES_NOT_EXIST="TEAM_DOES_NOT_EXIST",e.USER_NOT_PROPOSED_IN_TEAM="USER_NOT_PROPOSED_IN_TEAM",e.USER_TEAM_INVITE_TOKEN_NOT_FOUND="USER_TEAM_INVITE_TOKEN_NOT_FOUND",e}({});E.z.object({tag:E.z.nativeEnum(A)});class f extends((0,g.Q)({persist:!1,scope:h.F.Device,storeName:"invite-link-store",initialValue:{status:I.NOT_LOADED},capacity:m.Y._001KB})){}var b=s(82874),C=s(45315),O=s(14122),R=s(52477),T=s(85465),_=s(60399),D=s(41842),F=s(63696),P=s(16623),U=s(63604),N=s(53344),L=s(66329),x=s(82059),G=s(48702),k=s(17591),K=s(78776);const M="ZZ";function j(e){return!e||e.length<2||e.length>5?M:e}const V="und";function W(e){return!e||e.length<2||e.length>5?V:e}const B="Device";function z(e){return e||B}function q(e){return e?e.replace(/https?:\/\//g," "):e}function H(){return`{${(0,K.Z)().toUpperCase()}}`}var Y=s(19911),Q=s(60605),$=s(75711),X=s(98894),Z=s(28868),J=s(93704),ee=s(12100);class te{async createAccount({login:e,accountType:t,password:s,consents:i,deviceName:r}){const n=await(0,_.z)(this.platformInfoClient.queries.platformInfo());if(!(0,d.d6)(n))throw new Error("failed to get platform info");const o=n.data,a=Math.round(Date.now()/1e3),c=this.random.get(16),l=function({AnonymousUserId:e,CryptoFixedSalt:t,CryptoUserPayload:s,UsagelogToken:i,accountCreationDatetime:r}){return`<?xml version="1.0" encoding="UTF-8"?>\n<root>\n    <KWSettingsManagerApp> \n        <KWDataItem key="AnonymousUserId"><![CDATA[${e}]]></KWDataItem>\n        <KWDataItem key="CryptoFixedSalt"><![CDATA[${t}]]></KWDataItem>\n        <KWDataItem key="CryptoUserPayload"><![CDATA[${s}]]></KWDataItem>  \n        <KWDataItem key="SyncBackup"><![CDATA[YES]]></KWDataItem>\n        <KWDataItem key="UsagelogToken"><![CDATA[${i}]]></KWDataItem>\n        <KWDataItem key="accountCreationDatetime"><![CDATA[${r}]]></KWDataItem>\n    </KWSettingsManagerApp>\n</root>`}({accountCreationDatetime:a,AnonymousUserId:H(),CryptoFixedSalt:(0,Y.s)(c),CryptoUserPayload:"$1$argon2d$16$3$32768$2$aes256$cbchmac$16$",Login:e,UsagelogToken:H()}),u=(0,Q.n)((new TextEncoder).encode(l)),p=async e=>await this.flexibleEncryptor.encrypt((new TextEncoder).encode(s),e,Z.mr,J.Nw,{salt:c}),h=await p(u),{privateKey:g,publicKey:m}=await this.rsaKeyGenerator.generate(),v=(0,$.R)(g),y=(0,X.y)(m),S=await p((new TextEncoder).encode(v));if("server_carbon_unknown"===o.platformName)throw new Error("Invalid platform info");const w=await(0,_.z)(this.serverApiClient.v1.account.createUser({appVersion:o.appVersion,consents:[{consentType:"emailsOffersAndTips",status:i.offers},{consentType:"privacyPolicyAndToS",status:i.tosAndPrivacy}],country:j(o.country),deviceName:z(q(r)),language:W(o.lang),login:e,osCountry:j(o.country),osLanguage:W(o.lang),platform:o.platformName,settings:{time:a,content:(0,Y.s)(h)},sharingKeys:{publicKey:y,privateKey:(0,Y.s)(S)},temporaryDevice:!1,accountType:t,contactEmail:e}));if(!(0,d.d6)(w))return(0,R.EQ)(w.error,{BusinessError:()=>(0,k.j)("failed to create account"),FetchFailedError:()=>(0,d.Rn)((0,C.G2)()),InternalServerError:()=>(0,k.j)("failed to create account"),InvalidRequest:()=>(0,k.j)("failed to create account"),RateLimited:()=>(0,k.j)("failed to create account"),ServiceUnavailable:()=>(0,k.j)("failed to create account"),UnspecifiedBadStatus:()=>(0,k.j)("failed to create account")});const{deviceAccessKey:E,deviceSecretKey:I,userAnalyticsId:A}=w.data.data,f=await this.deviceRegistration.commands.registerDevice({with:"deviceKeys",deviceAccessKey:E,deviceSecretKey:I,login:e,settings:(0,Y.s)(h),userAnalyticsId:A,deviceName:r,ignoreAlreadyRegisteredError:!0});return(0,d.d6)(f)?(0,d.Vp)(void 0):(0,R.EQ)(f.error,{DeviceAlreadyRegistered:()=>(0,k.j)("failed to register device in carbon"),InvalidTokenError:()=>(0,k.j)("failed to register device in carbon"),NetworkError:()=>(0,d.Rn)((0,C.G2)())})}constructor(e,t,s,i,r,n){this.serverApiClient=e,this.platformInfoClient=t,this.random=s,this.flexibleEncryptor=i,this.rsaKeyGenerator=r,this.deviceRegistration=n}}te=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===N.l?Object:N.l,void 0===U.c?Object:U.c,void 0===L.Y?Object:L.Y,void 0===x._?Object:x._,void 0===G.e?Object:G.e,void 0===ee.z?Object:ee.z])],te);const se={avoidAmbiguous:!1,length:40,letters:!0,digits:!0,symbols:!0};class ie{async execute({body:{consents:e,email:t,pinCode:s,deviceName:i}}){const r=(0,T.generate)(se),n=await this.creator.createAccount({accountType:"invisibleMasterPassword",login:t,consents:e,password:r,deviceName:i});if(!(0,d.d6)(n))return(0,R.EQ)(n.error,{NetworkError:e=>(0,d.Rn)(e)});const o=await this.carbon.commands.openSessionWithMasterPassword({login:t,password:r,rememberPassword:!1,requiredPermissions:void 0,loginType:"PasswordlessAccountCreation"});if(!(0,d.d6)(o))throw new Error("failed to login in carbon");return await(0,_.z)(this.session.queries.selectedOpenedSession().pipe((0,D.h)((e=>(0,d.d6)(e)&&e.data===t)))),await this.pinCode.commands.activate({pinCode:s}),(0,d.Vp)(void 0)}constructor(e,t,s,i){this.creator=e,this.carbon=t,this.session=s,this.pinCode=i}}ie=(0,i.gn)([(0,b.W)(C.ck),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===te?Object:te,void 0===O._?Object:O._,void 0===F.x?Object:F.x,void 0===P.u?Object:P.u])],ie);var re=s(2551);class ne{async execute(){const e=await this.acBrowserPoliciesStore.getState();return this.acBrowserPoliciesStore.set({...e,firstMassDeployOpening:!1}),(0,d.Vp)(void 0)}constructor(e){this.acBrowserPoliciesStore=e}}ne=(0,i.gn)([(0,b.W)(re.$),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S?Object:S])],ne);var oe=s(43179),ae=s(33312);class ce{constructor(e,t){this.serverApiClient=e,this.inviteLinkStore=t,this.getFunctionalError=e=>{switch(e){case A.TEAM_DOES_NOT_EXIST:return{tag:A.TEAM_DOES_NOT_EXIST};case A.USER_NOT_PROPOSED_IN_TEAM:return{tag:A.USER_NOT_PROPOSED_IN_TEAM};case A.USER_TEAM_INVITE_TOKEN_NOT_FOUND:return{tag:A.USER_TEAM_INVITE_TOKEN_NOT_FOUND};default:throw new Error(`RequestTeamInviteToken: error ${e}`)}},this.loadInviteLinkData=async e=>{const t=await this.inviteLinkStore.getState();if(t.status===I.LOADING||t.status===I.READY&&e===t.teamKey)return;await this.inviteLinkStore.set({status:I.LOADING});const s=await(0,_.z)(this.serverApiClient.v1.teams.getTeamSignUpPage({teamKey:e}).pipe((0,ae.Qn)((({data:e})=>e))));if((0,d.hx)(s))return this.inviteLinkStore.set({status:I.NOT_LOADED});const{disabled:i,displayName:r,teamUuid:n}=s.data;return this.inviteLinkStore.set({teamKey:e,teamUuid:n,displayName:r,disabled:i,status:I.READY})},this.requestTeamInviteTokenSending=(e,t)=>(0,_.z)(this.serverApiClient.v1.teams.requestTeamInviteToken({login:e,teamUuid:t}).pipe((0,ae.DZ)((e=>(0,R.EQ)(e,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:()=>{throw new Error("Fetch Failed error")},InternalServerError:k.j,InvalidRequest:k.j,RateLimited:k.j,ServiceUnavailable:k.j,UnspecifiedBadStatus:k.j}))),(0,ae.Qn)((({data:e})=>e))))}}ce=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===N.l?Object:N.l,void 0===f?Object:f])],ce);class de{async execute({body:e}){const{login:t,teamUuid:s}=e,i=await this.inviteLinkService.requestTeamInviteTokenSending(t,s);return(0,d.hx)(i)?Promise.resolve(i):(0,d.Vp)(void 0)}constructor(e){this.inviteLinkService=e}}de=(0,i.gn)([(0,b.W)(oe.V),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ce?Object:ce])],de);var le=s(6136),ue=s(87065),pe=s(62760),he=s(46449),ge=s(95822);class me{execute(){return this.acBrowserPoliciesStore.state$.pipe((0,le.x)(pe.shallowEqualObjects),(0,ue.U)(d.Vp))}constructor(e){this.acBrowserPoliciesStore=e}}me=(0,i.gn)([(0,he.e)(ge.d),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S?Object:S])],me);var ve=s(69885),ye=s(25859),Se=s(6641);class we{execute({body:e}){const{teamKey:t}=e;return""===t?(0,ve.of)((0,d.Vp)(null)):(0,ye.P)((()=>(this.inviteLinkService.loadInviteLinkData(t),this.inviteLinkStore.state$.pipe((0,ue.U)((e=>e.status!==I.READY?(0,d.Vp)(null):(0,d.Vp)({teamKey:e.teamKey,teamUuid:e.teamUuid,displayName:e.displayName,disabled:e.disabled})))))))}constructor(e,t){this.inviteLinkStore=e,this.inviteLinkService=t}}we=(0,i.gn)([(0,he.e)(Se.$),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===f?Object:f,void 0===ce?Object:ce])],we);class Ee{}Ee=(0,i.gn)([(0,n.Y)({api:r.X,providers:[{provide:u,useClass:p},te,ce],exports:[u],onFrameworkInit:[w],stores:[S,f],handlers:{commands:{createPasswordlessAccount:ie,markMassDeployFirstInitDone:ne,requestTeamInviteTokenSending:de},events:{},queries:{accountCreationMassDeployPolicies:me,inviteLinkData:we}},imports:[o.n,a.D]})],Ee)},93849:(e,t,s)=>{s.d(t,{c:()=>j});var i=s(92336),r=s(86006),n=s(41511),o=s(57978),a=function(e){return e.ChangeLoginEmailWebDev="account_management_change_login_email_web_dev",e}({}),c=s(82874),d=s(78346),l=s(559),u=s(60399),p=s(92587),h=s(53344),g=s(33312),m=s(52477),v=s(17591);class y{async acceptTeamInvite(e){return await(0,u.z)(this.serverClient.v1.teams.acceptTeamInvite({inviteToken:e}).pipe((0,g.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>({tag:e.code}),FetchFailedError:v.j,InternalServerError:v.j,InvalidRequest:v.j,RateLimited:v.j,ServiceUnavailable:v.j,UnspecifiedBadStatus:v.j}))),(0,g.lk)(d.Vp)))}constructor(e){this.serverClient=e}}y=(0,i.gn)([(0,p.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.l?Object:h.l])],y);class S{async execute({body:{token:e}}){const t=await this.teamInviteService.acceptTeamInvite(e);if(!(0,d.d6)(t))throw new Error("Request to accept invite failed");return(0,d.Vp)(void 0)}constructor(e){this.teamInviteService=e}}S=(0,i.gn)([(0,c.W)(l.c),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===y?Object:y])],S);var w=s(69885),E=s(63696);class I{async requestChangeLoginEmail(e){return await(0,u.z)(this.serverClient.v1.user.requestLoginChange({newLogin:e}).pipe((0,g.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>({tag:e.code}),FetchFailedError:v.j,InternalServerError:v.j,InvalidRequest:v.j,RateLimited:v.j,ServiceUnavailable:v.j,UnspecifiedBadStatus:v.j}))),(0,g.lk)(d.Vp)))}async completeChangeLoginEmail(e){return await(0,u.z)(this.serverClient.v1.user.completeLoginChange({validationToken:e}).pipe((0,g.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>({tag:e.code}),FetchFailedError:v.j,InternalServerError:v.j,InvalidRequest:v.j,RateLimited:v.j,ServiceUnavailable:v.j,UnspecifiedBadStatus:v.j}))),(0,g.lk)(d.Vp)))}async changeLoginEmailForTeamMembers(e){return await(0,u.z)(this.serverClient.v1.teams.requestLoginChange({users:e}).pipe((0,g.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>({tag:e.code}),FetchFailedError:v.j,InternalServerError:v.j,InvalidRequest:v.j,RateLimited:v.j,ServiceUnavailable:v.j,UnspecifiedBadStatus:v.j}))),(0,g.lk)(d.Vp)))}async resendLoginChangeToken(){return await(0,u.z)(this.serverClient.v1.user.sendLoginChangeToken().pipe((0,g.DZ)(v.j),(0,g.lk)(d.Vp)))}getChangeLoginEmailRequests(){return(0,w.of)([])}async migrateSessionDataAndChangeEmail(e){const t=await(0,u.z)(this.sessionClient.queries.selectedOpenedSession());if(!(0,d.d6)(t)||!t.data)throw new Error("Current user's email not found");const s=await(0,u.z)(this.serverClient.v1.sync.getLatestContent({needsKeys:!1,teamAdminGroups:!1,transactions:["SETTINGS_userId"],timestamp:0}));if(!(0,d.d6)(s))throw new Error("Could not retrieve user's PersonalSettings");const i=s.data.data.transactions.find((e=>"BACKUP_EDIT"===e.action&&"SETTINGS"===e.type));if(!i||"BACKUP_REMOVE"===i.action)throw new Error("Could not retrieve user's PersonalSettings in user's transactions");const r=await this.sessionClient.commands.copyUserDataAndOpenSession({currentEmail:t.data,newEmail:e,personalSettings:i});if(!(0,d.d6)(r))throw new Error(`Error while migrating user session details: ${r.error.tag}`);return(0,d.Vp)(void 0)}constructor(e,t){this.sessionClient=e,this.serverClient=t}}I=(0,i.gn)([(0,p.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E.x?Object:E.x,void 0===h.l?Object:h.l])],I);var A=s(62508);class f{async execute({body:e}){const t=await this.changeLoginEmailService.requestChangeLoginEmail(e.newEmail);if(!(0,d.d6)(t)){const{tag:e}=t.error;if("LOGIN_UNAVAILABLE"===e)return(0,d.Rn)({tag:e});throw new Error("Request to change login email failed")}return(0,d.Vp)(void 0)}constructor(e){this.changeLoginEmailService=e}}f=(0,i.gn)([(0,c.W)(A.j),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I?Object:I])],f);var b=s(50423),C=s(77588),O=s(25298),R=s(62149),T=s(63144),_=s(56618);class D extends((0,T.Q)({persist:!1,scope:R.F.Device,storeName:"change-login-email",initialValue:{status:"no_request"},capacity:_.Y._001KB})){}class F{async execute({body:{newEmail:e,verificationCode:t}}){await this.changeLoginEmailStore.set({status:"in_progress"});return await this.allowedToFail.doOne((async()=>{const s=await this.changeLoginEmailService.completeChangeLoginEmail(t);(0,d.d6)(s)?(await this.changeLoginEmailService.migrateSessionDataAndChangeEmail(e),await this.changeLoginEmailStore.set({status:"success"})):await this.changeLoginEmailStore.set({status:"failed",error:C.v[s.error.tag]})}),{criticality:"critical",methodName:"change-login-email"})||await this.changeLoginEmailStore.set({status:"failed",error:C.v.LOGIN_CHANGE_FAILED}),(0,d.Vp)(void 0)}constructor(e,t,s){this.changeLoginEmailService=e,this.changeLoginEmailStore=t,this.allowedToFail=s}}F=(0,i.gn)([(0,c.W)(O.b),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I?Object:I,void 0===D?Object:D,void 0===b.J?Object:b.J])],F);var P=s(58402);class U{async execute(){return await this.changeLoginEmailService.resendLoginChangeToken(),(0,d.Vp)(void 0)}constructor(e){this.changeLoginEmailService=e}}U=(0,i.gn)([(0,c.W)(P.h),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I?Object:I])],U);var N=s(87065),L=s(46449);class x{execute(){return this.store.state$.pipe((0,N.U)((e=>(0,d.Vp)(e))))}constructor(e){this.store=e}}x=(0,i.gn)([(0,L.e)(C.w),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===D?Object:D])],x);var G=s(52688);class k{execute(){return this.service.getChangeLoginEmailRequests().pipe((0,N.U)((e=>(0,d.Vp)(e))))}constructor(e){this.service=e}}k=(0,i.gn)([(0,L.e)(G.A),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I?Object:I])],k);var K=s(30247);class M{async execute({body:e}){const t=await this.changeLoginEmailService.changeLoginEmailForTeamMembers(e);return(0,d.d6)(t)?(0,d.Vp)(void 0):(0,d.Rn)({tag:t.error.tag})}constructor(e){this.changeLoginEmailService=e}}M=(0,i.gn)([(0,c.W)(K.C),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I?Object:I])],M);class j{}j=(0,i.gn)([(0,r.Y)({api:o.v,imports:[n.n],providers:[I,y],stores:[D],handlers:{commands:{acceptTeamInvite:S,initChangeLoginEmail:f,completeChangeLoginEmail:F,resendVerificationCode:U,changeTeamMembersLoginEmail:M},events:{},queries:{changeLoginEmailStatus:x,pendingLoginChangeRequests:k}},domainName:"account",requiredFeatureFlips:Object.values(a)})],j)},12770:(e,t,s)=>{s.d(t,{o:()=>C});var i=s(92336),r=s(86006),n=s(35936);var o=s(41511),a=s(60399),c=s(82874),d=s(32389),l=s(25200),u=s(95115),p=s(53344),h=s(78346),g=s(87065),m=s(92587);class v{async getIsExistingLogin(e){const t=this.serverApiClient.v1.authentication.get2FaStatusUnauthenticated({login:e});return await(0,a.z)(t.pipe((0,g.U)((e=>(0,h.d6)(e)))))}constructor(e){this.serverApiClient=e}}v=(0,i.gn)([(0,m.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.l?Object:p.l])],v);class y{async execute({body:{email:e}}){try{const t=await(0,a.z)(this.subscriptionCodeApi.queries.getSubscriptionCode());if(await this.accountExistsService.getIsExistingLogin(e))return(0,h.Rn)((0,d.qM)());if(!(0,h.d6)(t))return(0,h.Rn)((0,l.KJ)());const s=await(0,a.z)(this.serverApiClient.v1.invitation.invite({userKey:t.data,identifiers:[e],type:"manual"}));if((0,h.hx)(s))throw new Error("InviteByEmailCommand failure: something went wrong in call to /invitation/invite");return(0,h.Vp)(void 0)}catch(e){throw new Error("InviteByEmailCommand failure: something went wrong in execute method")}}constructor(e,t,s){this.serverApiClient=e,this.accountExistsService=t,this.subscriptionCodeApi=s}}y=(0,i.gn)([(0,c.W)(d.PI),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.l?Object:p.l,void 0===v?Object:v,void 0===u._?Object:u._])],y);var S=s(34987),w=s(46449),E=s(59020),I=s(33312);class A{execute(){return this.subscriptionCodeApi.queries.getSubscriptionCode().pipe((0,S.b)((e=>this.serverApiClient.v1.invitation.getSharingLink({userKey:"success"===e.tag?e.data:""}).pipe((0,I.Qn)((e=>e.data)),(0,I.DZ)((e=>{throw new Error(e.message)}))))))}constructor(e,t){this.serverApiClient=e,this.subscriptionCodeApi=t}}A=(0,i.gn)([(0,w.e)(E.h),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.l?Object:p.l,void 0===u._?Object:u._])],A);var f=s(75449);class b{execute(){return this.serverApiClient.v1.invitation.getInvitationsHistory().pipe((0,I.Qn)((e=>e.data)),(0,I.DZ)((e=>(0,h.Rn)({tag:`GetInvitationsHistoryQueryHandler failure: ${e.message}`}))))}constructor(e){this.serverApiClient=e}}b=(0,i.gn)([(0,w.e)(f.g),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.l?Object:p.l])],b);class C{}C=(0,i.gn)([(0,r.Y)({api:n.l,imports:[o.n],handlers:{commands:{inviteByEmail:y},events:{},queries:{getSharingLink:A,getInvitationsHistory:b}},providers:[v],requiredFeatureFlips:[...Object.values({B2bReferralProd:"activationRetention_web_b2b_referrals_prod"})]})],C)},99813:(e,t,s)=>{s.d(t,{T:()=>U});var i=s(92336),r=s(86006),n=s(41511),o=s(12892),a=s(60399),c=s(87065),d=s(84238),l=s(68817),u=s(92587),p=s(53344),h=s(33312),g=s(52477),m=s(17591),v=s(78346);class y{getAuthenticationMethodsForReset(e){return this.serverApiClient.v1.authentication.getAuthenticationMethodsForReset({login:e,methods:["email_token","totp"]}).pipe((0,h.DZ)((e=>(0,g.EQ)(e,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:()=>{throw new Error("Fetch Failed error")},BadStatus:m.j,InternalServerError:m.j,InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j,UnspecifiedBadStatus:m.j}))),(0,h.Qn)((e=>{if(e.data.verifications.length>=1)return e.data.verifications[0].type;throw new Error("GetAuthenticationMethodsForReset: couldn't retrieve any method")})))}requestEmailTokenVerificationSending(e){return(0,a.z)(this.serverApiClient.v1.authentication.requestEmailTokenVerification({login:e}).pipe((0,c.U)((e=>(0,v.d6)(e)))))}getVerifyTokenFunctionalError(e){switch(e){case"invalid_otp_already_used":return{tag:d.O.INVALID_OTP_ALREADY_USED};case"invalid_otp_blocked":return{tag:d.O.INVALID_OTP_BLOCKED};case"verification_failed":return{tag:d.O.VERIFICATION_FAILED};case"account_blocked_contact_support":return{tag:d.O.ACCOUNT_BLOCKED_CONTACT_SUPPORT};case"verification_requires_request":return{tag:d.O.VERIFICATION_REQUIRES_REQUEST};case"verification_timeout":return{tag:d.O.VERIFICATION_TIMEOUT};default:throw new Error("performTokenVerification: Business error not handled")}}verifyTOTPToken(e,t){return(0,a.z)(this.serverApiClient.v1.authentication.performTotpVerification({login:e,otp:t,intent:"account_delete_or_reset"}).pipe((0,h.DZ)((e=>(0,g.EQ)(e,{BusinessError:e=>this.getVerifyTokenFunctionalError(e.code),FetchFailedError:m.j,BadStatus:m.j,InternalServerError:m.j,InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j,UnspecifiedBadStatus:m.j}))),(0,h.Qn)((e=>e.data.authTicket))))}verifyEmailToken(e,t){return(0,a.z)(this.serverApiClient.v1.authentication.performEmailTokenVerification({login:e,token:t,intent:"account_delete_or_reset"}).pipe((0,h.DZ)((e=>(0,g.EQ)(e,{BusinessError:e=>this.getVerifyTokenFunctionalError(e.code),FetchFailedError:m.j,BadStatus:m.j,InternalServerError:m.j,InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j,UnspecifiedBadStatus:m.j}))),(0,h.Qn)((e=>e.data.authTicket))))}deleteOrResetAccount(e,t,s=!0){return(0,a.z)(this.serverApiClient.v1.account.deleteOrResetAccount({authTicket:t,isDelete:s,login:e}).pipe((0,h.DZ)((e=>(0,g.EQ)(e,{BusinessError:m.j,FetchFailedError:m.j,BadStatus:m.j,InternalServerError:m.j,InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j,UnspecifiedBadStatus:m.j}))),(0,h.Qn)((()=>!0))))}constructor(e){this.serverApiClient=e,this.getFunctionalError=e=>{switch(e){case l.U.UNKNOWN_USER:return{tag:l.U.UNKNOWN_USER};case l.U.SSO_BLOCKED:return{tag:l.U.SSO_BLOCKED};default:throw new Error(`GetAuthenticationMethodsForReset: error ${e}`)}}}}y=(0,i.gn)([(0,u.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.l?Object:p.l])],y);var S=s(62149),w=s(63144),E=s(56618);class I extends((0,w.Q)({persist:!1,scope:S.F.Device,storeName:"account-deletion",initialValue:{login:"",userAuthenticationMethod:null,isFlowCompleted:!1},capacity:E.Y._001KB})){}var A=function(e){return e.EMAIL="EMAIL",e.TOTP="TOTP",e}({}),f=s(82874),b=s(50423),C=s(14122);class O{async execute({body:e}){const{token:t,isDelete:s}=e,i=await this.deleteOrResetAccountStore.getState(),{userAuthenticationMethod:r,login:n}=i,o=r===A.EMAIL?await this.deleteOrResetAccountService.verifyEmailToken(n,t):await this.deleteOrResetAccountService.verifyTOTPToken(n,t);if((0,v.hx)(o))return Promise.resolve(o);const a=await this.deleteOrResetAccountService.deleteOrResetAccount(n,o.data,s);if((0,v.hx)(a))throw new Error("CompleteFlowCommand : error while deleting the account");return this.deleteOrResetAccountStore.set({...i,isFlowCompleted:!0}),await this.allowedToFail.doOne((async()=>this.carbonLegacy.commands.cleanRemotelyRemovedProfiles())),Promise.resolve((0,v.Vp)(void 0))}constructor(e,t,s,i){this.deleteOrResetAccountStore=e,this.deleteOrResetAccountService=t,this.carbonLegacy=s,this.allowedToFail=i}}O=(0,i.gn)([(0,f.W)(d.I),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I?Object:I,void 0===y?Object:y,void 0===C._?Object:C._,void 0===b.J?Object:b.J])],O);class R{async execute({body:e}){const{login:t}=e,s=await(0,a.z)(this.deleteOrResetAccountService.getAuthenticationMethodsForReset(t).pipe((0,h.Qn)((e=>"email_token"===e?A.EMAIL:A.TOTP))));if((0,v.hx)(s))return Promise.resolve(s);s.data===A.EMAIL&&this.deleteOrResetAccountService.requestEmailTokenVerificationSending(t);const i=await this.deleteOrResetAccountStore.getState();return await this.deleteOrResetAccountStore.set({...i,login:t,userAuthenticationMethod:s.data}),Promise.resolve((0,v.Vp)(void 0))}constructor(e,t){this.deleteOrResetAccountStore=e,this.deleteOrResetAccountService=t}}R=(0,i.gn)([(0,f.W)(l.O),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I?Object:I,void 0===y?Object:y])],R);var T=s(46449),_=s(81377);class D{execute(){return this.deleteOrResetAccountStore.state$.pipe((0,c.U)((e=>(0,v.Vp)(e.userAuthenticationMethod))))}constructor(e){this.deleteOrResetAccountStore=e}}D=(0,i.gn)([(0,T.e)(_.c),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I?Object:I])],D);var F=s(65104);class P{execute(){return this.deleteOrResetAccountStore.state$.pipe((0,c.U)((e=>(0,v.Vp)(e.isFlowCompleted))))}constructor(e){this.deleteOrResetAccountStore=e}}P=(0,i.gn)([(0,T.e)(F.h),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I?Object:I])],P);class U{}U=(0,i.gn)([(0,r.Y)({api:o.d,handlers:{commands:{completeFlow:O,initiateFlow:R},events:{},queries:{userAuthenticationMethod:D,isFlowCompleted:P}},stores:[I],imports:[n.n],providers:[y]})],U)},79925:(e,t,s)=>{s.d(t,{q:()=>D});var i=s(92336),r=s(41511),n=s(65862),o=s(86006),a=s(20691),c=s(12723),d=s(85798),l=s(60399),u=s(92587),p=s(53344),h=s(33312),g=s(78346),m=s(7165),v=s(62149),y=s(63144),S=s(56618),w=s(60018);const E=m.z.object({code:m.z.string().nullable(),error:m.z.union([m.z.string(),m.z.undefined()])}),I=e=>E.safeParse(e).success;class A extends((0,y.Q)({storage:{schemaVersion:1,initialValue:{code:null},typeGuard:I},persist:!0,scope:v.F.User,storeName:"plan-cancellation-store",capacity:S.Y._001KB,codec:w.E})){}class f{async refresh(){const e=await(0,l.z)(this.serverApiClient.v1.premium.getSubscriptionCode({}).pipe((0,h.Qn)((({data:e})=>e))));(0,g.d6)(e)?this.subscriptionCodeStore.set({code:e.data.subscriptionCode}):this.subscriptionCodeStore.set({code:null,error:e.error.message})}constructor(e,t){this.serverApiClient=e,this.subscriptionCodeStore=t}}f=(0,i.gn)([(0,u.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.l?Object:p.l,void 0===A?Object:A])],f);class b{async handle(){this.subscriptionCodeService.refresh()}constructor(e){this.subscriptionCodeService=e}}b=(0,i.gn)([(0,d.b)(c.M),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===f?Object:f])],b);var C=s(87065),O=s(6136),R=s(46449),T=s(25200);class _{execute(){return this.subscriptionCodeStore.state$.pipe((0,C.U)((e=>"no_key_for_user"!==e.error&&e.code?(0,g.Vp)(e.code):(0,g.Rn)((0,T.KJ)()))),(0,O.x)())}constructor(e){this.subscriptionCodeStore=e}}_=(0,i.gn)([(0,R.e)(T.aD),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===A?Object:A])],_);class D{}D=(0,i.gn)([(0,o.Y)({api:a.N,handlers:{commands:{},events:{...(0,o.g)(n.Q,{sessionOpened:b})},queries:{getSubscriptionCode:_}},stores:[A],imports:[r.n],providers:[f]})],D)},11526:(e,t,s)=>{s.d(t,{D:()=>n});var i=s(75958),r=s(89689);const n=(0,i.Q)({name:"overrides",commands:{},events:{},queries:{OverridesQuery:r.N}})},89689:(e,t,s)=>{s.d(t,{N:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},50618:(e,t,s)=>{s.d(t,{x:()=>g});var i=s(92336),r=s(86006);var n=s(11526),o=s(47830),a=s(46449),c=s(89689),d=s(78346),l=s(1598),u=s(87065);class p{execute(){return this.rfuClient.streamFileUpdate().pipe((0,u.U)((e=>(0,d.Vp)({overrides:e}))))}constructor(e){this.rfuClient=e}}p=(0,i.gn)([(0,a.e)(c.N),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===l.w?Object:l.w])],p);const h=(0,o.Q)("overrides.json",(e=>null!=e&&"object"==typeof e&&Object.values(e).every((e=>Array.isArray(e)&&e.every((e=>(e=>{if(!e||"object"!=typeof e)return!1;const t="type"in e&&void 0!==e.type&&("startsWith"===e.type||"regexp"===e.type),s="value"in e&&void 0!==e.value&&(Array.isArray(e.value)&&e.value.every((e=>"string"==typeof e))||"string"==typeof e.value),i="conditions"in e&&void 0!==e.conditions&&Array.isArray(e.conditions)&&e.conditions.every((e=>(e=>{const t="type"in e&&void 0!==e.type&&("css"===e.type||"xpath"===e.type),s="selector"in e&&void 0!==e.selector&&"string"==typeof e.selector;return t&&s})(e))),r="actions"in e&&void 0!==e.actions&&Array.isArray(e.actions)&&e.actions.every((e=>(e=>{const t="type"in e&&void 0!==e.type&&("set"===e.type||"ignore"===e.type),s="cssSelector"in e&&void 0!==e.cssSelector&&"string"==typeof e.cssSelector;return t&&s})(e)));return t&&s&&i&&r})(e)))))));class g{}g=(0,i.gn)([(0,r.Y)({api:n.D,composes:[h],handlers:{commands:{},events:{},queries:{overrides:p}}})],g)},30153:(e,t,s)=>{s.d(t,{e:()=>n});var i=s(8260),r=s(21738);class n extends((0,i.E)(r.V)){}(0,i.K)(r.V,n)},21738:(e,t,s)=>{s.d(t,{V:()=>o});var i=s(75958),r=s(93780),n=s(39650);const o=(0,i.Q)({name:"authenticationFlow",commands:{changeLogin:n.hW,changeTwoFactorAuthenticationOtpType:n.eG,clearError:n.jq,cancelDeviceTransferRequest:n.Yc,resendEmailToken:n.Gc,resendPushNotification:n.rF,sendAccountEmail:n.A,sendMasterPassword:n.rT,submitPinCode:n.CO,submitBackupCode:n.sH,submitEmailToken:n.XH,submitTotp:n.ad,switchToDevicetoDeviceAuthentication:n.sU,switchToDashlaneAuthenticator:n.K1,switchToMasterPasswordCommand:n.On,switchToEmailToken:n.v5,switchToPinCode:n.WF,retryWebAuthnAuthentication:n.M6,webAuthnAuthenticationFail:n.O3,logout:n.N5,lockSession:n.Y$,loginViaSSO:n.yv,initiateLoginWithSSO:n.Hr,initiateAutologinWithSSOCommand:n.x2},queries:{authenticationFlowStatus:r.DW,getSsoUserSettings:r.Dc,getProviderInfo:r.L2},events:{}})},39650:(e,t,s)=>{s.d(t,{A:()=>n,CO:()=>a,Gc:()=>v,Hr:()=>O,K1:()=>l,M6:()=>I,N5:()=>f,O3:()=>A,On:()=>c,WF:()=>u,XH:()=>p,Y$:()=>b,Yc:()=>T,ad:()=>h,eG:()=>m,hW:()=>o,jq:()=>E,rF:()=>S,rT:()=>y,sH:()=>g,sU:()=>d,v5:()=>w,x2:()=>R,yv:()=>C});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}class o extends((0,i.g)({scope:r.F.Device})){}class a extends((0,i.g)({scope:r.F.Device})){}class c extends((0,i.g)({scope:r.F.Device})){}class d extends((0,i.g)({scope:r.F.Device})){}class l extends((0,i.g)({scope:r.F.Device})){}class u extends((0,i.g)({scope:r.F.Device})){}class p extends((0,i.g)({scope:r.F.Device})){}class h extends((0,i.g)({scope:r.F.Device})){}class g extends((0,i.g)({scope:r.F.Device})){}class m extends((0,i.g)({scope:r.F.Device})){}class v extends((0,i.g)({scope:r.F.Device})){}class y extends((0,i.g)({scope:r.F.Device})){}class S extends((0,i.g)({scope:r.F.Device})){}class w extends((0,i.g)({scope:r.F.Device})){}class E extends((0,i.g)({scope:r.F.Device})){}class I extends((0,i.g)({scope:r.F.Device})){}class A extends((0,i.g)({scope:r.F.Device})){}class f extends((0,i.g)({scope:r.F.Device})){}class b extends((0,i.g)({scope:r.F.Device})){}class C extends((0,i.g)({scope:r.F.Device})){}class O extends((0,i.g)({scope:r.F.Device})){}class R extends((0,i.g)({scope:r.F.Device})){}class T extends((0,i.g)({scope:r.F.Device})){}},93780:(e,t,s)=>{s.d(t,{DW:()=>n,Dc:()=>o,L2:()=>a});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}class o extends((0,i.k)({scope:r.F.Device})){}class a extends((0,i.k)({scope:r.F.Device})){}},8606:(e,t,s)=>{s.d(t,{E6:()=>r,UY:()=>n,ao:()=>o,hr:()=>i,vX:()=>a});var i=function(e){return e.SSO="sso",e.MP="master_password",e}({}),r=function(e){return e.WaitingForTransferRequest="WaitingForTransferRequest",e.DisplayInstructions="DisplayInstructions",e.LoadingPassphrase="LoadingPassphrase",e.DisplayPassphrase="DisplayPassphrase",e.LoadingAccount="LoadingAccount",e.Error="Error",e.DeviceRegistered="DeviceRegistered",e}({}),n=function(e){return e.GENERIC_ERROR="GENERIC_ERROR",e.TIMEOUT="TIMEOUT",e.REQUEST_REJECTED="REQUEST_REJECTED",e.ACCOUNT_ERROR="ACCOUNT_ERROR",e.RATE_LIMIT="RATE_LIMIT",e}({});const o=e=>Object.values(n).includes(e);var a=function(e){return e[e.MP_TO_SSO=0]="MP_TO_SSO",e[e.MP_TO_SSO_WITH_INFO=1]="MP_TO_SSO_WITH_INFO",e[e.SSO_TO_MP=2]="SSO_TO_MP",e}({})},20491:(e,t,s)=>{s.r(t),s.d(t,{AuthenticationFlowClient:()=>a.e,AuthenticationFlowStatusQuery:()=>n.DW,CancelDeviceTransferRequestCommand:()=>r.Yc,ChangeAccountEmailCommand:()=>r.hW,ChangeTwoFactorAuthenticationOtpTypeCommand:()=>r.eG,ClearErrorCommand:()=>r.jq,DeviceToDeviceAuthenticationErrors:()=>o.UY,DeviceToDeviceAuthenticationFlowStep:()=>o.E6,GetSsoProviderInfoQuery:()=>n.L2,GetSsoUserSettingsQuery:()=>n.Dc,InitiateAutologinWithSSOCommand:()=>r.x2,InitiateLoginWithSSOCommand:()=>r.Hr,LockCommand:()=>r.Y$,LoginViaSSOCommand:()=>r.yv,LogoutCommand:()=>r.N5,ResendEmailTokenCommand:()=>r.Gc,ResendPushNotificationCommand:()=>r.rF,RetryWebAuthnAuthenticationCommand:()=>r.M6,SSOMigrationType:()=>o.vX,SendAccountEmailCommand:()=>r.A,SendMasterPasswordCommand:()=>r.rT,SsoMigrationServerMethod:()=>o.hr,SubmitBackupCodeCommand:()=>r.sH,SubmitEmailTokenCommand:()=>r.XH,SubmitPinCodeCommand:()=>r.CO,SubmitTotpCommand:()=>r.ad,SwitchToDashlaneAuthenticatorCommand:()=>r.K1,SwitchToDevicetoDeviceAuthenticationCommand:()=>r.sU,SwitchToEmailTokenCommand:()=>r.v5,SwitchToMasterPasswordCommand:()=>r.On,SwitchToPinCodeCommand:()=>r.WF,WebAuthnAuthenticationFailCommand:()=>r.O3,authenticationFlowApi:()=>i.V,isDeviceToDeviceAuthenticationError:()=>o.ao});var i=s(21738),r=s(39650),n=s(93780),o=s(8606),a=s(30153)},70063:(e,t,s)=>{s.d(t,{n:()=>n});var i=s(75958),r=s(91984);const n=(0,i.Q)({name:"authentication",commands:{},events:{},queries:{canLockApp:r._}})},91984:(e,t,s)=>{s.d(t,{I:()=>n,_:()=>o});var i=s(77535),r=s(62149);const n="USER_NOT_LOGGED_IN";class o extends((0,i.k)({scope:r.F.User,noUserError:{tag:n}})){}},25252:(e,t,s)=>{s.d(t,{G:()=>a});var i=s(75958),r=s(3552),n=s(6648),o=s(36205);const a=(0,i.Q)({name:"deviceRegistration",commands:{cleanRemotelyRemovedProfiles:r.L,registerDevice:n.J},events:{},queries:{localAccounts:o.a}})},12100:(e,t,s)=>{s.d(t,{z:()=>n});var i=s(8260),r=s(25252);class n extends((0,i.E)(r.G)){}(0,i.K)(r.G,n)},3552:(e,t,s)=>{s.d(t,{L:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},6648:(e,t,s)=>{s.d(t,{J:()=>a,Y:()=>o});var i=s(13385),r=s(62149),n=s(7165);const o=n.z.discriminatedUnion("with",[n.z.object({with:n.z.literal("token"),login:n.z.string(),token:n.z.string(),deviceName:n.z.optional(n.z.string()),ignoreAlreadyRegisteredError:n.z.optional(n.z.boolean())}),n.z.object({with:n.z.literal("authTicket"),login:n.z.string(),authTicket:n.z.string(),deviceName:n.z.optional(n.z.string()),ignoreAlreadyRegisteredError:n.z.optional(n.z.boolean())}),n.z.object({with:n.z.literal("deviceKeys"),login:n.z.string(),deviceName:n.z.optional(n.z.string()),ignoreAlreadyRegisteredError:n.z.optional(n.z.boolean()),deviceAccessKey:n.z.string(),deviceSecretKey:n.z.string(),settings:n.z.string(),userAnalyticsId:n.z.string(),serverKey:n.z.optional(n.z.string())})]);class a extends((0,i.g)({scope:r.F.Device})){}},36205:(e,t,s)=>{s.d(t,{a:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},88170:(e,t,s)=>{s.d(t,{F:()=>u});var i=s(75958),r=s(88240),n=s(69121),o=s(13960),a=s(35974),c=s(2585),d=s(81181),l=s(63408);const u=(0,i.Q)({name:"deviceTransfer",commands:{refreshRequest:r.V,cancelRequest:n.b,approveRequest:o.G,rejectRequest:a.a,submitPassphraseChallenge:c.I,returnToDeviceSetupCommand:d.n},events:{},queries:{trustedDeviceFlowStatus:l.N}})},13960:(e,t,s)=>{s.d(t,{G:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},69121:(e,t,s)=>{s.d(t,{b:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},88240:(e,t,s)=>{s.d(t,{V:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},35974:(e,t,s)=>{s.d(t,{a:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},81181:(e,t,s)=>{s.d(t,{n:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},2585:(e,t,s)=>{s.d(t,{I:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},63408:(e,t,s)=>{s.d(t,{N:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},77043:(e,t,s)=>{s.d(t,{S:()=>i,T:()=>r});var i=function(e){return e.GENERIC_ERROR="GENERIC_ERROR",e.INVALID_PASSPHRASE="INVALID_PASSPHRASE",e.TIMEOUT="TIMEOUT",e.PASSPHRASE_ATTEMPTS_LIMIT="PASSPHRASE_ATTEMPTS_LIMIT",e}({}),r=function(e){return e[e.WaitingForNewDeviceRequest=0]="WaitingForNewDeviceRequest",e[e.NewDeviceRequestAvailable=1]="NewDeviceRequestAvailable",e[e.DisplayPassphraseChallenge=2]="DisplayPassphraseChallenge",e[e.DeviceTransferComplete=3]="DeviceTransferComplete",e[e.LoadingChallenge=4]="LoadingChallenge",e[e.DeviceTransferRejected=5]="DeviceTransferRejected",e[e.Error=6]="Error",e}({})},89742:(e,t,s)=>{s.d(t,{i:()=>a});var i=s(75958),r=s(306),n=s(13284),o=s(7366);const a=(0,i.Q)({name:"identityVerificationFlow",commands:{changeTwoFactorAuthenticationOtpType:n.eG,clearError:n.$5,resendEmailToken:n.Gc,resendPushNotification:n.rF,submitBackupCode:n.sH,submitEmailToken:n.XH,submitTotp:n.ad,switchToDashlaneAuthenticator:n.K1,switchToEmailToken:n.v5,startIdentityVerification:n.qw,cancelIdentityVerification:n.Vs},queries:{identityVerificationFlowStatus:r.O},events:{identityVerificationCompleted:o.w}})},13284:(e,t,s)=>{s.d(t,{$5:()=>o,Gc:()=>a,K1:()=>p,Vs:()=>m,XH:()=>d,ad:()=>u,eG:()=>n,qw:()=>g,rF:()=>c,sH:()=>l,v5:()=>h});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}class o extends((0,i.g)({scope:r.F.Device})){}class a extends((0,i.g)({scope:r.F.Device})){}class c extends((0,i.g)({scope:r.F.Device})){}class d extends((0,i.g)({scope:r.F.Device})){}class l extends((0,i.g)({scope:r.F.Device})){}class u extends((0,i.g)({scope:r.F.Device})){}class p extends((0,i.g)({scope:r.F.Device})){}class h extends((0,i.g)({scope:r.F.Device})){}class g extends((0,i.g)({scope:r.F.Device})){}class m extends((0,i.g)({scope:r.F.Device})){}},7366:(e,t,s)=>{s.d(t,{w:()=>n});var i=s(446),r=s(62149);class n extends((0,i.d)({scope:r.F.Device})){}},306:(e,t,s)=>{s.d(t,{O:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},67651:(e,t,s)=>{s.d(t,{l:()=>n});var i=s(8260),r=s(89742);class n extends((0,i.E)(r.i)){}(0,i.K)(r.i,n)},54794:(e,t,s)=>{s.r(t),s.d(t,{CancelIdentityVerificationCommand:()=>r.Vs,ChangeTwoFactorAuthenticationOtpTypeCommand:()=>r.eG,ClearIdentityVerificationErrorCommand:()=>r.$5,IdentityVerificationClient:()=>o.l,IdentityVerificationCompletedEvent:()=>a.w,IdentityVerificationFlowStatusQuery:()=>n.O,ResendEmailTokenCommand:()=>r.Gc,ResendPushNotificationCommand:()=>r.rF,StartIdentityVerificationCommand:()=>r.qw,SubmitBackupCodeCommand:()=>r.sH,SubmitEmailTokenCommand:()=>r.XH,SubmitTotpCommand:()=>r.ad,SwitchToDashlaneAuthenticatorCommand:()=>r.K1,SwitchToEmailTokenCommand:()=>r.v5,identityVerificationFlowApi:()=>i.i});var i=s(89742),r=s(13284),n=s(306),o=s(67651),a=s(7366)},58713:(e,t,s)=>{s.r(t),s.d(t,{ActivateCommand:()=>C.r,AuthenticationClient:()=>k,AuthenticationFlowContracts:()=>r,CanLockAppQuery:()=>x._,CleanRemotelyRemovedProfilesCommand:()=>E.L,DeactivateCommand:()=>O.E,DeviceRegistrationClient:()=>f.z,DeviceTransferContracts:()=>i,GetCurrentUserStatusQuery:()=>_.o,GetStatusQuery:()=>T.D,IdentityVerificationFlowContracts:()=>n,IsPinCodeCorrectQuery:()=>D.M,LocalAccountsQuery:()=>A.a,LoginWithPinCodeCommand:()=>R.c,NO_ACTIVE_PIN_CODE:()=>N.DN,PinCodeClient:()=>F.u,PinCodeServerApiConfig:()=>U,RegisterDeviceCommand:()=>I.J,Request2FaCodesByPhoneCommand:()=>v.x,Request2FaCodesByPhoneErrorCodes:()=>y.A,USER_NOT_LOGGED_IN:()=>x.I,UserVerificationMethods:()=>S.W,UserVerificationMethodsQuery:()=>S.Y,ValidateWebauthnAssertionCommand:()=>v.L,WRONG_PIN_CODE:()=>N.Vh,authenticationApi:()=>L.n,createNoActivePinCodeError:()=>N.Zs,createWrongPinCodeError:()=>N.g5,deviceRegistrationApi:()=>w.G,pinCodeApi:()=>b.n,registrationSchema:()=>I.Y,userVerificationApi:()=>m.M});var i={};s.r(i),s.d(i,{ApproveDeviceTransferRequestCommand:()=>d.G,CancelRequestCommand:()=>p.b,RefreshRequestCommand:()=>c.V,RejectDeviceTransferRequestCommand:()=>l.a,ReturnToDeviceSetupCommand:()=>h.n,SubmitPassphraseChallengeCommand:()=>u.I,TrustedDeviceFlowErrors:()=>a.S,TrustedDeviceFlowStatusQuery:()=>g.N,TrustedDeviceFlowStep:()=>a.T,deviceTransferApi:()=>o.F});var r=s(20491),n=s(54794),o=s(88170),a=s(77043),c=s(88240),d=s(13960),l=s(35974),u=s(2585),p=s(69121),h=s(81181),g=s(63408),m=s(8504),v=s(19197),y=s(34224),S=s(3689),w=s(25252),E=s(3552),I=s(6648),A=s(36205),f=s(12100),b=s(26430),C=s(21253),O=s(63375),R=s(33984),T=s(44115),_=s(1047),D=s(10908),F=s(16623),P=s(97143);class U{constructor(e){(0,P._)(this,"env",void 0),this.env=e}}var N=s(76266),L=s(70063),x=s(91984),G=s(8260);class k extends((0,G.E)(L.n)){}(0,G.K)(L.n,k)},26430:(e,t,s)=>{s.d(t,{n:()=>l});var i=s(75958),r=s(21253),n=s(63375),o=s(33984),a=s(10908),c=s(44115),d=s(1047);const l=(0,i.Q)({name:"pinCode",commands:{activate:r.r,deactivate:n.E,loginWithPinCode:o.c},events:{},queries:{isPinCodeCorrect:a.M,getStatus:c.D,getCurrentUserStatus:d.o}})},16623:(e,t,s)=>{s.d(t,{u:()=>n});var i=s(8260),r=s(26430);class n extends((0,i.E)(r.n)){}(0,i.K)(r.n,n)},21253:(e,t,s)=>{s.d(t,{r:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},63375:(e,t,s)=>{s.d(t,{E:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},33984:(e,t,s)=>{s.d(t,{c:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},76266:(e,t,s)=>{s.d(t,{DN:()=>o,Vh:()=>r,Zs:()=>a,g5:()=>n});var i=s(98124);const r="WRONG_PIN_CODE",n=(0,i.Vj)(r,"Entered pin-code is not correct"),o="NO_ACTIVE_PIN_CODE",a=(0,i.Vj)(o,"User has no active pin-code")},1047:(e,t,s)=>{s.d(t,{o:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},44115:(e,t,s)=>{s.d(t,{D:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},10908:(e,t,s)=>{s.d(t,{M:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},34224:(e,t,s)=>{s.d(t,{A:()=>i});var i=function(e){return e.AccountNotEligible="AccountNotEligible",e.NetworkError="NetworkError",e}({})},3689:(e,t,s)=>{s.d(t,{W:()=>n,Y:()=>o});var i=s(77535),r=s(62149),n=function(e){return e.Biometrics="Biometrics",e.Pin="Pin",e.MasterPassword="MasterPassword",e}({});class o extends((0,i.k)({scope:r.F.User})){}},8504:(e,t,s)=>{s.d(t,{M:()=>o});var i=s(75958),r=s(19197),n=s(3689);const o=(0,i.Q)({name:"userVerification",commands:{validateWebauthnAssertion:r.L,request2FaCodesByPhone:r.x},queries:{userVerificationMethods:n.Y},events:{}})},19197:(e,t,s)=>{s.d(t,{L:()=>n,x:()=>o});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}class o extends((0,i.g)({scope:r.F.Device})){}},39378:(e,t,s)=>{s.d(t,{c:()=>Bt});var i=s(92336),r=s(60399),n=s(21738),o=s(14676),a=s(14122),c=s(86006),d=s(86213),l=s(50423),u=s(85045),p=s(63604),h=s(69259),g=s(78346),m=s(41511),v=s(5206),y=s(62149),S=s(63144);const w=e=>!0;class E extends((0,S.Q)({initialValue:void 0,persist:!1,scope:y.F.Device,storeName:"device-registration-flow-store",storeTypeGuard:w})){}var I=s(47440),A=s(7194),f=s(92587),b=s(9497),C=s(29498);class O extends C.x{}var R=s(63696);class T{async executeWithParams({login:e,masterPassword:t,isRememberMeEnabled:s,serverKey:i}){try{const n=await(0,r.z)(this.session.queries.localSessions());if(!(0,g.d6)(n))throw new Error("Failure querying the session module to get the sessions");if(e in n.data){const r=await this.session.commands.openUserSession({email:e,rememberPassword:s,sessionKey:{type:"mp",masterPassword:t,secondaryKey:i}});if(!(0,g.d6)(r))throw new Error("Failed to open session");return Promise.resolve()}const o=await this.carbon.commands.openSessionWithMasterPassword({login:e,password:t,rememberPassword:s,requiredPermissions:void 0,loginType:"MasterPassword"});if(!(0,g.d6)(o))throw new Error("Failed to open session in carbon");return Promise.resolve()}catch(e){if(e instanceof Error){if(("exception"in e&&e.exception instanceof Error?e.exception.message:e.message).includes("WRONG_PASSWORD on openSessionWithMasterPassword"))return Promise.reject(new O)}return Promise.reject(new Error("UNKNOWN_ERROR"))}}constructor(e,t){this.carbon=e,this.session=t}}T=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._,void 0===R.x?Object:R.x])],T);var _=s(1140);class D{async execute(){try{const e=await this.carbonLegacy.commands.carbon({name:"checkDoesLocalRecoveryKeyExist",args:[]});if(!(0,g.d6)(e))throw new Error("Carbon command failed");return{isAccountRecoveryAvailable:e.data.carbonResult.doesExist}}catch(e){return this.logger.error("Error checking local recovery key existence",{location:"AccountRecoveryStatusService",method:"execute()",error:e}),{isAccountRecoveryAvailable:!1}}}constructor(e,t){this.carbonLegacy=e,this.logger=t}}D=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._,void 0===_.SX?Object:_.SX])],D);var F=s(52477),P=s(17591),U=s(53344),N=s(8606),L=s(56618);const x=e=>!0;class G extends((0,S.Q)({persist:!1,initialValue:{},scope:y.F.Device,storeName:"sso-provider-info",storeTypeGuard:x,capacity:L.Y._001KB})){}const k=e=>"object"==typeof e&&"type"in e,K=e=>{if(e)switch(e){case"sso_member_to_admin":case"sso_member_to_mp_user":return N.vX.SSO_TO_MP;case"mp_user_to_sso_member":return N.vX.MP_TO_SSO;default:return}};class M{async getSsoMigration(e){const t=await(0,r.z)(this.serverApiClient.v1.authentication.getAuthenticationMethodsForDevice({login:e,methods:["email_token","totp","duo_push","dashlane_authenticator","u2f"]}));if((0,g.hx)(t))return(0,F.EQ)(t.error,{FetchFailedError:()=>{},BusinessError:()=>(0,P.j)("Retrieve of verificationMethods failed"),InternalServerError:()=>(0,P.j)("Retrieve of verificationMethods failed"),InvalidRequest:()=>(0,P.j)("Retrieve of verificationMethods failed"),RateLimited:()=>(0,P.j)("Retrieve of verificationMethods failed"),ServiceUnavailable:()=>(0,P.j)("Retrieve of verificationMethods failed"),UnspecifiedBadStatus:()=>(0,P.j)("Retrieve of verificationMethods failed")});const s=t.data.data.verifications.find(k);if(!s)throw new Error("No valid verification method");return"sso"===s.type?{serviceProviderUrl:s.ssoInfo.serviceProviderUrl,isNitroProvider:s.ssoInfo.isNitroProvider,migration:s.ssoInfo.migration}:void 0}async executeWithParams({login:e}){const t=await this.getSsoMigration(e);if(t)return await this.ssoProviderInfoStore.set({isNitroProvider:t.isNitroProvider??!1,serviceProviderUrl:t.serviceProviderUrl,migrationType:K(t.migration)}),{serviceProviderRedirectUrl:t.serviceProviderUrl,isNitroProvider:t.isNitroProvider}}constructor(e,t){this.ssoProviderInfoStore=e,this.serverApiClient=t,this.ssoProviderInfoStore=e,this.serverApiClient=t}}M=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===G?Object:G,void 0===U.l?Object:U.l])],M);class j{async executeWithParams(e){const t=await(0,r.z)(this.session.queries.checkSessionKey({email:e.login,sessionKey:{type:"mp",masterPassword:e.masterPassword,secondaryKey:e.serverKey}}));if(!(0,g.d6)(t))throw new Error("Error verifying SK");if(t.data)return!0;throw new O}constructor(e){this.session=e}}j=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===R.x?Object:R.x])],j);class V{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"CheckingAccountRecoveryStatus",id:"MasterPasswordFlowMachine",context:{isRememberMeEnabled:!1,isAccountRecoveryAvailable:!1},states:{CheckingAccountRecoveryStatus:{invoke:{src:"checkAccountRecoveryStatus",onDone:{target:"WaitingForMasterPassword",actions:["assignAccountRecoveryStatus"]}}},WaitingForMasterPassword:{on:{INPUT_MASTER_PASSWORD:{target:"ValidatingMasterPassword",actions:["assignMasterPassword"]},SWITCH_TO_PIN_CODE:{target:"#AuthenticationFlowMachine.PinCode",cond:"hasPinCodeEnabled"},CARBON_WRONG_PASSWORD:{actions:["assignMpError"]}}},ValidatingMasterPassword:{invoke:{src:"validateMasterPassword",onDone:{target:"OpeningSessionWithMasterpassword"},onError:{actions:["assignMaybeMpError"],target:"WaitingForMasterPassword"}},on:{CARBON_LEGACY_ERROR:{target:"WaitingForMasterPassword",actions:["assignError"]},CARBON_WRONG_PASSWORD:{actions:["assignMpError"],target:"WaitingForMasterPassword"}}},OpeningSessionWithMasterpassword:{invoke:{src:"authenticateWithMasterPassword",onError:{actions:["assignMaybeMpError"],target:"WaitingForMasterPassword"},onDone:{target:"CheckingMigrationNeeded"},CARBON_WRONG_PASSWORD:{actions:["assignMpError"],target:"WaitingForMasterPassword"}},on:{CARBON_LEGACY_ERROR:{target:"WaitingForMasterPassword",actions:["assignError"]},DEVICE_LIMIT_ABORTED:{target:"DeviceLimitAborted"}}},CheckingMigrationNeeded:{invoke:{src:"checkIsMigrationNeeded",onDone:{target:"MasterPasswordDone",actions:["assignSSOMigrationStatus"]},onError:{target:"WaitingForMasterPassword",actions:["assignGenericServiceError"]}},on:{CARBON_LEGACY_ERROR:{target:"WaitingForMasterPassword",actions:["assignError"]}}},DeviceLimitAborted:{type:"final",data:{shouldResetAuthenticationFlow:!0}},MasterPasswordDone:{type:"final",data:{shouldResetAuthenticationFlow:!1}}}},options:{actions:{assignMasterPassword:(0,I.f0)({masterPassword:(e,t)=>t.masterPassword,isRememberMeEnabled:(e,t)=>t.rememberMe}),assignAccountRecoveryStatus:(0,I.f0)({isAccountRecoveryAvailable:(e,t)=>t.data.isAccountRecoveryAvailable}),assignError:(0,I.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignGenericServiceError:(0,I.f0)({error:()=>({code:"unknown_error",data:{message:"UNKNOWN_ERROR"}})}),assignMpError:(0,I.f0)({error:()=>({code:"unknown_error",data:{message:"WRONG_PASSWORD"}})}),assignMaybeMpError:(0,I.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.data instanceof O?"WRONG_PASSWORD":"UNKNOWN_ERROR"}})}),assignSSOMigrationStatus:(0,I.f0)({serviceProviderRedirectUrl:(e,t)=>t.data?.serviceProviderRedirectUrl,isNitroProvider:(e,t)=>t.data?.isNitroProvider})},services:{authenticateWithMasterPassword:e=>{const{login:t,masterPassword:s,isRememberMeEnabled:i,serverKey:r}=e;return this.masterPasswordService.executeWithParams({login:t??"",masterPassword:s??"",isRememberMeEnabled:i,serverKey:r})},checkAccountRecoveryStatus:()=>this.accountRecoveryStatusService.execute(),checkIsMigrationNeeded:e=>this.checkIsMigrationNeededService.executeWithParams({login:e.login??""}),validateMasterPassword:({login:e,masterPassword:t,serverKey:s})=>this.mpVerificationService.executeWithParams({login:e??"",masterPassword:t??"",serverKey:s})},guards:{hasPinCodeEnabled:e=>e.shouldAskPinCode}}}}create(){const{config:e,options:t}=this.desc();return(0,A.C)(e,t)}constructor(e,t,s,i){this.accountRecoveryStatusService=e,this.masterPasswordService=t,this.checkIsMigrationNeededService=s,this.mpVerificationService=i}}V=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===D?Object:D,void 0===T?Object:T,void 0===M?Object:M,void 0===j?Object:j])],V);class W{async requestCodeAgainstServer(){}async execute({login:e}){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithDashlaneAuthenticator",arg:[{login:e,password:null,persistData:!0,deviceName:""}]}),Promise.resolve()}async cancel(){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"cancelDashlaneAuthenticatorRegistration",arg:[]}),Promise.resolve()}constructor(e){this.carbonLegacy=e}}W=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._])],W);class B{async execute(e){try{return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionResendToken",arg:[{login:e.login??""}]}),Promise.resolve()}catch(e){this.logger.error("Error resending session token",{location:"SendEmailToken",method:"execute()",error:e})}}constructor(e,t){this.carbonLegacy=e,this.logger=t}}B=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._,void 0===_.SX?Object:_.SX])],B);class z{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"AuthenticatorMachine",context:{isDashlaneAuthenticatorAvailable:!1},initial:"RequestingServerPush",states:{RequestingServerPush:{entry:["updateDashlaneAuthenticatorAvailability"],invoke:{src:"authenticateWithDashlaneAuthenticator"},on:{CARBON_LEGACY_ERROR:{actions:["assignError","updateDashlaneAuthenticatorAvailability"]},RESEND_PUSH_NOTIFICATION:{target:"RequestingServerPush",actions:["clearError"]},SWITCH_TO_EMAIL_TOKEN:{actions:["cancelDashlaneAuthenticator","clearError"],target:"EmailTokenRequested"}}},AuthenticatorPushValidated:{type:"final",data:{switchToEmailToken:!1}},EmailTokenRequested:{entry:["sendEmailToken"],type:"final",data:{switchToEmailToken:!0}}}},options:{actions:{clearError:(0,I.f0)({error:()=>{}}),assignError:(0,I.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),switchToEmailToken:(0,I.f0)({switchToEmailToken:()=>!0}),updateDashlaneAuthenticatorAvailability:(0,I.f0)({isDashlaneAuthenticatorAvailable:!0}),cancelDashlaneAuthenticator:()=>{this.dashlaneAuthenticatorService.cancel()},sendEmailToken:e=>{const{login:t}=e;this.sendEmailToken.execute({login:t})}},services:{authenticateWithDashlaneAuthenticator:e=>{const{login:t}=e;return this.dashlaneAuthenticatorService.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,A.C)(e,t)}constructor(e,t){this.dashlaneAuthenticatorService=e,this.sendEmailToken=t}}z=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===W?Object:W,void 0===B?Object:B])],z);class q{async execute(e){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithToken",arg:[{login:e.login??"",password:null,token:e.emailToken??"",persistData:!0,deviceName:e.deviceName}]})}catch(e){this.logger.error("Error opening session with token",{location:"AuthenticateWithEmailToken",method:"execute()",error:e})}}constructor(e,t){this.carbonLegacy=e,this.logger=t}}q=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._,void 0===_.SX?Object:_.SX])],q);class H{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"EmailTokenMachine",context:{login:"",emailToken:"",deviceName:""},initial:"WaitingForEmailToken",states:{SendEmailToken:{invoke:{src:"sendEmailToken",onError:{target:"WaitingForEmailToken"},onDone:{target:"WaitingForEmailToken"}}},WaitingForEmailToken:{on:{INPUT_EMAIL_TOKEN:{target:"ValidatingEmailToken",actions:["assignEmailToken"]},RESEND_EMAIL_TOKEN:{target:"SendEmailToken",actions:["clearError"]}}},ValidatingEmailToken:{entry:["authenticateWithEmailToken"],on:{CARBON_LEGACY_ERROR:{target:"WaitingForEmailToken",actions:["assignError"]}}},FinishingEmailToken:{type:"final",data:{switchToDashlaneAuthenticator:!1}},DashlaneAuthenticatorRequested:{type:"final",data:{switchToDashlaneAuthenticator:!0}}},on:{SWITCH_TO_DASHLANE_AUTHENTICATOR:{target:".DashlaneAuthenticatorRequested",internal:!0,actions:["clearError"]}}},options:{actions:{clearError:(0,I.f0)({error:()=>{}}),assignError:(0,I.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignEmailToken:(0,I.f0)({emailToken:(e,t)=>t.emailToken}),authenticateWithEmailToken:e=>{const{deviceName:t,emailToken:s,login:i}=e;return this.authenticateWithEmailToken.execute({deviceName:t,emailToken:s,login:i})}},services:{sendEmailToken:e=>{const{login:t}=e;return this.sendEmailToken.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,A.C)(e,t)}constructor(e,t){this.authenticateWithEmailToken=e,this.sendEmailToken=t}}H=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===q?Object:q,void 0===B?Object:B])],H);const Y=e=>({initial:e.initial,states:e.states,on:e.on??{}});class Q{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{},guards:{}},id:"DeviceRegistrationMachine",context:{...this.authenticatorMachine.desc().config.context,...this.emailTokenMachine.desc().config.context,registrationMethod:void 0},initial:"StartDeviceRegistration",states:{StartDeviceRegistration:{always:[{target:"EmailToken",cond:"isRegistrationMethodEmailToken"},{target:"DashlaneAuthenticator",cond:"isRegistrationMethodAuthenticator"},{target:"TwoFactorAuthentication",cond:"isRegistrationMethodOTP"}]},DashlaneAuthenticator:{...Y(this.authenticatorMachine.desc().config),onDone:[{target:"EmailToken",cond:"shouldSwitchToEmailToken"},{target:"DeviceRegistrationDone"}]},EmailToken:{...Y(this.emailTokenMachine.desc().config),onDone:[{target:"DashlaneAuthenticator",cond:"shouldSwitchToAuthenticator"},{target:"DeviceRegistrationDone"}]},TwoFactorAuthentication:{onDone:{target:"DeviceRegistrationDone"}},DeviceRegistrationDone:{type:"final"}}},options:{actions:{...this.authenticatorMachine.desc().options.actions,...this.emailTokenMachine.desc().options.actions,assignUnknownDeviceRegistrationError:(0,I.f0)({error:()=>({code:"unknown_error",data:{message:"Unknown device registration error"}})})},services:{...this.authenticatorMachine.desc().options.services,...this.emailTokenMachine.desc().options.services},guards:{...this.authenticatorMachine.desc().options.guards,...this.emailTokenMachine.desc().options.guards,isRegistrationMethodEmailToken:e=>"email_token"===e.registrationMethod,isRegistrationMethodOTP:e=>"otp"===e.registrationMethod,isRegistrationMethodAuthenticator:e=>"dashlane_authenticator"===e.registrationMethod,shouldSwitchToEmailToken:(e,t)=>t.data.switchToEmailToken,shouldSwitchToAuthenticator:(e,t)=>t.data.switchToDashlaneAuthenticator}}}}create(){const{config:e,options:t}=this.desc();return(0,A.C)(e,t)}constructor(e,t){this.authenticatorMachine=e,this.emailTokenMachine=t}}Q=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===z?Object:z,void 0===H?Object:H])],Q);class ${desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"WebAuthnMachine",context:{},initial:"InitWebAuthnAuthentication",states:{InitWebAuthnAuthentication:{on:{WEBAUTHN_AUTHENTICATION_FAIL:{target:"WebAuthnAuthenticationFailed",actions:["assignWebAuthnError"]}}},WebAuthnAuthenticationFailed:{on:{RETRY_WEBAUTHN_AUTHENTICATION:{target:"InitWebAuthnAuthentication",actions:["clearError"]}}},WebAuthnAuthenticationDone:{type:"final",data:{switchToMasterPassword:!1,switchToPinCode:!1}},MasterPasswordRequested:{type:"final",data:{switchToMasterPassword:!0,switchToPinCode:!1}},PinCodeRequested:{type:"final",data:{switchToMasterPassword:!1,switchToPinCode:!0}}},on:{USE_MASTER_PASSWORD:{actions:["clearError"],target:".MasterPasswordRequested",internal:!0},SWITCH_TO_PIN_CODE:{actions:["clearError"],target:".PinCodeRequested",internal:!0}}},options:{actions:{clearError:(0,I.f0)({error:()=>{}}),assignWebAuthnError:(0,I.f0)({error:(e,t)=>t.error})},services:{},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,A.C)(e,t)}}$=(0,i.gn)([(0,f.GS)()],$);class X{executeWithParams({login:e,masterPassword:t,otp:s,twoFactorAuthenticationOtpType:i,otpVerificationMode:r,deviceName:n}){const o={login:e,password:t??null,otp:s,withBackupCode:"backupCode"===i,persistData:!0};try{"otp2"===r?this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithOTP",arg:[{...o,deviceName:n}]}):"otp1"===r&&this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithOTPForNewDevice",arg:[o]})}catch(e){this.logger.error("Error opening session with otp",{location:"TwoFactorAuthenticationService",method:"execute()",error:e})}return Promise.resolve()}constructor(e,t){this.carbonLegacy=e,this.logger=t}}X=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._,void 0===_.SX?Object:_.SX])],X);class Z{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"WebAuthnMachine",context:{twoFactorAuthenticationOtpType:"totp"},initial:"WaitingForTotp",states:{WaitingForTotp:{on:{INPUT_TOTP:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForBackupCode",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},WaitingForBackupCode:{on:{INPUT_BACKUP_CODE:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForTotp",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},ValidatingTwoFactorAuthenticationOtp:{entry:["authenticateWithTwoFactorAuthentication"],on:{CARBON_LEGACY_ERROR:[{target:"WaitingForBackupCode",cond:"isBackupCode",actions:["assignError"]},{target:"WaitingForTotp",actions:["assignError"]}]}},TwoFactorAuthenticationDone:{type:"final"}}},options:{actions:{assignError:(0,I.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),clearError:(0,I.f0)({error:()=>{}}),assignTwoFactorAuthenticationOtpValue:(0,I.f0)({twoFactorAuthenticationOtpValue:(e,t)=>t.twoFactorAuthenticationOtpValue}),assignTwoFactorAuthenticationOtpType:(0,I.f0)({twoFactorAuthenticationOtpType:(e,t)=>t.twoFactorAuthenticationOtpType}),authenticateWithTwoFactorAuthentication:e=>{const t={login:e.login??"",masterPassword:e.masterPassword??null,otp:e.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.twoFactorAuthenticationOtpType,persistData:!0,otpVerificationMode:e.otpVerificationMode,deviceName:e.deviceName};this.twoFactorAuthenticationService.executeWithParams(t)}},services:{},guards:{isBackupCode:e=>"backupCode"===e.twoFactorAuthenticationOtpType}}}}create(){const{config:e,options:t}=this.desc();return(0,A.C)(e,t)}constructor(e){this.twoFactorAuthenticationService=e}}Z=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===X?Object:X])],Z);var J=s(16623);class ee extends C.x{constructor(){super("Entered PIN code is wrong")}}class te{async executeWithParams({loginEmail:e,pinCode:t}){if(!e)throw new Error("No login email");const s=await this.pinCodeClient.commands.loginWithPinCode({email:e,pinCode:t});return(0,g.hx)(s)?Promise.reject((0,F.EQ)(s.error,{NO_ACTIVE_PIN_CODE:()=>new Error("No active pin code"),WRONG_PIN_CODE:()=>new ee})):Promise.resolve()}constructor(e){this.pinCodeClient=e}}te=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===J.u?Object:J.u])],te);class se{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"PinCodeMachine",context:{pinCode:""},initial:"WaitingForPinCode",states:{WaitingForPinCode:{on:{INPUT_PIN_CODE:{target:"ValidatingPinCode",actions:["assignPinCode"]},USE_MASTER_PASSWORD:{target:"#AuthenticationFlowMachine.MasterPassword"},USE_DEVICE_TO_DEVICE_AUTHENTICATION:{target:"#AuthenticationFlowMachine.DeviceToDeviceAuthentication"}}},ValidatingPinCode:{invoke:{src:"validatePinCode",onDone:{target:"PinCodeDone"},onError:{actions:["assignPinCodeError"],target:"WaitingForPinCode"}}},PinCodeDone:{type:"final"}}},options:{actions:{assignPinCode:(0,I.f0)({pinCode:(e,t)=>t.pinCode}),assignPinCodeError:(0,I.f0)({error:(e,t)=>({code:t.data instanceof ee?"wrong_pin_code":"unknown_error"})}),clearError:(0,I.f0)({error:()=>{}}),clearContext:(0,I.f0)({pinCode:()=>"",error:()=>{}})},services:{validatePinCode:e=>this.pinCodeVerificationService.executeWithParams({loginEmail:e.login,pinCode:e.pinCode})},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,A.C)(e,t)}constructor(e){this.pinCodeVerificationService=e}}se=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===te?Object:te])],se);var ie=s(41842),re=s(87065);class ne{retrieveLocalAccounts(){return(0,r.z)(this.carbonLegacyClient.queries.carbonState({path:"authentication.localAccounts"}).pipe((0,ie.h)(g.d6),(0,ie.h)((e=>e.data.accountsListInitialized)),(0,re.U)((e=>e.data.accountsList))))}async getPinCodeStatus(e){if(!e)return!1;const t=await(0,r.z)(this.pinCodeClient.queries.getStatus({loginEmail:e}));return!(0,g.hx)(t)&&t.data.isPinCodeEnabled}async execute(){const e=await this.retrieveLocalAccounts(),t=e?.find((e=>e.isLastSuccessfulLogin)),s=await this.getPinCodeStatus(t?.login);return{localAccounts:e??[],lastUsedLogin:t?.login??"",shouldAskMasterPassword:t?.shouldAskMasterPassword??!1,shouldAskPinCode:s,shouldAskOTP:t?.hasLoginOtp??!1,rememberMeType:t?.rememberMeType??"disabled"}}constructor(e,t){this.carbonLegacyClient=e,this.pinCodeClient=t}}ne=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._,void 0===J.u?Object:J.u])],ne);class oe{async execute(e){await this.carbonLegacy.commands.carbon({name:"loginViaSSO",args:[e]})}constructor(e){this.carbonLegacy=e}}oe=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._])],oe);class ae{async execute({isNitroProvider:e,serviceProviderRedirectUrl:t}){await this.ssoProviderInfoStore.set({isNitroProvider:e,serviceProviderUrl:t})}constructor(e){this.ssoProviderInfoStore=e,this.ssoProviderInfoStore=e}}ae=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===G?Object:G])],ae);class ce{async execute({login:e}){await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSession",arg:[{login:e??""}]})}constructor(e){this.carbonLegacy=e}}ce=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._])],ce);class de{async execute({login:e}){if(e){const t=await(0,r.z)(this.pinCodeClient.queries.getStatus({loginEmail:e}));if((0,g.d6)(t)&&t.data.isPinCodeEnabled)return Promise.resolve(!0)}return Promise.resolve(!1)}constructor(e){this.pinCodeClient=e}}de=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===J.u?Object:J.u])],de);var le=s(43902),ue=s(38568),pe=s(36021);class he{async execute({login:e}){const t=le.getDefaultDeviceName();if(!e||!t)throw new pe.z("No user login/device name",N.UY.GENERIC_ERROR);const s=await this.d2dAuthenticationService.requestTransfer(e,t);if((0,g.hx)(s))throw new pe.z("Request transfer error",N.UY.GENERIC_ERROR);const{transferId:i,expireDateUnix:r}=s.data;return Promise.resolve({transferId:i,expireDateUnix:r})}constructor(e){this.d2dAuthenticationService=e}}he=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ue.C?Object:ue.C])],he);var ge=s(62430);class me{async execute({transferId:e}){if(!e)throw new pe.z("No transferId in context",N.UY.GENERIC_ERROR);const{privateKey:t,publicKey:s}=this.d2dCryptoService.generateKeyPair(),i=this.d2dCryptoService.hash(s),r=await this.d2dAuthenticationService.startReceiverKeyExchange(e,i);if((0,g.hx)(r))return Promise.reject(r.error);const{senderPublicKey:n}=r.data;return Promise.resolve({receiverPrivateKey:t,receiverPublicKey:s,senderPublicKey:n})}constructor(e,t){this.d2dCryptoService=e,this.d2dAuthenticationService=t}}me=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ge.q?Object:ge.q,void 0===ue.C?Object:ue.C])],me);class ve{async execute(e){if(!e.transferId||!e.login)throw new pe.z("No transferId or user login in the machine context",N.UY.GENERIC_ERROR);const t=await this.d2dAuthenticationService.startTransfer(e.transferId);return(0,g.hx)(t)?Promise.reject(t.error):Promise.resolve(t.data)}constructor(e){this.d2dAuthenticationService=e}}ve=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ue.C?Object:ue.C])],ve);class ye{async execute(e){if(!e.transferId||!e.login)throw new pe.z("No transferId or user login in the machine context",N.UY.GENERIC_ERROR);if(!e.receiverPrivateKey||!e.receiverPublicKey||!e.senderPublicKey)throw new pe.z("Missing keys/data in context",N.UY.GENERIC_ERROR);if(!e.sharedSecret)throw new pe.z("Missing sharedSecret in context",N.UY.GENERIC_ERROR);if(!e.encryptedData||!e.nonce)throw new pe.z("Missing transfer data in context",N.UY.GENERIC_ERROR);const t=this.d2dCryptoService.generateSymmetricKey(e.login,e.transferId,e.sharedSecret),s=this.d2dCryptoService.decryptInvisibleMasterPassword(e.encryptedData,e.nonce,t);await this.d2dAuthenticationService.openSession(s.login,s.token,s.key.value,e.deviceName)}constructor(e,t){this.d2dCryptoService=e,this.d2dAuthenticationService=t}}ye=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ge.q?Object:ge.q,void 0===ue.C?Object:ue.C])],ye);var Se=s(19715);class we{async execute(e){if(!e.receiverPrivateKey||!e.receiverPublicKey||!e.senderPublicKey)throw new pe.z("Keys not found in the state machine context",N.UY.GENERIC_ERROR);if(!e.transferId)throw new pe.z("TransferId not found in the state machine context/store",N.UY.GENERIC_ERROR);if(!e.login)throw new pe.z("User login not found in state machine context/store",N.UY.GENERIC_ERROR);const t=await this.d2dAuthenticationService.completeKeyExchange(e.transferId,e.receiverPublicKey);if((0,g.hx)(t))throw new pe.z("Error with completeKeyExchange",N.UY.GENERIC_ERROR);const s=this.d2dCryptoService.generateReceiverSharedSecret(e.receiverPublicKey,e.receiverPrivateKey,e.senderPublicKey),i=this.d2dCryptoService.generateVisualCheckSeed(e.login,e.transferId,s),{passphrase:r}=await this.passphraseService.generatePassphraseChallenge(i);return Promise.resolve({sharedSecret:s,passphrase:r})}constructor(e,t,s){this.d2dCryptoService=e,this.d2dAuthenticationService=t,this.passphraseService=s}}we=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ge.q?Object:ge.q,void 0===ue.C?Object:ue.C,void 0===Se.Kp?Object:Se.Kp])],we);class Ee{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"DeviceToDeviceAuthenticationFlow",initial:"WaitingForTransferRequest",context:{transferId:void 0},states:{WaitingForTransferRequest:{invoke:{src:"requestDeviceTransfer",onDone:{target:"DisplayInstructions",actions:["assignTransferId"]},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},DisplayInstructions:{invoke:{src:"startReceiverKeyExchange",onDone:{actions:["assignKeys"],target:"GeneratePassphrase"},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},GeneratePassphrase:{invoke:{src:"completeKeyExchangeAndGeneratePassphrase",onDone:{actions:["assignPassphrase"],target:"StartTransfer"},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},StartTransfer:{invoke:{src:"startTransfer",onDone:{actions:["assignTransferData"],target:"OpenSession"},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},OpenSession:{invoke:{src:"openSession",onDone:{target:"DeviceRegistered"},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},DeviceTransferError:{},DeviceRegistered:{type:"final"}}},options:{actions:{assignTransferId:(0,I.f0)({transferId:(e,t)=>t.data.transferId}),assignKeys:(0,I.f0)({receiverPublicKey:(e,t)=>t.data.receiverPublicKey,receiverPrivateKey:(e,t)=>t.data.receiverPrivateKey,senderPublicKey:(e,t)=>t.data.senderPublicKey}),assignPassphrase:(0,I.f0)({passphrase:(e,t)=>t.data.passphrase,sharedSecret:(e,t)=>t.data.sharedSecret}),assignTransferData:(0,I.f0)({encryptedData:(e,t)=>t.data.encryptedData,nonce:(e,t)=>t.data.nonce}),clearContext:(0,I.f0)({deviceName:()=>{},transferId:()=>{},receiverPublicKey:()=>{},receiverPrivateKey:()=>{},senderPublicKey:()=>{},sharedSecret:()=>{},passphrase:()=>{}}),assignDeviceToDeviceError:(0,I.f0)({error:(e,t)=>t.data instanceof pe.z?t.data.code:N.UY.GENERIC_ERROR})},services:{requestDeviceTransfer:e=>this.requestDeviceTransfer.execute(e),startReceiverKeyExchange:e=>this.startReceiverKeyExchange.execute(e),completeKeyExchangeAndGeneratePassphrase:e=>this.completeKeyExchangeAndGeneratePassphrase.execute(e),startTransfer:e=>this.startTransfer.execute(e),openSession:e=>this.openSession.execute(e)}}}}create(){const{config:e,options:t}=this.desc();return(0,A.C)(e,t)}constructor(e,t,s,i,r){this.requestDeviceTransfer=e,this.startReceiverKeyExchange=t,this.completeKeyExchangeAndGeneratePassphrase=s,this.startTransfer=i,this.openSession=r}}Ee=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===he?Object:he,void 0===me?Object:me,void 0===we?Object:we,void 0===ve?Object:ve,void 0===ye?Object:ye])],Ee);class Ie{desc(e=!1){const t={config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"AuthenticationFlowMachine",context:{...this.deviceRegistrationMachine.desc().config.context,...this.masterPasswordFlowMachine.desc().config.context,...this.twoFactorAuthenticationMachine.desc().config.context,...this.webAuthnMachine.desc().config.context,...this.deviceToDeviceAuthenticationMachine.desc().config.context,...this.pinCodeMachine.desc().config.context,ready:!1,shouldAskMasterPassword:!1,shouldAskOTP:!1,shouldAskPinCode:!1},states:{Starting:{invoke:{src:"initializeMachine",onDone:{actions:["assignInitializationResults"],target:"RememberMeRedirection"}}},RememberMeRedirection:{always:[{target:"MasterPassword",cond:"shouldAskMasterPassword"},{target:"CheckSessionForOtp2",cond:"shouldAskOTP"},{target:"WebAuthn",cond:"rememberMeIsWebAuthn"},{target:"WaitingForEmail"}]},CheckSessionForOtp2:{entry:["checkAccountType"]},WaitingForEmail:{on:{INPUT_ACCOUNT_EMAIL:{target:"ValidatingEmail",actions:["assignAccountEmail","clearError"]}}},ValidatingEmail:{entry:["checkAccountType"],on:{CARBON_LEGACY_ERROR:{target:"WaitingForEmail",actions:["assignError"]}}},PinCode:{...Y(this.pinCodeMachine.desc().config)},DeviceRegistration:{...Y(this.deviceRegistrationMachine.desc().config)},WebAuthn:{...Y(this.webAuthnMachine.desc().config),onDone:[{target:"MasterPassword",cond:"shouldSwitchToMasterPassword"},{target:"PinCode",cond:"shouldSwitchToPinCode"},{target:"MasterPasswordBasedAuthenticationDone"}]},TwoFactorAuthentication:{...Y(this.twoFactorAuthenticationMachine.desc().config),onDone:{target:"MasterPasswordBasedAuthenticationDone"}},SSOAuthentication:{entry:["legacySSOLogin"]},SSORedirectionToIdp:{entry:["assignServiceProviderInfo","storeSSOInfo"],on:{CARBON_LEGACY_ERROR:{target:"WaitingForEmail",actions:["assignError"]}}},CheckPinCodeAvailableForMasterPassword:{invoke:{src:"checkPinCodeStatus",onDone:[{actions:["assignShouldAskPinCode"],cond:"isPinCodeLogin",target:"PinCode"},{actions:["assignShouldAskPinCode"],target:"MasterPassword"}]}},MasterPassword:{...Y(this.masterPasswordFlowMachine.desc().config),onDone:[{target:"WaitingForEmail",cond:"shouldResetAuthenticationFlow"},{target:"MasterPasswordBasedAuthenticationDone"}]},MasterPasswordBasedAuthenticationDone:{on:{CARBON_LEGACY_LOGGED_OUT:{target:"Starting"}}},CheckPinCodeAvailableForPasswordless:{invoke:{src:"checkPinCodeStatus",onDone:[{actions:["assignShouldAskPinCode"],cond:"isPinCodeLogin",target:"PinCode"},{actions:["assignShouldAskPinCode"],target:"DeviceToDeviceAuthentication"}]}},DeviceToDeviceAuthentication:{...Y(this.deviceToDeviceAuthenticationMachine.desc().config),onDone:{target:"DeviceToDeviceAuthenticationDone"}},DeviceToDeviceAuthenticationDone:{type:"final"}},on:{CHANGE_ACCOUNT_EMAIL:[{target:"ValidatingEmail",actions:["clearError","assignAccountEmail"],cond:"isAccountLoginAvailable"},{target:"WaitingForEmail",actions:["clearError","clearEmail"]}],CARBON_LEGACY_ASK_MASTER_PASSWORD:{target:"CheckPinCodeAvailableForMasterPassword",actions:["assignServerKey","clearError"]},CARBON_LEGACY_OPEN_SESSION_TOKEN_SENT:[{target:"DeviceRegistration.EmailToken",actions:["assignAccountEmail","clearError"],cond:"isGrapheneDeviceRegistrationFlow"},{target:"DeviceRegistration.EmailToken",actions:["assignAccountEmail","clearError"]}],CARBON_LEGACY_OPEN_SESSION_DASHLANE_AUTHENTICATOR:{target:"DeviceRegistration.DashlaneAuthenticator",actions:["clearError"]},CARBON_LEGACY_OPEN_SESSION_SSO_REDIRECTION_TO_IDP_REQUIRED:{target:"SSORedirectionToIdp",actions:["clearError"]},CARBON_LEGACY_SSO_LOGIN_BYPASS:{target:"SSOAuthentication",actions:["assignSsoData"]},CARBON_LEGACY_OPEN_SESSION_OTP_SENT:{target:"TwoFactorAuthentication",actions:["assignOtpVerificationMode","clearError"]},CARBON_LEGACY_OPEN_SESSION_DEVICE_TO_DEVICE:{target:"CheckPinCodeAvailableForPasswordless",actions:["assignServerKey","clearError"]},CLEAR_ERROR:{actions:["clearError"]}}},options:{actions:{...this.deviceRegistrationMachine.desc().options.actions,...this.masterPasswordFlowMachine.desc().options.actions,...this.twoFactorAuthenticationMachine.desc().options.actions,...this.webAuthnMachine.desc().options.actions,...this.deviceToDeviceAuthenticationMachine.desc().options.actions,...this.pinCodeMachine.desc().options.actions,assignInitializationResults:(0,I.f0)({login:(e,t)=>t.data.lastUsedLogin,localAccounts:(e,t)=>t.data.localAccounts,shouldAskMasterPassword:(e,t)=>t.data.shouldAskMasterPassword,shouldAskOTP:(e,t)=>t.data.shouldAskOTP,shouldAskPinCode:(e,t)=>t.data.shouldAskPinCode,rememberMeType:(e,t)=>t.data.rememberMeType,ready:()=>!0}),assignAccountEmail:(0,I.f0)({login:(e,t)=>t.login}),assignError:(0,I.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignOtpVerificationMode:(0,I.f0)({otpVerificationMode:(e,t)=>t.otpVerificationMode}),assignSsoData:(0,I.f0)({ssoData:(e,t)=>t}),assignServiceProviderInfo:(0,I.f0)({serviceProviderRedirectUrl:(e,t)=>t.serviceProviderRedirectUrl,isNitroProvider:(e,t)=>t.isNitroProvider,rememberMeForSSOPreference:(e,t)=>t.rememberMeForSSOPreference}),assignServerKey:(0,I.f0)({serverKey:(e,t)=>t.serverKey}),assignShouldAskPinCode:(0,I.f0)({shouldAskPinCode:(e,t)=>t.data}),clearEmail:(0,I.f0)({login:void 0}),clearError:(0,I.f0)({error:()=>{}}),clearContext:(0,I.f0)({login:()=>"",shouldAskOTP:()=>!1,shouldAskMasterPassword:()=>!1,twoFactorAuthenticationOtpType:()=>"totp",registrationMethod:()=>{},emailToken:()=>"",deviceName:()=>"",isDashlaneAuthenticatorAvailable:()=>!1,isRememberMeEnabled:()=>!1,isAccountRecoveryAvailable:()=>!1}),legacySSOLogin:(e,t)=>this.legacySSOLoginService.execute(t),checkAccountType:e=>this.checkAccountType.execute(e),storeSSOInfo:(e,t)=>this.storeSSOInfoService.execute(t)},services:{...this.deviceRegistrationMachine.desc().options.services,...this.masterPasswordFlowMachine.desc().options.services,...this.twoFactorAuthenticationMachine.desc().options.services,...this.webAuthnMachine.desc().options.services,...this.deviceToDeviceAuthenticationMachine.desc().options.services,...this.pinCodeMachine.desc().options.services,initializeMachine:()=>this.initializeMachineService.execute(),checkAccountType:e=>this.checkAccountType.execute(e),checkPinCodeStatus:e=>this.checkPinCodeStatusService.execute(e)},guards:{...this.deviceRegistrationMachine.desc().options.guards,...this.twoFactorAuthenticationMachine.desc().options.guards,...this.webAuthnMachine.desc().options.guards,...this.masterPasswordFlowMachine.desc().options.guards,isAccountLoginAvailable:(e,t)=>Boolean(t.login),shouldAskMasterPassword:e=>e.shouldAskMasterPassword&&!e.shouldAskPinCode,shouldAskOTP:e=>!!e.shouldAskOTP&&e.shouldAskOTP,shouldAskPinCode:e=>e.shouldAskPinCode,shouldSwitchToMasterPassword:(e,t)=>t.data.switchToMasterPassword,shouldSwitchToPinCode:(e,t)=>t.data.switchToPinCode,shouldResetAuthenticationFlow:(e,t)=>t.data.shouldResetAuthenticationFlow,rememberMeIsWebAuthn:e=>void 0!==e.rememberMeType&&"webauthn"===e.rememberMeType,isGrapheneDeviceRegistrationFlow:e=>!!e.login&&e.login.includes("kw_test_newdevice"),isPinCodeLogin:(e,t)=>t.data}}};return e&&(0,b.G)(t.config),t}create(e=!1){const{config:t,options:s}=this.desc(e);return(0,A.C)(t,s)}constructor(e,t,s,i,r,n,o,a,c,d,l){this.deviceRegistrationMachine=e,this.masterPasswordFlowMachine=t,this.twoFactorAuthenticationMachine=s,this.webAuthnMachine=i,this.deviceToDeviceAuthenticationMachine=r,this.pinCodeMachine=n,this.initializeMachineService=o,this.legacySSOLoginService=a,this.checkAccountType=c,this.storeSSOInfoService=d,this.checkPinCodeStatusService=l}}Ie=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Q?Object:Q,void 0===V?Object:V,void 0===Z?Object:Z,void 0===$?Object:$,void 0===Ee?Object:Ee,void 0===se?Object:se,void 0===ne?Object:ne,void 0===oe?Object:oe,void 0===ce?Object:ce,void 0===ae?Object:ae,void 0===de?Object:de])],Ie);var Ae=s(39177),fe=s(14160),be=s(18330),Ce=s(57357),Oe=s(86051);const Re=e=>!0;class Te extends((0,S.Q)({initialValue:void 0,persist:!1,scope:y.F.Device,storeName:"authentication-flow-machine",storeTypeGuard:Re})){}class _e{execute(){try{const{carbonState:e}=this.carbon.queries;e({path:"userSession.loginDeviceLimitFlow.flow"}).pipe((0,re.U)((e=>{if("success"===e.tag)return e.data}))).subscribe((e=>{Boolean(this.lastDeviceLimitFlowValue)&&!e&&this.interpreter.send({type:"DEVICE_LIMIT_ABORTED"}),this.lastDeviceLimitFlowValue=e}))}catch(e){return Promise.reject(new Error("Unable to subscribe to loginDeviceLimitFlow state"))}}constructor(e,t){this.interpreter=e,this.carbon=t}}class De{async prepare(){await this.abortDeviceLimitEventHandler.execute();const e=await(async e=>{const t=await e.getState();return t?Oe.ZM.create(JSON.parse(t)):void 0})(this.loginMachineStore);if(!e){const e=this.interpreter.start();return void await(0,Ae.X)(e,(e=>e.context.ready),{timeout:3e4})}let t;await this.allowedToFail.doOne((()=>{if(e.done)throw new Error("Restarting a machine which is already in its final state. Starting from scratch instead.");t=this.interpreter.start(e)}),{methodName:"Resuming state machine"}),t||(t=this.interpreter.start()),await(0,Ae.X)(t,(e=>e.context.ready))}continue(e){this.interpreter.send(e)}constructor(e,t,s,i,r,n){this.carbon=i,this.allowedToFail=r,this.logger=n,this.loginMachineStore=t;const o=e.create(s);this.interpreter=(0,fe.kJ)(o).onChange((e=>{this.logger.info("Context change occured",{location:"AuthenticationFlow",method:"interpreter.onChanged()",context:e})})).onEvent((e=>{this.logger.info("Context change occured",{location:"AuthenticationFlow",method:"interpreter.onEvent()",event:e})})).onTransition(((e,t)=>{this.logger.info("Transition occured",{location:"AuthenticationFlow",method:"interpreter.onTransition()",event:t})})).onTransition((0,be.V)((e=>this.allowedToFail.doOne((()=>{throw e}))))).onEvent((0,Ce.V)((e=>this.allowedToFail.doOne((()=>{throw e}))))).onTransition((async()=>{const e=this.interpreter.getSnapshot();await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.loginMachineStore,e)})),this.abortDeviceLimitEventHandler=new _e(this.interpreter,this.carbon)}}De=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ie?Object:Ie,void 0===Te?Object:Te,Boolean,void 0===a._?Object:a._,void 0===l.J?Object:l.J,void 0===_.SX?Object:_.SX])],De);var Fe=s(82874),Pe=s(39650);class Ue{execute(e){const{pinCode:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_PIN_CODE",pinCode:t}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}Ue=(0,i.gn)([(0,Fe.W)(Pe.CO),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],Ue);class Ne{execute(){return this.authenticationFlow.continue({type:"USE_MASTER_PASSWORD"}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}Ne=(0,i.gn)([(0,Fe.W)(Pe.On),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],Ne);class Le{execute(){return this.authenticationFlow.continue({type:"SWITCH_TO_PIN_CODE"}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}Le=(0,i.gn)([(0,Fe.W)(Pe.WF),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],Le);class xe{execute(e){const{login:t}=e.body;return this.authenticationFlow.continue({type:"CHANGE_ACCOUNT_EMAIL",login:t}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}xe=(0,i.gn)([(0,Fe.W)(Pe.hW),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],xe);class Ge{execute(e){const{twoFactorAuthenticationOtpType:t}=e.body;return this.authenticationFlow.continue({type:"SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE",twoFactorAuthenticationOtpType:t}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}Ge=(0,i.gn)([(0,Fe.W)(Pe.eG),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],Ge);class ke{execute(){return this.authenticationFlow.continue({type:"CLEAR_ERROR"}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}ke=(0,i.gn)([(0,Fe.W)(Pe.jq),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],ke);class Ke{execute(){return this.authenticationFlow.continue({type:"CANCEL_DEVICE_TRANSFER_REQUEST"}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}Ke=(0,i.gn)([(0,Fe.W)(Pe.Yc),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],Ke);class Me{execute(){return this.authenticationFlow.continue({type:"RESEND_EMAIL_TOKEN"}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}Me=(0,i.gn)([(0,Fe.W)(Pe.Gc),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],Me);class je{execute(){return this.authenticationFlow.continue({type:"RESEND_PUSH_NOTIFICATION"}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}je=(0,i.gn)([(0,Fe.W)(Pe.rF),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],je);class Ve{execute(e){const{login:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_ACCOUNT_EMAIL",login:t}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}Ve=(0,i.gn)([(0,Fe.W)(Pe.A),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],Ve);class We{execute(e){const{masterPassword:t,rememberMe:s}=e.body;return this.authenticationFlow.continue({type:"INPUT_MASTER_PASSWORD",masterPassword:t,rememberMe:s}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}We=(0,i.gn)([(0,Fe.W)(Pe.rT),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],We);class Be{execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_BACKUP_CODE",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}Be=(0,i.gn)([(0,Fe.W)(Pe.sH),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],Be);class ze{execute(e){const{emailToken:t,deviceName:s}=e.body;return this.authenticationFlow.continue({type:"INPUT_EMAIL_TOKEN",emailToken:t,deviceName:s}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}ze=(0,i.gn)([(0,Fe.W)(Pe.XH),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],ze);class qe{execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_TOTP",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}qe=(0,i.gn)([(0,Fe.W)(Pe.ad),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],qe);class He{execute(){return this.authenticationFlow.continue({type:"SWITCH_TO_DASHLANE_AUTHENTICATOR"}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}He=(0,i.gn)([(0,Fe.W)(Pe.K1),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],He);class Ye{execute(){return this.authenticationFlow.continue({type:"SWITCH_TO_EMAIL_TOKEN"}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}Ye=(0,i.gn)([(0,Fe.W)(Pe.v5),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],Ye);class Qe{execute(){return this.authenticationFlow.continue({type:"USE_DEVICE_TO_DEVICE_AUTHENTICATION"}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}Qe=(0,i.gn)([(0,Fe.W)(Pe.sU),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],Qe);class $e{execute(){return this.authenticationFlow.continue({type:"RETRY_WEBAUTHN_AUTHENTICATION"}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}$e=(0,i.gn)([(0,Fe.W)(Pe.M6),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],$e);class Xe{execute(e){const{webAuthnError:t}=e.body;return this.authenticationFlow.continue({type:"WEBAUTHN_AUTHENTICATION_FAIL",error:t}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}Xe=(0,i.gn)([(0,Fe.W)(Pe.O3),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],Xe);class Ze{async execute(){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"closeSession",arg:[{}]})}catch(e){this.logger.error("Error closing session",{location:"LogoutCommandHandler",method:"execute()",error:e})}return Promise.resolve((0,g.Vp)(void 0))}constructor(e,t){this.carbonLegacy=e,this.logger=t}}Ze=(0,i.gn)([(0,Fe.W)(Pe.N5),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._,void 0===_.SX?Object:_.SX])],Ze);class Je{async execute(){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"lockSession",arg:[{}]})}catch(e){this.logger.trace("Error locking the session",{location:"LockCommandHandler",method:"execute()",error:e})}return Promise.resolve((0,g.Vp)(void 0))}constructor(e,t){this.carbonLegacy=e,this.logger=t}}Je=(0,i.gn)([(0,Fe.W)(Pe.Y$),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._,void 0===_.SX?Object:_.SX])],Je);class et{execute(e){return this.authenticationFlow.continue({type:"CARBON_LEGACY_SSO_LOGIN_BYPASS",...e.body}),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.authenticationFlow=e}}et=(0,i.gn)([(0,Fe.W)(Pe.yv),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De])],et);var tt=s(7303),st=s(53932),it=s(20246),rt=s(60018);const nt=e=>!(!e||"object"!=typeof e)&&"rememberMeForSSOPreference"in e;class ot extends((0,S.Q)({codec:rt.E,persist:!0,storage:{initialValue:{rememberMeForSSOPreference:!0},schemaVersion:1,typeGuard:nt},scope:y.F.Device,storeName:"sso-info",storeTypeGuard:nt,capacity:L.Y._001KB})){}class at{}class ct{async retrieveSSOInfo(){const e=await(0,r.z)(this.carbonLegacyClient.queries.carbonState({path:"userSession.ssoSettings"}).pipe((0,re.U)((e=>{if(!((0,g.d6)(e)&&(t=e.data,t&&"object"==typeof t&&(0,tt.l$)(t,"ssoUser")&&(0,tt.l$)(t,"serviceProviderUrl"))))throw new Error("SsoSettings is not of the expected type");var t;return e.data}))));return{isNitroProvider:e.isNitroProvider??!1,serviceProviderUrl:e.serviceProviderUrl}}async execute(e){const{loginUserWithEnclaveSSO:t}=this.client.getClient(it.y).commands,s=await this.retrieveSSOInfo(),{login:i,rememberMeForSSOPreference:r}=e.body;return await this.ssoUserSettingsStore.set({rememberMeForSSOPreference:r}),s.isNitroProvider?await t({userEmailAddress:i}):this.authenticationFlowInfraContext.redirectUserToExternalUrl({externalUrl:s.serviceProviderUrl,tabFocus:!0}),Promise.resolve((0,g.Vp)(void 0))}constructor(e,t,s,i){this.carbonLegacyClient=e,this.ssoUserSettingsStore=s,this.client=t,this.authenticationFlowInfraContext=i}}ct=(0,i.gn)([(0,Fe.W)(Pe.Hr),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._,void 0===st.w?Object:st.w,void 0===ot?Object:ot,void 0===at?Object:at])],ct);var dt=s(74081);const lt=e=>!!e&&"object"==typeof e&&(0,tt.l$)(e,"type")&&"sso"===e.type;class ut{getDeviceAccessKeys(e){return this.carbonLegacyClient.queries.carbonState({path:"authentication.localUsers"}).pipe((0,ie.h)(g.d6),(0,re.U)((t=>t.data[e])))}async checkSSOInfo(e){const t=(await(0,r.z)(this.getDeviceAccessKeys(e).pipe((0,re.U)((t=>this.serverApiClient.v1.authentication.getAuthenticationMethodsForLogin({login:e,deviceAccessKey:t.deviceAccessKey,methods:["email_token","totp","duo_push","dashlane_authenticator"]}))),(0,dt.J)(),(0,ie.h)(g.d6),(0,re.U)((e=>e.data.data))))).verifications.find(lt);if(t){const e=t.ssoInfo;return{isNitroProvider:e.isNitroProvider,serviceProviderUrl:e.serviceProviderUrl}}throw new Error("No SSO authentication available for the user")}async execute(e){const{login:t}=e.body,{loginUserWithEnclaveSSO:s}=this.client.getClient(it.y).commands;return await this.allowToFail.doOne((async()=>{const e=await this.checkSSOInfo(t);e.isNitroProvider?await s({userEmailAddress:t,tabFocus:!1}):this.authenticationFlowInfraContext.redirectUserToExternalUrl({externalUrl:e.serviceProviderUrl,tabFocus:!1})}),{methodName:"InitiateAutologinWithSSOCommandHandler.execute"}),Promise.resolve((0,g.Vp)(void 0))}constructor(e,t,s,i,r){this.allowToFail=r,this.client=t,this.carbonLegacyClient=e,this.authenticationFlowInfraContext=s,this.serverApiClient=i}}ut=(0,i.gn)([(0,Fe.W)(Pe.x2),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._,void 0===st.w?Object:st.w,void 0===at?Object:at,void 0===U.l?Object:U.l,void 0===l.J?Object:l.J])],ut);var pt=s(85798),ht=s(40923);class gt{getLoginFlowMigrationKillswitch(){return(0,r.z)(this.carbon.queries.carbonState({path:"device.killswitch.disableLoginFlowMigration"}).pipe((0,ie.h)(g.d6),(0,re.U)((e=>e))))}async handle(e){const t=await this.getLoginFlowMigrationKillswitch();let s=!1;if("undefined"!=typeof self&&self.localStorage){const e=self.localStorage.getItem("extng.loginFlow.forceLegacyFallback");s=Boolean(e)&&"true"===e}if("success"===t.tag&&t.data||s)return this.logger.warn("Authentication flow - Ignoring carbon event due to legacy login fallback",{location:"CarbonLegacyEventHandler",method:"handle()",isKillSwitchEnabled:t,isForceLoginFlowFallbackOptionEnabled:s}),Promise.resolve();switch(e.body.eventName){case"openSessionMasterPasswordLess":this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_DEVICE_TO_DEVICE"});break;case"openSessionTokenSent":if(!e.body.eventData||"object"!=typeof e.body.eventData||!("login"in e.body.eventData)||"string"!=typeof e.body.eventData.login)throw new Error("login not in eventData");this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_TOKEN_SENT",login:e.body.eventData.login});break;case"openSessionAskMasterPassword":{const e=await(0,r.z)(this.carbon.queries.getMasterPasswordAndServerKey());if((0,g.hx)(e))throw new Error("Failed to get  server key from carbon");const{serverKey:t}=e.data;this.authenticationFlow.continue({type:"CARBON_LEGACY_ASK_MASTER_PASSWORD",serverKey:t})}break;case"openSessionDashlaneAuthenticator":this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_DASHLANE_AUTHENTICATOR"});break;case"openSessionOTPSent":case"openSessionOTPForNewDeviceRequired":this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_OTP_SENT",otpVerificationMode:"openSessionOTPSent"===e.body.eventName?"otp2":"otp1"});break;case"openSessionSsoRedirectionToIdpRequired":{const t=e.body.eventData,{rememberMeForSSOPreference:s}=await this.ssoUserSettingsStore.getState();this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_SSO_REDIRECTION_TO_IDP_REQUIRED",serviceProviderRedirectUrl:t.serviceProviderRedirectUrl,isNitroProvider:t.isNitroProvider,rememberMeForSSOPreference:s})}break;case"openSessionFailed":{const t=e.body.eventData;return"WRONG_PASSWORD"===t.errorCode?this.authenticationFlow.continue({type:"CARBON_WRONG_PASSWORD"}):this.authenticationFlow.continue({type:"CARBON_LEGACY_ERROR",error:t.errorCode})}case"carbonLoginStatusChanged":{e.body.eventData.loggedIn||this.authenticationFlow.continue({type:"CARBON_LEGACY_LOGGED_OUT"});const t=await(0,r.z)(this.carbon.queries.getSSOMigrationInfo().pipe((0,ie.h)(g.d6),(0,re.U)((e=>e.data))));await this.ssoInfos.update((e=>({...e,migrationType:t.migration})))}}return Promise.resolve()}constructor(e,t,s,i,r){this.authenticationFlow=e,this.ssoUserSettingsStore=t,this.carbon=s,this.ssoInfos=i,this.logger=r}}gt=(0,i.gn)([(0,pt.b)(ht.Dj),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De,void 0===ot?Object:ot,void 0===a._?Object:a._,void 0===G?Object:G,void 0===_.SX?Object:_.SX])],gt);var mt=s(37182),vt=s(6136),yt=s(46449),St=s(93780),wt=s(69885),Et=s(6220);const It=e=>({step:"EmailStep",loginEmail:e.context.login,localAccounts:e.context.localAccounts??[],isLoading:e.matches("ValidatingEmail")&&!e.context.error,error:e.context.error?.data?.message}),At=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:N.E6.WaitingForTransferRequest,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),ft=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:N.E6.DisplayInstructions,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),bt=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:N.E6.LoadingPassphrase,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),Ct=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:N.E6.DisplayPassphrase,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,passphrase:e.context.passphrase?.split(Se.iy)||[],error:e.context.error}),Ot=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:N.E6.LoadingAccount,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),Rt=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:N.E6.Error,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error??N.UY.GENERIC_ERROR}),Tt=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:N.E6.DeviceRegistered,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),_t=e=>({step:"EmailTokenStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})&&!e.context.error,error:e.context.error?.data?.message,emailToken:e.context.emailToken,isDashlaneAuthenticatorAvailable:e.context.isDashlaneAuthenticatorAvailable}),Dt=e=>({step:"DashlaneAuthenticatorStep",localAccounts:e.context.localAccounts??[],isLoading:e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})&&!e.context.error,error:e.context.error?.data?.message}),Ft=e=>({step:"TwoFactorAuthenticationOtpStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})&&!e.context.error,error:e.context.error?.data?.message,twoFactorAuthenticationOtpValue:e.context.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.context.twoFactorAuthenticationOtpType}),Pt=e=>({step:"WebAuthnStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login??"",isLoading:e.matches({WebAuthn:"InitWebAuthnAuthentication"})&&!e.context.error,error:e.context.error?.data?.message}),Ut=e=>({step:"SSORedirectionToIdpStep",loginEmail:e.context.login,serviceProviderRedirectUrl:e.context.serviceProviderRedirectUrl??"",isNitroProvider:e.context.isNitroProvider??!1,rememberMeForSSOPreference:e.context.rememberMeForSSOPreference,isLoading:e.matches({SSORedirectionToIdp:"InitSSOAuthentication"})&&!e.context.error,error:e.context.error?.data?.message,localAccounts:e.context.localAccounts??[]}),Nt=(e,t)=>({step:"MasterPasswordStep",loginEmail:e.context.login??"",localAccounts:e.context.localAccounts??[],isLoading:(e.matches({MasterPassword:"ValidatingMasterPassword"})||e.matches({MasterPassword:"CheckingMigrationNeeded"})||e.matches({MasterPassword:"OpeningSessionWithMasterpassword"})||e.matches("MasterPasswordBasedAuthenticationDone"))&&!e.context.error,isAccountRecoveryAvailable:e.context.isAccountRecoveryAvailable,error:e.context.error?.data?.message,serviceProviderRedirectUrl:e.context.serviceProviderRedirectUrl,isNitroProvider:e.context.isNitroProvider??!1,isAuthenticationDone:t}),Lt=e=>{if(!e.context.login)throw new Error("No email login");return{step:"PinCodeStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({PinCode:"ValidatingPinCode"})&&!e.context.error,error:e.context.error?.code}},xt=e=>({step:"StartingStep",localAccounts:e.context.localAccounts??[]});const Gt=e=>(0,wt.of)((0,g.Vp)(function(e){if(e.matches("Starting"))return xt(e);if(e.matches("WaitingForEmail")||e.matches("ValidatingEmail")||e.matches("CheckPinCodeAvailableForMasterPassword")||e.matches("CheckPinCodeAvailableForPasswordless"))return It(e);if(e.matches({DeviceRegistration:{EmailToken:"SendEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"WaitingForEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"FinishingEmailToken"}}))return _t(e);if(e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushFailed"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushValidated"}}))return Dt(e);if(e.matches({TwoFactorAuthentication:"WaitingForTotp"})||e.matches({TwoFactorAuthentication:"WaitingForBackupCode"})||e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})||e.matches({TwoFactorAuthentication:"FinishingTwoFactorAuthenticationOtp"})||e.matches("CheckSessionForOtp2"))return Ft(e);if(e.matches({WebAuthn:"InitWebAuthnAuthentication"})||e.matches({WebAuthn:"WebAuthnAuthenticationFailed"})||e.matches({WebAuthn:"WebAuthnAuthenticationValidated"}))return Pt(e);if(e.matches("SSORedirectionToIdp"))return Ut(e);if(e.matches({DeviceToDeviceAuthentication:"WaitingForTransferRequest"}))return At(e);if(e.matches({DeviceToDeviceAuthentication:"DisplayInstructions"}))return ft(e);if(e.matches({DeviceToDeviceAuthentication:"GeneratePassphrase"}))return bt(e);if(e.matches({DeviceToDeviceAuthentication:"StartTransfer"}))return Ct(e);if(e.matches({DeviceToDeviceAuthentication:"OpenSession"}))return Ot(e);if(e.matches({DeviceToDeviceAuthentication:"DeviceTransferError"}))return Rt(e);if(e.matches({DeviceToDeviceAuthentication:"DeviceRegistered"})||e.matches("DeviceToDeviceAuthenticationDone"))return Tt(e);if(e.matches({PinCode:"WaitingForPinCode"})||e.matches({PinCode:"ValidatingPinCode"})||e.matches({PinCode:"PinCodeError"}))return Lt(e);if(e.matches({MasterPassword:"CheckingAccountRecoveryStatus"})||e.matches({MasterPassword:"WaitingForMasterPassword"})||e.matches({MasterPassword:"ValidatingMasterPassword"})||e.matches({MasterPassword:"OpeningSessionWithMasterpassword"})||e.matches({MasterPassword:"CheckingMigrationNeeded"})||e.matches({MasterPassword:"OpeningSessionWithMasterpassword"}))return Nt(e);if(e.matches("MasterPasswordBasedAuthenticationDone"))return Nt(e,!0);throw new Error(`[Auth] - No view associated to state ${JSON.stringify(e.value)}`)}(e))),kt=e=>e.pipe((0,Et.z)(Gt));var Kt=s(54389);class Mt{execute(){return(e=this.loginMachineStore,e.state$.pipe((0,re.U)((e=>e?Oe.ZM.create(JSON.parse(e)):void 0)))).pipe((0,ie.h)(Boolean),(0,vt.x)(((e,t)=>((e,t)=>{const s=t.matches(e.value),i=(0,Kt.Z)(e.context,t.context);return s&&i})(e,t))),kt,(0,mt.K)(((e,t)=>(this.logger.error("Error retrieving the machine view data",{location:"AuthenticationFlowQueryStatusHandler",method:"execute()",error:e}),t))));var e}constructor(e,t,s){this.authenticationFlow=e,this.loginMachineStore=t,this.logger=s}}Mt=(0,i.gn)([(0,yt.e)(St.DW),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===De?Object:De,void 0===Te?Object:Te,void 0===_.SX?Object:_.SX])],Mt);class jt{execute(){return this.ssoUserSettingsStore.state$.pipe((0,re.U)((e=>(0,g.Vp)({rememberMeForSSOPreference:e.rememberMeForSSOPreference}))))}constructor(e){this.ssoUserSettingsStore=e,this.ssoUserSettingsStore=e}}jt=(0,i.gn)([(0,yt.e)(St.Dc),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ot?Object:ot])],jt);class Vt{execute(){return this.ssoProviderInfoStore.state$.pipe((0,re.U)((e=>(0,g.Vp)({serviceProviderUrl:e.serviceProviderUrl,isNitroProvider:e.isNitroProvider,migrationType:e.migrationType}))))}constructor(e){this.ssoProviderInfoStore=e,this.ssoProviderInfoStore=e}}Vt=(0,i.gn)([(0,yt.e)(St.L2),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===G?Object:G])],Vt);var Wt=s(35451);class Bt{}Bt=(0,i.gn)([(0,c.Y)({api:n.V,handlers:{commands:{changeLogin:xe,changeTwoFactorAuthenticationOtpType:Ge,clearError:ke,cancelDeviceTransferRequest:Ke,resendEmailToken:Me,resendPushNotification:je,sendAccountEmail:Ve,sendMasterPassword:We,submitBackupCode:Be,submitEmailToken:ze,submitTotp:qe,submitPinCode:Ue,switchToMasterPassword:Ne,switchToDashlaneAuthenticator:He,switchToEmailToken:Ye,switchToDevicetoDeviceAuthentication:Qe,switchToPinCode:Le,retryWebAuthnAuthentication:$e,webAuthnAuthenticationFail:Xe,logout:Ze,lockSession:Je,loginViaSSO:et,initiateLoginWithSSO:ct,initiateAutologinWithSSO:ut},events:{...(0,c.g)(o.W,{carbonLegacy:gt})},queries:{authenticationFlowStatus:Mt,getSsoUserSettings:jt,getProviderInfo:Vt}},configurations:{authenticationFlowContextInfrastructure:{token:at}},providers:[z,Q,H,$,V,Z,Ee,...(0,d.H)(De,{inject:[Ie,Te,a._,p.c,l.J,_.SX],asyncFactory:async(e,t,s,i,n,o)=>{let a=!1;const c=await(0,r.z)(i.queries.platformInfo());!(0,g.d6)(c)||c.data.buildType!==h.P.DEV&&c.data.buildType!==h.P.NIGHTLY||(a=!0);const d=new De(e,t,a,s,n,o);return await d.prepare(),d}}),Ie,se,te,ne,oe,D,M,W,q,T,X,ce,B,ae,de,he,j,me,we,ve,ye,ge.q,ue.C,Se.Kp,Se.Ny,(0,u.ND)(_.SX)],stores:[Te,E,ot,G],imports:[m.n,v.i,Wt.I]})],Bt)},36021:(e,t,s)=>{s.d(t,{z:()=>i});class i extends Error{constructor(e,t){super(e),this.code=t}}},6751:(e,t,s)=>{s.d(t,{R:()=>m});var i=s(92336),r=s(86006),n=s(70063),o=s(91984),a=s(16623),c=s(14122),d=s(46449),l=s(78346),u=s(85390),p=s(87065),h=s(6136);class g{execute(){const e=this.carbon.queries.liveWebAuthnAuthenticationOptedIn(void 0),t=this.pinCode.queries.getCurrentUserStatus();return(0,u.a)({webAuthnQuery:e,pinCodeQuery:t}).pipe((0,p.U)((({pinCodeQuery:e,webAuthnQuery:t})=>{if((0,l.hx)(e)||(0,l.hx)(t))throw new Error("failed to query");return e.data.isPinCodeEnabled||t.data})),(0,h.x)(),(0,p.U)(l.Vp))}constructor(e,t){this.carbon=e,this.pinCode=t}}g=(0,i.gn)([(0,d.e)(o._),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===c._?Object:c._,void 0===a.u?Object:a.u])],g);class m{}m=(0,i.gn)([(0,r.Y)({api:n.n,handlers:{commands:{},events:{},queries:{canLockApp:g}}})],m)},56684:(e,t,s)=>{s.d(t,{_:()=>L});var i=s(92336),r=s(86006),n=s(25252),o=s(6648),a=s(82874),c=s(78346),d=s(52477),l=s(56742),u=s(60399),p=s(89238),h=s(14122),g=s(92587),m=s(53344),v=s(66610),y=s(17591);const S="ZZ";const w="und";function E(e){return e?e.replace(/https?:\/\//g," "):e}var I=s(43902);const A={tag:"InvalidTokenError"},f={tag:"NetworkError"};class b{async hasRegisteredDevice(e){const t=await(0,u.z)(this.carbon.queries.getLocalAccounts());if((0,c.hx)(t))throw new Error("Failed to query carbon");return t.data.some((t=>t.login===e))}async registerDeviceWithToken(e,t,s){const i=await(0,u.z)(this.serverApiClient.v1.authentication.performExtraDeviceVerification({login:e,token:t}));if(!(0,c.d6)(i))return(0,c.Rn)(A);const{authTicket:r}=i.data.data;return this.registerDeviceWithTicket(e,r,s)}async registerDeviceWithTicket(e,t,s){const i=await(0,u.z)(this.carbon.queries.getPlatformInfo());if(!(0,c.d6)(i))throw new Error("Failed to get status from carbon");const r=i.data;if("server_carbon_unknown"===r.platformName)throw new Error("unexpected server_carbon_unknown");const n={deviceName:E(s??I.getDefaultDeviceName()),appVersion:r.appVersion,platform:r.platformName,osCountry:(a=r.country,!a||a.length<2||a.length>5?S:a),osLanguage:(o=r.lang,!o||o.length<2||o.length>5?w:o),temporary:!1};var o,a;const l=await(0,u.z)(this.serverApiClient.v1.authentication.completeDeviceRegistrationWithAuthTicket({authTicket:t,login:e,device:n}));if(!(0,c.d6)(l))return(0,d.EQ)(l.error,{BusinessError:()=>(0,y.j)("Failed to register on server"),FetchFailedError:()=>(0,c.Rn)(f),InternalServerError:()=>(0,y.j)("Failed to register on server"),InvalidRequest:()=>(0,y.j)("Failed to register on server"),RateLimited:()=>(0,y.j)("Failed to register on server"),ServiceUnavailable:()=>(0,y.j)("Failed to register on server"),UnspecifiedBadStatus:()=>(0,y.j)("Failed to register on server")});const{deviceAccessKey:p,deviceSecretKey:h,settings:g,serverKey:m}=l.data.data;return await this.registerDeviceWithKeys({deviceAccessKey:p,deviceSecretKey:h,login:e,settingsContent:g.content,serverKey:m})}async registerDeviceWithKeys({deviceAccessKey:e,deviceSecretKey:t,settingsContent:s,serverKey:i,login:r}){const n=await(0,u.z)(this.contextless.v1.account.accountInfo({deviceAccessKey:e,deviceSecretKey:t,login:r}));if(!(0,c.d6)(n))return(0,d.EQ)(n.error,{BusinessError:()=>(0,y.j)("Failed to get account infos"),FetchFailedError:()=>(0,c.Rn)(f),InternalServerError:()=>(0,y.j)("Failed to get account infos"),InvalidRequest:()=>(0,y.j)("Failed to get account infos"),RateLimited:()=>(0,y.j)("Failed to get account infos"),ServiceUnavailable:()=>(0,y.j)("Failed to get account infos"),UnspecifiedBadStatus:()=>(0,y.j)("Failed to get account infos")});const{creationDateUnix:o,publicUserId:a,deviceAnalyticsId:l,userAnalyticsId:h}=n.data.data,g=await this.carbon.commands.registerDevice({deviceAccessKey:e,deviceAnalyticsId:l??"",deviceSecretKey:t,settings:{action:"BACKUP_EDIT",backupDate:o,content:s,identifier:"SETTINGS_userId",time:o,type:"SETTINGS"},serverKey:i,publicUserId:a,userAnalyticsId:h??"",isDataPersisted:p.jP.PERSIST_DATA_YES,login:r});if((0,c.hx)(g))throw new Error("Failed to register in carbon");return(0,c.Vp)(void 0)}constructor(e,t,s){this.serverApiClient=e,this.carbon=t,this.contextless=s}}b=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===m.l?Object:m.l,void 0===h._?Object:h._,void 0===v.B?Object:v.B])],b);const C={tag:"DeviceAlreadyRegistered"};class O{async execute({body:e}){const{login:t,ignoreAlreadyRegisteredError:s,deviceName:i}=e;if(!s){if(await this.service.hasRegisteredDevice(t))return(0,c.Rn)(C)}switch(e.with){case"authTicket":return this.service.registerDeviceWithTicket(t,e.authTicket,i);case"token":return(0,d.EQ)(await this.service.registerDeviceWithToken(t,e.token,i),{success:()=>(0,c.Vp)(void 0),failure:e=>(0,d.EQ)(e.error,{InvalidTokenError:e=>(0,c.Rn)(e),NetworkError:e=>(0,c.Rn)(e)})});case"deviceKeys":return await this.service.registerDeviceWithKeys({deviceAccessKey:e.deviceAccessKey,deviceSecretKey:e.deviceSecretKey,login:t,settingsContent:e.settings,serverKey:e.serverKey});default:return(0,l.U)(e)}}constructor(e){this.service=e}}O=(0,i.gn)([(0,a.W)(o.J),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===b?Object:b])],O);var R=s(41511),T=s(3552);class _{async execute(){const e=await this.carbon.commands.cleanRemotelyRemovedProfiles();if((0,c.hx)(e))throw new Error("clean remotely removed profiles failed");return(0,c.Vp)(void 0)}constructor(e){this.carbon=e}}_=(0,i.gn)([(0,a.W)(T.L),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h._?Object:h._])],_);var D=s(162),F=s(87065),P=s(46449),U=s(36205);class N{isLocalAccounts(e){if(!Array.isArray(e))return!1;if(0===e.length)return!0;const t=e[0];return"object"==typeof t&&"login"in t}isCarbonLocalAccountResult(e){return!(!e||"object"!=typeof e||!("localAccounts"in e))&&this.isLocalAccounts(e.localAccounts)}execute(){return(0,D.D)(this.carbon.commands.carbonLegacyLeeloo({name:"getLocalAccountsList",arg:[]})).pipe((0,F.U)((e=>{if((0,c.hx)(e))throw new Error("Unable to retrieve local accounts list");const t=(0,c.db)(e).carbonResult;if(!this.isCarbonLocalAccountResult(t))throw new Error("Carbon result is not of type local accounts");return(0,c.Vp)({localAccounts:t.localAccounts})})))}constructor(e){this.carbon=e}}N=(0,i.gn)([(0,P.e)(U.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h._?Object:h._])],N);class L{}L=(0,i.gn)([(0,r.Y)({api:n.G,imports:[R.n],handlers:{commands:{cleanRemotelyRemovedProfiles:_,registerDevice:O},events:{},queries:{localAccounts:N}},providers:[b]})],L)},89408:(e,t,s)=>{s.d(t,{E:()=>o,V:()=>a});var i=s(92336),r=s(75377),n=s(92587);class o{generateNonce(){return this.sodium.randombytes_buf(this.sodium.crypto_box_NONCEBYTES)}generateKeyPair(){return this.sodium.crypto_kx_keypair()}hash(e,t){return this.sodium.crypto_generichash(this.sodium.crypto_secretbox_KEYBYTES,e,t)}compare(e,t){return this.sodium.memcmp(e,t)}generateClientSharedSecret(e,t,s){return this.sodium.crypto_kx_client_session_keys(e,t,s)}generateServerSharedSecret(e,t,s){return this.sodium.crypto_kx_server_session_keys(e,t,s)}encrypt(e,t,s){return this.sodium.crypto_secretbox_easy(e,t,s)}decrypt(e,t,s){return this.sodium.crypto_secretbox_open_easy(e,t,s)}constructor(e){this.sodium=e}}function a(){return{token:o,asyncFactory:async()=>{await r.ready;return new o(r)}}}o=(0,i.gn)([(0,n.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object])],o)},38054:(e,t,s)=>{s.d(t,{K:()=>r,d:()=>n});var i=s(29498);const r=3;class n extends i.x{constructor(e,t){super(e),this.code=t}}},35451:(e,t,s)=>{s.d(t,{I:()=>de});var i=s(92336),r=s(88170),n=s(86006),o=s(86213),a=s(85045),c=s(41511),d=s(89408),l=s(86051),u=s(87065),p=s(62149),h=s(63144);const g=e=>!0;class m extends((0,h.Q)({initialValue:void 0,persist:!1,scope:p.F.Device,storeName:"trusted-device-flow-machine",storeTypeGuard:g})){}const v=e=>e.state$.pipe((0,u.U)((e=>e?l.ZM.create(JSON.parse(e)):void 0)));var y=s(14160),S=s(24966),w=s(92587),E=s(7194),I=s(47440),A=s(77043),f=s(78346),b=s(38568);class C{async execute(){const e=await this.d2dAuthenticationService.getKeyExchangeTransferInfo();if((0,f.hx)(e))throw new Error("Error with getKeyExchangeTransferInfo");const{transferId:t,receiver:s}=e.data.transfer;return Promise.resolve({transferId:t,requestTimestamp:s.requestedAtDateUnix,untrustedDeviceName:s.deviceName,untrustedDeviceLocation:`${s.city}, ${s.countryCode}`,untrustedDeviceHashedPublicKey:s.hashedPublicKey})}constructor(e){this.d2dAuthenticationService=e}}C=(0,i.gn)([(0,w.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===b.C?Object:b.C])],C);var O=s(62430),R=s(19715);class T{async execute(e){const{privateKey:t,publicKey:s}=this.d2dCryptoService.generateKeyPair();if(!e.transferId)throw new Error("No transferId in context");const i=await this.d2dAuthenticationService.startSenderKeyExchange(e.transferId,s);if((0,f.hx)(i))return Promise.reject(i.error);const{receiverPublicKey:r}=i.data,n=e.untrustedDeviceHashedPublicKey;if(!this.d2dCryptoService.verifyUntrustedDevicePublicKey(n,r))throw new Error("Receiver public key doesn't match");const o=this.d2dCryptoService.generateSenderSharedSecret(s,t,r),a=await this.d2dAuthenticationService.getCurrentUserLogin();if((0,f.hx)(a)||!a.data)throw new Error("No user login in context");const c=this.d2dCryptoService.generateVisualCheckSeed(a.data,e.transferId,o),{passphrase:d,missingWordIndex:l}=await this.passphraseService.generatePassphraseChallenge(c);return{sharedSecret:o,passphrase:d,passhraseMissingWordIndex:l}}constructor(e,t,s){this.d2dCryptoService=e,this.d2dAuthenticationService=t,this.passphraseService=s}}T=(0,i.gn)([(0,w.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===O.q?Object:O.q,void 0===b.C?Object:b.C,void 0===R.Kp?Object:R.Kp])],T);var _=s(38054);class D{async execute(e){if(!this.passphraseService.verifyChallenge(e.passphrase,e.passphraseGuess))throw new _.d("Passphrase incorrect",e.passphraseAttemptsLeft>1?A.S.INVALID_PASSPHRASE:A.S.PASSPHRASE_ATTEMPTS_LIMIT);const t=await this.d2dAuthenticationService.getCurrentUserLogin();if((0,f.hx)(t)||!t.data||!e.transferId)throw new Error("No user login or no transferId");const s=await this.d2dAuthenticationService.getUserInvisibleMasterPassword(),i=await this.d2dAuthenticationService.requestAuthTicket();if((0,f.hx)(i))throw new Error("Couldn't get authTicket");const{encryptedData:r,nonce:n}=this.d2dCryptoService.encryptInvisibleMasterPassword(t.data,i.data,s,e.transferId,e.sharedSecret),o=await this.d2dAuthenticationService.completeTransfer(r,n,e.transferId);return(0,f.hx)(o)?Promise.reject(o.error):Promise.resolve()}constructor(e,t,s){this.passphraseService=e,this.d2dCryptoService=t,this.d2dAuthenticationService=s}}D=(0,i.gn)([(0,w.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===R.Kp?Object:R.Kp,void 0===O.q?Object:O.q,void 0===b.C?Object:b.C])],D);class F{create(){return(0,E.C)({predictableActionArguments:!0,schema:{events:{},context:{}},initial:"WaitingForNewDeviceTransferRequest",id:"TrustedDeviceFlowMachine",context:{transferId:void 0,untrustedDeviceName:"",untrustedDeviceHashedPublicKey:"",untrustedDeviceLocation:"",sharedSecret:"",passphrase:"",passphraseGuess:"",passphraseMissingWordIndex:-1,passphraseAttemptsLeft:_.K},states:{Idle:{on:{REFRESH_REQUEST:{target:"WaitingForNewDeviceTransferRequest"}}},WaitingForNewDeviceTransferRequest:{invoke:{src:"getPendingDeviceTransferRequest",onDone:[{actions:["assignUntrustedDeviceData"],cond:"isDeviceTransferRequestAvailable",target:"NewDeviceTransferRequest"},{target:"Idle"}],onError:{actions:["assignTrustedDeviceFlowError"],target:"Idle"}}},NewDeviceTransferRequest:{on:{APPROVE_REQUEST:{target:"HandlingDeviceTransferRequest"},REJECT_REQUEST:{actions:["clearContext"],target:"DeviceTransferRejected"},RETURN_TO_DEVICE_SETUP:{actions:["clearContext"],target:"Idle"}}},HandlingDeviceTransferRequest:{invoke:{src:"approveDeviceTransferRequest",onDone:{actions:["assignPassphraseChallengeData"],target:"DisplayPassphraseChallenge"},onError:{actions:["assignTrustedDeviceFlowError"],target:"DeviceTransferFailed"}}},DisplayPassphraseChallenge:{on:{SUBMIT_PASSPHRASE_CHALLENGE:{actions:["assignPassphraseGuess","clearError"],target:"VerifyingPassphraseChallenge"},CANCEL_REQUEST:{actions:["clearContext"],target:"Idle"}}},VerifyingPassphraseChallenge:{invoke:{src:"verifyPassphraseChallenge",onDone:{target:"DeviceTransferComplete"},onError:[{actions:["assignTrustedDeviceFlowError","updatePassphraseAttempts"],target:"DisplayPassphraseChallenge",cond:"isInvalidPassphraseError"},{actions:["assignTrustedDeviceFlowError","updatePassphraseAttempts"],target:"DeviceTransferFailed"}]}},DeviceTransferComplete:{on:{RETURN_TO_DEVICE_SETUP:{actions:["clearContext"],target:"Idle"}}},DeviceTransferRejected:{on:{RETURN_TO_DEVICE_SETUP:{target:"Idle"}}},DeviceTransferFailed:{on:{RETURN_TO_DEVICE_SETUP:{actions:["clearContext"],target:"Idle"}}}}},{actions:{assignUntrustedDeviceData:(0,I.f0)({transferId:(e,t)=>t.data.transferId,untrustedDeviceName:(e,t)=>t.data.untrustedDeviceName,untrustedDeviceHashedPublicKey:(e,t)=>t.data.untrustedDeviceHashedPublicKey,untrustedDeviceLocation:(e,t)=>t.data.untrustedDeviceLocation,requestTimestamp:(e,t)=>t.data.requestTimestamp}),clearContext:(0,I.f0)({transferId:()=>{},untrustedDeviceName:()=>"",untrustedDeviceHashedPublicKey:()=>"",untrustedDeviceLocation:()=>"",sharedSecret:()=>"",passphrase:()=>"",passphraseGuess:()=>"",passphraseMissingWordIndex:()=>-1,passphraseAttemptsLeft:()=>_.K,error:()=>{}}),clearError:(0,I.f0)({error:()=>{}}),assignTrustedDeviceFlowError:(0,I.f0)({error:(e,t)=>t.data instanceof _.d?t.data.code:A.S.GENERIC_ERROR}),assignPassphraseChallengeData:(0,I.f0)({sharedSecret:(e,t)=>t.data.sharedSecret,passphrase:(e,t)=>t.data.passphrase,passphraseMissingWordIndex:(e,t)=>t.data.passhraseMissingWordIndex}),assignPassphraseGuess:(0,I.f0)({passphraseGuess:(e,t)=>t.passphraseChallenge}),updatePassphraseAttempts:(0,I.f0)({passphraseAttemptsLeft:(e,t)=>t.data instanceof _.d&&t.data.code===A.S.INVALID_PASSPHRASE?e.passphraseAttemptsLeft-1:e.passphraseAttemptsLeft})},services:{getPendingDeviceTransferRequest:()=>this.getPendingDeviceTransferRequestService.execute(),approveDeviceTransferRequest:e=>this.approveDeviceTransferRequestService.execute(e),verifyPassphraseChallenge:e=>this.verifyPassphraseChallengeService.execute(e)},guards:{isDeviceTransferRequestAvailable:(e,t)=>!!t.data.transferId,isInvalidPassphraseError:(e,t)=>t.data instanceof _.d&&"INVALID_PASSPHRASE"===t.data.code}})}constructor(e,t,s){this.getPendingDeviceTransferRequestService=e,this.approveDeviceTransferRequestService=t,this.verifyPassphraseChallengeService=s}}F=(0,i.gn)([(0,w.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===C?Object:C,void 0===T?Object:T,void 0===D?Object:D])],F);var P=s(1140);class U{async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?l.ZM.create(JSON.parse(t)):void 0})(this.trustedDeviceMachineStore);try{this.interpreter.start(e)}catch(e){this.logger.error("D2D Trusted Device Flow - Unable to reuse the stored state",{location:"TrustedDeviceFlow",method:"prepare()",error:e}),this.interpreter.start()}}catch(e){this.logger.error("D2D Trusted Device Flow - Unable to start machine",{location:"TrustedDeviceFlow",method:"prepare()",error:e})}}ready(){return new S.X(!0)}continue(e){if(!this.interpreter)throw new Error("TrustedDevice flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}constructor(e,t,s){this.trustedDeviceMachineStore=t,this.logger=s;const i=e.create();this.interpreter=y.kJ(i).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||this.logger.warn(`D2D Trusted Device Flow - State is unchanged, unexpected transition with event ${e.event.type}`,{location:"TrustedDeviceFlow",method:"interpreter.onTransition()",event:e});try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.trustedDeviceMachineStore,e)}catch(e){this.logger.error("D2D Trusted Device Flow - Unable to get snapshot",{location:"TrustedDeviceFlow",method:"interpreter.onTransition()",error:e})}}))}}U=(0,i.gn)([(0,w.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===F?Object:F,void 0===m?Object:m,void 0===P.SX?Object:P.SX])],U);var N=s(82874),L=s(13960);class x{execute(){return this.trustedDeviceFlow.continue({type:"APPROVE_REQUEST"}),Promise.resolve((0,f.Vp)(void 0))}constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}}x=(0,i.gn)([(0,N.W)(L.G),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U])],x);var G=s(88240);class k{execute(){return this.trustedDeviceFlow.continue({type:"REFRESH_REQUEST"}),Promise.resolve((0,f.Vp)(void 0))}constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}}k=(0,i.gn)([(0,N.W)(G.V),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U])],k);var K=s(35974);class M{execute(){return this.trustedDeviceFlow.continue({type:"REJECT_REQUEST"}),Promise.resolve((0,f.Vp)(void 0))}constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}}M=(0,i.gn)([(0,N.W)(K.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U])],M);var j=s(69121);class V{execute(){return this.trustedDeviceFlow.continue({type:"CANCEL_REQUEST"}),Promise.resolve((0,f.Vp)(void 0))}constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}}V=(0,i.gn)([(0,N.W)(j.b),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U])],V);var W=s(2585);class B{execute(e){const{passphraseChallenge:t}=e.body;return this.trustedDeviceFlow.continue({type:"SUBMIT_PASSPHRASE_CHALLENGE",passphraseChallenge:t}),Promise.resolve((0,f.Vp)(void 0))}constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}}B=(0,i.gn)([(0,N.W)(W.I),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U])],B);var z=s(81181);class q{execute(){return this.trustedDeviceFlow.continue({type:"RETURN_TO_DEVICE_SETUP"}),Promise.resolve((0,f.Vp)(void 0))}constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}}q=(0,i.gn)([(0,N.W)(z.n),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U])],q);var H=s(43978),Y=s(90171),Q=s(83695),$=s(85390),X=s(37182),Z=s(41842),J=s(6136),ee=s(54389),te=s(46449),se=s(63408),ie=s(69885),re=s(6220),ne=s(32863);const oe=e=>(0,ie.of)((0,f.Vp)(function(e){if(e.matches("Idle")||e.matches("WaitingForNewDeviceTransferRequest"))return{step:A.T.WaitingForNewDeviceRequest};if(e.matches("NewDeviceTransferRequest"))return(0,ne.Xn)(e.context.requestTimestamp)<=0?{step:A.T.Error,errorCode:A.S.TIMEOUT}:{step:A.T.NewDeviceRequestAvailable,untrustedDeviceName:e.context.untrustedDeviceName,untrustedDeviceLocation:e.context.untrustedDeviceLocation,requestTimestamp:e.context.requestTimestamp};if(e.matches("HandlingDeviceTransferRequest"))return{step:A.T.LoadingChallenge};if(e.matches("DisplayPassphraseChallenge")||e.matches("VerifyingPassphraseChallenge")){const{passphrase:t,passphraseMissingWordIndex:s,untrustedDeviceName:i,error:r}=e.context,n=t.split(R.iy).map(((e,t)=>t===s?"":e));return{step:A.T.DisplayPassphraseChallenge,untrustedDeviceName:i,passphrase:n,error:r}}if(e.matches("DeviceTransferComplete"))return{step:A.T.DeviceTransferComplete,untrustedDeviceName:e.context.untrustedDeviceName};if(e.matches("DeviceTransferRejected"))return{step:A.T.DeviceTransferRejected,untrustedDeviceName:e.context.untrustedDeviceName};if(e.matches("DeviceTransferFailed"))return{step:A.T.Error,errorCode:e.context.error};throw new Error("[D2D Trusted Device] - No view associated to state")}(e))),ae=e=>e.pipe((0,re.z)(oe));class ce{execute(){const e=v(this.trustedDeviceFlowMachineStore).pipe((0,Z.h)(Boolean),(0,u.U)((e=>e.context.requestTimestamp?(0,ne.Xn)(e.context.requestTimestamp):0))).pipe((0,H.w)((e=>(0,Y.H)(e))),(0,Q.O)(0));return(0,$.a)([v(this.trustedDeviceFlowMachineStore),this.trustedDeviceFlow.ready(),e],((e,t,s)=>{if(e&&t)return e})).pipe((0,Z.h)(Boolean),ae,(0,J.x)(((e,t)=>(0,ee.Z)(e,t))),(0,X.K)(((e,t)=>(this.logger.error("Error retrieving D2D data",{location:"TrustedDeviceFlowStatusQueryHandler",method:"execute()",error:e}),t))))}constructor(e,t,s){this.trustedDeviceFlow=e,this.trustedDeviceFlowMachineStore=t,this.logger=s}}ce=(0,i.gn)([(0,te.e)(se.N),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U,void 0===m?Object:m,void 0===P.SX?Object:P.SX])],ce);class de{}de=(0,i.gn)([(0,n.Y)({api:r.F,stores:[m],imports:[c.n],exports:[O.q,d.E],providers:[(0,d.V)(),...(0,o.H)(U,{inject:[F,m,P.SX],asyncFactory:async(e,t,s)=>{const i=new U(e,t,s);return await i.prepare(),i}}),d.E,R.Kp,O.q,b.C,C,T,D,F,R.Ny,(0,a.ND)(P.SX)],handlers:{commands:{approveRequest:x,refreshRequest:k,rejectRequest:M,cancelRequest:V,submitPassphraseChallenge:B,returnToDeviceSetup:q},events:{},queries:{trustedDeviceFlowStatus:ce}}})],de)},38568:(e,t,s)=>{s.d(t,{C:()=>I});var i=s(92336),r=s(60399),n=s(43902),o=s(89238),a=s(14122),c=s(53344),d=s(18920),l=s(92587),u=s(33312),p=s(78346),h=s(52477),g=s(17591),m=s(63696),v=s(8606),y=s(77043),S=s(32863),w=s(36021),E=s(38054);class I{async getCurrentUserLogin(){return await(0,r.z)(this.sessionClient.queries.selectedOpenedSession().pipe((0,u.DZ)((()=>(0,p.Rn)(new Error("No user login found")))),(0,u.lk)((e=>(0,p.Vp)(e)))))}getUserInvisibleMasterPassword(){const{carbonState:e}=this.carbon.queries;return(0,r.z)(e({path:"userSession.session.masterPassword"}).pipe((0,u.nb)({success:e=>e,failure:()=>{throw new Error("Failure getting user invisible master password info")}})))}async requestAuthTicket(){return await(0,r.z)(this.serverApiClient.v1.authentication.requestExtraDeviceRegistration({tokenType:"googleAccountNewDevice"}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:()=>(0,p.Rn)(e),FetchFailedError:()=>(0,p.Rn)(e),UnspecifiedBadStatus:()=>(0,p.Rn)(e),InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data.token)))))}async getKeyExchangeTransferInfo(){return await(0,r.z)(this.serverApiClient.v1.secretTransfer.getKeyExchangeTransferInfo({}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:()=>(0,p.Rn)(e),FetchFailedError:()=>(0,p.Rn)(e),UnspecifiedBadStatus:()=>(0,p.Rn)(e),InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async startReceiverKeyExchange(e,t){return await(0,r.z)(this.serverApiClient.v1.secretTransfer.startReceiverKeyExchange({transferId:e,receiverHashedPublicKey:t},{timeout:6e4}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:g.j,FetchFailedError:()=>{throw new w.z("User offline or request timeout",v.UY.TIMEOUT)},UnspecifiedBadStatus:({response:t})=>{if(t.status===d.W.GatewayTimeout)return new w.z("Request has timed out",v.UY.TIMEOUT);(0,g.j)(e)},InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async completeKeyExchange(e,t){return await(0,r.z)(this.serverApiClient.v1.secretTransfer.completeKeyExchange({receiverPublicKey:t,transferId:e}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:()=>(0,p.Rn)(e),FetchFailedError:()=>(0,p.Rn)(e),UnspecifiedBadStatus:()=>(0,p.Rn)(e),InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async startTransfer(e){return await(0,r.z)(this.serverApiClient.v1.secretTransfer.startTransfer({transferId:e,transferType:"universal"},{timeout:6e4}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:g.j,FetchFailedError:g.j,UnspecifiedBadStatus:({response:t})=>t.status===d.W.GatewayTimeout?new w.z("Request has timed out",v.UY.TIMEOUT):(0,g.j)(e),InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async requestTransfer(e,t){return await(0,r.z)(this.serverApiClient.v1.secretTransfer.requestTransfer({transfer:{login:e,receiverDeviceName:t,transferType:"universal"}}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:()=>{throw new Error("[D2D]: Business Error")},FetchFailedError:()=>{throw new Error("[D2D]: Network error")},UnspecifiedBadStatus:g.j,InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async startSenderKeyExchange(e,t){return await(0,r.z)(this.serverApiClient.v1.secretTransfer.startSenderKeyExchange({transferId:e,senderPublicKey:t},{timeout:6e4}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:e=>{if("TRANSFER_DOES_NOT_EXISTS"===e.code)throw new E.d("Transfer request has expired",y.S.TIMEOUT);throw new Error("[D2D]: Business Error")},FetchFailedError:()=>{throw new Error("[D2D]: Network error")},UnspecifiedBadStatus:({response:e})=>{if(e.status===d.W.GatewayTimeout)return new E.d("Request has timed out",y.S.TIMEOUT);throw new Error("[D2D]: Bad status error")},InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async completeTransfer(e,t,s){return await(0,r.z)(this.serverApiClient.v1.secretTransfer.completeTransfer({transfer:{encryptedData:e,nonce:t,transferId:s,transferType:"universal"}}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:e=>{if("TRANSFER_DOES_NOT_EXISTS"===e.error.code)return new E.d("Request timed out",y.S.TIMEOUT);throw new Error("[D2D]: Business Error")},FetchFailedError:()=>{throw new Error("[D2D]: Network error")},UnspecifiedBadStatus:g.j,InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async openSession(e,t,s,i){const a=await(0,r.z)(this.serverApiClient.v1.authentication.performExtraDeviceVerification({login:e,token:t}));if(!(0,p.d6)(a))throw new w.z("Perform extra device verification failed",v.UY.ACCOUNT_ERROR);const{authTicket:c}=a.data.data,d=await(0,r.z)(this.carbon.queries.getPlatformInfo());if(!(0,p.d6)(d))throw new w.z("No platform info available",v.UY.ACCOUNT_ERROR);const l=d.data,u={deviceName:(0,S.$f)(i||n.getDefaultDeviceName()),appVersion:l.appVersion,platform:l.platformName,osCountry:(0,S.Yb)(l.country),osLanguage:(0,S._$)(l.lang),temporary:!1},h=await(0,r.z)(this.serverApiClient.v1.authentication.completeDeviceRegistrationWithAuthTicket({authTicket:c,login:e,device:u}));if(!(0,p.d6)(h))throw new w.z("Device registration with authTicket failed",v.UY.ACCOUNT_ERROR);const{deviceAccessKey:g,deviceAnalyticsId:m,deviceSecretKey:y,settings:E,serverKey:I,publicUserId:A,userAnalyticsId:f}=h.data.data;await this.carbon.commands.registerDevice({deviceAccessKey:g,deviceAnalyticsId:m,deviceSecretKey:y,settings:E,serverKey:I,publicUserId:A,userAnalyticsId:f,isDataPersisted:o.jP.PERSIST_DATA_YES,login:e});const b=await this.carbon.commands.openSessionWithMasterPassword({login:e,password:s,rememberPassword:!0,requiredPermissions:void 0,serverKey:"",loginType:"DeviceToDevice"});if(!(0,p.d6)(b))throw new w.z("Open session with deciphered password failed",v.UY.ACCOUNT_ERROR)}constructor(e,t,s){this.serverApiClient=e,this.sessionClient=t,this.carbon=s}}I=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===c.l?Object:c.l,void 0===m.x?Object:m.x,void 0===a._?Object:a._])],I)},62430:(e,t,s)=>{s.d(t,{q:()=>c});var i=s(92336),r=s(19911),n=s(92587),o=s(89408),a=s(32863);class c{verifyUntrustedDevicePublicKey(e,t){return this.cryptoToolboxService.compare((0,a.tp)(e),(0,a.tp)(this.hash(t)))}generateReceiverSharedSecret(e,t,s){return(0,r.s)(this.cryptoToolboxService.generateClientSharedSecret((0,a.tp)(e),(0,a.tp)(t),(0,a.tp)(s)).sharedRx)}generateSenderSharedSecret(e,t,s){return(0,r.s)(this.cryptoToolboxService.generateServerSharedSecret((0,a.tp)(e),(0,a.tp)(t),(0,a.tp)(s)).sharedTx)}generateSymmetricKey(e,t,s){return(0,r.s)(this.cryptoToolboxService.hash((new TextEncoder).encode(`DASHLANE_D2D_SYMMETRIC_KEY${e.length}${e}${t}`),(0,a.tp)(s)))}hash(e){return(0,r.s)(this.cryptoToolboxService.hash((0,a.tp)(e)))}generateKeyPair(){const e=this.cryptoToolboxService.generateKeyPair();return{publicKey:(0,r.s)(e.publicKey),privateKey:(0,r.s)(e.privateKey)}}generateVisualCheckSeed(e,t,s){return(0,r.s)(this.cryptoToolboxService.hash((new TextEncoder).encode(`DASHLANE_D2D_SAS_SEED${e.length}${e}${t}`),(0,a.tp)(s)))}encryptInvisibleMasterPassword(e,t,s,i,n){const o=(e=>(new TextEncoder).encode(JSON.stringify(e)))({login:e,key:{type:"invisible_master_password",value:s},token:t,version:1}),c=this.generateSymmetricKey(e,i,n),d=this.cryptoToolboxService.generateNonce(),l=this.cryptoToolboxService.encrypt(o,d,(0,a.tp)(c));return{encryptedData:(0,r.s)(l),nonce:(0,r.s)(d)}}decryptInvisibleMasterPassword(e,t,s){const i=this.cryptoToolboxService.decrypt((0,a.tp)(e),(0,a.tp)(t),(0,a.tp)(s)),r=new TextDecoder("utf-8").decode(i);return JSON.parse(r)}constructor(e){this.cryptoToolboxService=e}}c=(0,i.gn)([(0,n.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.E?Object:o.E])],c)},19715:(e,t,s)=>{s.d(t,{Kp:()=>u,Ny:()=>l,iy:()=>c});var i=s(92336),r=s(7531),n=s(92587),o=s(23337),a=s(32863);const c=" ",d=Math.pow(2,32)-1;class l extends r.K{loadResource(e){if(!e||!Array.isArray(e))throw new Error("Failed to load word list");return e}constructor(e){super("assets/eff_large_wordlist.json",e)}}l=(0,i.gn)([(0,n.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.X?Object:o.X])],l);class u{getWordList(){return this.fetcher.get()}async generatePassphraseChallenge(e){const t=await this.getWordList(),s=[],i=Math.floor(d/t.length)*t.length;for(let r=0;r<e.length;r+=4){const{buffer:n,byteOffset:o}=new Uint8Array((0,a.tp)(e).slice(r,r+4)),c=new DataView(n).getUint32(o,!0);if(c<i){const e=t[c%t.length];s.push(e)}if(5===s.length)break}return{passphrase:s.join(c),missingWordIndex:Math.floor(5*Math.random())}}verifyChallenge(e,t){if(!e)throw new Error("[DEVICE-TRANSFER]: Passphrase challenge not generated yet");if(!t)throw new Error("[DEVICE-TRANSFER]: Passphrase guess not saved to machine context");return e===t}constructor(e){this.fetcher=e}}u=(0,i.gn)([(0,n.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===l?Object:l])],u)},32863:(e,t,s)=>{s.d(t,{$f:()=>l,Xn:()=>r,Yb:()=>a,_$:()=>d,tp:()=>n});var i=s(63352);const r=e=>1e3*e+6e4-Date.now(),n=e=>new Uint8Array((0,i.R)(e)),o="ZZ";function a(e){return!e||e.length<2||e.length>5?o:e}const c="und";function d(e){return!e||e.length<2||e.length>5?c:e}function l(e){return e?e.replace(/https?:\/\//g," "):e}},12875:(e,t,s)=>{s.d(t,{f:()=>Ue});var i=s(92336),r=s(86006),n=s(86213),o=s(85045),a=s(41511),c=s(89742),d=s(92587),l=s(47440),u=s(7194),p=s(60399),h=s(53344),g=s(33312),m=s(52477),v=s(56742),y=s(17591),S=s(78346),w=s(98124),E=function(e){return e.VERIFICATION_FAILED="verification_failed",e.VERIFICATION_TIMEOUT="verification_timeout",e.VERIFICATION_REQUIRES_REQUEST="verification_requires_request",e.ACCOUNT_BLOCKED_CONTACT_SUPPORT="account_blocked_contact_support",e.INVALID_OTP_ALREADY_USED="invalid_otp_already_used",e.INVALID_OTP_BLOCKED="invalid_otp_blocked",e}({});class I extends((0,w.Hu)("verification_failed","")){}class A extends((0,w.Hu)("verification_timeout","")){}class f extends((0,w.Hu)("verification_requires_request","")){}class b extends((0,w.Hu)("account_blocked_contact_support","")){}class C extends((0,w.Hu)("invalid_otp_already_used","")){}class O extends((0,w.Hu)("invalid_otp_blocked","")){}class R extends((0,w.Hu)("network_error","")){}var T=function(e){return e.TOKEN_NOT_VALID="TOKEN_NOT_VALID",e.TOKEN_EXPIRED="TOKEN_EXPIRED",e.TOKEN_TOO_MANY_ATTEMPTS="TOKEN_TOO_MANY_ATTEMPTS",e.TOKEN_ACCOUNT_LOCKED="TOKEN_ACCOUNT_LOCKED",e}({}),_=function(e){return e.OTP_NOT_VALID="OTP_NOT_VALID",e.OTP_TOO_MANY_ATTEMPTS="OTP_TOO_MANY_ATTEMPTS",e.OTP_ALREADY_USED="OTP_ALREADY_USED",e.BACKUP_CODE_NOT_VALID="BACKUP_CODE_NOT_VALID",e}({}),D=function(e){return e.DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED="DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED",e.TOKEN_EXPIRED="TOKEN_EXPIRED",e}({}),F=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e}({});class P{async performEmailTokenVerification(e,t){return await(0,p.z)(this.serverApiClient.v1.authentication.performEmailTokenVerification({login:e,token:t}).pipe((0,g.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>{switch(e.code){case E.VERIFICATION_FAILED:return new I;case E.VERIFICATION_TIMEOUT:return new A;case E.VERIFICATION_REQUIRES_REQUEST:return new f;case E.ACCOUNT_BLOCKED_CONTACT_SUPPORT:return new b;default:(0,v.U)(e.code)}},FetchFailedError:()=>new R,UnspecifiedBadStatus:y.j,InternalServerError:y.j,InvalidRequest:y.j,RateLimited:y.j,ServiceUnavailable:y.j}))),(0,g.lk)((e=>(0,S.Vp)(e.data.authTicket)))))}async performTotpVerification(e,t){return await(0,p.z)(this.serverApiClient.v1.authentication.performTotpVerification({login:e,otp:t}).pipe((0,g.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>{switch(e.code){case E.VERIFICATION_FAILED:return new I;case E.INVALID_OTP_ALREADY_USED:return new C;case E.INVALID_OTP_BLOCKED:return new O;default:(0,v.U)(e.code)}},FetchFailedError:()=>new R,UnspecifiedBadStatus:y.j,InternalServerError:y.j,InvalidRequest:y.j,RateLimited:y.j,ServiceUnavailable:y.j}))),(0,g.lk)((e=>(0,S.Vp)(e.data.authTicket)))))}async performDashlaneAuthenticatorValidation(e,t){return await(0,p.z)(this.serverApiClient.v1.authentication.performDashlaneAuthenticatorVerification({login:e,deviceName:t}).pipe((0,g.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>{switch(e.code){case E.VERIFICATION_FAILED:return new I;case E.VERIFICATION_TIMEOUT:return new A;default:(0,v.U)(e.code)}},FetchFailedError:()=>new R,UnspecifiedBadStatus:y.j,InternalServerError:y.j,InvalidRequest:y.j,RateLimited:y.j,ServiceUnavailable:y.j}))),(0,g.lk)((e=>(0,S.Vp)(e.data.authTicket)))))}async askServerToSendToken(e){return await(0,p.z)(this.serverApiClient.v1.authentication.requestEmailTokenVerification({login:e}).pipe((0,g.DZ)((e=>{throw e})),(0,g.lk)((()=>(0,S.Vp)(void 0)))))}constructor(e){this.serverApiClient=e}}P=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.l?Object:h.l])],P);var U=s(13800);class N extends U.f{}N=(0,i.gn)([(0,d.GS)()],N);class L{mapFunctionalErrorToErrorCode(e){switch(e.tag){case E.VERIFICATION_FAILED:return D.DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED;case E.VERIFICATION_TIMEOUT:return D.TOKEN_EXPIRED;default:return F.UNKNOWN_ERROR}}async execute({login:e}){if(!e)throw new Error("Something went wrong");const t=await this.identityVerificationService.performDashlaneAuthenticatorValidation(e,"");if((0,S.hx)(t)){const e=this.mapFunctionalErrorToErrorCode(t.error);return Promise.reject(e)}return this.eventEmitter.sendEvent("identityVerificationCompleted",{authTicket:t.data}),Promise.resolve()}constructor(e,t){this.identityVerificationService=e,this.eventEmitter=t}}L=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===P?Object:P,void 0===N?Object:N])],L);class x{async execute({login:e}){if(e){const t=await this.identityVerificationService.askServerToSendToken(e);if((0,S.hx)(t))return Promise.reject(t.error)}Promise.resolve(void 0)}constructor(e){this.identityVerificationService=e,this.identityVerificationService=e}}x=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===P?Object:P])],x);class G{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"AuthenticatorMachine",context:{isDashlaneAuthenticatorAvailable:!1},initial:"RequestingServerPush",states:{RequestingServerPush:{entry:["updateDashlaneAuthenticatorAvailability"],invoke:{src:"authenticateWithDashlaneAuthenticator",onDone:{target:"AuthenticatorPushValidated"},onError:{actions:["assignError","updateDashlaneAuthenticatorAvailability"]}},on:{RESEND_PUSH_NOTIFICATION:{target:"RequestingServerPush",actions:["clearError"]},SWITCH_TO_EMAIL_TOKEN:{actions:["clearError"],target:"EmailTokenRequested"}}},AuthenticatorPushValidated:{type:"final",data:{switchToEmailToken:!1}},EmailTokenRequested:{entry:["sendEmailToken"],type:"final",data:{switchToEmailToken:!0}}}},options:{actions:{clearError:(0,l.f0)({error:()=>{}}),assignError:(0,l.f0)({error:(e,t)=>t.data}),switchToEmailToken:(0,l.f0)({switchToEmailToken:()=>!0}),updateDashlaneAuthenticatorAvailability:(0,l.f0)({isDashlaneAuthenticatorAvailable:!0}),sendEmailToken:e=>{const{login:t}=e;this.sendEmailToken.execute({login:t})}},services:{authenticateWithDashlaneAuthenticator:e=>{const{login:t}=e;return this.dashlaneAuthenticatorService.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,u.C)(e,t)}constructor(e,t){this.dashlaneAuthenticatorService=e,this.sendEmailToken=t}}G=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===L?Object:L,void 0===x?Object:x])],G);const k=/^\d{6}$/;class K{mapFunctionalErrorToErrorCode(e){switch(e.tag){case E.VERIFICATION_FAILED:return T.TOKEN_NOT_VALID;case E.VERIFICATION_TIMEOUT:return T.TOKEN_EXPIRED;case E.VERIFICATION_REQUIRES_REQUEST:return T.TOKEN_TOO_MANY_ATTEMPTS;case E.ACCOUNT_BLOCKED_CONTACT_SUPPORT:return T.TOKEN_ACCOUNT_LOCKED;default:return F.UNKNOWN_ERROR}}async executeWithParams(e){if(!e.login||!e.emailToken||0===e.emailToken.length||!k.test(e.emailToken))return Promise.reject(F.UNKNOWN_ERROR);const t=await this.identityVerificationService.performEmailTokenVerification(e.login,e.emailToken);if((0,S.hx)(t)){const e=this.mapFunctionalErrorToErrorCode(t.error);return Promise.reject(e)}const s=t.data;return this.eventEmitter.sendEvent("identityVerificationCompleted",{authTicket:s}),Promise.resolve()}constructor(e,t){this.identityVerificationService=e,this.eventEmitter=t}}K=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===P?Object:P,void 0===N?Object:N])],K);class M{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"EmailTokenMachine",context:{login:"",emailToken:"",deviceName:""},initial:"SendEmailToken",states:{SendEmailToken:{invoke:{src:"sendEmailToken",onError:{target:"WaitingForEmailToken"},onDone:{target:"WaitingForEmailToken"}}},WaitingForEmailToken:{on:{INPUT_EMAIL_TOKEN:{target:"ValidatingEmailToken",actions:["assignEmailToken"]},RESEND_EMAIL_TOKEN:{target:"SendEmailToken",actions:["clearError"]}}},ValidatingEmailToken:{invoke:{src:"authenticateWithEmailToken",onDone:{target:"FinishingEmailToken"},onError:{target:"WaitingForEmailToken",actions:["assignError"]}}},FinishingEmailToken:{type:"final",data:{switchToDashlaneAuthenticator:!1}},DashlaneAuthenticatorRequested:{type:"final",data:{switchToDashlaneAuthenticator:!0}}},on:{SWITCH_TO_DASHLANE_AUTHENTICATOR:{target:".DashlaneAuthenticatorRequested",internal:!0,actions:["clearError"]}}},options:{actions:{assignError:(0,l.f0)({error:(e,t)=>t.data}),clearError:(0,l.f0)({error:()=>{}}),assignEmailToken:(0,l.f0)({emailToken:(e,t)=>t.emailToken})},services:{sendEmailToken:e=>{const{login:t}=e;return this.sendEmailToken.execute({login:t})},authenticateWithEmailToken:e=>{const{deviceName:t,emailToken:s,login:i}=e;return this.authenticateWithEmailToken.executeWithParams({deviceName:t,emailToken:s,login:i})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,u.C)(e,t)}constructor(e,t){this.authenticateWithEmailToken=e,this.sendEmailToken=t}}M=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===K?Object:K,void 0===x?Object:x])],M);const j=e=>({initial:e.initial,states:e.states,on:e.on??{}});class V{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{},guards:{}},id:"DeviceRegistrationMachine",context:{...this.authenticatorMachine.desc().config.context,...this.emailTokenMachine.desc().config.context,registrationMethod:void 0},initial:"StartDeviceRegistration",states:{StartDeviceRegistration:{always:[{target:"EmailToken",cond:"isRegistrationMethodEmailToken"},{target:"DashlaneAuthenticator",cond:"isRegistrationMethodAuthenticator"},{target:"TwoFactorAuthentication",cond:"isRegistrationMethodOTP"}]},DashlaneAuthenticator:{...j(this.authenticatorMachine.desc().config),onDone:[{target:"EmailToken",cond:"shouldSwitchToEmailToken"},{target:"DeviceRegistrationDone"}]},EmailToken:{...j(this.emailTokenMachine.desc().config),onDone:[{target:"DashlaneAuthenticator",cond:"shouldSwitchToAuthenticator"},{target:"DeviceRegistrationDone"}]},TwoFactorAuthentication:{onDone:{target:"DeviceRegistrationDone"}},DeviceRegistrationDone:{type:"final"}}},options:{actions:{...this.authenticatorMachine.desc().options.actions,...this.emailTokenMachine.desc().options.actions,assignUnknownDeviceRegistrationError:(0,l.f0)({error:()=>({code:"unknown_error",data:{message:"Unknown device registration error"}})})},services:{...this.authenticatorMachine.desc().options.services,...this.emailTokenMachine.desc().options.services},guards:{...this.authenticatorMachine.desc().options.guards,...this.emailTokenMachine.desc().options.guards,isRegistrationMethodEmailToken:e=>"email_token"===e.registrationMethod,isRegistrationMethodOTP:e=>"otp"===e.registrationMethod,isRegistrationMethodAuthenticator:e=>"dashlane_authenticator"===e.registrationMethod,shouldSwitchToEmailToken:(e,t)=>t.data.switchToEmailToken,shouldSwitchToAuthenticator:(e,t)=>t.data.switchToDashlaneAuthenticator}}}}create(){const{config:e,options:t}=this.desc();return(0,u.C)(e,t)}constructor(e,t){this.authenticatorMachine=e,this.emailTokenMachine=t}}V=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===G?Object:G,void 0===M?Object:M])],V);var W=s(62149),B=s(63144);const z=e=>!0;class q extends((0,B.Q)({initialValue:void 0,persist:!1,scope:W.F.Device,storeName:"device-registration-flow-store",storeTypeGuard:z})){}class H{mapFunctionalErrorToErrorCode(e){switch(e.tag){case E.VERIFICATION_FAILED:return _.OTP_NOT_VALID;case E.INVALID_OTP_ALREADY_USED:return _.OTP_ALREADY_USED;case E.INVALID_OTP_BLOCKED:return _.OTP_TOO_MANY_ATTEMPTS;default:return F.UNKNOWN_ERROR}}async executeWithParams(e){if(!e.login||!e.otp||0===e.otp.length||"totp"===e.twoFactorAuthenticationOtpType&&!k.test(e.otp))return Promise.reject(F.UNKNOWN_ERROR);const t=await this.identityVerificationService.performTotpVerification(e.login,e.otp);if((0,S.hx)(t)){const e=this.mapFunctionalErrorToErrorCode(t.error);return Promise.reject(e)}return this.eventEmitter.sendEvent("identityVerificationCompleted",{authTicket:t.data}),Promise.resolve()}constructor(e,t){this.identityVerificationService=e,this.eventEmitter=t}}H=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===P?Object:P,void 0===N?Object:N])],H);class Y{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"TwoFactorAuthenticationMachine",context:{twoFactorAuthenticationOtpType:"totp"},initial:"WaitingForTotp",states:{WaitingForTotp:{on:{INPUT_TOTP:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForBackupCode",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},WaitingForBackupCode:{on:{INPUT_BACKUP_CODE:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForTotp",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},ValidatingTwoFactorAuthenticationOtp:{invoke:{src:"authenticateWithTwoFactorAuthentication",onDone:{target:"TwoFactorAuthenticationDone"},onError:[{target:"WaitingForBackupCode",cond:"isBackupCode",actions:["assignError"]},{target:"WaitingForTotp",actions:["assignError"]}]}},TwoFactorAuthenticationDone:{type:"final"}}},options:{actions:{assignError:(0,l.f0)({error:(e,t)=>t.data}),clearError:(0,l.f0)({error:()=>{}}),assignTwoFactorAuthenticationOtpValue:(0,l.f0)({twoFactorAuthenticationOtpValue:(e,t)=>t.twoFactorAuthenticationOtpValue}),assignTwoFactorAuthenticationOtpType:(0,l.f0)({twoFactorAuthenticationOtpType:(e,t)=>t.twoFactorAuthenticationOtpType})},services:{authenticateWithTwoFactorAuthentication:e=>{const t={login:e.login??"",masterPassword:e.masterPassword??null,otp:e.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.twoFactorAuthenticationOtpType,persistData:!0,otpVerificationMode:e.otpVerificationMode,deviceName:e.deviceName};return this.twoFactorAuthenticationService.executeWithParams(t)}},guards:{isBackupCode:e=>"backupCode"===e.twoFactorAuthenticationOtpType}}}}create(){const{config:e,options:t}=this.desc();return(0,u.C)(e,t)}constructor(e){this.twoFactorAuthenticationService=e}}Y=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===H?Object:H])],Y);class Q{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"IdentityVerificationFlowMachine",context:{...this.deviceRegistrationMachine.desc().config.context,...this.twoFactorAuthenticationMachine.desc().config.context,ready:!1,shouldAskOTP:!1},states:{Starting:{entry:["assignInitializationResults"]},DeviceRegistration:{...j(this.deviceRegistrationMachine.desc().config)},TwoFactorAuthentication:{...j(this.twoFactorAuthenticationMachine.desc().config),onDone:{target:"AuthenticationDone"}},AuthenticationDone:{type:"final"}},on:{VERIFY_IDENTITY_WITH_TOKEN:{target:"DeviceRegistration.EmailToken",actions:["assignAccountEmail"]},VERIFY_IDENTITY_WITH_DASHLANE_AUTHENTICATOR:{target:"DeviceRegistration.DashlaneAuthenticator",actions:["assignAccountEmail"]},VERIFY_IDENTITY_WITH_TOTP:{target:"TwoFactorAuthentication",actions:["assignAccountEmail"]},CANCEL_IDENTITY_VERIFICATION:{target:"Starting",actions:["clearContext"]},CLEAR_ERROR:{actions:["clearError"]}}},options:{actions:{...this.deviceRegistrationMachine.desc().options.actions,...this.twoFactorAuthenticationMachine.desc().options.actions,assignInitializationResults:(0,l.f0)({ready:()=>!0}),assignAccountEmail:(0,l.f0)({login:(e,t)=>t.login}),clearContext:(0,l.f0)({login:()=>"",shouldAskOTP:()=>!1,twoFactorAuthenticationOtpType:()=>"totp",registrationMethod:()=>{},emailToken:()=>"",deviceName:()=>"",isDashlaneAuthenticatorAvailable:()=>!1}),clearError:(0,l.f0)({error:()=>{}})},services:{...this.deviceRegistrationMachine.desc().options.services,...this.twoFactorAuthenticationMachine.desc().options.services},guards:{...this.deviceRegistrationMachine.desc().options.guards,...this.twoFactorAuthenticationMachine.desc().options.guards,isGrapheneDeviceRegistrationFlow:e=>!!e.login&&e.login.includes("kw_test_newdevice")}}}}create(){const{config:e,options:t}=this.desc();return(0,u.C)(e,t)}constructor(e,t){this.deviceRegistrationMachine=e,this.twoFactorAuthenticationMachine=t}}Q=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===V?Object:V,void 0===Y?Object:Y])],Q);var $=s(1140),X=s(24966),Z=s(39177),J=s(14160),ee=s(86051),te=s(87065);const se=e=>!0;class ie extends((0,B.Q)({initialValue:void 0,persist:!1,scope:W.F.Device,storeName:"identity-verification-flow-machine",storeTypeGuard:se})){}class re{async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?ee.ZM.create(JSON.parse(t)):void 0})(this.identityVerificationMachineStore);let t;try{t=this.interpreter.start(e)}catch(e){this.logger.error("Auth Ticket - Unable to reuse the stored state",{location:"IdentityVerificationFlow",method:"prepare()",error:e}),t=this.interpreter.start()}await(0,Z.X)(t,(e=>e.context.ready)),this.interpreter.send(this.delayedEvents),this.delayedEvents=[],this.initFlag.next(!0)}catch(e){this.logger.error("Auth Ticket - Unable to start machine",{location:"IdentityVerificationFlow",method:"prepare()",error:e})}}ready(){return this.initFlag}continue(e){if(!this.interpreter)throw new Error("Authentication flow not started");this.interpreter.getSnapshot().context.ready?this.interpreter.send(e):this.delayedEvents.push(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}constructor(e,t,s){this.identityVerificationMachineStore=t,this.initFlag=new X.X(!1),this.logger=s;const i=e.create();this.delayedEvents=[],this.interpreter=(0,J.kJ)(i).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||this.logger.warn(`Auth Ticket - State is unchanged. Unexpected transition with event ${e.event.type}`,{location:"IdentityVerificationFlow",method:"onTransition()",event:e});try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.identityVerificationMachineStore,e)}catch(e){this.logger.error("Auth Ticket - Unable to get snapshot",{location:"IdentityVerificationFlow",method:"onTransition()",error:e})}}))}}re=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Q?Object:Q,void 0===ie?Object:ie,void 0===$.SX?Object:$.SX])],re);var ne=s(82874),oe=s(13284);class ae{execute(e){const{twoFactorAuthenticationOtpType:t}=e.body;return this.identityVerificationFlow.continue({type:"SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE",twoFactorAuthenticationOtpType:t}),Promise.resolve((0,S.Vp)(void 0))}constructor(e){this.identityVerificationFlow=e}}ae=(0,i.gn)([(0,ne.W)(oe.eG),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===re?Object:re])],ae);class ce{execute(){return this.identityVerificationFlow.continue({type:"CLEAR_ERROR"}),Promise.resolve((0,S.Vp)(void 0))}constructor(e){this.identityVerificationFlow=e}}ce=(0,i.gn)([(0,ne.W)(oe.$5),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===re?Object:re])],ce);class de{execute(){return this.identityVerificationFlow.continue({type:"RESEND_EMAIL_TOKEN"}),Promise.resolve((0,S.Vp)(void 0))}constructor(e){this.identityVerificationFlow=e}}de=(0,i.gn)([(0,ne.W)(oe.Gc),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===re?Object:re])],de);class le{execute(){return this.identityVerificationFlow.continue({type:"RESEND_PUSH_NOTIFICATION"}),Promise.resolve((0,S.Vp)(void 0))}constructor(e){this.identityVerificationFlow=e}}le=(0,i.gn)([(0,ne.W)(oe.rF),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===re?Object:re])],le);class ue{execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.identityVerificationFlow.continue({type:"INPUT_BACKUP_CODE",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,S.Vp)(void 0))}constructor(e){this.identityVerificationFlow=e}}ue=(0,i.gn)([(0,ne.W)(oe.sH),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===re?Object:re])],ue);class pe{execute(e){const{emailToken:t,deviceName:s}=e.body;return this.identityVerificationFlow.continue({type:"INPUT_EMAIL_TOKEN",emailToken:t,deviceName:s}),Promise.resolve((0,S.Vp)(void 0))}constructor(e){this.identityVerificationFlow=e}}pe=(0,i.gn)([(0,ne.W)(oe.XH),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===re?Object:re])],pe);class he{execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.identityVerificationFlow.continue({type:"INPUT_TOTP",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,S.Vp)(void 0))}constructor(e){this.identityVerificationFlow=e}}he=(0,i.gn)([(0,ne.W)(oe.ad),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===re?Object:re])],he);class ge{execute(){return this.identityVerificationFlow.continue({type:"SWITCH_TO_DASHLANE_AUTHENTICATOR"}),Promise.resolve((0,S.Vp)(void 0))}constructor(e){this.identityVerificationFlow=e}}ge=(0,i.gn)([(0,ne.W)(oe.K1),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===re?Object:re])],ge);class me{execute(){return this.identityVerificationFlow.continue({type:"SWITCH_TO_EMAIL_TOKEN"}),Promise.resolve((0,S.Vp)(void 0))}constructor(e){this.identityVerificationFlow=e}}me=(0,i.gn)([(0,ne.W)(oe.v5),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===re?Object:re])],me);class ve{execute(e){const{login:t,verificationMethod:s}=e.body;switch(s){case"email_token":this.identityVerificationFlow.continue({type:"VERIFY_IDENTITY_WITH_TOKEN",login:t});break;case"totp":this.identityVerificationFlow.continue({type:"VERIFY_IDENTITY_WITH_TOTP",login:t});break;case"dashlane_authenticator":this.identityVerificationFlow.continue({type:"VERIFY_IDENTITY_WITH_DASHLANE_AUTHENTICATOR",login:t})}return Promise.resolve((0,S.Vp)(void 0))}constructor(e){this.identityVerificationFlow=e}}ve=(0,i.gn)([(0,ne.W)(oe.qw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===re?Object:re])],ve);class ye{execute(){return this.identityVerificationFlow.continue({type:"CANCEL_IDENTITY_VERIFICATION"}),Promise.resolve((0,S.Vp)(void 0))}constructor(e){this.identityVerificationFlow=e}}ye=(0,i.gn)([(0,ne.W)(oe.Vs),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===re?Object:re])],ye);var Se=s(85390),we=s(37182),Ee=s(41842),Ie=s(6136),Ae=s(46449),fe=s(306),be=s(69885),Ce=s(6220);const Oe=e=>({step:"EmailTokenStep",isLoading:e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})&&!e.context.error,error:e.context.error,emailToken:e.context.emailToken,isDashlaneAuthenticatorAvailable:e.context.isDashlaneAuthenticatorAvailable}),Re=e=>({step:"DashlaneAuthenticatorStep",isLoading:e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})&&!e.context.error,error:e.context.error}),Te=e=>({step:"TwoFactorAuthenticationOtpStep",isLoading:e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})&&!e.context.error,error:e.context.error,twoFactorAuthenticationOtpValue:e.context.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.context.twoFactorAuthenticationOtpType});const _e=e=>(0,be.of)((0,S.Vp)(function(e){if(e.matches("Starting"))return{step:"StartingStep"};if(e.matches({DeviceRegistration:{EmailToken:"SendEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"WaitingForEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"FinishingEmailToken"}}))return Oe(e);if(e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushFailed"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushValidated"}}))return Re(e);if(e.matches({TwoFactorAuthentication:"WaitingForTotp"})||e.matches({TwoFactorAuthentication:"WaitingForBackupCode"})||e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})||e.matches({TwoFactorAuthentication:"FinishingTwoFactorAuthenticationOtp"}))return Te(e);throw new Error(`[Auth Ticket] - No view associated to state ${JSON.stringify(e.value)}`)}(e))),De=e=>e.pipe((0,Ce.z)(_e));var Fe=s(54389);class Pe{execute(){return(0,Se.a)([(e=this.identityVerificationMachineStore,e.state$.pipe((0,te.U)((e=>e?ee.ZM.create(JSON.parse(e)):void 0)))),this.identityVerificationFlow.ready()],((e,t)=>{if(e&&t)return e})).pipe((0,Ee.h)(Boolean),(0,Ie.x)(((e,t)=>((e,t)=>{const s=t.matches(e.value),i=(0,Fe.Z)(e.context,t.context);return s&&i})(e,t))),De,(0,we.K)(((e,t)=>(this.logger.error("Error retrieving identity verification view data",{location:"IdentityVerificationFlowQueryStatusHandler",method:"execute()",error:e}),t))));var e}constructor(e,t,s){this.identityVerificationFlow=e,this.identityVerificationMachineStore=t,this.logger=s}}Pe=(0,i.gn)([(0,Ae.e)(fe.O),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===re?Object:re,void 0===ie?Object:ie,void 0===$.SX?Object:$.SX])],Pe);class Ue{}Ue=(0,i.gn)([(0,r.Y)({api:c.i,handlers:{commands:{changeTwoFactorAuthenticationOtpType:ae,clearError:ce,resendEmailToken:de,resendPushNotification:le,submitBackupCode:ue,submitEmailToken:pe,submitTotp:he,switchToDashlaneAuthenticator:ge,switchToEmailToken:me,startIdentityVerification:ve,cancelIdentityVerification:ye},events:{},queries:{identityVerificationFlowStatus:Pe}},providers:[V,G,L,M,Y,...(0,n.H)(re,{inject:[Q,ie,$.SX],asyncFactory:async(e,t,s)=>{const i=new re(e,t,s);return await i.prepare(),i}}),Q,K,H,x,P,N,(0,o.ND)($.SX)],imports:[a.n],exports:[re],stores:[ie,q]})],Ue)},20412:(e,t,s)=>{s.d(t,{N:()=>de});var i=s(92336),r=s(86006),n=s(26430),o=s(40416),a=s(41511),c=s(44115),d=s(46449),l=s(76266),u=s(14122),p=s(92587),h=s(50423),g=s(36041),m=s(81929),v=s(53344),y=s(19911),S=s(63352),w=s(15340),E=s(78346),I=s(52477),A=s(17591),f=s(56742),b=s(63696),C=s(87065),O=s(89618),R=s(25313),T=s(41842),_=s(85390),D=s(60399);let F=null;async function P(){if(!F){const{client:e}=await async function(){const{client:e,ready:t}=await Promise.all([s.e(198),s.e(932),s.e(87),s.e(606),s.e(721),s.e(546)]).then(s.bind(s,6504));return await t,{client:e}}();F=e}return F}var U=s(62149),N=s(63144),L=s(56618),x=s(7165),G=s(60018);const k=x.z.object({localAccounts:x.z.record(x.z.string(),x.z.object({salt:x.z.string(),encryptedSessionKey:x.z.string(),serverSessionKey:x.z.string(),attemptsLeft:x.z.number()}))}),K=e=>k.safeParse(e).success;class M extends((0,N.Q)({persist:!0,storage:{initialValue:{localAccounts:{}},schemaVersion:1,typeGuard:K,migrateStorageSchema:()=>({localAccounts:{}})},codec:G.E,scope:U.F.Device,storeName:"pincode",capacity:L.Y._001KB})){}var j=s(82059),V=s(85603),W=s(28868),B=s(93704);class z{async encryptSessionKeyWithPinKey(e,t){return await this.flexibleEncryptor.encrypt(t,e,W.oo,B.gO)}async decryptSessionKeyWithPinKey(e,t){return await this.flexibleDecryptor.decrypt(t,e)}constructor(e,t){this.flexibleEncryptor=e,this.flexibleDecryptor=t}}z=(0,i.gn)([(0,p.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===j._?Object:j._,void 0===V.a?Object:V.a])],z);var q=s(7531),H=s(23337);class Y extends q.K{loadResource(e){if(!((t=e)&&"object"==typeof t&&"serverIdentifier"in t&&"serverPublicKey"in t))throw new Error("File corrupted");var t;return e}constructor(e,t){super(`/assets/pin-code.${"https://api.dashlane.com"===t.baseUrl?"prod":"staging"}.config.json`,e)}}Y=(0,i.gn)([(0,p.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===H.X?Object:H.X,void 0===v.l?Object:v.l])],Y);class Q{getPinCodeStatus(e){return this.pinCodeStore.state$.pipe((0,C.U)((t=>{const s=e in t.localAccounts;return(0,E.Vp)(s?{isPinCodeEnabled:!0,attemptsLeft:t.localAccounts[e].attemptsLeft}:{isPinCodeEnabled:!1})})))}getCurrentUserPinCodeStatus(){const e=this.session.queries.selectedOpenedSession().pipe((0,O.V)({first:5e3,with:()=>(0,R._)((()=>new Error("No current active user")))}),(0,C.U)((e=>(0,E.d6)(e)&&e.data?e.data:"")),(0,T.h)((e=>!!e)));return(0,_.a)([e,this.pinCodeStore.state$]).pipe((0,C.U)((([e,t])=>{const s=e in t.localAccounts;return(0,E.Vp)(s?{isPinCodeEnabled:!0,attemptsLeft:t.localAccounts[e].attemptsLeft}:{isPinCodeEnabled:!1})})))}async activatePinCode(e){const t=await this.getCurrentUserEmail(),s=await(0,D.z)(this.carbonClient.queries.carbonState({path:"state.authentication.currentUser.rememberMeType"}));(0,E.d6)(s)&&"autologin"===s.data&&await this.carbonClient.commands.disableAutologin();const i=await this.pinCodeStore.getState(),r=await this.getExportedSessionKey(),n=(0,y.s)(await this.keyGenerator.generate()),o=await P(),a=(0,y.s)(await this.hmacSigner.sign((0,S.R)(n),(new TextEncoder).encode(e))),{clientRegistrationState:c,registrationRequest:d}=o.startRegistration({password:a}),l=await(0,D.z)(this.serverApi.v1.authentication.pincodeRequestActivation({activationRequest:d})),u=(0,I.EQ)(l,{success:e=>e.data.data.activationResponse,failure:e=>(0,I.EQ)(e.error,{BusinessError:e=>{switch(e.code){case"FAILED_TO_PROCESS_ACTIVATION_REQUEST":case"SSO_USER_NOT_ALLOWED":return(0,A.j)(e.code);default:(0,f.U)(e)}},FetchFailedError:A.j,InternalServerError:A.j,InvalidRequest:A.j,RateLimited:A.j,ServiceUnavailable:A.j,UnspecifiedBadStatus:A.j})}),p=await this.pinCodeServerConfigResourceLoader.get(),{registrationRecord:h,exportKey:g,serverStaticPublicKey:m}=o.finishRegistration({clientRegistrationState:c,registrationResponse:u,password:a,identifiers:{client:t,server:p.serverIdentifier}});if(m!==p.serverPublicKey)throw new Error("OPAQUEs serverStaticPublicKey does not match api configs.");const v=await(0,D.z)(this.serverApi.v1.authentication.pincodeCompleteActivation({pinCodeRecord:h})),b=(0,I.EQ)(v,{success:e=>e.data.data.sessionKey,failure:e=>(0,I.EQ)(e.error,{BusinessError:e=>{switch(e.code){case"ACTIVATION_REQUEST_NOT_FOUND":case"EMPTY_PIN_CODE_RECORD":return(0,A.j)(e.code);default:(0,f.U)(e)}},FetchFailedError:A.j,InternalServerError:A.j,InvalidRequest:A.j,RateLimited:A.j,ServiceUnavailable:A.j,UnspecifiedBadStatus:A.j})}),C=(0,w.N)(g),O=await this.sessionKeyCrypto.encryptSessionKeyWithPinKey(r,C);await this.pinCodeStore.set({...i,localAccounts:{...i.localAccounts,[t]:{...i.localAccounts[t],serverSessionKey:b,salt:n,encryptedSessionKey:(0,y.s)(O),attemptsLeft:3}}})}async removePinCodeFromStore(e){const t=await this.pinCodeStore.getState();delete t.localAccounts[e],await this.pinCodeStore.set(t)}async deactivatePinCode(){const e=await this.getCurrentUserEmail();e in(await this.pinCodeStore.getState()).localAccounts&&(await this.removePinCodeFromStore(e),await this.allowToFail.doOne((async()=>await(0,D.z)(this.serverApi.v1.authentication.pincodeDisable({}))),{methodName:"Deactivate pin code"}))}async computePinKey(e,t){const s=await this.pinCodeStore.getState();if(!(t in s.localAccounts))return(0,E.Rn)((0,l.Zs)());const{serverSessionKey:i,salt:r}=s.localAccounts[t],n=(0,y.s)(await this.hmacSigner.sign((0,S.R)(r),(new TextEncoder).encode(e))),o=await P(),{clientLoginState:a,startLoginRequest:c}=o.startLogin({password:n}),d=await(0,D.z)(this.serverApi.v1.authentication.pincodeRequestLogin({loginRequest:c,sessionKey:i})),u=(0,I.EQ)(d,{success:e=>(0,E.Vp)(e.data.data),failure:e=>(0,I.EQ)(e.error,{BusinessError:e=>{switch(e.code){case"INVALID_SESSION_KEY":case"NO_PIN_CODE_ACTIVATED":case"FAILED_TO_PROCESS_LOGIN_REQUEST":case"MAX_ATTEMPTS_REACHED":return(0,E.Rn)((0,l.Zs)());default:(0,f.U)(e)}},FetchFailedError:A.j,InternalServerError:A.j,InvalidRequest:A.j,RateLimited:A.j,ServiceUnavailable:A.j,UnspecifiedBadStatus:A.j})});if(!(0,E.d6)(u))return await this.removePinCodeFromStore(t),u;const{loginResponse:p,attemptsLeft:h}=u.data,g=await this.pinCodeStore.getState();await this.pinCodeStore.set({...g,localAccounts:{...g.localAccounts,[t]:{...g.localAccounts[t],attemptsLeft:h}}});const m=await this.pinCodeServerConfigResourceLoader.get(),v=o.finishLogin({clientLoginState:a,loginResponse:p,password:n,identifiers:{client:t,server:m.serverIdentifier}});if(!v)return 0===h&&await this.removePinCodeFromStore(t),(0,E.Rn)((0,l.g5)());if(v.serverStaticPublicKey!==m.serverPublicKey)throw new Error("OPAQUEs serverStaticPublicKey does not match api configs.");const{exportKey:b,finishLoginRequest:C}=v;return await this.allowToFail.doOne((async()=>await(0,D.z)(this.serverApi.v1.authentication.pincodeCompleteLogin({sessionKey:i,completeLoginRequest:C}))),{methodName:"Complete login with pin code"}),(0,E.Vp)((0,w.N)(b))}async loginWithPinCode(e,t){const s=await this.pinCodeStore.getState();if(!(e in s.localAccounts))return(0,E.Rn)((0,l.Zs)());const{encryptedSessionKey:i}=s.localAccounts[e],r=await this.computePinKey(t,e);if(!(0,E.d6)(r))return r;const n=r.data,o=await this.sessionKeyCrypto.decryptSessionKeyWithPinKey((0,S.R)(i),n),a=await this.session.commands.openUserSession({email:e,rememberPassword:!1,sessionKey:{type:"exported",content:(0,y.s)(o)}});if(!(0,E.d6)(a))throw new Error("Failed to open the session");return(0,E.Vp)(void 0)}async validatePinCode(e,t){return(0,I.EQ)(await this.computePinKey(e,t),{success:()=>(0,E.Vp)({isPinCodeCorrect:!0}),failure:e=>(0,I.EQ)(e.error,{NO_ACTIVE_PIN_CODE:A.j,WRONG_PIN_CODE:async()=>{const e=await(0,D.z)(this.getCurrentUserPinCodeStatus());return(0,E.ho)(e).isPinCodeEnabled||await this.session.commands.closeUserSession({email:t}),(0,E.Vp)({isPinCodeCorrect:!1})}})})}async getCurrentUserEmail(){const e=await(0,D.z)(this.session.queries.selectedOpenedSession());if(!(0,E.d6)(e)||!e.data)throw new Error("No current session was found");return e.data}async getExportedSessionKey(){const e=await(0,D.z)(this.session.queries.exportSessionKey());if(!(0,E.d6)(e))throw new Error("Failed to export session key");return(0,S.R)(e.data.content)}constructor(e,t,s,i,r,n,o,a,c){this.pinCodeStore=e,this.session=t,this.keyGenerator=s,this.hmacSigner=i,this.sessionKeyCrypto=r,this.serverApi=n,this.allowToFail=o,this.carbonClient=a,this.pinCodeServerConfigResourceLoader=c}}Q=(0,i.gn)([(0,p.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===M?Object:M,void 0===b.x?Object:b.x,void 0===g.c?Object:g.c,void 0===m.q?Object:m.q,void 0===z?Object:z,void 0===v.l?Object:v.l,void 0===h.J?Object:h.J,void 0===u._?Object:u._,void 0===Y?Object:Y])],Q);class ${execute(e){return this.pinCodeService.getPinCodeStatus(e.body.loginEmail)}constructor(e){this.pinCodeService=e}}$=(0,i.gn)([(0,d.e)(c.D),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Q?Object:Q])],$);var X=s(21253),Z=s(82874);class J{async execute({body:e}){return await this.pinCodeService.activatePinCode(e.pinCode),(0,E.Vp)(void 0)}constructor(e){this.pinCodeService=e}}J=(0,i.gn)([(0,Z.W)(X.r),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Q?Object:Q])],J);var ee=s(63375);class te{async execute(){return await this.pinCodeService.deactivatePinCode(),(0,E.Vp)(void 0)}constructor(e){this.pinCodeService=e}}te=(0,i.gn)([(0,Z.W)(ee.E),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Q?Object:Q])],te);var se=s(33984);class ie{async execute({body:e}){return await this.pinCodeService.loginWithPinCode(e.email,e.pinCode)}constructor(e){this.pinCodeService=e}}ie=(0,i.gn)([(0,Z.W)(se.c),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Q?Object:Q])],ie);var re=s(10908),ne=s(43978);class oe{execute(e){return this.session.queries.selectedOpenedSession().pipe((0,ne.w)((async t=>{if(!(0,E.d6)(t)||!t.data)throw new Error("No user logged in");return await this.pinCodeService.validatePinCode(e.body.pinCode,t.data)})))}constructor(e,t){this.pinCodeService=e,this.session=t}}oe=(0,i.gn)([(0,d.e)(re.M),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Q?Object:Q,void 0===b.x?Object:b.x])],oe);var ae=s(1047);class ce{execute(){return this.pinCodeService.getCurrentUserPinCodeStatus()}constructor(e){this.pinCodeService=e}}ce=(0,i.gn)([(0,d.e)(ae.o),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Q?Object:Q])],ce);class de{}de=(0,i.gn)([(0,r.Y)({api:n.n,stores:[M],imports:[o.D,a.n],handlers:{commands:{activate:J,deactivate:te,loginWithPinCode:ie},events:{},queries:{isPinCodeCorrect:oe,getStatus:$,getCurrentUserStatus:ce}},providers:[Q,z,Y]})],de)},213:(e,t,s)=>{s.d(t,{Z:()=>L});var i=s(92336),r=s(8504),n=s(86006),o=s(41511),a=s(19197),c=s(82874),d=s(66610),l=s(78346),u=s(63696),p=s(60399),h=s(14122),g=s(92587),m=s(87065);class v{getSessionCredentialsForUser(e){const{queries:{carbonStateList:t}}=this.carbon;return(0,p.z)(t({paths:["authentication.currentUser.deviceKeys","userSession.localSettings.uki","userSession.account.login","userSession.session.sessionKeys"]}).pipe((0,m.U)((e=>{if((0,l.hx)(e))throw new Error("Failed to get credentials from carbon");return(0,l.db)(e)})),(0,m.U)(this.carbonStateToRequestUserSessionCredentials(e))))}carbonStateToRequestUserSessionCredentials(e){return([t,s,i,r])=>{if(!t&&!s||i!==e)throw new Error("No user device credentials available for active user");if(!r)throw new Error("No session credentials available for active user");let n;if(s){if("string"!=typeof s)throw new Error("Unexpected UKI state shape received from carbon");n=function(e){const t=e.split("-");if(t.length>0){const[s]=t;return{accessKey:s,secretKey:e}}throw new Error("Invalid UKI format")}(s)}else{if(!function(e){return!!(e&&"object"==typeof e&&"accessKey"in e&&"secretKey"in e)&&"string"==typeof e.accessKey&&"string"==typeof e.secretKey}(t))throw new Error("Unexpected user device state shape received from carbon");n=t}if(!function(e){return!!(e&&"object"==typeof e&&"accessKey"in e&&"secretKey"in e&&"expirationTimeSeconds"in e)&&"string"==typeof e.accessKey&&"string"==typeof e.secretKey&&"number"==typeof e.expirationTimeSeconds}(r))throw new Error("Unexpected session keys state shape received from carbon");return{login:e,deviceAccessKey:n.accessKey,sessionAccessKey:r.accessKey,sessionSecretKey:r.secretKey}}}constructor(e){this.carbon=e}}v=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h._?Object:h._])],v);class y{async execute(e){const t=await(0,p.z)(this.sessionClient.queries.selectedOpenedSession()),s=(0,l.d6)(t)?(0,l.db)(t):e.body.login;if(void 0===s)throw new Error("Logged out and no login specified");const{id:i,type:r,rawId:n,response:o}=e.body.assertion,a=await(0,p.z)(this.contextLessServerApiClient.v1.authentication.completeRememberMeOpenSession(await this.rememberMeSessionKeysRepository.getSessionCredentialsForUser(s),{authenticator:{authenticationType:"webauthn.get",credential:{type:r,id:i,rawId:n,response:o}}}));if((0,l.hx)(a))throw new Error(`Assertion could not be validated: ${a.error.name}`);return(0,l.Vp)(void 0)}constructor(e,t,s){this.contextLessServerApiClient=e,this.rememberMeSessionKeysRepository=t,this.sessionClient=s}}y=(0,i.gn)([(0,c.W)(a.L),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===d.B?Object:d.B,void 0===v?Object:v,void 0===u.x?Object:u.x])],y);var S=s(61798),w=s(53344),E=s(52477),I=s(25937),A=s(17591),f=s(34224);function b(e){return()=>(0,l.Rn)({tag:e})}class C{async execute({body:{email:e}}){const t=await(0,p.z)(this.server.v1.authentication.requestOtpRecoveryCodesByPhone({login:e}));return(0,E.EQ)(t,{success:()=>(0,l.Vp)(void 0),failure:e=>(0,E.EQ)(e.error,{...S.J,FetchFailedError:b(f.A.NetworkError),BusinessError:e=>(0,I.G)(e.code,{INVALID_RECOVERY_PHONE:b(f.A.AccountNotEligible),SMS_ERROR:()=>(0,A.j)("Dashlane servers failed to send SMS"),SMS_OPT_OUT:b(f.A.AccountNotEligible),USER_NOT_FOUND:b(f.A.AccountNotEligible),WRONG_OTP_STATUS:b(f.A.AccountNotEligible)})})})}constructor(e){this.server=e}}C=(0,i.gn)([(0,c.W)(a.x),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w.l?Object:w.l])],C);var O=s(3689),R=s(16623),T=s(46449),_=s(41842),D=s(43978),F=s(69885),P=s(85390);class U{execute(){const e=this.carbon.queries.liveWebAuthnAuthenticationOptedIn(void 0).pipe((0,_.h)(l.d6),(0,m.U)((e=>e.data))),t=this.carbon.queries.liveIsSSOUser(void 0).pipe((0,_.h)(l.d6),(0,m.U)((e=>e.data))).pipe((0,D.w)((e=>e?(0,F.of)(!1):this.carbon.queries.getAccountAuthenticationType().pipe((0,_.h)(l.d6),(0,m.U)((e=>"masterPassword"===e.data)))))),s=this.pin.queries.getCurrentUserStatus().pipe((0,_.h)(l.d6),(0,m.U)((e=>e.data.isPinCodeEnabled))),i=(0,P.a)({isMpUser:t,isPinCodeEnabled:s}).pipe((0,m.U)((({isMpUser:e,isPinCodeEnabled:t})=>(0,l.Vp)(!e&&t))),(0,_.h)(l.d6),(0,m.U)((e=>e.data)));return(0,P.a)({hasBiometrics:e,isPasswordlessUser:i,isMpUser:t}).pipe((0,m.U)((({hasBiometrics:e,isPasswordlessUser:t,isMpUser:s})=>(0,l.Vp)([...e?[O.W.Biometrics]:[],...t?[O.W.Pin]:[],...s?[O.W.MasterPassword]:[]]))))}constructor(e,t){this.pin=e,this.carbon=t}}U=(0,i.gn)([(0,T.e)(O.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===R.u?Object:R.u,void 0===h._?Object:h._])],U);var N=s(6751);class L{}L=(0,i.gn)([(0,n.Y)({api:r.M,handlers:{commands:{validateWebauthnAssertion:y,request2FaCodesByPhone:C},events:{},queries:{userVerificationMethods:U}},imports:[o.n,N.R],providers:[v]})],L)},1140:(e,t,s)=>{s.d(t,{SX:()=>u,kg:()=>h});var i=s(85045),r=s(59788),n=s(79386);const o=["masterPassword","serverKey","pinCode","passphrase","ssoServiceProviderKey","ssoToken"],a=(e,t=new WeakSet)=>{if(null==e)return e;if("object"!=typeof e)return e;if(t.has(e))return e;if(t.add(e),Array.isArray(e))return e.map((e=>a(e,t)));const s={};for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&"string"==typeof i){const r=e[i];o.some((e=>i.toLowerCase().includes(e.toLowerCase())))?s[i]="xxxxxxx":s[i]="object"==typeof r&&null!==r?a(r,t):r}return s},c=(e,t)=>null==e?"":"string"==typeof e?e:"number"==typeof e?`${e}`:t&&e instanceof Error?e:JSON.stringify(e),d=e=>{if(e&&"object"==typeof e&&!(e instanceof Error)){const t=a(e);return Object.keys(t).reduce(((e,s)=>{const i=t[s];return{...e,[s]:c(i,!1)}}),{})}return{data:c(e,!1)}},l=e=>!e||"object"!=typeof e||e instanceof Error?e&&e instanceof Error?{error:c(e,!0)}:{data:c(e,!0)}:a(e);class u extends((0,i.AJ)()){info(e,t){super.info(e,d(t))}debug(e,t){super.debug(e,l(t))}error(e,t){super.error(e,l(t))}fatal(e,t){super.fatal(e,l(t))}trace(e,t){super.trace(e,l(t))}warn(e,t){super.warn(e,l(t))}log(e,t){super.log(e,l(t))}}const p=r.V.create({container:"no-container",module:"no-module",domain:"authentication-core",infra:new n.s}),h=new Proxy(p,{get:(e,t,s)=>"info"===t?(t,s)=>{e.info(t,d(s))}:"debug"===t?(t,s)=>{e.debug(t,l(s))}:"error"===t?(t,s)=>{e.error(t,l(s))}:"fatal"===t?(t,s)=>{e.fatal(t,l(s))}:"trace"===t?(t,s)=>{e.trace(t,l(s))}:"warn"===t?(t,s)=>{e.warn(t,l(s))}:"log"===t?(t,s)=>{e.log(t,l(s))}:Reflect.get(e,t,s)})},99520:(e,t,s)=>{s.d(t,{e:()=>i});class i{async redirectUserToExternalUrl(e){try{await chrome.tabs.create({url:e.externalUrl,active:e.tabFocus})}catch(t){this.logger.warn("Auto-SSO - No window available, delaying tab creation",{location:"WebExtensionAuthenticationFlowInfraContext",method:"redirectUserToExternalUrl()",error:t});const s=()=>{chrome.tabs.create({url:e.externalUrl,active:e.tabFocus}),chrome.windows.onCreated.removeListener(s)};chrome.windows.onCreated.addListener(s)}}constructor(e){this.logger=e}}},67053:(e,t,s)=>{s.d(t,{c:()=>a});var i=s(75958),r=s(23032),n=s(37931),o=s(49164);const a=(0,i.Q)({name:"autofillData",commands:{},events:{},queries:{getSingleAutofillData:r.a,getMultipleAutofillData:n.N,searchAutofillData:o.w}})},37931:(e,t,s)=>{s.d(t,{N:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},23032:(e,t,s)=>{s.d(t,{a:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},49164:(e,t,s)=>{s.d(t,{w:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},32671:(e,t,s)=>{s.d(t,{Y:()=>o});var i=s(75958),r=s(43814),n=s(91056);const o=(0,i.Q)({name:"autofillTracking",commands:{temporaryEmitPasswordAutofillPerformedEvent:r.q},events:{passwordAutofillPerformedEvent:n.p},queries:{}})},43814:(e,t,s)=>{s.d(t,{q:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},91056:(e,t,s)=>{s.d(t,{p:()=>n});var i=s(446),r=s(62149);class n extends((0,i.d)({scope:r.F.User})){}},95322:(e,t,s)=>{s.d(t,{a:()=>o});var i=s(75958),r=s(59168),n=s(16705);const o=(0,i.Q)({name:"cloudPasskey",commands:{},events:{},queries:{registerPasskey:r.E,usePasskey:n.w}})},59168:(e,t,s)=>{s.d(t,{E:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},16705:(e,t,s)=>{s.d(t,{w:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},99510:(e,t,s)=>{s.d(t,{Hn:()=>o,QY:()=>d,hl:()=>c,j1:()=>a,qH:()=>r,qc:()=>n});var i=s(98124),r=function(e){return e.NOT_SUPPORTED_ERROR="NOT_SUPPORTED_ERROR",e.SECURITY_ERROR="SECURITY_ERROR",e.NOT_ALLOWED_ERROR="NOT_ALLOWED_ERROR",e.INVALID_STATE_ERROR="INVALID_STATE_ERROR",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e}({});const n=(0,i.Vj)("NOT_SUPPORTED_ERROR","The operation is not supported"),o=(0,i.Vj)("SECURITY_ERROR","The operation is insecure"),a=(0,i.Vj)("NOT_ALLOWED_ERROR","The request is not allowed by the user agent or the platform in the current context, possibly because the user denied permission"),c=(0,i.Vj)("INVALID_STATE_ERROR","The object is in an invalid state"),d=(0,i.Vj)("UNKNOWN_ERROR","The operation failed for an unknown transient reason (e.g. out of memory)")},63433:(e,t,s)=>{s.d(t,{S:()=>i});var i=function(e){return e.AutofillWebAskBeforeAutologin="autofill_web_askBeforeAutologin",e.AutofillWebInjectScriptOnStartDev="autofill_web_injectScriptOnStart_dev",e.ReplaceInputListeners="autofill_web_replaceInputListeners",e.PasskeySupport="autofill_web_passkey_support",e.ImproveImpalaVisibility="autofill_web_improveImpalaVisibility",e.ImproveImpalaVisibilityDev="autofill_web_improveImpalaVisibility_dev",e.DisableEmailPasswordWarningDev="ace_disable_email_password_warning_dev",e.DisableEmailPasswordWarning="ace_disable_email_password_warning",e.AdminInterview="ace_admin_tab_interview",e.AdminInterviewDev="ace_admin_tab_interview_dev",e.SecretsAttachment="ace_secrets_vault_attachment",e.InAppPasswordHealthBadges="ace_inapp_passwordhealth_indicators",e.SharedCollectionInSaveWebcard="shared_collection_in_save_webcard_dev",e.UninstallNudges="ace_nudges_uninstall_slack",e.EnableVortex="ace_web_enable_vortex",e.FunAuditLogs="ace_item_fun_auditlogs",e.WebcardsPerformanceImprovement="ace_web_webcards_perf_improvements",e.CloudPasskeyDev="ace_web_cloud_passkey_dev",e}({})},34255:(e,t,s)=>{s.d(t,{Pw:()=>o,q_:()=>r,rF:()=>a,up:()=>i});const i=["KWAddress","KWBankStatement","KWCompany","KWDriverLicence","KWEmail","KWFiscalStatement","KWIDCard","KWIdentity","KWMerchand","KWPassport","KWPaymentMean_creditCard","KWPaymentMean_paypal","KWPersonalWebsite","KWPhone","KWSecureNote","KWSecureNoteCategory","KWSocialSecurityStatement"],r=["KWAuthentifiant","KWGeneratedPassword","KWPasskey"],n=[...i,...r],o=e=>!!e&&"string"==typeof e&&n.includes(e),a=e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every(o)},4427:(e,t,s)=>{s.d(t,{P:()=>i,w:()=>r});const i=e=>e instanceof Array&&!e.find((e=>{return!("object"==typeof(t=e)&&null!==t&&"id"in t&&"fieldIdentifier"in t&&"domain"in t);var t})),r=e=>"none"===e.correctedDataSource},28216:(e,t,s)=>{s.d(t,{M:()=>i});var i=function(e){return e[e.CannotDisable=0]="CannotDisable",e[e.DisableSpecificVaultItem=1]="DisableSpecificVaultItem",e[e.DisableGeneralSetting=2]="DisableGeneralSetting",e}({})},13725:(e,t,s)=>{s.d(t,{f:()=>i});const i=Object.freeze({NO_TYPE:"NO_TYPE",UNIVERSAL:"UNIVERSAL",AD:"AD",AE:"AE",AF:"AF",AG:"AG",AI:"AI",AL:"AL",AM:"AM",AO:"AO",AR:"AR",AS:"AS",AT:"AT",AU:"AU",AW:"AW",AZ:"AZ",BA:"BA",BB:"BB",BD:"BD",BE:"BE",BF:"BF",BG:"BG",BH:"BH",BI:"BI",BJ:"BJ",BL:"BL",BM:"BM",BN:"BN",BO:"BO",BR:"BR",BS:"BS",BT:"BT",BW:"BW",BY:"BY",BZ:"BZ",CA:"CA",CD:"CD",CF:"CF",CG:"CG",CH:"CH",CI:"CI",CK:"CK",CL:"CL",CM:"CM",CN:"CN",CO:"CO",CR:"CR",CU:"CU",CV:"CV",CY:"CY",CZ:"CZ",DE:"DE",DJ:"DJ",DK:"DK",DM:"DM",DO:"DO",DZ:"DZ",EC:"EC",EE:"EE",EG:"EG",ER:"ER",ES:"ES",ET:"ET",FI:"FI",FJ:"FJ",FK:"FK",FM:"FM",FO:"FO",FR:"FR",GA:"GA",GB:"GB",GD:"GD",GE:"GE",GF:"GF",GG:"GG",GH:"GH",GI:"GI",GL:"GL",GM:"GM",GN:"GN",GP:"GP",GQ:"GQ",GR:"GR",GT:"GT",GU:"GU",GW:"GW",GY:"GY",HK:"HK",HN:"HN",HR:"HR",HT:"HT",HU:"HU",ID:"ID",IE:"IE",IL:"IL",IM:"IM",IN:"IN",IO:"IO",IQ:"IQ",IR:"IR",IS:"IS",IT:"IT",JE:"JE",JM:"JM",JO:"JO",JP:"JP",KE:"KE",KG:"KG",KH:"KH",KI:"KI",KM:"KM",KN:"KN",KP:"KP",KR:"KR",KW:"KW",KY:"KY",KZ:"KZ",LA:"LA",LB:"LB",LC:"LC",LI:"LI",LK:"LK",LR:"LR",LS:"LS",LT:"LT",LU:"LU",LV:"LV",LY:"LY",MA:"MA",MC:"MC",MD:"MD",ME:"ME",MF:"MF",MG:"MG",MH:"MH",MK:"MK",ML:"ML",MM:"MM",MN:"MN",MO:"MO",MP:"MP",MQ:"MQ",MR:"MR",MS:"MS",MT:"MT",MU:"MU",MV:"MV",MW:"MW",MX:"MX",MY:"MY",MZ:"MZ",NA:"NA",NC:"NC",NE:"NE",NF:"NF",NG:"NG",NI:"NI",NL:"NL",NO:"NO",NP:"NP",NR:"NR",NU:"NU",NZ:"NZ",OM:"OM",PA:"PA",PE:"PE",PF:"PF",PG:"PG",PH:"PH",PK:"PK",PL:"PL",PM:"PM",PR:"PR",PS:"PS",PT:"PT",PW:"PW",PY:"PY",QA:"QA",RE:"RE",RO:"RO",RS:"RS",RU:"RU",RW:"RW",SA:"SA",SB:"SB",SC:"SC",SD:"SD",SE:"SE",SG:"SG",SH:"SH",SI:"SI",SK:"SK",SL:"SL",SM:"SM",SN:"SN",SO:"SO",SR:"SR",ST:"ST",SV:"SV",SY:"SY",SZ:"SZ",TC:"TC",TD:"TD",TF:"TF",TG:"TG",TH:"TH",TJ:"TJ",TK:"TK",TL:"TL",TM:"TM",TN:"TN",TO:"TO",TR:"TR",TT:"TT",TV:"TV",TW:"TW",TZ:"TZ",UA:"UA",UG:"UG",US:"US",UY:"UY",UZ:"UZ",VA:"VA",VC:"VC",VE:"VE",VG:"VG",VI:"VI",VN:"VN",VU:"VU",WF:"WF",WS:"WS",XK:"XK",YE:"YE",YT:"YT",ZA:"ZA",ZM:"ZM",ZW:"ZW",AQ:"AQ",AX:"AX",BV:"BV",CC:"CC",CX:"CX",EH:"EH",GS:"GS",HM:"HM",PN:"PN",SJ:"SJ",UM:"UM"})},23501:(e,t,s)=>{s.d(t,{$b:()=>n,JV:()=>r,Wm:()=>o});var i=s(30812),r=function(e){return e.NewPassword="newPassword",e.SubmitButton="submitButton",e.WebauthnConditionalUI="WebauthnConditionalUI",e}({});const n=e=>Object.values(r).includes(e),o=e=>e in i.k},30812:(e,t,s)=>{s.d(t,{k:()=>i});var i=function(e){return e.Address="Address",e.BankAccount="BankAccount",e.Company="Company",e.Credential="Credential",e.DriverLicense="DriverLicense",e.Email="Email",e.FiscalId="FiscalId",e.GeneratedPassword="GeneratedPassword",e.IdCard="IdCard",e.Identity="Identity",e.Note="Note",e.Passport="Passport",e.Passkey="Passkey",e.PaymentCard="PaymentCard",e.PersonalWebsite="PersonalWebsite",e.Phone="Phone",e.Secret="Secret",e.SocialSecurityId="SocialSecurityId",e}({})},83586:(e,t,s)=>{s.r(t),s.d(t,{AddDisabledSourceTypesCommand:()=>W.g,AddLinkedWebsiteCommand:()=>O.vp,AddLinkedWebsiteErrors:()=>O.hy,AnalysisStatus:()=>K._,AutofillFeatureFlips:()=>g.S,AutofillSettingsApiClient:()=>k.W,CREDENTIAL_DATA_MODELS:()=>S.q_,CloudPasskeyErrorCode:()=>h.qH,CountriesForAutofill:()=>m.f,DisableAnalysisCommand:()=>B.u,DisableAutofillOnFormsCommand:()=>q.t,DisableAutofillOnLoginsCommand:()=>H.f,DisableAutologinCommand:()=>z.T,DisableFollowUpNotificationCommand:()=>Y.y,DisablePhishingPreventionForUrlCommand:()=>x.z,EnableAnalysisCommand:()=>Q.c,EnableAutofillOnFormsCommand:()=>X.a,EnableAutofillOnLoginsCommand:()=>Z.I,EnableAutologinCommand:()=>$.i,EnableFollowUpNotificationCommand:()=>J.B,FORM_DATA_MODELS:()=>S.up,GetAnalysisStatusOnUrlQuery:()=>K.h,GetAutofillDisabledOnLoginsAndFormsNotificationStatusQuery:()=>D.z,GetAutofillProtectionContextQuery:()=>P.u,GetAutofillSettingsQuery:()=>M.T,GetDashlaneDefinedLinkedWebsitesQuery:()=>f.J,GetMultipleAutofillDataQuery:()=>n.N,GetMultipleDashlaneDefinedLinkedWebsitesQuery:()=>b.E,GetPreferencesForCredentialsQuery:()=>V.g,GetSingleAutofillDataQuery:()=>r.a,GetUserAutofillCorrectionsQuery:()=>j.w,LinkedWebsitesClient:()=>A.X,OtherSourceType:()=>v.JV,PasswordAutofillPerformedEvent:()=>c.p,PhishingPreventionDisabledForUrlQuery:()=>N.v,PhishingPreventionEnabledQuery:()=>U.i,RegisterPasskeyQuery:()=>u.E,RemoveDisabledSourceTypesCommand:()=>ee.v,RemoveLinkedWebsiteCommand:()=>R.M7,RemoveLinkedWebsiteErrors:()=>R.E6,ResetProtectedItemAutofillTimerCommand:()=>L.y,SearchAutofillDataQuery:()=>o.w,SetAutofillDisabledOnLoginsAndFormsNotificationStatusCommand:()=>_.a,SetUserAutofillCorrectionsCommand:()=>se.S,TemporaryEmitPasswordAutofillPerformedEventCommand:()=>d.q,ToggleDashlaneCommand:()=>te.r,UpdateCredentialPreferencesCommand:()=>ie.J,UpdateLinkedWebsitesCommand:()=>C.A,UsePasskeyQuery:()=>p.w,VaultItemDisableProtectionMode:()=>E.M,VaultSourceType:()=>y.k,autofillDataApi:()=>i.c,autofillNotificationsApi:()=>T._,autofillSecurityApi:()=>F.V,autofillSettingsApi:()=>G.I,autofillTrackingApi:()=>a.Y,cloudPasskeyApi:()=>l.a,createAddLinkedWebsiteCredentialNotFound:()=>O.i6,createAddLinkedWebsiteErrorOnUpdatingVault:()=>O.R6,createAddLinkedWebsiteWebsiteAlreadyLinked:()=>O.lD,createCloudPasskeyInvalidStateError:()=>h.hl,createCloudPasskeyNotAllowedError:()=>h.j1,createCloudPasskeyNotSupportedError:()=>h.qc,createCloudPasskeySecurityError:()=>h.Hn,createCloudPasskeyUnknownError:()=>h.QY,createRemoveLinkedWebsiteCredentialNotFound:()=>R.W4,createRemoveLinkedWebsiteErrorOnUpdatingVault:()=>R.cQ,isArrayOfAutofillableDataModel:()=>S.rF,isArrayOfUserAutofillCorrections:()=>w.P,isAutofillableDataModel:()=>S.Pw,isDashlaneDisabledPermanently:()=>w.w,isOtherSourceType:()=>v.$b,isVaultSourceType:()=>v.Wm,linkedWebsitesApi:()=>I.G});var i=s(67053),r=s(23032),n=s(37931),o=s(49164),a=s(32671),c=s(91056),d=s(43814),l=s(95322),u=s(59168),p=s(16705),h=s(99510),g=s(63433),m=s(13725),v=s(23501),y=s(30812),S=s(34255),w=s(4427),E=s(28216),I=s(85324),A=s(81813),f=s(73328),b=s(34674),C=s(92712),O=s(56231),R=s(23425),T=s(10839),_=s(1006),D=s(24584),F=s(56979),P=s(49739),U=s(97653),N=s(16743),L=s(8126),x=s(84471),G=s(98716),k=s(19216),K=s(37233),M=s(56226),j=s(50672),V=s(50072),W=s(62181),B=s(60355),z=s(56858),q=s(64912),H=s(41733),Y=s(41908),Q=s(91970),$=s(94702),X=s(79798),Z=s(33898),J=s(3499),ee=s(76751),te=s(18880),se=s(23187),ie=s(66069)},85324:(e,t,s)=>{s.d(t,{G:()=>d});var i=s(75958),r=s(56231),n=s(23425),o=s(92712),a=s(73328),c=s(34674);const d=(0,i.Q)({name:"linkedWebsites",commands:{addLinkedWebsite:r.vp,removeLinkedWebsite:n.M7,updateLinkedWebsites:o.A},events:{},queries:{getDashlaneDefinedLinkedWebsites:a.J,getMultipleDashlaneDefinedLinkedWebsites:c.E}})},81813:(e,t,s)=>{s.d(t,{X:()=>n});var i=s(8260),r=s(85324);class n extends((0,i.E)(r.G)){}(0,i.K)(r.G,n)},56231:(e,t,s)=>{s.d(t,{R6:()=>d,hy:()=>o,i6:()=>a,lD:()=>c,vp:()=>l});var i=s(13385),r=s(62149),n=s(98124),o=function(e){return e.CREDENTIAL_NOT_FOUND="credential_not_found",e.WEBSITE_ALREADY_LINKED="website_already_linked",e.ERROR_ON_UPDATING_VAULT="error_on_updating_vault",e}({});const a=(0,n.Vj)("credential_not_found","Couldn't retrieve the credential"),c=(0,n.Vj)("website_already_linked","Website alredy linked to this credential"),d=(0,n.Vj)("error_on_updating_vault","Error while updating the credential");class l extends((0,i.g)({scope:r.F.User})){}},23425:(e,t,s)=>{s.d(t,{E6:()=>o,M7:()=>d,W4:()=>a,cQ:()=>c});var i=s(13385),r=s(62149),n=s(98124),o=function(e){return e.CREDENTIAL_NOT_FOUND="credential_not_found",e.ERROR_ON_UPDATING_VAULT="error_on_updating_vault",e}({});const a=(0,n.Vj)("credential_not_found","Couldn't retrieve the credential"),c=(0,n.Vj)("error_on_updating_vault","Error while updating the credential");class d extends((0,i.g)({scope:r.F.User})){}},92712:(e,t,s)=>{s.d(t,{A:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},73328:(e,t,s)=>{s.d(t,{J:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},34674:(e,t,s)=>{s.d(t,{E:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},10839:(e,t,s)=>{s.d(t,{_:()=>o});var i=s(75958),r=s(1006),n=s(24584);const o=(0,i.Q)({name:"autofillNotifications",commands:{setAutofillDisabledOnLoginsAndFormsNotificationStatus:r.a},events:{},queries:{getAutofillDisabledOnLoginsAndFormsNotificationStatus:n.z}})},1006:(e,t,s)=>{s.d(t,{a:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},24584:(e,t,s)=>{s.d(t,{z:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},56979:(e,t,s)=>{s.d(t,{V:()=>d});var i=s(75958),r=s(84471),n=s(8126),o=s(49739),a=s(97653),c=s(16743);const d=(0,i.Q)({name:"autofillSecurity",commands:{disablePhishingPreventionForUrl:r.z,resetProtectedItemAutofillTimer:n.y},events:{},queries:{getAutofillProtectionContext:o.u,isPhishingPreventionCapabilityEnabled:a.i,isPhishingPreventionDisabledForUrl:c.v}})},84471:(e,t,s)=>{s.d(t,{z:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},8126:(e,t,s)=>{s.d(t,{y:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},49739:(e,t,s)=>{s.d(t,{u:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},97653:(e,t,s)=>{s.d(t,{i:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},16743:(e,t,s)=>{s.d(t,{v:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},98716:(e,t,s)=>{s.d(t,{I:()=>f});var i=s(75958),r=s(76751),n=s(62181),o=s(18880),a=s(91970),c=s(94702),d=s(79798),l=s(33898),u=s(3499),p=s(60355),h=s(56858),g=s(64912),m=s(41733),v=s(41908),y=s(23187),S=s(66069),w=s(37233),E=s(56226),I=s(50672),A=s(50072);const f=(0,i.Q)({name:"autofillSettings",commands:{toggleDashlane:o.r,enableAnalysis:a.c,enableAutologin:c.i,enableAutofillOnForms:d.a,enableAutofillOnLogins:l.I,enableFollowUpNotification:u.B,disableAnalysis:p.u,disableAutologin:h.T,disableAutofillOnForms:g.t,disableAutofillOnLogins:m.f,disableFollowUpNotification:v.y,addDisabledSourceTypes:n.g,removeDisabledSourceTypes:r.v,setUserAutofillCorrections:y.S,updateCredentialPreferences:S.J},events:{},queries:{getAnalysisStatusOnUrl:w.h,getAutofillSettings:E.T,getUserAutofillCorrections:I.w,getPreferencesForCredentials:A.g}})},19216:(e,t,s)=>{s.d(t,{W:()=>n});var i=s(8260),r=s(98716);class n extends((0,i.E)(r.I)){}(0,i.K)(r.I,n)},62181:(e,t,s)=>{s.d(t,{g:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},60355:(e,t,s)=>{s.d(t,{u:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},64912:(e,t,s)=>{s.d(t,{t:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},41733:(e,t,s)=>{s.d(t,{f:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},56858:(e,t,s)=>{s.d(t,{T:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},41908:(e,t,s)=>{s.d(t,{y:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},91970:(e,t,s)=>{s.d(t,{c:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},79798:(e,t,s)=>{s.d(t,{a:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},33898:(e,t,s)=>{s.d(t,{I:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},94702:(e,t,s)=>{s.d(t,{i:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},3499:(e,t,s)=>{s.d(t,{B:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},76751:(e,t,s)=>{s.d(t,{v:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},23187:(e,t,s)=>{s.d(t,{S:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},18880:(e,t,s)=>{s.d(t,{r:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},66069:(e,t,s)=>{s.d(t,{J:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},37233:(e,t,s)=>{s.d(t,{_:()=>n,h:()=>o});var i=s(77535),r=s(62149),n=function(e){return e.ANALYSIS_ENABLED="ANALYSIS_ENABLED",e.ANALYSIS_DISABLED_BY_USER="ANALYSIS_DISABLED_BY_USER",e.ANALYSIS_DISABLED_BY_B2B_ADMIN="ANALYSIS_DISABLED_BY_B2B_ADMIN",e.ANALYSIS_DISABLED_BY_KILLSWITCH="ANALYSIS_DISABLED_BY_KILLSWITCH",e.ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT="ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT",e}({});class o extends((0,i.k)({scope:r.F.Device})){}},56226:(e,t,s)=>{s.d(t,{T:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},50072:(e,t,s)=>{s.d(t,{g:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User,useCache:!0})){}},50672:(e,t,s)=>{s.d(t,{w:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},76347:(e,t,s)=>{s.d(t,{U:()=>j});var i=s(92336),r=s(86006),n=s(67053),o=s(87065),a=s(30812),c=s(92587),d=s(78346),l=s(33312),u=s(39431),p=s(29289),h=s(50879),g=s(22449);const m={[a.k.Address]:u.U.Address,[a.k.BankAccount]:u.U.BankAccount,[a.k.Company]:u.U.Company,[a.k.Credential]:u.U.Credential,[a.k.DriverLicense]:u.U.DriversLicense,[a.k.Email]:u.U.Email,[a.k.FiscalId]:u.U.FiscalId,[a.k.GeneratedPassword]:null,[a.k.IdCard]:u.U.IdCard,[a.k.Identity]:u.U.Identity,[a.k.Note]:u.U.SecureNote,[a.k.Passkey]:u.U.Passkey,[a.k.Passport]:u.U.Passport,[a.k.PaymentCard]:u.U.PaymentCard,[a.k.PersonalWebsite]:u.U.Website,[a.k.Phone]:u.U.Phone,[a.k.SocialSecurityId]:u.U.SocialSecurityId,[a.k.Secret]:u.U.Secret};class v{getAutofillData(e,t,s,i,r,n){const a=e.map((e=>m[e])).filter((e=>!!e));if(a.length<1)throw new Error("autofill-data.repository: bad vault item type in `getAutofillData`");return this.getVaultItem(a,t?[t]:void 0,s,i,r,n).pipe((0,o.U)((e=>{if((0,d.hx)(e))throw new Error("autofill-data.repository: the following error occured while requesting the vault API "+e.tag);if(t&&e.data[p.N[a[0]]].matchCount<1)throw new Error("autofill-data.repository: no vault item corresponding to the provided id");return e})))}searchAutofillData(e,t,s,i,r,n){let o;return t?.length&&(o=t.map((e=>m[e])).filter((e=>!!e))),this.searchVaultItem(e,o,s,i,r,n).pipe((0,l.DZ)((e=>{throw new Error("autofill-data.repository: the following error occured while requesting the search vault API "+e)})))}getVaultItem(e,t,s,i,r,n){const{query:o}=this.vaultClient.queries;return o({vaultItemTypes:e,ids:t,propertySorting:s,propertyFilters:i,pageNumber:n,pageSize:r})}searchVaultItem(e,t,s,i,r,n=!1){const{search:o}=this.searchClient.queries;return o({searchQuery:e,vaultItemTypes:t,propertySorting:s,pageSize:i,pageNumber:r,needDashlaneLinkedWebsites:n})}constructor(e,t){this.vaultClient=e,this.searchClient=t}}v=(0,i.gn)([(0,c.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.L?Object:h.L,void 0===g.T?Object:g.T])],v);var y=s(60399),S=s(19216),w=s(81813),E=s(35594),I=s(13134),A=s(48062);const f=(e,t,s)=>{const i=((e,t,s)=>{if(!e)return"None";const i=new I.Y(e).getRootDomain();return i===new I.Y(t.URL).getRootDomain()?"MainWebsite":s.map((e=>new I.Y(e).getRootDomain())).includes(i)?"DashlaneDefinedLinkedWebsite":t.linkedURLs.map((e=>new I.Y(e).getRootDomain())).includes(i)?"UserDefinedLinkedWebsite":"None"})(e,t,s);switch(i){case"DashlaneDefinedLinkedWebsite":return A.MatchType.AssociatedWebsite;case"UserDefinedLinkedWebsite":return A.MatchType.UserAssociatedWebsite;default:return A.MatchType.Regular}},b=e=>new Date(1e3*e),C=e=>{if(!e)return null;const t=(e=>{if(!e)return 0;const[t,s,i]=e.split(/[-/]/).map((e=>Number.parseInt(e,10))),r=new Date;r.setUTCHours(0,0,0,0);const n=r.setUTCFullYear(t,s-1,i);return Math.floor(n/1e3)})(e);return Number.isNaN(t)?null:t},O=e=>{const t=new Date(0).getUTCFullYear(),s=b(C(e.birthDate)??0),i=new Date(Date.now()-s.getTime());return Math.abs(i.getUTCFullYear()-t)},R=e=>e??"",T=e=>e??0;class _{getAutofillViewForItems(e,{data:t},s){const i=e.filter((e=>e!==a.k.GeneratedPassword));if(i.length<1)throw new Error("AutofillDataService: unexpected item types");return Promise.all(i.map((e=>this.mapVaultItemToAutofillView[e](t,s))))}getSingleAutofillViewForItem(e,{data:t},s){if(e===a.k.GeneratedPassword)throw new Error("AutofillDataService: unexpected item type");return this.mapVaultItemToAutofillView[e](t,s)}baseItemAutofillView(e){return{id:e.id,lastUse:e.lastUse,localeFormat:e.localeFormat,spaceId:R(e.spaceId)}}async addressAutofillView(e){return{items:e.addressesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:a.k.Address,addressFull:`${R(e.streetNumber)} ${e.streetName}`.trim(),stateCode:R(e.stateNumber),addressName:R(e.itemName),streetTitle:R(e.streetName),building:R(e.building),city:R(e.city),country:R(e.country),zipCode:R(e.zipCode),streetName:R(e.streetName),streetNumber:R(e.streetNumber),state:R(e.state),stairs:R(e.stairs),digitCode:R(e.digitCode),stateLevel2:"",door:R(e.door),floor:R(e.floor)}))),count:e.addressesResult.matchCount}}async bankAccountAutofillView(e){return{items:e.bankAccountsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:a.k.BankAccount,name:R(e.accountName),owner:R(e.ownerName),IBAN:R(e.IBAN),BIC:R(e.BIC),bank:"",bankCode:R(e.bankCode),country:R(e.country)}))),count:e.bankAccountsResult.matchCount}}async companyAutofillView(e){return{items:e.companiesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:a.k.Company,name:R(e.companyName),jobTitle:R(e.jobTitle)}))),count:e.companiesResult.matchCount}}filteredCredentials(e,t,s){const i=s.map((e=>new I.Y(e).getRootDomain()));return e.filter((e=>{const s=new I.Y(e.URL).getRootDomain();return s===t||(!!i.includes(s)||!!e.linkedURLs.map((e=>new I.Y(e).getRootDomain())).includes(t))}))}async credentialAutofillView(e,t){const{getDashlaneDefinedLinkedWebsites:s}=this.linkedWebsitesClient.queries,{getPreferencesForCredentials:i}=this.autofillSettings.queries,r=await(0,y.z)(s({url:t??""}));if((0,d.hx)(r))throw new Error("Failed to retrieve dashlane linked website for domain: "+r.error);const n=t?this.filteredCredentials(e.credentialsResult.items,t,r.data):e.credentialsResult.items,o=n.map((({id:e})=>e)),c=await(0,y.z)(i({credentialIds:o}));if((0,d.hx)(c))throw new Error("Failed to retrieve preferences result: "+c.error);const l=c.data;return Promise.all(n.map((async e=>{const i=l.find((({id:t})=>t===e.id)),r=await(0,y.z)(s({url:e.URL}));if(!i||(0,d.hx)(r))throw new Error("Failed to map Credential to autofill view");const n=await this.getSharingInfoForItem(e.id),{data:o}=r,{useAutoLogin:c,requireMasterPassword:u,onlyAutofillExactDomain:p}=i;return{...this.baseItemAutofillView(e),vaultType:a.k.Credential,title:R(e.itemName),url:R(e.URL),secondaryLogin:R(e.alternativeUsername),email:R(e.email),password:R(e.password),otpSecret:R(e.otpSecret),matchType:f(t??"",e,o),login:R(e.username),hasOtp:Boolean(e.otpURL)||Boolean(e.otpSecret),otpUrl:R(e.otpURL),autoLogin:c,autoProtected:u,subdomainOnly:p,userAddedLinkedWebsites:e.linkedURLs,sharingStatus:n}}))).then((t=>({items:t,count:e.credentialsResult.matchCount})))}async getSharingInfoForItem(e){const{getPermissionForItem:t}=this.sharingItemsClient.queries,s=await(0,y.z)(t({itemId:e}));if((0,d.hx)(s))throw new Error("Failed to get sharing info for item in `autofill-data.service`");const{capabilities:i,permissionLevel:r}=s.data,{canCopy:n,canEdit:o,canView:a}=i;return r?{isShared:!0,canCopy:n,canView:a,canEdit:o}:{isShared:!1}}async driverLicenseAutofillView(e){return{items:e.driversLicensesResult.items.map((e=>{const t=b(T(C(e.expirationDate))),s=b(T(C(e.issueDate)));return{...this.baseItemAutofillView(e),vaultType:a.k.DriverLicense,expirationDay:t.getDate(),expirationMonth:t.getMonth()+1,expirationYear:t.getFullYear(),expirationDateFull:`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`,idNumber:R(e.idNumber),issueDay:s.getDate(),issueMonth:s.getMonth()+1,issueYear:s.getFullYear(),issueDateFull:`${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()}`,country:R(e.country),creationDate:T(e.creationDatetime),name:R(e.idName),state:R(e.state)}})),count:e.driversLicensesResult.matchCount}}async emailAutofillView(e){return{items:e.emailsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:a.k.Email,email:R(e.emailAddress),name:R(e.itemName),type:e.type??"NO_TYPE"}))),count:e.emailsResult.matchCount}}async fiscalIdAutofillView(e){return{items:e.fiscalIdsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:a.k.FiscalId,creationDate:T(e.creationDatetime),country:R(e.country),idNumber:R(e.fiscalNumber),teledeclarantNumber:R(e.teledeclarantNumber)}))),count:e.fiscalIdsResult.matchCount}}async identityAutofillView(e){return{items:e.identitiesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:a.k.Identity,age:O(e),birthDate:R(e.birthDate),birthPlace:R(e.birthPlace),firstName:R(e.firstName),lastName2:R(e.lastName2),lastName:R(e.lastName),middleName:R(e.middleName),middleNameInitial:R(e.middleName),pseudo:R(e.pseudo),title:R(e.title)}))),count:e.identitiesResult.matchCount}}async idCardAutofillView(e){return{items:e.idCardsResult.items.map((e=>{const t=b(T(C(e.expirationDate))),s=b(T(C(e.issueDate)));return{...this.baseItemAutofillView(e),vaultType:a.k.IdCard,country:R(e.country),creationDate:T(e.creationDatetime),expirationDay:t.getDate(),expirationMonth:t.getMonth()+1,expirationYear:t.getFullYear(),expirationDateFull:`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`,idNumber:R(e.idNumber),issueDay:s.getDate(),issueMonth:s.getMonth()+1,issueYear:s.getFullYear(),issueDateFull:`${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()}`,name:R(e.idName)}})),count:e.idCardsResult.matchCount}}async noteAutofillView(e){return{items:e.secureNotesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:a.k.Note}))),count:e.secureNotesResult.matchCount}}async secretAutofillView(e){return{items:e.secretsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:a.k.Secret}))),count:e.secretsResult.matchCount}}async passportAutofillView(e){return{items:e.passportsResult.items.map((e=>{const t=b(T(C(e.expirationDate))),s=b(T(C(e.issueDate)));return{...this.baseItemAutofillView(e),vaultType:a.k.Passport,country:e.country,creationDate:T(e.creationDatetime),deliveryPlace:e.issuePlace,expirationDay:t.getDate(),expirationMonth:t.getMonth()+1,expirationYear:t.getFullYear(),expirationDateFull:`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`,idNumber:R(e.idNumber),issueDay:s.getDate(),issueMonth:s.getMonth()+1,issueYear:s.getFullYear(),issueDateFull:`${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()}`,name:R(e.idName)}})),count:e.passportsResult.matchCount}}async paymentCardAutofillView(e){return{items:e.paymentCardsResult.items.map((e=>{let t="";return e.cardNumber&&e.cardNumber.trim().length>0&&(t=e.cardNumber.trim().slice(-4)),{...this.baseItemAutofillView(e),vaultType:a.k.PaymentCard,bank:"",cardNumber:R(e.cardNumber),cardNumberLastDigits:t,color:e.color||"BLUE_1",expireMonth:R(e.expireMonth),expireYear:R(e.expireYear),name:R(e.itemName),ownerName:R(e.ownerName),securityCode:R(e.securityCode),type:"PAYMENT_TYPE_MASTERCARD"}})),count:e.paymentCardsResult.matchCount}}async personalWebsiteAutofillView(e){return{items:e.websitesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:a.k.PersonalWebsite,name:R(e.itemName),website:R(e.URL)}))),count:e.websitesResult.matchCount}}async phoneAutofillView(e){return{items:e.phonesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:a.k.Phone,name:R(e.itemName),numberInternational:R(e.numberInternational),number:R(e.phoneNumber),type:e.type}))),count:e.phonesResult.matchCount}}async socialSecurityIdAutofillView(e){return{items:e.socialSecurityIdsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:a.k.SocialSecurityId,name:R(e.idName),idNumber:R(e.idNumber),country:R(e.country),creationDate:T(e.creationDatetime)}))),count:e.socialSecurityIdsResult.matchCount}}filterPasskeys(e,t){return e.filter((e=>{const s=new I.Y(e.rpId).getHostname(),i=new I.Y(t).getHostname();return i===s||i.endsWith(`.${s}`)}))}async passkeyAutofillView(e,t){return{items:(t?this.filterPasskeys(e.passkeysResult.items,t):e.passkeysResult.items).map((e=>({...this.baseItemAutofillView(e),vaultType:a.k.Passkey,credentialId:e.credentialId,rpId:e.rpId,rpName:e.rpName,userDisplayName:e.userDisplayName,userHandle:e.userHandle,counter:e.counter,keyAlgorithm:e.keyAlgorithm}))),count:e.passkeysResult.matchCount}}constructor(e,t,s){this.autofillSettings=e,this.linkedWebsitesClient=t,this.sharingItemsClient=s,this.mapVaultItemToAutofillView={[a.k.Address]:this.addressAutofillView.bind(this),[a.k.BankAccount]:this.bankAccountAutofillView.bind(this),[a.k.Company]:this.companyAutofillView.bind(this),[a.k.Credential]:this.credentialAutofillView.bind(this),[a.k.DriverLicense]:this.driverLicenseAutofillView.bind(this),[a.k.Email]:this.emailAutofillView.bind(this),[a.k.FiscalId]:this.fiscalIdAutofillView.bind(this),[a.k.IdCard]:this.idCardAutofillView.bind(this),[a.k.Identity]:this.identityAutofillView.bind(this),[a.k.Passkey]:this.passkeyAutofillView.bind(this),[a.k.Passport]:this.passportAutofillView.bind(this),[a.k.PaymentCard]:this.paymentCardAutofillView.bind(this),[a.k.Phone]:this.phoneAutofillView.bind(this),[a.k.Secret]:this.secretAutofillView.bind(this),[a.k.Note]:this.noteAutofillView.bind(this),[a.k.SocialSecurityId]:this.socialSecurityIdAutofillView.bind(this),[a.k.PersonalWebsite]:this.personalWebsiteAutofillView.bind(this)}}}_=(0,i.gn)([(0,c.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S.W?Object:S.W,void 0===w.X?Object:w.X,void 0===E.s?Object:E.s])],_);var D=s(41842),F=s(43978),P=s(23032),U=s(46449);class N{execute({body:{itemId:e,itemType:t,rootDomain:s}}){return this.autofillDataRepository.getAutofillData([t],e).pipe((0,D.h)((e=>(0,d.d6)(e))),(0,F.w)((e=>this.autofillDataService.getSingleAutofillViewForItem(t,e,s))),(0,o.U)((e=>e.items[0])),(0,o.U)(d.Vp))}constructor(e,t){this.autofillDataRepository=e,this.autofillDataService=t}}N=(0,i.gn)([(0,U.e)(P.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===v?Object:v,void 0===_?Object:_])],N);var L=s(16433),x=s(37182),G=s(37931);class k{execute({body:{itemTypes:e,domain:t,sorting:s,filters:i,pagination:r}}){return this.autofillDataRepository.getAutofillData(e,void 0,s,i,r?.pageSize,r?.pageNumber).pipe((0,D.h)((e=>(0,d.d6)(e))),(0,L.q)(1),(0,F.w)((s=>this.autofillDataService.getAutofillViewForItems(e,s,t))),(0,x.K)((e=>{throw new Error("get-multiple-autofill-data: error occured while mapping to autofill views: "+e)})),(0,o.U)((e=>e.reduce(((e,t)=>({items:[...e.items,...t.items],count:e.count+t.count})),{items:[],count:0}))),(0,o.U)(d.Vp))}constructor(e,t){this.autofillDataRepository=e,this.autofillDataService=t}}k=(0,i.gn)([(0,U.e)(G.N),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===v?Object:v,void 0===_?Object:_])],k);var K=s(49164);class M{execute({body:{searchQuery:e,itemTypes:t,domain:s,sorting:i,pagination:r,needDashlaneLinkedWebsites:n}}){const c=t??[...Object.values(a.k).filter((e=>e!==a.k.GeneratedPassword))];return this.autofillDataRepository.searchAutofillData(e,t,i,r?.pageSize,r?.pageNumber,n).pipe((0,D.h)((e=>(0,d.d6)(e))),(0,F.w)((e=>this.autofillDataService.getAutofillViewForItems(c,e,s))),(0,x.K)((e=>{throw new Error("search-autofill-data: error occured while mapping to autofill views: "+e)})),(0,o.U)((e=>e.reduce(((e,t)=>({items:[...e.items,...t.items],count:e.count+t.count})),{items:[],count:0}))),(0,o.U)(d.Vp))}constructor(e,t){this.autofillDataRepository=e,this.autofillDataService=t}}M=(0,i.gn)([(0,U.e)(K.w),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===v?Object:v,void 0===_?Object:_])],M);class j{}j=(0,i.gn)([(0,r.Y)({api:n.c,handlers:{commands:{},events:{},queries:{getSingleAutofillData:N,getMultipleAutofillData:k,searchAutofillData:M}},providers:[v,_]})],j)},32611:(e,t,s)=>{s.d(t,{V:()=>h});var i=s(92336),r=s(86006),n=s(32671),o=s(13800),a=s(92587);class c extends o.f{}c=(0,i.gn)([(0,a.GS)()],c);var d=s(82874),l=s(78346),u=s(43814);class p{execute({body:e}){const{credentialId:t}=e;return t&&this.autofillTrackingEventsEmitter.sendEvent("passwordAutofillPerformed",{credentialId:t}),Promise.resolve((0,l.Vp)(void 0))}constructor(e){this.autofillTrackingEventsEmitter=e}}p=(0,i.gn)([(0,d.W)(u.q),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===c?Object:c])],p);class h{}h=(0,i.gn)([(0,r.Y)({api:n.Y,handlers:{commands:{temporaryEmitPasswordAutofillPerformedEvent:p},events:{},queries:{}},providers:[c]})],h)},41446:(e,t,s)=>{s.d(t,{A:()=>R});var i=s(92336),r=s(95322),n=s(86006),o=s(75421),a=s(19961),c=s(162),d=s(61076),l=s(6220),u=s(78776),p=s(99510),h=s(59168),g=s(9519),m=s(14122),v=s(46449),y=s(78989),S=s(76500),w=s(78346);class E{execute(e){const{passkeys:t}=this.enclaveApiClient,s=(0,u.Z)().toUpperCase(),i=t.registerPasskey({...e.body,uuid:s}),r=this.carbonLegacyClient.queries.getSpaces();return(0,c.D)(i).pipe((0,d.V)(r),(0,l.z)((async([t,i])=>{if((0,w.hx)(t))switch(t.error.code){case y.r.SECURITY_ERROR:return(0,w.Rn)((0,p.Hn)());case y.r.INVALID_STATE_ERROR:return(0,w.Rn)((0,p.hl)());case y.r.ALGORITHM_NOT_SUPPORTED_ERROR:return(0,w.Rn)((0,p.qc)());default:return(0,w.Rn)((0,p.QY)())}if((0,w.hx)(i))return(0,w.Rn)((0,p.QY)());const{encryptionKey:r,credentialRegisterData:n}=t.data,o=(i.data.length>1?i.data:[]).find((e=>""!==e.spaceId)),a=o?.settings.enableForcedCategorization,c=a?o.spaceId:"",d=await this.carbonLegacyClient.commands.addPasskey({id:`{${s}}`,credentialId:n.id,rpId:e.body.request.options.rp.id,rpName:e.body.request.options.rp.name,userHandle:e.body.request.options.user.id,userDisplayName:e.body.request.options.user.displayName,counter:0,spaceId:c,keyAlgorithm:g.aG.CloudPasskey,cloudCipheringKey:r});return(0,w.hx)(d)||!d.data.success?(0,w.Rn)((0,p.QY)()):(0,w.Vp)({credentialRegisterData:t.data.credentialRegisterData})})))}constructor(e,t){this.carbonLegacyClient=e,this.enclaveApiClient=t}}E=(0,i.gn)([(0,v.e)(h.E),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===m._?Object:m._,void 0===S.l?Object:S.l])],E);var I=s(60399),A=s(16705),f=s(39431),b=s(79),C=s(50879);class O{vaultIdToNitroIdFormat(e){if(!e.startsWith("{")||!e.endsWith("}"))throw new Error("UsePasskeyQuery: invalid item id format");return e.substring(1,e.length-1)}async usePasskey(e){const{id:t,request:s}=e,{passkeys:i}=this.enclaveApiClient,{query:r}=this.vaultClient.queries,n=this.vaultIdToNitroIdFormat(t),o=await(0,I.z)(r({vaultItemTypes:[f.U.Passkey],ids:[t]}));if(!(0,w.d6)(o)||1!==o.data.passkeysResult.items.length)throw new Error("UsePasskeyQuery: no vault item corresponding to the provided id");const a=o.data.passkeysResult.items[0];if(!(0,b.T5)(a))throw new Error("UsePasskeyQuery: passkey is not a cloud passkey");const c=await i.usePasskey({uuid:n,encryptionKey:a.cloudCipheringKey,request:s});if((0,w.hx)(c))switch(c.error.code){case y.r.SECURITY_ERROR:return(0,w.Rn)((0,p.Hn)());case y.r.INVALID_STATE_ERROR:case y.r.PASSKEY_NOT_FOUND:case y.r.PASSKEY_DECRYPTION_ERROR:return(0,w.Rn)((0,p.hl)());case y.r.ALGORITHM_NOT_SUPPORTED_ERROR:return(0,w.Rn)((0,p.qc)());default:return(0,w.Rn)((0,p.QY)())}return this.carbonLegacyClient.commands.updatePasskey({id:t}),c}execute(e){return(0,c.D)(this.usePasskey(e.body))}constructor(e,t,s){this.vaultClient=e,this.carbonLegacyClient=t,this.enclaveApiClient=s}}O=(0,i.gn)([(0,v.e)(A.w),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===C.L?Object:C.L,void 0===m._?Object:m._,void 0===S.l?Object:S.l])],O);class R{}R=(0,i.gn)([(0,n.Y)({api:r.a,handlers:{commands:{},events:{},queries:{registerPasskey:E,usePasskey:O}},imports:[o.X,a.G],providers:[],requiredFeatureFlips:[]})],R)},67206:(e,t,s)=>{s.d(t,{J:()=>L});var i=s(92336),r=s(86006),n=s(85324),o=s(69885),a=s(87065),c=s(60399),d=s(95502),l=s(14122),u=s(13134),p=s(92587),h=s(78346),g=s(93843),m=s(48501),v=s(21543);const y=e=>Object.keys(e).map((t=>[t].concat(e[t]))),S=e=>[...e].sort();var w=s(53385),E=s(39431),I=s(50879);class A{getDashlaneDefinedLinkedWebsites$(e){return(0,o.of)(this._getDashlaneDefinedLinkedWebsites(e)).pipe((0,a.U)(h.Vp))}getDashlaneDefinedLinkedWebsitesByList$(e){return(0,o.of)(this._getDashlaneDefinedLinkedWebsitesByList(e)).pipe((0,a.U)(h.Vp))}constructor(e,t){this.carbonLegacyClient=e,this.vaultItemsCrudClient=t,this.updateLinkedWebsites=async(e,t)=>{const s=await this.getCredentialById(t),i=this.getUserAddedLinkedWebsiteDomains(s),r=[...new Set(e)].filter(Boolean);var n,o;if(o=r,(n=i).length===o.length&&S(n).join("")===S(o).join(""))return;const a=0===r.length?[]:this.mergeLinkedWebsites(s,i,r),c={...s.LinkedServices,associated_domains:a},d=await this.carbonLegacyClient.commands.carbon({name:"updateCredential",args:[{id:t,update:{linkedServices:c}}]});if((0,h.hx)(d))throw new Error("Error when updating linked websites using updateCredential query from Carbon")},this.getCredentialByIdGraphene=e=>(0,c.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[E.U.Credential],ids:[e]}).pipe((0,a.U)((e=>(0,h.d6)(e)&&1===e.data.credentialsResult.matchCount?e.data.credentialsResult.items[0]:null)))),this.populateDashlaneDefinedLinkedWebsitesIndex=e=>{const t={};return e.forEach((e=>{e.forEach((s=>{t[s]=e}))})),t},this.mergeLinkedDomainsIntoList=(e,t)=>{const s=[],i=[];e.forEach((e=>{return r=t,e.some((e=>r.includes(e)))?s.push(e):i.push(e);var r}));const r=s.concat([t]).flat();return i.concat([r])},this.reduceLinkedDomainsLists=(e,t,s)=>e.concat(t,s).reduce(this.mergeLinkedDomainsIntoList,[]),this._getDashlaneDefinedLinkedWebsites=e=>{const t=new u.Y(e).getRootDomain();return t?this.allDashlaneDefinedLinkedWebsitesIndex[t]||[t]:[]},this._getDashlaneDefinedLinkedWebsitesByList=e=>e.map((e=>this._getDashlaneDefinedLinkedWebsites(e))),this.getCredentialById=e=>{const{carbonState:t}=this.carbonLegacyClient.queries;return(0,c.z)(t({path:"userSession.personalData.credentials"}).pipe((0,a.U)((t=>{if(!(0,h.d6)(t)||!(0,w.A)(t.data))throw new Error("Bad credential format");const s=t.data.find((t=>t.Id===e));if(s)return s;throw new Error("Cannot find credential")}))))},this.getUserAddedLinkedWebsiteDomains=e=>e.LinkedServices?.associated_domains?.flatMap((({domain:e})=>Boolean(e)?e:[]))??[],this.getNewLinkedWebsitesToAdd$=(e,t)=>t.filter((t=>!e.includes(t))).map(this.linkedWebsiteFormatter),this.linkedWebsiteFormatter=e=>({domain:e,source:d.k.Manual}),this.mergeLinkedWebsites=(e,t,s)=>[...(e.LinkedServices?.associated_domains??[]).filter((e=>s.includes(e.domain))),...this.getNewLinkedWebsitesToAdd$(t,s)],this.allDashlaneDefinedLinkedWebsitesIndex=this.populateDashlaneDefinedLinkedWebsitesIndex(this.reduceLinkedDomainsLists(g,y(v),y(m)).map((e=>[...new Set(e)])))}}A=(0,i.gn)([(0,p.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===l._?Object:l._,void 0===I.L?Object:I.L])],A);var f=s(82874),b=s(56231);class C{async execute({body:{credentialId:e,linkedWebsite:t}}){const s=await this.repository.getCredentialByIdGraphene(e);if(!s)return(0,h.Rn)((0,b.i6)());if(s.linkedURLs.find((e=>e===t)))return(0,h.Rn)((0,b.lD)());const i=await this.vaultItemsCrudClient.commands.updateVaultItem({vaultItemType:E.U.Credential,id:e,content:{linkedURLs:[...s.linkedURLs,t]}});return(0,h.hx)(i)?(0,h.Rn)((0,b.R6)()):(0,h.Vp)(void 0)}constructor(e,t){this.repository=e,this.vaultItemsCrudClient=t}}C=(0,i.gn)([(0,f.W)(b.vp),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===A?Object:A,void 0===I.L?Object:I.L])],C);var O=s(23425);class R{async execute({body:{credentialId:e,linkedWebsite:t}}){const s=await this.repository.getCredentialByIdGraphene(e);if(!s)return(0,h.Rn)((0,O.W4)());const i=await this.vaultItemsCrudClient.commands.updateVaultItem({vaultItemType:E.U.Credential,id:e,content:{linkedURLs:[...s.linkedURLs.filter((e=>e!==t))]}});return(0,h.hx)(i)?(0,h.Rn)((0,O.cQ)()):(0,h.Vp)(void 0)}constructor(e,t){this.repository=e,this.vaultItemsCrudClient=t}}R=(0,i.gn)([(0,f.W)(O.M7),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===A?Object:A,void 0===I.L?Object:I.L])],R);var T=s(92712);class _{async execute({body:{credentialId:e,updatedLinkedWebsitesList:t}}){try{return await this.linkedWebsites.updateLinkedWebsites(t,e),(0,h.Vp)(void 0)}catch(e){return(0,h.Rn)({tag:"",error:e instanceof Error?e:new Error("Update linked websites command failed")})}}constructor(e){this.linkedWebsites=e}}_=(0,i.gn)([(0,f.W)(T.A),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===A?Object:A])],_);var D=s(46449),F=s(73328);class P{execute({body:{url:e=""}}){return this.linkedWebsites.getDashlaneDefinedLinkedWebsites$(e)}constructor(e){this.linkedWebsites=e}}P=(0,i.gn)([(0,D.e)(F.J),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===A?Object:A])],P);var U=s(34674);class N{execute({body:{urls:e}}){return this.linkedWebsites.getDashlaneDefinedLinkedWebsitesByList$(e)}constructor(e){this.linkedWebsites=e}}N=(0,i.gn)([(0,D.e)(U.E),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===A?Object:A])],N);class L{}L=(0,i.gn)([(0,r.Y)({api:n.G,handlers:{commands:{addLinkedWebsite:C,removeLinkedWebsite:R,updateLinkedWebsites:_},events:{},queries:{getDashlaneDefinedLinkedWebsites:P,getMultipleDashlaneDefinedLinkedWebsites:N}},providers:[A]})],L)},53183:(e,t,s)=>{s.d(t,{r:()=>f});var i=s(92336),r=s(10839),n=s(63433),o=s(86006),a=s(82874),c=s(78346),d=s(1006),l=s(92587),u=s(63144),p=s(56618),h=s(62149),g=s(60018);const m=e=>void 0!==e&&"boolean"==typeof e;class v extends((0,u.Q)({persist:!0,storage:{initialValue:!1,typeGuard:m,schemaVersion:1},scope:h.F.User,storeName:"autofill-disabled-notification",capacity:p.Y._001KB,codec:g.E})){}class y{get autofillDisabledOnLoginsAndFormsNotificationStatus(){return{get$:this._getAutofillDisabledOnLoginsAndFormsNotificationStatus$,set:this._setAutofillDisabledOnLoginsAndFormsNotificationStatus.bind(this)}}get _getAutofillDisabledOnLoginsAndFormsNotificationStatus$(){return this.store.state$}async _setAutofillDisabledOnLoginsAndFormsNotificationStatus(e){try{await this.store.set(e)}catch{throw new Error("SetAutofillDisabledOnLoginsAndFormsNotificationStatus command from autofill-core failed")}}constructor(e){this.store=e}}y=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===v?Object:v])],y);class S{async execute({body:e}){const{status:t}=e;return await this.autofillDisabledNotificationRepository.autofillDisabledOnLoginsAndFormsNotificationStatus.set(t),(0,c.Vp)(void 0)}constructor(e){this.autofillDisabledNotificationRepository=e}}S=(0,i.gn)([(0,a.W)(d.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===y?Object:y])],S);var w=s(87065),E=s(46449),I=s(24584);class A{execute(){return this.repository.autofillDisabledOnLoginsAndFormsNotificationStatus.get$.pipe((0,w.U)(c.Vp))}constructor(e){this.repository=e}}A=(0,i.gn)([(0,E.e)(I.z),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===y?Object:y])],A);class f{}f=(0,i.gn)([(0,o.Y)({api:r._,handlers:{commands:{setAutofillDisabledOnLoginsAndFormsNotificationStatus:S},events:{},queries:{getAutofillDisabledOnLoginsAndFormsNotificationStatus:A}},stores:[v],providers:[y],requiredFeatureFlips:Object.values(n.S)})],f)},39331:(e,t,s)=>{s.d(t,{k:()=>G});var i=s(92336),r=s(56979),n=s(63433),o=s(86006),a=s(82874),c=s(78346),d=s(84471),l=s(60399),u=s(92587),p=s(63144),h=s(56618),g=s(62149),m=s(60018);const v=e=>!!e&&"object"==typeof e&&Object.values(e).every((e=>Array.isArray(e)))&&Object.keys(e).every((e=>"string"==typeof e));class y extends((0,p.Q)({persist:!0,storage:{initialValue:{},typeGuard:v,schemaVersion:1},scope:g.F.User,storeName:"phishing-prevention-optouts",capacity:h.Y._010KB,codec:m.E})){}class S{get phishingPreventionOptOuts(){return{get$:this._getPhishingPreventionOptOuts$,set$:this._setPhishingPreventionOptOut.bind(this)}}async disablePhishingPreventionForUrl(e,t){const s=await(0,l.z)(this._getPhishingPreventionOptOuts$),i={...s,[e]:Array.from(new Set(s[e]??[]).add(t))};await this._setPhishingPreventionOptOut(i)}get _getPhishingPreventionOptOuts$(){return this.store.state$}async _setPhishingPreventionOptOut(e){try{await this.store.set(e)}catch{throw new Error("SetPhishingPreventionOptOut command from autofill-core has failed")}}constructor(e){this.store=e}}S=(0,i.gn)([(0,u.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===y?Object:y])],S);class w{async execute({body:{credentialUrl:e,pasteDestinationUrl:t}}){return await this.phishingPreventionRepository.disablePhishingPreventionForUrl(e,t),(0,c.Vp)(void 0)}constructor(e){this.phishingPreventionRepository=e}}w=(0,i.gn)([(0,a.W)(d.z),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S?Object:S])],w);var E=s(46449),I=s(49739),A=s(87065),f=s(85390),b=s(69885),C=s(14122),O=s(30812),R=s(28216),T=s(53385);class _{getIsVaultItemProtected$(e,t){return this._isVaultItemProtected(e,t).pipe((0,A.U)(c.Vp))}getIsPhishingPreventionEnabled$(){return this._isPhishingPreventionEnabled().pipe((0,A.U)(c.Vp))}constructor(e){this.carbonLegacyClient=e,this.isUserSSO=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.localSettings.premiumStatus"}).pipe((0,A.U)((e=>{if(!(0,c.d6)(e))throw new Error("Cannot retrieve premium status");return e.spaces})),(0,A.U)((e=>e?.[0].isSSOUser??!1)))},this.areProtectedItemsUnlocked=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return(0,f.a)([e({path:"userSession.session.lastMasterPasswordCheck"}),e({path:"userSession.account.login"})]).pipe((0,A.U)((([e,t])=>{if(!(0,c.d6)(e)||"number"!=typeof e.data)throw new Error("Cannot retrieve last master password check");if(!(0,c.d6)(t)||"string"!=typeof t.data)throw new Error("No active login");const s=e.data,i=t.data;return Date.now()-s<(/^kw_test_auto_fmpc_.*/.test(i)?5e3:3e5)})))},this.isItemUnlocked=()=>(0,f.a)([this.areProtectedItemsUnlocked(),this.isUserSSO()]).pipe((0,A.U)((([e,t])=>e||t))),this.isGlobalCredentialProtectionSettingOn=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.personalSettings.ProtectPasswords"}).pipe((0,A.U)((e=>{if(!(0,c.d6)(e)||"boolean"!=typeof e.data)throw new Error("No global setting found");return e.data})))},this.getCredentialProtectionStatus=e=>{const{carbonState:t}=this.carbonLegacyClient.queries;return t({path:"userSession.personalData.credentials"}).pipe((0,A.U)((t=>{if(!(0,c.d6)(t)||!(0,T.A)(t.data))throw new Error("Bad credential format");const s=t.data;return s.find((t=>t.Id===e))?.AutoProtected??!1})))},this.getIsMPRequiredForCreditCardOrSocialSecurityId=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.personalSettings.SecuredDataAutofillCreditcard"}).pipe((0,A.U)((e=>!(0,c.d6)(e)||"boolean"!=typeof e.data||e.data)))},this._isVaultItemProtected=(e,t)=>e===O.k.PaymentCard||e===O.k.SocialSecurityId?(0,f.a)([this.isItemUnlocked(),this.getIsMPRequiredForCreditCardOrSocialSecurityId()]).pipe((0,A.U)((([e,t])=>({disableMode:R.M.CannotDisable,isProtected:t&&!e})))):e===O.k.Credential?(0,f.a)([this.isItemUnlocked(),this.isGlobalCredentialProtectionSettingOn(),this.getCredentialProtectionStatus(t)]).pipe((0,A.U)((([e,t,s])=>t?{disableMode:R.M.DisableGeneralSetting,isProtected:!e}:{disableMode:R.M.DisableSpecificVaultItem,isProtected:s&&!e}))):(0,b.of)({disableMode:R.M.CannotDisable,isProtected:!1}),this._isPhishingPreventionEnabled=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.localSettings.nodePremiumStatus"}).pipe((0,A.U)((e=>{if(!(0,c.d6)(e))throw new Error("Cannot retrieve premium status");const t=e.data;return t.capabilities?.autofillWithPhishingPrevention.enabled??!1})))}}}_=(0,i.gn)([(0,u.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===C._?Object:C._])],_);class D{execute({body:e}){const{vaultItemId:t,vaultType:s}=e;return this.autofillSecurity.getIsVaultItemProtected$(s,t)}constructor(e){this.autofillSecurity=e}}D=(0,i.gn)([(0,E.e)(I.u),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_?Object:_])],D);var F=s(97653);class P{execute(){return this.autofillSecurity.getIsPhishingPreventionEnabled$()}constructor(e){this.autofillSecurity=e}}P=(0,i.gn)([(0,E.e)(F.i),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_?Object:_])],P);var U=s(16743);class N{execute({body:{credentialUrl:e,pasteDestinationUrl:t}}){return this.phishingPreventionRepository.phishingPreventionOptOuts.get$.pipe((0,A.U)((s=>e in s&&(s[e]??[]).includes(t))),(0,A.U)(c.Vp))}constructor(e){this.phishingPreventionRepository=e}}N=(0,i.gn)([(0,E.e)(U.v),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S?Object:S])],N);var L=s(8126);class x{async execute(){const{carbon:e}=this.carbonLegacyClient.commands,t=await e({name:"resetProtectedItemAutofillTimer",args:[]});return(0,c.hx)(t)?(0,c.Rn)({tag:"ResetProtectedItemAutofillTimer command from autofill/security failed"}):(0,c.Vp)(void 0)}constructor(e){this.carbonLegacyClient=e}}x=(0,i.gn)([(0,a.W)(L.y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===C._?Object:C._])],x);class G{}G=(0,i.gn)([(0,o.Y)({api:r.V,handlers:{commands:{resetProtectedItemAutofillTimer:x,disablePhishingPreventionForUrl:w},events:{},queries:{getAutofillProtectionContext:D,isPhishingPreventionCapabilityEnabled:P,isPhishingPreventionDisabledForUrl:N}},stores:[y],providers:[_,S],requiredFeatureFlips:Object.values(n.S)})],G)},53385:(e,t,s)=>{s.d(t,{A:()=>r});var i=s(96500);const r=e=>Array.isArray(e)&&e.every((e=>null!==e&&"object"==typeof e&&"kwType"in e&&(0,i.G)(e)))},75644:(e,t,s)=>{s.d(t,{P:()=>ye});var i=s(92336),r=s(98716),n=s(63433),o=s(86006),a=s(82874),c=s(78346),d=s(62181),l=s(60399),u=s(87065),p=s(97280),h=s(14122),g=s(92587),m=s(34255),v=s(7303);var y=s(53385),S=s(39431);class w{get credentialsPreferences(){return{getByIds:this._getPreferencesForCredentials$.bind(this),set:this._setCredentialPreferences.bind(this)}}get isAutofillDisabled(){return{get$:this._getIsAutofillDisabled$,set:this._setIsAutofillDisabled.bind(this)}}get isAutologinDisabled(){return{get$:this._getIsAutologinDisabled$,set:this._setIsAutologinDisabled.bind(this)}}get disabledDomains(){return{get$:this._getDisabledDomains$,set:this._setDisabledDomains.bind(this),add:this._addDisabledDomains.bind(this),remove:this._removeDisabledDomains.bind(this)}}get disabledSourceTypes(){return{get$:this._getDisabledSourceTypes$,set:this._setDisabledSourceTypes.bind(this),add:this._addDisabledSourceTypes.bind(this),remove:this._removeDisabledSourceTypes.bind(this)}}get isFollowUpNotificationEnabled(){return{get$:this._getIsFollowUpNotificationEnabled$,set:this._setIsFollowUpNotificationEnabled.bind(this)}}async _updateSettings(e){const t=e.isAutofillDisabled??await(0,l.z)(this._getIsAutofillDisabled$),s=e.isAutologinDisabled??await(0,l.z)(this._getIsAutologinDisabled$),i=e.disabledDomains??await(0,l.z)(this._getDisabledDomains$),r=e.disabledSourceTypes??await(0,l.z)(this._getDisabledSourceTypes$),n=e.isFollowUpNotificationEnabled??await(0,l.z)(this._getIsFollowUpNotificationEnabled$),o=await this.carbonLegacyClient.commands.carbon({name:"updateAutofillSettings",args:[{AutofillSettings:{disabledDomains:i,disabledSourceTypes:r,isAutofillDisabled:t,isAutologinDisabled:s,isFollowUpNotificationEnabled:n}}]});if((0,c.hx)(o))throw new Error("Error when updating autofill settings using updateAutofillSettings query from Carbon")}get _getAutofillSettings$(){const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.personalSettings.AutofillSettings"}).pipe((0,u.U)((e=>{if(!(0,c.d6)(e)||!(e=>!!e&&"object"==typeof e&&(0,v.l$)(e,"isAutofillDisabled")&&"boolean"==typeof e.isAutofillDisabled&&(0,v.l$)(e,"isAutologinDisabled")&&"boolean"==typeof e.isAutologinDisabled&&(0,v.l$)(e,"disabledSourceTypes")&&(0,m.rF)(e.disabledSourceTypes)&&(0,v.l$)(e,"disabledDomains")&&Array.isArray(e.disabledDomains)&&e.disabledDomains.every((e=>"string"==typeof e))&&(0,v.l$)(e,"isFollowUpNotificationEnabled")&&"boolean"==typeof e.isFollowUpNotificationEnabled)(e.data))throw new Error("AutofillSettings is not of the expected type");return e.data})),(0,p.d)(1))}async _setCredentialPreferences({credentialId:e,credentialUrl:t,onlyAutofillExactDomain:s,requireMasterPassword:i,useAutoLogin:r,shouldSkipSync:n}){const{carbonLegacyLeeloo:o}=this.carbonLegacyClient.commands,a=await o({name:"savePersonalDataItem",arg:[{kwType:S.U.Credential,origin:"MANUAL",content:{id:e,url:t,onlyForThisSubdomain:s,autoLogin:r,protectWithMasterPassword:i},shouldSkipSync:n}]});if((0,c.hx)(a))throw new Error(`Failed to update credential preferences for: ${e}`)}_getPreferencesForCredentials$(e){const{carbonState:t}=this.carbonLegacyClient.queries;return t({path:"userSession.personalData.credentials"}).pipe((0,u.U)((t=>{if((0,c.hx)(t)||!(0,y.A)(t.data))throw new Error("Bad credentials format when retrieving credential preferences");const s=e.length?t.data.filter((t=>e.includes(t.Id))):t.data;if(e.length&&s.length!==e.length)throw new Error("not able to find one or more credentials corresponding to the provided ids");return(0,c.Vp)(s.map((e=>({id:e.Id,useAutoLogin:Boolean(e.AutoLogin),onlyAutofillExactDomain:Boolean(e.SubdomainOnly),requireMasterPassword:Boolean(e.AutoProtected)}))))})))}get _getIsAutofillDisabled$(){return this._getAutofillSettings$.pipe((0,u.U)((({isAutofillDisabled:e})=>e)))}_setIsAutofillDisabled(e){return this._updateSettings({isAutofillDisabled:e})}get _getIsAutologinDisabled$(){return this._getAutofillSettings$.pipe((0,u.U)((({isAutologinDisabled:e})=>e)))}_setIsAutologinDisabled(e){return this._updateSettings({isAutologinDisabled:e})}_setIsFollowUpNotificationEnabled(e){return this._updateSettings({isFollowUpNotificationEnabled:e})}get _getDisabledDomains$(){return this._getAutofillSettings$.pipe((0,u.U)((({disabledDomains:e})=>e)))}_setDisabledDomains(e){return this._updateSettings({disabledDomains:e})}async _addDisabledDomains(e){const t=await(0,l.z)(this._getDisabledDomains$);return this._setDisabledDomains([...new Set([...t,...e])])}async _removeDisabledDomains(e){const t=await(0,l.z)(this._getDisabledDomains$);return this._setDisabledDomains(t.filter((t=>!e.includes(t))))}get _getDisabledSourceTypes$(){return this._getAutofillSettings$.pipe((0,u.U)((({disabledSourceTypes:e})=>e)))}_setDisabledSourceTypes(e){return this._updateSettings({disabledSourceTypes:e})}async _addDisabledSourceTypes(e){const t=await(0,l.z)(this._getDisabledSourceTypes$);return this._setDisabledSourceTypes([...new Set([...t,...e])])}async _removeDisabledSourceTypes(e){const t=await(0,l.z)(this._getDisabledSourceTypes$);return this._setDisabledSourceTypes(t.filter((t=>!e.includes(t))))}get _getIsFollowUpNotificationEnabled$(){return this._getAutofillSettings$.pipe((0,u.U)((({isFollowUpNotificationEnabled:e})=>e)))}constructor(e){this.carbonLegacyClient=e}}w=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h._?Object:h._])],w);class E{async execute({body:{sourceTypes:e}}){return await this.settings.disabledSourceTypes.add(e),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}E=(0,i.gn)([(0,a.W)(d.g),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],E);var I=s(60355);class A{async execute(){return await this.settings.isAutofillDisabled.set(!0),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}A=(0,i.gn)([(0,a.W)(I.u),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],A);var f=s(64912);class b{async execute(){return await this.settings.disabledSourceTypes.add([...m.up]),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}b=(0,i.gn)([(0,a.W)(f.t),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],b);var C=s(41733);class O{async execute(){return await this.settings.disabledSourceTypes.add([...m.q_]),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}O=(0,i.gn)([(0,a.W)(C.f),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],O);var R=s(56858);class T{async execute(){return await this.settings.isAutologinDisabled.set(!0),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}T=(0,i.gn)([(0,a.W)(R.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],T);var _=s(41908);class D{async execute(){return await this.settings.isFollowUpNotificationEnabled.set(!1),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}D=(0,i.gn)([(0,a.W)(_.y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],D);var F=s(91970);class P{async execute(){return await this.settings.isAutofillDisabled.set(!1),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}P=(0,i.gn)([(0,a.W)(F.c),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],P);var U=s(79798);class N{async execute(){return await this.settings.disabledSourceTypes.remove([...m.up]),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}N=(0,i.gn)([(0,a.W)(U.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],N);var L=s(33898);class x{async execute(){return await this.settings.disabledSourceTypes.remove([...m.q_]),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}x=(0,i.gn)([(0,a.W)(L.I),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],x);var G=s(94702);class k{async execute(){return await this.settings.isAutologinDisabled.set(!1),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}k=(0,i.gn)([(0,a.W)(G.i),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],k);var K=s(3499);class M{async execute(){return await this.settings.isFollowUpNotificationEnabled.set(!0),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}M=(0,i.gn)([(0,a.W)(K.B),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],M);var j=s(76751);class V{async execute({body:{sourceTypes:e}}){return await this.settings.disabledSourceTypes.remove(e),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}V=(0,i.gn)([(0,a.W)(j.v),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],V);var W=s(23187),B=s(4427),z=s(63144),q=s(56618),H=s(62149),Y=s(60018);const Q=e=>!!e&&(0,B.P)(e);class $ extends((0,z.Q)({persist:!0,storage:{initialValue:[],typeGuard:Q,schemaVersion:1},scope:H.F.Device,storeName:"user-autofill-corrections",capacity:q.Y._100KB,codec:Y.E})){}class X{get userAutofillCorrections(){return{get$:this._getUserAutofillCorrections$,set:this._setUserAutofillCorrections.bind(this)}}get _getUserAutofillCorrections$(){return this.store.state$}async _setUserAutofillCorrections(e){try{await this.store.set(e)}catch{throw new Error("SetUserAutofillCorrections command from core-autofill failed")}}constructor(e){this.store=e}}X=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===$?Object:$])],X);class Z{async execute({body:e}){const{corrections:t}=e;return await this.correctionsRepository.userAutofillCorrections.set(t),(0,c.Vp)(void 0)}constructor(e){this.correctionsRepository=e}}Z=(0,i.gn)([(0,a.W)(W.S),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===X?Object:X])],Z);var J=s(18880);class ee{async execute({body:e}){const{isAutofillEnabled:t,url:s}=e,{carbon:i}=this.carbonLegacyClient.commands,r=await i({name:"toggleDashlane",args:[{where:"site",autofill:t,autologin:t,url:s}]});if((0,c.hx)(r))throw new Error("Toggle Dashlane command from core-autofill failed");return(0,c.Vp)(void 0)}constructor(e){this.carbonLegacyClient=e}}ee=(0,i.gn)([(0,a.W)(J.r),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h._?Object:h._])],ee);var te=s(66069);class se{async execute({body:e}){try{return await this.autofillSettings.credentialsPreferences.set(e),(0,c.Vp)(void 0)}catch(e){const t=e instanceof Error?e.message:"unable to update credential preferences";return(0,c.Rn)({tag:"error",errorMessage:t})}}constructor(e){this.autofillSettings=e}}se=(0,i.gn)([(0,a.W)(te.J),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],se);var ie=s(85390),re=s(43978),ne=s(46449),oe=s(13134),ae=s(37233);const ce=e=>{if(!(t=e)||"object"!=typeof t||!(0,v.l$)(t,"status")||"number"!=typeof t.status)throw new Error("twoFactorAuthentication is not of the expected type");var t;return 3===e.status&&e.shouldEnforceTwoFactorAuthentication},de=e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every((e=>"string"==typeof e));class le{execute({body:{url:e}}){const{carbonState:t}=this.carbonLegacyClient.queries,s=new oe.Y(e),i=s.getRootDomain(),r=s.getHost(),n=t({path:"device.killswitch.disableAutofill"}).pipe((0,u.U)((e=>{if(!(0,c.d6)(e)||!(e=>"boolean"==typeof e)(e.data))throw new Error("Error when fetching killswitch.disableAutofill");return e.data}))),o=(0,ie.a)({isAutofillDisabled:this.settings.isAutofillDisabled.get$,disabledDomains:this.settings.disabledDomains.get$}).pipe((0,re.w)((async({isAutofillDisabled:e,disabledDomains:t})=>e||t.includes(await i)))),a=t({path:"userSession.spaceData.spaces"}).pipe((0,re.w)((async e=>{if(!(0,c.d6)(e)||!(e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every((e=>(0,v.l$)(e,"details")&&(0,v.l$)(e.details,"info"))))(e.data))throw new Error("Error when fetching spaceData.spaces");const t=e.data.reduce(((e,t)=>{const s=t.details.info.autologinDomainDisabledArray;return[...e,...de(s)?s:[]]}),[]),s=await r;return t.some((e=>{const t=new oe.Y(e).getHost();return t===s||s.endsWith(`.${t}`)}))}))),d=t({path:"authentication.twoFactorAuthentication"}).pipe((0,u.U)((e=>{if(!(0,c.d6)(e))throw new Error("Error when fetching authentication.twoFactorAuthentication");return ce(e.data)})));return(0,ie.a)({isAutofillDisabledByB2BAdmin:a,isAutofillDisabledByKillswitch:n,isAutofillDisabledByUser:o,isAutofillDisabledBy2FAEnforcement:d}).pipe((0,u.U)((({isAutofillDisabledBy2FAEnforcement:e,isAutofillDisabledByB2BAdmin:t,isAutofillDisabledByKillswitch:s,isAutofillDisabledByUser:i})=>{let r=ae._.ANALYSIS_ENABLED;return s?r=ae._.ANALYSIS_DISABLED_BY_KILLSWITCH:t?r=ae._.ANALYSIS_DISABLED_BY_B2B_ADMIN:i?r=ae._.ANALYSIS_DISABLED_BY_USER:e&&(r=ae._.ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT),(0,c.Vp)({analysisStatus:r})})))}constructor(e,t){this.carbonLegacyClient=e,this.settings=t}}le=(0,i.gn)([(0,ne.e)(ae.h),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h._?Object:h._,void 0===w?Object:w])],le);var ue=s(56226);class pe{execute(){return(0,ie.a)({disabledDomains:this.settings.disabledDomains.get$,disabledSourceTypes:this.settings.disabledSourceTypes.get$,isAutofillDisabled:this.settings.isAutofillDisabled.get$,isAutologinDisabled:this.settings.isAutologinDisabled.get$,isFollowUpNotificationEnabled:this.settings.isFollowUpNotificationEnabled.get$}).pipe((0,u.U)(c.Vp))}constructor(e){this.settings=e}}pe=(0,i.gn)([(0,ne.e)(ue.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],pe);var he=s(50672);class ge{execute(){return this.settings.userAutofillCorrections.get$.pipe((0,u.U)(c.Vp))}constructor(e){this.settings=e}}ge=(0,i.gn)([(0,ne.e)(he.w),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===X?Object:X])],ge);var me=s(50072);class ve{execute({body:{credentialIds:e=[]}}){return this.autofillSettingsRepository.credentialsPreferences.getByIds(e)}constructor(e){this.autofillSettingsRepository=e}}ve=(0,i.gn)([(0,ne.e)(me.g),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],ve);class ye{}ye=(0,i.gn)([(0,o.Y)({api:r.I,handlers:{commands:{toggleDashlane:ee,enableAnalysis:P,enableAutologin:k,enableAutofillOnForms:N,enableAutofillOnLogins:x,enableFollowUpNotification:M,disableAnalysis:A,disableAutologin:T,disableAutofillOnForms:b,disableAutofillOnLogins:O,disableFollowUpNotification:D,addDisabledSourceTypes:E,removeDisabledSourceTypes:V,setUserAutofillCorrections:Z,updateCredentialPreferences:se},events:{},queries:{getAnalysisStatusOnUrl:le,getAutofillSettings:pe,getUserAutofillCorrections:ge,getPreferencesForCredentials:ve}},stores:[$],providers:[w,X],requiredFeatureFlips:Object.values(n.S)})],ye)},33538:(e,t,s)=>{s.d(t,{c:()=>a});var i=s(75958),r=s(44802),n=s(26505),o=s(75628);const a=(0,i.Q)({name:"deviceManagement",commands:{RevokeAuthorisedDeviceCommand:n.hr,RenameAuthorisedDeviceCommand:r.nT},events:{},queries:{ListAuthorisedDeviceQuery:o.p}})},44802:(e,t,s)=>{s.d(t,{nT:()=>n});var i=s(13385),r=s(62149);(0,s(98124).Vj)("RENAME_DEVICE_ERROR","Failed to rename the device");class n extends((0,i.g)({scope:r.F.User})){}},26505:(e,t,s)=>{s.d(t,{hr:()=>n});var i=s(13385),r=s(62149);(0,s(98124).Vj)("REVOKE_DEVICE_ERROR","Failed to revoke the device");class n extends((0,i.g)({scope:r.F.User})){}},75628:(e,t,s)=>{s.d(t,{p:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},81050:(e,t,s)=>{s.d(t,{B:()=>R});var i=s(92336),r=s(33538),n=s(86006),o=s(41511),a=s(62149),c=s(63144),d=s(56618);const l=e=>!e||"object"!=typeof e;class u extends((0,c.Q)({initialValue:[],persist:!1,scope:a.F.User,storeName:"device-management",storeTypeGuard:l,capacity:d.Y._010KB})){}var p=s(26505),h=s(82874),g=s(78346),m=s(60399),v=s(14122),y=s(92587),S=s(53344);class w{async refreshDeviceManagementList(){const e=await(0,m.z)(this.carbonLegacyClient.queries.carbonState({path:"authentication.currentUser.deviceKeys"})),t=await(0,m.z)(this.serverApi.v1.devices.listDevices());if(!(0,g.d6)(t))throw new Error("Unable to retrieve Authorised Devices list: Server call failed");await this.store.set(t.data.data.devices.map((t=>({deviceId:t.deviceId,deviceName:t.deviceName,devicePlatform:t.devicePlatform,creationDate:t.creationDateUnix,lastUpdateDate:t.lastUpdateDateUnix,isCurrentDevice:(0,g.d6)(e)&&e.data.accessKey===t.deviceId}))))}async revokeDevice(e){const t=await this.store.getState(),s=await(0,m.z)(this.serverApi.v1.devices.deactivateDevice({deviceId:e}));if(!(0,g.d6)(s))throw new Error("Failure to revoke device: Server call failed");return await this.store.set(t.filter((t=>t.deviceId!==e))),(0,g.Vp)(void 0)}async renameDevice(e,t){const s=await this.store.getState(),i=await(0,m.z)(this.serverApi.v1.devices.renameDevice({accessKey:e,updatedName:t}));if(!(0,g.d6)(i))throw new Error("Failure to rename device: Server call failed");return await this.store.set(s.map((s=>s.deviceId===e?{...s,deviceName:t}:s))),(0,g.Vp)(void 0)}constructor(e,t,s){this.serverApi=e,this.carbonLegacyClient=t,this.store=s}}w=(0,i.gn)([(0,y.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S.l?Object:S.l,void 0===v._?Object:v._,void 0===u?Object:u])],w);class E{async execute({body:e}){const{deviceId:t}=e,s=await this.deviceManagementService.revokeDevice(t);if((0,g.hx)(s))throw new Error("Failed to revoke device: Server error");return(0,g.Vp)(void 0)}constructor(e){this.deviceManagementService=e}}E=(0,i.gn)([(0,h.W)(p.hr),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],E);var I=s(43978),A=s(75628),f=s(46449);class b{execute(){return this.store.state$.pipe((0,I.w)((async e=>(e.length||await this.deviceManagementService.refreshDeviceManagementList(),(0,g.Vp)(e)))))}constructor(e,t){this.deviceManagementService=e,this.store=t}}b=(0,i.gn)([(0,f.e)(A.p),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w,void 0===u?Object:u])],b);var C=s(44802);class O{async execute({body:e}){const{deviceId:t,updatedName:s}=e,i=await this.deviceManagementService.renameDevice(t,s);if((0,g.hx)(i))throw new Error("Failed to rename device: Server error");return(0,g.Vp)(void 0)}constructor(e){this.deviceManagementService=e}}O=(0,i.gn)([(0,h.W)(C.nT),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],O);class R{}R=(0,i.gn)([(0,n.Y)({api:r.c,imports:[o.n],handlers:{commands:{revokeAuthorisedDevice:E,renameAuthorisedDevice:O},events:{},queries:{listAuthorisedDevice:b}},providers:[w],stores:[u],domainName:"device"})],R)},96023:(e,t,s)=>{s.d(t,{K:()=>a});var i=s(75958),r=s(232),n=s(54154),o=s(84556);const a=(0,i.Q)({name:"teamEnclave",commands:{createTeamInEnclave:r.f},events:{},queries:{getTeamFromEnclave:n.m3,getTeamIdentifiers:o.r}})},25917:(e,t,s)=>{s.d(t,{G:()=>n});var i=s(8260),r=s(96023);class n extends((0,i.E)(r.K)){}(0,i.K)(r.K,n)},232:(e,t,s)=>{s.d(t,{f:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},54154:(e,t,s)=>{s.d(t,{SM:()=>o,m3:()=>a});var i=s(77535),r=s(62149),n=s(98124);const o=(0,n.Vj)("TEAM_NOT_PROVISIONED_IN_ENCLAVE","Team not provisioned in enclave");class a extends((0,i.k)({scope:r.F.User})){}},84556:(e,t,s)=>{s.d(t,{r:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},21483:(e,t,s)=>{s.d(t,{Z:()=>X});var i=s(92336),r=s(86006),n=s(75421),o=s(5206),a=s(19961),c=s(67051),d=s(96023),l=s(20246),u=s(63144),p=s(56618),h=s(62149);const g=e=>null!==e&&"object"==typeof e&&"adminProvisioningKey"in e&&"string"==typeof e.adminProvisioningKey&&"teamUuid"in e&&"string"==typeof e.teamUuid;class m extends((0,u.Q)({persist:!1,scope:h.F.User,storeName:"enclave-team-info",storeTypeGuard:g,initialValue:{adminProvisioningKey:void 0,teamUuid:void 0},capacity:p.Y._001KB})){}var v=s(82874),y=s(232),S=s(76500),w=s(14122),E=s(31108),I=s(78346),A=s(7165),f=s(54591);const b=A.z.object({data:A.z.object({deviceAccessKey:A.z.string(),deviceSecretKey:A.z.string()})}),C=A.z.object({data:A.z.object({devicePrivateKey:A.z.string(),devicePublicKey:A.z.string()})});class O{async execute(){let e;try{const t=await this.getTeamUuid(),s=await this.registerTeamDeviceWithAccount();e=s.deviceAccessKey;const i=await this.enclaveApiClient.teams.createTeam({teamDeviceCredentials:{teamUuid:t,accessKey:s.deviceAccessKey,secretKey:s.deviceSecretKey,sharingPublicKey:s.devicePublicKey,sharingPrivateKey:s.devicePrivateKey}});if((0,I.hx)(i))return i;const{adminProvisioningKey:r}=(0,I.db)(i);return await this.runSideEffects(t,r),(0,I.Vp)(void 0)}catch(t){switch(e&&await this.rollBackTeamCreation(e),t.message){case"TeamIdNotFound":return(0,I.Rn)({tag:"TeamIdNotFound"});case"RegisterTeamDeviceFailed":return(0,I.Rn)({tag:"RegisterTeamDeviceFailed"});default:return(0,I.Rn)({tag:"CreateTeamInEnclaveApiError"})}}}async getTeamUuid(){const{teamUuid:e}=await this.teamInfoStore.getState();if(!e)throw new Error("TeamIdNotFound");return e}async registerTeamDeviceWithAccount(){const e=await(async e=>{const t=await e.commands.registerTeamDevice({platform:f.h.NITRO,deviceName:"Nitro Encryption Service"});if((0,I.hx)(t))return t;const{data:{deviceAccessKey:s,deviceSecretKey:i}}=b.parse((0,I.db)(t)),r=await e.commands.registerTeamDeviceAccount({deviceAccessKey:s,shouldGenerateDeviceKeyPair:!0});if((0,I.hx)(r))return r;const{data:{devicePrivateKey:n,devicePublicKey:o}}=C.parse((0,I.db)(r));return(0,I.Vp)({deviceAccessKey:s,deviceSecretKey:i,devicePrivateKey:n,devicePublicKey:o})})(this.carbonClient);if((0,I.hx)(e))throw new Error("RegisterTeamDeviceFailed");return(0,I.db)(e)}async runSideEffects(e,t){await this.carbonClient.commands.persistAdminProvisioningKey({adminProvisioningKey:t}),await this.teamInfoStore.set({teamUuid:e,adminProvisioningKey:t})}async rollBackTeamCreation(e){await this.carbonClient.commands.deactivateTeamDevice({teamDeviceAccessKey:e})}constructor(e,t,s,i){this.enclaveApiClient=e,this.carbonClient=t,this.teamPlanClient=s,this.teamInfoStore=i}}O=(0,i.gn)([(0,v.W)(y.f),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S.l?Object:S.l,void 0===w._?Object:w._,void 0===E.e?Object:E.e,void 0===m?Object:m])],O);var R=s(85798),T=s(19272),_=s(84895),D=s(71991),F=s(60399),P=s(33312);const U=A.z.object({adminProvisioningKey:A.z.object({adminProvisioningKey:A.z.ostring().nullable(),itemId:A.z.ostring().nullable()}).optional().nullable()});var N=s(89238);const L=A.z.object({enabled:A.z.boolean()}).optional(),x=A.z.object({teamInfo:A.z.object({uuid:A.z.ostring().nullable(),ssoEnabled:A.z.boolean(),ssoIsNitroProvider:A.z.boolean(),ssoServiceProviderUrl:A.z.ostring().nullable(),ssoIdpMetadata:A.z.ostring().nullable(),ssoIdpEntrypoint:A.z.ostring().nullable()}),capabilities:A.z.object({sso:L})}),G=A.z.object({data:x}),k=A.z.object({message:A.z.string(),reason:A.z.nativeEnum(N._V)});class K{async handle(){if(!await this.isUserFullAdminRights())return;const e=await this.getTeamUuid(),t=await this.getAdminProvisioningKey();await this.teamInfoStore.set({teamUuid:e,adminProvisioningKey:t})}async getTeamUuid(){const e=await(async e=>{const{getTeamInfo:t}=e.commands,s=await t();if((0,I.hx)(s))switch(k.parse(s.error).reason){case N._V.UNAUTHORIZED:return(0,I.Rn)({tag:"UserNotAuthorized"});case N._V.UNKNOWN_ERROR:return(0,I.Rn)({tag:"CouldNotGetTeamStatus"});default:throw new Error("An unexpected error happened while trying to retrieve team info")}const{data:{teamInfo:i,capabilities:r}}=G.parse(s.data);return(0,I.Vp)({teamInfo:i,capabilities:r})})(this.carbonClient);if((0,I.hx)(e))throw new Error("[Enclave] - cannot retrieve team Uuid");const{teamInfo:{uuid:t}}=e.data;if(!t)throw new Error("[Enclave] - cannot retrieve team Uuid");return t}async getAdminProvisioningKey(){const e=await(0,F.z)(this.teamPlansClient.queries.getTeamId());if((0,I.hx)(e))throw new Error("[Enclave] - cannot retrieve team info");const t=e.data.teamId??"";return await((e,t)=>{const s=t({path:`userSession.teamAdminData.teams.${e}`}).pipe((0,P.nb)({success:e=>{const t=U.safeParse(e);if(!t.success)throw t.error;return t.data.adminProvisioningKey?.adminProvisioningKey??null},failure:()=>""}));return(0,F.z)(s)})(t,this.carbonClient.queries.carbonState)??void 0}async isUserFullAdminRights(){const e=await(0,F.z)(this.permissionsClient.queries.userPermissions());if((0,I.hx)(e))throw new Error("[Enclave] - Cannot get user permissions");return(0,I.db)(e).includes(T.fp.enum.ALL)}constructor(e,t,s,i){this.teamInfoStore=e,this.carbonClient=t,this.teamPlansClient=s,this.permissionsClient=i}}K=(0,i.gn)([(0,R.b)(_.L),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===m?Object:m,void 0===w._?Object:w._,void 0===E.e?Object:E.e,void 0===D.J?Object:D.J])],K);var M=s(27326);class j{async handle(){const e=await this.teamInfoStore.getState();this.teamInfoStore.set({teamUuid:e.teamUuid,adminProvisioningKey:void 0})}constructor(e){this.teamInfoStore=e}}j=(0,i.gn)([(0,R.b)(M.z),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===m?Object:m])],j);var V=s(43978),W=s(69885),B=s(162),z=s(46449),q=s(54154);class H{execute(){return this.teamInfoStore.state$.pipe((0,V.w)((({teamUuid:e,adminProvisioningKey:t})=>{if(!e)throw new Error("GetTeamFromEnclave: Team UUID is missing");return t?(0,B.D)(this.enclaveApiClient.teams.getTeam({teamUuid:e,adminProvisioningKey:t})):(0,W.of)((0,I.Rn)((0,q.SM)()))})))}constructor(e,t){this.enclaveApiClient=e,this.teamInfoStore=t}}H=(0,i.gn)([(0,z.e)(q.m3),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S.l?Object:S.l,void 0===m?Object:m])],H);var Y=s(84556),Q=s(87065);class ${execute(){return this.teamInfoStore.state$.pipe((0,Q.U)((({teamUuid:e,adminProvisioningKey:t})=>{if(!e)throw new Error("GetTeamIdentifiersQueryHandler: Could not fetch any team identifiers");return(0,I.Vp)({teamUuid:e,adminProvisioningKey:t})})))}constructor(e){this.teamInfoStore=e}}$=(0,i.gn)([(0,z.e)(Y.r),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===m?Object:m])],$);class X{}X=(0,i.gn)([(0,r.Y)({api:d.K,imports:[n.X,o.i,a.G],stores:[m],handlers:{commands:{createTeamInEnclave:O},events:{...(0,r.g)(c.J,{permissionsLoaded:K}),...(0,r.g)(l.y,{confidentialSsoSettingsReset:j})},queries:{getTeamFromEnclave:H,getTeamIdentifiers:$}},domainName:"enclave"})],X)},831:(e,t,s)=>{s.d(t,{J:()=>u});var i=s(75958),r=s(93759),n=s(94921),o=s(9917),a=s(68523),c=s(83822),d=s(43635),l=s(41742);const u=(0,i.Q)({name:"masterPasswordSecurity",commands:{dismissMasterPasswordNotification:r.T,temporaryCheckMasterPassword:n.T,temporaryResetMasterPasswordLeaked:o.j,temporaryCheckMasterPasswordWeak:a.B},events:{},queries:{isMasterPasswordLeaked:c.B,isMasterPasswordWeak:d.D,isMasterPasswordNotificationDismissed:l.F}})},93759:(e,t,s)=>{s.d(t,{T:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},68523:(e,t,s)=>{s.d(t,{B:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},94921:(e,t,s)=>{s.d(t,{T:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},9917:(e,t,s)=>{s.d(t,{j:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},83822:(e,t,s)=>{s.d(t,{B:()=>r});var i=s(77535);class r extends((0,i.k)()){}},41742:(e,t,s)=>{s.d(t,{F:()=>r});var i=s(77535);class r extends((0,i.k)()){}},43635:(e,t,s)=>{s.d(t,{D:()=>r});var i=s(77535);class r extends((0,i.k)()){}},6850:(e,t,s)=>{s.d(t,{f:()=>ie});var i=s(92336),r=s(86006),n=s(831),o=s(40416),a=s(41511),c=s(9176),d=s(62149),l=s(63144),u=s(56618),p=s(60018),h=s(7165);const g=h.z.object({isMasterPasswordLeaked:h.z.boolean(),isMasterPasswordNotificationDismissed:h.z.boolean(),isMasterPasswordWeak:h.z.boolean(),lastCheckTimestamp:h.z.number()}),m=h.z.union([h.z.object({isMasterPasswordLeaked:h.z.boolean(),isMasterPasswordLeakedNotificationDismissed:h.z.boolean(),isMasterPasswordWeak:h.z.boolean(),lastCheckTimestamp:h.z.number()}),g]),v=e=>g.safeParse(e).success,y=e=>m.safeParse(e).success;function S(e){const{content:t,version:s}=e;if(1===s&&y(t))return v(t)?t:{isMasterPasswordWeak:t.isMasterPasswordWeak,isMasterPasswordLeaked:t.isMasterPasswordLeaked,isMasterPasswordNotificationDismissed:t.isMasterPasswordLeakedNotificationDismissed,lastCheckTimestamp:t.lastCheckTimestamp};throw new Error(`Unable to migrate unexpected master-password-security schema version ${s}`)}const w={isMasterPasswordWeak:!1,isMasterPasswordLeaked:!1,isMasterPasswordNotificationDismissed:!1,lastCheckTimestamp:0};class E extends((0,l.Q)({persist:!0,storage:{initialValue:w,typeGuard:v,schemaVersion:2,migrateStorageSchema:S},scope:d.F.User,isCache:!0,storeName:"master-password-security",codec:p.E,capacity:u.Y._001KB})){}var I=s(82874),A=s(78346),f=s(93759);class b{async execute(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordNotificationDismissed:!0}),Promise.resolve((0,A.Vp)(void 0))}constructor(e){this.masterPasswordSecurityStore=e}}b=(0,i.gn)([(0,I.W)(f.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E?Object:E])],b);var C=s(94921),O=s(92587),R=s(53344),T=s(60399),_=s(87065),D=s(30522);class F{shouldBeChecked(){return(0,T.z)(this.masterPasswordSecurityStore.state$.pipe((0,_.U)((e=>!e.isMasterPasswordLeaked&&e.lastCheckTimestamp+864e5<=Date.now()))))}async check(e){const t=await this.passwordHasher.hash(e),s=await(0,T.z)(this.serverApiClient.v1.pwleak.getHashes({hashPrefix:t.substring(0,6)}));if((0,A.hx)(s))throw new Error("Error while retrieving list of hashes for MP checking");const i=s.data.data.includes(t),r=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...r,isMasterPasswordLeaked:i,lastCheckTimestamp:Date.now()})}constructor(e,t,s){this.serverApiClient=e,this.masterPasswordSecurityStore=t,this.passwordHasher=s}}F=(0,i.gn)([(0,O.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===R.l?Object:R.l,void 0===E?Object:E,void 0===D.T?Object:D.T])],F);class P{async reset(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordNotificationDismissed:!1})}constructor(e){this.masterPasswordSecurityStore=e}}P=(0,i.gn)([(0,O.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E?Object:E])],P);var U=s(53932),N=s(5574),L=s(48062);class x{async send(){const{commands:{trackEvent:e}}=this.cqrsClient.getClient(N.Yu),t=await this.masterPasswordSecurityStore.getState();await e({event:new L.AnonymousMasterPasswordHealthReportEvent({isLeaked:t.isMasterPasswordLeaked})})}constructor(e,t){this.masterPasswordSecurityStore=e,this.cqrsClient=t}}x=(0,i.gn)([(0,O.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E?Object:E,void 0===U.w?Object:U.w])],x);class G{async execute({body:e}){return await this.resetMasterPasswordNotification.reset(),await this.checkMasterPasswordService.shouldBeChecked()?(await this.checkMasterPasswordService.check(e.password),this.anonymousMasterPasswordLeakedTrackingEventSender.send(),Promise.resolve((0,A.Vp)(void 0))):Promise.resolve((0,A.Vp)(void 0))}constructor(e,t,s){this.checkMasterPasswordService=e,this.resetMasterPasswordNotification=t,this.anonymousMasterPasswordLeakedTrackingEventSender=s}}G=(0,i.gn)([(0,I.W)(C.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===F?Object:F,void 0===P?Object:P,void 0===x?Object:x])],G);var k=s(9917);class K{async execute(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,lastCheckTimestamp:0,isMasterPasswordLeaked:!1,isMasterPasswordNotificationDismissed:!1}),Promise.resolve((0,A.Vp)(void 0))}constructor(e){this.masterPasswordSecurityStore=e}}K=(0,i.gn)([(0,I.W)(k.j),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E?Object:E])],K);var M=s(68523),j=s(85465);const V=async e=>{if(e)return await(async e=>(await(0,j.evaluate)(e)).score)(e)/25};class W{async check(e){const t=(await V(e)??5)<3,s=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...s,isMasterPasswordWeak:t})}constructor(e){this.masterPasswordSecurityStore=e}}W=(0,i.gn)([(0,O.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E?Object:E])],W);class B{async send(){const{commands:{trackEvent:e}}=this.cqrsClient.getClient(N.Yu),t=await this.masterPasswordSecurityStore.getState();await e({event:new L.AnonymousMasterPasswordHealthReportEvent({isWeak:t.isMasterPasswordWeak})})}constructor(e,t){this.masterPasswordSecurityStore=e,this.cqrsClient=t}}B=(0,i.gn)([(0,O.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E?Object:E,void 0===U.w?Object:U.w])],B);class z{async execute({body:e}){return await this.resetMasterPasswordNotification.reset(),await this.checkMasterPasswordWeakService.check(e.password),this.anonymousMasterPasswordWeakTrackingEventSender.send(),Promise.resolve((0,A.Vp)(void 0))}constructor(e,t,s){this.checkMasterPasswordWeakService=e,this.anonymousMasterPasswordWeakTrackingEventSender=t,this.resetMasterPasswordNotification=s}}z=(0,i.gn)([(0,I.W)(M.B),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===W?Object:W,void 0===B?Object:B,void 0===P?Object:P])],z);var q=s(85798),H=s(66769);class Y{async reset(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordWeak:!1})}constructor(e){this.masterPasswordSecurityStore=e}}Y=(0,i.gn)([(0,O.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E?Object:E])],Y);class Q{handle(){return this.resetMasterPasswordWeak.reset(),Promise.resolve(void 0)}constructor(e){this.resetMasterPasswordWeak=e}}Q=(0,i.gn)([(0,q.b)(H.D),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Y?Object:Y])],Q);var $=s(46449),X=s(83822);class Z{execute(){return this.masterPasswordSecurityStore.state$.pipe((0,_.U)((e=>(0,A.Vp)(e.isMasterPasswordLeaked))))}constructor(e){this.masterPasswordSecurityStore=e}}Z=(0,i.gn)([(0,$.e)(X.B),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E?Object:E])],Z);var J=s(43635);class ee{execute(){return this.masterPasswordSecurityStore.state$.pipe((0,_.U)((e=>(0,A.Vp)(e.isMasterPasswordWeak))))}constructor(e){this.masterPasswordSecurityStore=e}}ee=(0,i.gn)([(0,$.e)(J.D),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E?Object:E])],ee);var te=s(41742);class se{execute(){return this.masterPasswordSecurityStore.state$.pipe((0,_.U)((e=>(0,A.Vp)(e.isMasterPasswordNotificationDismissed))))}constructor(e){this.masterPasswordSecurityStore=e}}se=(0,i.gn)([(0,$.e)(te.F),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E?Object:E])],se);class ie{}ie=(0,i.gn)([(0,r.Y)({api:n.J,handlers:{commands:{dismissMasterPasswordNotification:b,temporaryCheckMasterPassword:G,temporaryResetMasterPasswordLeaked:K,temporaryCheckMasterPasswordWeak:z},events:{...(0,r.g)(c.v,{masterPasswordChanged:Q})},queries:{isMasterPasswordLeaked:Z,isMasterPasswordWeak:ee,isMasterPasswordNotificationDismissed:se}},providers:[F,D.T,P,W,x,B,Y],imports:[o.D,a.n],stores:[E]})],ie)},30522:(e,t,s)=>{s.d(t,{T:()=>c});var i=s(92336),r=s(92587),n=s(71171),o=s(17991),a=s(59503);class c{async hash(e){return(0,o.k)(await this.argon2dDeriver.derive((0,a.u)(e),(0,a.u)("z8CXohryCcGAa7CESNHYnedqbDyp"),{tCost:3,mCost:32768,parallelism:2}))}constructor(e){this.argon2dDeriver=e}}c=(0,i.gn)([(0,r.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===n.y?Object:n.y])],c)},11712:(e,t,s)=>{s.d(t,{B:()=>n});var i=s(75958),r=s(43890);const n=(0,i.Q)({name:"notifications",commands:{},events:{},queries:{GetUserMessagesQuery:r.m}})},43890:(e,t,s)=>{s.d(t,{m:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},32127:(e,t,s)=>{s.d(t,{F:()=>p});var i=s(92336),r=s(86006),n=s(11712),o=s(41511),a=s(46449),c=s(14122),d=s(43890),l=s(33312);class u{execute(){const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.localSettings.userMessages"}).pipe((0,l.Qn)((e=>e)))}constructor(e){this.carbonLegacyClient=e}}u=(0,i.gn)([(0,a.e)(d.m),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===c._?Object:c._])],u);class p{}p=(0,i.gn)([(0,r.Y)({api:n.B,handlers:{commands:{},events:{},queries:{getUserMessages:u}},imports:[o.n],providers:[]})],p)},23765:(e,t,s)=>{s.d(t,{G:()=>i});var i=function(e){return e.OnboardingWebProfileNewUsers="onboarding_web_profileNewUsers_prod",e.OnboardingWebAVGSGForEmployeeOrB2C="onboarding_web_avgsg_for_employee_b2c_dev",e.OnboardingWebConfirmSite="onboarding_web_onboarding",e.OnboardingWebExtensionInstallStaticBanner="onboarding_web_extensionInstallStaticBanner",e.SaexOnboardingHubAddPasswords="saexOnboardingHubAddPasswords",e}({})},47071:(e,t,s)=>{s.d(t,{U:()=>u});var i=s(75958),r=s(46221),n=s(59771),o=s(31867),a=s(50299),c=s(84119),d=s(74779),l=s(55267);const u=(0,i.Q)({name:"getStarted",commands:{dismissGetStarted:r.A,markAdminConsoleOpened:n.T},events:{},queries:{hasAddedMobileOnWeb:o.c,hasCompletedAutofillTutorial:a.G,hasCompletedCredentialTutorial:c.x,hasOpenedAdminConsole:d.s,isGetStartedDismissed:l.A}})},46221:(e,t,s)=>{s.d(t,{A:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},59771:(e,t,s)=>{s.d(t,{T:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},31867:(e,t,s)=>{s.d(t,{c:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},50299:(e,t,s)=>{s.d(t,{G:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},84119:(e,t,s)=>{s.d(t,{x:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},74779:(e,t,s)=>{s.d(t,{s:()=>r});var i=s(77535);class r extends((0,i.k)()){}},55267:(e,t,s)=>{s.d(t,{A:()=>r});var i=s(77535);class r extends((0,i.k)()){}},52862:(e,t,s)=>{s.d(t,{d:()=>c});var i=s(75958),r=s(58985),n=s(30986),o=s(63914),a=s(85183);const c=(0,i.Q)({name:"profileAdmin",commands:{markProfilingFormSeen:r.v,saveAnswer:n.L},events:{},queries:{answers:o.G,hasSeenProfilingForm:a.v}})},58985:(e,t,s)=>{s.d(t,{v:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},30986:(e,t,s)=>{s.d(t,{L:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},63914:(e,t,s)=>{s.d(t,{G:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},85183:(e,t,s)=>{s.d(t,{v:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},55743:(e,t,s)=>{s.d(t,{$:()=>G});var i=s(92336),r=s(86006),n=s(47071),o=s(23765),a=s(62149),c=s(63144),d=s(56618),l=s(60018),u=s(7165);const p=u.z.object({hasOpenedAdminConsole:u.z.boolean(),isGetStartedDismissed:u.z.boolean()}),h=e=>p.safeParse(e).success;class g extends((0,c.Q)({storage:{schemaVersion:1,initialValue:{hasOpenedAdminConsole:!1,isGetStartedDismissed:!1},typeGuard:h},persist:!0,scope:a.F.User,storeName:"onboarding-get-started-store",capacity:d.Y._010KB,codec:l.E})){}var m=s(82874),v=s(78346),y=s(46221);class S{async execute(){const e=await this.store.getState();return await this.store.set({...e,isGetStartedDismissed:!0}),Promise.resolve((0,v.Vp)(void 0))}constructor(e){this.store=e}}S=(0,i.gn)([(0,m.W)(y.A),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===g?Object:g])],S);var w=s(59771);class E{async execute(){const e=await this.store.getState();return await this.store.set({...e,hasOpenedAdminConsole:!0}),Promise.resolve((0,v.Vp)(void 0))}constructor(e){this.store=e}}E=(0,i.gn)([(0,m.W)(w.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===g?Object:g])],E);var I=s(46449),A=s(31867),f=s(92587),b=s(14122),C=s(87065),O=s(6136);class R{get(){return this.carbonLegacyClient.queries.getWebOnboardingMode().pipe((0,C.U)((e=>{if(!(0,v.d6)(e))throw new Error("Error while retrieving the legacy onboarding state");return e.data.completedSteps})))}getAutofillTaskCompletion(){return this.get().pipe((0,C.U)((e=>!!e?.tryAutofillOnWeb)),(0,O.x)(),(0,C.U)(v.Vp))}getCredentialTaskCompletion(){return this.get().pipe((0,C.U)((e=>!!e?.saveCredentialOnWeb)),(0,O.x)(),(0,C.U)(v.Vp))}addMobileTaskCompletion(){return this.get().pipe((0,C.U)((e=>!!e?.addMobileOnWeb)),(0,O.x)(),(0,C.U)(v.Vp))}constructor(e){this.carbonLegacyClient=e}}R=(0,i.gn)([(0,f.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===b._?Object:b._])],R);class T{execute(){return this.onboardingStateGetterService.addMobileTaskCompletion()}constructor(e){this.onboardingStateGetterService=e}}T=(0,i.gn)([(0,I.e)(A.c),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===R?Object:R])],T);var _=s(50299);class D{execute(){return this.onboardingStateGetterService.getAutofillTaskCompletion()}constructor(e){this.onboardingStateGetterService=e}}D=(0,i.gn)([(0,I.e)(_.G),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===R?Object:R])],D);var F=s(84119);class P{execute(){return this.onboardingStateGetterService.getCredentialTaskCompletion()}constructor(e){this.onboardingStateGetterService=e}}P=(0,i.gn)([(0,I.e)(F.x),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===R?Object:R])],P);var U=s(74779);class N{execute(){return this.store.state$.pipe((0,C.U)((e=>(0,v.Vp)(e.hasOpenedAdminConsole))))}constructor(e){this.store=e}}N=(0,i.gn)([(0,I.e)(U.s),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===g?Object:g])],N);var L=s(55267);class x{execute(){return this.store.state$.pipe((0,C.U)((e=>(0,v.Vp)(e.isGetStartedDismissed))))}constructor(e){this.store=e}}x=(0,i.gn)([(0,I.e)(L.A),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===g?Object:g])],x);class G{}G=(0,i.gn)([(0,r.Y)({api:n.U,stores:[g],handlers:{commands:{dismissGetStarted:S,markAdminConsoleOpened:E},events:{},queries:{hasAddedMobileOnWeb:T,hasCompletedAutofillTutorial:D,hasCompletedCredentialTutorial:P,hasOpenedAdminConsole:N,isGetStartedDismissed:x}},providers:[R],requiredFeatureFlips:Object.values(o.G)})],G)},88427:(e,t,s)=>{s.d(t,{y:()=>T});var i=s(92336),r=s(86006),n=s(52862),o=s(23765),a=s(87065),c=s(46449),d=s(78346),l=s(63914),u=s(62149),p=s(63144),h=s(56618),g=s(60018),m=s(7165);const v=m.z.object({questionKey:m.z.string(),completed:m.z.boolean(),selectedAnswers:m.z.array(m.z.string())}),y=m.z.object({hasSeenProfilingForm:m.z.boolean(),answers:m.z.array(v)}),S=e=>y.safeParse(e).success;class w extends((0,p.Q)({persist:!0,capacity:h.Y._010KB,scope:u.F.User,storeName:"profile-admin-store",codec:g.E,storage:{schemaVersion:1,initialValue:{answers:[],hasSeenProfilingForm:!1},typeGuard:S}})){}class E{execute(){return this.profileAdminStore.state$.pipe((0,a.U)((e=>(0,d.Vp)({answers:e.answers}))))}constructor(e){this.profileAdminStore=e}}E=(0,i.gn)([(0,c.e)(l.G),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],E);var I=s(85183);class A{execute(){return this.profileAdminStore.state$.pipe((0,a.U)((e=>(0,d.Vp)({hasSeenProfilingForm:e.hasSeenProfilingForm}))))}constructor(e){this.profileAdminStore=e}}A=(0,i.gn)([(0,c.e)(I.v),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],A);var f=s(82874),b=s(58985);class C{async execute(){const e=await this.profileAdminStore.getState();return this.profileAdminStore.set({...e,hasSeenProfilingForm:!0}),Promise.resolve((0,d.Vp)(void 0))}constructor(e){this.profileAdminStore=e}}C=(0,i.gn)([(0,f.W)(b.v),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],C);var O=s(30986);class R{async execute({body:e}){const t=await this.profileAdminStore.getState(),s=t.answers.findIndex((t=>t.questionKey===e.questionKey));return-1===s?t.answers.push(e):t.answers[s]=e,this.profileAdminStore.set(t),Promise.resolve((0,d.Vp)(void 0))}constructor(e){this.profileAdminStore=e}}R=(0,i.gn)([(0,f.W)(O.L),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===w?Object:w])],R);class T{}T=(0,i.gn)([(0,r.Y)({api:n.d,stores:[w],handlers:{commands:{markProfilingFormSeen:C,saveAnswer:R},events:{},queries:{answers:E,hasSeenProfilingForm:A}},requiredFeatureFlips:Object.values(o.G)})],T)},70366:(e,t,s)=>{s.d(t,{y:()=>c});var i=s(75958),r=s(90141),n=s(84875),o=s(64959),a=s(58390);const c=(0,i.Q)({name:"publicApi",commands:{createPublicApiKeyCommand:r.$R,fetchPublicApiKeysCommand:n.Vj,revokePublicApiKeyCommand:o.rT},events:{},queries:{listPublicApiKeysQuery:a.O}})},90141:(e,t,s)=>{s.d(t,{$R:()=>a,dr:()=>o});var i=s(13385),r=s(62149),n=s(98124);const o=(0,n.Vj)("GENERIC_ERROR","Generic error");class a extends((0,i.g)({scope:r.F.User})){}},84875:(e,t,s)=>{s.d(t,{Vj:()=>a,W0:()=>o});var i=s(13385),r=s(62149),n=s(98124);const o=(0,n.Vj)("GENERIC_ERROR","Generic error");class a extends((0,i.g)({scope:r.F.User})){}},64959:(e,t,s)=>{s.d(t,{Ps:()=>a,YO:()=>c,iO:()=>o,rT:()=>l,zH:()=>d});var i=s(13385),r=s(62149),n=s(98124),o=function(e){return e.PUBLIC_API_KEY_NOT_FOUND="PUBLIC_API_KEY_NOT_FOUND",e.PUBLIC_API_KEY_ALREADY_REVOKED="PUBLIC_API_KEY_ALREADY_REVOKED",e.GENERIC_ERROR="GENERIC_ERROR",e}({});const a=(0,n.Vj)("PUBLIC_API_KEY_ALREADY_REVOKED","Public API Key was already revoked"),c=(0,n.Vj)("PUBLIC_API_KEY_NOT_FOUND","Public API Key was not found"),d=(0,n.Vj)("GENERIC_ERROR","Generic error");class l extends((0,i.g)({scope:r.F.User})){}},58390:(e,t,s)=>{s.d(t,{O:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User,useCache:!0})){}},38021:(e,t,s)=>{s.d(t,{M:()=>C});var i=s(92336),r=s(86006),n=s(70366),o=s(41511),a=s(63144),c=s(56618),d=s(62149);class l extends((0,a.Q)({persist:!1,scope:d.F.User,storeName:"public-api-keys",initialValue:void 0,capacity:c.Y._010KB})){}var u=s(82874),p=s(53344),h=s(78346),g=s(90141),m=s(60399);class v{async execute({body:{description:e}}){const t=await(0,m.z)(this.serverApiClient.v1.partners.createPublicApiKey({description:e,origin:"server_standalone"}));if((0,h.hx)(t))return(0,h.Rn)((0,g.dr)());const{data:{accessKey:s,secretKey:i}}=(0,h.db)(t);return(0,h.Vp)({id:`${s}-${i}`})}constructor(e){this.serverApiClient=e}}v=(0,i.gn)([(0,u.W)(g.$R),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.l?Object:p.l])],v);var y=s(84875);class S{async execute(){const e=await(0,m.z)(this.serverApiClient.v1.partners.listPublicApiKeys().pipe());if((0,h.hx)(e))return(0,h.Rn)((0,y.W0)());const{data:{publicAPIKeys:t}}=(0,h.db)(e);return this.publicApiKeysStore.set(t),(0,h.Vp)(void 0)}constructor(e,t){this.serverApiClient=e,this.publicApiKeysStore=t}}S=(0,i.gn)([(0,u.W)(y.Vj),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.l?Object:p.l,void 0===l?Object:l])],S);var w=s(64959);class E{async execute({body:e}){const t=await(0,m.z)(this.serverApiClient.v1.partners.revokePublicApiKey(e));if((0,h.hx)(t))switch(t.error.message){case w.iO.PUBLIC_API_KEY_ALREADY_REVOKED:return(0,h.Rn)((0,w.Ps)());case w.iO.PUBLIC_API_KEY_NOT_FOUND:return(0,h.Rn)((0,w.YO)());default:return(0,h.Rn)((0,w.zH)())}return this.publicApiKeysStore.getState().then(((t=[])=>{this.publicApiKeysStore.set(t.filter((t=>t.accessKey===e.accessKey)))})),(0,h.Vp)(void 0)}constructor(e,t){this.serverApiClient=e,this.publicApiKeysStore=t}}E=(0,i.gn)([(0,u.W)(w.rT),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.l?Object:p.l,void 0===l?Object:l])],E);var I=s(46449),A=s(58390),f=s(87065);class b{execute(){return this.publicApiKeysStore.state$.pipe((0,f.U)(((e=[])=>(0,h.Vp)(e))))}constructor(e){this.publicApiKeysStore=e}}b=(0,i.gn)([(0,I.e)(A.O),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===l?Object:l])],b);class C{}C=(0,i.gn)([(0,r.Y)({api:n.y,handlers:{commands:{createPublicApiKey:v,fetchPublicApiKeys:S,revokePublicApiKey:E},events:{},queries:{listPublicApiKeys:b}},imports:[o.n],stores:[l],domainName:"partner-api"})],C)},25593:(e,t,s)=>{s.d(t,{J:()=>o});var i=s(75958),r=s(3100),n=s(17308);const o=(0,i.Q)({name:"antiphishing",commands:{addAutoRedirectedDomain:r.A},events:{},queries:{isAutoRedirectedDomain:n.U}})},3100:(e,t,s)=>{s.d(t,{A:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},17308:(e,t,s)=>{s.d(t,{U:()=>r});var i=s(77535);class r extends((0,i.k)()){}},66706:(e,t,s)=>{s.d(t,{H:()=>c});var i=s(75958),r=s(87425),n=s(29362),o=s(60466),a=s(5202);const c=(0,i.Q)({name:"breaches",commands:{dismissBreach:r.n,markBreachAsSeen:n.Q},events:{},queries:{breach:o.i,unreadBreachesCount:a.L}})},71926:(e,t,s)=>{s.d(t,{J:()=>i});var i=function(e){return e.PENDING="PENDING",e.VIEWED="VIEWED",e.ACKNOWLEDGED="ACKNOWLEDGED",e}({})},87425:(e,t,s)=>{s.d(t,{n:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},29362:(e,t,s)=>{s.d(t,{Q:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},60466:(e,t,s)=>{s.d(t,{i:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},5202:(e,t,s)=>{s.d(t,{L:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},36282:(e,t,s)=>{s.d(t,{M:()=>d});var i=s(75958),r=s(92452),n=s(11959),o=s(49590),a=s(27655),c=s(43473);const d=(0,i.Q)({name:"emailMonitoring",commands:{dismissOnboardingNotification:r.n,optinEmail:n.P5,optoutEmail:o.Lc},events:{},queries:{emailList:a.dB,onboardingNotificationState:c.p}})},92452:(e,t,s)=>{s.d(t,{n:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},11959:(e,t,s)=>{s.d(t,{Dq:()=>o,Iy:()=>c,P5:()=>p,Qj:()=>l,XX:()=>a,pK:()=>d,tp:()=>u});var i=s(13385),r=s(62149),n=s(98124);const o="OK";var a=function(e){return e.INVALID_EMAIL="EMAIL_IS_INVALID",e.ALREADY_SUBSCRIBED="USER_HAS_ALREADY_AN_ACTIVE_SUBSCRIPTION",e.TOO_MANY_SUBSCRIPTIONS="USER_HAS_TOO_MANY_SUBSCRIPTIONS",e.GENERIC_ERROR="GENERIC_ERROR",e}({});const c=(0,n.Vj)("EMAIL_IS_INVALID",""),d=(0,n.Vj)("USER_HAS_ALREADY_AN_ACTIVE_SUBSCRIPTION",""),l=(0,n.Vj)("USER_HAS_TOO_MANY_SUBSCRIPTIONS",""),u=(0,n.Vj)("GENERIC_ERROR","");class p extends((0,i.g)({scope:r.F.User})){}},49590:(e,t,s)=>{s.d(t,{KP:()=>a,Lc:()=>u,QS:()=>o,h1:()=>d,uD:()=>c,v4:()=>l});var i=s(13385),r=s(62149),n=s(98124);const o="OK";var a=function(e){return e.INVALID_EMAIL="EMAIL_IS_INVALID",e.NO_SUBSCRIPTION="USER_HAS_NO_SUBSCRIPTION",e.GENERIC_ERROR="GENERIC_ERROR",e}({});class c extends((0,n.Hu)("EMAIL_IS_INVALID","")){}class d extends((0,n.Hu)("USER_HAS_NO_SUBSCRIPTION","")){}class l extends((0,n.Hu)("GENERIC_ERROR","")){}class u extends((0,i.g)({scope:r.F.User})){}},27655:(e,t,s)=>{s.d(t,{a2:()=>n,dB:()=>o,wp:()=>r});var i=s(77535),r=function(e){return e.PENDING="pending",e.ACTIVE="active",e.DISABLED="disabled",e}({});function n(e){return"pending"===e||"active"===e||"disabled"===e}class o extends((0,i.k)()){}},43473:(e,t,s)=>{s.d(t,{p:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},6538:(e,t,s)=>{s.d(t,{i:()=>a});var i=s(75958),r=s(34621),n=s(85869),o=s(81721);const a=(0,i.Q)({name:"otp",commands:{setupOtpCodeForCredential:r.z},events:{},queries:{otpCode:n.J,otpCodeForSecretOrUrl:o.S}})},34621:(e,t,s)=>{s.d(t,{z:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},85869:(e,t,s)=>{s.d(t,{J:()=>a,c:()=>o});var i=s(77535),r=s(62149),n=s(98124);class o extends((0,n.Hu)("Cannot generate OTP code due to no OtpSecret or OtpUrl found for credential","")){}class a extends((0,i.k)({scope:r.F.User})){}},81721:(e,t,s)=>{s.d(t,{S:()=>a,k:()=>o});var i=s(77535),r=s(62149),n=s(98124);class o extends((0,n.Hu)("Cannot generate OTP code for secret or url","")){}class a extends((0,i.k)({scope:r.F.User})){}},68754:(e,t,s)=>{s.d(t,{d:()=>w});var i=s(75958),r=s(45101),n=s(52835),o=s(90797),a=s(52586),c=s(33844),d=s(94388),l=s(17430),u=s(22231),p=s(44955),h=s(25374),g=s(35642),m=s(69134),v=s(61613),y=s(94449),S=s(9853);const w=(0,i.Q)({name:"passwordHealth",commands:{updateIsCredentialExcluded:r.v,recalculatePasswordHealth:n.t,updateHealthState:o.V,uploadUVVS:a.Yf,exportUVVS:c.E},events:{passwordHealthComputationFinished:d.w},queries:{credentialHealthData:l.w,filterCredentials:u.Q,filterCredentialsIds:p.M,score:h.e,compromisedCredentials:g.v,compromisedCredentialsIdsForBreach:m.A,passwordHealthReport:v.b,scoreForPassword:y.c,downloadUVVS:S.Up}})},45101:(e,t,s)=>{s.d(t,{v:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},33844:(e,t,s)=>{s.d(t,{E:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},52835:(e,t,s)=>{s.d(t,{t:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},90797:(e,t,s)=>{s.d(t,{V:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},52586:(e,t,s)=>{s.d(t,{Yf:()=>c,m0:()=>a});var i=s(13385),r=s(62149),n=s(98124);const o=Object.freeze({REQUEST_MALFORMED:"REQUEST_MALFORMED"}),a=(0,n.Vj)(o.REQUEST_MALFORMED,"Request is malformed.");class c extends((0,i.g)({scope:r.F.User})){}},94388:(e,t,s)=>{s.d(t,{w:()=>n});var i=s(446),r=s(62149);class n extends((0,i.d)({scope:r.F.User})){}},37109:(e,t,s)=>{s.d(t,{L:()=>n});var i=s(8260),r=s(68754);class n extends((0,i.E)(r.d)){}(0,i.K)(r.d,n)},69134:(e,t,s)=>{s.d(t,{A:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},35642:(e,t,s)=>{s.d(t,{v:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},17430:(e,t,s)=>{s.d(t,{w:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},9853:(e,t,s)=>{s.d(t,{Mw:()=>o,Up:()=>c,iQ:()=>a});var i=s(77535),r=s(62149),n=s(98124);const o=(0,n.Vj)("snapshot-not-found","No snapshot found for this user."),a=(0,n.Vj)("snapshot-malformed","The snapshot has an unexpected form.");class c extends((0,i.k)({scope:r.F.User})){}},44955:(e,t,s)=>{s.d(t,{M:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},22231:(e,t,s)=>{s.d(t,{Q:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},61613:(e,t,s)=>{s.d(t,{b:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},94449:(e,t,s)=>{s.d(t,{c:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},25374:(e,t,s)=>{s.d(t,{e:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},97203:(e,t,s)=>{s.d(t,{f:()=>i});const i=(0,s(75958).Q)({name:"vaultReport",commands:{},events:{},queries:{}})},53195:(e,t,s)=>{s.d(t,{v:()=>A});var i=s(92336),r=s(86006),n=s(25593),o=s(62149),a=s(63144),c=s(56618),d=s(60018),l=s(7165);const u=l.z.object({autoredirection:l.z.record(l.z.boolean())}),p=e=>u.safeParse(e).success;class h extends((0,a.Q)({persist:!0,storage:{initialValue:{autoredirection:{}},typeGuard:p,schemaVersion:1},scope:o.F.Device,storeName:"antiphishing",codec:d.E,capacity:c.Y._001KB})){}var g=s(82874),m=s(78346),v=s(3100);class y{async execute({body:e}){const{domain:t}=e;if(t){const e=await this.antiphishingStore.getState();await this.antiphishingStore.set({...e,autoredirection:{...e.autoredirection,[t]:!0}})}return Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.antiphishingStore=e}}y=(0,i.gn)([(0,g.W)(v.A),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h?Object:h])],y);var S=s(46449),w=s(17308),E=s(87065);class I{execute({body:e}){return this.antiphishingStore.state$.pipe((0,E.U)((t=>(0,m.Vp)(!!e.domain&&!!t.autoredirection[e.domain]))))}constructor(e){this.antiphishingStore=e}}I=(0,i.gn)([(0,S.e)(w.U),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h?Object:h])],I);class A{}A=(0,i.gn)([(0,r.Y)({api:n.J,handlers:{commands:{addAutoRedirectedDomain:y},events:{},queries:{isAutoRedirectedDomain:I}},stores:[h]})],A)},99002:(e,t,s)=>{s.d(t,{b:()=>n});const i=e=>void 0===e||"string"==typeof e,r=e=>void 0===e||"number"==typeof e,n=e=>{if(!e||!Array.isArray(e))return!1;if(0===e.length)return!0;const t=e[0];return"string"==typeof t.Id&&r(t.LastBackupTime)&&i(t.kwType)&&i(t.BreachId)&&r(t.ContentRevision)}},89315:(e,t,s)=>{s.d(t,{T:()=>c,l:()=>a});var i=s(71926),r=s(70942);const n=({name:e,domains:t})=>{if(e)return e;if(t.length>0){const[e]=t;return e}return""},o=e=>(0,r.Tc)(e)?"private":"public",a=e=>[...e.reduce(((e,t)=>{const s=e.get(t.BreachId);return(!s||s.LastBackupTime&&t.LastBackupTime&&s.LastBackupTime<t.LastBackupTime)&&e.set(t.BreachId,t),e}),new Map).values()],c=(e,t)=>{const s=a(e.filter(r.rY)).find((e=>e.Id===t));if(!s)throw new Error("Breach not found");return(e=>{const t=e.Content,s=(0,r.Tc)(e)?e.Content.impactedEmails:[];return{breachId:e.BreachId,breachType:o(e),domains:t.domains,eventDate:t.eventDate,id:e.Id,impactedEmails:s,kwType:e.kwType??"KWSecurityBreach",leakedData:t.leakedData??[],leakedPasswords:e.LeakedPasswords??[],name:n(t),status:e.Status??i.J.PENDING}})(s)}},70942:(e,t,s)=>{s.d(t,{F7:()=>o,Tc:()=>a,rY:()=>n});const i=e=>"object"==typeof e,r=e=>(e=>i(e)&&"breachModelVersion"in e&&"number"==typeof e.breachModelVersion)(e)&&1===e.breachModelVersion&&"domains"in e&&Array.isArray(e.domains)&&"eventDate"in e&&"string"==typeof e.eventDate&&"id"in e&&"string"==typeof e.id,n=e=>{return i(t=e)&&"kwType"in t&&"string"==typeof t.kwType&&"KWSecurityBreach"===t.kwType&&r(e.Content);var t},o=e=>(e=>{const t=e;return"impactedEmails"in t&&Array.isArray(t.impactedEmails)})(e)&&e.impactedEmails.length>0,a=e=>n(e)&&o(e.Content)},24981:(e,t,s)=>{s.d(t,{t:()=>b});var i=s(92336),r=s(86006),n=s(66706),o=s(82874),a=s(78346),c=s(71926),d=s(87425),l=s(14122);class u{async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacyClient;return await t({name:"updateBreachStatus",args:[{id:e.id,status:c.J.ACKNOWLEDGED}]}),Promise.resolve((0,a.Vp)(void 0))}constructor(e){this.carbonLegacyClient=e}}u=(0,i.gn)([(0,o.W)(d.n),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===l._?Object:l._])],u);var p=s(29362);class h{async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacyClient;return await t({name:"updateBreachStatus",args:[{id:e.id,status:c.J.VIEWED}]}),Promise.resolve((0,a.Vp)(void 0))}constructor(e){this.carbonLegacyClient=e}}h=(0,i.gn)([(0,o.W)(p.Q),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===l._?Object:l._])],h);var g=s(33312),m=s(46449),v=s(60466),y=s(89315),S=s(99002);class w{execute({body:e}){const{id:t}=e,{queries:{carbonState:s}}=this.carbonLegacyClient;return s({path:"userSession.personalData.securityBreaches"}).pipe((0,g.Qn)((e=>{if(!(0,S.b)(e))throw new Error("Bad Breaches format");return e})),(0,g.Qn)((e=>(0,y.T)(e,t))))}constructor(e){this.carbonLegacyClient=e}}w=(0,i.gn)([(0,m.e)(v.i),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===l._?Object:l._])],w);var E=s(87065),I=s(5202),A=s(70942);class f{execute(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.personalData.securityBreaches"}).pipe((0,g.Qn)((e=>{if(!(0,S.b)(e))throw new Error("Bad Breaches format");return e})),(0,E.U)((e=>{if((0,a.hx)(e))throw new Error("Error while fetching data");const t=(0,y.l)(e.data.filter(A.rY)).filter((e=>e.Status===c.J.PENDING&&(0,A.Tc)(e)));return(0,a.Vp)({count:t.length})})))}constructor(e){this.carbonLegacyClient=e}}f=(0,i.gn)([(0,m.e)(I.L),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===l._?Object:l._])],f);class b{}b=(0,i.gn)([(0,r.Y)({api:n.H,handlers:{commands:{dismissBreach:u,markBreachAsSeen:h},events:{},queries:{breach:w,unreadBreachesCount:f}}})],b)},41892:(e,t,s)=>{s.d(t,{S:()=>K});var i=s(92336),r=s(86006),n=s(36282),o=s(62149),a=s(63144),c=function(e){return e.UNKNOWN="UNKNOWN",e.SEEN="SEEN",e.NOT_SEEN="NOT_SEEN",e}({});var d=s(60018);const l=e=>(e=>!(!e||"object"!=typeof e)&&"onboardingStatus"in e&&"emails"in e)(e)&&function(e){return"UNKNOWN"===e||"SEEN"===e||"NOT_SEEN"===e}(e.onboardingStatus)&&Array.isArray(e.emails);class u extends((0,a.Q)({persist:!0,storage:{schemaVersion:1,initialValue:{onboardingStatus:c.NOT_SEEN,emails:[]},typeGuard:l},scope:o.F.User,storeName:"email-monitoring-state",storeTypeGuard:l,codec:d.E,isCache:!0})){}var p=s(11959),h=s(27655),g=s(82874),m=s(33312),v=s(78346),y=s(53344),S=s(60399),w=s(82567);class E{async execute({body:{email:e}}){return await(0,S.z)(this.serverApiClient.v1.darkwebmonitoring.registerEmail({email:e}).pipe((0,m.DZ)((e=>{throw new Error(e.message)})),(0,m.lk)((e=>e.data.result===p.Dq?(0,v.Vp)(void 0):(0,v.Rn)((e=>{switch(e){case p.XX.INVALID_EMAIL:return(0,p.Iy)();case p.XX.ALREADY_SUBSCRIBED:return(0,p.pK)();case p.XX.TOO_MANY_SUBSCRIPTIONS:return(0,p.Qj)();default:return(0,p.tp)()}})(e.data.result)))),(0,w.b)((async t=>{(0,v.d6)(t)&&await this.store.update((t=>({...t,emails:[...t.emails,{email:e,state:h.wp.PENDING}]})))}))))}constructor(e,t){this.serverApiClient=e,this.store=t}}E=(0,i.gn)([(0,g.W)(p.P5),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===y.l?Object:y.l,void 0===u?Object:u])],E);var I=s(41511),A=s(49590);class f{async execute({body:{email:e}}){return await(0,S.z)(this.serverApiClient.v1.darkwebmonitoring.deregisterEmail({email:e}).pipe((0,m.DZ)((e=>{throw new Error(e.message)})),(0,m.lk)((e=>e.data.result===A.QS?(0,v.Vp)(void 0):(0,v.Rn)(this.getFunctionalError(e.data.result)))),(0,w.b)((async t=>{(0,v.d6)(t)&&await this.store.update((t=>({...t,emails:[...t.emails.filter((t=>t.email!==e))]})))}))))}constructor(e,t){this.serverApiClient=e,this.store=t,this.getFunctionalError=e=>{switch(e){case A.KP.NO_SUBSCRIPTION:return new A.h1;case A.KP.INVALID_EMAIL:return new A.uD;case A.KP.GENERIC_ERROR:default:return new A.v4}}}}f=(0,i.gn)([(0,g.W)(A.Lc),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===y.l?Object:y.l,void 0===u?Object:u])],f);var b=s(92452),C=s(92587);function O(e){return{...e,onboardingStatus:c.SEEN}}class R{async execute(){await this.store.update(O)}constructor(e){this.store=e}}R=(0,i.gn)([(0,C.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===u?Object:u])],R);class T{async execute(){return await this.dismissOnboardingNotificationService.execute(),Promise.resolve((0,v.Vp)(void 0))}constructor(e){this.dismissOnboardingNotificationService=e}}T=(0,i.gn)([(0,g.W)(b.n),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===R?Object:R])],T);var _=s(87065),D=s(6136),F=s(43978),P=s(90171),U=s(69885),N=s(46449);class L{constructor(e,t){this.serverApiClient=e,this.store=t,this.execute=()=>{this.serverApiClient.v1.darkwebmonitoring.listRegistrations({}).pipe((0,m.Qn)((({data:e})=>e.emails.map((e=>({email:e.email,state:(0,h.a2)(e.state)?e.state:h.wp.PENDING}))))),(0,m.Qn)((e=>{this.store.update((t=>({...t,emails:e})))})),(0,m.DZ)((e=>{throw e}))).subscribe()}}}L=(0,i.gn)([(0,C.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===y.l?Object:y.l,void 0===u?Object:u])],L);class x{execute(){this.syncMonitoredEmails.execute();return this.store.state$.pipe((0,_.U)((e=>e.emails)),(0,D.x)(((e,t)=>JSON.stringify(e)===JSON.stringify(t))),(0,_.U)((e=>(0,v.Vp)(e)))).pipe((0,F.w)((e=>{const t=()=>(this.syncMonitoredEmails.execute(),e),s=e=>(0,P.H)(0,e).pipe((0,F.w)((()=>(0,U.of)(t()))));return(0,v.hx)(e)||e.data.some((e=>e.state===h.wp.PENDING))?s(3e4):(0,U.of)(e)})))}constructor(e,t){this.syncMonitoredEmails=e,this.store=t}}x=(0,i.gn)([(0,N.e)(h.dB),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===L?Object:L,void 0===u?Object:u])],x);var G=s(43473);class k{execute(){return this.store.state$.pipe((0,_.U)((e=>e.onboardingStatus)),(0,D.x)(),(0,_.U)(v.Vp))}constructor(e){this.store=e}}k=(0,i.gn)([(0,N.e)(G.p),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===u?Object:u])],k);class K{}K=(0,i.gn)([(0,r.Y)({api:n.M,stores:[u],handlers:{commands:{dismissOnboardingNotification:T,optinEmail:E,optoutEmail:f},events:{},queries:{emailList:x,onboardingNotificationState:k}},imports:[I.n],providers:[R,L]})],K)},72481:(e,t,s)=>{s.d(t,{f:()=>z});var i=s(92336),r=s(86006),n=s(6538),o=s(87065),a=s(14122),c=s(92587),d=s(33312),l=s(78346);const u=e=>void 0===e||"string"==typeof e;class p{getById(e){const{queries:{carbonState:t}}=this.carbonLegacyClient;return t({path:"state.userSession.personalData.credentials"}).pipe((0,d.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&u(t.OtpSecret)&&u(t.OtpUrl)}))))(e))throw new Error("Bad credential format");return e})),(0,o.U)((t=>{if((0,l.hx)(t))return(0,l.Vp)(null);const s=t.data.reduce(((t,s)=>s.Id===e?{Id:s.Id,OtpSecret:s.OtpSecret,OtpUrl:s.OtpUrl}:t),null);return(0,l.Vp)(s)})))}constructor(e){this.carbonLegacyClient=e}}p=(0,i.gn)([(0,c.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._])],p);var h=s(46449),g=s(81721),m=function(e){return e.SHA1="SHA-1",e.SHA256="SHA-256",e.SHA384="SHA-384",e.SHA512="SHA-512",e}({});const v=["totp","hotp"],y=e=>{const t=new URL(e),s=(e=>{const t=e.hostname?e.hostname:/\/\/([th]otp)\//.exec(e.pathname)?.[1]??"";return v.includes(t)?t:null})(t),i=t.searchParams.get("secret")?.toUpperCase();if(!s||!i)throw new Error("Corrupted OTP url");const r=t.searchParams.get("digits"),n=t.searchParams.get("counter"),o=t.searchParams.get("period"),a=t.searchParams.get("algorithm");return{secret:i,algorithm:a?m[a]:m.SHA1,counter:n?Number.parseInt(n,10):0,digits:r?Number.parseInt(r,10):6,period:o?Number.parseInt(o,10):30}},S=e=>({secret:e.toUpperCase(),algorithm:m.SHA1,counter:0,digits:6,period:30}),w=e=>{try{return y(e)}catch{return S(e)}},E=e=>{const{secret:t,algorithm:s,digits:i,period:r}=e;return`otpauth://totp/?secret=${t.toLowerCase()}&algorithm=${s.toUpperCase().replace("-","")}&digits=${i}&period=${r}&lock=false`};var I=s(90171),A=s(41842),f=s(43978),b=s(81929);var C=s(57003),O=s(82565);const R=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9],T=async(e,t,s)=>{const i=(e=>{const t=new Uint8Array(e),s=15&t[t.length-1],i=t.slice(s,s+4).reduce(((e,t)=>e.concat(t.toString(16).toString().padStart(2,"0"))),"");return 2147483647&Number.parseInt(i,16)})(await e((0,O.n)(t)));return(i%(s<=9?R[s]:Math.pow(10,s))).toString().padStart(s,"0")};class _{async computeOtpCode({counter:e,digits:t,period:s}){const i=this.getStep(e,s);return await T(this.signer,i,t)}constructor(e,t){this.signer=e,this.getStep=t}}class D{createCodeGenerator({secret:e,algorithm:t}){try{const s=(0,C.K)(e);return new _((e=>this.hmacSigner.sign(s,e,t)),this.getStep)}catch(e){return null}}getNextOtpRefreshTimestamp(e,t){if(e)return(e=>{const t=1e3*e,s=Math.floor(Date.now()/t)*t;return new Date(s+t).getTime()})(t);throw new Error("Not supported for non time based OTP type")}constructor(e){this.hmacSigner=e}}class F extends D{getStep(e,t){return((e,t)=>Math.floor(e/t))(e||(new Date).getTime(),1e3*t)}constructor(e){super(e)}}F=(0,i.gn)([(0,c.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===b.q?Object:b.q])],F);class P{async withGeneratedCodeAndValidity(e,t){try{const s=await t.computeOtpCode(e),i=this.otpGeneratorService.getNextOtpRefreshTimestamp(!0,e.period);return(0,l.Vp)({code:s,validityEndDate:i,validityTime:1e3*e.period,url:E(e)})}catch{return(0,l.Rn)(void 0)}}otpCodes$(e,t){return(0,I.H)(0,1e3).pipe((0,A.h)((t=>{if(0===t)return!0;return((e,t)=>e-Date.now()>=1e3*t-1e3)(this.otpGeneratorService.getNextOtpRefreshTimestamp(!0,e.period),e.period)})),(0,f.w)((()=>this.withGeneratedCodeAndValidity(e,t))))}constructor(e){this.otpGeneratorService=e}}P=(0,i.gn)([(0,c.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===F?Object:F])],P);var U=s(69885);class N{execute({body:e}){const{secretOrUrl:t}=e;if(!t)return(0,U.of)((0,l.Rn)(new g.k));const s=w(t.replaceAll(" ","")),i=this.otpGeneratorService.createCodeGenerator(s);return null===i?(0,U.of)((0,l.Rn)(new g.k)):this.otpCodeService.otpCodes$(s,i).pipe((0,d.DZ)((()=>new g.k)))}constructor(e,t){this.otpGeneratorService=e,this.otpCodeService=t}}N=(0,i.gn)([(0,h.e)(g.S),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===F?Object:F,void 0===P?Object:P])],N);var L=s(82874),x=s(34621),G=s(39431),k=s(50879);class K{async execute({body:e}){const{updateVaultItem:t}=this.vaultCrudClient.commands,{credentialId:s,otpUrl:i}=e;return await t({vaultItemType:G.U.Credential,content:{otpSecret:"",otpURL:i},id:s}),(0,l.Vp)(void 0)}constructor(e){this.vaultCrudClient=e}}K=(0,i.gn)([(0,L.W)(x.z),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===k.L?Object:k.L])],K);var M=s(85869);class j{withCodeGenerator(e){return{codeGenerator:this.otpGeneratorService.createCodeGenerator(e),params:e}}execute({body:e}){const{credentialId:t}=e;return this.credentialOTPGetter.getById(t).pipe((0,o.U)((e=>{if((0,l.hx)(e)||!e.data)throw new Error("Credential not found");return e.data})),(0,o.U)((e=>{if(!e.OtpUrl&&!e.OtpSecret)return{params:null,codeGenerator:null};const t=(e=>{const{OtpSecret:t,OtpUrl:s}=e;if(!t&&!s)throw new Error("Otp config missing for this credential");return s?w(s):S(t??"")})(e);return this.withCodeGenerator(t)})),(0,f.w)((({params:e,codeGenerator:t})=>null===e||null===t?(0,U.of)((0,l.Rn)(new M.c)):this.otpCodeService.otpCodes$(e,t).pipe((0,o.U)((e=>(0,l.hx)(e)?(0,l.Vp)({code:"",validityEndDate:Date.now(),validityTime:Date.now(),url:""}):e))))))}constructor(e,t,s){this.credentialOTPGetter=e,this.otpGeneratorService=t,this.otpCodeService=s}}j=(0,i.gn)([(0,h.e)(M.J),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p?Object:p,void 0===F?Object:F,void 0===P?Object:P])],j);class V extends D{getStep(e,t){return e}constructor(e){super(e)}}V=(0,i.gn)([(0,c.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===b.q?Object:b.q])],V);var W=s(40416);class B{}B=(0,i.gn)([(0,r.Y)({sharedModuleName:"otp-generator",providers:[F,V],exports:[F,V],imports:[W.D]})],B);class z{}z=(0,i.gn)([(0,r.Y)({api:n.i,handlers:{commands:{setupOtpCodeForCredential:K},events:{},queries:{otpCode:j,otpCodeForSecretOrUrl:N}},imports:[B],providers:[p,P]})],z)},88559:(e,t,s)=>{s.d(t,{U:()=>l});var i=s(92336),r=s(14122),n=s(92587),o=s(33312),a=s(99002),c=s(89315),d=s(70942);class l{getSupportedBreaches(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.personalData.securityBreaches"}).pipe((0,o.Qn)((e=>{if(!(0,a.b)(e))throw new Error("Bad Breaches format");return e})),(0,o.Qn)((e=>e.filter(d.rY))))}get(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.personalData.securityBreaches"}).pipe((0,o.Qn)((e=>{if(!(0,a.b)(e))throw new Error("Bad Breaches format");return e})),(0,o.Qn)((e=>(0,c.l)(e.filter(d.rY)))))}constructor(e){this.carbonLegacyClient=e}}l=(0,i.gn)([(0,n.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===r._?Object:r._])],l)},61648:(e,t,s)=>{s.d(t,{C:()=>hs});var i=s(92336),r=s(68754),n=function(e){return e.DisablePasswordHealth="web_disable_password_health",e.PasswordHealthPaginationDev="sharingVault_web_password_health_pagination_dev",e.PasswordHealthPaginationProd="sharingVault_web_password_health_pagination_prod",e.PasswordHealthHourlySyncDev="sharingVault_web_passwordHealthHourlySync_dev",e.PasswordHealthHourlySyncProd="sharingVault_web_passwordHealthHourlySync_prod",e.ItemVisibilityPhase1="sharingVault_web_adminItemVisibility_phase1",e}({}),o=s(41511),a=s(52987),c=s(86006),d=s(48302),l=s(85045),u=s(19961),p=s(32671),h=s(70433),g=s(62149),m=s(63144),v=s(56618),y=s(60018),S=s(7165),w=function(e){return e.Weak="weak",e.Reused="reused",e.Compromised="compromised",e.Excluded="excluded",e}({}),E=function(e){return e.All="all",e.Weak="weak",e.Reused="reused",e.Compromised="compromised",e.Excluded="excluded",e}({}),I=function(e){return e.WEAK="weak",e.EXTREMELY_WEAK="extremely_weak",e}({}),A=function(e){return e.COMMON="common",e.STRONG="strong",e}({});const f=S.z.object({breachId:S.z.string(),domains:S.z.array(S.z.string()),date:S.z.string()}),b=S.z.object({riskType:S.z.literal(w.Compromised),breaches:S.z.array(f)}),C=S.z.object({riskType:S.z.literal(w.Weak),strength:S.z.number()}),O=S.z.object({riskType:S.z.literal(w.Reused),credentialIds:S.z.array(S.z.string())}),R=S.z.discriminatedUnion("riskType",[b,C,O]),T=S.z.object({id:S.z.string(),excluded:S.z.boolean(),title:S.z.string(),login:S.z.string(),email:S.z.string(),autoLogin:S.z.boolean(),autoProtected:S.z.boolean(),otpSecret:S.z.string(),otpUrl:S.z.string(),spaceId:S.z.string(),shared:S.z.boolean(),domains:S.z.array(S.z.string())});T.extend({password:S.z.string()});const _=T.extend({isImportant:S.z.boolean(),risks:S.z.array(R)}),D=S.z.object({compromised:S.z.array(S.z.string()),reused:S.z.array(S.z.string()),weak:S.z.array(S.z.string()),excluded:S.z.array(S.z.string()),corruptedCount:S.z.number(),importantCorruptedCount:S.z.number()}),F=S.z.object({credentialsAtRisk:S.z.record(_),index:S.z.record(D)}),P=e=>F.safeParse(e).success;class U extends((0,m.Q)({persist:!0,storage:{initialValue:{credentialsAtRisk:{},index:{}},typeGuard:P,schemaVersion:1},scope:g.F.User,storeName:"password-health-state",storeTypeGuard:P,codec:y.E,isCache:!0,capacity:v.Y.Unlimited})){}var N=s(14122),L=s(92587),x=s(33312),G=s(78346),k=s(13134),K=s(61076),M=s(87065);const j=e=>void 0===e||"string"==typeof e,V=e=>void 0===e||"string"==typeof e||"boolean"==typeof e;class W{vaultBooleanFormatter(e,t=!1){return void 0===e?t:"string"==typeof e?"true"===e.toLocaleLowerCase():e}get(){const{queries:{carbonState:e}}=this.carbonLegacyClient,t=e({path:"state.userSession.spaceData.spaces"}).pipe((0,x.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.teamId&&"object"==typeof t.details&&"string"==typeof t.details.status}))))(e))throw new Error("Bad space item format");return new Set(e.filter((e=>"accepted"===e.details.status)).map((e=>e.teamId)))}))),s=e({path:"userSession.sharingData.items"}).pipe((0,x.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.content&&"string"==typeof t.itemId&&"number"==typeof t.timestamp}))))(e))throw new Error("Bad shared items format");return e.map((e=>e.itemId))})));return e({path:"state.userSession.personalData.credentials"}).pipe((0,x.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&V(t.AutoLogin)&&V(t.AutoProtected)&&j(t.Email)&&j(t.Login)&&j(t.OtpSecret)&&j(t.OtpUrl)&&j(t.Password)&&j(t.Title)&&j(t.Url)&&j(t.SpaceId)&&V(t.Checked)}))))(e))throw new Error("Bad credential format");return e})),(0,K.V)(s,t),(0,M.U)((([e,t,s])=>{const i={};return(0,G.hx)(e)||(0,G.hx)(s)||e.data.forEach((e=>{const r=new k.Y(e.Url).getRootDomain();var n;e.SpaceId&&""!==e.SpaceId&&!s.data.has(e.SpaceId)||(i[e.Id]={domains:r?[r]:[],autoLogin:this.vaultBooleanFormatter(e.AutoLogin),autoProtected:this.vaultBooleanFormatter(e.AutoProtected),email:e.Email??"",excluded:this.vaultBooleanFormatter(e.Checked),id:e.Id,login:e.Login??"",otpSecret:e.OtpSecret??"",otpUrl:e.OtpUrl??"",password:e.Password??"",spaceId:e.SpaceId??"",shared:(n=e.Id,!(0,G.hx)(t)&&t.data.includes(n)),title:e.Title??""})})),(0,G.Vp)(i)})))}constructor(e){this.carbonLegacyClient=e}}W=(0,i.gn)([(0,L.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===N._?Object:N._])],W);var B=s(88559);const z=e=>{if(!e)return;const t=e;if(!((s=t.spaces)&&Array.isArray(s)&&0!==s.length&&(e=>{if(!e)return!1;const t=e;return!!(t.associatedEmail&&t.billingAdmins&&t.color&&t.info&&t.letter&&t.planType&&t.status&&t.teamAdmins&&t.teamId&&t.teamName&&t.tier)})(s.find((e=>"accepted"===e.status)))))return;var s;const i=t.spaces.find((e=>"accepted"===e.status));return i?.teamId};class q{get(){const{queries:{carbonState:e}}=this.carbon;return e({path:"userSession.localSettings.premiumStatus"}).pipe((0,x.Qn)(z))}constructor(e){this.carbon=e}}q=(0,i.gn)([(0,L.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===N._?Object:N._])],q);var H=s(7531),Y=s(23337);class Q extends H.K{loadResource(e){if(!(t=e)||!Array.isArray(t))throw new Error("Important domains file corrupted");var t;return new Set(e)}constructor(e){super("assets/domains/importantDomains.json",e)}}Q=(0,i.gn)([(0,L.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Y.X?Object:Y.X])],Q);var $=s(60399),X=s(43651);class Z extends((0,l.AJ)()){}var J=s(13800);class ee extends J.f{}ee=(0,i.gn)([(0,L.GS)()],ee);const te=e=>{const t=e.risks.filter((e=>e.riskType===w.Reused));return 1===t.length?t[0]:void 0},se=(e,t)=>e?.risks.find((e=>e.riskType===t)),ie=(e,t)=>e.risks.filter((e=>e.riskType!==t)),re=(e,t,s)=>[...s,{riskType:w.Reused,credentialIds:[...t.credentialIds].filter((t=>e!==t))}],ne=(e,t)=>{const s=te(t);return{...t,risks:ie(t,w.Reused).concat([{riskType:w.Reused,credentialIds:s?[...s.credentialIds].concat(e.id):[e.id]}])}},oe=e=>({id:e.id,title:e.title,email:e.email,excluded:e.excluded,login:e.login,autoLogin:e.autoLogin,autoProtected:e.autoProtected,otpSecret:e.otpSecret,otpUrl:e.otpUrl,spaceId:e.spaceId,shared:e.shared,domains:e.domains}),ae=e=>({...oe(e),risks:[],isImportant:!1}),ce=(e,t,s)=>{const i=ie(t,w.Reused),r=s&&s.length>0,n=i.length>0;return r||n?{...ae(e),risks:r?i.concat([{riskType:w.Reused,credentialIds:s}]):i}:void 0},de=e=>!!se(e,w.Weak),le=e=>!!te(e),ue=e=>!!se(e,w.Compromised),pe=e=>e.excluded,he=3,ge=5;function me(e,t,s=he,i=ge){if(!e||!t)return!1;const r=e.length,n=t.length;if(Math.abs(r-n)>s)return!1;if(r<i||n<i)return e===t;if(e===t)return!0;let o=new Array(n+1),a=new Array(n+1),c=!1;for(let e=0;e<n+1;e++)o[e]=e;for(let i=0;i<r;i++){a[0]=i+1,c=a[0]>s;for(let r=0;r<n;r++){const n=o[r+1]+1,d=a[r]+1;let l=o[r];e[i]!==t[r]&&l++,a[r+1]=Math.min(n,Math.min(d,l)),c=c&&a[r+1]>s}const r=o;if(o=a,a=r,c)break}return o[n]<=s}const ve=(e,t,s)=>{const i=((e,t)=>Object.keys(t).reduce(((s,i)=>me(i,e.password)?[...s,...t[i]]:s),[]))(e,s);if(!t&&0===i.length)return{};const r=(e=>{if(0!==e.length)return{riskType:w.Compromised,breaches:e}})(i),n=t?ie(t,w.Compromised):[],o={...ae(e),risks:r?n.concat(r):n};return{[e.id]:0===o.risks.length?void 0:o}},ye=(e,t,s)=>{if(!s)return Promise.resolve({});const i=t[e.id]??ae(e),r=i.risks.length>0,n=((e,t)=>Object.keys(t).map((e=>t[e])).filter((t=>t.id!==e.id&&me(t.password,e.password))).map((e=>e.id)))(e,s);if(0===n.length&&!r)return Promise.resolve({});const o=te(i)?.credentialIds??[],a=((e,t,s,i)=>{const r=s.filter((e=>!t.includes(e)));if(0===r.length)return{};const n={};for(const t of r){const s=i[t];if(!s)continue;const r=te(s);if(!r)continue;const o=ie(s,w.Reused);1===r.credentialIds.length&&0===o.length?n[t]=void 0:n[t]={...s,risks:1===r.credentialIds.length?o:re(e,r,o)}}return n})(e.id,n,o,t),c=((e,t,s,i,r)=>{const n=t.filter((e=>!s.includes(e)));if(0===n.length)return{};const o={};for(const t of n){const s=i[t];if(s)o[t]=ne(e,s);else{const s=r[t];o[t]={...ae(s),risks:[{riskType:w.Reused,credentialIds:[e.id]}]}}}return o})(e,n,o,t,s),d=ce(e,i,n);return Promise.resolve({...a,...c,[e.id]:d})};var Se=s(85465);const we=async e=>{if(e)return await(async e=>(await(0,Se.evaluate)(e)).score)(e)/25},Ee=async(e,t)=>{const s=await we(e.password),i=t??ae(e),r=ie(i,w.Weak),n=void 0!==s&&s<2;return n||0!==r.length?{[e.id]:{...i,...oe(e),risks:n?r.concat([{riskType:w.Weak,strength:s}]):r}}:{[e.id]:void 0}},Ie=(e,t,s)=>{if(!t)return{};const i=e.domains.some((e=>s.has(e))),r={...t,isImportant:i};return{[t.id]:r}},Ae=e=>{const t={};if(!Object.keys(e).length)return t;for(const s in e){if(!e[s])continue;const i=e[s]?.spaceId??"";void 0===t[i]&&(t[i]={[w.Reused]:[],[w.Weak]:[],[w.Compromised]:[],[w.Excluded]:[],corruptedCount:0,importantCorruptedCount:0}),e[s]?.excluded?t[i][w.Excluded].push(s):(t[i].corruptedCount++,e[s]?.isImportant&&t[i].importantCorruptedCount++,e[s]?.risks.forEach((e=>t[i][e.riskType].push(s))))}return t},fe=e=>{const t={};return Object.keys(e).forEach((s=>{const i=e[s];i&&(t[s]=i)})),t},be=(e=0)=>new Promise((t=>setTimeout((()=>t()),e))),Ce=(e,t)=>Array.from({length:Math.ceil(t.length/e)},((s,i)=>t.slice(i*e,i*e+e))),Oe=100,Re=async({credentialUpdates:e,allCredentials:t,breaches:s,importantDomains:i,hasUpdatedBreaches:r,healthState:n,deletedCredentialIds:o})=>{const a=(e=>{const t={};return e.forEach((e=>{e.LeakedPasswords&&e.LeakedPasswords.forEach((s=>{Object.prototype.hasOwnProperty.call(t,s)?t[s].push({breachId:e.Id,date:e.Content.eventDate,domains:e.Content.domains}):t[s]=[{breachId:e.Id,date:e.Content.eventDate,domains:e.Content.domains}]}))})),t})(s),c=0===e.length&&0===o.length&&!r,d={...n?.credentialsAtRisk??{}},l=e=>Object.keys(e).forEach((t=>d[t]=e[t]));o.length>0&&l(((e=[])=>e.reduce(((e,t)=>({...e,[t]:void 0})),{}))(o));const u={},p={};for(const e of Object.keys(t))t[e].excluded?u[e]=ae(t[e]):p[e]=t[e];const h=[],g=[];for(const t of e)t.excluded?g.push(t):o.includes(t.id)||h.push(t);if(l(((e,t)=>{const s={};for(const i of Object.values(t)){if(!i)continue;const t=te(i);if(!t)continue;const r=t.credentialIds.filter((t=>!e.includes(t)));if(r.length!==t.credentialIds.length){const e=ie(i,w.Reused);0===r.length&&0===e.length?s[i.id]=void 0:s[i.id]={...i,risks:0===r.length?e:[...e,{...t,credentialIds:r}]}}}return s})([...Object.values(g).map((e=>e.id)),...o],d)),c){l(await(async e=>{const t={},s=Ce(Oe,e);for(let i=0;i<s.length;i++){await be();const r=s[i];for(let s=0;s<r.length;s++){const n=r[s],o=n.password,a=n.id,c=[];for(let r=i*Oe+s+1;r<e.length;r++){const s=e[r].id,i=e[r].password,d=e[r];if(me(o,i)){const e=t[s]??ae(d),i=se(e,w.Reused),r=i?.credentialIds??[];t[s]=ce(n,e,r.concat(a)),c.push(s)}}const d=t[a]??ae(n),l=se(d,w.Reused),u=l?.credentialIds??[];t[a]=ce(n,d,c.concat(u))}}return t})(Object.values(p)))}const m=c?Object.values(p):h;if(r)for await(const e of Object.values(p)){l(ve(e,d[e.id],a))}const v=Ce(Oe,m);for await(const e of v){await be();for await(const t of e){if(!r){l(ve(t,d[t.id],a))}if(!c){l(await ye(t,d,p))}l(await Ee(t,d[t.id])),l(Ie(t,d[t.id],i))}}return l(u),{credentialsAtRisk:fe(d),index:Ae(d)}};class Te{async run({updatedCredentialIds:e,deletedCredentialIds:t,hasUpdatedBreaches:s=!1}){this.logger.debug("Starting password health calculation");if(!await this.isPasswordHealthFeatureFlipEnabled())return this.logger.debug("Password health is disabled through feature flip"),await this.store.set({credentialsAtRisk:{},index:{}}),void this.eventEmitter.sendEvent("passwordHealthComputationFinished",null);this.logger.debug("Recovering data for calculation. Getting previous health state.");const i=await this.store.getState();this.logger.debug("Getting credentials");const r=await(0,$.z)(this.credentialsGetter.get());this.logger.debug("Getting breaches");const n=await(0,$.z)(this.breachesGetter.get());this.logger.debug("Getting important domains");const o=await this.importantDomains.get();if((0,G.hx)(r)||(0,G.hx)(n))throw new Error("Failure getting vault data");const a=e?.length??0,c=t?.length??0,d=a>0||c>0||s,l=a+c<=50,u=d&&l?i:void 0,p=d?((e,t)=>e.reduce(((e,s)=>void 0===t[s]?e:[...e,t[s]]),[]))(e??[],r.data):[];this.logger.debug("Calculating updated health state",{hasUpdates:d,hasUpdatedBreaches:s,partialUpdatePossible:l});const h=await this.updateHealthState(u,s,l,p,r.data,n,o,t);await this.updateHealthStateStore(h)}async updateHealthState(e,t,s,i,r,n,o,a){try{return await Re({hasUpdatedBreaches:t,credentialUpdates:s?i:[],allCredentials:r,breaches:n.data,importantDomains:o,healthState:e,deletedCredentialIds:s?[...a??[]]:[]})}catch(e){throw new Error("Failed to calculate updated health state",{cause:e})}}async updateHealthStateStore(e){try{this.logger.debug("Updating password health store value"),await this.store.set({...e}),this.eventEmitter.sendEvent("passwordHealthComputationFinished",null)}catch(e){throw new Error("Failed to set password health store value",{cause:e})}}async isPasswordHealthFeatureFlipEnabled(){return!await this.isFeatureFlipEnabled(n.DisablePasswordHealth)}async isFeatureFlipEnabled(e,t=!1){const{userFeatureFlips:s}=this.featureFlips.queries,i=await(0,$.z)(s());return(0,G.hx)(i)?t:(0,G.db)(i)[e]??t}constructor(e,t,s,i,r,n,o){this.logger=e,this.store=t,this.credentialsGetter=s,this.breachesGetter=i,this.importantDomains=r,this.eventEmitter=n,this.featureFlips=o}}Te=(0,i.gn)([(0,L.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Z?Object:Z,void 0===U?Object:U,void 0===W?Object:W,void 0===B.U?Object:B.U,void 0===Q?Object:Q,void 0===ee?Object:ee,void 0===X.P?Object:X.P])],Te);const _e=S.z.object({lastSentDate:S.z.number()});S.z.object({lastSentDate:S.z.number(),lastHash:S.z.string()});const De=e=>_e.safeParse(e).success;class Fe extends((0,m.Q)({persist:!0,storage:{initialValue:{lastSentDate:0,lastHash:""},typeGuard:De,schemaVersion:2,migrateStorageSchema:()=>({lastSentDate:0,lastHash:""})},scope:g.F.User,storeName:"user-activity-state",storeTypeGuard:De,codec:y.E,capacity:v.Y._001KB,isCache:!0})){}const Pe=S.z.object({isOutdated:S.z.literal(!0),lastUpdateTimestamp:S.z.number(),updatedCredentialIds:S.z.record(S.z.string()),deletedCredentialIds:S.z.record(S.z.string()),hasUpdatedBreaches:S.z.boolean()}),Ue=S.z.object({isOutdated:S.z.literal(!1),lastUpdateTimestamp:S.z.number()}),Ne=S.z.discriminatedUnion("isOutdated",[Pe,Ue]),Le=e=>Ne.safeParse(e).success;class xe extends((0,m.Q)({persist:!0,storage:{initialValue:{isOutdated:!1,lastUpdateTimestamp:0},typeGuard:Le,schemaVersion:1},scope:g.F.User,storeName:"health-cache-state",storeTypeGuard:Le,codec:y.E,isCache:!0,capacity:v.Y.Unlimited})){}const Ge=(e,t)=>({...e,...t.slice(0,51).reduce(((e,t)=>(e[t]=t,e)),{})});var ke=s(64987);const Ke=new ke.WU;class Me{update(e){Ke.runExclusive((async()=>{const t=await this.store.getState();this.store.set(((e,t)=>{if(!t.isOutdated)return{isOutdated:!1,lastUpdateTimestamp:e.lastUpdateTimestamp};const{updatedCredentialIds:s,deletedCredentialIds:i,hasUpdatedBreaches:r}=t,n=e.isOutdated?{...e}:{isOutdated:!0,lastUpdateTimestamp:e.lastUpdateTimestamp,updatedCredentialIds:{},deletedCredentialIds:{},hasUpdatedBreaches:!1};return s&&(n.updatedCredentialIds=Ge(n.updatedCredentialIds,s)),i&&(n.deletedCredentialIds=Ge(n.deletedCredentialIds,i)),r&&(n.hasUpdatedBreaches=r),n})(t,e))}))}async updateHealthState(){await Ke.runExclusive((async()=>{const e=await this.store.getState();(e.isOutdated||0===e.lastUpdateTimestamp||e.lastUpdateTimestamp+864e5<Date.now())&&(await this.passwordHealthCalculationService.run(this.prepCacheStateProps(e)),await this.markAsUpToDate())}))}prepCacheStateProps(e){return e.isOutdated?{updatedCredentialIds:Object.keys(e.updatedCredentialIds),deletedCredentialIds:Object.keys(e.deletedCredentialIds),hasUpdatedBreaches:e.hasUpdatedBreaches}:{}}async markAsUpToDate(){await this.store.set({isOutdated:!1,lastUpdateTimestamp:(new Date).getTime()})}constructor(e,t){this.store=e,this.passwordHealthCalculationService=t}}Me=(0,i.gn)([(0,L.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===xe?Object:xe,void 0===Te?Object:Te])],Me);class je{async run(){await this.healthCacheUpdater.updateHealthState()}constructor(e){this.healthCacheUpdater=e}}je=(0,i.gn)([(0,L.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Me?Object:Me])],je);var Ve=s(53344),We=s(17991),Be=s(59503),ze=s(18969);const qe=e=>null===e?null:Math.round(100*e),He=0;function Ye(e){const t={};return Object.keys(e).forEach((s=>{const i=e[s].spaceId;void 0===t[i]?t[i]=1:t[i]++})),t}const Qe=e=>Math.floor(e/1e3);class $e{async sendIfReportUpdated(){const e=await this.getTeamId();if(!e)return(0,G.Rn)("Missing team ID.");const t=await this.userActivityStore.getState(),{currentTime:s,relativeEnd:i,relativeStart:r}=this.getTimes(t.lastSentDate),n=await this.getTeamContent(e),o=(0,We.k)(this.md5Hasher.compute((0,Be.u)(JSON.stringify(n))));return t.lastHash===o?(0,G.Rn)("Health data has not changed from previous run."):(await this.createReport(e,s,i,r,n,o),(0,G.Vp)(void 0))}async sendReport(){const e=await this.getTeamId();if(!e)return(0,G.Rn)("Missing team ID.");const t=await this.userActivityStore.getState(),{currentTime:s,relativeEnd:i,relativeStart:r}=this.getTimes(t.lastSentDate),n=await this.getTeamContent(e);return await this.createReport(e,s,i,r,n,""),(0,G.Vp)(void 0)}getTimes(e){const t=Date.now();return{currentTime:t,relativeEnd:Qe(t),relativeStart:Qe(e||t)}}async getTeamContent(e){const t=await this.store.getState(),s=await this.getPerSpaceTotal();return function(e,t,s){const i=e[s],r=t[s]??0;return i?{checkedPasswords:i.excluded.length,compromisedPasswords:i.compromised.length,nbrPasswords:r,reused:i.reused.length,safePasswords:r-i.corruptedCount,securityIndex:qe((0,ze.R9)(i.corruptedCount,i.importantCorruptedCount,r-i.excluded.length))??He,weakPasswords:i.weak.length}:{checkedPasswords:0,compromisedPasswords:0,nbrPasswords:r,reused:0,safePasswords:r,securityIndex:r<ze.RG?He:ze.JK,weakPasswords:0}}(t.index,s,e)}async createReport(e,t,s,i,r,n){await(0,$.z)(this.serverApiClient.v1.useractivity.create({userActivity:{securityIndex:0},teamActivity:e?{teamId:parseInt(e,10),activity:r}:void 0,relativeEnd:s,relativeStart:i})),this.userActivityStore.set({lastSentDate:t,lastHash:n})}async getTeamId(){const e=await(0,$.z)(this.currentSpaceGetter.get());if(!(0,G.d6)(e))throw new Error("Error while retrieving current space for activity report");return(0,G.db)(e)}async getPerSpaceTotal(){const e=await(0,$.z)(this.credentialsGetter.get());if(!(0,G.d6)(e))throw new Error("Error while retrieving credentials");return Ye(e.data)}constructor(e,t,s,i,r,n){this.serverApiClient=e,this.userActivityStore=t,this.credentialsGetter=s,this.store=i,this.md5Hasher=r,this.currentSpaceGetter=n}}$e=(0,i.gn)([(0,L.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ve.l?Object:Ve.l,void 0===Fe?Object:Fe,void 0===W?Object:W,void 0===U?Object:U,void 0===a.f?Object:a.f,void 0===q?Object:q])],$e);var Xe=s(94449),Ze=s(46449),Je=s(162);class et{execute({body:e}){const{password:t}=e;return(0,Je.D)(we(t)).pipe((0,M.U)((e=>(0,G.Vp)(e))))}constructor(){}}et=(0,i.gn)([(0,Ze.e)(Xe.c),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[])],et);var tt=s(44955);const st=(e,t)=>t===E.All?[...new Set([...e[w.Compromised],...e[w.Reused],...e[w.Weak],...e[w.Excluded]])]:e[t],it=(e,t)=>{const s=((e,t)=>{if(0!==t.length)switch(e){case E.All:{const e={[w.Compromised]:3,[w.Weak]:2,[w.Reused]:1,[w.Excluded]:0};return t.reduce(((t,s)=>t?e[s.riskType]>e[t.riskType]?s:t:s),void 0)}case E.Compromised:return t.find((e=>e.riskType===w.Compromised));case E.Weak:return t.find((e=>e.riskType===w.Weak));case E.Reused:return t.find((e=>e.riskType===w.Reused));default:return}})(e,t);if(!s)return;const i={severity:A.COMMON};switch(s.riskType){case w.Compromised:{const e=[...s.breaches].sort(((e,t)=>{const s=Date.parse(e.date),i=Date.parse(t.date);return s===i?0:s<i?1:-1}))[0];return{...i,riskType:w.Compromised,date:e.date,domain:e.domains[0]??null,severity:A.STRONG}}case w.Reused:return{...i,riskType:w.Reused,reuseCount:s.credentialIds.length};case w.Weak:return{...i,riskType:w.Weak,strength:s.strength>=1?I.WEAK:I.EXTREMELY_WEAK}}},rt=(e,t,s,i,r)=>{let n;return n=null!==e?st(t[e],s):s===E.All?Object.keys(i):Object.keys(t).reduce(((e,i)=>[...e,...st(t[i],s)]),[]),r&&(n=n.filter((e=>r.includes(e)))),n.map((e=>((e,t)=>{const{id:s,title:i,login:r,email:n,autoProtected:o,shared:a,excluded:c,domains:d,risks:l}=e;return{id:s,title:i,login:r,email:n,autoProtected:o,shared:a,excluded:c,domainIcon:void 0,corruptionData:it(t,l),domain:d[0]}})(i[e],s)))};class nt{execute({body:e}){const{credentialIds:t,spaceId:s,healthFilter:i}=e;return this.store.state$.pipe((0,M.U)((e=>null!==s&&void 0===e.index[s]?(0,G.Vp)([]):(0,G.Vp)(rt(s,e.index,i||E.All,e.credentialsAtRisk,t)))))}constructor(e){this.store=e}}nt=(0,i.gn)([(0,Ze.e)(tt.M),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U])],nt);var ot=s(16433);class at{isRunnable(){return(0,$.z)(this.isHourlyActivityReportEnabled())}async run(){await this.userActivitySenderService.sendReport()}isHourlyActivityReportEnabled(){return this.featureFlipsClient.queries.userFeatureFlips().pipe((0,M.U)((e=>{if((0,G.hx)(e))return!1;const t=!e.data[n.DisablePasswordHealth],s=e.data[n.PasswordHealthHourlySyncProd],i=e.data[n.PasswordHealthHourlySyncDev];return t&&(s||i)})),(0,M.U)((e=>e??!1)),(0,ot.q)(1))}constructor(e,t){this.userActivitySenderService=e,this.featureFlipsClient=t}}at=(0,i.gn)([(0,L.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===$e?Object:$e,void 0===X.P?Object:X.P])],at);var ct=s(82874),dt=s(90797);class lt{async execute(){return await this.healthCacheUpdater.updateHealthState(),(0,G.Vp)(void 0)}constructor(e){this.healthCacheUpdater=e}}lt=(0,i.gn)([(0,ct.W)(dt.V),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Me?Object:Me])],lt);var ut=s(37109);function pt(e){const t={isCompromised:!1,isReused:!1,isWeak:!1};return e?.risks.reduce(((e,t)=>{switch(t.riskType){case w.Compromised:e.isCompromised=!0;break;case w.Reused:e.isReused=!0;break;case w.Weak:e.isWeak=!0}return e}),t)??t}class ht{async send(){if(!await this.isAdminVisibilityEnabled())return;const e=await(0,$.z)(this.credentialsGetter.get());if((0,G.hx)(e))throw new Error("Failure getting vault data");const t=await this.passwordHealthStore.getState(),s=await this.sendUVVS(e.data,t);if((0,G.hx)(s))throw new Error("Failed to upload UVVS",{cause:s.error})}async sendUVVS(e,t){this.logger.debug("Creating UVVS data");const s=function(e,t){try{const s=[];for(const i in e){const r=e[i],n=t[i];if(!r.spaceId)continue;const[o]=r.domains;if(o){const{isCompromised:e,isReused:t,isWeak:i}=pt(n);s.push({id:r.id,domain:o,risks:{isCompromised:e,isReused:t,isWeak:i}})}}return s}catch(e){throw new Error("Failed to create UVVS data from health state",{cause:e})}}(e,t.credentialsAtRisk);s.length||this.logger.warn("UVVS data was empty");try{return this.logger.debug("Sending UVVS data"),await this.passwordHealthClient.commands.uploadUVVS({uvvs:s})}catch(e){throw new Error("Unexpected error while uploading UVVS",{cause:e})}}async isAdminVisibilityEnabled(){return!!await this.isAdminVisibilityFeatureFlipEnabled()&&await this.isAdminVisibilitySettingEnabled()}async isAdminVisibilitySettingEnabled(){return(0,$.z)(this.getActiveSpaceSettings().pipe((0,M.U)((e=>(0,G.f2)(e,{failure:()=>!1,success:e=>e.uvvsReportEnabled??!1})))))}getActiveSpaceSettings(){return this.carbonLegacyClient.queries.getActiveSpaces().pipe((0,x.Qn)((([e])=>e)),(0,x.Qn)((e=>e?.info??{})))}async isAdminVisibilityFeatureFlipEnabled(){return this.isFeatureFlipEnabled(n.ItemVisibilityPhase1)}async isFeatureFlipEnabled(e,t=!1){const{userFeatureFlips:s}=this.featureFlips.queries,i=await(0,$.z)(s());return(0,G.hx)(i)?t:(0,G.db)(i)[e]??t}constructor(e,t,s,i,r,n){this.logger=e,this.credentialsGetter=t,this.passwordHealthStore=s,this.passwordHealthClient=i,this.carbonLegacyClient=r,this.featureFlips=n}}ht=(0,i.gn)([(0,L.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Z?Object:Z,void 0===W?Object:W,void 0===U?Object:U,void 0===ut.L?Object:ut.L,void 0===N._?Object:N._,void 0===X.P?Object:X.P])],ht);var gt=s(45101),mt=s(28275),vt=s(59093),yt=s(78776),St=s(59664);class wt{async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacyClient;await t({name:"updateCredential",args:[{id:e.credentialId,update:{isExcludedFromHealth:e.excluded}}]});return await this.getActivityLogEnabled()&&this.auditLogCredentialExclusionFromRisk(e.credentialId,e.excluded),this.store.update((t=>{const s={...t.credentialsAtRisk[e.credentialId],excluded:e.excluded},i={...t};return i.credentialsAtRisk[e.credentialId]=s,i.index=Ae(t.credentialsAtRisk),i})),Promise.resolve((0,G.Vp)(void 0))}async auditLogCredentialExclusionFromRisk(e,t){const{commands:{storeActivityLogs:s}}=this.activityLogsApiClient,i=await this.findCredentialRiskById(e),r=this.getActivityLogProperties(i),n=t?(e=>({date_time:(new Date).getTime(),schema_version:"1.0.0",is_sensitive:!0,uuid:(0,yt.Z)().toUpperCase(),category:St.s.SecurityMonitoring,log_type:St.b.UserExcludedItemFromPasswordHealth,properties:e}))(r):(e=>({date_time:(new Date).getTime(),schema_version:"1.0.0",is_sensitive:!0,uuid:(0,yt.Z)().toUpperCase(),category:St.s.SecurityMonitoring,log_type:St.b.UserIncludedItemInPasswordHealth,properties:e}))(r);s({activityLogs:[n]})}async findCredentialRiskById(e){return(await this.store.getState()).credentialsAtRisk[e]}async getActivityLogEnabled(){const{userFeatureFlip:e}=this.featureFlips.queries,t=await(0,$.z)(e({featureFlip:mt.q.SharingVaultTacAuditLogsProtectedItemRevealed}));return!!(0,G.d6)(t)&&!!(0,G.db)(t)}getActivityLogProperties({email:e,login:t,domains:[s]}){return{credential_domain:s,credential_login:e||t}}constructor(e,t,s,i){this.store=e,this.carbonLegacyClient=t,this.featureFlips=s,this.activityLogsApiClient=i}}wt=(0,i.gn)([(0,ct.W)(gt.v),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U,void 0===N._?Object:N._,void 0===X.P?Object:X.P,void 0===vt._?Object:vt._])],wt);var Et=s(52835);class It{execute(){return this.healthCacheUpdaterService.update({isOutdated:!0}),Promise.resolve((0,G.Vp)(void 0))}constructor(e){this.healthCacheUpdaterService=e}}It=(0,i.gn)([(0,ct.W)(Et.t),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Me?Object:Me])],It);var At=s(76500),ft=s(52586);class bt{async execute({body:e}){const{uvvs:t}=e,s=await this.enclaveApiClient.uvvs.uploadUVVS({uvvs:t});if(!(0,G.d6)(s)){if("request_malformed"===s.error.code)return(0,G.Rn)((0,ft.m0)());throw new Error("Unexpected error while uploading UVVS.",{cause:s.error})}return(0,G.Vp)(void 0)}constructor(e){this.enclaveApiClient=e}}bt=(0,i.gn)([(0,ct.W)(ft.Yf),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===At.l?Object:At.l])],bt);var Ct=s(79594),Ot=s(33844);const Rt=["Item Name","Date Created"],Tt=[e=>e.domain,()=>"fake/date/created"];class _t{async execute({body:e}){const{userId:t}=e;this.logger.debug("Downloading UVVS");const s=await this.downloadUVVS(t);if((0,G.hx)(s))throw new Error("Unexpectedly unable to fetch UVVS report",{cause:s.error});this.logger.debug("Downloaded UVVS with success");const i=s.data.uvvs;if(i.length<=0)return this.logger.debug("User has no UVVS data"),(0,G.Vp)(void 0);this.logger.debug("Serializing UVVS data into a CSV buffer");const r=this.getUVVSBuffer(i),n=this.getFileName();try{this.logger.debug("Downloading CSV buffer"),await this.fileDownloadService.downloadFile(n,"text/csv",r)}catch(e){throw new Error("Unexpectedly unable to download exported UVVS file",{cause:e})}return this.logger.debug("Exported UVVS's CSV successfully"),(0,G.Vp)(void 0)}async downloadUVVS(e){try{return await(0,$.z)(this.passwordHealthClient.queries.downloadUVVS({userId:e}))}catch(e){throw new Error("Unexpected error while downloading UVVS",{cause:e})}}getUVVSBuffer(e){try{const t=this.mapToRows(e),s=this.createCSV(t);return this.createTextBuffer(s)}catch(e){throw new Error("Unexpectedly unable to serialize UVVS content",{cause:e})}}createTextBuffer(e){return(new TextEncoder).encode(e).buffer}createCSV(e){return[Rt].concat(e).map((e=>e.join(","))).join("\n")}mapToRows(e){return e.map((e=>Tt.map((t=>t(e)))))}getFileName(){return"user-report.csv"}constructor(e,t,s){this.logger=e,this.passwordHealthClient=t,this.fileDownloadService=s}}_t=(0,i.gn)([(0,ct.W)(Ot.E),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Z?Object:Z,void 0===ut.L?Object:ut.L,void 0===Ct._?Object:Ct._])],_t);var Dt=s(94388),Ft=s(85798);class Pt{async handle(){await this.isPasswordHealthEnabled()&&(await this.sendActivityReport(),await this.uvvsSender.send())}async sendActivityReport(){if(await this.isHourlyActivityReportEnabled()){await this.isFirstRun()&&await this.userActivitySender.sendReport()}else await this.userActivitySender.sendIfReportUpdated()}async isFirstRun(){const{lastSentDate:e}=await this.userActivityStore.getState();return 0===e}async isPasswordHealthEnabled(){const{userFeatureFlips:e}=this.featureFlips.queries,t=await(0,$.z)(e());return!!(0,G.hx)(t)||!(0,G.db)(t)[n.DisablePasswordHealth]}async isHourlyActivityReportEnabled(){const{userFeatureFlips:e}=this.featureFlips.queries,t=await(0,$.z)(e());if((0,G.hx)(t))return!1;const s=(0,G.db)(t),i=s[n.PasswordHealthHourlySyncProd],r=s[n.PasswordHealthHourlySyncDev];return i||r}constructor(e,t,s,i){this.featureFlips=e,this.userActivitySender=t,this.userActivityStore=s,this.uvvsSender=i}}Pt=(0,i.gn)([(0,Ft.b)(Dt.w),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===X.P?Object:X.P,void 0===$e?Object:$e,void 0===Fe?Object:Fe,void 0===ht?Object:ht])],Pt);var Ut=s(53932),Nt=s(5574),Lt=s(91056),xt=s(48062);class Gt{async handle({body:e}){const{credentialId:t}=e,{commands:{trackEvent:s}}=this.cqrsClient.getClient(Nt.Yu),i=(e=>({is_excluded:!!e&&pe(e),is_weak:!!e&&de(e),is_reused:!!e&&le(e),is_compromised:!!e&&ue(e)}))((await(0,$.z)(this.store.state$)).credentialsAtRisk[t]);return s({event:new xt.UserCredentialHealthReportEvent({credentialSecurityStatus:i,itemId:t})}),Promise.resolve(void 0)}constructor(e,t){this.store=e,this.cqrsClient=t}}Gt=(0,i.gn)([(0,Ft.b)(Lt.p),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U,void 0===Ut.w?Object:Ut.w])],Gt);var kt=s(39431),Kt=s(34086);class Mt{handle({body:e}){const{ids:t,vaultItemType:s}=e;return s===kt.U.Credential&&this.healthCacheUpdater.update({isOutdated:!0,updatedCredentialIds:t}),Promise.resolve(void 0)}constructor(e){this.healthCacheUpdater=e}}Mt=(0,i.gn)([(0,Ft.b)(Kt.V),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Me?Object:Me])],Mt);var jt=s(25666);class Vt{handle({body:e}){const{ids:t,vaultItemType:s}=e;return s===kt.U.Credential&&this.healthCacheUpdater.update({isOutdated:!0,updatedCredentialIds:t}),Promise.resolve(void 0)}constructor(e){this.healthCacheUpdater=e}}Vt=(0,i.gn)([(0,Ft.b)(jt.J),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Me?Object:Me])],Vt);var Wt=s(46578);class Bt{handle({body:e}){const{ids:t,vaultItemType:s}=e;return s===kt.U.Credential&&this.healthCacheUpdater.update({isOutdated:!0,deletedCredentialIds:t}),Promise.resolve(void 0)}constructor(e){this.healthCacheUpdater=e}}Bt=(0,i.gn)([(0,Ft.b)(Wt.s),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Me?Object:Me])],Bt);var zt=s(17430);class qt{execute({body:e}){const{credentialId:t}=e;return this.store.state$.pipe((0,M.U)((e=>e.credentialsAtRisk[t]?(0,G.Vp)((e=>{const{excluded:t,risks:s}=e;return{excluded:t,corruptionData:it(E.All,s)}})(e.credentialsAtRisk[t])):(0,G.Vp)(null))))}constructor(e){this.store=e}}qt=(0,i.gn)([(0,Ze.e)(zt.w),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U])],qt);var Ht=s(25374);const Yt=(e,t)=>{const{excluded:s,compromised:i,reused:r,weak:n,corruptedCount:o,importantCorruptedCount:a}=e,c=s.length,d=qe((0,ze.R9)(o,a,t-c));return{total:t,excluded:c,compromised:i.length,reused:r.length,weak:n.length,score:d}},Qt=(e,t)=>{let s=0,i=0,r=0,n=0,o=0,a=0;for(const t of Object.values(e)){const{compromised:e,reused:c,weak:d,corruptedCount:l,importantCorruptedCount:u,excluded:p}=t;s+=e.length,i+=c.length,r+=d.length,n+=l,o+=u,a+=p.length}const c=(0,ze.R9)(n,o,t-a);return{compromised:s,reused:i,total:t,weak:r,score:qe(c),excluded:a}};function $t(e,t){return(0,G.hx)(e)?0:Object.keys(e.data).filter((s=>e.data[s].spaceId===t)).length}class Xt{execute({body:e}){const{spaceId:t=null}=e;return this.store.state$.pipe((0,K.V)(this.credentialsGetter.get(),this.cacheStateStore.state$),(0,M.U)((([e,s,i])=>{if(null!==t&&void 0===e.index[t]){const e=$t(s,t);return(0,G.Vp)({counters:{compromised:0,reused:0,score:100,total:e,weak:0,excluded:0},isInitialized:i.lastUpdateTimestamp>0})}if(null===t){const t=(0,G.hx)(s)?0:Object.keys(s.data).length;return(0,G.Vp)({counters:Qt(e.index,t),isInitialized:i.lastUpdateTimestamp>0})}const r=$t(s,t);return(0,G.Vp)({counters:Yt(e.index[t],r),isInitialized:i.lastUpdateTimestamp>0})})))}constructor(e,t,s){this.cacheStateStore=e,this.credentialsGetter=t,this.store=s}}Xt=(0,i.gn)([(0,Ze.e)(Ht.e),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===xe?Object:xe,void 0===W?Object:W,void 0===U?Object:U])],Xt);var Zt=s(6136),Jt=s(22231);const es={[w.Compromised]:1,[w.Reused]:2,[w.Weak]:3,[w.Excluded]:4},ts=e=>[...e].sort(((e,t)=>{const s=es[e.corruptionData?.riskType??w.Excluded],i=es[t.corruptionData?.riskType??w.Excluded];if(s===i){const s=((e,t)=>e?.riskType===w.Compromised&&t?.riskType===w.Compromised?Date.parse(t.date)-Date.parse(e.date):e?.riskType===w.Reused&&t?.riskType===w.Reused?t.reuseCount-e.reuseCount:e?.riskType===w.Weak&&t?.riskType===w.Weak?e.strength===t.strength?0:e.strength===I.WEAK?1:-1:0)(e.corruptionData,t.corruptionData);return 0!==s?s:e.title.localeCompare(t.title)}return s-i})),ss=20;class is{isPasswordHealthPaginationEnabled(){return this.featureFlipsClient.queries.userFeatureFlips().pipe((0,M.U)((e=>{if((0,G.hx)(e))return!1;const t=e.data[n.PasswordHealthPaginationProd],s=e.data[n.PasswordHealthPaginationDev];return t||s})),(0,ot.q)(1))}execute({body:e}){const{healthFilter:t,spaceId:s,pageNumber:i=1,pageSize:r=ss}=e;return this.store.state$.pipe((0,M.U)((e=>{if(null!==s&&void 0===e.index[s])return[];return ts(rt(s,e.index,t||E.All,e.credentialsAtRisk))})),(0,K.V)(this.isPasswordHealthPaginationEnabled()),(0,M.U)((([e,t])=>{const s=e.length;let n=e;if(t){const t=r*i;n=e.slice(0,t)}return{items:n,matchCount:s}})),(0,Zt.x)(((e,t)=>{const s=0===e.matchCount&&0===t.matchCount,i=0===e.items.length&&0===t.items.length;return!(!s||!i)})),(0,M.U)(G.Vp))}constructor(e,t){this.store=e,this.featureFlipsClient=t}}is=(0,i.gn)([(0,Ze.e)(Jt.Q),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U,void 0===X.P?Object:X.P])],is);var rs=s(35642);class ns{execute({body:e}){const{credentialIds:t}=e;return this.store.state$.pipe((0,M.U)((e=>(0,G.Vp)(((e,t)=>Object.keys(e).reduce(((t,s)=>[...t,...e[s].compromised]),[]).filter((e=>t.includes(e))))(e.index,t)))))}constructor(e){this.store=e}}ns=(0,i.gn)([(0,Ze.e)(rs.v),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U])],ns);var os=s(69134);class as{execute({body:e}){const{breachId:t}=e;return this.store.state$.pipe((0,M.U)((e=>(0,G.Vp)(((e,t)=>Object.keys(e.index).reduce(((s,i)=>[...s,...e.index[i].compromised.filter((s=>{const i=se(e.credentialsAtRisk[s],w.Compromised);return i?.breaches.some((e=>e.breachId===t))}))]),[]))(e,t)))))}constructor(e){this.store=e}}as=(0,i.gn)([(0,Ze.e)(os.A),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U])],as);var cs=s(61613);class ds{execute(){return this.store.state$.pipe((0,K.V)(this.credentialsGetter.get()),(0,M.U)((([e,t])=>{const s={};if(!(0,G.d6)(t))throw new Error("Error while retrieving credentials");const i=Ye(t.data),r=Object.keys(t.data).length,n=function(e){const t={};return Object.keys(e).forEach((s=>{const i=se(e[s],w.Compromised),r=e[s].spaceId;if(void 0===i)return;void 0===t[r]&&(t[r]={breaches:new Set,compromisedByBreaches:{}});const n=i.breaches.map((e=>e.breachId));t[r].breaches=new Set([...t[r].breaches,...n]),t[r].compromisedByBreaches[s]=new Set(n)})),t}(e.credentialsAtRisk);let o=new Set([]),a={},c=0;return Object.keys(e.index).forEach((t=>{const r=e.index[t],d=Yt(r,i[t]);s[t]={...d,breaches:n[t]?.breaches??new Set,compromisedByBreach:n[t]?.compromisedByBreaches??{},corrupted:r.corruptedCount},o=new Set([...o,...n[t]?.breaches??new Set]),a={...a,...n[t]?.compromisedByBreaches??{}},c+=r.corruptedCount})),s.global={...Qt(e.index,r),breaches:o,compromisedByBreach:a,corrupted:c},(0,G.Vp)(s)})))}constructor(e,t){this.store=e,this.credentialsGetter=t}}ds=(0,i.gn)([(0,Ze.e)(cs.b),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===U?Object:U,void 0===W?Object:W])],ds);var ls=s(52477),us=s(9853);class ps{execute({body:e}){const{userId:t}=e,s=this.enclaveApiClient.uvvs.downloadUVVS({requestedUserId:t});return(0,Je.D)(s).pipe((0,M.U)((e=>(0,ls.EQ)(e,{failure:({error:e})=>{switch(e.code){case"SNAPSHOT_NOT_FOUND":return(0,G.Rn)((0,us.Mw)());case"SNAPSHOT_MALFORMED":return(0,G.Rn)((0,us.iQ)());default:throw new Error("Unknown error from Enclave",{cause:e})}},success:e=>e}))))}constructor(e){this.enclaveApiClient=e}}ps=(0,i.gn)([(0,Ze.e)(us.Up),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===At.l?Object:At.l])],ps);class hs{}hs=(0,i.gn)([(0,c.Y)({api:r.d,crons:[{handler:je,name:"health-cache",periodInMinutes:15,scope:g.F.User},{handler:at,name:"user-activity-report",periodInMinutes:60,scope:g.F.User}],handlers:{commands:{updateIsCredentialExcluded:wt,recalculatePasswordHealth:It,updateHealthState:lt,uploadUVVS:bt,exportUVVS:_t},events:{...(0,c.g)(r.d,{passwordHealthComputationFinished:Pt}),...(0,c.g)(p.Y,{passwordAutofillPerformed:Gt}),...(0,c.g)(h.L,{updated:Mt,created:Vt,deleted:Bt})},queries:{credentialHealthData:qt,score:Xt,filterCredentials:is,filterCredentialsIds:nt,compromisedCredentials:ns,compromisedCredentialsIdsForBreach:as,passwordHealthReport:ds,scoreForPassword:et,downloadUVVS:ps}},imports:[o.n,u.G,d.l],stores:[U,Fe,xe],providers:[(0,l.ND)(Z),W,B.U,Q,Te,Me,je,ee,$e,U,a.f,q,at,ht],requiredFeatureFlips:[n.DisablePasswordHealth,n.PasswordHealthPaginationDev,n.PasswordHealthPaginationProd,n.PasswordHealthHourlySyncDev,n.PasswordHealthHourlySyncProd,n.ItemVisibilityPhase1]})],hs)},18969:(e,t,s)=>{s.d(t,{JK:()=>c,R9:()=>d,RG:()=>i});const i=5,r=.6,n=1,o=1,a=.2,c=100;function d(e,t,s){if(s<i)return null;const c=t/s,d=e/s,l=r*Math.pow(1-c,n),u=(1-r)*Math.pow(1-d,o);return a+(1-a)*(l+u)}},29292:(e,t,s)=>{s.d(t,{E:()=>z});var i=s(92336),r=s(86006),n=s(97203),o=s(68754),a=s(60399),c=s(19216),d=s(37109),l=s(92587),u=s(24418),p=s(78346),h=s(48062),g=s(20980),m=s(35594),v=s(39431),y=s(77802),S=s(50879),w=s(88559),E=s(62149),I=s(63144),A=s(56618),f=s(7303),b=s(60018);const C=e=>!(!e||"object"!=typeof e)&&((0,f.l$)(e,"lastSentDate")&&"number"==typeof e.lastSentDate);class O extends((0,I.Q)({codec:b.E,persist:!0,storage:{initialValue:{lastSentDate:0},schemaVersion:1,typeGuard:C},scope:E.F.User,storeName:"vault-report",storeTypeGuard:C,capacity:A.Y._001KB,isCache:!0})){}const R="global",T={collectionsCount:-1,collectionsSharedCount:-1,multipleCollectionsCount:-1,multipleCollectionsSharedCount:-1,singleCollectionCount:-1,singleCollectionSharedCount:-1};function _(e){if(0===e.length)return 0;const t=e.flatMap((e=>e.vaultItems)),s=new Set(t.map((e=>e.id))).size;return Math.round(t.length/s)}function D(e){if(0===e.length)return 0;let t=0,s=0;for(const i of e)i.vaultItems.length>0&&(s+=i.vaultItems.length,t++);return Math.round(s/t)}function F(e){let t=0,s=0,i=0,r=0;const n=e.reduce(((e,t)=>(t.vaultItems.forEach((s=>{const i=s.id;e[i]?(e[i].all++,t.isShared&&e[i].shared++):e[i]={all:1,shared:t.isShared?1:0}})),e)),{});return Object.values(n).forEach((e=>{e.all>1?t++:1===e.all&&s++,e.shared>1?i++:1===e.shared&&r++})),{collectionsCount:e.length,collectionsSharedCount:e.filter((e=>e.isShared)).length,multipleCollectionsCount:t,multipleCollectionsSharedCount:i,singleCollectionCount:s,singleCollectionSharedCount:r}}var P=s(70942);const U=e=>e.reduce(((e,t)=>({...e,[t.id]:{...t}})),{});const N=(e,t=[])=>{const s={[R]:{totalCount:0,sharedCount:0}};return e.forEach((e=>{const i=e.spaceId;void 0===s[i]&&(s[i]={totalCount:0,sharedCount:0}),s[i].totalCount++,s[R].totalCount++,t.includes(e.id)&&(s[i].sharedCount++,s[R].sharedCount++)})),s};var L=s(18969);const x=(e,t)=>({total_count:t?.totalCount??0,shared_count:t?.sharedCount??0,collections_count:e?.collectionsCount??0,collections_shared_count:e?.collectionsSharedCount??0,multiple_collections_count:e?.multipleCollectionsCount??0,multiple_collections_shared_count:e?.multipleCollectionsSharedCount??0,single_collection_count:e?.singleCollectionCount??0,single_collection_shared_count:e?.singleCollectionSharedCount??0}),G=[v.U.Email,v.U.Address,v.U.Company,v.U.Phone,v.U.Website,v.U.Identity],k=[v.U.BankAccount,v.U.PaymentCard],K=[v.U.DriversLicense,v.U.FiscalId,v.U.IdCard,v.U.Passport,v.U.SocialSecurityId],M=[v.U.Credential,v.U.SecureNote,v.U.Secret,v.U.Passkey,...G,...k,...K];class j{getSpaceScope(e){switch(e){case"":return h.Scope.Personal;case R:return h.Scope.Global;default:return h.Scope.Team}}async send(){const e=await(0,a.z)(this.passwordHealth.queries.passwordHealthReport());if((0,p.hx)(e))return Promise.reject(new Error("Error while retrieving health report for creating the vault report"));const t=await(0,a.z)(this.breachesGetter.getSupportedBreaches());if((0,p.hx)(t))return Promise.reject(new Error("Error while retrieving breaches for creating the vault report"));const s=await(0,a.z)(this.vaultCrud.queries.query({vaultItemTypes:M}));if((0,p.hx)(s))return Promise.reject(new Error("Error while retrieving credentials for creating the vault report"));const i=(0,p.db)(s).credentialsResult,r=await(0,a.z)(this.autofillSettings.queries.getPreferencesForCredentials({}));if((0,p.hx)(r))return Promise.reject(new Error("Error while retrieving credential preferences for creating the vault report"));const n=await(0,a.z)(this.vault.queries.queryCollections({}));if((0,p.hx)(n))return Promise.reject(new Error("Error while retrieving collections for creating the vault report"));const o=await(0,a.z)(this.sharedCollections.queries.sharedCollectionsWithItems());if((0,p.hx)(o))return Promise.reject(new Error("Error while retrieving shared collections for creating the vault report"));const c=await(0,a.z)(this.sharedItems.queries.sharedItemsIds());if((0,p.hx)(c))return Promise.reject(new Error("Error while retrieving shared items ids for creating the vault report"));const d=function(e,t,s){const i=U(e),r=U(t),n={[R]:{domainsWithoutAutofillCount:0,totalCount:0,sharedCount:0,passwordsWithOtpCount:0,passwordsProtectedWithMasterPasswordCount:0}};return Object.keys(i).forEach((e=>{const t=i[e].spaceId;void 0===n[t]&&(n[t]={domainsWithoutAutofillCount:0,totalCount:0,sharedCount:0,passwordsWithOtpCount:0,passwordsProtectedWithMasterPasswordCount:0}),n[t].totalCount++,n[R].totalCount++,s.includes(e)&&(n[t].sharedCount++,n[R].sharedCount++),r[e].useAutoLogin||(n[t].domainsWithoutAutofillCount++,n[R].domainsWithoutAutofillCount++),(i[e].otpSecret||i[e].otpURL)&&(n[t].passwordsWithOtpCount++,n[R].passwordsWithOtpCount++),r[e].requireMasterPassword&&(n[t].passwordsProtectedWithMasterPasswordCount++,n[R].passwordsProtectedWithMasterPasswordCount++)})),n}(i.items,(0,p.db)(r),c.data),l=function(e,t){const s=new Set,i=new Set;e.forEach((e=>{(0,P.F7)(e.Content)?i.add(e.Id):s.add(e.Id)}));const r=new Set,n=new Set,o={global:{activePrivateBreachAlerts:0,activePublicBreachAlerts:0,passwordsCompromisedThroughPrivateBreaches:0,privateBreachAlerts:i.size,publicBreachAlerts:s.size}};return Object.keys(t).forEach((e=>{if(e===R)return;const a=t[e];void 0===o[e]&&(o[e]={activePrivateBreachAlerts:0,activePublicBreachAlerts:0,passwordsCompromisedThroughPrivateBreaches:0,privateBreachAlerts:i.size,publicBreachAlerts:s.size}),[...a.breaches].forEach((t=>{s.has(t)?(o[e].activePublicBreachAlerts++,r.add(t)):i.has(t)&&(o[e].activePrivateBreachAlerts++,n.add(t))})),Object.keys(a.compromisedByBreach).forEach((t=>{[...a.compromisedByBreach[t]].some((e=>i.has(e)))&&o[e].passwordsCompromisedThroughPrivateBreaches++})),o[R].passwordsCompromisedThroughPrivateBreaches+=o[e].passwordsCompromisedThroughPrivateBreaches})),o[R].activePrivateBreachAlerts=n.size,o[R].activePublicBreachAlerts=r.size,o}(t.data,e.data);return Object.keys(d).forEach((t=>{const i=e.data[t],r=function(e,t,s){const i=[...e,...t].filter((e=>s===R||s&&e.spaceId||!s&&!e.spaceId)),r=s?t.length:0,n=r+(s===R?e.length:e.filter((e=>s&&e.spaceId||!s&&!e.spaceId)).length);return{itemsPerCollectionAverageCount:D(i),collectionsPerItemAverageCount:_(i),ids:T,passwords:F(i),payments:T,personalInfo:T,secureNotes:T,collectionsSharedCount:r,collectionsTotalCount:n}}((0,p.db)(n).collections,o.data,t),a={scope:this.getSpaceScope(t),...r,...d[t],...l[t]},u=((e,t)=>e?{passwordsSafeCount:t.totalCount-e.corrupted,passwordsExcludedCount:e.excluded,passwordsCompromisedCount:e.compromised,passwordsReusedCount:e.reused,securityScore:e.score??void 0,passwordsWeakCount:e.weak}:{passwordsSafeCount:t.totalCount,passwordsExcludedCount:0,passwordsCompromisedCount:0,passwordsReusedCount:0,securityScore:t.totalCount<L.RG?void 0:L.JK,passwordsWeakCount:0})(i,d[t]),g=((e,t,s,i,r)=>{const n=N([...t.idCardsResult.items,...t.socialSecurityIdsResult.items,...t.driversLicensesResult.items,...t.fiscalIdsResult.items,...t.passportsResult.items]),o=N(t.secureNotesResult.items,r),a=N(t.secretsResult.items,r),c=N(t.passkeysResult.items,r),d=N([...t.paymentCardsResult.items,...t.bankAccountsResult.items]),l=N([...t.addressesResult.items,...t.emailsResult.items,...t.phonesResult.items,...t.websitesResult.items,...t.companiesResult.items,...t.identitiesResult.items]),{totalCount:u,sharedCount:p}=((e,t)=>t.reduce(((t,s)=>({totalCount:t.totalCount+(s[e]?.totalCount??0),sharedCount:t.sharedCount+(s[e]?.sharedCount??0)})),{totalCount:0,sharedCount:0}))(e,[s,n,l,d,a,o,c]);return{itemsTotalCount:u,itemsSharedCount:p,ids:x(i.ids,n[e]),personalInfo:x(i.personalInfo,l[e]),secureNotes:x(i.secureNotes,o[e]),secrets:x(void 0,a[e]),passkeys:x(void 0,c[e]),payments:x(i.payments,d[e]),passwords:x(i.passwords,s[e])}})(t,s.data,d,r,c.data),m=new h.UserVaultReportEvent({...a,...u,...g});this.analytics.commands.trackEvent({event:m})})),this.store.set({lastSentDate:Date.now()}),Promise.resolve()}async shouldBeSent(){return(await(0,a.z)(this.store.state$)).lastSentDate+864e5<Date.now()}constructor(e,t,s,i,r,n,o,a,c){this.autofillSettings=e,this.breachesGetter=t,this.store=s,this.analytics=i,this.passwordHealth=r,this.vault=n,this.vaultCrud=o,this.sharedCollections=a,this.sharedItems=c}}j=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===c.W?Object:c.W,void 0===w.U?Object:w.U,void 0===O?Object:O,void 0===u.R?Object:u.R,void 0===d.L?Object:d.L,void 0===y.C?Object:y.C,void 0===S.L?Object:S.L,void 0===g.L?Object:g.L,void 0===m.s?Object:m.s])],j);var V=s(94388),W=s(85798);class B{async handle(){await this.vaultReportSender.shouldBeSent()&&this.vaultReportSender.send()}constructor(e){this.vaultReportSender=e}}B=(0,i.gn)([(0,W.b)(V.w),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===j?Object:j])],B);class z{}z=(0,i.gn)([(0,r.Y)({api:n.f,handlers:{commands:{},events:{...(0,r.g)(o.d,{passwordHealthComputationFinished:B})},queries:{}},providers:[w.U,j],stores:[O]})],z)},4350:(e,t,s)=>{s.d(t,{v:()=>i});const i="ecommerce_cancel_flow_discounts"},77404:(e,t,s)=>{s.d(t,{c:()=>p});var i=s(75958),r=s(30989),n=s(1714),o=s(67959),a=s(42616),c=s(74475),d=s(3599),l=s(9581),u=s(68618);const p=(0,i.Q)({name:"b2cPlansApi",commands:{downloadInvoice:r.j,refreshB2CCardInfo:n.E,requestRefund:o.E$},events:{},queries:{getB2CPlanPricing:a.W,getCancelationCouponDiscount:c.x,getRefundEligibility:d.B,getB2CCardInfo:l.t,listInvoices:u.U}})},30989:(e,t,s)=>{s.d(t,{j:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},1714:(e,t,s)=>{s.d(t,{E:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},67959:(e,t,s)=>{s.d(t,{E$:()=>p,FD:()=>c,HQ:()=>l,R0:()=>a,gR:()=>u,nW:()=>o,sT:()=>d});var i=s(13385),r=s(62149),n=s(98124),o=function(e){return e.UserIneligible30DayPolicy="USER_INELIGIBLE_FOR_FULL_REFUND_30_DAY_POLICY",e.MonthlySubscriptionIneligible="MONTHLY_SUBSCRIPTION_INELIGIBLE_FOR_FULL_REFUND",e.NoActiveSubscriptionFound="NO_ACTIVE_PAID_SUBSCRIPTION_FOUND",e.RenewalActive="RENEWAL_ACTIVE",e.SubscriptionIneligibleForRefund="SUBSCRIPTION_INELIGIBLE_FOR_REFUND",e}({});const a=(0,n.Vj)("USER_INELIGIBLE_FOR_FULL_REFUND_30_DAY_POLICY","This purchase is not within the last 30 days"),c=(0,n.Vj)("MONTHLY_SUBSCRIPTION_INELIGIBLE_FOR_FULL_REFUND","Only annual subscriptions are eligible for refund"),d=(0,n.Vj)("NO_ACTIVE_PAID_SUBSCRIPTION_FOUND","User does not have an active paid subscription"),l=(0,n.Vj)("RENEWAL_ACTIVE","User must first cancel renewal before being eligible for refund"),u=(0,n.Vj)("SUBSCRIPTION_INELIGIBLE_FOR_REFUND","This subscription is not eligible for a refund");class p extends((0,i.g)({scope:r.F.User})){}},9581:(e,t,s)=>{s.d(t,{t:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},42616:(e,t,s)=>{s.d(t,{W:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},74475:(e,t,s)=>{s.d(t,{x:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},3599:(e,t,s)=>{s.d(t,{B:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},68618:(e,t,s)=>{s.d(t,{U:()=>o,d:()=>n});var i=s(77535),r=s(62149),n=function(e){return e.NOT_LOADED="NOT_LOADED",e.LOADING="LOADING",e.READY="READY",e}({});class o extends((0,i.k)({scope:r.F.Device})){}},61746:(e,t,s)=>{s.d(t,{X:()=>X});var i=s(92336),r=s(86006),n=s(48302),o=s(77404);var a=s(41511),c=s(92587),d=s(53344),l=s(33312),u=s(78346);class p{getPlanPricing({login:e,userKey:t,couponCode:s,language:i,hasEssentials:r}){return this.serverApiClient.v1.payments.getAccessibleWebOffers({login:e,userKey:t,couponCode:s,language:i,forceFamily:!0,hasEssentials:r}).pipe((0,l.DZ)((e=>{throw new Error(`GetPlanPricing failed with error: ${e}`)})),(0,l.lk)((e=>{const{plans:t,currency:s}=e.data,{family:i,premium:r}=t,{offers:n,...o}=i,{offers:a,...c}=r,d={plans:{family:{offers:n.map((({price:e,duration:t,...s})=>({price:.01*(e??0),billingPeriod:{periodicity:this.getPeriodicity(t.unit,t.value),value:t.value},...s}))),...o},premium:{offers:a.map((({price:e,duration:t,...s})=>({price:.01*(e??0),billingPeriod:{periodicity:this.getPeriodicity(t.unit,t.value),value:t.value},...s}))),...c}},currency:s};return(0,u.Vp)(d)})))}constructor(e){this.serverApiClient=e,this.getPeriodicity=(e,t)=>"d"===e&&t>=30||"M"===e&&1===t?"monthly":"y"===e&&1===t||"M"===e&&12===t?"yearly":"other"}}p=(0,i.gn)([(0,c.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===d.l?Object:d.l])],p);class h{constructor(e){this.serverApiClient=e,this.getCancelationCouponDiscount=()=>this.serverApiClient.v1.premium.getB2CCancellationCoupon({}).pipe((0,l.DZ)((e=>{throw new Error(`GetB2CCancellationCoupon failed with error: ${e}`)})),(0,l.lk)((e=>(0,u.Vp)({couponCode:e.data.couponCode??null}))))}}h=(0,i.gn)([(0,c.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===d.l?Object:d.l])],h);var g=s(87065),m=s(60399),v=s(67959);class y{constructor(e){this.serverApiClient=e,this.checkRefundEligibility=()=>this.serverApiClient.v1.payments.grantFullRefundAndCancelSubscription({dryRun:!0}).pipe((0,g.U)((e=>(0,u.hx)(e)?(0,u.Vp)({isEligible:!1}):(0,u.Vp)({isEligible:!0})))),this.grantRefund=async()=>{const e=await(0,m.z)(this.serverApiClient.v1.payments.grantFullRefundAndCancelSubscription({dryRun:!1}));if((0,u.hx)(e)){if("BusinessError"===e.error.tag)return(e=>{switch(e){case v.nW.UserIneligible30DayPolicy:return(0,u.Rn)((0,v.R0)());case v.nW.MonthlySubscriptionIneligible:return(0,u.Rn)((0,v.FD)());case v.nW.NoActiveSubscriptionFound:return(0,u.Rn)((0,v.sT)());case v.nW.RenewalActive:return(0,u.Rn)((0,v.HQ)());case v.nW.SubscriptionIneligibleForRefund:default:return(0,u.Rn)((0,v.gR)())}})(e.error.code);throw new Error(e.error.message)}return(0,u.Vp)(void 0)}}}y=(0,i.gn)([(0,c.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===d.l?Object:d.l])],y);var S=s(3843),w=s(62149),E=s(63144),I=s(56618);class A extends((0,E.Q)({persist:!1,scope:w.F.Device,storeName:"b2c-Card-info",initialValue:{last4DigitsFormatted:"",expirationDateFormatted:"",hasCreditCardPaymentMethod:!1,isExpired:!1,billingCountry:"",cardType:""},capacity:I.Y._001KB})){}class f{populateB2CCardInfoStore(){return this.serverApiClient.v1.premium.getSubscriptionInfo({}).pipe((0,g.U)((e=>{if(!(0,u.d6)(e))throw new Error(`Cannot retrieve subscription info. Error: ${e.error} `);const{billingInformation:t}=e.data.data.b2cSubscription;return this.cardInfoStore.set({last4DigitsFormatted:this.formatCardLast4Digits(Number(t?.last4)),expirationDateFormatted:t?.exp_year&&t.exp_month?`${t.exp_month}/${t.exp_year.toString().substring(2)}`:"",hasCreditCardPaymentMethod:!!t?.last4,isExpired:this.isBillingMethodExpired(t),billingCountry:t?.country??"",cardType:t?.type??""}),(0,u.Vp)(void 0)})))}constructor(e,t){this.serverApiClient=e,this.cardInfoStore=t,this.isBillingMethodExpired=e=>!(!e?.exp_year||!e.exp_month)&&(0,S.Z)(new Date(e.exp_year,e.exp_month,0)),this.formatCardLast4Digits=e=>e.toLocaleString("en-US",{minimumIntegerDigits:4,useGrouping:!1})}}f=(0,i.gn)([(0,c.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===d.l?Object:d.l,void 0===A?Object:A])],f);var b=s(79594);class C{constructor(e,t){this.serverApiClient=e,this.serviceDownload=t,this.downloadInvoice=async e=>{const t=await(0,m.z)(this.getInvoice(e)),s=`dashlane_invoice_${e.invoiceDate.replace(/[^a-zA-Z0-9]/g,"_")}`;await this.serviceDownload.downloadFile(s,"application/pdf",t)},this.getInvoice=e=>{const{invoiceId:t,customerData:s}=e,{address:i,recipient:r,company:n,vatNumber:o}=s??{};return this.serverApiClient.v1.payments.getCustomerInvoice({invoiceId:t,address:i,recipient:r,company:n,vatNumber:o}).pipe((0,g.U)((e=>{if((0,u.hx)(e))throw new Error("cannot retrieve invoice");return e.data})))}}}C=(0,i.gn)([(0,c.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===d.l?Object:d.l,void 0===b._?Object:b._])],C);var O=s(10994),R=s(37182),T=s(25313),_=s(68618);class D extends((0,E.Q)({persist:!1,scope:w.F.Device,storeName:"invoice-list-store",initialValue:{status:_.d.NOT_LOADED},capacity:I.Y._001KB})){}class F{getInvoicesList(){return this.invoiceListStore.set({status:_.d.LOADING}),this.serverApiClient.v1.payments.listInvoices().pipe((0,g.U)((e=>{if((0,u.hx)(e))throw new Error(`couldn't retrieve invoices: ${e.error}`);const{invoices:t}=e.data.data,s=this.getInvoiceYears(t),i={invoices:t,invoiceCount:this.getInvoiceCount(t),invoiceYearsList:s};return this.invoiceListStore.set({...i,status:_.d.READY}),(0,u.Vp)(i)})),(0,R.K)((e=>(this.invoiceListStore.set({status:_.d.NOT_LOADED}),(0,T._)((()=>new Error(`Failed to load invoices: ${e.message}`)))))))}constructor(e,t){this.serverApiClient=e,this.invoiceListStore=t,this.getInvoiceYears=e=>Array.from(new Set(e.map((e=>(0,O.Z)(e.startDate).getFullYear().toString())))),this.getInvoiceCount=e=>e.length}}F=(0,i.gn)([(0,c.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===d.l?Object:d.l,void 0===D?Object:D])],F);var P=s(82874),U=s(30989);class N{async execute({body:e}){return await this.downloadInvoiceService.downloadInvoice(e),(0,u.Vp)(void 0)}constructor(e){this.downloadInvoiceService=e}}N=(0,i.gn)([(0,P.W)(U.j),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===C?Object:C])],N);var L=s(1714);class x{async execute(){return await(0,m.z)(this.cardInfoService.populateB2CCardInfoStore())}constructor(e){this.cardInfoService=e}}x=(0,i.gn)([(0,P.W)(L.E),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===f?Object:f])],x);class G{async execute(){return this.refundService.grantRefund()}constructor(e){this.refundService=e}}G=(0,i.gn)([(0,P.W)(v.E$),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===y?Object:y])],G);var k=s(41842),K=s(43978),M=s(46449),j=s(14122),V=s(42616);class W{execute(){const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.account.login"}).pipe((0,k.h)(u.d6),(0,g.U)((e=>e.data)),(0,K.w)((e=>this.webOffersService.getPlanPricing({login:e}))))}constructor(e,t){this.carbonLegacyClient=e,this.webOffersService=t}}W=(0,i.gn)([(0,M.e)(V.W),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===j._?Object:j._,void 0===p?Object:p])],W);var B=s(9581);class z{execute(){return this.cardInfoStore.state$.pipe((0,g.U)((e=>(0,u.Vp)(e))))}constructor(e){this.cardInfoStore=e}}z=(0,i.gn)([(0,M.e)(B.t),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===A?Object:A])],z);var q=s(74475);class H{execute(){return this.cancelationService.getCancelationCouponDiscount()}constructor(e){this.cancelationService=e}}H=(0,i.gn)([(0,M.e)(q.x),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h?Object:h])],H);var Y=s(3599);class Q{execute(){return this.refundService.checkRefundEligibility()}constructor(e){this.refundService=e}}Q=(0,i.gn)([(0,M.e)(Y.B),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===y?Object:y])],Q);class ${execute(){return this.listInvoicesService.getInvoicesList()}constructor(e,t){this.listInvoicesService=e,this.invoiceListStore=t}}$=(0,i.gn)([(0,M.e)(_.U),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===F?Object:F,void 0===D?Object:D])],$);class X{}X=(0,i.gn)([(0,r.Y)({api:o.c,handlers:{commands:{downloadInvoice:N,refreshB2CCardInfo:x,requestRefund:G},events:{},queries:{getB2CPlanPricing:W,getB2CCardInfo:z,getCancelationCouponDiscount:H,getRefundEligibility:Q,listInvoices:$}},imports:[a.n,n.l],providers:[p,h,f,y,F,C],stores:[A,D],requiredFeatureFlips:Object.values({CANCEL_DISCOUNT_FF:"b2c_ecommerce_web_optimize_cancel_flow_phase1",CANCEL_DISCOUNT_PHASE2_FF:"b2c_ecommerce_web_optimize_cancel_flow_phase2",ACCOUNT_REFERRAL_PHASE3_FF:"b2c_ecommerce_web_optimize_cancel_flow_phase3",CANCEL_FLOW_OPTIMIZATIONS_DEV:"b2c_ecommerce_web_optimize_cancel_flow_dev"})})],X)},65342:(e,t,s)=>{s.d(t,{y:()=>a});var i=s(75958),r=s(29688),n=s(94826),o=s(86473);const a=(0,i.Q)({name:"userConsents",commands:{UpdateConsentsCommand:r.a},events:{},queries:{getConsents:n.o,getEmailPreferenceLink:o.UE}})},29688:(e,t,s)=>{s.d(t,{a:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},94826:(e,t,s)=>{s.d(t,{o:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},86473:(e,t,s)=>{s.d(t,{UE:()=>a,Wp:()=>o});var i=s(98124),r=s(77535),n=s(62149);const o=(0,i.Vj)("no_user_for_key","No user for this subscription code");class a extends((0,r.k)({scope:n.F.User})){}},58955:(e,t,s)=>{s.d(t,{K:()=>b});var i=s(92336),r=s(86006),n=s(65342);var o=s(41511),a=s(60399),c=s(87065),d=s(6220),l=s(92587),u=s(53344),p=s(33312),h=s(78346),g=s(86473),m=s(95115);class v{async updateConsents({triggerBy:e,consents:t}){return await(0,a.z)(this.serverApiClient.v1.userconsents.updateConsents({triggerBy:e,consents:t}).pipe((0,p.DZ)((e=>{throw new Error(e.message)})))),(0,h.Vp)(void 0)}getEmailPreferenceCenterLink(){return this.getSubscriptionCode().pipe((0,c.U)((e=>e))).pipe((0,d.z)((e=>this.serverApiClient.v1.communication.getUserEmailSubscriptionInfo({userKey:e}).pipe((0,c.U)((e=>(0,h.hx)(e)?(0,h.Rn)((0,g.Wp)()):(0,h.Vp)(e.data.data.prefCenterLink)))))))}getSubscriptionCode(){const{getSubscriptionCode:e}=this.subscriptionCodeApi.queries;return e().pipe((0,c.U)((e=>{if(!(0,h.d6)(e))throw new Error(e.error.message);return(0,h.db)(e)})))}constructor(e,t){this.serverApiClient=e,this.subscriptionCodeApi=t}}v=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===u.l?Object:u.l,void 0===m._?Object:m._])],v);var y=s(82874),S=s(29688);class w{execute({body:{triggerBy:e,consents:t}}){return this.userConsentsService.updateConsents({triggerBy:e,consents:t})}constructor(e){this.userConsentsService=e}}w=(0,i.gn)([(0,y.W)(S.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===v?Object:v])],w);var E=s(46449),I=s(94826);class A{execute(){return this.serverApiClient.v1.userconsents.getConsents({format:"two-consents"}).pipe((0,p.Qn)((e=>e.data)),(0,p.DZ)((e=>{throw new Error(e.message)})))}constructor(e){this.serverApiClient=e}}A=(0,i.gn)([(0,E.e)(I.o),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===u.l?Object:u.l])],A);class f{execute(){return this.userConsentsService.getEmailPreferenceCenterLink()}constructor(e){this.userConsentsService=e}}f=(0,i.gn)([(0,E.e)(g.UE),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===v?Object:v])],f);class b{}b=(0,i.gn)([(0,r.Y)({api:n.y,imports:[o.n],providers:[v],handlers:{commands:{updateConsents:w},events:{},queries:{getConsents:A,getEmailPreferenceLink:f}},requiredFeatureFlips:[...Object.values({EMAIL_PREFERENCE_CENTER:"ecommerce_web_admin_email_preference_center"})]})],b)},97376:(e,t,s)=>{s.d(t,{R:()=>u});var i=s(75958),r=s(88504),n=s(42242),o=s(74702),a=s(1634),c=s(52648),d=s(41684),l=s(19708);const u=(0,i.Q)({name:"nudges",commands:{ValidateNudgesInstallationCommand:r.u,SendNudgeCommand:n.P,UpdateTeamNudgeCommand:o.X,UninstallNudgesCommand:a.Q},events:{},queries:{CheckNudgesInstallationQuery:c.W,GetHealthAndNudgeReportQuery:d.N,GetTeamNudgesQuery:l.w}})},42242:(e,t,s)=>{s.d(t,{P:()=>o,m:()=>n});var i=s(13385),r=s(62149);const n="SLACK_MESSAGE_NOT_DELIVERED";class o extends((0,i.g)({scope:r.F.User})){}},1634:(e,t,s)=>{s.d(t,{Q:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},74702:(e,t,s)=>{s.d(t,{X:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},88504:(e,t,s)=>{s.d(t,{u:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},52648:(e,t,s)=>{s.d(t,{W:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},41684:(e,t,s)=>{s.d(t,{N:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},19708:(e,t,s)=>{s.d(t,{w:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},22033:(e,t,s)=>{s.d(t,{_:()=>x});var i=s(92336),r=s(86006),n=s(75421),o=s(97376),a=s(5206),c=s(41511),d=s(19961),l=s(21483),u=s(82874),p=s(76500),h=s(78346),g=s(88504),m=s(25917),v=s(60399);class y{async execute({body:{authCode:e}}){try{const{adminProvisioningKey:t,teamUuid:s}=await this.getTeamIdentifiers();if(!t||!s){const t=await this.teamEnclaveClient.commands.createTeamInEnclave();if((0,h.hx)(t))throw new Error("ValidateNudgesInstallation: failed to create team "+t.error);return this.execute(new g.u({authCode:e}))}return await this.enclaveApiClient.slack.installSlackApp({adminProvisioningKey:t,slackAuthGrant:e,teamUuid:s}),(0,h.Vp)(void 0)}catch(e){throw new Error(`ValidateNudgesInstallation: ${e}`)}}async getTeamIdentifiers(){const e=await(0,v.z)(this.teamEnclaveClient.queries.getTeamIdentifiers());if((0,h.hx)(e))return{teamUuid:void 0,adminProvisioningKey:void 0};const{teamUuid:t,adminProvisioningKey:s}=(0,h.db)(e);return{teamUuid:t,adminProvisioningKey:s}}constructor(e,t){this.enclaveApiClient=e,this.teamEnclaveClient=t}}y=(0,i.gn)([(0,u.W)(g.u),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.l?Object:p.l,void 0===m.G?Object:m.G])],y);var S=s(53344),w=s(52477),E=s(17591),I=s(42242);class A{async execute({body:{type:e}}){const{testSlackMessageForAdmin:t}=this.serverApiClient.v1.integration;try{const s="welcome"===e?void 0:e,i=await(0,v.z)(t({nudge:s}));return(0,h.hx)(i)?(0,w.EQ)(i.error,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:()=>{throw new Error("Fetch Failed error")},BadStatus:E.j,InternalServerError:E.j,InvalidRequest:E.j,RateLimited:E.j,ServiceUnavailable:E.j,UnspecifiedBadStatus:E.j}):(0,h.Vp)(void 0)}catch(e){throw new Error("SendNudge: unable to send nudge"+e)}}constructor(e){this.serverApiClient=e,this.getFunctionalError=e=>{if(e===I.m)return(0,h.Rn)({tag:"SLACK_MESSAGE_NOT_DELIVERED"});throw new Error(`SendNudge: error ${e}`)}}}A=(0,i.gn)([(0,u.W)(I.P),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S.l?Object:S.l])],A);var f=s(74702);class b{async execute({body:e}){const{updateTeamNudge:t}=this.serverApiClient.v1.integration;try{const s=await(0,v.z)(t(e));if((0,h.hx)(s))throw new Error(s.error.message);return(0,h.Vp)(void 0)}catch(e){throw new Error("UpdateTeamNudge: "+e)}}constructor(e){this.serverApiClient=e}}b=(0,i.gn)([(0,u.W)(f.X),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S.l?Object:S.l])],b);var C=s(1634);class O{async execute(){try{const e=await(0,v.z)(this.teamEnclaveClient.queries.getTeamIdentifiers());if((0,h.hx)(e))throw new Error("UninstallNudges: team not provisioned in nitro");const{adminProvisioningKey:t,teamUuid:s}=(0,h.db)(e);if(!t)throw new Error("UninstallNudges: adminProvisioningKey is missing. Could not uninstall nudges");return await this.enclaveApiClient.slack.uninstallSlackApp({teamUuid:s,adminProvisioningKey:t}),(0,h.Vp)(void 0)}catch(e){throw new Error(`UninstallNudges: ${e}`)}}constructor(e,t){this.enclaveApiClient=e,this.teamEnclaveClient=t}}O=(0,i.gn)([(0,u.W)(C.Q),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.l?Object:p.l,void 0===m.G?Object:m.G])],O);var R=s(87065),T=s(46449),_=s(52648);class D{execute(){return this.teamEnclaveClient.queries.getTeamFromEnclave().pipe((0,R.U)((e=>{if((0,h.hx)(e))return(0,h.Vp)(!1);const{messageIntegrations:{slackStatus:t}}=(0,h.db)(e);return(0,h.Vp)(t)})))}constructor(e){this.teamEnclaveClient=e}}D=(0,i.gn)([(0,T.e)(_.W),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===m.G?Object:m.G])],D);var F=s(33312),P=s(41684);class U{execute({body:{numberOfDays:e}}){const{getHealthAndNudgeReport:t}=this.serverApiClient.v1.teams;return t({numberOfDays:e}).pipe((0,F.Qn)((e=>e.data)),(0,F.DZ)((e=>{throw new Error(e.message)})))}constructor(e){this.serverApiClient=e}}U=(0,i.gn)([(0,T.e)(P.N),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S.l?Object:S.l])],U);var N=s(19708);class L{execute(){const{getTeamNudges:e}=this.serverApiClient.v1.integration;return e().pipe((0,F.Qn)((e=>e.data)),(0,F.DZ)((e=>{throw new Error(e.message)})))}constructor(e){this.serverApiClient=e}}L=(0,i.gn)([(0,T.e)(N.w),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S.l?Object:S.l])],L);class x{}x=(0,i.gn)([(0,r.Y)({api:o.R,handlers:{commands:{validateNudgesInstallation:y,sendNudge:A,updateTeamNudge:b,uninstallNudges:O},events:{},queries:{checkNudgesInstallation:D,getHealthAndNudgeReport:U,getTeamNudges:L}},imports:[n.X,a.i,l.Z,c.n,d.G],providers:[],requiredFeatureFlips:["ace_tac_slack_integration"]})],x)},26131:(e,t,s)=>{s.d(t,{g:()=>d});var i=s(75958),r=s(45706),n=s(110),o=s(43302),a=s(55282),c=s(30717);const d=(0,i.Q)({name:"activityLogs",commands:{initiateActivityLogsRetrieval:r.b,loadNextActivityLogs:n.X,storeActivityLogs:o.M},events:{},queries:{activityLogs:a.I,areSensitiveLogsEnabled:c._}})},59093:(e,t,s)=>{s.d(t,{_:()=>n});var i=s(8260),r=s(26131);class n extends((0,i.E)(r.g)){}(0,i.K)(r.g,n)},45706:(e,t,s)=>{s.d(t,{b:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},110:(e,t,s)=>{s.d(t,{X:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},43302:(e,t,s)=>{s.d(t,{M:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},28275:(e,t,s)=>{s.d(t,{q:()=>i});var i=function(e){return e.SharingVaultTacAuditLogsProtectedItemRevealed="sharingVault_tac_audit_logs_protected_item_revealed",e.SetupRolloutActivityLogServerSideFiltering="setup_rollout_web_activityLogsServerSideFiltering",e}({})},55282:(e,t,s)=>{s.d(t,{I:()=>o,Q:()=>n});var i=s(77535),r=s(62149);const n={NOT_LOADED:"NOT_LOADED",LOADING:"LOADING",READY:"READY",ERROR:"ERROR"};class o extends((0,i.k)({scope:r.F.User})){}},30717:(e,t,s)=>{s.d(t,{_:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},97374:(e,t,s)=>{s.r(t),s.d(t,{ActivityLogCategory:()=>l.s,ActivityLogFeatureFlips:()=>u.q,ActivityLogType:()=>l.b,ActivityLogsClient:()=>r._,ActivityLogsQuery:()=>c.I,AnalysePasswordForRisksQuery:()=>I.S,AreSensitiveLogsEnabledQuery:()=>d._,ComputeRiskDetectionInsightsCommand:()=>w.N,GenerateAndDownloadMassDeploymentScriptCommand:()=>S.U,GenerateMassDeploymentTeamKeyCommand:()=>m.tv,GenerateMassDeploymentTeamKeyCommandErrorCodes:()=>m.rI,GetLastLogDateQuery:()=>A.k,GetMassDeploymentSecurityMonitoringConfigurationQuery:()=>f.g,GetMassDeploymentSetupInformationQuery:()=>b.a,GetRiskDetectionInsightsQuery:()=>C.p,GetRiskDetectionInsightsQueryErrorCodes:()=>R.Zq,GetSiemConfigurationErrorCode:()=>x.At,GetSiemConfigurationQuery:()=>x.pr,InitiateActivityLogsRetrievalCommand:()=>n.b,IsLoggedOutMonitoringEnabledForDeviceQuery:()=>O.m,IsLoggedOutMonitoringEnabledForDeviceQueryErrorCodes:()=>_,LoadNextActivityLogsCommand:()=>o.X,LoadingStatus:()=>c.Q,LoggedOutMonitoringClient:()=>g,LoggedOutMonitoringFeatureFlips:()=>E.q,MassDeploymentSecurityMonitoringConfigurationErrorCodes:()=>F.k,SUPPORTED_BROWSERS_TO_EXTENSION_ID_MAPPING:()=>P.NB,SUPPORTED_BROWSERS_TO_EXTENSION_PREFERENCE_DOMAINS:()=>P.Xd,SUPPORTED_BROWSERS_TO_PREFERENCE_DOMAINS:()=>P.Zf,SUPPORTED_BROWSERS_TO_UPDATE_URL_MAPPING:()=>P.m2,SUPPORTED_BROWSERS_TO_WINDOWS_REGISTRY_PATH:()=>P.Y,SUPPORTED_MASS_DEPLOYMENT_BROWSERS:()=>P.Qh,SUPPORTED_MASS_DEPLOYMENT_OSS:()=>P.I3,SUPPORTED_MASS_DEPLOYMENT_SOFTWARES:()=>P.T4,SendRiskyPasswordLoggedOutLogCommand:()=>v.r,SetSiemConfigurationCommand:()=>L.Qj,SetSiemConfigurationErrorCode:()=>L.M7,StoreActivityLogsCommand:()=>a.M,UpdateLoggedOutMonitoringActiveStatusCommand:()=>y.a,activityLogsApi:()=>i.g,createCantGetMassDeploymentTeamKeyFromBrowserPoliciesError:()=>D,createGetActivityLogsError:()=>R.LS,createInitiateActivityLogsRetrievalError:()=>R.y9,createLoadNextActivityLogsError:()=>R.We,createServerCallNotAuthorizedError:()=>F.x,createTeamNotFoundMassDeploymentError:()=>m.o1,createValidMassDeploymentTeamKeyAlreadyExistsForTeamError:()=>m.$m,getSiemGenericError:()=>x.Nv,invalidUrlError:()=>L.q0,isIntuneSetupInformationResult:()=>U.Ss,isJamfSetupInformationResult:()=>U.kv,isSupportedMassDeploymentBrowser:()=>U.US,isSupportedMassDeploymentOS:()=>U.TY,isSupportedMassDeploymentSoftware:()=>U.GI,loggedOutMonitoringApi:()=>p.i,mismatchingAdminProvisioningKeyError:()=>L.HC,noSiemConfigurationUpdateError:()=>L.$3,setSiemGenericError:()=>L.SC,siemApi:()=>N.v,teamNotFoundError:()=>L.gY});var i=s(26131),r=s(59093),n=s(45706),o=s(110),a=s(43302),c=s(55282),d=s(30717),l=s(59664),u=s(28275),p=s(70814),h=s(8260);class g extends((0,h.E)(p.i)){}(0,h.K)(p.i,g);var m=s(82583),v=s(1752),y=s(12701),S=s(36932),w=s(99173),E=s(67282),I=s(26799),A=s(21741),f=s(8641),b=s(14376),C=s(17220),O=s(95245),R=s(67522),T=s(98124),_=function(e){return e.CANT_GET_MASS_DEPLOYMENT_TEAM_KEY_FROM_BROWSER_POLICIES="CANT_GET_MASS_DEPLOYMENT_TEAM_KEY_FROM_BROWSER_POLICIES",e}({});const D=(0,T.Vj)("CANT_GET_MASS_DEPLOYMENT_TEAM_KEY_FROM_BROWSER_POLICIES","[Mass Deployment - Is Logged-out Monitoring Enabled for device] - Failed to get mass deployment team key from browser policies");var F=s(12230),P=s(31138),U=s(14921),N=s(76392),L=s(34041),x=s(41542)},70814:(e,t,s)=>{s.d(t,{i:()=>m});var i=s(75958),r=s(99173),n=s(82583),o=s(1752),a=s(12701),c=s(36932),d=s(26799),l=s(21741),u=s(8641),p=s(14376),h=s(17220),g=s(95245);const m=(0,i.Q)({name:"loggedOutMonitoring",commands:{computeRiskDetectionInsights:r.N,generateMassDeploymentTeamKey:n.tv,sendRiskyPasswordLoggedOutLog:o.r,updateLoggedOutMonitoringActiveStatus:a.a,generateAndDownloadMassDeploymentScriptCommand:c.U},events:{},queries:{analysePasswordForRisks:d.S,getLastLogDate:l.k,getMassDeploymentSecurityMonitoringConfigurationQuery:u.g,getMassDeploymentSetupInformation:p.a,getRiskDetectionInsights:h.p,isLoggedOutMonitoringEnabledForDevice:g.m}})},99173:(e,t,s)=>{s.d(t,{N:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},36932:(e,t,s)=>{s.d(t,{U:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},82583:(e,t,s)=>{s.d(t,{$m:()=>c,o1:()=>a,rI:()=>o,tv:()=>d});var i=s(13385),r=s(62149),n=s(98124),o=function(e){return e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.VALID_MASS_DEPLOYMENT_TEAM_KEY_ALREADY_EXISTS_FOR_TEAM="VALID_MASS_DEPLOYMENT_TEAM_KEY_ALREADY_EXISTS_FOR_TEAM",e}({});const a=(0,n.Vj)("TEAM_NOT_FOUND","[Mass Deployment - Generate Key] - Team not found"),c=(0,n.Vj)("VALID_MASS_DEPLOYMENT_TEAM_KEY_ALREADY_EXISTS_FOR_TEAM","[Mass Deployment - Generate Key] - A valid mass deployment team key already exists for the team");class d extends((0,i.g)({scope:r.F.User})){}},1752:(e,t,s)=>{s.d(t,{r:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},12701:(e,t,s)=>{s.d(t,{a:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},67282:(e,t,s)=>{s.d(t,{q:()=>i});var i=function(e){return e.RiskDetectionDev="setupAndRollout_web_lomo_dev",e.RiskDetectionV2Prod="lomo_web_v2-risk-detection",e.RiskDetectionV2OnDemand="lomo_web_risk-detection-capability",e}({})},26799:(e,t,s)=>{s.d(t,{S:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},21741:(e,t,s)=>{s.d(t,{k:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},8641:(e,t,s)=>{s.d(t,{g:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},14376:(e,t,s)=>{s.d(t,{a:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},17220:(e,t,s)=>{s.d(t,{p:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},95245:(e,t,s)=>{s.d(t,{m:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},67522:(e,t,s)=>{s.d(t,{LS:()=>n,We:()=>o,Zq:()=>r,y9:()=>a});var i=s(98124),r=function(e){return e.ERROR_GETTING_ACTIVITY_LOGS="ERROR_GETTING_ACTIVITY_LOGS",e.ERROR_INITIATING_ACTIVITY_LOGS_RETRIEVAL="ERROR_INITIATING_ACTIVITY_LOGS_RETRIEVAL",e.ERROR_LOADING_NEXT_ACTIVITY_LOGS="ERROR_LOADING_NEXT_ACTIVITY_LOGS",e}({});const n=(0,i.Vj)("ERROR_GETTING_ACTIVITY_LOGS","[Risk Detection Insights - get-risk-detection-insights] - Failed to get activity logs"),o=(0,i.Vj)("ERROR_LOADING_NEXT_ACTIVITY_LOGS","[Risk Detection Insights - get-risk-detection-insights] - Failed to load next activity logs"),a=(0,i.Vj)("ERROR_INITIATING_ACTIVITY_LOGS_RETRIEVAL","[Risk Detection Insights - get-risk-detection-insights] - Failed to initiate activity logs retrieval")},12230:(e,t,s)=>{s.d(t,{k:()=>r,x:()=>n});var i=s(98124),r=function(e){return e.NOT_AUTHORIZED="NOT_AUTHORIZED",e}({});const n=(0,i.Vj)("NOT_AUTHORIZED","[Mass Deployment - Update Logged-out Monitoring Active Status] - Server call not authorized")},14921:(e,t,s)=>{s.d(t,{GI:()=>r,Ss:()=>a,TY:()=>n,US:()=>o,kv:()=>c});var i=s(31138);function r(e){return"string"==typeof e&&i.T4.includes(e)}function n(e){return"string"==typeof e&&i.I3.includes(e)}function o(e){return"string"==typeof e&&i.Qh.includes(e)}function a(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&"massDeploymentPoliciesScript"in e&&"string"==typeof e.massDeploymentPoliciesScript&&"massDeploymentExtensionIDsAndUpdateURLs"in e&&"object"==typeof e.massDeploymentExtensionIDsAndUpdateURLs&&null!==e.massDeploymentExtensionIDsAndUpdateURLs&&!Array.isArray(e.massDeploymentExtensionIDsAndUpdateURLs)&&Object.keys(e.massDeploymentExtensionIDsAndUpdateURLs).every(o)&&Object.values(e.massDeploymentExtensionIDsAndUpdateURLs).every((e=>"string"==typeof e))}function c(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&"extensionPreferenceDomains"in e&&"object"==typeof e.extensionPreferenceDomains&&null!==e.extensionPreferenceDomains&&!Array.isArray(e.extensionPreferenceDomains)&&Object.keys(e.extensionPreferenceDomains).every(o)&&Object.values(e.extensionPreferenceDomains).every((e=>"string"==typeof e))&&"extensionPoliciesValue"in e&&"string"==typeof e.extensionPoliciesValue&&"browsersPreferenceDomains"in e&&"object"==typeof e.browsersPreferenceDomains&&null!==e.browsersPreferenceDomains&&!Array.isArray(e.browsersPreferenceDomains)&&Object.keys(e.browsersPreferenceDomains).every(o)&&Object.values(e.browsersPreferenceDomains).every((e=>"string"==typeof e))&&"browsersForceInstallValues"in e&&"object"==typeof e.browsersForceInstallValues&&null!==e.browsersForceInstallValues&&!Array.isArray(e.browsersForceInstallValues)&&Object.keys(e.browsersForceInstallValues).every(o)&&Object.values(e.browsersForceInstallValues).every((e=>"string"==typeof e))}},31138:(e,t,s)=>{s.d(t,{I3:()=>r,NB:()=>o,Qh:()=>n,T4:()=>i,Xd:()=>d,Y:()=>c,Zf:()=>l,m2:()=>a});const i=["jamf","microsoft-intune"],r=["macos","windows","linux"],n=["chrome","firefox","edge"],o={chrome:"fdjamakpfbbddfjaooikfcpapjohcfmg",firefox:"",edge:"gehmmocbbkpblljhkekmfhjpfbkclbph"},a={chrome:"https://clients2.google.com/service/update2/crx",firefox:"",edge:"https://edge.microsoft.com/extensionwebstorebase/v1/crx"},c={chrome:"HKLM:\\SOFTWARE\\Policies\\Google\\Chrome\\3rdparty\\extensions\\fdjamakpfbbddfjaooikfcpapjohcfmg\\policy",firefox:"",edge:"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Edge\\3rdparty\\extensions\\gehmmocbbkpblljhkekmfhjpfbkclbph\\policy"},d={chrome:"com.google.Chrome.extensions.fdjamakpfbbddfjaooikfcpapjohcfmg",edge:"com.microsoft.Edge.extensions.gehmmocbbkpblljhkekmfhjpfbkclbph",firefox:""},l={chrome:"com.google.Chrome",edge:"com.microsoft.Edge",firefox:""}},76392:(e,t,s)=>{s.d(t,{v:()=>o});var i=s(75958),r=s(34041),n=s(41542);const o=(0,i.Q)({name:"siem",commands:{setSiemConfiguration:r.Qj},events:{},queries:{getSiemConfiguration:n.pr}})},34041:(e,t,s)=>{s.d(t,{$3:()=>d,HC:()=>c,M7:()=>o,Qj:()=>p,SC:()=>u,gY:()=>a,q0:()=>l});var i=s(13385),r=s(62149),n=s(98124),o=function(e){return e.GENERIC_ERROR="GENERIC_ERROR",e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.MISMATCHING_ADMIN_PROVISIONING_KEY="MISMATCHING_ADMIN_PROVISIONING_KEY",e.NO_SIEM_CONFIGURATION_UPDATE="NO_SIEM_CONFIGURATION_UPDATE",e.INVALID_URL="INVALID_URL",e}({});const a=(0,n.Vj)("TEAM_NOT_FOUND","Team not found"),c=(0,n.Vj)("MISMATCHING_ADMIN_PROVISIONING_KEY","Mismatching admin provisioning key"),d=(0,n.Vj)("NO_SIEM_CONFIGURATION_UPDATE","There's nothing to update"),l=(0,n.Vj)("INVALID_URL","Invalid URL"),u=(0,n.Vj)("GENERIC_ERROR","Generic error");class p extends((0,i.g)({scope:r.F.User})){}},41542:(e,t,s)=>{s.d(t,{At:()=>o,Nv:()=>a,pr:()=>c});var i=s(77535),r=s(62149),n=s(98124),o=function(e){return e.GENERIC_ERROR="GENERIC_ERROR",e}({});const a=(0,n.Vj)("GENERIC_ERROR","Generic error");class c extends((0,i.k)({scope:r.F.User})){}},4184:(e,t,s)=>{s.d(t,{Z:()=>z});var i=s(92336),r=s(86006),n=s(41511),o=s(19961),a=s(26131),c=s(28275),d=s(62149),l=s(63144),u=s(56618),p=s(60018);const h=e=>!(!e||"object"!=typeof e)&&("activityLogsQueue"in e&&Array.isArray(e.activityLogsQueue));class g extends((0,l.Q)({persist:!0,storage:{initialValue:{activityLogsQueue:[]},typeGuard:h,schemaVersion:1},scope:d.F.User,storeName:"activity-logs",storeTypeGuard:h,codec:p.E,capacity:u.Y._010KB})){}var m=s(64987),v=s(43302),y=s(82874),S=s(78346),w=s(60399),E=s(14122),I=s(92587),A=s(33312);class f{get(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"state.userSession.spaceData.spaces"}).pipe((0,A.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t?.teamId&&"object"==typeof t?.details&&"string"==typeof t?.details.status}))))(e))throw new Error("Bad space item format");const t=e.find((e=>"accepted"===e.details.status)),s=t?.details.info.collectSensitiveDataAuditLogsEnabled;return Boolean(s)})))}constructor(e){this.carbonLegacyClient=e}}f=(0,i.gn)([(0,I.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E._?Object:E._])],f);const b=new m.WU;class C{async execute({body:{activityLogs:e}}){const t=await(0,w.z)(this.sensitiveLogsEnabledGetter.get());if(!(0,S.d6)(t))throw new Error("Error while getting sensitive logs enabled data");const s=e.filter((e=>!e.is_sensitive||t.data));return s.length&&await this.updateActivityLogsState(s),Promise.resolve((0,S.Vp)(void 0))}async updateActivityLogsState(e){await b.runExclusive((async()=>{const t=await this.activityLogsStore.getState();await this.activityLogsStore.set({...t,activityLogsQueue:[...t.activityLogsQueue,...e]})}))}constructor(e,t){this.activityLogsStore=e,this.sensitiveLogsEnabledGetter=t}}C=(0,i.gn)([(0,y.W)(v.M),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===g?Object:g,void 0===f?Object:f])],C);var O=s(50423),R=s(9525);class T{async isRunnable(){const{activityLogsQueue:e}=await this.activityLogsStore.getState();return e.length>0}async run(){const{activityLogsQueue:e}=await this.activityLogsStore.getState();await this.attemptSendLogsToServer(e)}async attemptSendLogsToServer(e){const t=[...e];for(;t.length>0;){const e=t.splice(0,40);await this.sendLogsToServer(e)}}async sendLogsToServer(e){const t=await this.activityLogsService.sendLogs(e);if((0,S.hx)(t))return;const s=e.map((e=>e.uuid));if(await this.removeSentLogsFromActivityLogsQueue(s),t.data?.invalidActivityLogs){const s=this.createLogsTypeMap(e),i=e=>()=>{const t=s.get(e.uuid);throw new Error(`An activity log with a log type of ${t} has been detected to have a technical/schema error. (${e.error})`)};await this.allowedToFail.do((t.data.invalidActivityLogs??[]).map(i))}}createLogsTypeMap(e){const t=new Map;return e.forEach((e=>{t.set(e.uuid,e.log_type)})),t}async removeSentLogsFromActivityLogsQueue(e){const{activityLogsQueue:t}=await this.activityLogsStore.getState(),s=t.filter((t=>!e.includes(t.uuid)));await this.activityLogsStore.set({activityLogsQueue:[...s]})}constructor(e,t,s){this.activityLogsService=e,this.allowedToFail=t,this.activityLogsStore=s}}T=(0,i.gn)([(0,I.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===R.c?Object:R.c,void 0===O.J?Object:O.J,void 0===g?Object:g])],T);var _=s(55282);class D extends((0,l.Q)({persist:!1,isCache:!0,scope:d.F.User,storeName:"activity-logs-data",initialValue:{status:_.Q.NOT_LOADED},capacity:u.Y._100KB})){}var F=s(110),P=s(43651),U=s(59664);const N=(e,t)=>{if(!t)return e;const{categories:s,domain:i,logTypes:r,login:n}=t;return e.filter((e=>{if(n&&!e.properties.author_login?.includes(n))return!1;if(s&&!s.some((t=>e.category===t)))return!1;if(r&&!r.some((t=>e.log_type===t)))return!1;if(i){const t=e.properties;if(!t.domain_url?.includes(i))return!1}return!0}))},L=e=>e.filter((e=>e.log_type===U.b.UserTypedPassword&&"safe"===e.properties.health_status?null:e)),x=e=>e.map((e=>e.category===U.s.SecurityMonitoring?{...e,category:U.s.RiskDetection}:e));class G{async execute({body:e}){const{maxResults:t,target:s="all"}=e,i=await this.logsStore.getState(),{queryInfo:r}=i;return r?.queryExecutionId&&r.nextToken?(this.logsStore.set({...i,queryInfo:{...r,nextToken:void 0},status:_.Q.LOADING}),this.loadNextActivityLogs({state:i,maxResults:t,target:s})):Promise.resolve((0,S.Vp)(void 0))}async loadNextActivityLogs({state:e,maxResults:t,target:s}){if(!e.queryInfo?.queryExecutionId||!e.queryInfo.nextToken)return Promise.resolve((0,S.Vp)(void 0));const i=await(0,w.z)(this.featureFlips.queries.userFeatureFlip({featureFlip:c.q.SetupRolloutActivityLogServerSideFiltering}));let r;if(r=(0,S.d6)(i)&&i.data?await this.activityLogService.getFilteredAuditLogsQueryResults(e.queryInfo.queryExecutionId,e.queryInfo.nextToken):await this.activityLogService.getAuditLogQueryResults({queryExecutionId:e.queryInfo.queryExecutionId,nextToken:e.queryInfo.nextToken,maxResults:t}),(0,S.hx)(r))return this.logsStore.set({status:_.Q.ERROR}),Promise.resolve((0,S.Vp)(void 0));const{logs:n,nextToken:o}=r.data,a=x(n),d="table"===s?L(N(a,e.queryInfo.filters)):N(a,e.queryInfo.filters);return 0===d.length&&o?this.loadNextActivityLogs({state:{...e,queryInfo:{...e.queryInfo,nextToken:o}},target:s}):(this.logsStore.set({...e,status:_.Q.READY,queryInfo:{...e.queryInfo,nextToken:o},logs:[...e.logs??[],...d]}),Promise.resolve((0,S.Vp)(void 0)))}constructor(e,t,s){this.logsStore=e,this.activityLogService=t,this.featureFlips=s}}G=(0,i.gn)([(0,y.W)(F.X),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===D?Object:D,void 0===R.c?Object:R.c,void 0===P.P?Object:P.P])],G);var k=s(45706);class K{async execute({body:{startDate:e,endDate:t,filters:s,target:i="all"}}){this.logsStore.set({status:_.Q.LOADING,queryInfo:{filters:s}});const r=await(0,w.z)(this.featureFlips.queries.userFeatureFlip({featureFlip:c.q.SetupRolloutActivityLogServerSideFiltering}));let n;if(n=(0,S.d6)(r)&&r.data?await this.activityLogService.startFilteredAuditLogsQuery(1e3*e,1e3*t,s?.categories,s?.logTypes):await this.activityLogService.startAuditLogQuery(e,t),(0,S.hx)(n))return this.logsStore.set({status:_.Q.ERROR}),Promise.resolve((0,S.Vp)(void 0));const{data:o}=n;let a=!1;do{const e=await this.activityLogService.getAuditLogQueryResults({queryExecutionId:o});if((0,S.hx)(e)||"CANCELLED"===e.data.state||"FAILED"===e.data.state){this.logsStore.set({status:_.Q.ERROR});break}const{state:t,nextToken:r,logs:n}=e.data;if("QUEUED"===t){await new Promise((e=>setTimeout((()=>e()),1e3)));continue}if("RUNNING"===t){await new Promise((e=>setTimeout((()=>e()),500)));continue}const c=x(n),d="table"===i?L(N(c,s)):N(c,s);this.logsStore.set({status:_.Q.READY,logs:d,queryInfo:{queryExecutionId:o,nextToken:r,filters:s}}),a=!0}while(!a);return Promise.resolve((0,S.Vp)(void 0))}constructor(e,t,s){this.logsStore=e,this.activityLogService=t,this.featureFlips=s}}K=(0,i.gn)([(0,y.W)(k.b),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===D?Object:D,void 0===R.c?Object:R.c,void 0===P.P?Object:P.P])],K);var M=s(46449),j=s(87065);class V{execute(){return this.logsStore.state$.pipe((0,j.U)((e=>(0,S.Vp)({logs:e.logs??[],hasMoreData:!!e.queryInfo?.nextToken,status:e.status}))))}constructor(e){this.logsStore=e}}V=(0,i.gn)([(0,M.e)(_.I),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===D?Object:D])],V);var W=s(30717);class B{execute(){return this.sensitiveLogsEnabledGetter.get()}constructor(e){this.sensitiveLogsEnabledGetter=e}}B=(0,i.gn)([(0,M.e)(W._),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===f?Object:f])],B);class z{}z=(0,i.gn)([(0,r.Y)({api:a.g,imports:[n.n,o.G],providers:[R.c,f],stores:[g,D],crons:[{handler:T,periodInMinutes:1,name:"activity-logs-cron",scope:d.F.User}],handlers:{commands:{initiateActivityLogsRetrieval:K,loadNextActivityLogs:G,storeActivityLogs:C},events:{},queries:{activityLogs:V,areSensitiveLogsEnabled:B}},requiredFeatureFlips:[c.q.SharingVaultTacAuditLogsProtectedItemRevealed,c.q.SetupRolloutActivityLogServerSideFiltering]})],z)},9525:(e,t,s)=>{s.d(t,{c:()=>a});var i=s(92336),r=s(92587),n=s(76500),o=s(78346);class a{async sendLogs(e){const t=await this.enclaveApiClient.auditLogs.store(e);return(0,o.hx)(t)?t:t.data.invalidAuditLogs.length?(0,o.Vp)({invalidActivityLogs:t.data.invalidAuditLogs}):(0,o.Vp)(void 0)}async startAuditLogQuery(e,t){return this.enclaveApiClient.auditLogs.queryStart({startDateRangeUnixMs:1e3*e,endDateRangeUnixMs:1e3*t})}async getAuditLogQueryResults({queryExecutionId:e,nextToken:t,maxResults:s}){const i=await this.enclaveApiClient.auditLogs.queryResults({queryExecutionId:e,nextToken:t,maxResults:s});return(0,o.hx)(i)?i:(0,o.Vp)({nextToken:i.data.nextToken??void 0,state:i.data.state,logs:i.data.results?.map((e=>JSON.parse(e)))||[]})}async startFilteredAuditLogsQuery(e,t,s,i){return this.enclaveApiClient.auditLogs.filteredQueryStart({startDateRangeUnixMs:e,endDateRangeUnixMs:t,categories:s,logTypes:i})}async getFilteredAuditLogsQueryResults(e,t){const s=await this.enclaveApiClient.auditLogs.filteredQueryResults({queryExecutionId:e,nextToken:t});return(0,o.hx)(s)?s:(0,o.Vp)({nextToken:s.data.nextToken??void 0,state:s.data.state,logs:s.data.results??[]})}constructor(e){this.enclaveApiClient=e}}a=(0,i.gn)([(0,r.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===n.l?Object:n.l])],a)},1884:(e,t,s)=>{s.d(t,{a:()=>Xe});var i=s(92336),r=s(86006),n=s(48302),o=s(40416),a=s(41511),c=s(5206),d=s(19961),l=s(70814),u=s(67282),p=s(6850),h=s(30522),g=s(63144),m=s(56618),v=s(62149),y=s(7165);const S=y.z.object({active:y.z.boolean(),teamId:y.z.number().nullable(),configuration:y.z.nullable(y.z.object({}))}),w=e=>S.safeParse(e).success,E=y.z.object({active:y.z.boolean(),teamId:y.z.number().nullable(),configuration:y.z.nullable(y.z.object({})),lastUpdateTimestamp:y.z.number()}),I=e=>E.safeParse(e).success,A=y.z.array(y.z.object({startDate:y.z.number(),endDate:y.z.number(),nLogins:y.z.number(),nWeak:y.z.number(),nCompromised:y.z.number()})),f=y.z.object({week:y.z.object({insights:y.z.object({nLogins:y.z.number().nullable(),nWeak:y.z.number().nullable(),nCompromised:y.z.number().nullable()}),history:A,lastUpdateTimestamp:y.z.number()}),month:y.z.object({insights:y.z.object({nLogins:y.z.number().nullable(),nWeak:y.z.number().nullable(),nCompromised:y.z.number().nullable()}),history:A,lastUpdateTimestamp:y.z.number()}),year:y.z.object({insights:y.z.object({nLogins:y.z.number().nullable(),nWeak:y.z.number().nullable(),nCompromised:y.z.number().nullable()}),history:A,lastUpdateTimestamp:y.z.number()}),lastLogDateTime:y.z.number().nullable(),hasLogsInLastYear:y.z.boolean(),lastRunningQueryId:y.z.string().nullable()}),b=e=>f.safeParse(e).success,C={week:{insights:{nLogins:null,nWeak:null,nCompromised:null},history:[],lastUpdateTimestamp:0},month:{insights:{nLogins:null,nWeak:null,nCompromised:null},history:[],lastUpdateTimestamp:0},year:{insights:{nLogins:null,nWeak:null,nCompromised:null},history:[],lastUpdateTimestamp:0},lastLogDateTime:0,hasLogsInLastYear:!1,lastRunningQueryId:null};class O extends((0,g.Q)({persist:!1,scope:v.F.User,storeName:"risk-detection-insights",initialValue:C,storeTypeGuard:b,capacity:m.Y._010KB})){}var R=s(60399),T=s(92587),_=s(53344),D=s(78346);class F{async check(e){const t=await this.passwordHasher.hash(e),s=await(0,R.z)(this.serverApiClient.v1.pwleak.getHashes({hashPrefix:t.substring(0,6)}));if((0,D.hx)(s))throw new Error("Error while retrieving list of hashes for password leak check");return s.data.data.includes(t)}constructor(e,t){this.serverApiClient=e,this.passwordHasher=t}}F=(0,i.gn)([(0,T.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_.l?Object:_.l,void 0===h.T?Object:h.T])],F);var P=s(76500),U=s(59664),N=s(45368);class L extends((0,g.Q)({persist:!1,scope:v.F.Device,storeName:"mass-deployment-security-monitoring-configuration-for-extension",initialValue:{active:!1,teamId:null,configuration:{},lastUpdateTimestamp:0},storeTypeGuard:I,capacity:m.Y._001KB})){}class x{async refreshStateIfOutdated(){const e=await this.configurationForExtensionStore.getState();if(0===e.lastUpdateTimestamp||e.lastUpdateTimestamp+3e5<Date.now()){const e=await this.getConfiguration();if((0,D.d6)(e)){const t={...e.data,lastUpdateTimestamp:Date.now()};return this.configurationForExtensionStore.set(t),(0,D.Vp)(t)}return(0,D.Rn)(void 0)}return(0,D.Vp)(e)}async getConfiguration(){const e=await(0,R.z)(this.serverApiClient.v1.massdeployment.getMassDeploymentSecurityMonitoringConfigForExtension());return(0,D.hx)(e)?(0,D.Rn)(void 0):(0,D.Vp)(e.data.data)}async getUsernameFromBrowserPolicies(){const e="Username";try{const t=await(0,N.U)();if("object"==typeof t&&null!==t&&e in t&&"string"==typeof t[e]&&t[e].length)return{username:t[e]}}catch(e){throw new Error("Error getting Username property from Mass-Deployed Browser Policies.")}return{username:void 0}}constructor(e,t){this.serverApiClient=e,this.configurationForExtensionStore=t}}x=(0,i.gn)([(0,T.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_.l?Object:_.l,void 0===L?Object:L])],x);class G{async sendLogs(e){const t=await this.enclaveApiClient.auditLogsMassDeployment.store(e);return(0,D.hx)(t)?(0,D.Rn)("massdeployment/storeActivityLogs failed with an unknown HTTP error"):t.data.invalidAuditLogs.length?(0,D.Vp)({invalidActivityLogs:t.data.invalidAuditLogs}):(0,D.Vp)(void 0)}async createLog({dateTime:e,domain:t,uuid:s,healthStatus:i}){try{const r=(await this.massDeploymentConfigurationForExtensionService.getUsernameFromBrowserPolicies()).username;return{uuid:s,log_type:U.b.UserTypedPassword,date_time:e,schema_version:"1.0.0",properties:{domain_url:t,author_login:r,health_status:i}}}catch{return null}}constructor(e,t){this.massDeploymentConfigurationForExtensionService=e,this.enclaveApiClient=t}}G=(0,i.gn)([(0,T.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===x?Object:x,void 0===P.l?Object:P.l])],G);var k=s(33312),K=s(52477),M=s(17591),j=s(82583);class V{generateMassDeploymentTeamKey(){return(0,R.z)(this.serverApiClient.v1.massdeployment.generateMassDeploymentTeamKey().pipe((0,k.DZ)((e=>(0,K.EQ)(e,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:M.j,BadStatus:M.j,InternalServerError:M.j,InvalidRequest:M.j,RateLimited:M.j,ServiceUnavailable:M.j,UnspecifiedBadStatus:M.j}))),(0,k.Qn)((e=>e.data))))}getFunctionalError(e){switch(e){case j.rI.TEAM_NOT_FOUND:return(0,j.o1)();case j.rI.VALID_MASS_DEPLOYMENT_TEAM_KEY_ALREADY_EXISTS_FOR_TEAM:return(0,j.$m)();default:throw new Error(`GenerateMassDeploymentTeamKey: error ${e}`)}}constructor(e){this.serverApiClient=e}}V=(0,i.gn)([(0,T.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_.l?Object:_.l])],V);var W=s(12230);class B extends((0,g.Q)({persist:!1,scope:v.F.User,storeName:"mass-deployment-security-monitoring-configuration",initialValue:{active:!1,teamId:null,configuration:{}},storeTypeGuard:w,capacity:m.Y._001KB})){}class z{async refreshState(){const e=await this.getMassDeploymentSecurityMonitoringConfiguration();return(0,D.d6)(e)&&this.massDeploymentSecurityConfigurationStore.set({...e.data}),e}async updateLoggedOutMonitoringActiveStatus(e){const t=await(0,R.z)(this.serverApiClient.v1.massdeployment.updateMassDeploymentSecurityMonitoringConfiguration({active:e}));return(0,D.hx)(t)?(0,D.Rn)((0,W.x)()):(this.refreshState(),(0,D.Vp)(void 0))}async getMassDeploymentSecurityMonitoringConfiguration(){const e=await(0,R.z)(this.serverApiClient.v1.massdeployment.getMassDeploymentSecurityMonitoringConfiguration());return(0,D.hx)(e)?(0,D.Rn)((0,W.x)()):(0,D.Vp)(e.data.data)}constructor(e,t){this.serverApiClient=e,this.massDeploymentSecurityConfigurationStore=t}}z=(0,i.gn)([(0,T.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_.l?Object:_.l,void 0===B?Object:B])],z);var q=s(162),H=s(69885),Y=s(64987),Q=s(67522),$=s(91273),X=s(6969),Z=s(11615),J=s(42094),ee=s(38027),te=s(17254),se=s(26874),ie=s(25573),re=s(80774);const ne={week:e=>(0,$.Z)({start:(0,X.Z)(e,{days:6}),end:(0,Z.Z)((0,J.Z)(e,1))}).map((e=>e.valueOf())),month:e=>(0,ee.Z)({start:(0,X.Z)(e,{weeks:4}),end:(0,te.Z)(e)},{weekStartsOn:1}).map((e=>e.valueOf())),year:e=>(0,se.Z)({start:(0,X.Z)(e,{months:11}),end:(0,ie.Z)((0,re.Z)(e,1))}).map((e=>e.valueOf()))},oe=e=>e.log_type===U.b.UserTypedWeakPassword||e.log_type===U.b.UserTypedPassword&&"weak"===e.properties.health_status,ae=e=>e.log_type===U.b.UserTypedCompromisedPassword||e.log_type===U.b.UserTypedPassword&&"compromised"===e.properties.health_status,ce=(e,t,s)=>{e.properties.author_login&&t[s].logins.add(e.properties.author_login),oe(e)?t[s].nWeak++:t[s].nCompromised++};var de=s(9525);const le=new Y.WU,ue=[U.b.UserTypedCompromisedPassword,U.b.UserTypedWeakPassword,U.b.UserTypedPassword],pe=[U.s.RiskDetection,U.s.SecurityMonitoring];class he{async getAllRiskDetectionLogsBetweenDates(e,t){let s,i,r=!1,n=[];try{const i=await this.activityLogsService.startFilteredAuditLogsQuery(e,t,pe,ue);if((0,D.hx)(i))return(0,q.D)((0,H.of)((0,D.Rn)((0,Q.y9)())));s=i.data,await this.riskDetectionInsightsStore.set({...await this.riskDetectionInsightsStore.getState(),lastRunningQueryId:s})}catch{return(0,q.D)((0,H.of)((0,D.Rn)((0,Q.y9)())))}do{const e=await this.activityLogsService.getFilteredAuditLogsQueryResults(s,i);if((0,D.hx)(e)||"FAILED"===e.data.state||"CANCELLED"===e.data.state)return(0,q.D)((0,H.of)((0,D.Rn)((0,Q.LS)())));i=e.data.nextToken,n=n.concat(e.data.logs),r=!!i||"QUEUED"===e.data.state||"RUNNING"===e.data.state,"QUEUED"!==e.data.state&&"RUNNING"!==e.data.state||await new Promise((e=>setTimeout(e,1e3)))}while(r);return await this.riskDetectionInsightsStore.set({...await this.riskDetectionInsightsStore.getState(),lastRunningQueryId:null}),(0,q.D)((0,H.of)((0,D.Vp)(n)))}async refreshRiskDetectionInsights(e){return le.runExclusive((async()=>{const{startDate:t,endDate:s,interval:i}=(e=>{const t=Date.now(),s=ne[e](t);return{startDate:s[0],endDate:t,interval:s}})(e),r=await this.riskDetectionInsightsStore.getState();if((0===r[e].lastUpdateTimestamp||r[e].lastUpdateTimestamp+3e5<Date.now())&&!r.lastRunningQueryId){const n=(await this.getAllRiskDetectionLogsBetweenDates(t,s)).pipe((0,k.lk)((t=>{const s=((e,t,s,i)=>{const r={...i},n=t.length-1;r.hasLogsInLastYear=!!e.length||i.hasLogsInLastYear,r.lastLogDateTime=e[0]?.date_time||i.lastLogDateTime;const o=[];for(let e=0;e<n;e++)o.push({startDate:t[e],endDate:t[e+1]-1,logins:new Set,nWeak:0,nCompromised:0});let a=o.length-1;for(let t=0;t<e.length;t++){const s=e[t];if((oe(s)||ae(s))&&s.date_time>=o[0].startDate){for(;s.date_time<o[a].startDate;)a--;ce(s,o,a)}}let c=new Set;var d;return r[s].history=o.map((e=>(c=new Set([...c,...e.logins]),{startDate:e.startDate,endDate:e.endDate,nWeak:e.nWeak,nCompromised:e.nCompromised,nLogins:e.logins.size}))),r[s].insights={nLogins:c.size,...(d=r[s].history,d.reduce(((e,t)=>({nWeak:e.nWeak+t.nWeak,nCompromised:e.nCompromised+t.nCompromised})),{nWeak:0,nCompromised:0}))},r[s].lastUpdateTimestamp=Date.now(),r})(t,i,e,r);return this.riskDetectionInsightsStore.set(s),(0,D.Vp)(s)})));await(0,R.z)(n)}}))}constructor(e,t){this.activityLogsService=e,this.riskDetectionInsightsStore=t}}he=(0,i.gn)([(0,T.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===de.c?Object:de.c,void 0===O?Object:O])],he);var ge=s(4184),me=s(82874),ve=s(99173);class ye{async execute({body:{timescale:e}}){return this.riskDetectionInsightsService.refreshRiskDetectionInsights(e),(0,D.Vp)(void 0)}constructor(e){this.riskDetectionInsightsService=e}}ye=(0,i.gn)([(0,me.W)(ve.N),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===he?Object:he])],ye);var Se=s(14122);class we{async execute(){const e=await this.massDeploymentTeamKeyService.generateMassDeploymentTeamKey();if((0,D.hx)(e))return e;const{massDeploymentTeamAccessKey:t,massDeploymentTeamSecretKey:s}=(0,D.db)(e);return await this.carbonLegacyClient.commands.persistMassDeploymentTeamKey({massDeploymentTeamAccessKey:t,massDeploymentTeamSecretKey:s}),(0,D.Vp)(void 0)}constructor(e,t){this.massDeploymentTeamKeyService=e,this.carbonLegacyClient=t}}we=(0,i.gn)([(0,me.W)(j.tv),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===V?Object:V,void 0===Se._?Object:Se._])],we);var Ee=s(1752);class Ie{async execute({body:e}){const t=await this.loggedOutMonitoringLogsService.createLog(e);return t&&this.loggedOutMonitoringLogsService.sendLogs([t]),(0,D.Vp)(void 0)}constructor(e){this.loggedOutMonitoringLogsService=e}}Ie=(0,i.gn)([(0,me.W)(Ee.r),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===G?Object:G])],Ie);var Ae=s(12701);class fe{async execute({body:{active:e}}){return this.massDeploymentSecurityMonitoringConfigurationService.updateLoggedOutMonitoringActiveStatus(e)}constructor(e){this.massDeploymentSecurityMonitoringConfigurationService=e}}fe=(0,i.gn)([(0,me.W)(Ae.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===z?Object:z])],fe);var be=s(79594),Ce=s(36932),Oe=s(31138),Re=s(14921);const Te=(e,t,s)=>{const i=t.reduce(((e,t)=>(e[t]=`${Oe.NB[t]};${Oe.m2[t]}`,e)),{});if("windows"===s){if(0===t.length)return;let s=`$username = $null\n# Wait for username to be populated\nwhile ($username -eq $null) {\n    $username = (Get-CimInstance Win32_Process -Filter 'name = "explorer.exe"' | Invoke-CimMethod -MethodName getowner).User\n    if ($username -is [array]) {\n        $username = $username[0]\n    }\n    $username = $username -replace ' ', '.'\n    Start-Sleep -Seconds 5 # Sleep for 5 seconds (optional)\n}\n\n$massDeploymentTeamKey = "${e}"\n`;for(const e of t){if(!(0,Re.US)(e))return;s+=`# Set the registry path for ${e}\n$registry_path_${e} = "${Oe.Y[e]}"\n$parent_path_${e} = Split-Path -Path $registry_path_${e}\n\nif (!(Test-Path $parent_path_${e})) {\n    New-Item -Path $parent_path_${e} -Force -ItemType Directory | Out-Null\n}\n\nif (!(Test-Path $parent_path_${e}\\policy)) {\n    New-Item -Path ("$parent_path_${e}\\policy") -Force -ItemType Directory | Out-Null\n}\n\n# Set the MassDeployedTeamKey and Username in the registry for ${e}\n\nSet-ItemProperty -Path $registry_path_${e} -Name "MassDeployedTeamKey" -Value $massDeploymentTeamKey\nSet-ItemProperty -Path $registry_path_${e} -Name "Username" -Value $username\nSet-ItemProperty -Path $registry_path_${e} -Name "silent_deploy" -Value 1\n`}return s+="\nexit 0",{massDeploymentPoliciesScript:s,massDeploymentExtensionIDsAndUpdateURLs:i}}},_e=(e,t,s)=>{if("macos"!==s)return;return{extensionPreferenceDomains:t.reduce(((e,t)=>(e[t]=Oe.Xd[t],e)),{}),extensionPoliciesValue:`<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">\n<plist version="1.0">\n  <dict>\n    <key>Username</key>\n      <string>$USERNAME</string>\n    <key>MassDeployedTeamKey</key>\n      <string>${e}</string>\n    <key>silent_deploy</key>\n      <true/>\n  </dict>\n</plist>\n    `,browsersPreferenceDomains:t.reduce(((e,t)=>(e[t]=Oe.Zf[t],e)),{}),browsersForceInstallValues:t.reduce(((e,t)=>(e[t]=`<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">\n<plist version="1.0">\n  <dict>\n    <key>ExtensionSettings</key>\n    <dict>\n      <key>${Oe.NB[t]}</key>\n      <dict>\n        <key>installation_mode</key>\n          <string>force_installed</string>\n        <key>update_url</key>\n          <string>${Oe.m2[t]}</string>\n      </dict>\n    </dict>\n  </dict>\n</plist>`,e)),{})}};function De(e,t,s,i){switch(t){case"microsoft-intune":return Te(e,i,s);case"jamf":return _e(e,i,s);default:return}}class Fe{areMassDeploymentTeamKeysUndefined(e){const{massDeploymentTeamAccessKey:t,massDeploymentTeamSecretKey:s}=(0,D.db)(e);return!t||!s}async execute({body:e}){const t=await(0,R.z)(this.carbonLegacyClient.queries.getMassDeploymentTeamKey());if(!(0,D.d6)(t)||this.areMassDeploymentTeamKeysUndefined(t))throw new Error("Trying to generate a MassDeployment script without a MassDeploymentTeamKey",{cause:"MassDeploymentTeamKey is not available from the CarbonLegacyClient. Either the key for this team was never generated or it was not persisted correctly in the team admin data."});const{massDeploymentTeamAccessKey:s,massDeploymentTeamSecretKey:i}=(0,D.db)(t),r=`${s}-${i}`,{targetedMassDeploymentSoftware:n,targetedBrowsers:o}=e;if("microsoft-intune"!==n)throw new Error("Trying to generate a MassDeployment script for an unsupported mass-deployment software",{cause:"The configuration provided by the admin is not supported for Mass Deployment. This is likely a bug in the UI that should have prevented this configuration from being selected."});const a=Te(r,o,"windows");if(!a)throw new Error("Something went wrong while generating the Mass Deployment script for Intune",{cause:"The targeted browsers might not be correct. This is likely a bug in the UI that should have prevented this configuration from being selected."});const c=(new TextEncoder).encode(a.massDeploymentPoliciesScript).buffer;return this.fileDownloaderService.downloadFile("Dashlane-Risk-Detection-Policies-Script.ps1","text/plain",c),(0,D.Vp)(void 0)}constructor(e,t){this.carbonLegacyClient=e,this.fileDownloaderService=t}}Fe=(0,i.gn)([(0,me.W)(Ce.U),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Se._?Object:Se._,void 0===be._?Object:be._])],Fe);var Pe=s(87065),Ue=s(46449),Ne=s(26799),Le=s(85465);class xe{execute({body:{password:e}}){const t=(e=>(0,Le.evaluate)(e).score/25<3)(e);return(0,q.D)(this.checkPasswordCompromisedService.check(e)).pipe((0,Pe.U)((e=>(0,D.Vp)({isWeak:t,isCompromised:e}))))}constructor(e){this.checkPasswordCompromisedService=e}}xe=(0,i.gn)([(0,Ue.e)(Ne.S),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===F?Object:F])],xe);var Ge=s(6136),ke=s(62760),Ke=s(21741);class Me{execute(){return this.riskDetectionInsightsStore.state$.pipe((0,Pe.U)((e=>e.lastLogDateTime?{lastLogDate:e.lastLogDateTime}:{lastLogDate:null})),(0,Ge.x)(ke.shallowEqualObjects),(0,Pe.U)(D.Vp))}constructor(e){this.riskDetectionInsightsStore=e}}Me=(0,i.gn)([(0,Ue.e)(Ke.k),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===O?Object:O])],Me);var je=s(18154),Ve=s(8641);class We{execute(){return this.massDeploymentSecurityMonitoringConfigurationStore.state$.pipe((0,Pe.U)((e=>(e.teamId||this.massDeploymentSecurityMonitoringConfigurationService.refreshState(),e))),(0,je.n)((e=>!e.teamId)),(0,Pe.U)(D.Vp))}constructor(e,t){this.massDeploymentSecurityMonitoringConfigurationService=e,this.massDeploymentSecurityMonitoringConfigurationStore=t}}We=(0,i.gn)([(0,Ue.e)(Ve.g),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===z?Object:z,void 0===B?Object:B])],We);var Be=s(14376);class ze{execute({body:e}){const t=this.carbonLegacyClient.queries.liveMassDeploymentTeamKey(void 0).pipe((0,Pe.U)((e=>{if((0,D.d6)(e)){const{massDeploymentTeamAccessKey:t,massDeploymentTeamSecretKey:s}=(0,D.db)(e);if(t&&s)return`${t}-${s}`}})),(0,Ge.x)());return e?t.pipe((0,Pe.U)((t=>t?(0,D.Vp)({massDeploymentTeamKey:t,massDeploymentSetupInformation:De(t,e.targetedMassDeploymentSoftware,e.targetedOS,e.targetedBrowsers)}):(0,D.Vp)({massDeploymentTeamKey:void 0,massDeploymentSetupInformation:void 0})))):t.pipe((0,Pe.U)((e=>(0,D.Vp)({massDeploymentTeamKey:e,massDeploymentSetupInformation:void 0}))))}constructor(e){this.carbonLegacyClient=e}}ze=(0,i.gn)([(0,Ue.e)(Be.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Se._?Object:Se._])],ze);var qe=s(10705),He=s(17220);class Ye{execute({body:{timeScale:e="week"}}){return this.riskDetectionInsightsStore.state$.pipe((0,je.n)((t=>0===t[e].lastUpdateTimestamp)),(0,Pe.U)((t=>({insights:t[e].insights,riskDetectionHistory:t[e].history,hasLogsInLastYear:t.hasLogsInLastYear,lastUpdateTimestamp:t[e].lastUpdateTimestamp}))),(0,Ge.x)(((e,t)=>(0,qe.Z)(e,t))),(0,Pe.U)(D.Vp))}constructor(e){this.riskDetectionInsightsStore=e}}Ye=(0,i.gn)([(0,Ue.e)(He.p),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===O?Object:O])],Ye);var Qe=s(95245);class $e{execute(){return(0,q.D)(this.configurationForExtensionService.refreshStateIfOutdated()).pipe((0,je.n)((e=>(0,D.d6)(e)&&0===e.data.lastUpdateTimestamp)),(0,Pe.U)((e=>(0,D.d6)(e)?(0,D.Vp)({isEnabled:!!e.data.active}):(0,D.Vp)({isEnabled:!1}))))}constructor(e){this.configurationForExtensionService=e}}$e=(0,i.gn)([(0,Ue.e)(Qe.m),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===x?Object:x])],$e);class Xe{}Xe=(0,i.gn)([(0,r.Y)({api:l.i,imports:[ge.Z,o.D,n.l,p.f,a.n,c.i,d.G],providers:[de.c,F,G,V,z,x,h.T,he],stores:[B,L,O],handlers:{commands:{computeRiskDetectionInsights:ye,generateMassDeploymentTeamKey:we,sendRiskyPasswordLoggedOutLog:Ie,updateLoggedOutMonitoringActiveStatus:fe,generateAndDownloadMassDeploymentScript:Fe},events:{},queries:{analysePasswordForRisks:xe,getLastLogDate:Me,getMassDeploymentSecurityMonitoringConfiguration:We,getMassDeploymentSetupInformation:ze,getRiskDetectionInsights:Ye,isLoggedOutMonitoringEnabledForDevice:$e}},requiredFeatureFlips:Object.values(u.q)})],Xe)},15090:(e,t,s)=>{s.d(t,{g:()=>P});var i=s(92336),r=s(86006),n=s(19961),o=s(76392),a=s(21483),c=s(20246),d=s(62149),l=s(63144),u=s(56618);const p={token:null,instanceURL:null,active:!1,siemType:null,isSelfSignedCertificateAllowed:!1};class h extends((0,l.Q)({initialValue:!1,persist:!1,scope:d.F.User,storeName:"siem-config",capacity:u.Y._001KB})){}var g=s(92587),m=s(78346),v=s(76500),y=s(25917),S=s(41542),w=s(34041),E=s(7165);const I=E.z.object({token:E.z.string().nullable(),instanceURL:E.z.string().nullable(),active:E.z.boolean(),siemType:E.z.enum(["splunk"]).nullable(),isSelfSignedCertificateAllowed:E.z.boolean()});var A=s(60399);class f{async getSiemConfiguration(){try{const{teamUuid:e,adminProvisioningKey:t}=await this.getTeamInfo(),s=await this.enclaveApiClient.siem.getSiemConfiguration({teamUuid:e,adminProvisioningKey:t});return(0,m.hx)(s)?Promise.reject((0,S.Nv)()):I.parse((0,m.db)(s))}catch(e){return Promise.reject((0,S.Nv)())}}async setSiemConfiguration(e){try{const{teamUuid:t,adminProvisioningKey:s}=await this.getTeamInfo(),i=await this.enclaveApiClient.siem.setSiemConfiguration({teamUuid:t,adminProvisioningKey:s,token:e.token??void 0,active:e.active,instanceURL:e.instanceURL??void 0,siemType:e.siemType,isSelfSignedCertificateAllowed:e.isSelfSignedCertificateAllowed??void 0});return(0,m.hx)(i)?Promise.reject((0,S.Nv)()):I.parse((0,m.db)(i))}catch(e){switch(e.message){case w.M7.INVALID_URL:return Promise.reject((0,w.q0)());case w.M7.MISMATCHING_ADMIN_PROVISIONING_KEY:return Promise.reject((0,w.HC)());case w.M7.NO_SIEM_CONFIGURATION_UPDATE:return Promise.reject((0,w.$3)());case w.M7.TEAM_NOT_FOUND:return Promise.reject((0,w.gY)());default:return Promise.reject((0,w.SC)())}}}async getTeamInfo(){const e=await(0,A.z)(this.teamEnclaveClient.queries.getTeamIdentifiers());if((0,m.hx)(e))throw new Error("TeamInfoNotFound");const{teamUuid:t,adminProvisioningKey:s}=(0,m.db)(e);if(!s)throw new Error("TeamInfoNotFound");return{teamUuid:t,adminProvisioningKey:s}}constructor(e,t){this.enclaveApiClient=e,this.teamEnclaveClient=t}}f=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===v.l?Object:v.l,void 0===y.G?Object:y.G])],f);var b=s(46449),C=s(43978);class O{execute(){return this.siemStore.state$.pipe((0,C.w)((async e=>{if(!e)try{const e=await this.siemService.getSiemConfiguration();return await this.siemStore.set(e),(0,m.Vp)(e)}catch(e){return(0,m.Vp)(p)}return(0,m.Vp)(e)})))}constructor(e,t){this.siemStore=e,this.siemService=t}}O=(0,i.gn)([(0,b.e)(S.pr),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h?Object:h,void 0===f?Object:f])],O);var R=s(82874);class T{async execute({body:e}){const{token:t,instanceURL:s,active:i,isSelfSignedCertificateAllowed:r}=e;try{const e=await this.siemService.setSiemConfiguration({active:i,instanceURL:s,token:t,siemType:"splunk",isSelfSignedCertificateAllowed:r});return this.siemConfigStore.set(e),(0,m.Vp)(void 0)}catch(e){return(0,m.Rn)(e)}}constructor(e,t){this.siemConfigStore=e,this.siemService=t}}T=(0,i.gn)([(0,R.W)(w.Qj),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h?Object:h,void 0===f?Object:f])],T);var _=s(85798),D=s(27326);class F{async handle(){await this.siemConfigStore.clear()}constructor(e){this.siemConfigStore=e}}F=(0,i.gn)([(0,_.b)(D.z),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h?Object:h])],F);class P{}P=(0,i.gn)([(0,r.Y)({api:o.v,stores:[h],providers:[f],imports:[a.Z,n.G],handlers:{commands:{setSiemConfiguration:T},events:{...(0,r.g)(c.y,{confidentialSsoSettingsReset:F})},queries:{getSiemConfiguration:O}},requiredFeatureFlips:["setup_rollout_splunk_integration_prod","setup_rollout_siem_self_signed_certificate"]})],P)},9176:(e,t,s)=>{s.d(t,{v:()=>o});var i=s(75958),r=s(31089),n=s(66769);const o=(0,i.Q)({name:"changeMasterPassword",commands:{temporarySendMasterPasswordChangedEvent:r.n},events:{masterPasswordChanged:n.D},queries:{}})},31089:(e,t,s)=>{s.d(t,{n:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},66769:(e,t,s)=>{s.d(t,{D:()=>n});var i=s(446),r=s(62149);class n extends((0,i.d)({scope:r.F.User})){}},21815:(e,t,s)=>{s.r(t),s.d(t,{ChangeSessionKeyErrorTypes:()=>l.eq,CheckSessionKeyErrorTypes:()=>A.f3,CheckSessionKeyQuery:()=>h.Z,CheckSessionSessionNotCreated:()=>A.OT,CloseUserSessionCommand:()=>o.V,CopyUserDataAndOpenSessionCommand:()=>u.k,CreateUserSessionCommand:()=>a.lk,CurrentSessionInfoQuery:()=>m.EP,DeleteLocalSessionCommand:()=>d.G,DeviceLimitQuery:()=>D.X,ExportSessionKeyQuery:()=>g.w,FlushLocalDataCommand:()=>r.e,IsAllowedQuery:()=>_.bY,LocalSessionsQuery:()=>v.a,MasterPasswordChangedEvent:()=>C.D,MultiAccountNotYetSupported:()=>c.y9,NO_USER_LOGGED_IN:()=>m.i6,NoUserLoggedInError:()=>m.Ou,NotAllowedReason:()=>_.Oq,OpenUserSessionCommand:()=>c.Dx,PlatformView:()=>D.i,PrepareLocalDataFlushCommand:()=>n.X,SESSION_FEATURE_FLIPS:()=>f.e,SelectedOpenedSessionQuery:()=>p._,SessionAlreadyExists:()=>a.X0,SessionAlreadyOpened:()=>c.mR,SessionClient:()=>I.x,SessionCloseMode:()=>y.K,SessionClosedEvent:()=>y.X,SessionClosingEvent:()=>S.Z,SessionCreationErrorTypes:()=>a.v5,SessionKeyChecker:()=>A.BD,SessionNotCreated:()=>c.aK,SessionOpenErrorTypes:()=>c.T8,SessionOpenedEvent:()=>w.M,SessionOpeningEvent:()=>E.$,SessionStates:()=>v.U,TemporarySendMasterPasswordChangedEventCommand:()=>O.n,UnableToUpdateSessionKeyForNonExistingAccount:()=>l.pX,UnableToUpdateSessionSessionNotOpened:()=>l.nA,UpdateUserSessionKeyCommand:()=>l.yt,UserNotLogged:()=>_.Fh,VaultAccessClient:()=>T.N,changeMasterPasswordApi:()=>b.v,sessionApi:()=>i.Q,vaultAccessApi:()=>R.Y});var i=s(65862),r=s(84125),n=s(73389),o=s(35985),a=s(96406),c=s(37148),d=s(21755),l=s(79168),u=s(96302),p=s(44945),h=s(60350),g=s(46767),m=s(94109),v=s(40268),y=s(91710),S=s(15175),w=s(12723),E=s(26618),I=s(63696),A=s(57096),f=s(32876),b=s(9176),C=s(66769),O=s(31089),R=s(38435),T=s(12824),_=s(89394),D=s(97411)},65862:(e,t,s)=>{s.d(t,{Q:()=>I});var i=s(75958),r=s(26618),n=s(44945),o=s(79168),a=s(94109),c=s(84125),d=s(73389),l=s(96406),u=s(37148),p=s(35985),h=s(21755),g=s(96302),m=s(60350),v=s(46767),y=s(40268),S=s(12723),w=s(15175),E=s(91710);const I=(0,i.Q)({name:"session",commands:{FlushLocalDataCommand:c.e,PrepareLocalDataFlushCommand:d.X,CreateUserSessionCommand:l.lk,OpenUserSessionCommand:u.Dx,CloseUserSessionCommand:p.V,DeleteLocalSessionCommand:h.G,CopyUserDataAndOpenSessionCommand:g.k,UpdateUserSessionKeyCommand:o.yt},queries:{selectedOpenedSession:n._,checkSessionKey:m.Z,exportSessionKey:v.w,currentSessionInfo:a.EP,localSessions:y.a},events:{SessionOpenedEvent:S.M,SessionClosingEvent:w.Z,SessionClosedEvent:E.X,SessionOpeningEvent:r.$}})},35985:(e,t,s)=>{s.d(t,{V:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},96406:(e,t,s)=>{s.d(t,{X0:()=>a,lk:()=>c,v5:()=>o});var i=s(13385),r=s(62149),n=s(98124),o=function(e){return e.AlreadyExists="alreadyExists",e}({});class a extends((0,n.Hu)("alreadyExists","The session already exists. Delete it first.")){}class c extends((0,i.g)({scope:r.F.Device})){}},21755:(e,t,s)=>{s.d(t,{G:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},84125:(e,t,s)=>{s.d(t,{e:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},96302:(e,t,s)=>{s.d(t,{k:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.Device})){}},37148:(e,t,s)=>{s.d(t,{Dx:()=>l,T8:()=>o,aK:()=>a,mR:()=>c,y9:()=>d});var i=s(13385),r=s(62149),n=s(98124),o=function(e){return e.NotCreated="notCreated",e.AlreadyOpened="alreadyOpened",e.MultiAccountNotYetSupported="multiAccountNotYetSupported",e}({});class a extends((0,n.Hu)("notCreated","The session has not been created. Create it first.")){}class c extends((0,n.Hu)("alreadyOpened","The session is already opened for this user. Close it first.")){}class d extends((0,n.Hu)("multiAccountNotYetSupported","Another session is opened. Close it first.")){}class l extends((0,i.g)({scope:r.F.Device})){}},73389:(e,t,s)=>{s.d(t,{X:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},79168:(e,t,s)=>{s.d(t,{eq:()=>o,nA:()=>c,pX:()=>a,yt:()=>d});var i=s(13385),r=s(62149),n=s(98124),o=function(e){return e.NotCreated="notCreated",e.NotOpened="notOpened",e}({});class a extends((0,n.Hu)("notCreated","The session has not been created. Create it first.")){}class c extends((0,n.Hu)("notOpened","The session has not been opened")){}class d extends((0,i.g)({scope:r.F.Device})){}},91710:(e,t,s)=>{s.d(t,{K:()=>n,X:()=>o});var i=s(446),r=s(62149),n=function(e){return e.Close="close",e.Lock="lock",e}({});class o extends((0,i.d)({scope:r.F.Device})){}},15175:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(446),r=s(62149);class n extends((0,i.d)({scope:r.F.User})){}},12723:(e,t,s)=>{s.d(t,{M:()=>n});var i=s(446),r=s(62149);class n extends((0,i.d)({scope:r.F.User})){}},26618:(e,t,s)=>{s.d(t,{$:()=>n});var i=s(446),r=s(62149);class n extends((0,i.d)({scope:r.F.User})){}},32876:(e,t,s)=>{s.d(t,{e:()=>i});const i={BrazeWithDesignSystemDev:"ecommerce_web_braze_with_design_system_dev"}},60350:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device})){}},40268:(e,t,s)=>{s.d(t,{U:()=>n,a:()=>o});var i=s(77535),r=s(62149);const n=Object.freeze({Open:"open",Closed:"closed",Opening:"opening"});class o extends((0,i.k)({scope:r.F.Device})){}},46767:(e,t,s)=>{s.d(t,{w:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},44945:(e,t,s)=>{s.d(t,{_:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.Device,useCache:!0})){}},94109:(e,t,s)=>{s.d(t,{EP:()=>c,Ou:()=>a,i6:()=>o});var i=s(77535),r=s(62149),n=s(98124);const o="no-user-logged-in",a=(0,n.Vj)(o,"User is not logged in")();class c extends((0,i.k)({scope:r.F.User,noUserError:a})){}},57096:(e,t,s)=>{s.d(t,{BD:()=>o,OT:()=>n,f3:()=>r});var i=s(98124),r=function(e){return e.SessionNotCreated="notCreated",e}({});class n extends((0,i.Hu)("notCreated","The session has not been created. Create it first.")){}class o{}},63696:(e,t,s)=>{s.d(t,{x:()=>n});var i=s(8260),r=s(65862);class n extends((0,i.E)(r.Q)){}(0,i.K)(r.Q,n)},38435:(e,t,s)=>{s.d(t,{Y:()=>o});var i=s(75958),r=s(89394),n=s(97411);const o=(0,i.Q)({name:"vaultAccess",commands:{},events:{},queries:{isAllowed:r.bY,deviceLimit:n.X}})},12824:(e,t,s)=>{s.d(t,{N:()=>n});var i=s(8260),r=s(38435);class n extends((0,i.E)(r.Y)){}(0,i.K)(r.Y,n)},97411:(e,t,s)=>{s.d(t,{X:()=>o,i:()=>n});var i=s(77535),r=s(62149),n=function(e){return e.Android="android",e.DesktopMacOS="macosx",e.DesktopWindows="windows",e.IPad="ipad",e.IPhone="iphone",e.IPod="ipod",e.Other="other",e.StandaloneExtension="saex",e.TeamAdminConsole="tac",e.WebApp="webapp",e}({});class o extends((0,i.k)({scope:r.F.User})){}},89394:(e,t,s)=>{s.d(t,{Fh:()=>a,Oq:()=>o,bY:()=>c});var i=s(77535),r=s(62149),n=s(98124),o=function(e){return e.DeviceLimited="DeviceLimited",e.Requires2FAEnforcement="Requires2FAEnforcement",e.RequiresSSO2MPMigration="RequiresSSO2MPMigration",e.RequiresMP2SSOMigration="RequiresMP2SSOMigration",e.RequiresSettingUpRecoveryKey="RequiresSettingUpRecoveryKey",e.RequiresSettingUpPin="RequiresSettingUpPin",e.RequiresChangeLoginEmail="RequiresChangeLoginEmail",e.NoActiveUser="NoActiveUser",e}({});class a extends((0,n.Hu)("UserNotLogged","Please log the user")){}class c extends((0,i.k)({scope:r.F.Device})){}},30011:(e,t,s)=>{s.d(t,{M:()=>h});var i=s(92336),r=s(86006),n=s(9176),o=s(31089),a=s(82874),c=s(78346),d=s(13800),l=s(92587);class u extends d.f{}u=(0,i.gn)([(0,l.GS)()],u);class p{execute(){return this.eventEmitter.sendEvent("masterPasswordChanged",void 0),Promise.resolve((0,c.Vp)(void 0))}constructor(e){this.eventEmitter=e}}p=(0,i.gn)([(0,a.W)(o.n),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===u?Object:u])],p);class h{}h=(0,i.gn)([(0,r.Y)({api:n.v,handlers:{commands:{temporarySendMasterPasswordChangedEvent:p},events:{},queries:{}},providers:[u]})],h)},10678:(e,t,s)=>{s.d(t,{P:()=>r});var i=s(28868);const r=e=>{const[,,t]=e.split("$");return"pbkdf2"===t?i.E1:i.mr}},91842:(e,t,s)=>{s.d(t,{h:()=>n});var i=s(35267),r=s(4035);class n extends r.b{async isUserIdle(e){return"idle"===await(0,i.q)(e)}}},4035:(e,t,s)=>{s.d(t,{b:()=>n});var i=s(92336),r=s(92587);class n{}n=(0,i.gn)([(0,r.GS)()],n)},45022:(e,t,s)=>{s.d(t,{t:()=>u});var i=s(92336),r=s(60399),n=s(14122),o=s(92587),a=s(59503),c=s(79533),d=s(33312),l=s(85603);class u{async decrypt(e){const{carbonStateList:t}=this.carbonLegacyClient.queries;return await(0,r.z)(t({paths:["userSession.session.localKey","userSession.session.masterPassword","userSession.session.serverKey"]}).pipe((0,d.nb)({success:([t,s,i])=>{if("string"==typeof t)return this.flexibleDecryptor.decrypt((0,a.u)(t),e);if("string"==typeof s&&"string"==typeof i){const t=i+s,r=(0,c.N)(t);return this.flexibleDecryptor.decrypt((0,a.u)(r),e)}throw new Error("Wrong types for local data key")},failure:()=>{throw new Error("Failure getting state list")}})))}constructor(e,t){this.carbonLegacyClient=e,this.flexibleDecryptor=t}}u=(0,i.gn)([(0,o.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===n._?Object:n._,void 0===l.a?Object:l.a])],u)},33471:(e,t,s)=>{s.d(t,{Y:()=>a});var i=s(92336),r=s(92587),n=s(45022),o=s(85107);class a{encode(e){return this.localDatKeyaEncryptor.encrypt(e)}decode(e){return this.localDataKeyDecryptor.decrypt(e)}constructor(e,t){this.localDataKeyDecryptor=e,this.localDatKeyaEncryptor=t}}a=(0,i.gn)([(0,r.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===n.t?Object:n.t,void 0===o.n?Object:o.n])],a)},85107:(e,t,s)=>{s.d(t,{n:()=>v});var i=s(92336),r=s(60399),n=s(92587),o=s(14122),a=s(33312),c=s(28868),d=s(93704),l=s(59503),u=s(79533),p=s(63352),h=s(82059),g=s(66329),m=s(10678);class v{async encrypt(e){const{carbonStateList:t}=this.carbonLegacyClient.queries;return await(0,r.z)(t({paths:["userSession.session.localKey","userSession.session.masterPassword","userSession.session.serverKey","userSession.personalSettings.CryptoFixedSalt","userSession.personalSettings.CryptoUserPayload"]}).pipe((0,a.nb)({success:([t,s,i,r,n])=>{if("string"==typeof t)return this.flexibleEncryptor.encrypt((0,l.u)(t),e,c.oo,d.gO);if("string"==typeof s&&"string"==typeof i){const t=i+s,o=(0,u.N)(t),a="string"==typeof n?(0,m.P)(n):c.mr,{saltLength:h}=a,g="string"===r?(0,p.R)(r):this.randomValuesGetter.get(h);return this.flexibleEncryptor.encrypt((0,l.u)(o),e,a,d.Nw,{salt:g})}throw new Error("Wrong types for local data key")},failure:()=>{throw new Error("Failure getting state list")}})))}constructor(e,t,s){this.carbonLegacyClient=e,this.flexibleEncryptor=t,this.randomValuesGetter=s}}v=(0,i.gn)([(0,n.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o._?Object:o._,void 0===h._?Object:h._,void 0===g.Y?Object:g.Y])],v)},7759:(e,t,s)=>{s.d(t,{_:()=>ze});var i=s(92336),r=s(86006),n=s(62149),o=s(65862),a=s(57096),c=s(32876),d=s(40416),l=s(14676),u=s(45022),p=s(85107),h=s(33471),g=s(92587),m=s(78346),v=s(87065),y=s(63144),S=s(56618),w=s(60018);const E=e=>!(!e||"object"!=typeof e)&&(0===Object.keys(e).length||Object.entries(e).every((([,e])=>"object"==typeof e&&"derivation"in e&&"salt"in e)));class I extends((0,y.Q)({storeName:"sessions-crypto-settings-store",scope:n.F.Device,capacity:S.Y._010KB,persist:!0,storage:{schemaVersion:1,initialValue:{},typeGuard:E},codec:w.E})){}class A{getConfig(e){return this.sessionsCryptoSettingsStore.state$.pipe((0,v.U)((t=>{if(e in t){const{derivation:s,salt:i}=t[e];return(0,m.Vp)({derivation:s,salt:i})}throw new Error("No crypto settings found for this user")})))}constructor(e){this.sessionsCryptoSettingsStore=e}}A=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I?Object:I])],A);var f=s(82874),b=s(63419),C=s(84125);class O{async execute(){return await this.storeFlusher.flush(),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.storeFlusher=e}}O=(0,i.gn)([(0,f.W)(C.e),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===b.X?Object:b.X])],O);var R=s(73389);class T{async execute(){return await this.storeFlusher.prepare(),Promise.resolve((0,m.Vp)(void 0))}constructor(e){this.storeFlusher=e}}T=(0,i.gn)([(0,f.W)(R.X),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===b.X?Object:b.X])],T);var _=s(14122),D=s(56742),F=s(96406),P=s(64987),U=s(60399),N=s(19911),L=s(63352),x=s(82059),G=s(93704),k=s(11458),K=s(59503);class M{encrypt(e,t,s){const{flexibleEncryptor:i}=this,{derivation:r,salt:n}=s,{algorithm:o}=r;if("noderivation"===o)throw new Error("Session key requires derivation");let a;switch(t.type){case"sso":a=(0,L.R)(t.ssoKey);break;case"mp":a=(0,k.K)((0,K.u)(t.masterPassword),(0,L.R)(t.secondaryKey??""));break;default:(0,D.U)(t)}return i.encrypt(a,e,r,G.Nw,{salt:(0,L.R)(n)})}constructor(e){this.flexibleEncryptor=e}}M=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===x._?Object:x._])],M);class j{decode(e){const t={};for(const[s,i]of Object.entries(e))t[s]={status:"closed",encryptedLocalKey:i.encryptedLocalKey};return t}async encode(e){const t={};for(const[s,i]of Object.entries(e)){if("closed"===i.status){t[s]={encryptedLocalKey:i.encryptedLocalKey};continue}if("sso"===i.sessionKey.type)continue;if(!i.localKey){t[s]={encryptedLocalKey:null};continue}const e=await(0,U.z)(this.settings.getConfig(s));if(!(0,m.d6)(e))throw new Error("Fail to get crypto settings");t[s]={encryptedLocalKey:(0,N.s)(await this.encryptor.encrypt((0,L.R)(i.localKey),i.sessionKey,e.data))}}return t}constructor(e,t){this.encryptor=e,this.settings=t}}j=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===M?Object:M,void 0===A?Object:A])],j);class V extends((0,y.Q)({storeName:"sessions-state-store",scope:n.F.Device,capacity:S.Y._010KB,persist:!0,isCache:!0,codec:j,storage:{initialValue:{},schemaVersion:2,typeGuard:e=>!0,migrateStorageSchema:()=>({})}})){}const W=new P.WU;var B=s(6220);class z{getLocalKey(e){const t=this.generate.bind(this),s=this.changeLocalKey.bind(this);return this.store.state$.pipe((0,B.z)((async i=>{if(e in i){const t=i[e];if("open"!==t.status)throw new Error("Session is not open ");const s=t.localKey;return s?(0,L.R)(s):null}const r=await t();return await s(e,r),r})))}async changeLocalKey(e,t){const{store:s}=this,i=await(0,U.z)(this.settings.getConfig(e));if(!(0,m.d6)(i))throw new Error("Fail to get crypto settings");await W.runExclusive((async()=>{const i=await s.getState();if(!(e in i))throw new Error("Session is not created");const r=i[e];if("open"!==r.status)throw new Error("Session is not open");await s.set({...i,[e]:{status:"open",localKey:t?(0,N.s)(t):null,sessionKey:r.sessionKey}})}))}async generateKeyIfNotExist(e){await(0,U.z)(this.getLocalKey(e))}async generate(){const{carbonStateList:e}=this.carbon.queries,t=await(0,U.z)(e({paths:["userSession.session.localKey"]}));if((0,m.hx)(t))throw new Error("Failure getting state list");const[s]=t.data;return"string"==typeof s?(0,K.u)(s):null}constructor(e,t,s){this.carbon=e,this.store=t,this.settings=s}}z=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_._?Object:_._,void 0===V?Object:V,void 0===A?Object:A])],z);var q=s(10678),H=s(85603);class Y extends((0,y.Q)({persist:!0,codec:w.E,scope:n.F.Device,storage:{initialValue:{},schemaVersion:0,typeGuard:e=>"object"==typeof e&&null!==e&&(!("encryptionKey"in e)||"string"==typeof e.encryptionKey)},storeName:"exported-session-keys-crypto",capacity:S.Y._001KB})){}var Q=s(34987),$=s(36041);class X{async updateAndSetEncryptionKey(){const e=await this.keyGenerator.generate();return await this.store.set({encryptionKey:(0,N.s)(e)}),e}getOrCreateEncryptionKey(){return this.store.state$.pipe((0,Q.b)((async e=>e.encryptionKey?(0,L.R)(e.encryptionKey):await this.updateAndSetEncryptionKey())))}constructor(e,t){this.store=e,this.keyGenerator=t}}X=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Y?Object:Y,void 0===$.c?Object:$.c])],X);class Z{async import(e){const t=await(0,U.z)(this.cryptoManager.getOrCreateEncryptionKey()),s=await this.flexibleDecryptor.decrypt(t,(0,L.R)(e.content)),i=(new TextDecoder).decode(s),r=JSON.parse(i);return Promise.resolve(r)}constructor(e,t){this.cryptoManager=e,this.flexibleDecryptor=t}}Z=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===X?Object:X,void 0===H.a?Object:H.a])],Z);class J{async execute({body:{sessionKey:e,email:t,personalSettings:s}}){const i="exported"===e.type?await this.importer.import(e):e,r=await this.localKeyRepository.generate(),n=r?await this.encryptor.encrypt(r,i,{derivation:(0,q.P)(s.CryptoUserPayload),salt:s.CryptoFixedSalt}):null;return W.runExclusive((async()=>{const e=await this.store.getState();if(t in e)return(0,m.Rn)(new F.X0);switch(i.type){case"mp":{await this.store.set({...e,[t]:{status:"closed",encryptedLocalKey:n?(0,N.s)(n):null}});const s=await this.carbon.commands.openSessionWithMasterPassword({login:t,password:i.masterPassword,rememberPassword:!1,requiredPermissions:void 0,serverKey:i.secondaryKey,loginType:"MasterPassword"});if((0,m.hx)(s))throw new Error("Failed to create the session in carbon");return(0,m.Vp)(void 0)}case"sso":throw new Error("Creating a SSO session in session module is not supported");default:return(0,D.U)(i)}}))}constructor(e,t,s,i,r){this.carbon=e,this.store=t,this.localKeyRepository=s,this.encryptor=i,this.importer=r}}J=(0,i.gn)([(0,f.W)(F.lk),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_._?Object:_._,void 0===V?Object:V,void 0===z?Object:z,void 0===M?Object:M,void 0===Z?Object:Z])],J);var ee=s(13800);class te extends ee.f{}te=(0,i.gn)([(0,g.GS)()],te);var se=s(91710),ie=s(35985),re=s(96498);class ne{async execute({body:{email:e}}){return await this.emitter.sendEvent("sessionClosing",void 0),await this.carbonLegacyClient.commands.carbonLegacyLeeloo({name:"closeSession",arg:[{}]}),await this.emitter.sendEvent("sessionClosed",{email:e,mode:se.K.Close}),await this.requestContextClient.commands.setActiveUser({userName:void 0}),Promise.resolve((0,m.Vp)(void 0))}constructor(e,t,s){this.emitter=e,this.requestContextClient=t,this.carbonLegacyClient=s}}ne=(0,i.gn)([(0,f.W)(ie.V),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===te?Object:te,void 0===re.Q?Object:re.Q,void 0===_._?Object:_._])],ne);var oe=s(37148);class ae{decrypt(e,t){const{flexibleDecryptor:s}=this;let i;switch(t.type){case"sso":i=(0,L.R)(t.ssoKey);break;case"mp":i=(0,k.K)((0,K.u)(t.masterPassword),(0,L.R)(t.secondaryKey??""));break;default:(0,D.U)(t)}return s.decrypt(i,e)}constructor(e){this.flexibleDecryptor=e}}ae=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===H.a?Object:H.a])],ae);class ce{async execute({body:{email:e,sessionKey:t,rememberPassword:s}}){const i="exported"===t.type?await this.importer.import(t):t;if("sso"===i.type)throw new Error("not implemented");const{sessionStore:r,carbon:n}=this;return await W.runExclusive((async()=>{const t=await r.getState();if(!(e in t))return(0,m.Rn)(new oe.aK);if(Object.values(t).some((e=>"open"===e.status)))return(0,m.Rn)(new oe.y9);const o=t[e];if("open"===o.status||"opening"===o.status)return(0,m.Rn)(new oe.mR);await r.set({...t,[e]:{status:"opening",sessionKey:i,localKey:o.encryptedLocalKey?(0,N.s)(await this.sessionKeyDecryptor.decrypt((0,L.R)(o.encryptedLocalKey),i)):null}});let a=!1;try{const t=await n.commands.openSessionWithMasterPassword({login:e,password:i.masterPassword,rememberPassword:s,requiredPermissions:void 0,serverKey:i.secondaryKey,loginType:"MasterPassword"});if(!(0,m.d6)(t))throw new Error("Failed to open session in carbon");return a=!0,(0,m.Vp)(void 0)}finally{a||await r.set(t)}}))}constructor(e,t,s,i){this.carbon=e,this.sessionStore=t,this.sessionKeyDecryptor=s,this.importer=i}}ce=(0,i.gn)([(0,f.W)(oe.Dx),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_._?Object:_._,void 0===V?Object:V,void 0===ae?Object:ae,void 0===Z?Object:Z])],ce);var de=s(6136),le=s(46449),ue=s(40268),pe=s(44945);class he{execute(){return this.sessionsStateStore.state$.pipe((0,v.U)((e=>{let t;for(const s in e)e[s].status===ue.U.Open&&(t=s);return t})),(0,de.x)(),(0,v.U)(m.Vp))}constructor(e){this.sessionsStateStore=e}}he=(0,i.gn)([(0,le.e)(pe._),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===V?Object:V])],he);var ge=s(21755);class me{execute(){return Promise.resolve((0,m.Vp)(void 0))}}me=(0,i.gn)([(0,f.W)(ge.G)],me);var ve=s(86308);class ye{verify(e,t){const{flexibleVerifier:s}=this;let i;switch(t.type){case"sso":i=(0,L.R)(t.ssoKey);break;case"mp":i=(0,k.K)((0,K.u)(t.masterPassword),(0,L.R)(t.secondaryKey??""));break;default:(0,D.U)(t)}return s.verifySignature(i,e)}constructor(e){this.flexibleVerifier=e}}ye=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ve.y?Object:ve.y])],ye);class Se extends a.BD{async checkSessionKey(e,t){if("mp"!==t.type)return(0,m.Vp)(!0);const s=await(0,U.z)(this.sessionsStateStore.state$);if(!(e in s))return(0,m.Vp)(!0);const i=s[e];if("open"===i.status||"opening"===i.status)return(0,m.Vp)(function(e,t){switch(e.type){case"mp":return"mp"===t.type&&e.masterPassword===t.masterPassword&&e.secondaryKey===t.secondaryKey;case"sso":return"sso"===t.type&&e.ssoKey===t.ssoKey;default:(0,D.U)(e)}}(i.sessionKey,t));if(!i.encryptedLocalKey)return(0,m.Vp)(!0);const r=(0,L.R)(i.encryptedLocalKey);return(0,m.Vp)(await this.verifier.verify(r,t))}constructor(e,t){super(),this.sessionsStateStore=e,this.verifier=t}}Se=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===V?Object:V,void 0===ye?Object:ye])],Se);var we=s(60350),Ee=s(162);class Ie{execute({body:{email:e,sessionKey:t}}){return(0,Ee.D)(this.checker.checkSessionKey(e,t))}constructor(e){this.checker=e}}Ie=(0,i.gn)([(0,le.e)(we.Z),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.BD?Object:a.BD])],Ie);var Ae=s(40923),fe=s(85798);class be{async handle({body:{user:e}}){await W.runExclusive((async()=>{const t=await this.store.getState();delete t[e],await this.store.set(t)}))}constructor(e){this.store=e}}be=(0,i.gn)([(0,fe.b)(Ae.E1),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===V?Object:V])],be);var Ce=s(79168);class Oe{async execute({body:{email:e,sessionKey:t}}){const s="exported"===t.type?await this.importer.import(t):t;return await W.runExclusive((async()=>{const t=await this.store.getState();if(!(e in t))return(0,m.Rn)(new Ce.pX);const i=t[e];return"closed"===i.status?(0,m.Rn)(new Ce.nA):(t[e]={status:"open",localKey:i.localKey,sessionKey:s},await this.store.set(t),(0,m.Vp)(void 0))}))}constructor(e,t){this.store=e,this.importer=t}}Oe=(0,i.gn)([(0,f.W)(Ce.yt),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===V?Object:V,void 0===Z?Object:Z])],Oe);var Re=s(4035);class Te{async run(){await this.carbonLegacyClient.commands.carbonLegacyLeeloo({name:"closeSession",arg:[{}]})}async isRunnable(){const e=await(0,U.z)(this.carbonLegacyClient.queries.getPremiumStatus());if(!(0,m.d6)(e)||!e.data.spaces)return!1;const t=e.data.spaces.find((e=>"accepted"===e.status)),s=t?.info.forceAutomaticLogout;if(!s)return!1;return await this.conf.isUserIdle(60*s)}constructor(e,t){this.carbonLegacyClient=e,this.conf=t}}Te=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_._?Object:_._,void 0===Re.b?Object:Re.b])],Te);var _e=s(28868);class De{async export(e){const t=JSON.stringify(e),s=(new TextEncoder).encode(t),i=await(0,U.z)(this.cryptoManager.getOrCreateEncryptionKey()),r=await this.flexibleEncryptor.encrypt(i,s,_e.oo,G.gO);return Promise.resolve({type:"exported",content:(0,N.s)(r)})}constructor(e,t){this.cryptoManager=e,this.flexibleEncryptor=t}}De=(0,i.gn)([(0,g.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===X?Object:X,void 0===x._?Object:x._])],De);var Fe=s(46767);class Pe{execute(){return this.store.state$.pipe((0,Q.b)((async e=>{let t;for(const s in e)e[s].status===ue.U.Open&&(t=s);if(!t)throw new Error("No opened session");const s=e[t];if("open"!==s.status)throw new Error("No opened session");return(0,m.Vp)(await this.exporter.export(s.sessionKey))})))}constructor(e,t){this.store=e,this.exporter=t}}Pe=(0,i.gn)([(0,le.e)(Fe.w),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===V?Object:V,void 0===De?Object:De])],Pe);var Ue=s(94109),Ne=s(86596);class Le{execute(){return this.repository.getInfos().pipe((0,v.U)((({analytics:e,deviceAccessKey:t,login:s,deviceKeys:i,publicUserId:r})=>(0,m.Vp)({analytics:e,deviceAccessKey:t,login:s,deviceKeys:i,publicUserId:r}))))}constructor(e){this.repository=e}}Le=(0,i.gn)([(0,le.e)(Ue.EP),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ne.h?Object:Ne.h])],Le);var xe=s(7303),Ge=s(85390);class ke{execute(){return(0,Ge.a)([this.carbon.queries.carbonStateList({paths:["authentication.localUsers"]}),this.store.state$]).pipe((0,v.U)((([e,t])=>{if(!(0,m.d6)(e))throw new Error("failed to get data from carbon");const[s]=e.data,i=Object.entries(t).reduce(((e,[t,i])=>({...e,[t]:(0,xe.Ay)({login:t,deviceAccessKey:s[t].deviceAccessKey,state:i.status})})),(0,xe.Ay)({}));return(0,m.Vp)(i)})))}constructor(e,t){this.carbon=e,this.store=t}}ke=(0,i.gn)([(0,le.e)(ue.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_._?Object:_._,void 0===V?Object:V])],ke);var Ke=s(55980),Me=s(12100),je=s(96302);class Ve{async execute({body:{currentEmail:e,newEmail:t,personalSettings:s}}){const i=await this.store.getState();if(!(e in i)||"open"!==i[e].status)return(0,m.Rn)({tag:"Current email is not authenticated"});const{localKey:r,sessionKey:n}=i[e];if("sso"===n.type)return(0,m.Rn)({tag:"SSO not supported yet"});const{analytics:o,deviceKeys:a,cryptoSettings:c}=await(0,U.z)(this.currentSessionInfoRepository.getInfos()),d=await this.deviceRegistration.commands.registerDevice({with:"deviceKeys",deviceAccessKey:a.accessKey,deviceSecretKey:a.secretKey,login:t,settings:s.content,userAnalyticsId:o.userId});if(!(0,m.d6)(d))return(0,m.Rn)({tag:`Device registration failed with code: ${d.error.tag}`});const l=r?await this.encryptor.encrypt((0,K.u)(r),n,{derivation:(0,q.P)(c.cryptoUserPayload),salt:c.cryptoFixedSalt}):null,u=await this.cryptoSettingsStore.getState();await this.cryptoSettingsStore.set({...u,[t]:{derivation:(0,q.P)(c.cryptoUserPayload),salt:c.cryptoFixedSalt}}),await this.store.set({...i,[e]:{status:"closed",encryptedLocalKey:l?(0,N.s)(l):null},[t]:{status:"closed",encryptedLocalKey:l?(0,N.s)(l):null}});try{const e=await this.carbon.commands.openSessionWithMasterPassword({login:t,password:n.masterPassword,rememberPassword:!1,serverKey:n.secondaryKey,loginType:"MasterPassword"});if((0,m.hx)(e))return(0,m.Rn)({tag:"Failed to open session in carbon"})}catch(e){return(0,m.Rn)({tag:"Failed to open session in carbon"})}return(0,m.Vp)(void 0)}constructor(e,t,s,i,r,n){this.carbon=e,this.store=t,this.encryptor=s,this.currentSessionInfoRepository=i,this.deviceRegistration=r,this.cryptoSettingsStore=n}}Ve=(0,i.gn)([(0,f.W)(je.k),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_._?Object:_._,void 0===V?Object:V,void 0===M?Object:M,void 0===Ne.h?Object:Ne.h,void 0===Me.z?Object:Me.z,void 0===I?Object:I])],Ve);var We=s(66329);class Be{async getUserCryptoSettings(){const{getUserCryptoSettings:e}=this.carbon.queries,t=await(0,U.z)(e());if(!(0,m.d6)(t))throw new Error("Fail to fetch crypto settings from carbon");const{cryptoUserPayload:s,cryptoFixedSalt:i}=t.data;return{cryptoUserPayload:s,cryptoFixedSalt:i}}async getSessionKey(e){const{getMasterPasswordAndServerKey:t,getIsSSOUser:s}=this.carbon.queries,i=await(0,U.z)(s());if(!(0,m.d6)(i))throw new Error("Fail to fetch is sso user from carbon");if(i.data||e)return{type:"sso",ssoKey:""};const r=await(0,U.z)(t());if(!(0,m.d6)(r))throw new Error("Fail to fetch master password and server key from carbon");const{password:n,serverKey:o}=r.data;return{type:"mp",masterPassword:n,secondaryKey:o}}async handleLogin(e,t){const s=await W.runExclusive((async()=>{const{cryptoUserPayload:s,cryptoFixedSalt:i}=await this.getUserCryptoSettings(),r=s?(0,q.P)(s):_e.mr,n=i||(0,N.s)(this.randomValuesGetter.get(r.saltLength)),o=await this.sessionsCryptoSettingsStore.getState();this.sessionsCryptoSettingsStore.set({...o,[e]:{derivation:r,salt:n}});const a=await this.getSessionKey(t),c=await this.sessionsStateStore.getState(),d=await this.localKeyRepo.generate();if(e in c)await this.sessionsStateStore.set({...c,[e]:{status:"open",sessionKey:a,localKey:d?(0,N.s)(d):null}});else{const t={status:"open",sessionKey:a,localKey:d?(0,N.s)(d):null};await this.sessionsStateStore.set({...c,[e]:t})}return a}));await this.context.commands.setActiveUser({userName:e}),await this.eventEmitter.sendEvent("sessionOpening",void 0),await this.eventEmitter.sendEvent("sessionOpened",{sessionKey:s,login:e})}async handleLogout(){const e=new Array;await W.runExclusive((async()=>{const t=await this.sessionsStateStore.getState(),s={};for(const[i,r]of Object.entries(t)){if("closed"===r.status){s[i]=r;continue}if("sso"===r.sessionKey.type){e.push(i);continue}const t=await(0,U.z)(this.settings.getConfig(i));if(!(0,m.d6)(t))throw new Error("Fail to get crypto settings");const n=t.data,o=r.localKey?(0,N.s)(await this.encryptor.encrypt((0,L.R)(r.localKey),r.sessionKey,n)):null;s[i]={status:"closed",encryptedLocalKey:o},e.push(i)}await this.sessionsStateStore.set(s)}));for(const t of e)await this.eventEmitter.sendEvent("sessionClosed",{mode:se.K.Close,email:t})}async handle(e){if("carbonLoginStatusChanged"===e.body.eventName){const t=e.body.eventData;t.loggedIn?await this.handleLogin(t.login,!!t.needsSSOMigration):await this.handleLogout()}"openSessionFailed"===e.body.eventName&&this.handleLogout()}constructor(e,t,s,i,r,n,o,a,c){this.carbon=e,this.sessionsStateStore=t,this.sessionsCryptoSettingsStore=s,this.eventEmitter=i,this.randomValuesGetter=r,this.localKeyRepo=n,this.encryptor=o,this.settings=a,this.context=c}}Be=(0,i.gn)([(0,fe.b)(Ae.Dj),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_._?Object:_._,void 0===V?Object:V,void 0===I?Object:I,void 0===te?Object:te,void 0===We.Y?Object:We.Y,void 0===z?Object:z,void 0===M?Object:M,void 0===A?Object:A,void 0===re.Q?Object:re.Q])],Be);class ze{}ze=(0,i.gn)([(0,r.Y)({api:o.Q,crons:[{handler:Te,periodInMinutes:1,name:"close-session-idle-cron",scope:n.F.User}],handlers:{commands:{flushLocalData:O,prepareLocalDataFlush:T,closeUserSession:ne,createUserSession:J,openUserSession:ce,deleteLocalSession:me,copyUserDataAndOpenSession:Ve,updateUserSessionKey:Oe},events:{...(0,r.g)(l.W,{carbonLegacy:Be,CarbonLegacyDeviceRemotelyDeleted:be})},queries:{selectedOpenedSession:he,checkSessionKey:Ie,exportSessionKey:Pe,currentSessionInfo:Le,localSessions:ke}},providers:[te,u.t,p.n,h.Y,z,ae,M,ye,A,j,Ne.h,Ke.w,{provide:a.BD,useClass:Se},De,Z,X],exports:[u.t,p.n,h.Y,a.BD,Ne.h,Ke.w],stores:[V,I,Y],imports:[d.D],configurations:{session:{token:Re.b}},requiredFeatureFlips:Object.values(c.e)})],ze)},55980:(e,t,s)=>{s.d(t,{w:()=>a});var i=s(92336),r=s(92587),n=s(86596),o=s(60399);class a{async getDeviceCredentialsForUser(e){const t=await(0,o.z)(this.repository.getInfos());if(t.login!==e)throw new Error("Cant get the credentials of another user");return{deviceAccessKey:t.deviceKeys.accessKey,deviceSecretKey:t.deviceKeys.secretKey,login:t.login}}constructor(e){this.repository=e}}a=(0,i.gn)([(0,r.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===n.h?Object:n.h])],a)},86596:(e,t,s)=>{s.d(t,{h:()=>l});var i=s(92336),r=s(43978),n=s(14122),o=s(92587),a=s(78346),c=s(7303);function d(e,t){if((s=e)&&"object"==typeof s&&"accessKey"in s&&"secretKey"in s&&"string"==typeof s.accessKey&&"string"==typeof s.secretKey)return e;var s;if(function(e){return"string"==typeof e}(t))return function(e){const t=e.split("-");if(t.length>0){const[s]=t;return{accessKey:s,secretKey:e}}throw new Error("Invalid UKI format")}(t);throw new Error("unable to get device keys")}class l{getInfos(){return this.carbon.queries.carbonStateList({paths:["userSession.account.login","authentication.currentUser.deviceKeys","userSession.localSettings.uki","userSession.session.analyticsIds","userSession.session.publicUserId","userSession.personalSettings.CryptoUserPayload","userSession.personalSettings.CryptoFixedSalt"]}).pipe((0,r.w)((async e=>{if(!(0,a.d6)(e))throw new Error("failed to get carbon data");const[t,s,i,r,n,o,l]=e.data;if(!((u=r)&&"object"==typeof u&&"userAnalyticsId"in u&&"deviceAnalyticsId"in u&&"string"==typeof u.userAnalyticsId&&"string"==typeof u.deviceAnalyticsId))throw new Error("analytics not of type string");var u;const p=d(s,i);return(0,c.Ay)({login:String(t),deviceAccessKey:p.accessKey,analytics:{deviceId:r.deviceAnalyticsId,userId:r.userAnalyticsId},deviceKeys:p,publicUserId:n,cryptoSettings:{cryptoUserPayload:o,cryptoFixedSalt:l}})})))}constructor(e){this.carbon=e}}l=(0,i.gn)([(0,o.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===n._?Object:n._])],l)},89175:(e,t,s)=>{s.d(t,{r:()=>Z});var i=s(92336),r=s(86006),n=s(55385),o=s(38435),a=s(87065),c=s(46449),d=s(78346),l=s(89394),u=s(43978),p=s(69885),h=s(37182),g=s(89618),m=s(85390),v=s(6136),y=s(62760),S=s(92587),w=s(9363),E=s(63696),I=s(14122),A=s(56186);const f=e=>!!e?.name&&e.name!==A.s.DeviceLimitDone&&e.name!==A.s.OpeningSessionAfterDeviceLimitRemoval;var b=s(54691);class C{check(){const{liveLoginDeviceLimitFlow:e}=this.carbon.queries;return e(void 0).pipe((0,a.U)((e=>{if(!(0,d.d6)(e))return console.log("loginDeviceLimitFlow query has failed"),this.anomalyReporter.commands.reportAnomaly({criticality:"warning",message:"loginDeviceLimitFlow query has failed",moduleName:"vault-access",useCaseName:"isAllowedQuery",applicationComponent:"",anomalyType:"other"}),[];return f(e.data)?[l.Oq.DeviceLimited]:[]})))}constructor(e,t){this.carbon=e,this.anomalyReporter=t,this.name="device-limit"}}C=(0,i.gn)([(0,S.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I._?Object:I._,void 0===b.G?Object:b.G])],C);var O=s(8260),R=s(78443);class T extends((0,O.E)(R.j)){}(0,O.K)(R.j,T);const _={masterPassword:!1,invisibleMasterPassword:!0};class D{check(e){if(!e)throw new Error("No user login provided");const{getAccountAuthenticationType:t}=this.carbon.queries,s=t(),i=this.ark.queries.accountRecoveryKeyStatus({login:e});return(0,m.a)({accountAuthenticationType:s,accountRecoveryKeyStatus:i}).pipe((0,a.U)((({accountAuthenticationType:e,accountRecoveryKeyStatus:t})=>{if(!(0,d.d6)(e)||!(0,d.d6)(t))return console.log("One of these queries has failed: [accountAuthenticationType, accountRecoveryKeyStatus]"),this.anomalyReporter.commands.reportAnomaly({criticality:"warning",message:"One of these queries has failed: [accountAuthenticationType, accountRecoveryKeyStatus]",moduleName:"vault-access",useCaseName:"isAllowedQuery",applicationComponent:"",anomalyType:"other"}),[];return _[e.data]&&!t.data.isEnabled?[l.Oq.RequiresSettingUpRecoveryKey]:[]})))}constructor(e,t,s){this.carbon=e,this.ark=t,this.anomalyReporter=s,this.name="enforce-ark"}}D=(0,i.gn)([(0,S.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I._?Object:I._,void 0===T?Object:T,void 0===b.G?Object:b.G])],D);var F=s(16623);const P={masterPassword:!1,invisibleMasterPassword:!0};class U{check(e){if(!e)throw new Error("No user login provided");const{getAccountAuthenticationType:t}=this.carbon.queries,s=t(),i=this.pinCode.queries.getCurrentUserStatus();return(0,m.a)({accountAuthenticationType:s,pinCodeStatus:i}).pipe((0,a.U)((({accountAuthenticationType:e,pinCodeStatus:t})=>{if(!(0,d.d6)(e)||!(0,d.d6)(t))return console.log("One of these queries has failed: [accountAuthenticationType, pinCodeStatus]"),this.anomalyReporter.commands.reportAnomaly({criticality:"warning",message:"One of these queries has failed: [accountAuthenticationType, pinCodeStatus]",moduleName:"vault-access",useCaseName:"isAllowedQuery",applicationComponent:"",anomalyType:"other"}),[];return P[e.data]&&!t.data.isPinCodeEnabled?[l.Oq.RequiresSettingUpPin]:[]})))}constructor(e,t,s){this.carbon=e,this.pinCode=t,this.anomalyReporter=s,this.name="enforce-pin"}}U=(0,i.gn)([(0,S.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I._?Object:I._,void 0===F.u?Object:F.u,void 0===b.G?Object:b.G])],U);var N=s(41842),L=s(83695),x=s(34445);class G{check(){const{liveTwoFactorAuthenticationInfo:e}=this.carbon.queries;return e(void 0).pipe((0,N.h)((e=>!(0,d.d6)(e)||(e.data.status===x.dN.READY||e.data.status===x.dN.ERROR))),(0,a.U)((e=>{if(!(0,d.d6)(e))throw new Error("twoFactorAuthenticationInfo query has failed");return e.data.status===x.dN.READY&&e.data.shouldEnforceTwoFactorAuthentication?[l.Oq.Requires2FAEnforcement]:[]})),(0,L.O)([]),(0,v.x)(((e,t)=>(0,y.shallowEqualArrays)(e,t))))}constructor(e){this.carbon=e,this.name="enforce-two-factor-authentication"}}G=(0,i.gn)([(0,S.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I._?Object:I._])],G);var k=s(20491),K=s(30153),M=s(95255);const j={[M.vX.MP_TO_SSO]:l.Oq.RequiresMP2SSOMigration,[M.vX.MP_TO_SSO_WITH_INFO]:l.Oq.RequiresMP2SSOMigration,[M.vX.SSO_TO_MP]:l.Oq.RequiresSSO2MPMigration};class V{check(){const{getProviderInfo:e}=this.authentication.queries;return e(void 0).pipe((0,a.U)((e=>(0,d.d6)(e)?void 0!==e.data.migrationType?[j[e.data.migrationType]]:[]:(console.log("ssoMigrationType query has failed"),this.anomalyReporter.commands.reportAnomaly({criticality:"warning",message:"ssoMigrationType query has failed",moduleName:"vault-access",useCaseName:"SsoMigrationCheckerService",applicationComponent:"",anomalyType:"other"}),[]))))}constructor(e,t){this.authentication=e,this.anomalyReporter=t,this.name="sso-migration"}}V=(0,i.gn)([(0,S.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===k||void 0===K.e?Object:K.e,void 0===b.G?Object:b.G])],V);var W=s(57978);class B extends((0,O.E)(W.v)){}(0,O.K)(W.v,B);class z{check(){return this.accountManagement.queries.pendingLoginChangeRequests().pipe((0,a.U)((e=>(0,d.d6)(e)?e.data.length>0?[l.Oq.RequiresChangeLoginEmail]:[]:(console.log("pendingLoginChangeRequests query has failed"),this.anomalyReporter.commands.reportAnomaly({criticality:"warning",message:"pendingLoginChangeRequests query has failed",moduleName:"vault-access",useCaseName:"ChangeLoginEmailCheckerService",applicationComponent:"",anomalyType:"other"}),[]))))}constructor(e,t){this.accountManagement=e,this.anomalyReporter=t,this.name="change-login-email"}}function q(e,t){return e.isAllowed===t.isAllowed&&(!(!e.isAllowed&&!t.isAllowed)||(0,y.shallowEqualArrays)(e.reasons,t.reasons))}z=(0,i.gn)([(0,S.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===B?Object:B,void 0===b.G?Object:b.G])],z);const H={isAllowed:!0};class Y{execute(){const{selectedOpenedSession:e}=this.session.queries;return e(void 0).pipe((0,u.w)((e=>{if(!(0,d.d6)(e))throw new Error("Failed to get active user's login");if(!e.data)return(0,p.of)({isAllowed:!1,reasons:[l.Oq.NoActiveUser]});const t=this.postLoginRequirements.map((t=>t.check(e.data).pipe((0,h.K)((()=>(console.log(`${t.name} query has failed`),this.exceptionLogger.captureException(new Error(`${t.name} query has failed`),{useCaseName:"isAllowedQuery"}),(0,p.of)([])))),(0,g.V)({first:3e3,with:()=>(console.log(`${t.name} query has timed out`),this.exceptionLogger.captureException(new Error(`${t.name} query has timed out`),{useCaseName:"isAllowedQuery"}),(0,p.of)([]))}))));return(0,m.a)(t).pipe((0,a.U)((e=>{const t=Array.from(new Set(e.flat())).sort();return t.length>0?{isAllowed:!1,reasons:t}:H})))})),(0,v.x)(q))}constructor(e,t,s,i,r,n,o,a){this.session=e,this.exceptionLogger=t,this.postLoginRequirements=[s,i,r,n,o,a]}}Y=(0,i.gn)([(0,S.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E.x?Object:E.x,void 0===w.v?Object:w.v,void 0===C?Object:C,void 0===D?Object:D,void 0===U?Object:U,void 0===G?Object:G,void 0===V?Object:V,void 0===z?Object:z])],Y);class Q{execute(){return this.postLoginRequirementsChecker.execute().pipe((0,a.U)(d.Vp))}constructor(e){this.postLoginRequirementsChecker=e}}Q=(0,i.gn)([(0,c.e)(l.bY),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Y?Object:Y])],Q);var $=s(97411);class X{execute(){const{liveLoginDeviceLimitFlow:e}=this.carbon.queries;return e(void 0).pipe((0,a.U)((e=>{if(!(0,d.d6)(e))throw new Error("liveLoginDeviceLimitFlow failed");return(0,d.Vp)({isLimited:f(e.data)})})))}constructor(e){this.carbon=e}}X=(0,i.gn)([(0,c.e)($.X),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I._?Object:I._])],X);class Z{}Z=(0,i.gn)([(0,r.Y)({api:o.Y,handlers:{commands:{},events:{},queries:{isAllowed:Q,deviceLimit:X}},providers:[C,Y,G,D,U,V,z],imports:[n.G]})],Z)},13252:(e,t,s)=>{s.d(t,{IP:()=>u,Iy:()=>a,Uv:()=>d,bd:()=>c,dg:()=>p,i:()=>h,qb:()=>n,y$:()=>o,y2:()=>l,y3:()=>r});var i=s(7165),r=function(e){return e.Admin="admin",e.Limited="limited",e}({}),n=function(e){return e.Pending="pending",e.Accepted="accepted",e.Refused="refused",e.Revoked="revoked",e}({});const o=i.z.nativeEnum(n),a=i.z.nativeEnum(r),c=i.z.union([i.z.literal("noKey"),i.z.literal("publicKey"),i.z.literal("sharingKeys")]);var d=function(e){return e.User="user",e.UserGroup="group",e.CollectionUser="collectionUser",e.CollectionUserGroup="collectionUserGroup",e}({}),l=function(e){return e.Secret="secret",e.Credential="password",e.SecureNote="note",e}({}),u=function(e){return e.Group="group",e.Collection="collection",e.User="user",e}({});const p=i.z.nativeEnum(d),h=i.z.nativeEnum(u)},88744:(e,t,s)=>{s.r(t),s.d(t,{ATTACHMENT_IN_COLLECTION:()=>ie.Pf,AcceptCollectionInviteCommand:()=>N.cD,AcceptCollectionInviteFailedError:()=>N.nu,AcceptCollectionInviteResultErrorCode:()=>N.Ti,AcceptSharedItemInviteCommand:()=>L.C,AcceptUserGroupInviteCommand:()=>x.Q,AddItemsToCollectionsCommand:()=>se.k,CollectionUserAccessSchema:()=>P.v,CollectionUserGroupAccessSchema:()=>P.r8,CreateSharedCollectionCommand:()=>ie.I4,DeleteSharedCollectionCommand:()=>re.U,DirectAccessSchema:()=>P.eA,GetAllAcceptedGroupsQuery:()=>me.J,GetCollectionPermissionsForUserQuery:()=>Q.y,GetCollectionRoleForGroupQuery:()=>$.L,GetCollectionsForUserOrGroupQuery:()=>X.Q,GetInvitesQuery:()=>j.q,GetIsLastAdminForItemQuery:()=>m.X,GetItemGroupIdForItemIdQuery:()=>l,GetItemIdsInSharedCollectionsQuery:()=>Y.q,GetItemIdsInSharedCollectionsSchema:()=>pe.Po,GetPendingCollectionsQuery:()=>V.D,GetPermissionForItemQuery:()=>h.C,GetPermissionForItemsQuery:()=>g.R,GetSharedAccessForItemIdsQuery:()=>b.D,GetSharedAccessQuery:()=>f.w,GetSharedCollectionsCountQuery:()=>J.C,GetSharedCollectionsQuery:()=>Z.$,GetSharedItemForIdQuery:()=>I.L,GetSharedItemsForItemIdsQuery:()=>a.z,GetSharedItemsQuery:()=>A.w,GetSharingGroupByIdQuery:()=>ve.e,GetSharingGroupsWithItemCountQuery:()=>Re.$,GetSharingStatusForItemQuery:()=>u.S,GetSharingStatusForItemsQuery:()=>p.I,GetSharingTeamLoginsQuery:()=>n.G,GetSharingUsersQuery:()=>Te.K,GetTeamAdminSharingDataQuery:()=>Ie.k,GetUserSharedVaultItemsQuery:()=>y.v,HasInvitesQuery:()=>W._,InviteCollectionMembersCommand:()=>ne.Q,IsSharingAllowedQuery:()=>w.B,MoveCollectionItemsToBusinessSpaceCommand:()=>Ce.g,PendingCollectionSchema:()=>B.of,PendingInviteSchema:()=>B.ju,PendingItemGroupSchema:()=>B.vH,PendingSharedItemInviteSchema:()=>B.jd,PendingUserGroupSchema:()=>B._P,Permission:()=>i.y3,PermissionSchema:()=>i.Iy,RecipientTypeSchema:()=>i.i,RecipientTypes:()=>i.IP,RefuseCollectionInviteCommand:()=>G.UC,RefuseCollectionInviteFailedError:()=>G.R$,RefuseCollectionInviteResultErrorCode:()=>G.eT,RefuseItemGroupInviteAuthorHasInvalidStatusError:()=>k.bp,RefuseItemGroupInviteCommand:()=>k.gm,RefuseItemGroupInviteGroupHasInvalidStatusError:()=>k.Xj,RefuseItemGroupInviteInvalidItemGroupRevisionError:()=>k.Ne,RefuseItemGroupInviteNotEnoughAdminsError:()=>k.Ix,RefuseItemGroupInviteNotFoundError:()=>k.fL,RefuseItemGroupInviteResultErrorCode:()=>k.dI,RefuseItemGroupInviteUserGroupIsNotInItemGroupError:()=>k.Te,RefuseItemGroupInviteUserIsNotInItemGroupError:()=>k.hp,RefuseItemGroupInviteUserIsNotInPendingStatusError:()=>k.gR,RefuseSharedItemBeforeDeletionCommand:()=>O.OL,RefuseSharedItemBeforeDeletionCommandErrors:()=>O.m$,RefuseSharedItemCommand:()=>C.l,RefuseUserGroupInviteAuthorHasInvalidStatusError:()=>K.K8,RefuseUserGroupInviteCommand:()=>K.Fo,RefuseUserGroupInviteGroupHasInvalidStatusError:()=>K.kh,RefuseUserGroupInviteInsufficientPrivilegesError:()=>K.FO,RefuseUserGroupInviteInvalidItemGroupRevisionError:()=>K.Uf,RefuseUserGroupInviteInvalidTeamIdError:()=>K.Ix,RefuseUserGroupInviteNotFoundError:()=>K.i6,RefuseUserGroupInviteResultErrorCode:()=>K.xC,RefuseUserGroupInviteUserGroupIsNotFoundError:()=>K.U1,RefuseUserGroupInviteUserGroupUpdateConflictError:()=>K.Xp,RefuseUserGroupInviteUserIsNotInPendingStatusError:()=>K.PZ,RefuseUserGroupInviteUserIsNotInUserGroupError:()=>K.xz,RemoteControlSharedItemsCommand:()=>be.v,RemoveItemFromCollectionsCommand:()=>ae.B,RenameCollectionCommand:()=>oe.r,RevokeCollectionMembersCommand:()=>ce.q,RevokeSharedItemCommand:()=>T.V,RsaStatusSchema:()=>i.bd,RunSharingSyncCommand:()=>Ee.N,ShareItemFailureReason:()=>E.z,ShareItemsCommand:()=>R.S2,ShareItemsErrorType:()=>R.Mb,ShareItemsErrorsQuery:()=>E.f,ShareableCollectionSchema:()=>ee.JQ,ShareableCollectionVaultItemSchema:()=>ee.FN,ShareableItemType:()=>i.y2,SharedAccessEntrySchema:()=>P.wQ,SharedAccessForItemQuery:()=>v.v,SharedAccessSchema:()=>P.Im,SharedCollectionAccessSchema:()=>pe.Ng,SharedCollectionRole:()=>pe.Yt,SharedCollectionSchema:()=>pe.MX,SharedCollectionUserGroupSchema:()=>pe.yD,SharedCollectionUserOrGroupViewSchema:()=>pe.fg,SharedCollectionUserSchema:()=>pe.Me,SharedCollectionsWithItemsQuery:()=>ee.MO,SharedItemAccessLinkTypes:()=>i.Uv,SharedItemAccessLinkTypesSchema:()=>i.dg,SharedItemDecryptionLinkSchema:()=>P.I2,SharedItemRecipientIdsSchema:()=>P.QT,SharedItemSchema:()=>P.m$,SharedItemsIdsQuery:()=>S.c,SharedVaultItemType:()=>P.nC,SharingCollectionsClient:()=>he.L,SharingDisabledReason:()=>pe.Hz,SharingEnabledQuery:()=>o.N,SharingInvitesClient:()=>q,SharingItemsClient:()=>F.s,SharingSyncFeatureFlips:()=>Ae.d,SharingUserSchema:()=>Se,SortDirection:()=>_e.S,Status:()=>i.qb,StatusSchema:()=>i.y$,TeamAdminSharingDataSchema:()=>Ie.m,UpdateCollectionMembersCommand:()=>le.c,UpdatePendingCollectionsCommand:()=>M.r,UpdatePermissionForCollectionItemCommand:()=>ue.a,UpdateSharedCollectionsCommand:()=>de.M,UpdateSharedItemContentCommand:()=>D.l,UpdateSharedItemPermissionCommand:()=>_.W,UserGroupAccessSchema:()=>P.Ho,UsersAndGroupsInCollectionQuery:()=>te.O,UsersAndGroupsInCollectionSchema:()=>pe.a7,createAttachmentInCollectionError:()=>ie.LG,createForbiddenGroupItemError:()=>O.Vf,createForbiddenLastAdminError:()=>O.V$,createLimitExceededError:()=>R.Kb,createPartialSuccessError:()=>R.$u,getRefuseItemGroupInviteFunctionalError:()=>k.fr,getRefuseUserGroupInviteFunctionalError:()=>K.cz,isSharedVaultItemType:()=>P.RP,sharingCenterApi:()=>Oe.m,sharingCollectionsApi:()=>H.a,sharingInvitesApi:()=>U.t,sharingItemsApi:()=>r.X,sharingRecipientsApi:()=>ge.A,sharingRemoteControlApi:()=>fe.X,sharingSyncApi:()=>we.k});var i=s(13252),r=s(61582),n=s(38638),o=s(36155),a=s(95803),c=s(77535),d=s(62149);class l extends((0,c.k)({scope:d.F.User})){}var u=s(95038),p=s(86368),h=s(46234),g=s(62176),m=s(11108),v=s(47670),y=s(39672),S=s(52715),w=s(54933),E=s(32725),I=s(90878),A=s(80160),f=s(89623),b=s(38661),C=s(24701),O=s(40102),R=s(33472),T=s(98721),_=s(2741),D=s(95196),F=s(35594),P=s(88981),U=s(95940),N=s(64549),L=s(83405),x=s(27122),G=s(37210),k=s(51571),K=s(11050),M=s(97675),j=s(57885),V=s(5650),W=s(71763),B=s(18091),z=s(8260);class q extends((0,z.E)(U.t)){}(0,z.K)(U.t,q);var H=s(62048),Y=s(7134),Q=s(13312),$=s(41869),X=s(10829),Z=s(34282),J=s(14947),ee=s(13575),te=s(54665),se=s(51607),ie=s(53384),re=s(21998),ne=s(22210),oe=s(46733),ae=s(94020),ce=s(88621),de=s(76001),le=s(31105),ue=s(63792),pe=s(11797),he=s(20980),ge=s(87581),me=s(31839),ve=s(48782),ye=s(7165);const Se=ye.z.object({userId:ye.z.string(),proposeSignature:ye.z.optional(ye.z.string()),acceptSignature:ye.z.optional(ye.z.nullable(ye.z.string())),status:ye.z.optional(i.y$),referrer:ye.z.optional(ye.z.string()),groupKey:ye.z.optional(ye.z.nullable(ye.z.string()))});var we=s(29390),Ee=s(76763),Ie=s(15292),Ae=s(6489),fe=s(94152),be=s(35061),Ce=s(76810),Oe=s(54416),Re=s(40266),Te=s(2683),_e=s(21912)},54416:(e,t,s)=>{s.d(t,{m:()=>o});var i=s(75958),r=s(2683),n=s(40266);const o=(0,i.Q)({name:"sharingCenter",commands:{},events:{},queries:{getSharingUsersQuery:r.K,getSharingGroupsWithItemCountQuery:n.$}})},40266:(e,t,s)=>{s.d(t,{$:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},2683:(e,t,s)=>{s.d(t,{K:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},21912:(e,t,s)=>{s.d(t,{S:()=>i});var i=function(e){return e.Ascend="ascend",e.Descend="descend",e}({})},62048:(e,t,s)=>{s.d(t,{a:()=>A});var i=s(75958),r=s(51607),n=s(53384),o=s(21998),a=s(22210),c=s(31105),d=s(94020),l=s(46733),u=s(88621),p=s(76001),h=s(63792),g=s(10829),m=s(7134),v=s(34282),y=s(13312),S=s(41869),w=s(14947),E=s(13575),I=s(54665);const A=(0,i.Q)({name:"sharingCollections",commands:{addItemsToCollections:r.k,createSharedCollection:n.I4,deleteSharedCollection:o.U,inviteCollectionMembers:a.Q,updateCollectionMembers:c.c,removeItemFromCollections:d.B,renameCollection:l.r,revokeCollectionMembers:u.q,updateSharedCollections:p.M,updatePermissionForCollectionItem:h.a},events:{},queries:{getCollectionsForUserOrGroup:g.Q,getItemIdsInSharedCollections:m.q,getSharedCollections:v.$,getCollectionPermissionsForUser:y.y,getCollectionRoleForGroup:S.L,getSharedCollectionsCount:w.C,sharedCollectionsWithItems:E.MO,usersAndGroupsInCollection:I.O}})},51607:(e,t,s)=>{s.d(t,{k:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},53384:(e,t,s)=>{s.d(t,{I4:()=>c,LG:()=>a,Pf:()=>o});var i=s(13385),r=s(62149),n=s(98124);const o="ATTACHMENT_IN_COLLECTION",a=(0,n.Vj)(o,"Unable to share collections containing secure notes with attachments.");class c extends((0,i.g)({scope:r.F.User})){}},21998:(e,t,s)=>{s.d(t,{U:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},22210:(e,t,s)=>{s.d(t,{Q:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},94020:(e,t,s)=>{s.d(t,{B:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},46733:(e,t,s)=>{s.d(t,{r:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},88621:(e,t,s)=>{s.d(t,{q:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},31105:(e,t,s)=>{s.d(t,{c:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},63792:(e,t,s)=>{s.d(t,{a:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},76001:(e,t,s)=>{s.d(t,{M:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},7134:(e,t,s)=>{s.d(t,{q:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},41869:(e,t,s)=>{s.d(t,{L:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},13312:(e,t,s)=>{s.d(t,{y:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},10829:(e,t,s)=>{s.d(t,{Q:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},14947:(e,t,s)=>{s.d(t,{C:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},34282:(e,t,s)=>{s.d(t,{$:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},13575:(e,t,s)=>{s.d(t,{FN:()=>o,JQ:()=>a,MO:()=>c});var i=s(7165),r=s(77535),n=s(62149);const o=i.z.object({id:i.z.string(),type:i.z.string(),url:i.z.optional(i.z.string())}),a=i.z.object({id:i.z.string(),name:i.z.string(),spaceId:i.z.string(),vaultItems:i.z.array(o),isShared:i.z.optional(i.z.boolean())});class c extends((0,r.k)({scope:n.F.User})){}},54665:(e,t,s)=>{s.d(t,{O:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},20980:(e,t,s)=>{s.d(t,{L:()=>n});var i=s(8260),r=s(62048);class n extends((0,i.E)(r.a)){}(0,i.K)(r.a,n)},11797:(e,t,s)=>{s.d(t,{Hz:()=>g,MX:()=>d,Me:()=>o,Ng:()=>p,Po:()=>u,Yt:()=>h,a7:()=>l,fg:()=>c,yD:()=>a});var i=s(7165),r=s(13252),n=s(88981);const o=i.z.object({acceptSignature:i.z.optional(i.z.nullable(i.z.string())),collectionKey:i.z.optional(i.z.nullable(i.z.string())),login:i.z.string(),permission:r.Iy,proposeSignature:i.z.optional(i.z.string()),proposeSignatureUsingAlias:i.z.optional(i.z.boolean()),referrer:i.z.string(),rsaStatus:i.z.optional(r.bd),status:r.y$}),a=i.z.object({acceptSignature:i.z.optional(i.z.nullable(i.z.string())),collectionKey:i.z.optional(i.z.nullable(i.z.string())),name:i.z.string(),permission:r.Iy,proposeSignature:i.z.optional(i.z.string()),referrer:i.z.optional(i.z.string()),status:r.y$,uuid:i.z.string()}),c=i.z.object({label:i.z.string(),status:r.y$,permission:r.Iy,id:i.z.string()}),d=i.z.object({name:i.z.string(),privateKey:i.z.string(),publicKey:i.z.string(),revision:i.z.number(),userGroups:i.z.optional(i.z.array(a)),users:i.z.optional(i.z.array(o)),uuid:i.z.string(),authorLogin:i.z.optional(i.z.string())}),l=i.z.object({userGroups:i.z.optional(i.z.array(c)),users:i.z.optional(i.z.array(c))}),u=i.z.array(i.z.string()),p=i.z.object({users:i.z.array(n.wQ),userGroups:i.z.array(n.wQ)});var h=function(e){return e.Editor="editor",e.Manager="manager",e}({}),g=function(e){return e.DisabledInTAC="disabledInTac",e.EditorRole="editorRole",e.LimitedRightItems="limitedRightItems",e}({})},95940:(e,t,s)=>{s.d(t,{t:()=>g});var i=s(75958),r=s(27122),n=s(83405),o=s(64549),a=s(37210),c=s(51571),d=s(11050),l=s(97675),u=s(57885),p=s(5650),h=s(71763);const g=(0,i.Q)({name:"sharingInvites",commands:{AcceptUserGroupInviteCommand:r.Q,AcceptSharedItemInviteCommand:n.C,AcceptCollectionInviteCommand:o.cD,RefuseCollectionInviteCommand:a.UC,RefuseItemGroupInviteCommand:c.gm,RefuseUserGroupInviteCommand:d.Fo,UpdatePendingCollectionsCommand:l.r},events:{},queries:{GetInvitesQuery:u.q,GetPendingCollectionsQuery:p.D,HasInvitesQuery:h._}})},64549:(e,t,s)=>{s.d(t,{Ti:()=>o,cD:()=>c,nu:()=>a});var i=s(13385),r=s(62149),n=s(98124),o=function(e){return e.AcceptFailed="AcceptFailed",e}({});class a extends((0,n.Hu)("AcceptFailed","Failed to accept collection")){}class c extends((0,i.g)({scope:r.F.User})){}},83405:(e,t,s)=>{s.d(t,{C:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},27122:(e,t,s)=>{s.d(t,{Q:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},37210:(e,t,s)=>{s.d(t,{R$:()=>a,UC:()=>c,eT:()=>o});var i=s(13385),r=s(62149),n=s(98124),o=function(e){return e.RefuseFailed="RefuseFailed",e}({});class a extends((0,n.Hu)("RefuseFailed","Failed to refuse collection")){}class c extends((0,i.g)({scope:r.F.User})){}},51571:(e,t,s)=>{s.d(t,{Ix:()=>h,Ne:()=>p,Te:()=>u,Xj:()=>d,bp:()=>c,dI:()=>o,fL:()=>a,fr:()=>m,gR:()=>g,gm:()=>v,hp:()=>l});var i=s(13385),r=s(62149),n=s(98124),o=function(e){return e.ItemGroupNotFound="ItemGroupNotFound",e.AuthorHasInvalidStatus="AuthorHasInvalidStatus",e.GroupHasInvalidStatus="GroupHasInvalidStatus",e.UserIsNotInItemGroup="UserIsNotInItemGroup",e.UserGroupIsNotInItemGroup="UserGroupIsNotInItemGroup",e.InvalidItemGroupRevision="InvalidItemGroupRevision",e.NotEnoughAdmins="NotEnoughAdmins",e.UserIsNotInPendingStatus="UserIsNotInPendingStatus",e}({});class a extends((0,n.Hu)("ItemGroupNotFound","Item Group not found")){}class c extends((0,n.Hu)("AuthorHasInvalidStatus","User is not in accepted/pending status (already refused or revoked)")){}class d extends((0,n.Hu)("GroupHasInvalidStatus","UserGroup is not in accepted/pending status (already refused or revoked)")){}class l extends((0,n.Hu)("UserIsNotInItemGroup","User is not part of item group")){}class u extends((0,n.Hu)("UserGroupIsNotInItemGroup","User group is not part of item group")){}class p extends((0,n.Hu)("InvalidItemGroupRevision","Item group revision is not valid")){}class h extends((0,n.Hu)("NotEnoughAdmins","The operation would let the item group with no admin")){}class g extends((0,n.Hu)("UserIsNotInPendingStatus",'User is not in "pending" status or not part of a group')){}function m(e){switch(e){case"AUTHOR_HAS_INVALID_STATUS":return new c;case"GROUP_HAS_INVALID_STATUS":return new d;case"USER_IS_NOT_IN_ITEM_GROUP":return new l;case"USER_GROUP_IS_NOT_IN_ITEM_GROUP":return new u;case"INVALID_ITEM_GROUP_REVISION":return new p;case"NOT_ENOUGH_ADMINS":return new h;case"USER_IS_NOT_IN_PENDING_STATUS":return new g;default:throw new Error("Unknown server error")}}class v extends((0,i.g)({scope:r.F.User})){}},11050:(e,t,s)=>{s.d(t,{FO:()=>p,Fo:()=>S,Ix:()=>c,K8:()=>v,PZ:()=>g,U1:()=>d,Uf:()=>l,Xp:()=>u,cz:()=>y,i6:()=>a,kh:()=>m,xC:()=>o,xz:()=>h});var i=s(13385),r=s(62149),n=s(98124),o=function(e){return e.UserGroupNotFound="UserGroupNotFound",e.InvalidTeamId="InvalidTeamId",e.UserGroupIsNotFound="UserGroupIsNotFound",e.InvalidItemGroupRevision="InvalidItemGroupRevision",e.UserGroupUpdateConflict="UserGroupUpdateConflict",e.InsufficientPrivileges="InsufficientPrivileges",e.UserIsNotInUserGroup="UserIsNotInUserGroup",e.UserIsNotInPendingStatus="UserIsNotInPendingStatus",e.GroupHasInvalidStatus="GroupHasInvalidStatus",e.AuthorHasInvalidStatus="AuthorHasInvalidStatus",e}({});class a extends((0,n.Hu)("UserGroupNotFound","User Group not found")){}class c extends((0,n.Hu)("InvalidTeamId","Provided Team ID is not a number")){}class d extends((0,n.Hu)("UserGroupIsNotFound","User group for provided ID does not exist")){}class l extends((0,n.Hu)("InvalidItemGroupRevision","User group revision is not valid")){}class u extends((0,n.Hu)("UserGroupUpdateConflict","Conflict between users attempting to update the same user group")){}class p extends((0,n.Hu)("InsufficientPrivileges","The user does not have User Group permission to refuse the invitation")){}class h extends((0,n.Hu)("UserIsNotInUserGroup","User is not part of a group")){}class g extends((0,n.Hu)("UserIsNotInPendingStatus",'User is not in "pending" status or not part of a group')){}class m extends((0,n.Hu)("GroupHasInvalidStatus",'UserGroup is not in "accepted" or "pending" status (already refused or revoked)')){}class v extends((0,n.Hu)("AuthorHasInvalidStatus","User is not in accepted/pending status (already refused or revoked)")){}function y(e){switch(e){case"INVALID_TEAM_ID":return new c;case"USER_GROUP_IS_NOT_FOUND":return new d;case"INVALID_USER_GROUP_REVISION":return new l;case"USER_GROUP_UPDATE_CONFLICT":return new u;case"INSUFFICIENT_PRIVILEGES":return new p;case"USER_IS_NOT_IN_USER_GROUP":return new h;case"USER_IS_NOT_IN_PENDING_STATUS":return new g;case"GROUP_HAS_INVALID_STATUS":return new m;case"AUTHOR_HAS_INVALID_STATUS":return new v;default:throw new Error("Unknown server error")}}class S extends((0,i.g)({scope:r.F.User})){}},97675:(e,t,s)=>{s.d(t,{r:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},57885:(e,t,s)=>{s.d(t,{q:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},5650:(e,t,s)=>{s.d(t,{D:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},71763:(e,t,s)=>{s.d(t,{_:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},18091:(e,t,s)=>{s.d(t,{_P:()=>a,jd:()=>g,ju:()=>d,of:()=>n,vH:()=>o});var i=s(7165),r=s(13252);const n=i.z.object({uuid:i.z.string(),name:i.z.string(),referrer:i.z.string(),permission:i.z.nativeEnum(r.y3)}),o=i.z.object({itemGroupId:i.z.string(),referrer:i.z.string(),permission:i.z.enum(["admin","limited"]),items:i.z.array(i.z.any())}),a=i.z.object({groupId:i.z.string(),name:i.z.string(),referrer:i.z.string(),permission:i.z.enum(["admin","limited"])}),c=i.z.object({referrer:i.z.string(),permission:r.Iy}),d=c.extend({id:i.z.string(),name:i.z.string()}),l=c.extend({vaultItemId:i.z.string(),sharedItemId:i.z.string(),revision:i.z.number(),title:i.z.string(),spaceId:i.z.optional(i.z.string())}),u=l.extend({itemType:i.z.literal(r.y2.Credential),url:i.z.optional(i.z.string()),login:i.z.optional(i.z.string()),secondaryLogin:i.z.optional(i.z.string()),email:i.z.optional(i.z.string()),linkedDomains:i.z.optional(i.z.array(i.z.string()))}),p=l.extend({itemType:i.z.literal(r.y2.SecureNote),color:i.z.optional(i.z.string()),secured:i.z.boolean()}),h=l.extend({itemType:i.z.literal(r.y2.Secret),secured:i.z.boolean()}),g=i.z.union([u,p,h])},61582:(e,t,s)=>{s.d(t,{X:()=>R});var i=s(75958),r=s(2741),n=s(95196),o=s(98721),a=s(24701),c=s(40102),d=s(33472),l=s(89623),u=s(38661),p=s(80160),h=s(90878),g=s(54933),m=s(38638),v=s(36155),y=s(95803),S=s(95038),w=s(86368),E=s(46234),I=s(62176),A=s(11108),f=s(47670),b=s(39672),C=s(52715),O=s(32725);const R=(0,i.Q)({name:"sharingItems",commands:{updateSharedItemPermission:r.W,updateSharedItemContent:n.l,revokeSharedItem:o.V,refuseSharedItem:a.l,refuseSharedItemBeforeDeletion:c.OL,shareItems:d.S2},events:{},queries:{getSharedAccess:l.w,getSharedAccessForItemIds:u.D,getSharedItems:p.w,getSharedItemForId:h.L,isSharingAllowed:g.B,getSharingTeamLogins:m.G,sharingEnabled:v.N,getSharedItemsForItemIds:y.z,getSharingStatusForItem:S.S,getSharingStatusForItems:w.I,getPermissionForItem:E.C,getPermissionForItems:I.R,getIsLastAdminForItem:A.X,sharedAccessForItem:f.v,getUserSharedVaultItems:b.v,sharedItemsIds:C.c,shareItemsErrors:O.f}})},40102:(e,t,s)=>{s.d(t,{OL:()=>d,V$:()=>c,Vf:()=>a,m$:()=>o});var i=s(13385),r=s(62149),n=s(98124);const o=Object.freeze({FORBIDDEN_GROUP_ITEM:"FORBIDDEN_GROUP_ITEM",FORBIDDEN_LAST_ADMIN:"FORBIDDEN_LAST_ADMIN"}),a=(0,n.Vj)(o.FORBIDDEN_GROUP_ITEM,"The Vault Item cannot be deleted while shared via user group."),c=(0,n.Vj)(o.FORBIDDEN_LAST_ADMIN,"The Vault Item cannot be deleted while the current user is the last admin.");class d extends((0,i.g)({scope:r.F.User})){}},24701:(e,t,s)=>{s.d(t,{l:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},98721:(e,t,s)=>{s.d(t,{V:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},33472:(e,t,s)=>{s.d(t,{$u:()=>c,Kb:()=>a,Mb:()=>o,S2:()=>d});var i=s(13385),r=s(62149),n=s(98124),o=function(e){return e.LIMIT_EXCEEDED="LIMIT_EXCEEDED",e.PARTIAL_SUCCESS="PARTIAL_SUCCESS",e}({});const a=(0,n.Vj)("LIMIT_EXCEEDED","Sharing limit exceeded"),c=(0,n.Vj)("PARTIAL_SUCCESS","Some items were shared successfully, but not all");class d extends((0,i.g)({scope:r.F.User})){}},95196:(e,t,s)=>{s.d(t,{l:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},2741:(e,t,s)=>{s.d(t,{W:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},11108:(e,t,s)=>{s.d(t,{X:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},46234:(e,t,s)=>{s.d(t,{C:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User,useCache:!0})){}},62176:(e,t,s)=>{s.d(t,{R:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},38661:(e,t,s)=>{s.d(t,{D:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},89623:(e,t,s)=>{s.d(t,{w:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},90878:(e,t,s)=>{s.d(t,{L:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},95803:(e,t,s)=>{s.d(t,{z:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},80160:(e,t,s)=>{s.d(t,{w:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},95038:(e,t,s)=>{s.d(t,{S:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User,useCache:!0})){}},86368:(e,t,s)=>{s.d(t,{I:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},38638:(e,t,s)=>{s.d(t,{G:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},39672:(e,t,s)=>{s.d(t,{v:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},54933:(e,t,s)=>{s.d(t,{B:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User,useCache:!0})){}},32725:(e,t,s)=>{s.d(t,{f:()=>o,z:()=>n});var i=s(77535),r=s(62149),n=function(e){return e[e.ITEM_DOESNT_EXIST=0]="ITEM_DOESNT_EXIST",e[e.LIMIT_EXCEEDED=1]="LIMIT_EXCEEDED",e[e.ITEM_HAS_ATTACHMENTS=2]="ITEM_HAS_ATTACHMENTS",e[e.INVALID_REVISION=3]="INVALID_REVISION",e[e.SHARING_FAILED=4]="SHARING_FAILED",e}({});class o extends((0,i.k)({scope:r.F.User})){}},47670:(e,t,s)=>{s.d(t,{v:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},52715:(e,t,s)=>{s.d(t,{c:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},36155:(e,t,s)=>{s.d(t,{N:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User,useCache:!0})){}},35594:(e,t,s)=>{s.d(t,{s:()=>n});var i=s(8260),r=s(61582);class n extends((0,i.E)(r.X)){}(0,i.K)(r.X,n)},88981:(e,t,s)=>{s.d(t,{Ho:()=>a,I2:()=>l,Im:()=>h,QT:()=>u,RP:()=>v,eA:()=>o,m$:()=>g,nC:()=>m,r8:()=>d,v:()=>c,wQ:()=>p});var i=s(7165),r=s(13252);const n=i.z.object({permission:r.Iy,proposeSignature:i.z.optional(i.z.string()),acceptSignature:i.z.optional(i.z.nullable(i.z.string())),encryptedResourceKey:i.z.string(),accessType:r.dg}),o=n.extend({accessType:i.z.literal(r.Uv.User)}),a=n.extend({accessType:i.z.literal(r.Uv.UserGroup),groupEncryptedKey:i.z.optional(i.z.string()),groupPrivateKey:i.z.optional(i.z.string()),groupPublicKey:i.z.optional(i.z.string())}),c=n.extend({accessType:i.z.literal(r.Uv.CollectionUser),collectionEncryptedKey:i.z.optional(i.z.string()),collectionPrivateKey:i.z.optional(i.z.string()),collectionPublicKey:i.z.optional(i.z.string())}),d=n.extend({accessType:i.z.literal(r.Uv.CollectionUserGroup),collectionEncryptedKey:i.z.optional(i.z.string()),collectionPrivateKey:i.z.optional(i.z.string()),groupEncryptedKey:i.z.optional(i.z.string()),groupPrivateKey:i.z.optional(i.z.string()),groupPublicKey:i.z.optional(i.z.string()),collectionPublicKey:i.z.optional(i.z.string())}),l=i.z.union([o,a,c,d]),u=i.z.object({userIds:i.z.optional(i.z.nullable(i.z.array(i.z.string()))),collectionIds:i.z.optional(i.z.nullable(i.z.array(i.z.string()))),userGroupIds:i.z.optional(i.z.nullable(i.z.array(i.z.string())))}),p=i.z.object({id:i.z.string(),name:i.z.string(),permission:r.Iy,status:i.z.optional(r.y$)}),h=i.z.object({users:i.z.array(p),userGroups:i.z.array(p),collections:i.z.array(p)}),g=i.z.object({accessLink:i.z.optional(l),sharedItemId:i.z.string(),itemId:i.z.string(),itemKey:i.z.string(),revision:i.z.number(),recipientIds:u,permission:r.Iy,isLastAdmin:i.z.boolean()});var m=function(e){return e.Credential="KWAuthentifiant",e.Secret="KWSecret",e.SecureNote="KWSecureNote",e}({});const v=e=>Object.values(m).includes(e)},87581:(e,t,s)=>{s.d(t,{A:()=>o});var i=s(75958),r=s(31839),n=s(48782);const o=(0,i.Q)({name:"sharingRecipients",commands:{},events:{},queries:{getAllAcceptedGroups:r.J,getSharingGroupById:n.e}})},31839:(e,t,s)=>{s.d(t,{J:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},48782:(e,t,s)=>{s.d(t,{e:()=>n});var i=s(77535),r=s(62149);class n extends((0,i.k)({scope:r.F.User})){}},94152:(e,t,s)=>{s.d(t,{X:()=>o});var i=s(75958),r=s(35061),n=s(76810);const o=(0,i.Q)({name:"sharingRemoteControl",commands:{remoteControlSharedItems:r.v,moveCollectionItemsToBusinessSpace:n.g},events:{},queries:{}})},76810:(e,t,s)=>{s.d(t,{g:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},35061:(e,t,s)=>{s.d(t,{v:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},29390:(e,t,s)=>{s.d(t,{k:()=>o});var i=s(75958),r=s(76763),n=s(15292);const o=(0,i.Q)({name:"sharingSync",commands:{runSharingSync:r.N},events:{},queries:{getTeamAdminSharingData:n.k}})},76763:(e,t,s)=>{s.d(t,{N:()=>n});var i=s(13385),r=s(62149);class n extends((0,i.g)({scope:r.F.User})){}},6489:(e,t,s)=>{s.d(t,{d:()=>i});var i=function(e){return e.SharingSyncGrapheneMigrationDev="sharingVault_web_sharingSyncGrapheneMigration_dev",e}({})},15292:(e,t,s)=>{s.d(t,{k:()=>p,m:()=>u});var i=s(7165),r=s(77535),n=s(62149),o=s(13252);const a=i.z.object({userId:i.z.string(),alias:i.z.string(),referrer:i.z.string(),groupKey:i.z.string().nullable().optional(),permission:i.z.enum(["admin","limited"]),rsaStatus:o.bd,status:o.y$}),c=i.z.object({groupId:i.z.string(),name:i.z.string(),type:i.z.literal("teamAdmins"),publicKey:i.z.string(),privateKey:i.z.string(),revision:i.z.number(),users:i.z.array(a)}),d=i.z.object({groupId:i.z.string(),items:i.z.array(i.z.object({itemId:i.z.string(),itemKey:i.z.string()})).optional(),revision:i.z.number(),type:i.z.literal("userGroupKeys"),users:i.z.array(a).optional()}),l=i.z.object({content:i.z.string(),timestamp:i.z.number(),itemId:i.z.string()}),u=i.z.object({specialItemGroup:d.optional(),specialUserGroup:c.optional(),specialItems:i.z.record(l).optional()});class p extends((0,r.k)({scope:n.F.User})){}},14139:(e,t,s)=>{s.d(t,{y:()=>h});var i=s(92336),r=s(86006),n=s(44449),o=s(93986),a=s(51612),c=s(57452),d=s(35635),l=s(523),u=s(22952),p=s(74929);class h{}h=(0,i.gn)([(0,r.Y)({sharedModuleName:"sharing-carbon-helpers",providers:[o.E,a.J,c.n,d.a,n.V,l.H,u.F,p.B],exports:[o.E,a.J,c.n,d.a,n.V,l.H,u.F,p.B],imports:[]})],h)},51612:(e,t,s)=>{s.d(t,{J:()=>d});var i=s(92336),r=s(60399),n=s(96500),o=s(14122),a=s(92587),c=s(78346);class d{async getCarbonCredentialsByItemIds(e){const{queries:{carbonState:t}}=this.client,s=await(0,r.z)(t({path:"userSession.personalData.credentials"}));if((0,c.hx)(s))throw new Error("Unable to access credentials from carbon");const i=s.data;if(!i)throw new Error("No credentials found");if(o=i,!Array.isArray(o)||!o.every(n.G))throw new Error("Credentials are invalid");var o;const a=i.reduce(((e,t)=>(e[t.Id]=t,e)),{});return e.reduce(((e,t)=>(t in a&&e.push(a[t]),e)),[])}constructor(e){this.client=e}}d=(0,i.gn)([(0,a.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o._?Object:o._])],d)},57452:(e,t,s)=>{s.d(t,{n:()=>l});var i=s(92336),r=s(6136),n=s(10705),o=s(14122),a=s(92587),c=s(33312);const d=e=>{if(!e)return{teamId:"",isSharingEnabled:!1,isCollectionsSharingEnabled:!1,areSensitiveLogsEnabled:!1};const t=e;if(!((s=t.spaces)&&Array.isArray(s)&&0!==s.length&&(e=>{if(!e)return!1;const t=e;return!!(t.associatedEmail&&t.billingAdmins&&t.color&&t.info&&t.letter&&t.planType&&t.status&&t.teamAdmins&&t.teamId&&t.teamName&&t.tier)})(s.find((e=>"accepted"===e.status)))))return{teamId:"",isSharingEnabled:!0,isCollectionsSharingEnabled:!1,areSensitiveLogsEnabled:!1};var s;const i=t.spaces.find((e=>"accepted"===e.status)),r=Boolean(t.capabilities?.collectionSharing.enabled),n=t.capabilities?.sharingLimit.info?.limit;return{teamId:i?.teamId??"",isSharingEnabled:Boolean(i&&!i.info.sharingDisabled),areSensitiveLogsEnabled:Boolean(i?.info.collectSensitiveDataAuditLogsEnabled),isCollectionsSharingEnabled:r,sharedItemsLimit:n}};class l{get(){const{getNodePremiumStatus:e}=this.carbon.queries;return e().pipe((0,c.Qn)(d),(0,r.x)(((e,t)=>(0,n.Z)(e,t))))}constructor(e){this.carbon=e}}l=(0,i.gn)([(0,a.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o._?Object:o._])],l)},35635:(e,t,s)=>{s.d(t,{a:()=>c});var i=s(92336),r=s(60399),n=s(14122),o=s(92587),a=s(33312);class c{async getCurrentUserWithKeys(){const{queries:{carbonStateList:e}}=this.client;return await(0,r.z)(e({paths:["userSession.account.login","userSession.session.keyPair.publicKey","userSession.session.keyPair.privateKey"]}).pipe((0,a.nb)({success:([e,t,s])=>{if("string"!=typeof e||"string"!=typeof t||"string"!=typeof s)throw new Error("Invalid format of current user keys");return{login:e,publicKey:t,privateKey:s}},failure:()=>{throw new Error("Failure getting current user and key pair")}})))}constructor(e){this.client=e}}c=(0,i.gn)([(0,o.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===n._?Object:n._])],c)},44449:(e,t,s)=>{s.d(t,{V:()=>c});var i=s(92336),r=s(14122),n=s(92587),o=s(33312),a=s(82181);class c{get(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.sharingSync"}).pipe((0,o.Qn)((e=>{if(!(0,a.o)(e))throw new Error("Bad SharingSync format");return e})))}constructor(e){this.carbonLegacyClient=e}}c=(0,i.gn)([(0,n.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===r._?Object:r._])],c)},93986:(e,t,s)=>{s.d(t,{E:()=>u});var i=s(92336),r=s(14122),n=s(92587),o=s(33312),a=s(72298);function c(e){switch(e){case"admin":return a.y3.Admin;case"limited":return a.y3.Limited}}function d(e){switch(e){case"pending":return a.qb.Pending;case"accepted":return a.qb.Accepted;case"refused":return a.qb.Refused;case"revoked":return a.qb.Revoked}}function l(e){return{groupId:e.groupId,revision:e.revision,type:e.type,teamId:e.teamId,items:e.items,users:e.users?[...e.users.map((e=>({...e,permission:c(e.permission),status:d(e.status)})))]:void 0,groups:e.groups?[...e.groups.map((e=>({...e,permission:c(e.permission),status:d(e.status)})))]:void 0,collections:e.collections?[...e.collections?.map((e=>({...e,permission:c(e.permission),status:d(e.status)})))??[]]:void 0}}class u{get(){const{queries:{carbonState:e}}=this.client;return e({path:"userSession.sharingData.itemGroups"}).pipe((0,o.Qn)((e=>e.map(l))))}getForItemId(e){return this.get().pipe((0,o.Qn)((t=>t.find((t=>t.items?.some((t=>e===t.itemId)))))))}getForItemGroupId(e){return this.get().pipe((0,o.Qn)((t=>t.find((t=>t.groupId===e)))))}getForItemsIds(e){return this.get().pipe((0,o.Qn)((t=>t.filter((t=>t.items?.some((t=>e.includes(t.itemId))))))))}getForCollectionId(e){return this.get().pipe((0,o.Qn)((t=>t.filter((t=>t.collections?.some((t=>e.includes(t.uuid))))))))}constructor(e){this.client=e}}u=(0,i.gn)([(0,n.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===r._?Object:r._])],u)},523:(e,t,s)=>{s.d(t,{H:()=>d});var i=s(92336),r=s(60399),n=s(69956),o=s(14122),a=s(92587),c=s(78346);class d{async getCarbonNotesByItemIds(e){const{queries:{carbonState:t}}=this.client,s=await(0,r.z)(t({path:"userSession.personalData.notes"}));if((0,c.hx)(s))throw new Error("Unable to access notes from carbon");const i=s.data;if(!i)throw new Error("No notes found");if(o=i,!Array.isArray(o)||!o.every(n.g))throw new Error("Notes are invalid");var o;const a=i.reduce(((e,t)=>(e[t.Id]=t,e)),{});return e.reduce(((e,t)=>(t in a&&e.push(a[t]),e)),[])}constructor(e){this.client=e}}d=(0,i.gn)([(0,a.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o._?Object:o._])],d)},22952:(e,t,s)=>{s.d(t,{F:()=>d});var i=s(92336),r=s(60399),n=s(47380),o=s(14122),a=s(92587),c=s(78346);class d{async getCarbonSecretsByItemIds(e){const{queries:{carbonState:t}}=this.client,s=await(0,r.z)(t({path:"userSession.personalData.secrets"}));if((0,c.hx)(s))throw new Error("Unable to access secrets from carbon");const i=s.data;if(!i)throw new Error("No secrets found");if(o=i,!Array.isArray(o)||!o.every(n.k))throw new Error("Secrets are invalid");var o;const a=i.reduce(((e,t)=>(e[t.Id]=t,e)),{});return e.reduce(((e,t)=>(t in a&&e.push(a[t]),e)),[])}constructor(e){this.client=e}}d=(0,i.gn)([(0,a.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o._?Object:o._])],d)},74929:(e,t,s)=>{s.d(t,{B:()=>m});var i=s(92336),r=s(60399),n=s(87065),o=s(7165),a=s(14122),c=s(92587),d=s(78346),l=s(72298);function u(e){switch(e){case"admin":return l.y3.Admin;case"limited":return l.y3.Limited}}function p(e){switch(e){case"pending":return l.qb.Pending;case"accepted":return l.qb.Accepted;case"refused":return l.qb.Refused;case"revoked":return l.qb.Revoked}}function h(e){return{groupId:e.groupId,revision:e.revision,type:e.type,teamId:e.teamId,name:e.name,privateKey:e.privateKey,publicKey:e.publicKey,externalId:e.externalId,familyId:e.familyId,users:[...e.users.map((e=>({...e,permission:u(e.permission),status:p(e.status)})))]}}const g=o.z.array(o.z.object({groupId:o.z.string(),name:o.z.string(),externalId:o.z.string().nullable().optional(),teamId:o.z.number().optional(),type:o.z.enum(["users","teamAdmins"]),publicKey:o.z.string(),privateKey:o.z.string(),revision:o.z.number(),users:o.z.array(o.z.object({userId:o.z.string(),alias:o.z.string(),referrer:o.z.string(),groupKey:o.z.string().nullable().optional(),acceptSignature:o.z.string().nullable().optional(),permission:o.z.enum(["admin","limited"]),rsaStatus:o.z.enum(["noKey","publicKey","sharingKeys"]),status:o.z.enum(["pending","accepted","refused","revoked"]),proposeSignatureUsingAlias:o.z.boolean().optional(),proposeSignature:o.z.string().optional()}))}));class m{getRawCarbon$(){const{queries:{carbonState:e}}=this.client;return e({path:"userSession.sharingData.userGroups"})}async getRawCarbon(){const e=await(0,r.z)(this.getRawCarbon$());if((0,d.hx)(e))throw new Error("Failure getting user groups state from carbon sharing data");return e.data}async get(){const e=await this.getRawCarbon(),t=g.safeParse(e);if(!t.success)throw new Error("Invalid format of user group state");return t.data}async getForGroupIds(e){return(await this.get()).filter((t=>e.includes(t.groupId)))}async getCarbonUserGroupForGroupId(e){return(await this.getCarbonUserGroups()).find((t=>t.groupId===e))}async getCarbonUserGroupForGroupIds(e){return(await this.getCarbonUserGroups()).filter((t=>e.includes(t.groupId)))}getCarbonUserGroups$(){return this.getRawCarbon$().pipe((0,n.U)((e=>{if((0,d.hx)(e))throw new Error("Failure getting user groups state from carbon sharing data");const t=g.safeParse(e.data);if(!t.success)throw new Error("Failure parsing ser groups state from carbon sharing data");return t.data.map(h)})))}async getCarbonUserGroups(){return(await this.getRawCarbon()).map(h)}constructor(e){this.client=e}}m=(0,i.gn)([(0,c.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a._?Object:a._])],m)},19052:(e,t,s)=>{s.d(t,{k:()=>F});var i=s(92336),r=s(86006),n=s(54416),o=s(16433),a=s(43978),c=s(87065),d=s(41842),l=s(14122),u=s(16712),p=s(46449),h=s(43651),g=s(78346),m=s(2683),v=s(93314),y=s(162),S=s(92587),w=s(39431),E=s(50879),I=s(50520);class A{getSharedVaultItemsForSpaceId(e){return this.sharedItemsRepo.sharedItems$().pipe((0,a.w)((t=>{const s=t.map((e=>e.itemId)),i=this.vaultItemsCrud.queries.query({vaultItemTypes:[w.U.Credential,w.U.SecureNote,w.U.Secret],ids:s,propertyFilters:null!==e?[{property:"spaceId",value:e}]:void 0});return(0,y.D)(i)})))}constructor(e,t){this.vaultItemsCrud=e,this.sharedItemsRepo=t}}A=(0,i.gn)([(0,S.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===E.L?Object:E.L,void 0===I.z?Object:I.z])],A);class f{execute({body:e}){const{spaceId:t,sortDirection:s}=e,{userFeatureFlip:i}=this.featureFlips.queries;return i({featureFlip:"sharingVault_web_sharingSyncGrapheneMigration_dev"}).pipe((0,o.q)(1),(0,a.w)((e=>!!(0,g.d6)(e)&&!!(0,g.db)(e)?this.executeWithGrapheneState$(t,s):this.executeWithCarbonState$(t,s))))}executeWithCarbonState$(e,t){const s={dataQuery:{sortToken:{sortCriteria:[{field:"id",direction:t}],uniqField:"id"},filterToken:{filterCriteria:[]}},spaceId:e};return this.carbonLegacyClient.queries.getSharingUsers(s).pipe((0,c.U)((e=>{if((0,g.hx)(e))throw new Error("Unable to get carbon user data.");const t=(0,g.db)(e).items;return(0,g.Vp)(t)})))}executeWithGrapheneState$(e,t){return null!==e?this.executeWithSpace(e,t):this.executeWithoutSpace(t)}executeWithoutSpace(e){return this.sharedItemsRepo.sharedAccess$().pipe((0,c.U)((t=>{const s=this.getSharingUsersFromSharedAccess(t,e);return(0,g.Vp)(s)})))}executeWithSpace(e,t){return this.getVaultItemIdsInSpace(e).pipe((0,a.w)((e=>this.sharedItemsRepo.sharedAccessForIds$(e))),(0,c.U)((e=>{const s=this.getSharingUsersFromSharedAccess(e,t);return(0,g.Vp)(s)})))}getCurrentUserLogin(){return this.context.get(u.l.UserName)}getVaultItemIdsInSpace(e){return this.recipientItems.getSharedVaultItemsForSpaceId(e).pipe((0,d.h)(g.d6),(0,c.U)((e=>{const t=(0,g.db)(e);return[...t.credentialsResult.items.map((e=>e.id)),...t.secureNotesResult.items.map((e=>e.id)),...t.secretsResult.items.map((e=>e.id))]})))}getSharingUsersFromSharedAccess(e,t){const s=this.getCurrentUserLogin(),i=new Map;e.forEach((e=>{e.users.forEach((e=>{if(e.id===s||"accepted"!==e.status)return;const t=i.has(e.id)?i.get(e.id).itemCount:0;i.set(e.id,{id:e.id,itemCount:t+1})}))}));return Array.from(i.values()).sort(((e,s)=>t===v.S.Ascend?e.id.localeCompare(s.id):s.id.localeCompare(e.id)))}constructor(e,t,s,i,r){this.context=e,this.recipientItems=t,this.sharedItemsRepo=s,this.carbonLegacyClient=i,this.featureFlips=r}}f=(0,i.gn)([(0,p.e)(m.K),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===u.f?Object:u.f,void 0===A?Object:A,void 0===I.z?Object:I.z,void 0===l._?Object:l._,void 0===h.P?Object:h.P])],f);var b=s(61076),C=s(21912),O=s(40266),R=s(89720);class T{execute({body:e}){const{sortDirection:t}=e,{userFeatureFlip:s}=this.featureFlips.queries;return s({featureFlip:"sharingVault_web_sharingSyncGrapheneMigration_dev"}).pipe((0,o.q)(1),(0,a.w)((e=>!!(0,g.d6)(e)&&!!(0,g.db)(e)?this.executeWithGrapheneState$(t):this.executeWithCarbonState$(t))))}executeWithGrapheneState$(e){return this.sharedItemsRepo.sharedAccess$().pipe((0,b.V)(this.userGroupsRepo.getUserGroups()),(0,c.U)((([t,s])=>{const i=this.context.get(u.l.UserName)??"",r=new Map;Object.values(s).forEach((e=>{e.acceptedUsers?.includes(i)&&r.set(e.groupId,{id:e.groupId,name:e.name,users:e.acceptedUsers,itemCount:0})})),t.forEach((e=>{e.userGroups.forEach((e=>{if("accepted"!==e.status)return;const t=r.get(e.id);if(!t)return;const s=t.itemCount||0;r.set(t.id,{id:t.id,name:t.name,users:t.users,itemCount:s+1})}))}));const n=Array.from(r.values()).sort(((t,s)=>e===C.S.Ascend?t.name.localeCompare(s.name):s.name.localeCompare(t.name)));return(0,g.Vp)(n)})))}executeWithCarbonState$(e){const t={dataQuery:{sortToken:{sortCriteria:[{field:"name",direction:e}],uniqField:"id"},filterToken:{filterCriteria:[]}},spaceId:""};return this.carbonLegacyClient.queries.getUserGroups(t).pipe((0,c.U)((e=>{if((0,g.hx)(e))throw new Error("Unable to carbon user group data.");const t=(0,g.db)(e).items.map((e=>({id:e.id,itemCount:e.itemCount,name:e.name,users:e.users.map((e=>e.id))})));return(0,g.Vp)(t)})))}constructor(e,t,s,i,r){this.sharedItemsRepo=e,this.userGroupsRepo=t,this.carbonLegacyClient=s,this.featureFlips=i,this.context=r}}T=(0,i.gn)([(0,p.e)(O.$),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I.z?Object:I.z,void 0===R.x?Object:R.x,void 0===l._?Object:l._,void 0===h.P?Object:h.P,void 0===u.f?Object:u.f])],T);var _=s(85378),D=s(38357);class F{}F=(0,i.gn)([(0,r.Y)({api:n.m,providers:[A],handlers:{commands:{},events:{},queries:{getSharingUsers:f,getSharingGroupsWithItemCount:T}},domainName:"sharing",imports:[_.u,D.F]})],F)},91969:(e,t,s)=>{s.d(t,{V:()=>u,c:()=>l});var i=s(92336),r=s(87065),n=s(92587),o=s(78346),a=s(13252),c=s(11797),d=s(63784);const l=e=>({users:e.users?.map((e=>({id:e.login,name:e.login,permission:e.permission,status:e.status})))??[],userGroups:e.userGroups?.map((e=>({id:e.uuid,name:e.name,permission:e.permission,status:e.status})))??[]});class u{async getCollectionsByIds(e){return(await this.store.getState()).sharedCollections.filter((t=>e.includes(t.uuid)))}async getCollections(){return(await this.store.getState()).sharedCollections}collections$(){return this.store.state$.pipe((0,r.U)((e=>e.sharedCollections)))}collection$(e){return this.collections$().pipe((0,r.U)((t=>t.find((t=>t.uuid===e)))))}async getCollection(e){const t=(await this.store.getState()).sharedCollections.find((t=>t.uuid===e));if(t)return t}async updateCollections(e){await this.store.set({sharedCollections:[...e]})}getGroupRoleInCollection$(e,t){return this.collection$(e).pipe((0,r.U)((e=>{if(!e)throw new Error("Shared collection not found");const s=e.userGroups?.find((e=>e.uuid===t));return s?.permission===a.y3.Admin?c.Yt.Manager:c.Yt.Editor})))}usersAndGroupsInCollection(e){return this.collections$().pipe((0,r.U)((t=>{const s=t.filter((t=>e.includes(t.uuid))),i=s.flatMap((e=>e.users?e.users:[])).map((e=>({id:e.login,label:e.login,status:e.status,permission:e.permission}))),r=s.flatMap((e=>e.userGroups?e.userGroups:[])).map((e=>({id:e.uuid,label:e.name,status:e.status,permission:e.permission})));return(0,o.Vp)({userGroups:r,users:i})})))}constructor(e){this.store=e}}u=(0,i.gn)([(0,n.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===d.C?Object:d.C])],u)},32336:(e,t,s)=>{s.d(t,{T_:()=>g,cx:()=>p});var i=s(7165),r=s(13252),n=s(11797),o=s(78262);const a=i.z.nativeEnum(o.o),c=i.z.object({permission:r.Iy,proposeSignature:i.z.optional(i.z.string()),acceptSignature:i.z.optional(i.z.nullable(i.z.string())),encryptedResourceKey:i.z.string(),accessType:a}),d=c.extend({accessType:i.z.literal(o.o.User)}),l=c.extend({accessType:i.z.literal(o.o.UserGroup),groupEncryptedKey:i.z.optional(i.z.string()),groupPrivateKey:i.z.optional(i.z.string()),groupPublicKey:i.z.optional(i.z.string())}),u=i.z.union([d,l]),p=i.z.object({sharedCollections:i.z.array(n.MX)}),h=i.z.object({id:i.z.string(),name:i.z.string(),privateKey:i.z.string(),publicKey:i.z.string(),revision:i.z.number(),isAccepted:i.z.boolean(),permission:r.Iy,accessLink:i.z.optional(u),isLastAdmin:i.z.boolean(),pendingDirectAccess:i.z.optional(i.z.object({referrer:i.z.string(),permission:r.Iy}))}),g=i.z.object({collections:i.z.record(h),sharedCollectionsAccess:i.z.record(n.Ng)})},5482:(e,t,s)=>{s.d(t,{U:()=>i});class i{}},71275:(e,t,s)=>{s.d(t,{G:()=>i});class i{}},46675:(e,t,s)=>{s.d(t,{a:()=>vt});var i=s(92336),r=s(86006),n=s(62048),o=s(41511),a=s(40416),c=s(63784),d=s(92587);class l{}var u=s(85337),p=s(6554),h=s(7533);class g{async createCollection(e,t,s,i,r){const n=await this.sharingCrypto.createResourceKey(),o={resourceKey:n,uuid:e},a=await this.sharingUsers.createSignedUserInvites(i,o),c=r.length>0?await this.sharingUserGroups.createSignedUserGroupInvites(r,o):void 0,{publicKey:d,privateKey:l}=await this.sharingCrypto.createRecipientKeyPair(n);return this.sharingCollectionsGateway.createCollection({collectionId:e,collectionName:s,publicKey:d,privateKey:l,users:a,userGroups:c,teamId:Number(t)})}async renameCollection(e,t){const{revision:s,uuid:i}=e;await this.sharingCollectionsGateway.renameCollection({collectionId:i,revision:s,updatedName:t})}async inviteCollectionMembers(e,t,s,i,r){const n=i.length?this.sharingUsers.createSignedUserInvites(i,{resourceKey:s,uuid:e},!1):void 0,o=r.length?this.sharingUserGroups.createSignedUserGroupInvites(r,{resourceKey:s,uuid:e}):void 0,[a,c]=await Promise.all([n,o]);return await this.sharingCollectionsGateway.inviteCollectionMembers({revision:t,collectionId:e,users:a,userGroups:c})}async updateCollectionMembers(e,t,s){const{revision:i,uuid:r}=e;return await this.sharingCollectionsGateway.updateCollectionMembers({revision:i,collectionId:r,users:t,userGroups:s})}constructor(e,t,s,i){this.sharingCollectionsGateway=e,this.sharingCrypto=t,this.sharingUserGroups=s,this.sharingUsers=i}}g=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===l?Object:l,void 0===h.M?Object:h.M,void 0===u.o?Object:u.o,void 0===p.E?Object:p.E])],g);var m=s(60399),v=s(78346),y=s(13252),S=s(53384),w=s(35594),E=s(523),I=s(63352),A=s(44647),f=s(59093),b=s(39431),C=s(50879),O=s(13134),R=s(90936),T=s(19298);class _{async getDomainForCredential(e){const t=await(0,m.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[b.U.Credential],ids:[e]}));if((0,v.hx)(t))throw new Error("Unable to find selected item");const s=t.data.credentialsResult.items[0];return new O.Y(s.URL).getRootDomain()}async createCollectionInvites(e,t,s){const i=await Promise.all(t.map((async t=>{const i=await this.sharingCryptoUtility.decryptItemGroupKey(t);if(null===i)throw new Error("Unable to decrypt item group key");const r=await this.sharingCryptoUtility.decryptSharedCollectionKeyForCurrentUser(e);if(!r)throw new Error("Unable to decrypt collection key");const n=await this.sharingCryptoElements.decryptSecureData(r,(0,I.R)(e.privateKey)),{proposeSignature:o,acceptSignature:a,resourceKey:c}=await this.sharingInvitesCrypto.createSignedInvite(e.id,{resourceKey:i,uuid:t.sharedItemId},e.publicKey,(0,A.v)(n));if(!c)throw new Error("Could not create resource key when generating user group invite for collection");if(!a)throw new Error("should not happen");const d=await(0,m.z)(this.activityLogs.queries.areSensitiveLogsEnabled());if((0,v.hx)(d))throw new Error("Unable find preferences");const l=await(0,m.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[b.U.Credential,b.U.SecureNote],ids:[t.itemId]}));if((0,v.hx)(l))throw new Error("Unable to find selected item");const u=l.data.credentialsResult.items.length?{domain:await this.getDomainForCredential(t.itemId),type:y.y2.Credential}:void 0;return{id:t.sharedItemId,permission:s,resourceKey:c,proposeSignature:o,acceptSignature:a,auditLogData:u}})));return{collectionId:e.id,revision:e.revision,itemGroups:i}}constructor(e,t,s,i,r){this.sharingInvitesCrypto=e,this.sharingCryptoElements=t,this.sharingCryptoUtility=s,this.vaultItemsCrudClient=i,this.activityLogs=r}}_=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===T.f?Object:T.f,void 0===h.M?Object:h.M,void 0===R.Z?Object:R.Z,void 0===C.L?Object:C.L,void 0===f._?Object:f._])],_);var D=s(40217),F=s(51612);class P{async addItemsToCollections(e,t,s){const i=await(0,m.z)(this.sharingItemsClient.queries.getSharedItemsForItemIds({itemIds:t}));if((0,v.hx)(i))throw new Error("Unable to find item groups for items");const r=(0,v.db)(i).sharedItems;if(!r.every((e=>e.permission===y.y3.Admin)))throw new Error("User does not have access to share selected items");const n=await this.credentialsGetter.getCarbonCredentialsByItemIds(t),o=await this.notesGetter.getCarbonNotesByItemIds(t),a=[...n,...o];if(o.some((e=>e.Attachments?.length)))return(0,v.Rn)((0,S.LG)());const c=[...a.filter((({Id:e})=>!r.some((t=>t.itemId===e))))],d=c.length>0?await this.sharingItemGroups.createMultipleItemGroups(c):[];return await Promise.all(e.map((async e=>{const t=await this.collectionInvitesService.createCollectionInvites(e,[...r,...d],s.find((t=>t.collectionId===e.id))?.permission??y.y3.Admin);await this.sharingCollectionsApi.addItemGroupsToCollection(t)}))),(0,v.Vp)(void 0)}constructor(e,t,s,i,r,n){this.collectionInvitesService=e,this.sharingItemGroups=t,this.sharingCollectionsApi=s,this.credentialsGetter=i,this.notesGetter=r,this.sharingItemsClient=n}}P=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_?Object:_,void 0===D.k?Object:D.k,void 0===l?Object:l,void 0===F.J?Object:F.J,void 0===E.H?Object:E.H,void 0===w.s?Object:w.s])],P);var U=s(16712),N=s(82874),L=s(43651),x=s(6489),G=s(51607);function k(e){return void 0!==e}var K=s(71275),M=s(5482),j=s(89720),V=s(21003),W=s(80629);class B{async execute({body:e}){const{collectionPermissions:t,itemIds:s,shouldSkipSync:i}=e,{userFeatureFlip:r}=this.featureFlips.queries,n=await(0,m.z)(r({featureFlip:x.d.SharingSyncGrapheneMigrationDev})),o=!!(0,v.d6)(n)&&!!(0,v.db)(n)?await this.collectionsNewRepository.getCollectionsById(t.map((({collectionId:e})=>e))):await this.getCollectionLegacy(t),a=await this.sharingCollectionItems.addItemsToCollections(o.filter(k),s,t);if((0,v.hx)(a))throw new Error("Failed adding an item to a list of collections");return i||await this.sharingSync.scheduleSync(),(0,v.Vp)(void 0)}async getCollectionLegacy(e){const t=await this.collectionsRepository.getCollectionsByIds(e.map((e=>e.collectionId)));if(t.length!==e.length)throw new Error("Unable to find some of the collections in the list");const s=Object.values(await this.userGroupsRepository.getUserGroups()),i=this.getCurrentUserLogin();if(!i)throw new Error("No loged in user available when adding items to collections");return t.map((e=>(0,V.E)(e,s,i)))}getCurrentUserLogin(){return this.context.get(U.l.UserName)}constructor(e,t,s,i,r,n,o){this.sharingCollectionItems=e,this.sharingSync=t,this.collectionsRepository=s,this.collectionsNewRepository=i,this.userGroupsRepository=r,this.featureFlips=n,this.context=o}}B=(0,i.gn)([(0,N.W)(G.k),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===P?Object:P,void 0===W.D?Object:W.D,void 0===K.G?Object:K.G,void 0===M.U?Object:M.U,void 0===j.x?Object:j.x,void 0===L.P?Object:L.P,void 0===U.f?Object:U.f])],B);var z=s(91969),q=s(53344);const H=e=>e.map((({id:e,resourceKey:t,proposeSignature:s,proposeSignatureUsingAlias:i,acceptSignature:r,alias:n,permission:o})=>({login:e,collectionKey:t,proposeSignature:s,proposeSignatureUsingAlias:i,acceptSignature:r,alias:n,permission:o}))),Y=e=>e.map((({id:e,resourceKey:t,proposeSignature:s,acceptSignature:i,permission:r})=>({groupUUID:e,collectionKey:t,proposeSignature:s,acceptSignature:i,permission:r})));var Q=s(11819);class ${async createCollection(e){const t=await(0,m.z)(this.serverApiClient.v1.sharingUserdevice.createCollection((e=>{const{collectionId:t,collectionName:s,users:i,userGroups:r,publicKey:n,privateKey:o,teamId:a}=e;return{collectionUUID:t,collectionName:s,publicKey:n,privateKey:o,teamId:a,users:H(i),userGroups:r?Y(r):void 0}})(e)));if((0,v.hx)(t))throw new Error("Failed to create shared collection from private one");const s=(0,v.db)(t).data.collections?.find((t=>t.uuid===e.collectionId));if(!s)throw new Error("Unable to find collection");return s}async renameCollection(e){const{collectionId:t,revision:s,updatedName:i}=e,r=await(0,m.z)(this.serverApiClient.v1.sharingUserdevice.renameCollection({collectionUUID:t,revision:s,updatedName:i}));if((0,v.hx)(r))throw new Error("Failed to rename shared collection")}async addItemGroupsToCollection(e){const t=[];for(let s=0;s<e.itemGroups.length;s+=100)t.push(e.itemGroups.slice(s,s+100));let s=e.revision;for(const i of t){const t=await(0,m.z)(this.serverApiClient.v1.sharingUserdevice.addItemGroupsToCollection({collectionUUID:e.collectionId,itemGroups:i.map((({id:e,proposeSignature:t,acceptSignature:s,permission:i,resourceKey:r,auditLogData:n})=>({uuid:e,proposeSignature:t,acceptSignature:s,permission:i,itemGroupKey:r,auditLogDetails:n?(0,Q.B)(n):void 0}))),revision:s}));if((0,v.hx)(t))throw new Error("Failed to add items to collection",{cause:t.error});const r=(0,v.db)(t).data;if(!r.collections?.length)throw new Error("Failed to add items to collection");s=r.collections[0].revision}}async deleteCollection(e,t){const s={collectionUUID:e,revision:t},i=await(0,m.z)(this.serverApiClient.v1.sharingUserdevice.deleteCollection(s));if((0,v.hx)(i))throw new Error("Failed to delete shared collection")}async inviteCollectionMembers({collectionId:e,revision:t,users:s,userGroups:i}){const r={collectionUUID:e,revision:t,users:s?H(s):void 0,userGroups:i?Y(i):void 0},n=this.serverApiClient.v1.sharingUserdevice.inviteCollectionMembers(r),o=await(0,m.z)(n);if((0,v.hx)(o)||!o.data.data.collections)throw new Error("Failed to add members to collection");return o.data.data.collections[0]}async updateCollectionMembers({collectionId:e,revision:t,users:s,userGroups:i}){const r={collectionUUID:e,revision:t,users:s,userGroups:i?.map((({groupId:e,permission:t})=>({groupUUID:e,permission:t})))},n=this.serverApiClient.v1.sharingUserdevice.updateCollectionMembers(r),o=await(0,m.z)(n);if((0,v.hx)(o)||!o.data.data.collections)throw new Error("Failed to update collection members");return o.data.data.collections[0]}async revokeCollectionMembers({collectionId:e,revision:t,userGroupIds:s,userLogins:i}){const r=this.serverApiClient.v1.sharingUserdevice.revokeCollectionMembers({collectionUUID:e,revision:t,userLogins:i,userGroupUUIDs:s}),n=await(0,m.z)(r);if((0,v.hx)(n)||!n.data.data.collections)throw new Error("Failed to revoke access to collection");return n.data.data.collections[0]}async removeItemGroupsFromCollection(e,t){const s=await(0,m.z)(this.serverApiClient.v1.sharingUserdevice.removeItemGroupsFromCollection({collectionUUID:e.uuid,itemGroupUUIDs:t,revision:e.revision}));if((0,v.hx)(s))throw new Error("Failure to remove items from collection")}async removeItemGroupCollectionAccess(e){const{collectionId:t,itemGroupId:s,itemGroupRevision:i,auditLogData:r}=e,n=await(0,m.z)(this.serverApiClient.v1.sharingUserdevice.revokeItemGroupMembers({revision:i,groupId:s,collections:[t],auditLogDetails:r?(0,Q.B)(r):void 0}));if((0,v.hx)(n))throw new Error("Failure to remove collection member from an item group",{cause:n.error})}constructor(e){this.serverApiClient=e}}$=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===q.l?Object:q.l])],$);var X=s(31105),Z=s(11797);const J=e=>e===Z.Yt.Manager?y.y3.Admin:y.y3.Limited,ee=e=>({login:e.login,permission:J(e.role)}),te=e=>({groupId:e.groupId,permission:J(e.role)});class se{async execute({body:e}){const{collectionId:t,userRecipients:s,userGroupRecipients:i}=e,r=await this.collectionsRepository.getCollection(t);if(!r)throw new Error("Collection not found");return await this.sharingCollectionsService.updateCollectionMembers(r,s?.map(ee),i?.map(te)),await this.sharingSync.scheduleSync(),(0,v.Vp)(void 0)}constructor(e,t,s){this.sharingCollectionsService=e,this.collectionsRepository=t,this.sharingSync=s}}se=(0,i.gn)([(0,N.W)(X.c),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===g?Object:g,void 0===K.G?Object:K.G,void 0===W.D?Object:W.D])],se);var ie=s(61076),re=s(87065),ne=s(69885),oe=s(33312),ae=s(63144),ce=s(56618),de=s(7303),le=s(60018),ue=s(62149),pe=s(32336);const he=e=>pe.T_.safeParse(e).success;class ge extends((0,ae.Q)({persist:!0,scope:ue.F.User,storeName:"collections-store",storeTypeGuard:he,storage:{initialValue:{collections:(0,de.Ay)({}),sharedCollectionsAccess:(0,de.Ay)({})},typeGuard:he,schemaVersion:3,migrateStorageSchema:()=>({collections:{},sharedCollectionsAccess:{}})},capacity:ce.Y.Unlimited,codec:le.E,isCache:!0})){}class me{getUserRoleInCollectionCarbon$(e,t,s){const i=t||s;if(!i)throw new Error("No target user to get role in collection");return this.userGroupsRepository.acceptedUserGroupIdsForLogin$(i).pipe((0,ie.V)(this.collectionsRepository.collection$(e)),(0,re.U)((([e,t])=>{if(!t)throw new Error("Shared collection not found");const s=t.users?.find((e=>e.login===i)),r=s?.permission===y.y3.Admin&&s.status===y.qb.Accepted,n=t.userGroups?.filter((t=>e.includes(t.uuid))),o=n?.some((e=>e.permission===y.y3.Admin));return r||o?Z.Yt.Manager:Z.Yt.Editor})))}getUserRoleInCollectionGraphene$(e,t,s){const i=t||s;if(!i)throw new Error("No target user to get role in collection");return this?.userGroupsRepository.acceptedUserGroupIdsForLogin$(i).pipe((0,ie.V)(this.store.state$),(0,re.U)((([t,s])=>{const{sharedCollectionsAccess:r}=s,n=r[e];if(!n)throw new Error("Shared collection not found");const o=n.users.find((e=>e.name===i)),a=o?.permission===y.y3.Admin&&o.status===y.qb.Accepted,c=n.userGroups.filter((e=>t.includes(e.id))).some((e=>e.permission===y.y3.Admin));return a||c?Z.Yt.Manager:Z.Yt.Editor})))}getGroupRoleInCollection$(e,t){return this.collectionsRepository.getGroupRoleInCollection$(e,t)}canShareItems(e){return 0===e.length?(0,ne.of)((0,v.Vp)(!0)):this.sharingItemsClient.queries.getSharedItemsForItemIds({itemIds:e}).pipe((0,oe.Qn)((e=>e.sharedItems.every((e=>e.permission===y.y3.Admin)))))}constructor(e,t,s,i){this.collectionsRepository=e,this.userGroupsRepository=t,this.sharingItemsClient=s,this.store=i}}me=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===K.G?Object:K.G,void 0===j.x?Object:j.x,void 0===w.s?Object:w.s,void 0===ge?Object:ge])],me);var ve=s(46449),ye=s(14947);class Se{execute(){const e=this.collectionsRepository.collections$(),t=this.getCurrentUserLogin();return e.pipe((0,re.U)((e=>{const s=e.filter((e=>e.authorLogin===t));return(0,v.Vp)(s.length)})))}getCurrentUserLogin(){return this.context.get(U.l.UserName)}constructor(e,t){this.collectionsRepository=e,this.context=t}}Se=(0,i.gn)([(0,ve.e)(ye.C),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===K.G?Object:K.G,void 0===U.f?Object:U.f])],Se);var we=s(63792),Ee=s(27790);class Ie{async execute({body:e}){const{collection:t,itemId:s}=e,i=await(0,m.z)(this.sharingItemsClient.queries.getSharedItemForId({itemId:s}));if((0,v.hx)(i)||!i.data.sharedItem)throw new Error("Item group to be removed from collection cannot be found");const{sharedItemId:r,revision:n}=i.data.sharedItem;return await this.sharingCommon.updateItemGroupMembers({groupId:r,collections:[{collectionUUID:t.collectionId,permission:t.permission}],revision:n}),await this.sharingSync.scheduleSync(),(0,v.Vp)(void 0)}constructor(e,t,s){this.sharingCommon=e,this.sharingSync=t,this.sharingItemsClient=s}}Ie=(0,i.gn)([(0,N.W)(we.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ee.b_?Object:Ee.b_,void 0===W.D?Object:W.D,void 0===w.s?Object:w.s])],Ie);const Ae=({id:e,name:t,revision:s,publicKey:i,privateKey:r})=>({uuid:e,name:t,revision:s,publicKey:i,privateKey:r});class fe{async getCollectionsByIds(e){const t=await this.store.getState();return e.reduce(((e,s)=>{const i=t.collections[s];return i&&e.push(Ae(i)),e}),(0,de.Ay)([]))}async getCollections(){const e=await this.store.getState();return Object.values(e.collections).map((e=>Ae(e)))}collections$(){return this.store.state$.pipe((0,re.U)((e=>Object.values(e.collections).reduce(((e,t)=>(t.isAccepted&&e.push(Ae(t)),e)),(0,de.Ay)([])))))}collection$(e){return this.collections$().pipe((0,re.U)((t=>t.find((t=>t.uuid===e)))))}async getCollection(e){const t=(await this.store.getState()).collections[e];if(t)return Ae(t)}async updateCollections(){}getGroupRoleInCollection$(e,t){return this.store.state$.pipe((0,re.U)((s=>{const{sharedCollectionsAccess:i}=s,r=i[e];if(!r)throw new Error("Shared collection not found");const n=r.userGroups.find((e=>e.id===t));return n?.permission===y.y3.Admin?Z.Yt.Manager:Z.Yt.Editor})))}usersAndGroupsInCollection(e){return this.store.state$.pipe((0,re.U)((t=>{const{sharedCollectionsAccess:s}=t,i=e.flatMap((e=>s[e]?s[e].users.map((e=>({id:e.name,label:e.name,status:e.status??y.qb.Pending,permission:e.permission}))):[])),r=e.flatMap((e=>s[e]?s[e].userGroups.map((e=>({id:e.id,label:e.name,status:e.status??y.qb.Pending,permission:e.permission}))):[]));return(0,v.Vp)({userGroups:r,users:i})})))}constructor(e){this.store=e}}fe=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ge?Object:ge])],fe);var be=s(162),Ce=s(43978);class Oe{async getCollectionsByIds(e){return(await this.getRepo()).getCollectionsByIds(e)}async getCollections(){return(await this.getRepo()).getCollections()}collections$(){return(0,be.D)(this.getRepo()).pipe((0,Ce.w)((e=>e.collections$())))}collection$(e){return(0,be.D)(this.getRepo()).pipe((0,Ce.w)((t=>t.collection$(e))))}async getCollection(e){return(await this.getRepo()).getCollection(e)}async updateCollections(e){return(await this.getRepo()).updateCollections(e)}getGroupRoleInCollection$(e,t){return(0,be.D)(this.getRepo()).pipe((0,Ce.w)((s=>s.getGroupRoleInCollection$(e,t))))}usersAndGroupsInCollection(e){return(0,be.D)(this.getRepo()).pipe((0,Ce.w)((t=>t.usersAndGroupsInCollection(e))))}async getRepo(){const{userFeatureFlip:e}=this.featureFlips.queries,t=await(0,m.z)(e({featureFlip:x.d.SharingSyncGrapheneMigrationDev}));return(0,v.hx)(t)?this.legacyRepo:(0,v.db)(t)?this.repo:this.legacyRepo}constructor(e,t,s){this.legacyRepo=e,this.repo=t,this.featureFlips=s}}Oe=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===z.V?Object:z.V,void 0===fe?Object:fe,void 0===L.P?Object:L.P])],Oe);class Re{async getCollections(){const{collections:e}=await this.store.getState();return e}async getCollectionsById(e){const{collections:t}=await this.store.getState();return e.reduce(((e,s)=>(t[s]&&e.push(t[s]),e)),(0,de.Ay)([]))}async setCollections(e,t){const s=await this.store.getState();await this.store.set(e.reduce(((e,i)=>(e.collections[i.id]=i,e.sharedCollectionsAccess[i.id]=t[i.id]??s.sharedCollectionsAccess[i.id],e)),(0,de.Ay)({collections:{},sharedCollectionsAccess:{}})))}sharedCollectionsAccessForId$(e){return this.store.state$.pipe((0,re.U)((({sharedCollectionsAccess:t})=>t[e])))}constructor(e){this.store=e}}Re=(0,i.gn)([(0,d.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ge?Object:ge])],Re);var Te=s(77802),_e=s(50436);const De=e=>e.login,Fe=e=>e.groupId,Pe=e=>e.length>0?e.map(De):void 0;class Ue{async execute({body:e}){const{teamId:t,collectionName:s,privateCollectionId:i,users:r,groups:n,defaultItemPermissions:o,itemIds:a}=e,c=(0,_e.R)(),d=await this.sharingCollections.createCollection(c,t,s,r.map(ee),n.map(te)),l={collectionId:c,permission:o};if(a.length>0)try{const e=this.getCurrentUserLogin();if(!e)throw new Error("No loged in user available when adding items to collections");const t=await this.sharingCollectionItems.addItemsToCollections([(0,V.E)(d,[],e)],a,[l]);if((0,v.hx)(t))throw new Error(t.error.tag)}catch(e){const t=await this.sharingCollectionsGateway.revokeCollectionMembers({collectionId:d.uuid,revision:d.revision,userGroupIds:(u=n,u.length>0?u.map(Fe):void 0),userLogins:Pe(r)});if(await this.sharingCollectionsGateway.deleteCollection(t.uuid,t.revision),await this.sharingSync.scheduleSync(),e instanceof Error&&e.message===S.Pf)return(0,v.Rn)((0,S.LG)());throw e}var u;const{commands:p}=this.vaultClient;return i?await p.deleteCollection({id:i}):await this.sharingSync.scheduleSync(),(0,v.Vp)(void 0)}getCurrentUserLogin(){return this.context.get(U.l.UserName)}constructor(e,t,s,i,r,n){this.sharingCollections=e,this.sharingCollectionsGateway=t,this.sharingCollectionItems=s,this.vaultClient=i,this.sharingSync=r,this.context=n}}Ue=(0,i.gn)([(0,N.W)(S.I4),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===g?Object:g,void 0===l?Object:l,void 0===P?Object:P,void 0===Te.C?Object:Te.C,void 0===W.D?Object:W.D,void 0===U.f?Object:U.f])],Ue);var Ne=s(21998);class Le{async execute({body:e}){const{id:t}=e,s=await this.collectionsRepository.getCollection(t);if(!s)throw new Error("Failed to find collection revision");return await this.sharingCollectionsApi.deleteCollection(s.uuid,s.revision),await this.sharingSync.scheduleSync(),(0,v.Vp)(void 0)}constructor(e,t,s){this.sharingSync=e,this.collectionsRepository=t,this.sharingCollectionsApi=s}}Le=(0,i.gn)([(0,N.W)(Ne.U),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===W.D?Object:W.D,void 0===K.G?Object:K.G,void 0===l?Object:l])],Le);var xe=s(22210),Ge=s(35635);class ke{async execute({body:e}){const{collectionId:t,userRecipients:s,userGroupRecipients:i}=e,{userFeatureFlip:r}=this.featureFlips.queries,n=await(0,m.z)(r({featureFlip:"sharingVault_web_sharingSyncGrapheneMigration_dev"}));if((0,v.hx)(n))throw new Error("Cannot retrieve FF for invite collection member command");return!!(0,v.d6)(n)&&!!(0,v.db)(n)?this.executeWithGrapheneState$(t,s,i):this.executeWithCarbonState$(t,s,i)}async executeWithGrapheneState$(e,t,s){const{sharedCollectionsAccess:i,collections:r}=await this.store.getState(),n=r[e],o=i[e];if(!n||!o)throw new Error(`Collection ${e} not found when inviting collection member`);const{revision:a,id:c}=n,d=await this.currentUserGetter.getCurrentUserWithKeys(),l=await this.sharingCrypto.decryptSharedCollectionKey(n,d);if(!l)throw new Error("Cannot decrypt collection key.");const u=t?.map(ee),p=s?.map(te);return await this.sharingCollectionsService.inviteCollectionMembers(c,a,l,u||[],p||[]),await this.syncService.scheduleSync(),(0,v.Vp)(void 0)}async executeWithCarbonState$(e,t,s){const i=await this.collectionsRepository.getCollection(e);if(!i)throw new Error("Collection not found");const r=t?.map(ee),n=s?.map(te),o=await this.sharingCrypto.decryptCollectionKey(i);if(!o)throw new Error("Cannot decrypt collection key.");const a=await this.sharingCollectionsService.inviteCollectionMembers(i.uuid,i.revision,o,r||[],n||[]),c=(await this.collectionsRepository.getCollections()).filter((e=>e.uuid!==a.uuid));return await this.collectionsRepository.updateCollections([...c,a]),(0,v.Vp)(void 0)}constructor(e,t,s,i,r,n,o){this.collectionsRepository=e,this.sharingCollectionsService=t,this.featureFlips=s,this.store=i,this.currentUserGetter=r,this.sharingCrypto=n,this.syncService=o}}ke=(0,i.gn)([(0,N.W)(xe.Q),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===K.G?Object:K.G,void 0===g?Object:g,void 0===L.P?Object:L.P,void 0===ge?Object:ge,void 0===Ge.a?Object:Ge.a,void 0===R.Z?Object:R.Z,void 0===W.D?Object:W.D])],ke);var Ke=s(94020),Me=s(57452);class je{async prepareAuditLogDetails(e){const{userFeatureFlips:t}=this.featureFlips.queries,s=await(0,m.z)(t().pipe((0,oe.Qn)((e=>e.audit_logs_sharing&&e.send_activity_log)))),i=!!(0,v.d6)(s)&&(s.data??!1),r=await(0,m.z)(this.currentSpaceGetter.get());if((0,v.hx)(r))throw new Error("Error fetching current space when moving shared collection items to business space");if(!r.data.areSensitiveLogsEnabled||!i)return;const n=await(0,m.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[b.U.Credential],ids:[e]}));if((0,v.hx)(n))throw new Error("Unable to find selected item");const o=(0,v.db)(n),a=o.credentialsResult.matchCount?o.credentialsResult.items[0]:void 0,c=a?new O.Y(a.URL).getRootDomain():"";return{domain:a?c:void 0,type:a?y.y2.Credential:y.y2.SecureNote}}async removeItemToCollection(e,t){const s=await(0,m.z)(this.sharingItemsClient.queries.getSharedItemForId({itemId:e}));if((0,v.hx)(s)||!s.data.sharedItem)throw new Error("Item group to be removed from collection cannot be found");const{sharedItemId:i,revision:r}=s.data.sharedItem,n=await this.prepareAuditLogDetails(e);await this.sharingCollectionsGateway.removeItemGroupCollectionAccess({collectionId:t,itemGroupId:i,itemGroupRevision:r,auditLogData:n})}async execute({body:e}){const{collectionIds:t,itemId:s}=e;for(const e of t)await this.removeItemToCollection(s,e);return await this.sharingSync.scheduleSync(),(0,v.Vp)(void 0)}constructor(e,t,s,i,r,n){this.sharingCollectionsGateway=e,this.sharingSync=t,this.currentSpaceGetter=s,this.featureFlips=i,this.vaultItemsCrudClient=r,this.sharingItemsClient=n}}je=(0,i.gn)([(0,N.W)(Ke.B),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===l?Object:l,void 0===W.D?Object:W.D,void 0===Me.n?Object:Me.n,void 0===L.P?Object:L.P,void 0===C.L?Object:C.L,void 0===w.s?Object:w.s])],je);var Ve=s(46733);class We{async execute({body:e}){const{collectionId:t,newName:s}=e,i=await this.collectionsRepository.getCollection(t);if(!i)throw new Error("Failed to find collection revision");return await this.sharingCollections.renameCollection(i,s),await this.sharingSync.scheduleSync(),(0,v.Vp)(void 0)}constructor(e,t,s){this.sharingCollections=e,this.collectionsRepository=t,this.sharingSync=s}}We=(0,i.gn)([(0,N.W)(Ve.r),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===g?Object:g,void 0===K.G?Object:K.G,void 0===W.D?Object:W.D])],We);var Be=s(88621);class ze{async execute({body:e}){const{collectionId:t,userGroupIds:s,userLogins:i}=e,r=await this.collectionsRepository.getCollection(t);if(!r)throw new Error("Cannot access the requested collection.");const{revision:n}=r;return await this.sharingCollectionsGateway.revokeCollectionMembers({collectionId:t,revision:n,userGroupIds:s,userLogins:i}),await this.sharingSync.scheduleSync(),(0,v.Vp)(void 0)}constructor(e,t,s){this.collectionsRepository=e,this.sharingCollectionsGateway=t,this.sharingSync=s}}ze=(0,i.gn)([(0,N.W)(Be.q),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===K.G?Object:K.G,void 0===l?Object:l,void 0===W.D?Object:W.D])],ze);var qe=s(76001);class He{async execute({body:e}){return await this.collectionsRepository.updateCollections(e.collections),(0,v.Vp)(void 0)}constructor(e){this.collectionsRepository=e}}He=(0,i.gn)([(0,N.W)(qe.M),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===K.G?Object:K.G])],He);var Ye=s(6136),Qe=s(62760),$e=s(13312);class Xe{isCollectionsSharingEnabled(e){return e.isSharingEnabled&&e.isCollectionsSharingEnabled}execute({body:e}){const{collectionId:t,userId:s}=e,{queries:{queryCollections:i}}=this.vaultOrganization;return i({ids:[t]}).pipe((0,ie.V)(this.currentSpace.get(),this.featureFlips.queries.userFeatureFlip({featureFlip:"sharingVault_web_sharingSyncGrapheneMigration_dev"})),(0,Ce.w)((([e,i,r])=>{if((0,v.hx)(e))throw new Error("Error accessing private collections");if((0,v.hx)(i))throw new Error("Error accessing current space info");if((0,v.hx)(r))throw new Error("Cannot retrieve FF for invite collection member command");const n=this.isCollectionsSharingEnabled((0,v.db)(i)),o=!!(0,v.d6)(r)&&!!(0,v.db)(r),a=(0,v.db)(e).collections.find((({id:e})=>e===t));if(a)return this.getPermissionsForPrivateCollection(a,n);const c=this.context.get(U.l.UserName);return o?this.sharingAccess.getUserRoleInCollectionGraphene$(t,s,c).pipe((0,re.U)((e=>{const t=e===Z.Yt.Manager;return{canShare:n&&t,canEditRoles:t,canEdit:t,canDelete:t,role:e,sharingDisabledReason:n?Z.Hz.EditorRole:Z.Hz.DisabledInTAC}})),(0,Ye.x)(Qe.shallowEqualObjects),(0,re.U)(v.Vp)):this.sharingAccess.getUserRoleInCollectionCarbon$(t,s,c).pipe((0,re.U)((e=>{const t=e===Z.Yt.Manager;return{canShare:n&&t,canEditRoles:t,canEdit:t,canDelete:t,role:e,sharingDisabledReason:n?Z.Hz.EditorRole:Z.Hz.DisabledInTAC}})),(0,Ye.x)(Qe.shallowEqualObjects),(0,re.U)(v.Vp))})))}getPermissionsForPrivateCollection(e,t){if(!t)return(0,ne.of)((0,v.Vp)({canShare:!1,canEditRoles:!0,canEdit:!0,canDelete:!0,role:Z.Yt.Manager,sharingDisabledReason:Z.Hz.DisabledInTAC}));const s=e.vaultItems.map((({id:e})=>e));return this.sharingAccess.canShareItems(s).pipe((0,re.U)((e=>{if((0,v.hx)(e))throw new Error("Error checking if user can share a collection");const t=(0,v.db)(e);return{canShare:t,canEditRoles:!0,canEdit:!0,canDelete:!0,role:Z.Yt.Manager,sharingDisabledReason:t?void 0:Z.Hz.LimitedRightItems}})),(0,Ye.x)(Qe.shallowEqualObjects),(0,re.U)(v.Vp))}constructor(e,t,s,i,r){this.sharingAccess=e,this.vaultOrganization=t,this.currentSpace=s,this.context=i,this.featureFlips=r}}Xe=(0,i.gn)([(0,ve.e)($e.y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===me?Object:me,void 0===Te.C?Object:Te.C,void 0===Me.n?Object:Me.n,void 0===U.f?Object:U.f,void 0===L.P?Object:L.P])],Xe);var Ze=s(41869);class Je{execute({body:e}){const{collectionId:t,groupId:s}=e;return this.sharingAccess.getGroupRoleInCollection$(t,s).pipe((0,re.U)((e=>(0,v.Vp)(e))))}constructor(e){this.sharingAccess=e}}Je=(0,i.gn)([(0,ve.e)(Ze.L),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===me?Object:me])],Je);var et=s(10829);class tt{execute({body:e}){const{targetId:t}=e,{userFeatureFlip:s}=this.featureFlips.queries;return s({featureFlip:"sharingVault_web_sharingSyncGrapheneMigration_dev"}).pipe((0,Ce.w)((e=>{if((0,v.hx)(e))throw new Error("Cannot retrieve FF for invite collection member command");return!!(0,v.d6)(e)&&!!(0,v.db)(e)?this.executeWithGrapheneState$(t):this.executeWithCarbonState$(t)})))}executeWithGrapheneState$(e){return this.userGroupsRepository.acceptedUserGroupIdsForLogin$(e).pipe((0,ie.V)(this.store.state$),(0,re.U)((([t,s])=>{const i=[],{collections:r,sharedCollectionsAccess:n}=s;for(const s in n){if(!n[s])continue;if(n[s].users.some((t=>t.name===e))){i.push(Ae(r[s]));continue}if(n[s].userGroups.some((t=>t.id===e))){i.push(Ae(r[s]));continue}n[s].userGroups.some((e=>t.includes(e.id)))&&i.push(Ae(r[s]))}return(0,v.Vp)({collections:i})})))}executeWithCarbonState$(e){return this.userGroupsRepository.acceptedUserGroupIdsForLogin$(e).pipe((0,ie.V)(this.collectionsRepository.getCollections()),(0,re.U)((([t,s])=>{const i=s.filter((s=>{const i=s.users?.some((t=>t.login===e));if(i)return!0;const r=s.userGroups,n=r?.some((t=>t.uuid===e));if(n)return!0;const o=r?.some((e=>t.includes(e.uuid)));return o}));return(0,v.Vp)({collections:i})})))}constructor(e,t,s,i){this.collectionsRepository=e,this.userGroupsRepository=t,this.featureFlips=s,this.store=i}}tt=(0,i.gn)([(0,ve.e)(et.Q),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===K.G?Object:K.G,void 0===j.x?Object:j.x,void 0===L.P?Object:L.P,void 0===ge?Object:ge])],tt);var st=s(7134),it=s(13575);const rt=e=>{if(!e.itemId||!e.sharedItemId)throw new Error("Corrupted item group");return{id:e.itemId,type:b.U.Credential}},nt=(e,t,s)=>{const i=((e,t,s)=>({name:e.name,id:e.uuid,spaceId:s,isShared:!0,vaultItems:t.filter((t=>t.recipientIds.collectionIds?.some((t=>t===e.uuid)))).map(rt)}))(e,t,s);if(it.JQ.safeParse(i).success)return i;throw new Error("Failure to convert shared collection")};class ot{execute({body:e}){const{itemIds:t}=e;return this.collectionsRepository.collections$().pipe((0,ie.V)(this.currentSpaceGetter.get(),this.sharingItemsClient.queries.getSharedItemsForItemIds({itemIds:t})),(0,re.U)((([e,s,i])=>{if((0,v.hx)(s)||(0,v.hx)(i))throw new Error("Unable to access sharing data");const r=i.data.sharedItems,n=e.map((e=>nt(e,r,s.data.teamId))).flatMap((e=>e.vaultItems)),o=t.filter((e=>n.some((t=>t.id===e))));return(0,v.Vp)(o)})))}constructor(e,t,s){this.currentSpaceGetter=e,this.collectionsRepository=t,this.sharingItemsClient=s}}ot=(0,i.gn)([(0,ve.e)(st.q),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Me.n?Object:Me.n,void 0===K.G?Object:K.G,void 0===w.s?Object:w.s])],ot);var at=s(34282);class ct{execute({body:e}){const t=e.collectionIds?e.collectionIds:[];return this.collectionsRepository.collections$().pipe((0,re.U)((e=>(0,v.Vp)(e.filter((e=>!t.length||t.includes(e.uuid)))))))}constructor(e){this.collectionsRepository=e}}ct=(0,i.gn)([(0,ve.e)(at.$),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===K.G?Object:K.G])],ct);class dt{execute(){return this.collectionsRepository.collections$().pipe((0,ie.V)(this.currentSpaceGetter.get(),this.sharingItemsClient.queries.getSharedItems()),(0,re.U)((([e,t,s])=>{if((0,v.hx)(t))throw new Error("Failed to load shared collections");if((0,v.hx)(s))throw new Error("Failed to load shared items data");return(0,v.Vp)(e.map((e=>nt(e,s.data.sharedItems,t.data.teamId))))})))}constructor(e,t,s){this.collectionsRepository=e,this.currentSpaceGetter=t,this.sharingItemsClient=s}}dt=(0,i.gn)([(0,ve.e)(it.MO),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===K.G?Object:K.G,void 0===Me.n?Object:Me.n,void 0===w.s?Object:w.s])],dt);var lt=s(54665);class ut{execute({body:e}){const{collectionIds:t}=e;return this.collectionsRepository.usersAndGroupsInCollection(t)}constructor(e){this.collectionsRepository=e}}ut=(0,i.gn)([(0,ve.e)(lt.O),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===K.G?Object:K.G])],ut);var pt=s(13186),ht=s(75028),gt=s(14139),mt=s(85378);class vt{}vt=(0,i.gn)([(0,r.Y)({api:n.a,stores:[ge,c.C],providers:[g,_,me,P,z.V,fe,{provide:l,useClass:$},{provide:K.G,useClass:Oe},{provide:M.U,useClass:Re}],exports:[K.G,M.U],handlers:{commands:{addItemsToCollections:B,createSharedCollection:Ue,deleteSharedCollection:Le,inviteCollectionMembers:ke,updateCollectionMembers:se,removeItemFromCollections:je,renameCollection:We,revokeCollectionMembers:ze,updateSharedCollections:He,updatePermissionForCollectionItem:Ie},events:{},queries:{getCollectionPermissionsForUser:Xe,getCollectionRoleForGroup:Je,getCollectionsForUserOrGroup:tt,getItemIdsInSharedCollections:ot,getSharedCollectionsCount:Se,getSharedCollections:ct,sharedCollectionsWithItems:dt,usersAndGroupsInCollection:ut}},imports:[o.n,a.D,ht.k,pt.I,gt.y,mt.u],requiredFeatureFlips:["sharing_web_invalidSignatureAutoRevoke_prod","monetization_extension_starterRepackagingCollection"]})],vt)},63784:(e,t,s)=>{s.d(t,{C:()=>c});var i=s(63144),r=s(56618),n=s(62149),o=s(32336);const a=e=>o.cx.safeParse(e).success;class c extends((0,i.Q)({capacity:r.Y._010KB,persist:!1,scope:n.F.User,storeName:"collections-legacy-store",storeTypeGuard:a,initialValue:{sharedCollections:[]}})){}},54250:(e,t,s)=>{s.d(t,{x:()=>i});const i=async(e,t,s=5,i=10)=>{const r=e.length>=20?Math.ceil(e.length/i):s,n=[];for(let t=0;t<e.length;t+=r)n.push(e.slice(t,t+r));const o=n.map((e=>t(e)));return Promise.all(o)}},11819:(e,t,s)=>{s.d(t,{B:()=>n});var i=s(13252);const r=e=>{switch(e){case i.y2.Credential:return"AUTHENTIFIANT";case i.y2.Secret:return"SECRET";default:return"SECURENOTE"}},n=({domain:e,type:t})=>({captureLog:!0,domain:e,type:r(t)})},13186:(e,t,s)=>{s.d(t,{I:()=>O});var i=s(92336),r=s(86006),n=s(60399),o=s(92587),a=s(53344),c=s(33312),d=s(78346),l=s(7303);const u=/[<>]/g;var p=s(98798);function h(e,t){const s=(0,p.B5)(e);return{type:s,name:t||`Untitled ${s}`}}const g=e=>e.map((({id:e,resourceKey:t,proposeSignature:s,proposeSignatureUsingAlias:i,acceptSignature:r,alias:n,permission:o})=>({userId:e,groupKey:t,proposeSignature:s,proposeSignatureUsingAlias:i,acceptSignature:r,alias:n,permission:o})));var m=s(27790),v=s(54250);class y{async getPublicKeysForUsers(e){const t=await(0,n.z)(this.serverApiClient.v1.sharingUserdevice.getUsersPublicKey({logins:e}).pipe((0,c.DZ)((()=>{throw new Error("Cannot get public keys of requested users.")})),(0,c.lk)((e=>(0,d.Vp)(e.data)))));if((0,d.hx)(t))throw new Error("Cannot get public keys of requested users.");return t.data.data.map((e=>{return{login:e.login??(t=e.email,t.trim().toLowerCase().replace(u,"")),publicKey:e.publicKey};var t}))}async createItemGroup({users:e,item:t,itemTitle:s,groupId:i}){const r=await(0,n.z)(this.serverApiClient.v1.sharingUserdevice.createItemGroup({groupId:i,items:[t],users:g(e),itemsForEmailing:[h(t.itemType,s)]}));if((0,d.hx)(r))throw new Error("Failed to create item group");const o=(0,d.db)(r).data.itemGroups?.find((e=>e.groupId===i));if(!o)throw new Error("Error creating item group");return o}async createMultipleItemGroups(e){const t=(await(0,v.x)(e,(async e=>{const t=e.map((({users:e,item:t,itemTitle:s,groupId:i})=>({groupId:i,items:[t],users:g(e),itemsForEmailing:[h(t.itemType,s)]}))),s=await(0,n.z)(this.serverApiClient.v1.sharingUserdevice.createMultipleItemGroups({itemgroups:t}));if((0,d.hx)(s))throw new Error("Failed to create item groups.");return(0,d.db)(s)}))).reduce(((e,t)=>({itemGroups:e.itemGroups.concat(t.data.itemGroups??[]),itemGroupErrors:e.itemGroupErrors.concat(t.data.itemGroupErrors??[])})),(0,l.Ay)({itemGroups:[],itemGroupErrors:[]}));if(t.itemGroupErrors.length)throw new Error("Failed to create some of multiple item groups",{cause:{itemGroupErrors:t.itemGroupErrors}});if(!t.itemGroups.length)throw new Error("No item groups have been created",{cause:{itemGroupErrors:t.itemGroupErrors}});return t.itemGroups}async updateItemGroupMembers(e){const{groupId:t,revision:s,users:i,groups:r,collections:o}=e,a=await(0,n.z)(this.serverApiClient.v1.sharingUserdevice.updateItemGroupMembers({groupId:t,revision:s,collections:o,groups:r,users:i}));if((0,d.hx)(a)){if("BusinessError"===a.error.tag&&a.error.code===m.wI)return(0,d.Rn)((0,m.ge)());throw new Error("Updating members of item groups have failed")}const c=(0,d.db)(a).data;return(0,d.Vp)(c.itemGroups)}async revokeItemGroupMembers(e){const{itemGroupId:t,revision:s,userLogins:i,collectionIds:r,userGroupIds:o,auditLogDetails:a}=e,c=await(0,n.z)(this.serverApiClient.v1.sharingUserdevice.revokeItemGroupMembers({groupId:t,revision:s,collections:r,users:i,groups:o,auditLogDetails:a||void 0}));if((0,d.hx)(c)){if("BusinessError"===c.error.tag&&c.error.code===m.wI)return(0,d.Rn)((0,m.ge)());throw new Error("Revoking members of item groups have failed")}const l=(0,d.db)(c).data;return(0,d.Vp)(l.itemGroups)}async refuseItemGroup(e){const{itemGroupId:t,revision:s}=e,i=await(0,n.z)(this.serverApiClient.v1.sharingUserdevice.refuseItemGroup({groupId:t,revision:s}));if((0,d.hx)(i))throw new Error("Refusing item group have failed");const r=(0,d.db)(i).data;if(!r.itemGroups?.length)throw new Error("No members of item groups have been revoked");if(r.itemGroupErrors?.length)throw new Error("Revoking of some members of item groups failed");return r.itemGroups}async deleteItemGroup(e){const{groupId:t,revision:s}=e,i=await(0,n.z)(this.serverApiClient.v1.sharingUserdevice.deleteItemGroup({groupId:t,revision:s}));if((0,d.hx)(i))throw new Error("Failed to delete item group");return(0,d.Vp)(void 0)}constructor(e){this.serverApiClient=e}}y=(0,i.gn)([(0,o.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.l?Object:a.l])],y);var S=s(40217),w=s(80629),E=s(85337),I=s(6554),A=s(41511),f=s(75028),b=s(85378),C=s(14139);class O{}O=(0,i.gn)([(0,r.Y)({sharedModuleName:"sharing-common",providers:[S.k,w.D,E.o,I.E,{provide:m.b_,useClass:y}],exports:[S.k,w.D,E.o,I.E,m.b_],imports:[b.u,f.k,A.n,C.y]})],O)},40217:(e,t,s)=>{s.d(t,{k:()=>p});var i=s(92336),r=s(92587),n=s(19911),o=s(13252),a=s(50436),c=s(7533),d=s(6554),l=s(27790),u=s(98798);class p{async prepareCreateItemGroupModel(e){const t=(0,a.R)(),s=await this.sharingCrypto.createResourceKey(),i=await this.sharingUsers.createSignedUserInvites([],{resourceKey:s,uuid:t}),r=await this.sharingCrypto.createResourceKey(),o=await this.sharingCrypto.encryptSecureData(s,r),c=await this.sharingCrypto.encryptSharingItem(r,e);return{groupId:t,item:{itemId:e.Id,itemType:(0,u.l7)(e),itemKey:(0,n.s)(o),content:(0,n.s)(c)},itemTitle:e.Title,users:i}}convertToSharedItem(e){const t=e.items?.[0];if(!t)throw new Error("Newly created item group is missing an item");const s=e.users?.[0];if(!s)throw new Error("Newly created item group is missing an admin");const{itemKey:i,itemId:r}=t;if(!s.groupKey)throw new Error("Newly created item group is missing a resource key");return{isLastAdmin:!0,sharedItemId:e.groupId,itemKey:i,itemId:r,accessLink:{accessType:o.Uv.User,encryptedResourceKey:s.groupKey,permission:o.y3.Admin},recipientIds:{userIds:[s.userId],collectionIds:null,userGroupIds:null},permission:o.y3.Admin,revision:e.revision}}async createItemGroup(e){const t=await this.prepareCreateItemGroupModel(e);return this.sharingApi.createItemGroup(t)}async createMultipleItemGroups(e){const t=await Promise.all(e.map((e=>this.prepareCreateItemGroupModel(e))));return(await this.sharingApi.createMultipleItemGroups(t)).map(this.convertToSharedItem)}constructor(e,t,s){this.sharingApi=e,this.sharingCrypto=t,this.sharingUsers=s}}p=(0,i.gn)([(0,r.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===l.b_?Object:l.b_,void 0===c.M?Object:c.M,void 0===d.E?Object:d.E])],p)},80629:(e,t,s)=>{s.d(t,{D:()=>u});var i=s(92336),r=s(78346),n=s(60399),o=s(41842),a=s(92587),c=s(90993),d=s(4174),l=s(48062);class u{async scheduleSync(){const{commands:e}=this.syncClient;return await this.waitOnSyncToFinish(),await e.sync({trigger:l.Trigger.Sharing}),(0,r.Vp)(void 0)}async runSync(){return await this.scheduleSync(),await this.waitOnSyncToFinish(),(0,r.Vp)(void 0)}waitOnSyncToFinish(){return(0,n.z)(this.syncClient.queries.syncProgress().pipe((0,o.h)(r.d6),(0,o.h)((e=>e.data.status!==c.L.IN_PROGRESS))))}constructor(e){this.syncClient=e}}u=(0,i.gn)([(0,a.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===d.Q?Object:d.Q])],u)},85337:(e,t,s)=>{s.d(t,{o:()=>u});var i=s(92336),r=s(7303),n=s(92587),o=s(13252),a=s(89720),c=s(7533),d=s(19298),l=s(35635);class u{async createSignedUserGroupInvites(e,t){return(await this.createSignedUserGroupInvitesPerResource(e,[t]))[t.uuid]}async createSignedUserGroupInvitesPerResource(e,t){const s=await this.getUserGroupsWithKeys(e),i=await Promise.all(t.map((async e=>{const t=await Promise.all(s.map((t=>this.createInvite(t,e))));return{resource:e,invites:t}}))),r={};return i.forEach((({resource:e,invites:t})=>{r[e.uuid]=t})),r}async getUserGroupsWithKeys(e){const t=await this.currentUserGetter.getCurrentUserWithKeys(),s=await this.userGroupsRepository.getUserGroupsForIds(e.map((e=>e.groupId)));return Promise.all(s.map((async s=>{const i=e.find((e=>e.groupId===s.groupId))?.permission??o.y3.Limited,r=s.groupKey;if(!r)throw new Error("Unable to get encrypted user group key.");const n=await this.sharingCrypto.decryptResourceKeyToClearText(t.privateKey,s.privateKey,r);return{permission:i,groupId:s.groupId,publicKey:s.publicKey,clearUserGroupPrivateKey:n}})))}async createInvite(e,t){const{groupId:s,publicKey:i,clearUserGroupPrivateKey:n,permission:o}=e,{proposeSignature:a,acceptSignature:c,resourceKey:d}=await this.sharingInvitesCrypto.createSignedInvite(s,t,i,n);if(!d)throw new Error("Could not create resource key when generating user group invite for shared item");return(0,r.Ay)({permission:o,proposeSignature:a,acceptSignature:c,id:s,resourceKey:d})}constructor(e,t,s,i){this.userGroupsRepository=e,this.sharingCrypto=t,this.sharingInvitesCrypto=s,this.currentUserGetter=i}}u=(0,i.gn)([(0,n.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.x?Object:a.x,void 0===c.M?Object:c.M,void 0===d.f?Object:d.f,void 0===l.a?Object:l.a])],u)},6554:(e,t,s)=>{s.d(t,{E:()=>d});var i=s(92336),r=s(92587),n=s(13252),o=s(27790),a=s(19298),c=s(35635);class d{async createSignedUserInvites(e,t,s=!0){const i=e.length?await this.sharingGateway.getPublicKeysForUsers(e.map((e=>e.login))):[],r=await this.currentUserGetter.getCurrentUserWithKeys(),o=[...s?[{login:r.login,publicKey:r.publicKey,permission:n.y3.Admin}]:[],...i.map((t=>({...t,permission:e.find((e=>e.login===t.login))?.permission??n.y3.Limited})))];return Promise.all(o.map((e=>this.createInvite(e,t,r))))}async createSignedUserInvitesPerResource(e,t){const s=e.length?await this.sharingGateway.getPublicKeysForUsers(e.map((e=>e.login))):[],i=s.map((e=>e.login)),r=e.filter((e=>!i.includes(e.login))).map((({login:e})=>({login:e,publicKey:null}))),o=[...s,...r].map((t=>({...t,permission:e.find((e=>e.login===t.login))?.permission??n.y3.Limited}))),a=await Promise.all(t.map((async e=>{const t=await Promise.all(o.map((t=>this.createInvite(t,e))));return{resource:e,invites:t}}))),c={};return a.forEach((({resource:e,invites:t})=>{c[e.uuid]=t})),c}async createInvite(e,t,s){const i=s?.login===e.login;return{...await this.invitesCryptoService.createSignedInvite(e.login,t,e.publicKey,i?s.privateKey:void 0),id:e.login,alias:e.login,permission:i?n.y3.Admin:e.permission}}constructor(e,t,s){this.currentUserGetter=e,this.invitesCryptoService=t,this.sharingGateway=s}}d=(0,i.gn)([(0,r.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===c.a?Object:c.a,void 0===a.f?Object:a.f,void 0===o.b_?Object:o.b_])],d)},27790:(e,t,s)=>{s.d(t,{b_:()=>o,ge:()=>n,wI:()=>r});var i=s(98124);const r="INVALID_ITEM_GROUP_REVISION",n=(0,i.Vj)(r,"Invalid revision when trying to update item group member");class o{}},75028:(e,t,s)=>{s.d(t,{k:()=>u});var i=s(92336),r=s(86006),n=s(7533),o=s(90936),a=s(19298),c=s(40416),d=s(14139),l=s(85378);class u{}u=(0,i.gn)([(0,r.Y)({sharedModuleName:"sharing-crypto",providers:[n.M,o.Z,a.f],exports:[n.M,o.Z,a.f],imports:[d.y,c.D,l.u]})],u)},7533:(e,t,s)=>{s.d(t,{M:()=>O});var i=s(92336),r=s(92587),n=s(81929),o=s(7473),a=s(36041),c=s(48702),d=s(60679),l=s(10363),u=s(61805),p=s(49504),h=s(92698),g=s(15996),m=s(19911),v=s(59503),y=s(75711),S=s(98894),w=s(33250),E=s(24595),I=s(63352),A=s(44647),f=s(78346),b=s(14122),C=s(92324);class O{async createResourceKey(){return await this.keyGeneratorAes256.generate()}async encryptSecureData(e,t){return await this.kwc5Encryptor.encrypt(e,t)}async decryptSecureData(e,t){return await this.kwc5Decryptor.decrypt(e,t)}async createProposeSignature(e,t){const s=await this.hmacSigner.sign(e,t);return(0,m.s)(s)}async createRecipientKeyPair(e){const{publicKey:t,privateKey:s}=await this.rsaKeyPairGenerator.generate(),i=(0,v.u)((0,y.R)(s)),r=await this.encryptSecureData(e,i);return{publicKey:(0,S.y)(t),privateKey:(0,m.s)(r)}}async createAcceptSignature(e,t,s){const i=`${t}-accepted-${(0,m.s)(s)}`,r=(0,v.u)(i),n=await this.rsaSigner.sign((0,w.B)(e),r);return(0,m.s)(n)}async verifyAcceptSignature(e,t,s,i){const r=`${s}-accepted-${(0,m.s)(i)}`,n=(0,v.u)(r);return await this.rsaVerifier.verify((0,E.M)(e),(0,I.R)(t),n)}async verifyProposeSignature(e,t,s){return this.hmacVerifier.verify(e,(0,I.R)(s),(0,v.u)(t))}async encryptResourceKey(e,t){return await this.rsaEncryptor.encrypt(e,t)}async decryptResourceKey(e,t){return await this.rsaDecryptor.decrypt(e,t)}async decryptResourceKeyToClearText(e,t,s){const i=await this.decryptResourceKey((0,w.B)(e),(0,I.R)(s)),r=await this.decryptSecureData(i,(0,I.R)(t));return(0,A.v)(r)}async encryptSharingItem(e,t){const{commands:{carbon:s}}=this.client,i=await s({name:"convertItemToDashlaneXml",args:[{item:t}]}),r=(n=i,(0,f.hx)(n)||"string"!=typeof n.data.carbonResult.xml?null:n.data.carbonResult.xml);var n;if(""===r||null===r)throw new Error("Unable to convert item to XML");const o=(0,C.w)(r);return await this.encryptSecureData(e,o)}async decryptContentAndConvertXMLToVaultItem(e,t){const s=(0,I.R)(t),i=await this.decryptSecureData(e,s),r=(0,C.Q)(i),n=await this.client.commands.convertDashlaneXmlToItem({xml:r});if((0,f.hx)(n))return null;const o=(0,f.db)(n);return o.success?o.item:null}async decryptEncapsulatedPrivateKey(e,t,s){const i=await this.decryptResourceKey(e,(0,I.R)(t)),r=await this.decryptSecureData(i,(0,I.R)(s));return(0,w.B)((0,A.v)(r))}constructor(e,t,s,i,r,n,o,a,c,d,l){this.client=e,this.hmacSigner=t,this.hmacVerifier=s,this.keyGeneratorAes256=i,this.rsaKeyPairGenerator=r,this.kwc5Decryptor=n,this.kwc5Encryptor=o,this.rsaDecryptor=a,this.rsaEncryptor=c,this.rsaSigner=d,this.rsaVerifier=l}}O=(0,i.gn)([(0,r.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===b._?Object:b._,void 0===n.q?Object:n.q,void 0===o.a?Object:o.a,void 0===a.c?Object:a.c,void 0===c.e?Object:c.e,void 0===d.$?Object:d.$,void 0===l.o?Object:l.o,void 0===u.g?Object:u.g,void 0===p.H?Object:p.H,void 0===h.k?Object:h.k,void 0===g.u?Object:g.u])],O)},90936:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(92336),r=s(92587),n=s(72298),o=s(63352),a=s(33250),c=s(13252),d=s(7533),l=s(89720),u=s(78262),p=s(35635);class h{async decryptItemGroupKey(e){const t=await this.currentUserGetter.getCurrentUserWithKeys(),{accessLink:s}=e;return this.decryptItemGroupKeyFromAccessLink(s,t)}async decryptItemGroupKeyFromAccessLink(e,t){return e?.accessType===c.Uv.User?this.decryptResourceKeyViaUserMember(e,t):e?.accessType===c.Uv.UserGroup?this.decryptViaGroupMember(e,t):e?.accessType===c.Uv.CollectionUser?this.decryptViaCollectionUserMember(e,t):e?.accessType===c.Uv.CollectionUserGroup?this.decryptViaCollectionUserGroupMember(e,t):null}async decryptSharedItemContent(e,t){try{const s=await this.decryptItemGroupKey(e);if(!s)return null;const i=await this.sharingCrypto.decryptSecureData(s,(0,o.R)(e.itemKey));return await this.sharingCrypto.decryptContentAndConvertXMLToVaultItem(i,t)}catch(e){return null}}async decryptSharedCollectionKey(e,t){const{accessLink:s}=e;return s?.accessType===u.o.User?this.decryptResourceKeyViaUserMember(s,t):s?.accessType===u.o.UserGroup?this.decryptViaGroupMember(s,t):void 0}async decryptSharedCollectionKeyForCurrentUser(e){const t=await this.currentUserGetter.getCurrentUserWithKeys();return this.decryptSharedCollectionKey(e,t)}async decryptResourceKeyViaUserMember(e,t){try{return await this.sharingCrypto.decryptResourceKey((0,a.B)(t.privateKey),(0,o.R)(e.encryptedResourceKey))}catch{return null}}async createSharedItemAcceptSignature(e,t){const s=await this.decryptItemGroupKey(e);if(!s)throw new Error("Failed to decrypt item group key");return await this.sharingCrypto.createAcceptSignature(t.privateKey,e.sharedItemId,s)}async createUserGroupAcceptSignature(e,t,s){const i=await this.sharingCrypto.decryptResourceKey((0,a.B)(e.privateKey),(0,o.R)(t));return await this.sharingCrypto.createAcceptSignature(e.privateKey,s,i)}async decryptViaGroupMember(e,t){const{encryptedResourceKey:s,groupEncryptedKey:i,groupPrivateKey:r}=e;if(!i||!r)return null;try{const e=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,a.B)(t.privateKey),i,r);return await this.sharingCrypto.decryptResourceKey(e,(0,o.R)(s))}catch(e){return null}}async decryptViaCollectionUserMember(e,t){const{encryptedResourceKey:s,collectionEncryptedKey:i,collectionPrivateKey:r}=e;if(!i||!r)return null;const n=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,a.B)(t.privateKey),i,r);return await this.sharingCrypto.decryptResourceKey(n,(0,o.R)(s))}async decryptViaCollectionUserGroupMember(e,t){try{const{encryptedResourceKey:s,collectionEncryptedKey:i,collectionPrivateKey:r,groupEncryptedKey:n,groupPrivateKey:c}=e;if(!(i&&r&&n&&c))return null;const d=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,a.B)(t.privateKey),n,c),l=await this.sharingCrypto.decryptEncapsulatedPrivateKey(d,i,r);return await this.sharingCrypto.decryptResourceKey(l,(0,o.R)(s))}catch(e){return null}}async decryptCollectionKey(e,t=n.qb.Accepted){const s=await this.currentUserGetter.getCurrentUserWithKeys(),i=e.users?.find((e=>e.login===s.login&&e.status===t&&e.collectionKey));if(i?.collectionKey)return await this.decryptCollectionKeyViaUserMember(i,s);const r=Object.values(await this.userGroupsRepository.getUserGroups()).filter((e=>e.groupKey&&e.acceptedUsers?.some((e=>e===s.login)))),o=e.userGroups?.find((e=>r.some((t=>t.groupId===e.uuid))&&e.status===t&&e.collectionKey));return o?.collectionKey?await this.decryptCollectionKeyViaGroupMember(o,s,r):null}async decryptCollectionKeyViaUserMember(e,t){if(!e.collectionKey)return null;try{return await this.sharingCrypto.decryptResourceKey((0,a.B)(t.privateKey),(0,o.R)(e.collectionKey))}catch{return null}}async decryptCollectionKeyViaGroupMember(e,t,s){if(!e.collectionKey)return null;try{const i=s.find((({groupId:t})=>t===e.uuid));if(!i?.groupKey)return null;const r=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,a.B)(t.privateKey),i.groupKey,i.privateKey);return await this.sharingCrypto.decryptResourceKey(r,(0,o.R)(e.collectionKey))}catch{return null}}constructor(e,t,s){this.sharingCrypto=e,this.currentUserGetter=t,this.userGroupsRepository=s}}h=(0,i.gn)([(0,r.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===d.M?Object:d.M,void 0===p.a?Object:p.a,void 0===l.x?Object:l.x])],h)},19298:(e,t,s)=>{s.d(t,{f:()=>d});var i=s(92336),r=s(92587),n=s(24595),o=s(19911),a=s(59503),c=s(7533);class d{async createSignedInvite(e,t,s,i){const r=s?await this.sharingCrypto.encryptResourceKey((0,n.M)(s),t.resourceKey):void 0,c=r?(0,o.s)(r):void 0,d=(0,a.u)(e);return{proposeSignature:await this.sharingCrypto.createProposeSignature(t.resourceKey,d),acceptSignature:i?await this.sharingCrypto.createAcceptSignature(i,t.uuid,t.resourceKey):void 0,resourceKey:c,proposeSignatureUsingAlias:!s}}constructor(e){this.sharingCrypto=e}}d=(0,i.gn)([(0,r.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===c.M?Object:c.M])],d)},82181:(e,t,s)=>{s.d(t,{o:()=>i});const i=e=>{if(!e)return!1;const t=e;return!!t.pendingItemGroups&&!!t.pendingUserGroups}},2807:(e,t,s)=>{s.d(t,{F:()=>u});var i=s(92336),r=s(60399),n=s(87065),o=s(92587),a=s(33312),c=s(78346),d=s(44449),l=s(60141);class u{async getSharedItemContentLegacy(e){const t=this.inviteGetter.get().pipe((0,a.Qn)((t=>{const s=t.pendingItemGroups.find((t=>t.itemGroupId===e));if(!s)throw new Error("Pending item group not found when accepting/refusing invite");if(s.items.length<1)throw new Error("Missing item content for pending item group when accepting/refusing invite");return s.items[0]}))),s=await(0,r.z)(t);if((0,c.hx)(s))throw new Error("Failed to retrieve item content for pending item group when accepting/refusing invite");return s.data}async getSharedItemContent(e){const t=this.store.state$.pipe((0,n.U)((t=>{const s=t.find((t=>t.sharedItemId===e));if(!s)throw new Error("Pending item group not found when accepting/refusing invite");return s})));return(0,r.z)(t)}constructor(e,t){this.inviteGetter=e,this.store=t}}u=(0,i.gn)([(0,o.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===d.V?Object:d.V,void 0===l.f?Object:l.f])],u)},3966:(e,t,s)=>{s.d(t,{p:()=>Fe});var i=s(92336),r=s(86006),n=s(95940),o=s(41511),a=s(40416),c=s(7165),d=s(63144),l=s(56618),u=s(62149),p=s(11797);const h=c.z.object({pendingCollections:c.z.array(p.MX)}),g=e=>h.safeParse(e).success;class m extends((0,d.Q)({capacity:l.Y._010KB,persist:!1,scope:u.F.User,storeName:"pending-shared-collections-state",storeTypeGuard:g,initialValue:{pendingCollections:[]}})){}var v=s(41393),y=s(60141),S=s(14474),w=s(66717),E=s(2807),I=s(1868),A=s(60399),f=s(82874),b=s(53344),C=s(78346),O=s(27122),R=s(72298),T=s(89720),_=s(90936),D=s(35635),F=s(80629);class P{async execute({body:e}){const{userGroupId:t}=e,s=await this.userGroupsRepository.getUserGroupForId(t),i=await this.currentUserGetter.getCurrentUserWithKeys(),r=s.groupKey;if(!r)throw new Error("Unable to get user group key");const n=await this.sharingCrypto.createUserGroupAcceptSignature(i,r,t);return await(0,A.z)(this.serverApiClient.v1.sharingUserdevice.acceptUserGroup({acceptSignature:n,groupId:t,provisioningMethod:R.ET.USER,revision:s.revision})),await this.sharingSync.scheduleSync(),(0,C.Vp)(void 0)}constructor(e,t,s,i,r){this.serverApiClient=e,this.sharingCrypto=t,this.currentUserGetter=s,this.sharingSync=i,this.userGroupsRepository=r}}P=(0,i.gn)([(0,f.W)(O.Q),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===_.Z?Object:_.Z,void 0===D.a?Object:D.a,void 0===F.D?Object:F.D,void 0===T.x?Object:T.x])],P);var U=s(43651),N=s(6489),L=s(64549),x=s(5482),G=s(7533);class k{async execute(e){const{body:{collectionId:t}}=e,{userFeatureFlip:s}=this.featureFlips.queries,i=await(0,A.z)(s({featureFlip:N.d.SharingSyncGrapheneMigrationDev})),r=!!(0,C.d6)(i)&&!!(0,C.db)(i),n=await this.currentUserGetter.getCurrentUserWithKeys(),{collectionKey:o,revision:a}=r?await this.getCollectionKeyAndRevisionNew(t,n):await this.getCollectionKeyAndRevisionLegacy(t),c=await this.sharingCryptoElements.createAcceptSignature(n.privateKey,t,o),d=await(0,A.z)(this.serverApiClient.v1.sharingUserdevice.acceptCollection({collectionUUID:t,revision:a,acceptSignature:c}));return(0,C.hx)(d)?(0,C.Rn)(new L.nu):(await this.sharingSync.scheduleSync(),(0,C.Vp)(void 0))}async getCollectionKeyAndRevisionNew(e,t){const s=await this.collectionsRepository.getCollectionsById([e]);if(!s.length)throw new Error("Pending Collection not found new path");const i=await this.sharingCryptoUtility.decryptSharedCollectionKey(s[0],t);if(!i)throw new Error("Unable to decrypt Collection Key for pending collection new path");return{collectionKey:i,revision:s[0].revision}}async getCollectionKeyAndRevisionLegacy(e){const t=(await this.oldStore.getState()).pendingCollections.find((({uuid:t})=>t===e));if(!t)throw new Error("Pending Collection not found legacy path");const s=await this.sharingCryptoUtility.decryptCollectionKey(t,R.qb.Pending);if(!s)throw new Error("Unable to decrypt Collection Key for pending collection legacy path");return{collectionKey:s,revision:t.revision}}constructor(e,t,s,i,r,n,o,a){this.serverApiClient=e,this.sharingCryptoElements=t,this.sharingCryptoUtility=s,this.oldStore=i,this.collectionsRepository=r,this.sharingSync=n,this.currentUserGetter=o,this.featureFlips=a}}k=(0,i.gn)([(0,f.W)(L.cD),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===G.M?Object:G.M,void 0===_.Z?Object:_.Z,void 0===m?Object:m,void 0===x.U?Object:x.U,void 0===F.D?Object:F.D,void 0===D.a?Object:D.a,void 0===U.P?Object:U.P])],k);var K=s(83405),M=s(20634),j=s(50520),V=s(93986);class W{async execute(e){const{userFeatureFlip:t}=this.featureFlips.queries,s=await(0,A.z)(t({featureFlip:N.d.SharingSyncGrapheneMigrationDev}));return!!(0,C.d6)(s)&&!!(0,C.db)(s)?this.executeWithNewState(e):this.executeWithCarbonState(e)}async executeWithCarbonState({body:e}){const{itemGroupId:t}=e,s=await(0,A.z)(this.itemGroupsGetter.getForItemGroupId(t));if((0,C.hx)(s))throw new Error("Error fetching item groups when trying to accept shared item");const i=(0,C.db)(s);if(!i)throw new Error("Item group not found");const r=await this.currentUserGetter.getCurrentUserWithKeys(),n=i.users?.find((e=>e.userId===r.login));if(!n?.groupKey)throw new Error("Item group key not found");const o=await this.sharingCryptoUtility.decryptResourceKeyViaUserMember({encryptedResourceKey:n.groupKey},r);if(!o)throw new Error("Failed to decrypt item group key");const a=await this.sharingCryptoElements.createAcceptSignature(r.privateKey,t,o),c=await this.sharedItemContent.getSharedItemContentLegacy(t);return await(0,A.z)(this.serverApiClient.v1.sharingUserdevice.acceptItemGroup({acceptSignature:a,groupId:t,revision:i.revision,itemsForEmailing:[(0,M.p)(c)]})),await this.sharingSync.scheduleSync(),(0,C.Vp)(void 0)}async executeWithNewState({body:e}){const{itemGroupId:t}=e,s=(await this.sharedItemsRepository.getSharedItemsIndex())[t];if(!s)throw new Error("Item group not found");const i=await this.currentUserGetter.getCurrentUserWithKeys(),r=await this.sharingCryptoUtility.createSharedItemAcceptSignature(s,i),n=await this.sharedItemContent.getSharedItemContent(t);return await(0,A.z)(this.serverApiClient.v1.sharingUserdevice.acceptItemGroup({acceptSignature:r,groupId:t,revision:s.revision,itemsForEmailing:[(0,M.Q)(n)]})),await this.sharingSync.scheduleSync(),(0,C.Vp)(void 0)}constructor(e,t,s,i,r,n,o,a,c){this.serverApiClient=e,this.itemGroupsGetter=t,this.sharedItemsRepository=s,this.sharingCryptoUtility=i,this.currentUserGetter=r,this.sharingCryptoElements=n,this.sharingSync=o,this.sharedItemContent=a,this.featureFlips=c}}W=(0,i.gn)([(0,f.W)(K.C),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===V.E?Object:V.E,void 0===j.z?Object:j.z,void 0===_.Z?Object:_.Z,void 0===D.a?Object:D.a,void 0===G.M?Object:G.M,void 0===F.D?Object:F.D,void 0===E.F?Object:E.F,void 0===U.P?Object:U.P])],W);var B=s(37210);class z{async execute(e){const{body:{collectionId:t}}=e,{userFeatureFlip:s}=this.featureFlips.queries,i=await(0,A.z)(s({featureFlip:N.d.SharingSyncGrapheneMigrationDev})),r=!!(0,C.d6)(i)&&!!(0,C.db)(i)?await this.getCollectionRevision(t):await this.getCollectionRevisionLegacy(t),n=await(0,A.z)(this.serverApiClient.v1.sharingUserdevice.refuseCollection({collectionUUID:t,revision:r}));return(0,C.hx)(n)?(0,C.Rn)(new B.R$):(await this.sharingSync.scheduleSync(),(0,C.Vp)(void 0))}async getCollectionRevision(e){const t=await this.collectionsRepository.getCollectionsById([e]);if(!t.length)throw new Error("Pending Collection not found new path");return t[0].revision}async getCollectionRevisionLegacy(e){const t=(await this.oldpendingCollectionsStore.getState()).pendingCollections.find((({uuid:t})=>t===e));if(!t)throw new Error("Pending Collection not found legacy path");return t.revision}constructor(e,t,s,i,r){this.serverApiClient=e,this.oldpendingCollectionsStore=t,this.collectionsRepository=s,this.sharingSync=i,this.featureFlips=r}}z=(0,i.gn)([(0,f.W)(B.UC),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===m?Object:m,void 0===x.U?Object:x.U,void 0===F.D?Object:F.D,void 0===U.P?Object:U.P])],z);var q=s(51571);class H{async execute(e){return this.refuseSharedItemService.execute(e.body.itemGroupId)}constructor(e){this.refuseSharedItemService=e}}H=(0,i.gn)([(0,f.W)(q.gm),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I.C?Object:I.C])],H);var Y=s(82567),Q=s(11050),$=s(33312);class X{async execute(e){const{body:{userGroupId:t}}=e,s=await this.userGroupsRepository.getUserGroupForId(t),{groupId:i,revision:r}=s;return await(0,A.z)(this.serverApiClient.v1.sharingUserdevice.refuseUserGroup({groupId:i,revision:r,provisioningMethod:R.ET.USER}).pipe((0,$.DZ)((e=>{if("BusinessError"===e.tag)return(0,Q.cz)(e.code);throw new Error(e.message)})),(0,$.lk)((e=>{if(void 0===e.data.userGroupErrors||0===e.data.userGroupErrors.length)return(0,C.Vp)(void 0);if(e.data.userGroupErrors.length>0)throw new Error(`Error for user group ${e.data.userGroupErrors[0].groupId}: ${e.data.userGroupErrors[0].message}`);throw new Error("Unknown server error")})),(0,Y.b)((async e=>{(0,C.d6)(e)&&await this.sharingSync.scheduleSync()}))))}constructor(e,t,s){this.serverApiClient=e,this.userGroupsRepository=t,this.sharingSync=s}}X=(0,i.gn)([(0,f.W)(Q.Fo),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===T.x?Object:T.x,void 0===F.D?Object:F.D])],X);var Z=s(16712),J=s(13252),ee=s(97675);class te{execute({body:e}){const t=e,s=this.getCurrentUserLogin(),i=t.filter((e=>(e.users||[]).some((e=>e.login===s&&e.status===J.qb.Pending))));return this.store.set({pendingCollections:i}),Promise.resolve((0,C.Vp)(void 0))}getCurrentUserLogin(){return this.context.get(Z.l.UserName)}constructor(e,t){this.store=e,this.context=t}}te=(0,i.gn)([(0,f.W)(ee.r),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===m?Object:m,void 0===Z.f?Object:Z.f])],te);var se=s(16433),ie=s(43978),re=s(85390),ne=s(87065),oe=s(46449),ae=s(57885),ce=s(44449),de=s(96500),le=s(69956);const ue=e=>void 0!==e.referrer&&void 0!==e.permission,pe=(e,t)=>e.map((e=>{const s=(e.users||[]).find((e=>e.login===t&&e.status===J.qb.Pending));return{uuid:e.uuid,name:e.name,referrer:s?.referrer,permission:s?.permission}})).filter(ue),he=e=>"admin"===e.permission?J.y3.Admin:J.y3.Limited,ge=e=>{const t={vaultItemId:e.items[0].Id,title:e.items[0].Title,spaceId:e.items[0].SpaceId,referrer:e.referrer,sharedItemId:e.itemGroupId,permission:he(e),revision:0},s=e.items[0];return(0,de.G)(s)?{...t,itemType:J.y2.Credential,url:s.Url,linkedDomains:s.LinkedServices?.associated_domains.map((e=>e.domain)),email:s.Email,login:s.Login,secondaryLogin:s.SecondaryLogin}:(0,le.g)(s)?{...t,itemType:J.y2.SecureNote,color:s.Type,secured:s.Secured}:{...t,itemType:J.y2.Secret,secured:s.Secured}},me=e=>({id:e.groupId,name:e.name,referrer:e.referrer,permission:he(e)}),ve=e=>({id:e.uuid,name:e.name,referrer:e.referrer,permission:he(e)});class ye{execute(){const{userFeatureFlip:e}=this.featureFlips.queries;return e({featureFlip:"sharingVault_web_sharingSyncGrapheneMigration_dev"}).pipe((0,se.q)(1),(0,ie.w)((e=>!!(0,C.d6)(e)&&!!(0,C.db)(e)?this.executeWithNewState$():this.executeWithCarbonState$())))}executeWithNewState$(){return(0,re.a)([this.pendingUserGroupsStore.state$,this.pendingCollectionsStore.state$,this.pendingItemsStore.state$]).pipe((0,ne.U)((([e,t,s])=>(0,C.Vp)({pendingSharedItems:s,pendingUserGroups:e,pendingCollections:t}))))}executeWithCarbonState$(){const e=this.inviteGetter.get(),t=this.store.state$,s=this.getCurrentUserLogin();return(0,re.a)([e,t]).pipe((0,ne.U)((([e,t])=>{const i=(0,C.d6)(e)?e.data:{pendingItemGroups:[],pendingUserGroups:[]},r=s?pe(t.pendingCollections,s):[];return(0,C.Vp)({pendingSharedItems:i.pendingItemGroups.map(ge),pendingUserGroups:i.pendingUserGroups.map(me),pendingCollections:r.map(ve)})})))}getCurrentUserLogin(){return this.context.get(Z.l.UserName)}constructor(e,t,s,i,r,n,o){this.inviteGetter=e,this.store=t,this.context=s,this.featureFlips=i,this.pendingUserGroupsStore=r,this.pendingItemsStore=n,this.pendingCollectionsStore=o}}ye=(0,i.gn)([(0,oe.e)(ae.q),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ce.V?Object:ce.V,void 0===m?Object:m,void 0===Z.f?Object:Z.f,void 0===U.P?Object:U.P,void 0===S.t?Object:S.t,void 0===y.f?Object:y.f,void 0===v.K?Object:v.K])],ye);var Se=s(5650);class we{execute(){const e=this.getCurrentUserLogin();if(void 0===e)throw new Error("Unable to get pending collections, user login not found");return this.store.state$.pipe((0,ne.U)((t=>{const s=pe(t.pendingCollections,e);return(0,C.Vp)(s)})))}getCurrentUserLogin(){return this.context.get(Z.l.UserName)}constructor(e,t){this.store=e,this.context=t}}we=(0,i.gn)([(0,oe.e)(Se.D),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===m?Object:m,void 0===Z.f?Object:Z.f])],we);var Ee=s(6136),Ie=s(71763),Ae=s(14122),fe=s(82181);class be{execute(){const{userFeatureFlip:e}=this.featureFlips.queries;return e({featureFlip:N.d.SharingSyncGrapheneMigrationDev}).pipe((0,se.q)(1),(0,ie.w)((e=>!!(0,C.d6)(e)&&!!(0,C.db)(e)?this.executeWithNewState$():this.executeWithCarbonState$())))}executeWithNewState$(){const e=this.pendingItemsStore.state$,t=this.pendingUserGroupsStore.state$,s=this.pendingCollectionInvitesStore.state$;return(0,re.a)([s,e,t]).pipe((0,ne.U)((([e,t,s])=>{const i=e.length>0,r=t.length>0,n=s.length>0;return i||r||n})),(0,Ee.x)(),(0,ne.U)(C.Vp))}executeWithCarbonState$(){const{queries:{carbonState:e}}=this.carbonLegacyClient,t=e({path:"userSession.sharingSync"}).pipe((0,$.Qn)((e=>{if(!(0,fe.o)(e))throw new Error("Bad SharingSync format");return e}))),s=this.pendingCollectionsStore.state$;return(0,re.a)([t,s]).pipe((0,ne.U)((([e,t])=>{const s=(0,C.d6)(e)?e.data:{pendingItemGroups:[],pendingUserGroups:[]},i=s.pendingItemGroups.length>0,r=s.pendingUserGroups.length>0,n=t.pendingCollections.length>0;return i||r||n})),(0,Ee.x)(),(0,ne.U)(C.Vp))}constructor(e,t,s,i,r,n){this.carbonLegacyClient=e,this.pendingCollectionsStore=t,this.pendingCollectionInvitesStore=s,this.pendingItemsStore=i,this.pendingUserGroupsStore=r,this.featureFlips=n}}be=(0,i.gn)([(0,oe.e)(Ie._),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Ae._?Object:Ae._,void 0===m?Object:m,void 0===v.K?Object:v.K,void 0===y.f?Object:y.f,void 0===S.t?Object:S.t,void 0===U.P?Object:U.P])],be);var Ce=s(38357),Oe=s(75028),Re=s(13186),Te=s(14139),_e=s(85378),De=s(46675);class Fe{}Fe=(0,i.gn)([(0,r.Y)({api:n.t,stores:[m,v.K,y.f,S.t],handlers:{commands:{acceptUserGroupInvite:P,acceptCollectionInvite:k,acceptSharedItemInvite:W,refuseCollectionInvite:z,refuseItemGroupInvite:H,refuseUserGroupInvite:X,updatePendingCollections:te},events:{},queries:{getInvites:ye,getPendingCollections:we,hasInvites:be}},imports:[o.n,a.D,Oe.k,Re.I,Te.y,_e.u,Ce.F,De.a],providers:[w.M,E.F,I.C],exports:[w.M,I.C],requiredFeatureFlips:["audit_logs_sharing","send_activity_log"]})],Fe)},66717:(e,t,s)=>{s.d(t,{M:()=>c});var i=s(92336),r=s(92587),n=s(41393),o=s(60141),a=s(14474);class c{setCollectionInvites(e){this.collectionsStore.set(e)}setUserGroupInvites(e){this.userGroupsStore.set(e)}setSharedItemInvites(e){this.itemsStore.set(e)}getUserGroupInvites(){return this.userGroupsStore.getState()}getSharedItemsInvites(){return this.itemsStore.getState()}getCollectionsInvites(){return this.collectionsStore.getState()}constructor(e,t,s){this.collectionsStore=e,this.userGroupsStore=t,this.itemsStore=s}}c=(0,i.gn)([(0,r.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===n.K?Object:n.K,void 0===a.t?Object:a.t,void 0===o.f?Object:o.f])],c)},1868:(e,t,s)=>{s.d(t,{C:()=>b});var i=s(92336),r=s(60399),n=s(82567),o=s(14122),a=s(92587),c=s(43651),d=s(53344),l=s(78346),u=s(33312),p=s(6489),h=s(51571),g=s(2807),m=s(50520),v=s(20634);const y=e=>(e.spaces??[]).filter((e=>"accepted"===e.status));var S=s(96500),w=s(13134),E=s(13252),I=s(98798);var A=s(93986),f=s(80629);class b{async execute(e){const{userFeatureFlip:t}=this.featureFlips.queries,s=await(0,r.z)(t({featureFlip:p.d.SharingSyncGrapheneMigrationDev}));return!!(0,l.d6)(s)&&!!(0,l.db)(s)?this.executeWithGrapheneState(e):this.executeWithCarbonState(e)}async executeWithGrapheneState(e){const t=(await this.sharedItemsRepository.getSharedItemsIndex())[e];if(!t)throw new Error("Shared item not found while refusing invite");const s=await this.sharedItemContent.getSharedItemContent(e),i=await this.prepareAuditLogDetails(s);return await(0,r.z)(this.serverApiClient.v1.sharingUserdevice.refuseItemGroup({groupId:e,revision:t.revision,itemsForEmailing:[(0,v.Q)(s)],auditLogDetails:i})),await this.sharingSync.scheduleSync(),(0,l.Vp)(void 0)}async executeWithCarbonState(e){const t=await(0,r.z)(this.itemGroupsGetter.getForItemGroupId(e));if((0,l.hx)(t))throw new Error("Failed to retrieve item group for pending item group with");const s=(0,l.db)(t);if(void 0===s)return(0,l.Rn)(new h.fL);const i=await this.sharedItemContent.getSharedItemContentLegacy(e),o=await this.prepareAuditLogDetailsLegacy(i);return(0,r.z)(this.serverApiClient.v1.sharingUserdevice.refuseItemGroup({groupId:s.groupId,revision:s.revision,itemsForEmailing:[(0,v.p)(i)],auditLogDetails:o}).pipe((0,u.DZ)((e=>{if("BusinessError"===e.tag)return(0,h.fr)(e.code);throw new Error(e.message)})),(0,u.lk)((e=>{if(void 0===e.data.itemGroupErrors||0===e.data.itemGroupErrors.length)return(0,l.Vp)(void 0);if(e.data.itemGroupErrors.length>0)throw new Error("Error when refusing an item group invite");throw new Error("Unknown server error")})),(0,n.b)((async e=>{(0,l.d6)(e)&&await this.sharingSync.scheduleSync()}))))}async prepareAuditLogDetails(e){const{queries:{carbonState:t}}=this.carbonLegacyClient,s=t({path:"userSession.localSettings.premiumStatus"}).pipe((0,u.Qn)((e=>{const t=y(e);return t.length?t[0]:void 0}))),i=await(0,r.z)(s);if((0,l.hx)(i))return;const n=(0,l.db)(i)?.info.collectSensitiveDataAuditLogsEnabled;return n?((e,t)=>{const s=!!t.spaceId&&e;let i;if(t.itemType===E.y2.Credential){const e={...t,itemType:E.y2.Credential};i=new w.Y(e.url).getRootDomain()||""}const r=(0,I.HU)(t.itemType);return s?{captureLog:s,domain:i,type:r}:void 0})(n,e):void 0}async prepareAuditLogDetailsLegacy(e){const{queries:{carbonState:t}}=this.carbonLegacyClient,s=t({path:"userSession.localSettings.premiumStatus"}).pipe((0,u.Qn)((e=>y(e)[0]))),{userFeatureFlips:i}=this.featureFlips.queries,n=await(0,r.z)(i().pipe((0,u.Qn)((e=>e.audit_logs_sharing&&e.send_activity_log))));if(!(!!(0,l.d6)(n)&&(n.data??!1)))return;const o=await(0,r.z)(s);if((0,l.hx)(o))return;const a=(0,l.db)(o)?.info.collectSensitiveDataAuditLogsEnabled;return a?((e,t)=>{const s=!!t?.SpaceId&&e,i=t&&(0,S.G)(t),r=i?new w.Y(t.Url).getRootDomain():"",n=i?r||"":void 0,o=(0,I.l7)(t);return s?{captureLog:s,domain:n,type:o}:void 0})(a,e):void 0}constructor(e,t,s,i,r,n,o){this.carbonLegacyClient=e,this.serverApiClient=t,this.sharedItemContent=s,this.sharedItemsRepository=i,this.itemGroupsGetter=r,this.featureFlips=n,this.sharingSync=o}}b=(0,i.gn)([(0,a.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o._?Object:o._,void 0===d.l?Object:d.l,void 0===g.F?Object:g.F,void 0===m.z?Object:m.z,void 0===A.E?Object:A.E,void 0===c.P?Object:c.P,void 0===f.D?Object:f.D])],b)},41393:(e,t,s)=>{s.d(t,{K:()=>u});var i=s(7165),r=s(18091),n=s(63144),o=s(56618),a=s(62149),c=s(60018);const d=i.z.array(r.ju),l=e=>d.safeParse(e).success;class u extends((0,n.Q)({persist:!0,storage:{initialValue:[],typeGuard:l,schemaVersion:1},scope:a.F.User,storeName:"pending-collection-invites-state",storeTypeGuard:l,codec:c.E,isCache:!0,capacity:o.Y.Unlimited})){}},60141:(e,t,s)=>{s.d(t,{f:()=>u});var i=s(7165),r=s(18091),n=s(63144),o=s(56618),a=s(62149),c=s(60018);const d=i.z.array(r.jd),l=e=>d.safeParse(e).success;class u extends((0,n.Q)({persist:!0,storage:{initialValue:[],typeGuard:l,schemaVersion:1},scope:a.F.User,storeName:"pending-shared-items-invites-state",storeTypeGuard:l,codec:c.E,isCache:!0,capacity:o.Y.Unlimited})){}},14474:(e,t,s)=>{s.d(t,{t:()=>u});var i=s(7165),r=s(18091),n=s(63144),o=s(56618),a=s(62149),c=s(60018);const d=i.z.array(r.ju),l=e=>d.safeParse(e).success;class u extends((0,n.Q)({persist:!0,storage:{initialValue:[],typeGuard:l,schemaVersion:1},scope:a.F.User,storeName:"pending-user-group-invites-state",storeTypeGuard:l,codec:c.E,isCache:!0,capacity:o.Y.Unlimited})){}},20634:(e,t,s)=>{s.d(t,{Q:()=>n,p:()=>r});var i=s(98798);const r=e=>{const t=(0,i.l7)(e);return{type:(0,i.B5)(t),name:e.Title}},n=e=>({type:e.itemType,name:e.title})},11047:(e,t,s)=>{s.d(t,{K4:()=>p,t9:()=>h,$h:()=>l});var i=s(7303),r=s(13252),n=s(92936);const o=(e,t)=>e?.filter((e=>t.some((t=>t.uuid===e.uuid))&&e.status===r.qb.Accepted&&e.itemGroupKey)),a=(...e)=>e.find((e=>e?.link))??e[0],c=({permission:e,status:t})=>e===r.y3.Admin&&t===r.qb.Accepted,d=(e,t,s,i)=>{const d=((e,t)=>{const s=e.users?.filter((e=>e.userId===t&&e.status===r.qb.Accepted&&e.groupKey)),i=e.users?.some((({userId:e,permission:s,rsaStatus:i,status:n})=>e!==t&&s===r.y3.Admin&&"sharingKeys"===i&&n===r.qb.Accepted))??!1;if(s?.length){const e=s[0];if(e.groupKey){const{permission:t,acceptSignature:o,proposeSignature:a}=e;return{link:{permission:t,acceptSignature:o,proposeSignature:a,encryptedResourceKey:e.groupKey,accessType:r.Uv.User},permission:(0,n.u)(s),otherAdminsFound:i}}}return{permission:r.y3.Limited,otherAdminsFound:i}})(e,t),l=Boolean(d?.otherAdminsFound)||Boolean(e.groups?.some(c))||Boolean(e.collections?.some(c));if(null!==d&&d.permission===r.y3.Admin)return{...d,otherAdminsFound:l};const u=s.filter((e=>e.users.some((e=>e.userId===t&&e.status===r.qb.Accepted&&!e.proposeSignatureUsingAlias&&e.groupKey)))),p=((e,t,s)=>{const i=e.groups?.filter((e=>s.some((t=>t.groupId===e.groupId))&&e.status===r.qb.Accepted&&e.groupKey));if(i?.length){const e=i[0],o=(0,n.u)(i);if(e.groupKey){const{permission:i,acceptSignature:n,proposeSignature:a}=e,c=s.find((t=>t.groupId===e.groupId)),d=c?.users.find((e=>e.userId===t));if(d?.groupKey)return{link:{permission:i,acceptSignature:n,proposeSignature:a,encryptedResourceKey:e.groupKey,groupEncryptedKey:d.groupKey,groupPrivateKey:c?.privateKey,groupPublicKey:c?.publicKey,accessType:r.Uv.UserGroup},permission:o}}}return null})(e,t,u);if(null!==p&&p.permission===r.y3.Admin)return{...a(d,p),permission:r.y3.Admin,otherAdminsFound:l};const h=((e,t,s)=>{const i=s.filter((e=>e.users?.some((e=>e.login===t&&e.status===r.qb.Accepted&&!e.proposeSignatureUsingAlias&&e.collectionKey)))),a=o(e.collections,i);if(a?.length){const e=a[0],s=(0,n.u)(a);if(e.itemGroupKey){const{permission:n,acceptSignature:o,proposeSignature:a}=e,c=i.find((t=>t.uuid===e.uuid)),d=c?.users?.find((e=>e.login===t));if(d&&c&&c.privateKey&&d.collectionKey)return{link:{permission:n,acceptSignature:o,proposeSignature:a,encryptedResourceKey:e.itemGroupKey,collectionEncryptedKey:d.collectionKey,collectionPrivateKey:c.privateKey,collectionPublicKey:c.publicKey,accessType:r.Uv.CollectionUser},permission:s}}}return null})(e,t,i);if(null!==h&&h.permission===r.y3.Admin)return{...a(d,p,h),permission:r.y3.Admin,otherAdminsFound:l};const g=((e,t,s,i)=>{const a=i.filter((e=>e.userGroups?.some((e=>s.some((t=>t.groupId===e.uuid))&&e.status===r.qb.Accepted&&e.collectionKey)))),c=o(e.collections,a);if(c?.length){const e=c[0],i=(0,n.u)(c);if(e.itemGroupKey){const{permission:n,acceptSignature:o,proposeSignature:c}=e,d=a.find((t=>t.uuid===e.uuid)),l=d?.userGroups?.find((e=>s.some((t=>t.groupId===e.uuid))));if(!l)return null;const u=s.find((({groupId:e})=>e===l.uuid)),p=u?.users.find((({userId:e})=>e===t));if(l.collectionKey&&d&&p?.groupKey)return{link:{permission:n,acceptSignature:o,proposeSignature:c,encryptedResourceKey:e.itemGroupKey,collectionEncryptedKey:l.collectionKey,collectionPrivateKey:d.privateKey,collectionPublicKey:d.publicKey,groupPrivateKey:u?.privateKey,groupPublicKey:u?.publicKey,groupEncryptedKey:p.groupKey,accessType:r.Uv.CollectionUserGroup},permission:i}}}return null})(e,t,u,i);return{...a(d,p,h,g),permission:g?.permission??r.y3.Limited,otherAdminsFound:l}},l=(e,t,s,i)=>{const{link:n,permission:o,otherAdminsFound:a}=d(e,i,t,s);if(!n)throw new Error("No access to a requested shared item");const{items:c,revision:l,groupId:u,groups:p,collections:h,users:g}=e,m=c?.[0];if(!m)throw new Error("No items associated with item group");const{itemId:v,itemKey:y}=m;return{permission:o,accessLink:n,itemId:v,itemKey:y,sharedItemId:u,revision:l,isLastAdmin:o===r.y3.Admin&&!a,recipientIds:{userIds:g?.map((({userId:e})=>e))??null,collectionIds:h?.map((({uuid:e})=>e))??null,userGroupIds:p?.map((({groupId:e})=>e))??null}}},u=({status:e})=>e&&![r.qb.Refused,r.qb.Revoked].includes(e),p=e=>({users:e.users?.reduce(((e,t)=>(u(t)&&e.push({id:t.userId,name:t.alias,permission:t.permission,status:t.status}),e)),(0,i.Ay)([]))??[],userGroups:e.groups?.reduce(((e,t)=>(u(t)&&e.push({id:t.groupId,name:t.name,permission:t.permission,status:t.status}),e)),(0,i.Ay)([]))??[],collections:e.collections?.reduce(((e,t)=>(u(t)&&e.push({id:t.uuid,name:t.name,permission:t.permission,status:t.status}),e)),(0,i.Ay)([]))??[]}),h=(e,t)=>({permission:e.permission,status:e.status,recipientId:e.id,recipientName:e.name,recipientType:t})},50520:(e,t,s)=>{s.d(t,{z:()=>i});class i{}},38357:(e,t,s)=>{s.d(t,{F:()=>Ft});var i=s(92336),r=s(86006),n=s(41511),o=s(61582),a=s(50520),c=function(e){return e.SHARED_ITEM_IS_NOT_FOUND="ITEM_GROUP_IS_NOT_FOUND",e.INSUFFICIENT_PERMISSION_PRIVILEGES="INSUFFICIENT_PERMISSION_PRIVILEGES",e.INVALID_REVISION="INVALID_ITEM_GROUP_REVISION",e.NOT_A_MEMBER_CANNOT_SHARE_WITH_USER_GROUP="NOT_A_MEMBER_CANNOT_SHARE_WITH_USER_GROUP",e.SHARING_DISABLED_BY_TEAM="SHARING_DISABLED_BY_TEAM",e.USER_IS_NOT_MEMBER_OF_TEAM="USER_IS_NOT_MEMBER_OF_TEAM",e.SERVER_ERROR="SERVER_ERROR",e}({});class d{}var l=s(92587),u=s(53344),p=s(60399);const h=e=>e.map((({id:e,resourceKey:t,proposeSignature:s,proposeSignatureUsingAlias:i,acceptSignature:r,alias:n,permission:o})=>({...t?{}:{proposeSignatureUsingAlias:!0},userId:e,groupKey:t,proposeSignature:s,proposeSignatureUsingAlias:i,acceptSignature:r,alias:n,permission:o}))),g=e=>e.map((({id:e,resourceKey:t,proposeSignature:s,acceptSignature:i,permission:r})=>({groupId:e,groupKey:t,proposeSignature:s,acceptSignature:i,permission:r}))),m=(e,t)=>({type:t,name:e||`Untitled ${t}`});var v=s(78346),y=s(7303),S=s(54250),w=s(11819);class E{async inviteMultipleItemGroupsMembers(e){const t=await(0,S.x)(e,(async e=>{const t=e.map((({sharedItem:e,users:t,userGroups:s})=>{const{sharedItemId:i,revision:r,auditLogData:n,itemType:o,title:a}=e;return{groupId:i,revision:r,users:t?.length?h(t):void 0,groups:s?.length?g(s):void 0,auditLogDetails:n?(0,w.B)(n):void 0,itemsForEmailing:[m(a,o)]}})),s=await(0,p.z)(this.serverApiClient.v1.sharingUserdevice.inviteMultipleItemGroupMembers({itemgroups:t}));if((0,v.hx)(s))throw new Error("Failed to add members to item group");return(0,v.db)(s)})),s=t.reduce(((e,t)=>({itemGroups:e.itemGroups.concat(t.data.itemGroups??[]),itemGroupErrors:e.itemGroupErrors.concat(t.data.itemGroupErrors??[])})),(0,y.Ay)({itemGroups:[],itemGroupErrors:[]})),i=s.itemGroupErrors.map((({groupId:e,message:t})=>({sharedItemId:e,error:this.mapServerError(t),revision:s.itemGroups.find((t=>t.groupId===e))?.revision})));return(0,v.Vp)({errors:i})}mapServerError(e){switch(e){case c.USER_IS_NOT_MEMBER_OF_TEAM:return c.USER_IS_NOT_MEMBER_OF_TEAM;case c.INSUFFICIENT_PERMISSION_PRIVILEGES:return c.INSUFFICIENT_PERMISSION_PRIVILEGES;case c.NOT_A_MEMBER_CANNOT_SHARE_WITH_USER_GROUP:return c.NOT_A_MEMBER_CANNOT_SHARE_WITH_USER_GROUP;case c.SHARED_ITEM_IS_NOT_FOUND:return c.SHARED_ITEM_IS_NOT_FOUND;case c.INVALID_REVISION:return c.INVALID_REVISION;case c.SHARING_DISABLED_BY_TEAM:return c.SHARING_DISABLED_BY_TEAM;default:return c.SERVER_ERROR}}constructor(e){this.serverApiClient=e}}E=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===u.l?Object:u.l])],E);var I=s(30309),A=s(13134),f=s(32725),b=s(13252);const C=e=>{switch(e){case c.SHARED_ITEM_IS_NOT_FOUND:return f.z.ITEM_DOESNT_EXIST;case c.INVALID_REVISION:return f.z.INVALID_REVISION;default:return f.z.SHARING_FAILED}},O=(e,t,s)=>{const i=s.find((e=>e.Id===t));if(!i)throw new Error("Vault item not found when trying to share");const{Id:r,kwType:n,Title:o}=i,a={id:r,title:o,error:C(e)};if(n===I.dJ.KWAuthentifiant){const e=i,t=new A.Y(e.Url).getRootDomain();return{...a,type:b.y2.Credential,domain:t,text:e.Email||e.Login}}return n===I.dJ.KWSecureNote?{...a,type:b.y2.SecureNote,color:i.Type}:{...a,type:b.y2.Secret}},R=(e,t)=>{const s=t.find((t=>t.Id===e.itemId));if(!s)throw new Error("Vault item not found when trying to share");const{kwType:i}=s,r=i===I.dJ.KWAuthentifiant?b.y2.Credential:i===I.dJ.KWSecureNote?b.y2.SecureNote:b.y2.Secret,n=i===I.dJ.KWAuthentifiant?new A.Y(s.Url).getRootDomain():void 0,o=r===b.y2.Credential?{type:r,domain:n}:void 0;return{itemType:r,sharedItemId:e.sharedItemId,revision:e.revision,title:s.Title,auditLogData:o}};var T=s(90936),_=s(85337),D=s(6554);class F{async inviteRecipients(e,t,s,i,r){const n=(await this.createItemsInvites(s,e.map((e=>({login:e,permission:r}))),t.map((e=>({groupId:e,permission:r}))))).map((({sharedItem:e,users:t,userGroups:s})=>({sharedItem:R(e,i),users:t,userGroups:s}))),o=await this.sharingItemsGateway.inviteMultipleItemGroupsMembers(n);if((0,v.hx)(o))throw new Error("Server error when sharing items");return(0,v.db)(o).errors?.map((({error:e,sharedItemId:t})=>{const r=s.find((e=>e.sharedItemId===t));if(!r)throw new Error("Error when creating invite params for sharing an item");return O(e,r.itemId,i)}))??[]}async createItemsInvites(e,t,s){const i=await Promise.all(e.map((async e=>{const t=await this.sharingCrypto.decryptItemGroupKey(e);if(null===t)throw new Error("Unable to decrypt item group key");return{resourceKey:t,uuid:e.sharedItemId}}))),r=await this.sharingUsers.createSignedUserInvitesPerResource(t,i),n=await this.sharingUserGroups.createSignedUserGroupInvitesPerResource(s,i);return e.map((e=>({sharedItem:e,users:r[e.sharedItemId],userGroups:n[e.sharedItemId]})))}constructor(e,t,s,i){this.sharingItemsGateway=e,this.sharingCrypto=t,this.sharingUserGroups=s,this.sharingUsers=i}}F=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===d?Object:d,void 0===T.Z?Object:T.Z,void 0===_.o?Object:_.o,void 0===D.E?Object:D.E])],F);var P=s(63144),U=s(62149);class N extends((0,P.Q)({storeName:"share-items-errors-state",scope:U.F.User,persist:!1,initialValue:{hasErrors:!1}})){}var L=s(87065),x=s(43978),G=s(69885),k=s(6136),K=s(57452);class M{get(){return this.currentSpaceGetter.get().pipe((0,L.U)((e=>{if((0,v.hx)(e))throw new Error("Problem retrieving current space information to assess sharing capacity");return(0,v.db)(e).sharedItemsLimit})),(0,x.w)((e=>void 0===e?(0,G.of)(!0):this.sharedItemsRepository.sharedItems$().pipe((0,L.U)((e=>e.length)),(0,k.x)(),(0,L.U)((t=>e-t))))))}constructor(e,t){this.currentSpaceGetter=e,this.sharedItemsRepository=t}}M=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===K.n?Object:K.n,void 0===a.z?Object:a.z])],M);var j=s(51612),V=s(523),W=s(22952);class B{async get(e){const t=await this.credentialsGetter.getCarbonCredentialsByItemIds(e),{notes:s,notesErrors:i}=await this.getSharableNotes(e);return{credentials:t,notes:s,notesErrors:i,secrets:await this.secretsGetter.getCarbonSecretsByItemIds(e)}}async getSharableNotes(e){return(await this.notesGetter.getCarbonNotesByItemIds(e)).reduce(((e,t)=>(t.Attachments?.length?e.notesErrors.push((e=>{const{Id:t,Title:s}=e;return{id:t,title:s,error:f.z.ITEM_HAS_ATTACHMENTS,type:b.y2.SecureNote,color:e.Type}})(t)):e.notes.push(t),e)),{notes:(0,y.Ay)([]),notesErrors:(0,y.Ay)([])})}constructor(e,t,s){this.credentialsGetter=e,this.notesGetter=t,this.secretsGetter=s}}B=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===j.J?Object:j.J,void 0===V.H?Object:V.H,void 0===W.F?Object:W.F])],B);var z=s(40217);class q{async run(e){const{vaultItemIds:t,permission:s,userLogins:i,userGroupIds:r}=e,{credentials:n,secrets:o,notes:a,notesErrors:c}=await this.shareableItems.get(t),d=[...a,...n,...o],{alreadySharedItems:l,alreadySharedItemsErrors:u,alreadySharedItemIds:h}=await(0,p.z)(this.getAlreadySharedItems(d,t)),g=d.filter((e=>!h.includes(e.Id))),m=[...l,...g.length?await this.sharingItemsService.createMultipleItemGroups(g):[]],v=[...c,...u,...m.length?await this.sharingItemsInvitesService.inviteRecipients(i,r,m,d,s):[]];return{hasChanges:m.length>0,errors:v}}getAlreadySharedItems(e,t){return this.sharedItemsRepository.sharedItemsForIds$(t).pipe((0,L.U)((t=>t.reduce(((t,s)=>(s.permission===b.y3.Limited?t.alreadySharedItemsErrors.push(((e,t)=>O(c.INSUFFICIENT_PERMISSION_PRIVILEGES,e,t))(s.itemId,e)):t.alreadySharedItems.push(s),t.alreadySharedItemIds.push(s.itemId),t)),{alreadySharedItems:(0,y.Ay)([]),alreadySharedItemsErrors:(0,y.Ay)([]),alreadySharedItemIds:(0,y.Ay)([])}))))}constructor(e,t,s,i){this.sharingItemsInvitesService=e,this.sharingItemsService=t,this.sharedItemsRepository=s,this.shareableItems=i}}q=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===F?Object:F,void 0===z.k?Object:z.k,void 0===a.z?Object:a.z,void 0===B?Object:B])],q);var H=s(7165),Y=s(56618),Q=s(60018),$=s(88981);const X=H.z.object({sharedItemId:H.z.string(),vaultItemId:H.z.string(),revision:H.z.number(),savedToVault:H.z.boolean().optional()}),Z=H.z.object({indexPerVaultItemId:H.z.record(X),sharedItems:H.z.record($.m$),sharedAccess:H.z.record($.Im)}),J=e=>Z.safeParse(e).success;class ee extends((0,P.Q)({persist:!0,storage:{initialValue:{indexPerVaultItemId:{},sharedItems:{},sharedAccess:{}},typeGuard:J,schemaVersion:4,migrateStorageSchema:()=>({indexPerVaultItemId:{},sharedItems:{},sharedAccess:{}})},scope:U.F.User,storeName:"shared-items-state",storeTypeGuard:J,codec:Q.E,isCache:!0,capacity:Y.Y.Unlimited})){}var te=s(162),se=s(43651),ie=s(6489);class re{async getVaultItemsIndex(){const{indexPerVaultItemId:e}=await this.store.getState();return e}async getSharedItemsIndex(){const{sharedItems:e}=await this.store.getState();return e}async setSharedItems(e,t){if(!e||!t)return void this.store.set({indexPerVaultItemId:{},sharedItems:{},sharedAccess:{}});const s=await this.store.getState();await this.store.set(e.reduce(((e,{sharedItem:i,revision:r})=>(e.sharedItems[i.sharedItemId]=i,e.indexPerVaultItemId[i.itemId]={sharedItemId:i.sharedItemId,vaultItemId:i.itemId,revision:r},e.sharedAccess[i.sharedItemId]=t[i.sharedItemId]??s.sharedAccess[i.sharedItemId],e)),(0,y.Ay)({sharedItems:{},indexPerVaultItemId:{},sharedAccess:{}})))}sharedItems$(){return this.store.state$.pipe((0,L.U)((({sharedItems:e})=>Object.values(e))))}sharedItemsForIds$(e){return this.store.state$.pipe((0,L.U)((({sharedItems:t,indexPerVaultItemId:s})=>e.reduce(((e,i)=>{const r=s[i];if(r){const s=t[r.sharedItemId];s&&e.push(s)}return e}),(0,y.Ay)([])))))}sharedItemForId$(e){return this.store.state$.pipe((0,L.U)((({sharedItems:t,indexPerVaultItemId:s})=>s[e]?t[s[e].sharedItemId]:null)))}sharedAccess$(){return this.store.state$.pipe((0,L.U)((({sharedAccess:e})=>Object.values(e))))}sharedAccessForId$(e){return this.store.state$.pipe((0,L.U)((({sharedAccess:t,indexPerVaultItemId:s})=>{const i=s[e];if(!i)return null;const r=i.sharedItemId;return{sharedItemId:r,...t[r]}})))}sharedAccessForIds$(e){return this.store.state$.pipe((0,L.U)((({sharedAccess:t,indexPerVaultItemId:s})=>e.reduce(((e,i)=>{const r=s[i];if(r){const s=t[r.sharedItemId];s&&e.push(s)}return e}),(0,y.Ay)([])))))}sharedAccessesById$(e){return this.store.state$.pipe((0,L.U)((({sharedAccess:t,indexPerVaultItemId:s})=>e.reduce(((e,i)=>{const r=s[i];if(r){const s=t[r.sharedItemId];s&&(e[i]=s)}return e}),(0,y.Ay)({})))))}constructor(e){this.store=e}}re=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ee?Object:ee])],re);var ne=s(61076),oe=s(14122),ae=s(11047),ce=s(93986),de=s(74929),le=s(71275);const ue=(e,t,s,i)=>e.reduce(((e,r)=>{if("items"===r.type)try{const n=(0,ae.$h)(r,t,s,i);e.push(n)}catch(e){}return e}),(0,y.Ay)([])),pe=(e,t,s,i)=>{if(!e)return null;try{return(0,ae.$h)(e,t,s,i)}catch(e){return null}};class he{userId$(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"state.userSession.account.login"}).pipe((0,L.U)((e=>{if((0,v.d6)(e)&&"string"==typeof e.data)return e.data;throw new Error("No active login")})))}combineWithCollectionsAndUserGroups(e,t){return e.pipe((0,ne.V)(this.userGroupsGetter.getCarbonUserGroups$(),this.collectionsRepository.collections$(),this.userId$()),(0,L.U)((([e,s,i,r])=>{if((0,v.hx)(e))throw new Error("Error when retrieving item groups");return t((0,v.db)(e),s,i,r)})))}sharedItems$(){return this.combineWithCollectionsAndUserGroups(this.itemGroupsGetter.get(),ue)}sharedItemsForIds$(e){return this.combineWithCollectionsAndUserGroups(this.itemGroupsGetter.getForItemsIds(e),ue)}sharedItemForId$(e){return this.combineWithCollectionsAndUserGroups(this.itemGroupsGetter.getForItemId(e),pe)}sharedAccess$(){return this.itemGroupsGetter.get().pipe((0,L.U)((e=>{if((0,v.hx)(e))throw new Error("Error when retrieving item groups for shared access");return(0,v.db)(e).map((e=>(0,ae.K4)(e)))})))}sharedAccessForId$(e){return this.combineWithCollectionsAndUserGroups(this.itemGroupsGetter.getForItemId(e),(e=>e?{sharedItemId:e.groupId,...(0,ae.K4)(e)}:null))}sharedAccessForIds$(e){return this.itemGroupsGetter.getForItemsIds(e).pipe((0,L.U)((e=>{if((0,v.hx)(e))throw new Error("Cannot get shared access for items");return(0,v.db)(e).map((e=>(0,ae.K4)(e)))})))}sharedAccessesById$(e){return this.itemGroupsGetter.getForItemsIds(e).pipe((0,L.U)((e=>{if((0,v.hx)(e))throw new Error("Cannot get shared access for items");return(0,v.db)(e).reduce(((e,t)=>{const s=t.items?.[0].itemId;return s&&(e[s]=(0,ae.K4)(t)),e}),(0,y.Ay)({}))})))}getSharedItemsIndex(){return Promise.reject(new Error("not supported"))}getVaultItemsIndex(){return Promise.reject(new Error("not supported"))}async setSharedItems(){throw new Error("not supported")}constructor(e,t,s,i){this.itemGroupsGetter=e,this.userGroupsGetter=t,this.collectionsRepository=s,this.carbonLegacyClient=i}}he=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ce.E?Object:ce.E,void 0===de.B?Object:de.B,void 0===le.G?Object:le.G,void 0===oe._?Object:oe._])],he);class ge{sharedItems$(){return(0,te.D)(this.getRepo()).pipe((0,x.w)((e=>e.sharedItems$())))}sharedItemForId$(e){return(0,te.D)(this.getRepo()).pipe((0,x.w)((t=>t.sharedItemForId$(e))))}sharedItemsForIds$(e){return(0,te.D)(this.getRepo()).pipe((0,x.w)((t=>t.sharedItemsForIds$(e))))}sharedAccess$(){return(0,te.D)(this.getRepo()).pipe((0,x.w)((e=>e.sharedAccess$())))}sharedAccessForId$(e){return(0,te.D)(this.getRepo()).pipe((0,x.w)((t=>t.sharedAccessForId$(e))))}sharedAccessForIds$(e){return(0,te.D)(this.getRepo()).pipe((0,x.w)((t=>t.sharedAccessForIds$(e))))}sharedAccessesById$(e){return(0,te.D)(this.getRepo()).pipe((0,x.w)((t=>t.sharedAccessesById$(e))))}async getSharedItemsIndex(){return(await this.getRepo()).getSharedItemsIndex()}async getRepo(){const{userFeatureFlip:e}=this.featureFlips.queries,t=await(0,p.z)(e({featureFlip:ie.d.SharingSyncGrapheneMigrationDev}));return(0,v.hx)(t)?this.legacyRepo:(0,v.db)(t)?this.repo:this.legacyRepo}async getVaultItemsIndex(){return(await this.getRepo()).getVaultItemsIndex()}async setSharedItems(e,t){return(await this.getRepo()).setSharedItems(e,t)}constructor(e,t,s){this.repo=e,this.legacyRepo=t,this.featureFlips=s}}ge=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===re?Object:re,void 0===he?Object:he,void 0===se.P?Object:se.P])],ge);class me{async refuseSharedItem(e){const t=await(0,p.z)(this.sharedItemRepository.sharedItemForId$(e));if(!t)throw new Error("Failed to retrieve shared item to refuse");await(0,p.z)(this.serverApiClient.v1.sharingUserdevice.refuseItemGroup({groupId:t.sharedItemId,revision:t.revision}))}constructor(e,t){this.serverApiClient=e,this.sharedItemRepository=t}}me=(0,i.gn)([(0,l.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===u.l?Object:u.l,void 0===a.z?Object:a.z])],me);var ve=s(82874),ye=s(2741),Se=s(27790),we=s(80629);class Ee{async execute({body:e}){const{sharedItemId:t,revision:s,users:i,groups:r}=await this.getItemGroup(e),n=await this.commonGateway.updateItemGroupMembers({groupId:t,revision:s,users:i,groups:r});if((0,v.hx)(n)){if(n.error.tag===Se.wI){await this.sharingSync.scheduleSync();const{sharedItemId:t,revision:s}=await this.getItemGroup(e);return await this.commonGateway.updateItemGroupMembers({groupId:t,revision:s,users:i,groups:r}),(0,v.Vp)(void 0)}throw new Error("Revoke shared item failed after retry attempt")}return await this.sharingSync.scheduleSync(),(0,v.Vp)(void 0)}async getItemGroup(e){const{vaultItemId:t,recipient:s,permission:i}=e,r=await(0,p.z)(this.sharedItemRepository.sharedItemForId$(t));if(!r)throw new Error("Failed to retrieve item group to revoke share item");const{sharedItemId:n,revision:o}=r;return{sharedItemId:n,revision:o,users:s.type===b.IP.User?[{userId:s.alias,permission:i}]:void 0,groups:s.type===b.IP.Group?[{groupId:s.groupId,permission:i}]:void 0}}constructor(e,t,s){this.sharingSync=e,this.commonGateway=t,this.sharedItemRepository=s}}Ee=(0,i.gn)([(0,ve.W)(ye.W),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===we.D?Object:we.D,void 0===Se.b_?Object:Se.b_,void 0===a.z?Object:a.z])],Ee);var Ie=s(98721),Ae=s(39431),fe=s(50879);class be{async execute({body:e}){const{revision:t,itemGroupId:s,userLogins:i,userGroupIds:r}=await this.getItemGroup(e),n=await(0,p.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[Ae.U.Credential],ids:[e.vaultItemId]}).pipe((0,L.U)((t=>{if((0,v.d6)(t))return t.data.credentialsResult.items.find((t=>t.id===e.vaultItemId))})))),o=await this.commonGateway.revokeItemGroupMembers({revision:t,itemGroupId:s,userLogins:i,userGroupIds:r,auditLogDetails:n?{type:"AUTHENTIFIANT",domain:new A.Y(n.URL).getRootDomain(),captureLog:!0}:void 0});if((0,v.hx)(o)){if(o.error.tag===Se.wI){await this.sharingSync.scheduleSync();const{revision:t,itemGroupId:s}=await this.getItemGroup(e);return await this.commonGateway.revokeItemGroupMembers({revision:t,itemGroupId:s,userLogins:i,userGroupIds:r}),(0,v.Vp)(void 0)}throw new Error("Revoke shared item failed after retry attempt")}return await this.sharingSync.scheduleSync(),(0,v.Vp)(void 0)}async getItemGroup(e){const{vaultItemId:t,recipient:s}=e,i=await(0,p.z)(this.sharedItemRepository.sharedItemForId$(t));if(!i)throw new Error("Failed to retrieve item group to revoke share item");const{sharedItemId:r,revision:n}=i;return{revision:n,itemGroupId:r,userLogins:s.type===b.IP.User?[s.alias]:void 0,userGroupIds:s.type===b.IP.Group?[s.groupId]:void 0}}constructor(e,t,s,i){this.sharingSync=e,this.commonGateway=t,this.sharedItemRepository=s,this.vaultItemsCrudClient=i}}be=(0,i.gn)([(0,ve.W)(Ie.V),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===we.D?Object:we.D,void 0===Se.b_?Object:Se.b_,void 0===a.z?Object:a.z,void 0===fe.L?Object:fe.L])],be);var Ce=s(24701);class Oe{async execute({body:e}){return await this.sharedItemsService.refuseSharedItem(e.vaultItemId),(0,v.Vp)(void 0)}constructor(e){this.sharedItemsService=e}}Oe=(0,i.gn)([(0,ve.W)(Ce.l),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===me?Object:me])],Oe);var Re=s(41182),Te=s(95038),_e=s(40102),De=s(11108),Fe=s(16433),Pe=s(62760),Ue=s(16712),Ne=s(46449),Le=s(89720);class xe{getCurrentUserLogin(){return this.context.get(Ue.l.UserName)}execute({body:e}){const{itemId:t}=e,{userFeatureFlip:s}=this.featureFlips.queries;return s({featureFlip:"sharingVault_web_sharingSyncGrapheneMigration_dev"}).pipe((0,Fe.q)(1),(0,x.w)((e=>!!(0,v.d6)(e)&&!!(0,v.db)(e)?this.executeWithGrapheneState$(t):this.executeWithCarbonState$(t))))}executeWithGrapheneState$(e){return this.sharedItemsRepository.sharedAccessForId$(e).pipe((0,x.w)((e=>{if(!e)return(0,G.of)({isShared:!1,isSharedViaUserGroup:!1});const t=this.getCurrentUserLogin();if(!t)throw new Error("No user login found to check sharing status for item");return this.userGroupRepository.acceptedUserGroupIdsForLogin$(t).pipe((0,L.U)((t=>({isShared:!0,isSharedViaUserGroup:e.userGroups.some((({id:e,status:s})=>t.includes(e)&&"accepted"===s))}))))})),(0,k.x)(Pe.shallowEqualObjects),(0,L.U)(v.Vp))}executeWithCarbonState$(e){return this.itemGroupGetter.getForItemId(e).pipe((0,x.w)((e=>{if((0,v.hx)(e))throw new Error("Error when retrieving item group to check sharing status");const t=(0,v.db)(e);if(!t)return(0,G.of)({isShared:!1,isSharedViaUserGroup:!1});const s=this.getCurrentUserLogin();if(!s)throw new Error("No user login found to check sharing status for item");return this.userGroupRepository.acceptedUserGroupIdsForLogin$(s).pipe((0,L.U)((e=>({isShared:!0,isSharedViaUserGroup:t.groups?.some((({groupId:t,status:s})=>e.includes(t)&&"accepted"===s))??!1}))))})),(0,k.x)(Pe.shallowEqualObjects),(0,L.U)(v.Vp))}constructor(e,t,s,i,r){this.itemGroupGetter=e,this.userGroupRepository=t,this.sharedItemsRepository=s,this.context=i,this.featureFlips=r}}xe=(0,i.gn)([(0,Ne.e)(Te.S),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ce.E?Object:ce.E,void 0===Le.x?Object:Le.x,void 0===a.z?Object:a.z,void 0===Ue.f?Object:Ue.f,void 0===se.P?Object:se.P])],xe);class Ge{execute({body:e}){const{itemId:t}=e;return this.sharedItemsRepository.sharedItemForId$(t).pipe((0,L.U)((e=>(0,v.Vp)({isLastAdmin:Boolean(e?.isLastAdmin)}))))}constructor(e){this.sharedItemsRepository=e}}Ge=(0,i.gn)([(0,Ne.e)(De.X),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.z?Object:a.z])],Ge);class ke{async execute({body:e}){const{vaultItemId:t}=e,s=await(0,p.z)(this.sharingStatusForItemQueryHandler.execute(new Te.S({itemId:t}))),{isSharedViaUserGroup:i,isShared:r}=(0,v.f2)(s,{success:Re.y,failure:e=>{throw new Error("Unexpected failure while attempting to retrieve sharing status of item to be deleted",{cause:{failure:e}})}});if(!r)return(0,v.Vp)(void 0);if(i)return(0,v.Rn)((0,_e.Vf)());const n=await(0,p.z)(this.getIsLastAdminForItemQueryHandler.execute(new De.X({itemId:t}))),{isLastAdmin:o}=(0,v.f2)(n,{success:Re.y,failure:e=>{throw new Error("Unexpected failure while attempting to determine if we're the last admin of shared item to be deleted",{cause:{failure:e}})}});return o?(0,v.Rn)((0,_e.V$)()):(await this.sharedItemsService.refuseSharedItem(t),(0,v.Vp)(void 0))}constructor(e,t,s){this.sharingStatusForItemQueryHandler=e,this.getIsLastAdminForItemQueryHandler=t,this.sharedItemsService=s}}ke=(0,i.gn)([(0,ve.W)(_e.OL),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===xe?Object:xe,void 0===Ge?Object:Ge,void 0===me?Object:me])],ke);var Ke=s(33472);class Me{async execute({body:e}){const{vaultItemIds:t}=e,s=await(0,p.z)(this.isSharingAllowedService.get());if("boolean"==typeof s?!s:t.length>s)return(0,v.Rn)((0,Ke.Kb)());let i=!1,r=null;const{hasChanges:n,errors:o}=await this.shareItemsService.run(e);if(i=n,r=o,this.hasInvalidRevisionErrors(o)){const{hasChanges:s,errors:n}=await this.runShareAttempt({...e,vaultItemIds:t.filter((e=>o.find((t=>t.id===e))))});r=n,i=i||s}return i&&this.sharingSync.scheduleSync(),r.length?(this.sharedItemsErrorsStore.set({hasErrors:!0,errors:r}),(0,v.Rn)((0,Ke.$u)())):(this.sharedItemsErrorsStore.set({hasErrors:!1}),(0,v.Vp)(void 0))}hasInvalidRevisionErrors(e){return e.find((({error:e})=>e===f.z.INVALID_REVISION))}async runShareAttempt(e){return await this.sharingSync.runSync(),this.shareItemsService.run(e)}constructor(e,t,s,i){this.isSharingAllowedService=e,this.sharedItemsErrorsStore=t,this.sharingSync=s,this.shareItemsService=i}}Me=(0,i.gn)([(0,ve.W)(Ke.S2),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===M?Object:M,void 0===N?Object:N,void 0===we.D?Object:we.D,void 0===q?Object:q])],Me);var je=s(63352),Ve=s(19911),We=s(95196),Be=s(92324),ze=s(7533);class qe{async execute({body:e}){const{itemContent:t,itemId:s}=e,i=await this.sharedItemsRepository.getVaultItemsIndex(),r=await(0,p.z)(this.sharedItemsRepository.sharedItemForId$(s));if(!r)throw new Error("Shared item not found when trying to update its content");const n=i[r.itemId].revision,o=await this.sharingCryptoUtility.decryptItemGroupKey(r);if(!o)throw new Error("Shared item key cannot be decrypted when trying to update its content");const a=await this.sharingCryptoElements.decryptSecureData(o,(0,je.R)(r.itemKey)),c=(0,Be.w)(t),d=await this.sharingCryptoElements.encryptSecureData(a,c);return await(0,p.z)(this.serverApi.v1.sharingUserdevice.updateItem({content:(0,Ve.s)(d),itemId:s,timestamp:n})),(0,v.Vp)(void 0)}constructor(e,t,s,i){this.sharedItemsRepository=e,this.sharingCryptoElements=t,this.sharingCryptoUtility=s,this.serverApi=i}}qe=(0,i.gn)([(0,ve.W)(We.l),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.z?Object:a.z,void 0===ze.M?Object:ze.M,void 0===T.Z?Object:T.Z,void 0===u.l?Object:u.l])],qe);var He=s(89623);class Ye{execute(){return this.sharedItemsRepository.sharedAccess$().pipe((0,L.U)((e=>(0,v.Vp)({sharedAccess:e}))))}constructor(e){this.sharedItemsRepository=e}}Ye=(0,i.gn)([(0,Ne.e)(He.w),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.z?Object:a.z])],Ye);var Qe=s(38661);class $e{execute({body:e}){const{itemIds:t}=e;return this.sharedItemsRepository.sharedAccessForIds$(t).pipe((0,L.U)((e=>(0,v.Vp)({sharedAccess:e}))))}constructor(e){this.sharedItemsRepository=e}}$e=(0,i.gn)([(0,Ne.e)(Qe.D),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.z?Object:a.z])],$e);var Xe=s(80160);class Ze{execute(){return this.sharedItemsRepository.sharedItems$().pipe((0,L.U)((e=>(0,v.Vp)({sharedItems:e}))))}constructor(e){this.sharedItemsRepository=e}}Ze=(0,i.gn)([(0,Ne.e)(Xe.w),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.z?Object:a.z])],Ze);var Je=s(90878);class et{execute({body:e}){const{itemId:t}=e;return(0,te.D)(this.repo.sharedItemForId$(t)).pipe((0,L.U)((e=>(0,v.Vp)({sharedItem:e}))))}constructor(e){this.repo=e}}et=(0,i.gn)([(0,Ne.e)(Je.L),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.z?Object:a.z])],et);var tt=s(54933);class st{execute(){return this.isSharingAllowedService.get().pipe((0,L.U)((e=>(0,v.Vp)("boolean"==typeof e?e:e>0))))}constructor(e){this.isSharingAllowedService=e}}st=(0,i.gn)([(0,Ne.e)(tt.B),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===M?Object:M])],st);var it=s(33312),rt=s(38638);class nt{execute(){return this.premiumSpaceGetter.get().pipe((0,x.w)((e=>{if((0,v.hx)(e))throw new Error("Error retrieving space for user");return(0,v.db)(e).teamId?this.serverApiClient.v1.sharingUserdevice.getTeamLogins().pipe((0,it.Qn)((e=>({userLogins:e.data.teamLogins}))),(0,it.DZ)((e=>{throw e}))):(0,G.of)((0,v.Vp)({userLogins:[]}))})))}constructor(e,t){this.serverApiClient=e,this.premiumSpaceGetter=t}}nt=(0,i.gn)([(0,Ne.e)(rt.G),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===u.l?Object:u.l,void 0===K.n?Object:K.n])],nt);var ot=s(36155);class at{execute(){return this.currentSpaceGetter.get().pipe((0,it.Qn)((e=>e.isSharingEnabled)))}constructor(e){this.currentSpaceGetter=e}}at=(0,i.gn)([(0,Ne.e)(ot.N),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===K.n?Object:K.n])],at);var ct=s(95803);class dt{execute({body:e}){const{itemIds:t}=e;return this.sharedItemsRepository.sharedItemsForIds$(t).pipe((0,L.U)((e=>(0,v.Vp)({sharedItems:e}))))}constructor(e){this.sharedItemsRepository=e}}dt=(0,i.gn)([(0,Ne.e)(ct.z),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.z?Object:a.z])],dt);var lt=s(10705),ut=s(86368);class pt{getCurrentUserLogin(){return this.context.get(Ue.l.UserName)}execute({body:e}){const{itemIds:t}=e;return this.sharedItemsRepository.sharedAccessesById$(t).pipe((0,x.w)((e=>{const t=this.getCurrentUserLogin();if(!t)throw new Error("No user login found to check sharing status for item");return this.userGroupRepository.acceptedUserGroupIdsForLogin$(t).pipe((0,L.U)((t=>Object.entries(e).reduce(((e,[s,i])=>{const r=i.userGroups.some((({id:e,status:s})=>t.includes(e)&&"accepted"===s));return e[s]={isShared:!0,isSharedViaUserGroup:r},e}),(0,y.Ay)({})))))})),(0,k.x)(((e,t)=>(0,lt.Z)(e,t))),(0,L.U)(v.Vp))}constructor(e,t,s){this.userGroupRepository=e,this.context=t,this.sharedItemsRepository=s}}pt=(0,i.gn)([(0,Ne.e)(ut.I),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===Le.x?Object:Le.x,void 0===Ue.f?Object:Ue.f,void 0===a.z?Object:a.z])],pt);var ht=s(46234);const gt=e=>e===b.y3.Admin?{canCopy:!0,canView:!0,canEdit:!0,canShare:!0,canChangeRoles:!0}:{canCopy:!1,canView:!1,canEdit:!1,canShare:!1,canChangeRoles:!1};class mt{execute({body:e}){const{itemId:t}=e;return this.sharedItemsRepository.sharedItemForId$(t).pipe((0,L.U)((e=>{const t=e?e.permission:b.y3.Admin,s=gt(t);return(0,v.Vp)({permissionLevel:e?.permission,capabilities:s})})))}constructor(e){this.sharedItemsRepository=e}}mt=(0,i.gn)([(0,Ne.e)(ht.C),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.z?Object:a.z])],mt);var vt=s(62176);class yt{execute({body:e}){const{itemIds:t}=e;return this.sharedItemsRepository.sharedItemsForIds$(t).pipe((0,L.U)((e=>(0,v.Vp)(e.reduce(((e,t)=>{const s=gt(t.permission);return e[t.itemId]={permissionLevel:t.permission,capabilities:s},e}),{})))))}constructor(e){this.sharedItemsRepository=e}}yt=(0,i.gn)([(0,Ne.e)(vt.R),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.z?Object:a.z])],yt);var St=s(47670);class wt{execute({body:e}){const{itemId:t}=e,{userFeatureFlip:s}=this.featureFlips.queries;return s({featureFlip:"sharingVault_web_sharingSyncGrapheneMigration_dev"}).pipe((0,Fe.q)(1),(0,x.w)((e=>!!(0,v.d6)(e)&&!!(0,v.db)(e)?this.executeWithNewState$(t):this.executeWithCarbonState$(t))))}executeWithNewState$(e){return this.sharedItemsRepository.sharedAccessForId$(e).pipe((0,L.U)((e=>{if(!e)return(0,v.Vp)(void 0);const t=e.sharedItemId,s=e.users.map((e=>(0,ae.t9)(e,b.IP.User))),i=e.userGroups.map((e=>(0,ae.t9)(e,b.IP.Group))),r=e.collections.map((e=>(0,ae.t9)(e,b.IP.Collection))),n={itemGroupId:t,count:s.length+i.length+r.length,users:s,groups:i,collections:r};return(0,v.Vp)(n)})))}executeWithCarbonState$(e){return this.itemGroupsGetter.getForItemId(e).pipe((0,L.U)((e=>{if((0,v.hx)(e))throw new Error("Error when retrieving item group for shared access");const t=(0,v.db)(e);if(!t)return;const s=t.users?.map((e=>({permission:e.permission,status:e.status,recipientId:e.userId,recipientName:e.alias,recipientType:b.IP.User}))).filter((e=>!["revoked","refused"].includes(e.status??""))).sort(((e,t)=>e.recipientName.localeCompare(t.recipientName))),i=t.groups?.map((e=>({permission:e.permission,status:e.status,recipientId:e.groupId,recipientName:e.name,recipientType:b.IP.Group}))).filter((e=>!["revoked","refused"].includes(e.status))).sort(((e,t)=>e.recipientName.localeCompare(t.recipientName))),r=t.collections?.map((e=>({permission:e.permission,status:e.status,recipientId:e.uuid,recipientName:e.name,recipientType:b.IP.Collection}))).filter((e=>!["revoked","refused"].includes(e.status))).sort(((e,t)=>e.recipientName.localeCompare(t.recipientName)));return{users:s??[],groups:i??[],collections:r??[],itemGroupId:t.groupId}})),(0,x.w)((e=>e?.groups.length?this.userGroupsGetter.getCarbonUserGroups$().pipe((0,L.U)((t=>({...e,groups:e.groups.map((e=>({...e,recipientName:t.find((t=>t.groupId===e.recipientId))?.name??e.recipientName})))})))):(0,G.of)(e))),(0,x.w)((e=>e?.collections.length?this.collectionsRepository.collections$().pipe((0,L.U)((t=>({...e,collections:e.collections.map((e=>({...e,recipientName:t.find((t=>t.uuid===e.recipientId))?.name??e.recipientName})))})))):(0,G.of)(e))),(0,L.U)((e=>(0,v.Vp)(e?{...e,count:e.users.length+e.groups.length+e.collections.length}:void 0))))}constructor(e,t,s,i,r){this.itemGroupsGetter=e,this.userGroupsGetter=t,this.collectionsRepository=s,this.sharedItemsRepository=i,this.featureFlips=r}}wt=(0,i.gn)([(0,Ne.e)(St.v),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===ce.E?Object:ce.E,void 0===de.B?Object:de.B,void 0===le.G?Object:le.G,void 0===a.z?Object:a.z,void 0===se.P?Object:se.P])],wt);var Et=s(39672),It=s(22449);class At{getVaultItems(e,t,s,i){return this.vaultClient.queries.search({searchQuery:s,vaultItemTypes:e,propertyFilters:null!==i?[{property:"spaceId",value:i}]:void 0,ids:t})}execute({body:e}){const{userFeatureFlip:t}=this.featureFlips.queries;if(!e.userId&&!e.groupId)throw new Error("No userId and no groupId has been provided");return t({featureFlip:"sharingVault_web_sharingSyncGrapheneMigration_dev"}).pipe((0,Fe.q)(1),(0,x.w)((t=>!!(0,v.d6)(t)&&!!(0,v.db)(t)?this.executeWithGrapheneState$(e):this.executeWithCarbonState$(e))))}executeWithGrapheneState$(e){const{userId:t,groupId:s,query:i,spaceId:r}=e;return this.sharedItemsStore.state$.pipe((0,x.w)((({sharedAccess:e,sharedItems:n})=>{const o=[];for(const i in e)t?e[i].users.some((e=>e.id===t))&&o.push(n[i].itemId):s&&e[i].userGroups.some((e=>e.id===s&&e.status!==b.qb.Revoked))&&o.push(n[i].itemId);return this.getVaultItems([Ae.U.Credential,Ae.U.SecureNote,Ae.U.Secret],o,i,r).pipe((0,L.U)((e=>{if(!(0,v.d6)(e))throw new Error("Unable to retrieve vault items");const t=e.data.credentialsResult.items,s=e.data.secureNotesResult.items,i=e.data.secretsResult.items;return(0,v.Vp)({sharedCredentials:t,sharedSecureNotes:s,sharedSecrets:i})})))})))}executeWithCarbonState$(e){const{userId:t,groupId:s,query:i,spaceId:r}=e;return this.itemGroupGetter.get().pipe((0,x.w)((e=>{if(!(0,v.d6)(e))throw new Error("Incorrect type");const n=e.data.filter((e=>t?e.users?.filter((e=>e.userId===t)).length:s?e.groups?.filter((e=>e.groupId===s&&e.status!==b.qb.Revoked)).length:void 0)).flatMap((e=>e.items?.map((e=>e.itemId))||[]));return this.getVaultItems([Ae.U.Credential,Ae.U.SecureNote,Ae.U.Secret],n,i,r).pipe((0,L.U)((e=>{if(!(0,v.d6)(e))throw new Error("Unable to retrieve vault items");const t=e.data.credentialsResult.items,s=e.data.secureNotesResult.items,i=e.data.secretsResult.items;return(0,v.Vp)({sharedCredentials:t,sharedSecureNotes:s,sharedSecrets:i})})))})))}constructor(e,t,s,i){this.vaultClient=e,this.itemGroupGetter=t,this.featureFlips=s,this.sharedItemsStore=i}}At=(0,i.gn)([(0,Ne.e)(Et.v),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===It.T?Object:It.T,void 0===ce.E?Object:ce.E,void 0===se.P?Object:se.P,void 0===ee?Object:ee])],At);var ft=s(52715);class bt{execute(){return this.sharedItemsRepo.sharedItems$().pipe((0,L.U)((e=>(0,v.Vp)(e.map((e=>e.itemId))))))}constructor(e){this.sharedItemsRepo=e}}bt=(0,i.gn)([(0,Ne.e)(ft.c),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.z?Object:a.z])],bt);class Ct{execute(){return this.store.state$.pipe((0,L.U)((e=>e.hasErrors?(0,v.Vp)(e.errors.reduce(((e,t)=>{const{id:s,type:i,title:r,error:n}=t,o={id:s,title:r,reason:n};switch(i){case b.y2.Credential:e.credentialsErrors.push({...o,domain:t.domain,text:t.text});break;case b.y2.SecureNote:e.notesErrors.push({...o,color:t.color});break;default:e.secretsErrors.push({...o})}return e}),{credentialsErrors:(0,y.Ay)([]),notesErrors:(0,y.Ay)([]),secretsErrors:(0,y.Ay)([])})):(0,v.Vp)({credentialsErrors:[],notesErrors:[],secretsErrors:[]}))))}constructor(e){this.store=e}}Ct=(0,i.gn)([(0,Ne.e)(f.f),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===N?Object:N])],Ct);var Ot=s(46675),Rt=s(14139),Tt=s(13186),_t=s(75028),Dt=s(85378);class Ft{}Ft=(0,i.gn)([(0,r.Y)({api:o.X,providers:[F,M,q,me,B,he,re,{provide:a.z,useClass:ge},{provide:d,useClass:E}],exports:[a.z],stores:[N,ee],handlers:{commands:{updateSharedItemPermission:Ee,revokeSharedItem:be,refuseSharedItem:Oe,refuseSharedItemBeforeDeletion:ke,shareItems:Me,updateSharedItemContent:qe},events:{},queries:{getSharedAccess:Ye,getSharedAccessForItemIds:$e,getSharedItems:Ze,getSharedItemForId:et,isSharingAllowed:st,getSharingTeamLogins:nt,sharingEnabled:at,getSharedItemsForItemIds:dt,getSharingStatusForItem:xe,getSharingStatusForItems:pt,getPermissionForItem:mt,getPermissionForItems:yt,getIsLastAdminForItem:Ge,sharedAccessForItem:wt,getUserSharedVaultItems:At,sharedItemsIds:bt,shareItemsErrors:Ct}},imports:[n.n,Rt.y,Tt.I,Ot.a,_t.k,Dt.u]})],Ft)},85378:(e,t,s)=>{s.d(t,{u:()=>M});var i=s(92336),r=s(86006),n=s(87581),o=s(7165),a=s(63144),c=s(56618),d=s(62149),l=s(60018);const u=o.z.object({groupId:o.z.string(),name:o.z.string(),revision:o.z.number(),publicKey:o.z.string(),privateKey:o.z.string(),acceptedUsers:o.z.array(o.z.string()),allUsers:o.z.array(o.z.string()),groupKey:o.z.string().optional()}),p=o.z.object({userGroups:o.z.record(u)}),h=e=>p.safeParse(e).success;class g extends((0,a.Q)({persist:!0,storage:{initialValue:{userGroups:{}},typeGuard:h,schemaVersion:1},scope:d.F.User,storeName:"sharing-user-groups-state",storeTypeGuard:h,codec:l.E,isCache:!0,capacity:c.Y.Unlimited})){}var m=s(89720),v=s(162),y=s(43978),S=s(60399),w=s(92587),E=s(78346),I=s(43651),A=s(6489),f=s(87065),b=s(7303);class C{async getUserGroups(){const{userGroups:e}=await this.userGroupsStore.getState();return Object.keys(e).reduce(((t,s)=>{const{groupId:i,name:r,revision:n,acceptedUsers:o,privateKey:a,publicKey:c,groupKey:d}=e[s];return t[s]={groupId:i,name:r,revision:n,privateKey:a,publicKey:c,users:[],acceptedUsers:o,groupKey:d},t}),(0,b.Ay)({}))}setUserGroups(e){const t=e.reduce(((e,t)=>(e[t.groupId]={...t,allUsers:t.allUsers??[],acceptedUsers:t.acceptedUsers??[]},e)),(0,b.Ay)({}));this.userGroupsStore.set({userGroups:t})}async getUserGroup(e){const{userGroups:t}=await this.userGroupsStore.getState(),s=t[e];if(!s)return null;const{groupId:i,name:r,revision:n,acceptedUsers:o,privateKey:a,publicKey:c,groupKey:d}=s;return{groupId:i,name:r,revision:n,privateKey:a,publicKey:c,groupKey:d,users:[],acceptedUsers:o}}async getUserGroupsForIds(e){const{userGroups:t}=await this.userGroupsStore.getState();return e.reduce(((e,s)=>{const i=t[s];if(i){const{groupId:t,name:s,revision:r,acceptedUsers:n,privateKey:o,publicKey:a,groupKey:c}=i;e.push({groupId:t,name:s,revision:r,privateKey:o,publicKey:a,groupKey:c,users:[],acceptedUsers:n})}return e}),(0,b.Ay)([]))}async getUserGroupForId(e){const t=await this.getUserGroupsForIds([e]);if(!t.length)throw new Error("Failed to retrieve user group by id");return t[0]}acceptedUserGroupIdsForLogin$(e){return this.userGroupsStore.state$.pipe((0,f.U)((t=>Object.values(t.userGroups).filter((t=>t.acceptedUsers.includes(e))).map((e=>e.groupId)))))}constructor(e){this.userGroupsStore=e}}C=(0,i.gn)([(0,w.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===g?Object:g])],C);var O=s(13252),R=s(16712),T=s(74929);class _{getCurrentUserLogin(){return this.context.get(R.l.UserName)}async getUserGroups(){const e=await this.userGroupsGetter.getCarbonUserGroups(),t={},s=this.getCurrentUserLogin();return e.forEach((e=>{const{groupId:i,name:r,revision:n,privateKey:o,publicKey:a,users:c}=e,d=c.find((e=>e.userId===s))?.groupKey??"",l=c.reduce(((e,t)=>(t.status===O.qb.Accepted&&e.push(t.userId),e)),[]);t[e.groupId]={acceptedUsers:l,groupId:i,name:r,revision:n,privateKey:o,publicKey:a,users:c,groupKey:d}})),t}setUserGroups(){throw new Error("Setting the user group index is not supported in the legacy user groups repository adapter")}async getUserGroup(e){const t=await this.userGroupsGetter.getCarbonUserGroupForGroupId(e);if(!t)throw new Error("Getting a user group by id failed");const s=this.getCurrentUserLogin(),i=t.users.find((e=>e.userId===s))?.groupKey??"";return{...t,groupKey:i}}async getUserGroupsForIds(e){const t=this.getCurrentUserLogin();return(await this.userGroupsGetter.getCarbonUserGroupForGroupIds(e)).map((e=>{const s=e.users.find((e=>e.userId===t))?.groupKey??"";return{...e,groupKey:s}}))}async getUserGroupForId(e){const t=await this.userGroupsGetter.getCarbonUserGroupForGroupId(e);if(!t)throw new Error("Failed to retrieve user group by id");const s=this.getCurrentUserLogin(),i=t.users.find((e=>e.userId===s))?.groupKey??"";return{...t,groupKey:i}}acceptedUserGroupIdsForLogin$(e){return this.userGroupsGetter.getCarbonUserGroups$().pipe((0,f.U)((t=>t.filter((t=>t.users.some((t=>t.userId===e&&t.status===O.qb.Accepted)))).map((e=>e.groupId)))))}constructor(e,t){this.context=e,this.userGroupsGetter=t}}_=(0,i.gn)([(0,w.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===R.f?Object:R.f,void 0===T.B?Object:T.B])],_);class D{async getUserGroup(e){return(await this.getRepo()).getUserGroup(e)}async getUserGroupsForIds(e){return(await this.getRepo()).getUserGroupsForIds(e)}async getUserGroupForId(e){return(await this.getRepo()).getUserGroupForId(e)}async getUserGroups(){return(await this.getRepo()).getUserGroups()}async setUserGroups(e){return(await this.getRepo()).setUserGroups(e)}acceptedUserGroupIdsForLogin$(e){return(0,v.D)(this.getRepo()).pipe((0,y.w)((t=>t.acceptedUserGroupIdsForLogin$(e))))}async getRepo(){const{userFeatureFlip:e}=this.featureFlips.queries,t=await(0,S.z)(e({featureFlip:A.d.SharingSyncGrapheneMigrationDev}));return(0,E.hx)(t)?this.legacyRepo:(0,E.db)(t)?this.repo:this.legacyRepo}constructor(e,t,s){this.repo=e,this.legacyRepo=t,this.featureFlips=s}}D=(0,i.gn)([(0,w.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===C?Object:C,void 0===_?Object:_,void 0===I.P?Object:I.P])],D);var F=s(16433),P=s(46449),U=s(21912),N=s(31839),L=s(14122);class x{execute(){const{userFeatureFlip:e}=this.featureFlips.queries;return e({featureFlip:"sharingVault_web_sharingSyncGrapheneMigration_dev"}).pipe((0,F.q)(1),(0,y.w)((e=>!!(0,E.d6)(e)&&!!(0,E.db)(e)?this.executeWithGrapheneState$():this.executeWithCarbonState$())))}executeWithGrapheneState$(){return(0,v.D)(this.userGroupsRepo.getUserGroups()).pipe((0,f.U)((e=>{const t=[],s=this.context.get(R.l.UserName)??"";for(const i in e){const r=e[i];r.acceptedUsers?.includes(s)&&t.push({id:r.groupId,name:r.name,users:r.acceptedUsers})}return(0,E.Vp)(t)})))}executeWithCarbonState$(){const e={dataQuery:{sortToken:{sortCriteria:[{field:"name",direction:U.S.Ascend}],uniqField:"id"},filterToken:{filterCriteria:[]}},spaceId:""};return this.carbonLegacyClient.queries.getUserGroups(e).pipe((0,f.U)((e=>{if((0,E.hx)(e))throw new Error("Unable to carbon user group data.");const t=(0,E.db)(e).items.map((e=>({id:e.id,itemCount:e.itemCount,name:e.name,users:e.users.map((e=>e.id))})));return(0,E.Vp)(t)})))}constructor(e,t,s,i){this.userGroupsRepo=e,this.carbonLegacyClient=t,this.featureFlips=s,this.context=i}}x=(0,i.gn)([(0,P.e)(N.J),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===m.x?Object:m.x,void 0===L._?Object:L._,void 0===I.P?Object:I.P,void 0===R.f?Object:R.f])],x);var G=s(48782);class k{execute({body:e}){const{id:t}=e,{userFeatureFlip:s}=this.featureFlips.queries;return s({featureFlip:"sharingVault_web_sharingSyncGrapheneMigration_dev"}).pipe((0,F.q)(1),(0,y.w)((e=>!!(0,E.d6)(e)&&!!(0,E.db)(e)?this.executeWithGrapheneState$(t):this.executeWithCarbonState$(t))))}executeWithGrapheneState$(e){return(0,v.D)(this.userGroupsRepo.getUserGroupForId(e)).pipe((0,f.U)((e=>{const t={id:e.groupId,name:e.name,users:e.acceptedUsers??[]};return(0,E.Vp)(t)})))}executeWithCarbonState$(e){return this.carbonLegacyClient.queries.getUserGroup(e).pipe((0,f.U)((e=>{if((0,E.hx)(e))throw new Error("Unable to get carbon user group.");const t=(0,E.db)(e);if(!t)throw new Error("Unable to get carbon user group.");const s={id:t.id,name:t.name,users:t.users.map((e=>e.id))};return(0,E.Vp)(s)})))}constructor(e,t,s){this.carbonLegacyClient=e,this.featureFlips=t,this.userGroupsRepo=s}}k=(0,i.gn)([(0,P.e)(G.e),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===L._?Object:L._,void 0===I.P?Object:I.P,void 0===m.x?Object:m.x])],k);var K=s(14139);class M{}M=(0,i.gn)([(0,r.Y)({api:n.A,providers:[C,_,{provide:m.x,useClass:D}],stores:[g],handlers:{commands:{},events:{},queries:{getAllAcceptedGroups:x,getSharingGroupById:k}},imports:[K.y],exports:[m.x]})],M)},89720:(e,t,s)=>{s.d(t,{x:()=>i});class i{}},21512:(e,t,s)=>{s.d(t,{D:()=>F});var i=s(92336),r=s(86006),n=s(94152),o=s(82874),a=s(76810),c=s(60399),d=s(78346),l=s(39431),u=s(50879),p=s(50520),h=s(57452);class g{async execute(){const e=await(0,c.z)(this.currentSpaceGetter.get());if((0,d.hx)(e))throw new Error("Error fetching current space when moving shared collection items to business space");const t=(0,d.db)(e).teamId;if(!t)return(0,d.Vp)(void 0);const s=(await(0,c.z)(this.sharedItemsRepository.sharedItems$())).reduce(((e,t)=>t.recipientIds.collectionIds?.length?[...e,t.itemId]:e),[]);if(s.length){if((await Promise.all(s.map((e=>this.moveItemToBusinessSpace(e,t))))).some(d.hx))throw new Error("Error when moving shared collection items to business space")}return(0,d.Vp)(void 0)}async moveItemToBusinessSpace(e,t){const{commands:s}=this.vaultItemsCrudClient,i=await(0,c.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[l.U.Credential,l.U.SecureNote],ids:[e]}));if((0,d.hx)(i))return Promise.resolve((0,d.Rn)(void 0));const r=(0,d.db)(i).credentialsResult,n=(0,d.db)(i).secureNotesResult,o=r.matchCount>0,a=n.matchCount>0;if(!o&&!a)return Promise.resolve((0,d.Vp)(void 0));return(o?r.items[0]:n.items[0]).spaceId===t?Promise.resolve((0,d.Vp)(void 0)):s.updateVaultItem({vaultItemType:o?l.U.Credential:l.U.SecureNote,id:e,content:{spaceId:t},shouldSkipSync:!0})}constructor(e,t,s){this.sharedItemsRepository=e,this.vaultItemsCrudClient=t,this.currentSpaceGetter=s}}g=(0,i.gn)([(0,o.W)(a.g),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.z?Object:p.z,void 0===u.L?Object:u.L,void 0===h.n?Object:h.n])],g);var m=s(41842),v=s(87065),y=s(14122),S=s(63696),w=s(13252),E=s(35061),I=s(27790),A=s(1868),f=s(80629);const b=async(e,t=2)=>{const s=[...e];let i=0;for(;s.length;){const e=s.splice(0,t).map((e=>e()));i+=(await Promise.all(e)).length}return i};class C{async execute(e){const{body:{vaultItemIds:t,pendingInvitesIds:s,shouldRunSync:i}}=e;if(!t.length&&!s.length)return i&&this.sharingSync.scheduleSync(),(0,d.Vp)(void 0);const r=s.map((e=>()=>this.refusePendingInvite(e))),n=await b(r),o=await this.getRevokeSharedItemsTasks(t),a=await b(o);return(i||(n>0||a>0))&&this.sharingSync.scheduleSync(),(0,d.Vp)(void 0)}async refusePendingInvite(e){const t=await this.refuseSharedItemService.execute(e);if((0,d.hx)(t))throw new Error("Failure to refuse pending invite for a force categorized item");return(0,d.db)(t)}async getRevokeSharedItemsTasks(e){if(!e.length)return[];const[t,s]=await Promise.all([this.getCurrentUserLogin(),(0,c.z)(this.sharedItemsRepository.sharedItemsForIds$(e))]);return s.map((e=>()=>this.revokeSharedItem(e,t)))}async revokeSharedItem({isLastAdmin:e,revision:t,recipientIds:{userIds:s,collectionIds:i,userGroupIds:r},sharedItemId:n,itemId:o,permission:a},c){const l=s?.filter((e=>e!==c));if(e&&(l||i||r)){const e=await this.commonGateway.revokeItemGroupMembers({itemGroupId:n,revision:t,userLogins:l?.length?l:void 0,collectionIds:i??void 0,userGroupIds:r??void 0});if((0,d.hx)(e))throw new Error("Revoke shared item failed in remote control");return await this.sharingSync.scheduleSync(),(0,d.Vp)(e)}const u=await this.commonGateway.refuseItemGroup({itemGroupId:n,revision:t});return a===w.y3.Admin?this.duplicateVaultItem(o):u}async duplicateVaultItem(e){const{commands:{duplicateVaultItem:t}}=this.carbonClient,s=await t({vaultItemId:e});if((0,d.hx)(s))throw new Error("Failed to duplicate a shared item that is revoked because of forced catgorization");return(0,d.db)(s)}getCurrentUserLogin(){return(0,c.z)(this.sessionClient.queries.selectedOpenedSession().pipe((0,m.h)(d.d6),(0,v.U)(d.db),(0,m.h)((e=>"string"==typeof e&&""!==e))))}constructor(e,t,s,i,r,n){this.sharedItemsRepository=e,this.commonGateway=t,this.carbonClient=s,this.sessionClient=i,this.sharingSync=r,this.refuseSharedItemService=n}}C=(0,i.gn)([(0,o.W)(E.v),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.z?Object:p.z,void 0===I.b_?Object:I.b_,void 0===y._?Object:y._,void 0===S.x?Object:S.x,void 0===f.D?Object:f.D,void 0===A.C?Object:A.C])],C);var O=s(13186),R=s(14139),T=s(46675),_=s(38357),D=s(3966);class F{}F=(0,i.gn)([(0,r.Y)({api:n.X,handlers:{commands:{remoteControlSharedItems:C,moveCollectionItemsToBusinessSpace:g},events:{},queries:{}},domainName:"sharing",imports:[O.I,R.y,T.a,_.F,D.p]})],F)},2406:(e,t,s)=>{s.d(t,{P:()=>fe});var i=s(92336),r=s(60399),n=s(82874),o=s(53344),a=s(78346),c=s(76763),d=s(13252),l=s(7303),u=s(92587),p=s(89720);const h=(e,t)=>e.reduce(((e,s)=>{const i=t[s.id];return i?i.revision<s.revision?e.updatedIds.push(s.id):e.unchanged.push(i):e.newIds.push(s.id),e}),{newIds:(0,l.Ay)([]),updatedIds:(0,l.Ay)([]),unchanged:(0,l.Ay)([])});var g=s(66717),m=s(96500),v=s(69956);var y=s(90936),S=s(7533);class w{async isUserGroupValid(e,t){const{publicKey:s,login:i}=t,r=e.users.find((e=>e.userId===i));if(!r?.groupKey?.length)return!1;if(r.status===d.qb.Pending)return r;if(r.status!==d.qb.Accepted)return!1;if(!r.acceptSignature)return!1;const n=await this.sharingCryptoUtility.decryptResourceKeyViaUserMember({encryptedResourceKey:r.groupKey},t);return!!n&&this.sharingCryptoElements.verifyAcceptSignature(s,r.acceptSignature,e.groupId,n)}async isSharedItemValid(e,t){return this.isSharedItemAccessValid(e.sharedItemId,e.accessLink,t)}async isSharedItemAccessValid(e,t,s){const{publicKey:i}=s;if(!t?.acceptSignature)return{isValid:!1};const{acceptSignature:r}=t,n=await this.sharingCryptoUtility.decryptItemGroupKeyFromAccessLink(t,s);if(!n)return{isValid:!1};const o=await this.sharingCryptoElements.verifyAcceptSignature((e=>{switch(e.accessType){case d.Uv.UserGroup:return e.groupPublicKey;case d.Uv.CollectionUserGroup:case d.Uv.CollectionUser:return e.collectionPublicKey}})(t)??i,r,e,n);return o?{isValid:!0,itemGroupKey:n}:{isValid:!1}}constructor(e,t){this.sharingCryptoUtility=e,this.sharingCryptoElements=t}}w=(0,i.gn)([(0,u.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===y.Z?Object:y.Z,void 0===S.M?Object:S.M])],w);class E{async getUserGroupChangesFromSummary(e){const t=await this.userGroupsRepo.getUserGroups(),{newIds:s,updatedIds:i,unchanged:r}=h(e,t);return{newUserGroupIds:s,updateUserGroupIds:i,unchangedUserGroups:r,isUserGroupsSyncNeeded:i.length||Object.keys(t).length!==e.length}}async syncUserGroups(e,t,s){const{validatedUserGroups:i,pendingInvites:r}=await e.reduce((async(e,t)=>{if("users"!==t.type)return e;const i=await this.validationService.isUserGroupValid(t,s),r=await e;if(i&&r.validatedUserGroups.push(t),"boolean"!=typeof i){const{referrer:e,permission:s}=i;r.pendingInvites.push({referrer:e,permission:s,id:t.groupId,name:t.name})}return e}),Promise.resolve({validatedUserGroups:(0,l.Ay)([]),pendingInvites:(0,l.Ay)([])}));this.userGroupsRepo.setUserGroups(t.concat(i.map((e=>this.mapToUserGroupStateModel(e,s.login)))));const n=t.map((e=>e.groupId)),o=(await this.pendingInvitesService.getUserGroupInvites()).filter((e=>n.includes(e.id))).concat(r);this.pendingInvitesService.setUserGroupInvites(o)}mapToUserGroupStateModel(e,t){const{groupId:s,name:i,revision:r,users:n,privateKey:o,publicKey:a}=e,c=[],l=[];let u="";return n.forEach((e=>{e.status===d.qb.Accepted&&c.push(e.userId),e.userId===t&&(u=e.groupKey??""),l.push(e.userId)})),{groupId:s,name:i,revision:r,acceptedUsers:c,publicKey:a,privateKey:o,groupKey:u,allUsers:l,users:[]}}constructor(e,t,s){this.userGroupsRepo=e,this.validationService=t,this.pendingInvitesService=s}}E=(0,i.gn)([(0,u.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.x?Object:p.x,void 0===w?Object:w,void 0===g.M?Object:g.M])],E);var I=s(5482),A=s(21003),f=s(91969),b=s(78262);class C{async getCollectionsChangesFromSummary(e){const t=await this.collectionsRepo.getCollections(),{newIds:s,updatedIds:i,unchanged:r}=h(e,t);return{newCollectionIds:s,updatedCollectionIds:i,unchangedCollections:r,isCollectionsSyncNeeded:i.length||Object.keys(t).length!==e.length}}async syncCollections(e,t,s){const i=Object.values(await this.userGroupsRepo.getUserGroups()),{validatedCollections:r,pendingInvites:n,validatedSharedCollectionAccess:o}=await e.reduce((async(e,t)=>{const r=(0,A.E)(t,i,s.login),n=t.users?.find((e=>e.login===s.login&&e.status===d.qb.Pending)),o=n||await this.isCollectionValid(r,s),a=await e;if(o&&(a.validatedCollections.push(r),a.validatedSharedCollectionAccess[r.id]=(0,f.c)(t)),n){const{referrer:e,permission:t}=n;a.pendingInvites.push({referrer:e,permission:t,id:r.id,name:r.name})}return e}),Promise.resolve({validatedCollections:(0,l.Ay)([]),pendingInvites:(0,l.Ay)([]),validatedSharedCollectionAccess:(0,l.Ay)({})}));this.collectionsRepo.setCollections(t.concat(r),o);const a=t.map((e=>e.id)),c=(await this.pendingInvitesService.getCollectionsInvites()).filter((e=>a.includes(e.id))).concat(n);this.pendingInvitesService.setCollectionInvites(c)}async isCollectionValid(e,t){const{publicKey:s}=t;if(!e.accessLink?.acceptSignature)return!1;const{acceptSignature:i}=e.accessLink,r=await this.sharingCryptoUtility.decryptSharedCollectionKey(e,t);return!!r&&this.sharingCryptoElements.verifyAcceptSignature(e.accessLink.accessType===b.o.UserGroup?e.accessLink.groupPublicKey??s:s,i,e.id,r)}constructor(e,t,s,i,r){this.collectionsRepo=e,this.userGroupsRepo=t,this.sharingCryptoElements=s,this.sharingCryptoUtility=i,this.pendingInvitesService=r}}C=(0,i.gn)([(0,u.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===I.U?Object:I.U,void 0===p.x?Object:p.x,void 0===S.M?Object:S.M,void 0===y.Z?Object:y.Z,void 0===g.M?Object:g.M])],C);var O=s(68327),R=s(54691),T=s(50520),_=s(39431),D=s(50879),F=s(14122);class P{async runVaultUpdates(e,t){const s=await Promise.all(e.map((async e=>{const s=t[e.itemId];if(!s)return null;const i=await this.decryptItemContent(s,e.content);return{vaultItemId:e.itemId,id:s.sharedItemId,revision:e.timestamp,itemToSave:i}}))),{itemRevisions:i,itemsToSave:r}=s.reduce(((e,t)=>{if(t){t.itemToSave&&e.itemsToSave.push(t.itemToSave);const{id:s,vaultItemId:i,revision:r}=t;e.itemRevisions.push({sharedItemId:s,vaultItemId:i,revision:r,savedToVault:!0})}return e}),{itemRevisions:(0,l.Ay)([]),itemsToSave:(0,l.Ay)([])}),n=await this.carbonLegacyClient.commands.saveSharedItemsToVault({items:r});return(0,a.hx)(n)?null:i}decryptItemContent(e,t){return this.sharingCrypto.decryptSharedItemContent(e,t)}async getVaultItemsPerType(e){const t=await(0,r.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[_.U.Credential,_.U.Secret,_.U.SecureNote],ids:e}));if((0,a.hx)(t))throw new Error("Could not access the vault items to run sharing sync");return(0,a.db)(t)}async deleteVaultItems(e){const t=await this.getVaultItemsPerType(e);t.credentialsResult.matchCount&&this.vaultItemsCrudClient.commands.deleteVaultItems({vaultItemType:_.U.Credential,ids:t.credentialsResult.items.map((e=>e.id))}).catch(),t.secureNotesResult.matchCount&&this.vaultItemsCrudClient.commands.deleteVaultItems({vaultItemType:_.U.SecureNote,ids:t.secureNotesResult.items.map((e=>e.id))}).catch(),t.secretsResult.matchCount&&this.vaultItemsCrudClient.commands.deleteVaultItems({vaultItemType:_.U.Secret,ids:t.secretsResult.items.map((e=>e.id))}).catch()}constructor(e,t,s){this.sharingCrypto=e,this.vaultItemsCrudClient=t,this.carbonLegacyClient=s}}P=(0,i.gn)([(0,u.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===y.Z?Object:y.Z,void 0===D.L?Object:D.L,void 0===F._?Object:F._])],P);var U=s(92936);const N=(e,t)=>{const s=((e,t)=>{const s={permission:d.y3.Limited};if(!e)return s;for(const i of e)if(i.status===d.qb.Accepted&&i.itemGroupKey){if(i.permission===d.y3.Admin&&(s.permission=d.y3.Admin),!s.collection||s.collection.accessLink?.accessType!==b.o.User){const e=t.find((e=>e.id===i.uuid&&e.accessLink));e&&(s.collection=e,s.member=i)}if(s.permission===d.y3.Admin&&s.collection?.accessLink?.accessType===b.o.User)break}return s})(e.collections,t);if(s.collection&&s.member){const{collection:e,member:t}=s,{permission:i,acceptSignature:r,proposeSignature:n,itemGroupKey:o}=t;if(o)if(e.accessLink?.accessType===b.o.User){const{encryptedResourceKey:t}=e.accessLink;if(t){return{link:{permission:i,acceptSignature:r,proposeSignature:n,encryptedResourceKey:o,collectionEncryptedKey:t,collectionPrivateKey:e.privateKey,collectionPublicKey:e.publicKey,accessType:d.Uv.CollectionUser},permission:s.permission}}}else if(e.accessLink?.accessType===b.o.UserGroup){const{encryptedResourceKey:t,groupPublicKey:a,groupPrivateKey:c,groupEncryptedKey:l}=e.accessLink;if(t){return{link:{permission:i,acceptSignature:r,proposeSignature:n,encryptedResourceKey:o,collectionEncryptedKey:t,collectionPrivateKey:e.privateKey,collectionPublicKey:e.publicKey,groupEncryptedKey:l,groupPublicKey:a,groupPrivateKey:c,accessType:d.Uv.CollectionUserGroup},permission:s.permission}}}}return null},L=(...e)=>e.find((e=>e?.link))??e[0],x=({permission:e,status:t})=>e===d.y3.Admin&&t===d.qb.Accepted,G=(e,t,s,i)=>{const r=((e,t)=>{const s=e.users?.filter((e=>e.userId===t&&(e.status===d.qb.Accepted||e.status===d.qb.Pending)&&e.groupKey)),i=e.users?.some((({userId:e,permission:s,rsaStatus:i,status:r})=>e!==t&&s===d.y3.Admin&&"sharingKeys"===i&&r===d.qb.Accepted))??!1;if(s?.length){const e=s[0];if(e.groupKey){const{permission:t,acceptSignature:r,proposeSignature:n}=e;return{link:{permission:t,acceptSignature:r,proposeSignature:n,encryptedResourceKey:e.groupKey,accessType:d.Uv.User},permission:(0,U.u)(s),otherAdminsFound:i}}}return{permission:d.y3.Limited,otherAdminsFound:i}})(e,t),n=Boolean(r?.otherAdminsFound)||Boolean(e.groups?.some(x))||Boolean(e.collections?.some(x));if(null!==r&&r.permission===d.y3.Admin)return{...r,otherAdminsFound:n};const o=((e,t)=>{const s=e.groups?.filter((e=>t.some((t=>t.groupId===e.groupId))&&e.status===d.qb.Accepted&&e.groupKey));if(s?.length){const e=s[0],i=(0,U.u)(s);if(e.groupKey){const{permission:s,acceptSignature:r,proposeSignature:n}=e,o=t.find((t=>t.groupId===e.groupId));if(o?.groupKey)return{link:{permission:s,acceptSignature:r,proposeSignature:n,encryptedResourceKey:e.groupKey,groupEncryptedKey:o.groupKey,groupPrivateKey:o.privateKey,groupPublicKey:o.publicKey,accessType:d.Uv.UserGroup},permission:i}}}return null})(e,s);if(null!==o&&o.permission===d.y3.Admin)return{...L(r,o),permission:d.y3.Admin,otherAdminsFound:n};const a=N(e,i);return{...L(r,o,a),permission:(0,U.u)([r,o,a]),otherAdminsFound:n}};var k=s(11047);const K=(e,t)=>e.reduce(((e,s)=>(e[t(s)]=s,e)),(0,l.Ay)({}));var M=s(27790),j=s(6554);const V={moduleName:"SharingSyncModule",useCaseName:"sharing-sync-resend-invites.service",applicationComponent:"Sharing"};class W{async checkPublicKeysAndResendInvites(e,t,s){if(!t.accessLink)return;const i=(e.users||[]).filter((e=>"publicKey"===e.rsaStatus&&!0===e.proposeSignatureUsingAlias)).map((e=>this.resendPublicKeyInvite(e,t,s)));await Promise.all(i)}async resendPublicKeyInvite(e,t,s){try{if(!e.proposeSignature)return void this.reportWarning("Missing propose signature when re-sending invite",JSON.stringify({itemGroupId:t.sharedItemId}));if(!await this.sharingCrypto.verifyProposeSignature(s,e.userId,e.proposeSignature))return void this.reportWarning("Invalid propose signature when re-sending invite",JSON.stringify({itemGroupId:t.sharedItemId}));const i=await this.sharingUsersService.createSignedUserInvites([{login:e.userId,permission:e.permission}],{resourceKey:s,uuid:t.sharedItemId},!1);i.length||this.reportWarning("Cannot create invite to re-sending invite",JSON.stringify({itemGroupId:t.sharedItemId})),await this.sharingCommonGateway.updateItemGroupMembers({revision:t.revision,groupId:t.sharedItemId,users:[{userId:e.userId,groupKey:i[0].resourceKey,proposeSignature:i[0].proposeSignature}]})}catch(e){this.reportError("Error when trying to resend an invite",{itemGroupId:t.sharedItemId,error:e})}}reportError(e,t){this.exceptionLoggingClient.commands.reportAnomaly({...V,criticality:O.h_.CRITICAL,message:e,anomalyType:"exception",origin:"uncaughtException",additionalInfo:JSON.stringify(t)})}reportWarning(e,t){this.exceptionLoggingClient.commands.reportAnomaly({...V,criticality:O.h_.WARNING,message:e,anomalyType:"other",additionalInfo:JSON.stringify(t)})}constructor(e,t,s,i){this.sharingCrypto=e,this.sharingUsersService=t,this.sharingCommonGateway=s,this.exceptionLoggingClient=i}}W=(0,i.gn)([(0,u.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S.M?Object:S.M,void 0===j.E?Object:j.E,void 0===M.b_?Object:M.b_,void 0===R.G?Object:R.G])],W);class B{async resolvePendingInvites(e,t,s,i){const r=K(e,(e=>e.itemId)),n=(await this.pendingInvitesService.getSharedItemsInvites()).filter((e=>t.some((t=>t.sharedItemId===e.sharedItemId&&!t.accessLink?.acceptSignature)))),o=K(n,(e=>e.sharedItemId)),a=await s.reduce((async(e,t)=>{const s=await this.resolvePendingInvite(t,r,i,o);return s&&(await e).push(s),e}),Promise.resolve((0,l.Ay)([])));return this.pendingInvitesService.setSharedItemInvites(a),a}async resolvePendingInvite(e,t,s,i){const r=s[e.sharedItemId],n=i[e.sharedItemId];if(r||n){const s=r??{permission:n.permission,referrer:n.referrer,sharedItemId:e.sharedItemId,vaultItemId:e.itemId},i=await this.decryptItemContentAndConvertToInvite(t,e,s);if(i)return i}if(n)return n}async decryptItemContentAndConvertToInvite(e,t,s){const i=e[t.itemId];if(i){const e=await this.vaultUpdatesService.decryptItemContent(t,i.content);if(e)return((e,t,s,i)=>{const r={vaultItemId:e.itemId,title:t.Title,spaceId:t.SpaceId,referrer:s.referrer,sharedItemId:e.sharedItemId,permission:s.permission,revision:i};return(0,m.G)(t)?{...r,itemType:d.y2.Credential,url:t.Url,linkedDomains:t.LinkedServices?.associated_domains.map((e=>e.domain)),email:t.Email,login:t.Login,secondaryLogin:t.SecondaryLogin}:(0,v.g)(t)?{...r,itemType:d.y2.SecureNote,color:t.Type,secured:t.Secured}:{...r,itemType:d.y2.Secret,secured:t.Secured}})(t,e,s,i.timestamp)}}constructor(e,t){this.vaultUpdatesService=e,this.pendingInvitesService=t}}B=(0,i.gn)([(0,u.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===P?Object:P,void 0===g.M?Object:g.M])],B);var z=s(86342),q=s(77802);class H{async deleteLastAdminSharedItem(e){let t,s;const i=await this.vaultUpdatesService.getVaultItemsPerType([e.itemId]);if(i.credentialsResult.matchCount){t=_.U.Credential;const{id:e,...r}=i.credentialsResult.items[0];s=r}else if(i.secureNotesResult.matchCount){t=_.U.SecureNote;const{id:e,...r}=i.secureNotesResult.items[0];s=r}else{if(!i.secretsResult.matchCount)return;{t=_.U.Secret;const{id:e,...r}=i.secretsResult.items[0];s=r}}const n=await this.vaultItemsCrudClient.commands.createVaultItem({vaultItemType:t,content:s,shouldSkipSync:!1});if(!(0,a.d6)(n))return;const o=await this.sharingCommonGateway.deleteItemGroup({groupId:e.sharedItemId,revision:e.revision});if(!(0,a.d6)(o))return this.exceptionLoggingClient.commands.reportAnomaly({criticality:O.h_.CRITICAL,message:"Error when trying to delete an item group during the unshare item process",moduleName:"SharingSyncModule",useCaseName:"sharing-sync-last-admin.service",applicationComponent:"Sharing",anomalyType:"exception",origin:"uncaughtException"}),void await this.vaultItemsCrudClient.commands.deleteVaultItem({id:n.data.id,vaultItemType:t});const c=await(0,r.z)(this.vaultOrganizationClient.queries.queryCollections({}));if(await this.vaultItemsCrudClient.commands.deleteVaultItem({id:e.itemId,vaultItemType:t,ignoreSharing:!0}),(0,a.d6)(c)&&c.data.collections.length>0){const t=c.data.collections.filter((t=>t.vaultItems.some((t=>t.id===e.itemId)))),s={vaultItems:[{id:e.itemId,type:_.U.Credential}]},i={vaultItems:[{id:n.data.id,type:_.U.Credential}]};for(const e of t)await this.vaultOrganizationClient.commands.updateCollection({id:e.id,collection:s,operationType:z.C.SUBSTRACT_VAULT_ITEMS}),await this.vaultOrganizationClient.commands.updateCollection({id:e.id,collection:i,operationType:z.C.APPEND_VAULT_ITEMS})}}constructor(e,t,s,i,r){this.vaultUpdatesService=e,this.sharingCommonGateway=t,this.vaultItemsCrudClient=s,this.vaultOrganizationClient=i,this.exceptionLoggingClient=r}}H=(0,i.gn)([(0,u.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===P?Object:P,void 0===M.b_?Object:M.b_,void 0===D.L?Object:D.L,void 0===q.C?Object:q.C,void 0===R.G?Object:R.G])],H);class Y{async getItemsChangesFromSummary(e,t){const s=await this.sharedItemsRepo.getVaultItemsIndex(),{newItemsIds:i,updatedItemsIds:r,unchangedItems:n}=e.reduce(((e,i)=>{const r=s[i.id];return r?r.revision<i.timestamp||!r.savedToVault&&t.includes(r.sharedItemId)?e.updatedItemsIds.push(i.id):e.unchangedItems.push(r):e.newItemsIds.push(i.id),e}),{newItemsIds:(0,l.Ay)([]),updatedItemsIds:(0,l.Ay)([]),unchangedItems:(0,l.Ay)([])}),o=Object.values(s).filter((t=>!e.find((e=>e.id===t.vaultItemId)))).map((e=>e.vaultItemId));return{newItemsIds:i,updatedItemsIds:r,unchangedItems:n,revokedIds:o,isItemsSyncNeeded:r.length||o.length}}async getSharedItemsChangesFromSummary(e){const t=await this.sharedItemsRepo.getSharedItemsIndex(),{newIds:s,updatedIds:i,unchanged:r}=h(e,t);return{newItemGroupIds:s,updatedItemGroupIds:i,unchangedItemGroups:r,isSharedItemsSyncNeeded:i.length||Object.keys(t).length!==e.length}}async syncSharedItems(e,t,s,i,r){const n=Object.values(await this.userGroupsRepo.getUserGroups()),o=Object.values(await this.collectionsRepo.getCollections()),{validatedSharedItems:a,pendingInvitesWithoutContent:c,validatedSharedAccess:u,sharedItemsToDelete:p}=await e.reduce((async(e,t)=>{if("items"!==t.type)return e;const s=t.groupId,i=await e,a=await this.syncSharedItem(t,n,o,r);if(a){const{sharedItem:e,sharedAccess:n,pendingInvite:o}=a;if(((e,t)=>{const s=e.collections;if(s&&s.length>0)return!1;const{users:i,groups:r}=e,n=!r||0===r.filter((e=>e.status===d.qb.Accepted||e.status===d.qb.Pending)).length,o=i&&1===i.filter((e=>e.status===d.qb.Accepted||e.status===d.qb.Pending)).length&&i[0].userId===t&&i[0].status===d.qb.Accepted&&i[0].permission===d.y3.Admin;return n&&!!o})(t,r.login))try{await this.sharingSyncLastAdmin.deleteLastAdminSharedItem(e),i.sharedItemsToDelete.push(e.sharedItemId)}catch(e){this.exceptionLoggingClient.commands.reportAnomaly({criticality:O.h_.CRITICAL,message:"Error when trying to unshare an item",moduleName:"SharingSyncModule",useCaseName:"sharing-sync-items.service",applicationComponent:"Sharing",anomalyType:"exception",origin:"uncaughtException"})}else i.validatedSharedItems.push(e),i.validatedSharedAccess[t.groupId]=n,o&&(i.pendingInvitesWithoutContent[s]=o)}return e}),Promise.resolve({validatedSharedItems:(0,l.Ay)([]),pendingInvitesWithoutContent:(0,l.Ay)({}),validatedSharedAccess:(0,l.Ay)({}),sharedItemsToDelete:(0,l.Ay)([])})),h=t.concat(a),g=K(h.filter((e=>e.accessLink?.acceptSignature)),(e=>e.itemId));let m=i,v=null;s.length&&(v=await this.vaultUpdatesService.runVaultUpdates(s,g),v?.length&&(m=m.concat(v)));const y=await this.pendingInvitesService.resolvePendingInvites(s,t,h,c),S=K(m,(e=>e.vaultItemId)),w=K(y,(e=>e.sharedItemId)),E=h.reduce(((e,t)=>{if(p.includes(t.sharedItemId))return e;const s=S[t.itemId];if(s){const{revision:i,savedToVault:r}=s;e.push({sharedItem:t,revision:i,savedToVault:r})}else{const s=w[t.sharedItemId];if(s){const{revision:i}=s;e.push({sharedItem:t,revision:i,savedToVault:!1})}}return e}),(0,l.Ay)([]));this.sharedItemsRepo.setSharedItems(E,u)}async deleteItems(e){const t=await this.sharedItemsRepo.getSharedItemsIndex(),s=Object.values(t).filter((e=>!e.accessLink?.acceptSignature)).map((e=>e.itemId)).concat(e);s.length&&this.vaultUpdatesService.deleteVaultItems(s).catch()}async syncSharedItem(e,t,s,i){const r=((e,t,s,i)=>{const r=G(e,i,t,s),{items:n,revision:o,groupId:a,groups:c,collections:l,users:u}=e,p=n?.[0];if(!p)throw new Error("No items associated with item group");const{itemId:h,itemKey:g}=p,m=r?.permission===d.y3.Admin&&!r.otherAdminsFound;return{permission:r?.permission??d.y3.Limited,accessLink:r?.link,itemId:h,itemKey:g,sharedItemId:a,revision:o,isLastAdmin:m,recipientIds:{userIds:u?.map((({userId:e})=>e))??null,collectionIds:l?.map((({uuid:e})=>e))??null,userGroupIds:c?.map((({groupId:e})=>e))??null}}})(e,t,s,i.login),n=await this.validationService.isSharedItemValid(r,i);n.isValid&&this.sharingSyncResendInvites.checkPublicKeysAndResendInvites(e,r,n.itemGroupKey);const o=e.users?.find((e=>e.userId===i.login&&e.status===d.qb.Pending));if(n.isValid||o){if(o){const{referrer:t,permission:s}=o,{sharedItemId:i,itemId:n}=r;return{sharedItem:r,sharedAccess:(0,k.K4)(e),pendingInvite:{referrer:t,permission:s,sharedItemId:i,vaultItemId:n}}}return{sharedItem:r,sharedAccess:(0,k.K4)(e)}}}constructor(e,t,s,i,r,n,o,a,c){this.sharedItemsRepo=e,this.userGroupsRepo=t,this.collectionsRepo=s,this.vaultUpdatesService=i,this.validationService=r,this.pendingInvitesService=n,this.sharingSyncResendInvites=o,this.sharingSyncLastAdmin=a,this.exceptionLoggingClient=c}}Y=(0,i.gn)([(0,u.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===T.z?Object:T.z,void 0===p.x?Object:p.x,void 0===I.U?Object:I.U,void 0===P?Object:P,void 0===w?Object:w,void 0===B?Object:B,void 0===W?Object:W,void 0===H?Object:H,void 0===R.G?Object:R.G])],Y);var Q=s(10705),$=s(63144),X=s(56618),Z=s(62149),J=s(60018),ee=s(15292);const te=e=>ee.m.safeParse(e).success;class se extends((0,$.Q)({persist:!0,storage:{initialValue:{},typeGuard:te,schemaVersion:1},scope:Z.F.User,storeName:"team-admin-data-store",storeTypeGuard:te,codec:J.E,isCache:!0,capacity:X.Y.Unlimited})){}const ie=(e,t)=>{const{groupId:s,name:i,revision:r,users:n,privateKey:o,publicKey:a}=e;return{groupId:s,name:i,revision:r,publicKey:a,privateKey:o,groupKey:n.find((e=>e.userId===t))?.groupKey??void 0,users:[]}};class re{async getTeamAdminSharingDataSummary(e,t,s){const{specialItemGroup:i,specialItems:r,specialUserGroup:n}=await this.store.getState();if(!n)return;const o=e.find((({revision:e,id:t})=>n.groupId===t&&n.revision===e)),a=i?t.find((({revision:e,id:t})=>i.groupId===t&&i.revision===e)):void 0,c=r?s.filter((({id:e,timestamp:t})=>{const s=r[e];return s?.timestamp===t})):void 0;return{itemGroupId:a?.id,userGroupId:o?.id,itemIds:c?.map((({id:e})=>e))}}async syncTeamAdminSharingData(e,t,s,i,r){const n=await this.store.getState(),o={specialUserGroup:e?.userGroupId?n.specialUserGroup:void 0,specialItemGroup:e?.itemGroupId?n.specialItemGroup:void 0,specialItems:e?.itemIds?.reduce(((e,t)=>{const s=n.specialItems?.[t];return s&&(e[t]=s),e}),(0,l.Ay)({}))},a=t?.find((e=>"teamAdmins"===e.type));if(a){if(!await this.validationService.isUserGroupValid(a,r))return void this.store.set({});o.specialUserGroup=a}const c=s?.find((e=>"userGroupKeys"===e.type));if(c&&o.specialUserGroup){const e=G(c,r.login,[ie(o.specialUserGroup,r.login)],[]);if(!(await this.validationService.isSharedItemAccessValid(c.groupId,e?.link,r)).isValid)return void this.store.set({});o.specialItemGroup=c}o.specialItemGroup?.items&&i?.forEach((e=>{const t=o.specialItemGroup?.items?.find((t=>t.itemId===e.itemId));t&&(o.specialItems||(o.specialItems={}),o.specialItems[e.itemId]=e)})),(0,Q.Z)(o,n)||this.store.set(o)}constructor(e,t){this.store=e,this.validationService=t}}re=(0,i.gn)([(0,u.GS)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===se?Object:se,void 0===w?Object:w])],re);var ne=s(35635);class oe{async execute({body:e}){const{summary:t}=e,{collections:s,userGroups:i,itemGroups:r,items:n}=t,o=await this.currentUserGetter.getCurrentUserWithKeys(),{newUserGroupIds:c,updateUserGroupIds:d,unchangedUserGroups:l,isUserGroupsSyncNeeded:u}=await this.userGroupsService.getUserGroupChangesFromSummary(i),{newCollectionIds:p,updatedCollectionIds:h,unchangedCollections:g,isCollectionsSyncNeeded:m}=await this.collectionsService.getCollectionsChangesFromSummary(s),{newItemGroupIds:v,updatedItemGroupIds:y,unchangedItemGroups:S,isSharedItemsSyncNeeded:w}=await this.itemsService.getSharedItemsChangesFromSummary(r),{newItemsIds:E,updatedItemsIds:I,unchangedItems:A,revokedIds:f,isItemsSyncNeeded:b}=await this.itemsService.getItemsChangesFromSummary(n,y),C=await this.teamAdminSharingDataService.getTeamAdminSharingDataSummary(i,r,n);let O=c.concat(d),R=v.concat(y),T=E.concat(I);if(C){const{itemGroupId:e,itemIds:t,userGroupId:s}=C;e&&(R=R.filter((t=>t!==e))),s&&(O=O.filter((e=>e!==s))),t?.length&&(T=T.filter((e=>!t.includes(e))))}const _=p.concat(h),{updatedUserGroups:D,updatedCollectionDownloads:F,updatedItemGroups:P,updatedItems:U}=await this.getSharingDetails({userGroupIds:O,collectionIds:_,itemGroupIds:R,itemIds:T});return u&&await this.userGroupsService.syncUserGroups(D,l,o),m&&await this.collectionsService.syncCollections(F,g,o),(w||b)&&await this.itemsService.syncSharedItems(P,S,U,A,o),await this.teamAdminSharingDataService.syncTeamAdminSharingData(C,D,P,U,o),await this.itemsService.deleteItems(f),(0,a.Vp)(void 0)}async getSharingDetails({userGroupIds:e,itemGroupIds:t,itemIds:s,collectionIds:i}){if(e.length||t.length||s.length||i.length){const n=await(0,r.z)(this.serverApiClient.v1.sharingUserdevice.postSharingUserdevice({collectionIds:i,userGroupIds:e,itemGroupIds:t,itemIds:s}));if((0,a.hx)(n))throw new Error("Error getting sharing updates");const{data:o}=(0,a.db)(n),{userGroups:c,collections:d,itemGroups:l,items:u}=o;return{updatedUserGroups:c??[],updatedCollectionDownloads:d??[],updatedItemGroups:l??[],updatedItems:u??[]}}return{updatedUserGroups:[],updatedCollectionDownloads:[],updatedItemGroups:[],updatedItems:[]}}constructor(e,t,s,i,r,n){this.serverApiClient=e,this.currentUserGetter=t,this.itemsService=s,this.userGroupsService=i,this.collectionsService=r,this.teamAdminSharingDataService=n}}oe=(0,i.gn)([(0,n.W)(c.N),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.l?Object:o.l,void 0===ne.a?Object:ne.a,void 0===Y?Object:Y,void 0===E?Object:E,void 0===C?Object:C,void 0===re?Object:re])],oe);var ae=s(86006),ce=s(85045),de=s(41511),le=s(29390),ue=s(6489),pe=s(87065),he=s(46449);class ge{execute(){return this.store.state$.pipe((0,pe.U)((e=>(0,a.Vp)(e))))}constructor(e){this.store=e}}ge=(0,i.gn)([(0,he.e)(ee.k),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===se?Object:se])],ge);class me extends((0,ce.AJ)()){}var ve=s(3966),ye=s(14139),Se=s(75028),we=s(85378),Ee=s(46675),Ie=s(38357),Ae=s(13186);class fe{}fe=(0,i.gn)([(0,ae.Y)({api:le.k,providers:[P,Y,C,E,B,W,H,re,w,(0,ce.ND)(me)],stores:[se],handlers:{commands:{runSharingSync:oe},events:{},queries:{getTeamAdminSharingData:ge}},imports:[de.n,ye.y,Se.k,we.u,Ee.a,Ie.F,ve.p,Ae.I],requiredFeatureFlips:[ue.d.SharingSyncGrapheneMigrationDev]})],fe)},92324:(e,t,s)=>{s.d(t,{Q:()=>l,w:()=>d});var i=s(79533),r=s(59503),n=s(60605),o=s(70273),a=s(44647),c=s(46470);const d=e=>{const t=(0,i.N)(e),s=(0,r.u)(t);return(0,n.n)(s)},l=e=>{const t=(0,o.L)(e),s=(0,a.v)(t);return(0,c.e)(s)}},50436:(e,t,s)=>{s.d(t,{R:()=>r});var i=s(78776);const r=()=>`{${(0,i.Z)().toUpperCase()}}`},92936:(e,t,s)=>{s.d(t,{u:()=>n});var i=s(13252);const r=(e,t)=>t?.permission===i.y3.Admin?t.permission:e,n=e=>e.reduce(r,i.y3.Limited)},98798:(e,t,s)=>{s.d(t,{B5:()=>o,HU:()=>n,l7:()=>r});var i=s(13252);function r(e){switch(e?.kwType){case"KWAuthentifiant":return"AUTHENTIFIANT";case"KWSecureNote":return"SECURENOTE";default:return"SECRET"}}function n(e){switch(e){case i.y2.Credential:return"AUTHENTIFIANT";case i.y2.SecureNote:return"SECURENOTE";default:return"SECRET"}}function o(e){switch(e){case"AUTHENTIFIANT":return"password";case"SECURENOTE":return"note";default:return"secret"}}},78262:(e,t,s)=>{s.d(t,{o:()=>i});var i=function(e){return e.User="user",e.UserGroup="group",e}({})},21003:(e,t,s)=>{s.d(t,{E:()=>c});var i=s(13252),r=s(92936),n=s(78262);const o=({permission:e,status:t})=>e===i.y3.Admin&&t===i.qb.Accepted,a=(e,t,s)=>{const a=((e,t)=>{const s=e.users?.some((({login:e,permission:s,rsaStatus:r,status:n})=>e!==t&&s===i.y3.Admin&&"sharingKeys"===r&&n===i.qb.Accepted))??!1,r=e.users?.some((e=>e.login===t&&e.status===i.qb.Accepted&&e.collectionKey))??!1,o=e.users?.find((e=>e.login===t&&(e.status===i.qb.Accepted||e.status===i.qb.Pending)&&e.collectionKey));if(o&&o.collectionKey){const{permission:e,acceptSignature:t,proposeSignature:i}=o;return{link:{permission:e,acceptSignature:t,proposeSignature:i,encryptedResourceKey:o.collectionKey,accessType:n.o.User},permission:o.permission,isAccepted:r,otherAdminsFound:s}}return{permission:i.y3.Limited,isAccepted:!1,otherAdminsFound:s}})(e,t),c=Boolean(a?.otherAdminsFound)||Boolean(e.userGroups?.some(o))||Boolean(e.users?.some(o));if(null!==a&&a.permission===i.y3.Admin)return{...a,otherAdminsFound:c};const d=((e,t)=>{const s=e.userGroups?.filter((e=>t.some((t=>t.groupId===e.uuid))&&e.status===i.qb.Accepted&&e.collectionKey));if(s?.length){const e=s[0],i=(0,r.u)(s);if(e.collectionKey){const{permission:s,acceptSignature:r,proposeSignature:o}=e,a=t.find((t=>t.groupId===e.uuid));if(a?.groupKey)return{link:{permission:s,acceptSignature:r,proposeSignature:o,encryptedResourceKey:e.collectionKey,groupEncryptedKey:a.groupKey,groupPrivateKey:a.privateKey,groupPublicKey:a.publicKey,accessType:n.o.UserGroup},permission:i,isAccepted:!0}}}return null})(e,s.filter((e=>e.groupKey&&e.acceptedUsers?.some((e=>e===t))))),l=d?.permission===i.y3.Admin||a?.permission===i.y3.Admin?i.y3.Admin:i.y3.Limited,u=Boolean(a?.isAccepted||d?.isAccepted);return{...a?.link?a:d,permission:l,otherAdminsFound:c,isAccepted:u}},c=(e,t,s)=>{const{link:r,permission:n,otherAdminsFound:o,isAccepted:c}=a(e,s,t),d=n===i.y3.Admin&&!o,{name:l,privateKey:u,publicKey:p,revision:h,uuid:g}=e;return{id:g,name:l,privateKey:u,publicKey:p,revision:h,accessLink:r,isLastAdmin:d,isAccepted:c,permission:n}}}}]);