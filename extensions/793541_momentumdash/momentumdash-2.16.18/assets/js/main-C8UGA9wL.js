const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/FocusModeHoverDropdown-CP28OJMF.js","assets/js/BaseDropdownContent-BkIWXp6C.js","assets/js/constants-CALDQiUE.js","assets/js/icon-alert-mvI7iJMO.js","assets/js/localStorage-C5mLf9Kt.js","assets/js/preload-helper-DmNsytk6.js","assets/js/string-VUUyAM1F.js","assets/js/index-B0SY0IAS.js","assets/css/BaseDropdownContent-BzU7S1Vc.css","assets/js/BaseIcon-05QItZKz.js","assets/js/arrow-Be8MuPJi.js","assets/js/icon-weather-reset-C06kxk3l.js","assets/js/icon-settings-Bycjf8-G.js","assets/js/icon-back-arrow-CiRQJ6G-.js","assets/js/icon-back-D_TFrgyJ.js","assets/js/icon-trash-BQ1O-AfY.js","assets/js/icon-close-BUGl_M7j.js","assets/js/icon-cog-BFr_Pva7.js","assets/js/icon-skip-BOkC5L0N.js","assets/js/icon-down-BiHbKN-t.js","assets/js/icon-edit-CixeXNYx.js","assets/js/icon-ellipsis-D3jS4u3x.js","assets/js/icon-error-state-BKQhfBCj.js","assets/js/icon-heart-v5O7C6eS.js","assets/js/icon-hide-NFfBhfBx.js","assets/js/icon-key-BPNRipb3.js","assets/js/icon-next-B4hjdiAA.js","assets/js/icon-photo-BrwqV1T0.js","assets/js/icon-pin-BHeOuzvO.js","assets/js/icon-plus-D4YOesIc.js","assets/js/icon-profile-B_XWyuTb.js","assets/js/icon-x-qUCmf2CW.js","assets/js/icon-skip-intro-BUi8b3Ak.js","assets/js/icon-tooltip-CN09iXOB.js","assets/js/icon-visible-on-CM3kpcFN.js","assets/js/icon-x-caret-half-CZtcH_PM.js","assets/js/tasks-completed-Dg2z75km.js","assets/js/add-COIuonao.js","assets/js/google-DKPAcOmk.js","assets/js/arrow-up-1QPpu78M.js","assets/js/square-check-DwLT60gj.js","assets/js/clocks-DjzskNOU.js","assets/js/close-Bj_A2br_.js","assets/js/search-DCqlmJx6.js","assets/js/folder-CwWTWsnJ.js","assets/js/switch-EuBTQVVE.js","assets/js/focus-mode-09pIyYAW.js","assets/js/storage-YYEO5TB5.js","assets/js/icon-confetti-Dz2LojDe.js","assets/js/ocean-bubbles-GcKjBI5B.js","assets/js/sparks-CAw9b6ob.js","assets/js/secure-B8YP-AML.js","assets/js/icon-asana-Csd73e1k.js","assets/js/icon-percent-schedule-CA5EI9b7.js","assets/js/icon-trello-DhCq-Fsi.js","assets/js/icon-clean-rFsPxTtp.js","assets/js/icon-more-lists-Cl9oRGK2.js","assets/js/icon-more-fonts-CcfOY0t4.js","assets/js/icon-focus-stats-keERwXFt.js","assets/js/icon-top-of-mind-B6EhbCcK.js","assets/js/icon-flow-5QqmGIWX.js","assets/js/icon-integrations-D9o58ob4.js","assets/js/icon-weather-extra-ufLpT_SX.js","assets/js/icon-spiral-gh4hwZDD.js","assets/js/icon-happy-place-D1z6CJgM.js","assets/js/icon-time-sensitive-CP2L3maw.js","assets/js/icon-hourly-CdMmiQZT.js","assets/js/icon-infinity-D4yMRoAd.js","assets/js/icon-personalize-photos-D2M4lLlt.js","assets/js/icon-skip-2bGCAGKt.js","assets/js/icon-photo-match-C2EChNEK.js","assets/js/icon-random-375DbcwF.js","assets/js/icon-timezones-DGZoTtaT.js","assets/js/icon-simplify-BRUtLJYp.js","assets/js/icon-sync-DIH26Y9h.js","assets/css/BaseIcon-BlT7Qz-y.css","assets/css/FocusModeHoverDropdown-Ctx6EUYH.css","assets/js/FocusModeFocusingView-LtumBsYX.js","assets/js/MaskedOverlay-Dtx70blF.js","assets/css/MaskedOverlay-DyX75djk.css","assets/js/index-S6WCWdQc.js","assets/js/migrateLegacyUserMessageHandler-D55cXb1Z.js","assets/js/main-DbylMrX8.js","assets/css/index-C0DDMXTO.css","assets/js/v-style-BYiLZAgG.js","assets/js/flashMessageMixin-iTsywE8h.js","assets/js/globalKeyEventManager-FFJ3_dcn.js","assets/js/VueBase-DZEWjrk8.js","assets/js/index-CJJH83pl.js","assets/js/portal-vue.esm-CMantqsQ.js","assets/js/PomodoroTimers-BWkB-14p.js","assets/js/focusModeHelpers-Dnjy08Ra.js","assets/js/reactiveCustomization-OmNBH0KE.js","assets/js/scenes-DlKs5kIo.js","assets/js/AppContainer-Bvs393gy.js","assets/js/showAnyway-Cm28IABw.js","assets/js/allComponentsMounted-C3UsG_cA.js","assets/css/AppContainer-Okwrv5EP.css","assets/js/AppDash-BVWpva56.js","assets/css/AppDash-Drg1dTh1.css","assets/js/focusModeViewState-CNsbBnWl.js","assets/js/ViewState-BPM6-Gc_.js","assets/js/loginHelpers-BgZoFN0w.js","assets/js/authService-BcSP4pRZ.js","assets/css/FocusModeFocusingView-C8NRpJ0S.css"])))=>i.map(i=>d[i]);
import"./VueBase-DZEWjrk8.js";import{_ as e}from"./preload-helper-DmNsytk6.js";import{_ as o}from"./focus-mode-09pIyYAW.js";import t from"./AppContainer-Bvs393gy.js";import{u as s,c as i,g as a,b as n,s as r}from"./focusModeHelpers-Dnjy08Ra.js";import{A as c}from"./AppDash-BVWpva56.js";import{useFocusModeViewStateStore as u}from"./focusModeViewState-CNsbBnWl.js";import{F as d,C as l,A as p,I as f,e as h}from"./index-S6WCWdQc.js";import{B as M,p as w,a9 as g,A as S,o as v,aa as F,r as y,ab as _,u as b,w as A,e as V,V as T}from"./icon-alert-mvI7iJMO.js";import{a as C}from"./main-DbylMrX8.js";import{s as D}from"./showAnyway-Cm28IABw.js";import{w as L}from"./loginHelpers-BgZoFN0w.js";const E=new class{constructor(){this.fullscreen=M(!!document.fullscreenElement),this.fullscreenModeAvailable=document.fullscreenEnabled,document.addEventListener("fullscreenchange",(()=>{this.fullscreen.value=!!document.fullscreenElement}))}async enterFullscreen(e){if(this.fullscreenModeAvailable){if(e){const e=await w.tabs.getCurrent();if(!e)return;await w.windows.create({tabId:e.id}),await g(100)}await document.body.requestFullscreen({navigationUI:"hide"})}}async exitFullscreen(){this.fullscreenModeAvailable&&await document.exitFullscreen()}async toggleFullscreen(e,o){this.fullscreen.value?await this.exitFullscreen():await this.enterFullscreen(e),S.capture((this.fullscreen.value?"enter":"leave")+" fullscreen",{feature:o})}},I=new S({feature:"focus mode"});const O=v({name:"FocusMode",components:{AppContainer:t,AppDash:c,FocusModeHoverDropdown:()=>e((()=>import("./FocusModeHoverDropdown-CP28OJMF.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76])),FocusModeFocusingView:()=>e((()=>import("./FocusModeFocusingView-LtumBsYX.js")),__vite__mapDeps([77,5,3,4,6,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,78,79,80,81,82,83,84,85,86,87,88,89,7,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104]))},setup(){const e=u(),o=s();return F("store",o),F("viewStateStore",e),{apps:i,FocusModeView:d,focusModeViewStateStore:e,focusModeSessionStore:o,CAPACITY_LIMIT_MS_ALLOWED_PER_DAY:l,showAnyway:D,capacityLimitInterval:null,APP_TRANSITION_TIME:p}},data:()=>({hoverDropdownOpen:!1,instantFocusingViewTransition:!1,focusModeCancelled:!1}),computed:{tabFocused:()=>y.tabFocused,activatedApps(){return Object.keys(this.apps).filter((e=>"pomodoro"===e||this.settingsWithDefaults.apps[e].enabled&&!this.apps[e].unsupported)).map((e=>({key:e,...this.apps[e]})))},focusing(){return this.focusModeViewStateStore.currentlyFocusing},focusingOrCelebrationViewActive(){return this.focusModeViewStateStore.currentlyFocusing||this.focusModeViewStateStore.currentFocusModeView===d.Celebration},settingsWithDefaults:()=>a(),focusModeLabel(){var e;return"focus_mode_label"===(null==(e=_("focus_mode_experiments"))?void 0:e.variantName)?"Pomodoro":"Focus"},iconName(){var e;return"focus_mode_icon"===(null==(e=_("focus_mode_experiments"))?void 0:e.variantName)?"soundscapes-variant":"apps/focus-mode"+(this.popupActive?"-fill":"")}},watch:{"focusModeViewStateStore.currentFocusModeView"(e){e===d.Transition&&this.loadPlusApps()},"focusModeSessionStore.loaded":{handler(e){if(e){const e=async()=>{await this.focusModeViewStateStore.resumeFocusModeAfterTabLoad(),this.setCapacityLimitFocusModeTimeout()};this.focusModeSessionStore.shouldAutoDisable&&this.$plus&&"true"!==localStorage.getItem("pomodoro-running")?(this.stopFocusMode(!0),L().then((async()=>{m.$e.$emit("flashMessage",{icon:o,message:f,button:{text:"Jump back in",action:()=>this.startFocusMode("inactivity flash message")}})}))):this.focusModeSessionStore.focusModeActive&&(this.loadPlusApps(),L().then((async()=>{var e,o;for(const t in i){(null==(o=(e=i[t]).shouldEnableOnResume)?void 0:o.call(e))&&i[t].enable(this.focusModeSessionStore.appActivationData[t])}await this.triggerFocusModeStartedEventAfterDelay()})),this.instantFocusingViewTransition=!0,y.disableAppTransitions=!0,Promise.race([b.delay(1e3),L()]).then(e)),this.unwatch=A((()=>this.focusModeSessionStore.focusModeActive),(async o=>{o?await e():o||this.focusModeViewStateStore.currentFocusModeView===d.Idle||(this.focusModeViewStateStore.currentFocusModeView!==d.Celebration&&(this.instantFocusingViewTransition=!0,await this.$nextTick()),await this.focusModeViewStateStore.stopFocusMode(),m.tourActive&&m.trigger("modal:close"))})),m.widgetManager.appReady("focus-mode")}},immediate:!0},tabFocused:{handler(){this.setCapacityLimitFocusModeTimeout()},immediate:!0},settingsWithDefaults(){this.onSettingsUpdate()}},mounted(){m.on("globalEvent:click",this.focusModeSessionStore.refreshLastInteraction),m.on("focusMode:start",this.startFocusMode),m.on("focusMode:stop",this.stopFocusMode),m.on("focusMode:cancel",this.cancelFocusMode),h.currentValue||m.widgetManager.appReady("focus-mode"),V.$emit("focusMode:ready")},destroyed(){var e;m.off("globalEvent:click",this.focusModeSessionStore.refreshLastInteraction),m.off("focusMode:start",this.startFocusMode),m.off("focusMode:stop",this.stopFocusMode),m.off("focusMode:cancel",this.cancelFocusMode),null==(e=this.unwatch)||e.call(this)},methods:{async loadPlusApps(){this.$plus||(b.isSafari()||b.isPwa()||await m.widgetManager.loadWidget("tabs"),await m.widgetManager.loadWidget("site-blocker"),await m.widgetManager.loadWidget("soundscapes"))},openHoverDropdown(){1===this.focusModeSessionStore.start&&0===C.stack.length&&(this.hoverDropdownOpen=!0,m.trigger("focusMode:hover:toggle",!0))},closeHoverDropdown(){this.hoverDropdownOpen=!1,m.trigger("focusMode:hover:toggle",!1)},async triggerFocusModeStartedEventAfterDelay(){await b.delay(p),await b.doubleRaf(),m.trigger("focusMode:started")},async startFocusMode(e){if(!this.focusing)if(!this.$plus&&this.focusModeSessionStore.isOverCapacityLimit)this.openUpsell();else{if(this.closeHoverDropdown(),m.trigger("focusMode:starting"),await this.focusModeViewStateStore.startFocusModeWithCancelPeriod(),this.focusModeCancelled)return this.focusModeCancelled=!1;await this.focusModeViewStateStore.finalizeStartFocusModeAfterCancelPeriod();const o={};for(const e of this.activatedApps)o[e.key]=await i[e.key].enable();await this.focusModeSessionStore.startAndSaveFocusMode(o),I.capture("focus mode start",{enabled_apps:this.activatedApps.map((e=>e.key)),source:e}),await this.triggerFocusModeStartedEventAfterDelay()}},async cancelFocusMode(){this.focusModeCancelled=!0,await this.focusModeViewStateStore.cancelFocusModeStart()},async stopFocusMode(e=!1){m.trigger("focusMode:stopping"),i.pomodoro.disable({});const o=async()=>{await b.delay(p),await this.focusModeSessionStore.disableAppsBeforeStop(e)};e?o():await Promise.allSettled([o(),this.focusModeViewStateStore.celebrateFocusMode()]),E.fullscreen.value&&await E.exitFullscreen(),await this.focusModeSessionStore.stopAndSaveFocusMode();const t=this.activatedApps.map((e=>e.key)),s=Math.round((this.focusModeSessionStore.stop-this.focusModeSessionStore.start)/1e3);I.capture("focus mode stop",{enabled_apps:t,seconds_since_start:s,stopped_by_inactivity:e}),this.setCapacityLimitFocusModeTimeout(),m.trigger("focusMode:stopped")},setCapacityLimitFocusModeTimeout(){clearTimeout(this.capacityLimitInterval),this.$plus||this.focusing&&(this.capacityLimitInterval=setTimeout((()=>{if(this.focusing){if(!this.focusModeSessionStore.isOverCapacityLimit)return this.setCapacityLimitFocusModeTimeout();i.pomodoro.disable({}),i.soundscapes.disable({}),i.siteBlocker.disable({}),y.tabFocused&&this.stopFocusMode().then((()=>{this.openUpsell()}))}}),Math.max(this.focusModeSessionStore.msUntilOverCapacityLimit+100,500)))},openUpsell(e=!0){var o;let t="UPSELL_FOCUS_MODE";e&&!b.isSafari()&&"experimental"===(null==(o=_("free_focus_mode_capacity_limit_upsell_experiment"))?void 0:o.variantName)&&(t="UPSELL_FOCUS_MODE_EXPERIMENTAL"),m.cmd("modal.open",t,{event_source:"dash"})},onSettingsUpdate(){this.focusing&&(this.focusModeViewStateStore.resetFocusingStyleVariables(),n(),r(),this.focusModeViewStateStore.setFocusingStyleVariables())},resetInstantTransition(){this.instantFocusingViewTransition=!1}}},(function(){var e,o=this,t=o._self._c;return t("app-container",{class:{focusing:o.focusingOrCelebrationViewActive},attrs:{"app-name":"focus-mode","visible-setting":"focusModeVisible","data-test":"focus-mode"}},[t("transition",{attrs:{name:"focus-mode-fade-deep",duration:o.instantFocusingViewTransition?0:o.APP_TRANSITION_TIME},on:{"after-enter":o.resetInstantTransition,"after-leave":o.resetInstantTransition}},[o.focusingOrCelebrationViewActive&&o.showAnyway.includes("focus-mode")?t("focus-mode-focusing-view",{on:{openUpsell:function(e){return o.openUpsell(!1)},stopFocusMode:o.stopFocusMode}}):o._e()],1),o.focusingOrCelebrationViewActive?o._e():[t("app-dash",{ref:"focusModeAppToggle",attrs:{icon:`icon/${o.iconName}`,label:o.focusModeLabel,"data-test":"focus-mode-top-left-app-toggle"},on:{mouseenter:o.openHoverDropdown,mouseleave:o.closeHoverDropdown,click:function(e){return o.startFocusMode("dash icon")}}}),t("transition",{attrs:{name:"slide-down-fade-blurred",duration:200}},[o.hoverDropdownOpen?t("focus-mode-hover-dropdown",{attrs:{target:null==(e=o.$refs.focusModeAppToggle)?void 0:e.$el}}):o._e()],1)]],2)}),[],!1,null,"df929891").exports,P=document.querySelector(".region.top-left"),j=document.createElement("div");P&&P.prepend(j),new T({render:e=>e(O)}).$mount(j);const k=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{E as f,k as m};