import{r as f}from"./cplx-M4JPizzD.js";import{$ as j}from"./cplx-BbAh7E-i.js";import{j as e,c as x}from"./cplx-DEt7CUyc.js";import{P as z}from"./cplx-BsCYqTWz.js";import{q as m,w as g,x as h,o as I,y as R,z as C,t as T,n as w,A,C as P,B as V,E as G,r as D,l as y,m as S,u as _,g as M}from"./cplx-CWPpH3dB.js";import{T as F,a as E}from"./cplx-rYRypPy0.js";import{C as H}from"./cplx-BddtA9RI.js";import{B as v}from"./cplx-CCGYIZQf.js";import{S as $,t as p,r as K,T as U,U as X,h as L,b as W}from"./cplx-CejnDNPm.js";import{b as k,d as O}from"./cplx-Cdcyb6EG.js";import{T as B}from"./cplx-Cqfmi6PF.js";import"./cplx-CVsLL7Ku.js";import"./cplx-CzQHx1MX.js";import"./cplx-DSnlyBAv.js";import"./cplx-CXGk_GMP.js";import"./cplx-BpeHHEix.js";import"./cplx-AFeO3sEC.js";import"./cplx-2ekRUlSR.js";import"./cplx-CIDXzIHh.js";import"./cplx-CvSOQQlQ.js";import"./cplx-Bzmv935M.js";import"./cplx-Bey00KRS.js";import"./cplx-DC-QQLj-.js";import"./cplx-B814hFp-.js";import"./cplx-wwbq-DDb.js";import"./cplx-BqwXc_LR.js";import"./cplx-D37zsf-y.js";import"./cplx-CZMWhpfy.js";import"./cplx-SsoyhRxE.js";import"./cplx-DewpVJ-0.js";import"./cplx-B42KOvrD.js";import"./cplx-km2FGkQ4.js";import"./cplx-Mn-h5XDX.js";import"./cplx-DD6dUv5H.js";import"./cplx-Dy60Fcq0.js";import"./cplx-CgmVhoKz.js";import"./cplx-hUtawQMb.js";import"./cplx-CCS6eJc0.js";import"./cplx-B19A3gYQ.js";const q="body[data-cplx-canvas-active-panel] [data-cplx-component=message-block]:not(:has(.col-span-4[data-cplx-component=message-block-visual-col] svg[data-icon=sources])) .col-span-8[data-cplx-component=message-block-text-col]{grid-column:span 12 / span 12}body[data-cplx-canvas-active-panel] [data-cplx-component=message-block]:not(:has(.col-span-4[data-cplx-component=message-block-visual-col] svg[data-icon=sources])) .col-span-4[data-cplx-component=message-block-visual-col]{display:none}body[data-cplx-canvas-active-panel] [data-cplx-component=thread-wrapper]{display:flex;gap:2rem;justify-content:space-between;max-width:100%;isolation:isolate}body[data-cplx-canvas-active-panel=list] [data-cplx-component=thread-wrapper]{max-width:-moz-max-content;max-width:max-content}body[data-cplx-canvas-active-panel=list] [data-cplx-component=thread-wrapper] .pointer-events-auto.md\\:col-span-8,body[data-cplx-canvas-active-panel=list] [data-cplx-component=thread-wrapper] [data-cplx-component=message-block-text-col]{grid-column:span 8 / span 8}body[data-cplx-canvas-active-panel=list] [data-cplx-component=thread-wrapper] [data-cplx-component=message-block-visual-col]{display:block}";function J(){const t=m(i=>i.selectedCodeBlockLocation),r=g(i=>i.blocks),n=h({mirroredCodeBlocks:r,messageBlockIndex:t==null?void 0:t.messageBlockIndex,codeBlockIndex:t==null?void 0:t.codeBlockIndex}),c=n==null?void 0:n.isInFlight,d=(n==null?void 0:n.codeString)??"",a=I((n==null?void 0:n.language)??""),s=f.useMemo(()=>({color:"oklch(var(--muted-foreground))"}),[]),l=f.useMemo(()=>{const i=({children:o})=>e.jsx("pre",{className:"tw-px-4 tw-py-2",children:o});return i.displayName="PreTag",i},[]);return e.jsx("div",{id:"canvas-code-view",className:x("tw-h-full tw-w-max tw-min-w-full tw-text-xs [&>pre]:tw-m-0 [&>pre]:tw-size-full [&>pre]:tw-rounded-t-none [&_span.linenumber]:!tw-text-muted-foreground",{"[&_span]:tw-duration-300 [&_span]:tw-animate-in [&_span]:tw-fade-in":c}),children:e.jsx(H,{showLineNumbers:!0,language:a,lineNumberStyle:s,PreTag:l,children:d})})}function Q({language:t}){const r=R[t];return r==null?null:e.jsx("div",{className:"tw-size-full",children:e.jsx(r,{})})}function Y(){const t=m(i=>i.selectedCodeBlockLocation),r=g(i=>i.blocks),n=h({mirroredCodeBlocks:r,messageBlockIndex:t==null?void 0:t.messageBlockIndex,codeBlockIndex:t==null?void 0:t.codeBlockIndex}),c=n==null?void 0:n.isInFlight,d=m(i=>i.state),a=I((n==null?void 0:n.language)??"text"),s=m(i=>i.refreshPreviewKey);return m(i=>i.isValidCanvasCode)?e.jsxs(F,{lazyMount:!0,value:c&&C[a]==="code"?"code":d,className:"custom-scrollbar tw-size-full tw-overflow-auto",children:[e.jsx(E,{value:"code",className:"tw-size-full",children:e.jsx(J,{})}),e.jsx(E,{value:"preview",className:x("tw-size-full",{"tw-hidden":c&&C[a]!=="preview"}),children:e.jsx(Q,{language:a},`${s}`)})]}):null}function Z(){const t=m(o=>o.selectedCodeBlockLocation),r=g(o=>o.blocks),n=h({mirroredCodeBlocks:r,messageBlockIndex:t==null?void 0:t.messageBlockIndex,codeBlockIndex:t==null?void 0:t.codeBlockIndex}),c=m(o=>o.canvasBlocks),d=T(n==null?void 0:n.language),a=c[d],s=a==null?void 0:a.location.findIndex(o=>o.messageBlockIndex===(t==null?void 0:t.messageBlockIndex)&&o.codeBlockIndex===(t==null?void 0:t.codeBlockIndex)),l=(a==null?void 0:a.location)&&s!==(a==null?void 0:a.location.length)-1,i=(a==null?void 0:a.location)&&s!==0;return!a||s==null?null:e.jsxs("div",{className:x("tw-flex tw-items-center tw-gap-1",{"tw-invisible tw-opacity-0":!l&&!i}),children:[e.jsx(v,{variant:"ghost",size:"iconSm",disabled:!i,onClick:()=>{w.setState(o=>{if(s==null)return;const u=a==null?void 0:a.location[s-1];u&&(o.selectedCodeBlockLocation=u)})},children:e.jsx($,{className:"tw-size-4"})}),e.jsx("div",{className:"tw-line-clamp-1 tw-cursor-pointer tw-text-sm tw-text-muted-foreground",onClick:()=>{const o=w.getState().selectedCodeBlockLocation;if(!o)return;const u=`[data-cplx-component="${k.THREAD.MESSAGE.BLOCK}"][data-index="${o.messageBlockIndex}"] [data-cplx-component="${k.THREAD.MESSAGE.TEXT_COL_CHILD.MIRRORED_CODE_BLOCK}"][data-index="${o.codeBlockIndex}"]`;O(j(u),-100)},children:p("plugin-canvas:canvas.version",{number:s+1})}),e.jsx(v,{variant:"ghost",size:"iconSm",disabled:!l,onClick:()=>{w.setState(o=>{if(s==null)return;const u=a==null?void 0:a.location[s+1];u&&(o.selectedCodeBlockLocation=u)})},children:e.jsx(K,{className:"tw-size-4"})})]})}function tt(){const t=m(a=>a.selectedCodeBlockLocation),r=g(a=>a.blocks),n=h({mirroredCodeBlocks:r,messageBlockIndex:t==null?void 0:t.messageBlockIndex,codeBlockIndex:t==null?void 0:t.codeBlockIndex}),c=I((n==null?void 0:n.language)??"text"),d=n==null?void 0:n.codeString;return e.jsxs("div",{className:"tw-flex tw-w-full tw-items-center tw-justify-between tw-border-t tw-border-border/50 tw-bg-background tw-p-2 tw-px-4",children:[e.jsx(Z,{}),e.jsxs("div",{className:"tw-ml-auto tw-flex tw-items-center tw-gap-1",children:[A[c]&&(()=>{const a=A[c];return e.jsx(a,{})})(),e.jsx(v,{asChild:!0,className:"tw-group tw-animate-in tw-fade-in",variant:"ghost",size:"iconSm",children:e.jsx(P,{content:d??"",className:"group-hover:tw-text-primary"})})]})]})}function et({language:t}){const{state:r,setState:n}=m();return e.jsxs("div",{className:"tw-flex tw-cursor-pointer tw-select-none tw-items-center tw-overflow-hidden tw-rounded-md tw-border tw-border-border/50 tw-bg-secondary tw-animate-in tw-fade-in",onClick:()=>n(r==="code"?"preview":"code"),children:[e.jsx("div",{className:x("tw-p-1 tw-px-4 tw-text-muted-foreground",{"tw-rounded-md tw-bg-primary tw-text-primary-foreground tw-transition-all":r==="preview"}),children:V[t]??p("plugin-canvas:canvas.toggle.preview")}),e.jsx("div",{className:x("tw-p-1 tw-px-4 tw-text-muted-foreground",{"tw-rounded-md tw-bg-primary tw-text-primary-foreground tw-transition-all":r==="code"}),children:G[t]??p("plugin-canvas:canvas.toggle.code")})]})}function nt(){const t=m(o=>o.selectedCodeBlockLocation),r=g(o=>o.blocks),n=h({mirroredCodeBlocks:r,messageBlockIndex:t==null?void 0:t.messageBlockIndex,codeBlockIndex:t==null?void 0:t.codeBlockIndex}),c=D(T(n==null?void 0:n.language)),d=y(n==null?void 0:n.language),a=S(n==null?void 0:n.language),s=n==null?void 0:n.isInFlight,l=m(o=>o.state),i=I((n==null?void 0:n.language)??"text");return!d&&!a?null:e.jsxs("div",{className:"tw-flex tw-w-full tw-items-center tw-justify-between tw-border-b tw-border-border/50 tw-bg-background tw-p-2 tw-px-4",children:[e.jsx("div",{className:"tw-line-clamp-1 tw-cursor-pointer tw-text-muted-foreground",onClick:()=>{const o=w.getState().selectedCodeBlockLocation;if(!o)return;const u=`[data-cplx-component="${k.THREAD.MESSAGE.BLOCK}"][data-index="${o.messageBlockIndex}"] [data-cplx-component="${k.THREAD.MESSAGE.TEXT_COL_CHILD.MIRRORED_CODE_BLOCK}"][data-index="${o.codeBlockIndex}"]`;O(j(u),-100)},children:c}),e.jsxs("div",{className:"tw-flex tw-items-center tw-gap-1",children:[e.jsxs("div",{className:x("tw-flex tw-items-center tw-gap-1",{"tw-invisible":s}),children:[l==="preview"&&e.jsx(B,{content:p("plugin-canvas:canvas.tooltip.refresh"),children:e.jsx(v,{variant:"ghost",size:"iconSm",className:"tw-animate-in tw-fade-in",onClick:()=>w.getState().refreshPreview(),children:e.jsx(U,{className:"tw-size-4"})})}),a&&e.jsxs(e.Fragment,{children:[e.jsx(et,{language:i}),a&&e.jsx(B,{content:p("plugin-canvas:canvas.tooltip.openList"),children:e.jsx(v,{variant:"ghost",size:"iconSm",onClick:()=>w.getState().openCanvasList(),children:e.jsx(X,{className:"tw-size-4"})})})]})]}),e.jsx(v,{variant:"ghost",size:"iconSm",onClick:()=>w.getState().close(),children:e.jsx(L,{className:"tw-size-4"})})]})]})}function at(){const t=m(r=>r.canvasBlocks);return e.jsxs("div",{className:"tw-flex tw-size-full tw-flex-col tw-gap-4",children:[e.jsxs("div",{className:"tw-flex tw-items-center tw-justify-between tw-border-b tw-border-border/50 tw-bg-background tw-p-2 tw-px-4",children:[e.jsx("div",{className:"tw-text-muted-foreground",children:p("plugin-canvas:canvas.list.title")}),e.jsx(v,{variant:"ghost",size:"iconSm",onClick:()=>{w.getState().closeCanvasList()},children:e.jsx(L,{className:"tw-size-4 tw-text-muted-foreground"})})]}),e.jsx("div",{className:"tw-flex tw-flex-col tw-gap-4 tw-overflow-y-auto tw-px-4",children:Object.values(t).map(({Icon:r,count:n,title:c,description:d,isInFlight:a,onClick:s},l)=>e.jsxs("div",{className:x("tw-group tw-flex tw-w-full tw-cursor-pointer tw-select-none tw-items-center tw-divide-x-2 tw-divide-border/50 tw-overflow-hidden tw-rounded-lg tw-border tw-border-border/50 tw-bg-secondary tw-transition-all hover:tw-border-primary"),onClick:s,children:[e.jsx("div",{className:x("tw-group-hover:tw-bg-primary/10 tw-flex tw-aspect-square tw-size-16 tw-items-center tw-justify-center"),children:a?e.jsx(W,{className:"tw-size-4 tw-animate-spin tw-text-muted-foreground"}):e.jsx(r,{className:"tw-size-8"})}),e.jsxs("div",{className:"tw-flex tw-w-full tw-flex-col tw-border-l tw-bg-background tw-px-4 tw-py-2",children:[e.jsx("div",{className:"tw-line-clamp-1 tw-text-base tw-text-foreground tw-transition-all group-hover:tw-text-primary",children:c}),e.jsx("div",{className:"tw-flex tw-w-max tw-items-center tw-gap-1",children:a?e.jsx("span",{className:"tw-animate-pulse",children:p("plugin-canvas:canvas.list.generating")}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"tw-hidden tw-text-sm tw-text-muted-foreground lg:tw-block",children:d}),n>1&&e.jsxs("span",{className:"tw-flex tw-items-center tw-gap-1 tw-text-sm tw-text-muted-foreground",children:[e.jsx("span",{className:"tw-hidden lg:tw-block",children:"•"}),p("plugin-canvas:canvas.list.versions",{count:n})]})]})})]})]},l))})]})}function st(){const t=m(a=>a.selectedCodeBlockLocation),r=t!==null,n=m(a=>a.hasAutoPreviewTriggered),c=g().blocks,d=h({mirroredCodeBlocks:c,messageBlockIndex:t==null?void 0:t.messageBlockIndex,codeBlockIndex:t==null?void 0:t.codeBlockIndex});f.useEffect(function(){t:for(let s=c.length-1;s>=0;s--){const l=c[s];if(l)for(let i=l.length-1;i>=0;i--){const o=l[i];if(!o||!o.language||!S(o.language))continue;const u=s===(t==null?void 0:t.messageBlockIndex)&&i===(t==null?void 0:t.codeBlockIndex);if(!o.isInFlight||u)continue;const N=w.getState().lastAutoOpenCodeBlockLocation;if(!(N&&N.messageBlockIndex===s&&N.codeBlockIndex===i)){w.setState(b=>{b.selectedCodeBlockLocation={messageBlockIndex:s,codeBlockIndex:i},b.state=C[I(o.language)],b.hasAutoPreviewTriggered=!1,b.lastAutoOpenCodeBlockLocation={messageBlockIndex:s,codeBlockIndex:i},b.isCanvasListOpen=!1});break t}}}},[t==null?void 0:t.messageBlockIndex,t==null?void 0:t.codeBlockIndex,c,r]),f.useEffect(function(){var l;r&&!n&&d&&!d.isInFlight&&t!=null&&d===((l=c[t.messageBlockIndex])==null?void 0:l[t.codeBlockIndex])&&(w.setState(i=>{i.hasAutoPreviewTriggered=!0}),w.setState(i=>{i.state="preview"}))},[d,r,n,t,c])}function ot(){const t=m(c=>c.selectedCodeBlockLocation),r=g().blocks,n=_(c=>c.threadComponents.codeBlocks);f.useEffect(function(){if(!t){w.setState(o=>{o.isValidCanvasCode=!1});return}const{messageBlockIndex:d,codeBlockIndex:a}=t,s=r[d],l=s==null?void 0:s[a],i=(l==null?void 0:l.codeString)!=null&&(l==null?void 0:l.language)!=null&&(y(l.language)||S(l.language));w.setState(o=>{o.isValidCanvasCode=i})},[r,t]),f.useEffect(function(){var l;if(!t)return;const{messageBlockIndex:d,codeBlockIndex:a}=t;((l=n==null?void 0:n[d])==null?void 0:l[a])!=null||w.getState().close()},[t,n])}function Kt(){const t=_(s=>s.threadComponents.wrapper);ot(),st();const r=m(s=>s.selectedCodeBlockLocation),n=r!==null,c=g(s=>s.blocks),d=h({mirroredCodeBlocks:c,messageBlockIndex:r==null?void 0:r.messageBlockIndex,codeBlockIndex:r==null?void 0:r.codeBlockIndex}),a=m(s=>s.isCanvasListOpen);return M({id:"canvas",css:q,inject:n||a}),f.useEffect(()=>{if(!n&&!a){j(document.body).removeAttr("data-cplx-canvas-active-panel");return}j(document.body).attr("data-cplx-canvas-active-panel",a?"list":"canvas")},[n,a]),!n&&!a?null:e.jsx(z,{container:t,children:e.jsxs("div",{className:x("tw-fixed tw-right-8 tw-my-8 tw-h-[calc(100dvh-var(--navbar-height)-11rem)] tw-overflow-hidden tw-rounded-md tw-border tw-border-border/50 tw-bg-secondary tw-text-sm tw-transition-all tw-animate-in tw-fade-in tw-slide-in-from-right xl:tw-sticky xl:tw-top-[calc(var(--navbar-height)+2rem)] xl:tw-my-0 xl:tw-h-[calc(100dvh-var(--navbar-height)-4rem)]",{"tw-w-[80vw] xl:tw-w-[200%]":n,"tw-w-[30vw] xl:tw-w-[20%] xl:tw-min-w-[400px]":a}),children:[a&&e.jsx(at,{}),n&&d!=null&&e.jsxs("div",{className:"tw-flex tw-size-full tw-flex-col",children:[e.jsx(nt,{}),e.jsx(Y,{}),e.jsx(tt,{})]})]})})}export{Kt as default};
