"undefined"==typeof _idaptiveUniqueGlobal&&(_idaptiveUniqueGlobal={}),function(){var d=this;void 0===d.net&&(d.net={}),void 0===d.background&&(d.background={});d.common.HasObserverBase=function(){this.observers=[]},d.common.HasObserverBase.prototype={addObserver:function(e,t){this.observers.push({observer:e,name:t})},addObserverByName:function(e,t){for(var s=0;s<this.observers.length;s++){var n=this.observers[s];if(n.name===t)return void(n.observer=e)}this.addObserver(e,t)},notifyObservers:function(e){for(var t=0;t<this.observers.length;t++){var s=this.observers[t];try{this.logTrace("> notifyObservers: "+s.name),s.observer(e)}catch(e){this.logError("notifyObservers error on "+s.name+": "+e)}}}},d.login.CentrifyBEHttp401Base=function(){d.common.CentrifyBEBase.call(this)},d.login.CentrifyBEHttp401Base.prototype={loggerName:"H401",end:function(e){try{this.clearLoginData(e)}catch(e){this.logError("fail to clear loginData - "+e)}},abort:function(e,t){this.debugMode,this.logError(t),this.end(e)},logSeq:function(e,t){var s=e.order[e.currentOrder],e="T-"+e.currentOrder+"/"+e.order.length+" "+s;t&&(e+=": "+t),this.log(e)},recevied401Header:function(e,t){if(t)if(this.log("start. URL = "+e.url),this.checkBackgroundProtocol(e,t)){var s=!1;if(t.order||(d.login.Common.initDefaultLoginOrder(t),s=!0),void 0!==t.currentOrder){if(t.currentOrder>=t.order.length)return this.abort(e,"OrderOfBound, currentOrder = "+t.currentOrder+", total = "+t.order.length),!1;var n=t.order[t.currentOrder],i=1<=t.currentOrder?t.order[t.currentOrder-1]:null;if(n[0]===d.login.LoginOrderEnum.newPage)++t.currentOrder,s=!0;else if(i[0]!=d.login.LoginOrderEnum.gotoUrl&&i[0]!=d.login.LoginOrderEnum.header401)return this.abort(e,"Unexpected login order, expect "+d.login.LoginOrderEnum.newPage+" but got "+n[0]),!1}else s=!(t.currentOrder=0);s&&this.updateLoginData(e,t),this.executeCommands(e,t)}else this.promptWarningDiag(e,"This login page is not secure.<br>The application you are trying to access is configured to require a secure, encrypted, connection (HTTPS).<br>However, this login page is not encrypted (HTTP).");else this.log("ignore. URL = "+e.url)},executeCommands:function(e,t){if(t.order.length<=t.currentOrder)this.log("no more command to run"),this.end(e);else{var s=t.order[t.currentOrder];switch(this.logSeq(t),s[0]){case d.login.LoginOrderEnum.click:case d.login.LoginOrderEnum.ups:case d.login.LoginOrderEnum.sleep:case d.login.LoginOrderEnum.fill:case d.login.LoginOrderEnum.fillEnter:case d.login.LoginOrderEnum.submit:case d.login.LoginOrderEnum.gotoUrl:this.abort(e,"UnsupportedCommand  "+s[0]);break;case d.login.LoginOrderEnum.newPage:this.executeCommandNewPage(e,t);break;case d.login.LoginOrderEnum.header401:this.executeCommandHeader401(e,t);break;default:this.abort(e,"Unknown command in the order: "+s[0])}}},getFieldValueByName:function(e,t){for(var s=0;s<e.fields.length;s++){var n=e.fields[s];if(n.name==t)return n.value}return null},executeCommandNewPage:function(e,t){var s=t.order[t.currentOrder][1],n=!1;(n=s&&s.httpStatus&&"401".match(s.httpStatus)?!0:n)?(this.log("The skip condition is met in waitForNewPage. No wait"),++t.currentOrder,this.updateLoginData(e,t),this.executeCommands(e,t)):this.log("The waiting for next page load. Zzz")},executeCommandHeader401:function(e,t){switch(t.scheme){case d.login.SchemeEnum.ftp:case d.login.SchemeEnum.basic:case d.login.SchemeEnum.any:break;default:return void this.abort(e,"loginData.scheme is not supported. It is "+t.scheme)}this.log("start setting basic auth");var s=this.getFieldValueByName(t,"username"),n=this.getFieldValueByName(t,"password");this.fillUsernameAndPassword(e,s,n),++t.currentOrder,this.updateLoginData(e,t)},checkBackgroundProtocol:function(e,t){return this.checkProtocol(e.url,t.applicationUrl)},clearLoginData:function(e){},fillUsernameAndPassword:function(e,t,s){},updateLoginData:function(e,t){},promptWarningDiag:function(e,t){}},d.common.objectExtend(d.login.CentrifyBEHttp401Base,d.common.CentrifyBEBase),d.net.UserSetting=function(e){this.raw=e,this.init()},d.net.UserSetting.prototype={init:function(){var e=this.raw;this.tenantId=e.tenantId,this.username=e.username,this.canCreateAppInAP=!0===e.canCreateAppInAP,this.canCreateAppInUP=!0===e.canCreateAppInUP,this.enableLandCatch=!0===e.enableLandCatch,this.durationForClearingClipboardPassword=e.durationForClearingClipboardPassword||120,this.isClearClipboardEnabled=!0===e.isClearClipboardEnabled,this.isDisableBrowserPasswordPromptsVisible=!0===e.isDisableBrowserPasswordPromptsVisible,this.isFormFillEnabled=!(!1===e.isFormFillEnabled),this.entitlement=e.entitlement||"APPS",this.defaultFormFillEnabled=!(!1===e.defaultFormFillEnabled),this.isAutoLoginEnabled=!0===e.isAutoLoginEnabled,this.defaultAutoLoginEnabled=!0===e.defaultAutoLoginEnabled,this.prescribeURL=e.prescribeURL,this.prescribeVersion=e.prescribeVersion,this.hasSwsEntitlement=e.hasSwsEntitlement,this.isCopyCredsFromIBEEnabled=!(!1===e.enableCopyCreds),this.enableCompromisedPasswordCheckForIBE=!0===e.enableCompromisedPasswordCheckForIBE,this.isEnabledLCEnhancement=!0===e.isEnabledLCEnhancement,this.isEnabledLCPromptReoccurFix=!0===e.isEnabledLCPromptReoccurFix,this.autoLoginUXImprovement=!(!1===e.autoLoginUXImprovement),this.isCompromisedPwdLaunchDisabled=!0===e.isCompromisedPwdLaunchDisabled,this.isCompromisedPwdSaveEnabled=!0===e.isCompromisedPwdSaveEnabled,this.enableEnhancedTooltip=!0===e.enableEnhancedTooltip,this.isCopyPasswordAllowed=!(!1===e.isCopyPasswordAllowed),this.hasWpmEntitlement=!0===e.hasWpmEntitlement,this.isSecuredItemsEnabled=!0===e.enableSecuredItemsBE,this.ignoreMultipleLCPrompts=!0===e.ignoreMultipleLCPromptsBE,this.enableCaptchaforBE=!0===e.enableCaptchaforBE,this.isTOTPEnabledForBE=!0===e.isTOTPEnabledForBE,this.isTOTPEnabledForSecuredPasswordBE=!0===e.isTOTPEnabledForSecuredPasswordBE,this.enableHandleChallenges=!0===e.enableHandleChallenges,this.enableAutoFillForNonPasswordTypeFields=!0===e.enableAutoFillForNonPasswordTypeFields,this.IsCopyUsernamePwdEnabled=!0===e.IsCopyUsernamePwdEnabled,this.isAppApearsTwiceBugFixEnabled=!0===e.isAppApearsTwiceBugFixEnabled,this.isAutoSubmitAfterEnterEnabled=!0===e.enableAutoSubmitAfterEnterInBE,this.enabledForceAutoFill=!0===e.enabledForceAutoFill,this.updateNonCatalogueApps=!0===e.updateNonCatalogApps,this.enableFNFCapture=!0===e.enableFNFCapture,this.isPassphraseGenerationEnable=!0===e.enablePassphraseGeneration,this.allowPasphraseGeneration=!0===e.allowPasphraseGeneration,this.minimumNumberOfPassphraseWords=e.minimumNumberOfPassphraseWords,this.minimumNumberOfPassphraseCharacters=e.minimumNumberOfPassphraseCharacters,this.excludedPassphraseCharactersOrWords=e.excludedPassphraseCharactersOrWords,this.enableLCBrokenSitesFix=!0===e.enableLCBrokenSitesFix,this.disableContextMenuCheckOnAllIFrames=!0===e.disableContextMenuCheckOnAllIFrames,this.enableNewFilterAndSortAlgorithm=!0===e.enableNewFilterAndSortAlgorithm,this.maxNumberOfAppsInContextMenu=e.maxNumberOfAppsInContextMenu||200,this.enableOldPasswordFillBasedOnPermissions=!0===e.enableOldPasswordFillBasedOnPermissions,this.autoSubmitScriptFix=!0===e.autoSubmitScriptFix,this.enableHeader401SuccessFix=!0===e.enableHeader401SuccessFix,this.enableBrokenLC=!0===e.enableBrokenLC,this.lcInputCount=e.lcInputCount||10,this.enablePrivilegedApps=!0===e.enablePrivilegedApps,this.shellLogoutURL=e.shellLogoutURL||"shell/api/logout",this.enabledIBEVersionUpdate=!0===e.enabledIBEVersionUpdate,this.enabledTotpAutoFill=!0===e.enabledTotpAutofill,this.enabledCompromisedChangeFix=!0===e.enabledCompromisedChangeFix,this.enabledAppsURLPatternCheck=!0===e.enabledAppsURLPatternCheck,this.isTotpAutoFillConfigValuesEnabled=!0===e.isTotpAutoFillConfigValuesEnabled,this.totpAutoFillConfig=e.totpAutoFillConfig,this.totpAutoFillSleep=e.totpAutoFillSleep,this.enableNewAutoFillAlgorithm=!0===e.enableNewAutoFillAlgorithm,this.enableSPNewUI=!0===e.enableSPNewUI,this.enableMouseEventsOnButtonSubmit=!0===e.enableMouseEventsOnButtonSubmit,this.enableIconFetchOnAppLoad=!0===e.enableIconFetchOnAppLoad,this.enableLCPwdCaptureInUserNameFix=!0===e.enableLCPwdCaptureInUserNameFix,this.enableLCCloudDomainCheckFix=!0===e.enableLCCloudDomainCheckFix,this.fillUsernameMaxRetries=e.fillUsernameMaxRetries||3,this.autofillClearTimeoutInSeconds=e.autofillClearTimeoutInSeconds||120},toString:function(){return"tenantId = "+this.tenantId+", username = "+this.username+", canCreateAppInAP = "+this.canCreateAppInAP+", canCreateAppInUP = "+this.canCreateAppInUP+", enableLandCatch = "+this.enableLandCatch+", isClearClipboardEnabled = "+this.isClearClipboardEnabled+", durationForClearingClipboardPassword = "+this.durationForClearingClipboardPassword+", isFormFillEnabled = "+this.isFormFillEnabled+", entitlement = "+this.entitlement+", defaultFormFillEnabled = "+this.defaultFormFillEnabled+", isAutoLoginEnabled = "+this.isAutoLoginEnabled+", defaultAutoLoginEnabled = "+this.defaultAutoLoginEnabled+", prescribeURL = "+this.prescribeURL+", prescribeVersion = "+this.prescribeVersion+", hasSwsEntitlement = "+this.hasSwsEntitlement+", isCopyCredsFromIBEEnabled = "+this.isCopyCredsFromIBEEnabled+", enableCompromisedPasswordCheckForIBE = "+this.enableCompromisedPasswordCheckForIBE+", isEnabledLCEnhancement = "+this.isEnabledLCEnhancement+", enableEnhancedTooltip = "+this.enableEnhancedTooltip+", isEnabledLCPromptReoccurFix = "+this.isEnabledLCPromptReoccurFix+", autoLoginUXImprovement = "+this.autoLoginUXImprovement+", isTOTPEnabledForBE = "+this.isTOTPEnabledForBE+", isTOTPEnabledForSecuredPasswordBE = "+this.isTOTPEnabledForSecuredPasswordBE+", enableHandleChallenges = "+this.enableHandleChallenges+", enableAutoFillForNonPasswordTypeFields = "+this.enableAutoFillForNonPasswordTypeFields+", isCopyPasswordAllowed = "+this.isCopyPasswordAllowed+", hasWpmEntitlement = "+this.hasWpmEntitlement+", isSecuredItemsEnabled = "+this.isSecuredItemsEnabled+", ignoreMultipleLCPrompts = "+this.ignoreMultipleLCPrompts+", enableCaptchaforBE = "+this.enableCaptchaforBE+", IsCopyUsernamePwdEnabled = "+this.IsCopyUsernamePwdEnabled+", isAutoSubmitAfterEnterEnabled = "+this.isAutoSubmitAfterEnterEnabled+", isAppApearsTwiceBugFixEnabled = "+this.isAppApearsTwiceBugFixEnabled+", enableLCEnhancements = "+this.enableFNFCapture+", enabledForceAutoFill = "+this.enabledForceAutoFill+", enableOldPasswordFillBasedOnPermissions = "+this.enableOldPasswordFillBasedOnPermissions+", enableLCBrokenSitesFix = "+this.enableLCBrokenSitesFix+", disableContextMenuCheckOnAllIFrames = "+this.disableContextMenuCheckOnAllIFrames+", enableNewFilterAndSortAlgorithm = "+this.enableNewFilterAndSortAlgorithm+", enableHeader401SuccessFix = "+this.enableHeader401SuccessFix+", lcInputCount = "+this.lcInputCount+", enableBrokenLC = "+this.enableBrokenLC+", enabledIBEVersionUpdate = "+this.enabledIBEVersionUpdate+", isTotpAutoFillConfigValuesEnabled = "+this.isTotpAutoFillConfigValuesEnabled+", totpAutoFillSleep = "+this.totpAutoFillSleep+", totpAutoFillConfig = "+this.totpAutoFillConfig+", enableNewAutoFillAlgorithm = "+this.enableNewAutoFillAlgorithm+", fillUsernameMaxRetries = "+this.fillUsernameMaxRetries+", autofillClearTimeoutInSeconds = "+this.autofillClearTimeoutInSeconds+", enableLCPwdCaptureInUserNameFix = "+this.enableLCPwdCaptureInUserNameFix+", enableLCCloudDomainCheckFix = "+this.enableLCCloudDomainCheckFix},visitDisplayableFields:function(e){for(var t in this)switch(typeof this[t]){case"boolean":case"number":case"string":e(t,this[t])}},saveInLocalStorage:function(){this.expiryTime=Date.now()+72e5,d.storage.set(d.constants.names.USER_SETTINGS,this)}},d.net.CentrifyConnectionBase=function(){d.common.HasObserverBase.call(this),d.common.CentrifyBEBase.call(this)},d.net.CentrifyConnectionBase.prototype={loggerName:d.constants.names.CENTRIFY_CONNECTION,init:function(){this.status=d.net.CONNECTION_STATUS_ENUM.notSignedIn},updateStatus:function(e){void 0!==e&&(this.updateToolbarIcon(e),this.status==e?this.log("Update connection status called but status is same as current status: "+this.status):(this.log("Update connection status from "+this.status+" to "+e),this.status=e,d.storage.set(this.loggerName+"_status",e),this.updateUsernameFieldIcon(e),this.notifyObservers({status:this.status})))}},d.common.objectExtend(d.net.CentrifyConnectionBase,d.common.CentrifyBEBase),d.common.objectExtend(d.net.CentrifyConnectionBase,d.common.HasObserverBase),d.net.CentrifyServiceBase=function(){this.userSetting=null,d.common.CentrifyBEBase.call(this),d.common.HasObserverBase.call(this)},d.net.CentrifyServiceBase.prototype={superpodHostname:null,superPodCookieName:null,childpodHostname:null,status:d.net.SERVICE_STATUS_ENUM.notReady,clientInfo:null,isChildPodChanged:!1,alternativepodHostName:null,alternativepodCookieName:null,brandAlternativeTenantDomains:null,clearFailedSettingTimer:null,cleanUpFailedSettingStatus:function(){this.status===d.net.SERVICE_STATUS_ENUM.failedSetting&&this.setStatusAndNotifyObservers(d.net.SERVICE_STATUS_ENUM.notReady),this.clearFailedSettingTimer&&(clearTimeout(this.clearFailedSettingTimer),this.clearFailedSettingTimer=null)},isLoggedIntoShell:function(){return d.storage.get(d.preference.perfKeyEnum.isLoggedInShellTenant)},loggedInShellTenantDetails:function(){return d.storage.get(d.preference.perfKeyEnum.loggedInShellTenantDetails)},getBearerToken:async function(){var e;return await this.isLoggedIntoShell()?(e=await this.loggedInShellTenantDetails(),(await d.cookieUtil.retrieveCookie(e.masterShellTenant,"idToken-"+e.tenantUUID))?.value):null},getFromCache:async function(e){var t=new Date,s=await d.storage.get(d.preference.perfKeyEnum.cache)||{};if(s[e]?.expiryTime>t.getTime())return s[e]?.value},setToCache:async function(e,t,s){var n=new Date,i=await d.storage.get(d.preference.perfKeyEnum.cache)||{};i[e]={expiryTime:n.getTime()+6e4*s,value:t},d.storage.set(d.preference.perfKeyEnum.cache,i)},cleanUpUserData:function(){this.log("cleaning up appsupdater,  user settings"),d.storage.remove(d.constants.names.APPS_UPDATER),d.storage.remove(d.constants.names.SECURED_ITEMS_UPDATER),d.storage.remove(d.constants.names.USER_SETTINGS)},cleanUpShellTenantDetails:function(){d.storage.remove(d.preference.perfKeyEnum.loggedInShellTenantDetails),d.storage.remove(d.preference.perfKeyEnum.isLoggedInShellTenant)},refreshToken:async function(){var e=(await this.loggedInShellTenantDetails()).masterShellTenant;return await this.getRequest(`https://${e}/api/idadmin/oauth2/refreshplatformtoken`),!0},getRequest:function(e,t,s,n){return this.request(e,null,t,s,"GET",!1,n)},postRequest:function(e,t,s,n,i){return this.request(e,t,s,n,"POST",!1,i)},request:async function(s,n,i,a,r,o,e){var t,l=this,p=(e=e||await l.getBearerToken(),void 0===r&&(r="post"),null!==n&&JSON.stringify(n),new Headers);if(p.append("Content-Type","application/json"),p.append("X-IDAP-NATIVE-CLIENT","TRUE"),e&&p.append("Authorization","Bearer "+e),"post"==r&&({method:r,headers:p}.body=n),s.startsWith("http"))t=s;else{if(!this.childpodHostname)return void this.log("childpodHostname missing, unable to request by relative path");t="https://"+this.childpodHostname+s}this.log("Request URL: "+t),this.log("Request headers: "+JSON.stringify(p));e=new Request(t,{method:r,headers:p,body:null!==n?JSON.stringify(n):null});async function u(e){var t;return 200<=e.status&&e.status<300?Promise.resolve(e):401!==e.status||o||!await l.isLoggedIntoShell()?((t=new Error(e.statusText)).statusCode=e.status,Promise.reject(t)):(await l.refreshToken(),void l.request(s,n,i,a,r,!0))}function c(e){if(e)return e.json()}return i?fetch(e).then(u).then(c).then(function(e){e&&(l.log("Request succeeded with JSON response"),i(e))}).catch(function(e){l.logError("Error in response: "+e),a&&a("Error in response: "+e,e.statusCode)}):fetch(e).then(u).then(c)},getBase64ImageFromURL:async e=>{e=await fetch(e);if(e.ok&&e.headers?.get("Content-Type")?.toLowerCase().includes("image")){let n=await e.blob();return new Promise((t,e)=>{let s=new FileReader;s.readAsDataURL(n),s.onloadend=()=>{var e=s.result;t(e)},s.onerror=e})}},handlePageReload:async function(e){var s=new URL(e.url).hostname;if(await d.common.matchesAlternateTenantDomain(s)){let e=await d.cookieUtil.retrieveCookie(s,".ASPXAUTH");if(e&&e.value)this.checkCurrentStatusOnSA(s);else{var n=await d.cookieUtil.retrieveAllCookies({url:`https://${s}/`});for(let t=0;t<n.length;t++){let e=n[t];e.name.startsWith("idToken-")&&(this.log(`Has ${e.name} cookie, trying shell login`),await this.checkCurrentStatusOnShell(s,e.name))}}}else this.log("Ignoring cookie which is not matching the tenant tabHostName "+s)},cookieChangeHandler:async function(e,t){var s=this;if(".ASPXAUTH"===e){if(!await d.common.matchesAlternateTenantDomain(t))return void s.log("Ignoring cookie which is not matching the tenant domain "+e+":"+t);s.log("Cookie matches alternate tenant domain & is userdata cookie or aspxauth. '"+e+"' changed."),s.checkCurrentStatusOnSA(t)}e.startsWith("idToken-")&&(await d.common.matchesAlternateTenantDomain(t)?s.checkCurrentStatusOnShell(t,e):s.log("Ignoring cookie which is not matching the tenant domain "+e+":"+t))},getShellUserportURL:async function(e){try{var t,s,n,i,a,r=new URL(e).host.split(".")[0],o=new URL(e).hostname,l=d.preference.perfKeyEnum.shellURLsCache+"."+o,p=await this.getFromCache(l);return p?p:(t=`${e.replace(r,"platform-discovery")}/${d.constants.PLATFORM_DISCOVERY_URL}/${r}/identity_user_portal`,n=(s=await this.getRequest(t))?.api_endpoint,i=s?.default_url,n?(a={upIdentityURL:new URL(n).host,shellDefaultURLHost:i?new URL(i).host:null},this.setToCache(l,a,120),a):void 0)}catch(e){return{}}},checkCurrentStatusOnShell:async function(e,t,s){var n,i,a,r=this,o=(this.log(`checking login status on shell tenant ${e} with cookie `+e),t.split("idToken-")[1]),l=await this.getStoredChildpodHostname(),p=await this.loggedInShellTenantDetails()||l,u=p?.tenantUUID,c=await d.cookieUtil.retrieveCookie(e,t);return c&&c.value?!!(c=d.util.parseJWT(c.value)?.tenant_subdomain)&&(o!==u&&e!==l||r.status===d.net.SERVICE_STATUS_ENUM.notReady?(l=new URL(c).host,!!(i=(a=await r.getShellUserportURL(c)).upIdentityURL)&&(l=a.shellDefaultURLHost||l,s&&e!==l?(this.log(`no need to prompt, but cookie_domain: ${e} is not the master shell tenant `+l),!1):(a=p?.masterShellTenant||p,s||u&&o===u||a===l?(this.log("login silently for "+l),d.storage.set(d.preference.perfKeyEnum.loggedInShellTenantDetails,{masterShellTenant:l,upIdentityURL:i,tenantUUID:o}),n=r.userSetting?d.net.SERVICE_STATUS_ENUM.ready:d.net.SERVICE_STATUS_ENUM.waitForSetting,d.storage.set(d.preference.perfKeyEnum.associatedChildPod,i),d.storage.set(d.preference.perfKeyEnum.isLoggedInShellTenant,!0),r.childpodHostname=i,r.log("IBE is ready. status = "+n),r.updateStatus(n),!0):(p={currChildPod:a,newChildPod:{masterShellTenant:l,upIdentityURL:i,tenantUUID:o},isShell:!0},this.log("Prompting for login on "+l),void r.promptChangeHostname(p))))):(this.log(`user is already logged into ${c}, ignoring the second attempt.`),!1)):(u&&o===u&&(n=d.net.SERVICE_STATUS_ENUM.notReady,r.log("cookie does not exist, setting status to not ready. childpodHostname = "+r.childpodHostname),d.cookieUtil.deleteCookie(e,t),r.cleanUpUserData(),r.updateStatus(n),d.formfill.appsUpdater.clearData()),!1)},getStoredChildpodHostname:function(){return d.storage.get(d.preference.perfKeyEnum.associatedChildPod)},checkCurrentStatus:async function(e,s){var t;if(e)await this.isLoggedIntoShell()?(this.log("Already logged into shell tenant, trying shell login"),t=await this.loggedInShellTenantDetails(),this.checkCurrentStatusOnShell(t.upIdentityURL,"idToken-"+t.tenantUUID)):this.checkCurrentStatusOnSA(e);else{let t;t=await this.isLoggedIntoShell()?(await this.loggedInShellTenantDetails()).masterShellTenant:await this.getStoredChildpodHostname(),t=!s&&t||this.superpodHostname,this.log("triggering login on superPodHostName "+t);var n=await d.cookieUtil.retrieveAllCookies({url:`https://${t}/`});if(-1!==n.findIndex(e=>".ASPXAUTH"===e.name))this.log("Has .ASPXAUTH cookie, trying standalone login"),this.checkCurrentStatusOnSA();else{for(let e=0;e<n.length;e++){var i=n[e];if(i.name.startsWith("idToken-"))if(this.log(`Has ${i.name} cookie, trying shell login`),await this.checkCurrentStatusOnShell(t,i.name,!0))return}this.log("IBE is not ready. childpodHostname = "+t),this.cleanUpUserData(),s&&this.cleanUpShellTenantDetails(),this.updateStatus(d.net.SERVICE_STATUS_ENUM.notReady)}}},checkCurrentStatusOnSA:async function(e){var t,s,n=this,i=(n.childpodHostname=await n.getStoredChildpodHostname(),await this.isLoggedIntoShell());e&&i&&e===n.childpodHostname||(e=e||n.childpodHostname||n.superpodHostname,t=await d.cookieUtil.retrieveCookie(e,".ASPXAUTH"),s=d.net.SERVICE_STATUS_ENUM.notReady,n.log("Cookie host to use "+e+" "+e.length),n.log("Child pod host name "+n.childpodHostname+" "+n.childpodHostname.length),t&&t.value&&e!==n.childpodHostname?(i={currChildPod:i?(await this.loggedInShellTenantDetails())?.masterShellTenant:n.childpodHostname,newChildPod:e},n.promptChangeHostname(i)):t&&t.value?(n.cleanUpShellTenantDetails(),s=n.userSetting?d.net.SERVICE_STATUS_ENUM.ready:d.net.SERVICE_STATUS_ENUM.waitForSetting,n.log("IBE is ready. status = "+s),n.updateStatus(s)):e===n.childpodHostname&&(s=d.net.SERVICE_STATUS_ENUM.notReady,n.log("IBE is not ready. childpodHostname = "+n.childpodHostname),d.cookieUtil.deleteCookie(e,".ASPXAUTH"),d.storage.remove(d.constants.names.APPS_UPDATER),d.storage.remove(d.constants.names.USER_SETTINGS),n.updateStatus(s),d.formfill.appsUpdater.clearData()))},loggerName:d.constants.names.CENTRIFY_SERVICE,init:function(e,t){this.userSetting=null,this.superpodHostname=e,this.superPodCookieName=null,this.childpodHostname=null,this.clientInfo=this.getClientInfo(),this.log("superpodHostname = "+this.superpodHostname),this.superpodHostname||(this.superpodHostname=d.brand.defaultPortalHostname),this.superPodCookieName=this.superpodHostname.substring(this.superpodHostname.indexOf(".")),this.brandAlternativeTenantDomains=d.brand.brandAlternativeTenantDomains,this.checkCurrentStatus(null,t)},promptChangeHostname:function(e){},getClientInfo:function(){return{userAgent:""}},getChildPodFromPodloc:function(e,t){this.logTrace("checking podloc");t=t||this.superpodHostname;if(t.includes("my"))return t;if(e){this.logTrace("podlocStr = "+e);try{var s=e.replace(/\./g,"+").replace(/\-/g,"/").replace(/_/g,"=");e=atob(s)}catch(e){if(this.isInvalidCharacterError(e))return;throw e}s=JSON.parse(e)[t];this.logTrace("childpodHostname = "+s)}else this.logTrace("no podloc");return s},isInvalidCharacterError:function(e){return e instanceof DOMException&&"InvalidCharacterError"===e.name},updateStatus:function(e,t){this.log(`update service status called with status: ${e}, current status is `+this.status);var s=!1;if(e==d.net.SERVICE_STATUS_ENUM.ready&&"undefined"!=typeof navigator&&null!==navigator&&navigator.onLine&&this.status==d.net.SERVICE_STATUS_ENUM.ready&&d.net.signalrClient.stat.status==d.net.SIGNALR_STATUS_ENUM.Disconnected&&(s=!0),this.status!=e||this.isChildPodChanged||s){if(s&&this.log("update status from "+this.status+" to "+e+". To make a fresh signalr connection as it is missing right now."),e==d.net.SERVICE_STATUS_ENUM.waitForSetting||this.isChildPodChanged){if(this.status===d.net.SERVICE_STATUS_ENUM.failedSetting){if(!this.isChildPodChanged)return void this.log("Service status is set to failed, so not calling querying settings again.");this.clearFailedSettingTimer&&(clearTimeout(this.clearFailedSettingTimer),this.clearFailedSettingTimer=null)}this.userSetting&&!this.isChildPodChanged||(this.status=e,d.storage.set(this.loggerName+"_status",e),this.querySetting(t))}else e==d.net.SERVICE_STATUS_ENUM.notReady&&(this.userSetting=null),this.log("update status from "+this.status+" to "+e),this.status=e,d.storage.set(this.loggerName+"_status",e),this.notifyObservers({status:this.status});this.isChildPodChanged=!1}else this.log("update status is same, will not notify observer.")},setStatusAndNotifyObservers:function(e){this.status=e,this.notifyObservers({status:this.status})},querySetting:async function(s){var t,n=this;function i(e){var t=!n.userSetting||n.userSetting.tenantId!==e.tenantId;n.userSetting=e,n.status=d.net.SERVICE_STATUS_ENUM.ready,d.storage.set(n.loggerName+"_status",d.net.SERVICE_STATUS_ENUM.ready),t?n.notifyObservers({userSetting:n.userSetting,status:n.status}):n.notifyObservers({userSetting:e}),s&&s(e)}let a=await d.storage.get(d.constants.names.USER_SETTINGS);a?.expiryTime>Date.now()?(n.log("Using Cache and not calling GetCbeSettings API for settings"),t=new d.net.UserSetting(a),Object.keys(t).map(e=>{t[e]=a[e]}),i(t)):(n.logTrace("Calling GetCbeSetting api"),n.getRequest("/Cbe/GetCbeSetting?version="+d.brand.version,function(e){var t;e.success?((t=new d.net.UserSetting(e.Result)).saveInLocalStorage(),i(t)):(n.setStatusAndNotifyObservers(d.net.SERVICE_STATUS_ENUM.failedSetting),n.clearFailedSettingTimer=setTimeout(()=>{n.cleanUpFailedSettingStatus()},d.constants.SETTINGS_FAIL_TIMEOUT),n.logError("/Cbe/GetCbeSetting fails result = "+JSON.stringify(e)))},function(){n.status=d.net.SERVICE_STATUS_ENUM.notReady,n.notifyObservers({status:n.status})}))},setSetting:function(s,n,i){var e,a=this,t={};for(e in s)t[e]={newValue:s[e],oldValue:a.userSetting.raw[e]};a.log("setSetting updates = "+JSON.stringify(t)),this.request("/Cbe/SetCbeSetting",t,function(e){if(e.success){Object.keys(s);for(var t in s)a.userSetting.raw[t]=s[t];a.userSetting.init(),a.notifyObservers.call(a,{userSetting:a.userSetting}),n&&n()}else a.log("setSetting failed "+e.Message),i&&i(e.Message)},i)}},d.common.objectExtend(d.net.CentrifyServiceBase,d.common.CentrifyBEBase),d.common.objectExtend(d.net.CentrifyServiceBase,d.common.HasObserverBase),d.net.SIGNALR_STATUS_ENUM={Disconnected:"disconnected",Connecting:"connecting",Connected:"connected",Error:"error"},d.net.SignalrClientBase=function(e){d.common.CentrifyBEBase.call(this),d.common.HasObserverBase.call(this),this.centrifyService=e,this.stat={status:d.net.SIGNALR_STATUS_ENUM.Disconnected,connectionId:null,lastError:null,stopCalled:!1}},d.net.SignalrClientBase.prototype={loggerName:"signalR",isConnected:function(){return!!this.connection},connect:async function(){var e,n=this;if(this.isConnected())throw"already connected to signalR";this.stat.status=d.net.SIGNALR_STATUS_ENUM.Connecting,this.log("connecting to "+this.centrifyService.childpodHostname),this.connection=await this.handleGetConnection(),null===this.connection?n.logError("Please implement signalR."):(this.connection.reconnecting(function(){n.log("reconnecting to signalR"),n.stat.status=d.net.SIGNALR_STATUS_ENUM.Connecting,n.notifyObservers({status:d.net.SIGNALR_STATUS_ENUM.Connecting})}),this.connection.reconnected(function(){n.log("reconnected to signalR"),n.stat.status=d.net.SIGNALR_STATUS_ENUM.Connected,n.stat.connectionId=n.connection.id,n.notifyObservers({status:d.net.SIGNALR_STATUS_ENUM.Connected})}),this.connection.disconnected(function(){n.stat.status=d.net.SIGNALR_STATUS_ENUM.Disconnected;var e=d.net.centrifyService.status===d.net.SERVICE_STATUS_ENUM.notReady,t=n.connection.lastError?n.connection.lastError.message:"unknown";n.log(`disconnected. Reason: ${t} and service status is `+d.net.centrifyService.status),n.connection.lastError&&!e||!n.stat.stopCalled||(n.stat.stopCalled=!1,t=d.net.SERVICE_STATUS_ENUM.notReady,d.net.centrifyService.updateStatus(t),n.log("Signalr is unable to recover from disconnected state or user has logged out of current session. We won't attempt reconnect until user has any interactions. Therefore, resetting the BE state to not ready."),n.notifyObservers({status:d.net.SIGNALR_STATUS_ENUM.Disconnected}))}),(e=this.connection.createHubProxy("managementHub")).on("broadcast",function(e,t,s){n.handleBroadcast(e,t,s)}),this.connection.start().done(function(){n.log("Now connected, connection ID="+n.connection.id),e.invoke("subscribeToGroups").done(function(){n.stat.status=d.net.SIGNALR_STATUS_ENUM.Connected,n.stat.connectionId=n.connection.id,n.log("Invocation of subscribeToGroups succeeded"),n.notifyObservers({status:d.net.SIGNALR_STATUS_ENUM.Connected})}).fail(function(e){n.stat.status=d.net.SIGNALR_STATUS_ENUM.Error,n.logError("Invocation of subscribeToGroups failed. Error: "+e),n.notifyObservers({status:d.net.SIGNALR_STATUS_ENUM.Error})})}).fail(function(e){n.stat.status=d.net.SIGNALR_STATUS_ENUM.Error,n.logError("Could not connect. "+e),n.notifyObservers({status:d.net.SIGNALR_STATUS_ENUM.Error})}))},handleGetConnection:async function(){var e=$.hubConnection("https://"+this.centrifyService.childpodHostname+"/signalr",{useDefaultPath:!1}),t=await d.net.centrifyService.getBearerToken();return t&&(e.accessToken=t),e},handleBroadcast:function(e,t,s){switch(this.log("handleBroadcast: target = "+e+", type = "+t+", data = "+JSON.stringify(s)),e){case"All":case"Tenant":break;case"Role":switch(t){case"Cloud.Saas.UpdateApp":this.updateSpecificApp(s);break;case"Cloud.Saas.UnPublishApp":this.unpublishSpecificApp(s);break;case"Cloud.Saas.PublishApp":this.publishSpecificApp(s);break;case"Cloud.Saas.RefreshAllApps":this.notifyUpDateAllApps(t,s)}break;case"User":switch(t){case"Cloud.Saas.RefreshAllApps":this.notifyUpDateAllApps(t,s);break;case"Cloud.Saas.UpdateApp":this.updateSpecificApp(s);break;case"Cloud.Saas.UnPublishApp":this.unpublishSpecificApp(s);break;case"Cloud.Saas.PublishApp":this.publishSpecificApp(s);break;case"Cloud.Saas.ModifyApplicationShortcuts":case"Cloud.Saas.SetUserCreds":case"Cloud.Saas.SetCbeAppSetting":this.updateAllApps();break;case"Cloud.Saas.SetDefaultTag":this.updateDefaultTag(s);break;case"Cloud.Saas.UpsertTagsForApp":this.updateTagsForApp(s);break;case"Cloud.Saas.PublishSecuredItem":this.publishSpecificSecuredItem(s.SecuredItem);break;case"Cloud.Saas.UpdateSecuredItem":this.updateSpecificSecuredItem(s);break;case"Cloud.Saas.UnPublishSecuredItem":this.unpublishSpecificSecuredItem(s);break;case"Cloud.Saas.RefreshAllSecuredItems":this.updateAllSecuredItems(s)}}},disconnect:function(e){e&&(this.log("disconnect connection"),this.isConnected()&&this.connection.state===$.signalR.connectionState.connected?(this.log("Signalr is still connected, disconnecting Signalr"),this.stat.stopCalled=e,this.connection.stop()):(this.log("Signalr is already disconnected, now updating the popover status"),this.notifyObservers({status:d.net.SIGNALR_STATUS_ENUM.Disconnected}))),this.connection=null},statusUpdater:function(e){try{e===d.net.SERVICE_STATUS_ENUM.ready?(this.isConnected()&&this.disconnect(!1),this.connect()):this.disconnect(!0)}catch(e){this.logError("error in signalr "+e)}},getStat:function(){return{status:this.stat.status,connectionId:this.stat.connectionId,lastError:this.stat.lastError}},updateAllApps:function(){},notifyUpDateAllApps:function(e,t){},updateSpecificApp:function(e){},unpublishSpecificApp:function(e){},publishSpecificApp:function(e){},updateDefaultTag:function(e){},updateTagsForApp:function(e){}},d.common.objectExtend(d.net.SignalrClientBase,d.common.CentrifyBEBase),d.common.objectExtend(d.net.SignalrClientBase,d.common.HasObserverBase),d.formfill.FFAppStatus={IMPOSSIBLE:1,NOT_READY:2,READY:3,INCOMPLETE:4,DISABLE:-1,USERNAMEPASSWORDAPPWITHOUTHOST:5},d.formfill.FFApp=function(e,t){this.raw=e,this.appkey=e.AppKey,this.name=e.Name,this.displayName=e.CpsHostname||e.DisplayName,this.category=e.Category||e.AdminTag,this.url=e.Url,this.username=e.Username,this.corpId=e.CorpIdentifier,this.scheme=e.Scheme,this.hostnamePattern=e.HostNameSuffix,this.usernamePattern=e.UsernameField,this.passwordPattern=e.PasswordField,this.corpIdPattern=e.CorpIdField,this.submitPattern=e.SubmitField,this.formPattern=e.FormField,this.formAction=e.FormAction,this.order=e.Order,this.additionalIdentifier=e.AdditionalIdentifier,this.additionalIdentifierValue=e.AdditionalIdentifierValue,this.identifierObject=e.IdentifierObject,this.checkStatusURL=e.CheckStatusURL,this.appLogOutURL=e.AppLogOutURL,this.isSharedAccout=!!e.UsernameIsShared,this.version=e.Version||"1",this.isNewApp=e.IsNewApp,this.isSwsEnabled=e.IsSwsEnabled,this.newPasswordPattern=e.GeneratePasswordField,this.newPasswordConfirmPattern=e.GeneratePasswordConfirmField,this.IsPwdCompromised=e.IsPwdCompromised,this.CanViewCreds=e.CanViewCreds,this.AllowViewFixedCredentials=void 0!==e.AllowViewFixedCredentials&&e.AllowViewFixedCredentials,this.IsMFAEnabled=void 0!==e.IsMFAEnabled&&e.IsMFAEnabled,this.Personal=e.Personal,this.IsPromptForUsername=void 0!==e.IsPromptForUsername&&e.IsPromptForUsername,this.currentPasswordPattern=e.GeneratePasswordCurrentField,this.IsRestrictedEmailDomain=void 0!==e.IsRestrictedEmailDomain&&e.IsRestrictedEmailDomain,this.IsRestrictedApp=void 0!==e.IsRestrictedApp&&e.IsRestrictedApp,this.UPAppWithoutHost=!("UsernamePassword"!==e.WebAppType||void 0!==e.HostNameSuffix||t.enabledAppsURLPatternCheck&&e.UrlMatchDetection),this.IsTotpEnabled=void 0!==e.IsTotpEnabled&&e.IsTotpEnabled,this.canSaveCreds=void 0===e.CanSaveCreds||e.CanSaveCreds,this.isSharedPersonalApp=e.Personal&&void 0!==e.SharedBy,this.isPrivilegedApp=!0===e.IsPrivilegedApp,this.urlMatchDetection=e.UrlMatchDetection,this.matchPattern=e.MatchPattern,this.setting=e.setting?{isAutoLoginEnabled:e.setting.isAutoLoginEnabled}:{},this.updateComputedValues(t,this.UPAppWithoutHost)},d.securedItem.SecuredItem=function(e){this.raw=e,this.itemKey=e.ItemKey,this.name=e.Name,this.displayName=e.DisplayName,this.icon=e.Icon,this.iconPath=e.IconPath,this.canModifyItem=e.CanModifyItem,this.isShareable=e.IsShareable,this.description=e.Description,this.IsRestrictedEmailDomain=e.IsRestrictedEmailDomain,"password"===e.SecuredItemType.toLowerCase()?(this.securedItemType="Passwords",this.isUsernameSet=e.IsUsernameSet,this.isPasswordSet=e.IsPasswordSet,this.isPasswordCompromised=e.IsPwdCompromised):"securenote"===e.SecuredItemType.toLowerCase()&&(this.securedItemType="Secured Notes"),this.tags=e.Tags},d.formfill.FFApp.prototype={readiness:null,updateComputedValues:function(e,t){this.raw.InComplete?this.readiness=d.formfill.FFAppStatus.INCOMPLETE:"Web"!==this.raw.AppType||"UsernamePassword"!==this.raw.WebAppType||"BrowserExtension"!==this.raw.WebUPAppType&&!t||this.raw.ShowState&&"Locked"==this.raw.ShowState&&"Elevate"==this.raw.ShowState?this.readiness=d.formfill.FFAppStatus.IMPOSSIBLE:this.raw.UsernameIsShared||!0===this.raw.PasswordIsSet?e.isFormFillEnabled&&this.raw.FormFillingEnabled?this.readiness=t?d.formfill.FFAppStatus.USERNAMEPASSWORDAPPWITHOUTHOST:d.formfill.FFAppStatus.READY:this.readiness=d.formfill.FFAppStatus.DISABLE:this.readiness=d.formfill.FFAppStatus.NOT_READY},visitDisplayableFields:function(e){for(var t=["appkey","name","displayName","url","corpId","scheme","hostnamePattern","usernamePattern","passwordPattern","corpIdPattern","submitPattern","formPattern","formAction","isSharedAccout","readiness"],s=0;s<t.length;s++)e(t[s],this[t[s]]);e("username",this.username?"x":""),e("corpId",this.corpId?"x":""),e("order",JSON.stringify(this.order));for(var n=["AppType","WebAppType","WebUPAppType","ShowState","PasswordIsSet"],s=0;s<n.length;s++)e(n[s],this.raw[n[s]])}},d.formfill.FFNode=function(e,t){this.parent=e,this.name=t,this.apps=[],this.children={}},d.formfill.FFNode.prototype={getMatchApps:function(e){for(var t,s=[],n=0;n<this.apps.length;n++)this.apps[n].readiness===d.formfill.FFAppStatus.READY&&s.push({app:this.apps[n],node:this});return s=0<e.length&&(t=e.shift(),t=this.children[t])&&null!==(t=t.getMatchApps(e))&&0<t.length?s.concat(t):s},getMatchAppsForContextMenu:function(e){for(var t,s=[],n=0;n<this.apps.length;n++)this.apps[n].readiness!==d.formfill.FFAppStatus.READY&&this.apps[n].readiness!==d.formfill.FFAppStatus.NOT_READY&&this.apps[n].readiness!==d.formfill.FFAppStatus.USERNAMEPASSWORDAPPWITHOUTHOST||s.push({app:this.apps[n],node:this});return s=0<e.length&&(t=e.shift(),t=this.children[t])&&null!==(t=t.getMatchAppsForContextMenu(e))&&0<t.length?s.concat(t):s},getCurrentPath:function(){var e;return null===this.parent?"":(e=this.parent.getCurrentPath())?e+"."+this.name:this.name},accept:function(e){e(this);for(var t=Object.keys(this.children),s=0;s<t.length;s++)this.children[t[s]].accept(e)},print:function(e){void 0===e&&(e=0);for(var t="",s=0;s<e;s++)t+="  ";var n="",i=(n=(n+=t+"<"+(null===this.name?"ROOT":this.name)+">\n")+(t+"Apps: "+this.apps.length+"\n"),Object.keys(this.children));n+=t+"Children: "+i.length+"\n";for(s=0;s<i.length;s++)n=(n+=t+"{\n")+this.children[i[s]].print(e+1)+t+"}\n";return n}},d.formfill.AppsUpdaterBase=function(e,t){d.common.CentrifyBEBase.call(this),d.common.HasObserverBase.call(this),this.centrifyService=e,this.centrifyConnection=t,this.rootNode=new d.formfill.FFNode(null,null)},d.formfill.AppsUpdaterBase.prototype={loggerName:d.constants.names.APPS_UPDATER,useLocalCache:!1,appkeyToAppMap:null,appsUpdateFlag:!1,appsRefreshAllFlag:!1,appTags:null,tenantId:null,username:null,status:d.formfill.APPS_UPDATER_STATUS_ENUM.NotReady,connectionSince:null,lastUpdate:null,lastError:null,maxTimeTick:3155378976e9,tryGetAppKey:function(e){return"string"==typeof e?e:"object"==typeof e?e.hasOwnProperty("_RowKey")?e["_RowKey"]:e.hasOwnProperty("Application")?e["Application"]:void 0:void 0},addNode:function(e,t,s){if(t&&s){if("UsernamePassword"===e.raw.WebAppType&&void 0===e.hostnamePattern&&(e.hostnamePattern=this.extractHostName(e)),e.hostnamePattern){for(var n=e.hostnamePattern.split(".").reverse(),i=0;i<n.length;i++){var a=t.children[n[i]];a||(t.children[n[i]]=new d.formfill.FFNode(t,n[i]),a=t.children[n[i]]),t=a}t.apps.push(e)}s[e.appkey]=e}},extractHostName:function(t){if(null!=t.url&&""!==t.url)try{return this.centrifyService.userSetting.enabledAppsURLPatternCheck&&t.urlMatchDetection?(t.url=t.url.replaceAll("%",""),new URL(t.url).host.split(".").slice(-2).join(".")):new URL(t.url).host}catch(e){this.logWarn("App url is not in valid format: "+t.url)}return null},deleteNode:function(e,t,s){var r;if(t&&s)return e=e.appkey,r=!1,e?(delete s[e],function e(t,s){if(t&&t.apps){for(var n,i=t.apps,a=i.length;a--;)i[a].appkey==s&&(i.splice(a,1),r=!0);for(n in t.children)e(t.children[n],s)}}(t,e)):this.logWarn("App can't be deleted since missing appkey"),r},updateNode:function(e,t,s){this.deleteNode(e,t,s),this.addNode(e,t,s)},setNeedUpdateApps:function(e,t,s,n){null!=e&&(this.appsUpdateFlag=e),null!=t&&(this.appsRefreshAllFlag=t),s&&this.notifyObservers({status:this.status,flags:[this.appsUpdateFlag,this.appsRefreshAllFlag],updateData:n})},removeNewAppProp:function(e){this.appkeyToAppMap&&this.appkeyToAppMap.hasOwnProperty(e)&&(this.appkeyToAppMap[e].isNewApp=!1)},updateSpecificApp:function(e){var t=this.tryGetAppKey(e);t?e.hasOwnProperty("_RowKey")?(this.log("Must be IsNew property removed, will notify the observers"),this.removeNewAppProp(t),this.setNeedUpdateApps(null,null,!0,{type:"Cloud.Saas.UpdateApp",appkey:t})):(e=new d.formfill.FFApp({AppKey:t,InComplete:!0},this.centrifyService.userSetting),this.log("Entire app :"+t+" needs update, set the appsUpdateFlag"),this.updateNode(e,this.rootNode,this.appkeyToAppMap),this.setNeedUpdateApps(!0,null,!1,{type:"Cloud.Saas.UpdateApp",appkey:t})):this.log("can not get appkey from the signalR data")},unpublishSpecificApp:function(e){var t,e=this.tryGetAppKey(e);e?(t=new d.formfill.FFApp({AppKey:e},this.centrifyService.userSetting),this.deleteNode(t,this.rootNode,this.appkeyToAppMap)):this.log("can not get appkey from the signalR data"),this.setNeedUpdateApps(null,null,!0,{type:"Cloud.Saas.UnPublishApp",appkey:e}),this.log("Deleted app: "+e+" from app cache"),this.notifyAppsUpdate()},publishSpecficApp:function(e){var t,s=this,e=this.tryGetAppKey(e);e?(t=new d.formfill.FFApp({AppKey:e,InComplete:!0},this.centrifyService.userSetting),this.log("New app: "+e+" will be published, set the appsUpdateFlag"),this.addNode(t,this.rootNode,this.appkeyToAppMap),this.setNeedUpdateApps(!0,null,!1,{type:"Cloud.Saas.PublishApp",appkey:e}),setTimeout(function(){s.notifyAppsUpdate()},2e3)):this.log("can not get appkey from the signalR data")},addAllApps:function(e){for(var t=new d.formfill.FFNode(null,null),s={},n="app count = "+e.apps.length,i=0;i<e.apps.length;i++){var a=e.apps[i];!0!==a.IsRestrictedApp&&!0!==a.IsRestrictedEmailDomain&&(n+=" ,"+a.displayName+"("+a.appkey+")",this.addNode(a,t,s))}this.logTrace(n),this.lastUpdate=e.lastUpdate,this.tenantId=e.tenantId,this.username=e.username,this.rootNode=t,this.appkeyToAppMap=s,this.notifyAppsUpdate(e)},addAllTags:function(e,t){e&&(delete(e=e.reduce(function(e,t){return e[t.tagname]=t,e},{}))["allusertags"],this.appTags=e,this.appDefTag=t)},transformToCBEFormat:function(e){for(var t=[],s=0;s<e.length;s++){var n=new d.formfill.FFApp(e[s],this.centrifyService.userSetting);t.push(n)}return{apps:t}},updateAppIconsWithBase64Image:async function({apps:e}){for(var t=0;t<e.length;t++){var s=e[t];if(!s.raw.Icon.startsWith("data")&&this.centrifyService.userSetting.enableIconFetchOnAppLoad)try{s.raw.Icon=await this.centrifyService.getBase64ImageFromURL(`https://${this.centrifyService.childpodHostname}/`+s.raw.Icon)}catch(e){this.logError("Icon fetch failed for app "+s.appkey)}}return{apps:e}},getDataToSave:function(){var e,t=[];for(e in this.appkeyToAppMap)t.push(this.appkeyToAppMap[e].raw);return{apps:t,createTime:(new Date).getTime(),version:1,lastUpdate:this.lastUpdate,tenantId:this.tenantId,username:this.username}},update:function(t,i,s){var a=this;this.status!==d.formfill.APPS_UPDATER_STATUS_ENUM.Requesting&&(a.status=d.formfill.APPS_UPDATER_STATUS_ENUM.Requesting,a.notifyObservers({status:a.status}),(async()=>{var n;async function e(e){var t,s;e?(t=a.transformToCBEFormat(e.apps),t=await a.updateAppIconsWithBase64Image(t),s=e.tags,t.lastUpdate=e.lastUpdate,t.tenantId=e.tenantId,t.username=e.username,a.logTrace("Reading from Cache, lastUpdate = "+t.lastUpdate+", tenantId = "+t.tenantId+", username = "+t.username),a.addAllApps(t),a.addAllTags(s),a.status=d.formfill.APPS_UPDATER_STATUS_ENUM.Ready,a.setNeedUpdateApps(!1,!1,!1),a.notifyObservers({status:a.status}),a.noticeReady()):(a.connectionSince=new Date,a.centrifyService.getRequest("/Cbe/GetApps?ts="+i+"&gettag="+n+"&userAgent="+a.centrifyService.clientInfo.userAgent,async function(e){var t,s;e.success?(t=a.transformToCBEFormat(e.Result.apps),t=await a.updateAppIconsWithBase64Image(t),s=e.Result.tags,e=e.Result.defTag,t.lastUpdate=new Date,t.tenantId=a.centrifyService.userSetting.tenantId,t.username=a.centrifyService.userSetting.username,a.logTrace("fresh from server, timestamp = "+i+", lastUpdate = "+t.lastUpdate+", tenantId = "+t.tenantId+", username = "+t.username),a.addAllApps(t),a.addAllTags(s,e),a.useLocalCache&&a.writeToLocal(),a.status=d.formfill.APPS_UPDATER_STATUS_ENUM.Ready,a.notifyObservers({status:a.status})):(a.lastError="TODO error",a.status=d.formfill.APPS_UPDATER_STATUS_ENUM.Error,a.notifyObservers({status:a.status}),a.log("bad result")),a.log("GetApps request is done, set flags: updateFlag=false, refreshFlag=false, notifyFlag=false"),a.setNeedUpdateApps(!1,!1,!1),a.noticeReady()},function(){a.status=d.formfill.APPS_UPDATER_STATUS_ENUM.Error,a.log("GetApps request has error, set flags: updateFlag=false, refreshFlag=false, notifyFlag=false"),a.setNeedUpdateApps(!1,!1,!1),a.notifyObservers({status:a.status}),a.noticeReady()}))}!a.appkeyToAppMap&&await a.readFromLocalStorage()?(a.log("Using Cache and not calling GetApps API for apps information"),a.status=d.formfill.APPS_UPDATER_STATUS_ENUM.Ready,a.notifyObservers({status:a.status}),a.setNeedUpdateApps(!1,!1,!1),a.noticeReady()):(n=!!s,t&&a.useLocalCache?a.readFromLocal(e):e(null))})())},getAppDataByKey:function(i,a){var r=this;this.centrifyService.request("/Cbe/GetAppsByKeys",{appkeys:i},async function(e){if(e.success){var t=r.transformToCBEFormat(e.Result);(t=await r.updateAppIconsWithBase64Image(t)).lastUpdate=new Date,t.tenantId=r.centrifyService.userSetting.tenantId,t.username=r.centrifyService.userSetting.username,r.logTrace("get apps by appkeys from server: "+i);for(var s=0;s<t.apps.length;s++){var n=t.apps[s];a&&a(n),r.updateNode(n,r.rootNode,r.appkeyToAppMap)}r.status=d.formfill.APPS_UPDATER_STATUS_ENUM.Ready,r.notifyObservers({status:r.status}),r.notifyAppsUpdate(),r.noticeReady()}else r.lastError="TODO error",r.status=d.formfill.APPS_UPDATER_STATUS_ENUM.Error,r.notifyObservers({status:r.status}),a&&a(null),r.log("bad result");r.log("GetAppsByKeys request is done, set flags: updateFlag=false, refreshFlag=null, notifyFlag=false"),r.setNeedUpdateApps(!1,null,!1)},function(){r.status=d.formfill.APPS_UPDATER_STATUS_ENUM.Error,r.log("GetAppsByKeys request has error, set flags: updateFlag=false, refreshFlag=null, notifyFlag=false"),r.setNeedUpdateApps(!1,null,!1),r.notifyObservers({status:r.status}),a&&a(null)},"POST")},asyncUpdate:function(e,t,s){var n=this;setTimeout(function(){n.update(e,t,s)},0)},updateAppIcon:async function(t,e){var s=this;try{s.log("Updating icon for "+t);var n=await s.centrifyService.getBase64ImageFromURL(e);n?s.centrifyService.postRequest("/uprest/UpdateNonCatalogApps",{appkey:t,icon:n}):s.log("Not able to fetch icon, returning")}catch(e){s.log("could not update icon for app "+t)}},updateDefaultTag:function(e){this.appDefTag=e,this.notifyObservers({event:"setDefaultTag"})},updateAppTags:function(e,t){if(this.appTags&&e){for(var s,n,i,a=0;a<t.length;a++){var r=t[a];this.appTags.hasOwnProperty(r)||(this.appTags[r]={appkeys:[e],tagdisplayname:r,tagname:r,type:"user"})}for(s in this.appTags)this.appTags.hasOwnProperty(s)&&"user"==(n=this.appTags[s]).type&&(r=n.tagname,i=(n=n.appkeys).indexOf(e),-1<t.indexOf(r)?-1<i||n.push(e):(-1<i&&n.splice(i,1),0==n.length&&delete this.appTags[s]));this.notifyObservers({event:"updateAppTags"})}else this.log("no appTag obtained before or invalid appkey, something is wrong")},checkForUpdate:function(){if(this.appsRefreshAllFlag)this.appsRefreshAllFlag=!1,this.log("Found appsRefreshFlag, will get all apps"),this.asyncUpdate(!1,this.maxTimeTick,!0);else if(this.appsUpdateFlag){this.appsUpdateFlag=!1,this.log("Found appsUpdateFlag, meaning some apps need to be retrieved or updated");var e,t=[];for(e in this.appkeyToAppMap){var s=this.appkeyToAppMap[e];s.readiness==d.formfill.FFAppStatus.INCOMPLETE&&t.push(s.appkey)}this.getAppDataByKey(t)}},getStat:function(){return{status:this.status,appCount:this.appkeyToAppMap?Object.keys(this.appkeyToAppMap).length:0,connectionSince:this.connectionSince,lastUpdate:this.lastUpdate,lastError:this.lastError}},clearData:function(){this.status=d.formfill.APPS_UPDATER_STATUS_ENUM.NotReady,this.rootNode=new d.formfill.FFNode(null,null),this.appkeyToAppMap=null,this.tenantId=null,this.username=null,this.notifyObservers({status:this.status}),this.notifyClearData()},disableData:function(){this.status=d.formfill.APPS_UPDATER_STATUS_ENUM.Disable,this.notifyObservers({status:this.status}),this.notifyContentData(this.status)},enableData:function(){this.status=d.formfill.APPS_UPDATER_STATUS_ENUM.Enable,this.notifyObservers({status:this.status}),this.notifyContentData(this.status)},observer:function(){try{var e;this.centrifyService.status===d.net.SERVICE_STATUS_ENUM.ready?(e=this.centrifyService.userSetting,(this.status===d.formfill.APPS_UPDATER_STATUS_ENUM.Ready?!!e&&(e.isFormFillEnabled?e.tenantId!=this.tenantId||e.username!=this.username:(this.clearData(),!1)):this.status!==d.formfill.APPS_UPDATER_STATUS_ENUM.Requesting&&!!e)&&(e.isFormFillEnabled?this.asyncUpdate(!0,this.maxTimeTick,!0):(this.status=d.formfill.APPS_UPDATER_STATUS_ENUM.Disable,this.notifyObservers({status:this.status})))):this.clearData()}catch(e){this.log("error when getting apps "+e)}},setAppSetting:function(e,s,n,i){var t,a=this,r=this.appkeyToAppMap[e],o={appkey:e,update:{}};for(t in s)o.update[t]={newValue:s[t],oldValue:r.setting[t]};this.log("setAppSetting updates = "+JSON.stringify(o)),this.centrifyService.request("/Cbe/SetCbeAppSetting",o,function(e){if(e.success){for(var t in s)r.setting[t]=s[t];a.useLocalCache&&a.writeToLocal(),n&&n()}else a.log("setSetting failed "+e.Message),i&&i(e.Message)},i)},getMatchApps:function(e){this.checkForUpdate();e=this.rootNode.getMatchApps(e);return this.logTrace("Candidate app number = "+e.length),e},getMatchAppsForContextMenu:function(e){this.checkForUpdate();e=this.rootNode.getMatchAppsForContextMenu(e);return this.logTrace("Candidate app number = "+e.length),e},checkAppUrlPattern:function(e,t){var s=d.constants.AppURLPatternNames;switch(e.urlMatchDetection){case s.ExactMatch:return e.url===t;case s.Hostname:return this.getAppHostname(e.url)===this.getAppHostname(t);case s.BaseDomain:var n=this.getAppHostname(e.url).split("."),i=this.getAppHostname(t).split(".");return n.slice(-2).join(".")===i.slice(-2).join(".");case s.RegularExpression:return new RegExp(`^${e.matchPattern}$`).test(t);default:return!0}},getAppHostname:function(e){try{return new URL(e).hostname}catch{return""}},getAppByKey:function(e){return this.appkeyToAppMap?this.appkeyToAppMap[e]:null},getAppsByHostname:function(e,t){var s=[];if(e)if(this.rootNode&&this.status==d.formfill.APPS_UPDATER_STATUS_ENUM.Ready)for(var n=e.split(".").reverse(),i=this.rootNode.children,a=0;a<n.length;a++){var r,o=i[n[a]];o&&o.name==n[a]&&(r=o.apps,t&&(r=this.filterPersonalApp(r)),s=s.concat(r),i=o.children)}else this.log("the rootNode is still not initialized or the appsUpdater status is not ready, return empty array");else this.log("invalide hostname "+e+" return empty array");return s},filterPersonalApp:function(e){return e.filter(function(e){return!(!e||!e.appkey)&&0==e.appkey.indexOf("@~")})},getDiagnosisData:function(){var e,t=d.common.toSafeString,s="\0AppCacheStatus:\n",n=(s=(s=(s=(s+=t("Status",this.status))+t("Connection Since",this.connectionSince))+t("Last Update",this.lastUpdate))+t("Last Error",this.lastError)+"\0AppCache:\n",!0);for(e in this.appkeyToAppMap){var i,a=this.appkeyToAppMap[e],r=(n&&(i=[],a.visitDisplayableFields(function(e,t){i.push(e)}),s+=d.common.combineArray(i,"\t",!0)+"\n",n=!1),[]);a.visitDisplayableFields(function(e,t){r.push(t)}),s+=d.common.combineArray(r,"\t",!0)+"\n"}return s},notifyObservers:function(e){this.writeToLocalStorage(),d.common.HasObserverBase.prototype.notifyObservers.call(this,e)},readFromLocalStorage:async function(){var e=this,t=(this.log("Reading app data from local storage during service worker restart"),await d.storage.get(e.loggerName));return!!(t&&t.tenantId===e.centrifyService.userSetting.tenantId&&t.username===e.centrifyService.userSetting.username&&(e.appkeyToAppMap=t.appkeyToAppMap,e.appsUpdateFlag=t.appsUpdateFlag,e.appsRefreshAllFlag=t.appsRefreshAllFlag,e.appTags=t.appTags,e.appDefTag=t.appDefTag,e.appkeyToAppMap)&&t.expiryTime>Date.now()&&e.centrifyService.userSetting.ignoreMultipleLCPrompts)},writeToLocalStorage:function(){var e=Date.now()+72e5;d.storage.set(this.loggerName,{appkeyToAppMap:this.appkeyToAppMap,appsUpdateFlag:this.appsUpdateFlag,appsRefreshAllFlag:this.appsRefreshAllFlag,appTags:this.appTags,appDefTag:this.appDefTag,status:this.status,expiryTime:e,tenantId:this.centrifyService.userSetting?.tenantId,username:this.centrifyService.userSetting?.username})},notifyAppsUpdate:function(e){},noticeReady:function(){}},d.common.objectExtend(d.formfill.AppsUpdaterBase,d.common.CentrifyBEBase),d.common.objectExtend(d.formfill.AppsUpdaterBase,d.common.HasObserverBase),d.securedItem.SecuredItemsUpdaterBase=function(e,t){d.common.CentrifyBEBase.call(this),d.common.HasObserverBase.call(this),this.centrifyService=e,this.centrifyConnection=t},d.securedItem.SecuredItemsUpdaterBase.prototype={loggerName:"SecuredItemsUpdater",securedItemkeyToSecuredItemMap:null,useLocalCache:!1,securedItemTags:null,tenantId:null,username:null,connectionSince:null,lastUpdate:null,lastError:null,addAllItems:function(e){for(var t={},s=0;s<e.securedItems.length;s++){var n=e.securedItems[s];n.IsRestrictedEmailDomain||(t[n.itemKey]=n)}this.lastUpdate=e.lastUpdate,this.tenantId=e.tenantId,this.username=e.username,this.securedItemkeyToSecuredItemMap=t,this.notifySecuredItemsUpdate(e)},addAllTags:function(e,t){e&&(delete(e=e.reduce(function(e,t){return e[t.tagname]=t,e},{}))["allusertags"],this.securedItemTags=e,this.securedItemDefTag=t)},transformToCBEFormat:function(e){for(var t=[],s=0;s<e.length;s++)t.push(new d.securedItem.SecuredItem(e[s]));return{securedItems:t}},update:function(e){var n,t;this.status!==d.securedItem.SECURED_ITEMS_UPDATER_STATUS_ENUM.Requesting&&(this.status=d.securedItem.SECURED_ITEMS_UPDATER_STATUS_ENUM.Requesting,this.notifyObservers({status:this.status}),n=this,t=function(e){var t,s;e?(t=n.transformToCBEFormat(e.securedItems),s=e.tags,t.lastUpdate=e.lastUpdate,t.tenantId=e.tenantId,t.username=e.username,n.logTrace("Reading from Cache, lastUpdate = "+t.lastUpdate+", tenantId = "+t.tenantId+", username = "+t.username),n.addAllItems(t),n.addAllTags(s),n.status=d.securedItem.SECURED_ITEMS_UPDATER_STATUS_ENUM.Ready,n.notifyObservers({status:n.status}),n.noticeReady()):(n.connectionSince=new Date,n.centrifyService.request("/uprest/GetSecuredItemsData",null,function(e){var t,s;e.success?(t=n.transformToCBEFormat(e.Result.SecuredItems),s=e.Result.Tags,e=e.Result.defTag,t.lastUpdate=new Date,t.tenantId=n.centrifyService.userSetting.tenantId,t.username=n.centrifyService.userSetting.username,n.logTrace("fresh from server, lastUpdate = "+t.lastUpdate+", tenantId = "+t.tenantId+", username = "+t.username),n.addAllItems(t),n.addAllTags(s,e),n.useLocalCache&&n.writeToLocal(),n.status=d.securedItem.SECURED_ITEMS_UPDATER_STATUS_ENUM.Ready,n.notifyObservers({status:n.status})):(n.lastError="TODO error",n.status=d.securedItem.SECURED_ITEMS_UPDATER_STATUS_ENUM.Error,n.notifyObservers({status:n.status}),n.log("bad result")),n.log("GetSecuredItemsData request is done"),n.noticeReady()},function(){n.status=d.securedItem.SECURED_ITEMS_UPDATER_STATUS_ENUM.Error,n.log("GetSecuredItemsData request has error"),n.notifyObservers({status:n.status}),n.noticeReady()}))},e&&this.useLocalCache?this.readFromLocal(t):t(null))},addItem:function(t){var e;(this.securedItemkeyToSecuredItemMap[t.itemKey]=t).raw.SharedWithMe&&!(e=this.securedItemTags["sharedwithme"].itemkeys).includes(t.itemKey)&&e.push(t.itemKey);for(var s,n=0;n<t.tags.length;n++){var i,a=t.tags[n];this.securedItemTags.hasOwnProperty(a)?(i=this.securedItemTags[a].itemkeys).includes(t.itemKey)||i.push(t.itemKey):(i={itemkeys:[t.itemKey],tagdisplayname:a,tagname:a,type:"user"},this.securedItemTags[a]=i)}for(s in this.securedItemTags){var r=this.securedItemTags[s];"user"!==r.type||r.itemkeys.includes(t.itemKey)&&!t.tags.includes(s)&&(r.itemkeys=r.itemkeys.filter(function(e){return e!==t.itemKey}))}},getSecuredItemByKey:function(e){this.status=d.securedItem.SECURED_ITEMS_UPDATER_STATUS_ENUM.Requesting,this.notifyObservers({status:this.status});var t=this;this.centrifyService.request("/uprest/GetSecuredItemByKey?sItemkey="+e,null,function(e){e.success?((e=new d.securedItem.SecuredItem(e.Result)).lastUpdate=new Date,e.tenantId=t.centrifyService.userSetting.tenantId,e.username=t.centrifyService.userSetting.username,t.addItem(e),t.status=d.securedItem.SECURED_ITEMS_UPDATER_STATUS_ENUM.Ready,t.notifyObservers({status:t.status})):(t.lastError="TODO error",t.status=d.securedItem.SECURED_ITEMS_UPDATER_STATUS_ENUM.Error,t.notifyObservers({status:t.status}),t.log("bad result"))},function(){t.status=d.securedItem.SECURED_ITEMS_UPDATER_STATUS_ENUM.Error,t.notifyObservers({status:t.status})},"get")},asyncUpdate:function(e){var t=this;setTimeout(function(){t.update(e)},0)},observer:function(){try{this.centrifyService.status===d.net.SERVICE_STATUS_ENUM.ready&&this.asyncUpdate(!1)}catch(e){this.log("error when getting secured items "+e)}},updateSpecificSecuredItem:function(e){this.unpublishSpecificSecuredItem(e),this.publishSpecificSecuredItem(e)},publishSpecificSecuredItem:function(e){var t=!1;e?this.getSecuredItemByKey(e):(this.log("can not get itemKey from the signalR data"),t=!0),t&&(this.log("so, updating the entire item data"),this.asyncUpdate(!1))},unpublishSpecificSecuredItem:function(e){var t=!1;e?this.securedItemkeyToSecuredItemMap[e]?(delete this.securedItemkeyToSecuredItemMap[e],this.notifyObservers({status:this.status})):(this.log("can not find itemKey in the secured items data, secured item data might be inconsistent"),t=!0):(this.log("can not get itemKey from the signalR data"),t=!0),t&&(this.log("so, updating the entire item data"),this.asyncUpdate(!1))},notifySecuredItemsUpdate:function(e){},notifyObservers:function(e){this.writeToLocalStorage(),d.common.HasObserverBase.prototype.notifyObservers.call(this,e)},writeToLocalStorage:function(){d.storage.set(this.loggerName,{securedItemkeyToSecuredItemMap:this.securedItemkeyToSecuredItemMap,securedItemTags:this.securedItemTags,securedItemsDefTag:this.securedItemsDefTag,status:this.status})},noticeReady:function(){}},d.common.objectExtend(d.securedItem.SecuredItemsUpdaterBase,d.common.CentrifyBEBase),d.common.objectExtend(d.securedItem.SecuredItemsUpdaterBase,d.common.HasObserverBase),d.background.MultiAccountCheckCBEBase=function(e,t){d.common.CentrifyBEBase.call(this),this.centrifyService=e,this.appUpdater=t},d.background.MultiAccountCheckCBEBase.prototype={centrifyService:null,appUpdater:null,checkIsAppAccountSignedIn:function(e,t){e=this.getAccountInfoForMultiSSO(e,t);this.checkLoginStatus4App(e,t)},findIdentifierValue:function(e,t){return e.split(".").reduce(function(e,t){return e[t]},t)},tryLogOutCurAccount:function(e,t){e=this.appUpdater.getAppByKey(e).appLogOutURL;this.logOutCurAccount4App(e,t)},getAccountInfoForMultiSSO:function(e,t){var s=this.appUpdater.getAppByKey(e);if(s)return{appkey:e,checkStatusURL:s.checkStatusURL,additionalIdentifier:s.additionalIdentifier,identifierObject:s.identifierObject,additionalIdentifierValue:s.additionalIdentifierValue,username:s.username,appname:s.name};this.sendMultiAccountResponse2content(t,{action:d.communication.CentrifyEventEnum.checkIsAppAccountSignedInResponse,result:!1})},checkLoginStatus4App:function(t,s){var n=this;!t.additionalIdentifier||t.additionalIdentifierValue&&""!=t.additionalIdentifierValue?this.centrifyService.request(t.checkStatusURL,null,function(e){e=n.findIdentifierValue(t.identifierObject,e);t.additionalIdentifier&&e==t.additionalIdentifierValue||!t.additionalIdentifier&&e==t.username?n.sendMultiAccountResponse2content(s,{action:d.communication.CentrifyEventEnum.checkIsAppAccountSignedInResponse,result:!1}):n.sendMultiAccountResponse2content(s,{action:d.communication.CentrifyEventEnum.checkIsAppAccountSignedInResponse,result:!0,info:{appkey:t.appkey,appName:t.appname}})},function(e){n.logError("checkLoginStatus4App request has been failed"+e),n.sendMultiAccountResponse2content(s,{action:d.communication.CentrifyEventEnum.checkIsAppAccountSignedInResponse,result:!1})},"GET"):n.sendMultiAccountResponse2content(s,{action:d.communication.CentrifyEventEnum.checkIsAppAccountSignedInResponse,result:!1})},logOutCurAccount4App:function(e,t){var s=this;e?this.centrifyService.request(e,null,function(e){s.sendMultiAccountResponse2content(t,{action:d.communication.CentrifyEventEnum.signOutAppCurAccountResponse})},function(e){s.logError("logOutCurAccount4App request has been failed. "+e),s.sendMultiAccountResponse2content(t,{action:d.communication.CentrifyEventEnum.signOutAppCurAccountResponse})},"GET"):this.sendMultiAccountResponse2content(t,{action:d.communication.CentrifyEventEnum.signOutAppCurAccountResponse})},sendMultiAccountResponse2content:function(e,t){}},d.common.objectExtend(d.background.MultiAccountCheckCBEBase,d.common.CentrifyBEBase),d.formfill.createTestapps=function(e,s){function t(e,t){return new d.formfill.FFApp({AppKey:"appkey"+e,Name:"name"+e,DisplayName:"displayname"+e,Url:"http://testing"+e,Username:t,Scheme:"HttpsHttp",HostNameSuffix:"",UsernameField:s,PasswordField:s,UsernameIsShared:!1,setting:{isFormFillEnabled:!0,isAutoLoginEnabled:!1}})}function n(e,t){return new d.formfill.FFApp({AppKey:"appkey"+e,Name:t,DisplayName:t,Url:"http://testing"+e,Scheme:"HttpsHttp",HostNameSuffix:"",UsernameField:s,PasswordField:s,UsernameIsShared:!0,setting:{isFormFillEnabled:!0,isAutoLoginEnabled:!0}})}var i=[];switch(e){case"0":i.push({app:t(1,"username1")});break;case"1":i.push({app:t(1,"a")}),i.push({app:t(2,"thisIsAVeryLongUsernameCreatedByTheUser")}),i.push({app:n(3,"x")}),i.push({app:n(4,"A Shared App Which Is Create dBy Admin And Assign To Me")});break;default:throw"unknown test case "+e}return i},d.landcatch.BHAnalyzerBase=function(){d.common.CentrifyBEBase.call(this),this.initAll()},d.landcatch.BHAnalyzerBase.prototype={loggerName:"LandCatchBehaviorAnalysis",bhTypeEnum:d.landcatch.BehaviorTypesEnum,bhFieldsEnum:d.landcatch.BehaviorFieldsEnum,bhBufferMaxLen:10,defaultSelectorTimeout:2e3,initAll:function(){this.behaviorBuffer=[],this.initAnalyzeResult(),this.initLoginDetails()},initAnalyzeResult:function(){this.analyzeResult={findLogin:!1,launchPasswordReset:!1,forcedValues:{},inputChangeStarted:!1,oneStepLogin:!0}},initLoginDetails:function(){this.loginDetails={url:null,hostnameSuffix:null,usernameField:null,usernameValue:null,passwordField:null,passwordValue:null,order:[],corpIdField:null,submitField:null,formField:null,formAction:null,version:"2",selectorTimeout:this.defaultSelectorTimeout}},addToEventBuffer:function(e){switch(e.type){case this.bhTypeEnum.inputChange:this.addInputEvt(e);break;case this.bhTypeEnum.mouseLClick:this.addClickEvent(e),(e.data.isSubmit||e.data.potentialForm?.sameParent)&&(this.log("LC app submit is found, updating the analysis"),this.updateAnalyzeResult());break;case this.bhTypeEnum.pressEnter:this.addKeyEnterEvent(e),(e.data.isSubmit||e.data.potentialForm?.sameParent)&&(this.log("LC app submit is found by enter keys, updating the analysis"),this.updateAnalyzeResult());break;case this.bhTypeEnum.navigate:this.addNewPageEvent(e),0<this.behaviorBuffer.length&&this.updateAnalyzeResult();break;case this.bhTypeEnum.forceLoginDataValues:for(var[t,s]of Object.entries(e.data))this.analyzeResult.forcedValues[t]=s}this.behaviorBuffer.length>this.bhBufferMaxLen&&this.behaviorBuffer.shift()},addNewPageEvent:function(e){this.analyzeResult.inputChangeStarted?this.behaviorBuffer.push(e):this.behaviorBuffer=[]},addClickEvent:function(e){var t;this.analyzeResult.inputChangeStarted?(t=this.behaviorBuffer[this.behaviorBuffer.length-1]).type==this.bhTypeEnum.inputChange?this.behaviorBuffer.push(e):t.type==this.bhTypeEnum.mouseLClick?this.behaviorBuffer[this.behaviorBuffer.length-1]=e:(t.type,this.bhTypeEnum.pressEnter):this.behaviorBuffer[0]=e},addKeyEnterEvent:function(e){var t,s=e.data;this.analyzeResult.oneStepLogin||(t=this.behaviorBuffer[this.behaviorBuffer.length-1])&&t.type==this.bhTypeEnum.inputChange&&(t.data.typeCombo="Enter");for(var n=0;n<this.behaviorBuffer.length;n++){var i=this.behaviorBuffer[n];if(i.type==this.bhTypeEnum.inputChange&&i.data.selector==s.selector)return void(i.data.typeCombo="Enter")}this.behaviorBuffer.push(e)},addInputEvt:function(e){var t;this.analyzeResult.inputChangeStarted=!0,"username"==e.data.type&&e.data.potentialForm&&((t=e.data.potentialForm.password)&&0<t.length?this.analyzeResult.oneStepLogin=!0:this.analyzeResult.oneStepLogin=!1);for(var s=0;s<this.behaviorBuffer.length;s++){var n=this.behaviorBuffer[s];if(n.type==this.bhTypeEnum.pressEnter&&n.data.selector==e.data.selector&&(this.log("detect this input change should be input enter"),e.data.typeCombo="Enter"),n.type==this.bhTypeEnum.inputChange&&n.data.type==e.data.type&&n.data.selector==e.data.selector)return this.log("this input "+e.data.selector+" has already been recorded, will overwrite this event"),void(this.behaviorBuffer[s]=e)}this.behaviorBuffer.push(e)},isValidLoginDetails:function(){return this.loginDetails.url&&this.loginDetails.hostnameSuffix&&this.loginDetails.usernameField&&this.loginDetails.usernameValue&&this.loginDetails.passwordField&&this.loginDetails.passwordValue},isValidPasswordGeneration:function(){return this.loginDetails.url&&this.loginDetails.hostnameSuffix&&this.loginDetails.passwordField&&this.loginDetails.passwordValue&&this.loginDetails.passwordGenerated},updateAnalyzeResult:function(){this.initLoginDetails();for(var e,t,s,n,i=0;i<this.behaviorBuffer.length;i++){var a,r,o=(a=this.behaviorBuffer[i]).data;switch(a.type){case this.bhTypeEnum.inputChange:"username"==o.type?("Enter"==o.typeCombo?this.loginDetails.order.push(["fillEnter","username"]):this.loginDetails.order.push(["fill","username"]),this.loginDetails.url=a.sender.docUrl,this.loginDetails.hostnameSuffix=a.sender.docHost,this.loginDetails.usernameField=o.selector,this.loginDetails.usernameValue=o.value):(this.loginDetails.passwordField=o.selector,this.loginDetails.passwordValue=o.value,"Enter"==o.typeCombo?0<o.potentialForm?.submit?.length&&o.potentialForm?.submit[0].selector&&0<this.loginDetails?.order?.length?(r=o.potentialForm?.submit[0]?.selector,this.loginDetails.order.push(["fill","password"]),this.loginDetails.order.push(["click",r])):this.loginDetails.order.push(["fillEnter","password"]):this.loginDetails.order.push(["fill","password"]));break;case this.bhTypeEnum.mouseLClick:this.loginDetails.order.push(["click",o.selector,{try:1}]);break;case this.bhTypeEnum.pressEnter:break;case this.bhTypeEnum.navigate:this.isValidLoginDetails()?this.analyzeResult.findLogin=!0:this.loginDetails.order.push(["waitForNewPage"])}}for([e,t]of Object.entries(this.analyzeResult.forcedValues))this.log(`forcing key onto loginDetails: ${e} - `+t),this.loginDetails[e]=t;0<this.behaviorBuffer.length&&(s="noform"==(a=this.behaviorBuffer[0]).data.potentialForm?.formElement,this.loginDetails.url=(n=a.sender).docUrl&&!this.loginDetails.url?n.docUrl:this.loginDetails.url,this.loginDetails.hostnameSuffix=n.docHost&&!this.loginDetails.hostnameSuffix?n.docHost:this.loginDetails.hostnameSuffix,"noform"==a.data.potentialForm?.formElement&&(this.log("No Form Found and check for same parent"),this.log(a.data?.sameparent)),0<a.data.potentialForm?.username?.length&&!s&&(n=a.data.potentialForm?.username[0],this.loginDetails.usernameField=n.selector&&!this.loginDetails.usernameField?n.selector:this.loginDetails.usernameField,this.loginDetails.usernameValue=n.value&&!this.loginDetails.usernameValue?n.value:this.loginDetails.usernameValue),0<a.data.potentialForm?.password?.length&&!s&&(n=a.data.potentialForm?.password[0],this.loginDetails.passwordField=n.selector&&!this.loginDetails.passwordField?n.selector:this.loginDetails.passwordField,this.loginDetails.passwordValue=n.value&&!this.loginDetails.passwordValue?n.value:this.loginDetails.passwordValue),0<a.data.potentialForm?.submit?.length)&&!s&&(n=a.data.potentialForm.submit[0],this.loginDetails.submitField=n?.selector),this.isValidLoginDetails()?this.analyzeResult.findLogin=!0:this.isValidPasswordGeneration()&&(this.analyzeResult.validForPasswordGeneration=!0)},findLogin:function(){return this.log("LC find the login: "+this.analyzeResult.findLogin),this.analyzeResult.findLogin},validForPasswordGeneration:function(){return this.analyzeResult.validForPasswordGeneration},clearAnalyzer:function(){this.behaviorBuffer=[],this.initAnalyzeResult(),this.initLoginDetails()}},d.common.objectExtend(d.landcatch.BHAnalyzerBase,d.common.CentrifyBEBase),d.landcatch.ManagerBase=function(e,t,s){d.common.CentrifyBEBase.call(this),this.centrifyService=e,this.userSetting=e.userSetting,this.policyEnabled=!!this.userSetting&&this.userSetting.enableLandCatch,this.localEnabled=this.getLandCatchLocalConfig(),this.canCreateApp=!!this.userSetting&&(this.canCreateAppInAP||this.userSetting.canCreateAppInUP),this.enablePrivilegedApps=!!this.userSetting&&this.userSetting.enablePrivilegedApps,this.centrifyConnection=t,this.appsUpdater=s},d.landcatch.ManagerBase.prototype={loggerName:"LandCatchBGManager",bhFieldsEnum:d.landcatch.BehaviorFieldsEnum,behaviorAnalyzers:{},detectedLoginApps:{},appInfos:{},observer:function(){this.centrifyService.status===d.net.SERVICE_STATUS_ENUM.ready?(this.userSetting=this.centrifyService.userSetting,this.policyEnabled=!!this.userSetting&&this.userSetting.enableLandCatch,this.canCreateApp=!!this.userSetting&&(this.canCreateAppInAP||this.userSetting.canCreateAppInUP),this.enablePrivilegedApps=!!this.userSetting&&this.userSetting.enablePrivilegedApps):(this.userSetting=null,this.policyEnabled=!1,this.canCreateApp=!1,this.enablePrivilegedApps=!1)},getLandCatchLocalConfig:function(){return 0},isEnabled:function(){var e=!!this.policyEnabled&&0<=this.localEnabled;return!!(e&&this.canCreateApp&&this.centrifyConnection)&&this.centrifyConnection.status==d.net.CONNECTION_STATUS_ENUM.signedIn},pushBehavior:function(e,t){if(!this.isEnabled())return this.log("land and catch is not enabled, check your portal setting and authentication"),null;this.behaviorAnalyzers[t]||(this.log("new behavior on tab "+t),this.behaviorAnalyzers[t]=new d.landcatch.BHAnalyzer);t=this.behaviorAnalyzers[t];return t.addToEventBuffer(e),t},addAppInfo:function(e,t,s){for(var n in this.appInfos.hasOwnProperty(t)||(this.appInfos[t]={}),e)!s&&this.appInfos[t][n]||(this.appInfos[t][n]=e[n]);return this.detectedLoginApps[t]},updateLoginApp:function(e,t,s){for(var n in this.detectedLoginApps.hasOwnProperty(t)||(this.detectedLoginApps[t]={}),e)!s&&this.detectedLoginApps[t][n]||(this.detectedLoginApps[t][n]=e[n]);return this.detectedLoginApps[t]},removeApp:function(e){delete this.detectedLoginApps[e],delete this.behaviorAnalyzers[e]},removeEntireApp:function(e){this.removeApp(e),delete this.appInfos[e]},clearLoginApps:function(){this.detectedLoginApps={},this.behaviorAnalyzers={},this.appInfos={}},findAppRelatedApps:function(e,t){if(!e)return this.log("invalid hostname suffix, return nothing"),[];for(var s=this.appsUpdater.getAppsByHostname(e,t),n=0;n<s.length;n++)s[n]={appkey:s[n].appkey,displayName:s[n].displayName,username:s[n].username,isPrivilegedApp:s[n].raw?.IsPrivilegedApp};return s},findLoginApp:function(e,t){this.log("Received Login Details for L&C");var s=this.appInfos[t],s=(this.updateLoginApp(s,t,!0),this.findAppRelatedApps(e.hostnameSuffix,!1)),n=(this.enablePrivilegedApps?(n=s.filter(e=>!e.isPrivilegedApp),e.relatedApps=n):e.relatedApps=s,this.updateLoginApp(e,t,!0));e.relatedApps&&0<e.relatedApps.length?(this.log("App is found in UP, checking for potentail cred change"),s={usernameValue:e.usernameValue,passwordValue:e.passwordValue,relatedApps:e.relatedApps},this.checkCredentialChange(s,t)):(this.log("App is not present in UP, notifiy for capture"),n.notifyFlag=!0,e=this.getCaptureSetting(),this.notifyCredentialChecking(t,{userSetting:e,detectedApp:n}))},resetWithGeneratedPassword:function(e,t){var s=this.appInfos[t],s=(this.updateLoginApp(s,t,!0),this.findAppRelatedApps(e.hostnameSuffix,!1)),s=(e.relatedApps=s,this.updateLoginApp(e,t,!0)),e=(s.notifyFlag=!0,this.getCaptureSetting());this.notifyCredentialChecking(t,{userSetting:e,detectedApp:s})},checkCredentialChange:function(t,n){var i=this;d.common.encryption.sha256Hash(t.passwordValue).then(e=>{t.passwordHash=e;var s=t.passwordValue;delete t.passwordValue,i.centrifyService.request("/cbe/CheckCredentialChange",t,function(e){var t;e.success?(e.Result.passwordValue=s,(e=e.Result).notifyFlag=!i.isCredentialFound(e),i.updateLoginApp(e,n,!0),e=i.updateLoginApp(i.appInfos[n],n,!1),t=i.getCaptureSetting(),e.notifyFlag?(i.log("no such credential found, should notify user"),i.notifyCredentialChecking(n,{userSetting:t,detectedApp:e})):(i.log("found existing credential, should not notify user and removeApp"),i.removeApp(n))):i.log("CheckCredentialChange API bad result")},function(){i.log("CheckCredentialChange fails, "+JSON.stringify(result))},"post")})},isCredentialFound:function(e){if(e.relatedApps&&0<e.relatedApps.length){for(var t=e.relatedApps,s=0;s<t.length;s++){var n=t[s];if(!1===n.usernameChange&&!1===n.passwordChange)return this.log("found app "+n.appkey+" credential matches the detected app"),!0}this.log("the detected credentials doesn't match any credentials on cloud")}else this.log("there is no related apps with the hostname: "+e.hostnameSuffix+", should be a new app, return true");return!1},getCaptureSetting:function(){return{canCreateAppInAP:this.centrifyService.userSetting.canCreateAppInAP,canCreateAppInUP:this.centrifyService.userSetting.canCreateAppInUP,ignoreMultipleLCPrompts:this.centrifyService.userSetting.ignoreMultipleLCPrompts,isCompromisedPwdSaveEnabled:this.centrifyService.userSetting.isCompromisedPwdSaveEnabled,enableCompromisedPasswordCheckForIBE:this.centrifyService.userSetting.enableCompromisedPasswordCheckForIBE,enablePrivilegedApps:this.centrifyService.userSetting.enablePrivilegedApps,enabledCompromisedChangeFix:this.centrifyService.userSetting.enabledCompromisedChangeFix,isEnabledLCEnhancement:this.centrifyService.userSetting.isEnabledLCEnhancement}},notifyCredentialChecking:function(e,t){},neverRememberSite:function(e){},clearAllSkippedSites:function(){},listener:function(e,t,s){}},d.common.objectExtend(d.landcatch.ManagerBase,d.common.CentrifyBEBase),d.common.setClearClipboardTimer=function(e){let t=this;t.clipboardTimer&&clearTimeout(t.clipboardTimer),t.clipboardTimer=setTimeout(()=>{var e=document.createElement("textarea");document.body.appendChild(e),e.value=" ",e.focus(),e.select(),document.execCommand("Copy"),e.remove(),clearTimeout(t.clipboardTimer)},1e3*e)}}.call(_idaptiveUniqueGlobal);