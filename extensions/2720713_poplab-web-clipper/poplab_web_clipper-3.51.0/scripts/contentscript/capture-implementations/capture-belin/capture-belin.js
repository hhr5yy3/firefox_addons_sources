(()=>{"use strict";var e={4056:(e,t,i)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.maxResolution=t.handledVideosPlatform=t.url_belin_api_resources=t.url_belin_api=t.url_belin_resources=t.url_belin=t.url_labo=t.url_frigo=t.url_auth=t.url_keycloack=t.url_api=t.base_url_front=t.VERSION=void 0,i(7505),i(872),i(7466),i(3848);const n=i(7260);let s;i(3734),s=n.config,t.VERSION=null!==(r=s.VERSION)&&void 0!==r?r:"3.50.1",t.base_url_front=s.base_url_front,t.url_api=s.url_api,t.url_keycloack=s.url_keycloack,t.url_auth=t.url_keycloack+"/realms/lde-poplab/protocol/openid-connect",t.url_frigo=t.base_url_front+"/frigo",t.url_labo=t.base_url_front+"/labo/mes-documents",t.url_belin="https://manuelnumeriquemax.belin.education/",t.url_belin_resources="https://resources.manuelnumeriquemax.belin.education/",t.url_belin_api="https://api.manuelnumeriquemax.belin.education/main/v1/nodes/",t.url_belin_api_resources="https://api.manuelnumeriquemax.belin.education/main/v1/resources",t.handledVideosPlatform=["youtube.com/watch","youtube.com/embed","youtu.be/","vimeo.com/","dailymotion.com/"],t.maxResolution=49e6},7466:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.integration-its.poplab.education",url_api:"https://app.integration-its.poplab.education/api",url_keycloack:"https://id.integration-its.poplab.education"}},7505:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"http://localhost:8000",url_api:"http://localhost:8082/api",url_keycloack:"http://auth.poplab.local"}},3848:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.preprod-its.poplab.education",url_api:"https://app.preprod-its.poplab.education/api",url_keycloack:"https://id.preprod-its.poplab.education"}},7260:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.poplab.education",url_api:"https://app.poplab.education/api",url_keycloack:"https://auth.poplab.education"}},872:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.sandbox.poplab.education",url_api:"https://app.sandbox.poplab.education/api",url_keycloack:"https://id.sandbox.poplab.education"}},3734:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={VERSION:"TEST",base_url_front:"https://app.sandbox.poplab.education",url_api:"https://app.sandbox.poplab.education/api",url_keycloack:"https://id.sandbox.poplab.education"}},9040:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getBelinPageResponse=t.getBelinToken=t.TypeFichierBelin=void 0;const n=i(4056);var s;function o(){const e=window.localStorage.getItem("edulibToken-undefined");return null!=e?JSON.parse(e).tokens.access_token:null}!function(e){e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.URL="URL",e.HTML="HTML",e.PDF="PDF"}(s||(t.TypeFichierBelin=s={})),t.getBelinToken=o,t.getBelinPageResponse=function(){return r(this,void 0,void 0,(function*(){let e;e=null!=o()?{authorization:"Bearer "+o()}:{"X-Authorization-Issuer":"Edulib"};const t=yield fetch(n.url_belin_api+function(){const e=window.location.href.split("/");return e[e.length-1].split("_")[0]}(),{method:"GET",headers:e});return yield t.json()}))}},9270:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureApiCall=void 0;const r=i(1241);class n extends r.Capture{}t.CaptureApiCall=n},1241:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Capture=void 0;const r=i(8033),n=i(2688),s=i(853),o=i(4911);t.Capture=class{constructor(e){this.mediaPreviews=[],this.elementsLength=void 0,this.elementNumber=void 0,this.description="",this.titre="",this.type=n.CaptureType.BASIQUE,this.callback=void 0,this.capture_en_cours=!1,this.listeners=new Map,this.selector=void 0,this.recapturable=!0,this.editable=!0,this.menu=e}startCapture(){this.reinitializeCapture(),this.mediaPreviews=[],this.listeners.set("keydown",this.keydown.bind(this)),this.listeners.set("mousedown",this.mousedown.bind(this)),this.listeners.set("mousemove",this.mousemove.bind(this)),this.listeners.set("mouseup",this.mouseup.bind(this)),this.listeners.forEach(((e,t)=>{document.addEventListener(t,e)})),this.menu.div.style.top="-9999px",this.menu.div.style.right="-9999px",this.capture_en_cours=!0}reinitializeCapture(){this.listeners.forEach(((e,t)=>{document.removeEventListener(t,e)})),this.listeners.clear(),this.menu.div.style.top="10px",this.menu.div.style.right="10px",this.capture_en_cours=!1}capturer(e){this.startCapture(),this.sendCaptureToMenu(new n.ElementCaptureData)}sendCaptureToMenu(e){this.reinitializeCapture(),this.data=e,this.menu.displayCaptureInfos()}sendCaptureToPoplab(e,t){var i,a,l,c,u;if((0,o.clearHighlight)(),this.data instanceof n.ElementCaptureData&&t){this.data.titre=t.titre,this.data.description=t.description,this.data.credit||(this.data.credit=document.URL);const e=[],r=[],n=[],s=[],o=[];null===(i=this.data.images)||void 0===i||i.forEach((i=>{-1!==t.mediasIds.indexOf(i.id)&&e.push(i)})),null===(a=this.data.videos)||void 0===a||a.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&r.push(e)})),null===(l=this.data.audios)||void 0===l||l.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&n.push(e)})),null===(c=this.data.urls)||void 0===c||c.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&s.push(e)})),null===(u=this.data.fichiers)||void 0===u||u.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&o.push(e)})),this.data.images=e,this.data.audios=n,this.data.videos=r,this.data.urls=s,this.data.fichiers=o,this.titre=t.titre,this.description=t.description}this.menu.old_capture=this,browser.runtime.sendMessage(new r.BrowserRuntimeMessageForPoplab(this.data instanceof n.ElementCaptureData?s.PoplabObjectType.ELEMENT:s.PoplabObjectType.DOCUMENT,this.type,this.data,e))}mousedown(e){return!0}mousemove(e){return!0}mouseup(e){return!0}keydown(e){return!0}isEmpty(){var e,t;return!(this.titre||this.description||(null===(e=this.data)||void 0===e?void 0:e.titre)||(null===(t=this.data)||void 0===t?void 0:t.description)||0!==this.mediaPreviews.length)}}},3892:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinCommon=void 0;const r=i(2688),n=i(4056),s=i(4911),o=i(4393),a=i(8286);t.CaptureBelinCommon=class{constructor(e){this.captureBelin=e}transformHandableUrls(e,t){var i,r;const s=t.find((t=>t.content.url===e.url));return e.url.includes("json://")?`${n.url_belin_resources}${null===(i=s.content.downloadPath)||void 0===i?void 0:i.split(".zip")[0]}/index.html`:e.url.includes("astra://")?`${n.url_belin_resources}${null===(r=s.content.downloadPath)||void 0===r?void 0:r.split("/Astra/")[0]}/Astra/pack/${s.id}.html`:e.url.includes("word://")||e.url.includes("pptx://")?`${n.url_belin_resources}${s.content.downloadPath}`:e.url}removeTags(e,t){let i=e;for(const e of t)i=this.removeTag(i,e);return i}removeTag(e,t){const i=`<${t}`;let r=e.indexOf(i);for(;-1!==r;){const n=e.indexOf(">",r),s=e.slice(r,n+1),o=e.slice(0,r),a=e.slice(n+1);if(s.includes("/>"))e=o+a;else{const i=`</${t}>`,r=e.indexOf(i,n);e=-1!==r?o+e.slice(r+i.length):o+a}r=e.indexOf(i)}return e}isGrainComplexe(e,t){if((0,s.hasSameFileTypeMoreThanOnce)(t))return!0;const i=this.getGrainContentSections(e);for(const e of i)if(e.outerHTML.includes("<table"))return!0;return 1!==i.length&&this.hasMoreThanOneText(i)}removeEmptyTags(e){const t=new RegExp(/<(\w+)(\s*[^>]*)> *<\/\1>/g);let i=e.replace(t,"");for(;t.test(i);)i=i.replace(t,"");return i}hasMoreThanOneText(e){let t=0;for(const i of e)if("RESOURCE"!==i.tagName){let e=this.removeTags(i.innerHTML,["media","img","audio","video","resource"]).replace(new RegExp(/\n/g),"").trim();if(e=this.removeEmptyTags(e),e.length>0&&(t++,t>1))break}return t>1}getGrainContentSections(e){const t=(0,a.createElementFromDomParser)(e).querySelector("topic"),i=[];if(t){const e=t.children;for(const t of e){const e=t;"METADATA"!==e.tagName&&"BELIN-TITLE"!==e.tagName&&"SURTITLE"!==e.tagName&&(e.innerHTML=this.removeTag(e.innerHTML,"metadata"),i.push(e))}}return i}createCredit(e,t,i){let r="";e.images[0]&&(r=r.concat(e.images[0].copyright?e.images[0].copyright:"")),e.videos[0]&&(r=r.concat(e.videos[0].copyright?e.videos[0].copyright:"")),e.audios[0]&&(r=r.concat(e.audios[0].copyright?e.audios[0].copyright:""));const n=`<a href="${window.location.href}">${chrome.i18n.getMessage("voir_manuel_max")}</a> (${t} ${i})`;return r=r?`${r} - ${n}`:n,r}putManuelPageLinkInElement(e){var t,i;if(e.type===o.ElementType.ELEMENT){if(1===e.urls.length){const i=e.urls[0];e.description=null===(t=e.description)||void 0===t?void 0:t.concat(`\n<a href="${i.url}">${i.label}</a>`)}e.type===o.ElementType.ELEMENT&&(e.urls=[new r.UrlMediaObject(window.location.href,window.location.href,"",chrome.i18n.getMessage("voir_manuel_max"))])}else if(e.type===o.ElementType.SECTION&&e.description){const t=`<a href="${window.location.href}">${chrome.i18n.getMessage("voir_manuel_max")}</a>`;e.description.endsWith(t)||(e.description=null===(i=e.description)||void 0===i?void 0:i.concat(`\n${t}`))}}createMetaElement(e){const t={manualId:e.manualId,discipline:e.discipline,niveau:e.level,grainId:e.grainId,pageId:e.pageId};return{editeur:o.Editeur.BELIN,origine:window.location.href,additionalInfo:t}}createMetaDocument(e){const t={manualId:e.manualId,discipline:e.discipline,niveau:e.level,grainId:e.grainId,pageId:e.pageId};return{editeur:o.Editeur.BELIN,origine:window.location.href,additionalInfo:t}}setEditeurForMedias(e){e.getMedias().forEach((e=>e.editeur=o.Editeur.BELIN))}handleMathFormulas(e){let t=e;if(null==t?void 0:t.includes("<latex>")){let e;for(;e=t.match(/<latex>(.*?)<\/latex>/);)t=t.replace("<latex>",`<span data-latex='${e[1]}' data-evaluate='no' data-display='no' data-type='inlineMath'>`),t=t.replace("</latex>","</span>")}return t}}},1956:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinGrainComplexeLinkHandler=void 0;const r=i(2688),n=i(1845),s=i(4393),o=i(3892);class a extends o.CaptureBelinCommon{handleLink(e,t,i,s,o){const a=this.getMediaObject(e,t);a.type_fichier===r.TypeFichier.VIDEO?i.videos.push(a):(0,n.parseLinkAsPoplabMediaObject)(i,a,o,e),i.urls.length>0?this.putUrlInNearestExistingElement(i,s):s.push(i),i.description=this.removeTag(i.description||"","a")}getMediaObject(e,t){let i=e.getAttribute("uri");i||(i=e.children[0].getAttribute("uri"));const r=i.split("//")[1],n=t.medias.find((e=>e.id===i||e.url===i||e.id===r));return n.url=this.transformHandableUrls(n,t.grainResources),n}putUrlInNearestExistingElement(e,t){if(e.titre||e.description)t.push(e);else{const i=t.slice().reverse().find((e=>e.type===s.ElementType.ELEMENT&&0===e.urls.length));i?i.urls.push(e.urls[0]):t.push(e)}}}t.CaptureBelinGrainComplexeLinkHandler=a},1454:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinGrainComplexeMediaHandler=void 0;const r=i(2688),n=i(4393);t.CaptureBelinGrainComplexeMediaHandler=class{handleMedia(e,t,i){let s="";const o=e.children;for(const e of o){const t=e;"BELIN-TITLE"!==t.tagName&&(t.id||t.getAttribute("url"))&&(s=t.id||t.getAttribute("url"))}const a=new r.ElementCaptureData;a.type=n.ElementType.ELEMENT,a.description=e.outerHTML;const l=i.find((e=>e.id===s||e.url===s));if(l)switch(l.type_fichier){case r.TypeFichier.IMAGE:a.images.push(l);break;case r.TypeFichier.VIDEO:a.videos.push(l);break;case r.TypeFichier.AUDIO:a.audios.push(l);break;case r.TypeFichier.LIEN:a.urls.push(l)}t.push(a)}}},7956:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinGrainComplexe=void 0;const r=i(2688),n=i(4393),s=i(3892),o=i(4911),a=i(1956),l=i(1454),c=i(1142),u=i(8286);class d extends s.CaptureBelinCommon{constructor(e){super(e),this.linkHandler=new a.CaptureBelinGrainComplexeLinkHandler(e),this.mediaHandler=new l.CaptureBelinGrainComplexeMediaHandler}accept(e){return this.isGrainComplexe(e.grainContent,e.medias)}startCaptureType(e){const t=(new r.DocumentCaptureData).setTitre((0,u.createElementFromDomParser)(e.grainTitle).textContent||this.createDefaultDocumentTitle(e));t.auteurInitial=new c.Auteur(c.AuteurInitial.BELIN),t.elements=[],this.getGrainContentSections(e.grainContent).forEach((i=>{var s;const o=new r.ElementCaptureData;if(o.description=this.removeTags(i.innerHTML,["note","copyright"]).replace(new RegExp(/\n/g),"").replace(new RegExp(/ {2}/g),"").trim(),i.outerHTML.startsWith("<resource")){const r=null===(s=i.querySelector("belin-title"))||void 0===s?void 0:s.innerHTML;i.querySelector("a")?this.linkHandler.handleLink(i.querySelector("a"),e,o,t.elements,r):i.querySelector("media")&&(this.mediaHandler.handleMedia(i.querySelector("media"),t.elements,e.medias),t.elements[t.elements.length-1].titre=r)}else{const i=this.splitSectionCaptureData(o,e);t.elements=t.elements.concat(i),o.type=n.ElementType.SECTION}}));for(let i=1;i<=t.elements.length;i++){const r=t.elements[i],s=t.elements[i-1];s.auteurInitial=new c.Auteur(c.AuteurInitial.BELIN),s.credit=this.createCredit(s,e.discipline,e.level),s.meta=this.createMetaElement(e),s.description&&(s.description=this.removeEmptyTags(s.description),s.description=this.handleMathFormulas(s.description)),this.isElementSectionWithOnlyDescription(r)?s.type===n.ElementType.SECTION&&(s.description+=`<p>${r.description}</p>`,t.elements.splice(i,1),i--):this.isElementSectionAndEmpty(r)&&t.elements.splice(i,1),this.putManuelPageLinkInElement(s),this.setEditeurForMedias(s)}return t.meta=this.createMetaDocument(e),t}removeLastUnclosedTag(e){return e.replace(/<(\w+)(\s*[^>]*)>$/,"")}removeFirstOnlyClosingTag(e){return e.replace(/^<\/(\w+)(\s*[^>]*)>/,"")}isElementSectionWithOnlyDescription(e){return!(!e||e.type!==n.ElementType.SECTION||e.titre||!e.description)}isElementSectionAndEmpty(e){return!(!e||e.type!==n.ElementType.SECTION||e.titre||e.description)}splitSectionCaptureData(e,t){const i=[e];let r=e.description,n=e;const s=[{startTag:"<media",endTag:"</media>"},{startTag:"<img",endTag:""},{startTag:"<audio",endTag:""},{startTag:"<video",endTag:""},{startTag:"<belin-title",endTag:"</belin-title>"}];for(;s.some((e=>-1!==r.indexOf(e.startTag)));){const a=s.map((e=>r.indexOf(e.startTag))),l=a.filter((e=>-1!==e));if(0===l.length)break;const c=Math.min(...l),d=s[a.indexOf(c)],p=r.indexOf(d.startTag);let h;if(h=d.endTag?r.indexOf(d.endTag,p)+d.endTag.length:r.indexOf(">",p)+1,-1===p||-1===h)break;const m=r.substring(p,h),E=(0,o.fromHTML)(m);switch(d.startTag){case"<media":this.mediaHandler.handleMedia(E,i,t.medias);break;case"<img":case"<audio":case"<video":{const e=document.createElement("media");e.append(E),this.mediaHandler.handleMedia(e,i,t.medias);break}case"<belin-title":e.titre=(0,u.createElementFromDomParser)(E.textContent).textContent}r=this.removeTagFromSectionContent(n,r,i,p,h,s.map((e=>e.startTag))),n=i[i.length-1]}return i}removeTagFromSectionContent(e,t,i,s,o,a){e.description=this.removeLastUnclosedTag(t.substring(0,s));const l=t.indexOf(">")+1;let c=t.substring(0,l);a.some((e=>c.startsWith(e)))&&(c="");const u=this.removeFirstOnlyClosingTag(t.substring(o)).trim();t=u&&!u.startsWith(c)?c+this.removeFirstOnlyClosingTag(t.substring(o)):u;const d=(new r.ElementCaptureData).setDescription(t).setType(n.ElementType.SECTION);return i.push(d),t}createDefaultDocumentTitle(e){return`${(0,u.createElementFromDomParser)(e.pageTitle).textContent} (${e.discipline} ${e.level} p.${e.startPage}-${e.endPage})`}}t.CaptureBelinGrainComplexe=d},315:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinGrainSimple=void 0;const r=i(2688),n=i(3892),s=i(1142);class o extends n.CaptureBelinCommon{constructor(e){super(e)}accept(e){return!0}startCaptureType(e){this.captureBelin.titre=e.grainTitle.trim();const t=new r.ElementCaptureData;t.titre=this.captureBelin.titre;const i=this.getGrainContentSections(e.grainContent);return t.description="",i.forEach((i=>{"RESOURCE"===i.tagName&&i.innerHTML.includes("<a")?this.handleGrainSimpleLink(e,i):t.description+=i.innerHTML})),t.description=this.handleMathFormulas(t.description),t.description=this.cleanupContent(t.description),t.images=e.medias.filter((e=>e.type_fichier===r.TypeFichier.IMAGE)),t.videos=e.medias.filter((e=>e.type_fichier===r.TypeFichier.VIDEO)),t.audios=e.medias.filter((e=>e.type_fichier===r.TypeFichier.AUDIO)),t.urls=e.medias.filter((e=>e.type_fichier===r.TypeFichier.LIEN)),t.exerciseurs=e.medias.filter((e=>e.type_fichier===r.TypeFichier.EXERCISEUR)),t.fichiers=e.medias.filter((e=>e.type_fichier===r.TypeFichier.FICHIER)),this.setEditeurForMedias(t),t.auteurInitial=new s.Auteur(s.AuteurInitial.BELIN),this.putManuelPageLinkInElement(t),this.captureBelin.mediaPreviews=t.getAllEmbeds(),this.captureBelin.description=t.description,t.credit=this.createCredit(t,e.discipline,e.level),t.meta=this.createMetaElement(e),t}handleGrainSimpleLink(e,t){var i;const n=e.medias.find((e=>e.type_fichier===r.TypeFichier.LIEN));if(n){for(const e of t.children)"BELIN-TITLE"===e.tagName&&(n.label=e.textContent);n.label||(n.label=null===(i=t.textContent)||void 0===i?void 0:i.trim()),n.url=this.transformHandableUrls(n,e.grainResources),n.url.includes("https://")||n.url.includes("http://")||(e.medias=e.medias.filter((e=>e.type_fichier!==r.TypeFichier.LIEN)))}}cleanupContent(e){return e=this.removeTag(e,"image"),e=this.removeTag(e,"note"),e=this.removeTag(e,"copyright"),e=this.removeTag(e,"video"),e=this.removeTag(e,"metadata"),(e=(e=this.removeTag(e,"resource")).replace(new RegExp(/belin-title/g),"p")).replace(new RegExp(/\n/g),"")}}t.CaptureBelinGrainSimple=o},1845:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseLinkAsPoplabMediaObject=void 0,t.parseLinkAsPoplabMediaObject=function(e,t,s,o){const a=[new i,new n,new r];for(const i of a)if(i.accept(t.url)){i.processLink(e,t,s,o);break}};class i{accept(e){return e.startsWith("html://")}processLink(e,t){e.exerciseurs.push(t)}}class r{accept(e){return e.startsWith("pdf://")}processLink(e,t,i,r){t.label=i,e.fichiers.push(t)}}class n{accept(e){return e.startsWith("https://")||e.startsWith("http://")}processLink(e,t,i,r){r.textContent?t.label=r.textContent.trim():t.label=i,e.urls.push(t)}}},8286:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createElementFromDomParser=t.sanitize=void 0;const r=i(4056);function n(e,t){for(let i=e.length-1;i>=0;i--){const r=e[i],n=document.createElement(t);n.innerHTML=r.innerHTML,Array.from(r.attributes).forEach((e=>{n.setAttribute(e.name,e.value)})),r.replaceWith(n)}}function s(e){return e=e.replace(/<title>/g,"<belin-title>").replace(/<\/title>/g,"</belin-title>"),(new DOMParser).parseFromString(`<body>${e}</body>`,"text/html").body}t.sanitize=function(e,t){return function(e){const t=s(e);return n(t.querySelectorAll('[style="ordered"]'),"ol"),t.querySelectorAll("ol").forEach((e=>{const t=e.getAttribute("start");if(t){const i=parseInt(t,10)-1;e.style.counterReset="item "+i}})),n(t.querySelectorAll("list"),"ul"),n(t.querySelectorAll("item"),"li"),n(t.querySelectorAll("emphasis"),"i"),t.innerHTML}(e=function(e){const t=s(e);return t.querySelectorAll('[for="teacher"]').forEach((e=>{e.remove()})),t.innerHTML}(e=function(e,t,i){return e=(e=(e=e.replace(new RegExp(/<link/g),"<a")).replace(new RegExp(/<\/link>/g),"</a>")).replace(new RegExp(/uri="topic:\/\//g),`href="${r.url_belin}${t.toLowerCase()}-${i.toLowerCase()}/topics/`)}(e,t.discipline,t.level)))},t.createElementFromDomParser=s},4143:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinAPI=void 0;const n=i(4056),s=i(9040),o=i(2688),a=i(4393),l=i(4911),c=i(9270),u=i(315),d=i(7956),p=i(8286);class h extends c.CaptureApiCall{constructor(e,t){super(e),this.type=o.CaptureType.UPLOAD,this.elementNumber=t,this.recapturable=!1,this.editable=!1,this.captureTypes=[new d.CaptureBelinGrainComplexe(this),new u.CaptureBelinGrainSimple(this)]}startCapture(){return r(this,void 0,void 0,(function*(){this.mediaPreviews=[];const e=yield this.getWantedGrain();if(null!=e)for(const t of this.captureTypes){const i=t;if(i.accept(e)){const t=i.startCaptureType(e);this.sendCaptureToMenu(t);break}}else this.reinitializeCapture()}))}getWantedGrain(){return r(this,void 0,void 0,(function*(){this.apiResponse||(this.apiResponse=yield(0,s.getBelinPageResponse)());const e=this.apiResponse.children;this.elementsLength=e.length;const t=e[this.elementNumber];(0,l.smoothScrollToTargetedHtmlElement)(t.id,118);const i=(0,p.sanitize)(t.content,this.apiResponse),r=[];let a=[];t.resources.length>0&&(a=yield this.processMedias(t,r));for(const e of this.processLinks(i))n.handledVideosPlatform.some((t=>e.includes(t)))?r.push(new o.VideoMediaObject(e,e)):r.push(new o.UrlMediaObject(e,e));return{grainContent:i,grainTitle:t.title,grainResources:a,medias:r,pageTitle:this.apiResponse.title,startPage:this.apiResponse.startPage,endPage:this.apiResponse.endPage,discipline:this.apiResponse.discipline,level:this.apiResponse.level,manualId:this.apiResponse.manualId,grainId:t.id,pageId:this.apiResponse.id}}))}getUrlOfResource(e){var t,i;return e.type===s.TypeFichierBelin.HTML?n.url_belin_resources+(null===(t=e.content.downloadPath)||void 0===t?void 0:t.split(".")[0])+"/index.html":null!==(i=e.content.url)&&void 0!==i?i:n.url_belin_resources+e.content.downloadPath}processMedias(e,t){return r(this,void 0,void 0,(function*(){const i=e.resources,r=[];for(const e of i){const t=e;t.type===s.TypeFichierBelin.IMAGE&&2===t.id.split("_").length||r.push({id:t.id,type:t.type,forTeacher:t.forTeacher,content:{url:this.getUrlOfResource(t),downloadPath:t.content.downloadPath,copyright:t.content.copyright,parentCopyright:t.content.parentCopyright}})}for(const e of r)e.type===s.TypeFichierBelin.HTML?t.push(new o.ExerciseurMediaObject(e.id,e.content.url,a.ExerciseurType.BELIN)):e.type===s.TypeFichierBelin.PDF?t.push(new o.FichierMediaObject(e.id,e.content.url,yield this.transformMediaIntoBase64(e.content.url,e.type,e.content.downloadPath),e.type)):t.push(new o.MediaObject(e.id,e.content.url,this.buildTypeFichier(e.type),this.buildCopyright(e.content.copyright,e.content.parentCopyright),yield this.transformMediaIntoBase64(e.content.url,e.type,e.content.downloadPath)));return r}))}processLinks(e){const t=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("resource"),i=[];return t.forEach((e=>{const t=e.querySelector("a");if(t){const e=t.getAttribute("uri");e.startsWith("http")&&i.push(e)}})),i}buildCopyright(e,t){return`${null!=e?e:""}${t?" - "+t:""}`}transformMediaIntoBase64(e,t,i){return r(this,void 0,void 0,(function*(){let r;if(e.includes(n.url_belin_resources))r=e;else{if(!i)return;{const e=yield fetch(`${n.url_belin_api_resources}?key=${i}`,{});r=(yield e.json()).location}}const o=yield fetch(r,{method:"GET",headers:{"Cache-Control":"no-cache","Access-Control-Allow-Origin":"*"}}),a=yield o.blob();if(t===s.TypeFichierBelin.IMAGE){const e=yield this.blobToImage(a);if(e.width*e.height>n.maxResolution)return}return yield this.blobToBase64(a)}))}blobToImage(e){return new Promise(((t,i)=>{const r=URL.createObjectURL(e),n=new Image;n.onload=()=>{URL.revokeObjectURL(r),t(n)},n.onerror=i,n.src=r}))}blobToBase64(e){return r(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{const r=new FileReader;r.onload=()=>{const e=r.result;t(e)},r.onerror=i,r.readAsDataURL(e)}))}))}buildTypeFichier(e){switch(e){case s.TypeFichierBelin.IMAGE:return o.TypeFichier.IMAGE;case s.TypeFichierBelin.AUDIO:return o.TypeFichier.AUDIO;case s.TypeFichierBelin.VIDEO:return o.TypeFichier.VIDEO;case s.TypeFichierBelin.PDF:return o.TypeFichier.FICHIER;case s.TypeFichierBelin.HTML:return o.TypeFichier.EXERCISEUR;case s.TypeFichierBelin.URL:default:return o.TypeFichier.LIEN}}}t.CaptureBelinAPI=h},4911:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fromHTML=t.clearHighlight=t.smoothScrollToTargetedHtmlElement=t.hasSameFileTypeMoreThanOnce=t.getCountPerFileType=void 0;const r=i(2688);function n(e){return Object.entries(e.reduce(((e,t)=>{const i=t.type_fichier;return e[i]=(e[i]||0)+1,e}),{})).map((([e,t])=>({typeFichier:e,count:t})))}t.getCountPerFileType=n,t.hasSameFileTypeMoreThanOnce=function(e){const t=n(e);return t.filter((e=>e.count>1)).length>0||2===t.filter((e=>e.typeFichier===r.TypeFichier.IMAGE||e.typeFichier===r.TypeFichier.VIDEO)).length};t.smoothScrollToTargetedHtmlElement=function(e,t=0){const i=document.querySelector(`#${e}`);if(i){const e=function(e){let t=e.parentElement;for(;t;){const e=window.getComputedStyle(t);if("auto"===e.overflowY||"scroll"===e.overflowY)return t;t=t.parentElement}return null}(i);if(e){let r=i.getBoundingClientRect().top+e.scrollTop-t;r>e.scrollHeight-e.getBoundingClientRect().height&&(r=e.scrollHeight-e.getBoundingClientRect().height),a(Math.floor(r),e).then((()=>o(i)))}else{let e=i.getBoundingClientRect().top+window.scrollY-t;const r=function(){const e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)-window.innerHeight-40}();e>r&&(e=r),a(Math.floor(e)).then((()=>o(i)))}}};let s=null;function o(e){s&&s.classList.remove("poplab-highlighted"),s=e;let t=document.getElementById("poplab-highlight-stylesheet");t||(t=document.createElement("style"),t.id="poplab-highlight-stylesheet",t.textContent="\n        .poplab-highlighted {\n            border: solid 8px rgb(75, 198, 185);\n        }",document.head.appendChild(t)),setTimeout((()=>{e.classList.add("poplab-highlighted")}),100)}function a(e,t){return t?t.scrollTo({top:e,behavior:"smooth"}):window.scrollTo({top:e,behavior:"smooth"}),new Promise((i=>{const r=()=>{t?Math.floor(t.scrollTop)!==e&&Math.ceil(t.scrollTop)!==e||(t.removeEventListener("scroll",r),i()):Math.floor(window.scrollY)!==e&&Math.ceil(window.scrollY)!==e||(window.removeEventListener("scroll",r),i())};t?(t.removeEventListener("scroll",r),Math.floor(t.scrollTop)===e||Math.ceil(t.scrollTop)===e?i():t.addEventListener("scroll",r)):(window.removeEventListener("scroll",r),Math.floor(window.scrollY)===e||Math.ceil(window.scrollY)===e?i():window.addEventListener("scroll",r))}))}t.clearHighlight=function(){var e;const t=document.getElementById("poplab-highlight-stylesheet");t&&(null===(e=t.parentNode)||void 0===e||e.removeChild(t))},t.fromHTML=function(e){if(!e)return null;const t=document.createElement("template");t.innerHTML=e;const i=t.content.children;return 1===i.length?i[0]:i}},2688:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentCaptureData=t.ElementCaptureData=t.CaptureData=t.FichierMediaObject=t.ExerciseurMediaObject=t.UrlMediaObject=t.AudioMediaObject=t.VideoMediaObject=t.ImageMediaObject=t.MediaObject=t.TypeFichier=t.CaptureType=void 0;const r=i(4393);var n,s;!function(e){e.BASIQUE="BASIQUE",e.UPLOAD="UPLOAD"}(n||(t.CaptureType=n={})),function(e){e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.FICHIER="FICHIER",e.LIEN="LIEN",e.EXERCISEUR="EXERCISEUR"}(s||(t.TypeFichier=s={}));class o{constructor(e,t,i,r,n,s,o){this.id=e,this.url=t,this.type_fichier=i,this.copyright=r,this.file=n,this.editeur=s,this.subTypeFichier=o}}t.MediaObject=o,t.ImageMediaObject=class extends o{constructor(e,t,i,r,n){super(e,t,s.IMAGE,i,r,n)}},t.VideoMediaObject=class extends o{constructor(e,t,i,r,n){super(e,t,s.VIDEO,i,r,n)}},t.AudioMediaObject=class extends o{constructor(e,t,i,r,n){super(e,t,s.AUDIO,i,r,n)}},t.UrlMediaObject=class extends o{constructor(e,t,i,r){super(e,t,s.LIEN,i),this.displayPreview=!1,this.bigPreview=!1,this.label=r}},t.ExerciseurMediaObject=class extends o{constructor(e,t,i){super(e,t,s.EXERCISEUR),this.typeExerciseur=i}},t.FichierMediaObject=class extends o{constructor(e,t,i,r,n){super(e,t,s.FICHIER,void 0,i,void 0,r),this.label=n}};class a{constructor(e,t,i){this.titre=e,this.description=t,this.auteurInitial=i}}t.CaptureData=a;class l extends a{constructor(e){var t,i,n,s,o,a,l;super(null==e?void 0:e.titre,null==e?void 0:e.description,null==e?void 0:e.auteurInitial),this.type=r.ElementType.ELEMENT,this.images=[],this.videos=[],this.audios=[],this.urls=[],this.exerciseurs=[],this.fichiers=[],this.credit=null==e?void 0:e.credit,this.images=null!==(t=null==e?void 0:e.images)&&void 0!==t?t:[],this.videos=null!==(i=null==e?void 0:e.videos)&&void 0!==i?i:[],this.audios=null!==(n=null==e?void 0:e.audios)&&void 0!==n?n:[],this.urls=null!==(s=null==e?void 0:e.urls)&&void 0!==s?s:[],this.exerciseurs=null!==(o=null==e?void 0:e.exerciseurs)&&void 0!==o?o:[],this.fichiers=null!==(a=null==e?void 0:e.fichiers)&&void 0!==a?a:[],this.type=null!==(l=null==e?void 0:e.type)&&void 0!==l?l:r.ElementType.ELEMENT,this.options=null==e?void 0:e.options,this.meta=null==e?void 0:e.meta}setTitre(e){return this.titre=e,this}setDescription(e){return this.description=e,this}setCredit(e){return this.credit=e,this}setImages(e){return this.images=e,this}setVideos(e){return this.videos=e,this}setAudios(e){return this.audios=e,this}setUrls(e){return this.urls=e,this}setExerciseurs(e){return this.exerciseurs=e,this}setType(e){return this.type=e,this}getMedias(){return this.images.concat(this.videos.concat(this.audios.concat(this.fichiers)))}getAllEmbeds(){return this.getMedias().concat(this.urls).concat(this.exerciseurs)}}t.ElementCaptureData=l,t.DocumentCaptureData=class extends a{constructor(e){super(null==e?void 0:e.titre,null==e?void 0:e.description,null==e?void 0:e.auteurInitial),this.elements=[],null==e||e.elements.forEach((e=>this.elements.push(new l(e)))),this.meta=null==e?void 0:e.meta}setTitre(e){return this.titre=e,this}setDescription(e){return this.description=e,this}setElements(e){return this.elements=e,this}}},8033:(e,t)=>{var i,r,n,s,o;Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserContextMenusId=t.MessageOngletDone=t.MessageOnglet=t.MessageOngletType=t.BrowserRuntimeResponse=t.BrowserRuntimeMessageSearchArborescenceWithSelectionnable=t.BrowserRuntimeMessageSearchArborescence=t.BrowserRuntimeMessageGetRecentArborescenceWithSelectionnable=t.BrowserRuntimeMessageGetRecentArborescence=t.BrowserRuntimeMessageForPoplab=t.BrowserRuntimeMessage=t.BrowserRuntimeMessageEventSubType=t.BrowserRuntimeMessageEventType=void 0,function(e){e.STATUS="status",e.CONNECT="connect",e.ENVOYER_SUR_POPLAB="envoyer_sur_poplab",e.CAPTURE_TAB="captureTab",e.GET_RECENT_ARBORESCENCE="getRecentHierarchies",e.SEARCH_ARBORESCENCE="searchArborescence"}(i||(t.BrowserRuntimeMessageEventType=i={})),function(e){e.WITH_SELECTIONNABLE="WithSelectionnable"}(r||(t.BrowserRuntimeMessageEventSubType=r={}));class a{constructor(e,t,i){this.type=e,this.subType=t,this.idp=i}}t.BrowserRuntimeMessage=a,t.BrowserRuntimeMessageForPoplab=class extends a{constructor(e,t,r,n){super(i.ENVOYER_SUR_POPLAB),this.type_item_poplab=e,this.type_capture=t,this.data=r,this.destination=n}},t.BrowserRuntimeMessageGetRecentArborescence=class extends a{constructor(){super(i.GET_RECENT_ARBORESCENCE)}},t.BrowserRuntimeMessageGetRecentArborescenceWithSelectionnable=class extends a{constructor(){super(i.GET_RECENT_ARBORESCENCE,r.WITH_SELECTIONNABLE)}};class l extends a{constructor(e,t,i){super(t,i),this.value=e}}t.BrowserRuntimeMessageSearchArborescence=class extends l{constructor(e){super(e,i.SEARCH_ARBORESCENCE)}},t.BrowserRuntimeMessageSearchArborescenceWithSelectionnable=class extends l{constructor(e){super(e,i.SEARCH_ARBORESCENCE,r.WITH_SELECTIONNABLE)}},function(e){e.INTERDIT="interdit",e.DECONNECTE="déconnecté",e.CONNECTE="connecté",e.ENVOYE="envoyé"}(n||(t.BrowserRuntimeResponse=n={})),function(e){e.STOP_CAPTURE="stopCapture",e.CAPTURER_LIEN="capturerLien",e.CAPTURER_IMAGE="capturerImage",e.CAPTURER_VIDEO="capturerVideo",e.TOGGLE_CAPTURE="toggleCapture",e.START_CAPTURE="startCapture",e.UPLOAD_FRIGO_DONE="uploadFrigoDone",e.CANCEL_UPLOAD="cancelUpload",e.REFRESH_CAPTURE="refreshCapture"}(s||(t.MessageOngletType=s={}));class c{constructor(e,t,i){this.first_name=void 0,this.provenance=void 0,this.type=e,this.first_name=t,this.provenance=i}}t.MessageOnglet=c,t.MessageOngletDone=class extends c{constructor(e,t){super(e),this.documentId=t}},function(e){e.SE_DECONNECTER="se-deconnecter",e.VOIR_FRIGO="voir-frigo",e.ENVOYER_LIEN="envoyer-lien",e.ENVOYER_IMAGE="envoyer-image",e.ENVOYER_VIDEO="envoyer-video"}(o||(t.BrowserContextMenusId=o={}))},1142:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.AuteurInitial=t.Auteur=void 0,t.Auteur=class{constructor(e,t){this.username=e,this.userId=t}},function(e){e.BELIN="© Belin Éducation / Humensis"}(i||(t.AuteurInitial=i={}))},4393:(e,t)=>{var i,r,n,s;Object.defineProperty(t,"__esModule",{value:!0}),t.Editeur=t.ElementType=t.ExerciseurType=t.PoplabElementCreationRequest=void 0,t.PoplabElementCreationRequest=class{constructor(e,t){var r,s,o;this.titre=null!==(r=e.titre)&&void 0!==r?r:"",this.description=null!==(s=e.description)&&void 0!==s?s:"",this.type=e.type,this.options={isnew:!0,separator:!1},this.type!==n.SECTION||this.titre||(this.options.separator=!0),this.credits=null!==(o=e.credit)&&void 0!==o?o:"",this.webAuteurInitial=e.auteurInitial,this.imageEmbed=e.images[0]?{url:e.images[0].url,type:i.IMAGE}:void 0,this.videoEmbed=e.videos[0]?{url:e.videos[0].url,type:i.VIDEO}:void 0,this.audioEmbed=e.audios[0]?{url:e.audios[0].url,type:i.AUDIO}:void 0,this.lienEmbed=e.urls[0]?{url:e.urls[0].url,label:e.urls[0].label,displayPreview:e.urls[0].displayPreview,bigPreview:e.urls[0].bigPreview,type:i.LIEN}:void 0,this.exerciseur=e.exerciseurs[0]?{url:e.exerciseurs[0].url,exerciseurType:e.exerciseurs[0].typeExerciseur,type:i.EXERCISEUR}:void 0,t&&(this.document=t),this.meta=e.meta}},function(e){e.LIEN="LIEN",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.FICHIER="FICHIER",e.EXERCISEUR="EXERCISEUR"}(i||(i={})),function(e){e.QUIZLET="QUIZLET",e.LEARNINGAPPS="LEARNINGAPPS",e.GENIALLY="GENIALLY",e.BOOKWIDGETS="BOOKWIDGETS",e.EDUPOOL="EDUPOOL",e.BELIN="BELIN"}(r||(t.ExerciseurType=r={})),function(e){e.ELEMENT="element",e.SECTION="section"}(n||(t.ElementType=n={})),function(e){e.BELIN="https://www.belin-education.com/"}(s||(t.Editeur=s={}))},853:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.PoplabObjectType=void 0,function(e){e.ELEMENT="ELEMENT",e.DOCUMENT="DOCUMENT"}(i||(t.PoplabObjectType=i={}))}},t={};!function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}(4143)})();