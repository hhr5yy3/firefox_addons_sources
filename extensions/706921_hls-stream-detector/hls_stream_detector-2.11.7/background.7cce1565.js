(()=>{let e,t,r,a,o,n,i,s,c,l,d,u,m,f,g,p;function w(e,t,r,a){Object.defineProperty(e,t,{get:r,set:a,enumerable:!0,configurable:!0})}function h(e){return e&&e.__esModule?e.default:e}var y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},b={},v={},x=y.parcelRequire8014;null==x&&((x=function(e){if(e in b)return b[e].exports;if(e in v){var t=v[e];delete v[e];var r={id:e,exports:{}};return b[e]=r,t.call(r.exports,r,r.exports),r.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){v[e]=t},y.parcelRequire8014=x),x.register("coEyi",function(e,t){"use strict";w(e.exports,"register",()=>r,e=>r=e),w(e.exports,"resolve",()=>a,e=>a=e);var r,a,o={};r=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)o[t[r]]=e[t[r]]},a=function(e){var t=o[e];if(null==t)throw Error("Could not resolve bundle with id "+e);return t}}),x.register("ac9na",function(e,t){w(e.exports,"getBundleURL",()=>r,e=>r=e);"use strict";var r,a={};r=function(e){var t=a[e];return t||(t=function(){try{throw Error()}catch(t){var e=(""+t.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(e)return(""+e[2]).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}(),a[e]=t),t}}),x("coEyi").register(JSON.parse('{"2tMng":"background.7cce1565.js","iW8rC":"icon-light-16.738042ec.png","aZaja":"icon-light-48.40e4ad95.png","lnA6Q":"icon-light-96.157f7b85.png","6DZ8k":"icon-dark-16.d158b7cb.png","b9VrW":"icon-dark-48.3050a510.png","lXsEZ":"icon-dark-96.4236c605.png","34kBZ":"icon-light-enabled-16.e1f2fee5.png","lWM7X":"icon-light-enabled-48.0d9d7dc0.png","9QPEP":"icon-light-enabled-96.3cf28ed0.png","2KkCV":"icon-dark-enabled-16.bd6e47e2.png","85CF7":"icon-dark-enabled-48.4a699580.png","5KTkt":"icon-dark-enabled-96.0a43ab4e.png"}'));var L={disablePref:!1,subtitlePref:!1,filePref:!0,downloadDirectPref:!1,autoDownloadPref:!1,fileSizePref:!1,fileSizeAmount:"1",manifestPref:!1,copyMethod:"url",userCommand:"",regexCommandPref:!1,regexCommand:"",regexReplace:"",customExtPref:!1,customExtEntries:[],customCtPref:!1,customCtEntries:[],headersPref:!0,titlePref:!0,filenamePref:!1,timestampPref:!1,fileExtension:"ts",streamlinkOutput:"file",downloaderPref:!1,multithreadPref:!0,multithreadAmount:"4",proxyPref:!1,customCommandPref:!1,customCommand:"",blacklistPref:!1,blacklistEntries:[],noRestorePref:!1,recentPref:!1,recentAmount:"5",notifDetectPref:!0,notifPref:!1,urlStorageRestore:[],urlStorage:[],tabThis:!0},R=[{ext:["m3u8"],ct:["application/x-mpegurl","application/vnd.apple.mpegurl","audio/vnd.apple.mpegurl"],type:"HLS",category:"stream"},{ext:["mpd","json?base64_init=1"],ct:["application/dash+xml"],type:"DASH",category:"stream"},{ext:["f4m"],ct:["application/f4m"],type:"HDS",category:"stream"},{ext:["ism/manifest"],ct:[],type:"MSS",category:"stream"},{ext:["vtt"],ct:["text/vtt"],type:"VTT",category:"subtitles"},{ext:["srt"],ct:["application/x-subrip"],type:"SRT",category:"subtitles"},{ext:["ttml","ttml2"],ct:["application/ttml+xml"],type:"TTML",category:"subtitles"},{ext:["dfxp"],ct:["application/ttaf+xml"],type:"DFXP",category:"subtitles"},{ext:["mp4","m4v","m4s"],ct:["video/x-m4v","video/m4v","video/mp4"],type:"MP4",category:"files"},{ext:["ts","m2t"],ct:["video/mp2t"],type:"TS",category:"files"},{ext:["aac","m4a"],ct:["audio/aac","audio/m4a"],type:"AAC",category:"files"},{ext:["mp3"],ct:["audio/mpeg"],type:"MP3",category:"files"},{ext:["ogg","ogv","oga","opus"],ct:["video/ogg","audio/ogg","audio/opus"],type:"OGG",category:"files"},{ext:["weba","webm"],ct:["audio/webm","video/webm"],type:"WEBM",category:"files"}];let P=async e=>new Promise(t=>chrome.storage.local.get(e,r=>{Object.prototype.hasOwnProperty.call(r,e)?t(r[e]):t(null)})),C=async e=>new Promise(t=>chrome.storage.local.set(e,()=>t())),E=async()=>new Promise(e=>chrome.storage.local.clear(()=>e()));var H={};H=x("ac9na").getBundleURL("2tMng")+x("coEyi").resolve("iW8rC");var S={};S=x("ac9na").getBundleURL("2tMng")+x("coEyi").resolve("aZaja");var A={};A=x("ac9na").getBundleURL("2tMng")+x("coEyi").resolve("lnA6Q");var M={};M=x("ac9na").getBundleURL("2tMng")+x("coEyi").resolve("6DZ8k");var _={};_=x("ac9na").getBundleURL("2tMng")+x("coEyi").resolve("b9VrW");var q={};q=x("ac9na").getBundleURL("2tMng")+x("coEyi").resolve("lXsEZ");var I={};I=x("ac9na").getBundleURL("2tMng")+x("coEyi").resolve("34kBZ");var k={};k=x("ac9na").getBundleURL("2tMng")+x("coEyi").resolve("lWM7X");var B={};B=x("ac9na").getBundleURL("2tMng")+x("coEyi").resolve("9QPEP");var U={};U=x("ac9na").getBundleURL("2tMng")+x("coEyi").resolve("2KkCV");var T={};T=x("ac9na").getBundleURL("2tMng")+x("coEyi").resolve("85CF7");var D={};D=x("ac9na").getBundleURL("2tMng")+x("coEyi").resolve("5KTkt"),chrome.browserAction=chrome.browserAction||chrome.action;let F=chrome.i18n.getMessage,O=[],W=[],j=[],Z=[],z=-1,N={ext:[],ct:[],type:"CUSTOM",category:"custom"},V=chrome.runtime.getURL("").startsWith("chrome-extension://"),X=()=>window.matchMedia("(prefers-color-scheme: dark)").matches,K=async()=>{e=await P("subtitlePref"),t=await P("filePref"),r=await P("fileSizePref"),a=await P("fileSizeAmount"),o=await P("manifestPref"),n=await P("blacklistPref"),i=await P("blacklistEntries"),s=await P("customExtPref"),N.ext=await P("customExtEntries"),c=await P("customCtPref"),N.ct=await P("customCtEntries"),l=await P("noRestorePref"),d=await P("disablePref"),u=await P("notifDetectPref"),m=await P("notifPref"),f=await P("downloadDirectPref"),g=await P("autoDownloadPref")},Q=()=>{!0!==d?chrome.browserAction.setIcon({path:{16:X?h(U):h(I),48:X?h(T):h(k),96:X?h(D):h(B)}}):chrome.browserAction.setIcon({path:{16:X?h(M):h(H),48:X?h(_):h(S),96:X?h(q):h(A)}})},G=()=>{chrome.webRequest.onBeforeSendHeaders.addListener(ee,{urls:["<all_urls>"]},V?["requestHeaders","extraHeaders"]:["requestHeaders"]),chrome.webRequest.onHeadersReceived.addListener(ee,{urls:["<all_urls>"]},V?["responseHeaders","extraHeaders"]:["responseHeaders"])},$=async()=>{for(let e in L)await P(e)===null&&await C({[e]:L[e]});await C({filterInput:""}),C({version:chrome.runtime.getManifest().version}),chrome.runtime.getPlatformInfo(async e=>{C({newline:p="win"===e.os?"\r\n":"\n"})}),chrome.browserAction.setBadgeBackgroundColor({color:"green"}),chrome.browserAction.setBadgeText({text:""}),chrome.browserAction.onClicked.addListener((e,t)=>t?.button===1&&chrome.tabs.create({url:"/popup.html"})),await K()},J=async e=>new Promise(t=>chrome.tabs.get(e,e=>t(e))),Y=(s,c,l,d)=>{if(!s||-1===c.tabId)return!1;let u=j.find(e=>e.url===c.url);return!(u&&(u.requestId!==c.requestId||!O.includes(c.requestId))||e&&"subtitles"===s.category||t&&"files"===s.category||r&&("files"===s.category||"custom"===s.category)&&l&&Math.floor(l.value/1024/1024)<Number(a)||o&&"stream"===s.category||n&&i?.some(e=>c.url.toLowerCase().includes(e.toLowerCase())||(c.documentUrl||c.originUrl||c.initiator)?.toLowerCase().includes(e.toLowerCase())||d?.value?.toLowerCase().includes(e.toLowerCase())||s.type.toLowerCase().includes(e.toLowerCase())))},ee=e=>{let t,r;let a=new URL(e.url).pathname.toLowerCase();(t=s&&N.ext?.some(e=>a.toLowerCase().includes("."+e))&&N)||(t=R.find(e=>e.ext?.some(e=>a.toLowerCase().includes("."+e)))),e.headers=e.responseHeaders||e.requestHeaders;let o=e.headers?.find(e=>"content-type"===e.name.toLowerCase());!o?.value||(r=c&&N?.ct?.some(e=>o.value.toLowerCase().includes(e.toLowerCase()))&&N)||(r=R.find(e=>e.ct?.some(e=>o.value.toLowerCase()===e.toLowerCase())));let n=e.headers?.find(e=>"content-length"===e.name.toLowerCase()),i=r||t;Y(i,e,n,o)&&(O.push(e.requestId),e.type=i.type,e.category=i.category,et(e))},et=async e=>{let r=new URL(e.url),a=r.pathname.toLowerCase().includes(".ism/manifest")?r.pathname.slice(0,r.pathname.lastIndexOf("/")):r.pathname,o=+a.lastIndexOf("/")?a.slice(a.lastIndexOf("/")+1):"/"===a[0]?a.slice(1):a,{hostname:n}=r,i=await J(e.tabId),s={category:e.category,documentUrl:e.documentUrl,originUrl:e.originUrl,initiator:e.initiator,requestId:e.requestId,tabId:e.tabId,timeStamp:e.timeStamp,type:e.type,url:e.url,headers:e.headers?.filter(e=>"user-agent"===e.name.toLowerCase()||"referer"===e.name.toLowerCase()||"cookie"===e.name.toLowerCase()||"set-cookie"===e.name.toLowerCase()||"content-length"===e.name.toLowerCase()),filename:o,hostname:n,tabData:{title:i?.title,url:i?.url,incognito:i?.incognito}},c=j.find(t=>t.requestId===e.requestId);if(c){let t=[...c.headers,...s.headers];j[j.findIndex(t=>t.requestId===e.requestId)].headers=t}else j.push(s),chrome.browserAction.getBadgeText({},e=>chrome.browserAction.setBadgeText({text:(Number(e)+1).toString()}));if(clearTimeout(z),W.push({requestId:s.requestId,filename:s.filename,type:s.type}),z=setTimeout(async()=>{await C({urlStorage:j}),chrome.runtime.sendMessage({urlStorage:!0}),W.map(e=>e.requestId).forEach(e=>O.splice(O.indexOf(e,1))),u||m||g&&(!g||!t)||(W.length>1?chrome.notifications.create("add",{type:"basic",iconUrl:h(q),title:F("notifManyTitle"),message:F("notifManyText")+W.map(e=>e.filename).join(p)}):chrome.notifications.create("add",{type:"basic",iconUrl:h(q),title:F("notifTitle"),message:F("notifText",e.type)+o})),W.length=0},100),("files"===s.category||"custom"===s.category)&&f&&g){let e=chrome.runtime.getURL("").startsWith("chrome-extension://")?{filename:s.filename,url:s.url,saveAs:!1}:{filename:s.filename,headers:s.headers?.filter(e=>"referer"===e.name.toLowerCase())||[],incognito:s.tabData?.incognito||!1,url:s.url,saveAs:!1};chrome.downloads.download(e)}},er=async e=>{!0!==e.previous?j=j.filter(t=>!e.delete.map(e=>e.requestId).includes(t.requestId)):Z=Z.filter(t=>!e.delete.map(e=>e.requestId).includes(t.requestId)),await C({urlStorage:j}),await C({urlStorageRestore:Z}),chrome.runtime.sendMessage({urlStorage:!0})};(async()=>{let e=chrome.runtime.getManifest().version,t=await P("version");t&&t!==e&&await P("noRestorePref")&&await C({noRestorePref:!1}),await $(),!0!==d&&(G(),Q()),j=await P("urlStorage"),Z=await P("urlStorageRestore"),Z=j&&j.length>0&&!l?(Z=[...Z,...j]).filter(e=>e.tabData?.incognito!==!0):[],await C({urlStorageRestore:Z}),j=[],await C({urlStorage:j}),chrome.runtime.onMessage.addListener(async e=>{e.delete?er(e):e.options?(await K(),!0===d&&chrome.webRequest.onBeforeSendHeaders.hasListener(ee)&&chrome.webRequest.onHeadersReceived.hasListener(ee)?(chrome.webRequest.onBeforeSendHeaders.removeListener(ee),chrome.webRequest.onHeadersReceived.removeListener(ee)):!0===d||chrome.webRequest.onBeforeSendHeaders.hasListener(ee)||chrome.webRequest.onHeadersReceived.hasListener(ee)||G(),Q()):e.reset&&(await E(),j=[],Z=[],await $(),chrome.runtime.sendMessage({options:!0}))}),chrome.commands.onCommand.addListener(e=>{"open-popup"===e&&chrome.browserAction.openPopup(),"open-sidebar"===e&&chrome.sidebarAction.open()}),chrome.runtime.onConnect.addListener(e=>{"popup"===e.name&&e.onDisconnect.addListener(()=>{chrome.browserAction.setBadgeBackgroundColor({color:"green"}),chrome.browserAction.setBadgeText({text:""})})})})()})();