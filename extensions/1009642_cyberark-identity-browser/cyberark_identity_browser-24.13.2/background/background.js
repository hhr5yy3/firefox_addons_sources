"undefined"==typeof _idaptiveUniqueGlobal&&(_idaptiveUniqueGlobal={}),function(){function a(){var t=this;y.storage.get(y.preference.perfKeyEnum.debugMode).then(function(e){t.debugMode=e}),browser.runtime.onMessage.addListener(function(e){e.action===y.preference.perfKeyEnum.debugMode&&(e=e.value,t.debugMode=e)})}var y=this,s=(void 0===y.preference&&(y.preference={}),void 0===y.firefox&&(y.firefox={}),void 0===y.jQuery&&(y.jQuery=$),y.background.log={logLimit:100,log:[],clear:function(){this.log=[]},addLog:function(e){for(this.log.push(e);this.log.length>this.logLimit;)this.log.shift()},setLogLimit:function(e){for(this.logLimit=e;this.log.length>e;)this.log.shift()}},y.storage.get(y.preference.perfKeyEnum.debugMode).then(function(e){y.background.log.setLogLimit(e?5e3:100)}),browser.runtime.onMessage.addListener(function(e){e.action===y.preference.perfKeyEnum.debugMode&&(e=e.value,y.background.log.setLogLimit(e?5e3:100))}),y.firefox.Log={},y.firefox.Log.prototype={logWithLevel:function(e,t){this.logWithEverything(this.getTime(),"-",e,this.loggerName,t)},logWithEverything:function(e,t,n,i,r){this.isLogLevelEnabled(n)&&y.common.CentrifyBEBase.prototype.logWithEverything.call(this,y.log.logPrefix,e,this.getLevelString(n),i,r),(n>y.log.LOG_LEVEL.INFO||this.debugMode)&&y.background.log.addLog([e,t,this.getLevelString(n),i,r])}},{}),c={};y.background.BackgroundMessageListener=function(){y.common.CentrifyBEBase.call(this),this.logWithLevel=y.firefox.Log.prototype.logWithLevel,this.logWithEverything=y.firefox.Log.prototype.logWithEverything,a.call(this)},y.background.BackgroundMessageListener.prototype={loggerName:"BG",CentrifyEventEnum:y.communication.CentrifyEventEnum,listener:function(n,e,d){var t=this,i=e.tab;if(i){var r=i.id;switch(n.action){case this.CentrifyEventEnum.setLoginData:s[r]?this.logError("loginData is already set."):(s[r]=n.loginData,this.log("setloginData "+r+" for "+s[r].applicationUrl+"   from "+s[r].originalUrl));break;case this.CentrifyEventEnum.updateLoginData:s[r]?(s[r]=n.loginData,this.log("updateLoginData "+r+" for "+s[r].applicationUrl)):this.logError("the loginData is not set for this tab "+r);break;case this.CentrifyEventEnum.getLoginData:(a=s[r])?this.log("getloginData "+r+" and found "+a.applicationUrl+"   from "+a.originalUrl):this.log("getloginData "+r+" but no matches"),d(a);break;case this.CentrifyEventEnum.removeLoginData:(a=s[r])?this.log("removeLoginData "+r+" for "+a.applicationUrl+"   from "+a.originalUrl):this.log("removeLoginData "+r+" but no matches"),delete s[r];break;case this.CentrifyEventEnum.initAll:return Promise.all([y.storage.get(y.preference.perfKeyEnum.debugMode),y.storage.get(y.preference.perfKeyEnum.debugDelay),y.storage.get(y.preference.perfKeyEnum.additionalParameters),y.storage.get(y.preference.perfKeyEnum.portalHostname),y.storage.get(y.preference.perfKeyEnum.associatedChildPod),y.storage.get(y.preference.perfKeyEnum.skippedSites),y.storage.get(y.preference.perfKeyEnum.enableLCLocal),y.storage.get(y.preference.perfKeyEnum.disableBrowserPasswordPrompts),y.storage.get(y.preference.perfKeyEnum.genpassConfig),y.storage.get(y.preference.perfKeyEnum.isLoggedInShellTenant),y.storage.get(y.preference.perfKeyEnum.loggedInShellTenantDetails)]).then(function([e,t,n,i,r,a,o,s,c,l,p]){e={debugMode:e,debugDelay:t,addtlParams:n,portalHostname:i,associatedChildPod:r,skippedSites:a,enableLCLocal:o,disableBrowserPasswordPrompts:s,browserType:"Firefox",userSetting:y.net.centrifyService.userSetting,cbeVersion:y.firefox.systemData.cbeVersion,genpassConfig:c,isLoggedInShellTenant:l,loggedInShellTenantDetails:p};d(e)}),!0;case this.CentrifyEventEnum.setLastLoginMap:var a=new Date;this.log("tab "+r+" tried to login at "+a.toLocaleString()),c[r]={appkey:n.appkey,time:a};break;case this.CentrifyEventEnum.log:this.logWithEverything(n.time,r,n.level,n.loggerName,n.message);break;case this.CentrifyEventEnum.logv2:y.background.log.addLog([n.time,r,n.level,n.loggerName,n.message]),console.log(n.time+" "+n.level+" ["+n.loggerName+"]: "+n.message);break;case this.CentrifyEventEnum.getCfaRequest:y.net.centrifyService.getCFA(r,n.app,n.fillOnly);break;case this.CentrifyEventEnum.handleMFA:a=n.app;let e="https://"+y.net.centrifyService.childpodHostname+"/uprest/HandleAppClick?appkey="+a.appkey;a.isNewApp&&(e+="&markAppVisited=true"),e+="&cbecurversion="+y.brand.version,browser.tabs.update(r,{url:e});break;case this.CentrifyEventEnum.centrifyServiceRequest:y.net.centrifyService.request(n.data.path,n.data.input,function(e){browser.tabs.sendMessage(r,{action:y.communication.CentrifyEventEnum.centrifyServiceResponse,data:{messageId:n.data.messageId,success:e}})},function(e,t){browser.tabs.sendMessage(r,{action:y.communication.CentrifyEventEnum.centrifyServiceResponse,data:{messageId:n.data.messageId,error:{msg:e,statusCode:t}}})},n.data.method);break;case this.CentrifyEventEnum.getAppsCache:var a=y.formfill.appsUpdater.appkeyToAppMap,o=y.net.centrifyService.childpodHostname;d({appsCache:a,childpodHostname:o});break;case this.CentrifyEventEnum.formfillFiltered:a=n.apps,o=y.formfill.appsUpdater.findAutoLoginApp(a,r);o&&(this.log("found auto login app on "+r+"with appkey "+o.appkey),d({appkey:o.appkey}));break;case this.CentrifyEventEnum.getAppsUpdaterStatus:a=new URL(i.url).host,o=null,a={status:o=y.net.centrifyService.childpodHostname==a?y.formfill.appsUpdater.status:o};d(a);break;case this.CentrifyEventEnum.setChildpodHostname:o=n.isShell?n.newChild.upIdentityURL:n.newChild,a=(this.log("Child pod host name being set to"+o),y.net.centrifyService.childpodHostname=o,y.storage.set(y.preference.perfKeyEnum.associatedChildPod,o),y.net.centrifyService.isChildPodChanged=!0,y.net.centrifyConnection.isChildPodChanged=!0,y.net.centrifyService.cleanUpUserData(),y.storage.set(y.preference.perfKeyEnum.isLoggedInShellTenant,n.isShell),n.isShell?y.storage.set(y.preference.perfKeyEnum.loggedInShellTenantDetails,n.newChild):y.net.centrifyService.cleanUpShellTenantDetails(),`https://${n.isShell?n.newChild.masterShellTenant:y.net.centrifyService.childpodHostname}/`),o=n.isShell?"idToken-"+n.newChild.tenantUUID:".ASPXAUTH";browser.cookies.get({url:a,name:o},async function(e){e&&e.value?(connStatus=y.net.CONNECTION_STATUS_ENUM.signedIn,status=y.net.centrifyService.userSetting?y.net.SERVICE_STATUS_ENUM.ready:y.net.SERVICE_STATUS_ENUM.waitForSetting,t.log("IBE is ready. status = "+status)):(status=y.net.SERVICE_STATUS_ENUM.notReady,connStatus=y.net.CONNECTION_STATUS_ENUM.notSignedIn,t.log("IBE is not ready. childpodHostname = "+y.net.centrifyService.childpodHostname)),y.net.centrifyService.updateStatus(status),y.net.centrifyConnection.updateStatus(connStatus)});break;case this.CentrifyEventEnum.checkIsAppAccountSignedInRequest:y.background.multiAccountCheckCBE.checkIsAppAccountSignedIn(n.appkey,r);break;case this.CentrifyEventEnum.signOutAppCurAccountRequest:y.background.multiAccountCheckCBE.tryLogOutCurAccount(n.appkey,r)}}}},y.common.objectExtend(y.background.BackgroundMessageListener,y.common.CentrifyBEBase),y.background.backgroundMessageListener=new y.background.BackgroundMessageListener,browser.runtime.onMessage.addListener(function(e,t,n){return y.background.backgroundMessageListener.listener(e,t,n)}),y.login.WebRequestMessageListener=function(){y.login.CentrifyBEHttp401Base.call(this),this.logWithLevel=y.firefox.Log.prototype.logWithLevel,this.logWithEverything=y.firefox.Log.prototype.logWithEverything,a.call(this)},y.login.WebRequestMessageListener.prototype={onAuthRequiredCallback:function(e){try{var t,n,i=e.tabId;if(-1!=i)return t=s[i],n={url:e.url,tabId:i},this.recevied401Header(n,t),n.response}catch(e){this.logError("Error = "+e)}},clearLoginData:function(e){delete s[e.tabId]},fillUsernameAndPassword:function(e,t,n){null==t||null==n?this.logError("Failed to find username/password in the loginData"):(this.log("the username and password is filled"),e.response={authCredentials:{username:t,password:n}})},updateLoginData:function(e,t){s[e.tabId]=t}},y.common.objectExtend(y.login.WebRequestMessageListener,y.login.CentrifyBEHttp401Base),y.background.webRequestMessageListener=new y.login.WebRequestMessageListener,browser.webRequest.onAuthRequired.addListener(function(e){return y.background.webRequestMessageListener.onAuthRequiredCallback(e)},{urls:["<all_urls>"]},["blocking"]),browser.tabs.onRemoved.addListener(function(e,t){delete c[e],y.landcatch.manager.removeEntireApp(e)}),y.background.backgroundMessageListener.log("background message listener started"),y.net.CentrifyService=function(){y.net.CentrifyServiceBase.call(this),a.call(this);var r=this;y.cookieUtil.addCookieListener((e,t)=>{r.cookieChangeHandler(e,t)}),browser.storage.managed.get("tenantId").then(e=>{0<Object.keys(e).length&&e.tenantId&&"string"==typeof e.tenantId?(r.log("reading tenatId from GPO policy, tenantId is "+e.tenantId),y.storage.set(y.preference.perfKeyEnum.portalHostname,e.tenantId),r.init(e.tenantId)):y.storage.get(y.preference.perfKeyEnum.portalHostname).then(function(e){r.init(e)})}).catch(()=>{r.log("can't read the managed tenantId from GPO"),y.storage.get(y.preference.perfKeyEnum.portalHostname).then(function(e){r.init(e)})}),browser.runtime.onMessage.addListener(function(e,t,n){var i;if(e.action===y.preference.perfKeyEnum.portalHostname&&(i=e.value,r.log("portal hostname changed to "+i),r.cleanUpUserData(),r.init(i,!0)),e.action===y.communication.AppsUpdaterEventEnum.getUserPortalURL)return r.cleanUpFailedSettingStatus(),r.getShellUserportURL("https://"+e.portalHost).then(({upIdentityURL:e})=>{n(e)}),!0}),browser.runtime.onMessage.addListener(function(e,t,n){e.action===y.communication.CentrifyEventEnum.pageLoad&&r.handlePageReload(t)})},y.net.CentrifyService.prototype={getClientInfo:function(){return{userAgent:window.navigator.userAgent}},getCurrentUrl:function(t){browser.tabs.query({active:!0,currentWindow:!0},function(e){0<e.length?t(e[0].url):t(null)})},getCFA:function(n,i,r){var a=this;y.common.encryption.generateE2EKeys().then(({publicKey:e,privateKey:t})=>{a.request("/Cbe/GetCFA",{appkey:i.appkey,publicKey:e},function(e){e.success?y.common.encryption.decryptCfaResponse(t,e).then(e=>{browser.tabs.sendMessage(n,{action:y.communication.CentrifyEventEnum.getCfaResponse,app:i,fillOnly:r,result:e})}):(a.logError("getCFA failed "+e.Message),a.handleError(n,i,e))},function(e){a.logError("Call to /Cbe/GetCFA failed. error: "+e)},"post")})},handleMFA:function(e,t){this.log("MFA is enabled for the app with appkey"+t.appkey);let n="https://"+y.net.centrifyService.childpodHostname+"/uprest/HandleAppClick?appkey="+t.appkey;t.isNewApp&&(n+="&markAppVisited=true"),n+="&cbecurversion="+y.brand.version,this.log("So, redirecting to "+n),browser.tabs.update(e,{url:n})},handleError:function(e,t,n){this.userSetting.enableHandleChallenges&&(this.log("IBE handle challenge is enabled"),"_I18N_NeedChallenge"===n.MessageID?this.handleMFA(e,t):(this.log("Showing the error message to the user"),browser.tabs.sendMessage(e,{action:y.communication.ToastMessageEnum.showError,message:n.Message},{frameId:0})))},promptChangeHostname:function(t){var n=this;setTimeout(function(){(async()=>{await n.getStoredChildpodHostname()!==t.newChildPod&&browser.tabs.query({active:!0,currentWindow:!0},function(e){0===e.length?n.log("promptChangeHostname: active tab not found."):(n.log("promptChangeHostname: prompting to change child host name by sending event."),browser.tabs.sendMessage(e[0].id,{action:y.communication.CentrifyEventEnum.setPrompt,currChildPod:t.currChildPod,newChildPod:t.newChildPod,isShell:t.isShell}))})})()},4e3)}},y.common.objectExtend(y.net.CentrifyService,y.net.CentrifyServiceBase),y.net.centrifyService=new y.net.CentrifyService,y.formfill.AppsUpdater=function(e){y.formfill.AppsUpdaterBase.call(this,e),this.logWithLevel=y.firefox.Log.prototype.logWithLevel,this.logWithEverything=y.firefox.Log.prototype.logWithEverything,a.call(this);var t=this;e.addObserver(function(e){t.observer(),e.status===y.net.SERVICE_STATUS_ENUM.ready&&chrome.tabs.query({},function(e){for(var t={action:y.communication.CentrifyEventEnum.formfillEnable},n=0;n<e.length;n++)e[n].url.toLowerCase().startsWith("http")&&chrome.tabs.sendMessage(e[n].id,t)})},"appsUpdater")},y.formfill.AppsUpdater.prototype={AppsUpdaterEventEnum:y.communication.AppsUpdaterEventEnum,useLocalCache:!1,LCSuccessCallback:function(e,t,n){e.success?chrome.tabs.sendMessage(t,{action:y.communication.ToastMessageEnum.showSuccess,message:n},{frameId:0}):chrome.tabs.sendMessage(t,{action:y.communication.ToastMessageEnum.showError,message:e.Message},{frameId:0})},LCFailureCallback:function(e){chrome.tabs.sendMessage(tabId,{action:y.communication.ToastMessageEnum.showError,message:e.msg},{frameId:0})},listener:function(n,t,s){switch(n.action){case this.AppsUpdaterEventEnum.getCredsForApp:return y.common.encryption.generateE2EKeys().then(({publicKey:e,privateKey:t})=>{y.net.centrifyService.request("/Cbe/GetCFAForIBE",{appkey:n.appkey,publicKey:e},function(e){y.common.encryption.decryptCfaResponse(t,e).then(e=>{s(e)})},null,"post")}),!0;case this.AppsUpdaterEventEnum.getCredsForFormFill:return y.common.encryption.generateE2EKeys().then(({publicKey:e,privateKey:t})=>{y.net.centrifyService.request("/Cbe/GetCFA",{appkey:n.appkey,publicKey:e},function(e){y.common.encryption.decryptCfaResponse(t,e).then(e=>{s(e)})},null,"post")}),!0;case this.AppsUpdaterEventEnum.getCredsForSecuredItem:return y.common.encryption.generateE2EKeys().then(({publicKey:e,privateKey:t})=>{y.net.centrifyService.postRequest("/uprest/GetCredsForSecuredItem?sItemKey="+n.itemKey,{publicKey:e},function(e){y.common.encryption.decryptSecuredItem(t,e,n.type).then(e=>{s(e)})})}),!0;case this.AppsUpdaterEventEnum.updateAppIcon:this.updateAppIcon(n.data.appkey,n.data.iconURL);break;case this.AppsUpdaterEventEnum.getVerificationCodeForApp:Math.floor(Date.now()/1e3);return y.net.centrifyService.request("/uprest/GetTotpCodes",{appkey:n.appkey,actionType:n.actionType},function(o){if(o.success){let e=Array.isArray(o.Result.TOTPCodes)?o.Result.TOTPCodes:Object.values(o.Result.TOTPCodes),t=Date.now()/1e3,n=o.Result.Period,i=Math.floor(o.Result.EpochTimeInSec/n),r=Math.floor(t/n),a=r-i;o=(e=e.slice(a))[0];o&&s(atob(o))}},null,"post"),!0;case this.AppsUpdaterEventEnum.getVerificationCodeForSecuredPassword:return y.net.centrifyService.request("/uprest/GetTotpCodesForSecuredPassword",{sItemkey:n.itemKey,actionType:n.actionType},function(o){if(o.success){let e=Array.isArray(o.Result.TOTPCodes)?o.Result.TOTPCodes:Object.values(o.Result.TOTPCodes),t=Date.now()/1e3,n=o.Result.Period,i=Math.floor(o.Result.EpochTimeInSec/n),r=Math.floor(t/n),a=r-i;o=(e=e.slice(a))[0];o&&s(atob(o))}},null,"post"),!0;case this.AppsUpdaterEventEnum.createDetectedPersonalApp:var i=this;y.common.encryption.encryptPasswordInPayload(n.payload,y.net,!1).then(e=>{y.net.centrifyService.postRequest("/uprest/CreateDetectedPersonalApp",e,function(e){i.LCSuccessCallback(e,t.tab.id,"Added")},function(e){i.LCFailureCallback(result,t.tab.id)})});break;case this.AppsUpdaterEventEnum.updateUserCreds:i=this;y.common.encryption.encryptPasswordInPayload(n.payload,y.net,!1).then(e=>{y.net.centrifyService.postRequest("/uprest/UpdateCapturedCreds?appkey="+n.appkey,e,function(e){i.LCSuccessCallback(e,t.tab.id,"Updated")},function(e){i.LCFailureCallback(e,t.tab.id)})});break;case this.AppsUpdaterEventEnum.getCompromisedPasswordStatus:return y.common.encryption.sha1Hash(n.password).then(e=>{y.net.centrifyService.request("/uprest/GetCompromisedPasswordStatus",{Password:e},function(e){s(e)},null,"post")}),!0;case this.AppsUpdaterEventEnum.getMatchApps:for(var e=n.docAppUrl,r=(l=this.getAppHostname(e)).split(".").reverse(),a=this.getMatchApps(r),o=[],c=0;c<a.length;c++)y.net.centrifyService.userSetting.enabledAppsURLPatternCheck&&a[c].app.urlMatchDetection&&!this.checkAppUrlPattern(a[c].app,e)||o.push({app:a[c].app});s(o);break;case this.AppsUpdaterEventEnum.buildContextMenu:var e=n.docAppUrl,l=encodeURIComponent(this.getAppHostname(e));if(this.log("Setting up context menu for "+l),"ibclick.stream"!==l&&t.tab.url===t.url){for(var r=l.split(".").reverse(),p=this.getMatchAppsForContextMenu(r),d=[],c=0;c<p.length;c++)y.net.centrifyService.userSetting.enabledAppsURLPatternCheck&&p[c].app.urlMatchDetection&&!this.checkAppUrlPattern(p[c].app,e)||d.push({app:p[c].app});t.tab,l=y.net.centrifyConnection.status===y.net.CONNECTION_STATUS_ENUM.signedIn&&y.net.centrifyService.userSetting?.IsCopyUsernamePwdEnabled;var u=d,r=l,g=y.net.centrifyConnection.status;r||g===y.net.CONNECTION_STATUS_ENUM.notSignedIn?browser.menus.removeAll(function(){if(browser.menus.create({title:"CyberArk",id:"cyberArk",contexts:["editable"]}),browser.menus.create({title:"Copy Username",parentId:"cyberArk",id:"copyUsername",contexts:["editable"]}),browser.menus.create({title:"Copy Password",parentId:"cyberArk",id:"copyPassword",contexts:["editable"]}),y.net.centrifyService.userSetting?.isTOTPEnabledForBE&&browser.menus.create({title:"Copy verification code",parentId:"cyberArk",id:"copyVerificationCode",contexts:["editable"]}),g===y.net.CONNECTION_STATUS_ENUM.signedIn)if(0<u.length){var t=u;let e=!1;for(var r,a=0;a<t.length&&a<y.net.centrifyService.userSetting?.maxNumberOfAppsInContextMenu;a++){let i=t[a].app?.appkey;if(t[a].app.Personal&&void 0===t[a].app.CanViewCreds||t[a].app.Personal&&t[a].app.CanViewCreds||t[a].app.AllowViewFixedCredentials&&t[a].app.isSharedAccout||void 0===t[a].app.Personal&&t[a].app.IsPromptForUsername){let n=t[a].app?.username;""!==n?browser.menus.create({title:t[a].app.displayName+" ("+t[a].app.username+")",parentId:"copyUsername",id:"applicationAccounts"+(a+1),contexts:["editable"],onclick:(e,t)=>{var i;i=n,browser.tabs.query({active:!0,currentWindow:!0},function(e){for(var t,n=0;n<e.length;n++)browser.tabs.sendMessage(e[n].id,{action:"copyText",textToCopy:i});y.net.centrifyService.userSetting.isClearClipboardEnabled&&(t=y.net.centrifyService.userSetting.durationForClearingClipboardPassword,y.common.setClearClipboardTimer(t))})}}):browser.menus.create({title:t[a].app.displayName+" (Username is unavailable)",parentId:"copyUsername",id:"applicationAccountswithoutusername"+(a+1),contexts:["editable"]}),!t[a].app.IsMFAEnabled&&t[a].app.raw.PasswordIsSet&&y.net.centrifyService.userSetting.isCopyPasswordAllowed?(r=t[a].app.username||"Username is unavailable",browser.menus.create({title:t[a].app.displayName+" ("+r+")",parentId:"copyPassword",id:"applicationAccountsPassword"+(a+1),contexts:["editable"],onclick:(e,t)=>function(n){var i=this;y.common.encryption.generateE2EKeys().then(({publicKey:e,privateKey:t})=>{y.net.centrifyService.request("/Cbe/GetCFAForIBE",{appkey:n,publicKey:e},function(e){e.success?y.common.encryption.decryptCfaResponse(t,e).then(r=>{null!==r&&null!==r.Result.p?browser.tabs.query({active:!0,currentWindow:!0},function(e){for(var t,n={action:"copyPassword",textToCopy:r.Result.p},i=0;i<e.length;i++)browser.tabs.sendMessage(e[i].id,n);y.net.centrifyService.userSetting.isClearClipboardEnabled&&(t=y.net.centrifyService.userSetting.durationForClearingClipboardPassword,y.common.setClearClipboardTimer(t))}):i.logError("Password is null, unable to copy")}):i.logError("GetCFAForIBE failed"+e.Message)},function(e){i.logError("Call to /Cbe/GetCFAForIBE failed. error: "+e)},"post")})}(i)})):browser.menus.create({title:t[a].app.displayName+" (Password is unavailable)",parentId:"copyPassword",id:"MfaEnabledAppsPassword"+(a+1),contexts:["editable"]})}else browser.menus.create({title:t[a].app.displayName+" (Username is unavailable)",parentId:"copyUsername",id:"applicationAccounts"+(a+1),contexts:["editable"]}),browser.menus.create({title:t[a].app.displayName+" (Password is unavailable)",parentId:"copyPassword",id:"applicationAccountsPassword"+(a+1),contexts:["editable"]});t[a].app.IsTotpEnabled&&y.net.centrifyService.userSetting.isTOTPEnabledForBE&&(e=!0,r=t[a].app.username,browser.menus.create({title:t[a].app.displayName+(r?" ("+r+")":""),parentId:"copyVerificationCode",id:"applicationAccountsTOTP"+(a+1),contexts:["editable"],onclick:(e,t)=>function(e,t){var n=this;Math.floor(Date.now()/1e3);y.net.centrifyService.request("/uprest/GetTotpCodes",{appkey:e,actionType:t},function(s){if(s.success){let e=Array.isArray(s.Result.TOTPCodes)?s.Result.TOTPCodes:Object.values(s.Result.TOTPCodes),t=Date.now()/1e3,n=s.Result.Period,i=Math.floor(s.Result.EpochTimeInSec/n),r=Math.floor(t/n),a=r-i,o=(e=e.slice(a))[0];o&&browser.tabs.query({active:!0,currentWindow:!0},function(e){for(var t,n={action:"copyVerificationCode",textToCopy:atob(o)},i=0;i<e.length;i++)e[i].url.toLowerCase().startsWith("http")&&browser.tabs.sendMessage(e[i].id,n);y.net.centrifyService.userSetting.isClearClipboardEnabled&&(t=y.net.centrifyService.userSetting.durationForClearingClipboardPassword,y.common.setClearClipboardTimer(t))})}},function(e){n.logError("Call to /uprest/GetTotpCode failed. error: "+e)},"post")}(i,y.formfill.TOTP_ACTION_TYPE.ContextMenuCopy)}))}e||browser.menus.create({title:"(Verification code is unavailable)",parentId:"copyVerificationCode",id:"applicationAccountsTOTP",contexts:["editable"]})}else{var e="(No matching accounts)";browser.menus.create({title:e,parentId:"copyUsername",id:"NoMatchedUsernameLogins",contexts:["editable"]}),browser.menus.create({title:e,parentId:"copyPassword",id:"NoMatchedPasswordLogins",contexts:["editable"]}),browser.menus.create({title:e,parentId:"copyVerificationCode",id:"NoMatchedVerificationCodeLogins",contexts:["editable"]})}else{let e="Sign-in to CyberArk",n=y.net.centrifyConnection.signalRClient.centrifyService.superpodHostname;browser.menus.create({title:e,parentId:"copyUsername",id:"signinToCyberArkUsername",contexts:["editable"],onclick:(e,t)=>b(e,0,n)}),browser.menus.create({title:e,parentId:"copyPassword",id:"signinToCyberArkPassword",contexts:["editable"],onclick:(e,t)=>b(e,0,n)}),browser.menus.create({title:e,parentId:"copyVerificationCode",id:"signinToCyberArkVerificationCode",contexts:["editable"],onclick:(e,t)=>b(e,0,n)})}browser.menus.create({id:"cybrGenPass",title:"Generate Password",parentId:"cyberArk",contexts:["editable"]})}):browser.menus.removeAll(function(){browser.menus.create({id:"cybrGenPass",title:"Generate Password",contexts:["editable"]})})}break;case this.AppsUpdaterEventEnum.getPassphraseWordList:return y.net.centrifyService.request("/Cbe/GetPassPhraseDictionary",null,function(e){e.success&&s(e)},function(e){s(e)},"get"),!0;case this.AppsUpdaterEventEnum.getAppByKey:var f=n.appkey,h=this.getAppByKey(f);if(!h)return this.log(`App with ${f} is not found in local cache, fetching from the server`),this.getAppDataByKey([f],s),!0;s(h);break;case this.AppsUpdaterEventEnum.setCBEAppALSetting:for(var m=n.appSettingChanges,c=0;c<m.length;c++)this.setAppSetting(m[c].appkey,m[c].ALupdate,null,null);break;case this.AppsUpdaterEventEnum.addAppNode:f=n.appData;f&&f.AppKey&&(h=new y.formfill.FFApp(f,this.centrifyService.userSetting),this.log("Will add the app to appsUpdater "+h.displayName+"("+h.appkey+")"),this.addNode(h,this.rootNode,this.appkeyToAppMap))}},notifyAppsUpdate:function(e){e&&this.log("Got "+e.apps.length+" apps"),this.log("Sending "+y.communication.CentrifyEventEnum.formfillRecheck+" to all tabs"),browser.tabs.query({},function(e){for(var t={action:y.communication.CentrifyEventEnum.formfillRecheck},n=0;n<e.length;n++)e[n].url.toLowerCase().startsWith("http")&&browser.tabs.sendMessage(e[n].id,t)})},notifyClearData:function(){this.log("Sending "+y.communication.CentrifyEventEnum.formfillClear+" to all tabs"),browser.tabs.query({},function(e){for(var t={action:y.communication.CentrifyEventEnum.formfillClear},n=0;n<e.length;n++)e[n].url.toLowerCase().startsWith("http")&&browser.tabs.sendMessage(e[n].id,t)})},findAutoLoginApp:function(e,t){var n=null,i=0,r=e;this.centrifyService.userSetting.enableCompromisedPasswordCheckForIBE&&this.centrifyService.userSetting.isCompromisedPwdLaunchDisabled&&(r=e.filter(e=>!e.app.IsPwdCompromised));for(var a=0;a<r.length;a++){var o=r[a];if(!0===o.app.setting.isAutoLoginEnabled||!1!==o.app.setting.isAutoLoginEnabled&&this.centrifyService.userSetting.defaultAutoLoginEnabled){if(i++,this.log("app "+o.app.name+" is autologin"),1<i)return null;n=o.app,c[t]&&c[t].appkey===n.appkey&&(this.log("I have login "+c[t].appkey+" at "+c[t].time.toLocaleString()+" and I won't try again."),n=null)}else this.log("app "+o.app.name+" is not autologin")}return n},noticeReady:function(){browser.tabs.query({}).then(function(e){for(var t of e)t.url.includes("uprest/bewarning")&&browser.tabs.sendMessage(t.id,{action:y.communication.CentrifyEventEnum.appsUpdated})}).catch(function(e){this.log("Error when broadcasting apps ready event to browsers: "+e)})}},y.common.objectExtend(y.formfill.AppsUpdater,y.formfill.AppsUpdaterBase),y.formfill.appsUpdater=new y.formfill.AppsUpdater(y.net.centrifyService),browser.runtime.onMessage.addListener(function(e,t,n){return y.formfill.appsUpdater.listener(e,t,n)}),y.securedItem.SecuredItemsUpdater=function(e){y.securedItem.SecuredItemsUpdaterBase.call(this,e),this.logWithLevel=y.firefox.Log.prototype.logWithLevel,this.logWithEverything=y.firefox.Log.prototype.logWithEverything,a.call(this);var t=this;e.addObserver(function(e){t.centrifyService.userSetting?.isSecuredItemsEnabled&&t.observer()},"securedItemsUpdater")},y.securedItem.SecuredItemsUpdater.prototype={useLocalCache:!1},y.common.objectExtend(y.securedItem.SecuredItemsUpdater,y.securedItem.SecuredItemsUpdaterBase),y.securedItem.securedItemsUpdater=new y.securedItem.SecuredItemsUpdater(y.net.centrifyService),y.net.SignalrClient=function(e){y.net.SignalrClientBase.call(this,e),this.logWithLevel=y.firefox.Log.prototype.logWithLevel,this.logWithEverything=y.firefox.Log.prototype.logWithEverything;var t=this;browser.runtime.onMessage.addListener(function(e){e.action===y.preference.perfKeyEnum.portalHostname&&(e.value,t.disconnect(!0))}),this.centrifyService.addObserver(function(e){void 0!==e.status&&t.statusUpdater(e.status)},"signalr"),a.call(this)},y.net.SignalrClient.prototype={notifyUpDateAllApps:function(e,t){this.log("background.js:SignalrClient:notifyUpDateAllApps()"),y.formfill.appsUpdater.setNeedUpdateApps(null,!0,!1,{type:"Cloud.Saas.RefreshAllApps"})},updateSpecificApp:function(e){this.log("background.js:SignalrClient:updateSpecificApp()"),y.formfill.appsUpdater.updateSpecificApp(e)},unpublishSpecificApp:function(e){this.log("background.js:SignalrClient:unpublishSpecificApp()"),y.formfill.appsUpdater.unpublishSpecificApp(e)},publishSpecificApp:function(e){this.log("background.js:SignalrClient:publishSpecificApp()"),y.formfill.appsUpdater.publishSpecficApp(e)},updateAllApps:function(){this.log("background.js:SignalrClient:updateAllApps()"),y.formfill.appsUpdater.asyncUpdate(!1,y.formfill.appsUpdater.maxTimeTick,!0)},updateAllSecuredItems:function(){this.log("background.js:SignalrClient:updateAllSecuredItems()"),y.securedItem.securedItemsUpdater.asyncUpdate(!1)},updateSpecificSecuredItem:function(e){this.log("background.js:SignalrClient:updateSpecificSecuredItem()"),y.securedItem.securedItemsUpdater.updateSpecificSecuredItem(e)},publishSpecificSecuredItem:function(e){this.log("background.js:SignalrClient:publishSpecificSecuredItem()"),y.securedItem.securedItemsUpdater.publishSpecificSecuredItem(e)},unpublishSpecificSecuredItem:function(e){this.log("background.js:SignalrClient:unpublishSpecificSecuredItem()"),y.securedItem.securedItemsUpdater.unpublishSpecificSecuredItem(e)},updateDefaultTag:function(e){this.log("background.js:SignalrClient:updateDefaultTag()"),y.formfill.appsUpdater.updateDefaultTag(e)},updateTagsForApp:function(e){this.log("background.js:SignalrClient:updateTagsForApp()"),y.formfill.appsUpdater.updateAppTags(e.appkey,e.tagnames)}},y.common.objectExtend(y.net.SignalrClient,y.net.SignalrClientBase),y.net.signalrClient=new y.net.SignalrClient(y.net.centrifyService),y.net.CentrifyConnection=function(e){y.net.CentrifyConnectionBase.call(this),this.logWithLevel=y.firefox.Log.prototype.logWithLevel,this.logWithEverything=y.firefox.Log.prototype.logWithEverything,this.status=y.net.CONNECTION_STATUS_ENUM.onLine,this.signalRClient=e,this.signalRReconnectTimeout=3e5,this.signalRReconnectBackoffStep=1e3,this.signalRReconnectTimer=null,a.call(this);var r=this;e.addObserver(function(e){r.log("Signalrclient observer called with "+e.status);var e=e.status,t=y.net.centrifyService.status==y.net.SERVICE_STATUS_ENUM.ready,n=(r.log("serviceReady: "+t),e==y.net.SIGNALR_STATUS_ENUM.Error&&y.net.centrifyConnection.status==y.net.CONNECTION_STATUS_ENUM.notSignedIn),n=(r.log("isErrorAndIBENotSignedIn: "+n),n&&t),i=e===y.net.SIGNALR_STATUS_ENUM.Error&&y.net.centrifyConnection.status==y.net.CONNECTION_STATUS_ENUM.signedIn,i=(r.log("isErrorAndUserSignedIn: "+i),i&&t);e===y.net.SIGNALR_STATUS_ENUM.Connected||n?(r.log("updating status to be signedin"),r.updateStatus(y.net.CONNECTION_STATUS_ENUM.signedIn)):e===y.net.SIGNALR_STATUS_ENUM.Connecting||i?r.log("Do nothing since with "+e):(t=r.getInternetConnectionStatus(),r.log("currentInternetStatus: "+t),t===y.net.CONNECTION_STATUS_ENUM.onLine?(r.log("update status as : not signed in"),r.updateStatus(y.net.CONNECTION_STATUS_ENUM.notSignedIn)):(r.log("update status as offline"),r.updateStatus(y.net.CONNECTION_STATUS_ENUM.offLine)))},"SignalRStatusChange"),this.signalRClientReconnect=function(e,t){r.getInternetConnectionStatus()===y.net.CONNECTION_STATUS_ENUM.offLine?r.log("Internet offLine, will not try to reconnect"):r.signalRClient.stat.status===y.net.SIGNALR_STATUS_ENUM.Connected?r.log("SignalR current status is connected, will not try to reconnect"):(r.signalRClient.stat.status===y.net.SIGNALR_STATUS_ENUM.Connecting?r.log("SignalR current status is connecting, will recheck after "+t+" ms"):(r.log("SignalR current status is "+r.signalRClient.stat.status+", will try to reconnect and recheck after "+t+" ms"),r.signalRClient.disconnect(!1),r.signalRClient.connect()),(new Date).getTime()-e<=r.signalRReconnectTimeout?(t+=r.signalRReconnectBackoffStep,r.signalRReconnectTimer=setTimeout(function(){r.signalRClientReconnect(e,t)},t)):(r.signalRClient.disconnect(!1),r.logError("SignalR tried to reconnect for "+r.signalRReconnectTimeout+" ms, will stop trying. Please check the internect connection to the portal")))},this.onNavigatorOffline=function(e){this.log("Connection is offline, disconnecting signalR"),r.signalRClient.disconnect(!1),r.updateStatus(y.net.CONNECTION_STATUS_ENUM.offLine)},this.onNavigatorOnline=function(e){var t;this.log("Connection is online, trying to reconnect with signalR"),y.net.centrifyService.status===y.net.SERVICE_STATUS_ENUM.ready?(t=r.signalRClient.stat.status)===y.net.SIGNALR_STATUS_ENUM.Connected?r.updateStatus(y.net.CONNECTION_STATUS_ENUM.signedIn):t===y.net.SIGNALR_STATUS_ENUM.Disconnected?(clearTimeout(r.signalRReconnectTimer),r.signalRClientReconnect((new Date).getTime(),0)):r.updateStatus(y.net.CONNECTION_STATUS_ENUM.notSignedIn):(r.updateStatus(y.net.CONNECTION_STATUS_ENUM.notSignedIn),y.net.centrifyService.checkCurrentStatus())}},y.net.CentrifyConnection.prototype={init:function(){var e=this.getInternetConnectionStatus(),e=e===y.net.CONNECTION_STATUS_ENUM.offLine?e:this.signalRClient.stat.status===y.net.SIGNALR_STATUS_ENUM.Connected?y.net.CONNECTION_STATUS_ENUM.signedIn:y.net.CONNECTION_STATUS_ENUM.notSignedIn;this.log("background.js:init(): connStatus = "+e),this.updateStatus(e)},getInternetConnectionStatus:function(){return navigator.onLine?y.net.CONNECTION_STATUS_ENUM.onLine:y.net.CONNECTION_STATUS_ENUM.offLine},updateToolbarIcon:function(e){var t="";e===y.net.CONNECTION_STATUS_ENUM.offLine?(browser.browserAction.setIcon({path:{19:"icons/19disabled.png",38:"icons/38disabled.png"}}),t=y.ui.menuItemLabel.noInternetConnection):e===y.net.CONNECTION_STATUS_ENUM.signedIn?(browser.browserAction.setIcon({path:{19:"icons/19.png",38:"icons/38.png"}}),t=y.net.centrifyService.userSetting?.username+" signed in"):e===y.net.CONNECTION_STATUS_ENUM.notSignedIn?(browser.browserAction.setIcon({path:{19:"icons/19disabled.png",38:"icons/38disabled.png"}}),t=y.ui.menuItemLabel.notSignedIn):(browser.browserAction.setIcon({path:{19:"icons/19disabled.png",38:"icons/38disabled.png"}}),this.logWarn("background.js:idaptiveConnection:updateToolbarIcon: unhandled status: "+e)),browser.browserAction.setTitle({title:t})},updateUsernameFieldIcon:function(e){e===y.net.CONNECTION_STATUS_ENUM.offLine&&(this.log("Connection status is offline, disable form filling"),browser.tabs.query({},function(e){for(var t={action:y.communication.CentrifyEventEnum.formfillDisable},n=0;n<e.length;n++)e[n].url.toLowerCase().startsWith("http")&&browser.tabs.sendMessage(e[n].id,t)}))}},y.common.objectExtend(y.net.CentrifyConnection,y.net.CentrifyConnectionBase),y.net.centrifyConnection=new y.net.CentrifyConnection(y.net.signalrClient),y.net.centrifyConnection.init(),window.addEventListener("offline",y.net.centrifyConnection.onNavigatorOffline),window.addEventListener("online",y.net.centrifyConnection.onNavigatorOnline),y.background.MultiAccountCheckCBE=function(e,t){y.background.MultiAccountCheckCBEBase.call(this,e,t),this.logWithLevel=y.firefox.Log.prototype.logWithLevel,this.logWithEverything=y.firefox.Log.prototype.logWithEverything,a.call(this)},y.background.MultiAccountCheckCBE.prototype={loggerName:"BG_SecuCheckIBE",sendMultiAccountResponse2content:function(e,t){browser.tabs.sendMessage(e,t)}},y.common.objectExtend(y.background.MultiAccountCheckCBE,y.background.MultiAccountCheckCBEBase),y.background.multiAccountCheckCBE=new y.background.MultiAccountCheckCBE(y.net.centrifyService,y.formfill.appsUpdater),y.landcatch.BHAnalyzer=function(){y.landcatch.BHAnalyzerBase.call(this),this.logWithLevel=y.firefox.Log.prototype.logWithLevel,this.logWithEverything=y.firefox.Log.prototype.logWithEverything,a.call(this)},y.landcatch.BHAnalyzer.prototype={},y.common.objectExtend(y.landcatch.BHAnalyzer,y.landcatch.BHAnalyzerBase),y.landcatch.Manager=function(e,t,n){y.landcatch.ManagerBase.call(this,e,t,n),this.logWithLevel=y.firefox.Log.prototype.logWithLevel,this.logWithEverything=y.firefox.Log.prototype.logWithEverything;var i=this;this.centrifyService.addObserver(function(e){i.observer()},"landCatchManager"),a.call(this)},y.landcatch.Manager.prototype={listener:function(e,t,n){if(this.isEnabled()){t=t.tab;if(t){var i=t.id;switch(e.action){case y.communication.LandCatchEventEnum.sendAppDetail:var r=e.data;this.addAppInfo(r,i,!0);break;case y.communication.LandCatchEventEnum.clearAllSkippedSites:this.clearAllSkippedSites();break;case y.communication.LandCatchEventEnum.behaviorForceLoginDataValues:var a=e.data,o=this.pushBehavior(a,i);break;case y.communication.LandCatchEventEnum.behaviorInputChange:case y.communication.LandCatchEventEnum.behaviorClick:case y.communication.LandCatchEventEnum.behaviorKeyEnter:a=e.data;(o=this.pushBehavior(a,i))?.findLogin()?(this.findLoginApp(o.loginDetails,i),o.clearAnalyzer()):o?.validForPasswordGeneration()&&(this.resetWithGeneratedPassword(o.loginDetails,i),o.clearAnalyzer());break;case y.communication.LandCatchEventEnum.behaviorNavigate:var a=e.data;(o=this.pushBehavior(a,i))?.findLogin()?(this.findLoginApp(o.loginDetails,i),o.clearAnalyzer()):o?.validForPasswordGeneration()?(this.resetWithGeneratedPassword(o.loginDetails,i),o.clearAnalyzer()):(r=this.detectedLoginApps[i])&&r.notifyFlag&&n({userSetting:this.getCaptureSetting(),detectedApp:r});break;case y.communication.LandCatchEventEnum.ignoreApp:this.removeApp(i),e.data.isNever&&e.data.appData&&(a=e.data.appData.hostnameSuffix,this.log("will never remember this website: "+a),this.neverRememberSite(a))}}}else this.log("land catch is not enabled yet, do nothing")},notifyCredentialChecking:function(e,t){t={action:y.communication.LandCatchEventEnum.credentialCheckingResponse,data:t};browser.tabs.sendMessage(e,t)},neverRememberSite:function(n){let i=this;n?(this.log(n+" will never be remembered"),(async()=>{var e=await y.storage.get(y.preference.perfKeyEnum.skippedSites),t=new Set(e.split(";"));t.add(n),e=Array.from(t).join(";"),i.log("now the never remember sites are: "+e),y.storage.set(y.preference.perfKeyEnum.skippedSites,e)})()):this.warn("the app's hostname is invalid")},clearAllSkippedSites:function(){this.log("will clear all the skipped sites of land catch"),y.storage.set(y.preference.perfKeyEnum.skippedSites,"")}},y.common.objectExtend(y.landcatch.Manager,y.landcatch.ManagerBase),y.landcatch.manager=new y.landcatch.Manager(y.net.centrifyService,y.net.centrifyConnection,y.formfill.appsUpdater),y.storage.get(y.preference.perfKeyEnum.enableLCLocal).then(function(i){y.landcatch.manager.localEnabled=i,browser.tabs.query({},function(e){for(var t={action:y.communication.LandCatchEventEnum.lcLocalConfig,data:i},n=0;n<e.length;n++)e[n].url.toLowerCase().startsWith("http")&&browser.tabs.sendMessage(e[n].id,t)})}),browser.runtime.onMessage.addListener(function(e){if(e.action===y.preference.perfKeyEnum.enableLCLocal){let i=e.value;y.landcatch.manager.localEnabled=i,browser.tabs.query({},function(e){for(var t={action:y.communication.LandCatchEventEnum.lcLocalConfig,data:i},n=0;n<e.length;n++)e[n].url.toLowerCase().startsWith("http")&&browser.tabs.sendMessage(e[n].id,t)})}}),browser.runtime.onMessage.addListener(function(e,t,n){return y.landcatch.manager.listener(e,t,n)}),browser.runtime.onMessage.addListener(function(e,t,n){e.action===y.communication.AppsUpdaterEventEnum.setClearClipboardTimer&&e.duration&&y.common.setClearClipboardTimer(e.duration)});function e(e){"cybrGenPass"==e.menuItemId&&browser.tabs.query({active:!0,currentWindow:!0},e=>{e=e[0].index;browser.tabs.create({url:browser.extension.getURL("popover/popover.html?tab=genpass"),index:e},function(e){this.log(e)})})}function b(e,t,n){"signinToCyberArkUsername"!=e.menuItemId&&"signinToCyberArkPassword"!=e.menuItemId||browser.tabs.create({url:"https://"+n})}function i(e){"number"==typeof prompt_for_centrify_extension_timer&&window.clearTimeout(prompt_for_centrify_extension_timer);var t=document.getElementById("app-launch-panel");t&&t.parentNode.removeChild(t),window.location=e}function r(t,i){let n=(e=document)=>{let t=[e];return e.querySelectorAll("*").forEach(e=>{e.shadowRoot&&t.push(...n(e.shadowRoot))}),t};t&&n().some(e=>{let n=e.querySelector(t);if(n&&n.click)return i?["mouseover","mousedown","mouseup","click"].forEach(function(e){var t=document.createEvent("MouseEvents");t.initEvent(e,!0,!0),n.dispatchEvent(t)}):n.click(),!0})}function o(e){var e=document.querySelector(e),t=(e.focus(),document.createEvent("Event"));t.initEvent("keydown",!0,!0),t.keyCode=13,t.which=13,e.dispatchEvent(t),(t=document.createEvent("Event")).initEvent("keyup",!0,!0),t.keyCode=13,t.which=13,e.dispatchEvent(t),(t=document.createEvent("Event")).initEvent("keypress",!0,!0),t.keyCode=13,t.which=13,e.dispatchEvent(t),(t=document.createEvent("HTMLEvents")).initEvent("change",!0,!1),e.dispatchEvent(t)}browser.menus.onClicked.hasListener(e)||browser.menus.onClicked.addListener(e),browser.runtime.onMessage.addListener(function(e,t,n){e.action===y.formfill.loginEventEnum.sendEnterEvents&&browser.scripting.executeScript({target:{tabId:t.tab.id},func:o,args:[e.selector],world:"MAIN"}),e.action===y.formfill.loginEventEnum.sendSubmitButton&&browser.scripting.executeScript({target:{tabId:t.tab.id},func:r,args:[e.data,y.net.centrifyService.userSetting.enableMouseEventsOnButtonSubmit],world:"MAIN"}),"redirectUrl"==e.action&&browser.scripting.executeScript({target:{tabId:t.tab.id},func:i,args:[e.data]})})}.call(_idaptiveUniqueGlobal);