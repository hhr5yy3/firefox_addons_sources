var requirejs,require,define;!function(a){function b(a,b){return r.call(a,b)}function c(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=p.map,q=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(a=a.split("/"),g=a.length-1,p.nodeIdCompat&&t.test(a[g])&&(a[g]=a[g].replace(t,"")),a=n.slice(0,n.length-1).concat(a),k=0;k<a.length;k+=1)if("."===(m=a[k]))a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||q)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if((e=o[n.slice(0,l).join("/")])&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&q&&q[d]&&(i=q[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function d(b,c){return function(){var d=s.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),k.apply(a,d.concat([b,c]))}}function e(a){return function(b){return c(b,a)}}function f(a){return function(b){n[a]=b}}function g(c){if(b(o,c)){var d=o[c];delete o[c],q[c]=!0,j.apply(a,d)}if(!b(n,c)&&!b(q,c))throw new Error("No "+c);return n[c]}function h(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function i(a){return function(){return p&&p.config&&p.config[a]||{}}}var j,k,l,m,n={},o={},p={},q={},r=Object.prototype.hasOwnProperty,s=[].slice,t=/\.js$/;l=function(a,b){var d,f=h(a),i=f[0];return a=f[1],i&&(i=c(i,b),d=g(i)),i?a=d&&d.normalize?d.normalize(a,e(b)):c(a,b):(a=c(a,b),f=h(a),i=f[0],a=f[1],i&&(d=g(i))),{f:i?i+"!"+a:a,n:a,pr:i,p:d}},m={require:function(a){return d(a)},exports:function(a){var b=n[a];return void 0!==b?b:n[a]={}},module:function(a){return{id:a,uri:"",exports:n[a],config:i(a)}}},j=function(c,e,h,i){var j,k,p,r,s,t,u=[],v=typeof h;if(i=i||c,"undefined"===v||"function"===v){for(e=!e.length&&h.length?["require","exports","module"]:e,s=0;s<e.length;s+=1)if(r=l(e[s],i),"require"===(k=r.f))u[s]=m.require(c);else if("exports"===k)u[s]=m.exports(c),t=!0;else if("module"===k)j=u[s]=m.module(c);else if(b(n,k)||b(o,k)||b(q,k))u[s]=g(k);else{if(!r.p)throw new Error(c+" missing "+k);r.p.load(r.n,d(i,!0),f(k),{}),u[s]=n[k]}p=h?h.apply(n[c],u):void 0,c&&(j&&j.exports!==a&&j.exports!==n[c]?n[c]=j.exports:p===a&&t||(n[c]=p))}else c&&(n[c]=h)},requirejs=require=k=function(b,c,d,e,f){if("string"==typeof b)return m[b]?m[b](c):g(l(b,c).f);if(!b.splice){if(p=b,p.deps&&k(p.deps,p.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?j(a,b,c,d):setTimeout(function(){j(a,b,c,d)},4),k},k.config=function(a){return k(a)},requirejs._defined=n,define=function(a,c,d){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");c.splice||(d=c,c=[]),b(n,a)||b(o,a)||(o[a]=[a,c,d])},define.amd={jQuery:!0}}(),require.config({baseUrl:"./",paths:{slice:".","browser-adapter":"adapter/adapter",api:"adapter/api/",jade:"common-libs/jade-runtime",react:"common-libs/react.min",jquery:"common-libs/jquery"}}),define("main-adapter",function(){}),define("api/dispatcher",[],function(){function a(){this._observers={}}var b="<empty>";return a.prototype={constructor:a,notify:function(a,c,d){var e=!1,f=this._observers[a||b];return f&&f.forEach(function(b){var f=[c,d];a&&f.unshift(a),b.callback.apply(b.ctx,f)&&(e=!0)}),e},notifyAsync:function(a,b,c){var d=this;setTimeout(function(){d.notify(a,b,c)},1)},addListener:function(a,c,d){return c?(a=a||b,(this._observers[a]=this._observers[a]||[]).push({callback:c,ctx:d||null}),c):null},clear:function(){this._observers={}},removeListener:function(a,c,d){if(a=a||b,c){var e=this._observers[a];e&&(d=d||null,this._observers[a]=e.filter(function(a){return!(a.callback===c&&d==a.ctx)}))}else delete this._observers[a]}},a}),define("browser-adapter",["require","api/dispatcher"],function(a){"use strict";function b(){this._dispatcher=new c,this._bg=null,this._bgApi=null,this._isBackground=null,this._isVisible=null}var c=a("api/dispatcher"),d="__slice_visible_state",e={CHROME:"chrome",YABROWSER:"yabrowser",OPERA:"opera",CHROMIUM:"chromium",FIREFOX:"firefox",userAgent:window.navigator.userAgent,vendor:window.navigator.vendor,appVersion:window.navigator.appVersion,isChrome:function(){return/Google Inc/.test(this.vendor)&&/Chrome/.test(this.userAgent)&&!/MRCHROME|Comodo/.test(this.userAgent)},isYabrowser:function(){return/YaBrowser/.test(this.appVersion)},isOpera:function(){return/OPR\//.test(this.appVersion)},isFirefox:function(){return/Gecko\/[\d.]* Firefox\/[\d.]*/.test(this.userAgent)},get:function(){return this.isFirefox()?this.FIREFOX:this.isOpera()?this.OPERA:this.isYabrowser()?this.YABROWSER:this.isChrome()?this.CHROME:this.CHROMIUM}};return b.prototype={constructor:b,browser:e.get(),adapterType:"chrome",init:function(a){if(this.isUnsupported=!this._isSupport(),this.isUnsupported)return a();this._storageEventHandler=this._storageEventHandler.bind(this),this._helperPlatformListener=this._helperPlatformListener.bind(this),chrome.runtime.getBackgroundPage(this._initializePage.bind(this,a))},_initializePage:function(a,b){b&&(this._bg=b,this._bgApi=this._bg.api,this._isBackground=this._bg===window,this._isVisible=!this._isBackground,chrome.runtime.onMessage.addListener(this._helperPlatformListener),this._isBackground&&this._initBgApi(),a())},_initBgApi:function(){window.addEventListener("storage",this._storageEventHandler),this._bgApi.init(this)},getProductInfo:function(){var a=chrome.runtime.getManifest().version,b=a.split(".");return b&&b.length>2&&(a=b[0]+"."+b[1]),{version:a}},sendMessage:function(a,b,c,d){this.isUnsupported||(c&&d&&(c=c.bind(d)),this._notifyAllInThisContext(a,b,c),this._sendMessageToOtherAdapters(a,b,c))},sendOuterMessage:function(a,b,c,d){this.sendMessage(a,b,c,d)},_sendMessageToOtherAdapters:function(a,b,c){var d={topic:a,data:b,options:this._createMessageOptions()};chrome.runtime.sendMessage(d,c)},_helperPlatformListener:function(a,b,c){if(this._isMessageFromSlice(a)&&!this._isMessageFromSameContext(a)){var d=a.topic||a.message||a,e=a.data;this._notifyAllInThisContext(d,e,c)}},_notifyAllInThisContext:function(a,b,c){this._dispatcher.notifyAsync(a,b,c),this._isBackground&&this._bgApi.notifyNano(a,b,c)},_isMessageFromSlice:function(a){return a&&a.options&&a.options.fromSlice},_isMessageFromSameContext:function(a){return a&&a.options&&a.options.isBackground===this._isBackground},_createMessageOptions:function(){return{fromSlice:!0,isBackground:this._isBackground}},addListener:function(a,b,c){return this._dispatcher.addListener(a,b,c)},removeListener:function(a,b,c){this._dispatcher.removeListener(a,b,c)},notifyAsync:function(a,b,c){this._dispatcher.notifyAsync(a,b,c)},getOption:function(a){return this._bgApi.options.get(a)},setOption:function(a,b){return this._bgApi.options.set(a,b)},getLang:function(){return this._bgApi.i18n.locale},getBrandId:function(){return this._bgApi.branding.getId()},getUI:function(){return this._bgApi.config.getUI()},log:function(a){this._bgApi&&this._bgApi.logger.log(a)},error:function(a){this._bgApi&&this._bgApi.logger.error(a)},logObj:function(a,b){b&&console.log(b+":"),console.log(a)},getCookie:function(a,b,c,d,e,f,g){this._bgApi.cookie.get(a,b,c,d,f,g)},getString:function(a){return this._bgApi.i18n.getString(a)},openSettings:function(){this._bgApi.openSettings()},navigate:function(a,b){this._bgApi.navigate(a,b),e.isFirefox()&&window.setTimeout(function(){window.close()},0)},createXHR:function(){return new this._bg.XMLHttpRequest},resizeWindowTo:function(a,b){},isWindowVisible:function(){return this._isVisible},clear:function(){this._storageEventHandler&&(window.removeEventListener("storage",this._storageEventHandler),this._storageEventHandler=null),this._helperPlatformListener&&(chrome.runtime.onMessage.removeListener(this._helperPlatformListener),this._helperPlatformListener=null,this._isBackground||localStorage.setItem(d,"0"))},initSliceShowEvent:function(){this._isBackground||localStorage.setItem(d,"1")},getNotificationManager:function(){return this._bgApi.notify},getSlicePath:function(){return chrome.extension.getURL("slice/")},getCurrentTabUrl:function(a){this._bgApi.getCurrentTabUrl(a)},isCurrentWindowMinimized:function(a){this._bgApi.isCurrentWindowMinimized(a)},getWebSocket:function(){return this._bg.WebSocket},sendClickerStatistics:function(a){return this._bgApi.sendClickerStatistics(a),!0},setWindowStyle:function(a){},_isSupport:function(){return chrome&&chrome.runtime&&chrome.runtime.getBackgroundPage&&chrome.runtime.onMessage},_storageEventHandler:function(a){if(a.key===d){var b="1"===a.newValue;b!==this._isVisible&&(this._isVisible=b,this.sendMessage("slice-event-"+(b?"show":"hide")))}}},new b}),define("api/messages",["browser-adapter"],function(a){return{addListeners:function(b){if(b&&b.observers)for(var c in b.observers)b.observers.hasOwnProperty(c)&&"function"==typeof b.observers[c]&&a.addListener(c,b.observers[c],b)},removeListeners:function(b){if(b&&b.observers)for(var c in b.observers)b.observers.hasOwnProperty(c)&&"function"==typeof b.observers[c]&&a.removeListener(c,b.observers[c],b)}}}),define("api/manager",["browser-adapter","api/dispatcher","api/messages"],function(a,b,c){var d={};return d.onReady=function(){function e(){function b(){var a=f;f=null,a.notify("ready")}g?window.onload=null:document.removeEventListener("DOMContentLoaded",e,!1),a.init?a.init(b):b()}var f=new b,g=/MSIE\s+8/i.test(navigator.userAgent);return"loading"!==document.readyState?e():g?window.onload=e:document.addEventListener("DOMContentLoaded",e,!1),function(a,b){"function"!=typeof a&&(b=a,a=function(){"function"==typeof this.init&&!1===this.init()||(c.addListeners(this),"function"==typeof this.finalize&&d.onExit(this.finalize,this))}),f?f.addListener("ready",a,b):a.call(b)}}(),d.onExit=function(){function c(){d&&a&&(d.notify("exit"),d=null,a.clear(),a=null)}var d=new b;return window.onunload=c,window.onbeforeunload=c,function(a,b){d&&d.addListener("exit",a,b)}}(),d}),define("api/branding",["browser-adapter"],function(a){function b(){return a.getBrandId()}function c(){return a.browser}function d(){return a.adapterType}function e(){return a.getLang()}function f(a){return a&&"[object RegExp]"===Object.prototype.toString.call(a)}var g={domains:{ya:"yandex.ru",locale:{be:{ya:"yandex.by"},uk:{ya:"yandex.ua"},kk:{ya:"yandex.kz"}}},branding:{tb:{domains:{ya:"yandex.com.tr"}},ua:{domains:{ya:"yandex.ua"}}}},h=null,i={getDomain:function(a){return h||(h={notLocalized:i.brandingObject(g,!0,!1),full:i.brandingObject(g,!0)}),h[a?"full":"notLocalized"].domains.ya},_funcReplaceTLD:function(a,b){return i.getDomain(!!b)},brandingUrl:function(a){return a?a.replace(/\byandex\.\{tld((-kubr)?)\}/,i._funcReplaceTLD):""},brandingObject:function(a,g,h){function j(a,b,c,d,e){var f=a;if(d){if(!a[d])return b;if(f=a[d][e],"string"==typeof f&&(f=a[d][f]),g||delete a[d],!f)return b;f=k(f)}for(var h=Object.keys(f),i=0;i<h.length;++i){var j=h[i];c.hasOwnProperty(j)||o[j]||(c[j]=!0,b[j]=k(f[j]))}return b}function k(a){if("string"==typeof a)return i.brandingUrl(a);if(!a||!l&&!h&&!m||"object"!=typeof a)return a;if(f(a))return a;var b;if(Array.isArray(a)){b=g?[]:a;for(var c=0;c<a.length;++c)b[c]=k(a[c]);return b}var d={};return b=g?{}:a,j(a,b,d,"browser",m),j(a,b,d,"adapter",n),j(a,b,d,"branding",l),j(a,b,d,"locale",h),j(a,b,d)}var l=b();!1!==h&&(h=h||e());var m=c(),n=d(),o={browser:!0,locale:!0,branding:!0,adapter:!0};return k(a)}};return i}),define("api/stat",["browser-adapter"],function(a){function b(b){a.log("[api/stat]: "+b)}return{_statName:null,log:function(c){if(!a.sendClickerStatistics({cid:c.cid,param:c.param,statisticsId:this._statName})){var d=c.dtype,e=c.pid,f=c.cid,g=c.param;if(void 0===d&&(d="stred"),void 0===e&&(e=12),"string"!=typeof d)throw new TypeError("Invalid dtype type ('"+typeof d+"')");if(!d)throw new RangeError("dtype is empty string");if("number"!=typeof e)throw new TypeError("Wrong pid type ('"+typeof e+"'). Number required.");if(e<0)throw new RangeError("Invalid pid value ("+e+")");if("number"!=typeof f)throw new TypeError("Wrong cid type ('"+typeof f+"'). Number required.");if(f<=0)throw new RangeError("Invalid cid value ("+f+")");var h=a.getProductInfo();g=a.browser+"."+this._statName+"."+(h?h.version.replace(/\./g,"-")+".":"")+g;var i="https://clck.yandex.ru/click/dtype="+encodeURIComponent(d)+"/pid="+e+"/cid="+f+"/path="+encodeURIComponent(g),j="",k=["dtype","pid","cid","param"];for(var l in c)if(c.hasOwnProperty(l)&&-1===k.indexOf(l)){var m=c[l];"*"!==l?i+="/"+l+"="+encodeURIComponent(m):j=m}i+="/*"+j,b("stat log "+i);var n=a.createXHR();n.open("GET",i,!0),n.send()}},logWidget:function(a){this.log({cid:72359,param:a})},logNotification:function(a){this.log({cid:72358,param:a})},setStatName:function(a){this._statName=a||null}}}),define("slice/locale",[],function(){return{be:{dampness:"Вільготнасць","dp.day":"удзень","dp.evening":"увечары","dp.morning":"уранку","dp.night":"уночы","error.net":"Інтэрнэт##не далучаны","error.server":"Адсутнічае сувязь з серверам.##Паспрабуйце пазней",pressure:"Ціск","pressure.hpa":"гПа","pressure.mm":"мм рт. сл.",settings:"Наладкі",title:"Віджэт надвор'я",today:"Сёння",tomorrow:"Заўтра","url.title":"Прагноз на 10 дзён",wind:"Вецер","wind.ms":"м/с"},en:{dampness:"Humidity","dp.day":"day","dp.evening":"evening","dp.morning":"morning","dp.night":"night","error.net":"No##internet connection","error.server":"No server connection.##Please try again later",pressure:"Pressure","pressure.hpa":"hPa","pressure.mm":"mm Hg",settings:"Settings",title:"Weather widget",today:"Today",tomorrow:"Tomorrow","url.title":"10-day forecast",wind:"Wind","wind.ms":"m/s"},kk:{dampness:"Ылғалдығы","dp.day":"күндіз","dp.evening":"кешке","dp.morning":"таң ертең","dp.night":"түнде","error.net":"Интернет##қосылмаған","error.server":"Сервермен қосылыс жоқ.##Кейінірек сынап көріңіз",pressure:"Ауа қысымы","pressure.hpa":"гПа","pressure.mm":"мм сын. бағ.",settings:"Баптаулар",title:"Ауа-райы виджеті",today:"Бүгін",tomorrow:"Ертең","url.title":"10 күндік болжам",wind:"Жел","wind.ms":"м/с"},ru:{dampness:"Влажность","dp.day":"днем","dp.evening":"вечером","dp.morning":"утром","dp.night":"ночью","error.net":"Интернет##не подключен","error.server":"Отсутствует связь с сервером.##Попробуйте позднее",pressure:"Давление","pressure.hpa":"гПа","pressure.mm":"мм рт. ст.",settings:"Настройки",title:"Виджет погоды",today:"Сегодня",tomorrow:"Завтра","url.title":"Прогноз на 10 дней",wind:"Ветер","wind.ms":"м/с"},tr:{dampness:"Nem","dp.day":"gündüz","dp.evening":"akşam","dp.morning":"sabah","dp.night":"gece","error.net":"İnternet##bağlantısı yok","error.server":"Sunucu bağlantısı yok.##Daha sonra deneyin",pressure:"Basınç","pressure.hpa":"hPa","pressure.mm":"hPa",settings:"Ayarlar",title:"Hava durumu widgeti",today:"Bugün",tomorrow:"Yarın","url.title":"10 günlük hava tahmini",wind:"Rüzgar","wind.ms":"m/sn"},uk:{dampness:"Вологість","dp.day":"вдень","dp.evening":"увечері","dp.morning":"зранку","dp.night":"вночі","error.net":"Інтернет##не підключено","error.server":"Немає зв'язку із сервером.##Спробуйте пізніше",pressure:"Тиск","pressure.hpa":"гПа","pressure.mm":"мм рт. ст.",settings:"Налаштування",title:"Віджет погоди",today:"Сьогодні",tomorrow:"Завтра","url.title":"Прогноз на 10 днів",wind:"Вітер","wind.ms":"м/с"}}}),define("slice/logic/config",{statName:"yapogoda",EXPORT_URL:"https://export.yandex.{tld}/bar/reginfo.xml",formatTemperature:function(a){return a.replace(/^\+/,"")},expireInterval:18e5,pressureUnit:"mm",defaultHomeUrl:"https://pogoda.yandex.{tld}/",linkParam:"?elmt=pogoda",branding:{tb:{pressureUnit:"hpa",defaultHomeUrl:"https://hava.yandex.com.tr/"}},adapter:{chrome:{linkParam:"?from=elmt_weatherchrome"}}}),define("slice/adapter/main",["browser-adapter","api/manager","api/branding","api/stat","slice/locale","slice/logic/config"],function(a,b,c,d,e,f){b.onReady(function(){if(c.brandingObject(f),d.setStatName(f.statName),e&&void 0!==e.ru){var b=e[a.getLang()]||e.ru;a.getString=function(a,c){var d=b[a]||"";return d&&c?d.replace(/<i18n:param>([a-zA-Z0-9\._-]+)<\/i18n:param>/g,function(a,b){return c[b]}):d}}"function"==typeof jQuery&&jQuery.ajaxSetup({crossDomain:!1,xhr:function(){return a.createXHR()}})})}),define("api/dom",[],function(){function a(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function b(b){return new RegExp("(^|\\s)"+a(b)+"(\\s|$)")}function c(a,b){for(var c=a.target||a.srcElement,d={self:b,target:c,event:a};c&&(!d.parent&&c.getAttribute("data-cmd-parent")&&(d.parent=c),d.param=d.param||c.getAttribute("data-cmd-param")||"",d.command=d.command||c.getAttribute("data-command")||"",c!=b);)c=c.parentNode;return d}return{getClickHandler:function(a){return function(b){b=b||window.event;var d=c(b,this);if(a.commands&&d.command&&a.commands[d.command])return b.stopPropagation?b.stopPropagation():b.cancelBubble=!0,a.commands[d.command].call(a,d)}},addClass:function(b,c){if(b&&c){if(b.classList)return void b.classList.add(c);var d=new RegExp("^(?!.*(^|\\s)"+a(c)+"(\\s|$))");b.className=b.className.replace(d,c+" ").trim()}},removeClass:function(a,c){if(a&&c){if(a.classList)return void a.classList.remove(c);var d=b(c);a.className=a.className.replace(d," ").trim()}},toggleClass:function(a,b){return!(!a||!b)&&(a.classList?a.classList.toggle(b):void(this.hasClass(a,b)?this.removeClass(a,b):this.addClass(a,b)))},hasClass:function(a,c){return!(!a||!c)&&(a.classList?a.classList.contains(c):b(c).test(a.className))},dragNDropCore:function(a){function b(b){if(e)return e.oldX=e.pageX,e.oldY=e.pageY,e.pageX=b.pageX,e.pageY=b.pageY,a.onmove.call(a.ctx,e,b),!1}function c(d){if(e)return document.removeEventListener("mousemove",b,!1),document.removeEventListener("mouseup",c,!1),a.onstop&&a.onstop.call(a.ctx,e,d),e=null,!1}function d(d){return c(),e={elem:this,target:d.target,startX:d.pageX,startY:d.pageY,pageX:d.pageX,pageY:d.pageY},a.start&&!1===a.start.call(a.ctx,e,d)?void(e=null):(document.addEventListener("mousemove",b,!1),document.addEventListener("mouseup",c,!1),d.stopPropagation(),d.preventDefault(),!1)}var e=null;if(a.elems.tagName)a.elems.addEventListener("mousedown",d,!1);else for(var f=0;f<a.elems.length;++f)a.elems[f].addEventListener("mousedown",d,!1)}}}),define("api/utils",["browser-adapter"],function(a){return{copy:function(a,b){if(b=b||{},a)for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},emptyFunc:function(){},navigate:function(b,c){if(b){var d=c&&c.shiftKey?"new window":"new tab";c&&(c.preventDefault?c.preventDefault():c.returnValue=!1),a.navigate(b,d)}},getParam:function(a,b){return(RegExp("[?&]"+a+"=([^&#]*)","i").exec(b||document.location.href)||"")[1]||""},debounce:function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}}}),define("api/http",["browser-adapter","api/utils"],function(a,b){function c(a,b){return a+"="+encodeURIComponent(b)}function d(a,b){return'Content-Disposition: form-data; name="'+a+'"\r\n\r\n'+b}function e(a,b){if(!a||"string"==typeof a)return a||"";var e=[],f=b?d:c;for(var g in a)if(a.hasOwnProperty(g)){var h=a[g];Array.isArray(h)?h.forEach(function(a){e.push(f(g,a))}):e.push(f(g,h))}if(b){var i="\r\n";return b+i+e.join(i+b+i)+i+b+"--"+i}return e.join("&")}function f(c){var d=a.createXHR(),f=c.multipart?"-----8a7gadg1ahSDCV"+Date.now():null,g=c.url,h=null,i=e(c.query),j=e(c.params,f?"--"+f:null);if(c.data&&(i=i||j,j=""),"POST"===c.method?h=c.data||j||"":(h=c.data||null,i=i||j),i&&(g+=(-1===g.indexOf("?")?"?":"&")+i),d.open(c.method,g,!c.sync),c.overrideMimeType&&d.overrideMimeType&&d.overrideMimeType(c.overrideMimeType),c.background)try{d.mozBackgroundRequest=!0}catch(a){}var k=b.copy(c.headers);if(!k["Content-Type"]){var l=c.contentType;l||"POST"!=c.method||(l=f?"multipart/form-data; boundary="+f:"application/x-www-form-urlencoded;  charset=UTF-8"),l&&(k["Content-Type"]=l)}for(var m in k)k.hasOwnProperty(m)&&d.setRequestHeader(m,k[m]);return{xhr:d,text:h}}function g(a,b){if("xml"==b){var c=a.responseXML;if(c)return c;throw"parse error"}var d=a.responseText;return"json"==b&&(d=JSON.parse(d)),d}function h(a){function c(b){d.xhr&&!d.aborted&&(d.aborted=b||"abort",d.xhr.abort(),i.call(j,0,d.aborted,d.xhr,a))}var d=f(a);if(!a.sync){var e=a.end||b.emptyFunc,h=a.callback||b.emptyFunc,i=a.errback||b.emptyFunc,j=a.ctx||a.scope||a,k=Date.now();d.xhr.onreadystatechange=function(){if(d.xhr&&4==d.xhr.readyState){var b=Date.now();if(e.call(j,d.xhr),d.timer&&(clearTimeout(d.timer),d.timer=null),!d.aborted){var c=d.xhr.status,f="error";if(c>=200&&c<400){var l="",m=!1;if("HEAD"===a.method)h.call(j,null,d.xhr,c,n);else{try{l=g(d.xhr,a.responseType),m=!0}catch(b){i.call(j,500,"parse error",d.xhr,a)}if(m){var n=null;if(a.getTimeDiff){var o=new Date(d.xhr.getResponseHeader("Date")).valueOf();n=o?Math.round((k+b)/2)-o:null}h.call(j,l,d.xhr,c,n)}}}else{try{f=d.xhr.statusText}catch(a){}i.call(j,c,f,d.xhr,a)}}d.xhr=null}}}if(d.xhr.send(d.text),a.sync)try{return g(d.xhr,a.responseType)}catch(a){return null}return a.timeout&&a.timeout>0&&(d.timer=setTimeout(function(){d.timer&&c("timeout")},a.timeout)),{abort:c}}return{HEAD:function(a){return a.method="HEAD",h(a)},GET:function(a){if(a.method="GET",a.noCache){var b=a.query||a.params||{};"string"==typeof b?b=b+"&_randomparameter="+Date.now():b._randomparameter=Date.now(),a.params?a.params=b:a.query=b}return h(a)},POST:function(a){return a.method="POST",h(a)},PATCH:function(a){return a.method="PATCH",h(a)},PUT:function(a){return a.method="PUT",h(a)}}}),define("api/xml",[],function(){var a=/&|  |<|>|\r\n|\n|"/g,b=/&amp;|&nbsp;|&lt;|&gt;|<(br|BR)\s*\/?>|&quot;/g,c={"&":"&amp;","  ":"&nbsp; ","<":"&lt;",">":"&gt;","\n":"<br />","\r\n":"<br />",'"':"&quot;"},d={"&amp;":"&","&nbsp;":" ","&lt;":"<","&gt;":">","<br />":"\n","<br/>":"\n","<br>":"\n","&quot;":'"'},e=function(a){return c[a]},f=function(a){return d[a.toLowerCase()]},g={escape:function(b){return b?String(b).replace(a,e):""},unescape:function(a){return a?String(a).replace(b,f):""},stringToXml:function(a){var b;return"function"==typeof DOMParser?b=(new DOMParser).parseFromString(a,"text/xml"):"function"==typeof ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a)),b},select:function(a,b){return b=b||document,"function"==typeof Sizzle?Sizzle(a,b)[0]||null:b.querySelector(a)},selectAll:function(a,b){return b=b||document,"function"==typeof Sizzle?Sizzle(a,b):b.querySelectorAll(a)},getText:function(a,b){return a&&b&&(a=g.select(b,a)),a?a.textContent||a.innerText||a.firstChild&&a.firstChild.data||"":""},setText:function(a,b){a&&(a.textContent=b,a.innerText=b)},getAttr:function(a,b,c){return 2==arguments.length&&(c=b,b=null),a&&b&&(a=g.select(b,a)),a&&a.getAttribute(c)||""}};return g}),require(["slice/adapter/main"],function(){require(["slice/logic/main"])}),define("main-logic",function(){}),define("slice/common-logic/timers",["browser-adapter","api/manager"],function(a,b){function c(a,b,c,d){var f=this;this._callback=function(){var a=!0;f._expandingMode&&(a=f._expandingCurrent>=f._expandingSkipCount,a?(f._expandingSkipCount<f._maxSkipCount&&f._expandingSkipCount++,f._expandingCurrent=0):f._expandingCurrent++),a&&b.call(c||f)},this._interval=0,this._maxSkipCount=d||e,this._expandingMode=!1,this.setInterval(a)}var d=function(b,c){a.log("[sliceApi.timers]: "+b)},e=2;c.prototype={constructor:c,setInterval:function(a){if(a=Number(a),this._interval!=a){this._interval=a;var b=this._timer;this.stop(),b&&this.start()}return this},start:function(){return!this._timer&&this._interval>=1&&(this._expandingSkipCount=0,this._expandingCurrent=0,this._timer=setInterval(this._callback,this._interval)),this},stop:function(){return this._timer&&(clearInterval(this._timer),this._timer=null),this},setExpanding:function(a){if(a=!1!==a,this._expandingMode!=a)return this._expandingMode=a,d("setExpanding "+a),a&&(this._expandingSkipCount=0,this._expandingCurrent=0),this},resetExpanding:function(){return this._expandingMode&&(this._expandingSkipCount=0,this._expandingCurrent=0),this},finalize:function(){this.stop(),this._callback=null,this._interval=0}};var f=[],g={create:function(a,b,d,e){"function"==typeof a&&(e=d,d=b,b=a,a=0);var g=new c(a,b,d,e);return f.push(g),g},stopAll:function(){for(var a=0;a<f.length;++a)f[a].stop()},startAll:function(){for(var a=0;a<f.length;++a)f[a].start()},finalize:function(){for(var a=0;a<f.length;++a)f[a].finalize();f=[]}};return b.onReady(g),g}),define("slice/common-logic/town-importer",["browser-adapter","api/stat","slice/logic/config","api/http","slice/common-logic/timers"],function(a,b,c,d,e){var f="id",g="update-interval",h=function(a,b){this._errorUpdate=!1,this._errorExport=!1,this._updating=!1,this._request=null,this._saved=null,this._savedUrl=null,this._savedPermanent=null,this._statName=b,this._sliceName=a,this._lastUpdateTime=0};return h.prototype={constructor:h,init:function(){this._timer=e.create(this._getInterval(),function(){this._update("timer")},this).start(),this._update("init")},finalize:function(){this._request&&this._request.abort()},observers:{update:function(a,b){this._update(b)},"slice-event-show":function(a,c){var d=c&&"menu"==c.sender?"menu":"button";b.logWidget(d),Date.now()-this._lastUpdateTime>3e5&&this._update("popup")},"options:change":function(b,c){c.name==f&&this._update("options"),c.name==g&&(a.log("interval setting change"),this._timer.setInterval(this._getInterval()))},"slice:request":function(){this._updating||this._sendError(!1)||this._sendData(!1)||this._update("popup")},navigate:function(d,e){b.logWidget("button"),a.navigate(this._savedUrl||c.defaultHomeUrl,e)}},_getInterval:function(){return this._errorExport?3e5:1e3*parseInt(a.getOption(g)||5,10)*60},_getSavedData:function(){if(!this._saved)return null;var a=Date.now()-this._saved.timestamp;return(a<0||a>c.expireInterval)&&(this._saved=null),this._saved},_sendData:function(b){var c=this._getSavedData();return c&&(a.sendMessage("slice:data",c),b&&c.outerData&&a.sendOuterMessage(this._sliceName+":data",c.outerData)),!!c},_sendError:function(b){return this._errorUpdate&&(a.sendMessage("slice:error",this._errorUpdate),!1!==b&&a.sendOuterMessage(this._sliceName+":error",{type:this._errorUpdate,sender:b})),!!this._errorUpdate},_updateErrorHandler:function(a,b){this._sendData(!0)||(this._errorUpdate=b,this._sendError(a)),this._errorExport=!0,this._timer.setInterval(this._getInterval())},_update:function(b){if(b=b||"",b&&"options"!=b||(this._saved=null),"options"==b&&(this._savedUrl=null,this._savedPermanent=null,this._updating=!1,this._request&&this._request.abort()),!this._updating){this._updating=!0,this._errorUpdate=null,this._errorExport=!1;try{this._request=d.GET({url:c.EXPORT_URL,params:{region:a.getOption(f)||"",lang:a.getLang(),brid:a.getBrandId(),_rand:Math.round((new Date).valueOf()/3e4)},ctx:this,responseType:"xml",callback:function(a){this._updating=!1,this._request=null,a=this.extractData(a),a?(this._saved=a,this._savedPermanent=a.permanentData||this._savedPermanent,this._saved.timestamp=Date.now(),this._lastUpdateTime=Date.now(),this._savedUrl=a.url,this._timer.setInterval(this._getInterval()),this._sendData(!0)):this._updateErrorHandler(b,"server")},errback:function(a,c){"abort"!=c&&(this._updating=!1,this._request=null,this._updateErrorHandler(b,a<200?"net":"server"))}}),a.sendOuterMessage(this._sliceName+":loading",{sender:b})}catch(a){}}},extractData:function(){return null}},h}),define("slice/logic/main",["browser-adapter","api/manager","slice/logic/config","api/xml","slice/common-logic/town-importer"],function(a,b,c,d,e){function f(a){if(!d.select("info > weather",a))return null;var b=d.select("weather > day",a),e=d.selectAll("day_part",b),f=e&&e[0];if(!f)return null;var h=d.select("temperature",f);if(!h)return null;for(var i={title:d.getText(a,"weather > day > title"),now:{temperature:g._temperature(d.getText(h)),bgcolor:"#"+h.getAttribute("color"),color:"#"+g._divColor(h.getAttribute("color"),2),img:g.getIconName(d.getText(f,"image-v3")),description:d.getText(f,"weather_type"),windDir:d.getAttr(f,"wind_direction","id"),windSpeed:d.getText(f,"wind_speed"),dampness:d.getText(f,"dampness"),pressure:d.getText(f,"pressure")},url:d.getText(a,"weather > url")+c.linkParam,period:[],pressureUnit:c.pressureUnit},j=["","morning","day","evening","night"],k=1;k<e.length;++k){f=e[k];var l=d.select("temperature_from",f),m=d.select("temperature_to",f),n=l&&m?null:d.select("temperature",f);if(n||l&&m){var o=n?n.getAttribute("color"):g._avgColor(l.getAttribute("color"),m.getAttribute("color"));i.period.push({type:j[f.getAttribute("typeid")],img:g.getIconName(d.getText(f,"image-v3")),hint:"",temperature:g._temperature(n?d.getText(n):g._avgTemp(d.getText(l),d.getText(m))),bgcolor:"#"+o,color:"#"+g._divColor(o,2)})}}return i.outerData={title:i.title,temperature:i.now.temperature,image:i.now.img},i}var g={_temperature:function(a){return a?c.formatTemperature(a):""},_divColor:function(a,b){return a.replace(/../g,function(a){var c=Math.round(parseInt(a,16)/b).toString(16);return c.length>1?c:"0"+c})},_avgColor:function(a,b){for(var c="",d=0;d<6;d+=2){var e=Math.round((parseInt(a.substr(d,2),16)+parseInt(b.substr(d,2),16))/2).toString(16);c+=e.length>1?e:"0"+e}return c},_avgTemp:function(a,b){return Math.round((parseInt(a,10)+parseInt(b,10))/2).toString(10).replace(/^([1-9])/,"+$1")},_replaceIconMap:{wnd:"ovc",strm:"ovc",sq:"ovc",br_d:"fg_d",br_n:"fg_n",ovc_gr_ra:"ovc_gr",ovc_ra_gr:"ovc_gr",ovc_ra_sn:"ovc_+sn",ovc_ra_sn_gr:"ovc_+sn",ovc_ts_ra_sn:"ovc_ts_ra",ovc_ts_sn:"ovc_ts_ra"},getIconName:function(a){if(!a)return"";var b=a.replace(/^.+\/([^\/]+)\.png$/,"$1").replace(/_[+-]\d+$/,"");return this._replaceIconMap[b]||b}},h=new e("weather","yapogoda");return h.extractData=f,b.onReady(h),h});