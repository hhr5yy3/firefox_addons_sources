"use strict";(()=>{var O=Object.defineProperty;var E=(D,C)=>O(D,"name",{value:C,configurable:!0});(globalThis.ffzWebpackJsonp=globalThis.ffzWebpackJsonp||[]).push([[2682],{29632:(D,C,n)=>{n.r(C),n.d(C,{ApolloEvent:()=>h,GQLError:()=>e,default:()=>o});var P=n(22527),f=n(46949),v=n(5286),l=n(17159);const s=class s extends l.FFZEvent{constructor(t){super(t),this._changed=!1}markChanged(){return this._changed=!0,this}};E(s,"ApolloEvent");let h=s;const a=class a extends Error{constructor(t){super(`${t.message}; Location: ${t.locations}`)}};E(a,"GQLError");let e=a;const d=class d extends P.default{constructor(...t){super(...t),this.modifiers={},this.post_modifiers={},this.inject("..fine")}get gqlPrint(){if(this._gql_print)return this._gql_print;const t=this.resolve("site.web_munch");return this._gql_print=t?.getModule?.("gql-printer")}onEnable(){let t=this.client;if(!t){const g=this.fine.react;if(t=(g&&g.stateNode)?.props?.client,g&&!t){let p=0,w=g;for(;!t?.queryManager&&w&&p++<20;)t=w?.memoizedProps?.client,w=w?.child;if(!t){const S=this.fine.searchTree(null,A=>A.props?.client?.queryManager,500);S&&(t=S.props.client)}}this.client=t}if(!t)return new Promise(()=>this.onEnable(),50);if(!this.client.link||!this.client.queryManager||!this.client.queryManager.link){this.log.error("Apollo does not have a Link. We are unable to manipulate queries.");return}this.hooked_query_init=!1;const i=this,r=this.client.queryManager.constructor.prototype,u=r.getCurrentQueryResult;if(r.getCurrentQueryResult=function(g,y=!0){const p=u.call(this,g,y);if(p&&p.partial)try{try{const w=g.getLastResult(),S=g.options;this.dataStore.getCache().read({query:S.query,variables:S.variables,previousResult:w?w.data:void 0,optimistic:y})}catch(w){if(w.toString().includes("Can't find field")&&g.lastResult&&!g.lastResult.loading&&!g.lastError&&Date.now()-(g._ffz_last_retry||0)>=12e4){const S=(0,f.get)("options.query.definitions.0.name",g),A=S&&S.kind==="Name"?S.value:`#${g.queryId}`;i.log.info("Forcing query to refetch due to missing field:",A),g._ffz_last_retry=Date.now(),g.refetch()}}}catch(w){i.log.capture(w)}return p},this.client.queryManager.queryStore){const g=this.client.queryManager.queryStore.initQuery;this.hooked_query_init=!0,this.client.queryManager.queryStore.initQuery=function(y){const p=this.store[y.queryId];return p&&p.queryString!==y.queryString&&(p.queryString=y.queryString),g.call(this,y)}}const c=this.ApolloLink=this.client.link.constructor;this.link=new c((g,y)=>{if(!this.enabled)return y(g);let p=g.variables;Object.keys(p).length||(p=void 0);try{this.hooked_query_init&&this.apolloPreFlight(g)}catch(w){return this.log.capture(w,{tags:{operation:g.operationName},extra:{variables:p}}),this.log.error("Error running Pre-Flight",w,g),y(g)}return y(g).map(w=>{w.extensions&&w.extensions.operationName===g.operationName&&this.log.crumb({level:"info",category:"gql",message:`${g.operationName} [${w.extensions&&w.extensions.durationMilliseconds||"??"}ms]`,data:{variables:p}});try{this.apolloPostFlight(w)}catch(S){this.log.capture(S,{tags:{operation:g.operationName},extra:{variables:p}}),this.log.error("Error running Post-Flight",S,w)}return w})}),this.old_link=this.client.link,this.old_qm_link=this.client.queryManager.link,this.client.link=c.from([this.link,this.old_link]),this.client.queryManager.link=c.from([this.link,this.old_qm_link])}onDisable(){this.client=this.printer=this._gql_print=this.old_link=this.old_qm_dedup=this.old_qm_link=null}apolloPreFlight(t){const i=t.operationName,r=this.modifiers[i],u=`:request.${i}`,c=this.hasListeners(u);if(!r&&!c)return;const g=this.client.queryManager,y=g&&g.queryIdsByName,p=g&&g.queries,w=y&&y[i],S=Array.isArray(w)?w[0]:w,A=p&&p.get(S);if(r)for(const M of r)typeof M=="function"?M(t):M[1]&&this.applyModifier(t,M[1]);let L=!!r;if(c){const M=new h({operation:i,request:t});this.emit(u,M),M._changed&&(L=!0)}if(L){const M=this.client.queryManager.queryStore.store[S],U=this.gqlPrint&&this.gqlPrint(t.query);M&&(U?(M.queryString=U,t.query.loc.source.body=U,t.query.loc.end=U.length,A&&(A.document=t.query,A.observableQuery&&A.observableQuery.options&&(A.observableQuery.options.query=t.query))):(this.log.info("Unable to find GQL Print. Clearing store for query:",i),this.client.queryManager.queryStore.store[S]=null))}}apolloPostFlight(t){if(!t.extensions)return;const i=t.extensions.operationName,r=this.post_modifiers[i];if(r)for(const u of r)u(t);this.emit(`:response.${i}`,t.data)}applyModifier(t,i){t.query=(0,v.default)(t.query,i)}registerModifier(t,i,r=!0){if(typeof i!="function"){if(!r)throw new Error("post modifiers must be functions");i=[i,i]}(r?this.modifiers[t]=this.modifiers[t]||[]:this.post_modifiers[t]=this.post_modifiers[t]||[]).push(i)}unregisterModifier(t,i,r=!0){const u=r?this.modifiers[t]:this.post_modifiers[t];if(u){if(typeof i!="function")throw new Error("graphql modifiers cannot be removed");for(let c=0;c<u.length;c++){const g=u[c];if(typeof g=="function"?g===i:g[0]===i){u.splice(c,1);return}}}}getQuery(t){const i=this.client.queryManager?.queries;if(i)for(const r of i.values()){const u=r?.observableQuery;if(u?.queryName===t)return u}}maybeRefetch(t){const i=this.getQuery(t);!i||!i.lastResult||i.lastResult.stale||i.refetch()}ensureQuery(t,i,r=500,u=12e4){const c=this.getQuery(t);if(c){const g=c.lastResult;let y;g?g.loading?y=!0:typeof i=="function"?y=i(g):y=(0,f.get)(i,g)!==void 0:y=!1,!y&&Date.now()-(c._ffz_last_retry||0)>=u&&(c._ffz_last_retry=Date.now(),c.options.query=Object.assign({},c.options.query),r===0?c.refetch():r>0&&setTimeout(()=>{c.refetch()},r))}return c}getFromQuery(t,i,r=500,u=12e4){const c=this.getQuery(t),g=c&&c.lastResult;if(!c)return;let y;if(!(g&&(typeof i=="function"?y=i(g):y=(0,f.get)(i,g),g.loading)))return y===void 0&&Date.now()-(c._ffz_last_retry||0)>=u&&(c._ffz_last_retry=Date.now(),c.options.query=Object.assign({},c.options.query),r===0?c.refetch():r>0&&setTimeout(()=>c.refetch(),r)),y}};E(d,"Apollo");let o=d},5286:(D,C,n)=>{n.d(C,{default:()=>v});const P={Document:(l,h)=>(l.definitions&&h.definitions?l.definitions=f(l.definitions,h.definitions):h.definitions&&(l.definitions=h.definitions),l),Field:(l,h)=>(l.name&&(!h.name||h.name.value!==l.name.value)||(l.selectionSet&&h.selectionSet?l.selectionSet=v(l.selectionSet,h.selectionSet):h.selectionSet&&(l.selectionSet=h.selectionSet)),l),OperationDefinition:(l,h)=>(l.operation!==h.operation||(l.selectionSet&&h.selectionSet?l.selectionSet=v(l.selectionSet,h.selectionSet):h.selectionSet&&(l.selectionSet=h.selectionSet)),l),FragmentDefinition:(l,h)=>(l.typeCondition&&h.typeCondition&&(l.typeCondition.kind!==h.typeCondition.kind||l.typeCondition.name.value!=h.typeCondition.name.value)||(l.selectionSet&&h.selectionSet?l.selectionSet=v(l.selectionSet,h.selectionSet):h.selectionSet&&(l.selectionSet=h.selectionSet)),l),SelectionSet:(l,h)=>(l.selections&&h.selections?l.selections=f(l.selections,h.selections):h.selections&&(l.selections=h.selections),l)};function f(l,h){let e=!1;const o={};for(const s of l)!s||!s.name||s.name.kind!=="Name"||(s.operation&&(e=!0),o[s.name.value]=s);for(const s of h){if(!s||!s.name||s.name.kind!=="Name")continue;const a=s.name.value,d=o[a]?l.indexOf(o[a]):-1;if(d!==-1){if(l[d].operation&&s.operation&&l[d].operation!==s.operation)continue;l[d]=v(l[d],s),l[d].operation&&(e=!0)}else{if(e&&s.operation)continue;l.push(s)}}return l}E(f,"mergeList");function v(l,h){return l.kind!==h.kind?l:P[l.kind]?P[l.kind](l,h):l}E(v,"merge")},27040:(D,C,n)=>{n.r(C),n.d(C,{default:()=>v});var P=n(22527),f=n(46949);const l=class l extends P.default{constructor(e,o){super(e,o),this.apollo=null,this.site=null,this.site=this.parent,this.inject("site.apollo"),this._waiting_user_ids=new Map,this._waiting_user_logins=new Map,this._waiting_stream_ids=new Map,this._waiting_stream_logins=new Map,this._waiting_flag_ids=new Map,this._waiting_flag_logins=new Map,this.tag_cache=new Map,this._waiting_tags=new Map,this._loadStreams=(0,f.debounce)(this._loadStreams,50)}queryApollo(e,o,s){let a;return!o&&!s&&"query"in e&&e.query?a=e:(a={query:e,variables:o},s&&(a=Object.assign(a,s))),this.apollo.client.query(a)}mutate(e,o,s){let a;return!o&&!s&&"mutation"in e&&e.mutation?a=e:(a={mutation:e,variables:o},s&&(a=Object.assign(a,s))),this.apollo.client.mutate(a)}get languageCode(){const e=this.site.getSession();return e&&e.languageCode||"en"}get locale(){const e=this.site.getSession();return e&&e.locale||"en-US"}async getBadges(){const e=await this.queryApollo(await n.e(3224).then(n.t.bind(n,68905,23)));return(0,f.get)("data.badges",e)}async getMatchingCategories(e,o=15,s=null){const a=await this.queryApollo(await n.e(3224).then(n.t.bind(n,29817,23)),{query:e,first:o,cursor:s}),d=(0,f.get)("data.searchCategories.edges.@each.node",a)??[],m=e.toLowerCase();return Array.isArray(d)&&d.sort((t,i)=>{const r=t&&(t.name?.toLowerCase?.()===m||t?.displayName?.toLowerCase?.()===m),u=t&&(i.name?.toLowerCase?.()===m||i?.displayName?.toLowerCase?.()===m);return r&&!u?-1:!r&&u?1:0}),{cursor:(0,f.get)("data.searchCategories.edges.@last.cursor",a),items:d,finished:!(0,f.get)("data.searchCategories.pageInfo.hasNextPage",a),count:(0,f.get)("data.searchCategories.totalCount",a)||0}}async getCategory(e,o){const s=await this.queryApollo(await n.e(3224).then(n.t.bind(n,95373,23)),{id:e,name:o});return(0,f.get)("data.game",s)}async deleteChatMessage(e,o){e=String(e);const s=await this.mutate({mutation:await n.e(3224).then(n.t.bind(n,4223,23)),variables:{input:{channelID:e,messageID:o}}}),a=(0,f.get)("data.deleteChatMessage.responseCode",s);if(a==="TARGET_IS_BROADCASTER")throw new f.TranslatableError("You cannot delete the broadcaster's messages.","chat.delete.forbidden.broadcaster");if(a==="TARGET_IS_MODERATOR")throw new f.TranslatableError("You cannot delete messages from moderator {displayName}.","chat.delete.forbidden.moderator",(0,f.get)("data.deleteChatMessage.message.sender",s));if(a!=="SUCCESS")throw new f.TranslatableError("You don't have permission to delete messages.","chat.delete.forbidden");return!0}async getMatchingUsers(e,o=15,s=null){const a=await this.queryApollo(await n.e(3224).then(n.t.bind(n,4176,23)),{query:e,first:o,cursor:s}),d=(0,f.get)("data.searchUsers.edges.@each.node",a)??[],m=e.toLowerCase();return Array.isArray(d)&&d.sort((t,i)=>{const r=t&&(t.login?.toLowerCase?.()===m||t?.displayName?.toLowerCase?.()===m),u=t&&(i.login?.toLowerCase?.()===m||i?.displayName?.toLowerCase?.()===m);return r&&!u?-1:!r&&u?1:0}),{cursor:(0,f.get)("data.searchUsers.edges.@last.cursor",a),items:d,finished:!(0,f.get)("data.searchUsers.pageInfo.hasNextPage",a),count:(0,f.get)("data.searchUsers.totalCount",a)||0}}async getUser(e,o){const s=await this.queryApollo(await n.e(3224).then(n.t.bind(n,2247,23)),{id:e,login:o});return(0,f.get)("data.user",s)}async getUserGame(e,o){const s=await this.queryApollo(await n.e(3224).then(n.t.bind(n,34489,23)),{id:e,login:o});return(0,f.get)("data.user.broadcastSettings.game",s)}async getUserSelf(e,o){const s=await this.queryApollo(await n.e(3224).then(n.t.bind(n,23333,23)),{id:e,login:o});return(0,f.get)("data.user.self",s)}async getUserFollowed(e,o){const s=await this.queryApollo(await n.e(3224).then(n.t.bind(n,70470,23)),{id:e,login:o});return(0,f.get)("data.user.self.follower",s)}async followUser(e,o=!1){e=String(e),o=!!o;const s=await this.mutate({mutation:await n.e(3224).then(n.t.bind(n,33886,23)),variables:{input:{targetID:e,disableNotifications:o}}});console.log("result",s);const a=(0,f.get)("data.followUser.error",s);if(a?.code)throw new Error(a.code);return(0,f.get)("data.followUser.follow",s)}async unfollowUser(e,o=!1){e=String(e),o=!!o;const s=await this.mutate({mutation:await n.e(3224).then(n.t.bind(n,65199,23)),variables:{input:{targetID:e}}});return console.log("result",s),(0,f.get)("data.unfollowUser.follow",s)}async getLastBroadcast(e,o){const s=await this.queryApollo(await n.e(3224).then(n.t.bind(n,27991,23)),{id:e,login:o});return(0,f.get)("data.user.lastBroadcast",s)}getUserBasic(e,o){return new Promise((s,a)=>{e?this._waiting_user_ids.has(e)?this._waiting_user_ids.get(e).push([s,a]):this._waiting_user_ids.set(e,[[s,a]]):o?this._waiting_user_logins.has(o)?this._waiting_user_logins.get(o).push([s,a]):this._waiting_user_logins.set(o,[[s,a]]):a("id and login cannot both be null"),this._loading_users||this._loadUsers()})}async _loadUsers(){if(this._loading_users)return;this._loading_users=!0;const e=[...this._waiting_user_ids.keys()].slice(0,50),o=50-e.length,s=o>0?[...this._waiting_user_logins.keys()].slice(0,o):[];let a;try{const t=await this.queryApollo({query:await n.e(3224).then(n.t.bind(n,59649,23)),variables:{ids:e.length?e:null,logins:s.length?s:null}});a=(0,f.get)("data.users",t)}catch(t){for(const i of e){const r=this._waiting_user_ids.get(i);this._waiting_user_ids.delete(i);for(const u of r)u[1](t)}for(const i of s){const r=this._waiting_user_logins.get(i);this._waiting_user_logins.delete(i);for(const u of r)u[1](t)}return}const d=new Set(e),m=new Set(s);if(Array.isArray(a))for(const t of a){if(!t||!t.id)continue;d.delete(t.id),m.delete(t.login);let i=this._waiting_user_ids.get(t.id);if(i){this._waiting_user_ids.delete(t.id);for(const r of i)r[0](t)}if(i=this._waiting_user_logins.get(t.login),i){this._waiting_user_logins.delete(t.login);for(const r of i)r[0](t)}}for(const t of d){const i=this._waiting_user_ids.get(t);if(i){this._waiting_user_ids.delete(t);for(const r of i)r[0](null)}}for(const t of m){const i=this._waiting_user_logins.get(t);if(i){this._waiting_user_logins.delete(t);for(const r of i)r[0](null)}}this._loading_users=!1,(this._waiting_user_ids.size||this._waiting_user_logins.size)&&this._loadUsers()}async getBroadcastID(e,o){const s=await this.queryApollo({query:await n.e(3224).then(n.t.bind(n,33929,23)),variables:{id:e,login:o}});return(0,f.get)("data.user.stream.archiveVideo.id",s)}async getChannelColor(e,o){const s=await this.queryApollo({query:await n.e(3224).then(n.t.bind(n,30252,23)),variables:{id:e,login:o}});return(0,f.get)("data.user.primaryColorHex",s)}async getPoll(e){const o=await this.queryApollo({query:await n.e(3224).then(n.t.bind(n,89218,23)),variables:{id:e}});return(0,f.get)("data.poll",o)}async createPoll(e,o,s,a={}){if(typeof o!="string")throw new TypeError("title must be string");if(!Array.isArray(s)||s.some(i=>typeof i!="string"))throw new TypeError("choices must be array of strings");let d=a.bits||0,m=a.duration||60;(typeof d!="number"||d<0)&&(d=0),(typeof m!="number"||m<0)&&(m=60);const t=await this.mutate({mutation:await n.e(3224).then(n.t.bind(n,31902,23)),variables:{input:{bitsCost:d,bitsVoting:d>0,choices:s.map(i=>({title:i})),durationSeconds:m,ownedBy:`${e}`,subscriberMultiplier:a.subscriberMultiplier||!1,subscriberOnly:a.subscriberOnly||!1,title:o}}});return(0,f.get)("data.createPoll.poll",t)}async archivePoll(e){const o=await this.mutate({mutation:await n.e(3224).then(n.t.bind(n,83852,23)),variables:{id:e}});return(0,f.get)("data.archivePoll.poll",o)}async terminatePoll(e){const o=await this.mutate({mutation:await n.e(3224).then(n.t.bind(n,20685,23)),variables:{id:e}});return(0,f.get)("data.terminatePoll.poll",o)}getStreamMeta(e,o){return new Promise((s,a)=>{e?this._waiting_stream_ids.has(e)?this._waiting_stream_ids.get(e).push([s,a]):this._waiting_stream_ids.set(e,[[s,a]]):o?this._waiting_stream_logins.has(o)?this._waiting_stream_logins.get(o).push([s,a]):this._waiting_stream_logins.set(o,[[s,a]]):a("id and login cannot both be null"),this._loading_streams||this._loadStreams()})}async _loadStreams(){if(this._loading_streams)return;this._loading_streams=!0;const e=[...this._waiting_stream_ids.keys()].slice(0,50),o=50-e.length,s=o>0?[...this._waiting_stream_logins.keys()].slice(0,o):[];let a;try{const t=await this.queryApollo({query:await n.e(3224).then(n.t.bind(n,61421,23)),variables:{ids:e.length?e:null,logins:s.length?s:null}});a=(0,f.get)("data.users",t)}catch(t){for(const i of e){const r=this._waiting_stream_ids.get(i);this._waiting_stream_ids.delete(i);for(const u of r)u[1](t)}for(const i of s){const r=this._waiting_stream_logins.get(i);this._waiting_stream_logins.delete(i);for(const u of r)u[1](t)}return}const d=new Set(e),m=new Set(s);if(Array.isArray(a))for(const t of a){if(!t||!t.id)continue;d.delete(t.id),m.delete(t.login);let i=this._waiting_stream_ids.get(t.id);if(i){this._waiting_stream_ids.delete(t.id);for(const r of i)r[0](t.stream)}if(i=this._waiting_stream_logins.get(t.login),i){this._waiting_stream_logins.delete(t.login);for(const r of i)r[0](t.stream)}}for(const t of d){const i=this._waiting_stream_ids.get(t);if(i){this._waiting_stream_ids.delete(t);for(const r of i)r[0](null)}}for(const t of m){const i=this._waiting_stream_logins.get(t);if(i){this._waiting_stream_logins.delete(t);for(const r of i)r[0](null)}}this._loading_streams=!1,(this._waiting_stream_ids.size||this._waiting_stream_logins.size)&&this._loadStreams()}getStreamFlags(e,o){return new Promise((s,a)=>{if(typeof e=="number"&&(e=`${e}`),e){const d=this._waiting_flag_ids.get(e);d?d.push([s,a]):this._waiting_flag_ids.set(e,[[s,a]])}else if(o){const d=this._waiting_flag_logins.get(o);d?d.push([s,a]):this._waiting_flag_logins.set(o,[[s,a]])}else a("id and login cannot both be null");this._loading_flags||this._loadStreamFlags()})}async _loadStreamFlags(){if(this._loading_flags)return;this._loading_flags=!0;const e=[...this._waiting_flag_ids.keys()].slice(0,50),o=50-e.length,s=o>0?[...this._waiting_flag_logins.keys()].slice(0,o):[];let a;try{const t=await this.queryApollo({query:await n.e(3224).then(n.t.bind(n,9808,23)),variables:{ids:e.length?e:null,logins:s.length?s:null}});a=(0,f.get)("data.users",t)}catch(t){for(const i of e){const r=this._waiting_flag_ids.get(i);if(r){this._waiting_flag_ids.delete(i);for(const u of r)u[1](t)}}for(const i of s){const r=this._waiting_flag_logins.get(i);if(r){this._waiting_flag_logins.delete(i);for(const u of r)u[1](t)}}return}const d=new Set(e),m=new Set(s);if(Array.isArray(a))for(const t of a){if(!t||!t.id)continue;d.delete(t.id),m.delete(t.login);let i=this._waiting_flag_ids.get(t.id);if(i){this._waiting_flag_ids.delete(t.id);for(const r of i)r[0](t.stream?.contentClassificationLabels)}if(i=this._waiting_flag_logins.get(t.login),i){this._waiting_flag_logins.delete(t.login);for(const r of i)r[0](t.stream?.contentClassificationLabels)}}for(const t of d){const i=this._waiting_flag_ids.get(t);if(i){this._waiting_flag_ids.delete(t);for(const r of i)r[0](null)}}for(const t of m){const i=this._waiting_flag_logins.get(t);if(i){this._waiting_flag_logins.delete(t);for(const r of i)r[0](null)}}this._loading_flags=!1,(this._waiting_flag_ids.size||this._waiting_flag_logins.size)&&this._loadStreamFlags()}async getMatchingTags(e){const s=(await this.queryApollo({query:await n.e(3224).then(n.t.bind(n,50873,23)),variables:{query:e,first:100}}))?.data?.searchFreeformTags?.edges;if(!Array.isArray(s)||!s.length)return[];const a=[];for(const d of s){const m=d?.node?.tagName;m&&a.push(m)}return a}};E(l,"TwitchData");let v=l}}]);})();

//# sourceMappingURL=tdata.js.map