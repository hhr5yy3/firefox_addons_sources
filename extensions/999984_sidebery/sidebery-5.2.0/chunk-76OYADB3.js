import{BKM_OTHER_ID,BKM_ROOT_ID,Bookmarks,Containers,DOMAIN_RE,DnD,Info,Menu,Mouse,NOID,Search,Selection,Settings,SetupPage,Sidebar,SidebarConfigRState,Store,Tabs,Windows,asap,bg,broadcast,cloneArray,closeNewTabShortcutsPopup,debounce,err,getFavicon,isBookmarksPanel,isHistoryPanel,isTabsPanel,reactive,reactive2,saveSidebarConfig,sleep,sort,translate,uDate,uTime}from"./chunk-4KZVVU6Z.js";import{__export}from"./chunk-FF3JOXTG.js";var keybindings_actions_exports={};__export(keybindings_actions_exports,{checkShortcut:()=>checkShortcut,loadKeybindings:()=>loadKeybindings,resetErrors:()=>resetErrors,resetKeybindings:()=>resetKeybindings,resetListeners:()=>resetListeners,saveKeybindingsToSync:()=>saveKeybindingsToSync,saveKeybindingsToSyncDebounced:()=>saveKeybindingsToSyncDebounced,setupListeners:()=>setupListeners,update:()=>update});var VALID_SHORTCUT=/^((Ctrl|Alt|Command|MacCtrl)\+)((Shift|Alt|Ctrl|Command|MacCtrl)\+)?([A-Z0-9]|Comma|Period|Home|End|PageUp|PageDown|Space|Insert|Delete|Up|Down|Left|Right|F\d\d?)$|^((Ctrl|Alt|Command|MacCtrl)\+)?((Shift|Alt|Ctrl|Command|MacCtrl)\+)?(F\d\d?)$/;async function loadKeybindings(){let commands=await browser.commands.getAll();Keybindings.reactive.byName={};for(let k of commands)k.name&&(k.error="",k.focus=!1,Keybindings.reactive.byName[k.name]=k);Keybindings.reactive.list=commands}async function saveKeybindingsToSync(){let keybindings={};Keybindings.reactive.list.map(cmd=>{cmd.name&&cmd.shortcut&&(keybindings[cmd.name]=cmd.shortcut)}),await Store.sync("kb",{keybindings})}var saveKeybindingsToSyncDebounced=debounce(saveKeybindingsToSync);async function resetKeybindings(){let waitGroup=Keybindings.reactive.list.map(async k=>{if(k.name)return browser.commands.reset(k.name)});await Promise.all(waitGroup),await loadKeybindings(),Settings.state.syncSaveKeybindings&&Keybindings.saveKeybindingsToSync()}function checkShortcut(shortcut){let duplicate=Keybindings.reactive.list.find(k=>k.shortcut===shortcut),valid=VALID_SHORTCUT.test(shortcut);return duplicate?"duplicate":valid?"valid":"invalid"}async function update(cmd,details){Object.assign(cmd,details),details.shortcut!==void 0&&cmd.name&&(Settings.state.syncSaveKeybindings&&Keybindings.saveKeybindingsToSyncDebounced(150),await browser.commands.update({name:cmd.name,shortcut:details.shortcut}))}function resetErrors(){Keybindings.reactive.list.forEach(k=>{k.error&&(k.error="")})}function onCmd(name){if(!Windows.focused)return;let kb=Keybindings.reactive.byName[name];if(kb||(kb=Keybindings.reactive.list.find(k=>k.name===name)),!!kb)if(name==="next_panel")Sidebar.switchPanel(1,!1,!0);else if(name==="prev_panel")Sidebar.switchPanel(-1,!1,!0);else if(name==="new_tab_on_panel")onKeyNewTabInPanel();else if(name==="new_tab_in_group")onKeyNewTabAfter();else if(name==="new_tab_as_first_child")onKeyNewTabAsFirstChild();else if(name==="new_tab_as_last_child")onKeyNewTabAsLastChild();else if(name==="rm_tab_on_panel")onKeyRmSelectedItem();else if(name==="rm_tabs_above_in_panel")onKeyRAIP();else if(name==="rm_tabs_below_in_panel")onKeyRBIP();else if(name==="rm_tabs_other_in_panel")onKeyROIP();else if(name==="sel_next_panel")Sidebar.selectPanel(1);else if(name==="sel_prev_panel")Sidebar.selectPanel(-1);else if(name==="activate")onKeyActivate();else if(name==="reset_selection")Windows.reactive.choosing&&Windows.closeWindowsPopup(),Selection.resetSelection(),Menu.close(),Sidebar.reactive.hiddenPanelsPopup&&(Sidebar.reactive.hiddenPanelsPopup=!1);else if(name==="select_all")onKeySelectAll();else if(name==="up")onKeySelect(-1);else if(name==="down")onKeySelect(1);else if(name==="up_shift")onKeySelectExpand(-1);else if(name==="down_shift")onKeySelectExpand(1);else if(name==="menu")onKeyMenu();else if(name==="unload_tabs")onKeyUnloadTabs();else if(name==="unload_all_tabs_in_panel")onKeyUnloadAllTabsInPanel();else if(name==="unload_other_tabs_in_panel")onKeyUnloadOtherTabsInPanel();else if(name==="unload_folded_tabs_in_panel")onKeyUnloadFoldedTabsInPanel();else if(name==="unload_all_tabs_in_inact_panels")onKeyUnloadAllTabsInInactPanels();else if(name==="fold_branch")onKeyFoldBranch();else if(name==="expand_branch")onKeyExpandBranch();else if(name==="toggle_branch")onKeyToggleBranch();else if(name==="fold_inact_branches")onKeyFoldInactiveBranches();else if(name==="activate_prev_active_tab_c")Tabs.tabFlip();else if(name==="activate_prev_active_tab")Tabs.switchToRecentlyActiveTab(1,-1);else if(name==="activate_next_active_tab")Tabs.switchToRecentlyActiveTab(1,1);else if(name==="activate_panel_prev_active_tab")Tabs.switchToRecentlyActiveTab(2,-1);else if(name==="activate_panel_next_active_tab")Tabs.switchToRecentlyActiveTab(2,1);else if(name==="tabs_indent")onKeyTabsIndent();else if(name==="tabs_outdent")onKeyTabsOutdent();else if(name==="move_tab_to_active")onKeyMoveTabsToAct();else if(name==="move_tabs_up")onKeyMoveTabs(-1);else if(name==="move_tabs_down")onKeyMoveTabs(1);else if(name==="create_snapshot")broadcast({dstType:0,action:"createSnapshot"});else if(name==="open_snap_viewer")SetupPage.open("snapshots");else if(name.startsWith("switch_to_panel_")){let panel=Sidebar.panels[parseInt(name.slice(-1))];panel&&Sidebar.switchToPanel(panel.id)}else if(name==="move_tabs_to_panel_start")onKeyMoveTabsInPanel("start",!0);else if(name==="move_tabs_to_panel_end")onKeyMoveTabsInPanel("end",!0);else if(name.startsWith("move_tabs_to_panel_"))onKeyMoveTabsToPanel(parseInt(name[19]));else if(name==="search")Search.start();else if(name==="switch_to_parent_tab")Tabs.activateParent(Selection.get()[0]);else if(name==="switch_to_last_tab")onKeySwitchToTab();else if(name.startsWith("switch_to_tab_")){let index=parseInt(name.slice(-1));isNaN(index)||onKeySwitchToTab(index)}else if(name.startsWith("switch_to_unpinned_tab_")){let index=parseInt(name.slice(-1));isNaN(index)||onKeySwitchToTab(index,{unpinned:!0})}else if(name==="switch_to_next_tab"){let globaly=Settings.state.scrollThroughTabs==="global";Tabs.switchTab(globaly,Settings.state.scrollThroughTabsCyclic,1,!1)}else if(name==="switch_to_prev_tab"){let globaly=Settings.state.scrollThroughTabs==="global";Tabs.switchTab(globaly,Settings.state.scrollThroughTabsCyclic,-1,!1)}else name==="scroll_to_active_panel_top"?onKeyScrollToTopBottom(-1):name==="scroll_to_active_panel_bottom"?onKeyScrollToTopBottom(1):name==="duplicate_tabs"?onKeyDuplicateTabs(!1):name==="pin_tabs"?onKeyPinTabs():name==="hide_act_panel"?onKeyHidePanel():name==="group_tabs"?onKeyGroupTabs(!1):name==="group_tabs_act"?onKeyGroupTabs(!0):name==="flatten_tabs"?onKeyFlattenTabs():name==="sel_child_tabs"?onKeySelChildTabs():name==="sort_tabs_by_title_asc"?onKeySortTabs(1,1):name==="sort_tabs_by_title_des"?onKeySortTabs(1,-1):name==="sort_tabs_by_url_asc"?onKeySortTabs(2,1):name==="sort_tabs_by_url_des"?onKeySortTabs(2,-1):name==="sort_tabs_by_time_asc"?onKeySortTabs(3,1):name==="sort_tabs_by_time_des"?onKeySortTabs(3,-1):name==="sort_panel_tabs_by_title_asc"?onKeySortTabs(1,1,!0,!0):name==="sort_panel_tabs_by_title_des"?onKeySortTabs(1,-1,!0,!0):name==="sort_panel_tabs_by_url_asc"?onKeySortTabs(2,1,!0,!0):name==="sort_panel_tabs_by_url_des"?onKeySortTabs(2,-1,!0,!0):name==="sort_panel_tabs_by_time_asc"?onKeySortTabs(3,1,!0,!0):name==="sort_panel_tabs_by_time_des"&&onKeySortTabs(3,-1,!0,!0)}function onKeySortTabs(type,dir=0,tree,panel){if(Tabs.sorting)return;let ids;if(panel){let activePanel=Sidebar.panelsById[Sidebar.activePanelId];if(!isTabsPanel(activePanel))return;ids=activePanel.tabs.map(t=>t.id)}else ids=Selection.isTabs()?Selection.get():[Tabs.activeId];ids.length&&sort(type,ids,dir,tree)}function onKeyScrollToTopBottom(dir){Sidebar.panelsById[Sidebar.activePanelId]&&Sidebar.scrollActivePanel(dir>0?99999999:0)}function onKeySwitchToTab(targetIndex,conf){let actPanel=Sidebar.panelsById[Sidebar.activePanelId];if(!isTabsPanel(actPanel))return;let normTabs;conf?.visible?normTabs=actPanel.reactive.visibleTabIds.map(id=>Tabs.byId[id]):normTabs=actPanel.tabs;let tabsList;if(conf?.unpinned?tabsList=[...normTabs]:tabsList=[...actPanel.pinnedTabs,...normTabs],!tabsList.length)return;let targetTab;targetIndex===void 0?targetTab=tabsList[tabsList.length-1]:targetTab=tabsList[targetIndex],targetTab&&(targetTab.id!==Tabs.activeId?browser.tabs.update(targetTab.id,{active:!0}):Settings.state.tabsSecondClickActPrev&&Tabs.tabFlip())}function onKeyMoveTabsToPanel(targetIndex){if(isNaN(targetIndex))return;let index=-1,panel=Sidebar.panels.find(p=>(isTabsPanel(p)&&index++,index===targetIndex));if(!isTabsPanel(panel))return;let targetTabIds=Selection.isTabs()?Selection.get():[Tabs.activeId];Tabs.sortTabIds(targetTabIds);let probeTab=Tabs.byId[targetTabIds[0]];if(probeTab&&probeTab.panelId!==panel.id){let items=Tabs.getTabsInfo(targetTabIds),src={windowId:Windows.id,panelId:probeTab.panelId,pinned:probeTab.pinned};Tabs.move(items,src,{panelId:panel.id,index:panel.nextTabIndex})}}function onKeyActivate(){if(Windows.reactive.choosing){Windows.activateSelectedWindow();return}if(Menu.isOpen){Menu.activateOption();return}if(Sidebar.panelsById[Selection.getFirst()]){let panelId=Selection.getFirst();Sidebar.reactive.hiddenPanelsPopup&&(Sidebar.reactive.hiddenPanelsPopup=!1),Sidebar.switchToPanel(panelId,!1,!1);return}if(Sidebar.reactive.hiddenPanelsPopup){Sidebar.closeHiddenPanelsPopup();return}if(Sidebar.updateBounds(),!Selection.isSet()){let activePanel=Sidebar.panelsById[Sidebar.activePanelId];if(isTabsPanel(activePanel)&&activePanel.tabs.length){let activeTab=Tabs.list.find(t=>t.active&&t.panelId===activePanel.id);activeTab&&Selection.selectTab(activeTab.id)}}if(Selection.isHeader()){let id=Selection.getFirst(),activePanel=Sidebar.panelsById[Sidebar.activePanelId];isBookmarksPanel(activePanel)&&activePanel.component&&activePanel.component.toggleGroupById(id)}else if(Selection.isTabs()){let tabId=Selection.getFirst(),tab=Tabs.byId[tabId];if(!tab)return;tab.active&&(Selection.resetSelection(),tab.isParent&&Tabs.toggleBranch(tab.id)),browser.tabs.update(tabId,{active:!0})}else if(Selection.isBookmarks()){let targetId=Selection.getFirst(),target=Bookmarks.reactive.byId[targetId];if(!target)return;if(target.type==="folder"&&(Bookmarks.reactive.expanded[Sidebar.activePanelId]?.[target.id]?Bookmarks.foldBookmark(target.id,Sidebar.activePanelId):Bookmarks.expandBookmark(target.id,Sidebar.activePanelId)),target.type==="bookmark"){if(Settings.state.activateOpenBookmarkTab&&target.isOpen){let tab=Tabs.list.find(t=>t.url===target.url);if(tab){browser.tabs.update(tab.id,{active:!0});return}}let{dst,useActiveTab,activateFirstTab}=Bookmarks.getMouseOpeningConf(0);Bookmarks.open([targetId],dst,useActiveTab,activateFirstTab)}}}function onKeyNewTabInPanel(){let panel=Sidebar.panelsById[Sidebar.activePanelId];isTabsPanel(panel)||(panel=Sidebar.panelsById[Sidebar.lastTabsPanelId]),isTabsPanel(panel)&&Tabs.createTabInPanel(panel)}function onKeyNewTabAfter(){let activeTab=Tabs.list.find(t=>t.active);if(!activeTab)return;let index=activeTab.index+1;if(!activeTab.pinned)for(let t;index<Tabs.list.length&&(t=Tabs.list[index],!(t.lvl<=activeTab.lvl));index++);Tabs.setNewTabPosition(index,activeTab.parentId,activeTab.panelId);let conf={index,pinned:activeTab.pinned,cookieStoreId:activeTab.cookieStoreId,windowId:Windows.id};browser.tabs.create(conf)}function onKeySelect(dir){if(!dir)return;if(Windows.reactive.choosing){Windows.selectWindow(dir);return}if(Menu.isOpen){Menu.selectOption(dir);return}if(Search.rawValue){dir>0?Search.next():Search.prev();return}let activePanel=Sidebar.panelsById[Sidebar.activePanelId];if(isTabsPanel(activePanel)){let tabs;if(Settings.state.pinnedTabsPosition==="panel"?tabs=[...activePanel.pinnedTabs,...activePanel.tabs]:tabs=[...Tabs.pinned,...activePanel.tabs],!tabs.length)return;let selIsSet=Selection.isSet(),target;if(Settings.state.selectActiveTabFirst&&!selIsSet){target=Tabs.byId[Tabs.activeId];let wrongPanel=target&&(!target.pinned||Settings.state.pinnedTabsPosition==="panel")&&target.panelId!==activePanel.id;(!target||wrongPanel)&&(target=dir>0?tabs[0]:tabs.findLast(t=>!t.invisible))}else{let afterSel=!1,tabFinder=tab=>{if(tab.invisible)return!1;if(afterSel)return!0;(selIsSet&&tab.sel||!selIsSet&&tab.active)&&(afterSel=!0)};target=dir>0?tabs.find(tabFinder):tabs.findLast(tabFinder)}if(!target&&(dir>0?target=tabs.findLast(t=>!t.invisible):target=tabs[0],!target))return;Selection.resetSelection(),Selection.selectTab(target.id),Tabs.scrollToTab(target.id,!0)}else{if(Sidebar.updateBounds(),!activePanel?.bounds?.length)return;let selIsSet=Selection.isSet(),selId=Selection.getFirst(),selIndex=-1;selIsSet&&(selIndex=activePanel.bounds.findIndex(s=>s.id===selId)),selIndex===-1&&dir<0&&(selIndex=activePanel.bounds.length);let target=activePanel.bounds[selIndex+dir];if(target&&(Selection.resetSelection(),target.type===3?Selection.select(target.id,7):Selection.select(target.id)),target&&activePanel.scrollEl){let h=activePanel.scrollEl.offsetHeight??0,s=activePanel.scrollEl.scrollTop??0;target.start<s+64&&Sidebar.scrollActivePanel(target.start-64),target.end>h+s-64&&Sidebar.scrollActivePanel(target.end-h+64)}}}function onKeySelectExpand(dir){if(!dir)return;Sidebar.updateBounds();let activePanel=Sidebar.panelsById[Sidebar.activePanelId];if(!activePanel||!activePanel.bounds?.length)return;let target;if(Selection.isSet()||(dir>0?(target=activePanel.bounds[0],Selection.select(target.id)):(target=activePanel.bounds[activePanel.bounds.length-1],Selection.select(target.id))),Selection.isSet()){let lastId=Selection.getLast(),index=activePanel.bounds.findIndex(b=>b.id===lastId);if(target=activePanel.bounds[index+dir],target){if(Selection.isTabs()){let nextTab=Tabs.byId[target.id];nextTab&&Selection.selectTabsRange(nextTab)}else if(Selection.isBookmarks()){let nextBookmark=Bookmarks.reactive.byId[target.id];nextBookmark&&Selection.selectBookmarksRange(nextBookmark)}}}if(target&&activePanel.scrollEl){activePanel.scrollEl;let h=activePanel.scrollEl.offsetHeight,s=activePanel.scrollEl.scrollTop;target.start<s+64&&(activePanel.scrollEl.scrollTop=target.start-64),target.end>h+s-64&&(activePanel.scrollEl.scrollTop=target.end-h+64)}}function onKeySelectAll(){Sidebar.updateBounds();let activePanel=Sidebar.panelsById[Sidebar.activePanelId];if(activePanel&&!(!activePanel.bounds||!activePanel.bounds.length)){Selection.resetSelection();for(let s of activePanel.bounds)Selection.select(s.id)}}function onKeyMenu(){let activePanel=Sidebar.panelsById[Sidebar.activePanelId];if(!activePanel)return;let activeTab=Tabs.byId[Tabs.activeId],actPanelIsTabs=isTabsPanel(activePanel),pinnedGlobally=activeTab?.pinned&&Settings.state.pinnedTabsPosition!=="panel";if(!Selection.isSet()&&activeTab){let panelIsOk=actPanelIsTabs&&activeTab.panelId===activePanel.id;(pinnedGlobally||panelIsOk)&&Selection.selectTab(Tabs.activeId)}if(!Selection.isSet())return;let targetEl,targetType,targetId=Selection.getFirst();if(Selection.isTabs())targetEl=document.getElementById(`tab${targetId}`),targetType=1;else if(Selection.isBookmarks()){let actPanelId=Sidebar.activePanelId;targetEl=document.getElementById(`bookmark${actPanelId}${targetId}`),targetType=2}else if(Selection.isNavItem()){let panel=Sidebar.panelsById[targetId];if(isTabsPanel(panel))targetType=7;else if(isBookmarksPanel(panel))targetType=8;else if(isHistoryPanel(panel))targetType=9;else return;targetEl=document.getElementById(`nav${targetId}`)}else return;if(!targetEl)return;let br=targetEl.getBoundingClientRect();Menu.open(targetType,br.left+1,br.bottom+1,!0)}function onKeyRmSelectedItem(){if(Selection.isSet())Selection.isTabs()?Tabs.removeTabs(Selection.get()):Selection.isBookmarks()&&Bookmarks.removeBookmarks(Selection.get()),Selection.resetSelection();else{let activeTab=Tabs.list.find(t=>t&&t.active);activeTab&&Tabs.removeTabs([activeTab.id])}}function onKeyFoldBranch(){if(!Selection.isSet())Tabs.foldTabsBranch(Tabs.activeId);else if(Selection.isTabs())for(let tabId of Selection){let tab=Tabs.byId[tabId];!tab||!tab.isParent||tab.folded||Tabs.foldTabsBranch(tabId)}else if(Selection.isBookmarks()){let activePanelId=Sidebar.activePanelId;for(let bookmarkId of Selection){let bookmark=Bookmarks.reactive.byId[bookmarkId],isExpanded=Bookmarks.reactive.expanded[activePanelId]?.[bookmarkId];!bookmark||!isExpanded||Bookmarks.foldBookmark(bookmarkId,activePanelId)}}}function onKeyExpandBranch(){if(!Selection.isSet())Tabs.expTabsBranch(Tabs.activeId);else if(Selection.isTabs())for(let tabId of Selection){let tab=Tabs.byId[tabId];!tab||!tab.isParent||!tab.folded||Tabs.expTabsBranch(tabId)}else if(Selection.isBookmarks()){let activePanelId=Sidebar.activePanelId;for(let bookmarkId of Selection){let bookmark=Bookmarks.reactive.byId[bookmarkId],isExpanded=Bookmarks.reactive.expanded[activePanelId]?.[bookmarkId];!bookmark||isExpanded||Bookmarks.expandBookmark(bookmarkId,activePanelId)}}}function onKeyToggleBranch(){if(!Selection.isSet())Tabs.toggleBranch(Tabs.activeId);else if(Selection.isTabs())for(let tabId of Selection){let tab=Tabs.byId[tabId];!tab||!tab.isParent||Tabs.toggleBranch(tabId)}else if(Selection.isBookmarks()){let activePanelId=Sidebar.activePanelId;for(let bookmarkId of Selection){if(!Bookmarks.reactive.byId[bookmarkId])continue;Bookmarks.reactive.expanded[activePanelId]?.[bookmarkId]?Bookmarks.foldBookmark(bookmarkId,activePanelId):Bookmarks.expandBookmark(bookmarkId,activePanelId)}}}function onKeyFoldInactiveBranches(){let activePanel=Sidebar.panelsById[Sidebar.activePanelId];isTabsPanel(activePanel)&&Tabs.foldAllInactiveBranches(activePanel.tabs.map(rt=>Tabs.byId[rt.id])??[])}function onKeyTabsIndent(){let selected;if(Selection.isTabs()?selected=Selection.get():selected=[Tabs.activeId],!Tabs.byId[selected[0]])return;selected.sort((a,b)=>{let at=Tabs.byId[a],bt=Tabs.byId[b];return!at||!bt?0:at.index-bt.index});let align=[],toExpand=[],toColorize=[];for(let id of selected){let tab=Tabs.byId[id];if(!tab)continue;let parentTab;for(let t,i=tab.index;i--;)if(t=Tabs.list[i],!(!t||t.panelId!==tab.panelId)){if(t.lvl<tab.lvl)break;if(t.lvl===tab.lvl){parentTab=t;break}}if(parentTab){if(selected.includes(parentTab.id)){align.push([tab,parentTab]),Settings.state.inheritCustomColor&&parentTab.customColor&&(tab.reactive.customColor=tab.customColor=parentTab.customColor);continue}if(parentTab.folded&&toExpand.push(parentTab.id),parentTab.lvl===0&&toColorize.push(parentTab.id),tab.parentId=parentTab.id,Settings.state.inheritCustomColor&&parentTab.customColor&&(tab.reactive.customColor=tab.customColor=parentTab.customColor,tab.isParent)){let branch=Tabs.getBranch(tab,!1);for(let childTab of branch)childTab.reactive.customColor=childTab.customColor=tab.customColor}}}align.forEach(([a,b])=>a.parentId=b.parentId),toExpand.forEach(id=>Tabs.expTabsBranch(id)),Tabs.updateTabsTree(),Tabs.cacheTabsData(),selected.forEach(id=>Tabs.saveTabData(id)),toColorize.forEach(id=>Tabs.colorizeBranch(id))}function onKeyTabsOutdent(){let selected;if(Selection.isTabs()?selected=Selection.get():selected=[Tabs.activeId],!Tabs.byId[selected[0]])return;selected.sort((a,b)=>{let at=Tabs.byId[a],bt=Tabs.byId[b];return!at||!bt?0:at.index-bt.index});let toColorize=[],toUpdCustomColor=[];for(let id of selected){let tab=Tabs.byId[id];if(!tab||tab.parentId===-1)continue;let parentTab;for(let t,i=tab.index;i--;)if(t=Tabs.list[i],!!t&&t.lvl<tab.lvl){parentTab=t;break}if(parentTab){if(selected.includes(parentTab.id)){Settings.state.inheritCustomColor&&toUpdCustomColor.push(tab);continue}tab.parentId=parentTab.parentId,tab.parentId===NOID&&toColorize.push(tab.id),Settings.state.inheritCustomColor&&toUpdCustomColor.push(tab)}}Tabs.updateTabsTree(),Tabs.cacheTabsData(),selected.forEach(id=>Tabs.saveTabData(id)),toColorize.forEach(id=>Tabs.colorizeBranch(id));for(let tab of toUpdCustomColor){let parentTab=Tabs.byId[tab.parentId];if(parentTab&&(parentTab.customColor&&(tab.reactive.customColor=tab.customColor=parentTab.customColor),tab.isParent&&tab.customColor)){let branch=Tabs.getBranch(tab,!1);for(let childTab of branch)childTab.reactive.customColor=childTab.customColor=tab.customColor}}}function onKeyMoveTabsToAct(){if(!Selection.isTabs())return;let activeTab=Tabs.byId[Tabs.activeId];if(!activeTab||activeTab.pinned)return;let items=Selection.getTabsInfo(!0),firstItem=items[0];if(!firstItem)return;let panelId=firstItem.panelId??NOID;if(!isTabsPanel(Sidebar.panelsById[panelId]))return;Selection.resetSelection();let src={panelId,pinned:!1,windowId:Windows.id};Tabs.move(items,src,{index:activeTab.index+1,parentId:activeTab.id,panelId})}var tabsMoving=!1;async function onKeyMoveTabs(dir){if(tabsMoving)return;let preSelected;Selection.isTabs()?preSelected=Selection.get():preSelected=[Tabs.activeId];let toMove=[],toMoveById={},tabsPinned;for(let id of preSelected){let tab=Tabs.byId[id];if(tab){if(tabsPinned===void 0)tabsPinned=tab.pinned;else if(tabsPinned!==tab.pinned)return;if(toMove.push(tab),toMoveById[tab.id]=tab,tab.isParent)for(let t,i=tab.index+1;i<Tabs.list.length&&(t=Tabs.list[i],!(t.lvl<=tab.lvl));i++)preSelected.includes(t.id)||(toMove.push(t),toMoveById[t.id]=t)}}toMove.sort((a,b)=>a.index-b.index);let toMoveIds=toMove.map(t=>t.id);Selection.resetSelection(!0),Selection.selectTabs(toMoveIds),Selection.preserveSelection(),Selection.allowSelectionReset(300);let firstTab=toMove[0];if(!firstTab)return;let edgeTab=dir<0?firstTab:toMove[toMove.length-1];if(!edgeTab)return;let panel=Sidebar.panelsById[edgeTab.panelId],unpin=!1,pin=!1;if(!isTabsPanel(panel)||dir<0&&edgeTab.pinned&&edgeTab.index===panel.startTabIndex)return;if(dir<0&&!edgeTab.pinned&&edgeTab.index===panel.startTabIndex&&(pin=!0),dir>0&&edgeTab.pinned){let list;if(Settings.state.pinnedTabsPosition==="panel"?list=panel.pinnedTabs:list=Tabs.pinned,!list?.length)return;edgeTab.id===list[list.length-1]?.id&&(unpin=!0)}let rootParentId=NOID,targetIndex;if(firstTab.pinned){let list;if(Settings.state.pinnedTabsPosition==="panel"?list=panel.pinnedTabs:list=Tabs.pinned,list.findLastIndex(t=>t.id===edgeTab.id)===-1)return;if(unpin){if(Settings.state.pinnedTabsPosition!=="panel"){let actPanel=Sidebar.panelsById[Sidebar.activePanelId];isTabsPanel(actPanel)?panel=actPanel:panel=Sidebar.panels.find(isTabsPanel)??panel}targetIndex=panel.startTabIndex}else if(dir<0){let prevTab=list.findLast(t=>t.index<edgeTab.index);if(!prevTab)return;targetIndex=prevTab.index}else{let nextTab=list.find(t=>t.index>edgeTab.index);if(!nextTab)return;targetIndex=nextTab.index+1}}else if(pin){let lastPinned;Settings.state.pinnedTabsPosition==="panel"?lastPinned=panel.pinnedTabs[panel.pinnedTabs.length-1]:lastPinned=Tabs.pinned[Tabs.pinned.length-1],lastPinned?targetIndex=lastPinned.index+1:targetIndex=0}else if(dir<0){let prevTab=panel.tabs.findLast(t=>t.index<firstTab.index&&!t.invisible);if(!prevTab)return;if(targetIndex=prevTab.index,rootParentId=prevTab.parentId,rootParentId!==firstTab.parentId&&prevTab.lvl>firstTab.lvl){let rootParent=panel.tabs.findLast(t=>t.index<firstTab.index&&!t.invisible&&t.lvl===firstTab.lvl+1);rootParent&&(rootParentId=rootParent.parentId),targetIndex=firstTab.index}}else{let fIndex=firstTab.index,nextTab=panel.tabs.find(t=>t.index>fIndex&&!toMoveById[t.id]&&!t.invisible);if(nextTab){if(nextTab.isParent&&nextTab.folded){let branchLen=Tabs.getBranchLen(nextTab.id)??0;targetIndex=nextTab.index+1+branchLen}else targetIndex=nextTab.index+1;if(nextTab.isParent&&!nextTab.folded?rootParentId=nextTab.id:rootParentId=nextTab.parentId,rootParentId!==firstTab.parentId&&nextTab.lvl<firstTab.lvl){let rootParent=panel.tabs.findLast(t=>t.index<firstTab.index&&!toMoveById[t.id]&&!t.invisible&&t.lvl===firstTab.lvl-1);rootParent&&(rootParentId=rootParent.parentId),targetIndex=firstTab.index}}else if(firstTab.lvl>0){let rootParent=panel.tabs.findLast(t=>t.index<firstTab.index&&!toMoveById[t.id]&&!t.invisible&&t.lvl===firstTab.lvl-1);rootParent&&(rootParentId=rootParent.parentId),targetIndex=firstTab.index}else return}tabsMoving=!0;let dst={index:targetIndex,parentId:rootParentId,panelId:panel.id};pin?dst.pinned=!0:unpin?dst.pinned=!1:dst.pinned=edgeTab.pinned,await Tabs.move(toMove,{},dst).catch(err2=>{err("KB.onKeyMoveTabs: Cannot move tabs",err2)}),tabsMoving=!1}function onKeyNewTabAsFirstChild(){let activeTab=Tabs.list.find(t=>t.active);activeTab&&(Tabs.setNewTabPosition(activeTab.index+1,activeTab.id,activeTab.panelId),browser.tabs.create({index:activeTab.index+1,cookieStoreId:activeTab.cookieStoreId,windowId:Windows.id,openerTabId:activeTab.id}))}function onKeyNewTabAsLastChild(){let activeTab=Tabs.list.find(t=>t.active);if(!activeTab)return;let index=activeTab.index+1;for(let t;index<Tabs.list.length&&(t=Tabs.list[index],!(t.lvl<=activeTab.lvl));index++);Tabs.setNewTabPosition(activeTab.index+1,activeTab.id,activeTab.panelId),browser.tabs.create({index,cookieStoreId:activeTab.cookieStoreId,windowId:Windows.id,openerTabId:activeTab.id})}function onKeyRAIP(){let actPanel=Sidebar.panelsById[Sidebar.activePanelId];if(!isTabsPanel(actPanel))return;let actTab=Tabs.byId[Tabs.activeId];!actTab||actTab.pinned||actTab.panelId!==actPanel.id||Tabs.removeTabsAbove()}function onKeyRBIP(){let actPanel=Sidebar.panelsById[Sidebar.activePanelId];if(!isTabsPanel(actPanel))return;let actTab=Tabs.byId[Tabs.activeId];!actTab||actTab.pinned||actTab.panelId!==actPanel.id||Tabs.removeTabsBelow()}function onKeyROIP(){let actPanel=Sidebar.panelsById[Sidebar.activePanelId];if(!isTabsPanel(actPanel))return;let actTab=Tabs.byId[Tabs.activeId];!actTab||actTab.pinned||actTab.panelId!==actPanel.id||Tabs.removeOtherTabs()}function onKeyUnloadTabs(){let ids=Selection.isTabs()?Selection.get():[Tabs.activeId];ids.length&&Tabs.discardTabs(ids)}function onKeyUnloadAllTabsInPanel(){let panel=Sidebar.panelsById[Sidebar.activePanelId];if(!isTabsPanel(panel))return;let tabIds=[];panel.pinnedTabs.forEach(t=>tabIds.push(t.id)),panel.tabs.forEach(t=>tabIds.push(t.id)),tabIds.length&&Tabs.discardTabs(tabIds)}function onKeyUnloadOtherTabsInPanel(){let ids=Selection.isTabs()?Selection.get():[Tabs.activeId];if(!ids.length)return;let firstTab=Tabs.byId[ids[0]];if(!firstTab)return;let panelOfFirstTab=Sidebar.panelsById[firstTab.panelId];if(!isTabsPanel(panelOfFirstTab))return;let tabIds=[];panelOfFirstTab.pinnedTabs.forEach(t=>!ids.includes(t.id)&&tabIds.push(t.id)),panelOfFirstTab.tabs.forEach(t=>!ids.includes(t.id)&&tabIds.push(t.id)),tabIds.length&&Tabs.discardTabs(tabIds)}function onKeyUnloadFoldedTabsInPanel(){let panel=Sidebar.panelsById[Sidebar.activePanelId];if(!isTabsPanel(panel))return;let tabIds=[];panel.tabs.forEach(t=>t.invisible&&tabIds.push(t.id)),tabIds.length&&Tabs.discardTabs(tabIds)}async function onKeyUnloadAllTabsInInactPanels(){let actTab=Tabs.byId[Tabs.activeId];if(!actTab)return;let actPanelId=Sidebar.activePanelId,actPanel=Sidebar.panelsById[actPanelId];isTabsPanel(actPanel)?actTab.panelId!==actPanelId&&await Tabs.activateLastActiveTabOf(actPanelId):actPanelId=actTab.panelId;let tabIds=[];for(let panel of Sidebar.panels)isTabsPanel(panel)&&panel.id!==actPanelId&&(panel.pinnedTabs.forEach(t=>tabIds.push(t.id)),panel.tabs.forEach(t=>tabIds.push(t.id)));tabIds.length&&Tabs.discardTabs(tabIds)}function onKeyMoveTabsInPanel(place,branch){let ids=Selection.isTabs()?Selection.get():[Tabs.activeId];if(!ids.length)return;Tabs.sortTabIds(ids);let firstTab=Tabs.byId[ids[0]];if(!firstTab||firstTab.pinned)return;let panel=Sidebar.panelsById[firstTab.panelId];if(!isTabsPanel(panel))return;branch&&ids.length===1&&ids.push(...Tabs.getBranch(firstTab,!1).map(t=>t.id));let items=Tabs.getTabsInfo(ids),src={},dst={panelId:panel.id};place==="start"?dst.index=panel.startTabIndex:place==="end"&&(dst.index=panel.nextTabIndex),Tabs.move(items,src,dst)}function onKeyDuplicateTabs(branch){let ids=Selection.isTabs()?Selection.get():[Tabs.activeId];if(!ids.length)return;let firstTab=Tabs.byId[ids[0]];!firstTab||firstTab.pinned||(branch&&ids.length===1&&ids.push(...Tabs.getBranch(firstTab,!1).map(t=>t.id)),Tabs.duplicateTabs(ids))}function onKeyPinTabs(){let ids=Selection.isTabs()?Selection.get():[Tabs.activeId];if(!ids.length)return;let firstTab=Tabs.byId[ids[0]];firstTab&&(firstTab.pinned?Tabs.unpinTabs(ids):Tabs.pinTabs(ids))}function onKeyHidePanel(){let panelId=Selection.getFirst();Sidebar.panelsById[panelId]||(panelId=Sidebar.activePanelId),Sidebar.hidePanel(panelId)}function onKeyGroupTabs(activate){let ids=Selection.isTabs()?Selection.get():[Tabs.activeId];ids.length&&Tabs.groupTabs(ids,{active:activate})}function onKeyFlattenTabs(){let ids=Selection.isTabs()?Selection.get():[Tabs.activeId];ids.length&&Tabs.flattenTabs(ids)}function onKeySelChildTabs(){let tab;if(Selection.isTabs()&&(tab=Tabs.byId[Selection.getFirst()]),tab||(tab=Tabs.byId[Tabs.activeId]),!tab||!tab.isParent)return;Selection.resetSelection(),tab.folded&&Tabs.expTabsBranch(tab.id);let childTabs=Tabs.getBranch(tab,!1);Selection.selectTabs(childTabs.map(t=>t.id))}function setupListeners(){browser.commands.onCommand.addListener(onCmd)}function resetListeners(){browser.commands.onCommand.removeListener(onCmd)}var Keybindings={reactive:{list:[],byName:{}},...keybindings_actions_exports};var reactiveUpgrading={status:null},reactFn;function initUpgrading(reactivate){reactivate&&(reactFn=reactivate,reactiveUpgrading=reactFn(reactiveUpgrading))}function showUpgradingScreen(){reactiveUpgrading.status={messages:[],status:"loading"},pollBgForUpgradeState()}async function pollBgForUpgradeState(){for(;;){await sleep(200);let upgradeState;try{upgradeState=await bg("checkUpgrade")}catch{break}if(!upgradeState||(reactiveUpgrading.status&&(reactiveUpgrading.status.messages=upgradeState.messages,reactiveUpgrading.status.status=upgradeState.status),upgradeState.status!=="loading"))break}}import{defineComponent as _defineComponent4}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref2,toDisplayString as _toDisplayString3,createElementVNode as _createElementVNode4,createVNode as _createVNode,openBlock as _openBlock5,createElementBlock as _createElementBlock5,createCommentVNode as _createCommentVNode3,withModifiers as _withModifiers2,createBlock as _createBlock2,renderList as _renderList2,Fragment as _Fragment2,withCtx as _withCtx,normalizeClass as _normalizeClass}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref3,reactive as reactive5,computed as computed2,nextTick}from"/vendor/vue.runtime.esm-browser.prod.js";import{defineComponent as _defineComponent}from"/vendor/vue.runtime.esm-browser.prod.js";import{createElementVNode as _createElementVNode,openBlock as _openBlock,createElementBlock as _createElementBlock,createCommentVNode as _createCommentVNode,toDisplayString as _toDisplayString,unref as _unref,withModifiers as _withModifiers,renderList as _renderList,Fragment as _Fragment,resolveComponent as _resolveComponent,createBlock as _createBlock}from"/vendor/vue.runtime.esm-browser.prod.js";import{computed}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_1=["id","data-type","data-expanded","data-parent","data-selected","data-open"],_hoisted_2=["title"],_hoisted_3=["data-dnd-id"],_hoisted_4={key:0,class:"fav"},_hoisted_5={key:0},_hoisted_6=_createElementVNode("use",{"xlink:href":"#icon_ff"},null,-1),_hoisted_7=[_hoisted_6],_hoisted_8=["src"],_hoisted_9={key:0},_hoisted_10=_createElementVNode("use",{"xlink:href":"#icon_folder_open"},null,-1),_hoisted_11=[_hoisted_10],_hoisted_12={key:1},_hoisted_13=_createElementVNode("use",{"xlink:href":"#icon_folder"},null,-1),_hoisted_14=[_hoisted_13],_hoisted_15={key:2,class:"title"},_hoisted_16={key:3,class:"len"},_hoisted_17=["title"],__default__={name:"BookmarkNode"},bookmark_node_default=_defineComponent({...__default__,props:{node:{},panelId:{},filter:{type:Function}},setup(__props){let props=__props,favicon=computed(()=>props.node.url?getFavicon(props.node.url):""),tooltip=computed(()=>props.node.title&&props.node.url?`${props.node.title}
---
${props.node.url}`:props.node.url?props.node.url:props.node.title?props.node.title:""),children=computed(()=>{if(props.node.children)return props.filter?props.node.children.filter(props.filter):props.node.children}),expanded=computed(()=>!props.node.children||!props.panelId?!1:!!Bookmarks.reactive.expanded[props.panelId]?.[props.node.id]);async function onMouseDown(e){if(Mouse.setTarget("bookmark",props.node.id),Menu.close(),e.button===0){if(Bookmarks.reactive.popup&&props.node.type==="folder"){props.node.sel?expanded.value?Bookmarks.foldBookmark(props.node.id,props.panelId):Bookmarks.expandBookmark(props.node.id,props.panelId):(Selection.resetSelection(),Selection.selectBookmark(props.node.id)),Bookmarks.reactive.popup.location=props.node.id,Bookmarks.reactive.popup.validate&&Bookmarks.reactive.popup.validate(Bookmarks.reactive.popup);return}if(e.ctrlKey){props.node.sel?(Selection.deselectBookmark(props.node.id),children.value&&children.value.length>0&&(expanded.value?Bookmarks.foldBookmark(props.node.id,props.panelId):Bookmarks.expandBookmark(props.node.id,props.panelId))):Selection.selectBookmark(props.node.id);return}if(e.shiftKey){Selection.isSet()?Selection.selectBookmarksRange(props.node):Selection.selectBookmark(props.node.id);return}}else if(e.button===1){if(e.preventDefault(),Selection.isBookmarks()&&(Selection.resetSelection(),!Search.rawValue))return;if(props.node.type==="bookmark"&&props.node.url){let action=Settings.state.bookmarksMidClickAction;if(action==="open_in_new"){let conf=Bookmarks.getMouseOpeningConf(e.button);await Bookmarks.open([props.node.id],conf.dst,conf.useActiveTab,conf.activateFirstTab),conf.removeBookmark&&Bookmarks.removeBookmarks([props.node.id],{noNotif:!0})}else action==="edit"?Bookmarks.editBookmarkNode(props.node):action==="delete"&&Bookmarks.removeBookmarks([props.node.id])}else if(props.node.type==="folder"){let panelId=Sidebar.getRecentTabsPanelId();await Bookmarks.open([props.node.id],{panelId},!1,!0)}}else e.button===2&&!Settings.state.ctxMenuNative&&!props.node.sel&&!Bookmarks.reactive.popup&&(Selection.resetSelection(),Mouse.startMultiSelection(e,props.node.id))}function onFolderFavMouseDown(e){Bookmarks.reactive.popup&&(e.stopPropagation(),Menu.close(),props.node.sel||(Selection.resetSelection(),Selection.selectBookmark(props.node.id)),expanded.value?Bookmarks.foldBookmark(props.node.id,props.panelId):Bookmarks.expandBookmark(props.node.id,props.panelId),Bookmarks.reactive.popup.location=props.node.id,Bookmarks.reactive.popup.validate&&Bookmarks.reactive.popup.validate(Bookmarks.reactive.popup))}async function onMouseUp(e){let sameTarget=Mouse.isTarget("bookmark",props.node.id);Mouse.resetTarget();let isFolder=props.node.type==="folder";if(e.button===0){if(!sameTarget||Bookmarks.reactive.popup||e.ctrlKey||e.shiftKey)return;if(Search.rawValue&&!isFolder&&(Search.stop(),Selection.resetSelection()),Selection.isBookmarks()&&!Search.rawValue)return Selection.resetSelection();if(Settings.state.pinOpenedBookmarksFolder&&isFolder&&expanded.value){let bookmarkEl=document.getElementById(`bookmark${props.panelId}${props.node.id}`),bookmarkBounds=bookmarkEl?.getBoundingClientRect(),bookmarkBodyBounds=bookmarkEl?.children[0]?.getBoundingClientRect();if(bookmarkBounds&&bookmarkBodyBounds&&bookmarkBounds.top<bookmarkBodyBounds.top){Sidebar.scrollActivePanel(bookmarkBodyBounds.top-bookmarkBounds.top,!0);return}}if(props.node.type==="bookmark"&&props.node.url){let actPanel=Sidebar.panelsById[Sidebar.activePanelId];if(isBookmarksPanel(actPanel)&&actPanel.autoConvert)try{let tabsPanelId=await Sidebar.convertToTabsPanel(actPanel,!1);if(tabsPanelId===NOID)return err("BookmarkNode.onMouseUp: cannot convert panel");let info={id:1,url:props.node.url,title:props.node.title,active:!0};await Tabs.open([info],{panelId:tabsPanelId});return}catch(err2){err("BookmarkNode.onMouseUp: cannot convert panel",err2)}let newTabNeededInActPanel=!1;if(Settings.state.activateOpenBookmarkTab&&props.node.isOpen){let tab;if(isTabsPanel(actPanel)?(tab=Tabs.list.find(t=>t.url===props.node.url&&t.panelId===actPanel.id),newTabNeededInActPanel=!tab):isBookmarksPanel(actPanel)&&(tab=Tabs.list.find(t=>t.url===props.node.url)),tab){browser.tabs.update(tab.id,{active:!0});return}}if(isTabsPanel(actPanel)&&!newTabNeededInActPanel){let actTab=Tabs.byId[Tabs.activeId];if(actTab){let inPanel=Settings.state.pinnedTabsPosition==="panel";newTabNeededInActPanel=actTab.panelId!==actPanel.id||actTab.pinned&&!inPanel}}let conf=Bookmarks.getMouseOpeningConf(e.button),useActiveTab=!newTabNeededInActPanel&&conf.useActiveTab,activateFirstTab=newTabNeededInActPanel||conf.activateFirstTab;Bookmarks.open([props.node.id],conf.dst,useActiveTab,activateFirstTab),conf.removeBookmark&&Bookmarks.removeBookmarks([props.node.id],{noNotif:!0})}else isFolder&&(expanded.value?Bookmarks.foldBookmark(props.node.id,props.panelId):Bookmarks.expandBookmark(props.node.id,props.panelId))}else if(e.button===2){if(e.ctrlKey||e.shiftKey||Bookmarks.reactive.popup)return;Mouse.stopMultiSelection(),Settings.state.ctxMenuNative||(Selection.isSet()||Selection.selectBookmark(props.node.id),Menu.open(2,e.clientX,e.clientY))}}function onCtxMenu(e){if(!Settings.state.ctxMenuNative||e.ctrlKey||e.shiftKey||Bookmarks.reactive.popup){e.stopPropagation(),e.preventDefault();return}!e.ctrlKey&&!e.shiftKey&&!props.node.sel&&Selection.resetSelection();let nativeCtx={context:"bookmark",bookmarkId:props.node.id};browser.menus.overrideContext(nativeCtx),Selection.isBookmarks()||Selection.selectBookmark(props.node.id),Menu.open(2)}function onDragStart(e){Menu.close(),Selection.isSet()||Selection.selectBookmark(props.node.id),Sidebar.updateBounds();let toDrag=[props.node.id],dragItems=[],walker=nodes=>{for(let node of nodes)(node.parentId&&toDrag.includes(node.parentId)||Selection.includes(node.id))&&(toDrag.push(node.id),dragItems.push({id:node.id,url:node.url,title:node.title,parentId:node.parentId})),node.children&&walker(node.children)};walker(Bookmarks.reactive.tree);let dragInfo={type:2,items:dragItems,windowId:Windows.id,incognito:Windows.incognito,panelId:"bookmarks",x:e.clientX,y:e.clientY};if(DnD.start(dragInfo,2),e.dataTransfer){let url=props.node.url??"",dragImgEl=document.getElementById("drag_image");e.dataTransfer.setData("application/x-sidebery-dnd",JSON.stringify(dragInfo)),(Settings.state.dndOutside==="data"?!e.altKey:e.altKey)&&(e.dataTransfer.setData("text/uri-list",url),e.dataTransfer.setData("text/plain",url)),dragImgEl&&e.dataTransfer.setDragImage(dragImgEl,-3,-3),e.dataTransfer.effectAllowed="copyMove"}}return(_ctx,_cache)=>{let _component_BookmarkNode=_resolveComponent("BookmarkNode",!0);return _openBlock(),_createElementBlock("div",{class:"BookmarkNode",id:"bookmark"+_ctx.panelId+_ctx.node.id,"data-type":_ctx.node.type,"data-expanded":expanded.value,"data-parent":!!children.value?.length,"data-selected":_ctx.node.sel,"data-open":_ctx.node.isOpen},[_createElementVNode("div",{class:"body",title:tooltip.value,onMousedown:_withModifiers(onMouseDown,["stop"]),onMouseup:_withModifiers(onMouseUp,["stop"]),onContextmenu:_withModifiers(onCtxMenu,["stop"])},[_createElementVNode("div",{class:"dnd-layer",draggable:"true","data-dnd-type":"bookmark","data-dnd-id":_ctx.node.id,onDragstart:onDragStart},null,40,_hoisted_3),_ctx.node.url?(_openBlock(),_createElementBlock("div",_hoisted_4,[favicon.value?(_openBlock(),_createElementBlock("img",{key:1,src:favicon.value},null,8,_hoisted_8)):(_openBlock(),_createElementBlock("svg",_hoisted_5,_hoisted_7))])):_ctx.node.type==="folder"?(_openBlock(),_createElementBlock("div",{key:1,class:"fav",onMousedown:onFolderFavMouseDown},[expanded.value?(_openBlock(),_createElementBlock("svg",_hoisted_9,_hoisted_11)):(_openBlock(),_createElementBlock("svg",_hoisted_12,_hoisted_14))],32)):_createCommentVNode("v-if",!0),_ctx.node.title||_ctx.node.url?(_openBlock(),_createElementBlock("div",_hoisted_15,_toDisplayString(_ctx.node.title||_ctx.node.url),1)):_createCommentVNode("v-if",!0),_unref(Settings).state.showBookmarkLen&&_ctx.node.len?(_openBlock(),_createElementBlock("div",_hoisted_16,_toDisplayString(_ctx.node.len),1)):_createCommentVNode("v-if",!0)],40,_hoisted_2),expanded.value&&children.value?.length?(_openBlock(),_createElementBlock("div",{key:0,class:"children",title:_ctx.node.title},[(_openBlock(!0),_createElementBlock(_Fragment,null,_renderList(children.value,node=>(_openBlock(),_createBlock(_component_BookmarkNode,{key:node.id,node,filter:props.filter,panelId:_ctx.panelId},null,8,["node","filter","panelId"]))),128))],8,_hoisted_17)):_createCommentVNode("v-if",!0)],8,_hoisted_1)}}});import{defineComponent as _defineComponent2}from"/vendor/vue.runtime.esm-browser.prod.js";import{createElementVNode as _createElementVNode2,renderSlot as _renderSlot,openBlock as _openBlock2,createElementBlock as _createElementBlock2}from"/vendor/vue.runtime.esm-browser.prod.js";import{reactive as reactive3,ref,onMounted,onBeforeUnmount}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_18=["data-show"],_hoisted_22=["data-show"],scroll_box_default=_defineComponent2({__name:"scroll-box",props:{lock:{type:Boolean},preScroll:{}},emits:["bottom"],setup(__props,{expose:__expose,emit:__emit}){let recalcScrollOnResize=null,resizeObserver=null,emit=__emit,props=__props,el=ref(null),scrollBoxEl=ref(null),scrollContentEl=ref(null),state=reactive3({topOverflow:!1,bottomOverflow:!1}),boxHeight=0,contentHeight=0,_preScroll=0;onMounted(()=>{if(props.preScroll&&(_preScroll=props.preScroll),!scrollBoxEl.value||!scrollContentEl.value)throw err("ScrollBox: No DOM elements registered");recalcScrollOnResize=asap(()=>recalcScroll(),180),resizeObserver=new ResizeObserver(recalcScrollOnResize.func),resizeObserver.observe(scrollBoxEl.value),resizeObserver.observe(scrollContentEl.value)}),onBeforeUnmount(()=>{resizeObserver&&resizeObserver.disconnect()});function onWheel(e){contentHeight<=boxHeight&&e.deltaY>0&&emit("bottom"),props.lock&&e.preventDefault()}function recalcScroll(bottomEvent){if(!scrollBoxEl.value||!scrollContentEl.value)return;boxHeight=scrollBoxEl.value.offsetHeight,contentHeight=scrollContentEl.value.offsetHeight;let contentY=scrollBoxEl.value.scrollTop;!state.topOverflow&&contentY>3&&(state.topOverflow=!0),state.topOverflow&&contentY<4&&(state.topOverflow=!1),!state.bottomOverflow&&contentHeight-contentY-_preScroll>boxHeight&&(state.bottomOverflow=!0),state.bottomOverflow&&contentHeight-contentY-_preScroll<=boxHeight&&(state.bottomOverflow=!1,bottomEvent&&emit("bottom"))}function setScrollY(y){scrollBoxEl.value&&(scrollBoxEl.value.scrollTop=y)}function getScrollBox(){return scrollBoxEl.value}function getScrollableBox(){return scrollContentEl.value}return __expose({setScrollY,recalcScroll,getScrollBox,getScrollableBox}),(_ctx,_cache)=>(_openBlock2(),_createElementBlock2("div",{class:"ScrollBox",ref_key:"el",ref:el,onWheel},[_createElementVNode2("div",{class:"top-shadow","data-show":state.topOverflow},null,8,_hoisted_18),_createElementVNode2("div",{class:"bottom-shadow","data-show":state.bottomOverflow},null,8,_hoisted_22),_createElementVNode2("div",{class:"scroll-container",ref_key:"scrollBoxEl",ref:scrollBoxEl,tabindex:"-1",onScrollPassive:_cache[0]||(_cache[0]=$event=>recalcScroll(!0))},[_createElementVNode2("div",{class:"scrollable",ref_key:"scrollContentEl",ref:scrollContentEl},[_renderSlot(_ctx.$slots,"default")],512)],544)],544))}});import{createElementVNode as _createElementVNode3,openBlock as _openBlock3,createElementBlock as _createElementBlock3}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_19={class:"LoadingDots"},_hoisted_23=_createElementVNode3("div",{class:"loading-dots-a"},null,-1),_hoisted_32=_createElementVNode3("div",{class:"loading-dots-b"},null,-1),_hoisted_42=_createElementVNode3("div",{class:"loading-dots-c"},null,-1),_hoisted_52=[_hoisted_23,_hoisted_32,_hoisted_42];function render(_ctx,_cache){return _openBlock3(),_createElementBlock3("div",_hoisted_19,_hoisted_52)}var _C={};_C.render=render;var loading_dots_default=_C;import{defineComponent as _defineComponent3}from"/vendor/vue.runtime.esm-browser.prod.js";import{openBlock as _openBlock4,createElementBlock as _createElementBlock4,createCommentVNode as _createCommentVNode2,toDisplayString as _toDisplayString2}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref2,reactive as reactive4,onMounted as onMounted2}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_110=["data-active","data-empty","data-valid","data-wrong","data-width"],_hoisted_24=["type","tabindex","value"],_hoisted_33=["tabindex","value"],_hoisted_43={key:2,class:"placeholder"},text_input_default=_defineComponent3({__name:"text-input",props:{value:{},valid:{type:[String,Boolean]},padding:{default:0},or:{},filter:{},line:{type:Boolean},tabindex:{default:"0"},password:{type:Boolean},width:{}},emits:["update:value","focus","blur","change","keydown"],setup(__props,{expose:__expose,emit:__emit}){let emit=__emit,props=__props,textEl=ref2(null),state=reactive4({isActive:!1,wrongValueAnimation:!1});onMounted2(()=>{recalcTextHeight()});function onFocus(){state.isActive=!0,emit("focus",textEl?.value)}function onBlur(){state.isActive=!1,textEl.value&&emit("blur",textEl.value)}function onInput(e){let value=e.target.value;if(props.filter){if(value=props.filter(e),value===void 0)return;e.target.value=value}recalcTextHeight(),emit("update:value",value)}function onChange(){textEl.value&&emit("change",textEl.value)}function onKD(e){emit("keydown",e)}function onAnimationEnd(){state.wrongValueAnimation=!1}function recalcTextHeight(){!textEl.value||props.line||(textEl.value.style.height="0",textEl.value.style.height=`${textEl.value.scrollHeight-props.padding}px`)}function focus(){textEl.value&&textEl.value.focus({preventScroll:!0})}function selectAll(){textEl.value&&textEl.value.select()}function error(){state.wrongValueAnimation=!0}return __expose({focus,error,recalcTextHeight,selectAll}),(_ctx,_cache)=>(_openBlock4(),_createElementBlock4("div",{class:"TextInput","data-active":state.isActive,"data-empty":!props.value,"data-valid":props.valid,"data-wrong":state.wrongValueAnimation,"data-width":props.width,onAnimationend:onAnimationEnd},[props.line?(_openBlock4(),_createElementBlock4("input",{key:0,ref_key:"textEl",ref:textEl,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",type:props.password?"password":"text",tabindex:props.tabindex,value:props.value,onInput,onFocus,onBlur,onChange,onKeydown:onKD},null,40,_hoisted_24)):(_openBlock4(),_createElementBlock4("textarea",{key:1,ref_key:"textEl",ref:textEl,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",tabindex:props.tabindex,value:props.value,onInput,onFocus,onBlur,onChange,onKeydown:onKD},null,40,_hoisted_33)),props.or?(_openBlock4(),_createElementBlock4("div",_hoisted_43,_toDisplayString2(props.or),1)):_createCommentVNode2("v-if",!0)],40,_hoisted_110))}});var _hoisted_111={key:0,class:"popup"},_hoisted_25={key:0,class:"field"},_hoisted_34={class:"field-label"},_hoisted_44={key:1,class:"field"},_hoisted_53=_createElementVNode4("div",{class:"field-label"},"URL",-1),_hoisted_62=["title"],_hoisted_72={class:"field-label"},_hoisted_82={class:"location-body"},_hoisted_92={class:"location-value"},_hoisted_102=_createElementVNode4("svg",null,[_createElementVNode4("use",{"xlink:href":"#icon_new_folder"})],-1),_hoisted_112=[_hoisted_102],_hoisted_122={key:0,class:"new-folder-field"},_hoisted_132={key:0,"xlink:href":"#icon_new_folder"},_hoisted_142={key:1,"xlink:href":"#icon_x"},_hoisted_152={key:3,class:"tree"},_hoisted_162={key:4,class:"recent-locations"},_hoisted_172={class:"field-label"},_hoisted_182=["data-sel","onClick"],_hoisted_192=_createElementVNode4("svg",{class:"folder-icon"},[_createElementVNode4("use",{"xlink:href":"#icon_folder"})],-1),_hoisted_20={class:"folder-label"},_hoisted_21={key:5,class:"loading-screen"},_hoisted_222={class:"ctrls"},RECENT_FOLDERS_LIMIT=5,popup_bookmarks_default=_defineComponent4({__name:"popup.bookmarks",setup(__props){let nameInput=ref3(null),urlInput=ref3(null),newFolderTitleInput=ref3(null),state=reactive5({loading:!0,wrongValueAnimation:!1,showTree:!1,tabindex:"-1",type:"bookmark",title:"",url:"",newFolderTitle:"",newFolderMode:!1,creatingNewFolder:!1,path:[],bookmarksRecentFolders:[]}),validateTimeout,selectedFolder=computed2(()=>{let location=Bookmarks.reactive.popup?.location??NOID;if(location===NOID)return"---";let folder=Bookmarks.reactive.byId[location];return!folder||folder.type!=="folder"?"---":folder.title}),path=computed2(()=>{let location=Bookmarks.reactive.popup?.location??NOID;if(!Bookmarks.reactive.tree.length||location===NOID)return"";let folder=Bookmarks.reactive.byId[location];if(!folder||folder.type!=="folder")return"";let result=folder.title+" /";for(;Bookmarks.reactive.byId[folder.parentId];)folder=Bookmarks.reactive.byId[folder.parentId],result=folder.title+" / "+result;return result.trim()}),titlePlaceholder=computed2(()=>state.type==="bookmark"?"bookmarks_editor.name_bookmark_placeholder":"bookmarks_editor.name_folder_placeholder");(async function(){if(!Bookmarks.reactive.popup)return;state.showTree=!!Bookmarks.reactive.popup.locationTree,state.tabindex="0",nextTick(()=>{nameInput.value&&nameInput.value.recalcTextHeight(),urlInput.value&&urlInput.value.recalcTextHeight()}),setTimeout(()=>{let popup=Bookmarks.reactive.popup;if(popup&&(nameInput.value&&nameInput.value.focus(),popup.locationField&&popup.location&&popup.location!==NOID&&(Selection.selectBookmark(popup.location),state.showTree))){Bookmarks.collapseAllBookmarks("popup");let folder=Bookmarks.reactive.byId[popup.location];folder?.parentId&&folder.parentId!==BKM_ROOT_ID&&Bookmarks.expandBookmark(folder.parentId,"popup")}},256);let asyncTasks=[];Bookmarks.reactive.tree.length||asyncTasks.push(Bookmarks.load()),Bookmarks.reactive.popup.recentLocations&&asyncTasks.push(loadBookmarksRecentFolders()),await Promise.all(asyncTasks),checkDefaultLocation(),initRecentFolders(),state.loading=!1,validate()})();function checkDefaultLocation(){if(!Bookmarks.reactive.popup)return;let id=Bookmarks.reactive.popup.location;if(id===void 0||id===NOID||id===BKM_ROOT_ID)return;Bookmarks.reactive.byId[id]||(Bookmarks.reactive.popup.location=BKM_OTHER_ID)}let loadedRecentFolders;async function loadBookmarksRecentFolders(){let stored=await browser.storage.local.get("bookmarksRecentFolders");!stored.bookmarksRecentFolders||!stored.bookmarksRecentFolders.length||(loadedRecentFolders=stored.bookmarksRecentFolders)}function initRecentFolders(){if(!loadedRecentFolders)return;let firstFolderId,folders=[];for(let id of loadedRecentFolders){let folder=Bookmarks.reactive.byId[id];folder&&(folders.push(folder),firstFolderId||(firstFolderId=id))}state.bookmarksRecentFolders=folders;let popup=Bookmarks.reactive.popup;popup&&popup.recentLocationAsDefault&&firstFolderId!==void 0&&(popup.location=firstFolderId)}async function saveBookmarksRecentFolders(lastFolderId){if(!Bookmarks.reactive.byId[lastFolderId])return;let recentIndex=state.bookmarksRecentFolders.findIndex(f=>f.id===lastFolderId);recentIndex!==-1&&state.bookmarksRecentFolders.splice(recentIndex,1);let ids=[lastFolderId],limit=RECENT_FOLDERS_LIMIT-1;for(let i=0;i<limit;i++){let folder=state.bookmarksRecentFolders[i];if(!folder)break;ids.push(folder.id)}await Store.set({bookmarksRecentFolders:ids})}function toggleTree(){if(Bookmarks.reactive.popup?.location)if(state.showTree=!state.showTree,state.showTree){Bookmarks.collapseAllBookmarks("popup");let folder=Bookmarks.reactive.byId[Bookmarks.reactive.popup.location];folder?.parentId&&folder.parentId!==BKM_ROOT_ID&&(Bookmarks.expandBookmark(folder.parentId,"popup"),Selection.selectBookmark(folder.id))}else Selection.resetSelection(),delete Bookmarks.reactive.expanded.popup}async function onNewFolderClick(e){if(!state.newFolderMode){state.newFolderMode=!0,await nextTick(),newFolderTitleInput.value&&newFolderTitleInput.value.focus();return}state.newFolderTitle?await createNewFolder():state.newFolderMode=!1}async function createNewFolder(){if(!Bookmarks.reactive.popup)return;state.creatingNewFolder=!0;let location=Bookmarks.reactive.popup.location??NOID,parent=Bookmarks.reactive.byId[location];if(!parent||parent.type!=="folder")return;let newFolderPosition=Bookmarks.reactive.popup.newFolderPosition,newFolderIndex;newFolderPosition&&newFolderPosition[0]===parent.id?newFolderIndex=newFolderPosition[1]:newFolderIndex=parent.children?.length??0;let folder=await browser.bookmarks.create({index:newFolderIndex,parentId:parent.id,title:state.newFolderTitle.trim(),type:"folder"});if(!folder){state.creatingNewFolder=!1;return}await sleep(750),Bookmarks.reactive.popup.location=folder.id,state.showTree&&(Selection.resetSelection(),Selection.selectBookmark(folder.id)),state.newFolderMode=!1,state.newFolderTitle="",state.creatingNewFolder=!1}function onNewFolderKD(e){e.key==="Escape"&&(state.newFolderMode=!1,state.newFolderTitle=""),e.key==="Enter"&&(state.newFolderTitle?createNewFolder():state.newFolderMode=!1)}function onTitleKD(e){e.key==="Escape"&&onCancel(),e.key==="Enter"&&(e.preventDefault(),onOk())}function onUrlKD(e){e.key==="Escape"&&onCancel(),e.key==="Enter"&&(e.preventDefault(),onOk())}function validate(){clearTimeout(validateTimeout),validateTimeout=setTimeout(()=>{Bookmarks.reactive.popup?.validate&&Bookmarks.reactive.popup.validate(Bookmarks.reactive.popup)},200)}function onOk(){if(Bookmarks.reactive.popup){if(!Bookmarks.reactive.popup.nameValid&&nameInput.value){nameInput.value.error();return}if(!Bookmarks.reactive.popup.urlValid&&urlInput.value){urlInput.value.error();return}Bookmarks.reactive.popup.location&&Bookmarks.reactive.popup.recentLocations&&saveBookmarksRecentFolders(Bookmarks.reactive.popup.location),state.tabindex="-1",Selection.resetSelection(),state.showTree&&delete Bookmarks.reactive.expanded.popup,Bookmarks.reactive.popup.close({name:Bookmarks.reactive.popup.name,url:Bookmarks.reactive.popup.url,location:Bookmarks.reactive.popup.location,controlIndex:0})}}function onCancel(){Bookmarks.reactive.popup&&(state.tabindex="-1",Selection.resetSelection(),state.showTree&&delete Bookmarks.reactive.expanded.popup,Bookmarks.reactive.popup.close())}function foldersFilter(node){return node.type==="folder"}function onRecentFolderClick(folder){Bookmarks.reactive.popup&&(Bookmarks.reactive.popup.location=folder.id)}return(_ctx,_cache)=>(_openBlock5(),_createElementBlock5("div",{class:"BookmarksPopup popup-container",onMousedown:_withModifiers2(onCancel,["stop","self"]),onMouseup:_cache[7]||(_cache[7]=_withModifiers2(()=>{},["stop"]))},[_unref2(Bookmarks).reactive.popup?(_openBlock5(),_createElementBlock5("div",_hoisted_111,[_createElementVNode4("h2",null,_toDisplayString3(_unref2(Bookmarks).reactive.popup.title),1),_unref2(Bookmarks).reactive.popup.nameField?(_openBlock5(),_createElementBlock5("div",_hoisted_25,[_createElementVNode4("div",_hoisted_34,_toDisplayString3(_unref2(translate)("popup.bookmarks.name_label")),1),_createVNode(text_input_default,{class:"input",ref_key:"nameInput",ref:nameInput,value:_unref2(Bookmarks).reactive.popup.name,"onUpdate:value":[_cache[0]||(_cache[0]=$event=>_unref2(Bookmarks).reactive.popup.name=$event),_cache[1]||(_cache[1]=$event=>validate())],or:_unref2(translate)(titlePlaceholder.value),tabindex:state.tabindex,line:!0,onKeydown:onTitleKD},null,8,["value","or","tabindex"])])):_createCommentVNode3("v-if",!0),_unref2(Bookmarks).reactive.popup.urlField?(_openBlock5(),_createElementBlock5("div",_hoisted_44,[_hoisted_53,_createVNode(text_input_default,{class:"input",ref_key:"urlInput",ref:urlInput,value:_unref2(Bookmarks).reactive.popup.url,"onUpdate:value":[_cache[2]||(_cache[2]=$event=>_unref2(Bookmarks).reactive.popup.url=$event),_cache[3]||(_cache[3]=$event=>validate())],or:_unref2(translate)("bookmarks_editor.url_placeholder"),tabindex:state.tabindex,line:!0,onKeydown:onUrlKD},null,8,["value","or","tabindex"])])):_createCommentVNode3("v-if",!0),_unref2(Bookmarks).reactive.popup.locationField?(_openBlock5(),_createElementBlock5("div",{key:2,class:"location",title:path.value,onClick:_cache[6]||(_cache[6]=$event=>toggleTree())},[_createElementVNode4("div",_hoisted_72,_toDisplayString3(_unref2(translate)("popup.bookmarks.location_label")),1),_createElementVNode4("div",_hoisted_82,[_createElementVNode4("div",_hoisted_92,_toDisplayString3(selectedFolder.value),1),state.newFolderMode?_createCommentVNode3("v-if",!0):(_openBlock5(),_createElementBlock5("div",{key:0,class:"new-folder-btn",onClick:_withModifiers2(onNewFolderClick,["stop"])},_hoisted_112))]),state.newFolderMode?(_openBlock5(),_createElementBlock5("div",_hoisted_122,[state.creatingNewFolder?(_openBlock5(),_createBlock2(loading_dots_default,{key:0})):_createCommentVNode3("v-if",!0),state.creatingNewFolder?_createCommentVNode3("v-if",!0):(_openBlock5(),_createBlock2(text_input_default,{key:1,class:"new-folder-input",ref_key:"newFolderTitleInput",ref:newFolderTitleInput,value:state.newFolderTitle,"onUpdate:value":_cache[4]||(_cache[4]=$event=>state.newFolderTitle=$event),or:_unref2(translate)("popup.bookmarks.location_new_folder_placeholder"),line:!0,onClick:_cache[5]||(_cache[5]=_withModifiers2(()=>{},["stop"])),onKeydown:onNewFolderKD},null,8,["value","or"])),state.creatingNewFolder?_createCommentVNode3("v-if",!0):(_openBlock5(),_createElementBlock5("div",{key:2,class:"new-folder-btn",onClick:_withModifiers2(onNewFolderClick,["stop"])},[(_openBlock5(),_createElementBlock5("svg",null,[state.newFolderTitle?(_openBlock5(),_createElementBlock5("use",_hoisted_132)):(_openBlock5(),_createElementBlock5("use",_hoisted_142))]))]))])):_createCommentVNode3("v-if",!0)],8,_hoisted_62)):_createCommentVNode3("v-if",!0),state.showTree?(_openBlock5(),_createElementBlock5("div",_hoisted_152,[_createVNode(scroll_box_default,null,{default:_withCtx(()=>[(_openBlock5(!0),_createElementBlock5(_Fragment2,null,_renderList2(_unref2(Bookmarks).reactive.tree,node=>(_openBlock5(),_createBlock2(bookmark_node_default,{class:"root-node",key:node.id,node,filter:foldersFilter,panelId:"popup"},null,8,["node"]))),128))]),_:1})])):_createCommentVNode3("v-if",!0),state.bookmarksRecentFolders.length&&!state.showTree?(_openBlock5(),_createElementBlock5("div",_hoisted_162,[_createElementVNode4("div",_hoisted_172,_toDisplayString3(_unref2(translate)("popup.bookmarks.recent_locations_label")),1),(_openBlock5(!0),_createElementBlock5(_Fragment2,null,_renderList2(state.bookmarksRecentFolders,folder=>(_openBlock5(),_createElementBlock5("div",{class:"recent-folder",key:folder.id,"data-sel":folder.id===_unref2(Bookmarks).reactive.popup.location,onClick:$event=>onRecentFolderClick(folder)},[_hoisted_192,_createElementVNode4("div",_hoisted_20,_toDisplayString3(folder.title),1)],8,_hoisted_182))),128))])):_createCommentVNode3("v-if",!0),state.loading?(_openBlock5(),_createElementBlock5("div",_hoisted_21,[_createVNode(loading_dots_default)])):_createCommentVNode3("v-if",!0),_createElementVNode4("div",_hoisted_222,[(_openBlock5(!0),_createElementBlock5(_Fragment2,null,_renderList2(_unref2(Bookmarks).reactive.popup.controls,ctrl=>(_openBlock5(),_createElementBlock5("div",{class:_normalizeClass(["btn",{"-inactive":ctrl.inactive}]),onClick:onOk},_toDisplayString3(_unref2(translate)(ctrl.label)),3))),256)),_createElementVNode4("div",{class:"btn -warn",onClick:onCancel},_toDisplayString3(_unref2(translate)("btn.cancel")),1)])])):_createCommentVNode3("v-if",!0)],32))}});import{defineComponent as _defineComponent7}from"/vendor/vue.runtime.esm-browser.prod.js";import{withModifiers as _withModifiers3,openBlock as _openBlock8,createElementBlock as _createElementBlock8,createCommentVNode as _createCommentVNode5,toDisplayString as _toDisplayString6,createElementVNode as _createElementVNode7,createBlock as _createBlock3,renderList as _renderList3,Fragment as _Fragment3,normalizeClass as _normalizeClass2}from"/vendor/vue.runtime.esm-browser.prod.js";import{onMounted as onMounted3,ref as ref4}from"/vendor/vue.runtime.esm-browser.prod.js";import{defineComponent as _defineComponent6}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref4,toDisplayString as _toDisplayString5,normalizeStyle as _normalizeStyle,createElementVNode as _createElementVNode6,createVNode as _createVNode2,openBlock as _openBlock7,createElementBlock as _createElementBlock7,createCommentVNode as _createCommentVNode4,renderSlot as _renderSlot2}from"/vendor/vue.runtime.esm-browser.prod.js";import{defineComponent as _defineComponent5}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref3,toDisplayString as _toDisplayString4,createElementVNode as _createElementVNode5,openBlock as _openBlock6,createElementBlock as _createElementBlock6}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_113=["data-active"],_hoisted_26={class:"opt -true"},_hoisted_35={class:"opt -false"},toggle_input_default=_defineComponent5({__name:"toggle-input",props:{value:{type:[Boolean,null]}},emits:["update:value"],setup(__props,{emit:__emit}){let emit=__emit,props=__props;function toggle(){emit("update:value",!props.value)}return(_ctx,_cache)=>(_openBlock6(),_createElementBlock6("div",{class:"ToggleInput","data-active":props.value,onClick:toggle},[_createElementVNode5("div",_hoisted_26,[_createElementVNode5("p",null,_toDisplayString4(_unref3(translate)("settings.opt_true")),1)]),_createElementVNode5("div",_hoisted_35,[_createElementVNode5("p",null,_toDisplayString4(_unref3(translate)("settings.opt_false")),1)])],8,_hoisted_113))}});var _hoisted_114=["data-inactive"],_hoisted_27={class:"body"},_hoisted_36={key:0,class:"note"},toggle_field_default=_defineComponent6({__name:"toggle-field",props:{value:{type:[Boolean,null]},label:{},inactive:{type:Boolean},field:{type:Boolean},color:{},note:{}},emits:["toggle","update:value"],setup(__props,{emit:__emit}){let emit=__emit,props=__props;function toggle(){props.inactive||(emit("update:value",!props.value),emit("toggle",!props.value))}return(_ctx,_cache)=>(_openBlock7(),_createElementBlock7("div",{class:"ToggleField","data-inactive":props.inactive,onClick:toggle},[_createElementVNode6("div",_hoisted_27,[_createElementVNode6("div",{class:"label",style:_normalizeStyle({color:props.color})},_toDisplayString5(_unref4(translate)(props.label)),5),_createVNode2(toggle_input_default,{class:"input",value:props.value},null,8,["value"])]),props.note?(_openBlock7(),_createElementBlock7("div",_hoisted_36,_toDisplayString5(props.note),1)):_createCommentVNode4("v-if",!0),_renderSlot2(_ctx.$slots,"default")],8,_hoisted_114))}});var _hoisted_115={key:0,class:"note"},_hoisted_28=["data-centered","data-inline"],_hoisted_37=["onClick"],popup_dialog_default=_defineComponent7({__name:"popup.dialog",props:{dialog:{}},setup(__props){let props=__props,focusedBtnIndex=ref4(-1),prevFocusedBtnIndex=-1,focusStealer=ref4(null);onMounted3(()=>{document.hasFocus()&&focusStealer.value&&focusStealer.value.focus()});function initFocusedBtn(){if(document.hasFocus()&&props.dialog.buttonsDefaultFocus!==void 0)if(prevFocusedBtnIndex===-1){let defaultValue=props.dialog.buttonsDefaultFocus,index=props.dialog.buttons.findIndex(b=>b.value===defaultValue);index!==-1&&(focusedBtnIndex.value=index)}else focusedBtnIndex.value=prevFocusedBtnIndex}function onKBKey(e){if(e.code==="ArrowRight"||e.code==="Tab"&&!e.shiftKey||e.code==="KeyL"){let index=focusedBtnIndex.value;if(!props.dialog.buttons[index])return;props.dialog.buttons[index+1]&&(focusedBtnIndex.value=index+1)}else if(e.code==="ArrowLeft"||e.code==="Tab"&&e.shiftKey||e.code==="KeyH"){let index=focusedBtnIndex.value;if(!props.dialog.buttons[index])return;props.dialog.buttons[index-1]&&(focusedBtnIndex.value=index-1)}else if(e.code==="Enter"){let index=focusedBtnIndex.value,btn=props.dialog.buttons[index];if(!btn)return;answer(btn.value)}}function onFocus(){initFocusedBtn()}function onBlur(){prevFocusedBtnIndex=focusedBtnIndex.value,focusedBtnIndex.value=-1}function answer(value){props.dialog&&props.dialog.result(value)}return(_ctx,_cache)=>(_openBlock8(),_createElementBlock8("div",{class:"Dialog popup-container",onClick:_cache[2]||(_cache[2]=$event=>answer(null))},[_ctx.dialog.buttonsDefaultFocus?(_openBlock8(),_createElementBlock8("div",{key:0,class:"focus-stealer",tabindex:"0",ref_key:"focusStealer",ref:focusStealer,onKeydown:_withModifiers3(onKBKey,["prevent","stop"]),onFocus,onBlur},null,544)):_createCommentVNode5("v-if",!0),_createElementVNode7("div",{class:"popup",onClick:_cache[1]||(_cache[1]=_withModifiers3(()=>{},["stop"]))},[_createElementVNode7("h2",null,_toDisplayString6(_ctx.dialog.title),1),_ctx.dialog.note?(_openBlock8(),_createElementBlock8("div",_hoisted_115,_toDisplayString6(_ctx.dialog.note),1)):_createCommentVNode5("v-if",!0),_ctx.dialog.checkbox?(_openBlock8(),_createBlock3(toggle_field_default,{key:1,label:_ctx.dialog.checkbox.label,value:_ctx.dialog.checkbox.value,"onUpdate:value":[_cache[0]||(_cache[0]=$event=>_ctx.dialog.checkbox.value=$event),_ctx.dialog.checkbox?.update]},null,8,["label","value","onUpdate:value"])):_createCommentVNode5("v-if",!0),_createElementVNode7("div",{class:"ctrls","data-centered":_ctx.dialog.buttonsCentered,"data-inline":_ctx.dialog.buttonsInline},[(_openBlock8(!0),_createElementBlock8(_Fragment3,null,_renderList3(_ctx.dialog.buttons,(btn,i)=>(_openBlock8(),_createElementBlock8("div",{class:_normalizeClass2(["btn -wrap",{"-warn":btn.warn,"-wide":!_ctx.dialog.buttonsInline,"-focused":focusedBtnIndex.value===i}]),onClick:$event=>answer(btn.value)},_toDisplayString6(btn.label),11,_hoisted_37))),256))],8,_hoisted_28)])]))}});import{defineComponent as _defineComponent11}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref8,toDisplayString as _toDisplayString10,openBlock as _openBlock12,createElementBlock as _createElementBlock12,createCommentVNode as _createCommentVNode9,renderList as _renderList5,Fragment as _Fragment5,createElementVNode as _createElementVNode11,withModifiers as _withModifiers6,createVNode as _createVNode5,normalizeClass as _normalizeClass3}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref8,computed as computed4}from"/vendor/vue.runtime.esm-browser.prod.js";import{defineComponent as _defineComponent8}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref5,toDisplayString as _toDisplayString7,createElementVNode as _createElementVNode8,createVNode as _createVNode3,openBlock as _openBlock9,createElementBlock as _createElementBlock9,createCommentVNode as _createCommentVNode6}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref5}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_116=["data-inactive"],_hoisted_29={class:"body"},_hoisted_38={class:"label"},_hoisted_45={key:0,class:"note"},text_field_default=_defineComponent8({__name:"text-field",props:{value:{},valid:{type:[String,Boolean]},padding:{default:0},or:{},filter:{},line:{type:Boolean},tabindex:{default:"0"},password:{type:Boolean},label:{},inactive:{type:Boolean},note:{},inputWidth:{}},emits:["update:value","keydown"],setup(__props,{expose:__expose,emit:__emit}){let emit=__emit,props=__props,inputEl=ref5(null);function focus(){inputEl.value?.focus()}function error(){inputEl.value?.error()}function recalcTextHeight(){inputEl.value?.recalcTextHeight()}function selectAll(){inputEl.value?.selectAll()}return __expose({focus,error,recalcTextHeight,selectAll}),(_ctx,_cache)=>(_openBlock9(),_createElementBlock9("div",{class:"TextField","data-inactive":props.inactive,onClick:focus},[_createElementVNode8("div",_hoisted_29,[_createElementVNode8("div",_hoisted_38,_toDisplayString7(_unref5(translate)(props.label)),1),_createVNode3(text_input_default,{ref_key:"inputEl",ref:inputEl,value:props.value,padding:props.padding,or:props.or,filter:props.filter,line:props.line,tabindex:props.tabindex,password:props.password,valid:props.valid,width:props.inputWidth,"onUpdate:value":_cache[0]||(_cache[0]=$event=>emit("update:value",$event)),onKeydown:_cache[1]||(_cache[1]=$event=>emit("keydown",$event))},null,8,["value","padding","or","filter","line","tabindex","password","valid","width"])]),props.note?(_openBlock9(),_createElementBlock9("div",_hoisted_45,_toDisplayString7(props.note),1)):_createCommentVNode6("v-if",!0)],8,_hoisted_116))}});import{defineComponent as _defineComponent10}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref7,toDisplayString as _toDisplayString9,createElementVNode as _createElementVNode10,createVNode as _createVNode4,openBlock as _openBlock11,createElementBlock as _createElementBlock11,createCommentVNode as _createCommentVNode8,withModifiers as _withModifiers5}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref7}from"/vendor/vue.runtime.esm-browser.prod.js";import{defineComponent as _defineComponent9}from"/vendor/vue.runtime.esm-browser.prod.js";import{createElementVNode as _createElementVNode9,openBlock as _openBlock10,createElementBlock as _createElementBlock10,createCommentVNode as _createCommentVNode7,unref as _unref6,toDisplayString as _toDisplayString8,renderList as _renderList4,Fragment as _Fragment4,withModifiers as _withModifiers4,normalizeStyle as _normalizeStyle2,Teleport as _Teleport,createBlock as _createBlock4}from"/vendor/vue.runtime.esm-browser.prod.js";import{computed as computed3,ref as ref6,reactive as reactive6,onMounted as onMounted4,nextTick as nextTick2}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_117=["data-color","data-folded"],_hoisted_210=["title","data-none","data-color"],_hoisted_39={key:0},_hoisted_46=["xlink:href"],_hoisted_54=["src"],_hoisted_63={key:2},_hoisted_73={key:3},_hoisted_83={key:0,class:"opt -exp"},_hoisted_93=_createElementVNode9("svg",null,[_createElementVNode9("use",{"xlink:href":"#icon_expand"})],-1),_hoisted_103=[_hoisted_93],_hoisted_118=["title","data-none","data-color","data-active","onMousedown"],_hoisted_123={key:0},_hoisted_133=["xlink:href"],_hoisted_143=["src"],_hoisted_153={key:2},_hoisted_163={key:3},_hoisted_173=["title","data-none","data-color","data-active","onMousedown"],_hoisted_183={key:0},_hoisted_193=["xlink:href"],_hoisted_202=["src"],_hoisted_212={key:2},select_input_default=_defineComponent9({__name:"select-input",props:{value:{},opts:{},label:{},plurNum:{},color:{},icon:{},noneOpt:{default:"none"},folded:{type:Boolean}},emits:["update:value"],setup(__props,{expose:__expose,emit:__emit}){let rootEl=ref6(null),dropDownEl=ref6(null),disabledDropDownTeleport=ref6(!0),isOpen=ref6(!1),emit=__emit,props=__props,dropDownStyle=reactive6({"--left":"0px","--top":"0px"}),activeOpt=computed3(()=>props.folded?props.opts.find(isActive)??props.noneOpt:props.noneOpt),inactiveOpts=computed3(()=>props.folded?props.opts.filter(opt=>!isActive(opt)):[]);onMounted4(()=>{setupDropDownTeleport()});function setupDropDownTeleport(){disabledDropDownTeleport.value=!1}function getOptColor(opt){return opt.color}function getOptIcon(opt){return opt.icon}function isActive(opt){if(Array.isArray(props.value)){let val=opt instanceof Object?opt.value:opt;return props.value.includes(val)}else return opt instanceof Object?opt.value===props.value:props.value===opt}function select(option){if(Array.isArray(props.value)){let val=option instanceof Object?option.value:option,index=props.value.indexOf(val);index===-1?props.value.push(val):props.value.splice(index,1),emit("update:value",props.value)}else option instanceof Object?emit("update:value",option.value):emit("update:value",option)}function getTooltip(option){if(option){if(typeof option=="object"){if(option.tooltip)return option.tooltip;if(option.title)return option.title}else if(props.label)return translate(`${props.label}${option}`,props.plurNum)}return""}function onWheel(e){if(!dropDownEl.value)return;let scrollOffset=dropDownEl.value.scrollTop,maxScrollOffset=dropDownEl.value.scrollHeight-dropDownEl.value.offsetHeight;scrollOffset===0&&e.deltaY<0&&e.preventDefault(),scrollOffset===maxScrollOffset&&e.deltaY>0&&e.preventDefault()}async function open(){if(!rootEl.value)return;isOpen.value=!0;let elStyles=window.getComputedStyle(rootEl.value,null),bottomPadding=parseInt(elStyles.getPropertyValue("padding-bottom"));if(isNaN(bottomPadding)&&(bottomPadding=0),await nextTick2(),!dropDownEl.value)return;let inputRect=rootEl.value.getBoundingClientRect(),dropDownRect=dropDownEl.value.getBoundingClientRect(),viewportHeight=window.innerHeight,viewportWidth=window.innerWidth,inputBottom=Math.round(inputRect.bottom),inputRight=Math.round(inputRect.right),dropDownTop=inputBottom-bottomPadding+1;if(viewportHeight<=dropDownTop+dropDownRect.height+bottomPadding&&(dropDownTop=viewportHeight-dropDownRect.height-bottomPadding),viewportWidth<dropDownRect.width+(viewportWidth-inputRight)){let inputWidth=Math.round(inputRect.width);dropDownStyle["--max-width"]=`${inputWidth}px`,dropDownRect.width=inputWidth}dropDownStyle["--top"]=`${dropDownTop}px`,dropDownStyle["--left"]=`${inputRight-dropDownRect.width}px`}function close(){isOpen.value=!1}return __expose({open,close}),(_ctx,_cache)=>(_openBlock10(),_createElementBlock10("div",{class:"SelectInput",ref_key:"rootEl",ref:rootEl,"data-color":props.color,"data-folded":_ctx.folded},[_ctx.folded&&activeOpt.value?(_openBlock10(),_createElementBlock10(_Fragment4,{key:0},[_createElementVNode9("div",{class:"opt",title:getTooltip(activeOpt.value),"data-none":(activeOpt.value.value??activeOpt.value)===props.noneOpt,"data-color":getOptColor(activeOpt.value)??!1,"data-active":"true"},[(activeOpt.value.icon||props.icon)?.startsWith("#")?(_openBlock10(),_createElementBlock10("svg",_hoisted_39,[_createElementVNode9("use",{"xlink:href":activeOpt.value.icon||props.icon},null,8,_hoisted_46)])):activeOpt.value.icon||props.icon?(_openBlock10(),_createElementBlock10("img",{key:1,src:activeOpt.value.icon||props.icon},null,8,_hoisted_54)):props.label?(_openBlock10(),_createElementBlock10("p",_hoisted_63,_toDisplayString8(_unref6(translate)(props.label+activeOpt.value,props.plurNum)),1)):_createCommentVNode7("v-if",!0),activeOpt.value.title?(_openBlock10(),_createElementBlock10("p",_hoisted_73,_toDisplayString8(activeOpt.value.title),1)):_createCommentVNode7("v-if",!0)],8,_hoisted_210),_ctx.folded?(_openBlock10(),_createElementBlock10("div",_hoisted_83,_hoisted_103)):_createCommentVNode7("v-if",!0),_ctx.folded&&!disabledDropDownTeleport.value?(_openBlock10(),_createBlock4(_Teleport,{key:1,to:"#root"},[isOpen.value?(_openBlock10(),_createElementBlock10("div",{key:0,class:"select-input-drop-down-layer",onWheel},[_createElementVNode9("div",{class:"select-input-drop-down",style:_normalizeStyle2(dropDownStyle)},[_createElementVNode9("div",{class:"select-input-drop-down-content",ref_key:"dropDownEl",ref:dropDownEl},[(_openBlock10(!0),_createElementBlock10(_Fragment4,null,_renderList4(inactiveOpts.value,opt=>(_openBlock10(),_createElementBlock10("div",{class:"opt",title:getTooltip(opt),"data-none":(opt.value??opt)===props.noneOpt,"data-color":getOptColor(opt)??!1,"data-active":isActive(opt),onMousedown:_withModifiers4($event=>select(opt),["stop"])},[(opt.icon||props.icon)?.startsWith("#")?(_openBlock10(),_createElementBlock10("svg",_hoisted_123,[_createElementVNode9("use",{"xlink:href":opt.icon||props.icon},null,8,_hoisted_133)])):opt.icon||props.icon?(_openBlock10(),_createElementBlock10("img",{key:1,src:opt.icon||props.icon},null,8,_hoisted_143)):props.label?(_openBlock10(),_createElementBlock10("p",_hoisted_153,_toDisplayString8(_unref6(translate)(props.label+opt,props.plurNum)),1)):_createCommentVNode7("v-if",!0),opt.title?(_openBlock10(),_createElementBlock10("p",_hoisted_163,_toDisplayString8(opt.title),1)):_createCommentVNode7("v-if",!0)],40,_hoisted_118))),256))],512)],4)],32)):_createCommentVNode7("v-if",!0)])):_createCommentVNode7("v-if",!0)],64)):(_openBlock10(!0),_createElementBlock10(_Fragment4,{key:1},_renderList4(props.opts,opt=>(_openBlock10(),_createElementBlock10("div",{class:"opt",title:getTooltip(opt),"data-none":(opt.value??opt)===props.noneOpt,"data-color":getOptColor(opt)??!1,"data-active":isActive(opt),onMousedown:_withModifiers4($event=>select(opt),["stop"])},[(opt.icon||props.icon)?.startsWith("#")?(_openBlock10(),_createElementBlock10("svg",_hoisted_183,[_createElementVNode9("use",{"xlink:href":opt.icon||props.icon},null,8,_hoisted_193)])):opt.icon||props.icon?(_openBlock10(),_createElementBlock10("img",{key:1,src:opt.icon||props.icon},null,8,_hoisted_202)):props.label?(_openBlock10(),_createElementBlock10("p",_hoisted_212,_toDisplayString8(_unref6(translate)(props.label+opt,props.plurNum)),1)):_createCommentVNode7("v-if",!0)],40,_hoisted_173))),256))],8,_hoisted_117))}});var _hoisted_119=["data-inactive","data-drop-down"],_hoisted_211={class:"body"},_hoisted_310={class:"label"},_hoisted_47={key:0,class:"note"},select_field_default=_defineComponent10({__name:"select-field",props:{value:{},label:{},inactive:{type:Boolean},optLabel:{},opts:{},color:{},icon:{},noneOpt:{},note:{},folded:{type:Boolean}},emits:["update:value"],setup(__props,{emit:__emit}){let emit=__emit,props=__props,dropDownOpen=ref7(!1),inputComponent=ref7(null),rootEl=ref7(null);function switchOption(e){if(props.inactive||!props.opts||Array.isArray(props.value))return;if(props.folded){dropDownOpen.value=!0,inputComponent.value&&inputComponent.value.open(),rootEl.value&&(rootEl.value.tabIndex=0,rootEl.value.focus());return}let i=props.value!==void 0?props.opts.indexOf(props.value):-1;if(i===-1&&(i=props.opts.findIndex(o=>o.value===props.value)),i===-1)return;e.button===0&&i++,e.button===2&&i--,i>=props.opts.length&&(i=0),i<0&&(i=props.opts.length-1);let selected=props.opts[i];selected&&selected.value?emit("update:value",selected.value):emit("update:value",selected)}function select(option){emit("update:value",option),dropDownOpen.value=!1,inputComponent.value&&inputComponent.value.close(),rootEl.value&&(rootEl.value.tabIndex=-1)}function onBlur(){dropDownOpen.value=!1,inputComponent.value&&inputComponent.value.close(),rootEl.value&&(rootEl.value.tabIndex=-1)}return(_ctx,_cache)=>(_openBlock11(),_createElementBlock11("div",{class:"SelectField",ref_key:"rootEl",ref:rootEl,"data-inactive":props.inactive,"data-drop-down":dropDownOpen.value,onMousedown:switchOption,onContextmenu:_cache[0]||(_cache[0]=_withModifiers5(()=>{},["stop","prevent"])),onBlur},[_createElementVNode10("div",_hoisted_211,[_createElementVNode10("div",_hoisted_310,_toDisplayString9(_unref7(translate)(props.label)),1),_createVNode4(select_input_default,{ref_key:"inputComponent",ref:inputComponent,label:props.optLabel,value:props.value,opts:props.opts,noneOpt:props.noneOpt,color:props.color,icon:props.icon,folded:_ctx.folded,"onUpdate:value":select},null,8,["label","value","opts","noneOpt","color","icon","folded"])]),props.note?(_openBlock11(),_createElementBlock11("div",_hoisted_47,_toDisplayString9(props.note),1)):_createCommentVNode8("v-if",!0)],40,_hoisted_119))}});var _hoisted_120={key:0,class:"popup"},_hoisted_213={key:0},_hoisted_311={key:1,class:"shortcuts"},_hoisted_48=["data-edit","onClick"],_hoisted_55=["data-color"],_hoisted_64={class:"icon-box"},_hoisted_74={class:"icon"},_hoisted_84=["xlink:href"],_hoisted_94={class:"container"},_hoisted_104=["onClick"],_hoisted_1110=_createElementVNode11("svg",null,[_createElementVNode11("use",{"xlink:href":"#icon_expand"})],-1),_hoisted_124=[_hoisted_1110],_hoisted_134=["onClick"],_hoisted_144=_createElementVNode11("svg",null,[_createElementVNode11("use",{"xlink:href":"#icon_expand"})],-1),_hoisted_154=[_hoisted_144],_hoisted_164=["onClick"],_hoisted_174=_createElementVNode11("svg",null,[_createElementVNode11("use",{"xlink:href":"#icon_remove"})],-1),_hoisted_184=[_hoisted_174],_hoisted_194=["data-with-container"],_hoisted_203={class:"icon-box"},_hoisted_214={key:0,class:"icon"},_hoisted_223=["xlink:href"],_hoisted_232=["src"],_hoisted_242={class:"url"},_hoisted_252=["onClick"],_hoisted_262=_createElementVNode11("svg",null,[_createElementVNode11("use",{"xlink:href":"#icon_expand"})],-1),_hoisted_272=[_hoisted_262],_hoisted_282=["onClick"],_hoisted_292=_createElementVNode11("svg",null,[_createElementVNode11("use",{"xlink:href":"#icon_expand"})],-1),_hoisted_30=[_hoisted_292],_hoisted_31=["onClick"],_hoisted_322=_createElementVNode11("svg",null,[_createElementVNode11("use",{"xlink:href":"#icon_remove"})],-1),_hoisted_332=[_hoisted_322],_hoisted_342={class:"controls-box"},_hoisted_352=["onClick"],_hoisted_362=_createElementVNode11("svg",null,[_createElementVNode11("use",{"xlink:href":"#icon_expand"})],-1),_hoisted_372=[_hoisted_362],_hoisted_382=["onClick"],_hoisted_392=_createElementVNode11("svg",null,[_createElementVNode11("use",{"xlink:href":"#icon_expand"})],-1),_hoisted_40=[_hoisted_392],_hoisted_41=["onClick"],_hoisted_422=_createElementVNode11("svg",null,[_createElementVNode11("use",{"xlink:href":"#icon_remove"})],-1),_hoisted_432=[_hoisted_422],_hoisted_442=_createElementVNode11("div",{class:"space"},null,-1),_hoisted_452={key:2,class:"ctrls"},_hoisted_462={key:3,class:"ctrls"},_hoisted_472=["title"],popup_new_tab_shortcuts_default=_defineComponent11({__name:"popup.new-tab-shortcuts",setup(__props){let newShortcutContainerId=ref8("none"),newShortcutURL=ref8(""),editing=ref8(null),addBtnActive=computed4(()=>{let urlIsValid=!!newShortcutURL.value&&DOMAIN_RE.test(newShortcutURL.value),containerIsValid=newShortcutContainerId.value!=="none";return urlIsValid||containerIsValid}),shortcuts=computed4(()=>{if(!reactive.newTabShortcutsPopup)return[];let rawShortcuts=reactive.newTabShortcutsPopup.rawShortcuts,shortcuts2=[],ids={},container;for(let conf of rawShortcuts){if(conf===""){shortcuts2.push({id:Math.random().toString(36)});continue}if(ids[conf])continue;ids[conf]=conf,container=void 0;let shortcut={id:conf},parts=conf.split(",");for(let part of parts){part=part.trim();let domain=DOMAIN_RE.exec(part)?.[2];if(domain){shortcut.url=part;let favicon=reactive2.byDomains[domain];favicon?shortcut.urlIcon=favicon:shortcut.urlIcon="#icon_ff";continue}if(!container&&(container=Object.values(Containers.reactive.byId).find(c=>c.name===part),container&&!Windows.incognito)){shortcut.container=container.name,shortcut.containerId=container.id,shortcut.containerIcon="#"+container.icon,shortcut.containerColor=container.color;continue}}shortcuts2.push(shortcut)}return shortcuts2}),availableContainersOpts=computed4(()=>{if(!reactive.newTabShortcutsPopup)return[];let panelId=reactive.newTabShortcutsPopup.panelId,panel=Info.isSidebar?Sidebar.panelsById[panelId]:SidebarConfigRState.panels[panelId];if(!isTabsPanel(panel))return[];let defaultTitle=translate("popup.new_tab_shortcuts.new_shortcut_default_container"),result=[{value:"none",color:"inactive",icon:"#icon_none",title:defaultTitle,tooltip:defaultTitle}];for(let c of Object.values(Containers.reactive.byId)){let icon="#"+c.icon;result.push({value:c.id,color:c.color,icon,title:c.name,tooltip:c.name})}return result});function onAddBr(){if(!reactive.newTabShortcutsPopup)return;let panelId=reactive.newTabShortcutsPopup.panelId,panel=Info.isSidebar?Sidebar.panelsById[panelId]:SidebarConfigRState.panels[panelId];if(!isTabsPanel(panel))return;let rawShortcuts=reactive.newTabShortcutsPopup.rawShortcuts,shortcut="";rawShortcuts.push(shortcut),panel.newTabBtns.push(shortcut),newShortcutURL.value="",newShortcutContainerId.value="none",Info.isSidebar&&(panel.reactive.newTabBtns=cloneArray(panel.newTabBtns)),Info.isSidebar?Sidebar.saveSidebar(1e3):saveSidebarConfig(1e3)}function onAdd(){if(!reactive.newTabShortcutsPopup||!addBtnActive.value||!newShortcutURL.value&&newShortcutContainerId.value==="none")return;let container=Containers.reactive.byId[newShortcutContainerId.value],btnConfig=[];if(container?.name&&btnConfig.push(container.name),newShortcutURL.value&&btnConfig.push(newShortcutURL.value),!btnConfig.length)return;let panelId=reactive.newTabShortcutsPopup.panelId,panel=Info.isSidebar?Sidebar.panelsById[panelId]:SidebarConfigRState.panels[panelId];if(!isTabsPanel(panel))return;let rawShortcuts=reactive.newTabShortcutsPopup.rawShortcuts,shortcut=btnConfig.join(", ");rawShortcuts.push(shortcut),panel.newTabBtns.push(shortcut),newShortcutURL.value="",newShortcutContainerId.value="none",Info.isSidebar&&(panel.reactive.newTabBtns=cloneArray(panel.newTabBtns)),Info.isSidebar?Sidebar.saveSidebar(1e3):saveSidebarConfig(1e3)}function onCancel(){reactive.newTabShortcutsPopup&&closeNewTabShortcutsPopup()}function shortcutUp(index){if(!reactive.newTabShortcutsPopup)return;let panelId=reactive.newTabShortcutsPopup.panelId,panel=Info.isSidebar?Sidebar.panelsById[panelId]:SidebarConfigRState.panels[panelId];if(!isTabsPanel(panel)||index<=0)return;let rawShortcuts=reactive.newTabShortcutsPopup.rawShortcuts,shortcut=rawShortcuts[index];rawShortcuts.splice(index,1),rawShortcuts.splice(index-1,0,shortcut),panel.newTabBtns.splice(index,1),panel.newTabBtns.splice(index-1,0,shortcut),Info.isSidebar&&(panel.reactive.newTabBtns=cloneArray(panel.newTabBtns)),Info.isSidebar?Sidebar.saveSidebar(1e3):saveSidebarConfig(1e3)}function shortcutDown(index){if(!reactive.newTabShortcutsPopup)return;let panelId=reactive.newTabShortcutsPopup.panelId,panel=Info.isSidebar?Sidebar.panelsById[panelId]:SidebarConfigRState.panels[panelId];if(!isTabsPanel(panel)||index>=panel.newTabBtns.length-1)return;let rawShortcuts=reactive.newTabShortcutsPopup.rawShortcuts,shortcut=rawShortcuts[index];rawShortcuts.splice(index,1),rawShortcuts.splice(index+1,0,shortcut),panel.newTabBtns.splice(index,1),panel.newTabBtns.splice(index+1,0,shortcut),Info.isSidebar&&(panel.reactive.newTabBtns=cloneArray(panel.newTabBtns)),Info.isSidebar?Sidebar.saveSidebar(1e3):saveSidebarConfig(1e3)}function removeShortcut(index){if(!reactive.newTabShortcutsPopup)return;let panelId=reactive.newTabShortcutsPopup.panelId,panel=Info.isSidebar?Sidebar.panelsById[panelId]:SidebarConfigRState.panels[panelId];if(!isTabsPanel(panel))return;reactive.newTabShortcutsPopup.rawShortcuts.splice(index,1),panel.newTabBtns.splice(index,1),Info.isSidebar&&(panel.reactive.newTabBtns=cloneArray(panel.newTabBtns)),Info.isSidebar?Sidebar.saveSidebar(1e3):saveSidebarConfig(1e3)}function editShortcut(shortcut){if(editing.value===shortcut.id)return onCancel();editing.value=shortcut.id,shortcut.containerId?newShortcutContainerId.value=shortcut.containerId:newShortcutContainerId.value="none",shortcut.url?newShortcutURL.value=shortcut.url:newShortcutURL.value=""}function onSaveEdit(){if(!reactive.newTabShortcutsPopup||!newShortcutURL.value&&newShortcutContainerId.value==="none")return;let id=editing.value;if(!id)return;editing.value=null;let sIndex=shortcuts.value.findIndex(s=>s.id===id);if(sIndex===-1)return;let container=Containers.reactive.byId[newShortcutContainerId.value],sConfig=[];if(container?.name&&sConfig.push(container.name),newShortcutURL.value&&sConfig.push(newShortcutURL.value),!sConfig.length)return;let panelId=reactive.newTabShortcutsPopup.panelId,panel=Info.isSidebar?Sidebar.panelsById[panelId]:SidebarConfigRState.panels[panelId];if(!isTabsPanel(panel))return;let rawShortcut=sConfig.join(", ");reactive.newTabShortcutsPopup.rawShortcuts.splice(sIndex,1,rawShortcut),panel.newTabBtns.splice(sIndex,1,rawShortcut),newShortcutURL.value="",newShortcutContainerId.value="none",Info.isSidebar&&(panel.reactive.newTabBtns=cloneArray(panel.newTabBtns)),Info.isSidebar?Sidebar.saveSidebar(1e3):saveSidebarConfig(1e3)}function onCancelEdit(){editing.value=null,newShortcutContainerId.value="none",newShortcutURL.value=""}return(_ctx,_cache)=>(_openBlock12(),_createElementBlock12("div",{class:"NewTabShortcutsPopup popup-container",onMousedown:_withModifiers6(onCancel,["stop","self"]),onMouseup:_cache[5]||(_cache[5]=_withModifiers6(()=>{},["stop"]))},[reactive.newTabShortcutsPopup?(_openBlock12(),_createElementBlock12("div",_hoisted_120,[shortcuts.value.length?(_openBlock12(),_createElementBlock12("h2",_hoisted_213,_toDisplayString10(_unref8(translate)("popup.new_tab_shortcuts.title")),1)):_createCommentVNode9("v-if",!0),shortcuts.value.length?(_openBlock12(),_createElementBlock12("div",_hoisted_311,[(_openBlock12(!0),_createElementBlock12(_Fragment5,null,_renderList5(shortcuts.value,(shortcut,index)=>(_openBlock12(),_createElementBlock12("div",{class:"shortcut",key:shortcut.id,"data-edit":shortcut.id===editing.value,onClick:$event=>editShortcut(shortcut)},[shortcut.container?(_openBlock12(),_createElementBlock12("div",{key:0,class:"container-box","data-color":shortcut.containerColor},[_createElementVNode11("div",_hoisted_64,[(_openBlock12(),_createElementBlock12("svg",_hoisted_74,[_createElementVNode11("use",{"xlink:href":shortcut.containerIcon},null,8,_hoisted_84)]))]),_createElementVNode11("div",_hoisted_94,_toDisplayString10(shortcut.container),1),_createElementVNode11("div",{class:"controls-box",onClick:_cache[0]||(_cache[0]=_withModifiers6(()=>{},["stop"]))},[_createElementVNode11("div",{class:"btn-up",onClick:$event=>shortcutUp(index)},_hoisted_124,8,_hoisted_104),_createElementVNode11("div",{class:"btn-down",onClick:$event=>shortcutDown(index)},_hoisted_154,8,_hoisted_134),_createElementVNode11("div",{class:"btn-rm",onClick:$event=>removeShortcut(index)},_hoisted_184,8,_hoisted_164)])],8,_hoisted_55)):_createCommentVNode9("v-if",!0),shortcut.url?(_openBlock12(),_createElementBlock12("div",{key:1,class:"url-box","data-with-container":!!shortcut.container},[_createElementVNode11("div",_hoisted_203,[shortcut.urlIcon?.startsWith("#")?(_openBlock12(),_createElementBlock12("svg",_hoisted_214,[_createElementVNode11("use",{"xlink:href":shortcut.urlIcon},null,8,_hoisted_223)])):(_openBlock12(),_createElementBlock12("img",{key:1,class:"icon",src:shortcut.urlIcon},null,8,_hoisted_232))]),_createElementVNode11("div",_hoisted_242,_toDisplayString10(shortcut.url),1),shortcut.container?_createCommentVNode9("v-if",!0):(_openBlock12(),_createElementBlock12("div",{key:0,class:"controls-box",onClick:_cache[1]||(_cache[1]=_withModifiers6(()=>{},["stop"]))},[_createElementVNode11("div",{class:"btn-up",onClick:$event=>shortcutUp(index)},_hoisted_272,8,_hoisted_252),_createElementVNode11("div",{class:"btn-down",onClick:$event=>shortcutDown(index)},_hoisted_30,8,_hoisted_282),_createElementVNode11("div",{class:"btn-rm",onClick:$event=>removeShortcut(index)},_hoisted_332,8,_hoisted_31)]))],8,_hoisted_194)):_createCommentVNode9("v-if",!0),!shortcut.url&&!shortcut.container?(_openBlock12(),_createElementBlock12("div",{key:2,class:"separator",onClick:_cache[2]||(_cache[2]=_withModifiers6(()=>{},["stop"]))},[_createElementVNode11("div",_hoisted_342,[_createElementVNode11("div",{class:"btn-up",onClick:$event=>shortcutUp(index)},_hoisted_372,8,_hoisted_352),_createElementVNode11("div",{class:"btn-down",onClick:$event=>shortcutDown(index)},_hoisted_40,8,_hoisted_382),_createElementVNode11("div",{class:"btn-rm",onClick:$event=>removeShortcut(index)},_hoisted_432,8,_hoisted_41)])])):_createCommentVNode9("v-if",!0)],8,_hoisted_48))),128))])):_createCommentVNode9("v-if",!0),_hoisted_442,_createElementVNode11("h2",null,_toDisplayString10(_unref8(translate)("popup.new_tab_shortcuts.create_title")),1),_createVNode5(select_field_default,{class:"-no-separator",label:"popup.new_tab_shortcuts.new_shortcut_container_label",noneOpt:"-",value:newShortcutContainerId.value,"onUpdate:value":_cache[3]||(_cache[3]=$event=>newShortcutContainerId.value=$event),opts:availableContainersOpts.value,inline:!1,folded:!0},null,8,["value","opts"]),_createVNode5(text_field_default,{class:"-no-separator",label:"popup.new_tab_shortcuts.new_shortcut_url_label",value:newShortcutURL.value,"onUpdate:value":_cache[4]||(_cache[4]=$event=>newShortcutURL.value=$event),or:_unref8(translate)("popup.new_tab_shortcuts.new_shortcut_url_placeholder"),line:!0},null,8,["value","or"]),editing.value?(_openBlock12(),_createElementBlock12("div",_hoisted_452,[_createElementVNode11("div",{class:"btn -wide",onClick:onSaveEdit},_toDisplayString10(_unref8(translate)("btn.save")),1),_createElementVNode11("div",{class:"btn -wide",onClick:onCancelEdit},_toDisplayString10(_unref8(translate)("btn.cancel")),1)])):(_openBlock12(),_createElementBlock12("div",_hoisted_462,[_createElementVNode11("div",{class:"btn -wide",title:_unref8(translate)("popup.new_tab_shortcuts.add_br_btn"),onClick:onAddBr},_toDisplayString10(_unref8(translate)("popup.new_tab_shortcuts.add_br_btn")),9,_hoisted_472),_createElementVNode11("div",{class:_normalizeClass3(["btn -wide",{"-inactive":!addBtnActive.value}]),onClick:onAdd},_toDisplayString10(_unref8(translate)("popup.new_tab_shortcuts.add_shortcut_btn")),3)]))])):_createCommentVNode9("v-if",!0)],32))}});import{defineComponent as _defineComponent12}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref9,toDisplayString as _toDisplayString11,createElementVNode as _createElementVNode12,createVNode as _createVNode6,openBlock as _openBlock13,createElementBlock as _createElementBlock13,createCommentVNode as _createCommentVNode10,renderList as _renderList6,Fragment as _Fragment6,normalizeClass as _normalizeClass4}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref9,onMounted as onMounted5,watch}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_121=["data-loading"],_hoisted_215={class:"container"},_hoisted_312={class:"title"},_hoisted_49={class:"loading-box"},_hoisted_56={class:"progress"},_hoisted_65={key:0,class:"item","data-status":"err"},_hoisted_75={key:0,class:"label"},_hoisted_85={key:1,class:"status"},_hoisted_95={key:1,class:"list"},_hoisted_105=["data-status"],_hoisted_1111={key:0,class:"label"},_hoisted_125={key:1,class:"status"},_hoisted_135={class:"controls"},upgrade_screen_default=_defineComponent12({__name:"upgrade-screen",setup(__props){onMounted5(()=>{genBackup()});let backupDataLink=ref9(null),continued=ref9(!1),backupReady=ref9(!1),backupErr=ref9(null),el=ref9(null),scrollConf={behavior:"smooth",top:0},scrollTimeout;watch(()=>reactiveUpgrading.status?.messages,()=>{clearTimeout(scrollTimeout),scrollTimeout=setTimeout(()=>{el.value&&(scrollConf.top=999999,el.value.scroll(scrollConf))},33)});function onContinueClick(){continued.value||reactiveUpgrading.status?.status!=="finish"&&(reactiveUpgrading.status&&(reactiveUpgrading.status.status="loading"),pollBgForUpgradeState(),blockContinueBtn(),bg("continueUpgrade"))}let blockContinueBtnTimeout;function blockContinueBtn(){continued.value=!0,clearTimeout(blockContinueBtnTimeout),blockContinueBtnTimeout=setTimeout(()=>{continued.value=!1},500)}async function genBackup(){let stored;try{stored=await browser.storage.local.get(["containers_v4","panels_v4","settings","tabsMenu","bookmarksMenu","snapshots_v4"])}catch(err2){let errStr=err2?err2.toString():"";return backupErr.value={title:translate("upgrade.err.backup"),note:translate("upgrade.err.backup_note")+`

`+errStr,status:"err"},err("genBackup: Cannot get stored data for backup",err2)}let backup={ver:browser.runtime.getManifest().version,...stored},backupJSON=JSON.stringify(backup),file=new Blob([backupJSON],{type:"application/json"}),now=Date.now(),date=uDate(now,"."),time=uTime(now,".");backupDataLink.value&&(backupDataLink.value.href=URL.createObjectURL(file),backupDataLink.value.download=`sidebery-data-${date}-${time}.json`,backupDataLink.value.title=`sidebery-data-${date}-${time}.json`),backupReady.value=!0}return(_ctx,_cache)=>(_openBlock13(),_createElementBlock13("div",{class:"UpgradeScreen",ref_key:"el",ref:el,"data-loading":_unref9(reactiveUpgrading).status?.status==="loading"},[_createElementVNode12("div",_hoisted_215,[_createElementVNode12("h2",_hoisted_312,_toDisplayString11(_unref9(translate)("upgrade.title")),1),_createElementVNode12("div",_hoisted_49,[_createVNode6(loading_dots_default)]),_createElementVNode12("div",_hoisted_56,[backupErr.value?(_openBlock13(),_createElementBlock13("div",_hoisted_65,[backupErr.value.title?(_openBlock13(),_createElementBlock13("div",_hoisted_75,_toDisplayString11(backupErr.value.title),1)):_createCommentVNode10("v-if",!0),backupErr.value.note?(_openBlock13(),_createElementBlock13("div",_hoisted_85,_toDisplayString11(backupErr.value.note),1)):_createCommentVNode10("v-if",!0)])):_createCommentVNode10("v-if",!0),_unref9(reactiveUpgrading).status?(_openBlock13(),_createElementBlock13("div",_hoisted_95,[(_openBlock13(!0),_createElementBlock13(_Fragment6,null,_renderList6(_unref9(reactiveUpgrading).status.messages,msg=>(_openBlock13(),_createElementBlock13("div",{class:"item","data-status":msg.status,key:msg.title},[msg.title?(_openBlock13(),_createElementBlock13("div",_hoisted_1111,_toDisplayString11(msg.title),1)):_createCommentVNode10("v-if",!0),msg.note?(_openBlock13(),_createElementBlock13("div",_hoisted_125,_toDisplayString11(msg.note),1)):_createCommentVNode10("v-if",!0)],8,_hoisted_105))),128))])):_createCommentVNode10("v-if",!0)]),_createElementVNode12("div",_hoisted_135,[_createElementVNode12("div",{class:_normalizeClass4(["btn",{"-inactive":_unref9(reactiveUpgrading).status?.status!=="done"&&_unref9(reactiveUpgrading).status?.status!=="err"}]),onClick:onContinueClick},_toDisplayString11(_unref9(translate)("upgrade.btn.continue")),3),_createElementVNode12("a",{class:_normalizeClass4(["btn -wrap",{"-inactive":!backupReady.value}]),ref_key:"backupDataLink",ref:backupDataLink},_toDisplayString11(_unref9(translate)("upgrade.btn.backup")),3)])])],8,_hoisted_121))}});export{Keybindings,reactiveUpgrading,initUpgrading,showUpgradingScreen,scroll_box_default,loading_dots_default,bookmark_node_default,text_input_default,popup_bookmarks_default,select_input_default,toggle_input_default,toggle_field_default,popup_dialog_default,text_field_default,select_field_default,popup_new_tab_shortcuts_default,upgrade_screen_default};
