var e={815:function(e,t){var n,i;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=function(e){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)e.exports=globalThis.browser;else{const t="The message port closed before a response was received.",n=e=>{const n={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(n).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class i extends WeakMap{constructor(e,t=void 0){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const r=(t,n)=>(...i)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):n.singleCallbackArg||i.length<=1&&!1!==n.singleCallbackArg?t.resolve(i[0]):t.resolve(i)},o=e=>1==e?"argument":"arguments",s=(e,t,n)=>new Proxy(t,{apply:(t,i,r)=>n.call(i,e,...r)});let a=Function.call.bind(Object.prototype.hasOwnProperty);const l=(e,t={},n={})=>{let i=Object.create(null),g={has:(t,n)=>n in e||n in i,get(g,c,d){if(c in i)return i[c];if(!(c in e))return;let h=e[c];if("function"==typeof h)if("function"==typeof t[c])h=s(e,e[c],t[c]);else if(a(n,c)){let t=((e,t)=>function(n,...i){if(i.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${o(t.minArgs)} for ${e}(), got ${i.length}`);if(i.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${o(t.maxArgs)} for ${e}(), got ${i.length}`);return new Promise(((o,s)=>{if(t.fallbackToNoCallback)try{n[e](...i,r({resolve:o,reject:s},t))}catch(r){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,r),n[e](...i),t.fallbackToNoCallback=!1,t.noCallback=!0,o()}else t.noCallback?(n[e](...i),o()):n[e](...i,r({resolve:o,reject:s},t))}))})(c,n[c]);h=s(e,e[c],t)}else h=h.bind(e);else if("object"==typeof h&&null!==h&&(a(t,c)||a(n,c)))h=l(h,t[c],n[c]);else{if(!a(n,"*"))return Object.defineProperty(i,c,{configurable:!0,enumerable:!0,get:()=>e[c],set(t){e[c]=t}}),h;h=l(h,t[c],n["*"])}return i[c]=h,h},set:(t,n,r,o)=>(n in i?i[n]=r:e[n]=r,!0),defineProperty:(e,t,n)=>Reflect.defineProperty(i,t,n),deleteProperty:(e,t)=>Reflect.deleteProperty(i,t)},c=Object.create(e);return new Proxy(c,g)},g=e=>({addListener(t,n,...i){t.addListener(e.get(n),...i)},hasListener:(t,n)=>t.hasListener(e.get(n)),removeListener(t,n){t.removeListener(e.get(n))}}),c=new i((e=>"function"!=typeof e?e:function(t){const n=l(t,{},{getContent:{minArgs:0,maxArgs:0}});e(n)})),d=new i((e=>"function"!=typeof e?e:function(t,n,i){let r,o,s=!1,a=new Promise((e=>{r=function(t){s=!0,e(t)}}));try{o=e(t,n,r)}catch(e){o=Promise.reject(e)}const l=!0!==o&&((g=o)&&"object"==typeof g&&"function"==typeof g.then);var g;if(!0!==o&&!l&&!s)return!1;return(l?o:a).then((e=>{i(e)}),(e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",i({__mozWebExtensionPolyfillReject__:!0,message:t})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)})),!0})),h=({reject:n,resolve:i},r)=>{e.runtime.lastError?e.runtime.lastError.message===t?i():n(new Error(e.runtime.lastError.message)):r&&r.__mozWebExtensionPolyfillReject__?n(new Error(r.message)):i(r)},m=(e,t,n,...i)=>{if(i.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${o(t.minArgs)} for ${e}(), got ${i.length}`);if(i.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${o(t.maxArgs)} for ${e}(), got ${i.length}`);return new Promise(((e,t)=>{const r=h.bind(null,{resolve:e,reject:t});i.push(r),n.sendMessage(...i)}))},u={devtools:{network:{onRequestFinished:g(c)}},runtime:{onMessage:g(d),onMessageExternal:g(d),sendMessage:m.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:m.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},p={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return n.privacy={network:{"*":p},services:{"*":p},websites:{"*":p}},l(e,u,n)};e.exports=n(chrome)}},void 0===(i=n.apply(t,[e]))||(e.exports=i)}},t={};const n=function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}(815);function i(e){var t;if(e.nodeType===Node.DOCUMENT_NODE)return"";if(e.nodeType!==Node.ELEMENT_NODE)return i(e.parentNode);let n=0;const r=(null===(t=e.parentNode)||void 0===t?void 0:t.childNodes)||[];for(let t=0;t<r.length;t++){const o=r[t];if(o===e)return i(e.parentNode)+"/"+e.tagName.toLowerCase()+"["+(n+1)+"]";o.nodeType===Node.ELEMENT_NODE&&o.tagName===e.tagName&&n++}return""}function r(e){return document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}var o=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};let s=null,a=0,l=0,g=!1,c=null;function d(e){return"html"===e.tagName.toLowerCase()||"body"===e.tagName.toLowerCase()||e.classList.contains("obsidian-highlighter-menu")||null!==e.closest(".obsidian-highlighter-menu")}function h(e){let t;if(e instanceof MouseEvent)t=e.target;else{const n=e.changedTouches[0];t=document.elementFromPoint(n.clientX,n.clientY)}d(t)?w():function(e){if(e===c)return;c=e,s||(s=document.createElement("div"),s.id="obsidian-highlight-hover-overlay",document.body.appendChild(s));const t=e.getBoundingClientRect();if(s.style.position="absolute",s.style.left=t.left+window.scrollX-2+"px",s.style.top=t.top+window.scrollY-2+"px",s.style.width=`${t.width+4}px`,s.style.height=`${t.height+4}px`,s.style.display="block",document.querySelectorAll(".obsidian-highlight-overlay.is-hovering").forEach((e=>{e.classList.remove("is-hovering")})),s.classList.remove("on-highlight"),e.classList.contains("obsidian-highlight-overlay")){const t=e.getAttribute("data-highlight-index");t&&(document.querySelectorAll(`.obsidian-highlight-overlay[data-highlight-index="${t}"]`).forEach((e=>{e.classList.add("is-hovering")})),s.classList.add("on-highlight"))}}(t)}function m(e){let t;if(e instanceof MouseEvent)t=e.target;else{if(g)return void(g=!1);const n=e.changedTouches[0];t=document.elementFromPoint(n.clientX,n.clientY)}const n=window.getSelection();n&&!n.isCollapsed?J(n):t.classList.contains("obsidian-highlight-overlay")?E(e):d(t)||z(t)}function u(e){const t=e.touches[0];a=t.clientX,l=t.clientY,g=!1}function p(e){const t=e.touches[0];(Math.abs(t.clientX-a)>10||Math.abs(t.clientY-l)>10)&&(g=!0),h(e)}function f(e,t){var n;let i=0;const r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);let o=r.currentNode;for(;o;){const e=(null===(n=o.textContent)||void 0===n?void 0:n.length)||0;if(i+e>=t)return{node:o,offset:Math.min(Math.max(0,t-i),e)};i+=e,o=r.nextNode()}const s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT).firstChild();return s?{node:s,offset:0}:null}function A(e,t,n){var i;const r=Array.from(document.querySelectorAll(`.obsidian-highlight-overlay[data-highlight-index="${n}"]`));if("complex"===t.type||"element"===t.type)v([e.getBoundingClientRect()],t.content,r,!1,n,t.notes);else if("text"===t.type)try{const o=document.createRange(),s=f(e,t.startOffset),a=f(e,t.endOffset);if(s&&a)try{try{o.setStart(s.node,s.offset)}catch(e){o.setStart(s.node,0)}try{o.setEnd(a.node,a.offset)}catch(e){o.setEnd(a.node,(null===(i=a.node.textContent)||void 0===i?void 0:i.length)||0)}const l=o.getClientRects();if(0===l.length)return void v([e.getBoundingClientRect()],t.content,r,!1,n,t.notes);const g=function(e){const t=Array.from(e).map((e=>e.height));return t.reduce(((e,t)=>e+t),0)/t.length}(l),c=Array.from(l).filter((e=>e.height<=1.5*g)),d=Array.from(l).filter((e=>e.height>1.5*g));c.length>0&&v(c,t.content,r,!0,n,t.notes),d.length>0&&v(d,t.content,r,!1,n,t.notes)}catch(i){v([e.getBoundingClientRect()],t.content,r,!1,n,t.notes)}else v([e.getBoundingClientRect()],t.content,r,!1,n,t.notes)}catch(i){console.error("Error creating text highlight:",i),v([e.getBoundingClientRect()],t.content,r,!1,n,t.notes)}}function v(e,t,n,i=!1,r,o){let s=[],a=null;for(let t=0;t<e.length;t++){const n=e[t];a?Math.abs(n.y-a.y)<1&&Math.abs(n.height-a.height)<1?a.width=n.right-a.left:(s.push(a),a=new DOMRect(n.x,n.y,n.width,n.height)):a=new DOMRect(n.x,n.y,n.width,n.height)}a&&s.push(a);for(const e of s)n.some((t=>{const n=t.getBoundingClientRect();return Math.abs(e.left-n.left)<1&&Math.abs(e.top-n.top)<1&&Math.abs(e.width-n.width)<1&&Math.abs(e.height-n.height)<1}))||x(e,t,i,r,o)}function x(e,t,n=!1,i,r){const o=document.createElement("div");o.className="obsidian-highlight-overlay",o.dataset.highlightIndex=i.toString(),o.style.position="absolute",o.style.left=e.left+window.scrollX-2+"px",o.style.top=e.top+window.scrollY-2+"px",o.style.width=`${e.width+4}px`,o.style.height=`${e.height+4}px`,o.setAttribute("data-content",t),r&&r.length>0&&o.setAttribute("data-notes",JSON.stringify(r));const s=document.elementFromPoint(e.left,e.top);s&&function(e){const t=e.match(/\d+/g);return!(!t||t.length<3)&&(299*parseInt(t[0])+587*parseInt(t[1])+114*parseInt(t[2]))/1e3<128}(function(e){let t=e;for(;t;){const e=window.getComputedStyle(t).backgroundColor;if("rgba(0, 0, 0, 0)"!==e&&"transparent"!==e)return e;t=t.parentElement}return"rgb(255, 255, 255)"}(s))&&o.classList.add("obsidian-highlight-overlay-dark"),o.addEventListener("click",E),o.addEventListener("touchend",E),document.body.appendChild(o)}function y(e){document.querySelectorAll(`.obsidian-highlight-overlay[data-highlight-index="${e}"]`).forEach((e=>e.remove()))}const b=function(e){let t;return function(...n){t||(e.apply(this,n),t=!0,setTimeout((()=>t=!1),100))}}((()=>{I||P.forEach(((e,t)=>{const n=r(e.xpath);n&&(document.querySelectorAll(`.obsidian-highlight-overlay[data-highlight-index="${t}"]`).length>0&&y(t),A(n,e,t))}))}));function w(){s&&(s.style.display="none"),c=null,document.querySelectorAll(".obsidian-highlight-overlay.is-hovering").forEach((e=>{e.classList.remove("is-hovering")}))}function E(e){return o(this,void 0,void 0,(function*(){e.stopPropagation(),e.preventDefault();const t=e.currentTarget;try{if(!t||!t.dataset)return;const e=t.dataset.highlightIndex;if(void 0===e)return void console.warn("No highlight index found on clicked element");const n=parseInt(e);if(isNaN(n)||n<0||n>=P.length)return void console.warn(`Invalid highlight index: ${e}`);const i=P[n];!function(e){const t=[...P];P=e,ue("add",t,e)}(P.filter((e=>e.id!==i.id))),y(n),ee(),se(),oe(),de()}catch(e){console.error("Error handling highlight click:",e)}}))}function M(){const e=document.querySelectorAll(".obsidian-highlight-overlay");console.log("existingHighlights",e.length),e.length>0&&e.forEach((e=>e.remove()))}window.addEventListener("resize",b),window.addEventListener("scroll",b),new MutationObserver((e=>{I||e.some((e=>"childList"===e.type&&e.target instanceof Element&&!e.target.id.startsWith("obsidian-highlight")||"attributes"===e.type&&("style"===e.attributeName||"class"===e.attributeName)&&e.target instanceof Element&&!e.target.id.startsWith("obsidian-highlight")))&&b()})).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"],characterData:!1});var L=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};function C(){return L(this,void 0,void 0,(function*(){const e=navigator.userAgent.toLowerCase();if(e.includes("firefox"))return e.includes("mobile")?"firefox-mobile":"firefox";if(e.indexOf("edg/")>-1)return"edge";if(e.indexOf("chrome")>-1){const e=navigator;return e.brave&&(yield e.brave.isBrave())?"brave":"chrome"}return e.includes("safari")?navigator.userAgent.includes("iPad")||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1?"ipad-os":e.includes("mobile")||e.includes("iphone")?"mobile-safari":"safari":"other"}))}const k=(e,...t)=>{};var T=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};let S={vaults:[],betaFeatures:!1,legacyMode:!1,silentOpen:!1,highlighterEnabled:!0,alwaysShowHighlights:!1,highlightBehavior:"highlight-inline",showMoreActionsButton:!1,interpreterModel:"gpt-4o-mini",models:[{id:"gpt-4o-mini",providerId:"openai",providerModelId:"gpt-4o-mini",name:"GPT-4o Mini",enabled:!0},{id:"gpt-4o",providerId:"openai",providerModelId:"gpt-4o",name:"GPT-4o",enabled:!0},{id:"claude-3-5-sonnet-20240620",providerId:"anthropic",providerModelId:"claude-3-sonnet-20240620",name:"Claude 3.5 Sonnet",enabled:!0},{id:"claude-3-haiku-20240307",providerId:"anthropic",providerModelId:"claude-3-haiku-20240307",name:"Claude 3 Haiku",enabled:!0}],providers:[{id:"openai",name:"OpenAI",baseUrl:"https://api.openai.com/v1/chat/completions",apiKey:""},{id:"anthropic",name:"Anthropic",baseUrl:"https://api.anthropic.com/v1/messages",apiKey:""}],interpreterEnabled:!1,interpreterAutoRun:!1,defaultPromptContext:"",propertyTypes:[],stats:{addToObsidian:0,saveFile:0,copyToClipboard:0,share:0},history:[]};const O=1;function H(){return T(this,void 0,void 0,(function*(){var e,t,i,r,o,s,a,l,g,c,d,h,m,u,p,f,A,v,x,y,b,w;const E=yield n.storage.sync.get(null),M={vaults:[],showMoreActionsButton:!1,betaFeatures:!1,legacyMode:!1,silentOpen:!1,highlighterEnabled:!0,alwaysShowHighlights:!0,highlightBehavior:"highlight-inline",interpreterModel:"gpt-4o-mini",models:[],providers:[],interpreterEnabled:!1,interpreterAutoRun:!1,defaultPromptContext:"",propertyTypes:[],stats:{addToObsidian:0,saveFile:0,copyToClipboard:0,share:0},history:[]};if(yield function(e){return T(this,void 0,void 0,(function*(){var t,n,i,r;return e.migrationVersion!==O&&!!(e.anthropicApiKey||e.openaiApiKey||(null===(t=e.interpreter_settings)||void 0===t?void 0:t.anthropicApiKey)||(null===(n=e.interpreter_settings)||void 0===n?void 0:n.openaiApiKey)||(null===(r=null===(i=e.interpreter_settings)||void 0===i?void 0:i.models)||void 0===r?void 0:r.some((e=>e.provider||e.apiKey))))}))}(E)){k("Settings","Starting migration...");try{const{models:e,providers:t}=yield function(e){return T(this,void 0,void 0,(function*(){var t;k("Migration","Starting models and providers migration");try{const i=S.providers.map((t=>{var n,i;return Object.assign(Object.assign({},t),{apiKey:"openai"===t.id?e.openaiApiKey||(null===(n=e.interpreter_settings)||void 0===n?void 0:n.openaiApiKey)||t.apiKey:"anthropic"===t.id&&(e.anthropicApiKey||(null===(i=e.interpreter_settings)||void 0===i?void 0:i.anthropicApiKey))||t.apiKey})})),r=new Map,o=(null===(t=e.interpreter_settings)||void 0===t?void 0:t.models)||[];o.forEach((e=>{if(e.provider&&!r.has(e.provider)&&!i.some((t=>t.name===e.provider))&&"OpenAI"!==e.provider&&"Anthropic"!==e.provider){const t={id:e.provider.toLowerCase().replace(/\s+/g,"-"),name:e.provider,baseUrl:e.baseUrl||"",apiKey:e.apiKey||""};r.set(e.provider,t),k("Migration",`Created custom provider: ${e.provider}`)}}));const s=[...i,...Array.from(r.values())],a=o.map((e=>{let t="";if("OpenAI"===e.provider||e.name.toLowerCase().includes("gpt"))t="openai";else if("Anthropic"===e.provider||e.name.toLowerCase().includes("claude"))t="anthropic";else if(e.provider){const n=r.get(e.provider);t=(null==n?void 0:n.id)||e.provider.toLowerCase().replace(/\s+/g,"-")}return{id:e.id,name:e.name,providerId:t,providerModelId:e.id,enabled:e.enabled}}));return 0===a.length&&a.push(...S.models),yield n.storage.sync.remove(["anthropicApiKey","openaiApiKey","openaiModel"]),yield n.storage.sync.set({migrationVersion:O}),k("Migration",`Migrated ${a.length} models and ${s.length} providers`),{models:a,providers:s}}catch(e){throw console.error("Migration failed:",e),k("Migration","Migration failed:",e),e}}))}(E);E.interpreter_settings=Object.assign(Object.assign({},E.interpreter_settings),{models:e,providers:t}),k("Settings","Migration completed")}catch(e){console.error("Migration failed:",e),k("Settings","Migration failed, using default settings")}}const L={vaults:E.vaults||M.vaults,showMoreActionsButton:null!==(t=null===(e=E.general_settings)||void 0===e?void 0:e.showMoreActionsButton)&&void 0!==t?t:M.showMoreActionsButton,betaFeatures:null!==(r=null===(i=E.general_settings)||void 0===i?void 0:i.betaFeatures)&&void 0!==r?r:M.betaFeatures,legacyMode:null!==(s=null===(o=E.general_settings)||void 0===o?void 0:o.legacyMode)&&void 0!==s?s:M.legacyMode,silentOpen:null!==(l=null===(a=E.general_settings)||void 0===a?void 0:a.silentOpen)&&void 0!==l?l:M.silentOpen,highlighterEnabled:null!==(c=null===(g=E.highlighter_settings)||void 0===g?void 0:g.highlighterEnabled)&&void 0!==c?c:M.highlighterEnabled,alwaysShowHighlights:null!==(h=null===(d=E.highlighter_settings)||void 0===d?void 0:d.alwaysShowHighlights)&&void 0!==h?h:M.alwaysShowHighlights,highlightBehavior:null!==(u=null===(m=E.highlighter_settings)||void 0===m?void 0:m.highlightBehavior)&&void 0!==u?u:M.highlightBehavior,interpreterModel:(null===(p=E.interpreter_settings)||void 0===p?void 0:p.interpreterModel)||M.interpreterModel,models:(null===(f=E.interpreter_settings)||void 0===f?void 0:f.models)||M.models,providers:(null===(A=E.interpreter_settings)||void 0===A?void 0:A.providers)||M.providers,interpreterEnabled:null!==(x=null===(v=E.interpreter_settings)||void 0===v?void 0:v.interpreterEnabled)&&void 0!==x?x:M.interpreterEnabled,interpreterAutoRun:null!==(b=null===(y=E.interpreter_settings)||void 0===y?void 0:y.interpreterAutoRun)&&void 0!==b?b:M.interpreterAutoRun,defaultPromptContext:(null===(w=E.interpreter_settings)||void 0===w?void 0:w.defaultPromptContext)||M.defaultPromptContext,propertyTypes:E.property_types||M.propertyTypes,stats:E.stats||M.stats,history:E.history||M.history};return S=L,k("Settings","Loaded settings:",S),S}))}window.debugStorage=e=>e?n.storage.sync.get(e).then((t=>(console.log(`Sync storage contents for key "${e}":`,t),t))):n.storage.sync.get(null).then((e=>(console.log("Sync storage contents:",e),e)));var N=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};let P=[],I=!1,$="",B=new WeakMap,R=[],_=[];const D=30;function j(e){document.body.classList.toggle("obsidian-highlighter-active",e),e?(document.addEventListener("mouseup",m),document.addEventListener("mousemove",h),document.addEventListener("touchstart",u),document.addEventListener("touchmove",p),document.addEventListener("touchend",m),document.addEventListener("keydown",he),document.querySelectorAll("a").forEach((e=>{const t=e.onclick;t&&B.set(e,t),e.onclick=e=>{e.preventDefault(),e.stopPropagation()}})),V(),function(){L(this,void 0,void 0,(function*(){const e=yield C(),t=document.documentElement;switch(t.classList.remove("is-firefox-mobile","is-chromium","is-firefox","is-edge","is-chrome","is-brave","is-safari","is-mobile-safari","is-ipad-os"),e){case"firefox-mobile":t.classList.add("is-mobile","is-firefox-mobile","is-firefox");break;case"firefox":t.classList.add("is-firefox");break;case"edge":t.classList.add("is-chromium","is-edge");break;case"chrome":t.classList.add("is-chromium","is-chrome");break;case"brave":t.classList.add("is-chromium","is-brave");break;case"safari":t.classList.add("is-safari");break;case"mobile-safari":t.classList.add("is-mobile","is-mobile-safari","is-safari","is-ios");break;case"ipad-os":t.classList.add("is-tablet","is-ipad-os","is-safari")}}))}(),n.runtime.sendMessage({action:"highlighterModeChanged",isActive:!0}),se()):(document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",h),document.removeEventListener("touchstart",u),document.removeEventListener("touchmove",p),document.removeEventListener("touchend",m),document.removeEventListener("keydown",he),w(),document.querySelectorAll("a").forEach((e=>{const t=B.get(e);t?(e.onclick=t,B.delete(e)):e.onclick=null})),Y(),n.runtime.sendMessage({action:"highlighterModeChanged",isActive:!1}),S.alwaysShowHighlights||M()),document.querySelectorAll(".obsidian-highlight-overlay").forEach((e=>{e.removeEventListener("click",E),e.removeEventListener("touchend",E),e.addEventListener("click",E),e.addEventListener("touchend",E)}))}function F(){return R.length>0}function q(){return _.length>0}function U(){if(F()){const e=R.pop();e&&(_.push(e),P=[...e.oldHighlights],se(),oe(),de(),W())}}function K(){if(q()){const e=_.pop();e&&(R.push(e),P=[...e.newHighlights],se(),oe(),de(),W())}}function W(){const e=document.getElementById("obsidian-undo-highlights"),t=document.getElementById("obsidian-redo-highlights");e&&(e.classList.toggle("active",F()),e.setAttribute("aria-disabled",(!F()).toString())),t&&(t.classList.toggle("active",q()),t.setAttribute("aria-disabled",(!q()).toString()))}function X(e){return N(this,void 0,void 0,(function*(){e.preventDefault();const t=yield C();try{const e=yield n.runtime.sendMessage({action:"openPopup"});if(!e||"object"!=typeof e||!("success"in e))throw new Error("Invalid response from background script");if(!e.success)throw new Error(e.error||"Unknown error")}catch(e){console.error("Error opening popup:",e),"firefox"===t?alert("Additional permissions required. To open Web Clipper from the highlighter, go to about:config and set this to true:\n\nextensions.openPopupWithoutUserGesture.enabled"):console.error("Failed to open popup:",e)}}))}function V(){let e=document.querySelector(".obsidian-highlighter-menu");e||(e=document.createElement("div"),e.className="obsidian-highlighter-menu",document.body.appendChild(e));const t=P.length,n=`${t}`;if(e.innerHTML=`\n\t\t${t>0?'<button id="obsidian-clip-button" class="mod-cta">Clip highlights</button>':'<span class="no-highlights">Select elements to highlight</span>'}\n\t\t${t>0?`<button id="obsidian-clear-highlights">${n} <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg></button>`:""}\n\t\t<button id="obsidian-undo-highlights"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-undo-2"><path d="M9 14 4 9l5-5"/><path d="M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11"/></svg></button>\n\t\t<button id="obsidian-redo-highlights"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-redo-2"><path d="m15 14 5-5-5-5"/><path d="M20 9H9.5A5.5 5.5 0 0 0 4 14.5v0A5.5 5.5 0 0 0 9.5 20H13"/></svg></button>\n\t\t<button id="obsidian-exit-highlighter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>\t\n\t`,t>0){const e=document.getElementById("obsidian-clear-highlights"),t=document.getElementById("obsidian-clip-button");e&&(e.addEventListener("click",ce),e.addEventListener("touchend",(e=>{e.preventDefault(),ce()}))),t&&(t.addEventListener("click",X),t.addEventListener("touchend",(e=>{e.preventDefault(),X(e)})))}const i=document.getElementById("obsidian-exit-highlighter"),r=document.getElementById("obsidian-undo-highlights"),o=document.getElementById("obsidian-redo-highlights");i&&(i.addEventListener("click",me),i.addEventListener("touchend",(e=>{e.preventDefault(),me()}))),r&&(r.addEventListener("click",U),r.addEventListener("touchend",(e=>{e.preventDefault(),U()}))),o&&(o.addEventListener("click",K),o.addEventListener("touchend",(e=>{e.preventDefault(),K()}))),W()}function Y(){const e=document.querySelector(".obsidian-highlighter-menu");e&&e.remove()}function z(e,t){var n;Q({xpath:i(e),content:e.outerHTML,type:"block"===window.getComputedStyle(e).display?"element":"text",id:Date.now().toString(),startOffset:0,endOffset:(null===(n=e.textContent)||void 0===n?void 0:n.length)||0},t)}function J(e,t){const n=function(e){const t=[],n=e.cloneContents(),r=document.createElement("div");r.appendChild(n);const o=function(e){let t=e;for(;t&&t.nodeType!==Node.ELEMENT_NODE;)t=t.parentNode;return t}(e.commonAncestorContainer),s=i(o);return t.push({xpath:s,content:Z(r.innerHTML),type:"text",id:Date.now().toString(),startOffset:G(o,e.startContainer,e.startOffset),endOffset:G(o,e.endContainer,e.endOffset)}),t}(e.getRangeAt(0));n.forEach((e=>Q(e,t))),e.removeAllRanges()}function Z(e){const t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll("script").forEach((e=>e.remove())),function(e){const t=[],n=/<\/?([a-z]+)[^>]*>/gi;let i;for(;null!==(i=n.exec(e));)if(i[0].startsWith("</")){const e=t.pop();e!==i[1].toLowerCase()&&e&&t.push(e)}else t.push(i[1].toLowerCase());let r=e;for(;t.length>0;)r+=`</${t.pop()}>`;return r}(t.innerHTML)}function G(e,t,n){var i;let r=0;const o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);let s=o.currentNode;for(;s;){if(s===t)return r+n;r+=(null===(i=s.textContent)||void 0===i?void 0:i.length)||0,s=o.nextNode()}return r}function Q(e,t){const n=[...P],i=Object.assign(Object.assign({},e),{notes:t||[]}),r=function(e,t){let n=[],i=!1;for(const s of e)!ne(s,t)&&(o=t,"text"!==(r=s).type||"text"!==o.type||r.xpath!==o.xpath||r.endOffset!==o.startOffset&&o.endOffset!==r.startOffset)?n.push(s):i?n[n.length-1]=ie(n[n.length-1],s):(n.push(ie(s,t)),i=!0);var r,o;return i||n.push(t),n}(P,i);P=r,ue("add",n,r),ee(),se(),oe(),de()}function ee(){P.sort(((e,t)=>{const n=r(e.xpath),i=r(t.xpath);if(n&&i){const r=te(n)-te(i);return 0===r?"text"===e.type&&"text"===t.type&&e.xpath===t.xpath?e.startOffset-t.startOffset:n.getBoundingClientRect().left-i.getBoundingClientRect().left:r}return 0}))}function te(e){return e.getBoundingClientRect().top+window.scrollY}function ne(e,t){const n=r(e.xpath),i=r(t.xpath);return!(!n||!i)&&(n===i?"text"!==e.type||"text"!==t.type||e.startOffset<t.endOffset&&t.startOffset<e.endOffset:n.contains(i)||i.contains(n))}function ie(e,t){var n;const o=r(e.xpath),s=r(t.xpath);if(!o||!s)throw new Error("Cannot merge highlights: elements not found");if("element"===e.type&&"text"===t.type)return e;if("element"===t.type&&"text"===e.type)return t;let a;return a=o.contains(s)?o:s.contains(o)?s:function(e,t){const n=re(e),i=re(t);for(const e of n)if(i.includes(e))return e;return document.body}(o,s),a!==o||a!==s||"complex"===e.type||"complex"===t.type?{xpath:i(a),content:a.outerHTML,type:"complex",id:Date.now().toString()}:"text"===e.type&&"text"===t.type&&e.xpath===t.xpath?{xpath:e.xpath,content:(null===(n=a.textContent)||void 0===n?void 0:n.slice(Math.min(e.startOffset,t.startOffset),Math.max(e.endOffset,t.endOffset)))||"",type:"text",id:Date.now().toString(),startOffset:Math.min(e.startOffset,t.startOffset),endOffset:Math.max(e.endOffset,t.endOffset)}:{xpath:i(a),content:a.outerHTML,type:"complex",id:Date.now().toString()}}function re(e){const t=[];let n=e;for(;n&&n!==document.body;)t.unshift(n),n=n.parentElement;return t.unshift(document.body),t}function oe(){const e=window.location.href;if(P.length>0){const t={highlights:P,url:e};n.storage.local.get("highlights").then((i=>{const r=i.highlights||{};r[e]=t,n.storage.local.set({highlights:r})}))}else n.storage.local.get("highlights").then((t=>{const i=t.highlights||{};delete i[e],n.storage.local.set({highlights:i})}))}function se(){if(0===P.length)return;if(I)return;const e=JSON.stringify(P);e!==$&&(I=!0,M(),P.forEach(((e,t)=>{const n=r(e.xpath);n&&A(n,e,t)})),$=e,I=!1,ae())}function ae(){n.runtime.sendMessage({action:"highlightsUpdated"})}function le(){return P.map((e=>e.content))}function ge(){return N(this,void 0,void 0,(function*(){const e=window.location.href,t=((yield n.storage.local.get("highlights")).highlights||{})[e];t&&Array.isArray(t.highlights)&&t.highlights.length>0?(P=t.highlights,yield H(),S.alwaysShowHighlights&&(se(),document.body.classList.add("obsidian-highlighter-always-show"))):P=[],$=JSON.stringify(P)}))}function ce(){const e=window.location.href,t=[...P];n.storage.local.get("highlights").then((i=>{const r=i.highlights||{};delete r[e],n.storage.local.set({highlights:r}).then((()=>{P=[],M(),console.log("Highlights cleared for:",e),n.runtime.sendMessage({action:"highlightsCleared"}),ae(),de(),ue("remove",t,[])}))}))}function de(){Y(),V()}function he(e){"Escape"===e.key&&document.body.classList.contains("obsidian-highlighter-active")?me():(e.metaKey||e.ctrlKey)&&"z"===e.key&&(e.preventDefault(),e.shiftKey?K():U())}function me(){console.log("Exiting highlighter mode"),j(!1),n.runtime.sendMessage({action:"setHighlighterMode",isActive:!1}),n.storage.local.set({isHighlighterMode:!1}),S.alwaysShowHighlights||M()}function ue(e,t,n){R.push({type:e,oldHighlights:t,newHighlights:n}),R.length>D&&R.shift(),_=[],W()}!function(){if(window.hasOwnProperty("obsidianHighlighterInitialized"))return;window.obsidianHighlighterInitialized=!0;let e=!1;function t(){const e=document.querySelectorAll('script[type="application/ld+json"]'),t=[];return e.forEach((e=>{let n=e.textContent||"";try{n=n.replace(/\/\*[\s\S]*?\*\/|^\s*\/\/.*$/gm,"").replace(/^\s*<!\[CDATA\[([\s\S]*?)\]\]>\s*$/,"$1").replace(/^\s*(\*\/|\/\*)\s*|\s*(\*\/|\/\*)\s*$/g,"").trim();const e=JSON.parse(n);e["@graph"]&&Array.isArray(e["@graph"])?t.push(...e["@graph"]):t.push(e)}catch(e){console.error("Error parsing schema.org data:",e),console.error("Problematic JSON content:",n)}})),t}function r(){const e=le().length>0;n.runtime.sendMessage({action:"updateHasHighlights",hasHighlights:e})}n.runtime.sendMessage({action:"contentScriptLoaded"}),n.runtime.onMessage.addListener(((e,t,n)=>{if("ping"===e.action)return n({}),!0})),n.runtime.onMessage.addListener((function(o,s,a){if("getPageContent"===o.action){let e="";const n=window.getSelection();if(n&&n.rangeCount>0){const t=n.getRangeAt(0).cloneContents(),i=document.createElement("div");i.appendChild(t),e=i.innerHTML}const i={},r=t(),o=(new DOMParser).parseFromString(document.documentElement.outerHTML,"text/html");o.querySelectorAll("script, style").forEach((e=>e.remove())),o.querySelectorAll("*").forEach((e=>e.removeAttribute("style"))),o.querySelectorAll("[src], [href]").forEach((e=>{["src","href","srcset"].forEach((t=>{const n=e.getAttribute(t);if(n)if("srcset"===t){const i=n.split(",").map((e=>{const[t,n]=e.trim().split(" ");try{return`${new URL(t,document.baseURI).href}${n?" "+n:""}`}catch(t){return e}})).join(", ");e.setAttribute(t,i)}else if(!(n.startsWith("http")||n.startsWith("data:")||n.startsWith("#")||n.startsWith("//")))try{const i=new URL(n,document.baseURI).href;e.setAttribute(t,i)}catch(e){console.warn(`Failed to process ${t} URL:`,n)}}))}));const s=o.documentElement.outerHTML.replace(/\t/g,"").replace(/^[ \t]+/gm,""),l={content:o.documentElement.outerHTML,selectedHtml:e,extractedContent:i,schemaOrgData:r,fullHtml:s,highlights:le()};a(l)}else if("extractContent"===o.action){const e=function(e,t,n=!1){var i;try{const r=document.querySelectorAll(e);return r.length>1?Array.from(r).map((e=>{var i;return t?e.getAttribute(t)||"":n?e.outerHTML:(null===(i=e.textContent)||void 0===i?void 0:i.trim())||""})):1===r.length?t?r[0].getAttribute(t)||"":n?r[0].outerHTML:(null===(i=r[0].textContent)||void 0===i?void 0:i.trim())||"":(console.log(`No elements found for selector: ${e}`),"")}catch(i){return console.error("Error in extractContentBySelector:",i,{selector:e,attribute:t,extractHtml:n}),""}}(o.selector,o.attribute,o.extractHtml);a({content:e,schemaOrgData:t()})}else{if("paintHighlights"===o.action)return ge().then((()=>{S.alwaysShowHighlights&&se(),a({success:!0})})),!0;if("setHighlighterMode"===o.action)return e=o.isActive,j(e),r(),a({success:!0}),!0;if("getHighlighterMode"===o.action)return n.runtime.sendMessage({action:"getHighlighterMode"}).then(a),!0;if("toggleHighlighter"===o.action)j(o.isActive),r(),a({success:!0});else if("highlightSelection"===o.action){if(j(o.isActive),o.highlightData&&"text"===o.highlightData.type){const e=window.getSelection();e&&!e.isCollapsed&&J(e)}r(),a({success:!0})}else if("highlightElement"===o.action){if(j(o.isActive),o.targetElementInfo){const{mediaType:e,srcUrl:t,pageUrl:n}=o.targetElementInfo;let r=null;const s=(e,t)=>{const i=new URL(e,n),r=new URL(t,n);return i.href===r.href};if(r=document.querySelector(`${e}[src="${t}"]`),!r){const n=new URL(t).pathname;r=document.querySelector(`${e}[src="${n}"]`)}if(!r){const n=Array.from(document.getElementsByTagName(e));for(const e of n)if((e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLAudioElement)&&s(e.src,t)){r=e;break}}r?(i(r),z(r)):console.warn("Could not find element to highlight. Info:",o.targetElementInfo)}r(),a({success:!0})}else if("clearHighlights"===o.action)ce(),r(),a({success:!0});else if("getHighlighterState"===o.action)return n.runtime.sendMessage({action:"getHighlighterMode"}).then((e=>{a(e)})).catch((e=>{console.error("Error getting highlighter mode:",e),a({isActive:!1})})),!0}return!0})),function(){var e,t,n,i;e=this,t=void 0,i=function*(){yield H(),yield ge(),S.alwaysShowHighlights&&se(),r()},new((n=void 0)||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))}(),window.addEventListener("load",r),window.addEventListener("beforeunload",(function(){e&&(j(!1),n.runtime.sendMessage({action:"highlighterModeChanged",isActive:!1}),n.storage.local.set({isHighlighterMode:!1}))}))}();