"use strict";(async()=>{await eagle.preference.init(),await eagle.i18n.init();var e=new URL(location.href);let o=document.getElementById("autoscroll"),t=document.getElementById("board"),a=document.getElementById("logs"),n=0;if(e.searchParams.has("download")){const s=$("#exportLogMessage");s.find("h2").text(eagle.i18n.words["log-viewer.exporting-message"]),s.find("p").text(eagle.i18n.words["log-viewer.exporting-description"]),s.css("display","flex"),l(()=>{s.find("p").show(),setTimeout(()=>window.close(),5e3)})}else $("#main").css("display","flex");function i(t,l=!1){const s=new Intl.DateTimeFormat("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});eagle.logger.all(o=>{let a="";for(let t=0;t<o.length;t++){if(o[t].time=s.format(o[t].time),a+=l?`<span class="line">${e=o[t].time,n=o[t].level,i=o[t].descriptor,o[t].data,i.startsWith("[debug]")||i.startsWith("[DEBUG]")?`[${e}] [${n}] <span style="color: red">${i}</span>`:i.startsWith('[background] {"method')?`[${e}] [${n}] [background] <span style="color: #808080">${i.replace("[background] ","")}</span>`:i.startsWith("[background]")?`[${e}] [${n}] <span style="color: #cfcfcf">${i}</span>`:i.startsWith("[content]")?`[${e}] [${n}] <span style="color: #808080">${i}</span>`:`[${e}] [${n}] `+i}</span>`:`[${o[t].time}] [${o[t].level}] `+o[t].descriptor,null!=o[t].data){let e=JSON.stringify(o[t].data);150<=e.length&&(e=e.slice(0,150)+"..."),a+=e}a+=l?"\n<br>":"\n"}var e,n,i;t(a)})}function l(e){e=e||(()=>{}),i(o=>{o=fflate.zipSync({"extension.log":fflate.strToU8(o)},{level:9});{let e=new Blob([o],{type:"application/octet-stream"}),t=window.URL.createObjectURL(e);{o=e;let t=new FileReader;t.onload=()=>{var e=document.createElement("a");e.setAttribute("href",t.result),e.setAttribute("download","extension-log.zip"),document.body.appendChild(e),e.click()},t.readAsDataURL(o)}setTimeout(()=>window.URL.revokeObjectURL(t),1e3)}e()})}$("#download").click(()=>{l()}),$(t).scroll(function(e){var t=$(this).scrollTop();t>n||(o.checked=!1),n=t}),$(document).on("click",".line",function(e){var t=$(this).text();navigator.clipboard?navigator.clipboard.writeText(t).then(()=>{},e=>{}):fallbackCopyTextToClipboard(t)}),setInterval(()=>{2===eagle.logger.status()&&i(e=>{a.innerHTML=e,1==o.checked&&(t.scrollTop=t.scrollHeight)},!0)},800)})();