function e(e,t,n,i){Object.defineProperty(e,t,{get:n,set:i,enumerable:!0,configurable:!0})}var t=globalThis,n={},i={},a=t.parcelRequire94c2;null==a&&((a=function(e){if(e in n)return n[e].exports;if(e in i){var t=i[e];delete i[e];var a={id:e,exports:{}};return n[e]=a,t.call(a.exports,a,a.exports),a.exports}var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){i[e]=t},t.parcelRequire94c2=a);var s=a.register;s("k82Ot",function(e,t){var n=a("d8ymB");function i(e){document.getElementById("error-text").innerText=e.message,(0,n.default).getOrCreateInstance(document.getElementById("error-toast")).show()}window.addEventListener("error",function(e){return i(e.error),!1}),window.addEventListener("unhandledrejection",function(e){return i(e.reason),!1})}),s("d8ymB",function(t,n){e(t.exports,"default",()=>v);var i=a("hnAIs"),s=a("e3sMm"),l=a("8L2u6"),o=a("8psKi");let r=".bs.toast",d=`mouseover${r}`,c=`mouseout${r}`,u=`focusin${r}`,m=`focusout${r}`,g=`hide${r}`,p=`hidden${r}`,h=`show${r}`,f=`shown${r}`,E="hide",y="show",b="showing",w={animation:"boolean",autohide:"boolean",delay:"number"},_={animation:!0,autohide:!0,delay:5e3};class I extends i.default{constructor(e,t){super(e,t),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return _}static get DefaultType(){return w}static get NAME(){return"toast"}show(){(0,s.default).trigger(this._element,h).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(E),(0,o.reflow)(this._element),this._element.classList.add(y,b),this._queueCallback(()=>{this._element.classList.remove(b),(0,s.default).trigger(this._element,f),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&!(0,s.default).trigger(this._element,g).defaultPrevented&&(this._element.classList.add(b),this._queueCallback(()=>{this._element.classList.add(E),this._element.classList.remove(b,y),(0,s.default).trigger(this._element,p)},this._element,this._config.animation))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(y),super.dispose()}isShown(){return this._element.classList.contains(y)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(e,t){switch(e.type){case"mouseover":case"mouseout":this._hasMouseInteraction=t;break;case"focusin":case"focusout":this._hasKeyboardInteraction=t}if(t){this._clearTimeout();return}let n=e.relatedTarget;this._element===n||this._element.contains(n)||this._maybeScheduleHide()}_setListeners(){(0,s.default).on(this._element,d,e=>this._onInteraction(e,!0)),(0,s.default).on(this._element,c,e=>this._onInteraction(e,!1)),(0,s.default).on(this._element,u,e=>this._onInteraction(e,!0)),(0,s.default).on(this._element,m,e=>this._onInteraction(e,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(e){return this.each(function(){let t=I.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw TypeError(`No method named "${e}"`);t[e](this)}})}}(0,l.enableDismissTrigger)(I),(0,o.defineJQueryPlugin)(I);var v=I}),s("8L2u6",function(t,n){e(t.exports,"enableDismissTrigger",()=>o);var i=a("e3sMm"),s=a("5Xvlb"),l=a("8psKi");let o=(e,t="hide")=>{let n=`click.dismiss${e.EVENT_KEY}`,a=e.NAME;(0,i.default).on(document,n,`[data-bs-dismiss="${a}"]`,function(n){if(["A","AREA"].includes(this.tagName)&&n.preventDefault(),(0,l.isDisabled)(this))return;let i=(0,s.default).getElementFromSelector(this)||this.closest(`.${a}`);e.getOrCreateInstance(i)[t]()})}}),s("2FsxV",function(t,n){e(t.exports,"default",()=>T);var i=a("hnAIs"),s=a("e3sMm"),l=a("5Xvlb"),o=a("8psKi");let r=".bs.tab",d=`hide${r}`,c=`hidden${r}`,u=`show${r}`,m=`shown${r}`,g=`click${r}`,p=`keydown${r}`,h=`load${r}`,f="ArrowRight",E="ArrowDown",y="Home",b="active",w="fade",_="show",I=".dropdown-toggle",v=`:not(${I})`,L=`.nav-link${v}, .list-group-item${v}, [role="tab"]${v}`,B='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',A=`${L}, ${B}`,P=`.${b}[data-bs-toggle="tab"], .${b}[data-bs-toggle="pill"], .${b}[data-bs-toggle="list"]`;class k extends i.default{constructor(e){if(super(e),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),!this._parent)return;this._setInitialAttributes(this._parent,this._getChildren()),(0,s.default).on(this._element,p,e=>this._keydown(e))}static get NAME(){return"tab"}show(){let e=this._element;if(this._elemIsActive(e))return;let t=this._getActiveElem(),n=t?(0,s.default).trigger(t,d,{relatedTarget:e}):null;(0,s.default).trigger(e,u,{relatedTarget:t}).defaultPrevented||n&&n.defaultPrevented||(this._deactivate(t,e),this._activate(e,t))}_activate(e,t){e&&(e.classList.add(b),this._activate((0,l.default).getElementFromSelector(e)),this._queueCallback(()=>{if("tab"!==e.getAttribute("role")){e.classList.add(_);return}e.removeAttribute("tabindex"),e.setAttribute("aria-selected",!0),this._toggleDropDown(e,!0),(0,s.default).trigger(e,m,{relatedTarget:t})},e,e.classList.contains(w)))}_deactivate(e,t){e&&(e.classList.remove(b),e.blur(),this._deactivate((0,l.default).getElementFromSelector(e)),this._queueCallback(()=>{if("tab"!==e.getAttribute("role")){e.classList.remove(_);return}e.setAttribute("aria-selected",!1),e.setAttribute("tabindex","-1"),this._toggleDropDown(e,!1),(0,s.default).trigger(e,c,{relatedTarget:t})},e,e.classList.contains(w)))}_keydown(e){let t;if(!["ArrowLeft",f,"ArrowUp",E,y,"End"].includes(e.key))return;e.stopPropagation(),e.preventDefault();let n=this._getChildren().filter(e=>!(0,o.isDisabled)(e));if([y,"End"].includes(e.key))t=n[e.key===y?0:n.length-1];else{let i=[f,E].includes(e.key);t=(0,o.getNextActiveElement)(n,e.target,i,!0)}t&&(t.focus({preventScroll:!0}),k.getOrCreateInstance(t).show())}_getChildren(){return(0,l.default).find(A,this._parent)}_getActiveElem(){return this._getChildren().find(e=>this._elemIsActive(e))||null}_setInitialAttributes(e,t){for(let n of(this._setAttributeIfNotExists(e,"role","tablist"),t))this._setInitialAttributesOnChild(n)}_setInitialAttributesOnChild(e){e=this._getInnerElement(e);let t=this._elemIsActive(e),n=this._getOuterElement(e);e.setAttribute("aria-selected",t),n!==e&&this._setAttributeIfNotExists(n,"role","presentation"),t||e.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(e,"role","tab"),this._setInitialAttributesOnTargetPanel(e)}_setInitialAttributesOnTargetPanel(e){let t=(0,l.default).getElementFromSelector(e);t&&(this._setAttributeIfNotExists(t,"role","tabpanel"),e.id&&this._setAttributeIfNotExists(t,"aria-labelledby",`${e.id}`))}_toggleDropDown(e,t){let n=this._getOuterElement(e);if(!n.classList.contains("dropdown"))return;let i=(e,i)=>{let a=(0,l.default).findOne(e,n);a&&a.classList.toggle(i,t)};i(I,b),i(".dropdown-menu",_),n.setAttribute("aria-expanded",t)}_setAttributeIfNotExists(e,t,n){e.hasAttribute(t)||e.setAttribute(t,n)}_elemIsActive(e){return e.classList.contains(b)}_getInnerElement(e){return e.matches(A)?e:(0,l.default).findOne(A,e)}_getOuterElement(e){return e.closest(".nav-item, .list-group-item")||e}static jQueryInterface(e){return this.each(function(){let t=k.getOrCreateInstance(this);if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw TypeError(`No method named "${e}"`);t[e]()}})}}(0,s.default).on(document,g,B,function(e){["A","AREA"].includes(this.tagName)&&e.preventDefault(),(0,o.isDisabled)(this)||k.getOrCreateInstance(this).show()}),(0,s.default).on(window,h,()=>{for(let e of(0,l.default).find(P))k.getOrCreateInstance(e)}),(0,o.defineJQueryPlugin)(k);var T=k}),a("k82Ot"),a("eme3Z");var l=a("8DrFe"),o=a("hnAIs"),r=a("e3sMm"),d=a("5Xvlb"),c=a("9AikM"),u=a("8L2u6"),m=a("k2zBL"),g=a("8psKi"),p=a("3IXkZ");const h=".bs.offcanvas",f=".data-api",E=`load${h}${f}`,y="show",b="showing",w="hiding",_=".offcanvas.show",I=`show${h}`,v=`shown${h}`,L=`hide${h}`,B=`hidePrevented${h}`,A=`hidden${h}`,P=`resize${h}`,k=`click${h}${f}`,T=`keydown.dismiss${h}`,x={backdrop:!0,keyboard:!0,scroll:!1},C={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class R extends o.default{constructor(e,t){super(e,t),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return x}static get DefaultType(){return C}static get NAME(){return"offcanvas"}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){this._isShown||(0,r.default).trigger(this._element,I,{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new(0,p.default)().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(b),this._queueCallback(()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(y),this._element.classList.remove(b),(0,r.default).trigger(this._element,v,{relatedTarget:e})},this._element,!0))}hide(){this._isShown&&!(0,r.default).trigger(this._element,L).defaultPrevented&&(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(w),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(y,w),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new(0,p.default)().reset(),(0,r.default).trigger(this._element,A)},this._element,!0))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){let e=!!this._config.backdrop;return new c.default({className:"offcanvas-backdrop",isVisible:e,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:e?()=>{if("static"===this._config.backdrop){(0,r.default).trigger(this._element,B);return}this.hide()}:null})}_initializeFocusTrap(){return new m.default({trapElement:this._element})}_addEventListeners(){(0,r.default).on(this._element,T,e=>{if("Escape"===e.key){if(this._config.keyboard){this.hide();return}(0,r.default).trigger(this._element,B)}})}static jQueryInterface(e){return this.each(function(){let t=R.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw TypeError(`No method named "${e}"`);t[e](this)}})}}(0,r.default).on(document,k,'[data-bs-toggle="offcanvas"]',function(e){let t=(0,d.default).getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&e.preventDefault(),(0,g.isDisabled)(this))return;(0,r.default).one(t,A,()=>{(0,g.isVisible)(this)&&this.focus()});let n=(0,d.default).findOne(_);n&&n!==t&&R.getInstance(n).hide(),R.getOrCreateInstance(t).toggle(this)}),(0,r.default).on(window,E,()=>{for(let e of(0,d.default).find(_))R.getOrCreateInstance(e).show()}),(0,r.default).on(window,P,()=>{for(let e of(0,d.default).find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(e).position&&R.getOrCreateInstance(e).hide()}),(0,u.enableDismissTrigger)(R),(0,g.defineJQueryPlugin)(R);var S=a("2FsxV"),O=a("d8ymB"),U=a("eZukr"),M=a("fEci9"),N=a("foKjy"),F=a("4rDM0");async function D(){let e=document.getElementById("site-install-button"),t=(await browser.tabs.query({active:!0,currentWindow:!0}))[0];t.url&&(t.url.startsWith("http://")||t.url.startsWith("https://"))||e.classList.add("d-none"),e.addEventListener("click",async()=>{document.location=browser.runtime.getURL("sites/install.html")});let n=Object.values(await (0,M.obtainSiteList)()),i=await (0,M.obtainProfileList)(),a=document.getElementById("sites-list"),s=document.getElementById("sites-list-template"),o=document.getElementById("sites-list-loading"),r=document.getElementById("sites-list-empty");for(let e of(o.classList.add("d-none"),n.length||r.classList.remove("d-none"),n)){let t=s.content.firstElementChild.cloneNode(!0),o=(0,M.sanitizeString)(e.config.name||e.manifest.name||e.manifest.short_name)||new URL(e.manifest.scope).host,r=(0,M.sanitizeString)(e.config.description||e.manifest.description)||"",d=e.config.icon_url||(0,M.getIcon)((0,M.buildIconList)(e.manifest.icons),64),c=t.querySelector("#sites-list-template-letter");d&&c.classList.add("d-none"),c.setAttribute("data-letter",o[0]),c.removeAttribute("id");let u=t.querySelector("#sites-list-template-icon");d||u.classList.add("d-none"),u.src=d,u.setAttribute("alt",await (0,N.getMessage)("managePageAppListIcon")),u.removeAttribute("id"),u.onerror=()=>{c.classList.remove("d-none"),u.classList.add("d-none")};let m=t.querySelector("#sites-list-template-title");m.innerText=o,m.removeAttribute("id");let g=t.querySelector("#sites-list-template-description");g.innerText=r,g.removeAttribute("id");let p=t.querySelector("#sites-list-template-launch"),h=await (0,N.getMessage)("managePageAppListLaunch");p.addEventListener("click",()=>{(0,M.launchSite)(e)}),p.setAttribute("title",h),p.setAttribute("aria-label",h),p.removeAttribute("id");let f=t.querySelector("#sites-list-template-edit"),E=await (0,N.getMessage)("managePageAppListEdit");f.addEventListener("click",async t=>{let a=document.getElementById("web-app-form"),s=document.getElementById("web-app-submit");document.getElementById("web-app-name").setAttribute("placeholder",(0,M.sanitizeString)(e.manifest.name||e.manifest.short_name)||new URL(e.manifest.scope).host),document.getElementById("web-app-description").setAttribute("placeholder",(0,M.sanitizeString)(e.manifest.description)||""),document.getElementById("web-app-start-url").setAttribute("placeholder",e.manifest.start_url),document.getElementById("web-app-name").value=e.config.name||"",document.getElementById("web-app-description").value=e.config.description||"",document.getElementById("web-app-start-url").value=e.config.start_url,document.getElementById("web-app-icon-url").value=e.config.icon_url,document.getElementById("web-app-ulid").value=e.ulid;let l=document.getElementById("web-app-categories");l.tagsInstance.resetSearchInput(),l.tagsInstance.reset();let o=e.config.categories?.length?e.config.categories:e.manifest.categories;for(let e of o=o?.map(e=>M.sanitizeString(e)).filter(e=>e)||[])l.tagsInstance.addItem(e,e);let r=document.getElementById("web-app-keywords");r.tagsInstance.resetSearchInput(),r.tagsInstance.reset();let d=e.config.keywords?.length?e.config.keywords:e.manifest.keywords;for(let e of d=d?.map(e=>M.sanitizeString(e)).filter(e=>e)||[])r.tagsInstance.addItem(e,e);let c=document.getElementById("web-app-profile");c.replaceChildren(),c.add(new Option((0,M.sanitizeString)(i[e.profile].name)||e.profile,e.profile));let u=await browser.runtime.getPlatformInfo();if("mac"!==u.os){let t=new Set([...e.config.custom_protocol_handlers,...e.manifest.protocol_handlers].map(e=>(0,M.sanitizeString)(e.protocol)).filter(e=>e).sort()),n=e.config.enabled_protocol_handlers.map(e=>(0,M.sanitizeString)(e)).filter(e=>e),i=document.getElementById("web-app-protocol-handlers-box"),a=document.getElementById("web-app-protocol-handlers-list");for(let e of(a.replaceChildren(),t))if((0,M.isProtocolSchemePermitted)(e)){let t=document.createElement("input");t.classList.add("web-app-protocol-handler","form-check-input","me-1"),t.type="checkbox",t.value=e,n.includes(e)&&(t.checked=!0);let i=document.createElement("span");i.innerText=e;let s=document.createElement("label");s.classList.add("list-group-item"),s.append(t,i),a.append(s)}a.children.length?i.classList.remove("d-none"):i.classList.add("d-none")}"mac"===u.os&&document.getElementById("web-app-launch-on-login-box").classList.add("d-none"),(await browser.storage.local.get(M.PREF_ENABLE_AUTO_LAUNCH))[M.PREF_ENABLE_AUTO_LAUNCH]?(document.getElementById("web-app-auto-launch").checked=e.config.enabled_url_handlers?.length,document.getElementById("web-app-auto-launch-box").classList.remove("d-none")):document.getElementById("web-app-auto-launch-box").classList.add("d-none"),document.getElementById("web-app-launch-on-login").checked=e.config.launch_on_login,document.getElementById("web-app-launch-on-browser").checked=e.config.launch_on_browser,a.classList.add("was-validated"),s.disabled=!1,s.innerText=await (0,N.getMessage)("buttonEditDefault");let m=async function(){let t=document.getElementById("web-app-name-invalid"),i=this.value||this.getAttribute("placeholder");if(n.filter(t=>e.ulid!==t.ulid).map(e=>e.config.name||e.manifest.name||e.manifest.short_name||new URL(e.manifest.scope).host).includes(i)){this.setCustomValidity(await (0,N.getMessage)("webAppValidationNameReuse")),t.innerText=this.validationMessage;return}this.setCustomValidity("")},g=document.getElementById("web-app-name");g.oninput=m,m.call(g);let p=async function(){let t=document.getElementById("web-app-start-url-invalid"),n=document.getElementById("web-app-start-url-warning");if(!this.value){this.setCustomValidity(""),this.classList.remove("is-warning");return}if(this.validity.typeMismatch){this.classList.remove("is-warning"),this.setCustomValidity(await (0,N.getMessage)("webAppValidationStartURLInvalid")),t.innerText=this.validationMessage;return}let i=new URL(this.value),a=new URL(e.manifest.scope);if(i.origin!==a.origin||!i.pathname.startsWith(a.pathname)){this.setCustomValidity(""),n.innerText=`${await (0,N.getMessage)("webAppValidationStartURLScope")} ${a}`,this.classList.add("is-warning");return}this.setCustomValidity(""),this.classList.remove("is-warning")},h=document.getElementById("web-app-start-url");h.oninput=p,p.call(h);let f=async function(){let e=document.getElementById("web-app-icon-url-invalid");if(!this.value){this.setCustomValidity("");return}if(this.validity.typeMismatch){this.setCustomValidity(await (0,N.getMessage)("webAppValidationIconURLInvalid")),e.innerText=this.validationMessage;return}this.setCustomValidity("")},E=document.getElementById("web-app-icon-url");E.addEventListener("input",f),f.call(E),s.onclick=async t=>{if(t.preventDefault(),t.stopPropagation(),!a.checkValidity())return;s.disabled=!0,s.innerText=await (0,N.getMessage)("buttonEditProcessing");let n=document.getElementById("web-app-start-url").value||null,i=document.getElementById("web-app-icon-url").value||null,l=document.getElementById("web-app-name").value||null,o=document.getElementById("web-app-description").value||null,r=[...document.getElementById("web-app-categories").selectedOptions].map(e=>e.value),d=e.manifest.categories?.map(e=>M.sanitizeString(e)).filter(e=>e)||[],c=r.toString()!==d.toString()?r:null,u=[...document.getElementById("web-app-keywords").selectedOptions].map(e=>e.value),m=e.manifest.keywords?.map(e=>M.sanitizeString(e)).filter(e=>e)||[],g=u.toString()!==m.toString()?u:null,p=[...document.querySelectorAll(".web-app-protocol-handler:checked")].map(e=>e.value),h=document.getElementById("web-app-auto-launch").checked,f=[];h&&f.push(e.manifest.scope);let E=await browser.runtime.sendNativeMessage("firefoxpwa",{cmd:"UpdateSite",params:{id:e.ulid,start_url:n,icon_url:i,name:l,description:o,categories:c,keywords:g,enabled_url_handlers:f,enabled_protocol_handlers:p,launch_on_login:document.getElementById("web-app-launch-on-login").checked,launch_on_browser:document.getElementById("web-app-launch-on-browser").checked,update_manifest:document.getElementById("web-app-update-manifest").checked,update_icons:document.getElementById("web-app-update-icons").checked}});if("Error"===E.type)throw Error(E.data);if("SiteUpdated"!==E.type)throw Error(`Received invalid response type: ${E.type}`);(0,O.default).getOrCreateInstance(document.getElementById("error-toast")).hide(),s.disabled=!0,s.innerText=await (0,N.getMessage)("buttonEditFinished"),setTimeout(async()=>{window.close()},5e3)},R.getOrCreateInstance(document.getElementById("site-edit-offcanvas")).show(),t.preventDefault()}),f.setAttribute("title",E),f.setAttribute("aria-label",E),f.removeAttribute("id");let y=t.querySelector("#sites-list-template-remove"),b=await (0,N.getMessage)("managePageAppListRemove");y.addEventListener("click",()=>{let t=i[e.profile].sites.length<=1;document.getElementById("site-remove-button").onclick=async function(){this.disabled=!0,this.innerText=await (0,N.getMessage)("buttonRemoveProcessing");let n=document.getElementById("site-remove-last-checkbox"),i=n.checked;if(n.disabled=!0,t&&i){let t=await browser.runtime.sendNativeMessage("firefoxpwa",{cmd:"RemoveProfile",params:{id:e.profile}});if("Error"===t.type)throw Error(t.data);if("ProfileRemoved"!==t.type)throw Error(`Received invalid response type: ${t.type}`)}else{let t=await browser.runtime.sendNativeMessage("firefoxpwa",{cmd:"UninstallSite",params:{id:e.ulid}});if("Error"===t.type)throw Error(t.data);if("SiteUninstalled"!==t.type)throw Error(`Received invalid response type: ${t.type}`)}this.disabled=!0,this.innerText=await (0,N.getMessage)("buttonRemoveProcessing"),setTimeout(async()=>{window.close()},5e3)},t?(document.getElementById("site-remove-last").hidden=!1,document.getElementById("site-remove-not-last").hidden=!0):(document.getElementById("site-remove-last").hidden=!0,document.getElementById("site-remove-not-last").hidden=!1),(0,l.default).getOrCreateInstance(document.getElementById("site-remove-modal")).show()}),y.setAttribute("title",b),y.setAttribute("aria-label",b),y.removeAttribute("id"),a.insertBefore(t,s)}}async function $(){document.getElementById("profile-create-button").addEventListener("click",async e=>{let t=document.getElementById("profile-form"),n=document.getElementById("profile-submit");document.getElementById("profile-edit-label").innerText=await (0,N.getMessage)("managePageProfileListCreate"),document.getElementById("profile-name").value="",document.getElementById("profile-description").value="";let i=(await browser.storage.local.get([M.PREF_DEFAULT_PROFILE_TEMPLATE]))[M.PREF_DEFAULT_PROFILE_TEMPLATE];document.getElementById("profile-template-div").classList.remove("d-none"),document.getElementById("profile-template").value=i||null,document.getElementById("profile-ulid-div").classList.add("d-none"),document.getElementById("profile-template-editing-div").classList.add("d-none"),document.getElementById("profile-template-editing").required=!1,document.getElementById("profile-template-editing").disabled=!0,t.classList.add("was-validated"),n.disabled=!1,n.innerText=await (0,N.getMessage)("buttonCreateDefault"),n.onclick=async e=>{if(e.preventDefault(),e.stopPropagation(),!t.checkValidity())return;n.disabled=!0,n.innerText=await (0,N.getMessage)("buttonCreateProcessing");let i=await browser.runtime.sendNativeMessage("firefoxpwa",{cmd:"CreateProfile",params:{name:document.getElementById("profile-name").value||null,description:document.getElementById("profile-description").value||null,template:document.getElementById("profile-template").value||null}});if("Error"===i.type)throw Error(i.data);if("ProfileCreated"!==i.type)throw Error(`Received invalid response type: ${i.type}`);(0,O.default).getOrCreateInstance(document.getElementById("error-toast")).hide(),n.disabled=!0,n.innerText=await (0,N.getMessage)("buttonCreateFinished"),setTimeout(async()=>{window.close()},5e3)},R.getOrCreateInstance(document.getElementById("profile-edit-offcanvas")).show(),e.preventDefault()});let e=Object.values(await (0,M.obtainProfileList)()),t=document.getElementById("profiles-list"),n=document.getElementById("profiles-list-template"),i=document.getElementById("profiles-list-loading"),a=document.getElementById("profiles-list-empty");for(let s of(i.classList.add("d-none"),e.length||a.classList.remove("d-none"),e)){let e=n.content.firstElementChild.cloneNode(!0),i=e.querySelector("#profiles-list-template-name");i.innerText=(0,M.sanitizeString)(s.name)||await (0,N.getMessage)("managePageProfileListUnnamed"),i.removeAttribute("id");let a=e.querySelector("#profiles-list-template-count");a.innerText=`(${await (0,N.getMessage)("managePageProfileListCount",void 0,s.sites.length)})`,0===s.sites.length&&a.classList.add("text-opacity-50"),a.removeAttribute("id");let o=e.querySelector("#profiles-list-template-description");o.innerText=(0,M.sanitizeString)(s.description)||"",o.removeAttribute("id");let r=e.querySelector("#profiles-list-template-edit"),d=await (0,N.getMessage)("managePageProfileListEdit");r.addEventListener("click",async e=>{let t=document.getElementById("profile-form"),n=document.getElementById("profile-submit");document.getElementById("profile-edit-label").innerText=await (0,N.getMessage)("managePageProfileListEdit"),document.getElementById("profile-name").value=s.name||"",document.getElementById("profile-description").value=s.description||"",document.getElementById("profile-ulid").value=s.ulid,document.getElementById("profile-template-editing-apply").checked=!1,document.getElementById("profile-template-div").classList.add("d-none"),document.getElementById("profile-ulid-div").classList.remove("d-none");let i=(await browser.storage.local.get([M.PREF_DEFAULT_PROFILE_TEMPLATE]))[M.PREF_DEFAULT_PROFILE_TEMPLATE];document.getElementById("profile-template-editing-div").classList.remove("d-none"),document.getElementById("profile-template-editing").value=i||null;let a=function(){let e=document.getElementById("profile-template-editing");this.checked?(e.required=!0,e.disabled=!1):(e.required=!1,e.disabled=!0)},l=document.getElementById("profile-template-editing-apply");l.onchange=a,a.call(l),t.classList.add("was-validated"),n.disabled=!1,n.innerText=await (0,N.getMessage)("buttonEditDefault"),n.onclick=async e=>{if(e.preventDefault(),e.stopPropagation(),!t.checkValidity())return;n.disabled=!0,n.innerText=await (0,N.getMessage)("buttonEditProcessing");let i=l.checked&&document.getElementById("profile-template-editing").value||null,a=await browser.runtime.sendNativeMessage("firefoxpwa",{cmd:"UpdateProfile",params:{id:s.ulid,name:document.getElementById("profile-name").value||null,description:document.getElementById("profile-description").value||null,template:i}});if("Error"===a.type)throw Error(a.data);if("ProfileUpdated"!==a.type)throw Error(`Received invalid response type: ${a.type}`);(0,O.default).getOrCreateInstance(document.getElementById("error-toast")).hide(),n.disabled=!0,n.innerText=await (0,N.getMessage)("buttonEditFinished"),setTimeout(async()=>{window.close()},5e3)},R.getOrCreateInstance(document.getElementById("profile-edit-offcanvas")).show(),e.preventDefault()}),r.setAttribute("title",d),r.setAttribute("aria-label",d),r.removeAttribute("id");let c=e.querySelector("#profiles-list-template-remove"),u=await (0,N.getMessage)("managePageProfileListRemove");c.addEventListener("click",()=>{document.getElementById("profile-remove-button").onclick=async function(){this.disabled=!0,this.innerText=await (0,N.getMessage)("buttonRemoveProcessing");let e=await browser.runtime.sendNativeMessage("firefoxpwa",{cmd:"RemoveProfile",params:{id:s.ulid}});if("Error"===e.type)throw Error(e.data);if("ProfileRemoved"!==e.type)throw Error(`Received invalid response type: ${e.type}`);this.disabled=!0,this.innerText=await (0,N.getMessage)("buttonRemoveFinished"),setTimeout(async()=>{window.close()},5e3)};let e="0".repeat(26);s.ulid===e?document.getElementById("profile-remove-default").classList.remove("d-none"):document.getElementById("profile-remove-default").classList.add("d-none"),(0,l.default).getOrCreateInstance(document.getElementById("profile-remove-modal")).show()}),c.setAttribute("title",u),c.setAttribute("aria-label",u),c.removeAttribute("id"),t.insertBefore(e,n)}}async function q(){let e=function(e){document.getElementById("search-box").classList.remove("invisible"),document.getElementById("search-input").oninput=function(){for(let t of document.getElementById(e).children){let e=(0,M.sanitizeString)(t.querySelector(".list-group-item-name")?.innerText.toLowerCase()),n=(0,M.sanitizeString)(this.value.toLowerCase());e&&t.classList.toggle("d-none",-1===e.indexOf(n))}}},t=function(){document.getElementById("search-box").classList.add("invisible")};document.getElementById("sites-tab").addEventListener("click",()=>e("sites-list")),document.getElementById("profiles-tab").addEventListener("click",()=>e("profiles-list")),document.getElementById("settings-tab").addEventListener("click",()=>t()),e("sites-list")}async function H(e=!1){let t=await browser.storage.local.get([M.PREF_DISPLAY_PAGE_ACTION,M.PREF_LAUNCH_CURRENT_URL,M.PREF_SHOW_UPDATE_POPUP,M.PREF_ENABLE_AUTO_LAUNCH,M.PREF_DEFAULT_PROFILE_TEMPLATE,M.PREF_AUTO_LAUNCH_EXCLUSION]),n=t[M.PREF_DISPLAY_PAGE_ACTION]?t[M.PREF_DISPLAY_PAGE_ACTION]:"valid",i=void 0===t[M.PREF_LAUNCH_CURRENT_URL]||t[M.PREF_LAUNCH_CURRENT_URL],a=void 0===t[M.PREF_SHOW_UPDATE_POPUP]||t[M.PREF_SHOW_UPDATE_POPUP],s=void 0!==t[M.PREF_ENABLE_AUTO_LAUNCH]&&t[M.PREF_ENABLE_AUTO_LAUNCH],o=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,r=t[M.PREF_DEFAULT_PROFILE_TEMPLATE]||null,d=t[M.PREF_AUTO_LAUNCH_EXCLUSION]||null;if(document.getElementById("settings-display-page-action").querySelector(`#settings-display-page-action-${n}`).checked=!0,document.getElementById("settings-launch-current-url").checked=i,document.getElementById("settings-show-update-popup").checked=a,document.getElementById("settings-enable-auto-launch").checked=s,document.getElementById("settings-enable-dark-mode").checked=o,document.getElementById("settings-default-profile-template").value=r,document.getElementById("settings-auto-launch-exclusion").value=d,e)return;document.getElementById("settings-display-page-action").addEventListener("change",async function(){await browser.storage.local.set({[M.PREF_DISPLAY_PAGE_ACTION]:this.querySelector(":checked").value})}),document.getElementById("settings-launch-current-url").addEventListener("change",async function(){await browser.storage.local.set({[M.PREF_LAUNCH_CURRENT_URL]:this.checked})}),document.getElementById("settings-show-update-popup").addEventListener("change",async function(){await browser.storage.local.set({[M.PREF_SHOW_UPDATE_POPUP]:this.checked})});let c=document.getElementById("settings-enable-auto-launch"),u=document.getElementById("enable-auto-launch-modal"),m=document.getElementById("enable-auto-launch-confirm");u.addEventListener("hide.bs.modal",async function(){(await browser.storage.local.get(M.PREF_ENABLE_AUTO_LAUNCH))[M.PREF_ENABLE_AUTO_LAUNCH]||(c.checked=!1)}),m.onclick=async function(){await browser.permissions.request(M.AUTO_LAUNCH_PERMISSIONS)&&(await browser.storage.local.set({[M.PREF_ENABLE_AUTO_LAUNCH]:!0}),(0,l.default).getOrCreateInstance(u).hide())},c.addEventListener("change",async function(){this.checked?(0,l.default).getOrCreateInstance(u).show():await browser.storage.local.set({[M.PREF_ENABLE_AUTO_LAUNCH]:!1})}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>H(!0)),document.getElementById("settings-default-profile-template").addEventListener("change",async function(){await browser.storage.local.set({[M.PREF_DEFAULT_PROFILE_TEMPLATE]:this.value||null})}),document.getElementById("settings-auto-launch-exclusion").addEventListener("change",async function(){await browser.storage.local.set({[M.PREF_AUTO_LAUNCH_EXCLUSION]:this.value||null})});let g=document.getElementById("settings-language"),p=new Intl.DisplayNames(["en"],{type:"language",languageDisplay:"standard"}),h=(0,N.getAllLocales)().map(e=>[p.of(e),e]).sort((e,t)=>e[0].localeCompare(t[0],"en")),f=await (0,N.getCurrentLocale)();for(let[e,t]of h)g.append(new Option(e,t,t===f,t===f));g.addEventListener("change",async function(){await browser.storage.local.set({[M.PREF_LOCALE]:this.value})}),document.getElementById("update-all-sites-button").onclick=async function(){this.disabled=!0,this.innerText=await (0,N.getMessage)("buttonUpdateProcessing");let e=document.getElementById("update-all-sites-manifests"),t=e.checked;e.disabled=!0;let n=await browser.runtime.sendNativeMessage("firefoxpwa",{cmd:"UpdateAllSites",params:{update_manifest:t,update_icons:!0}});if("Error"===n.type)throw Error(n.data);if("AllSitesUpdated"!==n.type)throw Error(`Received invalid response type: ${n.type}`);this.disabled=!0,this.innerText=await (0,N.getMessage)("buttonUpdateFinished")},document.getElementById("update-all-sites").onclick=async function(){let e=document.getElementById("update-all-sites-button");e.disabled=!1,e.innerText=await (0,N.getMessage)("buttonUpdateDefault"),(0,l.default).getOrCreateInstance(document.getElementById("update-all-sites-modal")).show()},document.getElementById("patch-all-profiles-button").onclick=async function(){this.disabled=!0,this.innerText=await (0,N.getMessage)("buttonPatchProcessing");let e=document.getElementById("patch-all-profiles-runtime"),t=e.checked;e.disabled=!0;let n=document.getElementById("patch-all-profiles-profiles"),i=n.checked;n.disabled=!0;let a=await browser.runtime.sendNativeMessage("firefoxpwa",{cmd:"PatchAllProfiles",params:{patch_runtime:t,patch_profiles:i}});if("Error"===a.type)throw Error(a.data);if("AllProfilesPatched"!==a.type)throw Error(`Received invalid response type: ${a.type}`);this.disabled=!0,this.innerText=await (0,N.getMessage)("buttonPatchFinished")},document.getElementById("patch-all-profiles").onclick=async function(){let e=document.getElementById("patch-all-profiles-button");e.disabled=!1,e.innerText=await (0,N.getMessage)("buttonPatchDefault"),(0,l.default).getOrCreateInstance(document.getElementById("patch-all-profiles-modal")).show()},document.getElementById("reinstall-runtime-button").onclick=async function(){this.disabled=!0,this.innerText=await (0,N.getMessage)("buttonReinstallProcessing");let e=await browser.runtime.sendNativeMessage("firefoxpwa",{cmd:"UninstallRuntime"});if("Error"===e.type)throw Error(e.data);if("RuntimeUninstalled"!==e.type)throw Error(`Received invalid response type: ${e.type}`);let t=await browser.runtime.sendNativeMessage("firefoxpwa",{cmd:"InstallRuntime"});if("Error"===t.type)throw Error(t.data);if("RuntimeInstalled"!==t.type)throw Error(`Received invalid response type: ${t.type}`);this.disabled=!0,this.innerText=await (0,N.getMessage)("buttonReinstallFinished")},document.getElementById("reinstall-runtime").onclick=async function(){let e=document.getElementById("reinstall-runtime-button");e.disabled=!1,e.innerText=await (0,N.getMessage)("buttonReinstallDefault"),(0,l.default).getOrCreateInstance(document.getElementById("reinstall-runtime-modal")).show()},document.getElementById("about-project").onclick=async function(){let e=await browser.runtime.sendNativeMessage("firefoxpwa",{cmd:"GetSystemVersions"});if("Error"===e.type)throw Error(e.data);if("SystemVersions"!==e.type)throw Error(`Received invalid response type: ${e.type}`);let t=browser.runtime.getManifest().version,n=e.data.firefoxpwa,i=e.data.firefox,a=(await browser.runtime.getBrowserInfo()).version;document.getElementById("about-extension-version").innerText=t,document.getElementById("about-native-version").innerText=n,document.getElementById("about-runtime-version").innerText=i,document.getElementById("about-firefox-version").innerText=a,(0,l.default).getOrCreateInstance(document.getElementById("about-project-modal")).show()},setTimeout(async()=>{let e=await browser.runtime.getPlatformInfo();("linux"===e.os||"openbsd"===e.os)&&(document.getElementById("settings-enable-wayland-container").classList.remove("d-none"),document.getElementById("settings-use-xinput2-container").classList.remove("d-none"),document.getElementById("settings-use-portals-container").classList.remove("d-none")),"mac"===e.os&&document.getElementById("settings-always-patch-container").classList.add("d-none");let t=await (0,M.getConfig)();document.getElementById("settings-enable-wayland").checked=t.runtime_enable_wayland,document.getElementById("settings-use-xinput2").checked=t.runtime_use_xinput2,document.getElementById("settings-use-portals").checked=t.runtime_use_portals,document.getElementById("settings-always-patch").checked=t.always_patch,document.getElementById("settings-enable-wayland-container").title="",document.getElementById("settings-use-xinput2-container").title="",document.getElementById("settings-use-portals-container").title="",document.getElementById("settings-always-patch-container").title="",document.getElementById("settings-enable-wayland").disabled=!1,document.getElementById("settings-use-xinput2").disabled=!1,document.getElementById("settings-use-portals").disabled=!1,document.getElementById("settings-always-patch").disabled=!1,document.getElementById("settings-enable-wayland").addEventListener("change",async function(){t.runtime_enable_wayland=this.checked,await (0,M.setConfig)(t)}),document.getElementById("settings-use-xinput2").addEventListener("change",async function(){t.runtime_use_xinput2=this.checked,await (0,M.setConfig)(t)}),document.getElementById("settings-use-portals").addEventListener("change",async function(){t.runtime_use_portals=this.checked,await (0,M.setConfig)(t)}),document.getElementById("settings-always-patch").addEventListener("change",async function(){t.always_patch=this.checked,await (0,M.setConfig)(t)})}),await (0,M.isAutoRuntimeInstallSupported)()||document.getElementById("reinstall-runtime").classList.add("d-none")}!async function(){switch(await (0,M.checkNativeStatus)()){case"install":await browser.tabs.create({url:browser.runtime.getURL("setup/install.html")}),window.close();break;case"update-major":await browser.tabs.create({url:browser.runtime.getURL("setup/update.html")}),window.close();break;case"update-minor":{let e=document.getElementById("extension-outdated-box");document.getElementById("extension-outdated-update").setAttribute("href",browser.runtime.getURL("setup/update.html")),document.getElementById("extension-outdated-close").addEventListener("click",()=>e.classList.add("d-none")),e.classList.remove("d-none")}}}();{let e=document.getElementById("web-app-categories");for(let t of F.knownCategories)e.add(new Option(t,t))}for(const e of document.querySelectorAll(".form-select-tags"))e.tagsInstance=new U.default(e);(0,S.default).getOrCreateInstance(document.getElementById("card-navigation")),(0,M.setPopupSize)(),D(),$(),q(),H();