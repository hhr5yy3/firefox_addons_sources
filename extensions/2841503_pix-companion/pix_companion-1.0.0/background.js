var background=function(){"use strict";var ce=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function me(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var H={exports:{}};(function(e,r){(function(t,n){n(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ce,function(t){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const n="The message port closed before a response was received.",h=g=>{const b={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(b).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class D extends WeakMap{constructor(o,u=void 0){super(u),this.createItem=o}get(o){return this.has(o)||this.set(o,this.createItem(o)),super.get(o)}}const R=m=>m&&typeof m=="object"&&typeof m.then=="function",M=(m,o)=>(...u)=>{g.runtime.lastError?m.reject(new Error(g.runtime.lastError.message)):o.singleCallbackArg||u.length<=1&&o.singleCallbackArg!==!1?m.resolve(u[0]):m.resolve(u)},v=m=>m==1?"argument":"arguments",$=(m,o)=>function(l,...w){if(w.length<o.minArgs)throw new Error(`Expected at least ${o.minArgs} ${v(o.minArgs)} for ${m}(), got ${w.length}`);if(w.length>o.maxArgs)throw new Error(`Expected at most ${o.maxArgs} ${v(o.maxArgs)} for ${m}(), got ${w.length}`);return new Promise((p,E)=>{if(o.fallbackToNoCallback)try{l[m](...w,M({resolve:p,reject:E},o))}catch(A){console.warn(`${m} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,A),l[m](...w),o.fallbackToNoCallback=!1,o.noCallback=!0,p()}else o.noCallback?(l[m](...w),p()):l[m](...w,M({resolve:p,reject:E},o))})},P=(m,o,u)=>new Proxy(o,{apply(l,w,p){return u.call(w,m,...p)}});let j=Function.call.bind(Object.prototype.hasOwnProperty);const a=(m,o={},u={})=>{let l=Object.create(null),w={has(E,A){return A in m||A in l},get(E,A,_){if(A in l)return l[A];if(!(A in m))return;let y=m[A];if(typeof y=="function")if(typeof o[A]=="function")y=P(m,m[A],o[A]);else if(j(u,A)){let S=$(A,u[A]);y=P(m,m[A],S)}else y=y.bind(m);else if(typeof y=="object"&&y!==null&&(j(o,A)||j(u,A)))y=a(y,o[A],u[A]);else if(j(u,"*"))y=a(y,o[A],u["*"]);else return Object.defineProperty(l,A,{configurable:!0,enumerable:!0,get(){return m[A]},set(S){m[A]=S}}),y;return l[A]=y,y},set(E,A,_,y){return A in l?l[A]=_:m[A]=_,!0},defineProperty(E,A,_){return Reflect.defineProperty(l,A,_)},deleteProperty(E,A){return Reflect.deleteProperty(l,A)}},p=Object.create(m);return new Proxy(p,w)},s=m=>({addListener(o,u,...l){o.addListener(m.get(u),...l)},hasListener(o,u){return o.hasListener(m.get(u))},removeListener(o,u){o.removeListener(m.get(u))}}),i=new D(m=>typeof m!="function"?m:function(u){const l=a(u,{},{getContent:{minArgs:0,maxArgs:0}});m(l)}),c=new D(m=>typeof m!="function"?m:function(u,l,w){let p=!1,E,A=new Promise(q=>{E=function(C){p=!0,q(C)}}),_;try{_=m(u,l,E)}catch(q){_=Promise.reject(q)}const y=_!==!0&&R(_);if(_!==!0&&!y&&!p)return!1;const S=q=>{q.then(C=>{w(C)},C=>{let Q;C&&(C instanceof Error||typeof C.message=="string")?Q=C.message:Q="An unexpected error occurred",w({__mozWebExtensionPolyfillReject__:!0,message:Q})}).catch(C=>{console.error("Failed to send onMessage rejected reply",C)})};return S(y?_:A),!0}),d=({reject:m,resolve:o},u)=>{g.runtime.lastError?g.runtime.lastError.message===n?o():m(new Error(g.runtime.lastError.message)):u&&u.__mozWebExtensionPolyfillReject__?m(new Error(u.message)):o(u)},f=(m,o,u,...l)=>{if(l.length<o.minArgs)throw new Error(`Expected at least ${o.minArgs} ${v(o.minArgs)} for ${m}(), got ${l.length}`);if(l.length>o.maxArgs)throw new Error(`Expected at most ${o.maxArgs} ${v(o.maxArgs)} for ${m}(), got ${l.length}`);return new Promise((w,p)=>{const E=d.bind(null,{resolve:w,reject:p});l.push(E),u.sendMessage(...l)})},k={devtools:{network:{onRequestFinished:s(i)}},runtime:{onMessage:s(c),onMessageExternal:s(c),sendMessage:f.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:f.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},x={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return b.privacy={network:{"*":x},services:{"*":x},websites:{"*":x}},a(g,k,b)};t.exports=h(chrome)}})})(H);var le=H.exports;const I=me(le);var X=Object.prototype.hasOwnProperty;function B(e,r){var t,n;if(e===r)return!0;if(e&&r&&(t=e.constructor)===r.constructor){if(t===Date)return e.getTime()===r.getTime();if(t===RegExp)return e.toString()===r.toString();if(t===Array){if((n=e.length)===r.length)for(;n--&&B(e[n],r[n]););return n===-1}if(!t||typeof e=="object"){n=0;for(t in e)if(X.call(e,t)&&++n&&!X.call(r,t)||!(t in r)||!B(e[t],r[t]))return!1;return Object.keys(r).length===n}}return e!==e&&r!==r}function F(e,...r){}const K={debug:(...e)=>F(console.debug,...e),log:(...e)=>F(console.log,...e),warn:(...e)=>F(console.warn,...e),error:(...e)=>F(console.error,...e)};function ge(e){return Array.isArray(e)?e:[e]}const ue=new Error("request for lock canceled");var Ae=function(e,r,t,n){function h(g){return g instanceof t?g:new t(function(b){b(g)})}return new(t||(t=Promise))(function(g,b){function D(v){try{M(n.next(v))}catch($){b($)}}function R(v){try{M(n.throw(v))}catch($){b($)}}function M(v){v.done?g(v.value):h(v.value).then(D,R)}M((n=n.apply(e,r||[])).next())})};class de{constructor(r,t=ue){this._value=r,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(r=1,t=0){if(r<=0)throw new Error(`invalid weight ${r}: must be positive`);return new Promise((n,h)=>{const g={resolve:n,reject:h,weight:r,priority:t},b=Y(this._queue,D=>t<=D.priority);b===-1&&r<=this._value?this._dispatchItem(g):this._queue.splice(b+1,0,g)})}runExclusive(r){return Ae(this,arguments,void 0,function*(t,n=1,h=0){const[g,b]=yield this.acquire(n,h);try{return yield t(g)}finally{b()}})}waitForUnlock(r=1,t=0){if(r<=0)throw new Error(`invalid weight ${r}: must be positive`);return this._couldLockImmediately(r,t)?Promise.resolve():new Promise(n=>{this._weightedWaiters[r-1]||(this._weightedWaiters[r-1]=[]),fe(this._weightedWaiters[r-1],{resolve:n,priority:t})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(r){this._value=r,this._dispatchQueue()}release(r=1){if(r<=0)throw new Error(`invalid weight ${r}: must be positive`);this._value+=r,this._dispatchQueue()}cancel(){this._queue.forEach(r=>r.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(r){const t=this._value;this._value-=r.weight,r.resolve([t,this._newReleaser(r.weight)])}_newReleaser(r){let t=!1;return()=>{t||(t=!0,this.release(r))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let r=this._value;r>0;r--){const t=this._weightedWaiters[r-1];t&&(t.forEach(n=>n.resolve()),this._weightedWaiters[r-1]=[])}else{const r=this._queue[0].priority;for(let t=this._value;t>0;t--){const n=this._weightedWaiters[t-1];if(!n)continue;const h=n.findIndex(g=>g.priority<=r);(h===-1?n:n.splice(0,h)).forEach(g=>g.resolve())}}}_couldLockImmediately(r,t){return(this._queue.length===0||this._queue[0].priority<t)&&r<=this._value}}function fe(e,r){const t=Y(e,n=>r.priority<=n.priority);e.splice(t+1,0,r)}function Y(e,r){for(let t=e.length-1;t>=0;t--)if(r(e[t]))return t;return-1}var he=function(e,r,t,n){function h(g){return g instanceof t?g:new t(function(b){b(g)})}return new(t||(t=Promise))(function(g,b){function D(v){try{M(n.next(v))}catch($){b($)}}function R(v){try{M(n.throw(v))}catch($){b($)}}function M(v){v.done?g(v.value):h(v.value).then(D,R)}M((n=n.apply(e,r||[])).next())})};class be{constructor(r){this._semaphore=new de(1,r)}acquire(){return he(this,arguments,void 0,function*(r=0){const[,t]=yield this._semaphore.acquire(1,r);return t})}runExclusive(r,t=0){return this._semaphore.runExclusive(()=>r(),1,t)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(r=0){return this._semaphore.waitForUnlock(1,r)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const L=we();function we(){const e={local:O("local"),session:O("session"),sync:O("sync"),managed:O("managed")},r=a=>{const s=e[a];if(s==null){const i=Object.keys(e).join(", ");throw Error(`Invalid area "${a}". Options: ${i}`)}return s},t=a=>{const s=a.indexOf(":"),i=a.substring(0,s),c=a.substring(s+1);if(c==null)throw Error(`Storage key should be in the form of "area:key", but received "${a}"`);return{driverArea:i,driverKey:c,driver:r(i)}},n=a=>a+"$",h=(a,s)=>a??s??null,g=a=>typeof a=="object"&&!Array.isArray(a)?a:{},b=async(a,s,i)=>{const c=await a.getItem(s);return h(c,(i==null?void 0:i.fallback)??(i==null?void 0:i.defaultValue))},D=async(a,s)=>{const i=n(s),c=await a.getItem(i);return g(c)},R=async(a,s,i)=>{await a.setItem(s,i??null)},M=async(a,s,i)=>{const c=n(s),f={...g(await a.getItem(c))};Object.entries(i).forEach(([k,x])=>{x==null?delete f[k]:f[k]=x}),await a.setItem(c,f)},v=async(a,s,i)=>{if(await a.removeItem(s),i!=null&&i.removeMeta){const c=n(s);await a.removeItem(c)}},$=async(a,s,i)=>{const c=n(s);if(i==null)await a.removeItem(c);else{const d=g(await a.getItem(c));ge(i).forEach(f=>delete d[f]),await a.setItem(c,d)}},P=(a,s,i)=>a.watch(s,i);return{getItem:async(a,s)=>{const{driver:i,driverKey:c}=t(a);return await b(i,c,s)},getItems:async a=>{const s=new Map,i=new Map;return a.forEach(d=>{let f,k;typeof d=="string"?f=d:(f=d.key,k=d.options);const{driverArea:x,driverKey:m}=t(f),o=s.get(x)??[];s.set(x,o.concat(m)),i.set(f,k)}),(await Promise.all(Array.from(s.entries()).map(async([d,f])=>(await e[d].getItems(f)).map(x=>{const m=`${d}:${x.key}`,o=i.get(m),u=h(x.value,(o==null?void 0:o.fallback)??(o==null?void 0:o.defaultValue));return{key:m,value:u}})))).flat()},getMeta:async a=>{const{driver:s,driverKey:i}=t(a);return await D(s,i)},setItem:async(a,s)=>{const{driver:i,driverKey:c}=t(a);await R(i,c,s)},setItems:async a=>{const s=new Map;a.forEach(({key:i,value:c})=>{const{driverArea:d,driverKey:f}=t(i),k=s.get(d)??[];s.set(d,k.concat({key:f,value:c}))}),await Promise.all(Array.from(s.entries()).map(async([i,c])=>{await r(i).setItems(c)}))},setMeta:async(a,s)=>{const{driver:i,driverKey:c}=t(a);await M(i,c,s)},removeItem:async(a,s)=>{const{driver:i,driverKey:c}=t(a);await v(i,c,s)},removeItems:async a=>{const s=new Map;a.forEach(i=>{let c,d;typeof i=="string"?c=i:(c=i.key,d=i.options);const{driverArea:f,driverKey:k}=t(c),x=s.get(f)??[];x.push(k),d!=null&&d.removeMeta&&x.push(n(k)),s.set(f,x)}),await Promise.all(Array.from(s.entries()).map(async([i,c])=>{await r(i).removeItems(c)}))},removeMeta:async(a,s)=>{const{driver:i,driverKey:c}=t(a);await $(i,c,s)},snapshot:async(a,s)=>{var d;const c=await r(a).snapshot();return(d=s==null?void 0:s.excludeKeys)==null||d.forEach(f=>{delete c[f],delete c[n(f)]}),c},restoreSnapshot:async(a,s)=>{await r(a).restoreSnapshot(s)},watch:(a,s)=>{const{driver:i,driverKey:c}=t(a);return P(i,c,s)},unwatch(){Object.values(e).forEach(a=>{a.unwatch()})},defineItem:(a,s)=>{const{driver:i,driverKey:c}=t(a),{version:d=1,migrations:f={}}=s??{};if(d<1)throw Error("Storage item version cannot be less than 1. Initial versions should be set to 1, not 0.");const k=async()=>{var y;const l=n(c),[{value:w},{value:p}]=await i.getItems([c,l]);if(w==null)return;const E=(p==null?void 0:p.v)??1;if(E>d)throw Error(`Version downgrade detected (v${E} -> v${d}) for "${a}"`);K.debug(`Running storage migration for ${a}: v${E} -> v${d}`);const A=Array.from({length:d-E},(S,q)=>E+q+1);let _=w;for(const S of A)_=await((y=f==null?void 0:f[S])==null?void 0:y.call(f,_))??_;await i.setItems([{key:c,value:_},{key:l,value:{...p,v:d}}]),K.debug(`Storage migration completed for ${a} v${d}`,{migratedValue:_})},x=(s==null?void 0:s.migrations)==null?Promise.resolve():k().catch(l=>{K.error(`Migration failed for ${a}`,l)}),m=new be,o=()=>(s==null?void 0:s.fallback)??(s==null?void 0:s.defaultValue)??null,u=()=>m.runExclusive(async()=>{const l=await i.getItem(c);if(l!=null||(s==null?void 0:s.init)==null)return l;const w=await s.init();return await i.setItem(c,w),w});return x.then(u),{get defaultValue(){return o()},get fallback(){return o()},getValue:async()=>(await x,s!=null&&s.init?await u():await b(i,c,s)),getMeta:async()=>(await x,await D(i,c)),setValue:async l=>(await x,await R(i,c,l)),setMeta:async l=>(await x,await M(i,c,l)),removeValue:async l=>(await x,await v(i,c,l)),removeMeta:async l=>(await x,await $(i,c,l)),watch:l=>P(i,c,(w,p)=>l(w??o(),p??o())),migrate:k}}}}function O(e){const r=()=>{if(I.runtime==null)throw Error(["'wxt/storage' must be loaded in a web extension environment",`
 - If thrown during a build, see https://github.com/wxt-dev/wxt/issues/371`,` - If thrown during tests, mock 'wxt/browser' correctly. See https://wxt.dev/guide/go-further/testing.html
`].join(`
`));if(I.storage==null)throw Error("You must add the 'storage' permission to your manifest to use 'wxt/storage'");const n=I.storage[e];if(n==null)throw Error(`"browser.storage.${e}" is undefined`);return n},t=new Set;return{getItem:async n=>(await r().get(n))[n],getItems:async n=>{const h=await r().get(n);return n.map(g=>({key:g,value:h[g]??null}))},setItem:async(n,h)=>{h==null?await r().remove(n):await r().set({[n]:h})},setItems:async n=>{const h=n.reduce((g,{key:b,value:D})=>(g[b]=D,g),{});await r().set(h)},removeItem:async n=>{await r().remove(n)},removeItems:async n=>{await r().remove(n)},snapshot:async()=>await r().get(),restoreSnapshot:async n=>{await r().set(n)},watch(n,h){const g=b=>{const D=b[n];D!=null&&(B(D.newValue,D.oldValue)||h(D.newValue??null,D.oldValue??null))};return r().onChanged.addListener(g),t.add(g),()=>{r().onChanged.removeListener(g),t.delete(g)}},unwatch(){t.forEach(n=>{r().onChanged.removeListener(n)}),t.clear()}}}const xe=[{baseDomain:"128mots.com"},{baseDomain:"besse.perso.univ-pau.fr"},{baseDomain:"brainly.in"},{baseDomain:"brainly.ro"},{baseDomain:"commentouvrir.com"},{baseDomain:"dictionary.tn"},{baseDomain:"diogn.fr"},{baseDomain:"docplayer.fr"},{baseDomain:"ecs.softec.com.py"},{baseDomain:"ekladata.com"},{baseDomain:"elibrary.tips"},{baseDomain:"eliteanswers.in"},{baseDomain:"es.educaplay.com"},{baseDomain:"evalquiz.com"},{baseDomain:"exocorriges.com"},{baseDomain:"fdj.home.blog"},{baseDomain:"fdjhome.files.wordpress.com"},{baseDomain:"foforum.fr"},{baseDomain:"forum.mathforu.com"},{baseDomain:"forums.commentcamarche.net"},{baseDomain:"fr.alamal-news.com"},{baseDomain:"frederic-junier.org"},{baseDomain:"fr.franceasks.com"},{baseDomain:"fr.quora.com"},{baseDomain:"fr.scribd.com"},{baseDomain:"labs.inquest.net"},{baseDomain:"la-pix.fr"},{baseDomain:"leblogduwebmaster.fr"},{baseDomain:"lecoindusenior.fr"},{baseDomain:"lesoutrali.com"},{baseDomain:"lewebpedagogique.com"},{baseDomain:"new.hi7ob.com"},{baseDomain:"nosdevoirs.fr"},{baseDomain:"quizizz.com"},{baseDomain:"quiz-let.com"},{baseDomain:"quizlet.com"},{baseDomain:"reso-avenirs.onisep.fr"},{baseDomain:"sciences-ingenieur.genevoix-signoret-vinci.fr"},{baseDomain:"socialgrep.com"},{baseDomain:"troyprep.uncommonschools.org"},{baseDomain:"truyenhinhcapsongthu.net"},{baseDomain:"view.genial.ly"},{baseDomain:"arue.pf"},{baseDomain:"askabox.fr"},{baseDomain:"brainscape.com"},{baseDomain:"calameo.com"},{baseDomain:"cjoint.com"},{baseDomain:"coin-des-animateurs.com"},{baseDomain:"commentformaterunpc.com"},{baseDomain:"e-bahut.com"},{baseDomain:"gauthmath.com"},{baseDomain:"jeuxvideo.com"},{baseDomain:"jz0ralalm.com"},{baseDomain:"marocpolis.net"},{baseDomain:"maths-forum.com"},{baseDomain:"onlinecv.fr"},{baseDomain:"pix-data.com"},{baseDomain:"presentation-cv-simple.com"},{baseDomain:"prof-tc.fr"},{baseDomain:"reddit.com"},{baseDomain:"reponserapide.com"},{baseDomain:"secu-ordi.com"},{baseDomain:"studocu.com"},{baseDomain:"technozerrifi.com"},{baseDomain:"xn--pixrponse-e4a.com"},{baseDomain:"ystor.org"},{baseDomain:"chatgpt.com"},{baseDomain:"copilot.microsoft.com"},{baseDomain:"gemini.google.com"},{baseDomain:"you.com"},{baseDomain:"huggingface.co"},{hostname:"mail.google.com"},{hostname:"messagerie.orange.fr"},{hostname:"webmail.free.fr"},{baseDomain:"discord.com"},{baseDomain:"instagram.com"},{hostname:"messenger.com"},{baseDomain:"whatsapp.com"},{baseDomain:"web.telegram.org"},{baseDomain:"snapchat.com"},{baseDomain:"chatbotgpt.fr"},{baseDomain:"chatbotgpt.fr"},{baseDomain:"openai.com"}];let W;function ve(e){try{const r=new URL(e);return W.some(t=>t(r))}catch{return!1}}async function ye({storage:e,onChange:r}){W=(await e.getItem("local:forbiddenUrls")??xe).map(n=>J(n)),e.watch("local:forbiddenUrls",n=>{n&&(W=n.map(h=>J(h)),r==null||r())})}async function pe(){const e=await fetch("https://companion.pix.digital/forbidden-urls.json");if(!e.ok)throw new Error(e.statusText);const r=await e.json();await L.setItem("local:forbiddenUrls",r)}function J(e){if("baseDomain"in e){const r=new RegExp(`^(.*\\.)?${e.baseDomain.replace(/\./g,"\\.")}`);return t=>r.test(t.hostname)}if("hostname"in e)return r=>r.hostname===e.hostname;throw new TypeError("unknown forbidden URL type")}const ee={DEBUG:0,INFO:1,WARN:2,ERROR:3},z="INFO";let G=z;const U=[];function re(e,r,t){ee[r]<ee[G]||(U.push({context:e,level:r,args:t}),!(U.length>1)&&L.getItem("local:logs").then(n=>`${n??""}${U.splice(0,U.length).map(De).join("")}`).then(n=>L.setItem("local:logs",n)).catch(n=>console.error(n)))}function De({context:e,args:r,level:t}){return`${new Date().toISOString()} - ${e} - ${t.padEnd(5)} - ${r.join(" ")}
`}let T;function Ee(e,r){T={debug:(...t)=>{r(e,"DEBUG",t)},info:(...t)=>{r(e,"INFO",t)},warn:(...t)=>{r(e,"WARN",t)},error:(...t)=>{r(e,"ERROR",t)}}}function _e(e){return e!=null&&typeof e=="object"&&"event"in e&&e.event==="pix:log"}function ke(){Ee("background",re),I.runtime.onMessage.addListener(e=>{_e(e)&&re(e.context,e.level,e.args)}),Ie().then(e=>{G=e}).catch(T.error),L.watch("local:log-level",e=>{G=e??z})}async function Ie(){return L.getItem("local:log-level",{fallback:z})}function Te(e){return e==null||typeof e=="function"?{main:e}:e}async function te(e){await L.setItem("local:activated",e)}async function Me(){return L.getItem("local:activated")}function Le(e){return L.watch("local:activated",e)}async function $e(){await L.removeItem("local:activation-time")}function Ce(e){return L.watch("local:activation-time",r=>{e(r===null?null:ne()-r)})}async function Se(){const e=await L.getItem("local:activation-time");return e===null?null:ne()-e}function ne(){return Math.round(Date.now()/1e3/60)}const Re=I.runtime.getURL("/forbidden.html"),N=I.action??I.browserAction,qe=3*60;function se(e,r){!e||!ve(e)||(T.info(`URL interdite détectée sur l’onglet ${r}`,e),I.tabs.update(r,{url:Re}).catch(t=>T.error("failed updating tab",t)))}const Pe=Te(()=>{ke(),(async()=>{await ye({storage:L}),await Ue(),await Oe(),await Ne()})().catch(e=>{T.error("Erreur d’initialisation",e)})}),ae=e=>se(e.url,e.tabId);function ie(e){T.debug(`Changement de l’état d’activation ${e}`),e?je().catch(r=>{T.error("failed activating",r)}):Fe().catch(r=>{T.error("failed deactivating",r)})}async function je(){T.info("Activation du filtrage"),I.webNavigation.onCommitted.addListener(ae),await N.setBadgeText({text:"🛡"});try{await pe()}catch(r){T.error("failed downloading latest forbidden URLs",r)}const e=await I.tabs.query({});for(const r of e)se(r.url,r.id)}async function Fe(){T.info("Désactivation du filtrage"),I.webNavigation.onCommitted.removeListener(ae),await N.setBadgeText({text:null}),await I.alarms.clear("activation-timeout")}async function Oe(){const e=await Me();e===null?await te(!1):ie(e),Le(ie)}async function Ue(){I.alarms.onAlarm.addListener(e=>{e.name==="activation-timeout"&&(te(!1).catch(T.error),$e().catch(T.error))}),oe(await Se()),Ce(oe)}function oe(e){if(e===null)return;const r=qe-e;T.debug(`Désactivation automatique prévue dans ${r} minutes`),I.alarms.create("activation-timeout",{delayInMinutes:r})}async function Ne(){await N.setBadgeTextColor({color:"#ffb100"}),await N.setBadgeBackgroundColor({color:"#2785ff"})}function Ke(){}function V(e,...r){}const Ve={debug:(...e)=>V(console.debug,...e),log:(...e)=>V(console.log,...e),warn:(...e)=>V(console.warn,...e),error:(...e)=>V(console.error,...e)};let Z;try{Z=Pe.main(),Z instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(e){throw Ve.error("The background crashed on startup!"),e}return Z}();
background;
