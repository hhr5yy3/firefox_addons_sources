/*! For license information please see background.js.LICENSE.txt */
(()=>{var e={7076:function(e){e.exports=function(){"use strict";var e=6e4,t=36e5,n="millisecond",r="second",i="minute",o="hour",a="day",s="week",c="month",u="quarter",f="year",l="date",d="Invalid Date",h=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},v=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},g={s:v,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+v(r,2,"0")+":"+v(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(r,c),o=n-i<0,a=t.clone().add(r+(o?-1:1),c);return+(-(r+(n-i)/(o?i-a:a-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:c,y:f,w:s,d:a,D:l,h:o,m:i,s:r,ms:n,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},m="en",b={};b[m]=y;var w="$isDayjsObject",_=function(e){return e instanceof A||!(!e||!e[w])},S=function e(t,n,r){var i;if(!t)return m;if("string"==typeof t){var o=t.toLowerCase();b[o]&&(i=o),n&&(b[o]=n,i=o);var a=t.split("-");if(!i&&a.length>1)return e(a[0])}else{var s=t.name;b[s]=t,i=s}return!r&&i&&(m=i),i||!r&&m},k=function(e,t){if(_(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new A(n)},O=g;O.l=S,O.i=_,O.w=function(e,t){return k(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var A=function(){function y(e){this.$L=S(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[w]=!0}var v=y.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(O.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(h);if(r){var i=r[2]-1||0,o=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)}}return new Date(t)}(e),this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return O},v.isValid=function(){return!(this.$d.toString()===d)},v.isSame=function(e,t){var n=k(e);return this.startOf(t)<=n&&n<=this.endOf(t)},v.isAfter=function(e,t){return k(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<k(e)},v.$g=function(e,t,n){return O.u(e)?this[t]:this.set(n,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var n=this,u=!!O.u(t)||t,d=O.p(e),h=function(e,t){var r=O.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return u?r:r.endOf(a)},p=function(e,t){return O.w(n.toDate()[e].apply(n.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},y=this.$W,v=this.$M,g=this.$D,m="set"+(this.$u?"UTC":"");switch(d){case f:return u?h(1,0):h(31,11);case c:return u?h(1,v):h(0,v+1);case s:var b=this.$locale().weekStart||0,w=(y<b?y+7:y)-b;return h(u?g-w:g+(6-w),v);case a:case l:return p(m+"Hours",0);case o:return p(m+"Minutes",1);case i:return p(m+"Seconds",2);case r:return p(m+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var s,u=O.p(e),d="set"+(this.$u?"UTC":""),h=(s={},s[a]=d+"Date",s[l]=d+"Date",s[c]=d+"Month",s[f]=d+"FullYear",s[o]=d+"Hours",s[i]=d+"Minutes",s[r]=d+"Seconds",s[n]=d+"Milliseconds",s)[u],p=u===a?this.$D+(t-this.$W):t;if(u===c||u===f){var y=this.clone().set(l,1);y.$d[h](p),y.init(),this.$d=y.set(l,Math.min(this.$D,y.daysInMonth())).$d}else h&&this.$d[h](p);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[O.p(e)]()},v.add=function(n,u){var l,d=this;n=Number(n);var h=O.p(u),p=function(e){var t=k(d);return O.w(t.date(t.date()+Math.round(e*n)),d)};if(h===c)return this.set(c,this.$M+n);if(h===f)return this.set(f,this.$y+n);if(h===a)return p(1);if(h===s)return p(7);var y=(l={},l[i]=e,l[o]=t,l[r]=1e3,l)[h]||1,v=this.$d.getTime()+n*y;return O.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||d;var r=e||"YYYY-MM-DDTHH:mm:ssZ",i=O.z(this),o=this.$H,a=this.$m,s=this.$M,c=n.weekdays,u=n.months,f=n.meridiem,l=function(e,n,i,o){return e&&(e[n]||e(t,r))||i[n].slice(0,o)},h=function(e){return O.s(o%12||12,e,"0")},y=f||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(p,(function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return O.s(t.$y,4,"0");case"M":return s+1;case"MM":return O.s(s+1,2,"0");case"MMM":return l(n.monthsShort,s,u,3);case"MMMM":return l(u,s);case"D":return t.$D;case"DD":return O.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return l(n.weekdaysMin,t.$W,c,2);case"ddd":return l(n.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(o);case"HH":return O.s(o,2,"0");case"h":return h(1);case"hh":return h(2);case"a":return y(o,a,!0);case"A":return y(o,a,!1);case"m":return String(a);case"mm":return O.s(a,2,"0");case"s":return String(t.$s);case"ss":return O.s(t.$s,2,"0");case"SSS":return O.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(n,l,d){var h,p=this,y=O.p(l),v=k(n),g=(v.utcOffset()-this.utcOffset())*e,m=this-v,b=function(){return O.m(p,v)};switch(y){case f:h=b()/12;break;case c:h=b();break;case u:h=b()/3;break;case s:h=(m-g)/6048e5;break;case a:h=(m-g)/864e5;break;case o:h=m/t;break;case i:h=m/e;break;case r:h=m/1e3;break;default:h=m}return d?h:O.a(h)},v.daysInMonth=function(){return this.endOf(c).$D},v.$locale=function(){return b[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=S(e,t,!0);return r&&(n.$L=r),n},v.clone=function(){return O.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},y}(),x=A.prototype;return k.prototype=x,[["$ms",n],["$s",r],["$m",i],["$H",o],["$W",a],["$M",c],["$y",f],["$D",l]].forEach((function(e){x[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),k.extend=function(e,t){return e.$i||(e(t,A,k),e.$i=!0),k},k.locale=S,k.isDayjs=_,k.unix=function(e){return k(1e3*e)},k.en=b[m],k.Ls=b,k.p={},k}()},164:function(e){e.exports=function(){"use strict";return{name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}}}()},6581:function(e,t,n){e.exports=function(e){"use strict";var t=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(e),n="января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_"),r="январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),i="янв._февр._мар._апр._мая_июня_июля_авг._сент._окт._нояб._дек.".split("_"),o="янв._февр._март_апр._май_июнь_июль_авг._сент._окт._нояб._дек.".split("_"),a=/D[oD]?(\[[^[\]]*\]|\s)+MMMM?/;function s(e,t,n){var r,i;return"m"===n?t?"минута":"минуту":e+" "+(r=+e,i={mm:t?"минута_минуты_минут":"минуту_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",MM:"месяц_месяца_месяцев",yy:"год_года_лет"}[n].split("_"),r%10==1&&r%100!=11?i[0]:r%10>=2&&r%10<=4&&(r%100<10||r%100>=20)?i[1]:i[2])}var c=function(e,t){return a.test(t)?n[e.month()]:r[e.month()]};c.s=r,c.f=n;var u=function(e,t){return a.test(t)?i[e.month()]:o[e.month()]};u.s=o,u.f=i;var f={name:"ru",weekdays:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),weekdaysShort:"вск_пнд_втр_срд_чтв_птн_сбт".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),months:c,monthsShort:u,weekStart:1,yearStart:4,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., H:mm",LLLL:"dddd, D MMMM YYYY г., H:mm"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",m:s,mm:s,h:"час",hh:s,d:"день",dd:s,M:"месяц",MM:s,y:"год",yy:s},ordinal:function(e){return e},meridiem:function(e){return e<4?"ночи":e<12?"утра":e<17?"дня":"вечера"}};return t.default.locale(f,null,!0),f}(n(7076))},7095:function(e,t,n){e.exports=function(e){"use strict";var t=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(e),n={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(e,t){return"W"===t?e+"周":e+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(e,t){var n=100*e+t;return n<600?"凌晨":n<900?"早上":n<1100?"上午":n<1300?"中午":n<1800?"下午":"晚上"}};return t.default.locale(n,null,!0),n}(n(7076))},9911:function(e){e.exports=function(){"use strict";var e,t,n=1e3,r=6e4,i=36e5,o=864e5,a=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,s=31536e6,c=2628e6,u=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,f={years:s,months:c,days:o,hours:i,minutes:r,seconds:n,milliseconds:1,weeks:6048e5},l=function(e){return e instanceof m},d=function(e,t,n){return new m(e,n,t.$l)},h=function(e){return t.p(e)+"s"},p=function(e){return e<0},y=function(e){return p(e)?Math.ceil(e):Math.floor(e)},v=function(e){return Math.abs(e)},g=function(e,t){return e?p(e)?{negative:!0,format:""+v(e)+t}:{negative:!1,format:""+e+t}:{negative:!1,format:""}},m=function(){function p(e,t,n){var r=this;if(this.$d={},this.$l=n,void 0===e&&(this.$ms=0,this.parseFromMilliseconds()),t)return d(e*f[h(t)],this);if("number"==typeof e)return this.$ms=e,this.parseFromMilliseconds(),this;if("object"==typeof e)return Object.keys(e).forEach((function(t){r.$d[h(t)]=e[t]})),this.calMilliseconds(),this;if("string"==typeof e){var i=e.match(u);if(i){var o=i.slice(2).map((function(e){return null!=e?Number(e):0}));return this.$d.years=o[0],this.$d.months=o[1],this.$d.weeks=o[2],this.$d.days=o[3],this.$d.hours=o[4],this.$d.minutes=o[5],this.$d.seconds=o[6],this.calMilliseconds(),this}}return this}var v=p.prototype;return v.calMilliseconds=function(){var e=this;this.$ms=Object.keys(this.$d).reduce((function(t,n){return t+(e.$d[n]||0)*f[n]}),0)},v.parseFromMilliseconds=function(){var e=this.$ms;this.$d.years=y(e/s),e%=s,this.$d.months=y(e/c),e%=c,this.$d.days=y(e/o),e%=o,this.$d.hours=y(e/i),e%=i,this.$d.minutes=y(e/r),e%=r,this.$d.seconds=y(e/n),e%=n,this.$d.milliseconds=e},v.toISOString=function(){var e=g(this.$d.years,"Y"),t=g(this.$d.months,"M"),n=+this.$d.days||0;this.$d.weeks&&(n+=7*this.$d.weeks);var r=g(n,"D"),i=g(this.$d.hours,"H"),o=g(this.$d.minutes,"M"),a=this.$d.seconds||0;this.$d.milliseconds&&(a+=this.$d.milliseconds/1e3,a=Math.round(1e3*a)/1e3);var s=g(a,"S"),c=e.negative||t.negative||r.negative||i.negative||o.negative||s.negative,u=i.format||o.format||s.format?"T":"",f=(c?"-":"")+"P"+e.format+t.format+r.format+u+i.format+o.format+s.format;return"P"===f||"-P"===f?"P0D":f},v.toJSON=function(){return this.toISOString()},v.format=function(e){var n=e||"YYYY-MM-DDTHH:mm:ss",r={Y:this.$d.years,YY:t.s(this.$d.years,2,"0"),YYYY:t.s(this.$d.years,4,"0"),M:this.$d.months,MM:t.s(this.$d.months,2,"0"),D:this.$d.days,DD:t.s(this.$d.days,2,"0"),H:this.$d.hours,HH:t.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:t.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:t.s(this.$d.seconds,2,"0"),SSS:t.s(this.$d.milliseconds,3,"0")};return n.replace(a,(function(e,t){return t||String(r[e])}))},v.as=function(e){return this.$ms/f[h(e)]},v.get=function(e){var t=this.$ms,n=h(e);return"milliseconds"===n?t%=1e3:t="weeks"===n?y(t/f[n]):this.$d[n],t||0},v.add=function(e,t,n){var r;return r=t?e*f[h(t)]:l(e)?e.$ms:d(e,this).$ms,d(this.$ms+r*(n?-1:1),this)},v.subtract=function(e,t){return this.add(e,t,!0)},v.locale=function(e){var t=this.clone();return t.$l=e,t},v.clone=function(){return d(this.$ms,this)},v.humanize=function(t){return e().add(this.$ms,"ms").locale(this.$l).fromNow(!t)},v.valueOf=function(){return this.asMilliseconds()},v.milliseconds=function(){return this.get("milliseconds")},v.asMilliseconds=function(){return this.as("milliseconds")},v.seconds=function(){return this.get("seconds")},v.asSeconds=function(){return this.as("seconds")},v.minutes=function(){return this.get("minutes")},v.asMinutes=function(){return this.as("minutes")},v.hours=function(){return this.get("hours")},v.asHours=function(){return this.as("hours")},v.days=function(){return this.get("days")},v.asDays=function(){return this.as("days")},v.weeks=function(){return this.get("weeks")},v.asWeeks=function(){return this.as("weeks")},v.months=function(){return this.get("months")},v.asMonths=function(){return this.as("months")},v.years=function(){return this.get("years")},v.asYears=function(){return this.as("years")},p}(),b=function(e,t,n){return e.add(t.years()*n,"y").add(t.months()*n,"M").add(t.days()*n,"d").add(t.hours()*n,"h").add(t.minutes()*n,"m").add(t.seconds()*n,"s").add(t.milliseconds()*n,"ms")};return function(n,r,i){e=i,t=i().$utils(),i.duration=function(e,t){var n=i.locale();return d(e,{$l:n},t)},i.isDuration=l;var o=r.prototype.add,a=r.prototype.subtract;r.prototype.add=function(e,t){return l(e)?b(this,e,1):o.bind(this)(e,t)},r.prototype.subtract=function(e,t){return l(e)?b(this,e,-1):a.bind(this)(e,t)}}}()},7890:function(e){e.exports=function(){"use strict";return function(e,t,n){e=e||{};var r=t.prototype,i={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function o(e,t,n,i){return r.fromToBase(e,t,n,i)}n.en.relativeTime=i,r.fromToBase=function(t,r,o,a,s){for(var c,u,f,l=o.$locale().relativeTime||i,d=e.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],h=d.length,p=0;p<h;p+=1){var y=d[p];y.d&&(c=a?n(t).diff(o,y.d,!0):o.diff(t,y.d,!0));var v=(e.rounding||Math.round)(Math.abs(c));if(f=c>0,v<=y.r||!y.r){v<=1&&p>0&&(y=d[p-1]);var g=l[y.l];s&&(v=s(""+v)),u="string"==typeof g?g.replace("%d",v):g(v,r,y.l,f);break}}if(r)return u;var m=f?l.future:l.past;return"function"==typeof m?m(u):m.replace("%s",u)},r.to=function(e,t){return o(e,t,this,!0)},r.from=function(e,t){return o(e,t,this)};var a=function(e){return e.$u?n.utc():n()};r.toNow=function(e){return this.to(a(this),e)},r.fromNow=function(e){return this.from(a(this),e)}}}()},5594:function(e,t,n){e.exports=function(){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)},t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function r(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,o=Object.keys,a=Array.isArray;function s(e,t){return"object"!=typeof t||o(t).forEach((function(n){e[n]=t[n]})),e}"undefined"==typeof Promise||i.Promise||(i.Promise=Promise);var c=Object.getPrototypeOf,u={}.hasOwnProperty;function f(e,t){return u.call(e,t)}function l(e,t){"function"==typeof t&&(t=t(c(e))),("undefined"==typeof Reflect?o:Reflect.ownKeys)(t).forEach((function(n){h(e,n,t[n])}))}var d=Object.defineProperty;function h(e,t,n,r){d(e,t,s(n&&f(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function p(e){return{from:function(t){return e.prototype=Object.create(t.prototype),h(e.prototype,"constructor",e),{extend:l.bind(null,e.prototype)}}}}var y=Object.getOwnPropertyDescriptor,v=[].slice;function g(e,t,n){return v.call(e,t,n)}function m(e,t){return t(e)}function b(e){if(!e)throw new Error("Assertion Failed")}function w(e){i.setImmediate?setImmediate(e):setTimeout(e,0)}function _(e,t){if("string"==typeof t&&f(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var o=_(e,t[r]);n.push(o)}return n}var a=t.indexOf(".");if(-1!==a){var s=e[t.substr(0,a)];return null==s?void 0:_(s,t.substr(a+1))}}function S(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){b("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)S(e,t[r],n[r])}else{var o,s,c=t.indexOf(".");-1!==c?(o=t.substr(0,c),""===(s=t.substr(c+1))?void 0===n?a(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n:S(c=(c=e[o])&&f(e,o)?c:e[o]={},s,n)):void 0===n?a(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function k(e){var t,n={};for(t in e)f(e,t)&&(n[t]=e[t]);return n}var O=[].concat;function A(e){return O.apply([],e)}var x="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(A([8,16,32,64].map((function(e){return["Int","Uint","Float"].map((function(t){return t+e+"Array"}))})))).filter((function(e){return i[e]})),M=new Set(x.map((function(e){return i[e]}))),R=null;function j(e){return R=new WeakMap,e=function e(t){if(!t||"object"!=typeof t)return t;var n=R.get(t);if(n)return n;if(a(t)){n=[],R.set(t,n);for(var r=0,i=t.length;r<i;++r)n.push(e(t[r]))}else if(M.has(t.constructor))n=t;else{var o,s=c(t);for(o in n=s===Object.prototype?{}:Object.create(s),R.set(t,n),t)f(t,o)&&(n[o]=e(t[o]))}return n}(e),R=null,e}var I={}.toString;function T(e){return I.call(e).slice(8,-1)}var P="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",D="symbol"==typeof P?function(e){var t;return null!=e&&(t=e[P])&&t.apply(e)}:function(){return null};function C(e,t){return 0<=(t=e.indexOf(t))&&e.splice(t,1),0<=t}var E={};function q(e){var t,n,r,i;if(1===arguments.length){if(a(e))return e.slice();if(this===E&&"string"==typeof e)return[e];if(i=D(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"!=typeof(t=e.length))return[e];for(n=new Array(t);t--;)n[t]=e[t];return n}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var N="undefined"!=typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},$=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ce=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"]),B={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function K(e,t){this.name=e,this.message=t}function F(e,t){return e+". Errors: "+Object.keys(t).map((function(e){return t[e].toString()})).filter((function(e,t,n){return n.indexOf(e)===t})).join("\n")}function L(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=F(e,t)}function W(e,t){this.name="BulkError",this.failures=Object.keys(t).map((function(e){return t[e]})),this.failuresByPos=t,this.message=F(e,this.failures)}p(K).from(Error).extend({toString:function(){return this.name+": "+this.message}}),p(L).from(K),p(W).from(K);var Y=$.reduce((function(e,t){return e[t]=t+"Error",e}),{}),U=K,H=$.reduce((function(e,t){var n=t+"Error";function r(e,r){this.name=n,e?"string"==typeof e?(this.message="".concat(e).concat(r?"\n "+r:""),this.inner=r||null):"object"==typeof e&&(this.message="".concat(e.name," ").concat(e.message),this.inner=e):(this.message=B[t]||n,this.inner=null)}return p(r).from(U),e[t]=r,e}),{});H.Syntax=SyntaxError,H.Type=TypeError,H.Range=RangeError;var V=ce.reduce((function(e,t){return e[t+"Error"]=H[t],e}),{}),z=$.reduce((function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=H[t]),e}),{});function G(){}function J(e){return e}function Q(e,t){return null==e||e===J?t:function(n){return t(e(n))}}function X(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Z(e,t){return e===G?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?X(r,this.onsuccess):r),i&&(this.onerror=this.onerror?X(i,this.onerror):i),void 0!==o?o:n}}function ee(e,t){return e===G?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?X(n,this.onsuccess):n),r&&(this.onerror=this.onerror?X(r,this.onerror):r)}}function te(e,t){return e===G?t:function(n){var r=e.apply(this,arguments);s(n,r);var i=this.onsuccess,o=this.onerror;return this.onsuccess=null,this.onerror=null,n=t.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?X(i,this.onsuccess):i),o&&(this.onerror=this.onerror?X(o,this.onerror):o),void 0===r?void 0===n?void 0:n:s(r,n)}}function ne(e,t){return e===G?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function re(e,t){return e===G?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then((function(){return t.apply(r,o)}))}return t.apply(this,arguments)}}z.ModifyError=L,z.DexieError=K,z.BulkError=W;var ie="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function oe(e){ie=e}var ae={},se=100,ce=(x="undefined"==typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,c(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,c(t),e]}(),x[0]),ue=($=x[1],x=x[2],$=$&&$.then,ce&&ce.constructor),fe=!!x,le=function(e,t){be.push([e,t]),he&&(queueMicrotask(je),he=!1)},de=!0,he=!0,pe=[],ye=[],ve=J,ge={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:G,pgp:!1,env:{},finalize:G},me=ge,be=[],we=0,_e=[];function Se(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=me;if("function"!=typeof e){if(e!==ae)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Ae(this,this._value))}this._state=null,this._value=null,++t.ref,function e(t,n){try{n((function(n){if(null===t._state){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&Ie();n&&"function"==typeof n.then?e(t,(function(e,t){n instanceof Se?n._then(e,t):n.then(e,t)})):(t._state=!0,t._value=n,xe(t)),r&&Te()}}),Ae.bind(null,t))}catch(n){Ae(t,n)}}(this,e)}var ke={get:function(){var e=me,t=Be;function n(n,r){var i=this,o=!e.global&&(e!==me||t!==Be),a=o&&!We(),s=new Se((function(t,s){Me(i,new Oe(Ge(n,e,o,a),Ge(r,e,o,a),t,s,e))}));return this._consoleTask&&(s._consoleTask=this._consoleTask),s}return n.prototype=ae,n},set:function(e){h(this,"then",e&&e.prototype===ae?ke:{get:function(){return e},set:ke.set})}};function Oe(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function Ae(e,t){var n,r;ye.push(t),null===e._state&&(n=e._lib&&Ie(),t=ve(t),e._state=!1,e._value=t,r=e,pe.some((function(e){return e._value===r._value}))||pe.push(r),xe(e),n&&Te())}function xe(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Me(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===we&&(++we,le((function(){0==--we&&Pe()}),[]))}function Me(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++we,le(Re,[n,e,t])}else e._listeners.push(t)}function Re(e,t,n){try{var r,i=t._value;!t._state&&ye.length&&(ye=[]),r=ie&&t._consoleTask?t._consoleTask.run((function(){return e(i)})):e(i),t._state||-1!==ye.indexOf(i)||function(e){for(var t=pe.length;t;)if(pe[--t]._value===e._value)return pe.splice(t,1)}(t),n.resolve(r)}catch(e){n.reject(e)}finally{0==--we&&Pe(),--n.psd.ref||n.psd.finalize()}}function je(){ze(ge,(function(){Ie()&&Te()}))}function Ie(){var e=de;return he=de=!1,e}function Te(){var e,t,n;do{for(;0<be.length;)for(e=be,be=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(0<be.length);he=de=!0}function Pe(){var e=pe;pe=[],e.forEach((function(e){e._PSD.onunhandled.call(null,e._value,e)}));for(var t=_e.slice(0),n=t.length;n;)t[--n]()}function De(e){return new Se(ae,!1,e)}function Ce(e,t){var n=me;return function(){var r=Ie(),i=me;try{return He(n,!0),e.apply(this,arguments)}catch(r){t&&t(r)}finally{He(i,!1),r&&Te()}}}l(Se.prototype,{then:ke,_then:function(e,t){Me(this,new Oe(null,null,e,t,me))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=e,n=arguments[1];return"function"==typeof t?this.then(null,(function(e){return(e instanceof t?n:De)(e)})):this.then(null,(function(e){return(e&&e.name===t?n:De)(e)}))},finally:function(e){return this.then((function(t){return Se.resolve(e()).then((function(){return t}))}),(function(t){return Se.resolve(e()).then((function(){return De(t)}))}))},timeout:function(e,t){var n=this;return e<1/0?new Se((function(r,i){var o=setTimeout((function(){return i(new H.Timeout(t))}),e);n.then(r,i).finally(clearTimeout.bind(null,o))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&h(Se.prototype,Symbol.toStringTag,"Dexie.Promise"),ge.env=Ve(),l(Se,{all:function(){var e=q.apply(null,arguments).map(Ye);return new Se((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach((function(i,o){return Se.resolve(i).then((function(n){e[o]=n,--r||t(e)}),n)}))}))},resolve:function(e){return e instanceof Se?e:e&&"function"==typeof e.then?new Se((function(t,n){e.then(t,n)})):new Se(ae,!0,e)},reject:De,race:function(){var e=q.apply(null,arguments).map(Ye);return new Se((function(t,n){e.map((function(e){return Se.resolve(e).then(t,n)}))}))},PSD:{get:function(){return me},set:function(e){return me=e}},totalEchoes:{get:function(){return Be}},newPSD:Fe,usePSD:ze,scheduler:{get:function(){return le},set:function(e){le=e}},rejectionMapper:{get:function(){return ve},set:function(e){ve=e}},follow:function(e,t){return new Se((function(n,r){return Fe((function(t,n){var r=me;r.unhandleds=[],r.onunhandled=n,r.finalize=X((function(){var e,r=this;e=function(){0===r.unhandleds.length?t():n(r.unhandleds[0])},_e.push((function t(){e(),_e.splice(_e.indexOf(t),1)})),++we,le((function(){0==--we&&Pe()}),[])}),r.finalize),e()}),t,n,r)}))}}),ue&&(ue.allSettled&&h(Se,"allSettled",(function(){var e=q.apply(null,arguments).map(Ye);return new Se((function(t){0===e.length&&t([]);var n=e.length,r=new Array(n);e.forEach((function(e,i){return Se.resolve(e).then((function(e){return r[i]={status:"fulfilled",value:e}}),(function(e){return r[i]={status:"rejected",reason:e}})).then((function(){return--n||t(r)}))}))}))})),ue.any&&"undefined"!=typeof AggregateError&&h(Se,"any",(function(){var e=q.apply(null,arguments).map(Ye);return new Se((function(t,n){0===e.length&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach((function(e,o){return Se.resolve(e).then((function(e){return t(e)}),(function(e){i[o]=e,--r||n(new AggregateError(i))}))}))}))})));var Ee={awaits:0,echoes:0,id:0},qe=0,Ne=[],$e=0,Be=0,Ke=0;function Fe(e,t,n,r){var i=me,o=Object.create(i);return o.parent=i,o.ref=0,o.global=!1,o.id=++Ke,ge.env,o.env=fe?{Promise:Se,PromiseProp:{value:Se,configurable:!0,writable:!0},all:Se.all,race:Se.race,allSettled:Se.allSettled,any:Se.any,resolve:Se.resolve,reject:Se.reject}:{},t&&s(o,t),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()},r=ze(o,e,n,r),0===o.ref&&o.finalize(),r}function Le(){return Ee.id||(Ee.id=++qe),++Ee.awaits,Ee.echoes+=se,Ee.id}function We(){return!!Ee.awaits&&(0==--Ee.awaits&&(Ee.id=0),Ee.echoes=Ee.awaits*se,!0)}function Ye(e){return Ee.echoes&&e&&e.constructor===ue?(Le(),e.then((function(e){return We(),e}),(function(e){return We(),Qe(e)}))):e}function Ue(){var e=Ne[Ne.length-1];Ne.pop(),He(e,!1)}function He(e,t){var n,r=me;(t?!Ee.echoes||$e++&&e===me:!$e||--$e&&e===me)||queueMicrotask(t?function(e){++Be,Ee.echoes&&0!=--Ee.echoes||(Ee.echoes=Ee.awaits=Ee.id=0),Ne.push(me),He(e,!0)}.bind(null,e):Ue),e!==me&&(me=e,r===ge&&(ge.env=Ve()),fe&&(n=ge.env.Promise,t=e.env,(r.global||e.global)&&(Object.defineProperty(i,"Promise",t.PromiseProp),n.all=t.all,n.race=t.race,n.resolve=t.resolve,n.reject=t.reject,t.allSettled&&(n.allSettled=t.allSettled),t.any&&(n.any=t.any))))}function Ve(){var e=i.Promise;return fe?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(i,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ze(e,t,n,r,i){var o=me;try{return He(e,!0),t(n,r,i)}finally{He(o,!1)}}function Ge(e,t,n,r){return"function"!=typeof e?e:function(){var i=me;n&&Le(),He(t,!0);try{return e.apply(this,arguments)}finally{He(i,!1),r&&queueMicrotask(We)}}}function Je(e){Promise===ue&&0===Ee.echoes?0===$e?e():enqueueNativeMicroTask(e):setTimeout(e,0)}-1===(""+$).indexOf("[native code]")&&(Le=We=G);var Qe=Se.reject,Xe=String.fromCharCode(65535),Ze="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",et="String expected.",tt=[],nt="__dbnames",rt="readonly",it="readwrite";function ot(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var at={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function st(e){return"string"!=typeof e||/\./.test(e)?function(e){return e}:function(t){return void 0===t[e]&&e in t&&delete(t=j(t))[e],t}}function ct(){throw H.Type()}function ut(e,t){try{var n=ft(e),r=ft(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,o=0;o<i;++o)if(e[o]!==t[o])return e[o]<t[o]?-1:1;return n===r?0:n<r?-1:1}(lt(e),lt(t));case"Array":return function(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,o=0;o<i;++o){var a=ut(e[o],t[o]);if(0!==a)return a}return n===r?0:n<r?-1:1}(e,t)}}catch(e){}return NaN}function ft(e){var t=typeof e;return"object"!=t?t:ArrayBuffer.isView(e)||"ArrayBuffer"===(e=T(e))?"binary":e}function lt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var dt=(ht.prototype._trans=function(e,t,n){var r=this._tx||me.trans,i=this.name,o=ie&&"undefined"!=typeof console&&console.createTask&&console.createTask("Dexie: ".concat("readonly"===e?"read":"write"," ").concat(this.name));function a(e,n,r){if(!r.schema[i])throw new H.NotFound("Table "+i+" not part of transaction");return t(r.idbtrans,r)}var s=Ie();try{var c=r&&r.db._novip===this.db._novip?r===me.trans?r._promise(e,a,n):Fe((function(){return r._promise(e,a,n)}),{trans:r,transless:me.transless||me}):function e(t,n,r,i){if(t.idbdb&&(t._state.openComplete||me.letThrough||t._vip)){var o=t._createTransaction(n,r,t._dbSchema);try{o.create(),t._state.PR1398_maxLoop=3}catch(o){return o.name===Y.InvalidState&&t.isOpen()&&0<--t._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),t.close({disableAutoOpen:!1}),t.open().then((function(){return e(t,n,r,i)}))):Qe(o)}return o._promise(n,(function(e,t){return Fe((function(){return me.trans=o,i(e,t,o)}))})).then((function(e){if("readwrite"===n)try{o.idbtrans.commit()}catch(e){}return"readonly"===n?e:o._completion.then((function(){return e}))}))}if(t._state.openComplete)return Qe(new H.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return Qe(new H.DatabaseClosed);t.open().catch(G)}return t._state.dbReadyPromise.then((function(){return e(t,n,r,i)}))}(this.db,e,[this.name],a);return o&&(c._consoleTask=o,c=c.catch((function(e){return console.trace(e),Qe(e)}))),c}finally{s&&Te()}},ht.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):null==e?Qe(new H.Type("Invalid argument to Table.get()")):this._trans("readonly",(function(t){return n.core.get({trans:t,key:e}).then((function(e){return n.hook.reading.fire(e)}))})).then(t)},ht.prototype.where=function(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(a(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=o(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter((function(e){if(e.compound&&t.every((function(t){return 0<=e.keyPath.indexOf(t)}))){for(var n=0;n<t.length;++n)if(-1===t.indexOf(e.keyPath[n]))return!1;return!0}return!1})).sort((function(e,t){return e.keyPath.length-t.keyPath.length}))[0];if(n&&this.db._maxKey!==Xe){var r=n.keyPath.slice(0,t.length);return this.where(r).equals(r.map((function(t){return e[t]})))}!n&&ie&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var i=this.schema.idxByName,s=this.db._deps.indexedDB;function c(e,t){return 0===s.cmp(e,t)}var u=t.reduce((function(t,n){var r=t[0],o=t[1],s=(t=i[n],e[n]);return[r||t,r||!t?ot(o,t&&t.multi?function(e){return e=_(e,n),a(e)&&e.some((function(e){return c(s,e)}))}:function(e){return c(s,_(e,n))}):o]}),[null,null]);return r=u[0],u=u[1],r?this.where(r.name).equals(e[r.keyPath]).filter(u):n?this.filter(u):this.where(t).equals("")},ht.prototype.filter=function(e){return this.toCollection().and(e)},ht.prototype.count=function(e){return this.toCollection().count(e)},ht.prototype.offset=function(e){return this.toCollection().offset(e)},ht.prototype.limit=function(e){return this.toCollection().limit(e)},ht.prototype.each=function(e){return this.toCollection().each(e)},ht.prototype.toArray=function(e){return this.toCollection().toArray(e)},ht.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},ht.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,a(e)?"[".concat(e.join("+"),"]"):e))},ht.prototype.reverse=function(){return this.toCollection().reverse()},ht.prototype.mapToClass=function(t){var n,r=this.db,i=this.name;function o(){return null!==n&&n.apply(this,arguments)||this}(this.schema.mappedClass=t).prototype instanceof ct&&(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(o,n=t),Object.defineProperty(o.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),o.prototype.table=function(){return i},t=o);for(var a=new Set,s=t.prototype;s;s=c(s))Object.getOwnPropertyNames(s).forEach((function(e){return a.add(e)}));function u(e){if(!e)return e;var n,r=Object.create(t.prototype);for(n in e)if(!a.has(n))try{r[n]=e[n]}catch(e){}return r}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=u,this.hook("reading",u),t},ht.prototype.defineClass=function(){return this.mapToClass((function(e){s(this,e)}))},ht.prototype.add=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,a=e;return o&&i&&(a=st(o)(e)),this._trans("readwrite",(function(e){return n.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[a]})})).then((function(e){return e.numFailures?Se.reject(e.failures[0]):e.lastResult})).then((function(t){if(o)try{S(e,o,t)}catch(t){}return t}))},ht.prototype.update=function(e,t){return"object"!=typeof e||a(e)?this.where(":id").equals(e).modify(t):void 0===(e=_(e,this.schema.primKey.keyPath))?Qe(new H.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t)},ht.prototype.put=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,a=e;return o&&i&&(a=st(o)(e)),this._trans("readwrite",(function(e){return n.core.mutate({trans:e,type:"put",values:[a],keys:null!=t?[t]:null})})).then((function(e){return e.numFailures?Se.reject(e.failures[0]):e.lastResult})).then((function(t){if(o)try{S(e,o,t)}catch(t){}return t}))},ht.prototype.delete=function(e){var t=this;return this._trans("readwrite",(function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]})})).then((function(e){return e.numFailures?Se.reject(e.failures[0]):void 0}))},ht.prototype.clear=function(){var e=this;return this._trans("readwrite",(function(t){return e.core.mutate({trans:t,type:"deleteRange",range:at})})).then((function(e){return e.numFailures?Se.reject(e.failures[0]):void 0}))},ht.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",(function(n){return t.core.getMany({keys:e,trans:n}).then((function(e){return e.map((function(e){return t.hook.reading.fire(e)}))}))}))},ht.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,o=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(function(t){var n=(s=r.schema.primKey).auto;if((s=s.keyPath)&&i)throw new H.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new H.InvalidArgument("Arguments objects and keys must have the same length");var a=e.length,s=s&&n?e.map(st(s)):e;return r.core.mutate({trans:t,type:"add",keys:i,values:s,wantResults:o}).then((function(e){var t=e.numFailures,n=e.results,i=e.lastResult;if(e=e.failures,0===t)return o?n:i;throw new W("".concat(r.name,".bulkAdd(): ").concat(t," of ").concat(a," operations failed"),e)}))}))},ht.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,o=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(function(t){var n=(s=r.schema.primKey).auto;if((s=s.keyPath)&&i)throw new H.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new H.InvalidArgument("Arguments objects and keys must have the same length");var a=e.length,s=s&&n?e.map(st(s)):e;return r.core.mutate({trans:t,type:"put",keys:i,values:s,wantResults:o}).then((function(e){var t=e.numFailures,n=e.results,i=e.lastResult;if(e=e.failures,0===t)return o?n:i;throw new W("".concat(r.name,".bulkPut(): ").concat(t," of ").concat(a," operations failed"),e)}))}))},ht.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map((function(e){return e.key})),i=e.map((function(e){return e.changes})),o=[];return this._trans("readwrite",(function(a){return n.getMany({trans:a,keys:r,cache:"clone"}).then((function(s){var c=[],u=[];e.forEach((function(e,n){var r=e.key,i=e.changes,a=s[n];if(a){for(var f=0,l=Object.keys(i);f<l.length;f++){var d=l[f],h=i[d];if(d===t.schema.primKey.keyPath){if(0!==ut(h,r))throw new H.Constraint("Cannot update primary key in bulkUpdate()")}else S(a,d,h)}o.push(n),c.push(r),u.push(a)}}));var f=c.length;return n.mutate({trans:a,type:"put",keys:c,values:u,updates:{keys:r,changeSpecs:i}}).then((function(e){var n=e.numFailures,r=e.failures;if(0===n)return f;for(var i=0,a=Object.keys(r);i<a.length;i++){var s,c=a[i],u=o[Number(c)];null!=u&&(s=r[c],delete r[c],r[u]=s)}throw new W("".concat(t.name,".bulkUpdate(): ").concat(n," of ").concat(f," operations failed"),r)}))}))}))},ht.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",(function(n){return t.core.mutate({trans:n,type:"delete",keys:e})})).then((function(e){var r=e.numFailures,i=e.lastResult;if(e=e.failures,0===r)return i;throw new W("".concat(t.name,".bulkDelete(): ").concat(r," of ").concat(n," operations failed"),e)}))},ht);function ht(){}function pt(e){function t(t,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return n[t].subscribe.apply(null,o),e}if("string"==typeof t)return n[t]}var n={};t.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return t;function s(e,r,i){if("object"!=typeof e){var c;r=r||ne;var u={subscribers:[],fire:i=i||G,subscribe:function(e){-1===u.subscribers.indexOf(e)&&(u.subscribers.push(e),u.fire=r(u.fire,e))},unsubscribe:function(e){u.subscribers=u.subscribers.filter((function(t){return t!==e})),u.fire=u.subscribers.reduce(r,i)}};return n[e]=t[e]=u}o(c=e).forEach((function(e){var t=c[e];if(a(t))s(e,c[e][0],c[e][1]);else{if("asap"!==t)throw new H.InvalidArgument("Invalid event config");var n=s(e,J,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach((function(e){w((function(){e.apply(null,t)}))}))}))}}))}}function yt(e,t){return p(t).from({prototype:e}),t}function vt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function gt(e,t){e.filter=ot(e.filter,t)}function mt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return ot(r(),t())}:t,e.justLimit=n&&!r}function bt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new H.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function wt(e,t,n){var r=bt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function _t(e,t,n,r){var i=e.replayFilter?ot(e.filter,e.replayFilter()):e.filter;if(e.or){var o={},a=function(e,n,r){var a,s;i&&!i(n,r,(function(e){return n.stop(e)}),(function(e){return n.fail(e)}))||("[object ArrayBuffer]"==(s=""+(a=n.primaryKey))&&(s=""+new Uint8Array(a)),f(o,s)||(o[s]=!0,t(e,n,r)))};return Promise.all([e.or._iterate(a,n),St(wt(e,r,n),e.algorithm,a,!e.keysOnly&&e.valueMapper)])}return St(wt(e,r,n),ot(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function St(e,t,n,r){var i=Ce(r?function(e,t,i){return n(r(e),t,i)}:n);return e.then((function(e){if(e)return e.start((function(){var n=function(){return e.continue()};t&&!t(e,(function(e){return n=e}),(function(t){e.stop(t),n=G}),(function(t){e.fail(t),n=G}))||i(e.value,e,(function(e){return n=e})),n()}))}))}x=Symbol();var kt=(Ot.prototype.execute=function(e){var t=null===(t=this.replacePrefix)||void 0===t?void 0:t[0];return t&&"string"==typeof e&&e.startsWith(t)?this.replacePrefix[1]+e.substring(t.length):e},Ot);function Ot(e){Object.assign(this,e)}var At=(xt.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,Qe.bind(null,n.error)):n.table._trans("readonly",e).then(t)},xt.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,Qe.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},xt.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=ot(t.algorithm,e)},xt.prototype._iterate=function(e,t){return _t(this._ctx,e,t,this._ctx.table.core)},xt.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&s(n,e),t._ctx=n,t},xt.prototype.raw=function(){return this._ctx.valueMapper=null,this},xt.prototype.each=function(e){var t=this._ctx;return this._read((function(n){return _t(t,e,n,t.table.core)}))},xt.prototype.count=function(e){var t=this;return this._read((function(e){var n=t._ctx,r=n.table.core;if(vt(n,!0))return r.count({trans:e,query:{index:bt(n,r.schema),range:n.range}}).then((function(e){return Math.min(e,n.limit)}));var i=0;return _t(n,(function(){return++i,!1}),e,r).then((function(){return i}))})).then(e)},xt.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function o(e,t){return t?o(e[n[t]],t-1):e[r]}var a="next"===this._ctx.dir?1:-1;function s(e,t){return(e=o(e,i))<(t=o(t,i))?-a:t<e?a:0}return this.toArray((function(e){return e.sort(s)})).then(t)},xt.prototype.toArray=function(e){var t=this;return this._read((function(e){var n=t._ctx;if("next"===n.dir&&vt(n,!0)&&0<n.limit){var r=n.valueMapper,i=bt(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then((function(e){return e=e.result,r?e.map(r):e}))}var o=[];return _t(n,(function(e){return o.push(e)}),e,n.table.core).then((function(){return o}))}),e)},xt.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,vt(t)?mt(t,(function(){var t=e;return function(e,n){return 0===t||(1===t?--t:n((function(){e.advance(t),t=0})),!1)}})):mt(t,(function(){var t=e;return function(){return--t<0}}))),this},xt.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),mt(this._ctx,(function(){var t=e;return function(e,n,r){return--t<=0&&n(r),0<=t}}),!0),this},xt.prototype.until=function(e,t){return gt(this._ctx,(function(n,r,i){return!e(n.value)||(r(i),t)})),this},xt.prototype.first=function(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)},xt.prototype.last=function(e){return this.reverse().first(e)},xt.prototype.filter=function(e){var t;return gt(this._ctx,(function(t){return e(t.value)})),(t=this._ctx).isMatch=ot(t.isMatch,e),this},xt.prototype.and=function(e){return this.filter(e)},xt.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},xt.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},xt.prototype.desc=function(){return this.reverse()},xt.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))},xt.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},xt.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))},xt.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)},xt.prototype.primaryKeys=function(e){var t=this._ctx;if("next"===t.dir&&vt(t,!0)&&0<t.limit)return this._read((function(e){var n=bt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((function(e){return e.result})).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)},xt.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},xt.prototype.firstKey=function(e){return this.limit(1).keys((function(e){return e[0]})).then(e)},xt.prototype.lastKey=function(e){return this.reverse().firstKey(e)},xt.prototype.distinct=function(){var e;if(!(e=(e=this._ctx).index&&e.table.schema.idxByName[e.index])||!e.multi)return this;var t={};return gt(this._ctx,(function(e){var n=e.primaryKey.toString();return e=f(t,n),t[n]=!0,!e})),this},xt.prototype.modify=function(e){var t=this,n=this._ctx;return this._write((function(r){var i,a,s;function c(e,t){var n=t.failures;t=t.numFailures,y+=e-t;for(var r=0,i=o(n);r<i.length;r++){var a=i[r];p.push(n[a])}}s="function"==typeof e?e:(i=o(e),a=i.length,function(t){for(var n=!1,r=0;r<a;++r){var o=i[r],s=e[o],c=_(t,o);s instanceof kt?(S(t,o,s.execute(c)),n=!0):c!==s&&(S(t,o,s),n=!0)}return n});var u=n.table.core,f=u.schema.primaryKey,l=f.outbound,d=f.extractKey,h=t.db._options.modifyChunkSize||200,p=[],y=0,v=[];return t.clone().primaryKeys().then((function(t){return function i(o){var a=Math.min(h,t.length-o);return u.getMany({trans:r,keys:t.slice(o,o+a),cache:"immutable"}).then((function(f){for(var p=[],y=[],v=l?[]:null,g=[],m=0;m<a;++m){var b=f[m],w={value:j(b),primKey:t[o+m]};!1!==s.call(w,w.value,w)&&(null==w.value?g.push(t[o+m]):l||0===ut(d(b),d(w.value))?(y.push(w.value),l&&v.push(t[o+m])):(g.push(t[o+m]),p.push(w.value)))}var _=vt(n)&&n.limit===1/0&&("function"!=typeof e||e===Mt)&&{index:n.index,range:n.range};return Promise.resolve(0<p.length&&u.mutate({trans:r,type:"add",values:p}).then((function(e){for(var t in e.failures)g.splice(parseInt(t),1);c(p.length,e)}))).then((function(){return(0<y.length||_&&"object"==typeof e)&&u.mutate({trans:r,type:"put",keys:v,values:y,criteria:_,changeSpec:"function"!=typeof e&&e}).then((function(e){return c(y.length,e)}))})).then((function(){return(0<g.length||_&&e===Mt)&&u.mutate({trans:r,type:"delete",keys:g,criteria:_}).then((function(e){return c(g.length,e)}))})).then((function(){return t.length>o+a&&i(o+h)}))}))}(0).then((function(){if(0<p.length)throw new L("Error modifying one or more objects",p,y,v);return t.length}))}))}))},xt.prototype.delete=function(){var e=this._ctx,t=e.range;return vt(e)&&(e.isPrimKey||3===t.type)?this._write((function(n){var r=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then((function(t){return e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then((function(e){var n=e.failures;if(e.lastResult,e.results,e=e.numFailures)throw new L("Could not delete some values",Object.keys(n).map((function(e){return n[e]})),t-e);return t-e}))}))})):this.modify(Mt)},xt);function xt(){}var Mt=function(e,t){return t.value=null};function Rt(e,t){return e<t?-1:e===t?0:1}function jt(e,t){return t<e?-1:e===t?0:1}function It(e,t,n){return(e=e instanceof Et?new e.Collection(e):e)._ctx.error=new(n||TypeError)(t),e}function Tt(e){return new e.Collection(e,(function(){return Ct("")})).limit(0)}function Pt(e,t,n,r){var i,o,a,s,c,u,f,l=n.length;if(!n.every((function(e){return"string"==typeof e})))return It(e,et);function d(e){i="next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()},o="next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()},a="next"===e?Rt:jt;var t=n.map((function(e){return{lower:o(e),upper:i(e)}})).sort((function(e,t){return a(e.lower,t.lower)}));s=t.map((function(e){return e.upper})),c=t.map((function(e){return e.lower})),f="next"===(u=e)?"":r}d("next"),(e=new e.Collection(e,(function(){return Dt(s[0],c[l-1]+r)})))._ondirectionchange=function(e){d(e)};var h=0;return e._addAlgorithm((function(e,n,r){var i=e.key;if("string"!=typeof i)return!1;var d=o(i);if(t(d,c,h))return!0;for(var p=null,y=h;y<l;++y){var v=function(e,t,n,r,i,o){for(var a=Math.min(e.length,r.length),s=-1,c=0;c<a;++c){var u=t[c];if(u!==r[c])return i(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):i(e[c],r[c])<0?e.substr(0,c)+r[c]+n.substr(c+1):0<=s?e.substr(0,s)+t[s]+n.substr(s+1):null;i(e[c],u)<0&&(s=c)}return a<r.length&&"next"===o?e+n.substr(e.length):a<e.length&&"prev"===o?e.substr(0,n.length):s<0?null:e.substr(0,s)+r[s]+n.substr(s+1)}(i,d,s[y],c[y],a,u);null===v&&null===p?h=y+1:(null===p||0<a(p,v))&&(p=v)}return n(null!==p?function(){e.continue(p+f)}:r),!1})),e}function Dt(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function Ct(e){return{type:1,lower:e,upper:e}}var Et=(Object.defineProperty(qt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),qt.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return 0<this._cmp(e,t)||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?Tt(this):new this.Collection(this,(function(){return Dt(e,t,!n,!r)}))}catch(e){return It(this,Ze)}},qt.prototype.equals=function(e){return null==e?It(this,Ze):new this.Collection(this,(function(){return Ct(e)}))},qt.prototype.above=function(e){return null==e?It(this,Ze):new this.Collection(this,(function(){return Dt(e,void 0,!0)}))},qt.prototype.aboveOrEqual=function(e){return null==e?It(this,Ze):new this.Collection(this,(function(){return Dt(e,void 0,!1)}))},qt.prototype.below=function(e){return null==e?It(this,Ze):new this.Collection(this,(function(){return Dt(void 0,e,!1,!0)}))},qt.prototype.belowOrEqual=function(e){return null==e?It(this,Ze):new this.Collection(this,(function(){return Dt(void 0,e)}))},qt.prototype.startsWith=function(e){return"string"!=typeof e?It(this,et):this.between(e,e+Xe,!0,!0)},qt.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):Pt(this,(function(e,t){return 0===e.indexOf(t[0])}),[e],Xe)},qt.prototype.equalsIgnoreCase=function(e){return Pt(this,(function(e,t){return e===t[0]}),[e],"")},qt.prototype.anyOfIgnoreCase=function(){var e=q.apply(E,arguments);return 0===e.length?Tt(this):Pt(this,(function(e,t){return-1!==t.indexOf(e)}),e,"")},qt.prototype.startsWithAnyOfIgnoreCase=function(){var e=q.apply(E,arguments);return 0===e.length?Tt(this):Pt(this,(function(e,t){return t.some((function(t){return 0===e.indexOf(t)}))}),e,Xe)},qt.prototype.anyOf=function(){var e=this,t=q.apply(E,arguments),n=this._cmp;try{t.sort(n)}catch(r){return It(this,Ze)}if(0===t.length)return Tt(this);var r=new this.Collection(this,(function(){return Dt(t[0],t[t.length-1])}));r._ondirectionchange=function(r){n="next"===r?e._ascending:e._descending,t.sort(n)};var i=0;return r._addAlgorithm((function(e,r,o){for(var a=e.key;0<n(a,t[i]);)if(++i===t.length)return r(o),!1;return 0===n(a,t[i])||(r((function(){e.continue(t[i])})),!1)})),r},qt.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},qt.prototype.noneOf=function(){var e=q.apply(E,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return It(this,Ze)}var t=e.reduce((function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]}),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},qt.prototype.inAnyRange=function(e,t){var n=this,r=this._cmp,i=this._ascending,o=this._descending,a=this._min,s=this._max;if(0===e.length)return Tt(this);if(!e.every((function(e){return void 0!==e[0]&&void 0!==e[1]&&i(e[0],e[1])<=0})))return It(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",H.InvalidArgument);var c,u=!t||!1!==t.includeLowers,f=t&&!0===t.includeUppers,l=i;function d(e,t){return l(e[0],t[0])}try{(c=e.reduce((function(e,t){for(var n=0,i=e.length;n<i;++n){var o=e[n];if(r(t[0],o[1])<0&&0<r(t[1],o[0])){o[0]=a(o[0],t[0]),o[1]=s(o[1],t[1]);break}}return n===i&&e.push(t),e}),[])).sort(d)}catch(e){return It(this,Ze)}var h=0,p=f?function(e){return 0<i(e,c[h][1])}:function(e){return 0<=i(e,c[h][1])},y=u?function(e){return 0<o(e,c[h][0])}:function(e){return 0<=o(e,c[h][0])},v=p;return(e=new this.Collection(this,(function(){return Dt(c[0][0],c[c.length-1][1],!u,!f)})))._ondirectionchange=function(e){l="next"===e?(v=p,i):(v=y,o),c.sort(d)},e._addAlgorithm((function(e,t,r){for(var o,a=e.key;v(a);)if(++h===c.length)return t(r),!1;return!p(o=a)&&!y(o)||(0===n._cmp(a,c[h][1])||0===n._cmp(a,c[h][0])||t((function(){l===i?e.continue(c[h][0]):e.continue(c[h][1])})),!1)})),e},qt.prototype.startsWithAnyOf=function(){var e=q.apply(E,arguments);return e.every((function(e){return"string"==typeof e}))?0===e.length?Tt(this):this.inAnyRange(e.map((function(e){return[e,e+Xe]}))):It(this,"startsWithAnyOf() only works with strings")},qt);function qt(){}function Nt(e){return Ce((function(t){return $t(t),e(t.target.error),!1}))}function $t(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Bt="storagemutated",Kt="x-storagemutated-1",Ft=pt(null,Bt),Lt=(Wt.prototype._lock=function(){return b(!me.global),++this._reculock,1!==this._reculock||me.global||(me.lockOwnerFor=this),this},Wt.prototype._unlock=function(){if(b(!me.global),0==--this._reculock)for(me.global||(me.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{ze(e[1],e[0])}catch(e){}}return this},Wt.prototype._locked=function(){return this._reculock&&me.lockOwnerFor!==this},Wt.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(b(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new H.DatabaseClosed(r);case"MissingAPIError":throw new H.MissingAPI(r.message,r);default:throw new H.OpenFailed(r)}if(!this.active)throw new H.TransactionInactive;return b(null===this._completion._state),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ce((function(n){$t(n),t._reject(e.error)})),e.onabort=Ce((function(n){$t(n),t.active&&t._reject(new H.Abort(e.error)),t.active=!1,t.on("abort").fire(n)})),e.oncomplete=Ce((function(){t.active=!1,t._resolve(),"mutatedParts"in e&&Ft.storagemutated.fire(e.mutatedParts)})),this},Wt.prototype._promise=function(e,t,n){var r=this;if("readwrite"===e&&"readwrite"!==this.mode)return Qe(new H.ReadOnly("Transaction is readonly"));if(!this.active)return Qe(new H.TransactionInactive);if(this._locked())return new Se((function(i,o){r._blockedFuncs.push([function(){r._promise(e,t,n).then(i,o)},me])}));if(n)return Fe((function(){var e=new Se((function(e,n){r._lock();var i=t(e,n,r);i&&i.then&&i.then(e,n)}));return e.finally((function(){return r._unlock()})),e._lib=!0,e}));var i=new Se((function(e,n){var i=t(e,n,r);i&&i.then&&i.then(e,n)}));return i._lib=!0,i},Wt.prototype._root=function(){return this.parent?this.parent._root():this},Wt.prototype.waitFor=function(e){var t,n=this._root(),r=Se.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then((function(){return r})):(n._waitingFor=r,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),function e(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=e)}());var i=n._waitingFor;return new Se((function(e,t){r.then((function(t){return n._waitingQueue.push(Ce(e.bind(null,t)))}),(function(e){return n._waitingQueue.push(Ce(t.bind(null,e)))})).finally((function(){n._waitingFor===i&&(n._waitingFor=null)}))}))},Wt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new H.Abort))},Wt.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(f(t,e))return t[e];var n=this.schema[e];if(!n)throw new H.NotFound("Table "+e+" not part of transaction");return(n=new this.db.Table(e,n,this)).core=this.db.core.table(e),t[e]=n},Wt);function Wt(){}function Yt(e,t,n,r,i,o,a){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:o,src:(n&&!a?"&":"")+(r?"*":"")+(i?"++":"")+Ut(t)}}function Ut(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function Ht(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(r=function(e){return[e.name,e]},n.reduce((function(e,t,n){return(n=r(t))&&(e[n[0]]=n[1]),e}),{}))};var r}var Vt=function(e){try{return e.only([[]]),Vt=function(){return[[]]},[[]]}catch(e){return Vt=function(){return Xe},Xe}};function zt(e){return null==e?function(){}:"string"==typeof e?1===(t=e).split(".").length?function(e){return e[t]}:function(e){return _(e,t)}:function(t){return _(t,e)};var t}function Gt(e){return[].slice.call(e)}var Jt=0;function Qt(e){return null==e?":id":"string"==typeof e?e:"[".concat(e.join("+"),"]")}function Xt(e,t,n){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var n=e.lower,r=e.upper,i=e.lowerOpen;return e=e.upperOpen,void 0===n?void 0===r?null:t.upperBound(r,!!e):void 0===r?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!e)}var i,o,s,c=(o=n,s=Gt((i=e).objectStoreNames),{schema:{name:i.name,tables:s.map((function(e){return o.objectStore(e)})).map((function(e){var t=e.keyPath,n=e.autoIncrement,r=a(t),i={};return n={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==t,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:zt(t)},indexes:Gt(e.indexNames).map((function(t){return e.index(t)})).map((function(e){var t=e.name,n=e.unique,r=e.multiEntry;return e=e.keyPath,r={name:t,compound:a(e),keyPath:e,unique:n,multiEntry:r,extractKey:zt(e)},i[Qt(e)]=r})),getIndexByKeyPath:function(e){return i[Qt(e)]}},i[":id"]=n.primaryKey,null!=t&&(i[Qt(t)]=n.primaryKey),n}))},hasGetAll:0<s.length&&"getAll"in o.objectStore(s[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),u=(n=c.schema,c.hasGetAll),f=(c=n.tables.map((function(e){var t,n=e.name;return{name:n,schema:e,mutate:function(e){var t=e.trans,i=e.type,o=e.keys,a=e.values,s=e.range;return new Promise((function(e,c){e=Ce(e);var u=t.objectStore(n),f=null==u.keyPath,l="put"===i||"add"===i;if(!l&&"delete"!==i&&"deleteRange"!==i)throw new Error("Invalid operation type: "+i);var d,h=(o||a||{length:1}).length;if(o&&a&&o.length!==a.length)throw new Error("Given keys array must have same length as given values array.");if(0===h)return e({numFailures:0,failures:{},results:[],lastResult:void 0});function p(e){++g,$t(e)}var y=[],v=[],g=0;if("deleteRange"===i){if(4===s.type)return e({numFailures:g,failures:v,results:[],lastResult:void 0});3===s.type?y.push(d=u.clear()):y.push(d=u.delete(r(s)))}else{var m=(f=l?f?[a,o]:[a,null]:[o,null])[0],b=f[1];if(l)for(var w=0;w<h;++w)y.push(d=b&&void 0!==b[w]?u[i](m[w],b[w]):u[i](m[w])),d.onerror=p;else for(w=0;w<h;++w)y.push(d=u[i](m[w])),d.onerror=p}function _(t){t=t.target.result,y.forEach((function(e,t){return null!=e.error&&(v[t]=e.error)})),e({numFailures:g,failures:v,results:"delete"===i?o:y.map((function(e){return e.result})),lastResult:t})}d.onerror=function(e){p(e),_(e)},d.onsuccess=_}))},getMany:function(e){var t=e.trans,r=e.keys;return new Promise((function(e,i){e=Ce(e);for(var o,a=t.objectStore(n),s=r.length,c=new Array(s),u=0,f=0,l=function(t){t=t.target,c[t._pos]=t.result,++f===u&&e(c)},d=Nt(i),h=0;h<s;++h)null!=r[h]&&((o=a.get(r[h]))._pos=h,o.onsuccess=l,o.onerror=d,++u);0===u&&e(c)}))},get:function(e){var t=e.trans,r=e.key;return new Promise((function(e,i){e=Ce(e);var o=t.objectStore(n).get(r);o.onsuccess=function(t){return e(t.target.result)},o.onerror=Nt(i)}))},query:(t=u,function(e){return new Promise((function(i,o){i=Ce(i);var a,s,c,u=e.trans,f=e.values,l=e.limit,d=e.query,h=l===1/0?void 0:l,p=d.index;if(d=d.range,u=u.objectStore(n),p=p.isPrimaryKey?u:u.index(p.name),d=r(d),0===l)return i({result:[]});t?((h=f?p.getAll(d,h):p.getAllKeys(d,h)).onsuccess=function(e){return i({result:e.target.result})},h.onerror=Nt(o)):(a=0,s=!f&&"openKeyCursor"in p?p.openKeyCursor(d):p.openCursor(d),c=[],s.onsuccess=function(e){var t=s.result;return t?(c.push(f?t.value:t.primaryKey),++a===l?i({result:c}):void t.continue()):i({result:c})},s.onerror=Nt(o))}))}),openCursor:function(e){var t=e.trans,i=e.values,o=e.query,a=e.reverse,s=e.unique;return new Promise((function(e,c){e=Ce(e);var u=o.index,f=o.range,l=t.objectStore(n),d=(l=u.isPrimaryKey?l:l.index(u.name),u=a?s?"prevunique":"prev":s?"nextunique":"next",!i&&"openKeyCursor"in l?l.openKeyCursor(r(f),u):l.openCursor(r(f),u));d.onerror=Nt(c),d.onsuccess=Ce((function(n){var r,i,o,a,s=d.result;s?(s.___id=++Jt,s.done=!1,r=s.continue.bind(s),i=(i=s.continuePrimaryKey)&&i.bind(s),o=s.advance.bind(s),a=function(){throw new Error("Cursor not stopped")},s.trans=t,s.stop=s.continue=s.continuePrimaryKey=s.advance=function(){throw new Error("Cursor not started")},s.fail=Ce(c),s.next=function(){var e=this,t=1;return this.start((function(){return t--?e.continue():e.stop()})).then((function(){return e}))},s.start=function(e){function t(){if(d.result)try{e()}catch(e){s.fail(e)}else s.done=!0,s.start=function(){throw new Error("Cursor behind last entry")},s.stop()}var n=new Promise((function(e,t){e=Ce(e),d.onerror=Nt(t),s.fail=t,s.stop=function(t){s.stop=s.continue=s.continuePrimaryKey=s.advance=a,e(t)}}));return d.onsuccess=Ce((function(e){d.onsuccess=t,t()})),s.continue=r,s.continuePrimaryKey=i,s.advance=o,t(),n},e(s)):e(null)}),c)}))},count:function(e){var t=e.query,i=e.trans,o=t.index,a=t.range;return new Promise((function(e,t){var s=i.objectStore(n),c=o.isPrimaryKey?s:s.index(o.name);(c=(s=r(a))?c.count(s):c.count()).onsuccess=Ce((function(t){return e(t.target.result)})),c.onerror=Nt(t)}))}}})),{});return c.forEach((function(e){return f[e.name]=e})),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!f[e])throw new Error("Table '".concat(e,"' not found"));return f[e]},MIN_KEY:-1/0,MAX_KEY:Vt(t),schema:n}}function Zt(e,n){var r=n.db;n=function(e,n,r,i){var o=r.IDBKeyRange;return r.indexedDB,{dbcore:(i=Xt(n,o,i),e.dbcore.reduce((function(e,n){return n=n.create,t(t({},e),n(e))}),i))}}(e._middlewares,r,e._deps,n),e.core=n.dbcore,e.tables.forEach((function(t){var n=t.name;e.core.schema.tables.some((function(e){return e.name===n}))&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))}))}function en(e,t,n,r){n.forEach((function(n){var i=r[n];t.forEach((function(t){var r=function e(t,n){return y(t,n)||(t=c(t))&&e(t,n)}(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?h(t,n,{get:function(){return this.table(n)},set:function(e){d(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))}))}))}function tn(e,t){t.forEach((function(t){for(var n in t)t[n]instanceof e.Table&&delete t[n]}))}function nn(e,t){return e._cfg.version-t._cfg.version}function rn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],o=t[n];if(i){var a={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto)a.recreate=!0,r.change.push(a);else{var s=i.idxByName,c=o.idxByName,u=void 0;for(u in s)c[u]||a.del.push(u);for(u in c){var f=s[u],l=c[u];f?f.src!==l.src&&a.change.push(l):a.add.push(l)}(0<a.del.length||0<a.add.length||0<a.change.length)&&r.change.push(a)}}else r.add.push([n,o])}return r}function on(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((function(e){return sn(i,e)})),i}function an(e,t){o(e).forEach((function(n){t.db.objectStoreNames.contains(n)||(ie&&console.debug("Dexie: Creating missing table",n),on(t,n,e[n].primKey,e[n].indexes))}))}function sn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function cn(e,t,n){var r={};return g(t.objectStoreNames,0).forEach((function(e){for(var t=n.objectStore(e),i=Yt(Ut(s=t.keyPath),s||"",!0,!1,!!t.autoIncrement,s&&"string"!=typeof s,!0),o=[],a=0;a<t.indexNames.length;++a){var s=(c=t.index(t.indexNames[a])).keyPath,c=Yt(c.name,s,!!c.unique,!!c.multiEntry,!1,s&&"string"!=typeof s,!1);o.push(c)}r[e]=Ht(e,i,o)})),r}function un(e,t,n){for(var r=n.db.objectStoreNames,o=0;o<r.length;++o){var a=r[o],s=n.objectStore(a);e._hasGetAll="getAll"in s;for(var c=0;c<s.indexNames.length;++c){var u=s.indexNames[c],f=s.index(u).keyPath,l="string"==typeof f?f:"["+g(f).join("+")+"]";!t[a]||(f=t[a].idxByName[l])&&(f.name=u,delete t[a].idxByName[l],t[a].idxByName[u]=f)}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&i.WorkerGlobalScope&&i instanceof i.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function fn(e){return e.split(",").map((function(e,t){var n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return Yt(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),a(r),0===t)}))}var ln=(dn.prototype._parseStoresSpec=function(e,t){o(e).forEach((function(n){if(null!==e[n]){var r=fn(e[n]),i=r.shift();if(i.unique=!0,i.multi)throw new H.Schema("Primary key cannot be multi-valued");r.forEach((function(e){if(e.auto)throw new H.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new H.Schema("Index must have a name and cannot be an empty string")})),t[n]=Ht(n,i,r)}}))},dn.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?s(this._cfg.storesSource,e):e,e=t._versions;var n={},r={};return e.forEach((function(e){s(n,e._cfg.storesSource),r=e._cfg.dbschema={},e._parseStoresSpec(n,r)})),t._dbSchema=r,tn(t,[t._allTables,t,t.Transaction.prototype]),en(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],o(r),r),t._storeNames=o(r),this},dn.prototype.upgrade=function(e){return this._cfg.contentUpgrade=re(this._cfg.contentUpgrade||G,e),this},dn);function dn(){}function hn(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Jn(nt,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function pn(e){return e&&"function"==typeof e.databases}function yn(e){return Fe((function(){return me.letThrough=!0,e()}))}function vn(e){return!("from"in e)}var gn=function(e,t){if(!this){var n=new gn;return e&&"d"in e&&s(n,e),n}s(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function mn(e,t,n){var r=ut(t,n);if(!isNaN(r)){if(0<r)throw RangeError();if(vn(e))return s(e,{from:t,to:n,d:1});var i=e.l;if(r=e.r,ut(n,e.from)<0)return i?mn(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Sn(e);if(0<ut(t,e.to))return r?mn(r,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Sn(e);ut(t,e.from)<0&&(e.from=t,e.l=null,e.d=r?r.d+1:1),0<ut(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,i&&!e.l&&bn(e,i),r&&n&&bn(e,r)}}function bn(e,t){vn(t)||function e(t,n){var r=n.from,i=n.to,o=n.l;n=n.r,mn(t,r,i),o&&e(t,o),n&&e(t,n)}(e,t)}function wn(e,t){var n=_n(t),r=n.next();if(r.done)return!1;for(var i=r.value,o=_n(e),a=o.next(i.from),s=a.value;!r.done&&!a.done;){if(ut(s.from,i.to)<=0&&0<=ut(s.to,i.from))return!0;ut(i.from,s.from)<0?i=(r=n.next(s.from)).value:s=(a=o.next(i.from)).value}return!1}function _n(e){var t=vn(e)?null:{s:0,n:e};return{next:function(e){for(var n=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&ut(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||ut(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Sn(e){var n,r,i=((null===(n=e.r)||void 0===n?void 0:n.d)||0)-((null===(r=e.l)||void 0===r?void 0:r.d)||0),o=1<i?"r":i<-1?"l":"";o&&(n="r"==o?"l":"r",r=t({},e),i=e[o],e.from=i.from,e.to=i.to,e[o]=i[o],r[o]=i[n],(e[n]=r).d=kn(r)),e.d=kn(e)}function kn(e){var t=e.r;return e=e.l,(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}function On(e,t){return o(t).forEach((function(n){e[n]?bn(e[n],t[n]):e[n]=function e(t){var n,r,i={};for(n in t)f(t,n)&&(r=t[n],i[n]=!r||"object"!=typeof r||M.has(r.constructor)?r:e(r));return i}(t[n])})),e}function An(e,t){return e.all||t.all||Object.keys(e).some((function(n){return t[n]&&wn(t[n],e[n])}))}l(gn.prototype,(($={add:function(e){return bn(this,e),this},addKey:function(e){return mn(this,e,e),this},addKeys:function(e){var t=this;return e.forEach((function(e){return mn(t,e,e)})),this}})[P]=function(){return _n(this)},$));var xn={},Mn={},Rn=!1;function jn(e){On(Mn,e),Rn||(Rn=!0,setTimeout((function(){Rn=!1,In(Mn,!(Mn={}))}),0))}function In(e,t){void 0===t&&(t=!1);var n=new Set;if(e.all)for(var r=0,i=Object.values(xn);r<i.length;r++)Tn(a=i[r],e,n,t);else for(var o in e){var a,s=/^idb\:\/\/(.*)\/(.*)\//.exec(o);s&&(o=s[1],s=s[2],(a=xn["idb://".concat(o,"/").concat(s)])&&Tn(a,e,n,t))}n.forEach((function(e){return e()}))}function Tn(e,t,n,r){for(var i=[],o=0,a=Object.entries(e.queries.query);o<a.length;o++){for(var s=a[o],c=s[0],u=[],f=0,l=s[1];f<l.length;f++){var d=l[f];An(t,d.obsSet)?d.subscribers.forEach((function(e){return n.add(e)})):r&&u.push(d)}r&&i.push([c,u])}if(r)for(var h=0,p=i;h<p.length;h++){var y=p[h];c=y[0],u=y[1],e.queries.query[c]=u}}function Pn(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((function(){return t.dbOpenError?Qe(t.dbOpenError):e}));t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,i=Math.round(10*e.verno),a=!1;function s(){if(t.openCanceller!==r)throw new H.DatabaseClosed("db.open() was cancelled")}var c,u=t.dbReadyResolve,f=null,l=!1;return Se.race([r,("undefined"==typeof navigator?Se.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(e){function t(){return indexedDB.databases().finally(e)}c=setInterval(t,100),t()})).finally((function(){return clearInterval(c)})):Promise.resolve()).then((function r(){return new Se((function(c,u){if(s(),!n)throw new H.MissingAPI;var d=e.name,h=t.autoSchema||!i?n.open(d):n.open(d,i);if(!h)throw new H.MissingAPI;h.onerror=Nt(u),h.onblocked=Ce(e._fireOnBlocked),h.onupgradeneeded=Ce((function(r){var i;f=h.transaction,t.autoSchema&&!e._options.allowEmptyDB?(h.onerror=$t,f.abort(),h.result.close(),(i=n.deleteDatabase(d)).onsuccess=i.onerror=Ce((function(){u(new H.NoSuchDatabase("Database ".concat(d," doesnt exist")))}))):(f.onerror=Nt(u),r=r.oldVersion>Math.pow(2,62)?0:r.oldVersion,l=r<1,e.idbdb=h.result,a&&function(e,t){an(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=cn(0,e.idbdb,t);un(e,e._dbSchema,t);for(var r=0,i=rn(n,e._dbSchema).change;r<i.length;r++){var o=function(e){if(e.change.length||e.recreate)return console.warn("Unable to patch indexes of table ".concat(e.name," because it has changes on the type of index or primary key.")),{value:void 0};var n=t.objectStore(e.name);e.add.forEach((function(t){ie&&console.debug("Dexie upgrade patch: Creating missing index ".concat(e.name,".").concat(t.src)),sn(n,t)}))}(i[r]);if("object"==typeof o)return o.value}}(e,f),function(e,t,n,r){var i=e._dbSchema;n.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=Ht("$meta",fn("")[0],[]),e._storeNames.push("$meta"));var a=e._createTransaction("readwrite",e._storeNames,i);a.create(n),a._completion.catch(r);var s=a._reject.bind(a),c=me.transless||me;Fe((function(){return me.trans=a,me.transless=c,0!==t?(Zt(e,n),u=t,((r=a).storeNames.includes("$meta")?r.table("$meta").get("version").then((function(e){return null!=e?e:u})):Se.resolve(u)).then((function(t){return i=t,s=a,c=n,u=[],t=(r=e)._versions,f=r._dbSchema=cn(0,r.idbdb,c),0!==(t=t.filter((function(e){return e._cfg.version>=i}))).length?(t.forEach((function(e){u.push((function(){var t=f,n=e._cfg.dbschema;un(r,t,c),un(r,n,c),f=r._dbSchema=n;var a=rn(t,n);a.add.forEach((function(e){on(c,e[0],e[1].primKey,e[1].indexes)})),a.change.forEach((function(e){if(e.recreate)throw new H.Upgrade("Not yet support for changing primary key");var t=c.objectStore(e.name);e.add.forEach((function(e){return sn(t,e)})),e.change.forEach((function(e){t.deleteIndex(e.name),sn(t,e)})),e.del.forEach((function(e){return t.deleteIndex(e)}))}));var u=e._cfg.contentUpgrade;if(u&&e._cfg.version>i){Zt(r,c),s._memoizedTables={};var l=k(n);a.del.forEach((function(e){l[e]=t[e]})),tn(r,[r.Transaction.prototype]),en(r,[r.Transaction.prototype],o(l),l),s.schema=l;var d,h=N(u);return h&&Le(),a=Se.follow((function(){var e;(d=u(s))&&h&&(e=We.bind(null,null),d.then(e,e))})),d&&"function"==typeof d.then?Se.resolve(d):a.then((function(){return d}))}})),u.push((function(t){var n,i,o=e._cfg.dbschema;n=o,i=t,[].slice.call(i.db.objectStoreNames).forEach((function(e){return null==n[e]&&i.db.deleteObjectStore(e)})),tn(r,[r.Transaction.prototype]),en(r,[r.Transaction.prototype],r._storeNames,r._dbSchema),s.schema=r._dbSchema})),u.push((function(t){r.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(r.idbdb.version/10)===e._cfg.version?(r.idbdb.deleteObjectStore("$meta"),delete r._dbSchema.$meta,r._storeNames=r._storeNames.filter((function(e){return"$meta"!==e}))):t.objectStore("$meta").put(e._cfg.version,"version"))}))})),function e(){return u.length?Se.resolve(u.shift()(s.idbtrans)).then(e):Se.resolve()}().then((function(){an(f,c)}))):Se.resolve();var r,i,s,c,u,f})).catch(s)):(o(i).forEach((function(e){on(n,e,i[e].primKey,i[e].indexes)})),Zt(e,n),void Se.follow((function(){return e.on.populate.fire(a)})).catch(s));var r,u}))}(e,r/10,f,u))}),u),h.onsuccess=Ce((function(){f=null;var n,s,u,p,y,v=e.idbdb=h.result,m=g(v.objectStoreNames);if(0<m.length)try{var b=v.transaction(1===(p=m).length?p[0]:p,"readonly");if(t.autoSchema)s=v,u=b,(n=e).verno=s.version/10,u=n._dbSchema=cn(0,s,u),n._storeNames=g(s.objectStoreNames,0),en(n,[n._allTables],o(u),u);else if(un(e,e._dbSchema,b),((y=rn(cn(0,(y=e).idbdb,b),y._dbSchema)).add.length||y.change.some((function(e){return e.add.length||e.change.length})))&&!a)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),v.close(),i=v.version+1,a=!0,c(r());Zt(e,b)}catch(n){}tt.push(e),v.onversionchange=Ce((function(n){t.vcFired=!0,e.on("versionchange").fire(n)})),v.onclose=Ce((function(t){e.on("close").fire(t)})),l&&(y=e._deps,b=d,v=y.indexedDB,y=y.IDBKeyRange,pn(v)||b===nt||hn(v,y).put({name:b}).catch(G)),c()}),u)})).catch((function(e){switch(null==e?void 0:e.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),r();break;case"VersionError":if(0<i)return i=0,r()}return Se.reject(e)}))}))]).then((function(){return s(),t.onReadyBeingFired=[],Se.resolve(yn((function(){return e.on.ready.fire(e.vip)}))).then((function n(){if(0<t.onReadyBeingFired.length){var r=t.onReadyBeingFired.reduce(re,G);return t.onReadyBeingFired=[],Se.resolve(yn((function(){return r(e.vip)}))).then(n)}}))})).finally((function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)})).catch((function(n){t.dbOpenError=n;try{f&&f.abort()}catch(n){}return r===t.openCanceller&&e._close(),Qe(n)})).finally((function(){t.openComplete=!0,u()})).then((function(){var t;return l&&(t={},e.tables.forEach((function(n){n.schema.indexes.forEach((function(r){r.name&&(t["idb://".concat(e.name,"/").concat(n.name,"/").concat(r.name)]=new gn(-1/0,[[[]]]))})),t["idb://".concat(e.name,"/").concat(n.name,"/")]=t["idb://".concat(e.name,"/").concat(n.name,"/:dels")]=new gn(-1/0,[[[]]])})),Ft(Bt).fire(t),In(t,!0)),e}))}function Dn(e){function t(t){return e.next(t)}var n=i(t),r=i((function(t){return e.throw(t)}));function i(e){return function(t){var i=e(t);return t=i.value,i.done?t:t&&"function"==typeof t.then?t.then(n,r):a(t)?Promise.all(t).then(n,r):n(t)}}return i(t)()}function Cn(e,t,n){for(var r=a(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}var En={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return t(t({},e),{table:function(n){var r=e.table(n),i=r.schema,o={},a=[];function s(e,n,r){var i=Qt(e),c=o[i]=o[i]||[],u=null==e?0:"string"==typeof e?1:e.length,f=0<n;return f=t(t({},r),{name:f?"".concat(i,"(virtual-from:").concat(r.name,")"):r.name,lowLevelIndex:r,isVirtual:f,keyTail:n,keyLength:u,extractKey:zt(e),unique:!f&&r.unique}),c.push(f),f.isPrimaryKey||a.push(f),1<u&&s(2===u?e[0]:e.slice(0,u-1),n+1,r),c.sort((function(e,t){return e.keyTail-t.keyTail})),f}n=s(i.primaryKey.keyPath,0,i.primaryKey),o[":id"]=[n];for(var c=0,u=i.indexes;c<u.length;c++){var f=u[c];s(f.keyPath,0,f)}function l(n){var r,i=n.query.index;return i.isVirtual?t(t({},n),{query:{index:i.lowLevelIndex,range:(r=n.query.range,i=i.keyTail,{type:1===r.type?2:r.type,lower:Cn(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,i),lowerOpen:!0,upper:Cn(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,i),upperOpen:!0})}}):n}return t(t({},r),{schema:t(t({},i),{primaryKey:n,indexes:a,getIndexByKeyPath:function(e){return(e=o[Qt(e)])&&e[0]}}),count:function(e){return r.count(l(e))},query:function(e){return r.query(l(e))},openCursor:function(t){var n=t.query.index,i=n.keyTail,o=n.isVirtual,a=n.keyLength;return o?r.openCursor(l(t)).then((function(n){return n&&function(n){return Object.create(n,{continue:{value:function(r){null!=r?n.continue(Cn(r,t.reverse?e.MAX_KEY:e.MIN_KEY,i)):t.unique?n.continue(n.key.slice(0,a).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,i)):n.continue()}},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(Cn(t,e.MAX_KEY,i),r)}},primaryKey:{get:function(){return n.primaryKey}},key:{get:function(){var e=n.key;return 1===a?e[0]:e.slice(0,a)}},value:{get:function(){return n.value}}})}(n)})):r.openCursor(t)}})}})}};function qn(e,t,n,r){return n=n||{},r=r||"",o(e).forEach((function(i){var o,a,s;f(t,i)?(o=e[i],a=t[i],"object"==typeof o&&"object"==typeof a&&o&&a?(s=T(o))!==T(a)?n[r+i]=t[i]:"Object"===s?qn(o,a,n,r+i+"."):o!==a&&(n[r+i]=t[i]):o!==a&&(n[r+i]=t[i])):n[r+i]=void 0})),o(t).forEach((function(i){f(e,i)||(n[r+i]=t[i])})),n}function Nn(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}var $n={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return t(t({},e),{table:function(n){var i=e.table(n),o=i.schema.primaryKey;return t(t({},i),{mutate:function(e){var a=me.trans,s=a.table(n).hook,c=s.deleting,u=s.creating,l=s.updating;switch(e.type){case"add":if(u.fire===G)break;return a._promise("readwrite",(function(){return d(e)}),!0);case"put":if(u.fire===G&&l.fire===G)break;return a._promise("readwrite",(function(){return d(e)}),!0);case"delete":if(c.fire===G)break;return a._promise("readwrite",(function(){return d(e)}),!0);case"deleteRange":if(c.fire===G)break;return a._promise("readwrite",(function(){return function e(n,r,a){return i.query({trans:n,values:!1,query:{index:o,range:r},limit:a}).then((function(i){var o=i.result;return d({type:"delete",keys:o,trans:n}).then((function(i){return 0<i.numFailures?Promise.reject(i.failures[0]):o.length<a?{failures:[],numFailures:0,lastResult:void 0}:e(n,t(t({},r),{lower:o[o.length-1],lowerOpen:!0}),a)}))}))}(e.trans,e.range,1e4)}),!0)}return i.mutate(e);function d(e){var n,a,s,d=me.trans,h=e.keys||Nn(o,e);if(!h)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?t(t({},e),{keys:h}):t({},e)).type&&(e.values=r([],e.values,!0)),e.keys&&(e.keys=r([],e.keys,!0)),n=i,s=h,("add"===(a=e).type?Promise.resolve([]):n.getMany({trans:a.trans,keys:s,cache:"immutable"})).then((function(t){var n=h.map((function(n,r){var i,a,s,h=t[r],p={onerror:null,onsuccess:null};return"delete"===e.type?c.fire.call(p,n,h,d):"add"===e.type||void 0===h?(i=u.fire.call(p,n,e.values[r],d),null==n&&null!=i&&(e.keys[r]=n=i,o.outbound||S(e.values[r],o.keyPath,n))):(i=qn(h,e.values[r]),(a=l.fire.call(p,i,n,h,d))&&(s=e.values[r],Object.keys(a).forEach((function(e){f(s,e)?s[e]=a[e]:S(s,e,a[e])})))),p}));return i.mutate(e).then((function(r){for(var i=r.failures,o=r.results,a=r.numFailures,s=(r=r.lastResult,0);s<h.length;++s){var c=(o||h)[s],u=n[s];null==c?u.onerror&&u.onerror(i[s]):u.onsuccess&&u.onsuccess("put"===e.type&&t[s]?e.values[s]:c)}return{failures:i,results:o,numFailures:a,lastResult:r}})).catch((function(e){return n.forEach((function(t){return t.onerror&&t.onerror(e)})),Promise.reject(e)}))}))}}})}})}};function Bn(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;for(var r=[],i=0,o=0;i<t.keys.length&&o<e.length;++i)0===ut(t.keys[i],e[o])&&(r.push(n?j(t.values[i]):t.values[i]),++o);return r.length===e.length?r:null}catch(e){return null}}var Kn={stack:"dbcore",level:-1,create:function(e){return{table:function(n){var r=e.table(n);return t(t({},r),{getMany:function(e){if(!e.cache)return r.getMany(e);var t=Bn(e.keys,e.trans._cache,"clone"===e.cache);return t?Se.resolve(t):r.getMany(e).then((function(t){return e.trans._cache={keys:e.keys,values:"clone"===e.cache?j(t):t},t}))},mutate:function(e){return"add"!==e.type&&(e.trans._cache=null),r.mutate(e)}})}}}};function Fn(e,t){return"readonly"===e.trans.mode&&!!e.subscr&&!e.trans.explicit&&"disabled"!==e.trans.db._options.cache&&!t.schema.primaryKey.outbound}function Ln(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Wn={stack:"dbcore",level:0,name:"Observability",create:function(e){var n=e.schema.name,r=new gn(e.MIN_KEY,e.MAX_KEY);return t(t({},e),{transaction:function(t,n,r){if(me.subscr&&"readonly"!==n)throw new H.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(me.querier));return e.transaction(t,n,r)},table:function(i){function s(t){t=(n=t.query).index;var n=n.range;return[t,new gn(null!==(t=n.lower)&&void 0!==t?t:e.MIN_KEY,null!==(n=n.upper)&&void 0!==n?n:e.MAX_KEY)]}var c=e.table(i),u=c.schema,f=u.primaryKey,l=f.extractKey,d=f.outbound,h=t(t({},c),{mutate:function(e){function t(e){return e="idb://".concat(n,"/").concat(i,"/").concat(e),h[e]||(h[e]=new gn)}var o,s,l,d=e.trans,h=e.mutatedParts||(e.mutatedParts={}),p=t(""),y=t(":dels"),v=e.type,g="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[Nn(f,e).filter((function(e){return e})),e.values]:[],m=g[0],b=g[1];return g=e.trans._cache,a(m)?(p.addKeys(m),(g="delete"===v||m.length===b.length?Bn(m,g):null)||y.addKeys(m),(g||b)&&(o=t,s=g,l=b,u.indexes.forEach((function(e){var t=o(e.name||"");function n(t){return null!=t?e.extractKey(t):null}function r(n){return e.multiEntry&&a(n)?n.forEach((function(e){return t.addKey(e)})):t.addKey(n)}(s||l).forEach((function(e,t){var i=s&&n(s[t]);0!==ut(i,t=l&&n(l[t]))&&(null!=i&&r(i),null!=t&&r(t))}))})))):m?(b={from:m.lower,to:m.upper},y.add(b),p.add(b)):(p.add(r),y.add(r),u.indexes.forEach((function(e){return t(e.name).add(r)}))),c.mutate(e).then((function(t){return!m||"add"!==e.type&&"put"!==e.type||p.addKeys(t.results),d.mutatedParts=On(d.mutatedParts||{},h),t}))}}),p={get:function(e){return[f,new gn(e.key)]},getMany:function(e){return[f,(new gn).addKeys(e.keys)]},count:s,query:s,openCursor:s};return o(p).forEach((function(e){h[e]=function(o){var a=!!(y=me.subscr),s=Fn(me,c)&&Ln(e,o)?o.obsSet={}:y;if(a){var u=function(e){return e="idb://".concat(n,"/").concat(i,"/").concat(e),s[e]||(s[e]=new gn)},f=u(""),h=u(":dels"),y=(a=(y=p[e](o))[0],y[1]);if(("query"===e&&a.isPrimaryKey&&!o.values?h:u(a.name||"")).add(y),!a.isPrimaryKey){if("count"!==e){var v="query"===e&&d&&o.values&&c.query(t(t({},o),{values:!1}));return c[e].apply(this,arguments).then((function(t){if("query"===e){if(d&&o.values)return v.then((function(e){return e=e.result,f.addKeys(e),t}));var n=o.values?t.result.map(l):t.result;(o.values?f:h).addKeys(n)}else if("openCursor"===e){var r=t,i=o.values;return r&&Object.create(r,{key:{get:function(){return h.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return h.addKey(e),e}},value:{get:function(){return i&&f.addKey(r.primaryKey),r.value}}})}return t}))}h.add(r)}}return c[e].apply(this,arguments)}})),h}})}};function Yn(e,n,r){if(0===r.numFailures)return n;if("deleteRange"===n.type)return null;var i=n.keys?n.keys.length:"values"in n&&n.values?n.values.length:1;return r.numFailures===i?null:(n=t({},n),a(n.keys)&&(n.keys=n.keys.filter((function(e,t){return!(t in r.failures)}))),"values"in n&&a(n.values)&&(n.values=n.values.filter((function(e,t){return!(t in r.failures)}))),n)}function Un(e,t){return n=e,(void 0===(r=t).lower||(r.lowerOpen?0<ut(n,r.lower):0<=ut(n,r.lower)))&&(void 0===t.upper||(t.upperOpen?ut(e,t.upper)<0:ut(e,t.upper)<=0));var n,r}function Hn(e,t,n,r,i,o){if(!n||0===n.length)return e;var s=t.query.index,c=s.multiEntry,u=t.query.range,f=r.schema.primaryKey.extractKey,l=s.extractKey,d=(s.lowLevelIndex||s).extractKey;return n=n.reduce((function(e,n){var r=e,i="add"===n.type||"put"===n.type?n.values.filter((function(e){return e=l(e),c&&a(e)?e.some((function(e){return Un(e,u)})):Un(e,u)})).map((function(e){return e=j(e),o&&Object.freeze(e),e})):[];switch(n.type){case"add":r=e.concat(t.values?i:i.map((function(e){return f(e)})));break;case"put":var s=(new gn).addKeys(n.values.map((function(e){return f(e)})));r=e.filter((function(e){return e=t.values?f(e):e,!wn(new gn(e),s)})).concat(t.values?i:i.map((function(e){return f(e)})));break;case"delete":var d=(new gn).addKeys(n.keys);r=e.filter((function(e){return e=t.values?f(e):e,!wn(new gn(e),d)}));break;case"deleteRange":var h=n.range;r=e.filter((function(e){return!Un(f(e),h)}))}return r}),e),n===e?e:(n.sort((function(e,t){return ut(d(e),d(t))||ut(f(e),f(t))})),t.limit&&t.limit<1/0&&(n.length>t.limit?n.length=t.limit:e.length===t.limit&&n.length<t.limit&&(i.dirty=!0)),o?Object.freeze(n):n)}function Vn(e,t){return 0===ut(e.lower,t.lower)&&0===ut(e.upper,t.upper)&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}var zn={stack:"dbcore",level:0,name:"Cache",create:function(e){var n=e.schema.name;return t(t({},e),{transaction:function(t,r,i){var o,a,s=e.transaction(t,r,i);return"readwrite"===r&&(a=(o=new AbortController).signal,i=function(i){return function(){if(o.abort(),"readwrite"===r){for(var a=new Set,c=0,u=t;c<u.length;c++){var f=u[c],l=xn["idb://".concat(n,"/").concat(f)];if(l){var d=e.table(f),h=l.optimisticOps.filter((function(e){return e.trans===s}));if(s._explicit&&i&&s.mutatedParts)for(var p=0,y=Object.values(l.queries.query);p<y.length;p++)for(var v=0,g=(w=y[p]).slice();v<g.length;v++)An((_=g[v]).obsSet,s.mutatedParts)&&(C(w,_),_.subscribers.forEach((function(e){return a.add(e)})));else if(0<h.length){l.optimisticOps=l.optimisticOps.filter((function(e){return e.trans!==s}));for(var m=0,b=Object.values(l.queries.query);m<b.length;m++)for(var w,_,S,k=0,O=(w=b[m]).slice();k<O.length;k++)null!=(_=O[k]).res&&s.mutatedParts&&(i&&!_.dirty?(S=Object.isFrozen(_.res),S=Hn(_.res,_.req,h,d,_,S),_.dirty?(C(w,_),_.subscribers.forEach((function(e){return a.add(e)}))):S!==_.res&&(_.res=S,_.promise=Se.resolve({result:S}))):(_.dirty&&C(w,_),_.subscribers.forEach((function(e){return a.add(e)}))))}}}a.forEach((function(e){return e()}))}}},s.addEventListener("abort",i(!1),{signal:a}),s.addEventListener("error",i(!1),{signal:a}),s.addEventListener("complete",i(!0),{signal:a})),s},table:function(r){var i=e.table(r),o=i.schema.primaryKey;return t(t({},i),{mutate:function(e){var a=me.trans;if(o.outbound||"disabled"===a.db._options.cache||a.explicit)return i.mutate(e);var s=xn["idb://".concat(n,"/").concat(r)];return s?(a=i.mutate(e),"add"!==e.type&&"put"!==e.type||!(50<=e.values.length||Nn(o,e).some((function(e){return null==e})))?(s.optimisticOps.push(e),e.mutatedParts&&jn(e.mutatedParts),a.then((function(t){0<t.numFailures&&(C(s.optimisticOps,e),(t=Yn(0,e,t))&&s.optimisticOps.push(t),e.mutatedParts&&jn(e.mutatedParts))})),a.catch((function(){C(s.optimisticOps,e),e.mutatedParts&&jn(e.mutatedParts)}))):a.then((function(n){var r=Yn(0,t(t({},e),{values:e.values.map((function(e,r){var i;return S(e=null!==(i=o.keyPath)&&void 0!==i&&i.includes(".")?j(e):t({},e),o.keyPath,n.results[r]),e}))}),n);s.optimisticOps.push(r),queueMicrotask((function(){return e.mutatedParts&&jn(e.mutatedParts)}))})),a):i.mutate(e)},query:function(e){if(!Fn(me,i)||!Ln("query",e))return i.query(e);var t="immutable"===(null===(s=me.trans)||void 0===s?void 0:s.db._options.cache),o=(u=me).requery,a=u.signal,s=function(e,t,n,r){var i=xn["idb://".concat(e,"/").concat(t)];if(!i)return[];if(!(t=i.queries[n]))return[null,!1,i,null];var o=t[(r.query?r.query.index.name:null)||""];if(!o)return[null,!1,i,null];switch(n){case"query":var a=o.find((function(e){return e.req.limit===r.limit&&e.req.values===r.values&&Vn(e.req.query.range,r.query.range)}));return a?[a,!0,i,o]:[o.find((function(e){return("limit"in e.req?e.req.limit:1/0)>=r.limit&&(!r.values||e.req.values)&&function(e,t){return function(e,t,n,r){if(void 0===e)return void 0!==t?-1:0;if(void 0===t)return 1;if(0===(t=ut(e,t))){if(n&&r)return 0;if(n)return 1;if(r)return-1}return t}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(e,t,n,r){if(void 0===e)return void 0!==t?1:0;if(void 0===t)return-1;if(0===(t=ut(e,t))){if(n&&r)return 0;if(n)return-1;if(r)return 1}return t}(e.upper,t.upper,e.upperOpen,t.upperOpen)}(e.req.query.range,r.query.range)})),!1,i,o];case"count":return a=o.find((function(e){return Vn(e.req.query.range,r.query.range)})),[a,!!a,i,o]}}(n,r,"query",e),c=s[0],u=s[1],f=s[2],l=s[3];return c&&u?c.obsSet=e.obsSet:(u=i.query(e).then((function(e){var n=e.result;if(c&&(c.res=n),t){for(var r=0,i=n.length;r<i;++r)Object.freeze(n[r]);Object.freeze(n)}else e.result=j(n);return e})).catch((function(e){return l&&c&&C(l,c),Promise.reject(e)})),c={obsSet:e.obsSet,promise:u,subscribers:new Set,type:"query",req:e,dirty:!1},l?l.push(c):(l=[c],(f=f||(xn["idb://".concat(n,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[e.query.index.name||""]=l)),function(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",(function(){var r,i;e.subscribers.delete(n),0===e.subscribers.size&&(r=e,i=t,setTimeout((function(){0===r.subscribers.size&&C(i,r)}),3e3))}))}(c,l,o,a),c.promise.then((function(n){return{result:Hn(n.result,e,null==f?void 0:f.optimisticOps,i,c,t)}}))}})}})}};function Gn(e,t){return new Proxy(e,{get:function(e,n,r){return"db"===n?t:Reflect.get(e,n,r)}})}var Jn=(Qn.prototype.version=function(e){if(isNaN(e)||e<.1)throw new H.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new H.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter((function(t){return t._cfg.version===e}))[0];return n||(n=new this.Version(e),t.push(n),t.sort(nn),n.stores({}),this._state.autoSchema=!1,n)},Qn.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||me.letThrough||this._vip)?e():new Se((function(e,n){if(t._state.openComplete)return n(new H.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void n(new H.DatabaseClosed);t.open().catch(G)}t._state.dbReadyPromise.then(e,n)})).then(e)},Qn.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;return i&&this.unuse({stack:t,name:i}),(e=this._middlewares[t]||(this._middlewares[t]=[])).push({stack:t,create:n,level:null==r?10:r,name:i}),e.sort((function(e,t){return e.level-t.level})),this},Qn.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter((function(e){return r?e.create!==r:!!n&&e.name!==n}))),this},Qn.prototype.open=function(){var e=this;return ze(ge,(function(){return Pn(e)}))},Qn.prototype._close=function(){var e=this._state,t=tt.indexOf(this);if(0<=t&&tt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(t){}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new Se((function(t){e.dbReadyResolve=t})),e.openCanceller=new Se((function(t,n){e.cancelOpen=n})))},Qn.prototype.close=function(e){var t=(void 0===e?{disableAutoOpen:!0}:e).disableAutoOpen;e=this._state,t?(e.isBeingOpened&&e.cancelOpen(new H.DatabaseClosed),this._close(),e.autoOpen=!1,e.dbOpenError=new H.DatabaseClosed):(this._close(),e.autoOpen=this._options.autoOpen||e.isBeingOpened,e.openComplete=!1,e.dbOpenError=null)},Qn.prototype.delete=function(e){var t=this;void 0===e&&(e={disableAutoOpen:!0});var n=0<arguments.length&&"object"!=typeof arguments[0],r=this._state;return new Se((function(i,o){function a(){t.close(e);var n=t._deps.indexedDB.deleteDatabase(t.name);n.onsuccess=Ce((function(){var e,n,r;e=t._deps,n=t.name,r=e.indexedDB,e=e.IDBKeyRange,pn(r)||n===nt||hn(r,e).delete(n).catch(G),i()})),n.onerror=Nt(o),n.onblocked=t._fireOnBlocked}if(n)throw new H.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(a):a()}))},Qn.prototype.backendDB=function(){return this.idbdb},Qn.prototype.isOpen=function(){return null!==this.idbdb},Qn.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},Qn.prototype.hasFailed=function(){return null!==this._state.dbOpenError},Qn.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Qn.prototype,"tables",{get:function(){var e=this;return o(this._allTables).map((function(t){return e._allTables[t]}))},enumerable:!1,configurable:!0}),Qn.prototype.transaction=function(){var e=function(e,t,n){var r=arguments.length;if(r<2)throw new H.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[e,A(i),n]}.apply(this,arguments);return this._transaction.apply(this,e)},Qn.prototype._transaction=function(e,t,n){var r=this,i=me.trans;i&&i.db===this&&-1===e.indexOf("!")||(i=null);var o,a,s=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(a=t.map((function(e){if("string"!=typeof(e=e instanceof r.Table?e.name:e))throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e})),"r"==e||e===rt)o=rt;else{if("rw"!=e&&e!=it)throw new H.InvalidArgument("Invalid transaction mode: "+e);o=it}if(i){if(i.mode===rt&&o===it){if(!s)throw new H.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach((function(e){if(i&&-1===i.storeNames.indexOf(e)){if(!s)throw new H.SubTransaction("Table "+e+" not included in parent transaction.");i=null}})),s&&i&&!i.active&&(i=null)}}catch(n){return i?i._promise(null,(function(e,t){t(n)})):Qe(n)}var c=function e(t,n,r,i,o){return Se.resolve().then((function(){var a=me.transless||me,s=t._createTransaction(n,r,t._dbSchema,i);if(s.explicit=!0,a={trans:s,transless:a},i)s.idbtrans=i.idbtrans;else try{s.create(),s.idbtrans._explicit=!0,t._state.PR1398_maxLoop=3}catch(a){return a.name===Y.InvalidState&&t.isOpen()&&0<--t._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),t.close({disableAutoOpen:!1}),t.open().then((function(){return e(t,n,r,null,o)}))):Qe(a)}var c,u=N(o);return u&&Le(),a=Se.follow((function(){var e;(c=o.call(s,s))&&(u?(e=We.bind(null,null),c.then(e,e)):"function"==typeof c.next&&"function"==typeof c.throw&&(c=Dn(c)))}),a),(c&&"function"==typeof c.then?Se.resolve(c).then((function(e){return s.active?e:Qe(new H.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):a.then((function(){return c}))).then((function(e){return i&&s._resolve(),s._completion.then((function(){return e}))})).catch((function(e){return s._reject(e),Qe(e)}))}))}.bind(null,this,o,a,i,n);return i?i._promise(o,c,"lock"):me.trans?ze(me.transless,(function(){return r._whenReady(c)})):this._whenReady(c)},Qn.prototype.table=function(e){if(!f(this._allTables,e))throw new H.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},Qn);function Qn(e,n){var r=this;this._middlewares={},this.verno=0;var i=Qn.dependencies;this._options=n=t({addons:Qn.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange},i=n.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var o,a,s,c,u,f={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:G,dbReadyPromise:null,cancelOpen:G,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};f.dbReadyPromise=new Se((function(e){f.dbReadyResolve=e})),f.openCanceller=new Se((function(e,t){f.cancelOpen=t})),this._state=f,this.name=e,this.on=pt(this,"populate","blocked","versionchange","close",{ready:[re,G]}),this.on.ready.subscribe=m(this.on.ready.subscribe,(function(e){return function(t,n){Qn.vip((function(){var i,o=r._state;o.openComplete?(o.dbOpenError||Se.resolve().then(t),n&&e(t)):o.onReadyBeingFired?(o.onReadyBeingFired.push(t),n&&e(t)):(e(t),i=r,n||e((function e(){i.on.ready.unsubscribe(t),i.on.ready.unsubscribe(e)})))}))}})),this.Collection=(o=this,yt(At.prototype,(function(e,t){this.db=o;var n=at,r=null;if(t)try{n=t()}catch(e){r=e}var i=e._ctx;e=(t=i.table).hook.reading.fire,this._ctx={table:t,index:i.index,isPrimKey:!i.index||t.schema.primKey.keyPath&&i.index===t.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:e!==J?e:null}}))),this.Table=(a=this,yt(dt.prototype,(function(e,t,n){this.db=a,this._tx=n,this.name=e,this.schema=t,this.hook=a._allTables[e]?a._allTables[e].hook:pt(null,{creating:[Z,G],reading:[Q,J],updating:[te,G],deleting:[ee,G]})}))),this.Transaction=(s=this,yt(Lt.prototype,(function(e,t,n,r,i){var o=this;this.db=s,this.mode=e,this.storeNames=t,this.schema=n,this.chromeTransactionDurability=r,this.idbtrans=null,this.on=pt(this,"complete","error","abort"),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Se((function(e,t){o._resolve=e,o._reject=t})),this._completion.then((function(){o.active=!1,o.on.complete.fire()}),(function(e){var t=o.active;return o.active=!1,o.on.error.fire(e),o.parent?o.parent._reject(e):t&&o.idbtrans&&o.idbtrans.abort(),Qe(e)}))}))),this.Version=(c=this,yt(ln.prototype,(function(e){this.db=c,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))),this.WhereClause=(u=this,yt(Et.prototype,(function(e,t,n){if(this.db=u,this._ctx={table:e,index:":id"===t?null:t,or:n},this._cmp=this._ascending=ut,this._descending=function(e,t){return ut(t,e)},this._max=function(e,t){return 0<ut(e,t)?e:t},this._min=function(e,t){return ut(e,t)<0?e:t},this._IDBKeyRange=u._deps.IDBKeyRange,!this._IDBKeyRange)throw new H.MissingAPI}))),this.on("versionchange",(function(e){0<e.newVersion?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close({disableAutoOpen:!1})})),this.on("blocked",(function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(e.oldVersion/10))})),this._maxKey=Vt(n.IDBKeyRange),this._createTransaction=function(e,t,n,i){return new r.Transaction(e,t,n,r._options.chromeTransactionDurability,i)},this._fireOnBlocked=function(e){r.on("blocked").fire(e),tt.filter((function(e){return e.name===r.name&&e!==r&&!e._state.vcFired})).map((function(t){return t.on("versionchange").fire(e)}))},this.use(Kn),this.use(zn),this.use(Wn),this.use(En),this.use($n);var l=new Proxy(this,{get:function(e,t,n){if("_vip"===t)return!0;if("table"===t)return function(e){return Gn(r.table(e),l)};var i=Reflect.get(e,t,n);return i instanceof dt?Gn(i,l):"tables"===t?i.map((function(e){return Gn(e,l)})):"_createTransaction"===t?function(){return Gn(i.apply(this,arguments),l)}:i}});this.vip=l,i.forEach((function(e){return e(r)}))}$="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";var Xn,Zn=(er.prototype.subscribe=function(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})},er.prototype[$]=function(){return this},er);function er(e){this._subscribe=e}try{Xn={indexedDB:i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,IDBKeyRange:i.IDBKeyRange||i.webkitIDBKeyRange}}catch(x){Xn={indexedDB:null,IDBKeyRange:null}}function tr(e){var t,n=!1,r=new Zn((function(r){var i,o=N(e),a=!1,s={},c={},u={get closed(){return a},unsubscribe:function(){a||(a=!0,i&&i.abort(),l&&Ft.storagemutated.unsubscribe(h))}};r.start&&r.start(u);var l=!1,d=function(){return Je(p)},h=function(e){On(s,e),An(c,s)&&d()},p=function(){var u,p,y;!a&&Xn.indexedDB&&(s={},u={},i&&i.abort(),i=new AbortController,y=function(t){var n=Ie();try{o&&Le();var r=Fe(e,t);return r=o?r.finally(We):r}finally{n&&Te()}}(p={subscr:u,signal:i.signal,requery:d,querier:e,trans:null}),Promise.resolve(y).then((function(e){n=!0,t=e,a||p.signal.aborted||(s={},function(e){for(var t in e)if(f(e,t))return;return 1}(c=u)||l||(Ft(Bt,h),l=!0),Je((function(){return!a&&r.next&&r.next(e)})))}),(function(e){n=!1,["DatabaseClosedError","AbortError"].includes(null==e?void 0:e.name)||a||Je((function(){a||r.error&&r.error(e)}))})))};return setTimeout(d,0),u}));return r.hasValue=function(){return n},r.getValue=function(){return t},r}var nr=Jn;function rr(e){var t=or;try{or=!0,Ft.storagemutated.fire(e),In(e,!0)}finally{or=t}}l(nr,t(t({},z),{delete:function(e){return new nr(e,{addons:[]}).delete()},exists:function(e){return new nr(e,{addons:[]}).open().then((function(e){return e.close(),!0})).catch("NoSuchDatabaseError",(function(){return!1}))},getDatabaseNames:function(e){try{return n=(t=nr.dependencies).indexedDB,t=t.IDBKeyRange,(pn(n)?Promise.resolve(n.databases()).then((function(e){return e.map((function(e){return e.name})).filter((function(e){return e!==nt}))})):hn(n,t).toCollection().primaryKeys()).then(e)}catch(e){return Qe(new H.MissingAPI)}var t,n},defineClass:function(){return function(e){s(this,e)}},ignoreTransaction:function(e){return me.trans?ze(me.transless,e):e()},vip:yn,async:function(e){return function(){try{var t=Dn(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Se.resolve(t)}catch(t){return Qe(t)}}},spawn:function(e,t,n){try{var r=Dn(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Se.resolve(r)}catch(e){return Qe(e)}},currentTransaction:{get:function(){return me.trans||null}},waitFor:function(e,t){return t=Se.resolve("function"==typeof e?nr.ignoreTransaction(e):e).timeout(t||6e4),me.trans?me.trans.waitFor(t):t},Promise:Se,debug:{get:function(){return ie},set:function(e){oe(e)}},derive:p,extend:s,props:l,override:m,Events:pt,on:Ft,liveQuery:tr,extendObservabilitySet:On,getByKeyPath:_,setByKeyPath:S,delByKeyPath:function(e,t){"string"==typeof t?S(e,t,void 0):"length"in t&&[].map.call(t,(function(t){S(e,t,void 0)}))},shallowClone:k,deepClone:j,getObjectDiff:qn,cmp:ut,asap:w,minKey:-1/0,addons:[],connections:tt,errnames:Y,dependencies:Xn,cache:xn,semVer:"4.0.1",version:"4.0.1".split(".").map((function(e){return parseInt(e)})).reduce((function(e,t,n){return e+t/Math.pow(10,2*n)}))})),nr.maxKey=Vt(nr.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(Ft(Bt,(function(e){or||(e=new CustomEvent(Kt,{detail:e}),or=!0,dispatchEvent(e),or=!1)})),addEventListener(Kt,(function(e){e=e.detail,or||rr(e)})));var ir,or=!1,ar=function(){};return"undefined"!=typeof BroadcastChannel&&((ar=function(){(ir=new BroadcastChannel(Kt)).onmessage=function(e){return e.data&&rr(e.data)}})(),"function"==typeof ir.unref&&ir.unref(),Ft(Bt,(function(e){or||ir.postMessage(e)}))),"undefined"!=typeof addEventListener&&(addEventListener("pagehide",(function(e){if(!Jn.disableBfCache&&e.persisted){ie&&console.debug("Dexie: handling persisted pagehide"),null!=ir&&ir.close();for(var t=0,n=tt;t<n.length;t++)n[t].close({disableAutoOpen:!1})}})),addEventListener("pageshow",(function(e){!Jn.disableBfCache&&e.persisted&&(ie&&console.debug("Dexie: handling persisted pageshow"),ar(),rr({all:new gn(-1/0,[[]])}))}))),Se.rejectionMapper=function(e,t){return!e||e instanceof K||e instanceof TypeError||e instanceof SyntaxError||!e.name||!V[e.name]?e:(t=new V[e.name](t||e.message,e),"stack"in e&&h(t,"stack",{get:function(){return this.inner.stack}}),t)},oe(ie),t(Jn,Object.freeze({__proto__:null,Dexie:Jn,liveQuery:tr,Entity:ct,cmp:ut,PropModSymbol:x,PropModification:kt,replacePrefix:function(e,t){return new kt({replacePrefix:[e,t]})},default:Jn,RangeSet:gn,mergeRanges:bn,rangesOverlap:wn}),{default:Jn}),Jn}()},3347:(e,t,n)=>{var r;!function(e){!function(t){var r="object"==typeof globalThis?globalThis:"object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(e){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(e){}}(),i=o(e);function o(e,t){return function(n,r){Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0!==r.Reflect&&(i=o(r.Reflect,i)),function(e,t){var n=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,i=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,s={__proto__:[]}instanceof Array,c=!a&&!s,u={create:a?function(){return L(Object.create(null))}:s?function(){return L({__proto__:null})}:function(){return L({})},has:c?function(e,t){return n.call(e,t)}:function(e,t){return t in e},get:c?function(e,t){return n.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},f=Object.getPrototypeOf(Function),l="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[o]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,C(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,i)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[o]=function(){return this.entries()},t.prototype._find=function(e,t){if(!C(this._cacheKey,e)){this._cacheIndex=-1;for(var n=0;n<this._keys.length;n++)if(C(this._keys[n],e)){this._cacheIndex=n;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function i(e,t){return t}function a(e,t){return[e,t]}}(),d="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:function(){function e(){this._map=new l}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[o]=function(){return this.keys()},e}(),h="function"==typeof WeakMap?WeakMap:function(){var e=16,t=u.create(),r=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=o(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=o(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return o(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=o(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do{e="@@WeakMap@@"+s()}while(u.has(t,e));return t[e]=!0,e}function o(e,t){if(!n.call(e,r)){if(!t)return;Object.defineProperty(e,r,{value:u.create()})}return e[r]}function a(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function s(){var t=function(e){if("function"==typeof Uint8Array){var t=new Uint8Array(e);return"undefined"!=typeof crypto?crypto.getRandomValues(t):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(t):a(t,e),t}return a(new Array(e),e)}(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<e;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}(),p=r?Symbol.for("@reflect-metadata:registry"):void 0,y=function(){var e;return!A(p)&&M(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[p]),A(e)&&(e=function(){var e,n,r,i;A(p)||void 0===t.Reflect||p in t.Reflect||"function"!=typeof t.Reflect.defineMetadata||(e=function(e){var t=e.defineMetadata,n=e.hasOwnMetadata,r=e.getOwnMetadata,i=e.getOwnMetadataKeys,o=e.deleteMetadata,a=new h;return{isProviderFor:function(e,t){var n=a.get(e);return!(A(n)||!n.has(t))||!!i(e,t).length&&(A(n)&&(n=new d,a.set(e,n)),n.add(t),!0)},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:n,OrdinaryGetOwnMetadata:r,OrdinaryOwnMetadataKeys:i,OrdinaryDeleteMetadata:o}}(t.Reflect));var o=new h,a={registerProvider:s,getProvider:u,setProvider:y};return a;function s(t){if(!Object.isExtensible(a))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===t:break;case A(n):n=t;break;case n===t:break;case A(r):r=t;break;case r===t:break;default:void 0===i&&(i=new d),i.add(t)}}function c(t,o){if(!A(n)){if(n.isProviderFor(t,o))return n;if(!A(r)){if(r.isProviderFor(t,o))return n;if(!A(i))for(var a=q(i);;){var s=$(a);if(!s)return;var c=N(s);if(c.isProviderFor(t,o))return B(a),c}}}if(!A(e)&&e.isProviderFor(t,o))return e}function u(e,t){var n,r=o.get(e);return A(r)||(n=r.get(t)),A(n)?(A(n=c(e,t))||(A(r)&&(r=new l,o.set(e,r)),r.set(t,n)),n):n}function f(e){if(A(e))throw new TypeError;return n===e||r===e||!A(i)&&i.has(e)}function y(e,t,n){if(!f(n))throw new Error("Metadata provider not registered.");var r=u(e,t);if(r!==n){if(!A(r))return!1;var i=o.get(e);A(i)&&(i=new l,o.set(e,i)),i.set(t,n)}return!0}}()),!A(p)&&M(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,p,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}(),v=function(e){var t=new h,n={isProviderFor:function(e,n){var r=t.get(e);return!A(r)&&r.has(n)},OrdinaryDefineOwnMetadata:function(e,t,n,i){r(n,i,!0).set(e,t)},OrdinaryHasOwnMetadata:function(e,t,n){var i=r(t,n,!1);return!A(i)&&j(i.has(e))},OrdinaryGetOwnMetadata:function(e,t,n){var i=r(t,n,!1);if(!A(i))return i.get(e)},OrdinaryOwnMetadataKeys:function(e,t){var n=[],i=r(e,t,!1);if(A(i))return n;for(var o=q(i.keys()),a=0;;){var s=$(o);if(!s)return n.length=a,n;var c=N(s);try{n[a]=c}catch(e){try{B(o)}finally{throw e}}a++}},OrdinaryDeleteMetadata:function(e,n,i){var o=r(n,i,!1);if(A(o))return!1;if(!o.delete(e))return!1;if(0===o.size){var a=t.get(n);A(a)||(a.delete(i),0===a.size&&t.delete(a))}return!0}};return y.registerProvider(n),n;function r(r,i,o){var a=t.get(r),s=!1;if(A(a)){if(!o)return;a=new l,t.set(r,a),s=!0}var c=a.get(i);if(A(c)){if(!o)return;if(c=new l,a.set(i,c),!e.setProvider(r,i,n))throw a.delete(i),s&&t.delete(r),new Error("Wrong provider for target.")}return c}}(y);function g(e,t,n){if(m(e,t,n))return!0;var r=K(t);return!x(r)&&g(e,r,n)}function m(e,t,n){var r=F(t,n,!1);return!A(r)&&j(r.OrdinaryHasOwnMetadata(e,t,n))}function b(e,t,n){if(m(e,t,n))return w(e,t,n);var r=K(t);return x(r)?void 0:b(e,r,n)}function w(e,t,n){var r=F(t,n,!1);if(!A(r))return r.OrdinaryGetOwnMetadata(e,t,n)}function _(e,t,n,r){F(n,r,!0).OrdinaryDefineOwnMetadata(e,t,n,r)}function S(e,t){var n=k(e,t),r=K(e);if(null===r)return n;var i=S(r,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var o=new d,a=[],s=0,c=n;s<c.length;s++){var u=c[s];o.has(u)||(o.add(u),a.push(u))}for(var f=0,l=i;f<l.length;f++)u=l[f],o.has(u)||(o.add(u),a.push(u));return a}function k(e,t){var n=F(e,t,!1);return n?n.OrdinaryOwnMetadataKeys(e,t):[]}function O(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function A(e){return void 0===e}function x(e){return null===e}function M(e){return"object"==typeof e?null!==e:"function"==typeof e}function R(e,t){switch(O(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",r=E(e,i);if(void 0!==r){var o=r.call(e,n);if(M(o))throw new TypeError;return o}return function(e,t){if("string"===t){var n=e.toString;if(P(n)&&!M(i=n.call(e)))return i;if(P(r=e.valueOf)&&!M(i=r.call(e)))return i}else{var r;if(P(r=e.valueOf)&&!M(i=r.call(e)))return i;var i,o=e.toString;if(P(o)&&!M(i=o.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function j(e){return!!e}function I(e){var t=R(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function T(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function P(e){return"function"==typeof e}function D(e){return"function"==typeof e}function C(e,t){return e===t||e!=e&&t!=t}function E(e,t){var n=e[t];if(null!=n){if(!P(n))throw new TypeError;return n}}function q(e){var t=E(e,o);if(!P(t))throw new TypeError;var n=t.call(e);if(!M(n))throw new TypeError;return n}function N(e){return e.value}function $(e){var t=e.next();return!t.done&&t}function B(e){var t=e.return;t&&t.call(e)}function K(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===f)return t;if(t!==f)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function F(e,t,n){var r=y.getProvider(e,t);if(!A(r))return r;if(n){if(y.setProvider(e,t,v))return v;throw new Error("Illegal state.")}}function L(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(A(n)){if(!T(e))throw new TypeError;if(!D(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!A(r)&&!x(r)){if(!D(r))throw new TypeError;t=r}}return t}(e,t)}if(!T(e))throw new TypeError;if(!M(t))throw new TypeError;if(!M(r)&&!A(r)&&!x(r))throw new TypeError;return x(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,n,r);if(!A(o)&&!x(o)){if(!M(o))throw new TypeError;r=o}}return r}(e,t,n=I(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!M(n))throw new TypeError;if(!A(r)&&!function(e){switch(O(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;_(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!M(n))throw new TypeError;return A(r)||(r=I(r)),_(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!M(t))throw new TypeError;return A(n)||(n=I(n)),g(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!M(t))throw new TypeError;return A(n)||(n=I(n)),m(e,t,n)})),e("getMetadata",(function(e,t,n){if(!M(t))throw new TypeError;return A(n)||(n=I(n)),b(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!M(t))throw new TypeError;return A(n)||(n=I(n)),w(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!M(e))throw new TypeError;return A(t)||(t=I(t)),S(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!M(e))throw new TypeError;return A(t)||(t=I(t)),k(e,t)})),e("deleteMetadata",(function(e,t,n){if(!M(t))throw new TypeError;if(A(n)||(n=I(n)),!M(t))throw new TypeError;A(n)||(n=I(n));var r=F(t,n,!1);return!A(r)&&r.OrdinaryDeleteMetadata(e,t,n)}))}(i,r),void 0===r.Reflect&&(r.Reflect=e)}()}(r||(r={}))}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";n(3347);const e="StorageService",t="PermissionService",r="BackgroundService",i="NotificationService",o="BadgeService",a="InstallCheckService",s="MarketTradeOfferService",c="FloatInventoryService",u="InventoryService",f="SteamAccountRepository",l="MarketTradeOfferRepository",d="MigrationService",h="PopupCM",p="InjectCM",y="OffscreenCM",v="Logger",g="ExtensionStore",m="DeclarativeNetRequestService";var b;!function(e){e.NoAction="NoAction",e.Create="Create",e.Accept="Accept",e.CreateAndAccept="CreateAndAccept"}(b||(b={}));class w{constructor(){this.version="1.3.1",this.steamAuth=new k("Off"),this.market=new k("Off"),this.configuration=new S,this.hasRequiredPermissions=!1}}class _{constructor(e){this.username=e.username,this.steamId=e.steamId,this.sessionId=e.sessionId,this.tradeOfferUrl=e.tradeOfferUrl,this.avatarUrl=e.avatarUrl,this.accessToken=e.accessToken,this.lastWsClientId=e.lastWsClientId}}class S{constructor(){this.isExtensionEnabled=!0,this.serverLocation="world",this.tradeOfferResolutionMode=b.CreateAndAccept,this.refreshSteamAuthAutomatically=!0,this.isCs2InventoryEnabled=!0}}class k{constructor(e,t=!1){this.description=e,this.status=t}}var O="Metadata key was used more than once in a parameter:",A="NULL argument",x="Key Not Found",M="Ambiguous match found for serviceIdentifier:",R="No matching bindings found for serviceIdentifier:",j="Missing required @injectable annotation in:",I="Missing required @inject or @multiInject annotation in:",T="Circular dependency found:",P="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",D=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},C=function(e,t){return"onDeactivation() error in class "+e+": "+t},E="Maximum call stack size exceeded",q="named",N="name",$="unmanaged",B="optional",K="inject",F="multi_inject",L="inversify:tagged",W="inversify:tagged_props",Y="inversify:paramtypes",U="post_construct",H="pre_destroy",V=[K,F,N,$,q,B];function z(){return function(e){if(Reflect.hasOwnMetadata(Y,e))throw new Error("Cannot apply @injectable decorator multiple times.");var t=Reflect.getMetadata("design:paramtypes",e)||[];return Reflect.defineMetadata(Y,t,e),e}}let G=class{constructor(){this.listeners=new Map}listen(e,t){const n=this.getListeners(e);return n.push(t),this.listeners.set(e,n),()=>{let n=this.getListeners(e);n=n?.filter((e=>e===t)),this.listeners.set(e,n)}}emit(e,t){const n=this.getListeners(e);for(const r of n)r(e,t)}getListeners(e){let t=this.listeners.get(e);return t||(t=[]),t}};G=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[])],G);let J=class extends G{constructor(){super(),this.state=new w}get(){return this.state}update(e,t=!1){t&&(delete e.steamAuth,delete e.market);const n=(r=this.state,JSON.parse(JSON.stringify(r)));var r;const i=Object.assign(this.state,e);return this.emit("update",{prev:n,next:i,diff:e}),i}};J=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[])],J);let Q=class{constructor(e="default",t=!1){this.pool=[],this.source=e,this.debug=t}add(e){const t=[];for(const n of e){let e=n;"string"!=typeof n&&(e=JSON.stringify(n,void 0,2)),t.push(e)}this.pool.push((new Date).toISOString()+" "+t.join(" ")),this.pool.length>200&&this.pool.splice(0,1)}appendPrefix(e){return[`[${(new Date).toISOString()}][${this.source}]`,...e]}log(...e){this.debug&&console.log(...this.appendPrefix(e)),this.add(this.appendPrefix(e))}warn(...e){this.debug&&console.warn(...this.appendPrefix(e)),this.add(this.appendPrefix(e))}error(...e){this.debug&&console.error(...this.appendPrefix(e)),this.add(this.appendPrefix(e))}getLogs(){return this.pool}};Q=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[String,Boolean])],Q);var X=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===q?"named: "+String(this.value).toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+String(this.value)+" }"},e}();function Z(e,t,n,r){!function(e){if(void 0!==e)throw new Error(P)}(t),ee(L,e,n.toString(),r)}function ee(e,t,n,r){var i=function(e){var t=[];if(Array.isArray(e)){var n=function(e){for(var t=new Set,n=0,r=e;n<r.length;n++){var i=r[n];if(t.has(i))return i;t.add(i)}}((t=e).map((function(e){return e.key})));if(void 0!==n)throw new Error(O+" "+n.toString())}else t=[e];return t}(r),o={};Reflect.hasOwnMetadata(e,t)&&(o=Reflect.getMetadata(e,t));var a=o[n];if(void 0===a)a=[];else for(var s=function(e){if(i.some((function(t){return t.key===e.key})))throw new Error(O+" "+e.key.toString())},c=0,u=a;c<u.length;c++)s(u[c]);a.push.apply(a,i),o[n]=a,Reflect.defineMetadata(e,o,t)}var te;let ne=class{onStart(){}onRun(e=!1){}onStop(){}constructor(e){this.logger=e}};var re,ie,oe,ae;ne=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z(),(oe=0,ae=function(e,t,n){Z(e,t,n,new X($,!0))},function(e,t){ae(e,t,oe)}),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",["function"==typeof(te=void 0!==Q&&Q)?te:Object])],ne),function(e){e.Closed="Closed",e.Opened="Opened",e.Authorized="Authorized"}(re||(re={})),function(e){e.GetSteamId="getSteamId",e.GetTradeLink="getTradeLink",e.AcceptOffer="acceptOffer",e.CancelOffer="cancelOffer",e.DeclineOffer="declineOffer",e.SendOffer="sendOffer",e.GetLogs="getLogs",e.AuthToken="authToken",e.GetActiveTradeOfferIds="getActiveTradeOfferIds",e.GetAccessToken="getAccessToken"}(ie||(ie={}));const se=e=>new Promise((t=>{setTimeout((()=>{t()}),e)}));class ce{static async getSteamId(){const e=await chrome.cookies.get({url:"https://steamcommunity.com",name:"steamLoginSecure"});return e?.value?.split("%7C%7C")?.[0]??void 0}static async getSessionId(){const e=await chrome.cookies.get({url:"https://steamcommunity.com",name:"sessionid"});return e?.value??void 0}static async getSteamCookies(){const e=["steamLoginSecure","sessionid"],t=[];for(const n of e){const e=await chrome.cookies.get({url:"https://steamcommunity.com",name:n});e?.value&&t.push(`${n}=${e.value}`)}return t}static async getSteamAccessToken(){const e=await chrome.cookies.get({url:"https://steamcommunity.com",name:"steamLoginSecure"});return e?.value?.split("%7C%7C")?.[1]??void 0}static async refreshSteamAuthData(){const e=await chrome.tabs.create({url:"https://steamcommunity.com",active:!1});await se(2e3),e.id&&await chrome.tabs.remove(e.id)}static validateTokenExpireDate(e){const t=(e=>{const t=e.split(".");if(3!==t.length)throw new Error("Invalid JWT");const n=t[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(atob(n))})(e);return t.exp?t.exp<(new Date).getTime()/1e3?"expired":"valid":"not-valid"}static getSteam64(e){return String(BigInt(e)+76561197960265728n)}}const ue="steam-service-accept-offer",fe="steam-service-send-offer",le="steam-service-cancel-offer",de="steam-service-decline-offer",he="steam-service-get-offer-url",pe="steam-service-get-user-summaries",ye="steam-service-get-active-trade-offer-ids",ve="steam-trade-offer-service-get-offer-details",ge="steam-account-service-get-user-summaries",me="steam-account-service-get-user-level",be="extension-session-get",we="extension-session-update",_e="extension-session-onupdate",Se="declarative-net-requests-set-referer-header-rule",ke="declarative-net-requests-append-cookie-rule",Oe="declarative-net-requests-remove-rule",Ae="market-trade-offer-repository-get-many",xe="market-trade-offer-repository-get-active-trades-count",Me="market-trade-offer-repository-on-update",Re="market-trade-offer-repository-on-add",je="market-web-socket-service-accept",Ie="market-web-socket-service-create",Te="market-web-socket-service-cancel",Pe="inventory-service-get-item-sell-price",De="float-inventory-get",Ce="steam-account-repository-get-by-id",Ee=()=>{function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()};let qe=class extends G{constructor(){super(),this.timeoutMs=5e3,this.isActive=!1,this.connectionStatus=re.Closed,this.connectionId=void 0,this.handlers=new Map}async handleMarket(e,t,n){switch(oi.logger.log(`Event: "${e}" Payload: ${JSON.stringify(t)}`),e){case ie.GetSteamId:return await this.onGetSteamId();case ie.GetTradeLink:return await this.onGetTradeLink();case ie.AcceptOffer:await oi.services.marketTradeOffer.add({data:t,event:e,callback:n});break;case ie.CancelOffer:return await oi.services.marketTradeOffer.cancel({tradeOfferId:t.tradeofferid??t.tradeOfferId,requiredAction:"cancel"});case ie.DeclineOffer:return await oi.services.marketTradeOffer.cancel({tradeOfferId:t.tradeofferid??t.tradeOfferId,requiredAction:"decline"});case ie.SendOffer:await oi.services.marketTradeOffer.add({data:t,event:e,callback:n});break;case ie.AuthToken:this.onAuthToken(t);break;case ie.GetLogs:return{success:!0,data:oi.logger.getLogs()};case ie.GetAccessToken:{const e=await this.onGetSteamId(),t=await ce.getSteamAccessToken();return t&&e.success?{success:!0,data:t}:(oi.logger.error("[Error][WSClient]: Unable to get access token"),{success:!1})}case ie.GetActiveTradeOfferIds:try{const e=await oi.to.offscreen.invoke(ye,"sent"),t=await oi.to.offscreen.invoke(ye,"received");return{success:!0,data:[...e,...t]}}catch(e){return{success:!1}}default:throw new Error(`[Error][WSClient]: Unknown event ${e}`)}}async connect(e="wss://appws.dota2.net"){try{this.webSocket=new WebSocket(e),this.webSocket.onmessage=e=>{this.onMessage(e)},this.webSocket.onerror=e=>this.onError(e),this.webSocket.onopen=()=>{this.onOpen()}}catch(e){this.onClose(e)}}terminate(){this.webSocket?.close(),this.webSocket=void 0,this.handlers=new Map,this.isActive=!1,this.connectionStatus=re.Closed,clearInterval(this.pingIntervalId),this.pingIntervalId=void 0}async authorize(){const{profile:e,version:t}=oi.store.get();if(!e?.accessToken)return{success:!1,steamID:"",clientID:""};const n=await this.writeAsync("auth-direct",{s64:e?.steamId,token:"",type:"extension",version:t,info:"",api_version:"2",access_token:e?.accessToken,client_id:e?.lastWsClientId});return n.success&&(e.lastWsClientId=n.clientID,oi.store.update({profile:e})),n}onError(e){oi.logger.error(e)}onClose(e){this.connectionStatus=re.Closed,this.emit("connectionStatusChanged",this.connectionStatus),oi.logger.log(`onClose: Code: ${e.code} Reason: ${JSON.stringify(e.reason)}`)}async onOpen(){oi.logger.log("WebSocket connection is opened"),this.connectionStatus=re.Opened,this.emit("connectionStatusChanged",this.connectionStatus),clearInterval(this.pingIntervalId),this.pingIntervalId=setInterval((()=>{if(this.webSocket&&this.webSocket?.readyState===WebSocket.OPEN){if(!this.isActive)return oi.logger.log("WebSocket connection is died"),void this.webSocket.close(4001,"WebSocket connection died");this.webSocket.send("ping"),this.isActive=!1}}),15e3),this.webSocket&&(this.webSocket.onclose=e=>this.onClose(e)),(await this.authorize()).success&&(this.isActive=!0,this.connectionStatus=re.Authorized,this.emit("connectionStatusChanged",this.connectionStatus),oi.logger.log("WebSocket connection has been authorized"))}async onMessage(e){try{if("string"==typeof e.data){if("pong"===e.data)return void(this.isActive=!0);const t=JSON.parse(e.data);if(t.e&&t.c){const e=await this.handleMarket(t.e,t.d,t.c);return void(e&&this.write(t.e,e,t.c))}if(t.h)return void this.handlers.get(t.h)?.(t.d);if("auth ok"===t.e)return this.isActive=!0,this.connectionId=t.d.cid,void(this.connectionStatus=re.Authorized)}}catch(e){return void oi.logger.error(e)}}onAuthToken(e){this.wsAuthToken=e.t}async onGetSteamId(){const{profile:e}=oi.store.get();return e?{success:!0,steamId:e.steamId}:(oi.logger.error("WebSocket onGetSteamId: Steam profile is not valid"),{success:!1})}async onGetTradeLink(){const{profile:e}=oi.store.get();return e&&e.tradeOfferUrl?{success:!0,steamId:e.steamId,tradeOfferUrl:e.tradeOfferUrl}:(oi.logger.error("WebSocket onGetTradeLink: Steam profile or trade offer url is not valid"),{success:!1})}write(e,t,n){try{const r={e,d:t};if("function"==typeof n){const e=Ee();r.h=e,this.handlers.set(e,n)}"string"==typeof n&&(r.c=n),this.webSocket?.send(JSON.stringify(r))}catch(e){oi.logger.error(e)}}async writeAsync(e,t){return new Promise(((n,r)=>{this.write(e,t,(e=>n(e))),setTimeout((()=>r(new Error("MarketWebSocketService timeout error"))),this.timeoutMs)}))}};qe=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[])],qe);var Ne,$e=(Ne=K,function(e){return function(t,n,r){if(void 0===e){var i="function"==typeof t?t.name:t.constructor.name;throw new Error("@inject called with undefined this could mean that the class "+i+" has a circular dependency problem. You can use a LazyServiceIdentifier to  overcome this limitation.")}return(o=new X(Ne,e),function(e,t,n){"number"==typeof n?Z(e,t,n,o):function(e,t,n){if(void 0!==e.prototype)throw new Error(P);ee(W,e.constructor,t,n)}(e,t,o)})(t,n,r);var o}}),Be="Request",Ke="Singleton",Fe="Transient",Le={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},We={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"},Ye=0;function Ue(){return Ye++}var He=function(){function e(e,t){this.id=Ue(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=Le.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===Ke&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.onDeactivation=this.onDeactivation,t.cache=this.cache,t},e}(),Ve=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(Y,e),userGeneratedMetadata:Reflect.getMetadata(L,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(W,e)||[]},e}(),ze={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};function Ge(e){return e instanceof RangeError||e.message===E}function Je(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function Qe(e,t,n){var r="",i=n(e,t);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(e){var t="Object";null!==e.implementationType&&(t=et(e.implementationType)),r=r+"\n "+t,e.constraint.metaData&&(r=r+" - "+e.constraint.metaData)}))),r}function Xe(e,t){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===t||Xe(e.parentRequest,t))}function Ze(e){e.childRequests.forEach((function(e){if(Xe(e,e.serviceIdentifier)){var t=function(e){return function e(t,n){void 0===n&&(n=[]);var r=Je(t.serviceIdentifier);return n.push(r),null!==t.parentRequest?e(t.parentRequest,n):n}(e).reverse().join(" --\x3e ")}(e);throw new Error(T+" "+t)}Ze(e)}))}function et(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}var tt=function(){function e(e){this.id=Ue(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}(),nt=function(e,t){this.parentContext=e,this.rootRequest=t},rt=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}(),it=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}(),ot=function(){function e(e,t,n,r){this.id=Ue(),this.type=e,this.serviceIdentifier=n;var i="symbol"==typeof t?t.toString().slice(7,-1):t;this.name=new it(i||""),this.identifier=t,this.metadata=new Array;var o=null;"string"==typeof r?o=new X(q,r):r instanceof X&&(o=r),null!==o&&this.metadata.push(o)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++)if(n[t].key===e)return!0;return!1},e.prototype.isArray=function(){return this.hasTag(F)},e.prototype.matchesArray=function(e){return this.matchesTag(F)(e)},e.prototype.isNamed=function(){return this.hasTag(q)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return V.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(B)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===q}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return V.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(q)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}(),at=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};function st(e,t,n,r){var i=e.getConstructorMetadata(n),o=i.compilerGeneratedMetadata;if(void 0===o)throw new Error(j+" "+t+".");var a=i.userGeneratedMetadata,s=Object.keys(a),c=0===n.length&&s.length>0,u=s.length>n.length,f=function(e,t,n,r,i){for(var o=[],a=0;a<i;a++){var s=ct(a,e,t,n,r);null!==s&&o.push(s)}return o}(r,t,o,a,c||u?s.length:n.length),l=ft(e,n,t);return at(at([],f,!0),l,!0)}function ct(e,t,n,r,i){var o=i[e.toString()]||[],a=dt(o),s=!0!==a.unmanaged,c=r[e];if((c=a.inject||a.multiInject||c)instanceof rt&&(c=c.unwrap()),s){if(!t&&(c===Object||c===Function||void 0===c))throw new Error(I+" argument "+e+" in class "+n+".");var u=new ot(We.ConstructorArgument,a.targetName,c);return u.metadata=o,u}return null}function ut(e,t,n,r){var i=e||t;if(void 0===i){var o=j+" for property "+String(n)+" in class "+r+".";throw new Error(o)}return i}function ft(e,t,n){for(var r=e.getPropertiesMetadata(t),i=[],o=Object.getOwnPropertySymbols(r),a=0,s=Object.keys(r).concat(o);a<s.length;a++){var c=s[a],u=r[c],f=dt(u),l=f.targetName||c,d=ut(f.inject,f.multiInject,c,n),h=new ot(We.ClassProperty,l,d);h.metadata=u,i.push(h)}var p=Object.getPrototypeOf(t.prototype).constructor;if(p!==Object){var y=ft(e,p,n);i=at(at([],i,!0),y,!0)}return i}function lt(e,t){var n=Object.getPrototypeOf(t.prototype).constructor;if(n!==Object){var r=st(e,et(n),n,!0),i=r.map((function(e){return e.metadata.filter((function(e){return e.key===$}))})),o=[].concat.apply([],i).length,a=r.length-o;return a>0?a:lt(e,n)}return 0}function dt(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[K],multiInject:t[F],targetName:t[N],unmanaged:t[$]}}var ht=function(){function e(e,t,n,r,i){this.id=Ue(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=i,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();function pt(e){return e._bindingDictionary}function yt(e,t,n,r,i){var o,a=gt(n.container,i.serviceIdentifier);return a.length===ze.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof i.serviceIdentifier&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(i.serviceIdentifier).toSelf(),a=gt(n.container,i.serviceIdentifier)),o=t?a:a.filter((function(e){var t=new ht(e.serviceIdentifier,n,r,e,i);return e.constraint(t)})),function(e,t,n,r){switch(t.length){case ze.NoBindingsAvailable:if(n.isOptional())return t;var i=Je(e),o=R;throw o+=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e}(i,n),o+=Qe(r,i,gt),new Error(o);case ze.OnlyOneBindingAvailable:return t;case ze.MultipleBindingsAvailable:default:if(n.isArray())return t;throw i=Je(e),o=M+" "+i,o+=Qe(r,i,gt),new Error(o)}}(i.serviceIdentifier,o,i,n.container),o}function vt(e,t,n,r,i,o){var a,s;if(null===i){a=yt(e,t,r,null,o),s=new ht(n,r,null,a,o);var c=new nt(r,s);r.addPlan(c)}else a=yt(e,t,r,i,o),s=i.addChildRequest(o.serviceIdentifier,a,o);a.forEach((function(t){var n=null;if(o.isArray())n=s.addChildRequest(t.serviceIdentifier,t,o);else{if(t.cache)return;n=s}if(t.type===Le.Instance&&null!==t.implementationType){var i=function(e,t){return st(e,et(t),t,!1)}(e,t.implementationType);if(!r.container.options.skipBaseClassChecks){var a=lt(e,t.implementationType);if(i.length<a){var c=D(et(t.implementationType));throw new Error(c)}}i.forEach((function(t){vt(e,!1,t.serviceIdentifier,r,n,t)}))}}))}function gt(e,t){var n=[],r=pt(e);return r.hasKey(t)?n=r.get(t):null!==e.parent&&(n=gt(e.parent,t)),n}function mt(e){return("object"==typeof e&&null!==e||"function"==typeof e)&&"function"==typeof e.then}function bt(e){return!!mt(e)||Array.isArray(e)&&e.some(mt)}var wt,_t=function(e,t){return n=void 0,r=void 0,o=function(){var n,r;return function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,t];case 1:return n=i.sent(),e.cache=n,[3,3];case 2:throw r=i.sent(),e.cache=null,e.activated=!1,r;case 3:return[2]}}))},new((i=void 0)||(i=Promise))((function(e,t){function a(e){try{c(o.next(e))}catch(e){t(e)}}function s(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,s)}c((o=o.apply(n,r||[])).next())}));var n,r,i,o};!function(e){e.DynamicValue="toDynamicValue",e.Factory="toFactory",e.Provider="toProvider"}(wt||(wt={}));var St=function(){return St=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},St.apply(this,arguments)},kt=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},Ot=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},At=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};function xt(e){var t,n=new((t=e.constr).bind.apply(t,At([void 0],e.constructorInjections,!1)));return e.propertyRequests.forEach((function(t,r){var i=t.target.identifier,o=e.propertyInjections[r];t.target.isOptional()&&void 0===o||(n[i]=o)})),n}function Mt(e){return kt(this,void 0,void 0,(function(){var t,n,r,i;return Ot(this,(function(o){for(t=[],n=0,r=e;n<r.length;n++)i=r[n],Array.isArray(i)?t.push(Promise.all(i)):t.push(i);return[2,Promise.all(t)]}))}))}function Rt(e,t){var n=function(e,t){var n,r,i,o;if(Reflect.hasMetadata(U,e)){var a=Reflect.getMetadata(U,e);try{return null===(r=(n=t)[a.value])||void 0===r?void 0:r.call(n)}catch(t){if(t instanceof Error)throw new Error((i=e.name,o=t.message,"@postConstruct error in class "+i+": "+o))}}}(e,t);return mt(n)?n.then((function(){return t})):t}var jt=function(e){return function(t){t.parentContext.setCurrentRequest(t);var n=t.bindings,r=t.childRequests,i=t.target&&t.target.isArray(),o=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(i&&o)return r.map((function(t){return jt(e)(t)}));if(!t.target.isOptional()||0!==n.length){var a=n[0];return Dt(e,t,a)}}},It=function(e,t){var n=function(e){switch(e.type){case Le.Factory:return{factory:e.factory,factoryType:wt.Factory};case Le.Provider:return{factory:e.provider,factoryType:wt.Provider};case Le.DynamicValue:return{factory:e.dynamicValue,factoryType:wt.DynamicValue};default:throw new Error("Unexpected factory type "+e.type)}}(e);return function(r,i){try{return n.factory.bind(e)(t)}catch(e){throw Ge(e)&&(e=new Error((o=n.factoryType,a=t.currentRequest.serviceIdentifier.toString(),"It looks like there is a circular dependency in one of the '"+o+"' bindings. Please investigate bindings with service identifier '"+a+"'."))),e}var o,a}()},Tt=function(e,t,n){var r,i=t.childRequests;switch(function(e){var t=null;switch(e.type){case Le.ConstantValue:case Le.Function:t=e.cache;break;case Le.Constructor:case Le.Instance:t=e.implementationType;break;case Le.DynamicValue:t=e.dynamicValue;break;case Le.Provider:t=e.provider;break;case Le.Factory:t=e.factory}if(null===t){var n=Je(e.serviceIdentifier);throw new Error("Invalid binding type: "+n)}}(n),n.type){case Le.ConstantValue:case Le.Function:r=n.cache;break;case Le.Constructor:r=n.implementationType;break;case Le.Instance:r=function(e,t,n,r){!function(e,t){e.scope!==Ke&&function(e,t){var n="Class cannot be instantiated in "+(e.scope===Be?"request":"transient")+" scope.";if("function"==typeof e.onDeactivation)throw new Error(C(t.name,n));if(Reflect.hasMetadata(H,t))throw new Error("@preDestroy error in class "+t.name+": "+n)}(e,t)}(e,t);var i=function(e,t,n){var r;if(t.length>0){var i=function(e,t){return e.reduce((function(e,n){var r=t(n);return n.target.type===We.ConstructorArgument?e.constructorInjections.push(r):(e.propertyRequests.push(n),e.propertyInjections.push(r)),e.isAsync||(e.isAsync=bt(r)),e}),{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}(t,n),o=St(St({},i),{constr:e});r=i.isAsync?function(e){return kt(this,void 0,void 0,(function(){var t,n;return Ot(this,(function(r){switch(r.label){case 0:return[4,Mt(e.constructorInjections)];case 1:return t=r.sent(),[4,Mt(e.propertyInjections)];case 2:return n=r.sent(),[2,xt(St(St({},e),{constructorInjections:t,propertyInjections:n}))]}}))}))}(o):xt(o)}else r=new e;return r}(t,n,r);return mt(i)?i.then((function(e){return Rt(t,e)})):Rt(t,i)}(n,n.implementationType,i,jt(e));break;default:r=It(n,t.parentContext)}return r},Pt=function(e,t,n){var r=function(e,t){return t.scope===Ke&&t.activated?t.cache:t.scope===Be&&e.has(t.id)?e.get(t.id):null}(e,t);return null!==r||function(e,t,n){t.scope===Ke&&function(e,t){e.cache=t,e.activated=!0,mt(t)&&_t(e,t)}(t,n),t.scope===Be&&function(e,t,n){e.has(t.id)||e.set(t.id,n)}(e,t,n)}(e,t,r=n()),r},Dt=function(e,t,n){return Pt(e,n,(function(){var r=Tt(e,t,n);return mt(r)?r.then((function(e){return Ct(t,n,e)})):Ct(t,n,r)}))};function Ct(e,t,n){var r,i=Et(e.parentContext,t,n),o=Bt(e.parentContext.container),a=o.next();do{r=a.value;var s=e.parentContext,c=e.serviceIdentifier,u=$t(r,c);i=mt(i)?Nt(u,s,i):qt(u,s,i),a=o.next()}while(!0!==a.done&&!pt(r).hasKey(e.serviceIdentifier));return i}var Et=function(e,t,n){return"function"==typeof t.onActivation?t.onActivation(e,n):n},qt=function(e,t,n){for(var r=e.next();!r.done;){if(mt(n=r.value(t,n)))return Nt(e,t,n);r=e.next()}return n},Nt=function(e,t,n){return r=void 0,i=void 0,a=function(){var r,i;return function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(o){switch(o.label){case 0:return[4,n];case 1:r=o.sent(),i=e.next(),o.label=2;case 2:return i.done?[3,4]:[4,i.value(t,r)];case 3:return r=o.sent(),i=e.next(),[3,2];case 4:return[2,r]}}))},new((o=void 0)||(o=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(e){e(r)}))).then(n,s)}c((a=a.apply(r,i||[])).next())}));var r,i,o,a},$t=function(e,t){var n=e._activations;return n.hasKey(t)?n.get(t).values():[].values()},Bt=function(e){for(var t=[e],n=e.parent;null!==n;)t.push(n),n=n.parent;return{next:function(){var e=t.pop();return void 0!==e?{done:!1,value:e}:{done:!0,value:void 0}}}},Kt=function(e,t){var n=e.parentRequest;return null!==n&&(!!t(n)||Kt(n,t))},Ft=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new X(e,t),n}},Lt=Ft(q),Wt=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}},Yt=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new Ut(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=Lt(e),new Ut(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e&&null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new Ut(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=Ft(e)(t),new Ut(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return null!==t&&Wt(e)(t.parentRequest)},new Ut(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return null!==t&&Lt(e)(t.parentRequest)},new Ut(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&Ft(e)(t)(n.parentRequest)},new Ut(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return null!==t&&Kt(t,Wt(e))},new Ut(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return null!==t&&!Kt(t,Wt(e))},new Ut(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return null!==t&&Kt(t,Lt(e))},new Ut(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return null!==t&&!Kt(t,Lt(e))},new Ut(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&Kt(n,Ft(e)(t))},new Ut(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&!Kt(n,Ft(e)(t))},new Ut(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return null!==t&&Kt(t,e)},new Ut(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return null!==t&&!Kt(t,e)},new Ut(this._binding)},e}(),Ut=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new Yt(this._binding)},e.prototype.onDeactivation=function(e){return this._binding.onDeactivation=e,new Yt(this._binding)},e}(),Ht=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new Yt(this._binding),this._bindingOnSyntax=new Ut(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},e}(),Vt=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=Be,new Ht(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=Ke,new Ht(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=Fe,new Ht(this._binding)},e}(),zt=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new Yt(this._binding),this._bindingOnSyntax=new Ut(this._binding),this._bindingInSyntax=new Vt(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},e}(),Gt=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=Le.Instance,this._binding.implementationType=e,new zt(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error("The toSelf function can only be applied when a constructor is used as service identifier");var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=Le.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Ke,new Ht(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=Le.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new zt(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=Le.Constructor,this._binding.implementationType=e,this._binding.scope=Ke,new Ht(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=Le.Factory,this._binding.factory=e,this._binding.scope=Ke,new Ht(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error("Value provided to function binding must be a function!");var t=this.toConstantValue(e);return this._binding.type=Le.Function,this._binding.scope=Ke,t},e.prototype.toAutoFactory=function(e){return this._binding.type=Le.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=Ke,new Ht(this._binding)},e.prototype.toAutoNamedFactory=function(e){return this._binding.type=Le.Factory,this._binding.factory=function(t){return function(n){return t.container.getNamed(e,n)}},new Ht(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=Le.Provider,this._binding.provider=e,this._binding.scope=Ke,new Ht(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}(),Jt=function(){function e(){}return e.of=function(t,n,r,i,o){var a=new e;return a.bindings=t,a.middleware=n,a.deactivations=i,a.activations=r,a.moduleActivationStore=o,a},e}(),Qt=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(A);if(null==t)throw new Error(A);var n=this._map.get(e);void 0!==n?n.push(t):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(A);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(x)},e.prototype.remove=function(e){if(null==e)throw new Error(A);if(!this._map.delete(e))throw new Error(x)},e.prototype.removeIntersection=function(e){var t=this;this.traverse((function(n,r){var i=e.hasKey(n)?e.get(n):void 0;if(void 0!==i){var o=r.filter((function(e){return!i.some((function(t){return e===t}))}));t._setValue(n,o)}}))},e.prototype.removeByCondition=function(e){var t=this,n=[];return this._map.forEach((function(r,i){for(var o=[],a=0,s=r;a<s.length;a++){var c=s[a];e(c)?n.push(c):o.push(c)}t._setValue(i,o)})),n},e.prototype.hasKey=function(e){if(null==e)throw new Error(A);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,"object"==typeof(r=e)&&null!==r&&"clone"in r&&"function"==typeof r.clone?e.clone():e);var r}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e.prototype._setValue=function(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)},e}(),Xt=function(){function e(){this._map=new Map}return e.prototype.remove=function(e){if(this._map.has(e)){var t=this._map.get(e);return this._map.delete(e),t}return this._getEmptyHandlersStore()},e.prototype.addDeactivation=function(e,t,n){this._getModuleActivationHandlers(e).onDeactivations.add(t,n)},e.prototype.addActivation=function(e,t,n){this._getModuleActivationHandlers(e).onActivations.add(t,n)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){t._map.set(n,{onActivations:e.onActivations.clone(),onDeactivations:e.onDeactivations.clone()})})),t},e.prototype._getModuleActivationHandlers=function(e){var t=this._map.get(e);return void 0===t&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t},e.prototype._getEmptyHandlersStore=function(){return{onActivations:new Qt,onDeactivations:new Qt}},e}(),Zt=function(){return Zt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Zt.apply(this,arguments)},en=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},tn=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},nn=function(){function e(e){var t=e||{};if("object"!=typeof t)throw new Error("Invalid Container constructor argument. Container options must be an object.");if(void 0===t.defaultScope)t.defaultScope=Fe;else if(t.defaultScope!==Ke&&t.defaultScope!==Fe&&t.defaultScope!==Be)throw new Error('Invalid Container option. Default scope must be a string ("singleton" or "transient").');if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error("Invalid Container option. Auto bind injectable must be a boolean");if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error("Invalid Container option. Skip base check must be a boolean");this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=Ue(),this._bindingDictionary=new Qt,this._snapshots=[],this._middleware=null,this._activations=new Qt,this._deactivations=new Qt,this.parent=null,this._metadataReader=new Ve,this._moduleActivationStore=new Xt}return e.merge=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=new e,a=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}([t,n],r,!0).map((function(e){return pt(e)})),s=pt(o);return a.forEach((function(e){var t;t=s,e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))})),o},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return en(this,void 0,void 0,(function(){var t,n,r,i,o;return tn(this,(function(a){switch(a.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,r=e,a.label=1;case 1:return n<r.length?(i=r[n],o=t(i.id),[4,i.registry(o.bindFunction,o.unbindFunction,o.isboundFunction,o.rebindFunction,o.unbindAsyncFunction,o.onActivationFunction,o.onDeactivationFunction)]):[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach((function(t){var n=e._removeModuleBindings(t.id);e._deactivateSingletons(n),e._removeModuleHandlers(t.id)}))},e.prototype.unloadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return en(this,void 0,void 0,(function(){var t,n,r,i;return tn(this,(function(o){switch(o.label){case 0:t=0,n=e,o.label=1;case 1:return t<n.length?(r=n[t],i=this._removeModuleBindings(r.id),[4,this._deactivateSingletonsAsync(i)]):[3,4];case 2:o.sent(),this._removeModuleHandlers(r.id),o.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},e.prototype.bind=function(e){var t=this.options.defaultScope||Fe,n=new He(e,t);return this._bindingDictionary.add(e,n),new Gt(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.rebindAsync=function(e){return en(this,void 0,void 0,(function(){return tn(this,(function(t){switch(t.label){case 0:return[4,this.unbindAsync(e)];case 1:return t.sent(),[2,this.bind(e)]}}))}))},e.prototype.unbind=function(e){if(this._bindingDictionary.hasKey(e)){var t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)},e.prototype.unbindAsync=function(e){return en(this,void 0,void 0,(function(){var t;return tn(this,(function(n){switch(n.label){case 0:return this._bindingDictionary.hasKey(e)?(t=this._bindingDictionary.get(e),[4,this._deactivateSingletonsAsync(t)]):[3,2];case 1:n.sent(),n.label=2;case 2:return this._removeServiceFromDictionary(e),[2]}}))}))},e.prototype.unbindAll=function(){var e=this;this._bindingDictionary.traverse((function(t,n){e._deactivateSingletons(n)})),this._bindingDictionary=new Qt},e.prototype.unbindAllAsync=function(){return en(this,void 0,void 0,(function(){var e,t=this;return tn(this,(function(n){switch(n.label){case 0:return e=[],this._bindingDictionary.traverse((function(n,r){e.push(t._deactivateSingletonsAsync(r))})),[4,Promise.all(e)];case 1:return n.sent(),this._bindingDictionary=new Qt,[2]}}))}))},e.prototype.onActivation=function(e,t){this._activations.add(e,t)},e.prototype.onDeactivation=function(e,t){this._deactivations.add(e,t)},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isCurrentBound=function(e){return this._bindingDictionary.hasKey(e)},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,q,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=function(e,t,n,r){var i=new ot(We.Variable,"",t,new X(n,r)),o=new tt(e);return new ht(t,o,null,[],i)}(this,e,t,n);r=i.some((function(e){return e.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(Jt.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error("No snapshot available to restore.");this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){var t=this._getNotAllArgs(e,!1);return this._getButThrowIfAsync(t)},e.prototype.getAsync=function(e){return en(this,void 0,void 0,(function(){var t;return tn(this,(function(n){return t=this._getNotAllArgs(e,!1),[2,this._get(t)]}))}))},e.prototype.getTagged=function(e,t,n){var r=this._getNotAllArgs(e,!1,t,n);return this._getButThrowIfAsync(r)},e.prototype.getTaggedAsync=function(e,t,n){return en(this,void 0,void 0,(function(){var r;return tn(this,(function(i){return r=this._getNotAllArgs(e,!1,t,n),[2,this._get(r)]}))}))},e.prototype.getNamed=function(e,t){return this.getTagged(e,q,t)},e.prototype.getNamedAsync=function(e,t){return this.getTaggedAsync(e,q,t)},e.prototype.getAll=function(e){var t=this._getAllArgs(e);return this._getButThrowIfAsync(t)},e.prototype.getAllAsync=function(e){var t=this._getAllArgs(e);return this._getAll(t)},e.prototype.getAllTagged=function(e,t,n){var r=this._getNotAllArgs(e,!0,t,n);return this._getButThrowIfAsync(r)},e.prototype.getAllTaggedAsync=function(e,t,n){var r=this._getNotAllArgs(e,!0,t,n);return this._getAll(r)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,q,t)},e.prototype.getAllNamedAsync=function(e,t){return this.getAllTaggedAsync(e,q,t)},e.prototype.resolve=function(e){var t=this.isBound(e);t||this.bind(e).toSelf();var n=this.get(e);return t||this.unbind(e),n},e.prototype._preDestroy=function(e,t){var n,r;if(Reflect.hasMetadata(H,e))return null===(r=(n=t)[Reflect.getMetadata(H,e).value])||void 0===r?void 0:r.call(n)},e.prototype._removeModuleHandlers=function(e){var t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)},e.prototype._removeModuleBindings=function(e){return this._bindingDictionary.removeByCondition((function(t){return t.moduleId===e}))},e.prototype._deactivate=function(e,t){var n=this,r=Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){var i=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if(mt(i))return this._handleDeactivationError(i.then((function(){return n._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,r)})),r)}var o=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,r);if(mt(o))return this._handleDeactivationError(o,r)}catch(e){if(e instanceof Error)throw new Error(C(r.name,e.message))}},e.prototype._handleDeactivationError=function(e,t){return en(this,void 0,void 0,(function(){var n;return tn(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e];case 1:return r.sent(),[3,3];case 2:if((n=r.sent())instanceof Error)throw new Error(C(t.name,n.message));return[3,3];case 3:return[2]}}))}))},e.prototype._deactivateContainer=function(e,t){for(var n=this,r=t.next();r.value;){var i=r.value(e);if(mt(i))return i.then((function(){return n._deactivateContainerAsync(e,t)}));r=t.next()}},e.prototype._deactivateContainerAsync=function(e,t){return en(this,void 0,void 0,(function(){var n;return tn(this,(function(r){switch(r.label){case 0:n=t.next(),r.label=1;case 1:return n.value?[4,n.value(e)]:[3,3];case 2:return r.sent(),n=t.next(),[3,1];case 3:return[2]}}))}))},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind(r);return t(i,n),i}},r=function(t){return function(n,r){e._moduleActivationStore.addActivation(t,n,r),e.onActivation(n,r)}},i=function(t){return function(n,r){e._moduleActivationStore.addDeactivation(t,n,r),e.onDeactivation(n,r)}};return function(o){return{bindFunction:(a=o,function(n){var r=e.bind(n);return t(r,a),r}),isboundFunction:function(t){return e.isBound(t)},onActivationFunction:r(o),onDeactivationFunction:i(o),rebindFunction:n(o),unbindFunction:function(t){return e.unbind(t)},unbindAsyncFunction:function(t){return e.unbindAsync(t)}};var a}},e.prototype._getAll=function(e){return Promise.all(this._get(e))},e.prototype._get=function(e){var t=Zt(Zt({},e),{contextInterceptor:function(e){return e},targetType:We.Variable});if(this._middleware){var n=this._middleware(t);if(null==n)throw new Error("Invalid return type in middleware. Middleware must return!");return n}return this._planAndResolve()(t)},e.prototype._getButThrowIfAsync=function(e){var t=this._get(e);if(bt(t))throw new Error("You are attempting to construct '"+e.serviceIdentifier+"' in a synchronous way\n but it has asynchronous dependencies.");return t},e.prototype._getAllArgs=function(e){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e}},e.prototype._getNotAllArgs=function(e,t,n,r){return{avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:n,value:r}},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=function(e,t,n,r,i,o,a,s){void 0===s&&(s=!1);var c=new tt(t),u=function(e,t,n,r,i,o){var a=new X(e?F:K,n),s=new ot(t,"",n,a);if(void 0!==i){var c=new X(i,o);s.metadata.push(c)}return s}(n,r,i,0,o,a);try{return vt(e,s,i,c,null,u),c}catch(e){throw Ge(e)&&Ze(c.plan.rootRequest),e}}(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return function(e){return jt(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}(n=t.contextInterceptor(n))}},e.prototype._deactivateIfSingleton=function(e){var t=this;if(e.activated)return mt(e.cache)?e.cache.then((function(n){return t._deactivate(e,n)})):this._deactivate(e,e.cache)},e.prototype._deactivateSingletons=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(mt(this._deactivateIfSingleton(r)))throw new Error("Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)")}},e.prototype._deactivateSingletonsAsync=function(e){return en(this,void 0,void 0,(function(){var t=this;return tn(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return t._deactivateIfSingleton(e)})))];case 1:return n.sent(),[2]}}))}))},e.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(e,t,n){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,n)},e.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(e,t,n){return en(this,void 0,void 0,(function(){return tn(this,(function(r){switch(r.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(e,t)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(e,t,n)];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},e.prototype._removeServiceFromDictionary=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error("Could not unbind serviceIdentifier: "+Je(e))}},e.prototype._bindingDeactivationAndPreDestroy=function(e,t,n){var r=this;if("function"==typeof e.onDeactivation){var i=e.onDeactivation(t);if(mt(i))return i.then((function(){return r._preDestroy(n,t)}))}return this._preDestroy(n,t)},e.prototype._bindingDeactivationAndPreDestroyAsync=function(e,t,n){return en(this,void 0,void 0,(function(){return tn(this,(function(r){switch(r.label){case 0:return"function"!=typeof e.onDeactivation?[3,2]:[4,e.onDeactivation(t)];case 1:r.sent(),r.label=2;case 2:return[4,this._preDestroy(n,t)];case 3:return r.sent(),[2]}}))}))},e}();let rn=class{};rn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z()],rn);var on,an,sn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},cn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let un=class extends ne{constructor(e){super(e)}async migrate(e){const t=this.container.getAll(rn);for(const n of t)try{await n.isRequired(e)&&(e=await n.migrate(e),this.logger.log(`Applied migration ${n.name}`))}catch(e){this.logger.error(`Failed to apply migration ${n.name}`,e.message)}return e}};sn([$e(nn),cn("design:type","function"==typeof(an=void 0!==nn&&nn)?an:Object)],un.prototype,"container",void 0),un=sn([z(),function(e,t){return function(n,r){t(n,r,e)}}(0,$e(v)),cn("design:paramtypes",["function"==typeof(on=void 0!==Q&&Q)?on:Object])],un);const fn=chrome.runtime.getURL("img/favicon_csgo.png");var ln;!function(e){e.NoSteamAuth="SteamAuthMissing",e.ConfirmTradeOffer="ConfirmTradeOffer",e.AcceptTradeOffer="AcceptTradeOffer",e.CreateTradeOffer="CreateTradeOffer"}(ln||(ln={}));let dn=class{show(e,t,n){chrome.notifications.create(e,{title:t,iconUrl:fn,type:"basic",message:n})}};dn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z()],dn);let hn=class{async set(e,t){const n={};return n[e]=t,await chrome.storage.local.set(n),t}async get(e,t){const n=await chrome.storage.local.get(e);return n[e]?n[e]:t??void 0}};hn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z()],hn);const pn="market-app-background-run",yn="firefox-workaround",vn="background-offscreen-connection",gn=(new Map,"configuration"),mn="profile",bn=()=>"firefox"===wn(),wn=()=>{const e=navigator.userAgent;return e.match(/chrome|chromium|crios/i)?"chrome":e.match(/firefox|fxios/i)?"firefox":e.match(/safari/i)?"safari":e.match(/opr/i)?"opera":e.match(/edg/i)?"edge":void 0},_n=(e,t)=>chrome.i18n.getMessage(e,t)||e;var Sn,kn,On,An,xn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Mn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Rn=function(e,t){return function(n,r){t(n,r,e)}};let jn=class extends ne{constructor(e,t){super(e),this.onRun=((e,t=1e3)=>{let n;return(...r)=>{n&&clearTimeout(n),n=setTimeout((()=>e(...r)),t)}})((async(e=!1,t=!1)=>{try{const{profile:n,configuration:r,hasRequiredPermissions:i}=this.store.get();if(!i)return void this.logger.log("Prevent run: missing required permissions");if(!e&&n&&!r.isExtensionEnabled)return void this.logger.log("Prevent run: extension is disabled");if(await this.createOffscreenPage(),await this.checkSteamAuth(),!await this.refreshUserData(n,t)||!r.isExtensionEnabled)return;await this.refreshWebSocket()}catch(e){this.logger.log("Unable to make a run in background service"),this.logger.error(e)}}),1e3),this.store=t,this.store.listen("update",(async(e,t)=>{await this.onStoreUpdate(t)}))}async onStart(){const e=await this.restoreExtensionState();await this.subscribeForChromeEvents(),this.onRun(!0,!1===e.configuration?.isExtensionEnabled)}async onStop(){this.unsubscribeFromMarketUpdates?.(),this.marketWebSocketService?.terminate(),this.marketWebSocketService=void 0,this.store.update({market:{status:!1,description:"off"},steamAuth:{status:!1,description:"off"}})}async onStoreUpdate({prev:e,next:t,diff:n}){const{isExtensionEnabled:r,serverLocation:i}=t.configuration,o=e.configuration.isExtensionEnabled!==t.configuration.isExtensionEnabled,a=e.profile&&!t.profile;await Promise.all([oi.to.popup,oi.to.inject].map((e=>e.send(_e,this.store.get())))),e.configuration.serverLocation!==i&&await this.refreshWebSocket(!0),n.configuration&&await this.storage.set(gn,t.configuration),t.profile&&await this.storage.set(mn,t.profile),(!r&&o||a)&&await this.onStop(),r&&o&&this.onRun()}async subscribeForChromeEvents(){await chrome.alarms.create(pn,{delayInMinutes:2,periodInMinutes:2}),chrome.alarms.onAlarm.addListener((e=>{e.name===pn&&(this.logger.log("Alarm invoked: "+pn),this.onRun())})),bn()&&(await chrome.alarms.create(yn,{delayInMinutes:1/6,periodInMinutes:1/6}),chrome.alarms.onAlarm.addListener((e=>{e.name===yn&&(this.logger.log("Firefox alarm invoked: "+yn),se(1))}))),chrome.cookies.onChanged.addListener((e=>{e.cookie.domain.includes("steamcommunity")&&(this.logger.log("Cookie change invoked: "+pn),this.onRun(!0,!0))}))}async restoreExtensionState(){this.logger.log("Restore extension state");const e={},t=await this.storage.get(gn);return t&&(e.configuration=await this.migrationService.migrate(t)),e.profile=await this.storage.get(mn),this.logger.log("Extension state restored",e.profile),this.store.update(e),e}async createOffscreenPage(){if("chrome"===wn()){if(!await chrome.offscreen.hasDocument()){const e="Offscreen API: creating a separated page to get username, trade offer url and web api key, automatically send trade offers requests.";this.logger.log(e),await chrome.offscreen.createDocument({url:chrome.runtime.getURL("offscreen.html"),reasons:[chrome.offscreen.Reason.DOM_PARSER,chrome.offscreen.Reason.DOM_SCRAPING],justification:e})}oi.to.offscreen.isConnected||oi.to.offscreen.connect(vn)}}async checkSteamAuth(){const e=await ce.getSteamAccessToken(),{refreshSteamAuthAutomatically:t}=this.store.get().configuration;if(!e)return oi.services.notifications.show(ln.NoSteamAuth,_n("steam_authorization_is_missing"),_n("open_https_steamcommunity_com_and_authorize_into_your_own_account")),void this.logger.log("Steam authorization is missing");switch(ce.validateTokenExpireDate(e)){case"expired":if(!t)return void this.logger.log("Steam session expired, update is turned off");this.logger.log("Steam session expired, trying to update"),await ce.refreshSteamAuthData();break;case"not-valid":return oi.services.notifications.show(ln.NoSteamAuth,_n("steam_authorization_is_not_valid"),_n("open_https_steamcommunity_com_and_authorize_into_your_own_account")),void this.logger.log("Steam authorization is not valid");case"valid":return chrome.notifications.clear(ln.NoSteamAuth),void this.logger.log("Steam authorization is okay")}}async refreshUserData(e,t=!1){const n={},r=await ce.getSteamId(),i=await ce.getSessionId(),o=await ce.getSteamAccessToken();try{const{avatarUrl:a,username:s}=await oi.to.offscreen.invoke(pe);return i&&r&&s&&o?(n.profile=new _({sessionId:i,steamId:r,username:s,avatarUrl:a,accessToken:o,lastWsClientId:e?.lastWsClientId}),n.steamAuth={status:!0,description:"ok"},n.profile.tradeOfferUrl=await oi.to.offscreen.invoke(he)):(n.steamAuth={status:!1,description:"auth_failed"},n.profile=void 0),oi.store.update(n,t),n.profile}catch(e){let r="error";e instanceof Error&&(r=e.message),n.steamAuth={status:!1,description:r},oi.store.update(n,t)}}async refreshWebSocket(e=!1){const{serverLocation:t}=this.store.get().configuration,n={};try{if((this.marketWebSocketService?.connectionStatus===re.Closed||e)&&(this.unsubscribeFromMarketUpdates?.(),this.marketWebSocketService?.terminate(),this.marketWebSocketService=void 0),!this.marketWebSocketService){n.market={status:!1,description:"off"},this.marketWebSocketService=new qe,this.unsubscribeFromMarketUpdates=this.marketWebSocketService.listen("connectionStatusChanged",((e,t)=>{const n={status:t===re.Authorized,description:t};oi.store.update({market:n})}));const e="world"===t?"wss://appws.dota2.net/":"wss://appws.csgobuy.cn/";await this.marketWebSocketService.connect(e)}}catch(e){n.market={status:!1,description:"auth_failed"}}oi.store.update(n)}};xn([$e(e),Mn("design:type","function"==typeof(On=void 0!==hn&&hn)?On:Object)],jn.prototype,"storage",void 0),xn([$e(d),Mn("design:type","function"==typeof(An=void 0!==un&&un)?An:Object)],jn.prototype,"migrationService",void 0),jn=xn([z(),Rn(0,$e(v)),Rn(1,$e(g)),Mn("design:paramtypes",["function"==typeof(Sn=void 0!==Q&&Q)?Sn:Object,"function"==typeof(kn=void 0!==J&&J)?kn:Object])],jn);const In=async e=>{let t="",n="#FFF";switch(e){case Pn.Green:t="On",n="#00FF00";break;case Pn.Red:t="Err",n="#FF0000"}chrome.action.setBadgeText({text:t}),chrome.action.setBadgeBackgroundColor({color:n})},Tn=async e=>{const t=e?"":"_grey";await chrome.action.setIcon({path:{48:chrome.runtime.getURL(`img/favicon_csgo${t}_48.png`),128:chrome.runtime.getURL(`img/favicon_csgo${t}.png`)}})};var Pn;!function(e){e.None="None",e.Green="Green",e.Red="Red"}(Pn||(Pn={}));var Dn;let Cn=class{constructor(e){this.store=e,this.store.listen("update",(async(e,t)=>{await this.onStoreUpdate(t)}))}async onStart(){await In(Pn.None),await Tn(!1)}async onStoreUpdate({prev:e,next:t}){const{isExtensionEnabled:n}=t.configuration,r=e.profile&&!t.profile,i=t.market.status&&t.steamAuth.status;return n&&!r&&t.hasRequiredPermissions?n?(await Tn(!0),i?void await In(Pn.Green):void await In(Pn.Red)):void 0:(await In(Pn.None),void await Tn(!1))}};Cn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z(),function(e,t){return function(n,r){t(n,r,e)}}(0,$e(g)),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",["function"==typeof(Dn=void 0!==J&&J)?Dn:Object])],Cn);var En,qn,Nn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},$n=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Bn=class extends G{constructor(e,t){super(),this.responseHandlers=new Map,this.requestHandlers=new Map,this.logger=t,chrome.runtime.onConnect.addListener((t=>{t.name===e&&this.onConnect(t)}))}get isConnected(){return!!this.port}connect(e){const t=chrome.runtime.connect({name:e});this.onConnect(t),this.emit("onConnect")}disconnect(){this.port&&(this.port.disconnect(),this.onDisconnect(),this.emit("onDisconnect"))}addListener(e,t){this.responseHandlers.set(e,t),this.logger.log("Listener added: ",e)}removeListener(e){this.responseHandlers.delete(e)}async invoke(e,...t){this.logger.log("Invoke: ",e);const n=Ee();this.port?.postMessage({channel:e,payload:t??[],id:n});const r=new AbortController;return await new Promise(((e,t)=>{r.signal.onabort=e=>{t(e.currentTarget.reason)},this.requestHandlers.set(n,[t=>{this.requestHandlers.delete(n),e(t)},r])}))}async send(e,...t){this.logger.log("Send: ",e);const n=Ee();this.port?.postMessage({channel:e,payload:t??[],id:n})}onConnect(e){this.port&&this.port.disconnect(),this.logger.log("New connection: ",e.name),this.port=e,this.port.onMessage.addListener((e=>(this.reducer(e),!0))),this.port.onDisconnect.addListener(this.onDisconnect.bind(this))}onDisconnect(){this.logger.log("Disconnected with: "+String(this.port?.name));for(const e of Array.from(this.requestHandlers.values()))e[1].abort(new Error("Port has been disconnected"));this.requestHandlers.clear(),this.port&&"error"in this.port&&this.port.error&&this.logger.error(this.port.error),this.port=void 0}async reducer(e){if("response"in e||"error"in e){const t=this.requestHandlers.get(e.id);if(!t)return;if("error"in e){const n=new Error;return n.name=e.name,n.message=e.message,n.stack=e.stack,void t[1].abort(n)}return void t[0](e.payload)}const t=this.responseHandlers.get(e.channel);if(t)try{const n=await t(...e.payload);this.port?.postMessage({id:e.id,response:!0,channel:e.channel,payload:n})}catch(t){this.port?.postMessage({id:e.id,error:!0,message:t.message,name:t.name,stack:t.stack,channel:e.channel})}else{this.logger.warn(`Unable to resolve reducer for "${e.channel}"`);const t=new Error(`Unable to resolve reducer for "${e.channel}"`);this.port?.postMessage({id:e.id,error:!0,message:t.message,name:t.name,stack:t.stack,channel:e.channel})}}};Bn=Nn([z(),function(e,t){return function(n,r){t(n,r,e)}}(1,$e(v)),$n("design:paramtypes",[String,"function"==typeof(En=void 0!==Q&&Q)?En:Object])],Bn);let Kn=class{create(e){return new Bn(e,this.logger)}};Nn([$e(v),$n("design:type","function"==typeof(qn=void 0!==Q&&Q)?qn:Object)],Kn.prototype,"logger",void 0),Kn=Nn([z()],Kn);let Fn=class{constructor(){this.name="Cs2SteamInventoryMigration"}async isRequired(e){return void 0===e.isCs2InventoryEnabled}async migrate(e){return e.isCs2InventoryEnabled=!0,e}};Fn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z()],Fn);var Ln,Wn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Yn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Un=class{async onStart(){const e=[this.offscreenCM,this.injectCM];for(const t of e)t.addListener(Oe,this.removeRuleById.bind(this)),t.addListener(Se,this.setRefererHeaderRule.bind(this)),t.addListener(ke,this.appendCookieRule.bind(this))}async setRefererHeaderRule(e,t,n){const r=await this.setHeaderByUrl(e,t,"Referer",n);await this.updateRuleById(e,r)}async appendCookieRule(e,t,n){const r=await this.setHeaderByUrl(e,t,"Cookie",n);await this.updateRuleById(e,r)}async removeRuleById(e){await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[e]}),this.logger.log("Rule has been removed: ",e)}async setHeaderByUrl(e,t,n,r){const i={id:e,priority:1,action:{type:"modifyHeaders",requestHeaders:[{operation:"set",header:n,value:r}]},condition:{urlFilter:t,resourceTypes:["xmlhttprequest"]}};return await this.updateRuleById(e,i),i}async updateRuleById(e,t){await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[e],addRules:[t]}),this.logger.log("Rule has been applied: ",t)}};Wn([$e(v),Yn("design:type","function"==typeof(Ln=void 0!==Q&&Q)?Ln:Object)],Un.prototype,"logger",void 0),Wn([$e(y),Yn("design:type",Object)],Un.prototype,"offscreenCM",void 0),Wn([$e(p),Yn("design:type",Object)],Un.prototype,"injectCM",void 0),Un=Wn([z()],Un);const Hn=async(e,t)=>{if(t?.body instanceof FormData)throw new Error("GET doesn't support FormData body");return t?.body instanceof URLSearchParams&&(e=e+"?"+t.body.toString()),await fetch(e,{method:"GET",mode:t?.mode||"cors",headers:t?.headers})};var Vn,zn,Gn=function(e,t){return function(n,r){t(n,r,e)}};let Jn=class extends ne{constructor(e,t){super(t),this.injectCM=e,this.injectCM.addListener(De,this.get.bind(this))}async get(e){const t=await(async(e,t)=>await fetch(e,{method:"POST",mode:"cors",headers:t?.headers,body:t?.body}))("https://floats.ondev.run/float",{body:JSON.stringify(e)});return 200!==t.status?[]:await t.json()}};Jn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z(),Gn(0,$e(p)),Gn(1,$e(v)),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",["function"==typeof(Vn=void 0!==Bn&&Bn)?Vn:Object,"function"==typeof(zn=void 0!==Q&&Q)?zn:Object])],Jn);var Qn;let Xn=class extends ne{constructor(e){super(e)}async onStart(){chrome.runtime.onMessageExternal.addListener(((e,t,n)=>(this.externalMessageHandler(e,n),!0)))}async externalMessageHandler(e,t){switch(oi.logger.log("External message handler invoked: "+String(e.cmd)),e.cmd){case"checkInstall":t({success:!0});break;case"start":t(await this.onStartMessage())}}async onStartMessage(){const{configuration:e,hasRequiredPermissions:t}=oi.store.get();return t&&e.isExtensionEnabled?{success:!0,data:void 0}:{success:!1,error:"Missing required permissions"}}};Xn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z(),function(e,t){return function(n,r){t(n,r,e)}}(0,$e(v)),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",["function"==typeof(Qn=void 0!==Q&&Q)?Qn:Object])],Xn);var Zn,er,tr=function(e,t){return function(n,r){t(n,r,e)}};let nr=class extends ne{constructor(e,t){super(t),this.injectCM=e,this.injectCM.addListener(Pe,this.getItemSellPrice.bind(this))}async getItemSellPrice(e){try{const{itemHashName:t,currencyId:n,country:r}=e,i=await this.getItemNameId(t);if(!i)throw Error("itemNameId not found");return await this.getItemPrice({itemNameId:i,currencyId:n,country:r})}catch(e){throw this.logger.error(e),new Error(e.message)}}async getItemNameId(e){const t="https://raw.githubusercontent.com/Olimp666/steam-market-item-nameids/master/ids.json",n=await Hn(t);if(200!==n.status)throw Error(`${t} with status ${n.status}`);return(await n.json())[e]}async getItemPrice(e){const{itemNameId:t,country:n,currencyId:r}=e,i=(e=>{const t={};for(const[n,r]of Object.entries(e))r&&(Array.isArray(r)?t[n]=r.map((e=>String(e))).join(","):t[n]="string"==typeof r?r:String(r));return new URLSearchParams(t)})({country:n,language:"english",currency:r,item_nameid:t}),o=await Hn("https://steamcommunity.com/market/itemordershistogram",{body:i});if(200!==o.status)throw Error(`Error code: ${o.status} Status: ${o.statusText}`);return await o.json()}};nr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z(),tr(0,$e(p)),tr(1,$e(v)),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",["function"==typeof(Zn=void 0!==Bn&&Bn)?Zn:Object,"function"==typeof(er=void 0!==Q&&Q)?er:Object])],nr),n(164),n(6581),n(7095);var rr,ir=n(7076),or=n.n(ir),ar=n(9911),sr=n.n(ar),cr=n(7890),ur=n.n(cr);or().extend(sr()),or().extend(ur());class fr{static unixNow(){return Math.floor((new Date).getTime()/1e3)}static extractTimeToExchange(e){const t=e.replaceAll("Tradable After","").replace(/[()]/g,""),n=or()(t);if(n.isValid()){const e=or()(),t=n.diff(e,"hours");return{remainDays:n.diff(e,"days"),remainHours:t}}}}!function(e){e.Initial="Initial",e.RequiresApproval="RequiresApproval",e.Completed="Completed",e.Error="Error",e.Canceled="Canceled"}(rr||(rr={}));var lr=n(5594);const dr=Symbol.for("Dexie"),hr=globalThis[dr]||(globalThis[dr]=lr);if(lr.semVer!==hr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${lr.semVer} and ${hr.semVer}`);const{liveQuery:pr,mergeRanges:yr,rangesOverlap:vr,RangeSet:gr,cmp:mr,Entity:br,PropModSymbol:wr,PropModification:_r,replacePrefix:Sr}=hr,kr=hr;let Or=class{constructor(){this.dbName="market-extension"}async onStart(){this.db=new kr(this.dbName),this.db.version(this.version).stores({[this.storeName]:this.scheme}),this.table=this.db.table(this.storeName),await this.db.open()}};Or=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z()],Or);var Ar,xr,Mr=function(e,t){return function(n,r){t(n,r,e)}};let Rr=class extends Or{constructor(e,t){super(),this.storeName="marketTradeOffers",this.scheme="++id,tradeOfferId,*partnerId,createdAt,type,name,status,updatedAt",this.version=6,this.injectCM=e,this.popupCM=t,this.injectCM.addListener(Ae,(()=>this.getMany().toArray())),this.popupCM.addListener(xe,(()=>this.getActiveTradesCount()))}async add(e){const t=await this.table.put(e);return e.id=t,this.sendEvent(Re,e),e}async getById(e){if(!e)throw new Error("Missing id");return await this.table.get(e)}async getByTradeName(e){return await this.table.filter((t=>t.name===e)).first()}async getByTradeOfferId(e){return await this.table.where({tradeOfferId:e}).first()}getMany(){return this.table.toCollection()}async update(e,t){if(!e)throw new Error("Missing id");await this.table.update(e,t);const n=await this.getById(e);if(!n)throw new Error("Missing entity");return this.sendEvent(Me,n),n}async getActiveTradesCount(){return await this.table.filter((e=>e.status===rr.RequiresApproval&&!!e.createdAt&&e.createdAt+300>fr.unixNow())).count()}async delete(e){await this.table.delete(e)}sendEvent(e,t){this.injectCM.send(e,t),this.popupCM.send(e,t)}};Rr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z(),Mr(0,$e(p)),Mr(1,$e(h)),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",["function"==typeof(Ar=void 0!==Bn&&Bn)?Ar:Object,"function"==typeof(xr=void 0!==Bn&&Bn)?xr:Object])],Rr);class jr{constructor(e){this.tradeOfferId=e.tradeOfferId,this.partnerId=e.partnerId,this.type=e.type,this.name=e.name,this.wsMessage=e.wsMessage,this.status=e.status,this.createdAt=fr.unixNow(),this.updatedAt=fr.unixNow()}}var Ir;!function(e){e.Buy="Buy",e.Sell="Sell"}(Ir||(Ir={}));class Tr{constructor(e){this.steamId=e.steamId,this.createTime=e.createTime,this.avatarUrl=e.avatarUrl,this.profileUrl=e.profileUrl,this.level=e.level,this.username=e.username,this.createdAt=fr.unixNow(),this.updatedAt=fr.unixNow()}}var Pr,Dr,Cr=function(e,t){return function(n,r){t(n,r,e)}};let Er=class extends ne{constructor(e,t){super(t),this.injectCM=e,this.injectCM.addListener(je,this.accept.bind(this)),this.injectCM.addListener(Ie,this.create.bind(this)),this.injectCM.addListener(Te,this.cancel.bind(this))}async onStart(){const e="delete-alarm";await chrome.alarms.create(e,{periodInMinutes:240,delayInMinutes:240}),chrome.alarms.onAlarm.addListener((t=>{t.name===e&&this.deleteOld()})),await this.deleteOld()}async getTradePartnerInfo(e){const t=await ce.getSteamAccessToken();if(!t)throw new Error("Unable to get steam access token");const[n]=await oi.to.offscreen.invoke(ge,t,e.toString()),r=await oi.to.offscreen.invoke(me,t,e.toString());return new Tr({steamId:e.toString(),avatarUrl:n.avatarfull,username:n.personaname,level:r,createTime:n.timecreated,profileUrl:n.profileurl})}async add(e){const{data:{post:t}}=e;let n;if("json_tradeoffer"in t){const r=await oi.repositories.marketTradeOffer.getByTradeName(t.tradeoffermessage);if(r)return r.wsMessage=e,await this.tryResolveMarketTradeOffer(r),r;const i=await oi.repositories.steamAccount.add(await this.getTradePartnerInfo(t.partner));n=new jr({partnerId:i.id,status:rr.RequiresApproval,wsMessage:e,name:t.tradeoffermessage,type:Ir.Sell})}else{const r=await oi.repositories.marketTradeOffer.getByTradeOfferId(t.tradeofferid);if(r)return r.wsMessage=e,await this.tryResolveMarketTradeOffer(r),r;const i=await oi.to.offscreen.invoke(ve,await ce.getSteamAccessToken(),t.tradeofferid),o=await oi.repositories.steamAccount.add(await this.getTradePartnerInfo(ce.getSteam64(i.accountid_other)));n=new jr({partnerId:o.id,tradeOfferId:i.tradeofferid,status:rr.RequiresApproval,type:Ir.Buy,wsMessage:e,name:i.message})}const r=await oi.repositories.marketTradeOffer.add(n);return await this.tryResolveMarketTradeOffer(r),r}async create(e){const{marketWebSocketService:t}=oi.services.background,n=await oi.to.offscreen.invoke(fe,e.wsMessage.data.post);let r;if(t?.write(e.wsMessage.event,n,e.wsMessage.callback),n.success){const{tradeofferid:e}=n.data;r=await oi.to.offscreen.invoke(ve,await ce.getSteamAccessToken(),e)}return await oi.repositories.marketTradeOffer.update(e.id,{status:n.success?rr.Completed:rr.Error,tradeOfferId:r?.tradeofferid}),n}async accept(e){const{marketWebSocketService:t}=oi.services.background,n=await oi.to.offscreen.invoke(ue,e.wsMessage.data.post);return t?.write(e.wsMessage.event,n,e.wsMessage.callback),await oi.repositories.marketTradeOffer.update(e.id,{status:n.success?rr.Completed:rr.Error}),n}async cancel(e){if("requiredAction"in e){const t=await oi.repositories.marketTradeOffer.getByTradeOfferId(e.tradeOfferId);if(!t)return"cancel"===e.requiredAction?await oi.to.offscreen.invoke(le,e.tradeOfferId):await oi.to.offscreen.invoke(de,e.tradeOfferId);e=t}let t={success:!1,error:"Unable to cancel/decline trade offer (unknown reason)"};if(e.type===Ir.Buy){const n=e.wsMessage.data.post;t=await oi.to.offscreen.invoke(de,n.tradeofferid)}else e.tradeOfferId&&(t=await oi.to.offscreen.invoke(le,e.tradeOfferId));return t?.success&&await oi.repositories.marketTradeOffer.update(e.id,{status:rr.Canceled}),t}async deleteOld(){try{const e=await oi.repositories.marketTradeOffer.getMany().filter((e=>e.createdAt+2592e3<fr.unixNow())).delete();this.logger.log(`Successfully removed old market trade offers (${e})`)}catch(e){this.logger.error("Unable to remove old market trade offers")}}async tryResolveMarketTradeOffer(e){const{tradeOfferResolutionMode:t}=oi.store.get().configuration;this.isAutoAcceptRequired(e,t)?await this.accept(e):oi.services.notifications.show(ln.AcceptTradeOffer,_n("new_create_trade_offer_request"),_n("trade_offer_requires_action_on_trade_offers_page")),this.isAutoCreateRequired(e,t)?await this.create(e):oi.services.notifications.show(ln.CreateTradeOffer,_n("new_accept_trade_offer_request"),_n("trade_offer_requires_action_on_trade_offers_page"))}isAutoAcceptRequired(e,t){return e.status===rr.RequiresApproval&&e.type===Ir.Buy&&(t===b.Accept||t===b.CreateAndAccept)&&e.wsMessage}isAutoCreateRequired(e,t){return e.status===rr.RequiresApproval&&e.type===Ir.Sell&&(t===b.Create||t===b.CreateAndAccept)&&e.wsMessage}};Er=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z(),Cr(0,$e(p)),Cr(1,$e(v)),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",["function"==typeof(Pr=void 0!==Bn&&Bn)?Pr:Object,"function"==typeof(Dr=void 0!==Q&&Q)?Dr:Object])],Er);var qr,Nr,$r=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Br=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Kr=class{constructor(e,t){this.listeners=new Map,this.portName=e,this.logger=t,window&&!window.nativeCommunicationStore&&(window.nativeCommunicationStore=[]);const n=window.nativeCommunicationStore.find((t=>t.portName===e));if(n)return n;window.nativeCommunicationStore.push(this)}get isConnected(){return!0}connect(e){}addListener(e,t){this.logger.log("Listener added: ",e),this.listeners.set(e,t)}removeListener(e){this.listeners.delete(e)}async invoke(e,...t){this.logger.log("Invoke: ",e);const n=this.listeners.get(e);if(!n)throw new Error("Unable to invoke listener for "+e);return await n(...t)}async send(e,...t){this.logger.log("Send: ",e);const n=this.listeners.get(e);n?await n(...t):this.logger.warn("Unable to send data to listener "+e)}};Kr=$r([z(),function(e,t){return function(n,r){t(n,r,e)}}(1,$e(v)),Br("design:paramtypes",[String,"function"==typeof(qr=void 0!==Q&&Q)?qr:Object])],Kr);let Fr=class{create(e){return new Kr(e,this.logger)}};var Lr;$r([$e(v),Br("design:type","function"==typeof(Nr=void 0!==Q&&Q)?Nr:Object)],Fr.prototype,"logger",void 0),Fr=$r([z()],Fr);var Wr,Yr,Ur,Hr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Vr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let zr=(Wr=Lr=class extends ne{constructor(e){super(e)}async onStart(){const e=await chrome.permissions.contains(Wr.required);this.store.update({hasRequiredPermissions:e}),chrome.permissions.onAdded.addListener(this.onPermissionsChanged.bind(this)),chrome.permissions.onRemoved.addListener(this.onPermissionsChanged.bind(this))}async hasRequiredPermissions(){return await chrome.permissions.contains(Wr.required)}async onPermissionsChanged(){const e=await this.hasRequiredPermissions();this.store.update({hasRequiredPermissions:e})}static async requestAdditionalPermissions(){return await chrome.permissions.request(Wr.required)}},Lr.required={origins:["https://steamcommunity.com/*","https://api.steampowered.com/*","https://floats.ondev.run/*"]},Lr);Hr([$e(g),Vr("design:type","function"==typeof(Ur=void 0!==J&&J)?Ur:Object)],zr.prototype,"store",void 0),zr=Wr=Hr([z(),function(e,t){return function(n,r){t(n,r,e)}}(0,$e(v)),Vr("design:paramtypes",["function"==typeof(Yr=void 0!==Q&&Q)?Yr:Object])],zr);let Gr=class{constructor(){this.name="RefreshSteamAuthorizationMigration"}async isRequired(e){return void 0===e.refreshSteamAuthAutomatically}async migrate(e){return e.refreshSteamAuthAutomatically=!0,e}};Gr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z()],Gr);var Jr;let Qr=class extends Or{constructor(e){super(),this.storeName="steamAccounts",this.scheme="++id,steamId,createTime,avatarUrl,profileUrl,level,username,createdAt,updatedAt",this.version=3,e.addListener(Ce,this.getById.bind(this))}async add(e){const t=await this.table.where({steamId:e.steamId}).first();if(t&&t.id)return await this.update(t.id,e),t;const n=await this.table.put(e);return e.id=n,e}async getById(e){if(!e)throw new Error("Missing id");return await this.table.get(e)}getMany(){return this.table.toCollection()}async update(e,t){await this.table.update(e,t)}async delete(e){await this.table.delete(e)}};Qr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z(),function(e,t){return function(n,r){t(n,r,e)}}(0,$e(p)),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",["function"==typeof(Jr=void 0!==Bn&&Bn)?Jr:Object])],Qr);let Xr=class{constructor(){this.name="TradeOfferResolutionSettingMigration"}async isRequired(e){return void 0===e.tradeOfferResolutionMode}async migrate(e){return e.tradeOfferResolutionMode=b.CreateAndAccept,e}};Xr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([z()],Xr);const Zr=new nn;Zr.bind(nn).toConstantValue(Zr),Zr.bind(v).toDynamicValue((()=>new Q("background",!1))).inSingletonScope(),Zr.bind(Kn).toSelf().inSingletonScope(),bn()?(Zr.bind(Fr).toSelf().inSingletonScope(),Zr.bind(y).toDynamicValue((e=>e.container.get(Fr).create(vn))).inSingletonScope()):Zr.bind(y).toDynamicValue((e=>e.container.get(Kn).create(vn))).inSingletonScope(),Zr.bind(e).to(hn).inSingletonScope(),Zr.bind(g).to(J).inSingletonScope(),Zr.bind(h).toDynamicValue((e=>e.container.get(Kn).create("background-popup-connection"))).inSingletonScope(),Zr.bind(p).toDynamicValue((e=>e.container.get(Kn).create("background-inject-connection"))).inSingletonScope(),Zr.bind(i).to(dn).inSingletonScope(),Zr.bind(r).to(jn).inSingletonScope(),Zr.bind(a).to(Xn).inSingletonScope(),Zr.bind(t).to(zr).inSingletonScope(),Zr.bind(s).to(Er).inSingletonScope(),Zr.bind(f).to(Qr).inSingletonScope(),Zr.bind(l).to(Rr).inSingletonScope(),Zr.bind(o).to(Cn).inSingletonScope(),Zr.bind(c).to(Jn).inSingletonScope(),Zr.bind(u).to(nr).inSingletonScope(),Zr.bind(m).to(Un).inSingletonScope(),Zr.bind(d).to(un).inSingletonScope(),Zr.bind(rn).to(Xr),Zr.bind(rn).to(Gr),Zr.bind(rn).to(Fn);const ei=Zr.get(g),ti=Zr.get(i),ni=Zr.get(y),ri=Zr.get(h),ii=Zr.get(p);ni.addListener(be,ei.get.bind(ei)),ni.addListener("background-restart",(()=>{chrome.runtime.reload()})),ni.addListener("notification-service-show",ti.show.bind(ti)),ri.addListener(be,ei.get.bind(ei)),ri.addListener(we,(e=>{ei.update(e)})),ii.addListener(be,ei.get.bind(ei)),ii.addListener(we,(e=>{ei.update(e)})),ii.addListener("steam-utils-get-steam-cookies",ce.getSteamCookies.bind(ce));const oi={logger:Zr.get(v),to:{offscreen:ni,popup:ri,inject:ii},services:{background:Zr.get(r),badge:Zr.get(o),permissions:Zr.get(t),installCheck:Zr.get(a),notifications:Zr.get(i),marketTradeOffer:Zr.get(s),floatInventory:Zr.get(c),inventory:Zr.get(u)},repositories:{marketTradeOffer:Zr.get(l),steamAccount:Zr.get(f)},store:Zr.get(g),storage:Zr.get(e),declarativeNetRequestService:Zr.get(m)};oi.logger.log("Background API has been loaded"),oi.services.installCheck.onStart(),oi.services.permissions.onStart(),oi.services.background.onStart(),oi.services.badge.onStart(),oi.declarativeNetRequestService.onStart(),oi.repositories.marketTradeOffer.onStart(),oi.repositories.steamAccount.onStart(),oi.services.marketTradeOffer.onStart()})()})();