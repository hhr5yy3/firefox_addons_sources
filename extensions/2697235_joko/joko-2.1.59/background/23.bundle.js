"use strict";(self.webpackChunkchrome_extension=self.webpackChunkchrome_extension||[]).push([[23],{7713:(e,t,r)=>{r.d(t,{b:()=>S});var n=r(15215),o=r(34549),i=r(3976),s=r(88319),a=r(23472),c=r.n(a),u=r(71805),l=r(89404),f=r(33770),g=r(89700),h=r(78704),d=r(46982),p=r(75488),_=r(27183),v=r(99496),m=r(54634),y=r(83934),w=r(30113);function b(e,t){if(!Number.isFinite(e)||!Number.isFinite(t))throw new Error("Invalid coordinates: ["+e+","+t+"]");if(t<-90||90<t)throw new Error("Latitude must be between -90 and 90 degrees inclusive.");if(e<-180||180<e)throw new Error("Longitude must be between -180 and 180 degrees inclusive.")}function I(e){if(!/^[-._\p{L}\p{N}]+$/iu.test(e))throw new Error("Invalid geofenceId: '"+e+"' - IDs can only contain alphanumeric characters, hyphens, underscores and periods.")}function C(e,t){var r=t?t+": ":"";if(e.length<4)throw new Error(r+"LinearRing must contain 4 or more coordinates.");var o=[];if(e.forEach((function(e){try{b(e[0],e[1])}catch(t){o.push({coordinates:e,error:t.message})}})),o.length>0)throw new Error(r+"One or more of the coordinates in the Polygon LinearRing are not valid: "+JSON.stringify(o));var i=(0,n.__read)(e[0],2),s=i[0],a=i[1],c=(0,n.__read)(e[e.length-1],2),u=c[0],l=c[1];if(s!==u||a!==l)throw new Error(r+"LinearRing's first and last coordinates are not the same");if((0,w.A)(e))throw new Error(r+"LinearRing coordinates must be wound counterclockwise")}function P(e){var t={};e.forEach((function(e){if(!e.geofenceId)throw new Error("Geofence '"+e+"' is missing geofenceId");var r=e.geofenceId;if(I(r),t[r])throw new Error("Duplicate geofenceId: "+r);if(t[r]=!0,!e.geometry)throw new Error("Geofence '"+r+"' is missing geometry");var o=e.geometry;if(!o.polygon)throw new Error("Geofence '"+r+"' is missing geometry.polygon");var i=o.polygon;try{!function(e,t){var r=t?t+": ":"";if(!Array.isArray(e))throw new Error(r+"Polygon is of incorrect structure. It should be an array of LinearRings");if(e.length<1)throw new Error(r+"Polygon must have a single LinearRing array.");if(e.length>1)throw new Error(r+"Polygon must have a single LinearRing array. Note: We do not currently support polygons with holes, multipolygons, polygons that are wound clockwise, or that cross the antimeridian.");if(e.reduce((function(e,t){return e+t.length}),0)>1e3)throw new Error(r+"Polygon has more than the maximum 1000 vertices.");e.forEach((function(e){C(e,t)}))}(i,r)}catch(e){if(e.message.includes("Polygon has more than the maximum 1000 vertices."))throw new Error("Geofence '"+r+"' has more than the maximum of 1000 vertices")}C((0,n.__read)(i,1)[0],r)}))}function N(e,t){var r=(0,n.__assign)({},t);if(r.FilterCountries=e.countries,r.MaxResults=e.maxResults,e.searchIndexName&&(r.IndexName=e.searchIndexName),e.biasPosition&&e.searchAreaConstraints)throw new Error("BiasPosition and SearchAreaConstraints are mutually exclusive, please remove one or the other from the options object");return e.biasPosition&&(r.BiasPosition=e.biasPosition),e.searchAreaConstraints&&(r.FilterBBox=e.searchAreaConstraints),r}var x=new o.C("AmazonLocationServiceProvider"),E=function(){function e(e){this._config=e||{},x.debug("Geo Options",this._config)}return e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.getProviderName=function(){return e.PROVIDER_NAME},e.prototype.configure=function(e){return x.debug("configure Amazon Location Service Provider",e),e?(this._config=Object.assign({},this._config,e),this._config):this._config},e.prototype.getAvailableMaps=function(){this._verifyMapResources();var e=[],t=this._config.maps.items,r=this._config.region;for(var n in t){var o=t[n].style;e.push({mapName:n,style:o,region:r})}return e},e.prototype.getDefaultMap=function(){this._verifyMapResources();var e=this._config.maps.default;return{mapName:e,style:this._config.maps.items[e].style,region:this._config.region}},e.prototype.searchByText=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s,a,l;return(0,n.__generator)(this,(function(h){switch(h.label){case 0:return[4,this._ensureCredentials()];case 1:if(!h.sent())throw new Error("No credentials");this._verifySearchIndex(null==t?void 0:t.searchIndexName),r={Text:e,IndexName:this._config.search_indices.default},t&&(r=(0,n.__assign)((0,n.__assign)({},r),N(t,r))),o=new f.R({credentials:this._config.credentials,region:this._config.region,customUserAgent:(0,u.Ij)()}),i=new g.z(r),h.label=2;case 2:return h.trys.push([2,4,,5]),[4,o.send(i)];case 3:return s=h.sent(),[3,5];case 4:throw a=h.sent(),x.debug(a),a;case 5:return l=s.Results.map((function(e){return e.Place})),[2,c()(l,{deep:!0})]}}))}))},e.prototype.searchForSuggestions=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s,a;return(0,n.__generator)(this,(function(c){switch(c.label){case 0:return[4,this._ensureCredentials()];case 1:if(!c.sent())throw new Error("No credentials");this._verifySearchIndex(null==t?void 0:t.searchIndexName),r={Text:e,IndexName:this._config.search_indices.default},t&&(r=(0,n.__assign)((0,n.__assign)({},r),N(t,r))),o=new f.R({credentials:this._config.credentials,region:this._config.region,customUserAgent:(0,u.Ij)()}),i=new h.R(r),c.label=2;case 2:return c.trys.push([2,4,,5]),[4,o.send(i)];case 3:return s=c.sent(),[3,5];case 4:throw a=c.sent(),x.debug(a),a;case 5:return[2,s.Results.map((function(e){return{text:e.Text,placeId:e.PlaceId}}))]}}))}))},e.prototype._verifyPlaceId=function(e){if(0===e.length){var t="PlaceId cannot be an empty string.";throw x.debug(t),new Error(t)}},e.prototype.searchByPlaceId=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s,a,l;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._ensureCredentials()];case 1:if(!n.sent())throw new Error("No credentials");this._verifySearchIndex(null==t?void 0:t.searchIndexName),this._verifyPlaceId(e),r=new f.R({credentials:this._config.credentials,region:this._config.region,customUserAgent:(0,u.Ij)()}),o={PlaceId:e,IndexName:(null==t?void 0:t.searchIndexName)||this._config.search_indices.default},i=new d.V(o),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,r.send(i)];case 3:return s=n.sent(),[3,5];case 4:throw a=n.sent(),x.debug(a),a;case 5:return(l=s.Place)?[2,c()(l,{deep:!0})]:[2]}}))}))},e.prototype.searchByCoordinates=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s,a,l;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._ensureCredentials()];case 1:if(!n.sent())throw new Error("No credentials");this._verifySearchIndex(null==t?void 0:t.searchIndexName),r={Position:e,IndexName:this._config.search_indices.default},t&&(t.searchIndexName&&(r.IndexName=t.searchIndexName),r.MaxResults=t.maxResults),o=new f.R({credentials:this._config.credentials,region:this._config.region,customUserAgent:(0,u.Ij)()}),i=new p.J(r),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,o.send(i)];case 3:return s=n.sent(),[3,5];case 4:throw a=n.sent(),x.debug(a),a;case 5:return l=s.Results.map((function(e){return e.Place})),[2,c()(l[0],{deep:!0})]}}))}))},e.prototype.saveGeofences=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s=this;return(0,n.__generator)(this,(function(a){switch(a.label){case 0:if(e.length<1)throw new Error("Geofence input array is empty");return[4,this._ensureCredentials()];case 1:if(!a.sent())throw new Error("No credentials");try{this._verifyGeofenceCollections(null==t?void 0:t.collectionName)}catch(e){throw x.debug(e),e}for(P(e),r=e.map((function(e){return{GeofenceId:e.geofenceId,Geometry:{Polygon:e.geometry.polygon}}})),o={successes:[],errors:[]},i=[];r.length>0;)i.push(r.splice(0,10));return[4,Promise.all(i.map((function(e){return(0,n.__awaiter)(s,void 0,void 0,(function(){var r,i;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._AmazonLocationServiceBatchPutGeofenceCall(e,(null==t?void 0:t.collectionName)||this._config.geofenceCollections.default)];case 1:return r=n.sent(),[3,3];case 2:return i=n.sent(),e.forEach((function(e){o.errors.push({geofenceId:e.GeofenceId,error:{code:"APIConnectionError",message:i.message}})})),[2];case 3:return r.Successes.forEach((function(e){var t=e.GeofenceId,r=e.CreateTime,n=e.UpdateTime;o.successes.push({geofenceId:t,createTime:r,updateTime:n})})),r.Errors.forEach((function(e){var t=e.Error,r=t.Code,n=t.Message,i=e.GeofenceId;o.errors.push({error:{code:r,message:n},geofenceId:i})})),[2]}}))}))})))];case 2:return a.sent(),[2,o]}}))}))},e.prototype.getGeofence=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s,a,c,l,g,h,d;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._ensureCredentials()];case 1:if(!n.sent())throw new Error("No credentials");try{this._verifyGeofenceCollections(null==t?void 0:t.collectionName)}catch(e){throw x.debug(e),e}I(e),r=new f.R({credentials:this._config.credentials,region:this._config.region,customUserAgent:(0,u.Ij)()}),o={GeofenceId:e,CollectionName:(null==t?void 0:t.collectionName)||this._config.geofenceCollections.default},i=new _.c(o),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,r.send(i)];case 3:return s=n.sent(),[3,5];case 4:throw a=n.sent(),x.debug(a),a;case 5:return c=s.GeofenceId,l=s.CreateTime,g=s.UpdateTime,h=s.Status,d=s.Geometry,[2,{createTime:l,geofenceId:c,geometry:{polygon:d.Polygon},status:h,updateTime:g}]}}))}))},e.prototype.listGeofences=function(e){return(0,n.__awaiter)(this,void 0,void 0,(function(){var t,r,o,i,s,a,c,l;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._ensureCredentials()];case 1:if(!n.sent())throw new Error("No credentials");try{this._verifyGeofenceCollections(null==e?void 0:e.collectionName)}catch(e){throw x.debug(e),e}t=new f.R({credentials:this._config.credentials,region:this._config.region,customUserAgent:(0,u.Ij)()}),r={NextToken:null==e?void 0:e.nextToken,CollectionName:(null==e?void 0:e.collectionName)||this._config.geofenceCollections.default},o=new v.x(r),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,t.send(o)];case 3:return i=n.sent(),[3,5];case 4:throw s=n.sent(),x.debug(s),s;case 5:return a=i.NextToken,c=i.Entries,l={entries:c.map((function(e){return{geofenceId:e.GeofenceId,createTime:e.CreateTime,updateTime:e.UpdateTime,status:e.Status,geometry:{polygon:e.Geometry.Polygon}}})),nextToken:a},[2,l]}}))}))},e.prototype.deleteGeofences=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s,a=this;return(0,n.__generator)(this,(function(c){switch(c.label){case 0:if(e.length<1)throw new Error("GeofenceId input array is empty");return[4,this._ensureCredentials()];case 1:if(!c.sent())throw new Error("No credentials");if(this._verifyGeofenceCollections(null==t?void 0:t.collectionName),(r=e.filter((function(e){try{I(e)}catch(e){return!0}}))).length>0)throw new Error("Invalid geofence ids: "+r.join(", "));for(o={successes:[],errors:[]},i=[],s=0;s<e.length;)i.push(e.slice(s,s+=10));return[4,Promise.all(i.map((function(e){return(0,n.__awaiter)(a,void 0,void 0,(function(){var r,i,s,a;return(0,n.__generator)(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this._AmazonLocationServiceBatchDeleteGeofenceCall(e,(null==t?void 0:t.collectionName)||this._config.geofenceCollections.default)];case 1:return r=c.sent(),[3,3];case 2:return i=c.sent(),e.forEach((function(e){var t={geofenceId:e,error:{code:i.message,message:i.message}};o.errors.push(t)})),[2];case 3:return s=r.Errors.map((function(e){return e.geofenceId})),(a=o.successes).push.apply(a,(0,n.__spread)(e.filter((function(e){return!s.includes(e)})))),[2]}}))}))})))];case 2:return c.sent(),[2,o]}}))}))},e.prototype._ensureCredentials=function(){return(0,n.__awaiter)(this,void 0,void 0,(function(){var e,t,r;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,l.J.get()];case 1:return(e=n.sent())?(t=l.J.shear(e),x.debug("Set credentials for storage. Credentials are:",t),this._config.credentials=t,[2,!0]):[2,!1];case 2:return r=n.sent(),x.debug("Ensure credentials error. Credentials are:",r),[2,!1];case 3:return[2]}}))}))},e.prototype._verifyMapResources=function(){if(!this._config.maps){var e="No map resources found in amplify config, run 'amplify add geo' to create one and run `amplify push` after";throw x.debug(e),new Error(e)}if(!this._config.maps.default){e="No default map resource found in amplify config, run 'amplify add geo' to create one and run `amplify push` after";throw x.debug(e),new Error(e)}},e.prototype._verifySearchIndex=function(e){if(!(this._config.search_indices&&this._config.search_indices.default||e)){var t="No Search Index found in amplify config, please run `amplify add geo` to create one and run `amplify push` after.";throw x.debug(t),new Error(t)}},e.prototype._verifyGeofenceCollections=function(e){if(!(this._config.geofenceCollections&&this._config.geofenceCollections.default||e)){var t="No Geofence Collections found, please run `amplify add geo` to create one and run `amplify push` after.";throw x.debug(t),new Error(t)}},e.prototype._AmazonLocationServiceBatchPutGeofenceCall=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:r={Entries:e,CollectionName:t||this._config.geofenceCollections.default},o=new f.R({credentials:this._config.credentials,region:this._config.region,customUserAgent:(0,u.Ij)()}),i=new m.H(r),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,o.send(i)];case 2:return s=n.sent(),[3,4];case 3:throw n.sent();case 4:return[2,s]}}))}))},e.prototype._AmazonLocationServiceBatchDeleteGeofenceCall=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:r={GeofenceIds:e,CollectionName:t||this._config.geofenceCollections.default},o=new f.R({credentials:this._config.credentials,region:this._config.region,customUserAgent:(0,u.Ij)()}),i=new y.j(r),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,o.send(i)];case 2:return s=n.sent(),[3,4];case 3:throw n.sent();case 4:return[2,s]}}))}))},e.CATEGORY="Geo",e.PROVIDER_NAME="AmazonLocationService",e}(),A=new o.C("Geo"),G="AmazonLocationService",S=new(function(){function e(){this._config={},this._pluggables=[],A.debug("Geo Options",this._config)}return e.prototype.getModuleName=function(){return e.MODULE},e.prototype.addPluggable=function(e){if(e&&"Geo"===e.getCategory())return this._pluggables.push(e),e.configure(this._config[e.getProviderName()])},e.prototype.getPluggable=function(e){var t=this._pluggables.find((function(t){return t.getProviderName()===e}));if(void 0===t)throw A.debug("No plugin found with providerName",e),new Error("No plugin found in Geo for the provider");return t},e.prototype.removePluggable=function(e){this._pluggables=this._pluggables.filter((function(t){return t.getProviderName()!==e}))},e.prototype.configure=function(e){var t=this;if(A.debug("configure Geo"),!e)return this._config;var r=(0,i.s)(e);return this._config=Object.assign({},this._config,r.Geo,e),this._pluggables.forEach((function(e){e.configure(t._config[e.getProviderName()])})),0===this._pluggables.length&&this.addPluggable(new E),this._config},e.prototype.getAvailableMaps=function(e){return void 0===e&&(e=G),this.getPluggable(e).getAvailableMaps()},e.prototype.getDefaultMap=function(e){return void 0===e&&(e=G),this.getPluggable(e).getDefaultMap()},e.prototype.searchByText=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:r=(t||{}).providerName,o=void 0===r?G:r,i=this.getPluggable(o),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,i.searchByText(e,t)];case 2:return[2,n.sent()];case 3:throw s=n.sent(),A.debug(s),s;case 4:return[2]}}))}))},e.prototype.searchForSuggestions=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:r=(t||{}).providerName,o=void 0===r?G:r,i=this.getPluggable(o),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,i.searchForSuggestions(e,t)];case 2:return[2,n.sent()];case 3:throw s=n.sent(),A.debug(s),s;case 4:return[2]}}))}))},e.prototype.searchByPlaceId=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:r=G,o=this.getPluggable(r),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,o.searchByPlaceId(e,t)];case 2:return[2,n.sent()];case 3:throw i=n.sent(),A.debug(i),i;case 4:return[2]}}))}))},e.prototype.searchByCoordinates=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s,a,c,u;return(0,n.__generator)(this,(function(l){switch(l.label){case 0:r=(t||{}).providerName,o=void 0===r?G:r,i=this.getPluggable(o),s=(0,n.__read)(e,2),a=s[0],c=s[1],l.label=1;case 1:return l.trys.push([1,3,,4]),b(a,c),[4,i.searchByCoordinates(e,t)];case 2:return[2,l.sent()];case 3:throw u=l.sent(),A.debug(u),u;case 4:return[2]}}))}))},e.prototype.saveGeofences=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s,a;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:r=(t||{}).providerName,o=void 0===r?G:r,i=this.getPluggable(o),s=Array.isArray(e)?e:[e],n.label=1;case 1:return n.trys.push([1,3,,4]),[4,i.saveGeofences(s,t)];case 2:return[2,n.sent()];case 3:throw a=n.sent(),A.debug(a),a;case 4:return[2]}}))}))},e.prototype.getGeofence=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:r=(t||{}).providerName,o=void 0===r?G:r,i=this.getPluggable(o),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,i.getGeofence(e,t)];case 2:return[2,n.sent()];case 3:throw s=n.sent(),A.debug(s),s;case 4:return[2]}}))}))},e.prototype.listGeofences=function(e){return(0,n.__awaiter)(this,void 0,void 0,(function(){var t,r,o,i;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:t=(e||{}).providerName,r=void 0===t?G:t,o=this.getPluggable(r),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,o.listGeofences(e)];case 2:return[2,n.sent()];case 3:throw i=n.sent(),A.debug(i),i;case 4:return[2]}}))}))},e.prototype.deleteGeofences=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s,a;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:r=(t||{}).providerName,o=void 0===r?G:r,i=this.getPluggable(o),s=Array.isArray(e)?e:[e],n.label=1;case 1:return n.trys.push([1,3,,4]),[4,i.deleteGeofences(s,t)];case 2:return[2,n.sent()];case 3:throw a=n.sent(),A.debug(a),a;case 4:return[2]}}))}))},e.MODULE="Geo",e}());s.H.register(S)},96227:(e,t,r)=>{r.d(t,{O:()=>v});var n=r(15215),o=r(34549),i=r(88319),s=new o.C("AbstractInteractionsProvider"),a=function(){function e(e){void 0===e&&(e={}),this._config=e}return e.prototype.configure=function(e){return void 0===e&&(e={}),this._config=(0,n.__assign)((0,n.__assign)({},this._config),e),s.debug("configure "+this.getProviderName(),this._config),this.options},e.prototype.getCategory=function(){return"Interactions"},Object.defineProperty(e.prototype,"options",{get:function(){return(0,n.__assign)({},this._config)},enumerable:!0,configurable:!0}),e}(),c=r(64869),u=r(88295),l=r(17745),f=r(89404),g=r(71805),h=function(e){return(0,n.__awaiter)(void 0,void 0,void 0,(function(){return(0,n.__generator)(this,(function(t){return e instanceof Blob||e instanceof ReadableStream?[2,new Response(e).arrayBuffer().then((function(e){return new Uint8Array(e)}))]:[2,Promise.reject("Invalid content type")]}))}))},d=new o.C("AWSLexProvider"),p=function(e){function t(t){void 0===t&&(t={});var r=e.call(this,t)||this;return r._botsCompleteCallback={},r}return(0,n.__extends)(t,e),t.prototype.getProviderName=function(){return"AWSLexProvider"},t.prototype.configure=function(t){void 0===t&&(t={});var r=["name","alias","region"];return Object.keys(t).forEach((function(e){var n=t[e];if(!r.every((function(e){return e in n})))throw new Error("invalid bot configuration")})),e.prototype.configure.call(this,t)},t.prototype.reportBotStatus=function(e,t){var r=this;d.debug("postContent state",e.dialogState),"ReadyForFulfillment"!==e.dialogState&&"Fulfilled"!==e.dialogState||("function"==typeof this._botsCompleteCallback[t]&&setTimeout((function(){return r._botsCompleteCallback[t](null,e)}),0),this._config&&"function"==typeof this._config[t].onComplete&&setTimeout((function(){return r._config[t].onComplete(null,e)}),0)),"Failed"===e.dialogState&&("function"==typeof this._botsCompleteCallback[t]&&setTimeout((function(){return r._botsCompleteCallback[t]("Bot conversation failed")}),0),this._config&&"function"==typeof this._config[t].onComplete&&setTimeout((function(){return r._config[t].onComplete("Bot conversation failed")}),0))},t.prototype.sendMessage=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,o,i,s,a,p,_,v,m,y,w,b,I;return(0,n.__generator)(this,(function(C){switch(C.label){case 0:if(!this._config[e])return[2,Promise.reject("Bot "+e+" does not exist")];C.label=1;case 1:return C.trys.push([1,3,,4]),[4,f.J.get()];case 2:return r=C.sent(),[3,4];case 3:return C.sent(),[2,Promise.reject("No credentials")];case 4:if(this.lexRuntimeServiceClient=new c.e({region:this._config[e].region,credentials:r,customUserAgent:(0,g.Ij)()}),"string"!=typeof t)return[3,9];o={botAlias:this._config[e].alias,botName:e,inputText:t,userId:r.identityId},d.debug("postText to lex",t),C.label=5;case 5:return C.trys.push([5,7,,8]),i=new u.p(o),[4,this.lexRuntimeServiceClient.send(i)];case 6:return m=C.sent(),this.reportBotStatus(m,e),[2,m];case 7:return s=C.sent(),[2,Promise.reject(s)];case 8:return[3,21];case 9:return a=t.content,"voice"!==t.options.messageType?[3,13]:"object"!=typeof a?[2,Promise.reject("invalid content type")]:a instanceof Uint8Array?(_=a,[3,12]):[3,10];case 10:return[4,h(a)];case 11:_=C.sent(),C.label=12;case 12:return p=_,o={botAlias:this._config[e].alias,botName:e,contentType:"audio/x-l16; sample-rate=16000; channel-count=1",userId:r.identityId,accept:"audio/mpeg",inputStream:p},[3,14];case 13:if("string"!=typeof a)return[2,Promise.reject("invalid content type")];o={botAlias:this._config[e].alias,botName:e,contentType:"text/plain; charset=utf-8",inputStream:a,userId:r.identityId,accept:"audio/mpeg"},C.label=14;case 14:d.debug("postContent to lex",t),C.label=15;case 15:return C.trys.push([15,20,,21]),v=new l.x(o),[4,this.lexRuntimeServiceClient.send(v)];case 16:return(m=C.sent()).audioStream?[4,h(m.audioStream)]:[3,18];case 17:return w=C.sent(),[3,19];case 18:w=void 0,C.label=19;case 19:return y=w,b=(0,n.__assign)((0,n.__assign)({},m),{audioStream:y}),this.reportBotStatus(b,e),[2,b];case 20:return I=C.sent(),[2,Promise.reject(I)];case 21:return[2]}}))}))},t.prototype.onComplete=function(e,t){if(!this._config[e])throw new Error("Bot "+e+" does not exist");this._botsCompleteCallback[e]=t},t}(a),_=new o.C("Interactions"),v=new(function(){function e(e){void 0===e&&(e={}),this._options=e,_.debug("Interactions Options",this._options),this._pluggables={}}return e.prototype.getModuleName=function(){return"Interactions"},e.prototype.configure=function(e){var t=this,r=e?e.Interactions||e:{};_.debug("configure Interactions",{opt:r}),this._options=(0,n.__assign)((0,n.__assign)({bots:{}},r),r.Interactions);var o=this._options.aws_bots_config,i=this._options.bots;return!Object.keys(i).length&&o&&Array.isArray(o)&&o.forEach((function(e){t._options.bots[e.name]=e})),Object.keys(i).forEach((function(e){var r,n=i[e],o=n.providerName||"AWSLexProvider";t._pluggables.AWSLexProvider||"AWSLexProvider"!==o||(t._pluggables.AWSLexProvider=new p),t._pluggables[o]?t._pluggables[o].configure(((r={})[n.name]=n,r)):_.debug("bot "+n.name+" was not configured as "+o+" provider was not found")})),this._options},e.prototype.addPluggable=function(e){var t=this;if(e&&"Interactions"===e.getCategory()){if(this._pluggables[e.getProviderName()])throw new Error("Pluggable "+e.getProviderName()+" already plugged");return Object.keys(this._options.bots).filter((function(r){return t._options.bots[r].providerName===e.getProviderName()})).forEach((function(r){var n,o=t._options.bots[r];e.configure(((n={})[o.name]=o,n))})),void(this._pluggables[e.getProviderName()]=e)}},e.prototype.send=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:return this._options.bots&&this._options.bots[e]?(r=this._options.bots[e].providerName||"AWSLexProvider",this._pluggables[r]?[4,this._pluggables[r].sendMessage(e,t)]:[2,Promise.reject("Bot "+r+" does not have valid pluggin did you try addPluggable first?")]):[2,Promise.reject("Bot "+e+" does not exist")];case 1:return[2,n.sent()]}}))}))},e.prototype.onComplete=function(e,t){if(!this._options.bots||!this._options.bots[e])throw new Error("Bot "+e+" does not exist");var r=this._options.bots[e].providerName||"AWSLexProvider";if(!this._pluggables[r])throw new Error("Bot "+r+" does not have valid pluggin did you try addPluggable first?");this._pluggables[r].onComplete(e,t)},e}());i.H.register(v)}}]);