var webRTCPrivacy=null,AdsCounters=new Object,blockImagePayload={redirectUrl:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEAAAAALAAAAAABAAEAAAI="},blockPagePayload={redirectUrl:"about:blank"},cancelPayload={cancel:!0};function blockImage(e){if(CheckMainFrameSkip(e))return null;for(var t=0;t!=FILTERS.length;++t){var o=FILTERS[t];if("string"==typeof o&&-1!==e.url.indexOf(o)||"object"==typeof o&&e.url.match(o))return DEBUG&&console.warn("BLOCKED",e,"as",e.type,"with",o),SaveTodaysCounter(e.tabId),blockImagePayload}return null}function blockPage(e){if(CheckIfWhitelisted(e))return null;for(var t=0;t!=FILTERS.length;++t){var o=FILTERS[t];if("string"==typeof o&&-1!==e.url.indexOf(o)||"object"==typeof o&&e.url.match(o))return DEBUG&&console.warn("BLOCKED",e,"as",e.type,"with",o),SaveTodaysCounter(e.tabId),blockPagePayload}return null}function blockObject(e){if(CheckMainFrameSkip(e))return null;for(var t=0;t!=FILTERS.length;++t){var o=FILTERS[t];if("string"==typeof o&&-1!==e.url.indexOf(o)||"object"==typeof o&&e.url.match(o))return DEBUG&&console.warn("BLOCKED",e,"as",e.type,"with",o),SaveTodaysCounter(e.tabId),cancelPayload}return null}var listenerCallbacks=[[["image"],blockImage],[["sub_frame"],blockPage],[["main_frame","object","script","xmlhttprequest","stylesheet","font","media","ping","csp_report","other"],blockObject]];function EnableAdBlocker(){if(!AdBlocker){for(var e in listenerCallbacks){var t=listenerCallbacks[e][0],o=listenerCallbacks[e][1];try{browser.webRequest.onBeforeRequest.addListener(o,{urls:["<all_urls>"],types:t},["blocking"])}catch(e){browser.runtime.lastError}}AdBlocker=!0,browser.storage.sync.set({AdBlocker:AdBlocker},function(){}),UpdatePopupData()}}function DisableAdBlocker(){for(var e=0;e<listenerCallbacks.length;e++){var t=listenerCallbacks[e][1];browser.webRequest.onBeforeRequest.removeListener(t)}AdBlocker=!1,browser.storage.sync.set({AdBlocker:AdBlocker},function(){}),UpdatePopupData()}function setWebRTCPrivacy(e,t){webRTCPrivacy=e;var o=e?"default_public_interface_only":"default";browser.privacy.network.webRTCIPHandlingPolicy.set({value:o}),t&&browser.storage.local.set({webrtc_privacy:e})}function CheckMainFrameSkip(e){return!!CheckIfWhitelisted(e)||(204==e.statusCode||205==e.statusCode||-1===e.tabId||0===e.frameId&&-1===e.parentFrameId&&("main_frame"===e.type||"image"===e.type||"stylesheet"===e.type))}function CheckIfWhitelisted(e){var t=getRootDomain(__PRIMARY_DOMAIN_STORAGE[e.tabId]);return!!IsDomainWhitelisted(t,"adblock")}function SaveTodaysCounter(e){AdBlockToday++;var t=AdsCounters[e];void 0===t?(t=0,AdsCounters[e]=+t+1):AdsCounters[e]=+t+1,setTimeout(function(){browser.storage.local.set({AdBlockToday:AdBlockToday},function(){})},200)}browser.storage.local.get("webrtc_privacy",function(e){void 0==e.webrtc_privacy?setWebRTCPrivacy(!1,!0):setWebRTCPrivacy(e.webrtc_privacy,!1)}),browser.webNavigation.onCompleted.addListener(function(e){if(AdBlocker&&0===e.frameId){if(-1===e.tabId)return;GetUrlFromTabId(e.tabId,function(t){t.includes("moz")||IsDomainWhitelisted(t,"adblock")||browser.tabs.executeScript(e.tabId,{file:"src/adblockcontnent.js",runAt:"document_end"},function(e){browser.runtime.lastError})})}});