(()=>{var Nt=Object.defineProperty;var G=(Et,Ct)=>Nt(Et,"name",{value:Ct,configurable:!0});var It=[];(()=>{var Et={22923:(ae,J)=>{"use strict";const d=/\s/,W={OPEN:"{",CLOSE:"}",TAG_OPEN:"<",TAG_CLOSE:">",TAG_CLOSING:"/",SEP:",",SUB_VAR:"#",ESCAPE:"'"},B="subnumeric_types",R="submessage_types",I=Object.keys(W),U=Symbol("C"),z=J=ae.exports=G(function n(s){if(!(this instanceof n))return new n(s);this.opts=Object.assign({OFFSET:"offset:",[B]:["plural","selectordinal"],[R]:["plural","selectordinal","select"],allowTags:!0,requireOther:!0},W,s);for(let i=0;i<I.length;i++){const l=I[i],w=this.opts[l];if(typeof w!="string"||w.length!==1)throw new Error(`Option ${l} must be a 1-length string`);for(let _=i+1;_<I.length;_++){const o=I[_];if(this.opts[o]===w)throw new Error(`Option ${l} and ${o} cannot match`)}}},"Parser2"),v=z.prototype;v.parse=function(n){return this.parseAST({msg:String(n),i:0},null)},v.parseAST=function(n,s){const i=n.msg,l=this.opts,w=i.length,_=s&&l[B].includes(s.t),o=[];for(;n.i<w;){const e=n.i,a=i[e];if(a===l.CLOSE)if(!s)S(o,"}"),n.i++;else break;else if(a===l.OPEN||_&&a===l.SUB_VAR)S(o,this.parseElement(n,s));else if(l.allowTags&&a===l.TAG_OPEN&&!d.test(i[e+1])){const p=this.parseTag(n,s);if(p===U){s.closed=!0;break}else S(o,p)}else S(o,this.parseText(n,s));if(n.i===e)throw u(a,n.i)}return o},v.parseText=function(n,s,i=!0,l=!0,w=!1){const _=n.msg,o=this.opts,e=o.allowTags,a=_.length,p=s&&o[B].includes(s.t);let C="";for(;n.i<a;){const m=_[n.i];if(m===o.OPEN||m===o.CLOSE||e&&(m===o.TAG_OPEN||w&&(m===o.TAG_CLOSE||m===o.TAG_CLOSING))||!i&&m===o.SEP||!l&&d.test(m)||p&&m===o.SUB_VAR)break;if(m===o.ESCAPE){let x=_[++n.i];if(x===o.ESCAPE)C+=x,n.i++;else if(x===o.OPEN||x===o.CLOSE||e&&(x===o.TAG_OPEN||w&&(x===o.TAG_CLOSE||x===o.TAG_CLOSING))||p&&x===o.SUB_VAR||!l||!i)for(C+=x;++n.i<a;)if(x=_[n.i],x===o.ESCAPE)if(x=_[n.i+1],x===o.ESCAPE)C+=x,n.i++;else{n.i++;break}else C+=x;else C+=m}else n.i++,C+=m}return C},v.parseTag=function(n,s){const i=n.msg,l=n.i,w=this.opts;n.i++;let _=i[n.i],o=!1;if(_===w.TAG_CLOSING){if(!s||!s.n)throw u(_,n.i);o=!0,n.i++,y(n)}const e=this.parseText(n,null,!1,!1,!0);if(!e)return i.slice(l,n.i);if(y(n),_=i[n.i],o){if(_!==w.TAG_CLOSE)throw f(w.TAG_CLOSE,_,n.i);if(e!==s.n)throw u("tag mismatch",l);return n.i++,U}if(o=!1,_===w.TAG_CLOSING&&(o=!0,n.i++,_=i[n.i]),_!==w.TAG_CLOSE)return i.slice(l,n.i);n.i++;const a={n:e};if(o)return a;const p=this.parseAST(n,a);if(p&&p.length&&(a.c=p),!a.closed&&n.i>=i.length)throw f("closing tag",n);return delete a.closed,a},v.parseElement=function(n,s){const i=n.msg,l=this.opts,w=s&&l[B].includes(s.t);let _=i[n.i];if(w&&_===l.SUB_VAR)return n.i++,{v:s.v,t:"number"};n.i++,y(n);const o=this.parseText(n,null,!1,!1);if(!o)throw f("placeholder id",_,n.i);const e={v:o};if(y(n),_=i[n.i],_===l.CLOSE)return n.i++,e;if(_!==l.SEP)throw f(`${l.SEP} or ${l.CLOSE}`,_,n.i);n.i++,y(n);const a=this.parseText(n,null,!1,!1);if(!a)throw f("type",n);if(e.t=a,y(n),_=i[n.i],_===l.CLOSE){if(l[R].includes(e.t))throw f("sub-messages",n);return n.i++,e}else if(_!==l.SEP)throw f(`${l.SEP} or ${l.CLOSE}`,_,n.i);if(n.i++,y(n),l[B].includes(e.t)){const p=this.parseOffset(n);p&&(e.f=p,y(n))}if(l[R].includes(e.t)){const p=this.parseSubmessages(n,e),C=l.requireOther;if((Array.isArray(C)?C.includes(e.t):C)&&!p.other)throw f("other sub-message",n);e.o=p}else{const p=this.parseText(n,null,!0,!0);if(!p)throw f("format",n);e.f=p.trimRight()}if(y(n),_=i[n.i],_!==l.CLOSE)throw f(l.CLOSE,_,n.i);return n.i++,e},v.parseSubmessages=function(n,s){const i=n.msg,l=i.length,w={};for(;n.i<l&&i[n.i]!==this.opts.CLOSE;){const o=this.parseText(n,null,!0,!1);if(!o)throw f("sub-message selector",n);y(n),w[o]=this.parseSubmessage(n,s),y(n)}return w},v.parseSubmessage=function(n,s){const i=n.msg,l=this.opts;if(i[n.i]!==l.OPEN)throw f(l.OPEN,n);n.i++;const w=this.parseAST(n,s);if(i[n.i]!==l.CLOSE)throw f(l.CLOSE,n);return n.i++,w},v.parseOffset=function(n){const s=n.msg,i=this.opts.OFFSET,l=s.length;if(s.slice(n.i,n.i+i.length)!==i)return;n.i+=i.length,y(n);const w=n.i;for(;n.i<l&&/[-\d]/.test(s[n.i]);)n.i++;if(w===n.i)throw f("number",n);return+s.slice(w,n.i)};function f(n,s,i){return typeof s=="object"&&(i=s.i,s=s.msg[i]),new SyntaxError(`expected ${n} at position ${i} but found ${s||"eof"}`)}G(f,"expected");function u(n,s){return new SyntaxError(`unexpected ${n} at position ${s}`)}G(u,"unexpected");function y(n){const s=n.msg,i=s.length;for(;n.i<i&&d.test(s[n.i]);)n.i++}G(y,"skipSpace");function S(n,s){const i=n.length-1;typeof s=="string"&&typeof n[i]=="string"?n[i]+=s:n.push(s)}G(S,"mergePush")},5926:(ae,J,d)=>{"use strict";d.d(J,{kZ:()=>x});var W=d(57845),B=d(23111),R=d(61378),I=d(52319);function U(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}G(U,"getHTMLElementScroll");function z(r){return r===(0,R.Z)(r)||!(0,I.Re)(r)?(0,B.Z)(r):U(r)}G(z,"getNodeScroll");var v=d(43332),f=d(61300),u=d(4377),y=d(10710),S=d(62079);function n(r){var c=r.getBoundingClientRect(),b=(0,S.NM)(c.width)/r.offsetWidth||1,k=(0,S.NM)(c.height)/r.offsetHeight||1;return b!==1||k!==1}G(n,"isElementScaled");function s(r,c,b){b===void 0&&(b=!1);var k=(0,I.Re)(c),h=(0,I.Re)(c)&&n(c),M=(0,u.Z)(c),L=(0,W.Z)(r,h,b),T={scrollLeft:0,scrollTop:0},O={x:0,y:0};return(k||!k&&!b)&&(((0,v.Z)(c)!=="body"||(0,y.Z)(M))&&(T=z(c)),(0,I.Re)(c)?(O=(0,W.Z)(c,!0),O.x+=c.clientLeft,O.y+=c.clientTop):M&&(O.x=(0,f.Z)(M))),{x:L.left+T.scrollLeft-O.x,y:L.top+T.scrollTop-O.y,width:L.width,height:L.height}}G(s,"getCompositeRect");var i=d(5618),l=d(26857),w=d(52839),_=d(49880);function o(r){var c=new Map,b=new Set,k=[];r.forEach(function(M){c.set(M.name,M)});function h(M){b.add(M.name);var L=[].concat(M.requires||[],M.requiresIfExists||[]);L.forEach(function(T){if(!b.has(T)){var O=c.get(T);O&&h(O)}}),k.push(M)}return G(h,"sort"),r.forEach(function(M){b.has(M.name)||h(M)}),k}G(o,"order");function e(r){var c=o(r);return _.xs.reduce(function(b,k){return b.concat(c.filter(function(h){return h.phase===k}))},[])}G(e,"orderModifiers");function a(r){var c;return function(){return c||(c=new Promise(function(b){Promise.resolve().then(function(){c=void 0,b(r())})})),c}}G(a,"debounce");function p(r){var c=r.reduce(function(b,k){var h=b[k.name];return b[k.name]=h?Object.assign({},h,k,{options:Object.assign({},h.options,k.options),data:Object.assign({},h.data,k.data)}):k,b},{});return Object.keys(c).map(function(b){return c[b]})}G(p,"mergeByName");var C={placement:"bottom",modifiers:[],strategy:"absolute"};function m(){for(var r=arguments.length,c=new Array(r),b=0;b<r;b++)c[b]=arguments[b];return!c.some(function(k){return!(k&&typeof k.getBoundingClientRect=="function")})}G(m,"areValidElements");function x(r){r===void 0&&(r={});var c=r,b=c.defaultModifiers,k=b===void 0?[]:b,h=c.defaultOptions,M=h===void 0?C:h;return G(function(T,O,P){P===void 0&&(P=M);var j={placement:"bottom",orderedModifiers:[],options:Object.assign({},C,M),modifiersData:{},elements:{reference:T,popper:O},attributes:{},styles:{}},Z=[],q=!1,X={state:j,setOptions:G(function(pe){var oe=typeof pe=="function"?pe(j.options):pe;te(),j.options=Object.assign({},M,j.options,oe),j.scrollParents={reference:(0,I.kK)(T)?(0,l.Z)(T):T.contextElement?(0,l.Z)(T.contextElement):[],popper:(0,l.Z)(O)};var de=e(p([].concat(k,j.options.modifiers)));return j.orderedModifiers=de.filter(function(me){return me.enabled}),ee(),X.update()},"setOptions"),forceUpdate:G(function(){if(!q){var pe=j.elements,oe=pe.reference,de=pe.popper;if(m(oe,de)){j.rects={reference:s(oe,(0,w.Z)(de),j.options.strategy==="fixed"),popper:(0,i.Z)(de)},j.reset=!1,j.placement=j.options.placement,j.orderedModifiers.forEach(function(re){return j.modifiersData[re.name]=Object.assign({},re.data)});for(var me=0;me<j.orderedModifiers.length;me++){if(j.reset===!0){j.reset=!1,me=-1;continue}var Ee=j.orderedModifiers[me],xe=Ee.fn,Te=Ee.options,Pe=Te===void 0?{}:Te,Se=Ee.name;typeof xe=="function"&&(j=xe({state:j,options:Pe,name:Se,instance:X})||j)}}}},"forceUpdate"),update:a(function(){return new Promise(function(ne){X.forceUpdate(),ne(j)})}),destroy:G(function(){te(),q=!0},"destroy")};if(!m(T,O))return X;X.setOptions(P).then(function(ne){!q&&P.onFirstUpdate&&P.onFirstUpdate(ne)});function ee(){j.orderedModifiers.forEach(function(ne){var pe=ne.name,oe=ne.options,de=oe===void 0?{}:oe,me=ne.effect;if(typeof me=="function"){var Ee=me({state:j,name:pe,instance:X,options:de}),xe=G(function(){},"noopFn2");Z.push(Ee||xe)}})}G(ee,"runModifierEffects");function te(){Z.forEach(function(ne){return ne()}),Z=[]}return G(te,"cleanupModifierEffects"),X},"createPopper2")}G(x,"popperGenerator");var $=null},75865:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>B});var W=d(52319);function B(R,I){var U=I.getRootNode&&I.getRootNode();if(R.contains(I))return!0;if(U&&(0,W.Zq)(U)){var z=I;do{if(z&&R.isSameNode(z))return!0;z=z.parentNode||z.host}while(z)}return!1}G(B,"contains")},57845:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>U});var W=d(52319),B=d(62079),R=d(61378),I=d(16182);function U(z,v,f){v===void 0&&(v=!1),f===void 0&&(f=!1);var u=z.getBoundingClientRect(),y=1,S=1;v&&(0,W.Re)(z)&&(y=z.offsetWidth>0&&(0,B.NM)(u.width)/z.offsetWidth||1,S=z.offsetHeight>0&&(0,B.NM)(u.height)/z.offsetHeight||1);var n=(0,W.kK)(z)?(0,R.Z)(z):window,s=n.visualViewport,i=!(0,I.Z)()&&f,l=(u.left+(i&&s?s.offsetLeft:0))/y,w=(u.top+(i&&s?s.offsetTop:0))/S,_=u.width/y,o=u.height/S;return{width:_,height:o,top:w,right:l+_,bottom:w+o,left:l,x:l,y:w}}G(U,"getBoundingClientRect")},26302:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>B});var W=d(61378);function B(R){return(0,W.Z)(R).getComputedStyle(R)}G(B,"getComputedStyle2")},4377:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>B});var W=d(52319);function B(R){return(((0,W.kK)(R)?R.ownerDocument:R.document)||window.document).documentElement}G(B,"getDocumentElement")},5618:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>B});var W=d(57845);function B(R){var I=(0,W.Z)(R),U=R.offsetWidth,z=R.offsetHeight;return Math.abs(I.width-U)<=1&&(U=I.width),Math.abs(I.height-z)<=1&&(z=I.height),{x:R.offsetLeft,y:R.offsetTop,width:U,height:z}}G(B,"getLayoutRect")},43332:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(B){return B?(B.nodeName||"").toLowerCase():null}G(W,"getNodeName")},52839:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>y});var W=d(61378),B=d(43332),R=d(26302),I=d(52319);function U(S){return["table","td","th"].indexOf((0,B.Z)(S))>=0}G(U,"isTableElement");var z=d(85564),v=d(3518);function f(S){return!(0,I.Re)(S)||(0,R.Z)(S).position==="fixed"?null:S.offsetParent}G(f,"getTrueOffsetParent");function u(S){var n=/firefox/i.test((0,v.Z)()),s=/Trident/i.test((0,v.Z)());if(s&&(0,I.Re)(S)){var i=(0,R.Z)(S);if(i.position==="fixed")return null}var l=(0,z.Z)(S);for((0,I.Zq)(l)&&(l=l.host);(0,I.Re)(l)&&["html","body"].indexOf((0,B.Z)(l))<0;){var w=(0,R.Z)(l);if(w.transform!=="none"||w.perspective!=="none"||w.contain==="paint"||["transform","perspective"].indexOf(w.willChange)!==-1||n&&w.willChange==="filter"||n&&w.filter&&w.filter!=="none")return l;l=l.parentNode}return null}G(u,"getContainingBlock");function y(S){for(var n=(0,W.Z)(S),s=f(S);s&&U(s)&&(0,R.Z)(s).position==="static";)s=f(s);return s&&((0,B.Z)(s)==="html"||(0,B.Z)(s)==="body"&&(0,R.Z)(s).position==="static")?n:s||u(S)||n}G(y,"getOffsetParent")},85564:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>I});var W=d(43332),B=d(4377),R=d(52319);function I(U){return(0,W.Z)(U)==="html"?U:U.assignedSlot||U.parentNode||((0,R.Zq)(U)?U.host:null)||(0,B.Z)(U)}G(I,"getParentNode")},61378:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(B){if(B==null)return window;if(B.toString()!=="[object Window]"){var R=B.ownerDocument;return R&&R.defaultView||window}return B}G(W,"getWindow")},23111:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>B});var W=d(61378);function B(R){var I=(0,W.Z)(R),U=I.pageXOffset,z=I.pageYOffset;return{scrollLeft:U,scrollTop:z}}G(B,"getWindowScroll")},61300:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>I});var W=d(57845),B=d(4377),R=d(23111);function I(U){return(0,W.Z)((0,B.Z)(U)).left+(0,R.Z)(U).scrollLeft}G(I,"getWindowScrollBarX")},52319:(ae,J,d)=>{"use strict";d.d(J,{Re:()=>R,Zq:()=>I,kK:()=>B});var W=d(61378);function B(U){var z=(0,W.Z)(U).Element;return U instanceof z||U instanceof Element}G(B,"isElement");function R(U){var z=(0,W.Z)(U).HTMLElement;return U instanceof z||U instanceof HTMLElement}G(R,"isHTMLElement");function I(U){if(typeof ShadowRoot>"u")return!1;var z=(0,W.Z)(U).ShadowRoot;return U instanceof z||U instanceof ShadowRoot}G(I,"isShadowRoot")},16182:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>B});var W=d(3518);function B(){return!/^((?!chrome|android).)*safari/i.test((0,W.Z)())}G(B,"isLayoutViewport")},10710:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>B});var W=d(26302);function B(R){var I=(0,W.Z)(R),U=I.overflow,z=I.overflowX,v=I.overflowY;return/auto|scroll|overlay|hidden/.test(U+v+z)}G(B,"isScrollParent")},26857:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>v});var W=d(85564),B=d(10710),R=d(43332),I=d(52319);function U(f){return["html","body","#document"].indexOf((0,R.Z)(f))>=0?f.ownerDocument.body:(0,I.Re)(f)&&(0,B.Z)(f)?f:U((0,W.Z)(f))}G(U,"getScrollParent");var z=d(61378);function v(f,u){var y;u===void 0&&(u=[]);var S=U(f),n=S===((y=f.ownerDocument)==null?void 0:y.body),s=(0,z.Z)(S),i=n?[s].concat(s.visualViewport||[],(0,B.Z)(S)?S:[]):S,l=u.concat(i);return n?l:l.concat(v((0,W.Z)(i)))}G(v,"listScrollParents")},49880:(ae,J,d)=>{"use strict";d.d(J,{BL:()=>v,Ct:()=>i,F2:()=>R,I:()=>B,Pj:()=>y,YP:()=>n,bw:()=>s,d7:()=>U,k5:()=>S,mv:()=>z,t$:()=>I,ut:()=>f,we:()=>W,xs:()=>x,zV:()=>u});var W="top",B="bottom",R="right",I="left",U="auto",z=[W,B,R,I],v="start",f="end",u="clippingParents",y="viewport",S="popper",n="reference",s=z.reduce(function($,r){return $.concat([r+"-"+v,r+"-"+f])},[]),i=[].concat(z,[U]).reduce(function($,r){return $.concat([r,r+"-"+v,r+"-"+f])},[]),l="beforeRead",w="read",_="afterRead",o="beforeMain",e="main",a="afterMain",p="beforeWrite",C="write",m="afterWrite",x=[l,w,_,o,e,a,p,C,m]},32898:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>U});var W=d(43332),B=d(52319);function R(z){var v=z.state;Object.keys(v.elements).forEach(function(f){var u=v.styles[f]||{},y=v.attributes[f]||{},S=v.elements[f];!(0,B.Re)(S)||!(0,W.Z)(S)||(Object.assign(S.style,u),Object.keys(y).forEach(function(n){var s=y[n];s===!1?S.removeAttribute(n):S.setAttribute(n,s===!0?"":s)}))})}G(R,"applyStyles");function I(z){var v=z.state,f={popper:{position:v.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(v.elements.popper.style,f.popper),v.styles=f,v.elements.arrow&&Object.assign(v.elements.arrow.style,f.arrow),function(){Object.keys(v.elements).forEach(function(u){var y=v.elements[u],S=v.attributes[u]||{},n=Object.keys(v.styles.hasOwnProperty(u)?v.styles[u]:f[u]),s=n.reduce(function(i,l){return i[l]="",i},{});!(0,B.Re)(y)||!(0,W.Z)(y)||(Object.assign(y.style,s),Object.keys(S).forEach(function(i){y.removeAttribute(i)}))})}}G(I,"effect");const U={name:"applyStyles",enabled:!0,phase:"write",fn:R,effect:I,requires:["computeStyles"]}},63454:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>s});var W=d(65352),B=d(5618),R=d(75865),I=d(52839),U=d(61919),z=d(72907),v=d(49534),f=d(62219),u=d(49880),y=G(function(l,w){return l=typeof l=="function"?l(Object.assign({},w.rects,{placement:w.placement})):l,(0,v.Z)(typeof l!="number"?l:(0,f.Z)(l,u.mv))},"toPaddingObject2");function S(i){var l,w=i.state,_=i.name,o=i.options,e=w.elements.arrow,a=w.modifiersData.popperOffsets,p=(0,W.Z)(w.placement),C=(0,U.Z)(p),m=[u.t$,u.F2].indexOf(p)>=0,x=m?"height":"width";if(!(!e||!a)){var $=y(o.padding,w),r=(0,B.Z)(e),c=C==="y"?u.we:u.t$,b=C==="y"?u.I:u.F2,k=w.rects.reference[x]+w.rects.reference[C]-a[C]-w.rects.popper[x],h=a[C]-w.rects.reference[C],M=(0,I.Z)(e),L=M?C==="y"?M.clientHeight||0:M.clientWidth||0:0,T=k/2-h/2,O=$[c],P=L-r[x]-$[b],j=L/2-r[x]/2+T,Z=(0,z.u)(O,j,P),q=C;w.modifiersData[_]=(l={},l[q]=Z,l.centerOffset=Z-j,l)}}G(S,"arrow");function n(i){var l=i.state,w=i.options,_=w.element,o=_===void 0?"[data-popper-arrow]":_;o!=null&&(typeof o=="string"&&(o=l.elements.popper.querySelector(o),!o)||(0,R.Z)(l.elements.popper,o)&&(l.elements.arrow=o))}G(n,"effect");const s={name:"arrow",enabled:!0,phase:"main",fn:S,effect:n,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]}},24502:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>s});var W=d(49880),B=d(52839),R=d(61378),I=d(4377),U=d(26302),z=d(65352),v=d(47408),f=d(62079),u={top:"auto",right:"auto",bottom:"auto",left:"auto"};function y(i,l){var w=i.x,_=i.y,o=l.devicePixelRatio||1;return{x:(0,f.NM)(w*o)/o||0,y:(0,f.NM)(_*o)/o||0}}G(y,"roundOffsetsByDPR");function S(i){var l,w=i.popper,_=i.popperRect,o=i.placement,e=i.variation,a=i.offsets,p=i.position,C=i.gpuAcceleration,m=i.adaptive,x=i.roundOffsets,$=i.isFixed,r=a.x,c=r===void 0?0:r,b=a.y,k=b===void 0?0:b,h=typeof x=="function"?x({x:c,y:k}):{x:c,y:k};c=h.x,k=h.y;var M=a.hasOwnProperty("x"),L=a.hasOwnProperty("y"),T=W.t$,O=W.we,P=window;if(m){var j=(0,B.Z)(w),Z="clientHeight",q="clientWidth";if(j===(0,R.Z)(w)&&(j=(0,I.Z)(w),(0,U.Z)(j).position!=="static"&&p==="absolute"&&(Z="scrollHeight",q="scrollWidth")),j=j,o===W.we||(o===W.t$||o===W.F2)&&e===W.ut){O=W.I;var X=$&&j===P&&P.visualViewport?P.visualViewport.height:j[Z];k-=X-_.height,k*=C?1:-1}if(o===W.t$||(o===W.we||o===W.I)&&e===W.ut){T=W.F2;var ee=$&&j===P&&P.visualViewport?P.visualViewport.width:j[q];c-=ee-_.width,c*=C?1:-1}}var te=Object.assign({position:p},m&&u),ne=x===!0?y({x:c,y:k},(0,R.Z)(w)):{x:c,y:k};if(c=ne.x,k=ne.y,C){var pe;return Object.assign({},te,(pe={},pe[O]=L?"0":"",pe[T]=M?"0":"",pe.transform=(P.devicePixelRatio||1)<=1?"translate("+c+"px, "+k+"px)":"translate3d("+c+"px, "+k+"px, 0)",pe))}return Object.assign({},te,(l={},l[O]=L?k+"px":"",l[T]=M?c+"px":"",l.transform="",l))}G(S,"mapToStyles");function n(i){var l=i.state,w=i.options,_=w.gpuAcceleration,o=_===void 0?!0:_,e=w.adaptive,a=e===void 0?!0:e,p=w.roundOffsets,C=p===void 0?!0:p,m={placement:(0,z.Z)(l.placement),variation:(0,v.Z)(l.placement),popper:l.elements.popper,popperRect:l.rects.popper,gpuAcceleration:o,isFixed:l.options.strategy==="fixed"};l.modifiersData.popperOffsets!=null&&(l.styles.popper=Object.assign({},l.styles.popper,S(Object.assign({},m,{offsets:l.modifiersData.popperOffsets,position:l.options.strategy,adaptive:a,roundOffsets:C})))),l.modifiersData.arrow!=null&&(l.styles.arrow=Object.assign({},l.styles.arrow,S(Object.assign({},m,{offsets:l.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:C})))),l.attributes.popper=Object.assign({},l.attributes.popper,{"data-popper-placement":l.placement})}G(n,"computeStyles");const s={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:n,data:{}}},72582:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>I});var W=d(61378),B={passive:!0};function R(U){var z=U.state,v=U.instance,f=U.options,u=f.scroll,y=u===void 0?!0:u,S=f.resize,n=S===void 0?!0:S,s=(0,W.Z)(z.elements.popper),i=[].concat(z.scrollParents.reference,z.scrollParents.popper);return y&&i.forEach(function(l){l.addEventListener("scroll",v.update,B)}),n&&s.addEventListener("resize",v.update,B),function(){y&&i.forEach(function(l){l.removeEventListener("scroll",v.update,B)}),n&&s.removeEventListener("resize",v.update,B)}}G(R,"effect");const I={name:"eventListeners",enabled:!0,phase:"write",fn:G(function(){},"fn"),effect:R,data:{}}},16087:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>n});var W={left:"right",right:"left",bottom:"top",top:"bottom"};function B(s){return s.replace(/left|right|bottom|top/g,function(i){return W[i]})}G(B,"getOppositePlacement");var R=d(65352),I={start:"end",end:"start"};function U(s){return s.replace(/start|end/g,function(i){return I[i]})}G(U,"getOppositeVariationPlacement");var z=d(24041),v=d(47408),f=d(49880);function u(s,i){i===void 0&&(i={});var l=i,w=l.placement,_=l.boundary,o=l.rootBoundary,e=l.padding,a=l.flipVariations,p=l.allowedAutoPlacements,C=p===void 0?f.Ct:p,m=(0,v.Z)(w),x=m?a?f.bw:f.bw.filter(function(c){return(0,v.Z)(c)===m}):f.mv,$=x.filter(function(c){return C.indexOf(c)>=0});$.length===0&&($=x);var r=$.reduce(function(c,b){return c[b]=(0,z.Z)(s,{placement:b,boundary:_,rootBoundary:o,padding:e})[(0,R.Z)(b)],c},{});return Object.keys(r).sort(function(c,b){return r[c]-r[b]})}G(u,"computeAutoPlacement");function y(s){if((0,R.Z)(s)===f.d7)return[];var i=B(s);return[U(s),i,U(i)]}G(y,"getExpandedFallbackPlacements");function S(s){var i=s.state,l=s.options,w=s.name;if(!i.modifiersData[w]._skip){for(var _=l.mainAxis,o=_===void 0?!0:_,e=l.altAxis,a=e===void 0?!0:e,p=l.fallbackPlacements,C=l.padding,m=l.boundary,x=l.rootBoundary,$=l.altBoundary,r=l.flipVariations,c=r===void 0?!0:r,b=l.allowedAutoPlacements,k=i.options.placement,h=(0,R.Z)(k),M=h===k,L=p||(M||!c?[B(k)]:y(k)),T=[k].concat(L).reduce(function(ie,fe){return ie.concat((0,R.Z)(fe)===f.d7?u(i,{placement:fe,boundary:m,rootBoundary:x,padding:C,flipVariations:c,allowedAutoPlacements:b}):fe)},[]),O=i.rects.reference,P=i.rects.popper,j=new Map,Z=!0,q=T[0],X=0;X<T.length;X++){var ee=T[X],te=(0,R.Z)(ee),ne=(0,v.Z)(ee)===f.BL,pe=[f.we,f.I].indexOf(te)>=0,oe=pe?"width":"height",de=(0,z.Z)(i,{placement:ee,boundary:m,rootBoundary:x,altBoundary:$,padding:C}),me=pe?ne?f.F2:f.t$:ne?f.I:f.we;O[oe]>P[oe]&&(me=B(me));var Ee=B(me),xe=[];if(o&&xe.push(de[te]<=0),a&&xe.push(de[me]<=0,de[Ee]<=0),xe.every(function(ie){return ie})){q=ee,Z=!1;break}j.set(ee,xe)}if(Z)for(var Te=c?3:1,Pe=G(function(fe){var ge=T.find(function(ve){var ke=j.get(ve);if(ke)return ke.slice(0,fe).every(function(De){return De})});if(ge)return q=ge,"break"},"_loop2"),Se=Te;Se>0;Se--){var re=Pe(Se);if(re==="break")break}i.placement!==q&&(i.modifiersData[w]._skip=!0,i.placement=q,i.reset=!0)}}G(S,"flip");const n={name:"flip",enabled:!0,phase:"main",fn:S,requiresIfExists:["offset"],data:{_skip:!1}}},48051:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>z});var W=d(49880),B=d(24041);function R(v,f,u){return u===void 0&&(u={x:0,y:0}),{top:v.top-f.height-u.y,right:v.right-f.width+u.x,bottom:v.bottom-f.height+u.y,left:v.left-f.width-u.x}}G(R,"getSideOffsets");function I(v){return[W.we,W.F2,W.I,W.t$].some(function(f){return v[f]>=0})}G(I,"isAnySideFullyClipped");function U(v){var f=v.state,u=v.name,y=f.rects.reference,S=f.rects.popper,n=f.modifiersData.preventOverflow,s=(0,B.Z)(f,{elementContext:"reference"}),i=(0,B.Z)(f,{altBoundary:!0}),l=R(s,y),w=R(i,S,n),_=I(l),o=I(w);f.modifiersData[u]={referenceClippingOffsets:l,popperEscapeOffsets:w,isReferenceHidden:_,hasPopperEscaped:o},f.attributes.popper=Object.assign({},f.attributes.popper,{"data-popper-reference-hidden":_,"data-popper-escaped":o})}G(U,"hide");const z={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:U}},61150:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>U});var W=d(65352),B=d(49880);function R(z,v,f){var u=(0,W.Z)(z),y=[B.t$,B.we].indexOf(u)>=0?-1:1,S=typeof f=="function"?f(Object.assign({},v,{placement:z})):f,n=S[0],s=S[1];return n=n||0,s=(s||0)*y,[B.t$,B.F2].indexOf(u)>=0?{x:s,y:n}:{x:n,y:s}}G(R,"distanceAndSkiddingToXY");function I(z){var v=z.state,f=z.options,u=z.name,y=f.offset,S=y===void 0?[0,0]:y,n=B.Ct.reduce(function(w,_){return w[_]=R(_,v.rects,S),w},{}),s=n[v.placement],i=s.x,l=s.y;v.modifiersData.popperOffsets!=null&&(v.modifiersData.popperOffsets.x+=i,v.modifiersData.popperOffsets.y+=l),v.modifiersData[u]=n}G(I,"offset");const U={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:I}},35772:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>R});var W=d(47840);function B(I){var U=I.state,z=I.name;U.modifiersData[z]=(0,W.Z)({reference:U.rects.reference,element:U.rects.popper,strategy:"absolute",placement:U.placement})}G(B,"popperOffsets");const R={name:"popperOffsets",enabled:!0,phase:"read",fn:B,data:{}}},29228:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>s});var W=d(49880),B=d(65352),R=d(61919);function I(i){return i==="x"?"y":"x"}G(I,"getAltAxis");var U=d(72907),z=d(5618),v=d(52839),f=d(24041),u=d(47408),y=d(29852),S=d(62079);function n(i){var l=i.state,w=i.options,_=i.name,o=w.mainAxis,e=o===void 0?!0:o,a=w.altAxis,p=a===void 0?!1:a,C=w.boundary,m=w.rootBoundary,x=w.altBoundary,$=w.padding,r=w.tether,c=r===void 0?!0:r,b=w.tetherOffset,k=b===void 0?0:b,h=(0,f.Z)(l,{boundary:C,rootBoundary:m,padding:$,altBoundary:x}),M=(0,B.Z)(l.placement),L=(0,u.Z)(l.placement),T=!L,O=(0,R.Z)(M),P=I(O),j=l.modifiersData.popperOffsets,Z=l.rects.reference,q=l.rects.popper,X=typeof k=="function"?k(Object.assign({},l.rects,{placement:l.placement})):k,ee=typeof X=="number"?{mainAxis:X,altAxis:X}:Object.assign({mainAxis:0,altAxis:0},X),te=l.modifiersData.offset?l.modifiersData.offset[l.placement]:null,ne={x:0,y:0};if(j){if(e){var pe,oe=O==="y"?W.we:W.t$,de=O==="y"?W.I:W.F2,me=O==="y"?"height":"width",Ee=j[O],xe=Ee+h[oe],Te=Ee-h[de],Pe=c?-q[me]/2:0,Se=L===W.BL?Z[me]:q[me],re=L===W.BL?-q[me]:-Z[me],ie=l.elements.arrow,fe=c&&ie?(0,z.Z)(ie):{width:0,height:0},ge=l.modifiersData["arrow#persistent"]?l.modifiersData["arrow#persistent"].padding:(0,y.Z)(),ve=ge[oe],ke=ge[de],De=(0,U.u)(0,Z[me],fe[me]),Ie=T?Z[me]/2-Pe-De-ve-ee.mainAxis:Se-De-ve-ee.mainAxis,Xe=T?-Z[me]/2+Pe+De+ke+ee.mainAxis:re+De+ke+ee.mainAxis,ct=l.elements.arrow&&(0,v.Z)(l.elements.arrow),Oe=ct?O==="y"?ct.clientTop||0:ct.clientLeft||0:0,g=(pe=te?.[O])!=null?pe:0,D=Ee+Ie-g-Oe,K=Ee+Xe-g,H=(0,U.u)(c?(0,S.VV)(xe,D):xe,Ee,c?(0,S.Fp)(Te,K):Te);j[O]=H,ne[O]=H-Ee}if(p){var V,E=O==="x"?W.we:W.t$,F=O==="x"?W.I:W.F2,A=j[P],N=P==="y"?"height":"width",Y=A+h[E],se=A-h[F],ue=[W.we,W.t$].indexOf(M)!==-1,_e=(V=te?.[P])!=null?V:0,Q=ue?Y:A-Z[N]-q[N]-_e+ee.altAxis,le=ue?A+Z[N]+q[N]-_e-ee.altAxis:se,he=c&&ue?(0,U.q)(Q,A,le):(0,U.u)(c?Q:Y,A,c?le:se);j[P]=he,ne[P]=he-A}l.modifiersData[_]=ne}}G(n,"preventOverflow");const s={name:"preventOverflow",enabled:!0,phase:"main",fn:n,requiresIfExists:["offset"]}},78224:(ae,J,d)=>{"use strict";d.d(J,{fi:()=>n});var W=d(5926),B=d(72582),R=d(35772),I=d(24502),U=d(32898),z=d(61150),v=d(16087),f=d(29228),u=d(63454),y=d(48051),S=[B.Z,R.Z,I.Z,U.Z,z.Z,v.Z,f.Z,u.Z,y.Z],n=(0,W.kZ)({defaultModifiers:S})},47840:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>U});var W=d(65352),B=d(47408),R=d(61919),I=d(49880);function U(z){var v=z.reference,f=z.element,u=z.placement,y=u?(0,W.Z)(u):null,S=u?(0,B.Z)(u):null,n=v.x+v.width/2-f.width/2,s=v.y+v.height/2-f.height/2,i;switch(y){case I.we:i={x:n,y:v.y-f.height};break;case I.I:i={x:n,y:v.y+v.height};break;case I.F2:i={x:v.x+v.width,y:s};break;case I.t$:i={x:v.x-f.width,y:s};break;default:i={x:v.x,y:v.y}}var l=y?(0,R.Z)(y):null;if(l!=null){var w=l==="y"?"height":"width";switch(S){case I.BL:i[l]=i[l]-(v[w]/2-f[w]/2);break;case I.ut:i[l]=i[l]+(v[w]/2-f[w]/2);break;default:}}return i}G(U,"computeOffsets")},24041:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>r});var W=d(49880),B=d(61378),R=d(4377),I=d(61300),U=d(16182);function z(c,b){var k=(0,B.Z)(c),h=(0,R.Z)(c),M=k.visualViewport,L=h.clientWidth,T=h.clientHeight,O=0,P=0;if(M){L=M.width,T=M.height;var j=(0,U.Z)();(j||!j&&b==="fixed")&&(O=M.offsetLeft,P=M.offsetTop)}return{width:L,height:T,x:O+(0,I.Z)(c),y:P}}G(z,"getViewportRect");var v=d(26302),f=d(23111),u=d(62079);function y(c){var b,k=(0,R.Z)(c),h=(0,f.Z)(c),M=(b=c.ownerDocument)==null?void 0:b.body,L=(0,u.Fp)(k.scrollWidth,k.clientWidth,M?M.scrollWidth:0,M?M.clientWidth:0),T=(0,u.Fp)(k.scrollHeight,k.clientHeight,M?M.scrollHeight:0,M?M.clientHeight:0),O=-h.scrollLeft+(0,I.Z)(c),P=-h.scrollTop;return(0,v.Z)(M||k).direction==="rtl"&&(O+=(0,u.Fp)(k.clientWidth,M?M.clientWidth:0)-L),{width:L,height:T,x:O,y:P}}G(y,"getDocumentRect");var S=d(26857),n=d(52839),s=d(52319),i=d(57845),l=d(85564),w=d(75865),_=d(43332);function o(c){return Object.assign({},c,{left:c.x,top:c.y,right:c.x+c.width,bottom:c.y+c.height})}G(o,"rectToClientRect");function e(c,b){var k=(0,i.Z)(c,!1,b==="fixed");return k.top=k.top+c.clientTop,k.left=k.left+c.clientLeft,k.bottom=k.top+c.clientHeight,k.right=k.left+c.clientWidth,k.width=c.clientWidth,k.height=c.clientHeight,k.x=k.left,k.y=k.top,k}G(e,"getInnerBoundingClientRect");function a(c,b,k){return b===W.Pj?o(z(c,k)):(0,s.kK)(b)?e(b,k):o(y((0,R.Z)(c)))}G(a,"getClientRectFromMixedType");function p(c){var b=(0,S.Z)((0,l.Z)(c)),k=["absolute","fixed"].indexOf((0,v.Z)(c).position)>=0,h=k&&(0,s.Re)(c)?(0,n.Z)(c):c;return(0,s.kK)(h)?b.filter(function(M){return(0,s.kK)(M)&&(0,w.Z)(M,h)&&(0,_.Z)(M)!=="body"}):[]}G(p,"getClippingParents");function C(c,b,k,h){var M=b==="clippingParents"?p(c):[].concat(b),L=[].concat(M,[k]),T=L[0],O=L.reduce(function(P,j){var Z=a(c,j,h);return P.top=(0,u.Fp)(Z.top,P.top),P.right=(0,u.VV)(Z.right,P.right),P.bottom=(0,u.VV)(Z.bottom,P.bottom),P.left=(0,u.Fp)(Z.left,P.left),P},a(c,T,h));return O.width=O.right-O.left,O.height=O.bottom-O.top,O.x=O.left,O.y=O.top,O}G(C,"getClippingRect");var m=d(47840),x=d(49534),$=d(62219);function r(c,b){b===void 0&&(b={});var k=b,h=k.placement,M=h===void 0?c.placement:h,L=k.strategy,T=L===void 0?c.strategy:L,O=k.boundary,P=O===void 0?W.zV:O,j=k.rootBoundary,Z=j===void 0?W.Pj:j,q=k.elementContext,X=q===void 0?W.k5:q,ee=k.altBoundary,te=ee===void 0?!1:ee,ne=k.padding,pe=ne===void 0?0:ne,oe=(0,x.Z)(typeof pe!="number"?pe:(0,$.Z)(pe,W.mv)),de=X===W.k5?W.YP:W.k5,me=c.rects.popper,Ee=c.elements[te?de:X],xe=C((0,s.kK)(Ee)?Ee:Ee.contextElement||(0,R.Z)(c.elements.popper),P,Z,T),Te=(0,i.Z)(c.elements.reference),Pe=(0,m.Z)({reference:Te,element:me,strategy:"absolute",placement:M}),Se=o(Object.assign({},me,Pe)),re=X===W.k5?Se:Te,ie={top:xe.top-re.top+oe.top,bottom:re.bottom-xe.bottom+oe.bottom,left:xe.left-re.left+oe.left,right:re.right-xe.right+oe.right},fe=c.modifiersData.offset;if(X===W.k5&&fe){var ge=fe[M];Object.keys(ie).forEach(function(ve){var ke=[W.F2,W.I].indexOf(ve)>=0?1:-1,De=[W.we,W.I].indexOf(ve)>=0?"y":"x";ie[ve]+=ge[De]*ke})}return ie}G(r,"detectOverflow")},62219:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(B,R){return R.reduce(function(I,U){return I[U]=B,I},{})}G(W,"expandToHashMap")},65352:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(B){return B.split("-")[0]}G(W,"getBasePlacement")},29852:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(){return{top:0,right:0,bottom:0,left:0}}G(W,"getFreshSideObject")},61919:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(B){return["top","bottom"].indexOf(B)>=0?"x":"y"}G(W,"getMainAxisFromPlacement")},47408:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(B){return B.split("-")[1]}G(W,"getVariation")},62079:(ae,J,d)=>{"use strict";d.d(J,{Fp:()=>W,NM:()=>R,VV:()=>B});var W=Math.max,B=Math.min,R=Math.round},49534:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>B});var W=d(29852);function B(R){return Object.assign({},(0,W.Z)(),R)}G(B,"mergePaddingObject")},3518:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(){var B=navigator.userAgentData;return B!=null&&B.brands&&Array.isArray(B.brands)?B.brands.map(function(R){return R.brand+"/"+R.version}).join(" "):navigator.userAgent}G(W,"getUAString")},72907:(ae,J,d)=>{"use strict";d.d(J,{q:()=>R,u:()=>B});var W=d(62079);function B(I,U,z){return(0,W.Fp)(I,(0,W.VV)(U,z))}G(B,"within");function R(I,U,z){var v=B(I,U,z);return v>z?z:v}G(R,"withinMaxClamp")},41182:function(ae,J,d){(function(W,B){ae.exports=J=B()})(this,function(){var W=W||function(B,R){var I;if(typeof window<"u"&&window.crypto&&(I=window.crypto),typeof self<"u"&&self.crypto&&(I=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(I=globalThis.crypto),!I&&typeof window<"u"&&window.msCrypto&&(I=window.msCrypto),!I&&typeof global<"u"&&global.crypto&&(I=global.crypto),!I)try{I=d(91054)}catch{}var U=G(function(){if(I){if(typeof I.getRandomValues=="function")try{return I.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof I.randomBytes=="function")try{return I.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},"cryptoSecureRandomInt"),z=Object.create||function(){function o(){}return G(o,"F"),function(e){var a;return o.prototype=e,a=new o,o.prototype=null,a}}(),v={},f=v.lib={},u=f.Base=function(){return{extend:function(o){var e=z(this);return o&&e.mixIn(o),(!e.hasOwnProperty("init")||this.init===e.init)&&(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var o=this.extend();return o.init.apply(o,arguments),o},init:function(){},mixIn:function(o){for(var e in o)o.hasOwnProperty(e)&&(this[e]=o[e]);o.hasOwnProperty("toString")&&(this.toString=o.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),y=f.WordArray=u.extend({init:function(o,e){o=this.words=o||[],e!=R?this.sigBytes=e:this.sigBytes=o.length*4},toString:function(o){return(o||n).stringify(this)},concat:function(o){var e=this.words,a=o.words,p=this.sigBytes,C=o.sigBytes;if(this.clamp(),p%4)for(var m=0;m<C;m++){var x=a[m>>>2]>>>24-m%4*8&255;e[p+m>>>2]|=x<<24-(p+m)%4*8}else for(var $=0;$<C;$+=4)e[p+$>>>2]=a[$>>>2];return this.sigBytes+=C,this},clamp:function(){var o=this.words,e=this.sigBytes;o[e>>>2]&=4294967295<<32-e%4*8,o.length=B.ceil(e/4)},clone:function(){var o=u.clone.call(this);return o.words=this.words.slice(0),o},random:function(o){for(var e=[],a=0;a<o;a+=4)e.push(U());return new y.init(e,o)}}),S=v.enc={},n=S.Hex={stringify:function(o){for(var e=o.words,a=o.sigBytes,p=[],C=0;C<a;C++){var m=e[C>>>2]>>>24-C%4*8&255;p.push((m>>>4).toString(16)),p.push((m&15).toString(16))}return p.join("")},parse:function(o){for(var e=o.length,a=[],p=0;p<e;p+=2)a[p>>>3]|=parseInt(o.substr(p,2),16)<<24-p%8*4;return new y.init(a,e/2)}},s=S.Latin1={stringify:function(o){for(var e=o.words,a=o.sigBytes,p=[],C=0;C<a;C++){var m=e[C>>>2]>>>24-C%4*8&255;p.push(String.fromCharCode(m))}return p.join("")},parse:function(o){for(var e=o.length,a=[],p=0;p<e;p++)a[p>>>2]|=(o.charCodeAt(p)&255)<<24-p%4*8;return new y.init(a,e)}},i=S.Utf8={stringify:function(o){try{return decodeURIComponent(escape(s.stringify(o)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(o){return s.parse(unescape(encodeURIComponent(o)))}},l=f.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new y.init,this._nDataBytes=0},_append:function(o){typeof o=="string"&&(o=i.parse(o)),this._data.concat(o),this._nDataBytes+=o.sigBytes},_process:function(o){var e,a=this._data,p=a.words,C=a.sigBytes,m=this.blockSize,x=m*4,$=C/x;o?$=B.ceil($):$=B.max(($|0)-this._minBufferSize,0);var r=$*m,c=B.min(r*4,C);if(r){for(var b=0;b<r;b+=m)this._doProcessBlock(p,b);e=p.splice(0,r),a.sigBytes-=c}return new y.init(e,c)},clone:function(){var o=u.clone.call(this);return o._data=this._data.clone(),o},_minBufferSize:0}),w=f.Hasher=l.extend({cfg:u.extend(),init:function(o){this.cfg=this.cfg.extend(o),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(o){return this._append(o),this._process(),this},finalize:function(o){o&&this._append(o);var e=this._doFinalize();return e},blockSize:512/32,_createHelper:function(o){return function(e,a){return new o.init(a).finalize(e)}},_createHmacHelper:function(o){return function(e,a){return new _.HMAC.init(o,a).finalize(e)}}}),_=v.algo={};return v}(Math);return W})},99968:function(ae,J,d){(function(W,B){ae.exports=J=B(d(41182))})(this,function(W){return function(){var B=W,R=B.lib,I=R.WordArray,U=R.Hasher,z=B.algo,v=[],f=z.SHA1=U.extend({_doReset:function(){this._hash=new I.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(u,y){for(var S=this._hash.words,n=S[0],s=S[1],i=S[2],l=S[3],w=S[4],_=0;_<80;_++){if(_<16)v[_]=u[y+_]|0;else{var o=v[_-3]^v[_-8]^v[_-14]^v[_-16];v[_]=o<<1|o>>>31}var e=(n<<5|n>>>27)+w+v[_];_<20?e+=(s&i|~s&l)+1518500249:_<40?e+=(s^i^l)+1859775393:_<60?e+=(s&i|s&l|i&l)-1894007588:e+=(s^i^l)-899497514,w=l,l=i,i=s<<30|s>>>2,s=n,n=e}S[0]=S[0]+n|0,S[1]=S[1]+s|0,S[2]=S[2]+i|0,S[3]=S[3]+l|0,S[4]=S[4]+w|0},_doFinalize:function(){var u=this._data,y=u.words,S=this._nDataBytes*8,n=u.sigBytes*8;return y[n>>>5]|=128<<24-n%32,y[(n+64>>>9<<4)+14]=Math.floor(S/4294967296),y[(n+64>>>9<<4)+15]=S,u.sigBytes=y.length*4,this._process(),this._hash},clone:function(){var u=U.clone.call(this);return u._hash=this._hash.clone(),u}});B.SHA1=U._createHelper(f),B.HmacSHA1=U._createHmacHelper(f)}(),W.SHA1})},51722:function(ae){(function(J,d){ae.exports=d()})(this,function(){"use strict";var J=1e3,d=6e4,W=36e5,B="millisecond",R="second",I="minute",U="hour",z="day",v="week",f="month",u="quarter",y="year",S="date",n="Invalid Date",s=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,i=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,l={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},w=G(function(r,c,b){var k=String(r);return!k||k.length>=c?r:""+Array(c+1-k.length).join(b)+r},"m"),_={s:w,z:function(r){var c=-r.utcOffset(),b=Math.abs(c),k=Math.floor(b/60),h=b%60;return(c<=0?"+":"-")+w(k,2,"0")+":"+w(h,2,"0")},m:G(function r(c,b){if(c.date()<b.date())return-r(b,c);var k=12*(b.year()-c.year())+(b.month()-c.month()),h=c.clone().add(k,f),M=b-h<0,L=c.clone().add(k+(M?-1:1),f);return+(-(k+(b-h)/(M?h-L:L-h))||0)},"t3"),a:function(r){return r<0?Math.ceil(r)||0:Math.floor(r)},p:function(r){return{M:f,y,w:v,d:z,D:S,h:U,m:I,s:R,ms:B,Q:u}[r]||String(r||"").toLowerCase().replace(/s$/,"")},u:function(r){return r===void 0}},o="en",e={};e[o]=l;var a=G(function(r){return r instanceof x},"p"),p=G(function(r,c,b){var k;if(!r)return o;if(typeof r=="string")e[r]&&(k=r),c&&(e[r]=c,k=r);else{var h=r.name;e[h]=r,k=h}return!b&&k&&(o=k),k||!b&&o},"S"),C=G(function(r,c){if(a(r))return r.clone();var b=typeof c=="object"?c:{};return b.date=r,b.args=arguments,new x(b)},"w"),m=_;m.l=p,m.i=a,m.w=function(r,c){return C(r,{locale:c.$L,utc:c.$u,x:c.$x,$offset:c.$offset})};var x=function(){function r(b){this.$L=p(b.locale,null,!0),this.parse(b)}G(r,"M2");var c=r.prototype;return c.parse=function(b){this.$d=function(k){var h=k.date,M=k.utc;if(h===null)return new Date(NaN);if(m.u(h))return new Date;if(h instanceof Date)return new Date(h);if(typeof h=="string"&&!/Z$/i.test(h)){var L=h.match(s);if(L){var T=L[2]-1||0,O=(L[7]||"0").substring(0,3);return M?new Date(Date.UTC(L[1],T,L[3]||1,L[4]||0,L[5]||0,L[6]||0,O)):new Date(L[1],T,L[3]||1,L[4]||0,L[5]||0,L[6]||0,O)}}return new Date(h)}(b),this.$x=b.x||{},this.init()},c.init=function(){var b=this.$d;this.$y=b.getFullYear(),this.$M=b.getMonth(),this.$D=b.getDate(),this.$W=b.getDay(),this.$H=b.getHours(),this.$m=b.getMinutes(),this.$s=b.getSeconds(),this.$ms=b.getMilliseconds()},c.$utils=function(){return m},c.isValid=function(){return this.$d.toString()!==n},c.isSame=function(b,k){var h=C(b);return this.startOf(k)<=h&&h<=this.endOf(k)},c.isAfter=function(b,k){return C(b)<this.startOf(k)},c.isBefore=function(b,k){return this.endOf(k)<C(b)},c.$g=function(b,k,h){return m.u(b)?this[k]:this.set(h,b)},c.unix=function(){return Math.floor(this.valueOf()/1e3)},c.valueOf=function(){return this.$d.getTime()},c.startOf=function(b,k){var h=this,M=!!m.u(k)||k,L=m.p(b),T=G(function(te,ne){var pe=m.w(h.$u?Date.UTC(h.$y,ne,te):new Date(h.$y,ne,te),h);return M?pe:pe.endOf(z)},"$2"),O=G(function(te,ne){return m.w(h.toDate()[te].apply(h.toDate("s"),(M?[0,0,0,0]:[23,59,59,999]).slice(ne)),h)},"l2"),P=this.$W,j=this.$M,Z=this.$D,q="set"+(this.$u?"UTC":"");switch(L){case y:return M?T(1,0):T(31,11);case f:return M?T(1,j):T(0,j+1);case v:var X=this.$locale().weekStart||0,ee=(P<X?P+7:P)-X;return T(M?Z-ee:Z+(6-ee),j);case z:case S:return O(q+"Hours",0);case U:return O(q+"Minutes",1);case I:return O(q+"Seconds",2);case R:return O(q+"Milliseconds",3);default:return this.clone()}},c.endOf=function(b){return this.startOf(b,!1)},c.$set=function(b,k){var h,M=m.p(b),L="set"+(this.$u?"UTC":""),T=(h={},h[z]=L+"Date",h[S]=L+"Date",h[f]=L+"Month",h[y]=L+"FullYear",h[U]=L+"Hours",h[I]=L+"Minutes",h[R]=L+"Seconds",h[B]=L+"Milliseconds",h)[M],O=M===z?this.$D+(k-this.$W):k;if(M===f||M===y){var P=this.clone().set(S,1);P.$d[T](O),P.init(),this.$d=P.set(S,Math.min(this.$D,P.daysInMonth())).$d}else T&&this.$d[T](O);return this.init(),this},c.set=function(b,k){return this.clone().$set(b,k)},c.get=function(b){return this[m.p(b)]()},c.add=function(b,k){var h,M=this;b=Number(b);var L=m.p(k),T=G(function(j){var Z=C(M);return m.w(Z.date(Z.date()+Math.round(j*b)),M)},"y2");if(L===f)return this.set(f,this.$M+b);if(L===y)return this.set(y,this.$y+b);if(L===z)return T(1);if(L===v)return T(7);var O=(h={},h[I]=d,h[U]=W,h[R]=J,h)[L]||1,P=this.$d.getTime()+b*O;return m.w(P,this)},c.subtract=function(b,k){return this.add(-1*b,k)},c.format=function(b){var k=this,h=this.$locale();if(!this.isValid())return h.invalidDate||n;var M=b||"YYYY-MM-DDTHH:mm:ssZ",L=m.z(this),T=this.$H,O=this.$m,P=this.$M,j=h.weekdays,Z=h.months,q=G(function(ne,pe,oe,de){return ne&&(ne[pe]||ne(k,M))||oe[pe].substr(0,de)},"h2"),X=G(function(ne){return m.s(T%12||12,ne,"0")},"c2"),ee=h.meridiem||function(ne,pe,oe){var de=ne<12?"AM":"PM";return oe?de.toLowerCase():de},te={YY:String(this.$y).slice(-2),YYYY:this.$y,M:P+1,MM:m.s(P+1,2,"0"),MMM:q(h.monthsShort,P,Z,3),MMMM:q(Z,P),D:this.$D,DD:m.s(this.$D,2,"0"),d:String(this.$W),dd:q(h.weekdaysMin,this.$W,j,2),ddd:q(h.weekdaysShort,this.$W,j,3),dddd:j[this.$W],H:String(T),HH:m.s(T,2,"0"),h:X(1),hh:X(2),a:ee(T,O,!0),A:ee(T,O,!1),m:String(O),mm:m.s(O,2,"0"),s:String(this.$s),ss:m.s(this.$s,2,"0"),SSS:m.s(this.$ms,3,"0"),Z:L};return M.replace(i,function(ne,pe){return pe||te[ne]||L.replace(":","")})},c.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},c.diff=function(b,k,h){var M,L=m.p(k),T=C(b),O=(T.utcOffset()-this.utcOffset())*d,P=this-T,j=m.m(this,T);return j=(M={},M[y]=j/12,M[f]=j,M[u]=j/3,M[v]=(P-O)/6048e5,M[z]=(P-O)/864e5,M[U]=P/W,M[I]=P/d,M[R]=P/J,M)[L]||P,h?j:m.a(j)},c.daysInMonth=function(){return this.endOf(f).$D},c.$locale=function(){return e[this.$L]},c.locale=function(b,k){if(!b)return this.$L;var h=this.clone(),M=p(b,k,!0);return M&&(h.$L=M),h},c.clone=function(){return m.w(this.$d,this)},c.toDate=function(){return new Date(this.valueOf())},c.toJSON=function(){return this.isValid()?this.toISOString():null},c.toISOString=function(){return this.$d.toISOString()},c.toString=function(){return this.$d.toUTCString()},r}(),$=x.prototype;return C.prototype=$,[["$ms",B],["$s",R],["$m",I],["$H",U],["$W",z],["$M",f],["$y",y],["$D",S]].forEach(function(r){$[r[1]]=function(c){return this.$g(c,r[0],r[1])}}),C.extend=function(r,c){return r.$i||(r(c,x,C),r.$i=!0),C},C.locale=p,C.isDayjs=a,C.unix=function(r){return C(1e3*r)},C.en=e[o],C.Ls=e,C.p={},C})},92045:function(ae){(function(J,d){ae.exports=d()})(this,function(){"use strict";return function(J,d,W){J=J||{};var B=d.prototype,R={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function I(z,v,f,u){return B.fromToBase(z,v,f,u)}G(I,"i"),W.en.relativeTime=R,B.fromToBase=function(z,v,f,u,y){for(var S,n,s,i=f.$locale().relativeTime||R,l=J.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],w=l.length,_=0;_<w;_+=1){var o=l[_];o.d&&(S=u?W(z).diff(f,o.d,!0):f.diff(z,o.d,!0));var e=(J.rounding||Math.round)(Math.abs(S));if(s=S>0,e<=o.r||!o.r){e<=1&&_>0&&(o=l[_-1]);var a=i[o.l];y&&(e=y(""+e)),n=typeof a=="string"?a.replace("%d",e):a(e,v,o.l,s);break}}if(v)return n;var p=s?i.future:i.past;return typeof p=="function"?p(n):p.replace("%s",n)},B.to=function(z,v){return I(z,v,this,!0)},B.from=function(z,v){return I(z,v,this)};var U=G(function(z){return z.$u?W.utc():W()},"d");B.toNow=function(z){return this.to(U(this),z)},B.fromNow=function(z){return this.from(U(this),z)}}})},5199:ae=>{"use strict";ae.exports=()=>/\u{1F3F4}\u{E0067}\u{E0062}(?:\u{E0077}\u{E006C}\u{E0073}|\u{E0073}\u{E0063}\u{E0074}|\u{E0065}\u{E006E}\u{E0067})\u{E007F}|(?:\u{1F9D1}\u{1F3FF}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FF}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}-\u{1F3FE}]|(?:\u{1F9D1}\u{1F3FE}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FE}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}-\u{1F3FD}\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FD}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FD}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}\u{1F3FC}\u{1F3FE}\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FC}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FC}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}\u{1F3FD}-\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FB}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FB}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FC}-\u{1F3FF}]|\u{1F468}(?:\u{1F3FB}(?:\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FF}]|\u{1F468}[\u{1F3FB}-\u{1F3FF}])|\u{1F91D}\u200D\u{1F468}[\u{1F3FC}-\u{1F3FF}]|[\u2695\u2696\u2708]\uFE0F|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]))?|[\u{1F3FC}-\u{1F3FF}]\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FF}]|\u{1F468}[\u{1F3FB}-\u{1F3FF}])|\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F468}|[\u{1F468}\u{1F469}]\u200D(?:\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}])|\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FE}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FE}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FD}\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FD}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}\u{1F3FC}\u{1F3FE}\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FC}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}\u{1F3FD}-\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])\uFE0F|\u200D(?:[\u{1F468}\u{1F469}]\u200D[\u{1F466}\u{1F467}]|[\u{1F466}\u{1F467}])|\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC})?|(?:\u{1F469}(?:\u{1F3FB}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}])|[\u{1F3FC}-\u{1F3FF}]\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}]))|\u{1F9D1}[\u{1F3FB}-\u{1F3FF}]\u200D\u{1F91D}\u200D\u{1F9D1})[\u{1F3FB}-\u{1F3FF}]|\u{1F469}\u200D\u{1F469}\u200D(?:\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}])|\u{1F469}(?:\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}])|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FE}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FD}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FC}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FB}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F9D1}(?:\u200D(?:\u{1F91D}\u200D\u{1F9D1}|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FE}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FD}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FC}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FB}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F469}\u200D\u{1F466}\u200D\u{1F466}|\u{1F469}\u200D\u{1F469}\u200D[\u{1F466}\u{1F467}]|\u{1F469}\u200D\u{1F467}\u200D[\u{1F466}\u{1F467}]|(?:\u{1F441}\uFE0F\u200D\u{1F5E8}|\u{1F9D1}(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u{1F3FB}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|\u{1F469}(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u{1F3FB}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|\u{1F636}\u200D\u{1F32B}|\u{1F3F3}\uFE0F\u200D\u26A7|\u{1F43B}\u200D\u2744|(?:[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}][\u{1F3FB}-\u{1F3FF}]|[\u{1F46F}\u{1F93C}\u{1F9DE}\u{1F9DF}])\u200D[\u2640\u2642]|[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}][\uFE0F\u{1F3FB}-\u{1F3FF}]\u200D[\u2640\u2642]|\u{1F3F4}\u200D\u2620|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}]\u200D[\u2640\u2642]|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u2600-\u2604\u260E\u2611\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26B0\u26B1\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0\u26F1\u26F4\u26F7\u26F8\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u3030\u303D\u3297\u3299\u{1F170}\u{1F171}\u{1F17E}\u{1F17F}\u{1F202}\u{1F237}\u{1F321}\u{1F324}-\u{1F32C}\u{1F336}\u{1F37D}\u{1F396}\u{1F397}\u{1F399}-\u{1F39B}\u{1F39E}\u{1F39F}\u{1F3CD}\u{1F3CE}\u{1F3D4}-\u{1F3DF}\u{1F3F5}\u{1F3F7}\u{1F43F}\u{1F4FD}\u{1F549}\u{1F54A}\u{1F56F}\u{1F570}\u{1F573}\u{1F576}-\u{1F579}\u{1F587}\u{1F58A}-\u{1F58D}\u{1F5A5}\u{1F5A8}\u{1F5B1}\u{1F5B2}\u{1F5BC}\u{1F5C2}-\u{1F5C4}\u{1F5D1}-\u{1F5D3}\u{1F5DC}-\u{1F5DE}\u{1F5E1}\u{1F5E3}\u{1F5E8}\u{1F5EF}\u{1F5F3}\u{1F5FA}\u{1F6CB}\u{1F6CD}-\u{1F6CF}\u{1F6E0}-\u{1F6E5}\u{1F6E9}\u{1F6F0}\u{1F6F3}])\uFE0F|\u{1F3F3}\uFE0F\u200D\u{1F308}|\u{1F469}\u200D\u{1F467}|\u{1F469}\u200D\u{1F466}|\u{1F635}\u200D\u{1F4AB}|\u{1F62E}\u200D\u{1F4A8}|\u{1F415}\u200D\u{1F9BA}|\u{1F9D1}(?:\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC}|\u{1F3FB})?|\u{1F469}(?:\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC}|\u{1F3FB})?|\u{1F1FD}\u{1F1F0}|\u{1F1F6}\u{1F1E6}|\u{1F1F4}\u{1F1F2}|\u{1F408}\u200D\u2B1B|\u2764\uFE0F\u200D[\u{1F525}\u{1FA79}]|\u{1F441}\uFE0F|\u{1F3F3}\uFE0F|\u{1F1FF}[\u{1F1E6}\u{1F1F2}\u{1F1FC}]|\u{1F1FE}[\u{1F1EA}\u{1F1F9}]|\u{1F1FC}[\u{1F1EB}\u{1F1F8}]|\u{1F1FB}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1EE}\u{1F1F3}\u{1F1FA}]|\u{1F1FA}[\u{1F1E6}\u{1F1EC}\u{1F1F2}\u{1F1F3}\u{1F1F8}\u{1F1FE}\u{1F1FF}]|\u{1F1F9}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1ED}\u{1F1EF}-\u{1F1F4}\u{1F1F7}\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FF}]|\u{1F1F8}[\u{1F1E6}-\u{1F1EA}\u{1F1EC}-\u{1F1F4}\u{1F1F7}-\u{1F1F9}\u{1F1FB}\u{1F1FD}-\u{1F1FF}]|\u{1F1F7}[\u{1F1EA}\u{1F1F4}\u{1F1F8}\u{1F1FA}\u{1F1FC}]|\u{1F1F5}[\u{1F1E6}\u{1F1EA}-\u{1F1ED}\u{1F1F0}-\u{1F1F3}\u{1F1F7}-\u{1F1F9}\u{1F1FC}\u{1F1FE}]|\u{1F1F3}[\u{1F1E6}\u{1F1E8}\u{1F1EA}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F4}\u{1F1F5}\u{1F1F7}\u{1F1FA}\u{1F1FF}]|\u{1F1F2}[\u{1F1E6}\u{1F1E8}-\u{1F1ED}\u{1F1F0}-\u{1F1FF}]|\u{1F1F1}[\u{1F1E6}-\u{1F1E8}\u{1F1EE}\u{1F1F0}\u{1F1F7}-\u{1F1FB}\u{1F1FE}]|\u{1F1F0}[\u{1F1EA}\u{1F1EC}-\u{1F1EE}\u{1F1F2}\u{1F1F3}\u{1F1F5}\u{1F1F7}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1EF}[\u{1F1EA}\u{1F1F2}\u{1F1F4}\u{1F1F5}]|\u{1F1EE}[\u{1F1E8}-\u{1F1EA}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}]|\u{1F1ED}[\u{1F1F0}\u{1F1F2}\u{1F1F3}\u{1F1F7}\u{1F1F9}\u{1F1FA}]|\u{1F1EC}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EE}\u{1F1F1}-\u{1F1F3}\u{1F1F5}-\u{1F1FA}\u{1F1FC}\u{1F1FE}]|\u{1F1EB}[\u{1F1EE}-\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1F7}]|\u{1F1EA}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1ED}\u{1F1F7}-\u{1F1FA}]|\u{1F1E9}[\u{1F1EA}\u{1F1EC}\u{1F1EF}\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1FF}]|\u{1F1E8}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1EE}\u{1F1F0}-\u{1F1F5}\u{1F1F7}\u{1F1FA}-\u{1F1FF}]|\u{1F1E7}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EF}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1E6}[\u{1F1E8}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F2}\u{1F1F4}\u{1F1F6}-\u{1F1FA}\u{1F1FC}\u{1F1FD}\u{1F1FF}]|[#\*0-9]\uFE0F\u20E3|\u2764\uFE0F|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}][\u{1F3FB}-\u{1F3FF}]|[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}][\uFE0F\u{1F3FB}-\u{1F3FF}]|\u{1F3F4}|[\u270A\u270B\u{1F385}\u{1F3C2}\u{1F3C7}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}\u{1F467}\u{1F46B}-\u{1F46D}\u{1F472}\u{1F474}-\u{1F476}\u{1F478}\u{1F47C}\u{1F483}\u{1F485}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F57A}\u{1F595}\u{1F596}\u{1F64C}\u{1F64F}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F930}-\u{1F934}\u{1F936}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9BB}\u{1F9D2}\u{1F9D3}\u{1F9D5}][\u{1F3FB}-\u{1F3FF}]|[\u261D\u270C\u270D\u{1F574}\u{1F590}][\uFE0F\u{1F3FB}-\u{1F3FF}]|[\u270A\u270B\u{1F385}\u{1F3C2}\u{1F3C7}\u{1F408}\u{1F415}\u{1F43B}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}\u{1F467}\u{1F46B}-\u{1F46D}\u{1F472}\u{1F474}-\u{1F476}\u{1F478}\u{1F47C}\u{1F483}\u{1F485}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F57A}\u{1F595}\u{1F596}\u{1F62E}\u{1F635}\u{1F636}\u{1F64C}\u{1F64F}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F930}-\u{1F934}\u{1F936}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9BB}\u{1F9D2}\u{1F9D3}\u{1F9D5}]|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}]|[\u{1F46F}\u{1F93C}\u{1F9DE}\u{1F9DF}]|[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55\u{1F004}\u{1F0CF}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F201}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F236}\u{1F238}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F320}\u{1F32D}-\u{1F335}\u{1F337}-\u{1F37C}\u{1F37E}-\u{1F384}\u{1F386}-\u{1F393}\u{1F3A0}-\u{1F3C1}\u{1F3C5}\u{1F3C6}\u{1F3C8}\u{1F3C9}\u{1F3CF}-\u{1F3D3}\u{1F3E0}-\u{1F3F0}\u{1F3F8}-\u{1F407}\u{1F409}-\u{1F414}\u{1F416}-\u{1F43A}\u{1F43C}-\u{1F43E}\u{1F440}\u{1F444}\u{1F445}\u{1F451}-\u{1F465}\u{1F46A}\u{1F479}-\u{1F47B}\u{1F47D}-\u{1F480}\u{1F484}\u{1F488}-\u{1F48E}\u{1F490}\u{1F492}-\u{1F4A9}\u{1F4AB}-\u{1F4FC}\u{1F4FF}-\u{1F53D}\u{1F54B}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F5A4}\u{1F5FB}-\u{1F62D}\u{1F62F}-\u{1F634}\u{1F637}-\u{1F644}\u{1F648}-\u{1F64A}\u{1F680}-\u{1F6A2}\u{1F6A4}-\u{1F6B3}\u{1F6B7}-\u{1F6BF}\u{1F6C1}-\u{1F6C5}\u{1F6D0}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6EB}\u{1F6EC}\u{1F6F4}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90D}\u{1F90E}\u{1F910}-\u{1F917}\u{1F91D}\u{1F920}-\u{1F925}\u{1F927}-\u{1F92F}\u{1F93A}\u{1F93F}-\u{1F945}\u{1F947}-\u{1F976}\u{1F978}\u{1F97A}-\u{1F9B4}\u{1F9B7}\u{1F9BA}\u{1F9BC}-\u{1F9CB}\u{1F9D0}\u{1F9E0}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]|[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55\u{1F004}\u{1F0CF}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F236}\u{1F238}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F320}\u{1F32D}-\u{1F335}\u{1F337}-\u{1F37C}\u{1F37E}-\u{1F393}\u{1F3A0}-\u{1F3CA}\u{1F3CF}-\u{1F3D3}\u{1F3E0}-\u{1F3F0}\u{1F3F4}\u{1F3F8}-\u{1F43E}\u{1F440}\u{1F442}-\u{1F4FC}\u{1F4FF}-\u{1F53D}\u{1F54B}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F57A}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5FB}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CC}\u{1F6D0}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6EB}\u{1F6EC}\u{1F6F4}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90C}-\u{1F93A}\u{1F93C}-\u{1F945}\u{1F947}-\u{1F978}\u{1F97A}-\u{1F9CB}\u{1F9CD}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]|[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299\u{1F004}\u{1F0CF}\u{1F170}\u{1F171}\u{1F17E}\u{1F17F}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F202}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F321}\u{1F324}-\u{1F393}\u{1F396}\u{1F397}\u{1F399}-\u{1F39B}\u{1F39E}-\u{1F3F0}\u{1F3F3}-\u{1F3F5}\u{1F3F7}-\u{1F4FD}\u{1F4FF}-\u{1F53D}\u{1F549}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F56F}\u{1F570}\u{1F573}-\u{1F57A}\u{1F587}\u{1F58A}-\u{1F58D}\u{1F590}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5A5}\u{1F5A8}\u{1F5B1}\u{1F5B2}\u{1F5BC}\u{1F5C2}-\u{1F5C4}\u{1F5D1}-\u{1F5D3}\u{1F5DC}-\u{1F5DE}\u{1F5E1}\u{1F5E3}\u{1F5E8}\u{1F5EF}\u{1F5F3}\u{1F5FA}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CB}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6E0}-\u{1F6E5}\u{1F6E9}\u{1F6EB}\u{1F6EC}\u{1F6F0}\u{1F6F3}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90C}-\u{1F93A}\u{1F93C}-\u{1F945}\u{1F947}-\u{1F978}\u{1F97A}-\u{1F9CB}\u{1F9CD}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]\uFE0F|[\u261D\u26F9\u270A-\u270D\u{1F385}\u{1F3C2}-\u{1F3C4}\u{1F3C7}\u{1F3CA}-\u{1F3CC}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}-\u{1F478}\u{1F47C}\u{1F481}-\u{1F483}\u{1F485}-\u{1F487}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F574}\u{1F575}\u{1F57A}\u{1F590}\u{1F595}\u{1F596}\u{1F645}-\u{1F647}\u{1F64B}-\u{1F64F}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91F}\u{1F926}\u{1F930}-\u{1F939}\u{1F93C}-\u{1F93E}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9B8}\u{1F9B9}\u{1F9BB}\u{1F9CD}-\u{1F9CF}\u{1F9D1}-\u{1F9DD}]/gu},67392:(ae,J,d)=>{"use strict";d.d(J,{Tr:()=>a,ZP:()=>l});var W=d(24431),B=d(46949),R=d(83269),I=d(22527),U=d(2356);const z=G((C,m)=>fetch(C,m).then(x=>x.ok?x.json():null).catch(()=>null),"fetchJSON"),v=/\s*at\s+(.+?)\s+\((.+)\)$/,f=/^(.+):\/\/(.+?)(?:\?[a-zA-Z0-9]+)?:(\d+:\d+)$/,u={filter(C){return C.includes(".frankerfacez.com")||C.includes("localhost")},cacheGlobally:!0},y=["/src/i18n.js","/src/utilities/vue.js"],S=["(\u30FB`\u03C9\xB4\u30FB)",";;w;;","owo","ono","oAo","oxo","ovo;","UwU",">w<","^w^","> w >","v.v"],n=G((C,m)=>C.map(x=>{if(typeof x=="string")return m(x);if(typeof x=="object"&&x.o){const $=Object.assign(x,{o:{}});for(const r of Object.keys(x.o))$.o[r]=n(x.o[r],m)}return x}),"transformText"),s=G(C=>C.replace(/(?:r|l)/g,"w").replace(/(?:R|L)/g,"W").replace(/n([aeiou])/g,"ny$1").replace(/N([aeiou])/g,"Ny$1").replace(/N([AEIOU])/g,"NY$1").replace(/ove/g,"uv").replace(/!+/g,` ${(0,B.pick_random)(S)} `),"owo"),i={double:(C,m)=>[...m," ",...m],upper:(C,m)=>n(m,x=>x.toUpperCase()),lower:(C,m)=>n(m,x=>x.toLowerCase()),append_key:(C,m)=>[...m,` (${C})`],set_key:C=>[C],owo:(C,m)=>n(m,s)},p=class p extends I.default{constructor(...m){super(...m),this.inject("settings"),this._seen=new Set,this.availableLocales=["en"],this.chunks=["client"],this.localeData={en:{name:"English"}},this.loadLocales(),this.strings_loaded=!1,this.new_strings=0,this.changed_strings=0,this.capturing=!1,this.captured=new Map,this.settings.addUI("i18n.debug.open",{path:"Debugging > Localization >> Editing",component:"i18n-open",force_seen:!0}),this.settings.add("i18n.debug.capture",{default:null,process(x,$){return $===null?W.DEBUG:$},ui:{path:"Debugging > Localization >> General",title:"Enable message capture.",description:"Capture all localized strings, including variables and call locations, for the purpose of reporting them to the backend. This is used to add new strings to the translation project. By default, message capture is enabled when running in development mode.",component:"setting-check-box",force_seen:!0},changed:x=>{this.capturing=x}}),this.settings.add("i18n.debug.transform",{default:null,ui:{path:"Debugging > Localization >> General",title:"Transformation",description:"Transform all localized strings to test string coverage as well as length.",component:"setting-select-box",data:[{value:null,title:"Disabled"},{value:"upper",title:"Upper Case"},{value:"lower",title:"Lower Case"},{value:"append_key",title:"Append Key"},{value:"set_key",title:"Set to Key"},{value:"double",title:"Double"},{value:"owo",title:"owo what's this"}]},changed:x=>{this._.transformation=i[x],this.emit(":transform"),this.emit(":update")}}),this.settings.add("i18n.locale",{default:-1,process:(x,$)=>{if(($===-1||typeof $!="string")&&($=x.get("context.session.languageCode")||"en"),this.availableLocales.includes($))return $;if($==="no"&&this.availableLocales.includes("nb"))return"nb";const r=$.indexOf("-");return r===-1?"en":($=$.slice(0,r),this.availableLocales.includes($)?$:"en")},ui:{path:'Appearance > Localization >> General @{"sort":-100}',title:"Language",description:"FrankerFaceZ is lovingly translated by volunteers from our community. Thank you. If you're interested in helping to translate FrankerFaceZ, please [join our Discord](https://discord.gg/UrAkGhT) and ask about localization.",component:"setting-select-box",data:(x,$)=>this.getLocaleOptions($)},changed:x=>this.locale=x}),this.settings.add("i18n.format.date",{default:"default",ui:{path:"Appearance > Localization >> Formatting",title:"Date Format",description:"The default date format. Custom date formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"date",component:"format-preview"},data:()=>{const x=[],$=new Date;for(const[r,c]of Object.entries(this._.formats.date))x.push({value:r,title:`${this.formatDate($,r)} (${r})`});return x}},changed:x=>{this._.defaultDateFormat=x,this.emit(":update")}}),this.settings.add("i18n.format.time",{default:"short",ui:{path:"Appearance > Localization >> Formatting",title:"Time Format",description:"The default time format. Custom time formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"time",component:"format-preview"},data:()=>{const x=[],$=new Date;for(const[r,c]of Object.entries(this._.formats.time))x.push({value:r,title:`${this.formatTime($,r)} (${r})`});return x}},changed:x=>{this._.defaultTimeFormat=x,this.emit(":update")}}),this.settings.add("i18n.format.datetime",{default:"medium",ui:{path:"Appearance > Localization >> Formatting",title:"Date-Time Format",description:"The default combined date-time format. Custom time formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"datetime",component:"format-preview"},data:()=>{const x=[],$=new Date;for(const[r,c]of Object.entries(this._.formats.datetime))x.push({value:r,title:`${this.formatDateTime($,r)} (${r})`});return x}},changed:x=>{this._.defaultDateTimeFormat=x,this.emit(":update")}})}getLocaleOptions(m){m===void 0&&(m=this.settings.get("i18n.locale"));const x=[],$=[];for(const c of this.availableLocales){const b=this.localeData[c];let k=b?.native_name||b?.name||c;b?.coverage!=null&&b?.coverage<100&&(k=this.t("i18n.locale-coverage","{name} ({coverage,number,percent} Complete)",{name:k,coverage:b.coverage/100}));const h={selected:m===c,value:c,title:k};b?.joke?$.push(h):x.push(h)}x.sort((c,b)=>c.title.localeCompare(b.title)),$.sort((c,b)=>c.title.localeCompare(b.title));let r=[{selected:m===-1,value:-1,i18n_key:"setting.appearance.localization.general.language.twitch",title:"Use Twitch's Language"}];return x.length&&(r.push({separator:!0,i18n_key:"setting.appearance.localization.general.language.languages",title:"Supported Languages"}),r=r.concat(x)),$.length&&(r.push({separator:!0,i18n_key:"setting.appearance.localization.general.language.joke",title:"Joke Languages"}),r=r.concat($)),r}onEnable(){this.capturing=this.settings.get("i18n.debug.capture"),this.capturing&&this.loadStrings(),this._=new U.default({warn:(...m)=>this.log.warn(...m),defaultDateFormat:this.settings.get("i18n.format.date"),defaultTimeFormat:this.settings.get("i18n.format.time"),defaultDateTimeFormat:this.settings.get("i18n.format.datetime")}),window.BroadcastChannel&&(this._broadcaster=new BroadcastChannel("ffz-i18n")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this)),this._.transformation=i[this.settings.get("i18n.debug.transform")],this.locale=this.settings.get("i18n.locale")}async loadChunk(m){if(this.chunks.includes(m))return[];this.chunks.push(m);const x=this._.locale,$=await this.loadLocale(x,m),r=this._.extend($);return r.length&&(this.log.info(`Loaded Chunk: ${m} -- Phrases: ${r.length}`),this.emit(":loaded",r),this.emit(":update")),r}broadcast(m){this._broadcaster&&this._broadcaster.postMessage(m)}getKeys(){const m=[];for(const x of this.captured.values()){const $=(0,B.deep_copy)(x);$.translation=this._.phrases.get($.key)||$.phrase,m.push($)}return m}requestKeys(){this.broadcast({type:"request-keys"})}updatePhrase(m,x){this.broadcast({type:"update-key",key:m,phrase:x}),this._.extend({[m]:x}),this.emit(":loaded",[m]),this.emit(":update")}handleMessage(m){const x=m.data;if(x){if(x.type==="update-key")this._.extend({[x.key]:x.phrase}),this.emit(":loaded",[x.key]),this.emit(":update");else if(x.type==="request-keys")this.broadcast({type:"keys",data:Array.from(this.captured.values())});else if(x.type==="keys"&&Array.isArray(x.data)){for(const $ of x.data)this.captured.set($.key,$);this.emit(":got-keys")}}}openUI(m=!0){this.capturing||(this.capturing=!0,this.emit(":update"));const x=this.resolve("translation_ui");m?x.openPopout():x.enable()}get dayjsLocale(){return this._?._dayjs_locale}get locale(){return this._&&this._.locale}set locale(m){this.setLocale(m)}async loadStrings(m=!1){if(this.strings_loaded&&!m||this.strings_loading)return;this.strings_loading=!0;const x=await fetch(`${W.SERVER}/script/locale/strings.json?_=${(0,R.getBuster)(30)}`);let $;x.ok?$=await x.json():(this.log.warn(`Error Loading Strings -- Status: ${x.status}`),$=[]);for(const r of $){const c=r.id;let b=this.captured.get(c);if(b||(this.captured.set(c,b={key:c,phrase:r.default,hits:0,calls:[]}),r.source?.length&&b.calls.push(r.source)),!b.options&&r.context?.length)try{b.options=JSON.parse(r.context)}catch{}b.known=r.default,b.different=r.default!==b.phrase}this.new_strings=0,this.changed_strings=0;for(const r of this.captured.values())r.known||this.new_strings++,r.different&&this.changed_strings++;this.strings_loaded=!0,this.strings_loading=!1,this.log.info(`Loaded ${$.length} strings from the server.`),this.emit(":strings-loaded"),this.emit(":new-strings",this.new_strings),this.emit(":changed-strings",this.changed_strings)}see(m,x,$){if(!this.capturing)return;let r;try{r=new Error().stack}catch(b){try{r=b.stack}catch{}}let c=this.captured.get(m);c||(this.captured.set(m,c={key:m,phrase:x,hits:0,calls:[]}),this.strings_loaded&&(this.new_strings++,this.emit(":new-strings",this.new_strings))),x!==c.phrase&&(c.phrase=x,c.known&&x!==c.known&&!c.different&&(c.different=!0,this.changed_strings++,this.emit(":changed-strings",this.changed_strings))),c.options=this.pluckVariables(m,$),c.hits++,r&&(this.mapStackTrace?this.mapStackTrace(r,b=>this.recordCall(c,b),u):Promise.all([d.e(7852),d.e(1871)]).then(d.t.bind(d,58194,23)).then(b=>{this.mapStackTrace=b.mapStackTrace,this.mapStackTrace(r,k=>this.recordCall(c,k),u)}))}pluckVariables(m,x){const $=this._.cache.get(m);if(!$)return null;const r={};return this._doPluck($,x,r),Object.keys(r).length?r:null}_doPluck(m,x,$){if(Array.isArray(m)){for(const r of m)this._doPluck(r,x,$);return}if(typeof m=="object"&&m.v){const r=(0,B.get)(m.v,x);if(r&&r.$$typeof)return;$[m.v]=(0,B.shallow_copy)(r)}}recordCall(m,x){if(Array.isArray(x))for(const $ of x){const r=v.exec($);if(!r)continue;const c=f.exec(r[2]);if(!c||c[1]!=="webpack")continue;const b=c[2];if(b.includes("/node_modules/")||y.includes(b))continue;let k;if(r[1]==="MainMenu.getSettingsTree")k="FFZ Control Center";else{let h=r[1];(h==="Proxy.render"||h.startsWith("Proxy.push"))&&c[2].includes(".vue")&&(h="Vue Component"),k=`${h} (${c[2]}:${c[3]})`}m.calls.includes(k)||m.calls.push(k);return}}async loadLocales(){const m=await fetch(`${W.SERVER}/script/locale/locales.json?_=${(0,R.getBuster)(30)}`);let x;m.ok?x=await m.json():this.log.warn(`Error Populating Locales -- Status: ${m.status}`),(!Array.isArray(x)||!x.length)&&(x=[{id:"en",name:"English",coverage:100,rtl:!1,hashes:{}}]),this.localeData={},this.availableLocales=[];for(const $ of x){const r=$.id.toLowerCase();this.localeData[r]=$,this.availableLocales.push(r)}this.emit(":locales-loaded")}async loadLocale(m,x=null){if(m=m.toLowerCase(),m==="en")return{};const $=this.localeData[m]?.hashes;if(!$)return this.log.info(`Cannot Load Locale: ${m}`),{};x?Array.isArray(x)||(x=[x]):x=this.chunks;const r=this.localeData[m].id,c=[];for(const M of x){const L=$[M];L&&c.push(z(`https://cdn2.frankerfacez.com/static/locale/${r}/${M}.${L}.json`))}const b=await Promise.all(c),k={};let h=0;for(const M of b)if(M)for(const[L,T]of Object.entries(M))typeof T=="string"&&T.length>0?k[L]=T:h++;return h>0&&this.log.debug(`Ignored ${h} invalid values while loading ${m} chunks.`),k}async setLocale(m){m=m.toLowerCase();const x=this._.locale;if(m===x)return[];if(this._.locale=m,this._.clear(),this.log.info(`Changed Locale: ${m} -- Old: ${x}`),this.emit(":changed",m,x),this.emit(":update"),m==="en")return this.emit(":loaded",[]),this._._dayjs_locale="en",[];const $=this.localeData[m],r=await this.loadLocale($?.id||m);let c;try{c=$?.dayjs_override||m,await this.loadDayjsLocale(c)}catch{this.log.warn(`Unable to load DayJS locale for ${m}`),c="en"}if(this._.locale!==m)throw new Error("locale has changed since we started loading");this._._dayjs_locale=c;const b=this._.extend(r);return b.length&&(this.log.info(`Loaded Locale: ${m} -- Phrases: ${b.length}`),this.emit(":loaded",b),this.emit(":update")),b}async loadDayjsLocale(m){if(!(m==="en"||m==="en-arrr"))try{await d(73637)(`./${m}.js`)}catch(x){this.log.warn(`Unable to load day.js locale data for locale "${m}"`,x)}}has(m){return this._.has(m)}formatNode(...m){return this._.formatNode(...m)}toLocaleString(...m){return this._.toLocaleString(...m)}toRelativeTime(...m){return this._.formatRelativeTime(...m)}formatNumber(...m){return this._.formatNumber(...m)}formatCurrency(...m){return this._.formatCurrency(...m)}formatDuration(...m){return this._.formatDuration(...m)}formatDate(...m){return this._.formatDate(...m)}formatTime(...m){return this._.formatTime(...m)}formatDateTime(...m){return this._.formatDateTime(...m)}t(m,...x){return this.see(m,...x),this._.t(m,...x)}tList(m,...x){return this.see(m,...x),this._.tList(m,...x)}};G(p,"TranslationManager");let l=p;const w=/\$/g,_=String.prototype.replace,o=/^\s*([^(]+?)\s*(?:\(\s*([^)]+?)\s*\))?\s*$/;function e(C){if(!C||!C.length)return;const m=[];for(const x of C.split(/\|/g)){const $=o.exec(x);$&&m.push({fmt:$[1],extra:$[2]})}return m}G(e,"parseFormatters");function a(C,m,x,$,r){const c=Array.isArray(C);if(m==null)return c?C[0]:C;let b=C;const k=typeof m=="number"?{count:m}:m;return c&&(b=b[0]),typeof b=="string"&&(b=_.call(b,$,(h,M,L)=>{let T=(0,B.get)(M.trim(),k);if(T==null)return"";const O=e(L);let P=!1;if(O)for(const j of O){const Z=r[j.fmt];typeof Z=="function"&&(T=Z(T,x,k,j.extra),P=!0)}return!P&&typeof T=="string"&&(T=_.call(T,w,"$$")),T})),b}G(a,"transformPhrase")},29986:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>y});var W=d(24431),B=d(22527),R=d(46949),I=d(44589),U=d(8528),z=d(8242),v=d(2682),f=d(67392);const u=/\{\{(.*?)(?:\|(.*?))?\}\}/g,S=class S extends B.default{constructor(...s){super(...s),this.inject("settings"),this.inject("tooltips"),this.inject("i18n"),this.actions={},this.renderers={},this.filterAction=i=>i.appearance&&this.renderers[i.appearance.type]&&(!this.renderers[i.appearance.type].load||this.renderers[i.appearance.type].load(i.appearance))&&(!i.action||this.actions[i.action]),this.settings.add("chat.actions.size",{default:16,ui:{path:'Chat > Actions @{"always_list_pages": true} >> Appearance',title:"Action Size",description:"How tall actions should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.actions.hover-size",{default:30,ui:{path:"Chat > Actions > Message Hover >> Appearance",title:"Action Size",description:"How tall hover actions should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.actions.reasons",{default:[{v:{text:"One-Man Spam",i18n:"chat.reasons.spam"}},{v:{text:"Posting Bad Links",i18n:"chat.reasons.links"}},{v:{text:"Ban Evasion",i18n:"chat.reasons.evasion"}},{v:{text:"Threats / Personal Info",i18n:"chat.reasons.personal"}},{v:{text:"Hate / Harassment",i18n:"chat.reasons.hate"}},{v:{text:"Ignoring Broadcaster / Moderators",i18n:"chat.reason.ignore"}}],type:"array_merge",always_inherit:!0,process(i,l){if(Array.isArray(l))for(const w of l)w.i18n&&typeof w.i18n!="string"&&delete w.i18n;return l},ui:{path:"Chat > Actions > Reasons >> Custom Reasons",component:"chat-reasons"}}),this.settings.add("chat.actions.hover",{process:(i,l)=>l.filter(this.filterAction),default:[{v:{action:"pin",appearance:{type:"icon",icon:"ffz-i-pin"},options:{},display:{mod_icons:!0}}},{v:{action:"reply",appearance:{type:"dynamic"},options:{},display:{}}}],type:"array_merge",inherit_default:!0,ui:{path:`Chat > Actions > Message Hover @{"description": "Here, you can define custom actions that will appear on top of messages in chat when you hover over them. If you aren't seeing an action you've defined here in chat, please make sure that you have enabled Mod Icons in the chat settings menu."}`,component:"chat-actions",context:["user","room","message"],inline:!0,modifiers:!0,hover_modifier:!1,data:()=>{const i=this.resolve("site.chat");return{color:l=>i&&i.colors?i.colors.process(l):l,actions:(0,R.deep_copy)(this.actions),renderers:(0,R.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.inline",{process:(i,l)=>l.filter(this.filterAction),default:[{v:{action:"ban",appearance:{type:"icon",icon:"ffz-i-block"},options:{},display:{mod:!0,mod_icons:!0,deleted:!1}}},{v:{action:"unban",appearance:{type:"icon",icon:"ffz-i-ok"},options:{},display:{mod:!0,mod_icons:!0,deleted:!0}}},{v:{action:"timeout",appearance:{type:"icon",icon:"ffz-i-clock"},display:{mod:!0,mod_icons:!0}}},{v:{action:"msg_delete",appearance:{type:"icon",icon:"ffz-i-trash"},options:{},display:{mod:!0,mod_icons:!0}}}],type:"array_merge",inherit_default:!0,ui:{path:`Chat > Actions > In-Line @{"description": "Here, you can define custom actions that will appear along messages in chat. If you aren't seeing an action you've defined here in chat, please make sure that you have enabled Mod Icons in the chat settings menu."}`,component:"chat-actions",context:["user","room","message"],inline:!0,modifiers:!0,data:()=>{const i=this.resolve("site.chat");return{color:l=>i&&i.colors?i.colors.process(l):l,actions:(0,R.deep_copy)(this.actions),renderers:(0,R.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.user-context",{process:(i,l)=>l.filter(w=>w.type||this.filterAction(w)),default:[],type:"array_merge",inherit_default:!0,ui:{path:'Chat > Actions > User Context @{"description": "Here, you can define custom actions that will appear in a context menu when you right-click a username in chat."}',component:"chat-actions",context:["user","room","message"],mod_icons:!0,data:()=>{const i=this.resolve("site.chat");return{color:l=>i&&i.colors?i.colors.process(l):l,actions:(0,R.deep_copy)(this.actions),renderers:(0,R.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.room",{process:(i,l)=>l.filter(w=>w.type||this.filterAction(w)),default:[],type:"array_merge",inherit_default:!0,ui:{path:'Chat > Actions > Room @{"description": "Here, you can define custom actions that will appear above the chat input box."}',component:"chat-actions",context:["room","room-mode"],inline:!1,data:()=>{const i=this.resolve("site.chat");return{color:l=>i&&i.colors?i.colors.process(l):l,actions:(0,R.deep_copy)(this.actions),renderers:(0,R.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.room-above",{default:!1,ui:{path:"Chat > Actions > Room >> General",component:"setting-check-box",title:"Display Room Actions above the chat input box."}}),this.settings.add("chat.actions.rules-as-reasons",{default:!0,ui:{path:"Chat > Actions > Reasons >> Rules",component:"setting-check-box",title:"Include the current room's rules in the list of reasons."}}),this.handleClick=this.handleClick.bind(this),this.handleContext=this.handleContext.bind(this),this.handleUserContext=this.handleUserContext.bind(this)}onEnable(){this.tooltips.types.action=(s,i)=>{const l=this.getData(s);return l?l.definition.tooltip?l.tip&&l.tip.length?this.replaceVariables(l.tip,l):(0,R.maybe_call)(l.definition.tooltip,this,l,s,i):`Error: The "${l.action}" action provider does not have tooltip support.`:this.i18n.t("chat.actions.unknown","Unknown Action Type")};for(const s in z)(0,R.has)(z,s)&&this.addAction(s,z[s]);for(const s in v)(0,R.has)(v,s)&&this.addRenderer(s,v[s]);this.on("addon:fully-unload",s=>{let i=0;for(const[l,w]of Object.entries(this.actions))w?.__source===s&&(i++,delete this.actions[l]);for(const[l,w]of Object.entries(this.renderers))w?.__source===s&&(i++,delete this.renderers[l]);i&&(this.log.debug(`Cleaned up ${i} entries when unloading addon:`,s),this._updateContexts())})}getAddonProxy(s,i,l){if(!s)return this;const w={},_={},o=W.DEBUG||i?.dev;return w.addAction=(e,a)=>(a&&(a.__source=s),o&&!e.includes(s)&&l.log.warn("[DEV-CHECK] Call to actions.addAction() did not include add-on ID in key:",e),this.addAction(e,a)),w.addRenderer=(e,a)=>(a&&(a.__source=s),o&&!e.includes(s)&&l.log.warn("[DEV-CHECK] Call to actions.addRenderer() did not include add-on ID in key:",e),this.addRenderer(e,a)),o&&(w.removeAction=(...e)=>{for(const a of e){const p=this.actions[a];p&&p.__source!==s&&l.log.warn("[DEV-CHECK] Removed un-owned action with actions.removeAction:",a," owner:",p.__source??"ffz")}return this.removeAction(...e)},w.removeRenderer=(...e)=>{for(const a of e){const p=this.renderers[a];p&&p.__source!==s&&l.log.warn("[DEV-CHECK] Removed un-owned renderer with actions.removeRenderer:",a," owner:",p.__source??"ffz")}return this.removeRenderer(...e)},_.actions="Please use addAction() or removeAction()",_.renderers="Please use addRenderer() or removeRenderer()"),(0,B.buildAddonProxy)(l,this,"actions",w,_)}_updateContexts(){for(const s of this.settings.__contexts)s.update("chat.actions.inline"),s.update("chat.actions.hover"),s.update("chat.actions.user-context"),s.update("chat.actions.room")}addAction(s,i){if((0,R.has)(this.actions,s))return this.log.warn(`Attempted to add action "${s}" which is already defined.`);this.actions[s]=i,this._updateContexts()}addRenderer(s,i){if((0,R.has)(this.renderers,s))return this.log.warn(`Attempted to add renderer "${s}" which is already defined.`);this.renderers[s]=i,this._updateContexts()}getActions(){return{...this.actions}}getAction(s){return this.actions[s]??null}getRenderer(s){return this.renderers[s]??null}getRenderers(){return{...this.renderers}}removeAction(...s){let i=!1;for(const l of s)(0,R.has)(this.actions,l)&&(delete this.actions[l],i=!0);i&&this._updateContexts()}removeRenderer(...s){let i=!1;for(const l of s){if(!(0,R.has)(this.renderers,l))return;delete this.renderers[l],i=!0}i&&this._updateContexts()}replaceVariables(s,i){return(0,f.Tr)(s,i,this.i18n.locale,u,{upper(l){return l.toString().toUpperCase()},uppercase(l){return l.toString().toUpperCase()},lower(l){return l.toString().toLowerCase()},lowercase(l){return l.toString().toLowerCase()},snakecase(l){return l.toString().toSnakeCase()},slugify(l,w,_,o){return l.toString().toSlug(o&&o.length?o:"-")},urlencode(l){return encodeURIComponent(l)},word(l,w,_,o){if(!o||!o.length)return l;let e,a;const p=o.split(",");try{if(e=parseInt(p[0],10),isNaN(e)||!isFinite(e))return l}catch{return this.log.warn("Invalid value for word(start)",p[0]),l}if(p.length>1)if(!p[1].trim().length)a=-1;else try{if(a=parseInt(p[1],10),isNaN(a)||!isFinite(a))return l}catch{return this.log.warn("Invalid value for word(end)",p[1]),l}const C=l.split(/\s+/);return e<0&&(e=C.length+e),e<0&&(e=0),e>=C.length&&(e=C.length-1),a!=null?(a<0&&(a=C.length+a),a<e&&(a=e),a>C.length&&(a=C.length),C.slice(e,a+1).join(" ")):C[e]}})}renderInlineReasons(s,i,l){const w=this.parent.context.get("chat.actions.reasons"),_=[],o=this.parent.context.get("chat.actions.rules-as-reasons")&&this.parent.getRoom(s.room.id,s.room.login,!0),e=o&&o.rules;if(!w&&!e)return l.hide(),null;const a=G(C=>m=>(l.hide(),s.definition.click.call(this,m,Object.assign({reason:C},s)),m.preventDefault(),!1),"click_fn");if(w&&w.length)for(const C of w){const m=this.replaceVariables(typeof C.i18n=="string"?this.i18n.t(C.i18n,C.text):C.text,s);_.push((0,I.createElement)("li",{class:"tw-full-width tw-relative"},(0,I.createElement)("a",{href:"#",class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-05",onClick:a(m)},m)))}if(e&&e.length){w&&w.length&&_.push((0,I.createElement)("div",{class:"tw-mg-y-05 tw-border-b"}));for(const C of e)_.push((0,I.createElement)("li",{class:"tw-full-width tw-relative"},(0,I.createElement)("a",{href:"#",class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-05",onClick:a(C)},C)))}let p;return s.definition.reason_text?p=s.definition.reason_text.call(this,s,i,l):p=this.i18n.t("chat.actions.select-reason","Please select a reason from the list below:"),(0,I.createElement)("div",{class:"ffz--inline-reasons"},p?(0,I.createElement)("div",{class:"tw-pd-05 tw-border-b"},p):null,(0,I.createElement)("div",{class:"scrollable-area","data-simplebar":!0},(0,I.createElement)("div",{class:"simplebar-scroll-content"},(0,I.createElement)("div",{class:"simplebar-content"},(0,I.createElement)("ul",null,_)))))}renderInlineContext(s,i){const l=i.definition;let w;if(l.context)w=G((_,o)=>l.context.call(this,i,_,o),"content");else if(l.uses_reason)w=G((_,o)=>this.renderInlineReasons(i,_,o),"content");else return;return this.renderPopup(s,w)}renderPopup(s,i){if(s._ffz_destroy)return s._ffz_destroy();const l=s._ffz_destroy=()=>{if(s._ffz_outside&&s._ffz_outside.destroy(),s._ffz_popup){const o=s._ffz_popup;s._ffz_popup=null,o.destroy()}s._ffz_on_destroy&&s._ffz_on_destroy(),s._ffz_destroy=s._ffz_outside=s._ffz_on_destroy=null},w=document.fullscreenElement||document.body.querySelector("#root>div")||document.body;(s._ffz_popup=new U.default(w,s,{logger:this.log,manual:!0,live:!1,html:!0,hover_events:!0,no_update:!0,tooltipClass:"ffz-action-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"ffz-balloon__tail tw-overflow-hidden tw-absolute",arrowInner:"ffz-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base  tw-absolute",innerClass:"",popper:{placement:"bottom",modifiers:{preventOverflow:{boundariesElement:w},flip:{behavior:["bottom","top","left","right"]}}},content:i,onShow:async(o,e)=>{await e.waitForDom(),s._ffz_outside=new I.ClickOutside(e.outer,l)},onMove:(o,e,a)=>{this.emit("tooltips:hover",o,e,a)},onLeave:(o,e,a)=>{this.emit("tooltips:leave",o,e,a)},onHide:l}))._enter(s)}getUserLevel(s,i){return!s||!i?0:s.id===i.id||s.login===i.login?5:i.moderator||i.type==="mod"||i.badges&&i.badges.moderator?3:0}renderRoom(s,i,l,w,_){const o=[],e=this.resolve("site.chat");let a=null;for(const x of this.parent.context.get("chat.actions.room")){if(!x)continue;x.ctx="room";const $=x.type;if($){$==="new-line"?a=null:$==="space"?(a||o.push(a=[]),a.push(_("div",{class:"tw-flex-grow-1"}))):$==="space-small"?(a||o.push(a=[]),a.push(_("div",{class:"tw-mg-x-1"}))):this.log.warn("Unknown action type",$);continue}if(!x.action||!x.appearance)continue;let r=x.appearance||{};const c=x.display||{},b=this.actions[x.action];if(!b||c.disabled||c.mod_icons!=null&&c.mod_icons!==!!s||c.mod!=null&&c.mod!==(i?!!i.mod:!1)||c.staff!=null&&c.staff!==(i?!!i.staff:!1)||c.emoteOnly!=null&&c.emoteOnly!==l.emoteOnly||c.slowMode!=null&&c.slowMode!==l.slowMode||c.subsMode!=null&&c.subsMode!==l.subsMode||c.r9kMode!=null&&c.r9kMode!==l.r9kMode||c.followersOnly!=null&&c.followersOnly!==l.followersOnly||(0,R.maybe_call)(b.hidden,this,x,null,l,i,s))continue;if(r.type==="dynamic"){const O=b.dynamicAppearance&&b.dynamicAppearance.call(this,Object.assign({},r),x,null,l,i,s);O&&(r=O)}if(b.override_appearance){const O=b.override_appearance.call(this,Object.assign({},r),x,null,l,i,s);O&&(r=O)}const k=this.renderers[r.type];if(!k)continue;const h=k.colored&&r.color,M=(0,R.maybe_call)(b.disabled,this,x,null,l,i,s)||!1,L=h&&(e&&e.colors?e.colors.process(r.color):r.color),T=k.render.call(this,r,_,L);a||o.push(a=[]),a.push(_("button",{class:`ffz-tooltip tw-pd-x-05 mod-icon ffz-mod-icon tw-c-text-alt-2${M?" disabled":""}${h?" colored":""}`,"data-tooltip-type":"action","data-action":x.action,"data-options":x.options?JSON.stringify(x.options):null,"data-tip":r.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},T))}if(!o.length)return null;const p=l&&JSON.stringify(l),C=o.length>1,m=C?o.map((x,$)=>_("div",{key:$,class:"tw-flex tw-full-width tw-flex-row tw-flex-wrap"},x)):o[0];return _("div",{class:`ffz--room-actions${C?" tw-flex-column":""} ffz-action-data tw-flex tw-flex-grow-1 tw-flex-wrap tw-align-items-center ${w?"tw-pd-y-05 tw-border-t":"tw-mg-x-05"}`,"data-room":p},m)}renderUserContext(s,i){const l=this.resolve("site.fine"),w=this.resolve("site"),_=this.resolve("site.chat"),o=l&&l.searchParent(s,h=>h.props&&h.props.message),e=o?.props?.message;if(!e||!w||!_)return;let a=e.roomLogin?e.roomLogin:e.channel?e.channel.slice(1):void 0;if(!a&&o.props.channelID){const h=this.parent.getRoom(o.props.channelID,null,!0);h&&h.login&&(a=e.roomLogin=h.login)}const p=w.getUser(),C={id:o.props.channelID,login:a},m=!!(o.props.hasReply||o.props.reply||!o.props.replyRestrictedReason),x=m&&e.message&&!e.deleted&&!o.props.disableReplyClick,$=x&&(m||p&&p.login!==e.user?.login);e.roomId=C.id,p&&(p.moderator=o.props.isCurrentUserModerator,p.staff=o.props.isCurrentUserStaff,p.reply_mode=this.parent.context.get("chat.replies.style"),p.can_reply=$);const r=this.getUserLevel(C,p),c=this.getUserLevel(C,e.user);let b=o.props.showModerationIcons;r<3&&(b=!1);const k=o;return this.renderPopup(s,(h,M)=>{const L=[];let T=null;const O=G(j=>{this.handleClick(j,T),M.hide()},"handle_click");for(const j of i){if(!j)continue;if(j.ctx="user_context",j.type==="new-line"){T=null;continue}else if(j.type==="space-small"){T||L.push(T=[]),T.push((0,I.createElement)("div",{class:"tw-pd-x-1"}));continue}else if(j.type==="space"){T||L.push(T=[]),T.push((0,I.createElement)("div",{class:"tw-flex-grow-1"}));continue}else if(!j.action||!j.appearance)continue;let Z=j.appearance||{};const q=j.display||{},X=this.actions[j.action];if(!X||q.disabled||q.mod_icons!=null&&q.mod_icons!==!!b||q.mod!=null&&q.mod!==r>c||q.staff!=null&&q.staff!==(p?!!p.staff:!1)||q.deleted!=null&&q.deleted!==!!e.deleted||(0,R.maybe_call)(X.hidden,this,j,e,C,p,b,k))continue;if(Z.type==="dynamic"){const me=X.dynamicAppearance&&X.dynamicAppearance.call(this,Object.assign({},Z),j,e,C,p,b,k);me&&(Z=me)}if(X.override_appearance){const me=X.override_appearance.call(this,Object.assign({},Z),j,e,C,p,b,k);me&&(Z=me)}const ee=this.renderers[Z.type];if(!ee)continue;const te=ee.colored&&Z.color,ne=(0,R.maybe_call)(X.disabled,this,j,e,C,p,b,k)||!1,pe=te&&(_&&_.colors?_.colors.process(Z.color):Z.color),oe=ee.render.call(this,Z,I.createElement,pe);T||L.push(T=[]);const de=(0,I.createElement)("button",{class:`ffz-tooltip ffz-tooltip--no-mouse tw-button tw-button--text${ne?" tw-button--disabled disabled":""}`,"data-tooltip-type":"action","data-action":j.action,"data-options":j.options?JSON.stringify(j.options):null,onClick:O,onContextMenu:this.handleContext},(0,I.createElement)("span",{class:"tw-button__text"},oe));Z.tooltip&&(de.dataset.tip=Z.tooltip),T.push(de)}const P=(0,I.createElement)("div",{class:"ffz-action-data tw-pd-05","data-source":"msg"},(0,I.createElement)("div",{class:"tw-pd-b-05 tw-border-b"},(0,I.createElement)("strong",null,e.user.displayName||e.user.login),"..."),L.map(j=>!j||!j.length?null:(0,I.createElement)("div",{class:"tw-flex tw-flex-no-wrap"},j)));return P.ffz_message=e,P.ffz_line=k,P})}renderHover(s,i,l,w,_,o=null){const e=[],a=this.getUserLevel(w,l),p=this.getUserLevel(w,s.user),C=s.user&&l&&l.login===s.user.login;a<3&&(i=!1);const m=this.resolve("site.chat");let x=!1;for(const $ of this.parent.context.get("chat.actions.hover")){if(!$.action||!$.appearance)continue;$.ctx="hover";let r=$.appearance||{};const c=$.display||{},b=c.keys,k=this.actions[$.action];if(!k||c.disabled||c.mod_icons!=null&&c.mod_icons!==!!i||c.mod!=null&&c.mod!==a>p||c.staff!=null&&c.staff!==(l?!!l.staff:!1)||c.deleted!=null&&c.deleted!==!!s.deleted||C&&!k.can_self||(0,R.maybe_call)(k.hidden,this,$,s,w,l,i,o))continue;if(r.type==="dynamic"){const P=k.dynamicAppearance&&k.dynamicAppearance.call(this,Object.assign({},r),$,s,w,l,i,o);P&&(r=P)}if(k.override_appearance){const P=k.override_appearance.call(this,Object.assign({},r),$,s,w,l,i,o);P&&(r=P)}const h=this.renderers[r.type];if(!h)continue;const M=h.colored&&r.color,L=(0,R.maybe_call)(k.disabled,this,$,s,w,l,i,o)||!1,T=M&&(m&&m.colors?m.colors.process(r.color):r.color),O=h.render.call(this,r,_,T);x=!0,e.push(_("div",{class:`ffz-hover-action${b?` ffz-has-modifier ffz-modifier-${b}`:""}`},_("button",{class:`ffz-tooltip ffz-mod-icon tw-c-text-alt-2${L?" disabled":""}${M?" colored":""}`,"data-tooltip-type":"action","data-action":$.action,"data-options":$.options?JSON.stringify($.options):null,"data-tip":r.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},O)))}return x?_("div",{class:"ffz--hover-actions ffz-action-data tw-mg-r-05","data-source":"line"},e):null}renderInline(s,i,l,w,_,o=null){const e=[],a=this.getUserLevel(w,l),p=this.getUserLevel(w,s.user),C=s.user&&l&&l.login===s.user.login;a<3&&(i=!1);const m=this.resolve("site.chat"),x=[];let $=!1;for(const c of this.parent.context.get("chat.actions.inline")){if(!c.action||!c.appearance)continue;c.ctx="inline";let b=c.appearance||{};const k=c.display||{},h=k.keys,M=k.hover,L=this.actions[c.action];if(!L||k.disabled||k.mod_icons!=null&&k.mod_icons!==!!i||k.mod!=null&&k.mod!==a>p||k.staff!=null&&k.staff!==(l?!!l.staff:!1)||k.deleted!=null&&k.deleted!==!!s.deleted||C&&!L.can_self||(0,R.maybe_call)(L.hidden,this,c,s,w,l,i,o))continue;if(b.type==="dynamic"){const X=L.dynamicAppearance&&L.dynamicAppearance.call(this,Object.assign({},b),c,s,w,l,i,o);X&&(b=X)}if(L.override_appearance){const X=L.override_appearance.call(this,Object.assign({},b),c,s,w,l,i,o);X&&(b=X)}const T=this.renderers[b.type];if(!T)continue;const O=T.colored&&b.color,P=(0,R.maybe_call)(L.disabled,this,c,s,w,l,i,o)||!1,j=O&&(m&&m.colors?m.colors.process(b.color):b.color),Z=T.render.call(this,b,_,j);let q=e;(h||M)&&(q=x),$=!0,q.push(_("button",{class:`ffz-tooltip mod-icon ffz-mod-icon tw-c-text-alt-2${P?" disabled":""}${O?" colored":""}${h?` ffz-modifier-${h}`:""}${M?" ffz-hover":""}`,"data-tooltip-type":"action","data-action":c.action,"data-options":c.options?JSON.stringify(c.options):null,"data-tip":b.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},Z))}if(!$)return null;let r=null;if(e.length&&(r=_("div",{class:"ffz--inline-actions ffz-action-data tw-inline-block tw-mg-r-05","data-source":"line"},e)),x.length){const c=_("div",{class:"ffz--inline-actions ffz--modifier-actions ffz-action-data","data-source":"line"},x);return r?[r,c]:c}return r}getData(s){const i=s.dataset,l=s.closest(".ffz-action-data"),w=l&&l.dataset,_=i&&i.action,o=this.actions[_];if(!o)return null;let e,a,p,C=!1,m;if(w){if(w.source==="msg"&&l.ffz_message){const $=l.ffz_message;m=l.ffz_line,C=!0,e=$.user?{color:$.user.color,id:$.user.id,login:$.user.login,displayName:$.user.displayName,type:$.user.type}:null,a={login:$.roomLogin,id:$.roomId},p={id:$.id,text:$.message}}else if(w.source==="line"){const $=this.resolve("site.fine");if(m=$&&$.searchParent(l,r=>r.props&&r.props.message),m&&m.props&&m.props.message){C=!0;const r=m.props.message;e=r.user?{color:r.user.color,id:r.user.id,login:r.user.login,displayName:r.user.displayName,type:r.user.type}:null,a={login:m.props.channelLogin,id:m.props.channelID},p={id:r.id,text:r.message}}}C||(e=w.user?JSON.parse(w.user):null,a=w.room?JSON.parse(w.room):null,p=w.message?JSON.parse(w.message):w.msgId?{id:w.msgId}:null)}const x={action:_,definition:o,tip:i.tip,options:i.options?JSON.parse(i.options):null,user:e,room:a,message:p,message_id:p?p.id:null,line:m};return o.defaults&&(x.options=Object.assign({},(0,R.maybe_call)(o.defaults,this,x,s),x.options)),x}handleClick(s){const i=s.target,l=this.getData(i);if(l&&!i.classList.contains("disabled"))return l.definition.click?(i._ffz_tooltip&&i._ffz_tooltip.hide(),l.definition.click.call(this,s,l)):l.definition.context?this.handleContext(s):this.log.warn(`No click handler for action provider "${l.action}"`)}handleContext(s){if(s.shiftKey)return;s.preventDefault();const i=s.target,l=this.getData(s.target);l&&(i.classList.contains("disabled")||(i._ffz_tooltip&&i._ffz_tooltip.hide(),!(!l.definition.context&&!l.definition.uses_reason)&&this.renderInlineContext(i,l)))}handleUserContext(s){if(s.shiftKey)return;const i=this.parent.context.get("chat.actions.user-context");if(!Array.isArray(i)||!i.length)return;s.preventDefault();const l=s.target;l._ffz_tooltip&&l._ffz_tooltip.hide(),this.renderUserContext(l,i)}pasteMessage(s,i){return this.resolve("site.chat.input").pasteMessage(s,i)}addNotice(s,i){return this.resolve("site.chat").addNotice(s,i)}sendMessage(s,i){return this.resolve("site.chat").sendMessage(s,i)}};G(S,"Actions");let y=S},2682:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{combo:()=>z,dynamic:()=>B,emote:()=>I,icon:()=>U,image:()=>v,text:()=>R});var W=d(61892);const B={title:"Dynamic",title_i18n:"setting.actions.appearance.dynamic",colored:!0,render(f,u,y){return u("figure",{style:{color:y},class:`${f.icon||"ffz-i-zreknarf"}`})}},R={title:"Text",title_i18n:"setting.actions.appearance.text",colored:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,74640)),component:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,68185)),render(f,u,y){return u("span",{style:{color:y}},f.text)}},I={title:"Emote",title_i18n:"setting.actions.appearance.emote",editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,29668)),component:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,25816)),render(f,u){return u("figure",{class:"mod-icon__image"},u("img",{src:f.src}))}},U={title:"Icon",title_i18n:"setting.actions.appearance.icon",colored:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,8684)),load(f){return f.icon&&f.icon.startsWith("ffz-fa")&&(0,W.load)(),!0},component:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,92123)),render(f,u,y){return u("figure",{style:{color:y},class:`${f.icon||"ffz-i-zreknarf"}`})}},z={title:"Text and Icon",title_i18n:"setting.actions.appearance.combo",colored:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,56727)),load(f){return f.icon&&f.icon.startsWith("ffz-fa")&&(0,W.load)(),!0},component:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,6234)),render(f,u,y){return u("span",{style:{color:y},class:f.icon},f.text)}},v={title:"Image",title_i18n:"setting.actions.appearance.image",editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,17816)),component:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,81725)),render(f,u){return u("figure",{class:"mod-icon__image"},u("img",{src:f.image}))}}},8242:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{ban:()=>y,chat:()=>f,copy_message:()=>z,edit_overrides:()=>U,mod:()=>i,msg_delete:()=>u,open_url:()=>v,pin:()=>R,reply:()=>I,timeout:()=>S,toggle_profile:()=>_,unban:()=>n,unmod:()=>l,untimeout:()=>s,whisper:()=>w});var W=d(46949),B=d(44589);const R={presets:[{appearance:{type:"icon",icon:"ffz-i-pin"}}],required_context:["message"],title:"Pin This Message",description:"Allows you to pin a chat message if you're a moderator.",can_self:!0,tooltip(o){return o.line?.props?.pinnedMessage?.message?.id===o.message_id?this.i18n.t("chat.actions.pin.already","This message is already pinned."):this.i18n.t("chat.actions.pin","Pin This Message")},disabled(o,e,a,p,C,m){return(m??o.line)?.props?.pinnedMessage?.message?.id===e.id&&e.id!=null},hidden(o,e,a,p,C,m){let x=m;if(!x||!x.props.isPinnable||!x.onPinMessageClick||!e.message||!e.message.length||e.deleted)return!0},click(o,e){let a=e.line;if(!a){const p=this.resolve("site.fine");a=p?p.searchParent(o.target,C=>C.setMessageTray&&C.props&&C.props.message):null}!a||!a.props.isPinnable||!a.onPinMessageClick||a.props.pinnedMessage?.message?.id!==e.message_id&&a.onPinMessageClick()}},I={presets:[{appearance:{type:"dynamic"}}],required_context:["message"],supports_dynamic:!0,title:"Reply to Message",description:"Allows you to directly reply to another user's message.",can_self:!0,dynamicAppearance(o,e,a,p,C,m,x){const $=x??e.line,r=$?.props;return{type:"icon",icon:r?.hasReply||r?.reply?"ffz-i-threads":"ffz-i-reply",color:o.color}},tooltip(o){const e=o.line?.props;return e?.hasReply||e?.reply?this.i18n.t("chat.actions.reply.thread","Open Thread"):this.i18n.t("chat.actions.reply","Reply to Message")},hidden(o,e,a,p){const C=e?.id;if(typeof C!="string"||!/^[0-9a-f]+-[0-9a-f]+/.test(C)||!p?.can_reply||p?.reply_mode===0||!e.message||e.deleted)return!0},click(o,e){let a=e.line;if(!a){const p=this.resolve("site.fine");a=p?p.searchParent(o.target,C=>C.setMessageTray&&C.props&&C.props.message):null}a&&a.ffzOpenReply()}},U={presets:[{appearance:{type:"icon",icon:"ffz-i-pencil"}}],required_context:["user"],title:"Change Name & Color",description:"Allows you to set local overrides for a user's name and color in chat.",can_self:!0,tooltip(){return this.i18n.t("chat.actions.edit_overrides","Change Name & Color")},click(o,e){this.resolve("chat.overrides").renderUserEditor(e.user,o.target)}},z={presets:[{appearance:{type:"icon",icon:"ffz-i-docs"}}],defaults:{format:"{{user.displayName}}: {{message.text}}"},editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,66038)),required_context:["user","message"],title:"Copy Message",description:"Allows you to quickly copy a chat message to your clipboard.",can_self:!0,tooltip(o){const e=this.replaceVariables(o.options.format,o);return[(0,B.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.actions.copy_message","Copy Message")),(0,B.createElement)("div",{class:"tw-align-left"},e)]},click(o,e){const a=this.replaceVariables(e.options.format,e);navigator.clipboard.writeText(a)}},v={presets:[{appearance:{type:"icon",icon:"ffz-i-link-ext"}}],defaults:{url:"https://link.example/{{user.login}}"},editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,86773)),title:"Open URL",description(o){return o.options.url},description_i18n:null,can_self:!0,tooltip(o){const e=this.replaceVariables(o.options.url,o);return[(0,B.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.actions.open_url","Open URL")),(0,B.createElement)("div",{class:"tw-align-left"},e)]},click(o,e){const a=this.replaceVariables(e.options.url,e),p=window.open();p&&(p.opener=null,p.location=a)}},f={presets:[{appearance:{type:"text",text:"C"}}],required_context:["room"],defaults:{command:"@{{user.login}} HeyGuys",paste:!1},title:"Chat Command",description(o){if(o.options.paste)return this.t("chat.actions.chat.desc.paste","Paste into chat: {cmd}",{cmd:o.options.command});const e=o.options.target??"";return this.t("chat.actions.chat.desc.target","Send in {target}: {cmd}",{cmd:o.options.command,target:/^\s*$/.test(e)?this.t("chat.actions.chat.desc.current","current channel"):e})},description_i18n:null,can_self:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,34727)),tooltip(o){const e=this.replaceVariables(o.options.command,o);let a=this.replaceVariables(o.options.target??"",o);return/^\s*$/.test(a)&&(a=null),[(0,B.createElement)("div",{class:"tw-border-b tw-mg-b-05"},a?this.i18n.t("chat.actions.chat.with-target","Chat Command in Channel: {target}",{target:a}):this.i18n.t("chat.actions.chat","Chat Command")),(0,B.createElement)("div",{class:"tw-align-left"},e)]},click(o,e){const a=this.replaceVariables(e.options.command,e);let p=this.replaceVariables(e.options.target??"",e);(e.options.paste||/^\s*$/.test(p))&&(p=e.room.login),e.options.paste?this.pasteMessage(p,a):this.sendMessage(p,a)}},u={presets:[{appearance:{type:"icon",icon:"ffz-i-trash"},display:{mod:!0,mod_icons:!0}}],defaults:{},required_context:["room","user","message"],title:"Delete Message",tooltip(o){return this.i18n.t("chat.actions.delete.tooltip","Delete {user.login}'s message",{user:o.user})},click(o,e){return this.resolve("site.twitch_data").deleteChatMessage(e.room.id,e.message_id).catch(p=>{p instanceof W.TranslatableError&&this.addNotice(e.room.login,this.i18n.t(p.i18n_key,p.message,p.data))})}},y={presets:[{appearance:{type:"icon",icon:"ffz-i-block"},display:{mod:!0,mod_icons:!0}}],defaults:{},required_context:["room","user"],uses_reason:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,93953)),title:"Ban User",reason_text(o){return this.i18n.t("chat.actions.ban-reason","Ban {user.login} for:",{user:o.user})},tooltip(o){return this.i18n.t("chat.actions.ban.tooltip","Ban {user.login}",{user:o.user})},click(o,e){let a=e.reason||e.options.reason||"";a.length&&(a=this.replaceVariables(a,e)),this.sendMessage(e.room.login,`/ban ${e.user.login} ${a}`)}},S={presets:[{appearance:{type:"icon",icon:"ffz-i-clock"},display:{mod:!0,mod_icons:!0}}],defaults:{duration:600},required_context:["room","user"],uses_reason:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,69454)),title:"Timeout User",description:"{options.duration, plural, one {# second} other {# seconds}}",reason_text(o){return this.i18n.t("chat.actions.timeout-reason","Timeout {user.login} for {duration, plural, one {# second} other {# seconds}} for:",{user:o.user,duration:o.options.duration})},tooltip(o){return this.i18n.t("chat.actions.timeout.tooltip","Timeout {user.login} for {duration, plural, one {# second} other {# seconds}}",{user:o.user,duration:o.options.duration})},click(o,e){let a=e.reason||e.options.reason||"";a.length&&(a=this.replaceVariables(a,e)),this.sendMessage(e.room.login,`/timeout ${e.user.login} ${e.options.duration} ${a}`)}},n={presets:[{appearance:{type:"icon",icon:"ffz-i-ok"},display:{mod:!0,mod_icons:!0}}],required_context:["room","user"],title:"Unban User",tooltip(o){return this.i18n.t("chat.actions.unban.tooltip","Unban {user.login}",{user:o.user})},click(o,e){this.sendMessage(e.room.login,`/unban ${e.user.login}`)}},s={presets:[{appearance:{type:"icon",icon:"ffz-i-ok"},display:{mod:!0,mod_icons:!0}}],required_context:["room","user"],title:"Untimeout User",tooltip(o){return this.i18n.t("chat.actions.untimeout.tooltip","Untimeout {user.login}",{user:o.user})},click(o,e){this.sendMessage(e.room.login,`/untimeout ${e.user.login}`)}},i={presets:[{appearance:{type:"icon",icon:"ffz-i-mod"}}],required_context:["room","user"],title:"Mod User",tooltip(o){return this.i18n.t("chat.actions.mod.tooltip","Mod {user.login}",{user:o.user})},hidden(o,e,a,p,C,m){return e.user.type==="mod"||e.user.id===a.id?!0:a.id!==p.id},click(o,e){this.sendMessage(e.room.login,`/mod ${e.user.login}`)}},l={presets:[{appearance:{type:"icon",icon:"ffz-i-unmod"}}],required_context:["room","user"],title:"Un-Mod User",tooltip(o){return this.i18n.t("chat.actions.unmod.tooltip","Un-Mod {user.login}",{user:o.user})},hidden(o,e,a,p,C,m){return e.user.type!=="mod"?!0:e.user.id===p.id||e.user.id===a.id?!1:a.id!==p.id},click(o,e){this.sendMessage(e.room.login,`/unmod ${e.user.login}`)}},w={presets:[{appearance:{type:"text",text:"W"}}],required_context:["user"],title:"Whisper User",tooltip(o){return this.i18n.t("chat.actions.whisper.tooltip","Whisper {user.login}",o)},click(o,e){const a=this.resolve("site"),p=a&&a.getUser(),C=a&&a.store;if(!p||!C||!e.user||!e.user.id||p.id==e.user.id)return;const m=parseInt(p.id,10),x=parseInt(e.user.id,10),$=m<x?`${m}_${x}`:`${x}_${m}`;C.dispatch({type:"whispers.THREAD_OPENED",data:{threadID:$,collapsed:!1}})}},_={presets:[{appearance:{type:"dynamic"}}],editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,12893)),required_context:[],supports_dynamic:!0,can_self:!0,title:"Toggle Settings Profile",description(o){const e=window.FrankerFaceZ.get(),a=e?.resolve("settings"),p=a?.profile(o.options?.uuid);return p?p.i18n_key?this.t(p.i18n_key,p.name):p.name:null},description_i18n:null,dynamicAppearance(o,e){const a=this.settings.profile(e.options?.uuid);return a?{type:"icon",icon:a.toggled?"ffz-i-ok":"ffz-i-cancel",color:o.color}:{type:"icon",icon:"ffz-i-attention",color:o.color}},tooltip(o){const e=this.settings.profile(o.options?.uuid);let a;return e?a=e.i18n_key?this.i18n.t(e.i18n_key,e.name):e.name:a="invalid",this.i18n.t("chat.actions.toggle_profile.tooltip","Toggle Profile: {name}",{name:a})},click(o,e){const a=this.settings.profile(e.options?.uuid);if(!a)return;const p=new Set;for(const C of["inline","hover","user-context","room"]){const m=`chat.actions.${C}`,x=this.parent.context.get(m);if(Array.isArray(x)){for(const $ of x)if($.action==="toggle_profile"&&$.options?.uuid===a.uuid){p.add(C),this.parent.context.once(`changed:${m}`,()=>p.delete(C));break}}}a.toggled=!a.toggled,requestAnimationFrame(()=>{for(const C of p)this.parent.context.update(`chat.actions.${C}`)})}}},12381:(ae,J,d)=>{"use strict";d.d(J,{QC:()=>o,ZP:()=>l,iV:()=>_});var W=d(24431),B=d(44589),R=d(46949),I=d(22527),U=d(14873),z=d(8528);const v={1:{staff:{1:{color:"#200f33",svg:!0,trans:{color:"#6441a5"}}},admin:{1:{color:"#faaf19",svg:!0}},global_mod:{1:{color:"#0c6f20",svg:!0}},broadcaster:{1:{color:"#e71818",svg:!0}},moderator:{1:{color:"#34ae0a",svg:!0}},twitchbot:{1:{color:"#34ae0a"}},partner:{1:{color:"transparent",trans:{image:!0,color:"#6441a5"}}},"clip-champ":{1:{color:"#6441a5"}},vip:{1:{color:"#b33ff0",trans:{color:"transparent",invert:!1}}},turbo:{1:{color:"#6441a5",svg:!0}},premium:{1:{color:"#009cdc"}},subscriber:{0:{color:"#6441a5"},1:{color:"#6441a5"}}},2:{staff:{1:{color:"#000"}},admin:{1:{color:"#DB7600"}},broadcaster:{1:{color:"#E91916"}},moderator:{1:{color:"#00AD03"}},global_mod:{1:{color:"#006441"}},twitchbot:{1:{color:"#00AD03"}},partner:{1:{color:"#9146FF"}},subscriber:{0:{color:"#8205B4"},1:{color:"#8205B4"}},vip:{1:{color:"#E005B9"}},turbo:{1:{color:"#59399A"}},premium:{1:{color:"#00A0D6"}},"anonymous-cheerer":{1:{color:"#4B367C"}},"clip-champ":{1:{color:"#9146FF"}},"artist-badge":{1:{color:"#1e69ff"}},no_audio:{1:{color:"#323239"}},no_video:{1:{color:"#323239"}}}},f={staff:-2,admin:-1,global_mod:-1,broadcaster:0,mod:1,moderator:1,twitchbot:1,vip:2,subscriber:25},u="background-repeat:no-repeat;background-position:center;",y=`${W.SERVER}/static/badges/twitch/`,S=W.IS_WEBKIT?"webkitMaskImage":"maskImage",n={0:a=>`${a.fore?`color:${a.fore};`:""}background:${a.image||""} ${a.color};background-size:${a.scale*1.8}rem;${a.svg?"":`background-image:${a.image_set};`}${u}`,1:a=>`${n[0](a)}border-radius:${a.scale*.2}rem;`,2:a=>`${n[0](a)}border-radius:${a.scale*.9}rem;background-size:${a.scale*1.6}rem;`,3:a=>`${a.fore?`color:${a.fore};`:""}background:${a.color};border-radius:${a.scale*.9}rem;`,4:a=>`${n[3](a)}height:${a.scale}rem;min-width:${a.scale}rem;`,5:a=>`background:${a.image};background-size:${a.scale*1.8}rem;${a.svg?"":`background-image:${a.image_set};`}${u}`,6:a=>`background:linear-gradient(${a.color},${a.color});${W.WEBKIT_CSS}mask-image:${a.image};${W.WEBKIT_CSS}mask-size:${a.scale*1.8}rem ${a.scale*1.8}rem;${a.svg?"":`${W.WEBKIT_CSS}mask-image:${a.image_set};`}`};function s(a,p){const C=a.urls||{1:a.image},m=`url("${C[1]}")`,x=`${W.WEBKIT_CSS}image-set(${m} 1x${C[2]?`, url("${C[2]}") 2x`:""}${C[4]?`, url("${C[4]}") 4x`:""})`;return p===3||p===4?"":p===6?`${W.WEBKIT_CSS}mask-image:${m} !important;${W.WEBKIT_CSS}mask-image:${x} !important;`:`background-image:${m} !important;background-image:${x} !important;`}G(s,"generateOverrideCSS");function i(a,p,C,m,x,$=2,r,c,b=1,k=!1){let h=C.color||"transparent",M=C.fore||x?"#fff":"#000",L=C.image||(C.addon?null:`${y}${$}/${a}${C.svg?".svg":`/${p}/`}`),T=!1,O=!1,P,j,Z;if(L&&m>4){const q=C.trans||{};h=q.color||h,q.image&&(T=!0,q.image!==!0&&(L=q.image)),(0,R.has)(q,"invert")?O=q.invert&&!x:O=m===5&&!x}return(m===3||m===4)&&h==="transparent"&&C.trans&&(h=C.trans.color||h),h==="transparent"&&(m=0),L&&m!==3&&m!==4&&(P=L.endsWith(".svg"),C.urls?j=`url("${C.urls[b]}")`:j=`url("${P?L:`${L}${b}${T?"_trans":""}.png`}")`,C.urls&&b===1?Z=`${W.WEBKIT_CSS}image-set(${j} 1x${C.urls[2]?`, url("${C.urls[2]}") 2x`:""}${C.urls[4]?`, url("${C.urls[4]}") 4x`:""})`:C.urls&&b===2?Z=`${W.WEBKIT_CSS}image-set(${j} 1x${C.urls[4]?`, url("${C.urls[4]}") 2x`:""})`:!P&&b<4?b===1?Z=`${W.WEBKIT_CSS}image-set(${j} 1x, url("${L}2${T?"_trans":""}.png") 2x, url("${L}4${T?"_trans":""}.png") 4x)`:b===2&&(Z=`${W.WEBKIT_CSS}image-set(${j} 1x, url("${L}4${T?"_trans":""}.png") 2x)`):Z=j),r&&h&&h!=="transparent"&&(h=r.process(h)||h),c&&M&&M!=="transparent"&&h!=="transparent"&&(c.base=h,M=c.process(M)||M),L||(m>4?m=1:m>3&&(m=2)),`${k&&(C.click_handler||C.click_url||C.click_action)?"cursor:pointer;":""}${O?"filter:invert(100%);":""}${n[m]({scale:1,color:h,fore:M,image:j,image_set:Z,svg:P})}${C.css||""}`}G(i,"generateBadgeCSS");const e=class e extends I.default{constructor(...p){super(...p),this.inject("i18n"),this.inject("settings"),this.inject("tooltips"),this.inject("experiments"),this.inject("staging"),this.inject("load_tracker"),this.style=new B.ManagedStyle("badges"),this.bulk=new Map,this._woofer_months={},this.badges={},this.twitch_badges={},W.IS_FIREFOX&&this.settings.add("chat.badges.media-queries",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use @media queries to support High-DPI Badge images in Mozilla Firefox.",description:"This is required to see high-DPI badges on Firefox because Firefox still has yet to support `image-set()` after more than five years. It may be less reliable.",component:"setting-check-box"}}),this.settings.add("chat.badges.version",{default:2,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Version",component:"setting-select-box",data:[{value:1,title:"1 (Pre December 2019)"},{value:2,title:"2 (Current)"}]}}),this.settings.add("chat.badges.clickable",{default:2,process(C,m){return m===!0?2:m===!1?0:m},ui:{path:"Chat > Badges >> Behavior",title:"Allow clicking badges.",description:"Certain badges, such as Prime Gaming, act as links when this is enabled.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Legacy (Open URLs)"},{value:2,title:"Open Badge Card"}]}}),this.settings.add("chat.badges.fix-colors",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Adjust badge colors for visibility.",description:`Ensures that badges are visible against the current background.

**Note:** Only affects badges with custom rendering. Subscriber badges, bit badges, etc. are not affected.`,component:"setting-check-box"}}),this.settings.add("chat.badges.hidden",{default:{},type:"object_merge",ui:{path:"Chat > Badges >> tabs ~> Visibility",title:"Visibility",component:"badge-visibility",getBadges:C=>this.getSettingsBadges(!0,C)}}),this.settings.add("chat.badges.custom-mod",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use custom moderator badges where available.",component:"setting-check-box"}}),this.settings.add("chat.badges.custom-vip",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use custom VIP badges where available.",component:"setting-check-box"}}),this.settings.add("chat.badges.style",{default:1,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Style",component:"setting-select-box",data:[{value:0,title:"Square"},{value:1,title:"Rounded"},{value:2,title:"Circular"},{value:3,title:"Circular (Color Only)"},{value:4,title:"Circular (Color Only, Small)"},{value:5,title:"Transparent"},{value:6,title:"Transparent (Colored)"}]}}),this.handleClick=this.handleClick.bind(this)}getSettingsBadges(p,C){const m=[],x=[],$=[],r=[],c=[],b=[],k={},h=[];if(!Object.keys(this.twitch_badges).length&&C){const P=this.resolve("site.twitch_data");P&&P.getBadges().then(j=>{this.updateTwitchBadges(j),C()})}for(const P in this.twitch_badges)if((0,R.has)(this.twitch_badges,P)){const j=this.twitch_badges[P],Z=[];let q=j&&(j[1]||j[0]);for(const X in j)if(X!=="__cat"&&(0,R.has)(j,X)){const ee=j[X];q||(q=ee),ee&&ee.image1x&&Z.push({version:X,name:ee.title,image:ee.image1x,styleImage:`url("${ee.image1x}")`})}if(q){let X;j.__cat==="m-other"?X=x:j.__cat==="m-owl"?X=$:j.__cat==="m-tcon"?X=r:j.__cat==="m-game"?X=c:X=m,X.push({id:P,provider:"twitch",name:q.title,color:"transparent",image:q.image2x,versions:Z,styleImage:`url("${q.image2x}")`})}}if(p){const P={};for(const[j,Z]of Object.entries(this.badges)){if(Z.no_visibility)continue;let q=Z.urls?Z.urls[2]||Z.urls[1]:Z.image,X=Z.urls?.[1]||Z.image,ee=Z.color||"transparent";Z.addon||(q=`//cdn.frankerfacez.com/badge/${Z.id}/2/rounded`,X=`//cdn.frankerfacez.com/badge/${Z.id}/1/rounded`,ee="transparent");let te;typeof Z.addon=="string"?te=k[Z.addon]=k[Z.addon]||[]:te=Z.addon?h:b;let ne=Z.title,pe;try{pe=(0,R.maybe_call)(Z.tooltipExtra,this,null,Z)}catch{pe=null}pe&&!(pe instanceof Promise)&&(ne=ne+pe);const oe=Z.base_id??j,de=oe===j;let me=P[oe];me?(me.versions||(me.versions=[{version:me.key,name:me.tipname,color:me.color,image:me.image1x,styleImage:`url("${me.image1x}")`}]),me.versions.push({version:j,name:ne,color:ee,image:X,styleImage:`url("${X}")`}),de&&(me.name=Z.title,me.tipname=ne,me.color=ee,me.image=q,me.styleImage=`url("${q}")`)):(me={id:oe,key:j,provider:"ffz",name:Z.title,tipname:ne,color:ee,image:q,image1x:X,styleImage:`url("${q}")`},Z.base_id&&(me.always_versions=!0,me.versions=[{version:me.key,name:me.tipname,color:me.color,image:me.image1x,styleImage:`url("${me.image1x}")`}]),P[oe]=me,te.push(me))}}const L=[{title:"Twitch",id:"m-twitch",badges:m},{title:"Twitch: TwitchCon",id:"m-tcon",badges:r},{title:"Twitch: Other",id:"m-other",badges:x},{title:"Twitch: Overwatch League",id:"m-owl",badges:$},{title:"Twitch: Game",id:"m-game",key:"game",badges:c}];b.length&&L.push({title:"FrankerFaceZ",id:"m-ffz",badges:b});const T=this.resolve("addons"),O=[];for(const[P,j]of Object.entries(k)){const Z=T?.getAddon?.(P),q=Z?.short_name??Z?.name??P;O.push({title:`Add-On: ${q}`,id:`m-addon-${P}`,badges:j})}return O.sort((P,j)=>P.title.localeCompare(j.title)),L.push(...O),h.length&&L.push({title:"Add-on",id:"m-addon",badges:h}),L}onEnable(){this.parent.context.on("changed:chat.badges.custom-mod",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.custom-vip",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.style",this.rebuildAllCSS,this),this.parent.context.on("changed:theme.is-dark",this.rebuildAllCSS,this),this.parent.context.on("changed:theme.tooltips-dark",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.version",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.media-queries",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.fix-colors",this.rebuildColoredBadges,this),this.parent.context.on("changed:chat.badges.clickable",this.rebuildAllCSS,this),this.rebuildAllCSS(),this.loadGlobalBadges(),this.on("chat:reload-data",p=>{(!p||p.badges)&&this.loadGlobalBadges()}),this.on("addon:fully-unload",p=>{let C=0;for(const[m,x]of Object.entries(this.badges))x?.__source===p&&(C++,this.removeBadge(m,!1));C&&(this.log.debug(`Cleaned up ${C} entries when unloading addon:`,p),this.generateBadgeCSS())}),this.tooltips.types.badge=(p,C)=>{C.add_class="ffz__tooltip--badges";const m=this.parent.context.get("tooltip.badge-images"),x=this.getBadgeData(p);if(x.data==null)return z.NoContent;const $=[];let r=!1;for(const c of x.data){let b=null;c.room&&(b=this.resolve("site.chat")?.shared_room_data?.get(c.room)?.displayName,b&&(b=`

${b}`));const k=c.provider;if(k==="twitch"){const h=this.getTwitchBadge(c.badge,c.version,x.room_id,x.room_login),M=this.getTwitchBadge(c.badge,c.version,null,null,!0)||{};if(!h)continue;let L=h.title||M.title;const T=h.tier||M.tier;c.data&&(c.badge==="subscriber"?T>0?L=this.i18n.t("badges.subscriber.tier-months",`{title}
(Tier {tier}, {months, plural, one {# Month} other {# Months}})`,{title:L,tier:T,months:c.data}):L=this.i18n.t("badges.subscriber.months",`{title}
({count, plural, one {# Month} other {# Months}})`,{title:L,count:c.data}):c.badge==="founder"&&(L=this.i18n.t("badges.founder.months",`{title}
(Subscribed for {count, plural, one {# Month} other {# Months}})`,{title:L,count:c.data}))),$.push((0,B.createElement)("div",{class:"ffz-badge-tip"},m&&(0,B.createElement)("img",{class:"preview-image ffz-badge",src:h.image4x}),L,b))}else if(k==="ffz"){const h=this.badges[c.id],M=c.badge,L=(0,R.maybe_call)(M?.tooltipExtra??h?.tooltipExtra,this,x,M,p,C);L instanceof Promise?(r=!0,$.push(L.then(T=>(0,B.createElement)("div",{class:"ffz-badge-tip"},m&&c.image&&(0,B.createElement)("div",{class:"preview-image ffz-badge",style:{backgroundColor:c.color,backgroundImage:`url("${c.image}")`}}),c.title,T||"",b)))):$.push((0,B.createElement)("div",{class:"ffz-badge-tip"},m&&c.image&&(0,B.createElement)("div",{class:"preview-image ffz-badge",style:{backgroundColor:c.color,backgroundImage:`url("${c.image}")`}}),c.title,L||"",b))}}return r?Promise.all($):$}}getAddonProxy(p,C,m){if(!p)return this;const x=W.DEBUG||(C?.dev??!1),$=(0,R.makeAddonIdChecker)(p),r={},c={};return r.loadBadgeData=(b,k,...h)=>(k&&k.addon===void 0&&(k.addon=p),x&&!$.test(b)&&m.log.warn("[DEV-CHECK] Call to chat.badges.loadBadgeData() did not include addon ID in badge_id:",b),this.loadBadgeData(b,k,...h)),x&&(r.removeBadge=(b,...k)=>{const h=this.badges[b];return h&&h.addon!==p&&m.log.warn("[DEV-CHECK] Removed un-owned badge with chat.badges.removeBadge():",key," owner:",h.addon??"ffz"),this.removeBadge(b,...k)},r.setBulk=(b,...k)=>($.test(b)||m.log.warn("[DEV-CHECK] Call to chat.badges.setBulk() did not include addon ID in source:",b),this.setBulk(b,...k)),r.deleteBulk=(b,...k)=>($.test(b)||m.log.warn("[DEV-CHECK] Call to chat.badges.deleteBulk() did not include addon ID in source:",b),this.deleteBulk(b,...k)),r.extendBulk=(b,...k)=>($.test(b)||m.log.warn("[DEV-CHECK] Call to chat.badges.extendBulk() did not include addon ID in source:",b),this.extendBulk(b,...k)),c.badges="Please use loadBadgeData() or removeBadge()"),(0,I.buildAddonProxy)(m,this,"chat.badges",r,c)}getBadgeData(p){let C=p.parentElement?.parentElement;C?.dataset?.roomId||(C=p.closest("[data-room-id]"));const m=C?.dataset?.roomId,x=C?.dataset?.room,$=C?.dataset?.userId,r=C?.dataset?.user;let c;if(p.dataset.badgeData)c=JSON.parse(p.dataset.badgeData);else{const b=p.dataset.badgeIdx;let k;if(C.message)k=C.message;else{const h=this.resolve("site.fine");if(h){if(k=C[h.accessor]?.return?.stateNode?.props?.message,k||(k=h.searchParent(C,M=>M.props?.message)?.props?.message),!k&&this.root.flavor==="clips"){const M=this.resolve("site.chat.line"),L=h.searchParent(C,T=>T.props?.node)?.props?.node;M&&L&&(k=M.messages.get(L))}k||(k=h.searchParent(C,M=>M.props?.node)?.props?.node?._ffz_message),k||(k=h.searchParent(C,M=>M.props?.messageContext)?.props?.messageContext?.comment?._ffz_message),k||(k=h.searchParent(C,M=>M._ffzIdentityMsg,50)?._ffzIdentityMsg)}}k?._ffz_message&&(k=k._ffz_message),k&&(c=k.ffz_badge_cache?.[b]?.[1]?.badges)}return{room_id:m,room_login:x,user_id:$,user_login:r,data:c}}handleClick(p){const C=this.parent.context.get("chat.badges.clickable");if(!C)return;const m=p.target,x=this.getBadgeData(m);if(x.data==null)return;let $=null,r=null;for(const c of x.data){const b=c.provider;if(b==="twitch"){const k=this.getTwitchBadge(c.badge,c.version,x.room_id,x.room_login),h=this.getTwitchBadge(c.badge,c.version,null,null,!0)||{};if(!k)continue;C==1&&k.click_url?$=k.click_url:C==1&&h.click_url?$=h.click_url:C==1&&(k.click_action==="sub"||h.click_action==="sub")&&x.room_login?$=`https://www.twitch.tv/subs/${x.room_login}`:r=k;break}else if(b==="ffz"){const k=this.badges[m.dataset.badge];if(k?.click_handler){$=k.click_handler(x.user_id,x.user_login,x.room_id,x.room_login,x.data,p);break}if(k?.click_url){$=k.click_url;break}}}if(r){const c=this.resolve("site.fine");if(c){const b=c.searchParent(m,k=>k.openBadgeDetails&&k.props?.message);if(b){b.openBadgeDetails(r,p);return}}}$&&(0,B.createElement)("a",{target:"_blank",rel:"noopener noreferrer",href:$}).click(),p.preventDefault()}cacheBadges(p,C=!1){if(p.ffz_badge_cache)return p.ffz_badge_cache;const m=C?{}:this.parent.context.get("chat.badges.hidden")||{},x=this.parent.context.get("chat.badges.style"),$=this.parent.context.get("chat.badges.custom-mod"),r=this.parent.context.get("chat.badges.custom-vip"),c=x>5,b=x!==5,k=x!==3&&x!==4,h=this.twitch_badges,M=new Map,L=p.badges||{},T=p.badgeDynamicData||{},O=p.sourceRoomID?p.sourceRoomID:p.roomID,P=p.sourceRoomID?null:p.roomLogin,j=this.parent.getRoom(O,P,!0),Z=p.ffz_badges;let q=50,X;for(const ee in L)if((0,R.has)(L,ee)){const te=L[ee],ne=m[ee],pe=h&&h[ee],oe=pe&&pe.__cat||"m-twitch";if(!ee||ne||ne==null&&m[oe])continue;(0,R.has)(f,ee)?X=f[ee]:X=q++;const de=T[ee]||ee==="founder"&&T.subscriber,me=ee==="moderator"&&$&&j&&j.data&&j.data.mod_urls,Ee=ee==="vip"&&r&&j&&j.data&&j.data.vip_badge,xe=[];if(me){const Te=this.getTwitchBadge(ee,te,O,P);xe.push({provider:"ffz",image:me[4]||me[2]||me[1],color:"#34ae0a",title:Te?Te.title:"Moderator",room:O,data:de})}else if(Ee){const Te=this.getTwitchBadge(ee,te,O,P);xe.push({provider:"ffz",image:Ee[4]||Ee[2]||Ee[1],color:"transparent",title:Te?Te.title:"VIP",room:O,data:de})}else xe.push({provider:"twitch",badge:ee,version:te,room:O,data:de});M.set(X,{id:ee,props:{"data-provider":"twitch","data-badge":ee,"data-version":te,style:{}},badges:xe})}if(Array.isArray(Z)){const ee=new Set;for(const te of Z)if(te&&te.id!=null){if(ee.has(te.id))continue;ee.add(te.id);const ne=this.badges[te.id]||{},pe=typeof ne.addon=="string"?`m-addon-${ne.addon}`:ne.addon?"m-addon":"m-ffz",oe=te.base_id??te.id,de=m[oe];if(de||de==null&&m[pe])continue;const me=(0,R.has)(te,"slot")?te.slot:ne.slot,Ee=M.get(me),xe=te.urls||(te.image?{1:te.image}:null),Te=te.color||ne.color||"transparent",Pe=te.no_invert,Se=Te!=="transparent"&&c,re=xe||ne.urls||{1:ne.image},ie={provider:"ffz",id:te.id,badge:te,room:te.room,image:re[4]||re[2]||re[1],color:te.color||ne.color,title:te.title||ne.title};ne.addon||(ie.image=`//cdn.frankerfacez.com/badge/${te.id}/4/rounded`,ie.color=null);let fe;if(Ee){Ee.badges.push(ie);const ge=(0,R.has)(te,"replaces")?te.replaces:ne.replaces,ve=te.replaces_type||ne.replaces_type;if(ge&&(!ve||ve===Ee.id))Ee.replaced=te.id,Ee.content=te.content||ne.content||Ee.content;else continue;fe=Ee.props.style}else{if(me==null)continue;{fe={};const ge={className:"ffz-tooltip ffz-badge","data-tooltip-type":"badge","data-provider":"ffz","data-badge":te.id,style:fe};M.set(me,{id:te.id,props:ge,badges:[ie],content:te.content||ne.content})}}if(Pe){const ge=M.get(me);ge.full_size=!0,ge.no_invert=!0,fe.background="unset",fe.backgroundSize="unset",fe[S]="unset"}if((k||Te==="transparent")&&xe){const ge=`url("${xe[1]}")`;let ve;(xe[2]||xe[4])&&(ve=`${W.WEBKIT_CSS}image-set(${ge} 1x${xe[2]?`, url("${xe[2]}") 2x`:""}${xe[4]?`, url("${xe[4]}") 4x`:""})`),fe[Se&&!Pe?S:"backgroundImage"]=ge,ve&&(fe[Se&&!Pe?S:"backgroundImage"]=ve)}b&&te.color&&(Se&&!Pe?fe.backgroundImage=`linear-gradient(${te.color},${te.color})`:fe.backgroundColor=te.color)}}return p.ffz_badge_cache=Array.from(M).sort((ee,te)=>ee[0]-te[0])}render(p,C,m=!1,x=!1){if(!p.badges&&!p.ffz_badges||(p.ffz_badge_cache||this.cacheBadges(p,m),!p.ffz_badge_cache.length))return null;const $=[];for(let r=0,c=p.ffz_badge_cache.length;r<c;r++){const b=p.ffz_badge_cache[r][1],k=b.props;let h=(0,R.maybe_call)(b.content,this,b,p,C);h&&!Array.isArray(h)&&(h=[h]),k.className=`ffz-tooltip ffz-badge${h?" tw-pd-x-05":""}${b.full_size?" ffz-full-size":""}${b.no_invert?" ffz-no-invert":""}`,k.key=`${k["data-provider"]}-${k["data-badge"]}`,k["data-tooltip-type"]="badge",k["data-badge-idx"]=r,x||(k.onClick=this.handleClick),b.replaced&&(k["data-replaced"]=b.replaced),$.push(C("span",k,h||void 0))}return $}rebuildColor(){this.parent.context.get("chat.badges.fix-colors")?(this.fg_fixer=new U.ColorAdjuster("#fff",1,4.5),this.color_fixer=new U.ColorAdjuster(this.parent.context.get("theme.is-dark")?"#181818":"#FFFFFF",1,2.5)):(this.fg_fixer=null,this.color_fixer=null)}rebuildColoredBadges(){this.rebuildColor(),this.buildBadgeCSS(),this.buildTwitchCSSBadgeCSS()}rebuildAllCSS(){this.rebuildColor();for(const p of this.parent.iterateRooms())p.buildBadgeCSS(),p.buildModBadgeCSS();this.buildBadgeCSS(),this.buildTwitchBadgeCSS(),this.buildTwitchCSSBadgeCSS()}getBadges(p,C,m,x){const $=this.parent.getRoom(m,x,!0),r=this.parent.getUser(p,C,!0);r&&(p=p??r.id,C=C??r.login);const c=$&&$.getUser(p,C,!0),b=(r?.badges?r.badges._cache:[]).concat(c?.badges?c.badges._cache.map(k=>({...k,room:m})):[]);if(this.bulk.size){const k=String(p);for(const[h,M]of this.bulk)M?._cache.has(k)&&b.push({id:h})}return b}setBulk(p,C,m){let x=this.bulk.get(C);x||this.bulk.set(C,x=new R.SourcedSet(!0)),x.set(p,m)}deleteBulk(p,C){const m=this.bulk.get(C);m&&m.delete(p)}extendBulk(p,C,m){let x=this.bulk.get(C);x||this.bulk.set(C,x=new R.SourcedSet(!0)),Array.isArray(m)||(m=[m]),x.extend(p,...m)}async loadGlobalBadges(p=0){this.load_tracker.schedule("chat-data","ffz-global-badges");let C,m;if(this.experiments.getAssignment("api_load")&&p<1)try{fetch(`${W.NEW_API}/v1/badges/ids`).catch(()=>{})}catch{}try{C=await fetch(`${this.staging.api}/v1/badges/ids`)}catch(r){return p++,p<10?setTimeout(()=>this.loadGlobalBadges(p),500*p):(this.log.error("Error loading global badge data.",r),this.load_tracker.notify("chat-data","ffz-global-badges",!1),!1)}if(!C.ok)return this.load_tracker.notify("chat-data","ffz-global-badges",!1),!1;try{m=await C.json()}catch(r){return this.log.error("Error parsing global badge data.",r),this.load_tracker.notify("chat-data","ffz-global-badges",!1),!1}let x=0,$=0;if(m.badges)for(const r of m.badges)r&&r.id&&(this.loadBadgeData(r.id,r,!1),x++);if(m.users){for(const r in m.users)if((0,R.has)(m.users,r)){const c=this.badges[r],b=c?.name;let k=0;if(b==="supporter"||b==="subwoofer"||b==="bot")this.setBulk("ffz-global",r,m.users[r].map(h=>String(h))),k=m.users[r].length;else for(const h of m.users[r])this.parent.getUser(h,void 0).addBadge("ffz-global",r)&&(k++,$++);k>0&&this.log.info(`Added "${c?c.name:`#${r}`}" to ${k} users.`)}}this.log.info(`Loaded ${x} badges and assigned them to ${$} users.`),this.buildBadgeCSS(),this.load_tracker.notify("chat-data","ffz-global-badges")}getBadge(p){return this.badges[p]??null}removeBadge(p,C=!0){this.badges[p]&&(delete this.badges[p],C&&this.buildBadgeCSS())}loadBadgeData(p,C,m=!0){this.badges[p]=C,C&&(C.addon===void 0&&(C.addon=/^addon/.test(p)),C.replaces&&!C.replaces_type&&(C.replaces_type=C.replaces,C.replaces=!0),!C.addon&&(C.name==="developer"||C.name==="subwoofer"||C.name==="supporter")&&(C.click_url="https://www.frankerfacez.com/subscribe"),!C.addon&&C.name==="subwoofer"&&(C.base_id=C.id,C.tooltipExtra=x=>x?.user_id?this.getSubwooferMonths(x.user_id).then($=>{if($?.months)return $.lifetime?`
`+this.i18n.t("badges.subwoofer.lifetime","Lifetime Subwoofer"):`
`+this.i18n.t("badges.subwoofer.months","({count, plural, one {# Month} other {# Months}})",{count:$.months})}):null)),m&&this.buildBadgeCSS()}getSubwooferMonths(p){let C=this._woofer_months[p];if(C instanceof Promise)return C;const m=C?.expires;return m&&Date.now()>=m&&(C=this._woofer_months[p]=null),C?.value?Promise.resolve(C.value):this._woofer_months[p]=fetch(`https://api.frankerfacez.com/v1/_user/id/${p}`).then(x=>x.ok?x.json():null).then(x=>{let $=null;return x?.user?.sub_months&&($={months:x.user.sub_months,lifetime:x.user.sub_lifetime}),this._woofer_months[p]={expires:Date.now()+3e5,value:$},$}).catch(x=>(console.error("Error getting subwoofer data for user",p,x),this._woofer_months[p]={expires:Date.now()+6e4,value:null},null))}buildBadgeCSS(){const p=this.parent.context.get("chat.badges.style"),C=this.parent.context.get("theme.is-dark"),m=this.parent.context.get("chat.badges.clickable"),x=W.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),$=[];for(const r in this.badges)if((0,R.has)(this.badges,r)){const c=this.badges[r],b=`.ffz-badge[data-badge="${r}"]`;$.push(`.ffz-badge[data-replaced="${r}"]{${s(c,p,C)}}`),x?($.push(`@media (max-resolution: 99dpi) {${b}{${i(r,0,c,p,C,0,this.color_fixer,this.fg_fixer,1,m)}}}`),$.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) {${b}{${i(r,0,c,p,C,0,this.color_fixer,this.fg_fixer,2,m)}}}`),$.push(`@media (min-resolution: 200dpi) {${b}{${i(r,0,c,p,C,0,this.color_fixer,this.fg_fixer,4,m)}}}`)):$.push(`${b}{${i(r,0,c,p,C,0,this.color_fixer,this.fg_fixer,void 0,m)}}`)}this.style.set("ext-badges",$.join(`
`))}getTwitchBadge(p,C,m,x,$=!1){const r=this.parent.getRoom(m,x,!0);let c;if(r){const b=r.badges&&r.badges[p];c=b&&b[C]}if(!c){const b=this.twitch_badges&&this.twitch_badges[p];c=b&&b[C]}if(!c&&!$){const b=this.resolve("site.chat");b&&b.tryUpdateBadges&&b.tryUpdateBadges()}return c}getTwitchBadgeCount(){return this.twitch_badge_count||0}updateTwitchBadges(p){if(this.twitch_badge_count=0,!p)this.twitch_badges={};else if(!Array.isArray(p))this.twitch_badges=p;else{let C=null;if(p.length){C={};for(const m of p){const x=m.setID,$=C[x]=C[x]||{__cat:_(x)};this.twitch_badge_count++,$[m.version]=o(m)}}this.twitch_badges=C}this.buildTwitchBadgeCSS(),this.buildTwitchCSSBadgeCSS()}buildTwitchCSSBadgeCSS(){const p=this.parent.context.get("chat.badges.style"),C=this.parent.context.get("theme.is-dark"),m=this.parent.context.get("chat.badges.clickable"),x=W.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),$=this.parent.context.get("chat.badges.version"),r=v[$]||{},c=this.twitch_badges||{},b=[];for(const k in r)if((0,R.has)(r,k)){const h=r[k],M=c[k];for(const L in h)if((0,R.has)(h,L)){const T=h[L],O=M?.[L],P=`.ffz-badge[data-badge="${k}"][data-version="${L}"]`;O&&O.click_url&&(T.click_url=O.click_url),O&&O.click_action&&(T.click_action=O.click_action),x?(b.push(`@media (max-resolution: 99dpi) {${P}{${i(k,L,T,p,C,$,this.color_fixer,this.fg_fixer,1,m)}}}`),b.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) {${P}{${i(k,L,T,p,C,$,this.color_fixer,this.fg_fixer,2,m)}}}`),b.push(`@media (min-resolution: 200dpi) {${P}{${i(k,L,T,p,C,$,this.color_fixer,this.fg_fixer,4,m)}}}`)):b.push(`${P}{${i(k,L,T,p,C,$,this.color_fixer,this.fg_fixer,void 0,m)}}`)}}this.style.set("css-badges",b.join(`
`))}buildTwitchBadgeCSS(){this.twitch_badges||this.style.delete("twitch-badges");const p=this.parent.context.get("chat.badges.version"),C=W.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),m=this.parent.context.get("chat.badges.clickable"),x=v[p]||{},$=[];for(const r in this.twitch_badges)if((0,R.has)(this.twitch_badges,r)){if((0,R.has)(x,r))continue;const c=this.twitch_badges[r];for(const b in c)if((0,R.has)(c,b)){const k=c[b],h=`.ffz-badge[data-badge="${r}"][data-version="${b}"]`;$.push(`${h} {
			${m&&(k.click_action||k.click_url)?"cursor:pointer;":""}
			background-color: transparent;
			filter: none;
			${W.WEBKIT_CSS}mask-image: none;
			background-size: 1.8rem;
			background-image: url("${k.image1x}");
			background-image: ${W.WEBKIT_CSS}image-set(
				url("${k.image1x}") 1x,
				url("${k.image2x}") 2x,
				url("${k.image4x}") 4x
			);
		}`),C&&($.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) { ${h} {
								background-image: url("${k.image2x}");
							}}`),$.push(`@media (min-resolution: 200dpi) { ${h} {
								background-image: url("${k.image4x}");
							}}`))}}$.length?this.style.set("twitch-badges",$.join(`
`)):this.style.delete("twitch-badges")}};G(e,"Badges");let l=e;const w=["vga-champ-2017","warcraft","samusoffer_beta","power-rangers","bits-charity","glhf-pledge"];function _(a){return w.includes(a)?"m-other":a.startsWith("overwatch-league")?"m-owl":a.startsWith("twitchcon")||a.startsWith("glitchcon")?"m-tcon":/_\d+$/.test(a)?"m-game":"m-twitch"}G(_,"getBadgeCategory");function o(a){if(!a)return a;if(a={...a},!a.clickAction&&a.onClickAction&&(a.clickAction=a.onClickAction),a.clickAction==="VISIT_URL"&&a.clickURL&&(a.click_url=a.clickURL),a.clickAction==="TURBO"&&(a.click_url="https://www.twitch.tv/products/turbo?ref=chat_badge"),a.clickAction==="SUBSCRIBE"&&a.channelName?a.click_url=`https://www.twitch.tv/subs/${a.channelName}`:a.clickAction&&(a.click_action="sub"),a.setID==="subscriber"){const p=parseInt(a.version,10);!isNaN(p)&&isFinite(p)?(a.tier=(p-p%1e3)/1e3,a.tier<0&&(a.tier=0)):a.tier=0}return a}G(o,"fixBadgeData")},49276:(ae,J,d)=>{"use strict";d.d(J,{D3:()=>v,Dk:()=>s,Vf:()=>w,ZP:()=>o,aA:()=>f,of:()=>u});var W=d(22527),B=d(24431),R=d(46949),I=d(83269),U=d(5199),z=d.n(U);const v=["component"],f={"smileys-emotion":"Smileys & Emotions","people-body":"People",component:"Components","animals-nature":"Animals & Nature","food-drink":"Food & Drink","travel-places":"Travel & Places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"},u=Object.keys(f),y={1:"1f3fb",2:"1f3fc",3:"1f3fd",4:"1f3fe",5:"1f3ff"};let S=!0,n;try{n=new RegExp("(?<!\\u{E0002})\\u{E0002}","gu")}catch{S=!1,n=null}const s=n,i=/\u{200D}/gu,l="\u{E0002}",w={google:"noto",twitter:"twemoji",open:"openmoji",blob:"blob"};function _(p){let C=typeof p=="number"?p:parseInt(p,16);return C<65536?String.fromCharCode(C):(C-=65536,String.fromCharCode(55296+(C>>10),56320+(C&1023)))}G(_,"codepoint_to_emoji");const a=class a extends W.default{constructor(...C){super(...C),this.inject("..emotes"),this.inject("settings"),S?this.settings.add("chat.emoji.replace-joiner",{default:1,process(m,x){return x===2?1:x},ui:{path:"Chat > Behavior >> Emoji",title:"Emoji Joiner Workaround",description:"This feature is intended to allow the use of combined emoji in supported clients. This is required due to a bug in TMI that strips ZWJ characters from chat messages. [Visit the original issue](https://github.com/FrankerFaceZ/FrankerFaceZ/issues/1147) for more details.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Display Only"},{value:3,title:"Display and Send"}]}}):(this.log.warn('This browser does not support regexp lookbehind. The "Emoji Joiner Workaround" feature will be disabled.'),this.settings.add("chat.emoji.replace-joiner",{process(){return 0}})),this.settings.add("chat.emoji.style",{default:"twitter",process(m,x){return x!=0&&!w[x]?"twitter":x},ui:{path:"Chat > Appearance >> Emoji",title:"Emoji Style",component:"setting-select-box",data:[{value:"twitter",title:"Twitter (Twemoji)"},{value:"google",title:"Google (Noto)"},{value:"blob",title:"Blob"},{value:"open",title:"OpenMoji"},{value:0,title:"Native"}]}}),this.splitter=z()(),this.categories=f,this.emoji={},this.names={},this.chars=new Map}onEnable(){this.on("chat:pre-send-message",C=>{C.context.get("chat.emoji.replace-joiner")<2||(C.message=C.message.replace(i,l))}),this.loadEmojiData()}async loadEmojiData(C=0){let m;try{m=await fetch(`${B.SERVER}/script/emoji/v3.2.json?_${(0,I.getBuster)(60)}`).then(b=>b.ok?b.json():null)}catch(b){return C++,C<10?setTimeout(()=>this.loadEmojiData(C),500*C):(this.log.error("Error loading emoji data.",b),!1)}if(!m)return!1;const x=m.c,$={},r={},c=new Map;for(const b of m.e){const k=Object.assign(e(b.slice(4)),{category:x[b[0]],sort:b[1],names:b[2],name:b[3]});Array.isArray(k.names)||(k.names=[k.names]),k.name||(k.name=k.names[0].replace(/_/g," ")),$[k.code]=k,c.set(k.raw,[k.code,null]);for(const h of k.names)r[h]=k.code;if(b[7]){const h=k.variants={};for(const M of b[7]){if(Array.isArray(M[3])||!M[3]){const O=Object.assign(e(M),{category:x[b[0]],sort:b[1],names:M[5],hidden:!0});Array.isArray(O.names)||(O.names=[O.names]),O.name=O.names[0].replace(/_/g," "),$[O.code]=O,c.set(O.raw,[O.code,null]);for(const P of O.names)r[P]=O.code;continue}const L=y[M[3]];if(!L){console.warn("Unknown tone:",M[3],M,k);continue}const T=Object.assign(e(M),{key:L});h[L]=T,c.set(T.raw,[k.code,T.key])}}}return this.emoji=$,this.names=r,this.chars=c,this.log.info(`Loaded data about ${Object.keys($).length} emoji.`),this.emit(":populated"),!0}getFullImage(C,m){return m||(m=this.parent.context.get("chat.emoji.style")),(0,R.has)(w,m)||(m="twitter"),`${B.SERVER}/static/emoji/images/${w[m]}/${C}`}getFullImageSet(C,m){return m||(m=this.parent.context.get("chat.emoji.style")),(0,R.has)(w,m)||(m="twitter"),`${B.SERVER}/static/emoji/images/${w[m]}/${C} 72w`}};G(a,"Emoji");let o=a;function e(p){let C=p[0];return p[4]===0&&(C=`${C}-fe0f`),{code:C,image:`${p[0]}.png`,raw:C.split("-").map(_).join(""),sheet_x:p[1][0],sheet_y:p[1][1],has:{google:!!(8&p[2]),blob:!!(4&p[2])||!!(8&p[2]),twitter:!!(2&p[2]),open:!!(1&p[2])}}}G(e,"hydrate_emoji")},66866:(ae,J,d)=>{"use strict";d.d(J,{ZP:()=>p,z8:()=>s});var W=d(22527),B=d(44589),R=d(46949),I=d(24431),U=d(98750),z=d.n(U),v=d(60795),f=d.n(v);const u=Symbol("FFZ:Hover:RAF"),y=Symbol("FFZ:Hover:State"),S=I.IS_OSX?"metaKey":"ctrlKey",n=(0,R.make_enum_flags)("Hidden","FlipX","FlipY","GrowX","Slide","Appear","Leave","Rotate","Rotate90","Greyscale","Sepia","Rainbow","HyperRed","Shake","Cursed","Jam","Bounce","NoSpace"),s=n,i=Object.values(s).filter($=>typeof $=="number"),l=[[0,-18,0,0],[19.99,-18,0,0],[20,-18,.1,0],[25,-16,.2,.6],[30,-14,.3,-4],[35,-12,.4,.6],[40,-10,.5,-4],[45,-8,.6,2],[50,-6,.7,-3],[55,-4,.8,2],[60,-2,.9,-3],[65,0,1,0],[100,0,1,0]],w=[[0,0,1,0],[39.99,0,1,0],[40,0,-.9,.9,-3],[45,-2,-.8,.8,2],[50,-4,-.7,.7,-3],[55,-6,-.6,.6,2],[60,-8,-.5,.5,-4],[65,-10,-.4,.4,.6],[70,-12,-.3,.3,-4],[75,-14,-.2,.2,.6],[80,-16,-.1,.1,0],[85,-18,-.01,0,0],[100,-18,0,0,0]];function _($,r=1,c=0,b=!1){const k=[];for(const h of $){const M=h[0]*r+c;let L,T,O,P;if(L=b?"var(--ffz-effect-transforms) ":"",T=h[1]===0?"":`translateX(${h[1]}px) `,h.length===4)O=`scale(${h[2]})`,P=h[3]===0?"":` translateY(${h[3]}px)`;else{const j=h[2],Z=h[3];O=`scale(${j}, ${Z})`,P=h[4]===0?"":` translateY(${h[4]}px)`}k.push(`	${M}% { transform:${L}${T}${O}${P}; }`)}return k.join(`
`)}G(_,"appearLeaveToKeyframes");const o=[{setting:"FlipX",flags:n.FlipX,title:"Flip Horizontal",transform:"scaleX(-1)"},{setting:"FlipY",flags:n.FlipY,title:"Flip Vertical",transform:"scaleY(-1)"},{setting:"ShrinkX",flags:n.ShrinkX,title:"Squish Horizontal"},{setting:"GrowX",flags:n.GrowX,title:"Stretch Horizontal"},{setting:"Slide",flags:n.Slide,title:"Slide Animation",as_background:!0,animation:"ffz-effect-slide var(--ffz-speed-x) linear infinite",raw:`@keyframes ffz-effect-slide {
0% { background-position-x: 0; }
100% { background-position-x: calc(-1 * var(--ffz-width)); }
}`},{setting:"Appear",flags:n.Appear,not_flags:n.Leave,title:"Appear Animation",animation:"ffz-effect-appear 3s infinite linear",animationTransform:"ffz-effect-appear-transform 3s linear infinite",raw:`@keyframes ffz-effect-appear {
${_(l)}
}
@keyframes ffz-effect-appear-transform {
${_(l,1,0,!0)}
}`},{setting:"Leave",flags:n.Leave,not_flags:n.Appear,title:"Leave Animation",animation:"ffz-effect-leave 3s infinite linear",animationTransform:"ffz-effect-leave-transform 3s infinite linear",raw:`@keyframes ffz-effect-leave {
${_(w)}
}
@keyframes ffz-effect-leave-transform {
${_(w,1,0,!0)}
}`},{setting:["Appear","Leave"],flags:n.Appear|n.Leave,animation:"ffz-effect-in-out 6s infinite linear",animationTransform:"ffz-effect-in-out-transform 6s linear infinite",raw:`@keyframes ffz-effect-in-out {
${_(l,.5,0)}
${_(w,.5,50)}
}
@keyframes ffz-effect-in-out-transform {
${_(l,.5,0,!0)}
${_(w,.5,50,!0)}
}`},{setting:"Rotate",flags:n.Rotate,not_flags:n.Slide,title:"Rotate Animation",no_wide:!0,animation:"ffz-effect-rotate 1.5s infinite linear",animationTransform:"ffz-effect-rotate-transform 1.5s infinite linear",raw:`@keyframes ffz-effect-rotate {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
@keyframes ffz-effect-rotate-transform {
0% { transform: var(--ffz-effect-transforms) rotate(0deg); }
100% { transform: var(--ffz-effect-transforms) rotate(360deg); }
}`},{setting:"Rainbow",flags:n.Rainbow,title:"Rainbow Animation",animation:"ffz-effect-rainbow 2s linear infinite",animationFilter:"ffz-effect-rainbow-filter 2s linear infinite",raw:`@keyframes ffz-effect-rainbow {
	0% { filter: hue-rotate(0deg) }
	100% { filter: hue-rotate(360deg) }
}
@keyframes ffz-effect-rainbow-filter {
	0% { filter: var(--ffz-effect-filters) hue-rotate(0deg) }
	100% { filter: var(--ffz-effect-filters) hue-rotate(360deg) }
}`},{setting:"HyperRed",flags:n.HyperRed,title:"Hyper Red",filter:"brightness(0.2) sepia(1) brightness(2.2) contrast(3) saturate(8)"},{setting:"Shake",flags:n.Shake,title:"Hyper Shake Animation",animation:"ffz-effect-shake 0.1s linear infinite",animationTransform:"ffz-effect-shake-transform 0.1s linear infinite",raw:`@keyframes ffz-effect-shake-transform {
	0% { transform: var(--ffz-effect-transforms) translate(1px, 1px); }
	10% { transform: var(--ffz-effect-transforms) translate(-1px, -2px); }
	20% { transform: var(--ffz-effect-transforms) translate(-3px, 0px); }
	30% { transform: var(--ffz-effect-transforms) translate(3px, 2px); }
	40% { transform: var(--ffz-effect-transforms) translate(1px, -1px); }
	50% { transform: var(--ffz-effect-transforms) translate(-1px, 2px); }
	60% { transform: var(--ffz-effect-transforms) translate(-3px, 1px); }
	70% { transform: var(--ffz-effect-transforms) translate(3px, 1px); }
	80% { transform: var(--ffz-effect-transforms) translate(-1px, -1px); }
	90% { transform: var(--ffz-effect-transforms) translate(1px, 2px); }
	100% { transform: var(--ffz-effect-transforms) translate(1px, -2px); }
}
@keyframes ffz-effect-shake {
	0% { transform: translate(1px, 1px); }
	10% { transform: translate(-1px, -2px); }
	20% { transform: translate(-3px, 0px); }
	30% { transform: translate(3px, 2px); }
	40% { transform: translate(1px, -1px); }
	50% { transform: translate(-1px, 2px); }
	60% { transform: translate(-3px, 1px); }
	70% { transform: translate(3px, 1px); }
	80% { transform: translate(-1px, -1px); }
	90% { transform: translate(1px, 2px); }
	100% { transform: translate(1px, -2px); }
}`},{setting:"Photocopy",flags:n.Cursed,title:"Cursed",filter:"grayscale(1) brightness(0.7) contrast(2.5)"},{setting:"Jam",flags:n.Jam,title:"Jam Animation",animation:"ffz-effect-jam 0.6s linear infinite",animationTransform:"ffz-effect-jam-transform 0.6s linear infinite",raw:`@keyframes ffz-effect-jam {
	0% { transform: translate(-2px, -2px) rotate(-6deg); }
	10% { transform: translate(-1.5px, -2px) rotate(-8deg); }
	20% { transform: translate(1px, -1.5px) rotate(-8deg); }
	30% { transform: translate(3px, 2.5px) rotate(-6deg); }
	40% { transform: translate(3px, 4px) rotate(-2deg); }
	50% { transform: translate(2px, 4px) rotate(3deg); }
	60% { transform: translate(1px, 4px) rotate(3deg); }
	70% { transform: translate(-0.5px, 3px) rotate(2deg); }
	80% { transform: translate(-1.25px, 1px) rotate(0deg); }
	90% { transform: translate(-1.75px, -0.5px) rotate(-2deg); }
	100% { transform: translate(-2px, -2px) rotate(-5deg); }
}
@keyframes ffz-effect-jam-transform {
	0% { transform: var(--ffz-effect-transforms) translate(-2px, -2px) rotate(-6deg); }
	10% { transform: var(--ffz-effect-transforms) translate(-1.5px, -2px) rotate(-8deg); }
	20% { transform: var(--ffz-effect-transforms) translate(1px, -1.5px) rotate(-8deg); }
	30% { transform: var(--ffz-effect-transforms) translate(3px, 2.5px) rotate(-6deg); }
	40% { transform: var(--ffz-effect-transforms) translate(3px, 4px) rotate(-2deg); }
	50% { transform: var(--ffz-effect-transforms) translate(2px, 4px) rotate(3deg); }
	60% { transform: var(--ffz-effect-transforms) translate(1px, 4px) rotate(3deg); }
	70% { transform: var(--ffz-effect-transforms) translate(-0.5px, 3px) rotate(2deg); }
	80% { transform: var(--ffz-effect-transforms) translate(-1.25px, 1px) rotate(0deg); }
	90% { transform: var(--ffz-effect-transforms) translate(-1.75px, -0.5px) rotate(-2deg); }
	100% { transform: var(--ffz-effect-transforms) translate(-2px, -2px) rotate(-5deg); }
}`},{setting:"Bounce",flags:n.Bounce,animation:"ffz-effect-bounce 0.5s linear infinite",animationTransform:"ffz-effect-bounce-transform 0.5s linear infinite",transformOrigin:"bottom center",raw:`@keyframes ffz-effect-bounce {
	0% { transform: scale(0.8, 1); }
	10% { transform: scale(0.9, 0.8); }
	20% { transform: scale(1, 0.4); }
	25% { transform: scale(1.2, 0.3); }
	25.001% { transform: scale(-1.2, 0.3); }
	30% { transform: scale(-1, 0.4); }
	40% { transform: scale(-0.9, 0.8); }
	50% { transform: scale(-0.8, 1); }
	60% { transform: scale(-0.9, 0.8); }
	70% { transform: scale(-1, 0.4); }
	75% { transform: scale(-1.2, 0.3); }
	75.001% { transform: scale(1.2, 0.3); }
	80% { transform: scale(1, 0.4); }
	90% { transform: scale(0.9, 0.8); }
	100% { transform: scale(0.8, 1); }
}
@keyframes ffz-effect-bounce-transform {
	0% { transform: scale(0.8, 1) var(--ffz-effect-transforms); }
	10% { transform: scale(0.9, 0.8) var(--ffz-effect-transforms); }
	20% { transform: scale(1, 0.4) var(--ffz-effect-transforms); }
	25% { transform: scale(1.2, 0.3) var(--ffz-effect-transforms); }
	25.001% { transform: scale(-1.2, 0.3) var(--ffz-effect-transforms); }
	30% { transform: scale(-1, 0.4) var(--ffz-effect-transforms); }
	40% { transform: scale(-0.9, 0.8) var(--ffz-effect-transforms); }
	50% { transform: scale(-0.8, 1) var(--ffz-effect-transforms); }
	60% { transform: scale(-0.9, 0.8) var(--ffz-effect-transforms); }
	70% { transform: scale(-1, 0.4) var(--ffz-effect-transforms); }
	75% { transform: scale(-1.2, 0.3) var(--ffz-effect-transforms); }
	75.001% { transform: scale(1.2, 0.3) var(--ffz-effect-transforms); }
	80% { transform: scale(1, 0.4) var(--ffz-effect-transforms); }
	90% { transform: scale(0.9, 0.8) var(--ffz-effect-transforms); }
	100% { transform: scale(0.8, 1) var(--ffz-effect-transforms); }
}`},{setting:["Bounce","FlipY"],flags:n.Bounce|n.FlipY,transform:"translateY(100%)"}];function e(){const $=[`.modified-emote[data-effects] > .chat-line__message--emote {
	--ffz-effect-filters: none;
	--ffz-effect-transforms: initial;
	--ffz-effect-animations: initial;
}`];for(const r of o)r.raw&&$.push(r.raw);return $.join(`
`)}G(e,"generateBaseFilterCss");const a={59847:{modifier_offset:"0 15px 15px 0",modifier:!0},70852:{modifier:!0,modifier_offset:"0 5px 20px 0",extra_width:5,shrink_to_fit:!0},70854:{modifier:!0,modifier_offset:"30px 0 0"},147049:{modifier:!0,modifier_offset:"4px 1px 0 3px"},147011:{modifier:!0,modifier_offset:"0"},70864:{modifier:!0,modifier_offset:"0"},147038:{modifier:!0,modifier_offset:"0"}},x=class x extends W.default{constructor(...r){super(...r),this.EmoteTypes=I.EmoteTypes,this.ModifierFlags=s,this.filters={},this.__filters=[],this.inject("i18n"),this.inject("settings"),this.inject("experiments"),this.inject("staging"),this.inject("load_tracker"),this.twitch_inventory_sets=new Set,this.__twitch_emote_to_set={},this.__twitch_set_to_channel={},this.__twitch_emote_to_artist={},this.bulk=new Map,this.effects_enabled={},this.pending_effects=new Set,this.applyEffects=this.applyEffects.bind(this),this.sub_sets=new R.SourcedSet,this.default_sets=new R.SourcedSet,this.global_sets=new R.SourcedSet,this.providers=new Map,this.setProvider("ffz",{name:"FrankerFaceZ",font_icon:"ffz-i-zreknarf"}),this.emote_sets={},this._set_refs={},this._set_timers={},this.settings.add("chat.emotes.source-priorities",{default:null,ui:{path:"Chat > Emote Priorities",component:"emote-priorities",data:()=>(0,R.deep_copy)(this.providers)}}),this.settings.add("chat.emotes.enabled",{default:2,ui:{path:"Chat > Appearance >> Emotes",title:"Display Emotes",sort:-100,force_seen:!0,description:"If you do not wish to see emotes, you can disable them here.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch Only"},{value:2,title:"Enabled"}]}}),this.settings.add("chat.emotes.2x",{default:0,process(c,b){return b===!0?1:b===!1?0:b},ui:{path:"Chat > Appearance >> Emotes",title:"Larger Emotes",description:"This setting will make emotes appear twice as large in chat. It's good for use with larger fonts or just if you really like emotes.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Emotes"},{value:2,title:"Emotes and Emoji"}]}}),this.settings.add("chat.emotes.limit-size",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:"Limit Native Emote Size",description:"Sometimes, really obnoxiously large emotes slip through the cracks and wind up on Twitch. This limits the size of Twitch emotes to mitigate the issue.",component:"setting-check-box"}}),this.settings.add("chat.emotes.allow-gigantify",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:'Allow "Gigantify an Emote" Power-Up',description:"How big is too big? Giant? Disable this and the emotes will be displayed normally.",component:"setting-check-box"}}),this.settings.add("chat.fix-bad-emotes",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:"Fix Bad Twitch Global Emotes",description:"Clean up the images for bad Twitch global emotes, removing white borders and solid backgrounds.",component:"setting-check-box"}}),this.settings.add("chat.click-emotes",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open emote information pages by Shift-Clicking them.",component:"setting-check-box"}}),this.settings.add("chat.sub-emotes",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open Twitch subscription pages by Shift-Clicking emotes when relevant.",component:"setting-check-box"}}),this.settings.add("chat.emote-dialogs",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open emote information cards for Twitch emotes by clicking them.",component:"setting-check-box"}}),this.settings.add("chat.effects.enable",{default:!0,ui:{path:"Chat > Emote Effects >> General",title:"Enable the use of emote effects.",description:"Emote Effects are special effects that can be applied to some emotes using special modifiers.",component:"setting-check-box"}});for(const c of o){if(!c.setting||Array.isArray(c.setting))continue;const b={default:c.animation?null:!0,ui:{path:'Chat > Emote Effects >> Specific Effect @{"description": "**Note:** Animated effects are, by default, only enabled when [Animated Emotes](~chat.appearance.emotes) are enabled."}',title:`Enable the effect "${c.title??c.setting}".`,component:"setting-check-box",force_seen:!0}};c.animation&&(b.default=null,b.requires=["chat.emotes.animated"],b.process=function(k,h){return h??k.get("chat.emotes.animated")===1}),this.settings.add(`chat.effects.${c.setting}`,b)}this.handleClick=this.handleClick.bind(this),this.animHover=this.animHover.bind(this),this.animLeave=this.animLeave.bind(this)}getAddonProxy(r,c,b){if(!r)return this;const k=I.DEBUG||c?.dev,h=(0,R.makeAddonIdChecker)(r),M={},L={};return M.addFilter=T=>(T&&(T.__source=r),this.addFilter(T)),M.setProvider=(T,O)=>(k&&!h.test(T)&&b.log.warn("[DEV-CHECK] Call to emotes.setProvider did not include addon ID in provider:",T),O&&(O.__source=r),this.setProvider(T,O)),M.addDefaultSet=(T,O,P)=>(k&&!h.test(T)&&b.log.warn("[DEV-CHECK] Call to emotes.addDefaultSet did not include addon ID in provider:",T),this.providers.has(T)||(this.inferProvider(T,r),k&&b.log.warn("[DEV-CHECK] Call to emotes.addDefaultSet for provider that has not been registered with emotes.setProvider:",T)),P&&(k&&!h.test(O)&&b.log.warn("[DEV-CHECK] Call to emotes.addDefaultSet loaded set data but did not include addon ID in set ID:",O),P.__source=r),this.addDefaultSet(T,O,P)),M.addSubSet=(T,O,P)=>(k&&!h.test(T)&&b.log.warn("[DEV-CHECK] Call to emotes.addSubSet did not include addon ID in provider:",T),this.providers.has(T)||(this.inferProvider(T,r),k&&b.log.warn("[DEV-CHECK] Call to emotes.addSubSet for provider that has not been registered with emotes.setProvider:",T)),P&&(k&&!h.test(O)&&b.log.warn("[DEV-CHECK] Call to emotes.addSubSet loaded set data but did not include addon ID in set ID:",O),P.__source=r),this.addSubSet(T,O,P)),M.loadSetData=(T,O,...P)=>(k&&!h.test(T)&&b.log.warn("[DEV-CHECK] Call to emotes.loadSetData did not include addon ID in set ID:",T),O&&(O.__source=r),this.loadSetData(T,O,...P)),k&&(M.removeFilter=T=>{let O;typeof T=="string"?O=T:O=T.type;const P=this.filters[O];return P&&P.__source!==r&&b.log.warn("[DEV-CHECK] Removed un-owned emote filter with emotes.removeFilter:",O," owner:",P.__source??"ffz"),this.removeFilter(T)},M.removeDefaultSet=(T,...O)=>(h.test(T)||b.log.warn("[DEV-CHECK] Call to emotes.removeDefaultSet did not include addon ID in provider:",T),this.removeDefaultSet(T,...O)),M.removeSubSet=(T,...O)=>(h.test(T)||b.log.warn("[DEV-CHECK] Call to emotes.removeSubSet did not include addon ID in provider:",T),this.removeSubSet(T,...O)),L.style=!0,L.effect_style=!0,L.emote_sets=!0,L.loadSetUserIds=L.loadSetUsers="This method is meant for internal use."),(0,W.buildAddonProxy)(b,this,"emotes",M,L)}onEnable(){this.style=new B.ManagedStyle("emotes"),this.effect_style=new B.ManagedStyle("effects"),this.base_effect_css=e(),this.parent.context.getChanges("chat.emotes.source-priorities",this.updatePriorities,this),this.parent.context.on("changed:chat.effects.enable",this.updateEffects,this);for(const b of o)b.setting&&!Array.isArray(b.setting)&&this.parent.context.on(`changed:chat.effects.${b.setting}`,this.updateEffects,this);this.updateEffects();const r=this.getFavorites("twitch");let c=!1;for(let b=0;b<r.length;b++)typeof r[b]=="number"&&(c=!0,r[b]=`${r[b]}`);if(c&&this.setFavorites("twitch",r),Object.keys(this.emote_sets).length){this.log.info("Generating CSS for existing emote sets.");for(const b in this.emote_sets)if((0,R.has)(this.emote_sets,b)){const k=this.emote_sets[b];k&&(k.pending_css||k.css)&&(this.style.set(`es--${b}`,(k.pending_css||"")+(k.css||"")),k.pending_css=null)}}this.on("pubsub:command:follow_sets",this.updateFollowSets,this),this.on("pubsub:command:add_emote",b=>{const k=b.set_id,h=b.emote,M=this.emote_sets[k];if(!M)return;const L=!!M.emotes?.[h.id]||!!M.disabled_emotes?.[h.id],T=this.addEmoteToSet(k,h);this.maybeNotifyChange(L?"modified":"added",k,T)}),this.on("pubsub:command:remove_emote",b=>{const k=b.set_id,h=b.emote_id;if(!this.emote_sets[k])return;const M=this.removeEmoteFromSet(k,h);M&&this.maybeNotifyChange("removed",k,M)}),this.on("chat:reload-data",b=>{(!b||b.emotes)&&this.loadGlobalSets()}),this.on("addon:fully-unload",b=>{let k=0;for(const[h,M]of Object.entries(this.emote_sets))M?.__source===b&&(k++,this.loadSetData(h,null,!0));for(const[h,M]of Object.entries(this.filters))M?.__source===b&&(k++,this.removeFilter(h));for(const[h,M]of this.providers.entries())M?.__source===b&&(k++,this.setProvider(h,null));k&&this.log.debug(`Cleaned up ${k} entries when unloading addon:`,b)}),this.loadGlobalSets()}updatePriorities(r){const c=r?.length;!c||c<=0?this.sourceSortFn=null:this.sourceSortFn=(b,k)=>{b.startsWith("ffz-")&&(b="ffz"),k.startsWith("ffz-")&&(k="ffz");let h=r.indexOf(b),M=r.indexOf(k);return h===-1&&(h=c),M===-1&&(M=c),h-M},this.default_sets.setSortFunction(this.sourceSortFn),this.emit(":update-priorities",this.sourceSortFn)}inferProvider(r,c){if(this.providers.has(r))return;const b=this.resolve("addons")?.getAddon(c);b&&this.setProvider(r,{name:b.name,i18n_key:b.name_i18n,icon:b.icon,description:r,__source:c})}setProvider(r,c){c?(c.id=r,this.providers.set(r,c)):this.providers.delete(r)}addFilter(r,c=!0){const b=r.type;if((0,R.has)(this.filters,b)){this.log.warn(`Tried adding emote filter of type '${b}' when one was already present.`);return}this.filters[b]=r,r.priority==null&&(r.priotiy=0),this.__filters.push(r),this.__filters.sort((k,h)=>k.priority>h.priority?-1:k.priority<h.priority?1:k.type<h.type),c&&this.updateFiltered()}removeFilter(r,c=!0){let b;if(typeof r=="string"?b=r:b=r.type,r=this.filters[b],!r)return null;delete this.filters[b];const k=this.__filters.indexOf(r);return k!==-1&&(this.__filters.splice(k,1),c&&this.updateFiltered()),r}shouldFilterEmote(r,c,b){for(const k of this.__filters)if(k.test(r,c,b))return!0;return!1}updateFiltered(){for(const r of Object.values(this.emote_sets)){const c={},b={};let k=0,h=0,M=!1;for(const T of Object.values(r.emotes))this.shouldFilterEmote(T,r,r.id)?(b[T.id]=T,h++,M=!0):(c[T.id]=T,k++);for(const T of Object.values(r.disabled_emotes))this.shouldFilterEmote(T,r,r.id)?(b[T.id]=T,h++):(c[T.id]=T,k++,M=!0);if(!M)continue;this.log.info(`Filtered emote set #${r.id}: ${r.title} (total: ${k+h}, old: ${r.disabled_count}, new: ${h})`),r.emotes=c,r.count=k,r.disabled_emotes=b,r.disabled_count=h;const L=[];for(const T of Object.values(c)){const O=this.generateEmoteCSS(T);O?.length&&L.push(O)}this.style&&(L.length||r.css)?this.style.set(`es--${r.id}`,L.join("")+(r.css||"")):L.length&&(r.pending_css=L.join("")),this.emit(":loaded",r.id,r)}}maybeNotifyChange(r,c,b){this._pending_notifications||(this._pending_notifications=[]),this._pending_notifications.push({action:r,set_id:c,emote:b}),this._pending_timer||(this._pending_timer=setTimeout(()=>this._handleNotifyChange(),1e3))}_handleNotifyChange(){clearTimeout(this._pending_timer),this._pending_timer=null;const r=this._pending_notifications;this._pending_notifications=null;const c=this.resolve("site.chat");if(!c?.addNotice)return;const b=this.resolve("site").getUser();if(!b?.id)return;let k=this.parent.context.get("context.channelID"),h=this.parent.context.get("context.channel");const M=this.getSetIDs(b.id,b.login,k,h),L={};for(const T of r){const O=`${T.set_id}`,P=T.action;if(M.includes(O)){const j=L[O]=L[O]||{},Z=j[P]=j[P]||[];if(Z.find(q=>q.id===T.emote.id))continue;Z.push(T.emote)}}for(const[T,O]of Object.entries(L)){const P=this.emote_sets[T];if(P)for(const[j,Z]of Object.entries(O)){const q=Z.map(ee=>ee.name).join(", ");let X;j==="added"?X=this.i18n.t("emote-updates.added","The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been added to {set}.",{count:Z.length,emotes:q,set:P.title}):j==="modified"?X=this.i18n.t("emote-updates.modified","The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been updated in {set}.",{count:Z.length,emotes:q,set:P.title}):j==="removed"&&(X=this.i18n.t("emote-updates.removed","The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been removed from {set}.",{count:Z.length,emotes:q,set:P.title})),X&&c.addNotice("*",{icon:"ffz-i-zreknarf",message:X})}}}ensureEffect(r){this.effect_style.has(`${r}`)||(this.pending_effects.add(r),this._effect_timer||(this._effect_timer=requestAnimationFrame(this.applyEffects)))}applyEffects(){this._effect_timer=null;const r=this.pending_effects;this.pending_effects=new Set;for(const c of r){const b=this.generateFilterCss(c);this.effect_style.set(`${c}`,b??"")}}generateFilterCss(r){if(!this.parent.context.get("chat.effects.enable"))return null;let c,b,k,h,M=[];for(const L of this.activeEffectStyles)(r&L.flags)===L.flags&&(L.not_flags&&(r&L.not_flags)===L.not_flags||(L.animation&&M.push(L),L.filter&&(c=c?`${c} ${L.filter}`:L.filter),L.transformOrigin&&(b=L.transformOrigin),L.transform&&(k=k?`${k} ${L.transform}`:L.transform)));if(M.length)for(const L of M)c&&L.animationFilter?h=h?`${h}, ${L.animationFilter}`:L.animationFilter:k&&L.animationTransform?h=h?`${h}, ${L.animationTransform}`:L.animationTransform:h=h?`${h}, ${L.animation}`:L.animation;return!c&&!k&&!h?null:`.modified-emote[data-effects="${r}"] > .chat-line__message--emote {${c?`
	--ffz-effect-filters: ${c};
	filter: var(--ffz-effect-filters);`:""}${b?`
	transform-origin: ${b};`:""}${k?`
	--ffz-effect-transforms: ${k};
	transform: var(--ffz-effect-transforms);`:""}${h?`
	--ffz-effect-animations: ${h};
	animation: var(--ffz-effect-animations);`:""}
}`}updateEffects(){const r=this.parent.context.get("chat.effects.enable");this.effects_enabled={},this.activeEffectStyles=[],this.activeAsBackgroundMask=0,this.activeNoWideMask=0;for(const c of o)c.setting&&!Array.isArray(c.setting)&&(this.effects_enabled[c.setting]=this.parent.context.get(`chat.effects.${c.setting}`));for(const c of o){let b=!0;if(Array.isArray(c.setting)){for(const k of c.setting)if(!this.effects_enabled[k]){b=!1;break}}else c.setting&&(b=this.effects_enabled[c.setting]);b&&(this.activeEffectStyles.push(c),c.as_background&&(this.activeAsBackgroundMask=this.activeAsBackgroundMask|c.flags),c.no_wide&&(this.activeNoWideMask=this.activeNoWideMask|c.flags))}this.effect_style.clear(),!(!r||!this.activeEffectStyles.length)&&(this.effect_style.set("base",this.base_effect_css),this.emit(":update-effects"))}updateFollowSets(r){for(const c in r)if((0,R.has)(r,c)){const b=this.parent.getRoom(null,c,!0);if(!b||b.destroyed)continue;const k=r[c]||[],h=b.emote_sets,M=h&&h._sources;if(M&&M.has("ffz-featured"))for(const L of M.get("ffz-featured")){const T=k.indexOf(L);T===-1?b.removeSet("ffz-featured",L):k.splice(T,1)}for(const L of k)b.addSet("ffz-featured",L),this.emote_sets[L]||this.loadSet(L)}}toggleHidden(r,c,b=null){const k=`hidden-emotes.${r}`,h=this.settings.provider,M=h.get(k,[]),L=M.indexOf(c);if(b===null&&(b=L===-1),b&&L===-1)M.push(c);else if(!b&&L!==-1)M.splice(L,1);else return;M.length?h.set(k,M):h.delete(k),this.emit(":change-hidden",r,c,b)}isHidden(r,c){return this.getHidden(r).includes(c)}getHidden(r){return this.settings.provider.get(`hidden-emotes.${r}`)||[]}setHidden(r,c){const b=`hidden-emotes.${r}`;!Array.isArray(c)||!c.length?this.settings.provider.delete(b):this.settings.provider.set(b,c)}animHover(r){const c=r.currentTarget;c[y]||(c[u]&&cancelAnimationFrame(c[u]),c[u]=requestAnimationFrame(()=>{if(c[u]=null,c[y]||!c.matches(":hover"))return;c[y]=!0;const b=c.querySelectorAll(".ffz-hover-emote");for(const k of b){const h=k.dataset;h.normalSrc&&h.hoverSrc&&(k.src=h.hoverSrc,k.srcset&&(k.srcset=h.hoverSrcSet))}}))}animLeave(r){const c=r.currentTarget;c[y]&&(c[u]&&cancelAnimationFrame(c[u]),c[u]=requestAnimationFrame(()=>{if(c[u]=null,!c[y]||c.matches(":hover"))return;c[y]=!1;const b=c.querySelectorAll(".ffz-hover-emote");for(const k of b){const h=k.dataset;h.normalSrc&&(k.src=h.normalSrc,k.srcset&&(k.srcset=h.normalSrcSet))}}))}toggleFavorite(r,c,b=null){const k=`favorite-emotes.${r}`,h=this.settings.provider,M=h.get(k)||[],L=M.indexOf(c);if(b===null&&(b=L===-1),b&&L===-1)M.push(c);else if(!b&&L!==-1)M.splice(L,1);else return b;return M.length?h.set(k,M):h.delete(k),this.emit(":change-favorite",r,c,b),b}isFavorite(r,c){const b=this.settings.provider.get(`favorite-emotes.${r}`);return b&&b.includes(c)}getFavorites(r){return this.settings.provider.get(`favorite-emotes.${r}`)||[]}setFavorites(r,c){const b=`favorite-emotes.${r}`;!Array.isArray(c)||!c.length?this.settings.provider.delete(b):this.settings.provider.set(b,c)}handleClick(r,c=!1){const b=r.target,k=b&&b.dataset;if(!k)return;const h=k.provider,M=this.parent.context.get("chat.click-emotes"),L=this.parent.context.get("chat.sub-emotes");if(r.shiftKey&&(M||L)){let P;if(h==="twitch"){if(P=null,L){const j=this.resolve("site.apollo");if(j)return j.client.query({query:z(),variables:{id:k.id}}).then(Z=>{const q=(0,R.get)("data.emote.subscriptionProduct",Z);if(q&&q.state==="ACTIVE"&&q.owner&&q.owner.login)P=`https://www.twitch.tv/subs/${q.owner.login}`;else if(!M)return!1;if(P){const X=window.open();X&&(X.opener=null,X.location=P)}}),!0}}else if(h==="ffz"){const j=this.emote_sets[k.set],Z=j&&(j.emotes[k.id]||j.disabled_emotes?.[k.id]);if(!Z)return;Z.click_url?P=Z.click_url:j.source||(P=`https://www.frankerfacez.com/emoticons/${Z.id}`)}if(!M)return!1;if(P){const j=window.open();j&&(j.opener=null,j.location=P)}return!0}if(r[S]){let P,j;if(h==="twitch")P="twitch",j=k.id;else if(h==="ffz"){const q=this.emote_sets[k.set],X=q&&(q.emotes[k.id]||q.disabled_emotes?.[k.id]);if(!X)return;P=q.source||"ffz",j=X.id}else if(h==="emoji")P="emoji",j=k.code;else return;this.toggleFavorite(P,j);const Z=b._ffz_tooltip;return Z&&Z.visible&&(Z.hide(),setTimeout(()=>document.contains(b)&&Z.show(),0)),!0}if(c)return!1;let T;try{T=JSON.parse(k.modifierInfo)}catch{}const O=this.makeEvent({provider:h,id:k.id,set:k.set,code:k.code,variant:k.variant,name:k.name||b.alt,modifiers:T,source:r});if(this.emit("chat.emotes:click",O),O.defaultPrevented)return!0;if(h==="twitch"&&this.parent.context.get("chat.emote-dialogs")){const P=this.resolve("site.fine");if(!P)return;const j=P.searchParent(b,X=>X.props&&X.props.message),Z=P.searchParent(b,X=>X.onShowEmoteCard,500);if(!j||!Z)return;const q=b.getBoundingClientRect();return Z.onShowEmoteCard({channelID:j.props.channelID||"",channelLogin:j.props.channelLogin||"",emoteID:k.id,emoteCode:b.alt,sourceID:"chat",referrerID:"",initialTopOffset:q.bottom,initialBottomOffset:q.top}),!0}}getTargetEmote(){this.target_emote=null;const r=this.resolve("site").getUser(),c=r?this.resolve("site.chat.input"):null,b=c?c.getInput():null,k=this.resolve("site.chat.emote_menu")?.MenuWrapper?.first,h=k?.getAllSets?.(),M=h?h.map(L=>L.emotes).flat().filter(L=>!L.effects&&!L.locked):null;if(b&&M){const L={};for(let P=0;P<M.length;P++)L[M[P].name]||(L[M[P].name]=P);const T=b.split(" ");let O=T.length;for(;O--;){const P=T[O];if(L[P]!=null)return M[L[P]]}}if(M&&M.length){const L=Math.floor(Math.random()*M.length),T=M[L];return this.target_emote=T,T}return this.target_emote={provider:"ffz",set_id:3,id:149346,name:"LaterSooner",src:"https://cdn.frankerfacez.com/emote/149346/1",srcSet:"https://cdn.frankerfacez.com/emote/149346/1 1x, https://cdn.frankerfacez.com/emote/149346/2 2x, https://cdn.frankerfacez.com/emote/149346/4 4x",width:25,height:32}}getSetIDs(r,c,b,k){const h=this.parent.getRoom(b,k,!0),M=h&&h.getUser(r,c,!0),L=this.parent.getUser(r,c,!0);let T=(L?.emote_sets?L.emote_sets._cache:[]).concat(M?.emote_sets?M.emote_sets._cache:[],h?.emote_sets?h.emote_sets._cache:[],this.default_sets._cache);if(this.bulk.size){const O=String(r);for(const[P,j]of this.bulk)j?._cache.has(O)&&T.push(P)}if(h?.shared_chats?.size>0)for(const O of h.shared_chats){const P=this.parent.getRoom(O,null,!0),j=P&&P.getUser(r,c,!0);j?.emote_sets?._cache&&(T=T.concat(j.emote_sets._cache)),P?.emote_sets?._cache&&(T=T.concat(P.emote_sets._cache))}return T}getSets(r,c,b,k){return this.getSetIDs(r,c,b,k).map(h=>this.emote_sets[h])}_withSources(r,c,b,k=null){if(b?._sources){for(const[h,M]of b._sources)for(const L of M)c.has(L)||(r.push([L,h,k]),c.add(L));return r}}getRoomSetIDsWithSources(r,c,b,k){const h=this.parent.getRoom(b,k,!0),M=h&&h.getUser(r,c,!0);if(!h)return[];const L=[],T=new Set;if(this._withSources(L,T,h.emote_sets,h.id),M&&this._withSources(L,T,M.emote_sets,h.id),h?.shared_chats?.size>0)for(const O of h.shared_chats){const P=this.parent.getRoom(O,null,!0),j=P&&P.getUser(r,c,!0);j&&this._withSources(L,T,j.emote_sets,O),P&&this._withSources(L,T,P.emote_sets,O)}return L}getRoomSetsWithSources(r,c,b,k){return this.getRoomSetIDsWithSources(r,c,b,k).map(([h,M,L])=>[this.emote_sets[h],M,L])}getRoomSetIDs(r,c,b,k){const h=this.parent.getRoom(b,k,!0),M=h&&h.getUser(r,c,!0);let L;if(h?M?.emote_sets?h.emote_sets?L=M.emote_sets._cache.concat(h.emote_sets._cache):L=M.emote_sets._cache:L=h.emote_sets?h.emote_sets._cache:[]:L=[],h?.shared_chats?.size>0)for(const T of h.shared_chats){const O=this.parent.getRoom(T,null,!0),P=O&&O.getUser(r,c,!0);P?.emote_sets?._cache&&(L=L.concat(P.emote_sets._cache)),O?.emote_sets?._cache&&(L=L.concat(O.emote_sets._cache))}return L}getRoomSets(r,c,b,k){return this.getRoomSetIDs(r,c,b,k).map(h=>this.emote_sets[h])}getGlobalSetIDsWithSources(r,c){const b=this.parent.getUser(r,c,!0),k=[],h=new Set;if(this._withSources(k,h,this.default_sets),b&&this._withSources(k,h,b.emote_sets),this.bulk.size){const M=String(r);for(const[L,T]of this.bulk)if(!h.has(L)&&T?._cache.has(M)){for(const[O,P]of T._sources)if(P&&P.includes(M)){k.push([L,O,null]);break}}}return k}getGlobalSetsWithSources(r,c){return this.getGlobalSetIDsWithSources(r,c).map(([b,k])=>[this.emote_sets[b],k,null])}getSubSetIDsWithSources(){const r=[],c=new Set;return this._withSources(r,c,this.sub_sets),r}getSubSetsWithSources(){return this.getSubSetIDsWithSources().map(([r,c])=>[this.emote_sets[r],c,null])}getGlobalSetIDs(r,c){const b=this.parent.getUser(r,c,!0),k=(b?.emote_sets?b.emote_sets._cache:[]).concat(this.default_sets._cache);if(this.bulk.size){const h=String(r);for(const[M,L]of this.bulk)L?._cache.has(h)&&k.push(M)}return k}getGlobalSets(r,c){return this.getGlobalSetIDs(r,c).map(b=>this.emote_sets[b])}getEmotes(r,c,b,k){const h={};for(const M of this.getSets(r,c,b,k))if(M&&M.emotes)for(const L of Object.values(M.emotes))L&&!(0,R.has)(h,L.name)&&(h[L.name]=L);return h}setBulk(r,c,b){let k=this.bulk.get(c);k||this.bulk.set(c,k=new R.SourcedSet(!0));const h=k._cache.size;k.set(r,b);const M=k._cache.size;!h&&M&&this.refSet(c)}deleteBulk(r,c){const b=this.bulk.get(c);if(!b)return;const k=b._cache.size;b.delete(r);const h=b._cache.size;k&&!h&&this.unrefSet(c)}extendBulk(r,c,b){let k=this.bulk.get(c);k||this.bulk.set(c,k=new R.SourcedSet(!0)),Array.isArray(b)||(b=[b]);const h=k._cache.size;k.extend(r,...b);const M=k._cache.size;!h&&M&&this.refSet(c)}addDefaultSet(r,c,b){typeof c=="number"&&(c=`${c}`);let k=!1,h=!1;return this.default_sets.sourceIncludes(r,c)||(k=!this.default_sets.includes(c),this.default_sets.push(r,c),h=!0),b&&this.loadSetData(c,b),k&&(this.refSet(c),this.emit(":update-default-sets",r,c,!0)),h}removeDefaultSet(r,c){if(!c){const b=this.default_sets.get(r);if(b)for(const k of Array.from(b))this.removeDefaultSet(r,k);return}return typeof c=="number"&&(c=`${c}`),this.default_sets.sourceIncludes(r,c)?(this.default_sets.remove(r,c),this.default_sets.includes(c)||(this.unrefSet(c),this.emit(":update-default-sets",r,c,!1)),!0):!1}addSubSet(r,c,b){typeof c=="number"&&(c=`${c}`);let k=!1,h=!1;return this.sub_sets.sourceIncludes(r,c)||(k=!this.sub_sets.includes(c),this.sub_sets.push(r,c),h=!0),b&&this.loadSetData(c,b),k&&(this.refSet(c),this.emit(":update-sub-sets",r,c,!0)),h}removeSubSet(r,c){return typeof c=="number"&&(c=`${c}`),this.sub_sets.sourceIncludes(r,c)?(this.sub_sets.remove(r,c),this.sub_sets.includes(c)||(this.unrefSet(c),this.emit(":update-sub-sets",r,c,!1)),!0):!1}refSet(r){this._set_refs[r]=(this._set_refs[r]||0)+1,this._set_timers[r]&&(clearTimeout(this._set_timers[r]),this._set_timers[r]=null)}unrefSet(r){(this._set_refs[r]=(this._set_refs[r]||1)-1)<=0&&!this._set_timers[r]&&(this._set_timers[r]=setTimeout(()=>this.unloadSet(r),5e3))}async loadGlobalSets(r=0){this.load_tracker.schedule("chat-data","ffz-global");let c,b;if(this.experiments.getAssignment("api_load")&&r<1)try{fetch(`${I.NEW_API}/v1/set/global`).catch(()=>{})}catch{}try{c=await fetch(`${this.staging.api}/v1/set/global/ids`)}catch(h){return r++,r<10?setTimeout(()=>this.loadGlobalSets(r),500*r):(this.log.error("Error loading global emote sets.",h),this.load_tracker.notify("chat-data","ffz-global",!1),!1)}if(!c.ok)return this.load_tracker.notify("chat-data","ffz-global",!1),!1;try{b=await c.json()}catch(h){return this.log.error("Error parsing global emote data.",h),this.load_tracker.notify("chat-data","ffz-global",!1),!1}const k=b.sets||{};this.removeDefaultSet("ffz-global");for(const h of b.default_sets)this.addDefaultSet("ffz-global",h);for(const h in k)if((0,R.has)(k,h)){const M=k[h]?.id;this.loadSetData(h,k[h]),M&&!b.default_sets.includes(M)&&this.addSubSet("ffz-global",h)}return b.user_ids?this.loadSetUserIds(b.user_ids):b.users&&this.loadSetUsers(b.users),this.load_tracker.notify("chat-data","ffz-global"),!0}async loadSet(r,c=!1,b=0){const k=`ffz-${r}`;this.load_tracker.schedule("chat-data",k);let h,M;if(this.experiments.getAssignment("api_load"))try{fetch(`${I.NEW_API}/v1/set/${r}`).catch(()=>{})}catch{}try{h=await fetch(`${this.staging.api}/v1/set/${r}${this.staging.active?"/ids":""}`)}catch(T){return b++,b<10?setTimeout(()=>this.loadGlobalSets(b),500*b):(this.log.error(`Error loading data for set "${r}".`,T),this.load_tracker.notify("chat-data",k,!1),!1)}if(!h.ok)return this.load_tracker.notify("chat-data",k,!1),!1;try{M=await h.json()}catch(T){return this.log.error(`Error parsing data for set "${r}".`,T),this.load_tracker.notify("chat-data",k,!1),!1}const L=M.set;return L&&this.loadSetData(L.id,L,c),M.user_ids?this.loadSetUserIds(M.user_ids):M.users&&this.loadSetUsers(M.users),this.load_tracker.notify("chat-data",k,!0),!0}loadSetUserIds(r,c=!1){for(const b in r)if((0,R.has)(r,b)){const k=this.emote_sets[b],h=r[b];this.setBulk("ffz-global",b,h.map(M=>String(M))),c||this.log.info(`Added "${k?k.title:b}" emote set to ${h.length} users.`)}}loadSetUsers(r,c=!1){for(const b in r)if((0,R.has)(r,b)){const k=this.emote_sets[b],h=r[b];for(const M of h)this.parent.getUser(void 0,M).addSet("ffz-global",b);c||this.log.info(`Added "${k?k.title:b}" emote set to ${h.length} users.`)}}processEmote(r,c){return!r.id||!r.name||!r.urls?null:(r.set_id=c,r.src=r.urls[1],r.srcSet=`${r.urls[1]} 1x`,r.urls[2]&&(r.srcSet+=`, ${r.urls[2]} 2x`),r.urls[4]&&(r.srcSet+=`, ${r.urls[4]} 4x`),r.urls[2]&&(r.can_big=!0,r.src2=r.urls[2],r.srcSet2=`${r.urls[2]} 1x`,r.urls[4]&&(r.srcSet2+=`, ${r.urls[4]} 2x`)),r.animated?.[1]&&(r.animSrc=r.animated[1],r.animSrcSet=`${r.animated[1]} 1x`,r.animated[2]&&(r.animSrcSet+=`, ${r.animated[2]} 2x`,r.animSrc2=r.animated[2],r.animSrcSet2=`${r.animated[2]} 1x`,r.animated[4]&&(r.animSrcSet+=`, ${r.animated[4]} 4x`,r.animSrcSet2+=`, ${r.animated[4]} 2x`))),r.token={type:"emote",id:r.id,set:c,provider:"ffz",src:r.src,srcSet:r.srcSet,can_big:!!r.urls[2],src2:r.src2,srcSet2:r.srcSet2,animSrc:r.animSrc,animSrcSet:r.animSrcSet,animSrc2:r.animSrc2,animSrcSet2:r.animSrcSet2,masked:!!r.mask,mod:r.modifier,mod_prefix:r.modifier_prefix,mod_hidden:(r.modifier_flags&1)===1,text:r.hidden?"???":r.name,length:r.name.length,height:r.height,width:r.width,source_modifier_flags:r.modifier_flags??0},(0,R.has)(a,r.id)&&Object.assign(r,a[r.id]),r)}addEmoteToSet(r,c){const b=this.emote_sets[r];if(!b)throw new Error(`Invalid emote set "${r}"`);let k=this.processEmote(c,r);if(!k)throw new Error("Invalid emote data object.");const h=this.shouldFilterEmote(k,b,r);b.disabled_emotes[k.id]&&(delete b.disabled_emotes[k.id],b.disabled_count--);const L=b.emotes[k.id],T=L&&this.generateEmoteCSS(L);if(h)if(b.disabled_emotes[k.id]=k,b.disabled_count++,L){const P={};let j=0;for(const Z of Object.values(b.emotes))Z.id!=k.id&&(P[Z.id]=Z,j++);b.emotes=P,b.count=j}else return k;else b.emotes[k.id]=k,L||b.count++;const O=`es--${r}`;if(T&&T.length){const P=[];for(const j of Object.values(b.emotes)){const Z=this.generateEmoteCSS(j);Z&&Z.length&&P.push(Z)}this.style&&(P.length||b.css)?this.style.set(O,P.join("")+(b.css||"")):P.length&&(b.pending_css=P.join(""))}else if(!h){const P=this.generateEmoteCSS(k);P&&P.length&&(this.style?this.style.set(O,(this.style.get(O)||"")+P):b.pending_css=(b.pending_css||"")+P)}return this.emit(":loaded",r,b),k}removeEmoteFromSet(r,c){const b=this.emote_sets[r];if(!b)throw new Error(`Invalid emote set "${r}"`);c&&c.id&&(c=c.id);const k=b.disabled_emotes?.[c];if(k)return b.disabled_count--,delete b.disabled_emotes[c],k;const h=b.emotes[c];if(!h)return;const M=this.generateEmoteCSS(h),L=M&&M.length?[]:null,T={};let O=0;for(const P of Object.values(b.emotes))if(P.id!=c&&(T[P.id]=P,O++,L!=null)){const j=this.generateEmoteCSS(P);j&&j.length&&L.push(j)}if(b.emotes=T,b.count=O,L!=null){const P=`es--${r}`;this.style&&(L.length||b.css)?this.style.set(P,L.join("")+(b.css||"")):L.length&&(b.pending_css=L.join(""))}return this.emit(":loaded",r,b),h}loadSetData(r,c,b=!1){const k=this.emote_sets[r];if(!c){k&&(this.style&&this.style.delete(`es--${r}`),this.emote_sets[r]=null);return}this.emote_sets[r]=c;let h=0,M=0;const L=c.emotes||c.emoticons,T=c.emotes={},O=c.disabled_emotes={},P=[];c.id=r,c.emoticons=void 0;const j=[];for(const q of L){let X=this.processEmote(q,r);if(!X){j.push(q);continue}if(this.shouldFilterEmote(X,c,r)){O[X.id]=X,M++;continue}const ee=this.generateEmoteCSS(X);ee&&P.push(ee),h++,T[X.id]=X}j.length&&this.log.warn(`Bad Emote Data for Set #${r}`,j),c.count=h,c.disabled_count=M,this.style&&(P.length||c.css)?this.style.set(`es--${r}`,P.join("")+(c.css||"")):P.length&&(c.pending_css=P.join("")),b||this.log.info(`Loaded emote set #${r}: ${c.title} (${h} emotes, ${M} filtered)`),this.emit(":loaded",r,c),(this._set_refs[r]||0)<=0&&!this._set_timers[r]&&(this._set_timers[r]=setTimeout(()=>this.unloadSet(r),5e3))}unloadSet(r,c=!1,b=!1){const k=this.emote_sets[r],h=this._set_refs[r]||0;if(k){if(h>0){if(!c)return this.log.warn(`Attempted to unload emote set #${r} with ${h} users.`);this.log.warn(`Unloading emote set ${r} with ${h} users.`)}b||this.log.info(`Unloaded emote set #${r}: ${k.title}`),this._set_timers[r]&&(clearTimeout(this._set_timers[r]),this._set_timers[r]=null),this.emit(":unloaded",r,k),this.emote_sets[r]=null}}generateEmoteCSS(r){if(!r.mask&&!r.margins&&(!r.modifier||!r.modifier_offset&&!r.extra_width&&!r.shrink_to_fit)&&!r.css)return"";let c="";if(r.modifier&&(r.modifier_offset||r.margins||r.extra_width||r.shrink_to_fit)){let b=r.modifier_offset||r.margins||"0";b=b.split(/\s+/).map(O=>parseInt(O,10)),b.length===3&&b.push(b[1]);const k=b.length,h=b[0%k],M=b[1%k],L=b[2%k],T=b[3%k];c=`.modified-emote span .ffz-emote[data-id="${r.id}"] {
	padding: ${h}px ${M}px ${L}px ${T}px;
	${r.shrink_to_fit?`max-width: calc(100% - ${40-T-M-(r.extra_width||0)}px);`:""}
	margin: 0 !important;
}`}return r.modifier&&r.mask?.[1]&&(c=(c||"")+`.modified-emote[data-modifiers~="${r.id}"] > .chat-line__message--emote {
	-webkit-mask-image: url("${r.mask[1]}");
	-webkit-mask-position: center center;
}`),`${c}.ffz-emote[data-id="${r.id}"] {
	${r.margins&&!r.modifier?`margin: ${r.margins} !important;`:""}
	${r.css||""}
}`}setTwitchEmoteSet(r,c){if(typeof r=="number"){if(isNaN(r)||!isFinite(r))return;r=`${r}`}if(typeof c=="number"){if(isNaN(c)||!isFinite(c))return;c=`${c}`}this.__twitch_emote_to_set[r]=c}setTwitchSetChannel(r,c){if(typeof r=="number"){if(isNaN(r)||!isFinite(r))return;r=`${r}`}this.__twitch_set_to_channel[r]=c}_getTwitchEmoteSet(r,c=!1){const b=this.__twitch_emote_to_set,k=this.__twitch_set_to_channel,h=this.__twitch_emote_to_artist;if(typeof r=="number"){if(isNaN(r)||!isFinite(r))return Promise.resolve(null);r=`${r}`}if((0,R.has)(b,r)&&(!c||(0,R.has)(h,r))){const L=b[r];return Array.isArray(L)?new Promise(T=>L.push(T)):Promise.resolve(L)}const M=this.resolve("site.apollo");return M?.client?new Promise(L=>{const T=[L];b[r]=T,(0,R.timeout)(M.client.query({query:z(),variables:{id:`${r}`}}),2e3).then(O=>{const P=O?.data?.emote;let j=null;if(P&&(j=P.setID,P.id&&!(0,R.has)(h,P.id)&&(h[P.id]=P.artist),j&&!(0,R.has)(k,j))){const Z=C(P);k[j]={id:j,type:Z,owner:P?.subscriptionProduct?.owner||P?.owner}}b[r]=j;for(const Z of T)Z(j)}).catch(()=>{b[r]=null;for(const O of T)O(null)})}):Promise.resolve(null)}getTwitchEmoteSet(r,c){const b=this._getTwitchEmoteSet(r);if(c)b.then(c);else return b}_getTwitchEmoteArtist(r){const c=this.__twitch_emote_to_artist;return(0,R.has)(c,r)?Promise.resolve(c[r]):this._getTwitchEmoteSet(r,!0).then(()=>c[r]).catch(()=>(c[r]=null,null))}getTwitchEmoteArtist(r,c){const b=this._getTwitchEmoteArtist(r);if(c)b.then(c);else return b}_getTwitchSetChannel(r){const c=this.__twitch_set_to_channel;if(typeof r=="number"){if(isNaN(r)||!isFinite(r))return Promise.resolve(null);r=`${r}`}if((0,R.has)(c,r)){const k=c[r];return Array.isArray(k)?new Promise(h=>k.push(h)):Promise.resolve(k)}const b=this.resolve("site.apollo");return b?.client?new Promise(k=>{const h=[k];c[r]=h,(0,R.timeout)(b.client.query({query:f(),variables:{id:`${r}`}}),2e3).then(M=>{const L=M?.data?.emoteSet;let T=null;L&&(T={id:r,type:m(L),owner:L.owner?{id:L.owner.id,login:L.owner.login,displayName:L.owner.displayName}:null}),c[r]=T;for(const O of h)O(T)}).catch(()=>{c[r]=null;for(const M of h)M(null)})}):Promise.resolve(null)}getTwitchSetChannel(r,c){const b=this._getTwitchSetChannel(r);if(c)b.then(c);else return b}};G(x,"Emotes");let p=x;function C($){const r=$.subscriptionProduct;if(r){if(r.id==12658)return I.EmoteTypes.Prime;if(r.id==324)return I.EmoteTypes.Turbo;const b=r.owner;if(b)return b.id==139075904||r.state==="INACTIVE"?I.EmoteTypes.LimitedTime:I.EmoteTypes.Subscription}if($.setID==300238151)return I.EmoteTypes.ChannelPoints;if($.setID==300374282)return I.EmoteTypes.TwoFactor;const c=parseInt($.setID,10);return!isNaN(c)&&isFinite(c)&&c>=5e8?I.EmoteTypes.BitsTier:I.EmoteTypes.Global}G(C,"determineEmoteType");function m($){const r=/^\d+$/.test($.id)?parseInt($.id,10):null;if(r&&I.TWITCH_GLOBAL_SETS.includes(r))return I.EmoteTypes.Global;if(r&&I.TWITCH_POINTS_SETS.includes(r))return I.EmoteTypes.ChannelPoints;if(r&&I.TWITCH_PRIME_SETS.includes(r))return I.EmoteTypes.Prime;if(r==300374282)return I.EmoteTypes.TwoFactor;const c=$.owner;if(c){if(c.id==139075904)return I.EmoteTypes.LimitedTime;let b;if(Array.isArray(c.subscriptionProducts)){for(const k of c.subscriptionProducts)if($.id==k.emoteSetID){b=k;break}}if(b){if(b.id==12658)return I.EmoteTypes.Prime;if(b.id==324)return I.EmoteTypes.Turbo;if(b.state==="INACTIVE")return I.EmoteTypes.LimitedTime}return I.EmoteTypes.Subscription}return r>=5e8?I.EmoteTypes.BitsTier:I.EmoteTypes.Global}G(m,"determineSetType")},89959:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>r});var W=d(51722),B=d.n(W),R=d(24431),I=d(22527),U=d(14873),z=d(44589),v=d(83342),f=d(46949),u=d(12381),y=d(66866),S=d(49276),n=d(83935),s=d(89711),i=d(22231),l=d(46328),w=d(88854),_=d(52970),o=d(29986);function e(k){return k.sort((h,M)=>h[0]<M[0]?1:h[0]>M[0]?-1:!h[1]&&M[1]?1:h[1]&&!M[1]?-1:0),k}G(e,"sortPriorityColorTerms");const a=["g","gi"],p=["filter_test"];function C(k){const h=[];for(let M=0;M<k.length;M++){const L=k[M];L[0].length&&L[1].push((0,f.addWordSeparators)(L[0].join("|"))),h.push(L[1].length?new RegExp(L[1].join("|"),a[M]||"gi"):null)}return h}G(C,"formatTerms");const m="https://static-cdn.jtvnw.net/emoticons/v1/58765/2.0",x=/[ .,!]/,$=["gif emotes","gif emoticons","gifs"],b=class b extends I.default{constructor(...h){super(...h),this.should_enable=!0,this.inject("settings"),this.inject("i18n"),this.inject("tooltips"),this.inject("experiments"),this.inject("staging"),this.inject("load_tracker"),this.inject(u.ZP),this.inject(y.ZP),this.inject(S.ZP),this.inject(o.Z),this.inject("overrides",n.Z),this._link_info={},this.clickToReveal=this.clickToReveal.bind(this),this.handleLinkClick=this.handleLinkClick.bind(this),this.handleMentionClick=this.handleMentionClick.bind(this),this.handleReplyClick=this.handleReplyClick.bind(this),this.style=new z.ManagedStyle,this.context=this.settings.context({}),this.CommandPrefixes=new f.SourcedSet(!0),this.CommandPrefixes.set("ffz",["/","!"]),this.rooms={},this.users={},this.room_ids={},this.user_ids={},this.tokenizers={},this.__tokenizers=[],this.rich_providers={},this.__rich_providers=[],this.link_providers={},this.__link_providers=[],this._hl_reasons={},this.addHighlightReason("mention","Mentioned","Mention"),this.addHighlightReason("user","Highlight User","User"),this.addHighlightReason("badge","Highlight Badge","Badge"),this.addHighlightReason("term","Highlight Term","Term"),this.settings.add("debug.link-resolver.source",{process:(T,O)=>R.LINK_DATA_HOSTS[O]??R.LINK_DATA_HOSTS.Production,default:null,ui:{path:"Debugging > Data Sources >> Links",title:"Link Resolver",component:"setting-select-box",force_seen:!0,data:[{value:null,title:"Automatic"}].concat(Object.entries(R.LINK_DATA_HOSTS).map(T=>({value:T[0],title:T[1].title})))},changed:()=>this.clearLinkCache()}),this.settings.addUI("debug.link-resolver.test",{path:"Debugging > Data Sources >> Links",component:"link-tester",getChat:()=>this,force_seen:!0}),this.settings.add("chat.timestamp-size",{default:null,ui:{path:"Chat > Appearance >> General",title:"Timestamp Font Size",description:"How large should timestamps be, in pixels. Defaults to Font Size if not set.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.font-size",{default:13,ui:{path:"Chat > Appearance >> General",title:"Font Size",description:"How large should text in chat be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.font-family",{default:"",ui:{path:"Chat > Appearance >> General",title:"Font Family",description:"Set the font used for displaying chat messages.",component:"setting-combo-box",data:()=>(0,v.R7)()}}),this.settings.add("chat.name-format",{default:0,ui:{path:"Chat > Appearance >> Usernames",title:"Display Style",description:"Change how usernames are displayed in chat when users have an international display name set.",component:"setting-select-box",data:[{value:0,title:"International Name (Username) <Default>"},{value:1,title:"International Name"},{value:2,title:"Username"}]}}),this.settings.add("chat.lines.emote-alignment",{default:0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Emote Alignment",description:"Change how emotes are positioned in chat, potentially making messages taller in order to avoid having emotes overlap.",component:"setting-select-box",data:[{value:0,title:"Standard"},{value:1,title:"Padded"},{value:2,title:"Baseline (BTTV-Like)"}]}}),this.settings.add("chat.rich.enabled",{default:!0,ui:{path:"Chat > Appearance >> Rich Content",title:"Display rich content in chat.",description:"This displays rich content blocks for things like linked clips and videos.",component:"setting-check-box"}}),this.settings.add("chat.rich.want-mid",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Display larger rich content in chat.",description:`This enables the use of bigger rich content embeds in chat. This is **not** recommended for most users and/or chats.

**Note:** Enabling this may cause chat to scroll at inopportune times due to content loading. Moderators should not use this feature.`,component:"setting-check-box"}}),this.settings.add("chat.rich.hide-tokens",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Hide matching links for rich content.",component:"setting-check-box"}}),this.settings.add("chat.rich.all-links",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Display rich content embeds for all links.",description:"*Streamers: Please be aware that this is a potential vector for NSFW imagery via thumbnails, so be mindful when capturing chat with this enabled.*",component:"setting-check-box",extra:{component:"chat-rich-example",getChat:()=>this}}}),this.settings.add("chat.rich.minimum-level",{default:0,ui:{path:"Chat > Appearance >> Rich Content",title:"Required User Level",description:"Only display rich content embeds on messages posted by users with this level or higher.",component:"setting-select-box",data:[{value:4,title:"Broadcaster"},{value:3,title:"Moderator"},{value:2,title:"VIP"},{value:1,title:"Subscriber"},{value:0,title:"Everyone"}]}}),this.settings.add("chat.scrollback-length",{default:150,ui:{path:"Chat > Behavior >> General",title:"Scrollback Length",description:"Keep up to this many lines in chat. Setting this too high will create lag.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.filtering.debug",{default:!1,ui:{path:"Chat > Filtering > General >> Behavior",title:"Display a list of highlight reasons on every chat message for debugging.",component:"setting-check-box",force_seen:!0}}),this.settings.addUI("chat.filtering.pad-bottom",{path:"Chat > Filtering > Highlight",sort:1e3,component:"setting-spacer",top:"30rem",force_seen:!0}),this.settings.add("chat.filtering.click-to-reveal",{default:!1,ui:{path:'Chat > Filtering > General @{"sort":-1} >> Behavior',title:"Click to reveal deleted terms.",component:"setting-check-box"}}),this.settings.add("chat.filtering.deleted-style",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Detailed Message Style",description:"This style will be applied to deleted messages showed in Detailed rendering mode to differentiate them from normal chat messages.",component:"setting-select-box",data:[{value:0,title:"Faded"},{value:1,title:"Faded, Line Through"},{value:2,title:"Line Through"},{value:3,title:"No Change"}]}}),this.settings.add("chat.filtering.display-deleted",{default:!1,ui:{path:"Chat > Behavior >> Deleted Messages",sort:-1,title:"Rendering Mode",description:"This, when set, overrides the `Deleted Messages` mode selected in Twitch chat settings, which is normally only accessible for moderators. Brief hides messages entirely and shows a notice in chat that a number of messages were hidden. Detailed shows the contents of the message. Legacy shows `<message deleted>` with click to reveal.",component:"setting-select-box",data:[{value:!1,title:"Do Not Override"},{value:"BRIEF",title:"Brief"},{value:"DETAILED",title:"Detailed"},{value:"LEGACY",title:"Legacy"}]}}),this.settings.add("chat.filtering.display-mod-action",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Display Reason",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"In Detailed Mode"},{value:2,title:"Always"}]}}),this.settings.add("chat.automod.delete-messages",{default:!0,ui:{path:'Chat > Filtering > General >> AutoMod Filters @{"description": "Extra configuration for Twitch\'s native `Chat Filters`."}',title:"Mark messages as deleted if they contain filtered phrases.",component:"setting-check-box"}}),this.settings.add("chat.automod.remove-messages",{default:!0,ui:{path:"Chat > Filtering > General >> AutoMod Filters",title:"Remove messages entirely if they contain filtered phrases.",component:"setting-check-box"}}),this.settings.add("chat.automod.run-as-mod",{default:!1,ui:{path:"Chat > Filtering > General >> AutoMod Filters",title:"Use Chat Filters as a moderator.",description:"By default, Twitch's Chat Filters feature does not function for moderators. This overrides that behavior.",component:"setting-check-box"}}),this.settings.add("chat.filtering.process-own",{default:!1,ui:{path:"Chat > Filtering > General >> Behavior",title:"Filter your own messages.",component:"setting-check-box"}}),this.settings.add("chat.filtering.ignore-clear",{default:!1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Do not Clear Chat when commanded to.",component:"setting-check-box"}}),this.settings.add("chat.filtering.remove-deleted",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Remove deleted messages from chat.",description:"Deleted messages will be removed from chat entirely. This setting is not recommended for moderators.",component:"setting-select-box",data:[{value:0,title:"Do Not Remove"},{value:1,title:"Remove Unseen (Default)"},{value:2,title:"Remove Unseen as Moderator"},{value:3,title:"Remove All"}]}}),this.settings.add("chat.delay",{default:-1,ui:{path:"Chat > Behavior >> General",title:"Artificial Chat Delay",description:"Delay the appearance of chat messages to allow for moderation before you see them.",component:"setting-select-box",data:[{value:-1,title:"Default Delay (Room Specific; Non-Mod Only)"},{value:0,title:"No Delay"},{value:300,title:"Minor (Bot Moderation; 0.3s)"},{value:1200,title:"Normal (Human Moderation; 1.2s)"},{value:5e3,title:"Large (Spoiler Removal / Slow Mods; 5s)"},{value:1e4,title:"Extra Large (10s)"},{value:15e3,title:"Extremely Large (15s)"},{value:2e4,title:"Mods Asleep; Delay Chat (20s)"},{value:3e4,title:"Half a Minute (30s)"},{value:6e4,title:"Why??? (1m)"},{value:7884e8,title:"The CBenni Option (Literally 25 Years)"}]}}),this.settings.add("chat.filtering.hidden-tokens",{default:[],type:"array_merge",always_inherit:!0,process(T,O){const P=new Set;for(const j of O)(j?.v||!p.includes(j.v))&&P.add(j.v);return P},ui:{path:'Chat > Appearance >> Hidden Token Types @{"description":"This filter allows you to prevent specific content token types from appearing chat messages, such as hiding all cheers or emotes."}',component:"blocked-types",data:()=>Object.keys(this.tokenizers).filter(T=>!p.includes(T)&&this.tokenizers[T]?.render).sort()}}),this.settings.add("chat.filtering.highlight-basic-users",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Highlight @{"description": "These settings allow you to highlight messages in chat based on their contents. Setting priorities on rules allows you to determine which highlight color should be applied if a message matches multiple rules. Rules with a higher priority take priority over rules with lower priorities.\\n\\nYou can also create a rule that removes highlights from messages, preventing lower priority rules from highlighting them, by setting a color with an alpha value of zero. Example: `#00000000`"} >> Users',component:"basic-terms",colored:!0,words:!1,priority:!0}}),this.settings.add("__filter:highlight-users",{requires:["chat.filtering.highlight-basic-users"],equals:"requirements",process(T){const O=T.get("chat.filtering.highlight-basic-users");if(!O||!O.length)return null;const P=new Map;for(const Z of O){const q=Z.p||0,X=Z.t;let ee=Z.c||null,te=Z.v;if(X==="glob"?te=(0,f.glob_to_regex)(te):X!=="raw"&&(te=(0,f.escape_regex)(te)),!te||!te.length)continue;try{new RegExp(te)}catch{continue}let ne=P.get(q);if(ne||(ne=new Map,P.set(q,ne)),ee){const pe=U.Color.RGBA.fromCSS(ee);(!pe||!pe.a)&&(ee=!1)}ne.has(ee)?ne.get(ee).push(te):ne.set(ee,[te])}const j=[];for(const[Z,q]of P)for(const[X,ee]of q)j.push([Z,X,new RegExp(`^(?:${ee.join("|")})$`,"gi")]);return e(j)}}),this.settings.add("chat.filtering.highlight-basic-users-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering > Block >> Users",component:"basic-terms",removable:!0,words:!1}}),this.settings.add("__filter:block-users",{requires:["chat.filtering.highlight-basic-users-blocked"],equals:"requirements",process(T){const O=T.get("chat.filtering.highlight-basic-users-blocked");if(!O||!O.length)return null;const P=[[],[]];for(const j of O){const Z=j.t;let q=j.v;Z==="glob"?q=(0,f.glob_to_regex)(q):Z!=="raw"&&(q=(0,f.escape_regex)(q)),!(!q||!q.length)&&P[j.remove?1:0].push(q)}return P.map(j=>j.length?new RegExp(`^(?:${j.join("|")})$`,"i"):null)}}),this.settings.add("chat.filtering.highlight-basic-badges",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering > Highlight >> Badges",component:"badge-highlighting",colored:!0,priority:!0,data:()=>this.badges.getSettingsBadges(!0)}}),this.settings.add("__filter:highlight-badges",{requires:["chat.filtering.highlight-basic-badges"],equals:"requirements",process(T){const O=T.get("chat.filtering.highlight-basic-badges");if(!O||!O.length)return null;const P=new Map;for(const j of O){let Z=j.c||null;const q=j.p||0,X=j.v;if(Z){const te=U.Color.RGBA.fromCSS(Z);(!te||!te.a)&&(Z=!1)}const ee=P.get(X);(!ee||ee[0]<q||Z&&!ee[1]&&ee[0]<=q)&&P.set(X,[q,Z])}return P}}),this.settings.add("chat.filtering.highlight-basic-badges-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Block >> Badges @{"description": "**Note:** This section is for filtering messages out of chat from users with specific badges. If you wish to hide a badge, go to [Chat > Badges >> Visibility](~chat.badges.tabs.visibility)."}',component:"badge-highlighting",removable:!0,data:()=>this.badges.getSettingsBadges(!0)}}),this.settings.add("__filter:block-badges",{requires:["chat.filtering.highlight-basic-badges-blocked"],equals:"requirements",process(T){const O=T.get("chat.filtering.highlight-basic-badges-blocked");if(!O||!O.length)return null;const P=[[],[]];for(const j of O)j.v&&P[j.remove?1:0].push(j.v);return!P[0].length&&!P[1].length?null:P}}),this.settings.add("chat.filtering.highlight-basic-terms",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Highlight >> Terms @{"description": "Please see [Chat > Filtering > Syntax Help](~) for details on how to use terms."}',component:"basic-terms",colored:!0,priority:!0,highlight:!0}}),this.settings.add("__filter:highlight-terms",{requires:["chat.filtering.highlight-tokens","chat.filtering.highlight-basic-terms"],equals:"requirements",process(T){const O=T.get("chat.filtering.highlight-tokens"),P=T.get("chat.filtering.highlight-basic-terms");if(!P||!P.length)return null;const j=new Map;let Z=!1,q=!1;for(const ee of P){const te=ee.p||0,ne=O&&((0,f.has)(ee,"h")?ee.h:!0),pe=ee.s,oe=ee.t,de=(0,f.has)(ee,"w")?ee.w:oe!=="raw";let me=ee.c||null,Ee=ee.v;if(oe==="glob"?Ee=(0,f.glob_to_regex)(Ee):oe!=="regex"&&oe!=="raw"&&(Ee=(0,f.escape_regex)(Ee)),!Ee||!Ee.length)continue;try{new RegExp(Ee)}catch{continue}ne?Z=!0:q=!0;let xe=j.get(te);if(xe||(xe=new Map,j.set(te,xe)),me){const Pe=U.Color.RGBA.fromCSS(me);(!Pe||!Pe.a)&&(me=!1)}let Te=xe.get(me);Te||xe.set(me,Te=[[[[],[]],[[],[]]],[[[],[]],[[],[]]]]),Te[ne?0:1][pe?0:1][de?0:1].push(Ee)}if(!Z&&!q)return null;const X={hl:Z?[]:null,non:q?[]:null};for(const[ee,te]of j)for(const[ne,pe]of te){const oe=C(pe[0]),de=C(pe[1]);(oe[0]||oe[1])&&X.hl.push([ee,ne,oe]),(de[0]||de[1])&&X.non.push([ee,ne,de])}return Z&&e(X.hl),q&&e(X.non),X}}),this.settings.add("chat.filtering.highlight-basic-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Block >> Terms @{"description": "Please see [Chat > Filtering > Syntax Help](~) for details on how to use terms."}',component:"basic-terms",removable:!0}}),this.settings.add("__filter:block-terms",{requires:["chat.filtering.highlight-basic-blocked"],equals:"requirements",process(T){const O=T.get("chat.filtering.highlight-basic-blocked");if(!O||!O.length)return null;const P=[[[[],[]],[[],[]]],[[[],[]],[[],[]]]];let j=!1,Z=!1;for(const q of O){const X=q.t,ee=q.s,te=(0,f.has)(q,"w")?q.w:X!=="raw";let ne=q.v;X==="glob"?ne=(0,f.glob_to_regex)(ne):X!=="regex"&&X!=="raw"&&(ne=(0,f.escape_regex)(ne)),!(!ne||!ne.length)&&(q.remove?j=!0:Z=!0,P[q.remove?1:0][ee?0:1][te?0:1].push(ne))}return!j&&!Z?null:{remove:j?C(P[1]):null,non:Z?C(P[0]):null}}}),this.settings.add("chat.filtering.clickable-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Viewer Cards >> Behavior",title:"Enable opening viewer cards by clicking mentions in chat."}}),this.settings.add("chat.filtering.all-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Filtering > General >> Appearance",title:"Display mentions for all users without requiring an at sign (@).",description:"**Note**: This setting can increase memory usage and impact chat performance."}}),this.settings.add("chat.filtering.color-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Filtering > General >> Appearance",title:"Display mentions in chat with username colors.",description:"**Note:** Not compatible with color overrides as mentions do not include user IDs."}}),this.settings.add("chat.filtering.need-colors",{requires:["chat.filtering.all-mentions","chat.filtering.color-mentions"],process(T){return T.get("chat.filtering.all-mentions")||T.get("chat.filtering.color-mentions")}}),this.settings.add("chat.filtering.bold-mentions",{default:!0,ui:{component:"setting-check-box",path:"Chat > Filtering > General >> Appearance",title:"Display mentions in chat with a bold font."}}),this.settings.add("chat.filtering.mention-priority",{default:0,ui:{path:"Chat > Filtering > General >> Appearance",title:"Mention Priority",component:"setting-text-box",type:"number",process:"to_int",description:"Mentions of your name have this priority for the purpose of highlighting. See [Chat > Filtering > Highlight](~chat.filtering.highlight) for more details."}}),this.settings.add("chat.filtering.mention-color",{default:"",ui:{path:"Chat > Filtering > General >> Appearance",title:"Custom Highlight Color",component:"setting-color-box",description:"If this is set, highlighted messages with no default color set will use this color rather than red."}}),this.settings.add("chat.filtering.highlight-mentions",{default:!1,ui:{path:"Chat > Filtering > General >> Appearance",title:"Highlight messages that mention you.",component:"setting-check-box"}}),this.settings.add("chat.filtering.highlight-tokens",{default:!1,ui:{path:"Chat > Filtering > General >> Appearance",title:"Highlight matched words in chat.",component:"setting-check-box"}}),this.settings.add("tooltip.images",{default:!0,ui:{path:'Chat > Tooltips >> General @{"sort": -1}',title:"Display images in tooltips.",component:"setting-check-box"}}),this.settings.add("tooltip.badge-images",{default:!0,requires:["tooltip.images"],process(T,O){return T.get("tooltip.images")?O:!1},ui:{path:"Chat > Tooltips >> Badges",title:"Display large images of badges.",component:"setting-check-box"}}),this.settings.add("tooltip.emote-sources",{default:!0,ui:{path:"Chat > Tooltips >> Emotes",title:"Display known sources.",component:"setting-check-box"}}),this.settings.add("tooltip.emote-images",{default:!0,requires:["tooltip.images"],process(T,O){return T.get("tooltip.images")?O:!1},ui:{path:"Chat > Tooltips >> Emotes",title:"Display large images of emotes.",component:"setting-check-box"}}),this.settings.add("tooltip.rich-links",{default:!0,ui:{sort:-1,path:"Chat > Tooltips >> Links",title:"Display rich tooltips for links.",component:"setting-check-box",extra:{component:"chat-tooltip-example"}}}),this.settings.add("tooltip.link-interaction",{default:!0,ui:{path:"Chat > Tooltips >> Links",title:"Allow interaction with supported link tooltips.",component:"setting-check-box"}}),this.settings.add("tooltip.link-images",{default:!0,requires:["tooltip.images"],process(T,O){return T.get("tooltip.images")?O:!1},ui:{path:"Chat > Tooltips >> Links",title:"Display images for links.",component:"setting-check-box"}}),this.settings.add("tooltip.link-nsfw-images",{default:!1,ui:{path:"Chat > Tooltips >> Links",title:"Display potentially NSFW images.",description:"When enabled, FrankerFaceZ will include images that are tagged as unsafe or that are not rated.",component:"setting-check-box"}});for(const[T,O]of Object.entries(R.RESOLVERS_REQUIRE_TOS))this.settings.addUI(`tooltip.tos.${T}`,{path:'Chat > Tooltips >> Terms of Service @{"description": "The following services require you to agree to their Terms of Service before we can show you information from their platforms."}',component:"tooltip-tos",item:T,override_setting:"agreed-tos",getChat:()=>this,data:(0,f.deep_copy)(O),onUIChange:()=>this.emit(":update-link-resolver")});this.settings.add("chat.adjustment-mode",{default:null,process(T,O){return O??(T.get("ls.useHighContrastColors")??!0?1:0)},requires:["ls.useHighContrastColors"],ui:{path:"Chat > Appearance >> Colors",title:"Adjustment",description:"Alter user colors to ensure that they remain readable.",default(T){return T.get("ls.useHighContrastColors")??!0?1:0},component:"setting-select-box",data:[{value:-1,title:"No Color"},{value:0,title:"Unchanged"},{value:1,title:"HSL Luma"},{value:2,title:"Luv Luma"},{value:3,title:"HSL Loop (BTTV-Like)"},{value:4,title:"RGB Loop (Deprecated)"}]}}),this.settings.add("chat.adjustment-contrast",{default:4.5,ui:{path:"Chat > Appearance >> Colors",title:"Minimum Contrast",description:"Set the minimum contrast ratio used by Luma adjustments when determining readability.",component:"setting-text-box",process:"to_float"}}),this.settings.add("chat.me-style",{default:2,ui:{path:"Chat > Appearance >> Chat Lines",title:"Action Style",description:"When someone uses `/me`, the message will be rendered in this style.",component:"setting-select-box",data:[{value:0,title:"No Style"},{value:1,title:"Colorized (Old Style)"},{value:2,title:"Italic (New Style)"},{value:3,title:"Colorized Italic"}]}}),this.settings.add("chat.bits.stack",{default:0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Cheer Stacking",description:"Collect all the cheers in a message into a single cheer at the start of the message.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Grouped by Type"},{value:2,title:"All in One"}]}}),this.settings.add("chat.emotes.animated",{default:null,requires:["ls.emoteAnimationsEnabled"],process(T,O){return O??(T.get("ls.emoteAnimationsEnabled")??!0?1:0)},ui:{path:"Chat > Appearance >> Emotes",sort:-50,title:"Animated Emotes",default(T){return T.get("ls.emoteAnimationsEnabled")??!0?1:0},getExtraTerms:()=>$,description:"This controls whether or not animated emotes are allowed to play in chat. When this is `Disabled`, emotes will appear as static images. Setting this to `Enable on Hover` may cause performance issues.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enable on Hover"}]}}),this.settings.add("tooltip.emote-images.animated",{requires:["chat.emotes.animated"],default:null,process(T,O){return O==null&&(O=!!T.get("chat.emotes.animated")),O},ui:{path:"Chat > Tooltips >> Emotes",title:"Display animated images of emotes.",getExtraTerms:()=>$,description:"If this is not overridden, animated images are only shown in emote tool-tips if [Chat > Appearance >> Emotes > Animated Emotes](~chat.appearance.emotes) is not disabled.",component:"setting-check-box"}}),this.settings.add("chat.bits.animated",{default:!0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Display animated cheers.",component:"setting-check-box"}});const M=new Date(0).toLocaleTimeString().toUpperCase(),L=M.lastIndexOf("PM")===-1&&M.lastIndexOf("AM")===-1;this.settings.add("chat.timestamp-format",{default:L?"H:mm":"h:mm",ui:{path:"Chat > Appearance >> Chat Lines",title:"Timestamp Format",component:"setting-combo-box",description:"Timestamps are formatted using the [Day.js](https://github.com/iamkun/dayjs#readme) library. More details about formatting strings [can be found here](https://github.com/iamkun/dayjs/blob/HEAD/docs/en/API-reference.md#list-of-all-available-formats)",data:[{value:"h:mm",title:"12 Hour"},{value:"h:mm:ss",title:"12 Hour with Seconds"},{value:"H:mm",title:"24 Hour"},{value:"H:mm:ss",title:"24 Hour with Seconds"},{value:"hh:mm",title:"Padded"},{value:"hh:mm:ss",title:"Padded with Seconds"},{value:"HH:mm",title:"Padded 24 Hour"},{value:"HH:mm:ss",title:"Padded 24 Hour with Seconds"}]}}),this.context.on("changed:theme.is-dark",()=>{for(const T of this.iterateRooms())T.buildBitsCSS()}),this.context.on("changed:chat.bits.animated",()=>{for(const T of this.iterateRooms())T.buildBitsCSS()}),this.context.on("changed:chat.filtering.need-colors",async T=>{T?await this.createColorCache():this.color_cache=null,this.emit(":update-line-tokens")}),this.context.on("changed:chat.filtering.all-mentions",()=>this.emit(":update-line-tokens")),this.context.on("changed:chat.filtering.color-mentions",()=>this.emit(":update-line-tokens"))}async createColorCache(){const h=await d(4866);this.color_cache=new h(150)}generateLog(){const h=["chat settings","-------------------------------------------------------------------------------"];for(const[M,L]of this.context.__cache.entries())h.push(`${M}: ${JSON.stringify(L)}`);return h.join(`
`)}getAddonProxy(h,M,L){if(!h)return this;const T=R.DEBUG||M?.dev,O=(0,f.makeAddonIdChecker)(h),P={},j={},Z=(0,I.buildAddonProxy)(L,null,"getUser()",{addBadge:T?function(X,...ee){return O.test(X)||L.log.warn("[DEV-CHECK] Call to getUser().addBadge() did not include addon ID in provider:",X),this.addBadge(X,...ee)}:void 0,removeBadge:T?function(X,...ee){return O.test(X)||L.log.warn("[DEV-CHECK] Call to getUser().removeBadge() did not include addon ID in provider:",X),this.removeBadge(X,...ee)}:void 0,addSet(X,ee,te){return T&&!O.test(X)&&L.log.warn("[DEV-CHECK] Call to getUser().addSet() did not include addon ID in provider:",X),this.manager.emotes.providers.has(X)||(this.manager.emotes.inferProvider(X,h),T&&L.log.warn("[DEV-CHECK] Call to getUser().addSet() for provider that has not been registered with emotes.setProvider:",X)),te&&(T&&!O.test(ee)&&L.log.warn("[DEV-CHECK] Call to getUser().addSet() loaded set data but did not include addon ID in set ID:",ee),te.__source=h),this.addSet(X,ee,te)},removeAllSets:T?function(X){return O.test(X)||L.log.warn("[DEV-CHECK] Call to getUser().removeAllSets() did not include addon ID in provider:",X),this.removeAllSets(X)}:void 0,removeSet:T?function(X,...ee){return O.test(X)||L.log.warn("[DEV-CHECK] Call to getUser().removeSet() did not include addon ID in provider:",X),this.removeSet(X,...ee)}:void 0},T?{badges:"Please use addBadge(), getBadge(), or removeBadge()",emote_sets:"Please use addSet(), removeSet(), or removeAllSets()",room:!0}:null,!0),q=(0,I.buildAddonProxy)(L,null,"getRoom()",{getUser(...X){const ee=this.getUser(...X);if(ee)return new Proxy(ee,Z)},addSet(X,ee,te){return T&&!O.test(X)&&L.log.warn("[DEV-CHECK] Call to getRoom().addSet() did not include addon ID in provider:",X),this.manager.emotes.providers.has(X)||(this.manager.emotes.inferProvider(X,h),T&&L.log.warn("[DEV-CHECK] Call to getRoom().addSet() for provider that has not been registered with emotes.setProvider:",X)),te&&(T&&!O.test(ee)&&L.log.warn("[DEV-CHECK] Call to getRoom().addSet() loaded set data but did not include addon ID in set ID:",ee),te.__source=h),this.addSet(X,ee,te)},removeAllSets:T?function(X){return O.test(X)||L.log.warn("[DEV-CHECK] Call to getRoom().removeAllSets() did not include addon ID in provider:",X),this.removeAllSets(X)}:void 0,removeSet:T?function(X,...ee){return O.test(X)||L.log.warn("[DEV-CHECK] Call to getRoom().removeSet() did not include addon ID in provider:",X),this.removeSet(X,...ee)}:void 0},{badges:!0,load_data:!0,emote_sets:"Please use addSet(), removeSet(), or removeAllSets()",refs:"Please use ref() or unref()",style:!0,users:"Please use getUser()",user_ids:"Please use getUser()"},!0);return P.iterateUsers=function*(){for(const X of this.iterateUsers())yield new Proxy(X,Z)},P.iterateRooms=function*(){for(const X of this.iterateRooms())yield new Proxy(X,q)},P.iterateAllRoomsAndUsers=function*(){for(const X of this.iterateAllRoomsAndUsers())yield new Proxy(X,X instanceof s.Z?q:Z)},P.addTabCommandPrefix=(X,ee=null)=>(ee==null&&(ee=h),T&&ee!==h&&L.log.warn("[DEV-CHECK] Used addTabCommandPrefix with incorrect provider."),this.addTabCommandPrefix(X,ee)),P.removeTabCommandPrefix=(X,ee=null)=>(ee==null&&(ee=h),T&&ee!==h&&L.log.warn("[DEV-CHECK] Used removeTabCommandPrefix with incorrect provider."),this.removeTabCommandPrefix(X,ee)),P.addTokenizer=X=>(X&&(X.__source=h),this.addTokenizer(X)),P.addLinkProvider=X=>(X&&(X.__source=h),this.addLinkProvider(X)),P.addRichProvider=X=>(X&&(X.__source=h),this.addRichProvider(X)),T&&(P.getUser=(...X)=>{let ee=this.getUser(...X);if(ee)return new Proxy(ee,Z)},P.getRoom=(...X)=>{let ee=this.getRoom(...X);if(ee)return new Proxy(ee,q)},P.removeTokenizer=X=>{let ee;typeof X=="string"?ee=X:ee=X.type;const te=this.tokenizers[ee];return te&&te.__source!==h&&L.log.warn("[DEV-CHECK] Removed un-owned tokenizer with chat.removeTokenizer:",ee," owner:",te.__source??"ffz"),this.removeTokenizer(X)},P.removeLinkProvider=X=>{let ee;typeof X=="string"?ee=X:ee=X.type;const te=this.link_providers[ee];return te&&te.__source!==h&&L.log.warn("[DEV-CHECK] Removed un-owned link provider with chat.removeLinkProvider:",ee," owner:",te.__source??"ffz"),this.removeLinkProvider(X)},P.removeRichProvider=X=>{let ee;typeof X=="string"?ee=X:ee=X.type;const te=this.link_providers[ee];return te&&te.__source!==h&&L.log.warn("[DEV-CHECK] Removed un-owned rich provider with chat.removeRichProvider:",ee," owner:",te.__source??"ffz"),this.removeRichProvider(X)}),(0,I.buildAddonProxy)(L,this,"chat",P,j)}onEnable(){this.socket=this.resolve("socket"),this.pubsub=this.resolve("pubsub"),this.settings.provider.on("changed",this.onProviderChange,this),this.on("site.subpump:pubsub-message",this.onPubSub,this),this.on("chat.emotes:update-priorities",h=>{for(const M of this.iterateAllRoomsAndUsers())M.emote_sets&&M.emote_sets.setSortFunction(h)}),this.context.get("chat.filtering.need-colors")&&this.createColorCache().then(()=>this.emit(":update-line-tokens"));for(const h in l)(0,f.has)(l,h)&&this.addTokenizer(l[h]);for(const h in w)(0,f.has)(w,h)&&this.addRichProvider(w[h]);for(const h in _)(0,f.has)(_,h)&&this.addLinkProvider(_[h]);this.on("chat:reload-data",h=>{for(const M of this.iterateRooms())M.load_data()}),this.on("chat:get-tab-commands",h=>{h.commands.push({name:"ffz:reload",description:this.i18n.t("chat.command.reload","Reload FFZ and add-on chat data (emotes, badges, etc.)"),permissionLevel:0,ffz_group:"FrankerFaceZ"})}),this.triggered_reload=!1,this.on("chat:ffz-command:reload",h=>{if(this.triggered_reload)return;const M=this.resolve("site.chat");M?.addNotice&&M.addNotice("*",this.i18n.t("chat.command.reload.starting","FFZ is reloading data...")),this.triggered_reload=!0,this.emit("chat:reload-data")}),this.on("load_tracker:complete:chat-data",h=>{if(this.triggered_reload){const M=this.resolve("site.chat");M?.addNotice&&M.addNotice("*",this.i18n.t("chat.command.reload.done","FFZ has finished reloading data. (Sources: {list})",{list:h.join(", ")}))}this.triggered_reload=!1}),this.on("addon:fully-unload",h=>{let M=0;for(const[L,T]of Object.entries(this.link_providers))T?.__source===h&&(M++,this.removeLinkProvider(L));for(const[L,T]of Object.entries(this.rich_providers))T?.__source===h&&(M++,this.removeRichProvider(L));for(const[L,T]of Object.entries(this.tokenizers))T?.__source===h&&(M++,this.removeTokenizer(L));this.CommandPrefixes.delete(h);for(const L of this.iterateAllRoomsAndUsers())M+=L._unloadAddon(h)??0;M&&(this.log.debug(`Cleaned up ${M} entries when unloading addon:`,h),this.emit(":update-line-tokens"))})}onPubSub(h){if(h.prefix==="stream-chat-room-v1"&&h.message.type==="chat_rich_embed"){const M=h.message.data,L=M.request_url,T=this.__link_providers;if(this._link_info[L])return;for(const O of T){const P=O.test.call(this,L);if(P){const j=O.receive?O.receive.call(this,P,M):M;let Z=O.process.call(this,P,j);Z instanceof Promise||(Z=Promise.resolve(Z)),Z.then(q=>{this._link_info[L]||(this._link_info[L]=[!0,Date.now()+12e4,q])});return}}}}getUser(h,M,L,T,O=!1){let P;if(h&&typeof h=="number"&&(h=`${h}`),h&&this.user_ids[h]?P=this.user_ids[h]:M&&this.users[M]&&!T&&(P=this.users[M]),P&&P.destroyed&&(P=null),!P){if(L)return null;P=new i.Z(this,null,h,M)}if(h&&h!==P.id){if(P.id){if(this.log.warn(`Data mismatch for user #${h} -- Stored ID: ${P.id} -- Login: ${M} -- Stored Login: ${P.login}`),O)throw new Error("id mismatch");this.user_ids[P.id]===P&&(this.user_ids[P.id]=null)}P._id=h,this.user_ids[h]=P}if(M){const j=this.users[M];j?j!==P&&!T&&(j.id?this.users[M]=P:(P.merge(j),j.destroy(!0))):this.users[M]=P}return P}getRoom(h,M,L,T,O=!1){let P;if(h&&typeof h=="number"&&(h=`${h}`),h&&this.room_ids[h]?P=this.room_ids[h]:M&&this.rooms[M]&&!T&&(P=this.rooms[M]),P&&P.destroyed&&(P=null),!P){if(L)return null;P=new s.Z(this,h,M)}if(h&&h!==P.id){if(P.id){if(this.log.warn(`Data mismatch for room #${h} -- Stored ID: ${P.id} -- Login: ${M} -- Stored Login: ${P.login}`),O)throw new Error("id mismatch");this.room_ids[P.id]===P&&(this.room_ids[P.id]=null)}P._id=h,this.room_ids[h]=P}if(M){const j=this.rooms[M];j?j!==P&&!T&&(j.id?this.rooms[M]=P:(P.merge(j),j.destroy(!0))):this.rooms[M]=P}return P}*iterateAllRoomsAndUsers(){for(const h of this.iterateRooms()){yield h;for(const M of h.iterateUsers())yield M}for(const h of this.iterateUsers())yield h}*iterateUsers(){const h=new Set;for(const M of Object.values(this.user_ids))M&&!M.destroyed&&(h.add(M),yield M);for(const M of Object.values(this.users))M&&!M.destroyed&&(yield M)}*iterateRooms(){const h=new Set;for(const M of Object.values(this.room_ids))M&&!M.destroyed&&(h.add(M),yield M);for(const M of Object.values(this.rooms))M&&!M.destroyed&&!h.has(M)&&(yield M)}iterateMessages(h=!0,M=!0,L=!0){const T=[];return this.emit("chat:get-messages",h,M,L,T),this.emit("chat:get-messages-late",h,M,L,T),T}handleLinkClick(h){if(h.ctrlKey||h.shiftKey)return;const M=h.currentTarget,L=M?.dataset;if(!L)return;const T=this.makeEvent({url:L.url??M.href,source:h});if(this.emit("chat:click-link",T),T.defaultPrevented)return h.preventDefault(),h.stopPropagation(),!0}handleReplyClick(h){const M=h.target,L=this.resolve("site.fine");if(!M||!L)return;const T=L.searchParent(M,O=>O.props&&O.props.reply&&O.setOPCardTray);T&&T.setOPCardTray(T.props.reply)}handleMentionClick(h){if(!this.context.get("chat.filtering.clickable-mentions"))return;const M=h.target,L=M&&M.dataset;if(!L||!L.login)return;const T=this.resolve("site.fine");if(!T)return;const O=T.searchParent(M,P=>P.props&&P.props.onUsernameClick);O&&O.props.onUsernameClick(L.login,void 0,void 0,h.currentTarget.getBoundingClientRect().bottom)}clickToReveal(h){const M=h.target;if(M){if(M._ffz_visible)M.textContent="\xD7\xD7\xD7";else if(this.context.get("chat.filtering.click-to-reveal"))M.dataset&&(M.textContent=M.dataset.text);else return;M._ffz_visible=!M._ffz_visible}}standardizeWhisper(h){if(!h)return h;if(h._ffz_message)return h._ffz_message;const M={},L=h.content.startsWith("/me "),T=L?4:0,O=h._ffz_message={id:h.id,user:{...h.from},message:h.content.slice(T),is_action:L,ffz_emotes:M,timestamp:h.sentAt&&h.sentAt.getTime(),deleted:!1};if(O.user.color=O.user.chatColor,Array.isArray(h.emotes)&&h.emotes.length)for(const P of h.emotes){const j=P.emoteID;(M[j]=M[j]||[]).push({startIndex:P.from-T,endIndex:P.to-T})}return O}getUserLevel(h){return!h||!h.user?0:h.user.login===h.roomLogin||h.badges&&h.badges.broadcaster?4:h.badges?h.badges.moderator?3:h.badges.vip?2:h.badges.subscriber?1:0:0}tokenizeReply(h){return h?[{type:"reply",text:h.parentDisplayName,color:this.context.get("chat.filtering.color-mentions")&&this.color_cache?this.color_cache.get(h.parentUserLogin):null,recipient:h.parentUserLogin},{type:"text",text:" "}]:null}applyHighlight(h,M,L,T,O=!1){if(!h)return h;const P=h.mention_priority==null,j=P||M>=h.mention_priority,Z=P||M>h.mention_priority;if(h.filters&&h.filters.push(`${T}(${M})${j&&L===!1?":remove":L?`:${L}`:""}`),j){if(h.mention_priority=M,L===!1){Z&&(h.mentioned=!1,h.clear_priority=M,h.mention_color=h.highlights=null);return}h.mentioned=!0,h.highlights||(h.highlights=new Set)}h.mentioned&&(h.clear_priority==null||M>=h.clear_priority)&&(h.highlights.add(T),(L||O)&&(Z||!h.mention_color)&&(h.mention_color=L))}standardizeMessage(h){if(!h)return h;h.ffz_standardized=!0,h.sender&&!h.user&&(h.user=h.sender),h.from&&!h.user&&(h.user=h.from);let M=h.user;M||(M=h.user={});const L=h.extension||{};if(M.color=M.color||M.chatColor||L.chatColor||null,M.type=M.type||M.userType||null,M.id=M.id||M.userID||null,M.login=M.login||M.userLogin||null,M.displayName=M.displayName||M.userDisplayName||M.login||L.displayName,M.isIntl=M.login&&M.displayName&&M.displayName.trim().toLowerCase()!==M.login,this.color_cache&&M.color&&this.color_cache.set(M.login,M.color),!h.message&&h.messageParts&&this.detokenizeMessage(h),h.content&&!h.message&&(h.content.fragments?this.detokenizeContent(h):h.message=h.content.text),h.ffz_emotes||this.standardizeEmotes(h),!h.badges&&M.displayBadges){const T=h.badges={};for(const O of M.displayBadges)T[O.setID]=O.version}if(!h.badges&&L.displayBadges){const T=h.badges={};for(const O of L.displayBadges)T[O.setID]=O.version}return M.type==null&&h.badges&&h.badges.moderator&&(M.type="mod"),!h.timestamp&&h.sentAt&&(h.timestamp=new Date(h.sentAt).getTime()),h.deletedAt!==void 0&&(h.deleted=!!h.deletedAt),h.ffz_badges=h.sourceRoomID?this.badges.getBadges(M.id,M.login,h.sourceRoomID,null):this.badges.getBadges(M.id,M.login,h.roomID,h.roomLogin),h}standardizeEmotes(h){if(h.emotes&&h.message){const M={},L=(0,f.split_chars)(h.message);let T=0;h.message&&h.messageBody&&h.message!==h.messageBody&&(T=L.length-(0,f.split_chars)(h.messageBody).length);for(const O in h.emotes)if((0,f.has)(h.emotes,O)){const P=h.emotes[O];if(Array.isArray(P))return h.ffz_emotes=h.emotes;const j=M[P.id]=M[P.id]||[];let Z=P.startIndex+1+T;for(;Z<L.length&&!x.test(L[Z]);)Z++;j.push({startIndex:P.startIndex+T,endIndex:Z-1})}h.ffz_emotes=M;return}h.messageParts?this.detokenizeMessage(h,!0):h.content&&h.content.fragments&&this.detokenizeContent(h,!0)}detokenizeContent(h,M=!1){const L=[],T=h.content.fragments,O=T.length,P={};let j=0,Z,q=!0;for(let X=0;X<O;X++){const ee=T[X],te=ee.content,ne=te&&te.__typename;if(Z=ee.text,ne==="Emote"){const pe=te.emoteID;(P[pe]=P[pe]||[]).push({startIndex:j,endIndex:j+Z.length-1})}Z&&Z.length&&(q&&Z.startsWith("/me ")&&(h.is_action=!0,Z=Z.slice(4)),j+=(0,f.split_chars)(Z).length,L.push(Z)),q=!1}return M||(h.message=L.join("")),h.ffz_emotes=P,h}detokenizeMessage(h,M=!1){const L=[],T=h.messageParts,O=T.length,P={};let j=0,Z,q=null,X=0;for(let ee=0;ee<O;ee++){const te=T[ee],ne=te.ffz_content??te.content;if(ne){if(typeof ne=="string")Z=ne;else if(ne.recipient)Z=`@${ne.recipient}`;else if(ne.url)Z=ne.url;else if(ne.cheerAmount)X+=ne.cheerAmount,Z=`${ne.alt}${ne.cheerAmount}`;else if(ne.images){const pe=ne.images.themed?ne.images.dark:ne.images.sources;let oe=ne.emoteID;if(!oe){const de=pe&&(/\/emoticons\/v1\/(\d+)\/[\d.]+$/.exec(pe["1x"])||/\/emoticons\/v2\/(\d+)\//.exec(pe["1x"]));oe=de&&de[1]}if(Z=ne.alt,oe){const de=P[oe]=P[oe]||[],me=q>0?1:0;de.push({startIndex:j+me,endIndex:j+Z.length-1})}q>0&&(Z=` ${Z}`)}else continue;Z&&(j+=(0,f.split_chars)(Z).length,q=te.type,L.push(Z))}}return M||(h.message=L.join("")),h.bits=X,h.ffz_emotes=P,h}formatUser(h,M){const L=this.context.get("chat.name-format"),T=L===2&&h.isIntl?h.login:h.displayName||h.login,O=[M("span",{className:"chat-author__display-name"},T)];return L===0&&h.isIntl&&O.push(M("span",{className:"chat-author__intl-login"},` (${h.login})`)),O}formatTime(h){h instanceof Date||(h=new Date(h));const M=this.context.get("chat.timestamp-format"),L=B()(h);try{return L.locale(this.i18n.locale).format(M)}catch{return L.format(M)}}addHighlightReason(h,M,L){if(typeof h=="object"&&h.key?(M=h,h=M.key):typeof M=="string"&&(M={title:M}),typeof L=="string"&&L.length>0&&(M.label=L),M.value=M.key=h,M.i18n_key||(M.i18n_key=`hl-reason.${h}`),M.label&&!M.i18n_label&&(M.i18n_label=`${M.i18n_key}.label`),this._hl_reasons[h])throw new Error(`Highlight Reason already exists with key ${h}`);this._hl_reasons[h]=M}getHighlightReason(h){return this._hl_reasons[h]??null}getHighlightReasons(){return Object.values(this._hl_reasons)}addTabCommandPrefix(h,M="ffz"){Array.isArray(h)||(h=[h]);for(const L of h){if(typeof L!="string"||L.length!==1)throw new Error("Invalid command prefix. Must be string of length 1.");this.CommandPrefixes.push(M,L)}}removeTabCommandPrefix(h,M="ffz"){Array.isArray(h)||(h=[h]);for(const L of h)this.CommandPrefixes.remove(M,L)}addTokenizer(h){const M=h.type;if((0,f.has)(this.tokenizers,M)){this.log.warn(`Tried adding tokenizer of type '${M}' when one was already present.`);return}if(this.tokenizers[M]=h,h.priority==null&&(h.priority=0),h.tooltip){const L=h.tooltip,T=this.tooltips.types[M]=L.bind(this);for(const O of["interactive","delayShow","delayHide","onShow","onHide"])T[O]=typeof L[O]=="function"?L[O].bind(this):L[O]}this.__tokenizers.push(h),this.__tokenizers.sort((L,T)=>L.priority>T.priority?-1:L.priority<T.priority?1:L.type<T.type)}removeTokenizer(h){let M;if(typeof h=="string"?M=h:M=h.type,h=this.tokenizers[M],!h)return null;delete this.tokenizers[M],h.tooltip&&delete this.tooltips.types[M];const L=this.__tokenizers.indexOf(h);return L!==-1&&this.__tokenizers.splice(L,1),h}addLinkProvider(h){const M=h.type;if((0,f.has)(this.link_providers,M)){this.log.warn(`Tried adding link provider of type '${M}' when one was already present.`);return}this.link_providers[M]=h,h.priority==null&&(h.priority=0),this.__link_providers.push(h),this.__link_providers.sort((L,T)=>L.priority>T.priority?-1:L.priority<T.priority?1:L.type<T.type)}removeLinkProvider(h){let M;if(typeof h=="string"?M=h:M=h.type,h=this.link_providers[M],!h)return null;delete this.link_providers[M];const L=this.__link_providers.indexOf(h);return L!==-1&&this.__link_providers.splice(L,1),h}addRichProvider(h){const M=h.type;if((0,f.has)(this.rich_providers,M)){this.log.warn(`Tried adding rich provider of type '${M}' when one was already present.`);return}this.rich_providers[M]=h,h.priority==null&&(h.priority=0),this.__rich_providers.push(h),this.__rich_providers.sort((L,T)=>L.priority>T.priority?-1:L.priority<T.priority?1:L.type<T.type)}removeRichProvider(h){let M;if(typeof h=="string"?M=h:M=h.type,h=this.rich_providers[M],!h)return null;delete this.rich_providers[M];const L=this.__rich_providers.indexOf(h);return L!==-1&&this.__rich_providers.splice(L,1),h}tokenizeString(h,M,L,T=!1){let O=[{type:"text",text:h}];for(const P of this.__tokenizers){if(!P.process)continue;const j=P.process.call(this,O,M,L,T);if(j&&(O=j),T&&M.ffz_halt_tokens){M.ffz_halt_tokens=void 0;break}}return O}pluckLastEmote(h){if(!Array.isArray(h))return;let M=h.length;for(;M--;){const L=h[M];if(L.type==="emote"&&L.provider!=="emoji")return this.context.get("chat.emotes.allow-gigantify")?(L.gigantify=!0,L.hidden=!0,L):(L.gigantify&&(L.hidden=!1),null);if(L.hidden)continue}}pluckRichContent(h,M){if(!this.context.get("chat.rich.enabled")||this.context.get("chat.rich.minimum-level")>this.getUserLevel(M)||!Array.isArray(h))return;const L=this.__rich_providers,T=this.context.get("chat.rich.want-mid");for(const O of h)if(O.allow_rich??!0){for(const P of L)if(P.test.call(this,O,M))return O.hidden=P.can_hide_token&&(this.context.get("chat.rich.hide-tokens")||P.hide_token),P.process.call(this,O,T)}}tokenizeMessage(h,M,L=!1){if(h.content&&!h.message&&(h.message=h.content.text),h.sender&&!h.user&&(h.user=h.sender),!h.message)return[];let T=[{type:"text",text:h.message}];for(const O of this.__tokenizers){if(!O.process)continue;const P=O.process.call(this,T,h,M,L);if(P&&(T=P),L&&h.ffz_halt_tokens){h.ffz_halt_tokens=void 0;break}}return T||[]}renderGiantEmote(h,M){M||(M=z.createElement);const L=h.anim===1,T=h.anim===2;let O,P,j;if(h.provider==="twitch")O=(0,f.getTwitchEmoteURL)(h.id,4,L,!0),T&&(P=(0,f.getTwitchEmoteURL)(h.id,4,!0,!0)),j=112;else if(h.provider==="ffz"){const Z=this.emotes.emote_sets[h.set],q=Z?.emotes?.[h.id];if(q){let X=(L?q.animated:null)??q.urls,ee=c(X);if(!ee)return null;O=ee[0],j=q.height*ee[1],T&&q.animated&&(ee=c(q.animated),ee&&(P=ee[0]))}}else O=null;return O?M("img",{className:`chat-image chat-line__message--emote ffz--pointer-events ffz-tooltip${P?" ffz-hover-emote":""}${h.provider==="twitch"?" twitch-emote":h.provider==="ffz"?" ffz-emote":h.provider==="emoji"?" ffz-emoji":""}`,src:O,height:`${j}px`,alt:h.text,"data-normal-src":O,"data-hover-src":P,"data-tooltip-type":"emote","data-provider":h.provider,"data-id":h.id,"data-set":h.set,"data-code":h.code,"data-variant":h.variant,onClick:this.emotes.handleClick}):null}renderTokens(h,M,L){M||(M=z.createElement);const T=[],O=this.tokenizers,P=h.length,j=this.context.get("chat.filtering.hidden-tokens");for(let Z=0;Z<P;Z++){const q=h[Z],X=q.type,ee=O[X];if(q.hidden||j.has(X))continue;let te;L&&Z===0&&X==="mention"&&q.recipient&&q.recipient===L.parentUserLogin||(X==="text"?te=M("span",{className:"text-fragment","data-a-target":"chat-message-text"},q.text):ee?te=ee.render.call(this,q,M,L):te=M("em",{className:"ffz-unknown-token ffz-tooltip","data-tooltip-type":"json","data-data":JSON.stringify(q,null,2)},`[unknown token: ${X}]`),te&&T.push(te))}return T}clearLinkCache(h){if(h){const L=this._link_info[h];if(!L[0])for(const T of L[2])T[1]();this._link_info[h]=null,this.emit(":update-link-resolver",h);return}const M=this._link_info;this._link_info={};for(const L of Object.values(M))if(!L[0])for(const T of L[2])T[1]();this.emit(":update-link-resolver")}get_link_info(h,M,L=!1){let T=this._link_info[h];const O=T&&T[1];if((T&&T[0]&&L||O&&Date.now()>O)&&(T=this._link_info[h]=null),T&&T[0]){const P=this.handleLinkToS(T[2]);return M?P:Promise.resolve(P)}return M?null:T?new Promise((P,j)=>T[2].push([P,j])):new Promise((P,j)=>{T=this._link_info[h]=[!1,null,[[P,j]]];const Z=G((X,ee)=>{ee=this.fixLinkInfo(ee);const te=!T[0]&&T[2];if(T[0]=!0,T[1]=Date.now()+12e4,T[2]=X?ee:null,ee=this.handleLinkToS(ee),te)for(const ne of te)ne[X?0:1](ee)},"handle");for(const X of this.__link_providers){const ee=X.test.call(this,h);if(ee){(0,f.timeout)(X.process.call(this,ee),15e3).then(te=>Z(!0,te)).catch(te=>Z(!1,te));return}}let q=this.settings.get("debug.link-resolver.source").value;q==="special:socket"&&!this.socket&&(q=R.LINK_DATA_HOSTS.test.value),q==="special:socket"?(0,f.timeout)(this.socket.call("get_link",h),15e3).then(X=>Z(!0,X)).catch(X=>Z(!1,X)):(0,f.timeout)(fetch(`${q}?url=${encodeURIComponent(h)}`).then(X=>X.json()),15e3).then(X=>Z(!0,X)).catch(X=>Z(!1,X))})}handleLinkToS(h){if(!Array.isArray(h?.urls))return h;const M=this.settings.provider.get("agreed-tos",[]),L=this.settings.provider.get("declined-tos",[]),T=new Set(h.urls.map(O=>O.resolver).filter(O=>O));for(const[O,P]of Object.entries(R.RESOLVERS_REQUIRE_TOS))if(T.has(O)&&!M.includes(O)){const j=L.includes(O);return{...h,url:null,short:[{type:"box",content:[P.i18n_key?{type:"i18n",key:P.i18n_key,phrase:P.label}:P.label,j?null:" ",j?null:{type:"conditional",tooltip:!1,content:{type:"i18n",key:"embed.tos-open-settings",phrase:"{link} to open your settings.",content:{link:{type:"open_settings",item:"chat.tooltips",content:{type:"i18n",key:"embed.tos-open-settings.click",phrase:"Click here"}}}},alternative:{type:"i18n",key:"embed.tos-settings",phrase:"Open the FFZ Control Center and navigate to Chat > Tooltips to agree."}}]}],mid:null,full:null}}return h}agreeToTerms(h){const M=this.settings.provider.get("agreed-tos",[]);M.includes(h)||(this.settings.provider.set("agreed-tos",[...M,h]),this.emit(":update-link-resolver"))}declineTerms(h){const M=this.settings.provider.get("declined-tos",[]);M.includes(h)||(this.settings.provider.set("declined-tos",[...M,h]),this.emit(":update-link-resolver"))}hasAgreedToTerms(h){const M=this.settings.provider.get("agreed-tos");return M?M.includes(h):!1}hasDeclinedTerms(h){const M=this.settings.provider.get("declined-tos");return M?M.includes(h):!1}onProviderChange(h,M){h!=="agreed-tos"&&h!=="declined-tos"||this.emit(":update-link-resolver")}fixLinkInfo(h){if(!h)return h;if(h.error&&h.message&&(h.error=h.message),h.error&&(h={v:5,title:this.i18n.t("card.error","An error occurred."),description:h.error,short:{type:"header",image:{type:"image",url:m},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:h.error},unsafe:h.unsafe,urls:h.urls}),h.v<5&&!h.short&&!h.full&&(h.title||h.desc_1||h.desc_2)){const M=h.preview||h.image;h={v:5,short:{type:"header",image:M?{type:"image",url:M,sfw:h.image_safe??!1}:null,title:h.title,subtitle:h.desc_1,extra:h.desc_2}}}return h}};G(b,"Chat");let r=b;function c(k){return k?.[4]?[k[4],4]:k?.[3]?[k[3],3]:k?.[2]?[k[2],2]:k?.[1]?[k[1],1]:null}G(c,"getBiggestImage")},52970:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{Clip:()=>y,User:()=>S,Video:()=>n});var W=d(36e3),B=d.n(W),R=d(87590),I=d.n(R);const U=/^(?:https?:\/\/)?clips\.twitch\.tv\/([a-z0-9-_=]+)(?:\/)?(\w+)?(?:\/edit)?/i,z=/^(?:https?:\/\/)?(?:(?:www|m)\.)?twitch\.tv\/\w+\/clip\/([a-z0-9-_=]+)/i,v=/^(?:https?:\/\/)?(?:www\.)?twitch\.tv\/(?:\w+\/v|videos)\/(\w+)/,f=/^(?:https?:\/\/)?(?:www\.)?twitch\.tv\/([^/]+)$/,u=["directory","_deck","p","downloads","jobs","turbo","settings","friends","subscriptions","inventory","wallet","store","drops","search","prime"],y={type:"clip",test(s){const i=U.exec(s)||z.exec(s);if(i&&i[1]&&i[1]!=="create")return i[1]},receive(s,i){const l=i?.twitch_metadata?.clip_metadata;if(l)return{id:l.id,slug:l.slug,title:i.title,thumbnailURL:i.thumbnail_url,curator:{id:l.curator_id,displayName:i.author_name},broadcaster:{id:l.broadcaster_id,displayName:l.channel_display_name},game:{displayName:l.game}}},async process(s,i){let l=i;if(!l){const m=this.resolve("site.apollo");if(!m)return null;l=(await m.client.query({query:B(),variables:{slug:s}}))?.data?.clip}if(!l||!l.broadcaster)return null;const w=l.game,_=w&&w.displayName;let o={type:"style",weight:"semibold",color:"alt-2",content:l.broadcaster.displayName};l.broadcaster.login&&(o={type:"link",url:`https://www.twitch.tv/${l.broadcaster.login}`,content:o});const e=_?{type:"i18n",key:"clip.desc.1.playing",phrase:"{user} playing {game}",content:{user:o,game:{type:"style",weight:"semibold",content:_}}}:{type:"i18n",key:"clip.desc.1",phrase:"Clip of {user}",content:{user:o}};let a=l.curator?{type:"style",color:"alt-2",content:l.curator.displayName}:{type:"i18n",key:"clip.unknown",phrase:"Unknown"};l.curator?.login&&(a={type:"link",url:`https://www.twitch.tv/${l.curator.login}`,content:a});let p;return l.viewCount>0?p={type:"i18n",key:"clip.desc.2",phrase:"Clipped by {curator} \u2014 {views, plural, one {# View} other {# Views}}",content:{curator:a,views:l.viewCount}}:p={type:"i18n",key:"clip.desc.no-views",phrase:"Clipped by {curator}",content:{curator:a}},{accent:"#6441a4",fragments:{header:{type:"header",image:{type:"image",url:l.thumbnailURL,sfw:!0,aspect:16/9},title:l.title,subtitle:e,extra:p}},short:{type:"ref",name:"header"},full:[{type:"ref",name:"header"},{type:"conditional",media:!0,content:{type:"gallery",items:[{type:"player",iframe:`https://clips.twitch.tv/embed?parent=twitch.tv&clip=${s}`,aspect:16/9,content:{type:"overlay",content:{type:"image",url:l.thumbnailURL,sfw:!0,aspect:16/9},center:{type:"style",size:"2",content:{type:"icon",name:"play"}}}}]}}]}}},S={type:"user",test(s){const i=f.exec(s);if(i&&!u.includes(i[1]))return i[1]},async process(s){const i=this.resolve("site.twitch_data"),l=i?await i.getUser(null,s):null;if(!l||!l.id)return null;const w=l.broadcastSettings?.game?.displayName,_=l.stream?.id,o={avatar:{type:"image",url:l.profileImageURL,rounding:-1,aspect:1},desc:l.description,title:[l.displayName]};_&&w&&(o.game={type:"style",weight:"semibold",content:w}),l.displayName.trim().toLowerCase()!==l.login&&o.title.push({type:"style",color:"alt-2",content:[" (",l.login,")"]}),l.roles?.isPartner&&o.title.push({type:"style",color:"link",content:{type:"icon",name:"verified"}});const e=[{type:"header",image:{type:"ref",name:"avatar"},title:{type:"ref",name:"title"}},{type:"box","mg-y":"small",wrap:"pre-wrap",lines:5,content:{type:"ref",name:"desc"}}];if(_&&w){const a=l.stream.previewImageURL?l.stream.previewImageURL.replace("{width}","320").replace("{height}","180"):null;e.push({type:"link",url:`https://www.twitch.tv/${l.login}`,embed:!0,interactive:!0,tooltip:!1,content:[{type:"conditional",media:!0,content:{type:"gallery",items:[{type:"image",url:a,aspect:16/9}]}},{type:"box","mg-y":"small",lines:2,content:l.broadcastSettings.title},{type:"ref",name:"game"}]})}return e.push({type:"header",compact:!0,subtitle:[{type:"icon",name:"twitch"}," Twitch"]}),{v:5,accent:l.primaryColorHex?`#${l.primaryColorHex}`:null,fragments:o,short:{type:"header",image:{type:"ref",name:"avatar"},title:{type:"ref",name:"title"},subtitle:{type:"ref",name:"desc"},extra:_?{type:"i18n",key:"cards.user.streaming",phrase:"streaming {game}",content:{game:{type:"ref",name:"game"}}}:null},full:e}}},n={type:"video",test(s){const i=v.exec(s);if(i)return i[1]},async process(s){const i=this.resolve("site.apollo");if(!i)return null;const l=await i.client.query({query:I(),variables:{id:s}});if(!l||!l.data||!l.data.video||!l.data.video.owner)return null;const w=l.data.video,_=w.game,o=_&&_.displayName,e={title:w.title,thumbnail:{type:"image",url:w.previewThumbnailURL,aspect:16/9}},a={type:"link",url:`https://www.twitch.tv/${w.owner.login}`,content:{type:"style",weight:"semibold",color:"alt-2",content:w.owner.displayName}};e.subtitle=w.game?.displayName?{type:"i18n",key:"video.desc.1.playing",phrase:"Video of {user} playing {game}",content:{user:a,game:{type:"style",weight:"semibold",content:w.game.displayName}}}:{type:"i18n",key:"video.desc.1",phrase:"Video of {user}",content:{user:a}};let p=w.lengthSeconds;return{v:5,fragments:e,short:{type:"header",image:{type:"ref",name:"thumbnail"},title:{type:"ref",name:"title"},subtitle:{type:"ref",name:"subtitle"},extra:{type:"i18n",key:"video.desc.2",phrase:"{length,duration} \u2014 {views,number} Views \u2014 {date,datetime}",content:{length:p,views:w.viewCount,date:w.publishedAt}}},full:[{type:"header",image:{type:"image",url:w.owner.profileImageURL,rounding:-1,aspect:1},title:{type:"ref",name:"title"},subtitle:{type:"ref",name:"subtitle"}},{type:"box","mg-y":"small",lines:5,wrap:"pre-wrap",content:w.description},{type:"conditional",media:!0,content:{type:"gallery",items:[{type:"overlay",content:{type:"ref",name:"thumbnail"},"top-left":{type:"format",format:"duration",value:p},"bottom-left":{type:"i18n",key:"video.views",phrase:"{views,number} views",content:{views:w.viewCount}}}]}},{type:"header",compact:!0,subtitle:[{type:"icon",name:"twitch"}," Twitch \u2022 ",{type:"format",format:"datetime",value:w.publishedAt}]}]}}}},88854:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{Links:()=>W});const W={type:"link",can_hide_token:!0,priority:-10,test(B){if(B.type!=="link")return!1;const R=B.url;for(const I of this.__link_providers)if(I.test.call(this,R))return!0;return this.context.get("chat.rich.all-links")||B.force_rich},process(B,R){return{card_tooltip:!0,url:B.url,timeout:0,want_mid:R,getData:async(I=!1)=>{let U;try{U=await this.get_link_info(B.url,!1,I)}catch(z){return{url:B.url,error:String(z)}}return U?{...U,allow_media:this.context.get("tooltip.link-images"),allow_unsafe:this.context.get("tooltip.link-nsfw-images")}:{url:B.url}}}}}},89711:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>u});var W=d(22231),B=d(24431),R=d(44589),I=d(46949),U=d(12381),z=Object.defineProperty,v=G((S,n,s)=>n in S?z(S,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):S[n]=s,"__defNormalProp"),f=G((S,n,s)=>(v(S,typeof n!="symbol"?n+"":n,s),s),"__publicField");const y=class y{constructor(n,s,i){f(this,0),this._destroy_timer=null,this.refs=new Set,this.style=new R.ManagedStyle(`room--${i}`),this.emote_sets=null,this.badges=null,this.users={},this.user_ids={},this.shared_chats=new Set,this.manager=n,this._id=s,this.login=i,s&&(this.manager.room_ids[s]=this),s&&this.manager.pubsub&&this.manager.pubsub.subscribe(this,`twitch/${s}`),this.manager.emit(":room-add",this),this.load_data()}destroy(){if(clearTimeout(this._destroy_timer),this._destroy_timer=null,this.destroyed=!0,this.manager.emit(":room-remove",this),this.users)for(const n of Object.values(this.users))n&&n.destroy();if(this.user_ids)for(const n of Object.values(this.user_ids))n&&n.destroy();if(this.shared_chats=null,this.refs=null,this.users=null,this.user_ids=null,this.style&&(this.style.destroy(),this.style=null),this.emote_sets){for(const n of this.emote_sets._cache)this.manager.emotes.unrefSet(n);this.emote_sets=null}this._login&&(this.manager.rooms[this._login]===this&&(this.manager.rooms[this._login]=null),this.manager.socket&&this.manager.socket.unsubscribe(this,`room.${this.login}`)),this._id&&this.manager.pubsub&&this.manager.pubsub.unsubscribe(this,`twitch/${this._id}`),this.manager.room_ids[this._id]===this&&(this.manager.room_ids[this._id]=null)}merge(n){if(!this.login&&n.login&&(this.login=n.login),n.refs)for(const i of n.refs)this.ref(i);if(n.shared_chats)for(const i of n.shared_chats)this.shareChat(i);if(n.emote_sets&&n.emote_sets._sources)for(const[i,l]of n.emote_sets._sources.entries())for(const w of l)this.addSet(i,w);n.data&&!this.data&&(this.data=n.data,this.data.css?this.style.set("css",this.data.css):this.style.delete("css"),this.buildModBadgeCSS(),this.buildVIPBadgeCSS()),n.badges&&!this.badges&&(this.badges=n.badges,this.buildBadgeCSS()),n.bitsConfig&&!this.bitsConfig&&(this.bitsConfig=n.bitsConfig,this.buildBitsCSS());const s=new Set;if(n.users)for(const i of Object.values(n.users))!i.destroyed&&!s.has(i)&&(this.getUser(i.id,i.login).merge(i),s.add(i));if(n.user_ids)for(const i of Object.values(n.user_ids))!i.destroyed&&!s.has(i)&&(this.getUser(i.id,i.login).merge(i),s.add(i))}shareChat(n){this.shared_chats.add(n)}shareChats(n){this.shared_chats=new Set(n||[])}unshareChat(n){n?this.shared_chats.delete(n):this.shared_chats.clear()}_unloadAddon(n){return 0}get id(){return this._id}get login(){return this._login}set login(n){if(this._login===n||(this._login&&this.manager.rooms[this._login]===this&&(this.manager.rooms[this._login]=null,this.manager.socket&&this.manager.socket.unsubscribe(this,`room.${this.login}`)),this._login=n,!n))return;const s=this.manager.rooms[n];s&&s!==this&&(s.login=null),this._login=n,this.manager.rooms[n]=this,this.manager.socket&&this.manager.socket.subscribe(this,`room.${n}`),this.manager.emit(":room-update-login",this,n)}*iterateUsers(){const n=new Set;for(const s of Object.values(this.user_ids))s&&!s.destroyed&&(n.add(s),yield s);for(const s of Object.values(this.users))s&&!s.destroyed&&(yield s)}getUser(n,s,i,l,w=!1){if(this.destroyed)return null;let _;if(n&&typeof n=="number"&&(n=`${n}`),n&&this.user_ids[n]?_=this.user_ids[n]:s&&this.users[s]&&!l&&(_=this.users[s]),_&&_.destroyed&&(_=null),!_){if(i)return null;_=new W.Z(this.manager,this,n,s)}if(n&&n!==_.id){if(_.id){if(this.manager.log.warn(`Data mismatch for user #${n} -- Stored ID: ${_.id} -- Login: ${s} -- Stored Login: ${_.login}`),w)throw new Error("id mismatch");this.user_ids[_.id]===_&&(this.user_ids[_.id]=null)}_._id=n,this.user_ids[n]=_}if(s){const o=this.users[s];o?o!==_&&!l&&(o.id?this.users[s]=_:(_.merge(o),o.destroy())):this.users[s]=_}return _}async load_data(n=0){if(this.destroyed)return;const s=`ffz-room-${this.id?`id:${this.id}`:this.login}`;if(this.manager.load_tracker.schedule("chat-data",s),this.manager.experiments.getAssignment("api_load"))try{fetch(`${B.NEW_API}/v1/room/${this.id?`id/${this.id}`:this.login}`).catch(()=>{})}catch{}let i,l;try{i=await fetch(`${this.manager.staging.api}/v1/room/${this.id?`id/${this.id}`:this.login}`)}catch(a){return n++,n<10?setTimeout(()=>this.load_data(n),500*n):(this.manager.log.error(`Error loading room data for ${this.id}:${this.login}`,a),this.manager.load_tracker.notify("chat-data",s,!1),!1)}if(!i.ok)return this.manager.load_tracker.notify("chat-data",s,!1),!1;try{l=await i.json()}catch(a){return this.manager.log.error(`Error parsing room data for ${this.id}:${this.login}`,a),this.manager.load_tracker.notify("chat-data",s,!1),!1}const w=this.data?.user_badge_ids;if(w){for(const a in w)if((0,I.has)(w,a))for(const p of w[a])this.getUser(p,void 0).removeBadge("ffz",a)}const _=l.room,o=`${_.twitch_id}`;if(!this._id)this._id=o,this.manager.room_ids[o]=this;else if(this._id!==o)return this.manager.log.warn(`Received data for ${this.id}:${this.login} with the wrong ID: ${o}`),this.manager.load_tracker.notify("chat-data",s,!1),!1;if(this.login?this.login!==_.id&&this.manager.log.warn(`Login mismatch for room ${this.id}:${this.login}. Got "${_.id}" from FFZ's API.`):this.login=_.id,this.data=_,this.removeAllSets("ffz-main"),_.set&&this.addSet("ffz-main",_.set),l.sets)for(const a in l.sets)(0,I.has)(l.sets,a)&&this.manager.emotes.loadSetData(a,l.sets[a]);const e=_.user_badge_ids;if(e){for(const a in e)if((0,I.has)(e,a))for(const p of e[a])this.getUser(p,void 0).addBadge("ffz",a)}return _.css?this.style.set("css",_.css):this.style.delete("css"),this.buildModBadgeCSS(),this.buildVIPBadgeCSS(),this.manager.load_tracker.notify("chat-data",s),!0}addSet(n,s,i){if(this.destroyed)return;this.emote_sets||(this.emote_sets=new I.SourcedSet(!1,this.manager.emotes.sourceSortFn)),typeof s=="number"&&(s=`${s}`);let l=!1,w=!1;return this.emote_sets.sourceIncludes(n,s)||(l=!this.emote_sets.includes(s),this.emote_sets.push(n,s),w=!0),i&&this.manager.emotes.loadSetData(s,i),l&&(this.manager.emotes.refSet(s),this.manager.emotes.emit(":update-room-sets",this,n,s,!0)),w}removeAllSets(n){if(this.destroyed||!this.emote_sets)return!1;const s=this.emote_sets.get(n);if(!Array.isArray(s)||!s.length)return!1;for(const i of s)this.removeSet(n,i);return!0}removeSet(n,s){if(!(this.destroyed||!this.emote_sets))return typeof s=="number"&&(s=`${s}`),this.emote_sets.sourceIncludes(n,s)?(this.emote_sets.remove(n,s),this.emote_sets.includes(s)||(this.manager.emotes.unrefSet(s),this.manager.emotes.emit(":update-room-sets",this,n,s,!1)),!0):!1}ref(n){if(!this.refs)throw new Error("Attempting to use destroyed Room");clearTimeout(this._destroy_timer),this._destroy_timer=null,this.refs.add(n)}unref(n){this.refs&&(this.refs.delete(n),!this.refs.size&&!this._destroy_timer&&(this._destroy_timer=setTimeout(()=>this.destroy(),5e3)))}badgeCount(){return this.badge_count||0}updateBadges(n){if(this.badge_count=0,n instanceof Map){const s={};for(const[i,l]of n.entries()){const w=s[i]=s[i]||{__cat:(0,U.iV)(i)};for(const[_,o]of l.entries())w[_]=(0,U.QC)(o),this.badge_count++}this.badges=s}else if(!Array.isArray(n))this.badges=n;else{const s={};for(const i of n){const l=i.setID,w=s[l]=s[l]||{__cat:(0,U.iV)(l)};w[i.version]=(0,U.QC)(i),this.badge_count++}this.badges=s}this.buildBadgeCSS()}buildVIPBadgeCSS(){if(this.destroyed)return;if(!this.data||!this.data.vip_badge||!this.manager.context.get("chat.badges.custom-vip"))return this.style.delete("vip-badge");const n=this.data.vip_badge,s=`url("${n[1]}")`;let i;(n[2]||n[4])&&(i=`${B.WEBKIT_CSS}image-set(${s} 1x${n[2]?`, url("${n[2]}") 2x`:""}${n[4]?`, url("${n[4]}") 4x`:""})`),this.style.set("vip-badge",`[data-room-id="${this.id}"] .ffz-badge[data-badge="vip"] {
			background-color: transparent;
			background-image: ${s};
			${i?`background-image: ${i};`:""}
			${B.WEBKIT_CSS}mask-image: unset;
		}`)}buildModBadgeCSS(){if(this.destroyed)return;if(!this.data||!this.data.mod_urls||!this.manager.context.get("chat.badges.custom-mod"))return this.style.delete("mod-badge");const n=this.manager.context.get("chat.badges.style"),s=n>5?`${B.WEBKIT_CSS}mask`:"background";if(!(n!==3&&n!==4))return this.style.delete("mod-badge");const l=this.data.mod_urls,w=`url("${l[1]}")`;let _;(l[2]||l[4])&&(_=`${B.WEBKIT_CSS}image-set(${w} 1x${l[2]?`, url("${l[2]}") 2x`:""}${l[4]?`, url("${l[4]}") 4x`:""})`),this.style.set("mod-badge",`[data-room-id="${this.id}"] .ffz-badge[data-badge="moderator"] {
			${s}-image: ${w};
			${_?`${s}-image: ${_};`:""}
		}`)}buildBadgeCSS(){if(this.destroyed)return;if(!this.badges)return this.style.delete("badges");const n=B.IS_FIREFOX&&this.manager.context.get("chat.badges.media-queries"),s=this.manager.context.get("chat.badges.clickable"),i=[],l=this.id;for(const w in this.badges)if((0,I.has)(this.badges,w)){const _=this.badges[w];for(const o in _)if((0,I.has)(_,o)){const e=_[o],a=`[data-room-id="${l}"] .ffz-badge[data-badge="${w}"][data-version="${o}"]`;i.push(`${a} {
			${s&&(e.click_action||e.click_url)?"cursor:pointer;":""}
			background-color: transparent;
			filter: none;
			${B.WEBKIT_CSS}mask-image: none;
			height: 1.8rem;
			width: 1.8rem;
			background-size: 1.8rem;
			background-image: url("${e.image1x}");
			background-image: ${B.WEBKIT_CSS}image-set(
				url("${e.image1x}") 1x,
				url("${e.image2x}") 2x,
				url("${e.image4x}") 4x
			);
		}`),n&&(i.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) { ${a} {
								background-image: url("${e.image2x}");
							}}`),i.push(`@media (min-resolution: 200dpi) { ${a} {
								background-image: url("${e.image4x}");
							}}`))}}this.style.set("badges",i.join(`
`))}updateBitsConfig(n,s){if(!s&&this.bitsConfig&&n){const i=new Set(Object.keys(this.bitsConfig)),l=new Set(Object.keys(n));if((0,I.set_equals)(i,l))return}this.bitsConfig=n,this.buildBitsCSS()}buildBitsCSS(){if(this.destroyed)return;if(!this.bitsConfig)return this.style.delete("bits");const n=this.manager.context.get("chat.bits.animated")?"animated":"static",s=this.manager.context.get("theme.is-dark")?"dark":"light",i=this.manager.context.get("theme.tooltips-dark")?"dark":"light",l=[];for(const w in this.bitsConfig)if((0,I.has)(this.bitsConfig,w)){const _=this.bitsConfig[w],o=_.prefix.toLowerCase(),e=_.tiers,a=e.length;for(let p=0;p<a;p++){const C=e[p].images[s][n],m=e[p].images[i][n];l.push(`.ffz-cheer[data-prefix="${o}"][data-tier="${p}"] {
	color: ${e[p].color||"inherit"};
	background-image: url("${C[1]}");
	background-image: ${B.WEBKIT_CSS}image-set(
		url("${C[1]}") 1x,
		url("${C[2]}") 2x,
		url("${C[4]}") 4x
	);
}
.ffz__tooltip .ffz-cheer[data-prefix="${o}"][data-tier="${p}"] {
	background-image: url("${m[1]}");
	background-image: ${B.WEBKIT_CSS}image-set(
		url("${m[1]}") 1x,
		url("${m[2]}") 2x,
		url("${m[4]}") 4x
	);
}
.ffz-cheer-preview[data-prefix="${o}"][data-tier="${p}"] {
	background-image: url("${m[4]}");
}`)}}this.style.set("bits",l.join(`
`))}};G(y,"Room");let u=y},46328:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{AddonEmotes:()=>h,AutomoddedTerms:()=>c,BadgeStuff:()=>C,BlockedTerms:()=>$,BlockedUsers:()=>a,CheerEmotes:()=>b,CustomHighlights:()=>m,Emoji:()=>M,FilterTester:()=>s,Links:()=>l,Mentions:()=>o,Replies:()=>w,TwitchEmotes:()=>L,UserHighlights:()=>e});var W=d(44589),B=d(46949),R=d(8528),I=d(24431),U=d(49276),z=d(66866);const v=z.z8.ShrinkX,f=z.z8.Slide,u=z.z8.GrowX,y="chat-image chat-line__message--emote",S=/(?:(https?:\/\/)?((?:[\w#%\-+=:~]+\.)+[a-z]{2,10}(?:\/[\w./#%&@()\-+=:?~]*[^\s\.!,?])?))/g,n=/^(['"*([{<\\/]*)(@)((?:[^\u0000-\u007F]|[\w-])+)(?:\b|$)/,s={type:"filter_test",priority:1e3,render(T,O){return T.msg.filters?.length?O("div",{class:"ffz-pill tw-mg-l-1"},T.msg.filters.join(", ")):null},process(T,O){if(!(!T||!T.length||!this.context.get("chat.filtering.debug")))return O.filters=[],T.push({type:"filter_test",msg:O}),T}};function i(T){return T==null?null:T==="true"}G(i,"datasetBool");const l={type:"link",priority:50,component:()=>d.e(9442).then(d.bind(d,12868)),render(T,O){return O("a",{class:"ffz-tooltip link-fragment","data-tooltip-type":"link","data-url":T.url,"data-is-mail":T.is_mail,rel:"noopener noreferrer",target:"_blank",href:T.url,onClick:this.handleLinkClick},T.text)},tooltip(T,O){if(!this.context.get("tooltip.rich-links")&&!T.dataset.forceTooltip)return R.NoContent;if(T.dataset.isMail==="true")return[this.i18n.t("tooltip.email-link","E-Mail {address}",{address:T.textContent})];const P=T.dataset.url||T.href,j=i(T.dataset.forceMedia)??this.context.get("tooltip.link-images"),Z=i(T.dataset.forceUnsafe)??this.context.get("tooltip.link-nsfw-images");return Promise.all([Promise.all([d.e(2009),d.e(208)]).then(d.bind(d,30642)),this.get_link_info(P)]).then(([q,X])=>{if(!X||(X.v||1)>q.VERSION)return"";const ee={tList:(...oe)=>this.i18n.tList(...oe),i18n:this.i18n,fragments:X.fragments,i18n_prefix:X.i18n_prefix,tooltip:!0,allow_media:j,allow_unsafe:Z,onload:()=>requestAnimationFrame(()=>O.update())};let te;if(O.element&&(O.element.classList.add("ffz-rich-tip"),O.element.classList.add("tw-align-left")),O.outer&&X.accent&&(O.outer.classList.add("ffz-accent-tip"),O.outer.style.setProperty("--ffz-color-accent",X.accent)),X.full?te=q.renderTokens(X.full,W.createElement,ee):X.mid?te=q.renderTokens(X.mid,W.createElement,ee):X.short?te=q.renderTokens(X.short,W.createElement,ee):te=this.i18n.t("card.empty","No data was returned."),!X.urls)return te;const ne=[];for(let oe=0;oe<X.urls.length;oe++){const de=X.urls[oe];ne.push((0,W.createElement)("tr",null,(0,W.createElement)("td",null,this.i18n.formatNumber(oe+1),"."),(0,W.createElement)("td",{class:"tw-c-text-alt-2 tw-pd-x-05 tw-word-break-all"},de.url),(0,W.createElement)("td",null,de.flags?de.flags.map(me=>(0,W.createElement)("span",{class:"ffz-pill"},me.toLowerCase())):null)))}let pe;if(X.unsafe){const oe=Array.from(new Set(X.urls.map(de=>de.flags).flat())).join(", ");pe=(0,W.createElement)("div",{class:"ffz-i-attention"},this.i18n.tList("tooltip.link-unsafe","Caution: This URL is has been flagged as potentially harmful by: {reasons}",{reasons:oe.toLowerCase()}))}else X.urls.length>1&&(pe=this.i18n.t("tooltip.link-destination","Destination: {url}",{url:X.urls[X.urls.length-1].url}));return te=(0,W.createElement)("div",null,(0,W.createElement)("div",{class:"ffz--shift-hide"},te,pe?(0,W.createElement)("div",{class:"tw-mg-t-05 tw-border-t tw-pd-t-05 tw-align-center"},pe,(0,W.createElement)("div",{class:" tw-font-size-8"},this.i18n.t("tooltip.shift-detail","(Shift for Details)"))):null),(0,W.createElement)("div",{class:"ffz--shift-show tw-align-left"},(0,W.createElement)("div",{class:"tw-semibold tw-mg-b-05 tw-align-center"},this.i18n.t("tooltip.link.urls","Visited URLs")),(0,W.createElement)("table",null,ne))),te}).catch(q=>(console.error(q),(0,W.sanitize)(this.i18n.t("tooltip.error","An error occurred. ({error})",{error:q}))))},process(T){if(!T||!T.length)return;const O=[];for(const P of T){if(P.type!=="text"){O.push(P);continue}S.lastIndex=0;const j=P.text;let Z=0,q;for(;q=S.exec(j);){const X=q.index;Z!==X&&O.push({type:"text",text:j.slice(Z,X)});let ee=q[0];if(ee.endsWith(")")){let te=1,ne=ee.length-1;for(;ne--;){const pe=ee[ne];if(pe===")"?te++:pe==="("&&te--,!te)break}te&&(ee=ee.slice(0,ee.length-1))}O.push({type:"link",url:`${q[1]?"":"https://"}${ee}`,is_mail:!1,text:ee}),Z=X+ee.length}Z<j.length&&O.push({type:"text",text:j.slice(Z)})}return O}};l.tooltip.interactive=function(T){if(!this.context.get("tooltip.rich-links")||!this.context.get("tooltip.link-interaction")||T.dataset.isMail==="true")return!1;const O=this.get_link_info(T.dataset.url,!0);return O&&O.interactive},l.tooltip.delayHide=function(T){return!this.context.get("tooltip.rich-links")||T.dataset.isMail==="true"?0:64};const w={type:"reply",priority:0,component:()=>null,render(T,O){let P=T.color;if(P){const j=this.resolve("site.chat");P=j?j.colors.process(P):P}return O("strong",{class:`chat-line__message-mention ffz--pointer-events ffz-tooltip ffz--reply-mention ffz-i-threads${T.me?" ffz--mention-me":""}`,style:{color:P},"data-tooltip-type":"reply","data-login":T.recipient,onClick:this.handleReplyClick},T.text)},tooltip(T){const O=this.resolve("site.fine");if(!T||!O)return null;const P=O.searchParent(T,Z=>Z.props&&Z.props.reply&&Z.setOPCardTray),j=P?.props?.reply;return j?[(0,W.createElement)("strong",{},this.i18n.t("chat.reply-to","Replying To:")),`

`,(0,W.createElement)("div",{className:"tw-align-left"},[(0,W.createElement)("strong",{},j.parentDisplayName),": ",j.parentMessageBody])]:null}};function _(T,O,P,j){const Z=P&&P.login&&P.login==O.user.login&&!this.context.get("chat.filtering.process-own"),q=this.context.get("chat.filtering.mention-priority");let X,ee,te=!1;P&&P.login&&!Z&&(X=P.login.toLowerCase(),ee=P.displayName&&P.displayName.toLowerCase(),ee===X&&(ee=null),te=!0);const ne=[];for(const pe of T){if(pe.type!=="text"){ne.push(pe);continue}let oe=[];for(const de of pe.text.split(/ +/)){const me=/^(@?)(\S+?)(?:\b|$)/.exec(de);if(me){let Ee=me[2],xe=me[1]==="@",Te=!1;const Pe=Ee?Ee.toLowerCase():"",Se=this.color_cache?this.color_cache.get(Pe):null;(Pe===X||Pe===ee)&&(Te=!0),!xe&&!Se&&!Te?oe.push(de):(oe.length&&(ne.push({type:"text",text:`${oe.join(" ")} `}),oe=[]),ne.push({type:"mention",text:me[0],me:Te,color:j?Se:null,recipient:Pe}),Te&&this.applyHighlight(O,q,null,"mention",!0),oe.push(de.substr(me[0].length)))}else oe.push(de)}(oe.length>1||oe.length===1&&oe[0]!=="")&&ne.push({type:"text",text:oe.join(" ")})}return ne}G(_,"mention_processAll");const o={type:"mention",priority:0,component:()=>d.e(9442).then(d.bind(d,30884)),render(T,O){let P=T.color;if(P){const j=this.resolve("site.chat");P=j?j.colors.process(P):P}return O("strong",{class:`chat-line__message-mention${T.me?" ffz--mention-me":""} ffz--pointer-events`,style:{color:P},"data-login":T.recipient,onClick:this.handleMentionClick},T.text)},process(T,O,P){if(!T||!T.length)return;const j=this.context.get("chat.filtering.all-mentions"),Z=this.context.get("chat.filtering.color-mentions");if(j)return _.call(this,T,O,P,Z);const q=P&&P.login&&P.login==O.user.login&&!this.context.get("chat.filtering.process-own"),X=this.context.get("chat.filtering.mention-priority");let ee,te,ne,pe=!1;P&&P.login&&!q?(te=P.login.toLowerCase(),ne=P.displayName&&P.displayName.toLowerCase(),ne===te&&(ne=null),pe=!0,ee=new RegExp(`^(['"*([{<\\/]*)(?:(@?)(${P.login.toLowerCase()}${ne?`|${ne}`:""})|@((?:[^\0-\x7F]|[\\w-])+))(?:\\b|$)`,"i")):ee=n;const oe=[];for(const de of T){if(de.type!=="text"){oe.push(de);continue}let me=[];for(const Ee of de.text.split(/ +/)){const xe=ee.exec(Ee);if(xe){(me.length||xe[1])&&(oe.push({type:"text",text:`${me.join(" ")} ${xe[1]||""}`}),me=[]);let Te,Pe=!1,Se=xe[2];xe[4]?(Te=xe[4],Se="@"):(Te=xe[3],Pe=pe);const re=Te?Te.toLowerCase():"",ie=Z&&this.color_cache?this.color_cache.get(re):null;oe.push({type:"mention",text:`${Se}${Te}`,me:Pe,color:ie,recipient:re}),Pe&&this.applyHighlight(O,X,null,"mention",!0),me.push(Ee.substr(xe[0].length))}else me.push(Ee)}(me.length>1||me.length===1&&me[0]!=="")&&oe.push({type:"text",text:me.join(" ")})}return oe}},e={type:"user_highlight",priority:90,process(T,O,P){if(P&&P.login&&P.login==O.user.login&&!this.context.get("chat.filtering.process-own"))return;const j=this.context.get("__filter:highlight-users");if(!j||!j.length)return;const Z=O.user;for(const[q,X,ee]of j)(ee.test(Z.login)||ee.test(Z.displayName))&&this.applyHighlight(O,q,X,"user")}},a={type:"user_block",priority:100,process(T,O,P,j){if(P&&P.login&&P.login==O.user.login&&!this.context.get("chat.filtering.process-own"))return;const Z=O.user,q=this.context.get("__filter:block-users");q&&(q[1]&&(q[1].test(Z.login)||q[1].test(Z.displayName))?(O.deleted=!0,O.ffz_removed=!0,j&&(O.ffz_halt_tokens=!0)):!O.deleted&&q[0]&&(q[0].test(Z.login)||q[0].test(Z.displayName))&&(O.deleted=!0))}};function p(T){let O=T.badges?Object.keys(T.badges):null;if(!T.ffz_badges)return O;O||(O=[]);for(const P of T.ffz_badges)P?.id&&O.push(P.id);return O}G(p,"getBadgeIDs");const C={type:"badge_stuff",priority:97,process(T,O,P,j){if(P&&P.login&&P.login==O.user.login&&!this.context.get("chat.filtering.process-own"))return;const Z=this.context.get("__filter:highlight-badges"),q=this.context.get("__filter:block-badges");if(!Z&&!q)return;const X=p(O);if(!(!X||!X.length))for(const ee of X){if(q&&q[1].includes(ee)){O.deleted=!0,O.ffz_removed=!0,j&&(O.ffz_halt_tokens=!0);return}if(q&&!O.deleted&&q[0].includes(ee)&&(O.deleted=!0),Z&&Z.has(ee)){const te=Z.get(ee);Array.isArray(te)&&te.length>1&&this.applyHighlight(O,te[0],te[1],"badge")}}}},m={type:"highlight",priority:35,component:()=>d.e(9442).then(d.bind(d,27778)),render(T,O){return O("strong",{class:"ffz--highlight"},T.text)},process(T,O,P){if(!T||!T.length||P&&P.login&&P.login==O.user.login&&!this.context.get("chat.filtering.process-own"))return;const j=this.context.get("__filter:highlight-terms");if(!j)return;let Z=!1;if(j.non)for(const[q,X,ee]of j.non){if(Z&&O.mention_priority!=null&&O.mention_priority>q)break;let te=!1;ee[0]&&(ee[0].lastIndex=0,te=ee[0].test(O.message)),!te&&ee[1]&&(ee[1].lastIndex=0,te=ee[1].test(O.message)),te&&(Z=!0,this.applyHighlight(O,q,X,"term"))}if(!j.hl)return T;for(const[q,X,ee]of j.hl){const te=[];for(const ne of T){if(ne.type!=="text"){te.push(ne);continue}const pe=ne.text;let oe=0,de;for(;oe<pe.length;){ee[0]&&(ee[0].lastIndex=oe),ee[1]&&(ee[1].lastIndex=oe),de=ee[0]?ee[0].exec(pe):null;const me=ee[1]?ee[1].exec(pe):null;if(me&&(!de||de.index>me.index)&&(de=me),!de)break;const Ee=de.index,xe=de[1]?de[1].length:0,Te=Ee+xe;oe!==Te&&te.push({type:"text",text:pe.slice(oe,Te)}),this.applyHighlight(O,q,X,"term"),te.push({type:"highlight",text:de[0].slice(xe)}),oe=Ee+de[0].length}oe<pe.length&&te.push({type:"text",text:pe.slice(oe)})}T=te}return T}};function x(T,O,P,j,Z){const q=[];for(const X of T){if(X.type!=="text"){q.push(X);continue}const ee=X.text;let te=0,ne;for(;te<ee.length;){P[0]&&(P[0].lastIndex=te),P[1]&&(P[1].lastIndex=te),ne=P[0]?P[0].exec(ee):null;const pe=P[1]?P[1].exec(ee):null;if(pe&&(!ne||ne.index>pe.index)&&(ne=pe),!ne)break;const oe=ne.index,de=ne[1]?ne[1].length:0,me=oe+de;if(te!==me&&q.push({type:"text",text:ee.slice(te,me)}),j&&(O.ffz_removed=!0,Z))return T;q.push({type:"blocked",text:ne[0].slice(de)}),te=oe+ne[0].length}te<ee.length&&q.push({type:"text",text:ee.slice(te)})}return q}G(x,"blocked_process");const $={type:"blocked",priority:99,component:()=>d.e(9442).then(d.bind(d,87307)),render(T,O){return O("strong",{"data-text":T.text,"data-tooltip-type":"blocked",class:"ffz-tooltip ffz--blocked ffz--pointer-events",onClick:this.clickToReveal},"\xD7\xD7\xD7")},tooltip(T){const O=T.dataset;return[(0,W.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.filtering.blocked-term","Blocked Term")),O.text]},process(T,O,P,j){if(!T||!T.length||P&&P.login&&P.login==O.user.login&&!this.context.get("chat.filtering.process-own"))return;const Z=this.context.get("__filter:block-terms");if(Z)return Z.remove&&(T=x(T,O,Z.remove,!0,j),j&&O.ffz_removed)?(O.ffz_halt_tokens=!0,T):(Z.non&&(T=x(T,O,Z.non,!1,j)),T)}},r={A:"Hostility",I:"Discrimination",P:"Profanity",S:"Sexually Explicit Language"},c={type:"amterm",priority:95,component:()=>d.e(9442).then(d.bind(d,61669)),render(T,O){return O("strong",{"data-text":T.text,"data-categories":JSON.stringify(T.categories),"data-tooltip-type":"amterm",class:"ffz-tooltip ffz--blocked ffz--pointer-events",onClick:this.clickToReveal},"\xD7\xD7\xD7")},tooltip(T){const O=T.dataset,P=[];let j;try{j=JSON.parse(O.categories);for(const Z in j)j[Z]&&r[Z]&&P.push(this.i18n.t(`chat.filtering.automod.${Z}`,r[Z]))}catch{P.push("Parse Error")}return[(0,W.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.filtering.automod-term","AutoMod Blocked Term")),this.i18n.t("chat.filtering.automod-why","This was flagged as: "),P.join(", ")]},process(T,O,P,j){if(!T||!T.length||!O.flags||!Array.isArray(O.flags.list))return;const Z=O.flags.preferences,q=O.flags.list.filter(de=>{if(!de||de.startIndex==null||de.endIndex==null)return!1;const me=de.categories;if(!me)return!1;for(const Ee in me)if(me[Ee]&&Z[Ee])return!0}),X=q.length;if(!X)return;const ee=[];let te=0,ne=0;const pe=this.context.get("chat.automod.remove-messages");if(this.context.get("chat.automod.delete-messages")&&(O.deleted=!0),pe){O.ffz_removed=!0,j&&(O.ffz_halt_tokens=!0);return}for(const de of T){const me=de.length||de.text&&(0,B.split_chars)(de.text).length||0,Ee=te,xe=te+me;if(de.type!=="text"){ee.push(de),te=xe;continue}const Te=(0,B.split_chars)(de.text);for(;ne<X;){const Pe=q[ne],Se=Pe.startIndex,re=Pe.endIndex+1;if(re<Ee){ne++;continue}if(Se>xe){ee.push(de),te=xe;break}Se>te&&ee.push({type:"text",text:Te.slice(te-Ee,Se-Ee).join("")});let ie=Se-Ee;if(ie<0&&(ie=0),ee.push({type:"amterm",categories:Pe.categories,text:Te.slice(ie,re-Ee).join("")}),re>xe){te=xe;break}te=re,ne++}te<xe&&(Ee===te?ee.push(de):ee.push({type:"text",text:Te.slice(te-Ee).join("")}),te=xe)}return ee}},b={type:"cheer",priority:40,component:()=>d.e(9442).then(d.bind(d,93114)),render(T,O){return O("span",{class:"ffz-cheer ffz-tooltip ffz--pointer-events","data-tooltip-type":"cheer","data-prefix":T.prefix,"data-amount":this.i18n.formatNumber(T.amount),"data-tier":T.tier,"data-individuals":JSON.stringify(T.individuals||null),alt:T.text})},tooltip(T){const O=T.dataset,P=parseInt(O.amount.replace(/,/g,""),10),j=O.prefix,Z=O.tier,q=O.individuals&&JSON.parse(O.individuals),X=q&&q.length,ee=[this.context.get("tooltip.emote-images")&&(0,W.createElement)("div",{class:"preview-image ffz-cheer-preview","data-prefix":j,"data-tier":Z}),this.i18n.t("tooltip.bits","{count,number} Bits",P)];if(X>1){ee.push((0,W.createElement)("br",null)),q.sort(te=>-te[0]);for(let te=0;te<X&&te<12;te++){const[ne,pe,oe]=q[te];ee.push(this.tokenizers.cheer.render.call(this,{amount:ne,prefix:oe,tier:pe},W.createElement))}X>12&&(ee.push((0,W.createElement)("br",null)),ee.push(this.i18n.t("tooltip.bits.more","(and {count, number} more)",X-12)))}return ee},process(T,O){if(!T||!T.length||!O.bits)return;const P=this.getRoom(O.roomID,O.roomLogin,!0),j=P&&P.bitsConfig;if(!j)return;const Z=new RegExp(`^(${Object.keys(j).join("|")})(\\d+)$`,"i"),q=[],X={},ee=this.context.get("chat.bits.stack");for(const te of T){if(!te||te.type!=="text"){q.push(te);continue}let ne=[];for(const pe of te.text.split(/ +/)){const oe=Z.exec(pe);if(oe){const de=oe[1].toLowerCase(),me=j[de];if(!me){ne.push(pe);continue}const Ee=parseInt(oe[2],10),xe=me.tiers;let Te,Pe;for(let Se=0,re=xe.length;Se<re;Se++)if(Ee>=xe[Se].amount){Te=Se;break}if(ne.length&&(q.push({type:"text",text:`${ne.join(" ")} `}),ne=[]),q.push(Pe={type:"cheer",prefix:de,tier:Te,amount:Ee,text:oe[0]}),ee){let Se=ee===2?"cheer":de;j[Se]||(Se=de);const re=X[Se]=X[Se]||{total:0,individuals:[]};re.total+=Ee,re.individuals.push([Ee,Te,de]),Pe.hidden=!0}ne.push("")}else ne.push(pe)}(ne.length>1||ne.length===1&&ne[0]!=="")&&q.push({type:"text",text:ne.join(" ")})}if(ee){for(const te in X)if((0,B.has)(X,te)){const ne=X[te],pe=j[te],oe=pe.tiers;let de=0;for(let me=oe.length;de<me&&!(ne.total>=oe[de].amount);de++);q.unshift({type:"cheer",prefix:te,tier:de,amount:ne.total,individuals:ne.individuals,length:0})}}return q}},k=G((T,O,P)=>{const j=T.anim===2,Z=T.big&&T.can_big;let q,X,ee,te,ne,pe;T.anim===1&&T.animSrc?(q=Z?T.animSrc2:T.animSrc,X=Z?T.animSrcSet2:T.animSrcSet):(q=Z?T.src2:T.src,X=Z?T.srcSet2:T.srcSet),j&&T.animSrc&&(ne=q,pe=X,ee=Z?T.animSrc2:T.animSrc,te=Z?T.animSrcSet2:T.animSrcSet);const oe=T.modifiers||[],de=oe.length,me=O("img",{class:`${y} ffz-tooltip${ee?" ffz-hover-emote":""}${T.provider==="twitch"?" twitch-emote":T.provider==="ffz"?" ffz-emote":T.provider==="emoji"?" ffz-emoji":""}`,attrs:{src:I.IS_FIREFOX&&X?.length?void 0:q,srcSet:X,alt:T.text,height:T.big&&!T.can_big&&T.height?`${T.height*2}px`:void 0,"data-tooltip-type":"emote","data-provider":T.provider,"data-id":T.id,"data-set":T.set,"data-code":T.code,"data-variant":T.variant,"data-normal-src":ne,"data-normal-src-set":pe,"data-hover-src":ee,"data-hover-src-set":te,"data-modifiers":de?oe.map(Ee=>Ee.id).join(" "):null,"data-modifier-info":de?JSON.stringify(oe.map(Ee=>[Ee.set,Ee.id])):null}});return de?O("div",{class:"ffz--inline modified-emote",attrs:{"data-test-selector":"emote-button","data-provider":T.provider,"data-id":T.id,"data-set":T.set,"data-modifiers":de?oe.map(Ee=>Ee.id).join(" "):null}},[me,oe.map(Ee=>O("span",{key:Ee.text},k(Ee,O,!0)))]):P?me:O("div",{className:"ffz--inline",attrs:{"data-test-selector":"emote-button"}},[me])},"render_emote"),h={type:"emote",priority:10,component:{functional:!0,render(T,{props:O}){return k(O.token,T)}},render(T,O,P){const j=T.anim===2,Z=T.big&&T.can_big;let q,X,ee,te,ne,pe;T.anim===1&&T.animSrc?(q=Z?T.animSrc2:T.animSrc,X=Z?T.animSrcSet2:T.animSrcSet):(q=Z?T.src2:T.src,X=Z?T.srcSet2:T.srcSet),j&&T.animSrc&&(ne=q,pe=X,ee=Z?T.animSrc2:T.animSrc,te=Z?T.animSrcSet2:T.animSrcSet);let oe,de;const me=T.modifiers||[],Ee=me.length,xe=T.modifier_flags,Te=T.big&&!T.can_big&&T.height;let Pe=(this.emotes.activeAsBackgroundMask&xe)!==0,Se=(this.emotes.activeNoWideMask&xe)!==0;if(Se||xe||Ee){if(T.provider==="emoji"){const ie=T.big_emoji?2:1,fe=ie*1.5*(this.context.get("chat.font-size")??13);oe={width:fe,height:fe},de={width:fe,height:fe}}else{const ie=T.big?2:1;oe={width:T.width*ie,height:T.height*ie},de={width:oe.width,height:oe.height}}for(const ie of me)if(ie.effect_bg&&(Pe=!0),!ie.mod_hidden&&ie.set!=="info"){const fe=ie.big?2:1,ge=ie.width*fe,ve=ie.height*fe;ge>de.width&&(de.width=ge),ve>de.height&&(de.height=ve)}if(xe&&(this.emotes.ensureEffect(xe),(xe&v)===v&&this.emotes.effects_enabled?.ShrinkX&&(oe.width*=.5),(xe&u)===u&&this.emotes.effects_enabled?.GrowX&&(oe.width*=2),oe.width=Math.min(oe.width,T.big?256:128),oe.height=Math.min(oe.height,T.big?80:40)),Se){const ie=T.big?64:32;if(oe.width>ie){const fe=ie/oe.width;oe.width*=fe,oe.height*=fe}}oe.width>de.width&&(de.width=oe.width),oe.height>de.height&&(de.height=oe.height),oe.width!==de.width&&(oe.marginLeft=(de.width-oe.width)/2),oe.height!==de.height&&(oe.marginTop=(de.height-oe.height)/2),xe&&(xe&f)===f&&(oe["--ffz-width"]=`${oe.width}px`,oe["--ffz-speed-x"]=`${.5*(oe.width/(T.big?64:32))}s`)}let re;return Pe?(oe=oe||{},oe.backgroundImage=`url("${q}")`,oe.backgroundSize="100%",re=O("div",{class:`${y} ffz--pointer-events ffz-tooltip${ee?" ffz-hover-emote":""}${T.provider==="twitch"?" twitch-emote":T.provider==="ffz"?" ffz-emote":T.provider==="emoji"?" ffz-emoji":""}`,style:oe,"data-name":T.text,"data-tooltip-type":"emote","data-provider":T.provider,"data-id":T.id,"data-set":T.set,"data-code":T.code,"data-variant":T.variant,"data-normal-src":ne,"data-normal-src-set":pe,"data-hover-src":ee,"data-hover-src-set":te,"data-modifiers":Ee?me.map(ie=>ie.id).join(" "):null,"data-modifier-info":Ee?JSON.stringify(me.map(ie=>[ie.set,ie.id])):null,onClick:this.emotes.handleClick},O("div",{class:"ffz-alt-text"},T.text))):re=O("img",{class:`${y} ffz--pointer-events ffz-tooltip${ee?" ffz-hover-emote":""}${T.provider==="twitch"?" twitch-emote":T.provider==="ffz"?" ffz-emote":T.provider==="emoji"?" ffz-emoji":""}`,src:I.IS_FIREFOX&&X?.length?void 0:q,srcSet:X,style:oe,height:oe?void 0:Te?`${T.height*2}px`:void 0,alt:T.text,"data-tooltip-type":"emote","data-provider":T.provider,"data-id":T.id,"data-set":T.set,"data-code":T.code,"data-variant":T.variant,"data-normal-src":ne,"data-normal-src-set":pe,"data-hover-src":ee,"data-hover-src-set":te,"data-modifiers":Ee?me.map(ie=>ie.id).join(" "):null,"data-modifier-info":Ee?JSON.stringify(me.map(ie=>[ie.set,ie.id])):null,onClick:this.emotes.handleClick}),!Ee&&!T.modifier_flags?P?re:O("div",{class:"ffz--inline","data-test-selector":"emote-button"},re):O("div",{class:`ffz--inline ffz--pointer-events modified-emote${oe?" scaled-modified-emote":""}`,"data-test-selector":"emote-button","data-provider":T.provider,"data-id":T.id,"data-set":T.set,style:de,"data-modifiers":Ee?me.map(ie=>ie.id).join(" "):null,"data-effects":xe||void 0},re,me.map(ie=>ie.set==="info"||(ie.source_modifier_flags&1)===1&&ie.text?null:O("span",{key:ie.text},this.tokenizers.emote.render.call(this,ie,O,!0))))},async tooltip(T,O){const P=T.dataset,j=P.provider,Z=P.modifierInfo;let q,X,ee,te,ne,pe,oe,de,me,Ee=!1;const xe=P.noSource==="true";if(Z&&Z!=="null"&&(pe=JSON.parse(Z).map(([Pe,Se])=>{if(Pe==="info")return(0,W.createElement)("span",{class:"tw-mg-05"},Se?.icon?(0,W.createElement)("img",{class:"ffz__tooltip__mod-icon",src:Se.icon}):null,Se?.icon?` - ${Se?.label}`:Se?.label);const re=this.emotes.emote_sets[Pe],ie=re&&(re.emotes[Se]||re.disabled_emotes?.[Se]);if(ie)return(0,W.createElement)("span",{class:"tw-mg-05"},this.tokenizers.emote.render.call(this,ie.token,W.createElement),` - ${ie.hidden?"???":ie.name}`)})),j==="twitch"){de=P.id;const Pe=xe?null:await this.emotes.getTwitchEmoteSet(de),Se=Pe!=null&&await this.emotes.getTwitchSetChannel(Pe),re=xe?null:await this.emotes.getTwitchEmoteArtist(de);if(X=`${(0,B.getTwitchEmoteURL)(P.id,4,!0,!0)}?_=preview`,oe="twitch",re&&(te=re.displayName||re.login),Se){const ie=Se.type;ie===I.EmoteTypes.Global?Se.owner?.login?ee=this.i18n.t("tooltip.channel","Channel: {source}",{source:Se.owner.displayName||Se.owner.login}):ee=this.i18n.t("emote.global","Twitch Global"):ie===I.EmoteTypes.BitsTier?(ee=this.i18n.t("emote.bits","Twitch Bits Reward"),Se.owner?.login&&(ee=this.i18n.t("emote.bits-owner",`{source}
Channel: {channel}`,{source:ee,channel:Se.owner.displayName||Se.owner.login}))):ie===I.EmoteTypes.Prime||ie===I.EmoteTypes.Turbo?ee=this.i18n.t("emote.prime","Prime Gaming"):ie===I.EmoteTypes.TwoFactor?ee=this.i18n.t("emote.2fa","Twitch 2FA Emote"):ie===I.EmoteTypes.LimitedTime?ee=this.i18n.t("emote.limited","Limited-Time Only Emote"):ie===I.EmoteTypes.ChannelPoints?ee=this.i18n.t("emote.points","Channel Points Emote"):ie===I.EmoteTypes.Follower&&Se.owner?.login?ee=this.i18n.t("emote.follower","Follower Emote ({source})",{source:Se.owner.displayName||Se.owner.login}):ie===I.EmoteTypes.Subscription&&Se.owner?.login&&(ee=this.i18n.t("tooltip.channel","Channel: {source}",{source:Se.owner.displayName||Se.owner.login}))}}else if(j==="ffz"){const Pe=this.emotes.emote_sets[P.set],Se=Pe&&(Pe.emotes[P.id]||Pe.disabled_emotes?.[P.id]);if(Pe&&(ee=Pe.source_line||`${Pe.source||"FFZ"} ${Pe.title||"Global"}`,oe=Pe.source||"ffz"),Se&&(de=Se.id,Se.artist&&(te=Se.artist.display_name||Se.artist.name),Se.original_name&&Se.original_name!==Se.name&&(me=this.i18n.t("emote.original-name","Name: {name}",{name:Se.original_name})),Se.owner&&(ne=this.i18n.t("emote.owner","By: {owner}",{owner:Se.owner.display_name})),this.context.get("tooltip.emote-images.animated")&&Se.animated?.[1]?Se.animated[4]?X=Se.animated[4]:Se.animated[2]&&(X=Se.animated[2]):Se.urls[4]?X=Se.urls[4]:Se.urls[2]&&(X=Se.urls[2]),P.effects&&Se.modifier&&Se.modifier_flags)){ne=null;const ie=Se.modifier_flags;this.emotes.ensureEffect(ie);const fe=this.emotes.getTargetEmote();let ge={width:(fe.width??28)*2,height:(fe.height??28)*2},ve={width:ge.width,height:ge.height},ke=(this.emotes.activeAsBackgroundMask&ie)!==0,De=(this.emotes.activeNoWideMask&ie)!==0,Ie=!1;if((ie&v)===v&&this.emotes.effects_enabled?.ShrinkX&&(ge.width*=.5,Ie=!0),(ie&u)===u&&this.emotes.effects_enabled?.GrowX&&(ge.width*=2,Ie=!0),Ie&&(ge.width>512&&(ge.width=512),ge.height>160&&(ge.height=160)),De&&ge.width>64){const ct=64/ge.width;ge.width*=ct,ge.height*=ct}ge.width>ve.width&&(ve.width=ge.width),ge.height>ve.height&&(ve.height=ge.height),ge.width!==ve.width&&(ge.marginLeft=(ve.width-ge.width)/2),ge.height!==ve.height&&(ge.marginTop=(ve.height-ge.height)/2),(ie&f)===f&&(ge["--ffz-width"]=`${ge.width}px`,ge["--ffz-speed-x"]=`${.5*ge.width/64}s`),ge.width=`${ge.width}px`,ge.height=`${ge.height}px`,ve.width=`${ve.width}px`,ve.height=`${ve.height}px`,ke&&(ge.backgroundImage=`url("${fe.src}")`,ge.backgroundSize="100%"),X=(0,W.createElement)("div",{class:"ffz-effect-tip"},(0,W.createElement)("img",{src:fe.src,srcSet:fe.srcSet,width:(fe.width??28)*2,height:(fe.height??28)*2,onLoad:O.update}),(0,W.createElement)("span",{class:"ffz-i-right-open"}),(0,W.createElement)("div",{class:`ffz--inline ffz--pointer-events modified-emote${ge?" scaled-modified-emote":""}`,style:ve,"data-modifiers":Se.id,"data-effects":ie},ke?(0,W.createElement)("div",{class:`${y} ffz--pointer-events ffz-tooltip ffz-emote`,style:ge}):(0,W.createElement)("img",{class:`${y} ffz--pointer-events ffz-tooltip ffz-emote`,src:fe.src,srcSet:fe.srcSet,style:ge,height:ge?void 0:`${fe.height*2}px`,onLoad:O.update})))}}else if(j==="emoji"){const Pe=this.emoji.emoji[P.code],Se=this.context.get("chat.emoji.style"),re=P.variant?Pe.variants[P.variant]:Pe,ie=P.variant?this.emoji.emoji[P.variant]:null;oe="emoji",de=P.code,X=(0,W.createElement)("img",{class:"preview-image ffz-emoji",src:this.emoji.getFullImage(re.image,Se),srcSet:this.emoji.getFullImageSet(re.image,Se),onLoad:O.update}),Ee=!0,q=`:${Pe.names[0]}:${ie?`:${ie.names[0]}:`:""}`;const fe=Pe.category?this.i18n.t(`emoji.category.${Pe.category.toSnakeCase()}`,U.aA[Pe.category]||Pe.category):null;ee=this.i18n.t("tooltip.emoji","Emoji - {category}",{category:fe})}else return;q||(q=P.name||T.alt);const Te=oe&&this.emotes.isFavorite(oe,de);return[X&&this.context.get("tooltip.emote-images")&&(typeof X=="string"?(0,W.createElement)("img",{class:"preview-image",src:X,onLoad:O.update}):X),Ee||xe&&!ne?q:this.i18n.t("tooltip.emote","Emote: {name}",{name:q}),!xe&&ee&&this.context.get("tooltip.emote-sources")&&(0,W.createElement)("div",{class:"tw-pd-t-05"},ee),me&&(0,W.createElement)("div",{class:"tw-pd-t-05"},me),ne&&this.context.get("tooltip.emote-sources")&&(0,W.createElement)("div",{class:"tw-pd-t-05"},ne),te&&this.context.get("tooltip.emote-sources")&&(0,W.createElement)("div",{class:"tw-pd-t-05"},this.i18n.t("emote.artist","Artist: {artist}",{artist:te})),P.sellout&&(0,W.createElement)("div",{class:"tw-mg-t-05 tw-border-t tw-pd-t-05"},P.sellout),pe&&(0,W.createElement)("div",{class:"tw-pd-t-1 tw-pd-b-05"},pe),Te&&(0,W.createElement)("figure",{class:"ffz--favorite ffz-i-star"})]},process(T,O){if(!T||!T.length||this.context.get("chat.emotes.enabled")!==2)return;const P=this.emotes.getEmotes(O.user.id,O.user.login,O.roomID,O.roomLogin);if(!P)return;const j=this.context.get("chat.emotes.2x")>0,Z=this.context.get("chat.emotes.animated"),q=[];let X=!1,ee=!1,te,ne;const pe=this.emotes.ModifierFlags?.NoSpace;for(const oe of T){if(!oe)continue;if(oe.type!=="text"){oe.type==="emote"&&(oe.modifiers||(oe.modifiers=[],oe.modifier_flags=0)),q.push(oe),te=oe;continue}let de=[];for(const me of oe.text.split(/ +/))if((0,B.has)(P,me)){if(ne=P[me],ne.modifier&&ne.modifier_prefix)X=!0;else if(ne.modifier&&te&&te.modifiers&&(!de.length||de.length===1&&de[0]==="")){te.modifiers.indexOf(ne.token)===-1&&(ne.modifier_flags&&(te.modifier_flags|=ne.modifier_flags,pe&&(ne.modifier_flags&pe)===pe&&(ee=!0)),te.modifiers.push(Object.assign({big:j,anim:Z},ne.token)));continue}if(de.length){const xe={type:"text",text:`${de.join(" ")} `};q.push(xe),xe.text.trim().length&&(te=xe),de=[]}const Ee=Object.assign({modifiers:[],modifier_flags:0,big:j,anim:Z},ne.token);q.push(Ee),te=Ee,de.push("")}else de.push(me);if(de.length>1||de.length===1&&de[0]!==""){const me={type:"text",text:de.join(" ")};q.push(me)}}if(X){let oe,de=!1,me=q.length;for(;me--;){const Ee=q[me];Ee.type==="emote"&&!Ee.mod?(oe=Ee,de=!1):oe&&Ee.type==="emote"&&Ee.mod&&Ee.mod_prefix?(oe.modifiers.push(Ee),Ee.source_modifier_flags&&(oe.modifier_flags|=Ee.source_modifier_flags,pe&&(Ee.source_modifier_flags&pe)===pe&&(ee=!0)),q.splice(me,de?2:1),de=!1):oe&&!de&&Ee.type==="text"&&Ee.text===" "?de=!0:(oe=null,de=!1)}}if(ee){let oe=!1,de=q.length;for(;de--;){const me=q[de];me.type==="emote"&&(me.modifier_flags&pe)===pe?oe=!0:(oe&&me.type==="text"&&me.text===" "&&q.splice(de,1),oe=!1)}}return q}},M={type:"emoji",priority:15,process(T){if(!T||!T.length)return;const O=this.emoji.splitter,P=this.context.get("chat.emotes.2x")>1,j=this.context.get("chat.emoji.replace-joiner")>0,Z=this.context.get("chat.emoji.style");if(Z===0)return;const q=[];for(const X of T){if(!X)continue;if(X.type!=="text"){q.push(X);continue}const ee=j?X.text.replace(U.Dk,"\u200D"):X.text;O.lastIndex=0;let te=0,ne;for(;ne=O.exec(ee);){const pe=ne.index,oe=this.emoji.chars.get(ne[0]);if(!oe)continue;const de=this.emoji.emoji[oe[0]],me=oe[1]?de.variants[oe[1]]:de,Ee=(0,B.split_chars)(ne[0]).length;te!==pe&&q.push({type:"text",text:ee.slice(te,pe)}),q.push({type:"emote",provider:"emoji",code:oe[0],variant:oe[1],big_emoji:P,src:this.emoji.getFullImage(me.image,Z),srcSet:this.emoji.getFullImageSet(me.image,Z),text:ne[0],length:Ee,modifiers:[],modifier_flags:0}),te=pe+ne[0].length}te<ee.length&&q.push({type:"text",text:ee.slice(te)})}return q}},L={type:"twitch-emote",priority:20,process(T,O){if(!O.ffz_emotes||this.context.get("chat.emotes.enabled")<1)return;const P=O.ffz_emotes,j=this.context.get("chat.emotes.animated"),Z=this.context.get("chat.emotes.2x")>0,q=this.context.get("chat.fix-bad-emotes"),X=[];for(const oe in P)if((0,B.has)(P,oe))for(const de of P[oe])X.push([oe,de.startIndex,de.endIndex+1]);const ee=X.length;if(!ee)return;const te=[];X.sort((oe,de)=>oe[1]!==de[1]?oe[1]-de[1]:de[0]-oe[0]);let ne=0,pe=0;for(const oe of T){const de=oe.length||oe.text&&(0,B.split_chars)(oe.text).length||0,me=ne,Ee=ne+de;if(oe.type!=="text"){te.push(oe),ne=Ee;continue}const xe=(0,B.split_chars)(oe.text);for(;pe<ee;){const[Te,Pe,Se]=X[pe];if(typeof Te=="string"&&(Te.startsWith("__FFZ__")||Te.startsWith("__BTTV__"))){pe++;continue}if(Pe>Ee||Se>Ee){me===ne?te.push(oe):te.push({type:"text",text:xe.slice(ne-me).join("")}),Pe<Ee&&Se>Ee&&pe++,ne=Ee;break}if(Pe<ne){pe++;continue}Pe>ne&&te.push({type:"text",text:xe.slice(ne-me,Pe-me).join("")});let re,ie,fe,ge,ve,ke,De,Ie,Xe=!0;const ct=I.REPLACEMENTS[Te];ct&&q?(re=`${I.REPLACEMENT_BASE}${ct}`,ie="",Xe=!1):(re=(0,B.getTwitchEmoteURL)(Te,1,!1),ie=(0,B.getTwitchEmoteSrcSet)(Te,!1),j>0&&(fe=(0,B.getTwitchEmoteURL)(Te,1,!0),ge=(0,B.getTwitchEmoteSrcSet)(Te,!0)),Z&&(ve=(0,B.getTwitchEmoteURL)(Te,2,!1),ke=(0,B.getTwitchEmoteSrcSet)(Te,!1,!0,!0),j>0&&(De=(0,B.getTwitchEmoteURL)(Te,2,!0),Ie=(0,B.getTwitchEmoteSrcSet)(Te,!0,!0,!0))));const Oe=I.WEIRD_EMOTE_SIZES[Te],g=Oe?Oe[0]:28,D=Oe?Oe[1]:28;te.push({type:"emote",id:Te,provider:"twitch",src:re,srcSet:ie,src2:ve,srcSet2:ke,animSrc:fe,animSrc2:De,animSrcSet:ge,animSrcSet2:Ie,anim:j,big:Z,can_big:Xe,width:g,height:D,text:xe.slice(Pe-me,Se-me).join(""),modifiers:[],modifier_flags:0}),ne=Se,pe++}ne<Ee&&(me===ne?te.push(oe):te.push({type:"text",text:xe.slice(ne-me).join("")}),ne=Ee)}return te}}},99733:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>y});var W=d(44589),B=d(94417),R=d(46949),I=d(24431),U=d(96883),z=d.n(U),v=d(22527);function f(n){return n==="SUBSCRIPTIONS"?I.EmoteTypes.Subscription:n==="FOLLOWER"?I.EmoteTypes.Follower:n==="GLOBALS"||n==="SMILIES"?I.EmoteTypes.Global:n==="LIMITED_TIME"||n==="MEGA_COMMERCE"?I.EmoteTypes.LimitedTime:n==="BITS_BADGE_TIERS"?I.EmoteTypes.BitsTier:n==="CHANNEL_POINTS"?I.EmoteTypes.ChannelPoints:n==="TWO_FACTOR"?I.EmoteTypes.TwoFactor:n==="PRIME"?I.EmoteTypes.Prime:n==="TURBO"?I.EmoteTypes.Turbo:I.EmoteTypes.Unknown}G(f,"getEmoteTypeFromTwitchType");function u(n){return n==="1000"||n==="prime"?1:n==="2000"?2:n==="3000"?3:1}G(u,"tierToNumber");const S=class S extends v.default{constructor(...s){super(...s),this.should_enable=!0,this.inject("i18n"),this.inject("chat"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("site"),this.inject("site.apollo"),this.inject("site.twitch_data"),this.vue=this.resolve("vue"),this.open_cards={},this.last_card=null}onEnable(){this.on("chat.emotes:click",this.handleClick,this)}handleClick(s){this.chat.context.get("chat.emote-dialogs")&&(s.preventDefault(),this.openCard({provider:s.provider,code:s.code,variant:s.variant,name:s.name,set:s.set,id:s.id??`${s.code}::${s.variant}`},s.modifiers,s.source))}async loadVue(){if(this._vue_loaded)return;await this.vue.enable();const s=await d.e(6115).then(d.bind(d,81414));this.vue.component("emote-card",s.default),this._vue_loaded=!0}canReportTwitch(){const s=this.resolve("site"),i=s.getUser(),l=this.resolve("site.web_munch");let w;try{w=l.getModule("user-report")}catch{return!1}return!!w&&!!i?.id&&s?.store?.dispatch}reportTwitchEmote(s,i){const l=this.resolve("site"),w=l.getUser(),_=this.resolve("site.web_munch");let o;try{o=_.getModule("user-report")}catch{return!1}return!w?.id||!l?.store?.dispatch?!1:(l.store.dispatch({type:"core.modal.MODAL_SHOWN",modalComponent:o,modalProps:{reportContext:{contentID:String(s),contentMetadata:{channelID:String(w.id)},contentType:"EMOTE_REPORT",targetUserID:String(i),trackingContext:"emote_card"}}}),!0)}async loadData(s){if(s.provider==="twitch"){const _=this.resolve("site.apollo");if(!_)throw new Error("Unable to load emote data");const o=await _.client.query({query:z(),variables:{emoteID:s.id}});if(!o?.data?.emote)throw new Error("Unable to load emote data");const e=o.data.emote,a=(0,R.getTwitchEmoteURL)(e.id,2,!0,!0),p=`${a} 1x, ${(0,R.getTwitchEmoteURL)(e.id,4,!0,!0)} 2x`;let C,m,x,$=f(e.type),r;try{r=parseInt(e.setID,10)}catch{}if(I.TWITCH_GLOBAL_SETS.includes(r)?$=I.EmoteTypes.Global:I.TWITCH_POINTS_SETS.includes(r)?$=I.EmoteTypes.ChannelPoints:I.TWITCH_PRIME_SETS.includes(r)&&($=I.EmoteTypes.Prime),$===I.EmoteTypes.Subscription){const b=e.owner?.subscriptionProducts;if(Array.isArray(b)){for(const k of b)if(k.emotes.some(h=>h.id===e.id)){x=u(k.tier);break}}C=this.i18n.t("emote-card.sub","Tier {tier} Sub Emote ({source})",{tier:x,source:e.owner?.displayName||e.owner?.login}),m="twitch"}else $===I.EmoteTypes.Follower?(C=this.i18n.t("emote.follower","Follower Emote ({source})",{source:e.owner.displayName||e.owner.login}),m="twitch"):$===I.EmoteTypes.Global?C=this.i18n.t("emote.global","Twitch Global"):$===I.EmoteTypes.LimitedTime?C=this.i18n.t("emote.limited","Limited-Time Only Emote"):$===I.EmoteTypes.BitsTier?(C=this.i18n.t("emote-card.bits","{amount,number} Bits Reward ({source})",{amount:e.bitsBadgeTierSummary?.threshold,source:e.owner.displayName||e.owner.login}),m="twitch"):$===I.EmoteTypes.TwoFactor?C=this.i18n.t("emote.2fa","Twitch 2FA Emote"):$===I.EmoteTypes.ChannelPoints?(C=this.i18n.t("emote.points","Channel Points Emote"),m="twitch"):$===I.EmoteTypes.Prime||$===I.EmoteTypes.Turbo?C=this.i18n.t("emote.prime","Prime Gaming"):C=e.type;const c={id:e.id,fav_source:"twitch",channel_id:e.owner?.id,more:[],body:m,src:a,srcSet:p,name:e.token,source:C,artist:e.artist?e.artist.displayName||e.artist.login:null,artistLink:e.artist?`https://www.twitch.tv/${e.artist.login}`:null};if(e.owner?.id&&(c.channel_title=e.owner.displayName??e.owner.login,c.channel_login=e.owner.login,c.channel_live=!!e.owner.stream?.id,c.channel_followed=!!e.owner?.self?.follower?.followedAt,c.more.push({type:"link",icon:"ffz-i-link-ext",title:"View Channel on TwitchEmotes.com",href:`https://twitchemotes.com/channels/${e.owner.id}`}),this.canReportTwitch()&&c.more.push({type:"report-twitch",title_i18n:"emote-card.report",title:"Report Emote",icon:"ffz-i-flag"})),e.bitsBadgeTierSummary?.threshold)c.unlock_mode="bits",c.unlocked=e.bitsBadgeTierSummary.self?.isUnlocked,c.bits_amount=e.bitsBadgeTierSummary.threshold,c.bits_remain=e.bitsBadgeTierSummary.self?.numberOfBitsUntilUnlock??c.unlock_amount;else if($===I.EmoteTypes.Follower){c.unlock_mode="follow",c.unlocked=!1;const b=c.extra_emotes=[];if(!c.unlocked&&Array.isArray(e.owner?.channel?.localEmoteSets)){for(const k of e.owner.channel.localEmoteSets)if(Array.isArray(k.emotes))for(const h of k.emotes){const M=(0,R.getTwitchEmoteURL)(h.id,1,!0,!0),L=`${M} 1x, ${(0,R.getTwitchEmoteURL)(h.id,2,!0,!0)} 2x`;b.push({id:h.id,name:h.token,src:M,srcSet:L})}}}else if($===I.EmoteTypes.Subscription){c.unlock_mode="subscribe",c.unlocked=!1,c.unlock_tier=x,c.existing_tier=0;const b=e.owner?.self?.subscriptionBenefit;b?.tier&&(c.existing_tier=u(b.tier));const k=c.extra_emotes=[],h=c.existing_tier;if(h>=x)c.unlocked=!0;else if(Array.isArray(e.owner?.subscriptionProducts))for(const M of e.owner.subscriptionProducts){const L=u(M.tier);if(L===x&&(c.channel_product=M.name,M.priceInfo?.price&&M.priceInfo.currency)){const T=new Intl.NumberFormat(navigator.languages,{style:"currency",currency:M.priceInfo.currency});c.product_price=T.format(M.priceInfo.price/100)}if(L>h&&L<=x&&Array.isArray(M.emotes))for(const T of M.emotes){const O=(0,R.getTwitchEmoteURL)(T.id,1,!0,!0),P=`${O} 1x, ${(0,R.getTwitchEmoteURL)(T.id,2,!0,!0)} 2x`;k.push({id:T.id,name:T.token,src:O,srcSet:P})}}}return c}if(s.provider==="emoji"){const _=this.emoji.emoji[s.code],o=this.chat.context.get("chat.emoji.style"),e=s.variant?_.variants[s.variant]:_,a=s.variant?this.emoji.emoji[s.variant]:null,p=_.category?this.i18n.t(`emoji.category.${_.category.toSnakeCase()}`,this.emoji.categories[_.category]||_.category):null;return{id:s.code,fav_source:"emoji",more:[],src:this.emoji.getFullImage(e.image,o),srcSet:this.emoji.getFullImageSet(e.image,o),width:18,height:18,name:`:${_.names[0]}:${a?`:${a.names[0]}:`:""}`,source:this.i18n.t("tooltip.emoji","Emoji - {category}",{category:p})}}if(s.provider!=="ffz")throw new Error("Invalid provider");const i=this.emotes.emote_sets[s.set],l=i?i.emotes?.[s.id]||i.disabled_emotes?.[s.id]:null;if(!l)throw new Error("Unable to load emote data");const w={id:l.id,fav_source:i.source??"ffz",more:[],src:l.animSrc2??l.src2,srcSet:l.animSrcSet2??l.srcSet2,width:l.width,height:l.height,name:l.name,originalName:l.original_name,source:i.source_line||`${i.source||"FFZ"} ${i.title||"Global Emotes"}`,owner:l.owner?l.owner.display_name||l.owner.name:null,ownerLink:l.owner&&!i.source?`https://www.frankerfacez.com/${l.owner.name}`:null,artist:l.artist?l.artist.display_name||l.artist.name:null,artistLink:l.artist&&!i.source?`https://www.frankerfacez.com/${l.artist.name}`:null};return i.source?l.click_url&&w.more.push({type:"link",title_i18n:"emote-card.view-external",title:"View on {source}",source:i.source,href:l.click_url}):(l.public&&(w.body="manage-ffz"),w.more.push({type:"link",title_i18n:"emote-card.view-on-ffz",title:"View on FrankerFaceZ",href:`https://www.frankerfacez.com/emoticon/${l.id}-`}),w.more.push({type:"report-ffz",title_i18n:"emote-card.report",title:"Report Emote",icon:"ffz-i-flag"})),w}async openCard(s,i,l){const w=`${s.provider}::${s.id}::${i??""}`,_=this.open_cards[w];if(_){_.$el.style.zIndex=(0,B.getDialogNextZ)(),_.focus();return}let o=l?l.clientX:window.innerWidth/2,e=l?l.clientY+15:window.innerHeight/2;if(this.last_card){const p=this.last_card;l||(o=p.$el.offsetLeft,e=p.$el.offsetTop),p.close()}const a=this.loadData(s);await this.loadVue(),this.last_card=this.open_cards[w]=this.buildCard(o,e,s,i,a)}buildCard(s,i,l,w,_){let o;const e=new this.vue.Vue({el:(0,W.createElement)("div"),render:C=>C("emote-card",{props:{raw_emote:(0,R.deep_copy)(l),raw_modifiers:w,data:_,getFFZ:()=>this,reportTwitchEmote:(...m)=>this.reportTwitchEmote(...m),getZ:B.getDialogNextZ},on:{emit:(m,...x)=>this.emit(m,...x),close:()=>{e.$el.remove(),e.$destroy(),this.last_card===o&&(this.last_card=null);const x=`${l.provider}::${l.id}::${w??""}`;this.open_cards[x]===o&&(this.open_cards[x]=null),this.emit("tooltips:cleanup")},pin:()=>{this.last_card===o&&(this.last_card=null)}}})});o=e.$children[0];const a=e.$el;return a.style.left=`${s}px`,a.style.top=`${i}px`,document.querySelector(this.site.constructor.DIALOG_SELECTOR??"#root>div>.tw-full-height,.twilight-minimal-root>.tw-full-height").appendChild(a),requestAnimationFrame(()=>o.constrain()),o}};G(S,"EmoteCard");let y=S},88082:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>U});var W=d(44589),B=d(94417),R=d(46949),I=d(22527);const z=class z extends I.default{constructor(...f){super(...f),this.should_enable=!0,this.inject("i18n"),this.inject("chat"),this.inject("site"),this.inject("settings"),this.vue=this.resolve("vue"),this.settings.add("link-cards.enable",{default:!1,ui:{path:"Chat > Link Cards >> General",title:"Enable Link Cards.",description:"When this is enabled and you click a link in chat or whispers, a popup will open with information about the link. This provides the same data as rich link tooltips, but in a form that allows more interaction.",component:"setting-check-box"}}),this.settings.add("link-cards.use-destination",{default:!1,ui:{path:"Chat > Link Cards >> General",title:"Bypass Known Shorteners",description:'When clicking "Open Link" from a Link Card with this enabled, you will bypass known shorteners and tracking services and go directly to the destination URL.',component:"setting-check-box"}}),this.open_cards={},this.last_card=null}onEnable(){this.on("chat:click-link",this.handleClick,this)}handleClick(f){this.settings.get("link-cards.enable")&&(f.preventDefault(),this.openCard(f.url,f.source))}async loadVue(){if(this._vue_loaded)return;await this.vue.enable();const f=await d.e(6115).then(d.bind(d,47792));this.vue.component("link-card",f.default),this.vue.component("lc-url",{functional:!0,props:["url","show-protocol"],render(u,y){let S=y.props.url;S instanceof URL||(S=new URL(S));const n=[];y.props.showProtocol&&n.push(u("span",{class:"tw-c-text-alt-2"},`${S.protocol}//`)),n.push(u("span",S.host));let s=S.toString().slice(S.origin.length);return s.length&&s!=="/"&&n.push(u("span",{class:"tw-c-text-alt-2"},s)),u("span",n)}}),this._vue_loaded=!0}async openCard(f,u){const y=`${f}`,S=this.open_cards[y];if(S){S.$el.style.zIndex=(0,B.getDialogNextZ)(),S.focus();return}let n=u?u.clientX:window.innerWidth/2,s=u?u.clientY+15:window.innerHeight/2;const i=this.chat.get_link_info(f);await this.loadVue(),this.last_card=this.open_cards[y]=this.buildCard(n,s,f,i)}buildCard(f,u,y,S){let n;const s=new this.vue.Vue({el:(0,W.createElement)("div"),render:w=>w("link-card",{props:{url:y,data:S,use_dest:this.settings.get("link-cards.use-destination"),getFFZ:()=>this,getZ:B.getDialogNextZ},on:{emit:(_,...o)=>this.emit(_,...o),close:()=>{s.$el.remove(),s.$destroy(),this.last_card===n&&(this.last_card=null);const o=y;this.open_cards[o]===n&&(this.open_cards[o]=null),this.emit("tooltips:cleanup")},pin:()=>{this.last_card===n&&(this.last_card=null)}}})});n=s.$children[0];const i=s.$el;return i.style.left=`${f}px`,i.style.top=`${u}px`,document.querySelector(this.site.constructor.DIALOG_SELECTOR??"#root>div>.tw-full-height,.twilight-minimal-root>.tw-full-height").appendChild(i),requestAnimationFrame(()=>n.constrain()),n}};G(z,"LinkCard");let U=z},5624:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>u});var W=d(22527),B=d(44589),R=d(46949),I=d(94417),U=d(54643),z=d(90334),v=d(68069);function f(S){return typeof S!="string"?S:S.replace(/<[^>]*>/g,"").toLocaleLowerCase()}G(f,"format_term");const y=class y extends W.default{constructor(...n){super(...n),this.inject("settings"),this.inject("i18n"),this.inject("site"),this.inject("vue"),this.load_requires=["vue"],this.Mixin=this.SettingMixin=U.Z,this.ProviderMixin=z.Z,this.exclusive=!1,this.new_seen=!1,this._settings_tree=null,this._settings_count=0,this.dialog=new I.default(()=>this.buildDialog()),this.has_update=!1,this.opened=!1,this.showing=!1,this.context=this.settings.context(),this.settings.addUI("profiles",{path:'Data Management @{"sort": 1000, "profile_warning": false} > Profiles @{"profile_warning": false}',component:"profile-manager"}),this.settings.addUI("backup",{path:'Data Management > Backup and Restore @{"profile_warning": false}',component:"backup-restore",getExtraTerms:()=>["restore"],getFFZ:()=>this.resolve("core")}),this.settings.addUI("clear",{path:'Data Management > Storage @{"profile_warning": false} >> tabs ~> Clear',component:"clear-settings",getExtraTerms:()=>["reset"],force_seen:!0}),this.settings.addUI("provider",{path:"Data Management > Storage >> tabs ~> Provider",component:"provider",getExtraTerms:()=>["storage","local","indexeddb","localstorage"],force_seen:!0}),this.settings.addUI("home",{path:'Home @{"sort": -1000, "profile_warning": false}',component:"home-page",requestPage:s=>this.requestPage(s),getUnseen:()=>{if(!this.unseen?.size)return null;const s={},i=[];let l=0;for(const w of this.unseen){const _=this.settings.definitions.get(w)||this.settings.ui_structures.get(w);if(!_||!_.ui||!_.ui.path_tokens)continue;const o=_.ui.path,e=_.ui.title;if(l++,l>20)break;if(!s[o]){const a=_.ui.path_tokens.map(m=>m.key).join("."),p=[];let C=this._settings_tree[a];for(;C;)p.unshift({i18n:C.i18n_key,title:C.title}),C.parent&&(C.page||C.tab?p.unshift({title:">>"}):p.unshift({title:">"})),C=this._settings_tree[C.parent];i.push(s[o]={key:a,tokens:p,entries:[]})}!o||!e||s[o].entries.push({key:w,i18n:_.ui.i18n_key??`setting.entry.${w}`,title:e})}return i.length?i:null}}),this.settings.addUI("debug.graphql-test",{path:"Debugging > GraphQL >> Inspector",component:"graphql-inspect",getFFZ:()=>this.resolve("core"),force_seen:!0}),this.settings.addUI("faq",{path:'Home > FAQ @{"profile_warning": false}',component:"md-page",key:"faq"}),this.settings.addUI("chat.filtering.syntax-help",{path:'Chat > Filtering > Syntax Help @{"profile_warning": false}',component:"md-page",key:"term-syntax",force_seen:!0}),this.settings.addUI("feedback",{path:'Home > Feedback @{"profile_warning": false}',component:"md-page",key:"feedback"}),this.settings.addUI("feedback.log",{path:'Home > Feedback >> Log @{"sort": 1000}',component:"async-text",watch:["reports.error.include-user","reports.error.include-settings"],data:()=>this.resolve("core").generateLog()}),this.settings.addUI("changelog",{path:'Home > Changelog @{"profile_warning": false}',component:"changelog",getFFZ:()=>this}),this.settings.addUI("addon-changelog",{path:'Add-Ons > Changelog @{"sort": -1000, "profile_warning": false, "hide_children": true}',component:"changelog",force_seen:!0,addons:!0,getFFZ:()=>this}),this.settings.addUI("legal",{path:'Home > Legal @{"sort": 1000}',component:"md-page",key:"legal",force_seen:!0}),this.settings.add("ffz.search.matches-only",{default:!0,ui:{path:"Appearance > Control Center >> Search",title:"Hide items that do not match completely when searching.",component:"setting-check-box"}}),this.on("settings:added-definition",(s,i)=>{this._addDefinitionToTree(s,i),this.scheduleUpdate()}),this.on("settings:removed-definition",s=>{this._removeDefinitionFromTree(s),this.scheduleUpdate()}),this.on("pubsub:command:new_version",s=>{if(s===window.FrankerFaceZ.version_info.commit)return;this.log.info("New Version:",s),this.has_update=!0;const i=this.resolve("site.menu_button");i&&(i.has_update=!0),this._vue&&(this._vue.$children[0].context.has_update=!0)}),this.scheduleUpdate(),this.on(":open",s=>{const i=this.resolve("site.layout"),l=s?.item,w=s?.event;if(i&&i.is_minimal||w&&(w.ctrlKey||w.shiftKey)){!this.openPopout(l)&&s&&(s.errored=!0);return}l&&this.requestPage(l),!this.showing&&this.emit("site.menu_button:clicked")})}openPopout(n){const s=window.open(`https://twitch.tv/popout/frankerfacez/chat?ffz-settings${n?`=${encodeURIComponent(n)}`:""}`,"_blank","resizable=yes,scrollbars=yes,width=850,height=600");return s?(s.focus(),!0):(this.log.warn("Unable to open popout settings window."),!1)}async onLoad(){this.vue.component((await Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,63479))).default)}async onEnable(){await this.site.awaitElement(I.default.EXCLUSIVE),await this.i18n.loadChunk("settings"),this.on("addons:added",this.scheduleUpdate,this),this.on("experiments:enabled",this.scheduleUpdate,this),this.on("i18n:update",this.scheduleUpdate,this),this.dialog.on("show",()=>{this.dialog.maximized&&this.runFix(1),this.showing=!0,this.opened=!0,this.updateButtonUnseen(),this.emit("show")}),this.dialog.on("hide",()=>{this.dialog.maximized&&this.runFix(-1),this.showing=!1,this.emit("hide"),this.destroyDialog()}),this.dialog.on("resize",()=>{this.dialog.visible&&this.runFix(this.dialog.maximized?1:-1),this._vue&&(this._vue.$children[0].maximized=this.dialog.maximized)}),this.on("site.menu_button:clicked",this.dialog.toggleVisible,this.dialog),this.dialog.show()}onDisable(){this.dialog.hide(),this.off("site.menu_button:clicked",this.dialog.toggleVisible,this.dialog)}mdNavigate(n){const s=n?.dataset?.settingsLink;s&&(this.requestPage(s),this.showing||this.emit("site.menu_button:clicked"))}updateContext(n){n||(n=this._context),this._context=n,this.use_context?(this.context._updateContext||(this.context._updateContext=this.context.updateContext,this.context.updateContext=function(s){const i={};for(const l of v.eB)(0,R.has)(s,l)&&(i[l]=s[l]);this._updateContext(i)}),this.context._context={},this.context._updateContext({...n,can_proxy:n?.proxied||!1})):(this.context._updateContext&&(this.context.updateContext=this.context._updateContext,this.context._updateContext=null),this.context.setContext({can_proxy:n?.proxied||!1}))}openExclusive(){window.addEventListener("message",n=>{const s=n.data?.ffz_type;s==="context-update"?this.updateContext({...n.data.ctx,proxied:!0}):s==="context-gone"&&(this.log.info("Context proxy gone."),this.updateContext({proxied:!1}))});try{window.opener.postMessage({ffz_type:"request-context"},"*")}catch{this.log.info("Unable to request settings context from opener.")}this.exclusive=!0,this.dialog.exclusive=!0,this.enable().then(()=>this.dialog.show())}runFix(n){this.settings.updateContext({force_chat_fix:(this.settings.get("context.force_chat_fix")||0)+n})}requestPage(n){const s=(0,R.get)("_vue.$children.0",this);s&&s.navigate?s.navigate(n):this._wanted_page=n}getUnseen(){const n=this.getSettingsTree();if(!Array.isArray(n))return 0;let s=0;for(const i of n)i&&(s+=i.unseen||0);return s}buildDialog(){return this._menu?this._menu:(this._vue=new this.vue.Vue({el:(0,B.createElement)("div"),render:n=>n("main-menu",this.getData())}),this._menu=this._vue.$el)}destroyDialog(){this._vue&&this._vue.$destroy(),this._menu=this._vue=null}scheduleUpdate(){this._update_timer||(this._update_timer=setTimeout(()=>{this.i18n.enable().then(()=>this.updateLiveMenu())},250))}updateButtonUnseen(){const n=this.resolve("site.menu_button");n&&(n.new_settings=this.opened?0:this.getUnseen())}updateLiveMenu(){if(clearTimeout(this._update_timer),this._update_timer=null,this.updateButtonUnseen(),!this._vue||!this._vue.$children||!this._vue.$children[0])return;const n=this._vue.$children[0],s=n.currentItem,i=s&&s.full_key,l=!n.restoredItem,w=window.history.state,_=this.getSettingsTree();n.nav=_,n.navKeys=_.keys;let o,e=!0;if(this._wanted_page&&(o=_.keys[this._wanted_page]),!o&&l){if(w?.ffzcc&&(o=_.keys[w.ffzcc]),!o){const a=new URL(window.location).searchParams,p=a?.get("ffz-settings");o=p&&_.keys[p]}o||(e=!1)}o||(o=_.keys[i]),o||(o=this.has_update?_.keys["home.changelog"]:_.keys.home),n.currentItem=o,n.restoredItem=e,this._wanted_page=null}rebuildSettingsTree(){this._settings_tree={},this._settings_count=0;for(const[n,s]of this.settings.definitions)this._addDefinitionToTree(n,s);for(const[n,s]of this.settings.ui_structures)this._addDefinitionToTree(n,s)}_removeDefinitionFromTree(n){if(!this._settings_tree)return;let s;for(const i of Object.values(this._settings_tree))if(!(!i||!Array.isArray(i.settings))){for(let l=0;l<i.settings.length;l++){const w=i.settings[l];if(w&&w[0]===n){i.settings.splice(l,1),s=i;break}}if(s)break}s&&this._maybeDeleteSection(s)}_maybeDeleteSection(n){if(n.settings&&n.settings.length)return;const s=n.full_key;for(const i of Object.values(this._settings_tree))if(i.parent===s)return;if(delete this._settings_tree[s],n.parent){const i=this._settings_tree[n.parent];i&&this._maybeDeleteSection(i)}}_addDefinitionToTree(n,s){if(!s.ui||!this._settings_tree)return;if(!s.ui.path_tokens)if(s.ui.path)s.ui.path_tokens=(0,v.lm)(s.ui.path);else return;if(!s.ui||!s.ui.path_tokens||!this._settings_tree)return;const i=this._settings_tree,l=s.ui.path_tokens,w=l.length;let _=null,o;for(let e=0;e<w;e++){const a=l[e],p=_?`${_}.${a.key}`:a.key;o=i[p],o||(o=i[p]={full_key:p,sort:0,parent:_,expanded:_==null,i18n_key:`setting.${p}`,desc_i18n_key:`setting.${p}.description`}),Object.assign(o,a),_=p}o.settings=o.settings||[],o.settings.push([n,s]),this._settings_count++}getSettingsTree(){const n=performance.now();this._settings_tree||this.rebuildSettingsTree();const s=this._settings_tree,i=this.new_seen?null:this.settings.provider.get("cfg-seen"),l=i?new Set:null,w=i?null:[],_=this.settings.provider.get("cfg-collapsed"),o={},e={},a=new Set,p=new Set,C=this.i18n.locale!=="en";w&&(this.new_seen=!0);for(const x in s){if(!(0,R.has)(s,x))continue;const $=e[x]=e[x]||Object.assign({},s[x]),r=$.parent,c=r?e[r]=e[r]||Object.assign({},s[r]):o;if($.parent=r?c:null,$.page=$.page||c.page,_&&($.expanded=!_.includes($.full_key)),$.page&&!$.component&&p.add($),$.settings){const h=$.contents=$.contents||[];for(const[M,L]of $.settings)if(L.ui){const T=L.ui.i18n_key?L.ui.i18n_key:M?`setting.entry.${M}`:L.ui.key?`${$.i18n_key}.${L.ui.key}`:$.i18n_key,O=Object.assign({i18n_key:T,desc_i18n_key:`${T}.description`,sort:0},L.ui,{full_key:`setting:${M}`,setting:M,path_tokens:void 0,parent:$});(0,R.has)(L,"default")&&!(0,R.has)(O,"default")&&(typeof L.default==="object"?O.default=(0,R.deep_copy)(L.default):O.default=L.default);let P=[M];if(O.title&&(P.push(O.i18n_key?this.i18n.t(O.i18n_key,O.title,null,!0):O.title),C&&O.i18n_key&&this.i18n.has(O.i18n_key)&&P.push(this.i18n.t(O.i18n_key,O.title,null))),O.description&&(P.push(O.desc_i18n_key?this.i18n.t(O.desc_i18n_key,O.description,null,!0):O.description),C&&O.desc_i18n_key&&this.i18n.has(O.desc_i18n_key)&&P.push(this.i18n.t(O.desc_i18n_key,O.description,null))),O.getExtraTerms&&(P=P.concat(O.getExtraTerms())),O.search_terms=P.map(f).join(`
`),i){if(!i.includes(M)&&!O.force_seen){l.add(M);let j=O;for(;j;)j.unseen=(j.unseen||0)+1,j=j.parent}}else w&&w.push(M);h.push(O)}$.settings=void 0,h.length>1&&a.add(h)}if(!$.search_terms){const h=$.title&&($.i18n_key?this.i18n.t($.i18n_key,$.title,null,!0):$.title);let M=[$.key];h&&h.localeCompare($.key,void 0,{sensitivity:"base"})&&M.push(h),C&&$.i18n_key&&this.i18n.has($.i18n_key)&&M.push(this.i18n.t($.i18n_key,$.title,null)),$.description&&(M.push($.desc_i18n_key?this.i18n.t($.desc_i18n_key,$.description,null,!0):$.description),C&&$.desc_i18n_key&&this.i18n.has($.desc_i18n_key)&&M.push(this.i18n.t($.desc_i18n_key,$.description,null))),M=M.map(f);for(const T of["tabs","contents","items"])if($[T])for(const O of $[T])O.search_terms&&M.push(O.search_terms);M=$.search_terms=M.join(`
`);let L=c;for(;L&&L.search_terms;)L.search_terms+=`
${M}`,L=L.parent}const b=$.tab?"tabs":$.page?"contents":"items",k=c[b]=c[b]||[];k.push($),k.length>1&&a.add(k)}for(const x of p)x.component=x.tabs?"tab-container":x.contents?"menu-container":"setting-check-box";for(const x of a)x.sort(($,r)=>$.sort<r.sort?-1:$.sort>r.sort?1:$.key&&$.key.localeCompare(r.key));const m=o.items||[];if(m.keys=e,w&&this.settings.provider.set("cfg-seen",w),!_){const x=[];for(const $ of Object.keys(e)){const r=e[$];r&&r.items&&r.parent&&x.push($)}this.settings.provider.set("cfg-collapsed",x)}return(0,R.set_equals)(l,this.unseen)||(this.unseen=l,this.emit(":update-unseen")),this.log.info(`Built Tree in ${(performance.now()-n).toFixed(5)}ms with ${Object.keys(s).length} structure nodes and ${this._settings_count} settings nodes.`),m}getProfiles(n){const s=[],i={};n=n||this.context;for(const l of this.settings.__profiles)s.push(i[l.id]=this.getProfileProxy(l,n));return[s,i]}getProfileProxy(n,s){return{id:n.id,order:s.manager.__profiles.indexOf(n),live:s.__profiles.includes(n),toggled:n.toggled,title:n.name,i18n_key:n.i18n_key,ephemeral:n.ephemeral,description:n.description,desc_i18n_key:n.desc_i18n_key||n.i18n_key&&`${n.i18n_key}.description`,hotkey:n.hotkey,url:n.url,pause_updates:n.pause_updates,move:i=>s.manager.moveProfile(n.id,i),save:()=>n.save(),update:i=>{n.data=(0,R.deep_copy)(i),n.save()},toggle:()=>n.toggled=!n.toggled,getBackup:()=>(0,R.deep_copy)(n.getBackup()),context:(0,R.deep_copy)(n.context),get:i=>n.get(i),set:(i,l)=>n.set(i,l),delete:i=>n.delete(i),has:i=>n.has(i),on:(...i)=>n.on(...i),off:(...i)=>n.off(...i)}}getContext(){const n=this,s=this.vue.Vue,i=this.settings,l=i.provider,w=this.context,[_,o]=this.getProfiles(),e=window.history.state,a=e?.ffzccp;let p=o[0];if(a!=null&&(p=o[a]),!p){for(let m=_.length-1;m>=0;m--)if(_[m].live&&!_[m].ephemeral&&_[m].title&&!/7tv/i.test(_[m].title)){p=_[m];break}p||(p=_[0])}const C={profiles:_,profile_keys:o,currentProfile:p,exclusive:this.exclusive,can_proxy:w._context.can_proxy,proxied:w._context.proxied,has_update:this.has_update,matches_only:i.get("ffz.search.matches-only"),mod_icons:w.get("context.chat.showModIcons"),setProxied:m=>{this.use_context=m,this.updateContext()},createProfile:m=>{const x=i.createProfile(m);return n.getProfileProxy(x,w)},deleteProfile:m=>i.deleteProfile(m),getProcessor:m=>i.getProcessor(m),getValidator:m=>i.getValidator(m),getFFZ:()=>n.resolve("core"),provider:{unwrap:()=>l,get:(...m)=>l.get(...m),set:(...m)=>l.set(...m),delete:(...m)=>l.delete(...m),has:(...m)=>l.has(...m),on:(...m)=>l.on(...m),off:(...m)=>l.off(...m)},context:{_users:0,profiles:w.__profiles.map(m=>m.id),get:m=>w.get(m),uses:m=>w.uses(m),on:(...m)=>w.on(...m),off:(...m)=>w.off(...m),order:m=>w.order.indexOf(m),context:(0,R.deep_copy)(w._context),_update_profiles(m){const x=[],$=w.manager.__profiles;for(let r=0;r<$.length;r++){const c=o[$[r].id];c&&(c.order=r,x.push(c))}s.set(C,"profiles",x),m&&m.id===C.currentProfile.id&&(C.currentProfile=o[m.id])},_profile_created(m){s.set(o,m.id,n.getProfileProxy(m,w)),this._update_profiles()},_profile_changed(m){s.set(o,m.id,n.getProfileProxy(m,w)),this._update_profiles(m)},_profile_toggled(m,x){s.set(o[m.id],"toggled",x),this._update_profiles(m)},_profile_deleted(m){if(s.delete(o,m.id),this._update_profiles(),C.currentProfile.id===m.id&&(C.currentProfile=o[0],!C.currentProfile)){for(let x=C.profiles.length-1;x>=0;x--)if(C.profiles[x].live){C.currentProfile=C.profiles[x];break}C.currentProfile||(C.currentProfile=C.profiles[0])}},_context_changed(){this.context=(0,R.deep_copy)(w.__context);const m=w.manager.__profiles,x=this.profiles=w.__profiles.map($=>$.id);C.proxied=this.context.proxied,C.can_proxy=this.context.can_proxy,C.mod_icons=w.get("context.chat.showModIcons");for(let $=0;$<m.length;$++){const r=m[$].id,c=o[r];c.live=x.includes(r)}},_update_settings(){C.matches_only=i.get("ffz.search.matches-only")},_add_user(){this._users++,this._users===1&&(i.on(":changed:ffz.search.matches-only",this._update_settings,this),i.on(":profile-toggled",this._profile_toggled,this),i.on(":profile-created",this._profile_created,this),i.on(":profile-changed",this._profile_changed,this),i.on(":profile-deleted",this._profile_deleted,this),i.on(":profiles-reordered",this._update_profiles,this),w.on("context_changed",this._context_changed,this),w.on("profiles_changed",this._context_changed,this),this.profiles=w.__profiles.map(m=>m.id))},_remove_user(){this._users--,this._users===0&&(i.off(":changed:ffz.search.matches-only",this._update_settings,this),i.off(":profile-toggled",this._profile_toggled,this),i.off(":profile-created",this._profile_created,this),i.off(":profile-changed",this._profile_changed,this),i.off(":profile-deleted",this._profile_deleted,this),i.off(":profiles-reordered",this._update_profiles,this),w.off("context_changed",this._context_changed,this),w.off("profiles_changed",this._context_changed,this))}}};return C}markSeen(n,s){let i=!0,l=!1;if(s||(i=!1,s=this.settings.provider.get("cfg-seen",[])),Array.isArray(n.contents))for(const w of n.contents)l=w&&this.markSeen(w,s)||l;if(n.setting&&(this.unseen&&this.unseen.delete(n.setting),!s.includes(n.setting))){l=!0,s.push(n.setting);let w=n.parent;for(;w;)w.unseen=(w.unseen||1)-1,w=w.parent}return!i&&l&&(this.settings.provider.set("cfg-seen",s),this.emit(":update-unseen")),l}markAllSeen(n,s){let i=!0;if(s||(i=!1,s=this.settings.provider.get("cfg-seen",[])),Array.isArray(n))for(const l of n)l&&this.markAllSeen(l,s);if(Array.isArray(n.items))for(const l of n.items)this.markAllSeen(l,s);if(Array.isArray(n.contents))for(const l of n.contents)this.markAllSeen(l,s);if(Array.isArray(n.tabs))for(const l of n.tabs)this.markAllSeen(l,s);if(Array.isArray(n.settings))for(const l of n.settings)l&&this.markAllSeen(l[1],s);n.setting&&!s.includes(n.setting)&&s.push(n.setting),n.unseen&&(n.unseen=0),i||(this.settings.provider.set("cfg-seen",s),this.unseen=null,this.emit(":update-unseen"))}getData(){const n=this.getSettingsTree(),s=this.getContext(),i=window.history.state;let l,w=!0;if(this._wanted_page&&(l=n.keys[this._wanted_page]),!l&&i?.ffzcc&&(l=n.keys[i.ffzcc],l||(w=!1)),!l){const e=new URL(window.location).searchParams,a=e?.get("ffz-settings");l=a&&n.keys[a],l||(w=!1)}l||(l=this.has_update?n.keys["home.changelog"]:n.keys.home),this._wanted_page=null,this.markSeen(l);let _=!1;for(const e of n)if(e&&e.unseen){_=!0;break}const o={context:s,query:"",faded:!1,nav:n,currentItem:l,restoredItem:!0,navKeys:n.keys,has_unseen:_,maximized:this.dialog.maximized,exclusive:this.dialog.exclusive,markAllSeen:e=>this.markAllSeen(e),markSeen:e=>this.markSeen(e),markExpanded:e=>{const a=this.settings.provider.get("cfg-collapsed",[]),p=a.indexOf(e.full_key);if(e.expanded&&p!==-1)a.splice(p,1);else if(!e.expanded&&p===-1)a.push(e.full_key);else return;this.settings.provider.set("cfg-collapsed",a)},resize:e=>{this.dialog.exclusive||this.site?.router?.current_name==="squad"||this.site?.router?.current_name==="command-center"||this.settings.get("layout.is-theater-mode")||this.dialog.toggleSize(e)},close:e=>!this.dialog.exclusive&&this.dialog.toggleVisible(e),version:window.FrankerFaceZ.version_info};return o.popout=e=>{this.dialog.exclusive||(this.dialog.toggleVisible(e),this.openPopout(o.currentItem?.full_key)||alert(this.i18n.t("popup.error","We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch.")))},o}};G(y,"MainMenu");let u=y},90334:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>B});var W=d(46949);const B={data(){return{value:void 0,has_value:!1,provider_key:this.item.override_setting??this.item.setting,_unseen:!1}},created(){const R=this.context.provider,I=this.provider_key;R.on("changed",this._providerChange,this),this.has_value=R.has(I),this.has_value?this.value=(0,W.deep_copy)(R.get(I)):this.value=this.default_value,this.item.unseen&&(this._unseen=!0,this.item.unseen=0)},destroyed(){this.context.provider.off("changed",this._providerChange,this),this.value=void 0,this.has_value=!1},computed:{data(){const R=this.item.data;return typeof R=="function"?R(this.value):R},unseen(){return this._unseen||this.item.unseen>0},default_value(){return typeof this.item.default=="function"?this.item.default(this.context):(0,W.deep_copy)(this.item.default)},isValid(){return this.isDefault||this.validate(this.value)},isDefault(){return!this.has_value}},methods:{_providerChange(R,I,U){R===this.provider_key&&(U?(this.has_value=!1,this.value=this.default_value):(this.has_value=!0,this.value=(0,W.deep_copy)(I)))},validate(R){let I=this.item.validator;if(!I&&typeof this.item.process=="string"&&(I=this.context.getValidator(`process_${this.item.process}`)),I){if(typeof I!="function"&&(I=this.context.getValidator(I)),typeof I=="function")return I(R,this.item,this);throw new Error(`Invalid Validator for ${this.provider_key}`)}return!0},set(R){const I=this.context.provider,U=this.provider_key;let z=this.item.process;if(z)if(typeof z!="function"&&(z=this.context.getProcessor(z)),typeof z=="function")R=z(R,this.default_value,this.item,this);else throw new Error(`Invalid processor for ${U}`);I.set(U,R),this.has_value=!0,this.value=(0,W.deep_copy)(R),this.item.onUIChange&&this.item.onUIChange(this.value,this)},clear(){const R=this.context.provider,I=this.provider_key;R.delete(I),this.value=this.default_value,this.has_value=!1,this.item.onUIChange&&this.item.onUIChange(this.value,this)}}}},54643:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>B});var W=d(46949);const B={data(){return{value:void 0,has_value:!1,profile:null,_unseen:!1,source:null,source_value:void 0}},created(){const R=this.context.context,I=this.item.setting;R._add_user(),this._update_profile(),this._uses_changed(R.uses(I)),this.item.unseen&&(this._unseen=!0,this.item.unseen=0),R.on(`uses_changed:${I}`,this._uses_changed,this)},destroyed(){const R=this.context.context,I=this.item.setting;this.profile&&this.profile.off("changed",this._setting_changed,this),this.source&&this.source.off("changed",this._source_setting_changed,this),R.off(`uses_changed:${I}`,this._uses_changed,this),this.value=void 0,this.has_value=!1,this.profile=null,this.source_value=void 0,this.source=null,R._remove_user()},watch:{"context.currentProfile"(){this._update_profile()}},computed:{data(){const R=this.item.data;return typeof R=="function"?R(this.profile,this.value):R},unseen(){return this._unseen||this.item.unseen>0},default_value(){return typeof this.item.default=="function"?this.item.default(this.context.context):(0,W.deep_copy)(this.item.default)},isInherited(){return!this.has_value&&this.source&&this.sourceOrder>this.profileOrder},isDefault(){return!this.has_value&&!this.source},isOverridden(){return this.source&&this.sourceOrder<this.profileOrder},isValid(){return this.isDefault||this.validate(this.value)},isReadOnly(){return this.profile&&this.profile.ephemeral},sourceOrder(){return this.source?this.source.order:1/0},profileOrder(){return this.profile?this.profile.order:1/0},sourceTitle(){if(this.source)return this.source.i18n_key?this.t(this.source.i18n_key,this.source.title,this.source):this.source.title},sourceDisplay(){const R={title:this.sourceTitle};if(this.isInherited)return this.t("setting.inherited-from","Inherited From: {title}",R);if(this.isOverridden)return this.t("setting.overridden-by","Overridden By: {title}",R)}},methods:{_update_profile(){this.profile&&this.profile.off("changed",this._setting_changed,this);const R=this.profile=this.context.currentProfile,I=this.item.setting;R.on("changed",this._setting_changed,this),this.has_value=R.has(I),this.value=this.has_value?(0,W.deep_copy)(R.get(I)):this.isInherited?this.source_value:this.default_value},_setting_changed(R,I,U){R===this.item.setting&&(this.has_value=U!==!0,this.value=this.has_value?(0,W.deep_copy)(I):this.isInherited?this.source_value:this.default_value)},_source_setting_changed(R,I,U){R===this.item.setting&&(this.source_value=(0,W.deep_copy)(I),this.isInherited&&(this.value=U?this.default_value:I))},_uses_changed(R){this._uses_cb&&clearTimeout(this._uses_cb),this._uses_cb=setTimeout(()=>{this.source&&this.source.off("changed",this._source_setting_changed,this),R=R?R[0]:null;const I=this.source=R==null?null:this.context.profile_keys[R],U=this.item.setting;I?(I.on("changed",this._source_setting_changed,this),this.source_value=(0,W.deep_copy)(I.get(U))):this.source_value=void 0,this.has_value=this.profile&&this.profile.has(this.item.setting),this.has_value||(this.value=this.isInherited?this.source_value:this.default_value)},0)},validate(R){let I=this.item.validator;if(!I&&typeof this.item.process=="string"&&(I=this.context.getValidator(`process_${this.item.process}`)),I){if(typeof I!="function"&&(I=this.context.getValidator(I)),typeof I=="function")return I(R,this.item,this);throw new Error(`Invalid Validator for ${this.item.setting}`)}return!0},set(R){if(this.isReadOnly)return;let I=this.item.process;if(I)if(typeof I!="function"&&(I=this.context.getProcessor(I)),typeof I=="function")R=I(R,this.default_value,this.item,this);else throw new Error(`Invalid processor for ${this.item.setting}`);this.profile.set(this.item.setting,R),this.item.onUIChange&&this.item.onUIChange(R,this)},clear(){this.isReadOnly||(this.profile.delete(this.item.setting),this.item.onUIChange&&this.item.onUIChange(this.value,this))}}}},19745:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>I});var W=d(22527),B=d(94417),R=d(44589);const U=class U extends W.default{constructor(...v){super(...v),this.inject("settings"),this.inject("i18n"),this.inject("site"),this.inject("vue"),this.load_requires=["vue"],this.dialog=new B.default(()=>this.buildDialog())}openPopout(){const v=window.open("https://twitch.tv/popout/frankerfacez/chat?ffz-translate","_blank","resizable=yes,scrollbars=yes,width=850,height=600");return v?(v.focus(),!0):(this.log.warn("Unable to open popout translation window."),!1)}async onLoad(){this.vue.component((await Promise.all([d.e(7852),d.e(1871)]).then(d.bind(d,68088))).default)}async onEnable(){await this.site.awaitElement(B.default.EXCLUSIVE),this.on("i18n:seen",v=>{if(!this._vue)return;this._vue.$children[0].phrases.push(v)}),this.dialog.on("hide",this.destroyDialog,this),this.dialog.on("resize",()=>{this._vue&&(this._vue.$children[0].maximized=this.dialog.maximized)}),this.dialog.show()}onDisable(){this.dialog.hide()}buildDialog(){return this._dialog?this._dialog:(this._vue=new this.vue.Vue({el:(0,R.createElement)("div"),render:v=>v("translation-ui",this.getData())}),this._dialog=this._vue.$el)}destroyDialog(){this._vue&&this._vue.$destroy(),this._dialog=this._vue=null}getData(){return this.i18n.loadStrings(),{phrases:[],query:"",faded:!1,maximized:this.dialog.maximized,exclusive:this.dialog.exclusive,getI18n:()=>this.i18n,getKeys:()=>this.i18n.getKeys(),requestKeys:()=>this.i18n.requestKeys(),updatePhrase:(v,f)=>this.i18n.updatePhrase(v,f),listen:(v,f,u)=>this.on(v,f,u),unlisten:(v,f,u)=>this.off(v,f,u),resize:v=>!this.dialog.exclusive&&this.dialog.toggleSize(v),close:v=>!this.dialog.exclusive&&this.dialog.toggleVisible(v),popout:v=>{this.dialog.exclusive||(this.dialog.toggleVisible(v),this.openPopout()||alert(this.i18n.t("popup.error","We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch.")))}}}};G(U,"TranslationUI");let I=U},33612:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>I});var W=d(22527);let B=0,R=0;const U=class U extends W.default{constructor(v,f){super(v,f),this._id=`_ffz$${B++}`,this.log.info(`Using: ${this.constructor.name}`)}getReact(){if(this._react)return this._react;let v;try{v=this.getCore?.()?.intl?.react}catch{}if(v?.Component&&v.createElement)return this._react=v;if(v=this.resolve("site.web_munch")?.getModule?.("react"),v?.Component&&v.createElement)return this._react=v}getReactDom(){if(this._reactDom)return this._reactDom;let v=this.resolve("site.web_munch")?.getModule?.("react-dom");if(v?.createPortal)return this._reactDom=v}findReact(){const v=this.getReact();if(v)return Promise.resolve(v);const f=this.resolve("site.web_munch");return f?f.findModule("react"):this.waitFor("site.web_munch:registered").then(()=>this.findReact())}awaitElement(v,f,u=6e4){f||(f=document.documentElement);const y=f.querySelector(v);return y?Promise.resolve(y):new Promise((S,n)=>{const s=`${this._id}$observer`,i=f[s],l=R++,w=u&&setTimeout(()=>{const o=f[s];if(!o)return;const[e,a]=o;for(let p=0;p<a.length;p++){const C=a[p];if(C[0]===l){a.splice(p,1),C[3]("Timed out");break}}a.length||(e.disconnect(),f[s]=null)},u);if(i){i[1].push([l,v,S,n,w]);return}const _=new MutationObserver(()=>{const o=f[s];if(!o){_.disconnect();return}const e=o[1];for(let a=0;a<e.length;a++){const p=e[a],C=f.querySelector(p[1]);C&&(e.splice(a,1),a--,p[4]&&clearTimeout(p[4]),p[2](C))}e.length||(_.disconnect(),f[s]=null)});f[s]=[_,[[l,v,S,n,w]]],_.observe(f,{childList:!0,attributes:!0,characterData:!0,subtree:!0})})}};G(U,"BaseSite");let I=U},10789:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>w});var W=d(22527),B=d(44589),R=d(46949),I=d(83342);const U=(0,B.createElement)("span"),z=".video-player__default-player .player-controls__left-control-group",v=".video-player__default-player .player-controls__right-control-group",f=window.AudioContext&&window.DynamicsCompressorNode!=null,u=f&&window.GainNode!=null,y="setting.entry.player.volume-scroll.values",S=[{value:!1,title:"Disabled",i18n_key:`${y}.false`},{value:!0,title:"Enabled",i18n_key:`${y}.true`},{value:2,title:"Enabled with Right-Click",i18n_key:`${y}.2`},{value:3,title:"Enabled with Alt",i18n_key:`${y}.3`},{value:4,title:"Enabled with Alt + Right-Click",i18n_key:`${y}.4`},{value:5,title:"Enabled with Shift",i18n_key:`${y}.5`},{value:6,title:"Enabled with Shift + Right-Click",i18n_key:`${y}.6`},{value:7,title:"Enabled with Ctrl",i18n_key:`${y}.7`},{value:8,title:"Enabled with Ctrl + Right-Click",i18n_key:`${y}.8`}];function n(o){return o.querySelector('button[aria-label*="alt+x"]')??o.querySelector('button[aria-label]:has(path[d="M8 9H6v2h2V9zm1 0h2v2H9V9zm5 0h-2v2h2V9z"]')}G(n,"getNativeClipButton");function s(o){return o===2||o===4||o===6||o===8}G(s,"wantsRMB");function i(o,e,a){return!(s(o)&&e.button!==2&&!a||!e.altKey&&(o===3||o===4)||!e.shiftKey&&(o===5||o===6)||!e.ctrlKey&&(o===7||o===8))}G(i,"matchesEvent");function l(o){const e=o.currentTarget,a=e&&e.querySelector("figure");!a||a.classList.contains("ffz-i-t-reset-clicked")||(a.classList.toggle("ffz-i-t-reset",!1),a.classList.toggle("ffz-i-t-reset-clicked",!0),setTimeout(()=>{a.classList.toggle("ffz-i-t-reset",!0),a.classList.toggle("ffz-i-t-reset-clicked",!1)},500))}G(l,"rotateButton");const _=class _ extends W.default{constructor(...e){super(...e),this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.onShortcut=this.onShortcut.bind(this),this.LEFT_CONTROLS=z,this.RIGHT_CONTROLS=v,this.registerSettings()}registerSettings(){this.settings.add("player.embed-metadata",{default:!0,ui:{path:"Player > General >> Embed and Popout",title:"Show metadata when mousing over the player.",component:"setting-check-box"}}),this.settings.add("player.cast-button.hide",{default:!1,ui:{path:"Player > General >> Appearance",component:"setting-check-box",title:"Hide the Cast button."},changed:e=>this.css_tweaks.toggleHide("player-cast",e)}),this.settings.add("player.clip-button.hide-native",{default:null,requires:["player.clip-button.custom"],process:(e,a)=>a??e.get("player.clip-button.custom"),ui:{path:"Player > General >> Appearance",component:"setting-check-box",title:"Hide the native Clip button.",description:"By default, this is enabled when using the setting to add a custom Clip button."},changed:e=>this.css_tweaks.toggle("player-hide-native-clip",e)}),this.settings.add("player.clip-button.custom",{default:!1,ui:{path:"Player > General >> Appearance",component:"setting-check-box",title:"Display a custom Clip button.",description:"Add a custom Clip button to the player that better fits the style of the other buttons."},changed:()=>{for(const e of this.Player.instances)this.addClipButton(e)}}),this.settings.add("player.fade-pause-buffer",{default:!1,ui:{path:"Player > General >> Playback",title:"Fade the player when paused or buffering to make the UI easier to see.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("player-fade-paused",e)}),this.settings.add("player.disable-content-warnings",{default:!1,ui:{path:"Player > General >> General",title:"Do not display content warnings.",description:"When this is enabled, FFZ will automatically skip content warnings. This feature is intended for use by adults only.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.skipContentWarnings(e)}}),f&&(this.settings.add("player.compressor.enable",{default:!0,ui:{path:'Player > Compressor @{"description": "These settings control optional dynamic range compression for the player, a form of audio processing that reduces the volume of loud sounds and amplifies quiet sounds, thus normalizing or compressing the volume. This uses a [DynamicsCompressorNode](https://developer.mozilla.org/en-US/docs/Web/API/DynamicsCompressorNode) from the Web Audio API behind the scenes if you want to learn more."} >> General',title:"Enable the audio compressor and add an `Audio Compressor` button to the player controls.",sort:-1e3,component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.addCompressorButton(e)}}),this.settings.add("player.compressor.default",{default:!1,ui:{path:"Player > Compressor >> General",title:"Enable the compressor by default.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.compressPlayer(e)}}),this.settings.add("player.compressor.force-legacy",{default:!1,ui:{path:"Player > Compressor >> Advanced",title:"Force use of legacy browser API.",description:"This setting forces FrankerFaceZ to attempt to use an older browser API to create the compressor. Please reset your player after changing this setting.",component:"setting-check-box",force_seen:!0}}),this.settings.add("player.compressor.shortcut",{default:null,requires:["player.compressor.enable"],process(e,a){return e.get("player.compressor.enable")?a:null},ui:{path:"Player > Compressor >> General",title:"Shortcut Key",description:"This key sequence can be used to toggle the compressor.",component:"setting-hotkey"},changed:()=>{this.updateShortcut();for(const e of this.Player.instances)this.addCompressorButton(e)}}),u&&(this.settings.add("player.gain.enable",{default:!1,ui:{sort:-1,path:'Player > Compressor >> Gain Control @{"sort": 50, "description": "Gain Control gives you extra control over the output volume when using the Compressor by letting you adjust the volume after the compressor runs, while the built-in volume slider takes affect before the compressor. This uses a simple [GainNode](https://developer.mozilla.org/en-US/docs/Web/API/GainNode) from the Web Audio API, connected in sequence after the DynamicsCompressorNode the Compressor uses."}',title:"Enable gain control when the audio compressor is enabled.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.compressPlayer(e)}}),this.settings.add("player.gain.no-volume",{default:!1,requires:["player.gain.enable"],process(e,a){return e.get("player.gain.enable")?a:!1},ui:{path:"Player > Compressor >> Gain Control",title:"Force built-in volume to 100% when the audio compressor is enabled.",description:"With this enabled, the built-in volume will be hidden and the Gain Control will be the only way to change volume.",component:"setting-check-box"},changed:e=>{this.css_tweaks.toggleHide("player-gain-volume",e);for(const a of this.Player.instances)this.updateGainVolume(a)}}),this.settings.add("player.gain.scroll",{default:!1,ui:{path:"Player > Compressor >> Gain Control",title:"Scroll Adjust",description:"Adjust the gain by scrolling with the mouse wheel. This setting takes precedence over adjusting the volume by scrolling. *This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*",component:"setting-select-box",data:S}}),this.settings.add("player.gain.default",{default:100,requires:["player.gain.min","player.gain.max"],process(e,a){const p=e.get("player.gain.min"),C=e.get("player.gain.max");return a/=100,a<p&&(a=p),a>C&&(a=C),a},ui:{path:"Player > Compressor >> Gain Control",title:"Default Value",component:"setting-text-box",description:"The default value for gain control, when gain control is enabled. 100% means no change in volume.",process:"to_int",bounds:[0,!0]},changed:()=>this.updateGains()}),this.settings.add("player.gain.min",{default:0,process:(e,a)=>a/100,ui:{path:"Player > Compressor >> Gain Control",title:"Minimum",component:"setting-text-box",description:`**Range:** 0 ~ 100

The minimum allowed value for gain control. 0% is effectively muted.`,process:"to_int",bounds:[0,!0,100,!0]},changed:()=>this.updateGains()}),this.settings.add("player.gain.max",{default:200,process:(e,a)=>a/100,ui:{path:"Player > Compressor >> Gain Control",title:"Maximum",component:"setting-text-box",description:`**Range:** 100 ~ 1000

The maximum allowed value for gain control. 100% is no change. 200% is double the volume.`,process:"to_int",bounds:[100,!0,1e3,!0]},changed:()=>this.updateGains()})),this.settings.add("player.compressor.threshold",{default:-50,ui:{path:'Player > Compressor >> Advanced @{"sort": 1000}',title:"Threshold",sort:0,description:`**Range:** -100 ~ 0

The decibel value above which the compression will start taking effect.`,component:"setting-text-box",process:"to_int",bounds:[-100,!0,0,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.knee",{default:40,ui:{path:"Player > Compressor >> Advanced",title:"Knee",sort:5,description:`**Range:** 0 ~ 40

A decibel value representing the range above the threshold where the curve smoothly transitions to the compressed portion.`,component:"setting-text-box",process:"to_int",bounds:[0,!0,40,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.ratio",{default:12,ui:{path:"Player > Compressor >> Advanced",title:"Ratio",sort:10,description:`**Range:** 0 ~ 20

The amount of change, in dB, needed in the input for a 1 dB change in the output.`,component:"setting-text-box",process:"to_int",bounds:[0,!0,20,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.attack",{default:0,ui:{path:"Player > Compressor >> Advanced",title:"Attack",sort:15,description:`**Range:** 0 ~ 1

The amount of time, in seconds, required to reduce the gain by 10 dB.`,component:"setting-text-box",process:"to_float",bounds:[0,!0,1,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.release",{default:.25,ui:{path:"Player > Compressor >> Advanced",title:"Release",sort:20,description:`**Range:** 0 ~ 1
The amount of time, in seconds, required to increase the gain by 10 dB.`,component:"setting-text-box",process:"to_float",bounds:[0,!0,1,!0]},changed:()=>this.updateCompressors()})),this.settings.add("player.allow-catchup",{default:!0,ui:{path:'Player > General @{"sort": -1000} >> General',title:"Allow the player to speed up to reduce delay.",description:"Twitch, by default, will apply a minor speed up to live video when you have a large delay to the broadcaster in order to catch back up with the live broadcast. This may result in audio distortion. Disable this to prevent the automatic speed changes.",component:"setting-check-box"},changed:()=>this.updatePlaybackRates()}),this.settings.add("player.mute-click",{default:!1,ui:{path:"Player > General >> Volume",title:"Mute or unmute the player by middle-clicking.",component:"setting-check-box"}}),this.settings.add("player.volume-scroll",{default:!1,ui:{path:"Player > General >> Volume",title:"Adjust volume by scrolling with the mouse wheel.",description:"*This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*",component:"setting-select-box",data:S}}),this.settings.add("player.button.reset",{default:!0,ui:{path:"Player > General >> General",title:"Add a `Reset Player` button to the player controls.",description:"Double-clicking the Reset Player button attempts to reset the Twitch player's internal state, fixing playback issues without a full page refresh.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.addResetButton(e)}}),document.pictureInPictureEnabled&&this.settings.add("player.button.pip",{default:!0,ui:{path:"Player > General >> General",title:"Add a `Picture-in-Picture` button to the player controls.",description:"Clicking the PiP button attempts to toggle Picture-in-Picture mode for the player's video.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.addPiPButton(e)}}),this.settings.add("player.volume-scroll-steps",{default:.1,ui:{path:"Player > General >> Volume",title:"Volume scroll amount",description:"How much the volume level is changed per individual scroll input.",component:"setting-select-box",data:[{value:.1,title:"10%"},{value:.05,title:"5%"},{value:.02,title:"2%"},{value:.01,title:"1%"}]}}),this.settings.add("player.captions.font-size",{default:"",ui:{path:"Player > Closed Captioning >> Font",title:"Font Size",description:"How large should captions be. This can be a percentage, such as `10%`, or a pixel value, such as `50px`.",component:"setting-text-box"},changed:()=>this.updateCaptionsCSS()}),this.settings.add("player.captions.font-family",{default:"",ui:{path:"Player > Closed Captioning >> Font",title:"Font Family",description:"Override the font used for displaying Closed Captions.",component:"setting-combo-box",data:()=>(0,I.R7)()},changed:()=>this.updateCaptionsCSS()}),this.settings.add("player.ext-hide",{default:0,ui:{path:"Player > General >> Extensions",title:"Show Overlay Extensions",description:"**Note**: This feature does not prevent extensions from loading. Hidden extensions are merely invisible. Hiding extensions with this feature will not improve your security. To prevent extensions from loading entirely, we recommend using the [Disable Twitch Extensions browser extension](https://twitch-tools.rootonline.de/disable_twitch_extensions.php) by CommanderRoot.",component:"setting-select-box",data:[{value:2,title:"Never"},{value:1,title:"With Controls"},{value:0,title:"Always"}]},changed:e=>this.updateHideExtensions(e)}),this.settings.add("player.ext-interaction",{default:!0,ui:{path:"Player > General >> Extensions",title:"Allow mouse interaction with overlay extensions.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("player-ext-mouse",!e)}),this.settings.add("player.no-autoplay",{default:!1,ui:{path:"Player > General >> Playback",title:"Do not automatically start playing videos or streams.",description:"Note: This feature does not apply when navigating directly from channel to channel.",component:"setting-check-box"}}),this.settings.add("player.vod.autoplay",{default:!0,ui:{path:"Player > General >> Playback",title:"Auto-play the next recommended video after a video finishes.",component:"setting-check-box"}}),this.settings.add("player.volume-always-shown",{default:!1,ui:{path:"Player > General >> Volume",title:"Keep the volume slider expanded at all times.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("player-volume",e)}),this.settings.add("player.hide-mouse",{default:!0,ui:{path:"Player > General >> General",title:"Hide mouse when controls aren't visible.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("player-hide-mouse",e)}),this.settings.add("player.single-click-pause",{default:!1,ui:{path:"Player > General >> Playback",title:"Pause/Unpause the player by clicking.",component:"setting-check-box"}})}async onEnable(){await this.settings.awaitProvider(),await this.settings.provider.awaitReady(),this.css_tweaks.toggleHide("player-cast",this.settings.get("player.cast-button.hide")),this.css_tweaks.toggleHide("player-gain-volume",this.settings.get("player.gain.no-volume")),this.css_tweaks.toggle("player-hide-native-clip",this.settings.get("player.clip-button.hide-native")),this.css_tweaks.toggle("player-volume",this.settings.get("player.volume-always-shown")),this.css_tweaks.toggle("player-ext-mouse",!this.settings.get("player.ext-interaction")),this.css_tweaks.toggle("player-hide-mouse",this.settings.get("player.hide-mouse")),this.css_tweaks.toggle("player-fade-paused",this.settings.get("player.fade-pause-buffer")),this.installVisibilityHook(),this.updateHideExtensions(),this.updateCaptionsCSS(),this.updateShortcut(),this.on(":reset",this.resetAllPlayers,this),this.Player.ready((e,a)=>{this.modifyPlayerClass(e);for(const p of a){const C=p.props?.playerEvents;C&&((0,B.off)(C,"Playing",p.setPlayerActive),(0,B.off)(C,"PlayerSeekCompleted",p.setPlayerActive)),p.ffzMaybeRemoveNativeListeners(),p.maybeAttachDomEventListeners(),p.ffzScheduleState(),C&&((0,B.on)(C,"Playing",p.setPlayerActive),(0,B.on)(C,"PlayerSeekCompleted",p.setPlayerActive)),this.updateGUI(p),this.compressPlayer(p),this.updatePlaybackRate(p)}}),this.Player.on("mount",e=>{this.updateGUI(e),this.compressPlayer(e),this.updatePlaybackRate(e)}),this.Player.on("update",e=>{this.updateGUI(e),this.compressPlayer(e),this.updatePlaybackRate(e)}),this.Player.on("unmount",e=>{e.ffzUninstall()}),this.on("i18n:update",()=>{for(const e of this.Player.instances)this.updateGUI(e)})}updateShortcut(){const e=this.Mousetrap=this.Mousetrap||this.resolve("site.web_munch")?.getModule?.("mousetrap")||window.Mousetrap;if(!e||!e.bind)return;this._shortcut_bound&&(e.unbind(this._shortcut_bound),this._shortcut_bound=null);const a=this.settings.get("player.compressor.shortcut");f&&a&&(0,R.isValidShortcut)(a)&&(e.bind(a,this.onShortcut),this._shortcut_bound=a)}onShortcut(e){for(const a of this.Player.instances)this.compressPlayer(a,e)}modifyPlayerClass(e){const a=this,p=e.prototype.maybeAttachDomEventListeners;e.prototype.ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0,this._ffzUpdateState||(this._ffzUpdateState=this.ffzUpdateState.bind(this)),this._ffzErrorReset||(this._ffzErrorReset=a.addErrorResetButton.bind(a,this)),this._ffzReady||(this._ffzReady=this.ffzReady.bind(this));const C=this,m=this.setPlayerActive,x=this.setPlayerInactive;this.setPlayerActive=function(){return C.ffzScheduleState(),m.call(C)},this.setPlayerInactive=function(){return C.ffzScheduleState(),x.call(C)},this.ffzOnEnded=()=>{a.settings.get("player.vod.autoplay")||a.parent.awaitElement(".autoplay-vod__content-container button",this.props.containerRef||a.fine.getChildNode(this),1e3).then(r=>r.click())};const $=this.props.playerEvents;$&&((0,B.on)($,"Buffering",this._ffzUpdateState),(0,B.on)($,"Playing",this._ffzUpdateState),(0,B.on)($,"PlayerError",this._ffzUpdateState),(0,B.on)($,"PlayerError",this._ffzErrorReset),(0,B.on)($,"Ended",this._ffzUpdateState),(0,B.on)($,"Ended",this.ffzOnEnded),(0,B.on)($,"Ready",this._ffzReady),(0,B.on)($,"Idle",this._ffzUpdateState)),this.ffzStopAutoplay()},e.prototype.ffzUninstall=function(){this._ffz_state_raf&&cancelAnimationFrame(this._ffz_state_raf);const C=this.props.playerEvents;C&&this._ffzUpdateState&&((0,B.off)(C,"Playing",this._ffzUpdateState),(0,B.off)(C,"PlayerError",this._ffzUpdateState),(0,B.off)(C,"PlayerError",this._ffzErrorReset),(0,B.off)(C,"Ended",this._ffzUpdateState),(0,B.off)(C,"Ended",this.ffzOnEnded),(0,B.off)(C,"Ready",this._ffzReady),(0,B.off)(C,"Idle",this._ffzUpdateState)),this.ffzRemoveListeners(),this._ffz_state_raf=null,this._ffzUpdateState=null,this._ffzErrorReset=null,this._ffzReady=null,this.ffzOnEnded=null},e.prototype.ffzReady=function(){const C=this.props.containerRef;C&&requestAnimationFrame(()=>{const m=C.querySelectorAll(".ffz--player-reset figure");for(const x of m)x._ffz_unspin&&clearTimeout(x._ffz_unspin),x.classList.toggle("loading",!1)})},e.prototype.ffzStopAutoplay=function(){a.shouldStopAutoplay(this)&&a.stopPlayer(this.props.mediaPlayerInstance,this.props.playerEvents,this)},e.prototype.ffzScheduleState=function(){this._ffzUpdateState||(this._ffzUpdateState=this.ffzUpdateState.bind(this)),this._ffz_state_raf||(this._ffz_state_raf=requestAnimationFrame(this._ffzUpdateState))},e.prototype.ffzUpdateState=function(){this._ffz_state_raf=null;const C=this.props.containerRef;if(!C)return;const m=C.dataset;m.controls=this.state?.active||!1;let x=this.props.mediaPlayerInstance;if(!x)return;x.core&&(x=x.core);const $=x.state?.state,r=x.mediaSinkManager?.video;$==="Playing"&&r?._ffz_maybe_compress&&(r._ffz_maybe_compress=!1,a.compressPlayer(this)),r&&r._ffz_compressed!=null&&(m.compressed=r._ffz_compressed),m.ended=$==="Ended",m.paused=$==="Idle",m.buffering=$==="Buffering"},e.prototype.ffzAttachListeners=function(){const C=this.props.containerRef;!C||this._ffz_listeners||(this._ffz_listeners=!0,this._ffz_scroll_handler||(this._ffz_scroll_handler=this.ffzScrollHandler.bind(this)),this._ffz_click_handler||(this._ffz_click_handler=this.ffzClickHandler.bind(this)),this._ffz_dblclick_handler||(this._ffz_dblclick_handler=this.ffzDblClickHandler.bind(this)),this._ffz_menu_handler||(this._ffz_menu_handler=this.ffzMenuHandler.bind(this)),(0,B.on)(C,"wheel",this._ffz_scroll_handler),(0,B.on)(C,"dblclick",this._ffz_dblclick_handler),(0,B.on)(C,"mousedown",this._ffz_click_handler),(0,B.on)(C,"contextmenu",this._ffz_menu_handler))},e.prototype.ffzRemoveListeners=function(){const C=this.props.containerRef;!C||!this._ffz_listeners||(this._ffz_scroll_handler&&((0,B.off)(C,"wheel",this._ffz_scroll_handler),this._ffz_scroll_handler=null),this._ffz_click_handler&&((0,B.off)(C,"mousedown",this._ffz_click_handler),this._ffz_click_handler=null),this._ffz_menu_handler&&((0,B.off)(C,"contextmenu",this._ffz_menu_handler),this._ffz_menu_handler=null),this._ffz_dblclick_handler&&((0,B.off)(C,"dblclick",this._ffz_dblclick_handler),this._ffz_dblclick_handler=null),this._ffz_listeners=!1)},e.prototype.ffzDelayPause=function(){this._ffz_pause_timer&&clearTimeout(this._ffz_pause_timer),(this.props?.mediaPlayerInstance).isPaused()||(this._ffz_pause_timer=setTimeout(()=>{const m=this.props?.mediaPlayerInstance;m.isPaused()||m.pause()},500))},e.prototype.ffzDblClickHandler=function(C){C&&this._ffz_pause_timer&&clearTimeout(this._ffz_pause_timer)},e.prototype.ffzClickHandler=function(C){if(!C)return;const m=a.settings.get("player.volume-scroll"),x=a.settings.get("player.gain.scroll"),$=a.settings.get("player.single-click-pause"),r=s(m)||s(x);if($&&C.button===0){if(!C.target||!C.target.classList.contains("click-handler"))return;this.ffzDelayPause()}if(r&&C.button===2&&(this.ffz_rmb=!0,this.ffz_scrolled=!1),!a.settings.get("player.mute-click")||C.button!==1)return;const c=this.props?.mediaPlayerInstance;if(!c?.isMuted)return;const b=!c.isMuted();return c.setMuted(b),localStorage.setItem("video-muted",JSON.stringify({default:b})),C.preventDefault(),!1},e.prototype.ffzMenuHandler=function(C){this.ffz_rmb=!1,this.ffz_scrolled&&(C.preventDefault(),C.stopPropagation())},e.prototype.ffzScrollHandler=function(C){const m=a.settings.get("player.volume-scroll"),x=a.settings.get("player.gain.scroll"),$=a.settings.get("player.gain.no-volume"),r=x&&i(x,C,this.ffz_rmb),c=m&&i(m,C,this.ffz_rmb);if(!r&&!c)return;const b=C.wheelDelta||-(C.deltaY||C.detail||0),k=this.props?.mediaPlayerInstance,h=k?.mediaSinkManager?.video||k?.core?.mediaSinkManager?.video,M=h?._ffz_compressed&&h?._ffz_gain!=null,L=M&&r;if(!k?.getVolume)return;s(L?x:m)&&(this.ffz_scrolled=!0);const T=a.settings.get("player.volume-scroll-steps");if(L){let O=h._ffz_gain_value;O==null&&(O=a.settings.get("player.gain.default"));const P=a.settings.get("player.gain.min"),j=a.settings.get("player.gain.max");b>0?O+=T:O-=T,O<P&&(O=P),O>j&&(O=j),h._ffz_gain_value=O,$&&O!==0&&(k.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1}))),a.updateGain(this)}else if(c&&!(h._ffz_compressed&&$)){const O=h?.volume??k.getVolume(),P=Math.max(0,Math.min(1,O+(b>0?T:-T)));k.setVolume(P),localStorage.volume=P,P!==0&&(k.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1})))}return C.preventDefault(),!1},e.prototype.ffzMaybeRemoveNativeListeners=function(){const C=this.props.containerRef;C&&this.listenersAttached&&((0,B.off)(C,"mouseleave",this.setPlayerInactive),(0,B.off)(C,"mouseenter",this.setPlayerActive),(0,B.off)(C,"mousemove",this.onMouseMove),this.listenersAttached=!1)},e.prototype.maybeAttachDomEventListeners=function(){try{this.ffzInstall(),this.ffzAttachListeners()}catch(C){a.log.error("Error attaching event listener.",C)}return p.call(this)}}shouldStopAutoplay(){return!1}installVisibilityHook(){if(!document.pictureInPictureEnabled){this.log.info("Skipping visibility hooks. Picture-in-Picture is not available.");return}const e=this;document.addEventListener("fullscreenchange",()=>{const a=document.fullscreenElement,p=document.pictureInPictureElement;a&&p&&(a===p||a.contains(p))&&document.exitPictureInPicture();for(const C of this.Player.instances)this.addPiPButton(C)});try{Object.defineProperty(document,"hidden",{configurable:!0,get(){return document.pictureInPictureElement!=null||e.settings.get("player.force-visible")?!1:document.visibilityState==="hidden"}})}catch(a){this.log.warn("Unable to install document visibility hook.",a)}}stopPlayer(e,a,p){if(e&&e.pause&&(e.getState?.()||e.core?.getState?.())==="Playing")e.pause();else if(a&&!a._ffz_stopping){a._ffz_stopping=!0;const C=G(()=>{p.props.mediaPlayerInstance?.pause&&(p.props.mediaPlayerInstance.pause(),(0,B.off)(a,"Playing",C),a._ffz_stopping=!1)},"immediatePause");this.log.info("Unable to immediately pause. Listening for playing event."),(0,B.on)(a,"Playing",C)}}updateCaptionsCSS(){const e=[],a=this.settings.get("player.captions.font-size");let p=this.settings.get("player.captions.font-family");if(p&&p.length){const[C,m]=(0,I.jo)(p);p=C,this._font_unloader&&this._font_unloader(),this._font_unloader=m,p.indexOf(" ")!==-1&&p.indexOf(",")===-1&&p.indexOf('"')===-1&&p.indexOf("'")===-1&&(p=`"${p}"`),U.style.fontFamily="",U.style.fontFamily=p,U.style.fontFamily&&e.push(`font-family: ${U.style.fontFamily} !important;`)}U.style.fontSize="",U.style.fontSize=a,U.style.fontSize&&e.push(`font-size: ${U.style.fontSize} !important;`),e.length?this.css_tweaks.set("captions-font",`.player-captions-container__caption-line {
	${e.join(`
	`)}
}`):this.css_tweaks.delete("captions-font")}updateHideExtensions(e){e===void 0&&(e=this.settings.get("player.ext-hide")),this.css_tweaks.toggleHide("player-ext-hover",e===1),this.css_tweaks.toggleHide("player-ext",e===2)}skipContentWarnings(e){if(!this.settings.get("player.disable-content-warnings"))return;const a=this.fine.getHostNode(e),p=a&&a.querySelector('button[data-a-target="content-classification-gate-overlay-start-watching-button"]');p&&p.click()}updateGUI(e){this.skipContentWarnings(e),this.addPiPButton(e),this.addResetButton(e),this.addClipButton(e),this.addCompressorButton(e,!1),this.addGainSlider(e,!1),this.addMetadata(e),this.emit(":update-gui",e)}areControlsDisabled(e){return e._ffz_control_state||this.findControlState(e),e._ffz_control_state?e._ffz_control_state.props.disableControls:!1}findControlState(e){e._ffz_control_state||(e._ffz_control_state=this.fine.searchTree(e,a=>a.props&&(0,R.has)(a.props,"disableControls"),200))}addGainSlider(e,a,p=0){const C=e.props.containerRef||this.fine.getChildNode(e),m=e.props.mediaPlayerInstance?.mediaSinkManager?.video||e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,x=C&&C.querySelector(z);let $=m!=null&&m._ffz_compressed&&m._ffz_gain;if(this.areControlsDisabled(e)&&($=null),!x)return m&&!$?void 0:p<5?setTimeout(this.addGainSlider.bind(this,e,a,(p||0)+1),250):void 0;const r=this.settings.get("player.gain.min"),c=this.settings.get("player.gain.max");(r>=c||c<=r)&&($=null);let b,k,h,M,L,T=x.querySelector(".ffz--player-gain");if(!$){T&&T.remove();return}if(T){if(a)return;h=T.querySelector("input"),L=T.querySelector(".ffz--gain-value"),k=T.querySelector(".ffz-il-tooltip"),b=T.querySelector(".ffz-il-tooltip .ffz--p-tip"),M=T.querySelector(".ffz-il-tooltip .ffz--p-value")}else{const Z=G(()=>{let q=h.value/100;const X=this.settings.get("player.gain.min"),ee=this.settings.get("player.gain.max");if(q<X&&(q=X),q>ee&&(q=ee),q==m._ffz_gain_value)return;const te=e.props.mediaPlayerInstance,ne=te.core||te;!this.areControlsDisabled(e)&&q>0&&this.settings.get("player.gain.no-volume")&&ne?.isMuted?.()&&(ne.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1}))),m._ffz_gain_value=q,$.gain.value=q;const pe=ee-X,oe=(q-X)/pe;L.style.width=`${oe*100}%`,M.textContent=`${Math.round(q*100)}%`},"on_change");T=(0,B.createElement)("div",{class:"ffz--player-gain volume-slider__slider-container tw-relative ffz-il-tooltip__container"},(0,B.createElement)("div",{class:"tw-align-items-center tw-flex tw-full-height"},(0,B.createElement)("label",{class:"tw-hide-accessible"},this.i18n.t("player.gain.label","Gain Control")),(0,B.createElement)("div",{class:"tw-flex tw-full-width tw-relative tw-z-above"},h=(0,B.createElement)("input",{class:"ffz-range ffz-range--overlay",type:"range",min:"0",max:"100",step:"1","data-a-target":"player-gain-slider",value:"100"}),(0,B.createElement)("div",{class:"tw-absolute tw-border-radius-large tw-bottom-0 tw-flex tw-flex-column tw-full-width tw-justify-content-center ffz-range__fill ffz-range__fill--overlay tw-top-0 tw-z-below"},(0,B.createElement)("div",{class:"tw-border-radius-large ffz-range__fill-container"},L=(0,B.createElement)("div",{class:"tw-border-radius-large ffz-range__fill-value ffz--gain-value","data-test-selector":"ffz-range__fill-value-selector"}))))),k=(0,B.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-center ffz-il-tooltip--up",role:"tooltip"},(0,B.createElement)("div",null,b=(0,B.createElement)("div",{class:"ffz--p-tip"}),M=(0,B.createElement)("div",{class:"tw-regular ffz--p-value"})))),h.addEventListener("input",Z),x.appendChild(T)}let O=m._ffz_gain_value;O==null&&(O=this.settings.get("player.gain.default")),h.min=r*100,h.max=c*100,h.value=O*100;const P=c-r,j=(O-r)/P;L.style.width=`${j*100}%`,b.textContent=this.i18n.t("player.gain.label","Gain Control"),M.textContent=`${Math.round(O*100)}%`}addCompressorButton(e,a,p=0){const C=e.props.containerRef||this.fine.getChildNode(e),m=e.props.mediaPlayerInstance?.mediaSinkManager?.video||e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,x=C&&C.querySelector(z),$=f&&m!=null&&this.settings.get("player.compressor.enable");if(!x)return $&&p<5?setTimeout(this.addCompressorButton.bind(this,e,a,(p||0)+1),250):void 0;let r,c,b,k,h=x.querySelector(".ffz--player-comp");if(!$||this.areControlsDisabled(e)){h&&h.remove();return}if(!h)h=(0,B.createElement)("div",{class:"ffz--player-comp tw-inline-flex tw-relative ffz-il-tooltip__container"},k=(0,B.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-comp-button",onClick:this.compressPlayer.bind(this,e)},(0,B.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,B.createElement)("div",{class:"tw-button-icon__icon"},r=(0,B.createElement)("figure",{class:"ffz-player-icon"})))),(0,B.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-left ffz-il-tooltip--up",role:"tooltip"},(0,B.createElement)("div",null,c=(0,B.createElement)("div",{class:"ffz--p-tip"}),b=(0,B.createElement)("div",{class:"ffz--p-extra tw-pd-t-05 ffz--tooltip-explain"})))),x.appendChild(h);else{if(a)return;r=h.querySelector("figure"),k=h.querySelector("button"),c=h.querySelector(".ffz-il-tooltip .ffz--p-tip"),b=h.querySelector(".ffz-il-tooltip .ffz--p-extra")}const M=m._ffz_compressed,L=this.canCompress(e);let T=L?M?this.i18n.t("player.comp_button.off","Disable Audio Compressor"):this.i18n.t("player.comp_button.on","Audio Compressor"):this.i18n.t("player.comp_button.disabled","Audio Compressor cannot be enabled when viewing Clips.");b.textContent=this.i18n.t("player.comp_button.help","See the FFZ Control Center for details. If audio breaks, please reset the player."),L&&this._shortcut_bound&&(T=`${T} (${this._shortcut_bound})`),r.classList.toggle("ffz-i-comp-on",M),r.classList.toggle("ffz-i-comp-off",!M),k.disabled=!L,k.setAttribute("aria-label",T),c.textContent=T}replaceVideoElement(e,a){const p=(0,B.createElement)("video"),C=a?._ffz_pregain_volume??a?.volume??e.getVolume(),m=e.isMuted();return p._ffz_gain_value=a._ffz_gain_value,p._ffz_state=a._ffz_state,p._ffz_toggled=a._ffz_toggled,p._ffz_maybe_compress=a._ffz_compressed,p.volume=C,m&&(p.muted=!0),p.playsInline=!0,this.installPlaybackRate(p),a.replaceWith(p),e.attachHTMLVideoElement(p),p}hookPlayerLoad(e){!e||e._ffz_load||(e._ffz_load=e.load,e.load=(...a)=>{try{const p=e.getHTMLVideoElement();p?._ffz_compressor&&e.attachHTMLVideoElement&&(this.log.info("Recreating video element due to player load with compressor installed."),this.replaceVideoElement(e,p))}catch(p){t.log.error("Error while handling player load.",p)}return e._ffz_load(...a)})}compressPlayer(e,a){const p=e.props.mediaPlayerInstance,C=p.core||p,m=C?.mediaSinkManager?.video;if(!m||!f)return;this.hookPlayerLoad(p),e._ffz_setSrc||(e._ffz_setSrc=e.setSrc,e.setSrc=async function(...L){console.log("setSrc",L);const T=e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;return T&&T._ffz_compressor&&await this.resetPlayer(e),e._ffz_setSrc(...L)}),C._ffz_setVolume||(C._ffz_setVolume=C.setVolume,C._ffz_fakeVolume=()=>{}),m._ffz_maybe_compress=!1;const x=m._ffz_compressed||!1;let $=m._ffz_toggled?m._ffz_state:this.settings.get("player.compressor.default");if(a!=null&&(a.preventDefault(),m._ffz_toggled=!0,$=!m._ffz_compressed,m._ffz_state=$),m._ffz_compressor){if(!m._ffz_comp_reset&&!this.canCompress(e)){m._ffz_comp_reset=!0,this.resetPlayer(e);return}}else{if(!$)return;this.createCompressor(e,m)}let r=m._ffz_gain;const c=u&&this.settings.get("player.gain.enable"),b=r!=null;if(($==x||a==null&&m._ffz_toggled)&&b==c)return;const k=m._ffz_context,h=m._ffz_compressor,M=m._ffz_source;if(!(!k||!h||!M)){if(c&&!r){let L=m._ffz_gain_value;L==null&&(L=this.settings.get("player.gain.default"));try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;r=m._ffz_gain=new GainNode(k,{gain:L})}catch{this.log.info("Unable to use new GainNode. Falling back to old method."),r=m._ffz_gain=k.createGain(),r.gain.value=L}h.connect(r),x&&(h.disconnect(k.destination),r.connect(k.destination))}else!c&&r&&(h.disconnect(r),x&&(r.disconnect(k.destination),h.connect(k.destination)),r=m._ffz_gain=null);$!=x&&($?(M.disconnect(k.destination),M.connect(h),r?(r.connect(k.destination),this.settings.get("player.gain.no-volume")&&(m._ffz_pregain_volume=C.getVolume(),C._ffz_setVolume(1),C.setVolume=C._ffz_fakeVolume)):h.connect(k.destination)):(M.disconnect(h),r?(r.disconnect(k.destination),m._ffz_pregain_volume!=null&&(C._ffz_setVolume(m._ffz_pregain_volume),C.setVolume=C._ffz_setVolume,m._ffz_pregain_volume=null)):h.disconnect(k.destination),M.connect(k.destination))),e.props.containerRef&&(e.props.containerRef.dataset.compressed=$),m._ffz_compressed=$,this.addCompressorButton(e),this.addGainSlider(e)}}updateGainVolume(e){const a=e.props.mediaPlayerInstance,p=a.core||a,C=p?.mediaSinkManager?.video;if(!C||!C._ffz_compressed)return;const m=this.settings.get("player.gain.no-volume");m&&C._ffz_pregain_volume==null?(C._ffz_pregain_volume=p.getVolume(),p._ffz_setVolume(1),p.setVolume=p._ffz_fakeVolume):!m&&C._ffz_pregain_volume!=null&&(p._ffz_setVolume(C._ffz_pregain_volume),p.setVolume=p._ffz_setVolume,C._ffz_pregain_volume=null)}canCompress(e){if(!f)return!1;const a=e.props?.mediaPlayerInstance;if(a==null)return!1;const p=a.mediaSinkManager?.video||a.core?.mediaSinkManager?.video;return!(!p||!p.src&&!p.srcObject||p.src&&new URL(p.src).protocol!=="blob:")}createCompressor(e,a,p){if(!this.canCompress(e))return;let C=a._ffz_compressor;if(!C){if(p=p||new AudioContext,p.state==="suspended"){let x;const $=G(()=>{if(clearTimeout(x),p.removeEventListener("statechange",$),p.state==="suspended"){this.log.debug("Aborting due to browser auto-play policy.");return}this.createCompressor(e,a,p)},"evt");this.log.debug("Attempting to resume suspended AudioContext."),x=setTimeout($,100);try{p.addEventListener("statechange",$),p.resume()}catch{}return}a._ffz_context=p;let m;try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;m=a._ffz_source=new MediaElementAudioSourceNode(p,{mediaElement:a})}catch{this.log.info("Unable to use new MediaElementAudioSourceNode. Falling back to old method."),m=a._ffz_source=p.createMediaElementSource(a)}m.connect(p.destination);try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;C=a._ffz_compressor=new DynamicsCompressorNode(p)}catch{this.log.info("Unable to use new DynamicsCompressorNode. Falling back to old method."),C=a._ffz_compressor=p.createDynamicsCompressor()}if(this.settings.get("player.gain.enable")){let x,$=a._ffz_gain_value;$==null&&($=this.settings.get("player.gain.default"));try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;x=a._ffz_gain=new GainNode(p,{gain:$})}catch{this.log.info("Unable to use new GainNode. Falling back to old method."),x=a._ffz_gain=p.createGain(),x.gain.value=$}C.connect(x)}a._ffz_compressed=!1}this.updateCompressor(null,C)}updateGains(){for(const e of this.Player.instances)this.updateGain(e)}updateGain(e,a,p,C=!0){if(p||(p=e.props.mediaPlayerInstance?.mediaSinkManager?.video||e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video),a==null&&(a=p?._ffz_gain),!p||!a)return;let m=p._ffz_gain_value;m==null&&(m=this.settings.get("player.gain.default")),a.gain.value=m,C&&this.addGainSlider(e)}updateCompressors(){for(const e of this.Player.instances)this.updateCompressor(e)}updateCompressor(e,a){a==null&&(a=(e.props.mediaPlayerInstance?.mediaSinkManager?.video||e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video)?._ffz_compressor),a&&(a.threshold.value=this.settings.get("player.compressor.threshold"),a.knee.value=this.settings.get("player.compressor.knee"),a.ratio.value=this.settings.get("player.compressor.ratio"),a.attack.value=this.settings.get("player.compressor.attack"),a.release.value=this.settings.get("player.compressor.release"))}updatePlaybackRates(){for(const e of this.Player.instances)this.updatePlaybackRate(e)}updatePlaybackRate(e){const a=e.props.mediaPlayerInstance?.mediaSinkManager?.video||e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;a.setFFZPlaybackRate||this.installPlaybackRate(a),a.setFFZPlaybackRate(a.playbackRate)}installPlaybackRate(e){if(e.setFFZPlaybackRate)return;let a=e.playbackRate;const p=this,C=G(()=>{p.settings.get("player.allow-catchup")||Object.defineProperty(e,"playbackRate",{configurable:!0,get(){return a},set(m){(m===1||m<1||m>=1.1)&&e.setFFZPlaybackRate(m)}})},"installProperty");e.setFFZPlaybackRate=m=>{delete e.playbackRate,a=m,e.playbackRate=m,C()}}addPiPButton(e,a=0){const p=e.props.containerRef||this.fine.getChildNode(e),C=e.props.mediaPlayerInstance?.mediaSinkManager?.video||e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,m=C&&document.fullscreenElement&&document.fullscreenElement.contains(C),x=p&&p.querySelector(v),$=document.pictureInPictureEnabled&&this.settings.get("player.button.pip");if(!x)return $&&a<5?setTimeout(this.addPiPButton.bind(this,e,(a||0)+1),250):void 0;let r,c,b,k=x.querySelector(".ffz--player-pip");if(!$){k&&k.remove();return}if(k)r=k.querySelector("figure"),b=k.querySelector("button"),c=k.querySelector(".ffz-il-tooltip");else{k=(0,B.createElement)("div",{class:"ffz--player-pip tw-inline-flex tw-relative ffz-il-tooltip__container"},b=(0,B.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-pip-button",onClick:this.pipPlayer.bind(this,e)},(0,B.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,B.createElement)("div",{class:"tw-button-icon__icon"},r=(0,B.createElement)("figure",{class:"ffz-player-icon"})))),c=(0,B.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));const T=x.querySelector('button[data-a-target="player-theatre-mode-button"]')||x.querySelector('button[aria-label*="Theat"]')||x.querySelector('button[data-a-target="player-fullscreen-button"]');T?x.insertBefore(k,T.parentElement):x.appendChild(k)}const h=!!document.pictureInPictureElement,M=!1,L=m?this.i18n.t("player.pip_button.fs","Cannot use Picture-in-Picture when Fullscreen"):M?this.i18n.t("player.pip_button.swap","Switch Picture-in-Picture"):h?this.i18n.t("player.pip_button.off","Exit Picture-in-Picture"):this.i18n.t("player.pip_button","Picture-in-Picture");r.classList.toggle("ffz-i-t-pip-inactive",!h||M),r.classList.toggle("ffz-i-t-pip-active",h&&!M),b.setAttribute("aria-label",L),c.textContent=L}pipPlayer(e,a){const p=e.props.mediaPlayerInstance?.mediaSinkManager?.video||e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;!p||!document.pictureInPictureEnabled||(a&&a.preventDefault(),!(document.fullscreenElement&&document.fullscreenElement.contains(p))&&(p._ffz_pip_enter||(p.addEventListener("enterpictureinpicture",p._ffz_pip_enter=()=>{this.addPiPButton(e)}),p.addEventListener("leavepictureinpicture",p._ffz_pip_exit=()=>{this.addPiPButton(e)})),document.pictureInPictureElement?document.exitPictureInPicture():p.requestPictureInPicture()))}addClipButton(e,a=0){const p=e.props.containerRef||this.fine.getChildNode(e),C=p&&p.querySelector(v),m=this.settings.get("player.clip-button.custom");if(!C)return m&&a<5?setTimeout(this.addClipButton.bind(this,e,(a||0)+1),250):void 0;let x,$,r=C.querySelector(".ffz--player-clip");if(!m){r&&r.remove();return}if((!C.ffz_native_clip||!C.contains(C.ffz_native_clip))&&(C.ffz_native_clip=n(C)),r)$=r.querySelector("button"),x=r.querySelector(".ffz-il-tooltip");else{const k=G(M=>{const L=n(C);L&&L.click()},"on_click");r=(0,B.createElement)("div",{class:"ffz--player-clip tw-inline-flex tw-relative ffz-il-tooltip__container"},$=(0,B.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-clip-button",onClick:k},(0,B.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,B.createElement)("div",{class:"tw-button-icon__icon"},(0,B.createElement)("figure",{class:"ffz-player-icon ffz-i-clip"})))),x=(0,B.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));const h=C.querySelector(".ffz--player-reset button")||C.querySelector(".ffz--player-pip button")||C.querySelector('button[data-a-target="player-theatre-mode-button"]')||C.querySelector('button[aria-label*="Theat"]')||C.querySelector('button[data-a-target="player-fullscreen-button"]');h?C.insertBefore(r,h.parentElement):C.appendChild(r)}const c=C.ffz_native_clip,b=c?c.disabled||c.ariaDisabled==="true":!1;$.disabled=b,$.setAttribute("aria-label",x.textContent=b?c.ariaLabel||this.i18n.t("player.clip-button.disabled","Clips are Disabled"):this.i18n.t("player.clip-button","Clip (Alt+X)"))}clickClip(e,a){console.log("clicked clip",e,a)}addResetButton(e,a=0){const p=e.props.containerRef||this.fine.getChildNode(e),C=p&&p.querySelector(v),m=this.settings.get("player.button.reset");if(!C)return m&&a<5?setTimeout(this.addResetButton.bind(this,e,(a||0)+1),250):void 0;let x,$,r=C.querySelector(".ffz--player-reset");if(!m){r&&r.remove();return}if(r)$=r.querySelector("button"),x=r.querySelector(".ffz-il-tooltip");else{r=(0,B.createElement)("div",{class:"ffz--player-reset tw-inline-flex tw-relative ffz-il-tooltip__container"},$=(0,B.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-reset-button",onClick:l,onDblClick:this.resetPlayer.bind(this,e)},(0,B.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,B.createElement)("div",{class:"tw-button-icon__icon"},(0,B.createElement)("figure",{class:"ffz-player-icon ffz-i-t-reset"})))),x=(0,B.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));const c=C.querySelector(".ffz--player-pip button")||C.querySelector('button[data-a-target="player-theatre-mode-button"]')||C.querySelector('button[aria-label*="Theat"]')||C.querySelector('button[data-a-target="player-fullscreen-button"]');c?C.insertBefore(r,c.parentElement):C.appendChild(r)}$.setAttribute("aria-label",x.textContent=this.i18n.t("player.reset_button","Reset Player (Double-Click)"))}addErrorResetButton(e,a=0){const p=e.props.containerRef||this.fine.getChildNode(e),C=p&&p.querySelector(".content-overlay-gate"),m=this.settings.get("player.button.reset");if(!C){if(!m)return;a<2&&this.parent.awaitElement(".autoplay-vod__content-container button",this.props.containerRef||t.fine.getChildNode(this),1e3).then(()=>{this.addErrorResetButton(e,(a||0)+1)}).catch(()=>{this.log.warn("Unable to find container element for Error Reset button.")});return}let x,$,r=C.querySelector(".ffz--player-reset");if(!m){r&&r.remove();return}r?($=r.querySelector("button"),x=r.querySelector(".ffz-il-tooltip")):(r=(0,B.createElement)("div",{class:"ffz--player-reset tw-absolute tw-bottom-0 tw-right-0 ffz-il-tooltip__container tw-mg-1"},$=(0,B.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-reset-button",onClick:l,onDblClick:this.resetPlayer.bind(this,e)},(0,B.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,B.createElement)("div",{class:"tw-button-icon__icon"},(0,B.createElement)("figure",{class:"ffz-player-icon ffz-i-t-reset"})))),x=(0,B.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"})),C.appendChild(r)),$.setAttribute("aria-label",x.textContent=this.i18n.t("player.reset_button","Double-Click to Reset Player"))}resetAllPlayers(){for(const e of this.Player.instances)this.resetPlayer(e)}async resetPlayer(e,a){const p=e?e.mediaSinkManager||e.core?.mediaSinkManager?e:e?.props?.mediaPlayerInstance:null;if(a){a.preventDefault();const r=a.currentTarget,c=r&&r.querySelector("figure");if(c){if(c.classList.contains("loading"))return;c.classList.toggle("ffz-i-t-reset",!0),c.classList.toggle("ffz-i-t-reset-clicked",!1),c.classList.toggle("loading",!0),c._ffz_unspin=setTimeout(()=>{c._ffz_unspin=null,c.classList.toggle("loading",!1)},1e4)}}const C=p.getDuration?.()??1/0;let m=-1;const x=p.core||p;x._ffz_setVolume&&(x.setVolume=x._ffz_setVolume),isFinite(C)&&!isNaN(C)&&C>0&&(m=p.getPosition());const $=p.mediaSinkManager?.video||p.core?.mediaSinkManager?.video;if($?._ffz_compressor&&p.attachHTMLVideoElement){const r=this.replaceVideoElement(p,$);r._ffz_maybe_compress=!0}this.PlayerSource.check();for(const r of this.PlayerSource.instances)(!p||p===r.props?.mediaPlayerInstance)&&await r.setSrc({isNewMediaPlayerInstance:!1});m>0&&setTimeout(()=>p.seekTo(m),250)}addMetadata(e){this.metadata&&(e._ffz_md_update||(e._ffz_md_update=(0,R.debounce)(()=>requestAnimationFrame(()=>this._updateMetadata(e)),1e3,2)),e._ffz_md_update())}wantsMetadata(){return!1}_updateMetadata(e){e._ffz_cont&&!document.contains(e._ffz_cont)&&(e._ffz_cont=null);const a=this.wantsMetadata(e);if(!e._ffz_cont){if(!a)return;const p=e.props.containerRef||this.fine.getChildNode(e),C=p&&p.querySelector(v);if(!C)return;e._ffz_cont=(0,B.createElement)("div",{class:"ffz--player-meta-tray"}),C.insertBefore(e._ffz_cont,C.firstElementChild)}if(!a){e._ffz_cont.remove(),e._ffz_cont=null;return}this.updateMetadata(e)}updateMetadata(e,a){const p=e._ffz_cont;if(!p||!document.contains(p))return;a?Array.isArray(a)||(a=[a]):a=this.metadata.keys;const C=this.getData(),m=C?.props?.data?.user,x=e._ffz_meta_timers=e._ffz_meta_timers||{},$=G(c=>this.updateMetadata(e,c),"refresh_fn"),r={channel:{id:m?.id,login:C?.props?.channelLogin,display_name:m?.displayName,live:m?.stream?.id!=null,live_since:m?.stream?.createdAt},inst:e,source:C,getViewerCount:()=>0,getUserSelfImmediate:()=>null,getUserSelf:()=>null,getBroadcastID:()=>m?.id?this.getBroadcastID(e,m.id):null};for(const c of a)this.metadata.renderPlayer(c,r,p,x,$)}getUptime(e){let C=this.getData()?.props?.data?.user?.stream?.createdAt;return C?(C instanceof Date||(C=new Date(C)),(Date.now()-C.getTime())/1e3):null}getBroadcastID(e,a){if(!this.twitch_data)return Promise.resolve(null);const p=e._ffz_bcast_cache=e._ffz_bcast_cache||{};return a===p.channel_id&&Date.now()-p.saved<6e4?Promise.resolve(p.broadcast_id):new Promise(async(C,m)=>{if(p.updating){p.updating.push([C,m]);return}p.channel_id=a,p.updating=[[C,m]];let x,$;try{x=await this.twitch_data.getBroadcastID(a)}catch(c){x=null,$=c}const r=p.updating;if(p.updating=null,p.channel_id!==a){$=new Error("Outdated"),p.channel_id=null,p.broadcast_id=null,p.saved=0;for(const c of r)c[1]($);return}p.broadcast_id=x,p.saved=Date.now();for(const c of r)$?c[1]($):c[0](x)})}get playerUI(){return this.fine.searchTree(this.Player.first,a=>a.props&&a.props.uiContext,150)?.props?.uiContext}get current(){for(const e of this.Player.instances)if(e?.props?.mediaPlayerInstance)return e.props.mediaPlayerInstance;return null}};G(_,"PlayerBase");let w=_},89196:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>x});var W=d(33612),B=d(22527),R=d(46949),I=d(24431);const U=Symbol("FFZRequires"),z={};function v(O){return z[O]||(z[O]=new RegExp(`\\b(?<!\\.)${O}\\(([0-9e_+]+)\\)`,"g")),z[O]}G(v,"getRequireRegex");const f=["webpackJsonp","webpackChunktwitch_twilight","webpackChunktwitch_sunlight","webpackJsonp_N_E"],u=[[0,"vendor"],[1,"core"]];let y=0;const b=class b extends B.default{constructor(...P){super(...P),this._id=`_ffz$${y++}`,this._rid=0,this._original_loader=null,this._known_rules={},this._require=null,this._chunk_names={},this._mod_cache={},this._checked_module={},this._required_ids=new Set,this._known_ids=new Set,this.Requires=U,this.v4=null,this.hookLoader(),this.hookRequire()}waitForLoader(){if(this._original_loader)return Promise.resolve();const P=this._load_waiters=this._load_waiters||[];return new Promise((j,Z)=>P.push([j,Z]))}_resolveLoadWait(P){const j=this._load_waiters;if(this._load_waiters=null,j)for(const Z of j)Z[P?1:0]()}hookLoader(P=0){if(this._original_loader)return this.log.warn("Attempted to call hookLoader twice.");let j;for(const q of f)if(window[q]){j=q;break}if(!j){if(P>240){this.log.error("Unable to find webpack's loader after one minute.");try{const q=[];for(const X of Object.keys(window))(0,R.has)(window,X)&&typeof X=="string"&&/webpack/i.test(X)&&!/ffz/i.test(X)&&q.push(X);q.length?this.log.info("Possible Matches: ",q.join(", ")):this.log.info("No possible matches found.")}catch{}this._resolveLoadWait(!0);return}return setTimeout(this.hookLoader.bind(this,P+1),250)}const Z=window[j];if(typeof Z=="function"){this.v4=!1,this._original_loader=Z;try{window[j]=this.webpackJsonpv3.bind(this)}catch{this.log.warn("Unable to wrap webpackJsonp due to write protection."),this._resolveLoadWait(!0);return}}else if(Array.isArray(Z)){this.v4=!0,this._original_store=Z,this._original_loader=Z.push;for(const q of Z)q&&q[1]&&this.processModulesV4(q[1],!0);try{Z.push=this.webpackJsonpv4.bind(this)}catch{this.log.warn("Unable to wrap webpackJsonp (v4) due to write protection."),this._resolveLoadWait(!0);return}}else{this.log.error("webpackJsonp is of an unknown value. Unable to wrap."),this._resolveLoadWait(!0);return}this._resolveLoadWait(),this.log.info(`Found and wrapped webpack's loader after ${(P||0)*250}ms.`)}webpackJsonpv3(P,j){const Z=P.map(X=>this._chunk_names[X]||X).join(", ");this.log.verbose(`Twitch Chunk Loaded: ${P} (${Z})`),this.log.verbose(`Modules: ${Object.keys(j)}`);const q=this._original_loader.apply(window,arguments);return this.emit(":loaded",P,Z,j),q}_resolveRequire(P){if(!this._require&&(this._require=P,this._resolve_require)){for(const j of this._resolve_require)j(P);this._resolve_require=null}}processModulesV4(P){const j=this;for(const[Z,q]of Object.entries(P))this._known_ids.add(Z)}webpackJsonpv4(P){const j=P[0],Z=P[1],q=Array.isArray(j)&&j.map(ee=>this._chunk_names[ee]||ee);this.log.verbose(`Twitch Chunk Loaded: ${j} (${q.join(", ")})`),this.log.verbose(`Modules: ${Object.keys(Z)}`),Z&&this.processModulesV4(Z,!1);for(const[ee,te]of Object.entries(this._checked_module))te==!0&&(this._checked_module[ee]=null);const X=this._original_loader.apply(this._original_store,arguments);return this.emit(":loaded",j,q,Z),X}known(P,j){if(typeof P=="object"){for(const Z in P)(0,R.has)(P,Z)&&this.known(Z,P[Z]);return}this._known_rules[P]=j}async findModule(P,j){return this._require||await this.getRequire(),this.getModule(P,j)}findDeep(P,j,Z=!0){if(P&&!Array.isArray(P)&&(P=[P]),!this._require||!this.v4||!this._original_store)return new Error("We do not have webpack");const q=[],X=this._chunk_names;for(const[ee,te]of this._original_store){if(P){let ne=!1;for(const pe of ee)if(P.includes(pe)||P.includes(`${pe}`)||X[pe]&&P.includes(X[pe])){ne=!0;break}if(!ne)continue}for(const ne of Object.keys(te))try{const pe=this._require(ne);for(const oe in pe)if(pe[oe]&&j(pe[oe],pe,oe)){if(this.log.info(`Found in key "${oe}" of module "${ne}" (${this.chunkNameForModule(ne)})`),!Z)return pe;q.push(pe);break}}catch(pe){this.log.warn("Exception while deep scanning webpack.",pe)}}return q.length?q:(this.log.info("Unable to find deep scan target."),null)}getModule(P,j){if(typeof P=="function"&&(j=P,P=null),P&&this._mod_cache[P])return this._mod_cache[P];const Z=this._require;if(!Z)return null;if(j||(j=this._known_rules[P]),!j)throw new Error(`no known predicate for locating ${P}`);if(Z.c)return this._oldGetModule(P,j,Z);if(Z.m)return this._newGetModule(P,j,Z)}_chunksForModule(P){if(!this.v4||!this._original_store)return null;const j=new Set;for(const[Z,q]of this._original_store)if(q[P])for(const X of Z)j.add(X);return[...j]}chunkNameForModule(P){const j=this._chunksForModule(P);if(!j)return null;for(const Z of j){const q=this._chunk_names[Z];if(q)return q}return null}chunkNamesForModule(P){const j=this._chunksForModule(P);return j?j.map(Z=>this._chunk_names[Z]||Z):null}_oldGetModule(P,j,Z){if(!Z||!Z.c)return null;let q;if(this._original_store&&j.chunks&&this._chunk_names&&Object.keys(this._chunk_names).length){const ee=typeof j.chunks=="function";!ee&&!Array.isArray(j.chunks)&&(j.chunks=[j.chunks]);const te=j.chunks,ne=this._chunk_names;q=[];for(const[pe,oe]of this._original_store){let de=!1;for(const me of pe)if(ee?te(ne[me],me):te.includes(me)||te.includes(String(me))||ne[me]&&te.includes(ne[me])){de=!0;break}de&&(q=[...q,...Object.keys(oe)])}q=new Set(q)}else q=Object.keys(Z.c);let X=0;for(const ee of q)if((0,R.has)(Z.c,ee)){X++;const te=Z.c[ee],ne=te&&te.exports;if(ne){const pe=j(ne);if(pe){this.log.debug(`[Old] Located module "${P}" in module ${ee}${I.DEBUG?` (${this.chunkNameForModule(ee)})`:""} after ${X} tries`);const oe=j.use_result?pe:ne;return P&&(this._mod_cache[P]=oe),oe}}}return this.log.debug(`[Old] Unable to locate module "${P}" despite checking ${X} modules`),null}_newGetModule(P,j,Z){if(!Z)return null;let q=this._known_ids;if(this._original_store&&j.chunks&&this._chunk_names&&Object.keys(this._chunk_names).length){const ee=typeof j.chunks=="function";!ee&&!Array.isArray(j.chunks)&&(j.chunks=[j.chunks]);const te=j.chunks,ne=this._chunk_names;q=[];for(const[pe,oe]of this._original_store){let de=!1;for(const me of pe)if(ee?te(ne[me],me):te.includes(me)||te.includes(String(me))||ne[me]&&te.includes(ne[me])){de=!0;break}de&&(q=[...q,...Object.keys(oe)])}q=new Set(q)}let X=0;for(const ee of q)try{if(X++,!this._required_ids.has(ee)){let ne=this._checked_module[ee];if(ne==null&&(ne=this._checkModule(ee)),ne)continue}this._required_ids.add(ee),Z.m[ee]||this.log.warn("Tried requiring module that isn't loaded",ee);const te=Z(ee);if(te){const ne=j(te);if(ne){this.log.debug(`Located module "${P}" in module ${ee}${I.DEBUG?` (${this.chunkNameForModule(ee)})`:""} after ${X} tries`);const pe=j.use_result?ne:te;return P&&(this._mod_cache[P]=pe),pe}}}catch(te){this.log.warn("Unexpected error trying to find module",te)}return this.log.debug(`Unable to locate module "${P}" despite checking ${X} modules`),null}_checkModule(P,j=null){if(j){if(j.has(P))return this._checked_module[P]??!1;j.add(P)}let Z=this._require?.m?.[P];if(Z){Z.original&&(Z=Z.original);let q=Z[U],X=!1;if(q==null){const ee=Z.toString(),te=/^function\([^,)]+,[^,)]+,([^,)]+)/.exec(ee);if(te){const ne=v(te[1]);q=Z[U]=new Set,ne.lastIndex=0;let pe;for(;pe=ne.exec(ee);){let oe=pe[1];if(oe!=="e"){if(/^\d+e\d+$/.test(oe)){const de=oe.split("e");oe=`${parseInt(de[0],10)*10**parseInt(de[1],10)}`}q.add(oe),!X&&!this._require.m[oe]&&(this.log.verbose(`Unable to load module ${P} due to missing dependency ${oe}`),X=!0)}}}else Z[U]=!1}else if(q){for(const ee of q)if(!this._require.m[ee]){X=!0;break}}if(!X&&q){j||(j=new Set,j.add(P));for(const ee of q){let te=this._checked_module[ee];if(te==null&&!j.has(ee))try{te=this._checkModule(ee,j)}catch{this.log.verbose(`Recursion error checking module ${P} (${ee})`),te=!0}if(te){this.log.verbose(`Unable to load module ${P} due to unable to load dependency ${ee}`),X=!0;break}}}return this._checked_module[P]=X}return this._checked_module[P]=!0}getRequire(P=0){return this._require?Promise.resolve(this._require):new Promise((j,Z)=>{let q=this._original_loader;if(!q)return P>500&&Z(new Error("unable to find webpackJsonp")),setTimeout(()=>this.getRequire(P++).then(j),250);this.v4&&(q=q.bind(this._original_store));const X=`ffz-loader$${(0,R.generateUUID)()}`;q([[X],{[X]:(ee,te,ne)=>{j(this._require=ne)}},ee=>ee(X)])})}async hookRequire(){const P=performance.now(),j=await this.getRequire(),Z=performance.now()-P;this.log.info(`require() grabbed in ${Z.toFixed(5)}ms.`);const q=j.e&&j.e.toString();let X;if(q&&q.indexOf("Loading chunk")!==-1){const ee=this.v4?/assets\/"\+\(?({1:.*?})/.exec(q):/({0:.*?})/.exec(q);if(ee)try{X=JSON.parse(ee[1].replace(/(\d+):/g,'"$1":'))}catch{}}else if(j.u){const ee=j.u.toString(),te=/assets\/"\+\(?({\d+:.*?})/.exec(ee),ne=te?te[1].replace(/([\de]+):/g,(pe,oe)=>{if(/^\d+e\d+$/.test(oe)){const de=oe.split("e");oe=parseInt(de[0],10)*10**parseInt(de[1],10)}return`"${oe}":`}):null;if(ne)try{X=JSON.parse(ne)}catch(pe){console.log(ne),console.log(pe)}}if(X){if(this._original_store)for(const[ee,te]of u){const ne=this._original_store[ee]?.[0];if(Array.isArray(ne))for(const pe of ne)typeof pe!="object"&&!X[pe]&&(X[pe]=te)}this._chunk_names=X,this.log.debug(`Loaded names for ${Object.keys(X).length} chunks from require().`)}else this.log.warn("Unable to find chunk names in require().")}};G(b,"WebMunch");let S=b;S.Requires=U;var n=d(17159);const k=class k extends B.default{constructor(P,j){super(P,j),this._pruneLive=this._pruneLive.bind(this),this._wrappers=new Map,this._observer=null,this._watching=new Set,this._live_watching=null}onDisable(){this._stopWatching()}define(P,j,Z,q=null,X=0,ee=5e3,te=!0){if(this._wrappers.has(P))return this._wrappers.get(P);if(!j||typeof j!="string"||!j.length)throw new Error("cannot find definition and no selector provided");const ne=new l(P,j,Z,q,X,ee,te,this);return this._wrappers.set(P,ne),ne}route(P){this._route=P,this._timer=Date.now(),this._updateLiveWatching(),this.checkAll(),this.cleanAll()}cleanAll(){this._clean_all&&cancelAnimationFrame(this._clean_all),this._clean_all=requestAnimationFrame(()=>{this._clean_all=null;for(const P of this._wrappers.values())P.clean()})}checkAll(){if(this._watching)for(const P of this._watching)P.check()}updateTimeout(){this._timer=Date.now(),this._updateLiveWatching(),this.checkAll()}_isActive(P,j){return!(P.routes===!1||this._route&&P.routes.length&&!P.routes.includes(this._route)||P.timeout>0&&j-this._timer>P.timeout)}_updateLiveWatching(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null);const P=this._live_watching=[],j=Date.now();let Z=Number.POSITIVE_INFINITY;if(this._watching)for(const q of this._watching)this._isActive(q,j)&&(q.timeout>0&&q.timeout<Z&&(Z=q.timeout),P.push(q));isFinite(Z)&&(this._timeout=setTimeout(this._pruneLive,Z)),P.length?this._observer||this._startWatching():this._stopWatching()}_pruneLive(){this._updateLiveWatching()}_checkWatchers(P){if(this._live_watching)for(const j of this._live_watching)j.checkElements(P)}_startWatching(){!this._observer&&this._live_watching&&this._live_watching.length&&(this.log.info("Installing MutationObserver."),this._observer=new MutationObserver(P=>this._checkWatchers(P.map(j=>j.target))),this._observer.observe(document.body,{childList:!0,subtree:!0}))}_stopWatching(){this._observer&&(this.log.info("Stopping MutationObserver."),this._observer.disconnect()),this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this._live_watching=null,this._observer=null}listen(P,j=!0){this._watching.has(P)||(j&&(this._timer=Date.now()),this._watching.add(P),this._updateLiveWatching())}unlisten(P){this._watching.has(P)&&(this._watching.delete(P),this._updateLiveWatching())}};G(k,"Elemental");let s=k,i=0;const h=class h extends n.EventEmitter{constructor(P,j,Z,q,X,ee,te,ne){super(),this.id=i++,this.param=`_ffz$elemental$${this.id}`,this.remove_param=`_ffz$elemental_remove$${this.id}`,this._schedule=this._schedule.bind(this),this.name=P,this.selector=j,this.routes=Z??[],this.opts=q,this.limit=X,this.timeout=ee,this.check_removal=te,this.opts&&!this.opts.childList&&!this.opts.attributes&&!this.opts.characterData&&(this.opts.attributes=!0),this.count=0,this.instances=new Set,this.elemental=ne,this.check(),this.schedule()}get atLimit(){return this.limit>0&&this.count>=this.limit}clean(){const P=Array.from(this.instances);for(const j of P)document.contains(j)||this.remove(j)}schedule(){this._stimer||(this._stimer=setTimeout(this._schedule,0))}_schedule(){this._stimer&&clearTimeout(this._stimer),this._stimer=null,this.limit===0||this.count<this.limit?this.elemental.listen(this):this.elemental.unlisten(this)}check(){const P=document.querySelectorAll(this.selector);for(const j of P)this.add(j)}checkElements(P){if(this.atLimit)return this.schedule();for(const j of P){const Z=j.querySelectorAll(this.selector);for(const q of Z)this.add(q);if(this.atLimit)return}}get first(){for(const P of this.instances)return P;return null}toArray(){return Array.from(this.instances)}each(P){for(const j of this.instances)P(j)}add(P){if(!this.instances.has(P)){if(this.instances.add(P),this.count++,this.check_removal&&P.parentNode){const j=new MutationObserver(()=>{requestAnimationFrame(()=>{document.contains(P)||this.remove(P)})});j.observe(P.parentNode,{childList:!0}),P[this.remove_param]=j}if(this.opts){const j=new MutationObserver(Z=>{document.contains(P)?this.__running.size||this.emit("mutate",P,Z):this.remove(P)});j.observe(P,this.opts),P[this.param]=j}this.schedule(),this.emit("mount",P)}}remove(P){const j=P[this.param];j&&(j.disconnect(),P[this.param]=null);const Z=P[this.remove_param];Z&&(Z.disconnect(),P[this.remove_param]=null),this.instances.has(P)&&(this.instances.delete(P),this.count--,this.schedule(),this.emit("unmount",P))}};G(h,"ElementalWrapper");let l=h;var w=d(98247),_=d(45866),o=d(29632),e=d(27040);const M=class M extends n.FFZEvent{constructor(P){super(P),this._obj=void 0,this._changed=!1}markChanged(){this._changed=!0}get topic(){return this.event.topic}get message(){return this._obj===void 0&&(this._obj=JSON.parse(this.event.message)??null),this._obj}set message(P){this._obj=P,this._changed=!0}};G(M,"PubSubEvent");let a=M;const L=class L extends B.default{constructor(P,j){super(P,j),this.instance=null}onEnable(P=0){const j=window.__twitch_pubsub_client;if(!j){P>10?this.log.warn("Unable to find PubSub."):new Promise(Z=>setTimeout(Z,50)).then(()=>this.onEnable(P+1));return}j&&(this.instance=j,this.hookClient(j)),this.instance||this.log.warn("Unable to find a PubSub instance.")}handleMessage(P){try{if(P.type==="MESSAGE"&&P.data?.topic){const j=P.data.topic,Z=j.indexOf("."),q=Z===-1?j:j.slice(0,Z),X=Z===-1?"":j.slice(Z+1),ee=new a({prefix:q,trail:X,event:P.data});if(this.emit(":pubsub-message",ee),ee.defaultPrevented)return!0;ee._changed&&(P.data.message=JSON.stringify(ee._obj))}}catch(j){this.log.error("Error processing PubSub event.",j)}return!1}hookClient(P){const j=this,Z=P.onMessage;P.connection.removeAllListeners("message"),P.onMessage=function(ee){if(!j.handleMessage(ee))return Z.call(this,ee)},P.connection.addListener("message",P.onMessage);const q=P.listen,X=P.unlisten;P.ffz_original_listen=q,P.ffz_original_unlisten=X,P.listen=function(ee,te,...ne){const pe=ee.topic,oe=pe&&!!P.topicListeners?._events?.[pe],de=q.call(this,ee,te,...ne);return pe&&!oe&&j.emit(":add-topic",pe),de},P.unlisten=function(ee,te,...ne){const pe=!!P.topicListeners?._events?.[ee],oe=X.call(this,ee,te,...ne);return pe&&!P.topicListeners?._events?.[ee]&&j.emit(":remove-topic",ee),oe}}simulateMessage(P,j){if(!this.instance)throw new Error("No PubSub instance available");this.instance.simulateMessage(P,JSON.stringify(j))}get topics(){const P=this.instance?.topicListeners?._events;return P?Object.keys(P):[]}};G(L,"Subpump");let p=L;var C=d(44589);const m=d.p+"main.css",T=class T extends W.Z{constructor(...P){super(...P),this.inject(S),this.inject(w.Z),this.inject(s),this.inject("router",_.Z),this.inject(o.default,!1),this.inject(e.default),this.inject(p),this._dom_updates=[]}async populateModules(){const P=await d(41152),j=await this.loadFromContext(P,this.log);this.log.info(`Loaded descriptions of ${Object.keys(j).length} modules.`)}async onLoad(){await this.populateModules(),this.web_munch.known(T.KNOWN_MODULES),this.router.route(T.ROUTES),this.router.routeName(T.ROUTE_NAMES),this.router.route("user","/:userName",null,P=>P?.channelView!=="Home"),this.router.route("user-home","/:userName",null,P=>P?.channelView==="Home"),this.router.route(T.DASH_ROUTES,"dashboard.twitch.tv"),this.router.route(T.PLAYER_ROUTES,"player.twitch.tv"),this.router.route(T.CLIP_ROUTES,"clips.twitch.tv")}onEnable(){this.settings=this.resolve("settings"),this.web_munch.findModule("simplebar").then(te=>{!window.ffzSimplebar&&te&&(window.ffzSimplebar=te)}).catch(()=>{});const P=this.fine.searchNode(null,te=>te?.pendingProps?.store?.getState),j=this.store=P?.pendingProps?.store;if(!j)return new Promise(te=>setTimeout(te,50)).then(()=>this.onEnable());this.on(":dom-update",(...te)=>{this._dom_updates.push(te),this._dom_frame||(this._dom_frame=requestAnimationFrame(()=>{const ne=this._dom_updates,pe=this.resolve("core");this._dom_updates=[],this._dom_frame=null;for(const[oe,de]of ne){const me=this.fine.getChildNode(de);pe.emit("core:dom-update",oe,me,de)}}))});const Z=G(()=>this.settings.updateContext({size:{height:window.innerHeight,width:window.innerWidth}}),"update_size");window.addEventListener("resize",Z),Z();const q=G(()=>{this.settings.updateContext({fullscreen:!!document.fullscreenElement}),this.emit(":fullscreen")},"update_fullscreen");document.addEventListener("fullscreenchange",q),this.settings.updateContext({fullscreen:!!document.fullscreenElement}),j.subscribe(()=>this.updateContext()),this.updateContext(),this.router.on(":route",(te,ne)=>{this.log.info("Navigation",te&&te.name,ne&&ne[0]),this.fine.route(te&&te.name),this.elemental.route(te&&te.name),this.settings.updateContext({route:te,route_data:ne})});const X=this.router.current;this.fine.route(X&&X.name),this.elemental.route(X&&X.name),this.settings.updateContext({route:X,route_data:this.router.match}),document.head.appendChild((0,C.createElement)("link",{href:m,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"}));const ee=new URL(window.location).searchParams;if(ee&&(ee.has("ffz-settings")&&this.resolve("main_menu").openExclusive(),ee.has("ffz-translate"))){const te=this.resolve("translation_ui");te.dialog.exclusive=!0,te.enable()}}updateContext(){try{const P=this.store.getState(),j=this.router&&this.router.history;this.settings.updateContext({location:j&&j.location,ui:P&&P.ui,session:P&&P.session,chat:P&&P.chat})}catch(P){this.log.error("Error updating context.",P)}}getSession(){const P=this.store&&this.store.getState();return P&&P.session}getUser(){if(this._user)return this._user;const P=this.getSession();return this._user=P&&P.user}getCore(){return this._core||(this._core=this.web_munch.getModule("core")),this._core}};G(T,"Twilight");let x=T;const $="_calculateChangedBits";x.KNOWN_MODULES={simplebar:O=>O.globalObserver&&O.initDOMLoadedElements,react:O=>O.Component&&O.createElement,"react-dom":O=>O.createRoot&&O.createPortal,core:O=>{if(O.x2?.experiments&&O.x2.intl)return O.x2;if(O.$6?.experiments)return O.$6;if(O.p?.experiments)return O.p;if(O.o?.experiments)return O.o;if(O.q?.experiments)return O.q},cookie:O=>O&&O.set&&O.get&&O.getJSON&&O.withConverter,"extension-service":O=>O.extensionService,"callout-types":O=>{if(O.o?.ClipLiveNudge&&O.o?.Drop&&O.o?.ShareResub)return O.o},"chat-types":O=>{if((0,R.has)(O.ZW,"Message")&&(0,R.has)(O.ZW,"RoomMods"))return{automod:O.sq,chat:O.ZW,message:O.IF,mod:O.RB};if((0,R.has)(O.b,"Message")&&(0,R.has)(O.b,"RoomMods"))return{automod:O.a,chat:O.b,message:O.c,mod:O.e};if((0,R.has)(O.SJ,"Message")&&(0,R.has)(O.SJ,"RoomMods"))return{automod:O.mT,chat:O.SJ,message:O.Ay,mod:O.Aw}},"gql-printer":O=>{if(O!==window){if(O.print&&O.print.toString().includes(".visit"))return O.print;if(O.S&&O.S.toString().includes(".visit"))return O.S}},"user-report":O=>O.Z?.displayName==="Loadable(ReportUserModal)"&&O.Z,"sub-form":O=>typeof O.T=="function"&&String(O.T).includes("CheckoutModal")&&O.T,mousetrap:O=>O.bindGlobal&&O.unbind&&O.handleKey,"algolia-search":O=>{if(O.a?.prototype?.queryTopResults&&O.a.prototype.queryForType)return O.a;if(O.w9?.prototype?.queryTopResults&&O.w9.prototype.queryForType)return O.w9},calloutstack:O=>{if((0,R.has)(O.at?._currentValue,"callouts")&&typeof O.at._currentValue.pinCallout=="function")return{stack:O.at}},highlightstack:O=>{if((0,R.has)(O.g$?._currentValue,"highlights")&&typeof O.SP?._currentValue=="function")return{stack:O.g$,dispatch:O.SP};if((0,R.has)(O.b,$)&&(0,R.has)(O.c,$))return{stack:O.b,dispatch:O.c};if((0,R.has)(O.fQ,$)&&(0,R.has)(O.vJ,$))return{stack:O.fQ,dispatch:O.vJ};if((0,R.has)(O.fQ?._currentValue,"highlights")&&typeof O.vJ?._currentValue=="function")return{stack:O.fQ,dispatch:O.vJ}}};const r=G(O=>!O||O.includes("vendor")||O.includes("core"),"VEND_CORE");x.KNOWN_MODULES.core.use_result=!0,x.KNOWN_MODULES.core.skip_cache=!0,x.KNOWN_MODULES.simplebar.chunks=r,x.KNOWN_MODULES.react.chunks=r,x.KNOWN_MODULES.cookie.chunks=r,x.KNOWN_MODULES["gql-printer"].use_result=!0,x.KNOWN_MODULES["gql-printer"].chunks=r,x.KNOWN_MODULES.mousetrap.chunks=r;const c=G(O=>!O||O.includes("chat"),"CHAT_CHUNK");x.KNOWN_MODULES["callout-types"].use_result=!0,x.KNOWN_MODULES["chat-types"].use_result=!0,x.KNOWN_MODULES["chat-types"].chunks=c,x.KNOWN_MODULES.calloutstack.use_result=!0,x.KNOWN_MODULES.highlightstack.use_result=!0,x.KNOWN_MODULES.highlightstack.chunks=c,x.KNOWN_MODULES["algolia-search"].use_result=!0,x.KNOWN_MODULES["algolia-search"].chunks="core",x.KNOWN_MODULES["user-report"].use_result=!0,x.KNOWN_MODULES["user-report"].chunks=O=>!O||O.includes("core")||O.includes("common"),x.KNOWN_MODULES["sub-form"].use_result=!0,x.KNOWN_MODULES["sub-form"].chunks="core",x.POPOUT_ROUTES=["embed-chat","popout","dash-popout-chat","mod-popout-chat"],x.CHAT_ROUTES=["collection","popout","dash-chat","video","user-video","user-home","user-clip","user-videos","user-clips","user-events","user-followers","user-following","user","dash","embed-chat","squad","command-center","dash-stream-manager","dash-popout-chat","mod-view","mod-popout-chat"],x.ROUTE_NAMES={dir:"Browse","dir-following":"Following","dir-all":"Browse Live Channels",dash:"Dashboard",popout:"Popout Chat","dash-popout-chat":"Dashboard Popout Chat","user-video":"Channel Video","popout-player":"Popout/Embed Player"},x.SUNLIGHT_ROUTES=["dash-stream-manager","dash-channel-analytics","dash-stream-summary","dash-achievements","dash-roles","dash-activity","dash-channel-points","dash-video-producer","dash-edit-video","dash-collections","dash-edit-collection","dash-clips","dash-settings-moderation","dash-settings-channel","dash-settings-revenue","dash-extensions","dash-streaming-tools"],x.PLAYER_ROUTES={"popout-player":"/"},x.CLIP_ROUTES={"clip-page":"/:slug"},x.DASH_ROUTES={"dash-stream-manager":"/u/:userName/stream-manager","dash-channel-analytics":"/u/:userName/channel-analytics","dash-stream-summary":"/u/:userName/stream-summary","dash-achievements":"/u/:userName/achievements","dash-roles":"/u/:userName/community/roles","dash-activity":"/u/:userName/community/activity","dash-channel-points":"/u/:userName/community/channel-points","dash-video-producer":"/u/:userName/content/video-producer","dash-edit-video":"/u/:userName/content/video-producer/edit/:videoID","dash-collections":"/u/:userName/content/collections","dash-edit-collection":"/u/:userName/content/collections/:collectionID","dash-clips":"/u/:userName/content/clips","dash-settings-moderation":"/u/:userName/settings/moderation","dash-settings-channel":"/u/:userName/settings/channel","dash-settings-revenue":"/u/:userName/settings/revenue","dash-extensions":"/u/:userName/extensions","dash-streaming-tools":"/u/:userName/broadcast","dash-popout-chat":"/popout/u/:userName/stream-manager/chat"},x.ROUTES={"front-page":"/",collection:"/directory/collection/:collectionID",dir:"/directory","dir-gaming":"/directory/gaming","dir-irl":"/directory/irl","dir-music":"/directory/music","dir-creative":"/directory/creative","dir-esports":"/directory/esports","dir-following":"/directory/following/:category?","dir-game-index":"/directory/category/:gameName","dir-game-clips":"/directory/category/:gameName/clips","dir-game-videos":"/directory/category/:gameName/videos/:filter","dir-all":"/directory/all/:filter?",dash:"/:userName/dashboard/:live?",event:"/event/:eventName",popout:"/popout/:userName/chat",video:"/videos/:videoID","user-video":"/:userName/video/:videoID","user-videos":"/:userName/videos/:filter?","user-clips":"/:userName/clips","user-clip":"/:userName/clip/:clipID","user-collections":"/:userName/collections","user-events":"/:userName/events","user-followers":"/:userName/followers","user-following":"/:userName/following",product:"/products/:productName",prime:"/prime",turbo:"/turbo",search:"/search",squad:"/:userName/squad","command-center":"/:userName/commandcenter","embed-chat":"/embed/:userName/chat","mod-view":"/moderator/:userName","mod-popout-chat":"/popout/moderator/:userName/chat"},x.DIALOG_EXCLUSIVE=".moderation-root,.sunlight-root,.twilight-main,.twilight-minimal-root>div,#root>div>.tw-full-height,.clips-root,#root",x.DIALOG_MAXIMIZED='.moderation-view-page > div[data-highlight-selector="main-grid"],.sunlight-page,.twilight-main,.twilight-minimal-root,#root .dashboard-side-nav+.tw-full-height,.clips-root>.tw-full-height .scrollable-area,.teams-page-body__outer-container .scrollable-area',x.DIALOG_SELECTOR=".moderation-root,.sunlight-root,#root,.twilight-minimal-root>.tw-full-height,.clips-root>.tw-full-height .scrollable-area"},24531:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>B});var W=d(22527);const R=class R extends W.default{constructor(...U){super(...U),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.settings.add("layout.display-bits-button",{requires:["chat.bits.show"],default:null,process(z,v){return v??z.get("chat.bits.show")},ui:{path:"Appearance > Layout >> Top Navigation",title:"Show the Get Bits button.",description:"By default, this inherits its value from [Chat > Bits and Cheering > Display Bits](~chat.bits_and_cheering)",component:"setting-check-box"},changed:()=>this.BitsButton.forceUpdate()}),this.BitsButton=this.fine.define("bits-button",z=>z.toggleBalloon&&z.toggleShowTutorial)}onEnable(){this.BitsButton.ready(U=>{const z=this,v=U.prototype.render;U.prototype.render=function(){return z.settings.get("layout.display-bits-button")?v.call(this):null},this.BitsButton.forceUpdate()})}};G(R,"BitsButton");let B=R},11746:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>I});var W=d(46949),B=d(22527);const R=["chat-input"],U=class U extends B.default{constructor(...v){super(...v),this.inject("settings"),this.should_enable=!0}onEnable(){this.on("core:dom-update",this.handleDomUpdate,this),this.hookSettings()}awaitSettings(v=0){return window.BetterTTV?.settings?window.BetterTTV.settings:v>100?Promise.reject():(0,W.sleep)(50).then(()=>this.awaitSettings(v+1))}async hookSettings(){const v=await this.awaitSettings(),f=G(()=>this.updateContext(v),"waiter");if(v.on("changed.clickTwitchEmotes",f),v.on("changed.bttvGIFEmotes",f),f(),v.get("ffzEmotes")){if(this.settings.provider.get("bttv-ffz-notice"))return;const u=this.resolve("site.menu_button");u&&(u.addToast({icon:"ffz-i-zreknarf",text_i18n:"compat.bttv.emotes-on",text:`You have "FrankerFaceZ Emotes" turned on in BetterTTV's settings, but you also have FrankerFaceZ installed. Please disable "FrankerFaceZ Emotes" in BetterTTV's settings. It isn't necessary.`}),this.settings.provider.set("bttv-ffz-notice",!0))}}updateContext(v){this.settings.updateContext({bttv:{loaded:!0,emote_menu:v.get("clickTwitchEmotes"),gifs:v.get("bttvGIFEmotes")}})}handleDomUpdate(v){if(window.BetterTTV?.watcher?.emitLoad&&R.includes(v)){this.log.info("Sending chat reload event to BetterTTV.");try{window.BetterTTV.watcher.emitLoad("chat")}catch(f){this.log.error("An error occurred with BetterTTV:",f)}}}};G(U,"BTTVCompat");let I=U},74756:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>z});var W=d(22527),B=d(14873),R=d(46949),I=d(44589);const U=["user","user-home","user-about","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following"],v=class v extends W.default{constructor(...u){super(...u),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site.apollo"),this.inject("site.css_tweaks"),this.inject("site.elemental"),this.inject("site.subpump"),this.inject("site.fine"),this.inject("site.router"),this.inject("site.twitch_data"),this.inject("metadata"),this.inject("socket"),this.inject("pubsub"),this.settings.add("channel.auto-click-off-featured",{default:!1,ui:{path:"Channel > Behavior >> General",title:`Automatically un-check "Featured Clips Only" when viewing a channel's clips.`,component:"setting-check-box"}}),this.settings.add("channel.panel-tips",{default:!1,ui:{path:"Channel > Behavior >> Panels",title:"Display rich tool-tips for links in channel panels.",component:"setting-check-box"},changed:y=>{this.updatePanelTips(),this.css_tweaks.toggle("panel-links",y)}}),this.settings.add("channel.auto-skip-trailer",{default:!1,ui:{path:"Channel > Behavior >> General",title:"Automatically skip channel trailers.",component:"setting-check-box"},changed:y=>{y&&this.ChannelTrailer.each(S=>this.maybeSkipTrailer(S))}}),this.settings.add("channel.auto-click-chat",{default:!1,ui:{path:"Channel > Behavior >> General",title:"Automatically open chat when opening an offline channel page.",component:"setting-check-box"}}),this.settings.add("channel.extra-links",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Add extra links to live channel pages, next to the streamer's name.",component:"setting-check-box"},changed:()=>this.updateLinks()}),this.ChannelPanels=this.fine.define("channel-panels",y=>y.layoutMasonry&&y.updatePanelOrder&&y.onExtensionPoppedOut,U),this.ChannelTrailer=this.elemental.define("channel-trailer",".channel-trailer-player__wrapper",U,{attributes:!0},1),this.ChannelRoot=this.elemental.define("channel-root",".channel-root",U,{attributes:!0},1),this.InfoBar=this.elemental.define("channel-info-bar","#live-channel-stream-information",U,{childNodes:!0,subtree:!0},1)}onEnable(){this.updateChannelColor(),this.css_tweaks.toggle("panel-links",this.settings.get("channel.panel-tips")),this.on("i18n:update",this.updateLinks,this),this.ChannelTrailer.on("mount",this.maybeSkipTrailer,this),this.ChannelTrailer.on("update",this.maybeSkipTrailer,this),this.ChannelTrailer.each(u=>this.maybeSkipTrailer(u)),this.ChannelPanels.on("mount",this.updatePanelTips,this),this.ChannelPanels.on("update",this.updatePanelTips,this),this.ChannelPanels.on("unmount",this.removePanelTips,this),this.ChannelPanels.ready((u,y)=>{for(const S of y)this.updatePanelTips(S)}),this.ChannelRoot.on("mount",this.updateRoot,this),this.ChannelRoot.on("mutate",this.updateRoot,this),this.ChannelRoot.on("unmount",this.removeRoot,this),this.ChannelRoot.each(u=>this.updateRoot(u)),this.InfoBar.on("mount",this.updateBar,this),this.InfoBar.on("mutate",this.updateBar,this),this.InfoBar.on("unmount",this.removeBar,this),this.InfoBar.each(u=>this.updateBar(u)),this.router.on(":route",this.checkNavigation,this),this.checkNavigation()}maybeSkipTrailer(u){if(!this.settings.get("channel.auto-skip-trailer"))return;const y=this.fine.searchParent(u,S=>S.props&&S.props.onDismiss);y&&(this.log.info("Automatically skipping channel trailer."),y.props.onDismiss())}updatePanelTips(u){if(!u){for(const S of this.ChannelPanels.instances)S&&this.updatePanelTips(S);return}const y=this.fine.getChildNode(u);if(!y||!this.settings.get("channel.panel-tips"))return this.removePanelTips(u);if(u._ffz_tips&&u._ffz_tip_el!==y&&this.removePanelTips(u),!u._ffz_tips){const S=this.resolve("tooltips");S&&(u._ffz_tips=S._createInstance(y,"tw-link","link",S.getRoot()),u._ffz_tip_el=y)}}removePanelTips(u){u?._ffz_tips&&(u._ffz_tips.destroy(),u._ffz_tips=null,u._ffz_tip_el=null)}checkFeaturedClips(){this.router.current_name!=="user-clips"&&this.router.current_name!=="user-videos"||this._featured_waiting||!this.settings.get("channel.auto-click-off-featured")||(this._featured_waiting=this.parent.awaitElement("input#featured-clips-toggle").then(u=>{u.checked&&u.click(),this._featured_waiting=!1}).catch(()=>{this._featured_waiting=!1}))}checkNavigation(){this.checkFeaturedClips(),!(!this.settings.get("channel.auto-click-chat")||this.router.current_name!=="user-home")&&this.router.old_location!==this.router.location&&this.router.history.replace(this.router.location,{channelView:"Watch"})}updateLinks(){for(const u of this.InfoBar.instances)u._ffz_link_login=null,this.updateBar(u)}updateSubscription(u,y){this._subbed_login===y&&this._subbed_id===u||(this._subbed_id&&(this.pubsub.unsubscribe(this,`twitch/${this._subbed_id}`),this._subbed_id=null),this._subbed_login&&(this.socket.unsubscribe(this,`channel.${this._subbed_login}`),this._subbed_login=null),u&&(this.pubsub.subscribe(this,`twitch/${u}`),this._subbed_id=u),y&&(this.socket.subscribe(this,`channel.${y}`),this._subbed_login=y))}updateBar(u){u._ffz_update||(u._ffz_update=(0,R.debounce)(()=>requestAnimationFrame(()=>this._updateBar(u)),1e3,2)),u._ffz_update()}_updateBar(u){u._ffz_cont&&!document.contains(u._ffz_cont)&&(u._ffz_cont.classList.remove("ffz--meta-tray"),u._ffz_cont=null);const y=this.settings.get("channel.extra-links");u._ffz_links&&(!document.contains(u._ffz_links)||!y)&&(u._ffz_links.remove(),u._ffz_links=null,u._ffz_link_login=null);let S=u.querySelector(".ffz--native-viewers-container");if(!S){let o=0,e=u.querySelector('p[data-a-target="animated-channel-viewers-count"]');for(;e&&e!=u&&o<5;){if(e.querySelector("svg")){e.classList.add("ffz--native-viewers-container"),S=e;break}e=e.parentElement,o++}}if(!u._ffz_cont){let o=u.querySelector('.report-button,button[data-test-selector="video-options-button"],button[data-test-selector="clip-options-button"],button[data-a-target="report-button-more-button"]');!o&&S&&(o=S.parentElement);let e=o&&(o.closest(".tw-flex-wrap.tw-justify-content-end")||o.closest(".tw-justify-content-end"));!e&&o&&(e=o.parentElement?.parentElement,e&&e.parentElement?.childElementCount===2&&o.dataset.aTarget!=="report-button-more-button"&&(e=e.parentElement.firstElementChild)),e&&u.contains(e)?(u._ffz_cont=e,e.classList.add("ffz--meta-tray")):u._ffz_cont=null}if(!u._ffz_links&&y){const o=u.querySelector("a .tw-title"),e=o&&o.closest("a"),a=e&&e.closest("div");a&&u.contains(a)&&(u._ffz_links=(0,I.createElement)("div",{class:"ffz--links tw-mg-l-1"}),a.appendChild(u._ffz_links))}const n=this.fine.getReactInstance(u);let s=n?.child?.memoizedProps;s?.channelLogin||(s=s?.children?.props);const i=s?.watchPartyProps?.isShowingWatchPartyInMain;if(this.settings.updateContext({isWatchParty:i}),!u._ffz_cont||!s?.channelID){this.updateSubscription(null,null);return}if(u._ffz_links&&s.channelLogin!==u._ffz_link_login){const o=u._ffz_link_login=s.channelLogin;if(o){const e=G((a,p)=>{const C=(0,I.createElement)("a",{href:a,class:"tw-c-text-alt-2 tw-interactive tw-pd-x-1 tw-font-size-5"},p);return C.addEventListener("click",m=>{if(m.ctrlKey||m.shiftKey||m.altKey)return;const x=this.router.history;x&&(m.preventDefault(),x.push(a))}),C},"make_link");u._ffz_links.closest(".home-header-sticky")?u._ffz_links.innerHTML="":(0,I.setChildren)(u._ffz_links,[e(`/${o}/schedule`,this.i18n.t("channel.links.schedule","Schedule")),e(`/${o}/videos`,this.i18n.t("channel.links.videos","Videos")),e(`/${o}/clips`,this.i18n.t("channel.links.clips","Clips"))])}else u._ffz_links.innerHTML=""}let l=null;this.fine.searchNode(n,o=>{let e=o?.memoizedState,a=0;for(;e!=null&&l==null&&a<50;)l=e?.memoizedState?.current?.result?.data?.user??e?.memoizedState?.current?.previousData?.user,l?.lastBroadcast?.game||(l=null),l||(e=e?.next),a++;return l!=null});const w=l?.lastBroadcast?.game,_=l?.lastBroadcast?.title;(w?.id!==u._ffz_game_cache||_!==u._ffz_title_cache)&&this.settings.updateContext({category:w?.displayName,categoryID:w?.id,title:_}),this.updateSubscription(s.channelID,s.channelLogin),this.updateMetadata(u),this.emit(":update-bar",u,s,l)}removeBar(u){if(this.updateSubscription(null,null),u._ffz_cont&&u._ffz_cont.classList.remove("ffz--meta-tray"),u._ffz_cont=null,u._ffz_meta_timers){for(const y of Object.values(u._ffz_meta_timers))clearTimeout(y);u._ffz_meta_timers=null}u._ffz_update=null}updateMetadata(u,y){const S=u._ffz_cont;let s=this.fine.getReactInstance(u)?.memoizedProps?.children?.props;if(s&&!s.channelID&&(s=s.children?.props),!S||!document.contains(S)||!s||!s.channelID)return;y?Array.isArray(y)||(y=[y]):y=this.metadata.keys;const i=u._ffz_meta_timers=u._ffz_meta_timers||{},l=G(_=>this.updateMetadata(u,_),"refresh_fn"),w={channel:{id:s.channelID,login:s.channelLogin,display_name:s.displayName,live:s.isLive&&!s.videoID&&!s.clipSlug,video:!!(s.videoID||s.clipSlug),live_since:s.liveSince},props:s,el:u,getViewerCount:()=>{const _=S.querySelector('p[data-a-target="animated-channel-viewers-count"]'),o=_&&this.fine.getReactInstance(_),e=o?.memoizedProps?.children;if(typeof e=="string"&&/^[0-9,.]+$/.test(e))try{const p=parseInt(e.replace(/,/,""),10);if(!isNaN(p)&&isFinite(p)&&p>0)return p}catch{}const a=e?.props;return a&&a.value!=null?a.value:0},getUserSelfImmediate:_=>{const o=this.getUserSelf(u,s.channelID,!0);return o&&o.then?(o.then(_),null):o},getUserSelf:()=>this.getUserSelf(u,s.channelID),getBroadcastID:()=>this.getBroadcastID(u,s.channelID)};for(const _ of y)this.metadata.renderLegacy(_,w,S,i,l)}updateRoot(u){const y=this.fine.getReactInstance(u);let S=null,n=y,s=0,i=0;for(;n!=null&&S==null&&s<10;){let l=n?.memoizedState;for(i=0;l!=null&&S==null&&i<50;)S=l?.memoizedState?.current?.result?.data?.userOrError??l?.memoizedState?.current?.previousData?.userOrError,S||(l=l?.next),i++;n=n?.return,s++}S&&S.id?(this.updateChannelColor(S.primaryColorHex),this.settings.updateContext({channel:S.login,channelID:S.id,channelColor:S.primaryColorHex})):this.removeRoot()}removeRoot(){this.updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})}updateChannelColor(u){let y=u&&B.Color.RGBA.fromHex(u);y||(y=B.Color.RGBA.fromHex("9147FF")),y?(this.css_tweaks.setVariable("channel-color",y.toCSS()),this.css_tweaks.setVariable("channel-color-20",y._a(.2).toCSS()),this.css_tweaks.setVariable("channel-color-30",y._a(.3).toCSS())):(this.css_tweaks.deleteVariable("channel-color"),this.css_tweaks.deleteVariable("channel-color-20"),this.css_tweaks.deleteVariable("channel-color-30"))}getUserSelf(u,y,S){const n=u._ffz_self_cache=u._ffz_self_cache||{};return y===n.channel_id&&Date.now()-n.saved<6e4?S?n.data:Promise.resolve(n.data):new Promise(async(s,i)=>{if(n.updating){n.updating.push([s,i]);return}n.channel_id=y,n.updating=[[s,i]];let l,w;try{l=await this.twitch_data.getUserSelf(y)}catch(o){l=null,w=o}const _=n.updating;if(n.updating=null,n.channel_id!==y){w=new Error("Outdated"),n.channel_id=null,n.data=null,n.saved=0;for(const o of _)o[1](w);return}n.data=l,n.saved=Date.now();for(const o of _)w?o[1](w):o[0](l)})}getBroadcastID(u,y){const S=u._ffz_bcast_cache=u._ffz_bcast_cache||{};return y===S.channel_id&&Date.now()-S.saved<6e4?Promise.resolve(S.broadcast_id):new Promise(async(n,s)=>{if(S.updating){S.updating.push([n,s]);return}S.channel_id=y,S.updating=[[n,s]];let i,l;try{i=await this.twitch_data.getBroadcastID(y)}catch(_){i=null,l=_}const w=S.updating;if(S.updating=null,S.channel_id!==y){l=new Error("Outdated"),S.channel_id=null,S.broadcast_id=null,S.saved=0;for(const _ of w)_[1](l);return}S.broadcast_id=i,S.saved=Date.now();for(const _ of w)l?_[1](l):_[0](i)})}};G(v,"Channel");let z=v},6172:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>re,formatBitsConfig:()=>ie});var W=d(14873),B=d(46949),R=d(24431),I=d(83342),U=d(6170),z=d(22527),v=d(89196);const f=["touchmove","scroll","wheel","mousewheel","DOMMouseScroll"];let u=0;const fe=class fe extends z.default{constructor(...g){super(...g),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("site"),this.inject("site.fine"),this.inject("site.web_munch"),this.ChatScroller=this.fine.define("chat-scroller",D=>D.saveScrollRef&&D.handleScrollEvent&&!D.renderLines&&D.resume,v.Z.CHAT_ROUTES),this.settings.add("chat.scroller.freeze",{default:0,ui:{path:"Chat > Behavior >> Scrolling",title:"Pause Chat Scrolling",description:`Automatically stop chat from scrolling when moving the mouse over it or holding a key.

**Note:** Scrolling up in chat will always prevent automatic scrolling, regardless of this setting.`,component:"setting-select-box",data:[{value:0,title:"Use Twitch Setting"},{value:1,title:"On Hover"},{value:2,title:"When Ctrl is Held"},{value:3,title:"When Meta is Held"},{value:4,title:"When Alt is Held"},{value:5,title:"When Shift is Held"},{value:6,title:"Ctrl or Hover"},{value:7,title:"Meta or Hover"},{value:8,title:"Alt or Hover"},{value:9,title:"Shift or Hover"}]}}),this.settings.add("chat.scroller.freeze-requires-hover",{default:!0,ui:{path:"Chat > Behavior >> Scrolling",title:"Require the mouse to be over chat to freeze with a hotkey.",component:"setting-check-box"}}),this.settings.add("chat.scroller.hover-delay",{default:750,ui:{path:"Chat > Behavior >> Scrolling",title:"Hover Timeout",description:"Chat will only remain frozen due to mouse hovering for this long after the mouse stops moving.",component:"setting-combo-box",data:[{value:250,title:"0.25 Seconds"},{value:500,title:"0.50 Seconds"},{value:750,title:"0.75 Seconds"},{value:1e3,title:"1 Second"},{value:2500,title:"2.5 Seconds"},{value:5e3,title:"5 Seconds"}]}}),this.settings.add("chat.scroller.smooth-scroll",{default:0,ui:{path:"Chat > Behavior >> Scrolling",title:"Smooth Scrolling",description:`**Note:** This may not behave well depending on your browser. Disable this if you encounter issues.

Smoothly slide new chat messages into view. Speed will increase as necessary to keep up with chat.`,component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Slow"},{value:2,title:"Medium"},{value:3,title:"Fast"},{value:4,title:"Very Fast"}]}})}updateUseKeys(){const g=this.use_keys;this.use_keys=!1;for(const D of this.chat.context.get("chat.actions.inline"))if(D&&D.display&&D.display.keys){this.use_keys=!0;break}for(const D of this.chat.context.get("chat.actions.hover"))if(D&&D.display&&D.display.keys){this.use_keys=!0;break}if(this.use_keys!==g)for(const D of this.ChatScroller.instances)D&&D.ffzUpdateKeys&&D.ffzUpdateKeys()}async onEnable(){this.on("i18n:update",()=>this.ChatScroller.forceUpdate()),this.chat.context.on("changed:chat.actions.inline",this.updateUseKeys,this),this.updateUseKeys(),this.pause_hover=this.chat.context.get("chat.scroller.freeze-requires-hover"),this.chat.context.on("changed:chat.scroller.freeze-requires-hover",H=>{this.pause_hover=H;for(const V of this.ChatScroller.instances)V.ffzMaybeUnpause()}),this.pause_delay=this.chat.context.get("chat.scroller.hover-delay"),this.chat.context.on("changed:chat.scroller.hover-delay",H=>{this.pause_delay=H;for(const V of this.ChatScroller.instances)V.ffzMaybeUnpause()}),this.pause=this.chat.context.get("chat.scroller.freeze"),this.chat.context.on("changed:chat.scroller.freeze",H=>{this.pause=H;for(const V of this.ChatScroller.instances)V.ffzMaybeUnpause()}),this.smooth_scroll=this.chat.context.get("chat.scroller.smooth-scroll"),this.chat.context.on("changed:chat.scroller.smooth-scroll",H=>{this.smooth_scroll=H;for(const V of this.ChatScroller.instances)V.ffzSetSmoothScroll(H)});const g=this,D=await this.site.findReact(),K=D?.createElement;if(!K)return g.log.warn("Unable to get React.");this.ChatScroller.ready((H,V)=>{const E=H.prototype.componentDidCatch,F=H.prototype.render;H.prototype.componentDidCatch=function(A,N){const Y=this.state.ffz_errors||0;if(Y<100&&(this.setState({ffz_errors:Y+1,ffz_total_errors:(this.state.ffz_total_errors||0)+1}),g.log.capture(A,{extra:N}),g.log.info("Error within Chat",A,N,Y)),E)return E.call(this,A,N)},H.prototype.ffzZeroErrors=function(){this.setState({ffz_errors:0})},H.prototype.render=function(){if(this.state.ffz_errors>0){let A;const N=this.state.ffz_total_errors<10,Y=G(()=>{clearTimeout(A),this.ffzZeroErrors()},"handler");return N&&(A=setTimeout(Y,250)),K?K("div",{className:"tw-border-l tw-c-background-alt-2 tw-c-text-base tw-full-width tw-full-height tw-align-items-center tw-flex tw-flex-column tw-justify-content-center tw-relative"},[K("div",{className:"tw-mg-b-1"},"There was an error displaying chat."),!N&&K("button",{className:"tw-button",onClick:Y},K("span",{className:"tw-button__text"},"Try Again"))]):null}else{const A=F.call(this);try{const N=A?.props?.children?.props?.children;N?.[2]?.type?.displayName==="ChatPausedFooter"&&(N[2]=this.ffzRenderFooter())}catch{}return A}},H.prototype.ffzInstallCleaner=function(){this._ffz_cleaner||(this._ffz_cleaner=this.ffzOnClean.bind(this),this._ffz_clean_timer=setInterval(this._ffz_cleaner,6e4))},H.prototype.ffzOnClean=function(){const A=g.fine.getChildNode(this);if(!A)return this.ffzRemoveCleaner();requestAnimationFrame(()=>g.cleanMessages(A.querySelector(".chat-scrollable-area__message-container")))},H.prototype.ffzRemoveCleaner=function(){this._ffz_clean_timer&&clearInterval(this._ffz_clean_timer),this._ffz_clean_timer=this._ffz_cleaner=null},H.prototype.ffzInstallHandler=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const A=this;A.ffz_oldScrollEvent=A.handleScrollEvent,A.ffz_oldScroll=A.scrollToBottom,A.ffz_acting=!1,A.ffz_outside=!0,A._ffz_accessor=`_ffz_contains_${u++}`,g.on("tooltips:hover",this.ffzTooltipHover,this),g.on("tooltips:leave",this.ffzTooltipLeave,this),A.scrollToBottom=function(){A._ffz_scroll_request||(A._ffz_scroll_request=requestAnimationFrame(A._scrollToBottom))},A._scrollToBottom=function(){A._ffz_scroll_request=null,A.state.isPaused||(A.ffz_smooth_scroll&&!A._ffz_one_fast_scroll?A.ffzSmoothScroll():(A._ffz_one_fast_scroll=!1,A.ffz_oldScroll()))},A.handleScrollEvent=function(_e){if(!A.scrollRef?.scrollContent||!(_e.which>0||_e.type==="mousewheel"||_e.type==="wheel"||_e.type==="touchmove"))return;const Q=A.scrollRef.scrollContent,le=Q.scrollHeight-Q.scrollTop-Q.offsetHeight,he=le>10;he!==A.state.ffz_scrolled_up&&A.setState({ffz_scrolled_up:he}),A.state.isPaused&&he&&A.setLoadMoreEnabled(!0),A.state.isPaused&&!he?A.ffzMaybeUnpause():!A.state.isPaused&&he&&A.pause()};const N=A.resume;A.ffzFastResume=function(){A._ffz_one_fast_scroll=!0,A.resume()},A.resume=function(){A.setState({ffz_scrolled_up:!1}),N.call(this)};const Y=g.web_munch.getModule("mousetrap")||window.Mousetrap;Y!=null&&(Y.unbind("alt","keydown"),Y.unbind("alt","keyup")),A.ffzHandleKey=A.ffzHandleKey.bind(A),window.addEventListener("keydown",A.ffzHandleKey),window.addEventListener("keyup",A.ffzHandleKey),A.hoverPause=A.ffzMouseMove.bind(A),A.hoverResume=A.ffzMouseLeave.bind(A);const se=g.fine.getChildNode(A);se&&se.addEventListener("mousemove",A.hoverPause);const ue=this.scrollRef?.scrollContent;if(ue)for(const _e of f)ue.removeEventListener(_e,A.ffz_oldScrollEvent),ue.addEventListener(_e,A.handleScrollEvent);A.forceUpdate(),g.emit("site:dom-update","chat-scroller",A)},H.prototype.ffzSmoothScroll=function(){this._ffz_smooth_animation&&cancelAnimationFrame(this._ffz_smooth_animation),this.ffz_is_smooth_scrolling=!0;let A=this.ffz_smooth_scroll,N=performance.now();const Y=this.scrollRef?.scrollContent;if(!Y)return;const se=Y.scrollHeight-Y.clientHeight,ue=se-Y.scrollTop;ue>Y.clientHeight?A=ue:ue>200&&(A+=A*Math.floor(ue/200));const _e=G(()=>{if(this.state.isPaused)return this.ffz_is_smooth_scrolling=!1;const Q=performance.now(),le=Q-N,he=A*(le/10);if(he>=1){const be=Y.scrollTop,Ce=be+he,ze=Y.scrollHeight-Y.clientHeight;N=Q,Ce<ze?(Y.scrollTop=be+he,this._ffz_smooth_animation=requestAnimationFrame(_e)):(Y.scrollTop=ze,this.ffz_is_smooth_scrolling=!1)}else this._ffz_smooth_animation=requestAnimationFrame(_e)},"smoothAnimation");_e()},H.prototype.ffzSetSmoothScroll=function(A){this.ffz_smooth_scroll=A,this.ffzMaybeUnpause()},H.prototype.ffzReadKeysFromEvent=function(A){return A.altKey===this.ffz_alt&&A.shiftKey===this.ffz_shift&&A.ctrlKey===this.ffz_ctrl&&A.metaKey===this.ffz_meta?!1:(this.ffz_alt=A.altKey,this.ffz_shift=A.shiftKey,this.ffz_ctrl=A.ctrlKey,this.ffz_meta=A.metaKey,!0)},H.prototype.ffzHandleKey=function(A){if(!this.ffzReadKeysFromEvent(A)||(this.ffzUpdateKeyTags(),g.pause_hover&&this.ffz_outside||this.ffzGetMode()<2))return;const N=this.ffzShouldBePaused();N!==this.state.isPaused&&(N?(this.pause(),this.state.ffz_scrolled_up||this.setLoadMoreEnabled(!1)):this.resume())},H.prototype.ffzInstallHoverTimer=function(){this._ffz_hover_timer||(this._ffz_hover_timer=setInterval(()=>{this.state.isPaused&&this.ffzShouldBePaused()||this.ffzMaybeUnpause()},50))},H.prototype.ffzMouseMove=function(A){this.ffz_last_move=Date.now();const N=this.ffz_outside;this.ffz_outside=!1,this._ffz_outside_timer&&(clearTimeout(this._ffz_outside_timer),this._ffz_outside_timer=null);const Y=this.ffzReadKeysFromEvent(A);if(!Y&&A.screenX===this.ffz_sx&&A.screenY===this.ffz_sy){N&&this.ffzUpdateKeyTags();return}this.ffz_sx=A.screenX,this.ffz_sy=A.screenY,(Y||N)&&this.ffzUpdateKeyTags();const se=this.ffzShouldBePaused();se!==this.state.isPaused&&(se?(this.pause(),this.ffzInstallHoverTimer(),this.state.ffz_scrolled_up||this.setLoadMoreEnabled(!1)):this.resume())},H.prototype.ffzMouseLeave=function(){this.ffz_outside=!0,this._ffz_outside_timer&&clearTimeout(this._ffz_outside_timer),this._ffz_outside_timer=setTimeout(()=>this.ffzMaybeUnpause(),64),this.ffzUpdateKeyTags()},H.prototype.ffzTooltipHover=function(A,N,Y){if(A[this._ffz_accessor]==null){const se=this.scrollRef?.scrollContent;A[this._ffz_accessor]=se?se.contains(A):!1}A[this._ffz_accessor]&&this.ffzMouseMove(Y)},H.prototype.ffzTooltipLeave=function(A){if(!this.ffz_outside){if(A[this._ffz_accessor]==null){const N=this.scrollRef?.scrollContent;A[this._ffz_accessor]=N?N.contains(A):!1}A[this._ffz_accessor]&&this.ffzMouseLeave()}},H.prototype.ffzUpdateActing=function(){this._ffz_key_frame_acting||(this._ffz_key_frame_acting=requestAnimationFrame(()=>this.ffz_updateActing()))},H.prototype.ffz_updateActing=function(){this._ffz_key_frame_acting=null,this.scrollRef?.root&&(this.scrollRef.root.dataset.acting=this.ffz_acting)},H.prototype.ffzUpdateKeyTags=function(){this._ffz_key_frame||(this._ffz_key_frame=requestAnimationFrame(()=>this.ffz_updateKeyTags()))},H.prototype.ffz_updateKeyTags=function(){if(this._ffz_key_frame=null,!g.use_keys&&this.ffz_use_keys===g.use_keys||!this.scrollRef?.root)return;this.ffz_use_keys=g.use_keys,this.scrollRef.root.classList.toggle("ffz--keys",g.use_keys);const A=this.scrollRef.root.dataset;g.use_keys?(A.alt=!this.ffz_outside&&this.ffz_alt,A.ctrl=!this.ffz_outside&&this.ffz_ctrl,A.shift=!this.ffz_outside&&this.ffz_shift,A.meta=!this.ffz_outside&&this.ffz_meta):(delete A.alt,delete A.ctrl,delete A.shift,delete A.meta)},H.prototype.ffzShouldBePaused=function(A){if(A==null&&(A=Date.now()-(this.ffz_last_move??Date.now())),this.state.ffz_scrolled_up)return!0;const N=this.ffzGetMode();return(!g.pause_hover||!this.ffz_outside)&&(this.ffz_acting||this.ffz_ctrl&&(N===2||N===6)||this.ffz_meta&&(N===3||N===7)||this.ffz_alt&&(N===4||N===8)||this.ffz_shift&&(N===5||N===9)||!this.ffz_outside&&A<g.pause_delay&&(N===1||N>5))},H.prototype.ffzGetMode=function(){let A=g.pause;if(A===0&&!this.props.mouseoverPausingDisabled){const N=this.props.pauseSetting;N==="MOUSEOVER_ALTKEY"?A=8:N==="MOUSEOVER"?A=1:N==="ALTKEY"&&(A=4)}return A},H.prototype.ffzMaybeUnpause=function(){this.state.isPaused&&!this._ffz_unpause_frame&&(this._ffz_unpause_frame=requestAnimationFrame(()=>{this._ffz_unpause_frame=null,this.state.isPaused&&!this.ffzShouldBePaused()&&this.resume()}))},H.prototype.ffzRenderFooter=function(){let A,N="";if(this.state.ffz_scrolled_up)A=g.i18n.t("chat.messages-below","Chat Paused Due to Scroll");else if(this.state.isPaused){const Y=this.ffzGetMode(),se=this.ffz_acting?g.i18n.t("chat.acting","Taking Action"):Y===2?g.i18n.t("key.ctrl","Ctrl Key"):Y===3?g.i18n.t("key.meta","Meta Key"):Y===4?g.i18n.t("key.alt","Alt Key"):Y===5?g.i18n.t("key.shift","Shift Key"):Y===6?g.i18n.t("key.ctrl_mouse","Ctrl or Mouse"):Y===7?g.i18n.t("key.meta_mouse","Meta or Mouse"):Y===8?g.i18n.t("key.alt_mouse","Alt or Mouse"):Y===9?g.i18n.t("key.shift_mouse","Shift or Mouse"):g.i18n.t("key.mouse","Mouse Movement");A=g.i18n.t("chat.paused","Chat Paused Due to {reason}",{reason:se}),N="ffz--freeze-indicator"}else return K("div",{className:`chat-scroll-footer__placeholder tw-flex tw-justify-content-center tw-relative ${N}`},null);return K("div",{className:`chat-scroll-footer__placeholder tw-flex tw-justify-content-center tw-relative ${N}`},K("div",{className:"tw-absolute tw-border-radius-medium tw-bottom-0 tw-c-background-overlay tw-c-text-overlay tw-mg-b-1"},K("button",{className:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--overlay ffz-core-button--text tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative","data-a-target":"chat-list-footer",onClick:this.ffzFastResume},K("div",{className:"tw-align-items-center ffz-core-button-label tw-flex tw-flex-grow-0"},K("div",{className:"tw-flex-grow-0"},A)))))};for(const A of V)this.onMount(A)}),this.ChatScroller.on("mount",this.onMount,this),this.ChatScroller.on("unmount",this.onUnmount,this)}onMount(g){g.ffzSetSmoothScroll(this.smooth_scroll),g.ffzInstallHandler(),g.ffzInstallCleaner()}onUnmount(g){this.off("tooltips:hover",g.ffzTooltipHover,g),this.off("tooltips:leave",g.ffzTooltipLeave,g),g._ffz_hover_timer&&(clearInterval(g._ffz_hover_timer),g._ffz_hover_timer=null),g._ffz_outside_timer&&(clearTimeout(g._ffz_outside_timer),g._ffz_outside_timer=null),g.ffzRemoveCleaner(),window.removeEventListener("keydown",g.ffzHandleKey),window.removeEventListener("keyup",g.ffzHandleKey)}cleanMessages(g){const D=ffz.site.fine.getReactInstance(g);if(!D||!Array.isArray(D.child?.memoizedProps))return;let K=null,H=D.child,V=0;for(;H&&V<10;){if(H.stateNode instanceof HTMLDivElement){K=H.stateNode;break}H=H.child,V++}if(!K||K.parentElement!==g)return;let E=K.previousElementSibling;for(V=0;E;){const F=E;E=E.previousElementSibling,F.remove(),V++}V>0&&this.log.debug(`Removed ${V} dead chat lines from`,g)}};G(fe,"Scroller");let y=fe;const S="https://static-cdn.jtvnw.net/emoticons/v1/58765/2.0",ge=class ge extends z.default{constructor(...g){super(...g),this.inject("chat"),this.inject("i18n"),this.inject("site"),this.RichContent=null,this.has_tokenizer=!1}async loadTokenizer(){if(!this.has_tokenizer)return this.tokenizer=await Promise.all([d.e(2009),d.e(208)]).then(d.bind(d,30642)),this.has_tokenizer=!0,this.tokenizer}async onEnable(){var H;const g=this,D=await this.site.findReact();if(!D)return;const K=D.createElement;this.RichContent=(H=class extends D.Component{constructor(E){super(E),this.state={loaded:!1,error:!1,has_tokenizer:g.has_tokenizer},g.has_tokenizer||g.loadTokenizer().then(()=>this.setState({...this.state,has_tokenizer:!0}))}async load(E=!1){this.clearRefresh();try{let F=this.props.getData(E);if(F instanceof Promise){const A=(0,B.has)(this.props,"timeout")?this.props.timeout:1e3;A?F=await(0,B.timeout)(F,A):F=await F}if(F||(F={error:{type:"i18n",key:"card.empty",phrase:"No data was returned."}}),F.error&&(F={short:{type:"header",image:{type:"image",url:S},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:F.error}}),F.refresh)try{this.clearRefresh();const A=new Date(F.refresh).getTime(),N=A-Date.now();N>0&&(this._refresh_timer=setTimeout(()=>this.load(!0),N+100*Math.floor(Math.random()*100)))}catch{}this.setState(Object.assign({loaded:!0,url:this.props.url},F))}catch(F){F.message!=="timeout"&&g.log.capture(F),this.setState({has_tokenizer:g.has_tokenizer,loaded:!0,url:this.props.url,short:{type:"header",image:{type:"image",url:S},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:String(F)}})}}clearRefresh(){this._refresh_timer&&(clearTimeout(this._refresh_timer),this._refresh_timer=null)}checkReload(E){(!E||E&&this.props.url===E)&&this.reload()}reload(E=!1){this.clearRefresh(),this.setState({loaded:!1,error:!1,has_tokenizer:g.has_tokenizer},()=>this.load(E))}componentDidMount(){g.on("chat:update-link-resolver",this.checkReload,this),this.load()}componentWillUnmount(){g.off("chat:update-link-resolver",this.checkReload,this),this.clearRefresh()}renderCard(){return this.props.renderBody?this.props.renderBody(this.state,this,K):[this.renderUnsafe(),this.renderBody()]}renderUnsafe(){if(!this.state.unsafe)return null;const E=Array.from(new Set(this.state.urls.map(F=>F.flags).flat())).join(", ").toLowerCase();return K("div",{class:"ffz--corner-flag ffz--corner-flag__warn ffz-tooltip ffz-tooltip--no-mouse","data-title":g.i18n.t("tooltip.link-unsafe","Caution: This URL is has been flagged as potentially harmful by: {reasons}",{reasons:E})},K("figure",{class:"ffz-i-attention"}))}renderBody(){let E;return(this.props.force_full===!0||this.props.force_full!==!1&&this.props.want_full&&this.state.full)&&(E=this.state.full),this.props.force_mid===!0||this.props.force_mid!==!1&&this.props.want_mid&&this.state.mid?E=this.state.mid:E=this.state.short,g.has_tokenizer&&this.state.v&&this.state.v>g.tokenizer.VERSION&&(E=null),g.has_tokenizer&&this.state.loaded&&E?K("div",{class:"ffz-card-rich tw-full-width tw-overflow-hidden tw-flex tw-flex-column"},g.tokenizer.renderTokens(E,K,{vue:!1,tList:(...F)=>g.i18n.tList(...F),i18n:g.i18n,last_player:0,player_state:this.state.player_state,togglePlayer:F=>{const A=this.state.player_state??{};A[F]=!A[F],this.setState({player_state:A})},link_click_handler:g.chat.handleLinkClick,fragments:this.state.fragments,i18n_prefix:this.state.i18n_prefix,allow_media:g.chat.context.get("tooltip.link-images"),allow_unsafe:g.chat.context.get("tooltip.link-nsfw-images")})):this.renderBasic()}renderBasic(){let E,F;return this.state.error?(E=g.i18n.t("card.error","An error occurred."),F=this.state.error):this.state.loaded&&this.state.has_tokenizer?(E=this.state.title,F=this.state.description):F=g.i18n.t("card.loading","Loading..."),!E&&!F&&(F=g.i18n.t("card.empty","No data was returned.")),F=F?F.split(/\n+/).slice(0,2).map(A=>K("div",{class:"tw-c-text-alt-2 tw-ellipsis tw-mg-x-05",title:A},A)):[],[K("div",{class:"ffz--header-image"}),K("div",{class:"ffz--card-text tw-full-width tw-overflow-hidden tw-flex tw-flex-column tw-justify-content-center"},E&&K("div",{class:"chat-card__title tw-ellipsis tw-mg-x-05"},K("span",{class:"tw-strong",title:E},E)),F)]}render(){let E=K("div",{class:"tw-flex tw-flex-nowrap tw-pd-05"},this.renderCard());const F=this.props.card_tooltip&&this.state.full&&!this.props.force_full;return this.state.url&&(E=K("a",{class:`${F?"ffz-tooltip ":""}${this.state.accent?"ffz-accent-card ":""}${this.state.error?"":"ffz-interactable--hover-enabled "}tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--default tw-interactive`,"data-tooltip-type":"link","data-url":this.state.url,"data-is-mail":!1,target:"_blank",rel:"noreferrer noopener",href:this.state.url,onClick:g.chat.handleLinkClick},E)),K("div",{class:`tw-border-radius-medium tw-elevation-1 ffz--chat-card tw-relative${this.state.unsafe?" ffz--unsafe":""}`,style:{"--ffz-color-accent":this.state.accent||null}},K("div",{class:"tw-border-radius-medium tw-c-background-alt tw-flex tw-full-width"},E))}},G(H,"RichContent"),H)}};G(ge,"RichContent");let n=ge;var s=d(83269),i=d(44615);const l={1e3:1,2e3:2,3e3:3},ve=class ve extends z.default{constructor(...g){super(...g),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("site"),this.inject("site.fine"),this.inject(n),this.inject("experiments"),this.inject("chat.actions"),this.inject("chat.overrides"),this.inject("chat.emotes"),this.line_types={},this.line_types.unknown={renderNotice:(D,K,H,V,E)=>`Unknown message type: ${D.ffz_type}`},this.line_types.notice={renderNotice:(D,K,H,V,E)=>{const F=D.ffz_data;let A=this.line_types.notice.renderContent(D,K,H,V,E);if(!F.icon)return A;if(typeof A=="string"&&(A=E("span",{},A)),typeof F.icon=="function")try{A.ffz_icon=F.icon(F,V,E)}catch(N){this.log.capture(N),this.log.error("Error using custom renderer for notice:",N)}else F.icon instanceof URL?A.ffz_icon=E("img",{className:"ffz-notice-icon tw-mg-r-05",src:F.icon.toString()}):A.ffz_icon=E("span",{className:`${F.icon} tw-mg-r-05`});return A},renderContent:(D,K,H,V,E)=>{const F=D.ffz_data;if(F.renderer)try{return F.renderer(F,V,E)}catch(N){return this.log.capture(N),this.log.error("Error using custom renderer for notice:",N),"Error rendering notice."}const A=F.i18n?this.i18n.t(F.i18n,F.messgae,F):F.message;if(F.markdown)return(0,U.e)()?E("span",{dangerouslySetInnerHTML:{__html:(0,U.e)().renderInline(A)}}):((0,U.Z)().then(()=>V.forceUpdate()),"Loading...");if(F.tokenize){const N=F.ffz_tokens=F.ffz_tokens||this.chat.tokenizeMessage({badges:{},message:A,id:D.id,user:D.user,roomLogin:D.roomLogin,roomID:D.roomID});return this.chat.renderTokens(N,E)}return A}},this.line_types.hype={renderNotice:(D,K,H,V,E)=>{if(this.chat.context.get("chat.hype.message-style")===0)return null;const A=D.user,N=D.ffz_tokens=D.ffz_tokens||this.chat.tokenizeMessage(D,K),Y=N.length>0;let se=D.hype_amount;const ue=D.hype_exponent??0;ue>0&&(se/=Math.pow(10,ue));try{se=new Intl.NumberFormat(navigator.languages,{style:"currency",currency:D.hype_currency,compactDisplay:"short",minimumFractionDigits:ue,maximumFractionDigits:ue}).format(se)}catch{se=`${D.hype_currency} ${se}`}return Y?this.i18n.tList("chat.hype-chat","Sent a Hype Chat for {amount}!",{amount:se}):this.i18n.tList("chat.hype-chat.user","{user} sent a Hype Chat for {amount}!",{amount:se,user:E("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},E("span",{className:"tw-c-text-base tw-strong"},A.displayName))})}},this.line_types.cheer={renderNotice:(D,K,H,V,E)=>this.i18n.tList("chat.bits-message","Cheered {count, plural, one {# Bit} other {# Bits}}",{count:D.bits||0})},this.line_types.points={getClass:D=>`ffz--points-line tw-pd-l-1 tw-pd-r-2 ${D.ffz_reward_highlight&&this.chat.context.get("chat.points.allow-highlight")===2?"ffz-custom-color ffz--points-highlight":""}`,renderNotice:(D,K,H,V,E)=>{if(!D.ffz_reward)return null;const F=D.user,A=(0,i.KC)(D.ffz_reward),N=D.ffz_tokens=D.ffz_tokens||this.chat.tokenizeMessage(D,K),Y=N.length>0,se=E("span",{className:"ffz--points-reward"},(0,i.yg)(D.ffz_reward,this.i18n)),ue=E("span",{className:"ffz--points-cost"},[E("span",{className:A?"ffz-i-bits":"ffz--points-icon"}),this.i18n.formatNumber((0,i.at)(D.ffz_reward))]);return Y?this.i18n.tList("chat.points.redeemed","Redeemed {reward} {cost}",{reward:se,cost:ue}):this.i18n.tList("chat.points.user-redeemed","{user} redeemed {reward} {cost}",{reward:se,cost:ue,user:E("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},E("span",{className:"tw-c-text-base tw-strong"},F.displayName))})}},this.line_types.resub={getClass:()=>"ffz--subscribe-line tw-pd-r-2",renderNotice:(D,K,H,V,E)=>{const F=D.sub_cumulative||D.sub_months,A=this.chat.context.get("chat.subs.show");let N;if(A===1&&F>1&&(N=(D.ffz_tokens=D.ffz_tokens||this.chat.tokenizeMessage(D,K)).length>0),!(A===3||A===1&&N&&F>1||A===2&&F>1))return null;const Y=D.user,se=D.sub_plan||{},ue=l[se.plan]||1,_e=D.sub_multi,Q=(_e?.count??0)>1&&_e.tenure===0,le=this.i18n.tList(`chat.sub.main${Q?"-multi":""}`,`{user} subscribed {plan}${Q?" for {multi, plural, one {# month} other {# months}} in advance":""}. `,{user:E("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},E("span",{className:"tw-c-text-base tw-strong"},Y.displayName)),plan:se.prime?this.i18n.t("chat.sub.twitch-prime","with Prime Gaming"):this.i18n.t("chat.sub.plan","at Tier {tier}",{tier:ue}),multi:Q?_e.count:1});return D.sub_share_streak&&D.sub_streak>1?le.push(this.i18n.t("chat.sub.cumulative-months","They've subscribed for {cumulative,number} months, currently on a {streak,number} month streak!",{cumulative:D.sub_cumulative,streak:D.sub_streak})):F>1&&le.push(this.i18n.t("chat.sub.months","They've subscribed for {count,number} months!",{count:F})),this.chat.context.get("chat.subs.compact")||(le.ffz_icon=E("span",{className:`ffz-i-${se.prime?"crown":"star"} tw-mg-r-05`})),le}},this.line_types.ritual={getClass:()=>"ffz--ritual-line tw-pd-r-2",renderNotice:(D,K,H,V,E)=>{const F=D.user;if(D.ritual==="new_chatter")return this.i18n.tList("chat.ritual","{user} is new here. Say hello!",{user:E("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},E("span",{className:"tw-c-text-base tw-strong"},F.displayName))})}},this.line_types.sub_gift={getClass:()=>"ffz--subscribe-line",renderNotice:(D,K,H,V,E)=>{const F=D.user,A=D.sub_plan||{},N=D.sub_months||1,Y=l[A.plan]||1;let se;const ue={months:N,user:D.sub_anon||F.username==="ananonymousgifter"?this.i18n.t("chat.sub.anonymous-gifter","An anonymous gifter"):E("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},E("span",{className:"tw-c-text-base tw-strong"},F.displayName)),plan:A.plan==="custom"?"":this.i18n.t("chat.sub.gift-plan","Tier {tier}",{tier:Y}),recipient:E("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,"data-user":JSON.stringify(D.sub_recipient)},E("span",{className:"tw-c-text-base tw-strong"},D.sub_recipient.displayName))};return N<=1?se=this.i18n.tList("chat.sub.mystery","{user} gifted a {plan} Sub to {recipient}! ",ue):se=this.i18n.tList("chat.sub.gift-months","{user} gifted {months, plural, one {# month} other {# months}} of {plan} Sub to {recipient}!",ue),D.sub_total===1?se.push(this.i18n.t("chat.sub.gift-first","It's their first time gifting a Sub in the channel!")):D.sub_total>1&&se.push(this.i18n.t("chat.sub.gift-total","They've gifted {count,number} Subs in the channel!",{count:D.sub_total})),this.chat.context.get("chat.subs.compact")||(se.ffz_icon=E("span",{className:`ffz-i-${A.prime?"crown":"star"} tw-mg-r-05`})),se}},this.line_types.sub_mystery={getClass:()=>"ffz--subscribe-line",renderNotice:(D,K,H,V,E)=>{const F=D.mystery;F&&(F.line=V);const A=this.i18n.tList("chat.sub.gift","{user} is gifting {count, plural, one {# Tier {tier} Sub} other {# Tier {tier} Subs}} to {channel}'s community! ",{user:D.sub_anon||D.user.username==="ananonymousgifter"?this.i18n.t("chat.sub.anonymous-gifter","An anonymous gifter"):E("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},E("span",{className:"tw-c-text-base tw-strong"},D.user.displayName)),count:D.sub_count,tier:l[D.sub_plan]||1,channel:D.roomLogin});D.sub_total===1?A.push(this.i18n.t("chat.sub.gift-first","It's their first time gifting a Sub in the channel!")):D.sub_total>1&&A.push(this.i18n.t("chat.sub.gift-total","They've gifted {count} Subs in the channel!",{count:D.sub_total})),V.ffz_click_expand||(V.ffz_click_expand=()=>{V.setState({ffz_expanded:!V.state.ffz_expanded})});const N=this.chat.context.get("chat.subs.merge-gifts-visibility")?!V.state.ffz_expanded:V.state.ffz_expanded;let Y=null;if(N&&F&&F.recipients&&F.recipients.length>0){const _e=[];for(const Q of F.recipients)_e.length&&_e.push(", "),_e.push(E("span",{role:"button",className:"ffz--giftee-name",onClick:V.ffz_user_click_handler,"data-user":JSON.stringify(Q)},E("span",{className:"tw-c-text-base tw-strong"},Q.displayName)));Y=E("div",{className:"tw-mg-t-05 tw-border-t tw-pd-t-05 tw-c-text-alt-2"},_e)}const se=[A];F&&se.push(E("span",{className:`tw-pd-l-05 tw-font-size-4 ffz-i-${N?"down":"right"}-dir`}));const ue=[E("div",{className:"tw-full-width tw-c-text-alt-2",onClick:V.ffz_click_expand},se),Y];return this.chat.context.get("chat.subs.compact")||(ue.ffz_icon=E("span",{className:`ffz-i-star${D.sub_anon?"-empty":""} tw-mg-r-05`})),ue.ffz_target=se,ue}},this.ChatLine=this.fine.define("chat-line",D=>D.renderMessageBody&&D.props&&!D.onExtensionNameClick&&!(0,B.has)(D.props,"hasModPermissions"),v.Z.CHAT_ROUTES),this.ExtensionLine=this.fine.define("extension-line",D=>D.renderMessageBody&&D.onExtensionNameClick,v.Z.CHAT_ROUTES),this.WhisperLine=this.fine.define("whisper-line",D=>D.props&&D.props.message&&(0,B.has)(D.props,"reportOutgoingWhisperRendered"))}async onEnable(){this.on("chat.overrides:changed",V=>this.updateLinesByUser(V,null,!1,!1),this),this.on("chat:update-lines-by-user",this.updateLinesByUser,this),this.on("chat:update-line",this.updateLineById,this),this.on("chat:update-lines",this.updateLines,this),this.on("chat:rerender-lines",this.rerenderLines,this),this.on("chat:update-line-tokens",this.updateLineTokens,this),this.on("chat:update-line-badges",this.updateLineBadges,this),this.on("i18n:update",this.rerenderLines,this),this.on("chat.emotes:update-effects",this.checkEffects,this),this.can_reprocess=!0,this.on("chat:reload-data",()=>this.can_reprocess=!0),this.on("chat:room-add",()=>this.can_reprocess=!0),this.on("load_tracker:complete:chat-data",()=>{!this.chat.context.get("chat.update-when-loaded")||!this.can_reprocess||(this.can_reprocess=!1,this.log.info("Reprocessing chat lines due to data loads."),this.updateLines())});for(const V of R.RERENDER_SETTINGS)this.chat.context.on(`changed:${V}`,this.rerenderLines,this);for(const V of R.UPDATE_TOKEN_SETTINGS)this.chat.context.on(`changed:${V}`,this.updateLineTokens,this);for(const V of R.UPDATE_BADGE_SETTINGS)this.chat.context.on(`changed:${V}`,this.updateLineBadges,this);this.chat.context.on("changed:tooltip.link-images",this.maybeUpdateLines,this),this.chat.context.on("changed:tooltip.link-nsfw-images",this.maybeUpdateLines,this),this.on("chat:get-messages",(V,E,F,A)=>{if(V){for(const N of this.ChatLine.instances){const Y=N.props.message;Y&&A.push({message:Y,_instance:N,update:()=>N.forceUpdate()})}for(const N of this.ExtensionLine.instances){const Y=N.props.message;Y&&A.push({message:Y,_instance:N,update:()=>N.forceUpdate()})}}if(E)for(const N of this.WhisperLine.instances){const Y=N.props.message;Y&&Y._ffz_message&&A.push({message:Y._ffz_message,_instance:N,update:()=>N.forceUpdate()})}}),this.on("chat:get-tab-commands",V=>{this.experiments.getTwitchAssignmentByName("chat_replies")!=="control"&&V.commands.push({name:"reply",description:"Reply to a user's last message.",permissionLevel:0,ffz_group:"FrankerFaceZ",commandArgs:[{name:"username",isRequired:!0},{name:"message",isRequired:!1}]})}),this.on("chat:pre-send-message",V=>{if(this.experiments.getTwitchAssignmentByName("chat_replies")==="control")return;const E=V.message,F=this.parent.chat_types||{};let A,N;if(/^\/reply ?/i.test(E))A=E.slice(7).trim();else return;V.preventDefault();const Y=A.indexOf(" ");if(Y!==-1&&(N=A.slice(Y+1),A=A.slice(0,Y)),A.startsWith("@")&&(A=A.slice(1)),A&&A.length){A=A.toLowerCase();const se=Array.from(this.ChatLine.instances);let ue=se.length;for(;ue--;){const _e=se[ue],Q=_e?.props?.message,le=Q?.user;if(le&&(le.login===A||le.displayName?.toLowerCase?.()===A)){N?V.sendMessage(N,{reply:{parentDeleted:Q.deleted||!1,parentDisplayName:le.displayName,parentMessageBody:Q.message,parentMsgId:Q.id,parentUid:le.id,parentUserLogin:le.login}}):requestAnimationFrame(()=>_e.ffzOpenReply());return}}}V.addMessage({type:F.Notice,message:this.i18n.t("chat.reply.bad-user","Invalid user or no known message to reply to.")})});const g=this,D=await this.site.findReact();if(!D)return;const K=D.createElement,H=this.rich_content&&this.rich_content.RichContent;this.WhisperLine.ready(V=>{const E=V.prototype.render;V.prototype.render=function(){if(this._ffz_no_scan=!0,!this.props.message||!this.props.message.content||!this.props.message.from)return E.call(this);try{const F=g.chat.standardizeWhisper(this.props.message),A=F.is_action,N=A?g.chat.context.get("chat.me-style"):0,Y=N>=2,se=N===1||N===3,ue=F.user,_e=g.overrides.getColor(ue.id)||ue.color,Q=g.parent.colors.process(_e),le=F.ffz_tokens=F.ffz_tokens||g.chat.tokenizeMessage(F,null),he=g.chat.renderTokens(le,K),be=g.overrides.getName(ue.id);return K("div",{className:"thread-message__message"},K("div",{className:"tw-pd-x-1 tw-pd-y-05"},[K("span",{className:`thread-message__message--user-name notranslate${be?" ffz--name-override":""}`,style:{color:Q}},be||ue.displayName),K("span",null,A?" ":": "),K("span",{className:`message${Y?" chat-line__message-body--italicized":""}`,style:{color:se&&Q}},he)]))}catch(F){return g.log.error(F),g.log.capture(F,{extra:{props:this.props}}),E.call(this)}},setTimeout(()=>this.WhisperLine.forceUpdate())}),this.ChatLine.ready(V=>{const E=V.prototype.render;V.prototype.shouldComponentUpdate=function(F,A){const N=A&&A.alwaysShowMessage||!F.message.deleted,Y=this._ffz_show;return this._ffz_show=N,N!==Y||A&&this.state&&A.ffz_expanded!==this.state.ffz_expanded||F.deletedMessageDisplay!==this.props.deletedMessageDisplay||F.deletedCount!==this.props.deletedCount||F.message!==this.props.message||F.isCurrentUserModerator!==this.props.isCurrentUserModerator||F.showModerationIcons!==this.props.showModerationIcons||F.showTimestamps!==this.props.showTimestamps||F.pinnedMessage?.message?.id===F.message?.id!=(this.props.pinnedMessage?.message?.id===this.props.message?.id)},V.prototype.ffzOpenReply=function(){if(this.onMessageClick)return this.onMessageClick();if(this.props.reply){this.setOPCardTray(this.props.reply);return}if(this.props.hasReply){const N=this.props.message;if(N?.user){this.setOPCardTray({parentMsgId:N.id,parentUid:N.user.userID,parentUserLogin:N.user.userLogin,parentDeleted:N.deleted,parentDisplayName:N.user.userDisplayName,parentMessageBody:N.messageBody});return}}const F=this.renderMessageAuthor;this.renderMessageAuthor=()=>this.ffzReplyAuthor();const A=this.props.message?.ffz_tokens;A&&(this.setMessageTray(this.props.message,g.chat.renderTokens(A,K)),this.renderMessageAuthor=F)},V.prototype.ffzReplyAuthor=function(){const F=g.chat.standardizeMessage(this.props.message),A=F.user,N=g.overrides.getColor(A.id)||A.color,Y=g.parent.colors.process(N);let se=F.roomLogin?F.roomLogin:F.channel?F.channel.slice(1):void 0,ue=F.roomId?F.roomId:this.props.channelID;if(!se&&ue){const le=g.chat.getRoom(ue,null,!0);le&&le.login&&(se=F.roomLogin=le.login)}if(!ue&&se){const le=g.chat.getRoom(null,ue,!0);le&&le.id&&(ue=F.roomId=le.id)}const _e=g.chat.formatUser(A,K),Q=g.overrides.getName(A.id);return K("span",{"data-room-id":ue,"data-room":se,"data-user-id":A.userID,"data-user":A.userLogin&&A.userLogin.toLowerCase()},[K("span",{className:"chat-line__message--badges"},g.chat.badges.render(F,K)),K("span",{className:`chat-line__username notranslate${Q?" ffz--name-override tw-relative ffz-il-tooltip__container":""}`,role:"button",style:{color:Y},onClick:this.ffz_user_click_handler,onContextMenu:g.actions.handleUserContext},Q?[K("span",{className:"chat-author__display-name"},Q),K("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},_e)]:_e)])},V.prototype.ffzRenderSharedChatPill=function(){let F=g.chat.context.get("chat.shared-chat.style");if(F==null&&(F=this.props.isCurrentUserModerator?2:0),F===0)return null;const A=this.props.message,N=A.sourceRoomID,Y=N&&this.props.sharedChatDataByChannelID?.get(N),se=!Y||N===(A.roomId??this.props.channelID);if(!Y)return null;const ue=g.i18n.t("chat.sent-from-source","Sent from {source}",{source:Y.displayName??Y.login});return F===1?K("span",{className:`ffz-pill ffz-tooltip tw-mg-r-05 ${se?"ffz-pill--brand":""}`,"data-title":ue},`${Y.displayName??Y.login}`):F===2?K("figure",{className:`ffz-tooltip ffz-tooltip--no-mouse ffz-shared-chat-badge ffz-avatar tw-border-radius-rounded ${se?"ffz-shared-chat-badge--active":""} tw-mg-r-05`,"data-title":g.i18n.t("chat.sent-from-source","Sent from {source}",{source:Y.displayName})},K("img",{className:"tw-block tw-border-radius-rounded tw-image",src:Y.profileImageURL,alt:Y.displayName})):null},V.prototype.ffzNewRender=function(){try{this._ffz_no_scan=!0;const F=g.chat.standardizeMessage(this.props.message),A=g.chat.context.get("chat.filtering.display-deleted");let N=this.props.deletedMessageDisplay;if(A?N=A:!this.props.isCurrentUserModerator&&N==="DETAILED"&&(N="LEGACY"),N==="BRIEF"&&F.deleted){const We=this.props.deletedCount;return We==null?null:K("div",{className:"chat-line__status"},g.i18n.t("chat.deleted-messages",`{count,plural,
one {One message was deleted by a moderator.}
other {# messages were deleted by a moderator.}
}`,{count:We}))}const Y=F.sourceRoomID,se=Y&&this.props.sharedChatDataByChannelID?.get(Y);let ue=F.roomLogin?F.roomLogin:F.channel?F.channel.slice(1):void 0,_e=F.roomId?F.roomId:this.props.channelID;if(!ue&&_e){const We=g.chat.getRoom(_e,null,!0);We&&We.login&&(ue=F.roomLogin=We.login)}if(!_e&&ue){const We=g.chat.getRoom(null,ue,!0);We&&We.id&&(_e=F.roomId=We.id)}const Q=g.site.getUser(),le={id:_e,login:ue},he=!se||Y===_e,be=he?le:{id:Y,login:se.login},Ce=g.chat.context.get("chat.replies.style"),ze=this.props&&!!(this.props.hasReply||this.props.reply||!this.props.replyRestrictedReason),Me=ze&&F.message&&!F.deleted&&!this.props.disableReplyClick,ce=Me&&(ze||Q&&Q.login!==F.user?.login);Q&&(Q.moderator=this.props.isCurrentUserModerator,Q.staff=this.props.isCurrentUserStaff,Q.reply_mode=Ce,Q.can_reply=ce),this.ffz_open_reply||(this.ffz_open_reply=this.ffzOpenReply.bind(this)),this.ffz_user_click_handler||(this.props.onUsernameClick?this.ffz_user_click_handler=We=>{if(this.isKeyboardEvent(We)&&We.keyCode!==R.KEYS.Space&&We.keyCode!==R.KEYS.Enter)return;const Ke=We.currentTarget,dt=Ke&&Ke.dataset;let rt=F.user;if(dt&&dt.user)try{rt=JSON.parse(dt.user)}catch{}const vt=g.makeEvent({inst:this,event:We,message:F,user:rt,room:le,source:be});g.emit("chat:user-click",vt),!vt.defaultPrevented&&this.props.onUsernameClick(rt.login,"chat_message",F.id,Ke.getBoundingClientRect().bottom)}:this.ffz_user_click_handler=this.openViewerCard||this.usernameClickHandler);let ye,we,Ae=null,$e=F.ffz_type&&g.line_types[F.ffz_type];if(!$e&&F.bits>0&&g.chat.context.get("chat.bits.cheer-notice")&&($e=g.line_types.cheer),!$e&&F.ffz_type&&($e=g.line_types.unknown),$e){if($e.render)return $e.render(F,Q,le,this,K);$e.renderNotice&&(ye=$e.renderNotice(F,Q,le,this,K)),$e.getClass&&(we=$e.getClass(F,Q,le,this,K))}const Ne=F.user,tt=g.chat.context.get("chat.emotes.animated")===2;Ne&&!Ne.lowerLogin&&Ne.userLogin&&(Ne.lowerLogin=Ne.userLogin.toLowerCase()),we=we||"";let qe,ot,it=null;if(N==="BRIEF"?(qe=!0,ot=!1):N==="DETAILED"?(qe=!0,ot=F.deleted):(qe=this.state?.alwaysShowMessage||!F.deleted,ot=!1),F.deleted){const We=g.chat.context.get("chat.filtering.display-mod-action");if(We===2||We===1&&N==="DETAILED"){const Ke=F.modActionType;Ke==="timeout"?it=g.i18n.t("chat.mod-action.timeout","{duration} Timeout",{duration:(0,s.print_duration)(F.duration||1)}):Ke==="ban"?it=g.i18n.t("chat.mod-action.ban","Banned"):(Ke==="delete"||!Ke)&&(it=g.i18n.t("chat.mod-action.delete","Deleted")),it&&F.modLogin&&(it=g.i18n.t("chat.mod-action.by","{action} by {login}",{login:F.modLogin,action:it})),it&&(it=K("span",{className:"tw-pd-l-05","data-test-selector":"chat-deleted-message-attribution"},`(${it})`))}}let st=null;const pt=g.chat.context.get("chat.filtering.show-reasons");if(F.highlights?.size&&pt){st=[];for(const We of F.highlights){const Ke=g.chat._hl_reasons[We];let dt,rt;Ke&&(rt=Ke.i18n_key?g.i18n.t(Ke.i18n_key,Ke.title):Ke.title,dt=Ke.i18n_label?g.i18n.t(Ke.i18n_label,Ke.label):Ke.label,dt===rt&&(rt=null)),dt||(dt=We),st.push(K("span",{className:`ffz-pill ffz-highlight-tag${Ke?" ffz-tooltip":""}`,"data-title":rt},dt))}st.length>0?st=K("span",{className:`ffz-highlight-tags ${pt===1?"ffz-highlight-tags__above":"tw-mg-r-05"}`},st):st=null}const nt=F.ffz_tokens=F.ffz_tokens||g.chat.tokenizeMessage(F,Q),yt=nt.length>0||!ye;let ht;if(yt){const We=Ce===2||Ce===1&&this.props.repliesAppearancePreference&&this.props.repliesAppearancePreference!=="expanded"?F.ffz_reply=F.ffz_reply||g.chat.tokenizeReply(this.props.reply):null,Ke=g.parent.message_types&&g.parent.message_types.Action===F.messageType,dt=this.props.isLastEmoteGigantified||(0,i._x)(F.ffz_reward),rt=Ke?g.chat.context.get("chat.me-style"):0,vt=rt>=2,bt=rt===1||rt===3,wt=g.overrides.getColor(Ne.id)||Ne.color,Ue=g.parent.colors.process(wt),Be=qe&&H&&g.chat.pluckRichContent(nt,F),at=dt&&g.chat.pluckLastEmote(nt,F),lt=g.chat.formatUser(Ne,K),Qe=g.overrides.getName(Ne.id);let et=F.ffz_user_class;et instanceof Set?et=[...et].join(" "):Array.isArray(et)&&(et=et.join(" "));const Ze=se&&g.chat.context.get("chat.shared-chat.username-tooltip"),Re={className:`chat-line__username notranslate${Qe?" ffz--name-override":""}${Qe||Ze?" tw-relative ffz-il-tooltip__container":""} ${et??""}`,role:"button",style:{color:Ue},onClick:this.ffz_user_click_handler,onContextMenu:g.actions.handleUserContext};F.ffz_user_props&&Object.assign(Re,F.ffz_user_props),F.ffz_user_style&&Object.assign(Re.style,F.ffz_user_style);const je=K("span",Re,Qe?[K("span",{className:"chat-author__display-name"},Qe),K("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},[lt,Ze?K("div",{className:"tw-font-size-8 tw-mg-t-05"},g.i18n.t("chat.sent-from-source","Sent from {source}",{source:se.displayName??se.login})):null])]:Ze?[lt,K("span",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},g.i18n.t("chat.sent-from-source","Sent from {source}",{source:se.displayName??se.login}))]:lt),Ye=this.props.showTimestamps||this.props.isHistorical?K("span",{className:"chat-line__timestamp"},g.chat.formatTime(F.timestamp)):null,Ge=qe&&ze&&We?g.chat.renderTokens(We,K):null,Le=F.ffz_reward_highlight&&g.chat.context.get("chat.points.allow-highlight")===1;ht=[Ce===1&&this.props.reply&&this.props.repliesAppearancePreference&&this.props.repliesAppearancePreference==="expanded"?this.renderReplyLine():null,se?this.ffzRenderSharedChatPill():null,Ye,F.ffz_no_actions?null:g.actions.renderInline(F,this.props.showModerationIcons,Q,le,K,this),this.renderInlineHighlight?this.renderInlineHighlight():null,pt===2?st:null,K("span",{className:"chat-line__message--badges"},g.chat.badges.render(F,K)),je,K("span",{"aria-hidden":!0},Ke?" ":": "),Ge,qe?K("span",{className:`message ${vt?"chat-line__message-body--italicized":""} ${Le?"chat-line__message-body--highlighted":""}`,style:bt?{color:Ue}:null},g.chat.renderTokens(nt,K,Ce!==0&&ze?this.props.reply:null)):K("span",{className:"chat-line__message--deleted"},K("a",{href:"",onClick:this.alwaysShowMessage},g.i18n.t("chat.message-deleted","<message deleted>"))),it,Be?K(H,Be):null,at?K("div",{className:"chat-line__message--ffz-giant-emote"},g.chat.renderGiantEmote(at,K)):null]}let ut;if(ye){const We=Array.isArray(ye.ffz_target);if(ht)We?ye.ffz_icon&&ye.ffz_target.unshift(ye.ffz_icon):ye.ffz_icon&&(ye=[ye.ffz_icon,ye]),ht=K("div",{className:"chat-line--inline chat-line__message","data-room-id":be?.id??F.roomId??le.id,"data-room":be?.login??F.roomLogin,"data-user-id":Ne?.userID,"data-user":Ne?.lowerLogin},ht);else{const Ke=g.chat.context.get("chat.extra-timestamps"),dt=Ke&&(this.props.showTimestamps||this.props.isHistorical)?K("span",{className:"chat-line__timestamp"},g.chat.formatTime(F.timestamp)):null,rt=F.ffz_no_actions?null:g.actions.renderInline(F,this.props.showModerationIcons,Q,le,K,this);We?ye.ffz_target.unshift(se?this.ffzRenderSharedChatPill():null,ye.ffz_icon??null,dt,rt,pt===2?st:null):ye=[se?this.ffzRenderSharedChatPill():null,ye.ffz_icon??null,dt,rt,pt===2?st:null,ye]}we=`${we} ffz-notice-line user-notice-line tw-pd-y-05`,We||(ye=K("div",{className:"tw-c-text-alt-2"},ye)),st&&pt===1?ut=[st,ye,ht??null]:ht?ut=[ye,ht]:ut=ye}else we=`${we} chat-line__message`,st&&pt===1?ut=[st,ht]:ut=ht;const He=Ne&&F.id&&!F.ffz_no_actions?g.actions.renderHover(F,this.props.showModerationIcons,Q,le,K,this):null;return He&&(we=`${we} tw-relative`,ut=[K("div",{className:"chat-line__message-highlight tw-absolute tw-border-radius-medium tw-top-0 tw-bottom-0 tw-right-0 tw-left-0","data-test-selector":"chat-message-highlight"}),K("div",{className:"chat-line__message-container tw-relative"},ut),He]),Ae==null&&(Ae=F.mentioned&&F.mention_color?g.parent.inverse_colors.process(F.mention_color):null),K("div",{className:`${we}${ot?" ffz--deleted-message":""}${F.mentioned?" ffz-mentioned":""}${Ae?" ffz-custom-color":""}`,style:{backgroundColor:Ae},"data-room-id":be?.id??F.roomId??le.id,"data-room":be?.login??F.roomLogin,"data-user-id":Ne?.userID,"data-user":Ne?.lowerLogin,onMouseOver:tt?g.chat.emotes.animHover:null,onMouseOut:tt?g.chat.emotes.animLeave:null},ut)}catch(F){g.log.error(F),g.log.capture(F,{extra:{props:this.props}});try{return console.log("trying old 1"),E.call(this)}catch(A){return g.log.error("An error in Twitch shit.",A),g.log.capture(A,{extra:{props:this.props}}),"An error occurred rendering this chat line."}}},V.prototype.render=V.prototype.ffzNewRender,setTimeout(()=>this.ChatLine.forceUpdate())}),this.ExtensionLine.ready(V=>{const E=V.prototype.render;V.prototype.render=function(){try{if(this._ffz_no_scan=!0,!this.props.installedExtensions)return null;const F=g.chat.standardizeMessage(this.props.message),A=F&&F.extension;if(!A||!this.props.installedExtensions.some(he=>{const be=he.extension;return be&&(be.clientId||be.clientID)===(A.clientId||A.clientID)&&be.version===A.version}))return null;const N=g.parent.colors.process(A.chatColor);let Y=F.roomLogin?F.roomLogin:F.channel?F.channel.slice(1):void 0;if(!Y&&this.props.channelID){const he=g.chat.getRoom(this.props.channelID,null,!0);he&&he.login&&(Y=F.roomLogin=he.login)}const se=g.site.getUser(),ue={id:this.props.channelID,login:Y},_e=F.ffz_tokens=F.ffz_tokens||g.chat.tokenizeMessage(F,se),Q=H&&g.chat.pluckRichContent(_e,F),le=F.mentioned&&F.mention_color?g.parent.inverse_colors.process(F.mention_color):null;return _e.length?K("div",{className:`chat-line__message${F.mentioned?" ffz-mentioned":""}${le?" ffz-custom-color":""}`,style:{backgroundColor:le},"data-room-id":ue.id,"data-room":ue.login,"data-extension":A.clientID},[this.props.showTimestamps&&K("span",{className:"chat-line__timestamp"},g.chat.formatTime(F.timestamp)),K("span",{className:"chat-line__message--badges"},g.chat.badges.render(F,K)),K("span",{className:"chat-line__username notranslate",role:"button",style:{color:N},onClick:this.onExtensionNameClick},K("span",{className:"chat-author__display-name"},A.displayName)),K("span",null,": "),K("span",{className:"message"},g.chat.renderTokens(_e,K)),Q&&K(H,Q)]):null}catch(F){return g.log.info(F),g.log.capture(F,{extra:{props:this.props}}),E.call(this)}},setTimeout(()=>this.ExtensionLine.forceUpdate())})}checkEffects(){for(const g of this.ChatLine.instances){const D=g.props.message,K=D?.ffz_tokens;if(K)for(const H of K)H.type==="emote"&&H.modifier_flags&&this.emotes.ensureEffect(H.modifier_flags)}for(const g of this.WhisperLine.instances){const D=g.props.message?._ffz_message,K=D?.ffz_tokens;if(K)for(const H of K)H.type==="emote"&&H.modifier_flags&&this.emotes.ensureEffect(H.modifier_flags)}}updateLineById(g,D=!0,K=null){K==null&&(K=D);for(const H of this.ChatLine.instances){const V=H.props.message;if(V?.id===g){K&&(V.ffz_badges=V.ffz_badge_cache=null),D&&(V.ffz_tokens=null,V.ffz_reply=null,V.highlights=V.mentioned=V.mention_color=V.color_priority=null),H.forceUpdate();return}}for(const H of this.WhisperLine.instances){const V=H.props.message?._ffz_message;if(V?.id===g){(K||D)&&(V._ffz_message=null),H.forceUpdate();return}}}updateLinesByUser(g,D,K=!0,H=!0){for(const V of this.ChatLine.instances){const E=V.props.message,F=E?.user;F&&(g&&g==F.id||D&&D==F.login)&&(H&&(E.ffz_badges=E.ffz_badge_cache=null),K&&(E.ffz_tokens=null,E.ffz_reply=null,E.highlights=E.mentioned=E.mention_color=E.color_priority=null),V.forceUpdate())}for(const V of this.WhisperLine.instances){const E=V.props.message?._ffz_message,F=E?.user;F&&(g&&g==F.id||D&&D==F.login)&&(E._ffz_message=null,V.forceUpdate())}}maybeUpdateLines(){this.chat.context.get("chat.rich.all-links")&&this.updateLines()}updateLines(){return this._updateLines()}rerenderLines(){return this._updateLines(!1,!1)}updateLineTokens(){return this._updateLines(!0,!1)}updateLineBadges(){return this._updateLines(!1,!0)}_updateLines(g=!0,D=!0){for(const K of this.ChatLine.instances){const H=K.props.message;H&&(D&&(H.ffz_badge_cache=H.ffz_badges=null),g&&(H.ffz_tokens=null,H.ffz_reply=null,H.highlights=H.mentioned=H.mention_color=H.mention_priority=H.clear_priority=null))}for(const K of this.ExtensionLine.instances){const H=K.props.message;H&&(D&&(H.ffz_badge_cache=H.ffz_badges=null),g&&(H.ffz_tokens=null,H.ffz_reply=null,H.highlights=H.mentioned=H.mention_color=H.mention_priority=H.clear_priority=null))}for(const K of this.WhisperLine.instances){const H=K.props.message;H&&H._ffz_message&&(H._ffz_message=null)}this.ChatLine.forceUpdate(),this.ExtensionLine.forceUpdate(),this.WhisperLine.forceUpdate(),this.emit("chat:updated-lines")}};G(ve,"ChatLine");let w=ve;var _=d(44589),o=d(17159);const ke=class ke extends z.default{constructor(...g){super(...g),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("chat.badges"),this.inject("site.fine"),this.inject("site"),this.inject("site.css_tweaks"),this.settings.add("chat.input.hide-identity",{default:!1,ui:{path:"Chat > Input >> Appearance",title:'Display "Chat Identity" in the chat settings menu rather than the input box.',component:"setting-check-box"}}),this.SettingsMenu=this.fine.define("chat-settings",D=>D.renderUniversalOptions&&D.onBadgesChanged,v.Z.CHAT_ROUTES)}async onEnable(){this.on("i18n:update",()=>this.SettingsMenu.forceUpdate()),this.chat.context.on("changed:chat.scroller.freeze",()=>this.SettingsMenu.forceUpdate()),this.chat.context.on("changed:chat.input.hide-identity",H=>{this.css_tweaks.toggle("hide-chat-identity",H),this.SettingsMenu.forceUpdate()}),this.css_tweaks.toggle("hide-chat-identity",this.chat.context.get("chat.input.hide-identity"));const g=this,D=await this.site.findReact();if(!D)return;const K=D.createElement;this.SettingsMenu.ready(H=>{const V=H.prototype.render,E=H.prototype.renderUniversalOptions;H.prototype.renderUniversalOptions=function(){const F=E.call(this);return this.ffzSettingsClick||(this.ffzSettingsClick=A=>g.click(this,A)),this.ffzPauseClick||(this.ffzPauseClick=()=>this.setState({ffzPauseMenu:!this.state.ffzPauseMenu})),F.props.children.push(K("div",{class:"tw-full-width tw-relative"},K("button",{class:"tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this.ffzSettingsClick},K("div",{class:"tw-align-items-center tw-flex tw-pd-05 tw-relative"},K("div",{class:"tw-flex-grow-1"},g.i18n.t("site.menu_button","FrankerFaceZ Control Center")))),g.cant_window&&K("div",{class:"tw-mg-t-05 tw-c-text-alt-2"},K("span",{class:"ffz-i-attention"},g.i18n.t("popup.error","We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch."))))),F},H.prototype.ffzRenderIdentity=function(){if(!this.state||!this.props||this.state.moderatorMode||this.state.chatAppearance||this.state.chatPause||this.state.followerMode||this.state.recentRaids||this.state.repliesAppearance||this.state.slowMode||this.props.isShowingChatFilterSettings||this.props.isShowingDeletedMessageDisplaySettings||!this.props.isLoggedIn||!g.chat.context.get("chat.input.hide-identity"))return null;const F=this.props.data?.currentUser,A=this.props.data?.user?.self?.displayBadges;if(!F||!F.login||!Array.isArray(A))return null;const N=F.login&&F.displayName&&F.displayName.trim().toLowerCase()!==F.login,Y=g.parent.colors.process(F.chatColor),se={};for(const _e of A)_e?.setID&&_e.version&&(se[_e.setID]=_e.version);this._ffzIdentityClick||(this._ffzIdentityClick=()=>{document.querySelector('button[data-a-target="chat-badge-carousel-badge-icon"]').click(),this.props.onCloseSettings()});const ue={user:F,badges:se,ffz_badges:g.badges.getBadges(F.id,F.login,this.props.channelID,this.props.channelLogin),roomID:this.props.channelID,roomLogin:this.props.channelLogin};return this._ffzIdentityMsg=ue,K("div",{class:"ffz-identity"},K("div",{class:"tw-mg-y-05 tw-pd-x-05"},K("p",{class:"tw-c-text-alt-2 tw-font-size-6 tw-strong tw-upcase"},g.i18n.t("chat.identity-menu","Chat Identity"))),K("div",{class:"tw-full-width tw-relative"},K("button",{class:"tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this._ffzIdentityClick},K("div",{class:"tw-align-items-center tw-flex tw-pd-05 tw-relative"},K("div",{class:"tw-flex-grow-1"},K("span",{class:"ffz--editor-name"},K("span",{class:"ffz--editor-badges","data-room-id":this.props.channelID,"data-room":this.props.channelLogin},g.badges.render(ue,K,!0,!0)),K("span",{class:"tw-strong notranslate",style:{color:Y}},K("span",{class:"name-display__name"},F.displayName||F.login),N&&K("span",{class:"intl-name"}," (",F.login,") ")))),K("div",{class:"tw-align-items-center tw-flex tw-flex-shrink-0 tw-mg-l-05"},K("figure",{class:"ffz-i-right-open"}))))))},H.prototype.render=function(){const F=V.call(this);try{const A=F?.props?.children?.props?.children?.props?.children?.[1]?.props?.children?.props?.children;if(Array.isArray(A)){const N=this.ffzRenderIdentity();N&&A.unshift(N)}}catch(A){g.log.error("Error rendering chat settings menu.",A)}return F},this.SettingsMenu.forceUpdate()}),this.SettingsMenu.on("update",this.updateSettingsMenu,this),this.SettingsMenu.on("unmount",H=>{H.ffzSettingsClick=null})}updateSettingsMenu(g){const D=this.fine.getChildNode(g);if(!D||!document.contains(D))return;let K;if(g.props?.editAppearance){this.registerBadgePicker();const N=D.querySelector('span[data-a-target="edit-display-name"]');K=N&&N.closest(".tw-mg-t-1")}else K=D.querySelector('.name-display > div:not([data-test-selector="edit-appearance-button"])');if(!K||!D.contains(K))return;const H=g.props?.data?.currentUser,V=g.props?.data?.user?.self?.displayBadges;if(!H||!H.login||!Array.isArray(V))return;const E=H.login&&H.displayName&&H.displayName.trim().toLowerCase()!==H.login,F=this.parent.colors.process(H.chatColor),A={};for(const N of K.children)N?.classList&&(N.classList.contains("ffz--editor-name")?N.remove():N.classList.add("tw-hide"));for(const N of V)N?.setID&&N.version&&(A[N.setID]=N.version);K.appendChild((0,_.createElement)("span",{className:"ffz--editor-name"},[(0,_.createElement)("span",{className:"ffz--editor-badges","data-room-id":g.props.channelID,"data-room-login":g.props.channelLogin},this.badges.render({user:H,badges:A,ffz_badges:this.badges.getBadges(H.id,H.login,g.props.channelID,g.props.channelLogin),roomID:g.props.channelID,roomLogin:g.props.channelLogin},_.createElement,!0,!0)),(0,_.createElement)("span",{class:"tw-strong notranslate",style:{color:F}},(0,_.createElement)("span",{class:"name-display__name"},H.displayName||H.login),E&&(0,_.createElement)("span",{class:"intl-name"}," (",H.login,")"))]))}registerBadgePicker(){this.BadgePicker||(this.BadgePicker=this.fine.define("badge-picker",g=>g.onGlobalBadgeClicked&&g.onGlobalBadgeKeyPress,v.Z.CHAT_ROUTES),this.BadgePicker.on("mount",this.updateBadgePicker,this),this.BadgePicker.on("update",this.updateBadgePicker,this),this.BadgePicker.ready((g,D)=>{for(const K of D)this.updateBadgePicker(K)}))}updateBadgePicker(g){const D=this.fine.getChildNode(g);if(!D){g.props?.data?.loading===!1&&!g._ffz_try_again&&(g._ffz_try_again=requestAnimationFrame(()=>this.updateBadgePicker(g)));return}const K=D.querySelector(".tw-flex-column");if(!K)return;const H=this.badges.getBadges(g.props.userID,g.props.userLogin);let V;for(const N of H){const Y=this.badges.badges[N?.id];Y&&!Y.addon&&(V=Y)}const E=K.querySelector(".ffz--badge-selector");if(E){V||E.remove();return}else if(!V)return;const F=(0,_.createElement)("div",{class:"ffz--badge-selector tw-border-b tw-mg-b-1"},(0,_.createElement)("div",{class:"tw-mg-y-05 tw-pd-x-05"},(0,_.createElement)("p",{class:"tw-c-text-alt-2 tw-font-size-6 tw-strong tw-upcase"},this.i18n.t("chat.ffz-badge.title","FrankerFaceZ Badge"))),(0,_.createElement)("div",null,(0,_.createElement)("p",{class:"tw-mg-b-05 tw-pd-x-05"},this.i18n.tList("chat.ffz-badge.about","This badge appears globally for users with FrankerFaceZ. Please visit the {website} to change this badge.",{website:(0,_.createElement)("a",{href:"https://www.frankerfacez.com/subscribe",class:"ffz-link",rel:"noopener noreferrer",target:"_blank"},this.i18n.t("chat.ffz-badge.site-link","FrankerFaceZ website"))}))),(0,_.createElement)("div",{role:"radiogroup",class:"tw-align-items-center tw-flex tw-flex-wrap tw-mg-b-05 tw-mg-t-05 tw-pd-x-05"},(0,_.createElement)("div",{class:"tw-mg-r-1 tw-mg-y-05"},(0,_.createElement)("div",{class:"tw-inline-flex"},(0,_.createElement)("div",{class:"edit-appearance__badge-chooser edit-appearance__badge-chooser--selected tw-border-radius-small"},(0,_.createElement)("img",{alt:V.title,src:V.urls[2],srcset:`${V.urls[2]} 1x, ${V.urls[4]} 2x`,style:{backgroundColor:V.color||"transparent"},role:"radio","aria-checked":"true",class:"tw-full-height tw-full-width"})))))),A=K.querySelector('[data-test-selector="global-badges-test-selector"]')?.nextElementSibling;A?K.insertBefore(F,A):K.appendChild(F)}closeMenu(g){const D=this.fine.searchParent(g,H=>H.setChatInputRef&&H.setAutocompleteInputRef,100),K=D&&this.fine.searchTree(D,H=>H.props&&H.props.isSettingsOpen&&H.onClickSettings);K&&K.onClickSettings()}click(g,D){const K=D.currentTarget,H=K&&K.dataset&&K.dataset.page,V=new o.FFZEvent({item:H,event:D,errored:!1});if(this.emit("main_menu:open",V),V.errored){this.cant_window=!0,this.SettingsMenu.forceUpdate();return}this.closeMenu(g)}};G(ke,"SettingsMenu");let e=ke;var a=d(49276),p=d(90424),C=d.n(p);const m={1e3:"Tier 1",2e3:"Tier 2",3e3:"Tier 3"},x=["the_horns","raised_back_of_hand","ok_hand","+1","clap","fist","pinched_fingers","wave","pinch","victory","love_you_gesture"];function $(Oe,g){g||(g=Oe.closest(".simplebar-scroll-content")??Oe.parentElement);const D=g.offsetHeight,K=Oe.offsetHeight,H=Oe.offsetTop;if(K>=D){g.scrollTop=H;return}const V=H+K/2-D/2;g.scrollTop=V}G($,"scrollIntoView");function r(Oe){if(!Oe)return Oe;try{return new Date(Oe)}catch{return null}}G(r,"maybe_date");const c=window?.Intl?.Collator&&new Intl.Collator(void 0,{numeric:!0}),b=[G(function(g,D){return c?c.compare(g.id,D.id):g.id<D.id?-1:g.id>D.id?1:0},"id_asc"),G(function(g,D){return c?c.compare(D.id,g.id):g.id>D.id?-1:g.id<D.id?1:0},"id_desc"),G(function(g,D){const K=g.name.toLowerCase(),H=D.name.toLowerCase();return K<H?-1:K>H?1:c?c.compare(g.id,D.id):g.id<D.id?-1:g.id>D.id?1:0},"name_asc"),G(function(g,D){const K=g.name.toLowerCase(),H=D.name.toLowerCase();return K>H?-1:K<H?1:c?c.compare(D.id,g.id):g.id>D.id?-1:g.id<D.id?1:0},"name_desc"),G(function(g,D){if(g.order!=null||D.order!=null){if(g.order&&D.order==null)return-1;if(D.order&&g.order==null)return 1;if(g.order<D.order)return-1;if(g.order>D.order)return 1}return c?c.compare(g.id,D.id):g.id<D.id?-1:g.id>D.id?1:0},"native_asc"),G(function(g,D){if(g.order!=null||D.order!=null){if(g.order&&D.order==null)return 1;if(D.order&&g.order==null)return-1;if(g.order<D.order)return 1;if(g.order>D.order)return-1}return c?c.compare(g.id,D.id):g.id<D.id?1:g.id>D.id?-1:0},"native_desc")];function k(Oe,g){const D=Oe.sort_key,K=g.sort_key;if(D<K)return-1;if(K<D)return 1;const H=Oe.title.toLowerCase(),V=g.title.toLowerCase();return H<V?-1:V<H?1:0}G(k,"sort_sets");const De=class De extends z.default{constructor(...g){super(...g),this.inject("staging"),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("chat.badges"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("site"),this.inject("site.fine"),this.inject("site.apollo"),this.inject("site.css_tweaks"),this.SUB_STATUS=C(),this.settings.add("chat.emote-menu.shortcut",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Use Ctrl+E to open the Emote Menu.",description:"When enabled and you press Ctrl+E with the chat input focused, the emote menu will open.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.modifiers",{default:0,ui:{path:"Chat > Emote Menu >> General",title:"Emote Modifiers",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"In-Line"}]}}),this.settings.add("chat.emote-menu.clear-search",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Reset search when closing the Emote Menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.enabled",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Use the FrankerFaceZ Emote Menu.",description:"The FFZ emote menu replaces the built-in Twitch emote menu and provides enhanced functionality.",component:"setting-check-box"},changed:()=>this.EmoteMenu.forceUpdate()}),this.settings.add("chat.emote-menu.icon",{requires:["chat.emote-menu.enabled","context.bttv.emote_menu"],default:!1,process(D,K){return D.get("chat.emote-menu.enabled")?D.get("context.bttv.emote_menu")||K:!1},ui:{path:"Chat > Emote Menu >> Appearance",title:"Replace the emote menu icon with the FFZ icon for that classic feel.",description:"**Note:** This setting may be forcibly enabled if other emote menus are detected, to ensure you can visually identify the FFZ Emote Menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.show-quick-nav",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show a quick navigation bar along the side of the menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.tall",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Use extra height for the emote menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.show-heading",{default:1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show Headers",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Not Searching"}]}}),this.settings.add("chat.emote-menu.show-search",{default:!0,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show the search box.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.reduced-padding",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Use reduced padding.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.default-tab",{default:"channel",ui:{path:"Chat > Emote Menu >> General",title:"Default Tab",component:"setting-select-box",data:[{value:"fav",title:"Favorites"},{value:"channel",title:"Channel"},{value:"effect",title:"Emote Effects"},{value:"all",title:"My Emotes"},{value:"emoji",title:"Emoji"}]}}),this.settings.add("chat.emote-menu.effect-tab",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Display Emote Effects in their own tab.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.tooltips",{default:!0,ui:{path:"Chat > Emote Menu >> Appearance",title:"Display emote preview tool-tips in the FFZ Emote Menu.",component:"setting-check-box",description:"You may wish to disable this for performance reasons."}}),this.settings.add("chat.emote-menu.show-emoji",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Display emoji in the emote menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.combine-tabs",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Display all emotes on one tab.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.stay-loaded",{requires:["chat.emote-menu.combine-tabs"],default:null,process(D,K){return K==null&&(K=D.get("chat.emote-menu.combine-tabs")),K},ui:{path:"Chat > Emote Menu >> General",title:"Stay loaded after opening.",component:"setting-check-box",description:"This causes the emote menu to stay in the DOM even when it's not visible. Enabling this may help the site perform better when opening the menu if it's slow. By default, this setting is enabled when using `Display all emotes on one tab.`"}}),this.settings.add("chat.emote-menu.sort-emotes",{default:4,ui:{path:"Chat > Emote Menu >> Sorting",title:"Sort Emotes By",component:"setting-select-box",data:[{value:4,title:"Native Order, Ascending"},{value:5,title:"Native Order, Descending"},{value:0,title:"Order Added (ID), Ascending"},{value:1,title:"Order Added (ID), Descending"},{value:2,title:"Name, Ascending"},{value:3,title:"Name, Descending"}]}}),this.settings.add("chat.emote-menu.sort-tiers-last",{default:!0,ui:{path:"Chat > Emote Menu >> Sorting",title:"List emotes from higher sub tiers last.",component:"setting-check-box"}}),this.EmoteMenu=this.fine.define("chat-emote-menu",D=>D.getAllEmoteSets&&D.getSortedChannelEmotes&&D.props?.emotePickerSource,v.Z.CHAT_ROUTES),this.MenuWrapper=this.fine.wrap("ffz-emote-menu")}async onEnable(){this.on("i18n:update",()=>this.EmoteMenu.forceUpdate()),this.on("chat.emotes:update-default-sets",this.maybeUpdate,this),this.on("chat.emotes:update-user-sets",this.maybeUpdate,this),this.on("chat.emotes:update-room-sets",this.maybeUpdate,this),this.on("chat.emotes:loaded",this.maybeUpdate,this),this.on("chat.emotes:change-favorite",this.maybeUpdate,this),this.on("chat.emotes:change-hidden",this.maybeUpdate,this),this.on("chat.emoji:populated",this.maybeUpdate,this),this.chat.context.on("changed:chat.emote-menu.enabled",()=>this.EmoteMenu.forceUpdate());const g=G(()=>{for(const V of this.MenuWrapper.instances)V.rebuildData()},"rebuild");this.chat.context.on("changed:chat.emotes.enabled",g),this.chat.context.on("changed:chat.emote-menu.modifiers",g),this.chat.context.on("changed:chat.emote-menu.show-emoji",g),this.chat.context.on("changed:chat.emote-menu.tooltips",g),this.chat.context.on("changed:chat.fix-bad-emotes",g),this.chat.context.on("changed:chat.emote-menu.effect-tab",g),this.chat.context.on("changed:chat.emote-menu.sort-emotes",g),this.chat.context.on("changed:chat.emote-menu.sort-tiers-last",g),this.chat.context.on("changed:chat.emoji.style",this.updateEmojiVariables,this),this.chat.context.getChanges("chat.emote-menu.icon",V=>this.css_tweaks.toggle("emote-menu",V)),this.updateEmojiVariables(),this.css_tweaks.setVariable("emoji-menu--sheet","//cdn.frankerfacez.com/static/emoji/images/sheet-twemoji-36.png"),this.css_tweaks.setVariable("emoji-menu--count",58),this.css_tweaks.setVariable("emoji-menu--size",36);const D=this,K=await this.site.findReact(),H=K&&K.createElement;if(!H)return D.log.warn("Unable to get React.");this.defineClasses(),this.EmoteMenu.ready(V=>{const E=V.prototype.render;V.prototype.render=function(){return this._ffz_no_scan=!1,!this.props||this.props.emotePickerSource==="bits-rewards"||!(0,B.has)(this.props,"channelID")||!D.chat.context.get("chat.emote-menu.enabled")?E.call(this):H(D.MenuErrorWrapper,{visible:this.props.visible},H(D.MenuComponent,{source:this.props.emotePickerSource,visible:this.props.visible,toggleVisibility:this.props.toggleVisibility,channel_data:this.props.channelData,emote_data:this.props.emoteSetsData,user_id:this.props.currentUserID,channel_id:this.props.channelID,loading:this.props.channelData?.loading||this.props.emoteSetsData?.loading,error:this.props.channelData?.error||this.props.emoteSetsData?.error,onClickToken:this.props.onClickToken}))},this.EmoteMenu.forceUpdate()})}updateEmojiVariables(){const g=this.chat.context.get("chat.emoji.style")||"twitter",D=`//cdn.frankerfacez.com/static/emoji/images/sheet-${a.Vf[g]||"twemoji"}-`,K=this.emoji_size=36,H=this.emoji_sheet_count=58,V=this.emoji_sheet_size=H*(K+2),E=this.emoji_sheet_pct=100*V/K;this.emoji_sheet_remain=V-K,this.css_tweaks.set("emoji-menu",`.ffz--emoji-tone-picker__emoji,.emote-picker__emoji .emote-picker__emote-figure {
	background-size: ${E}% ${E}%;
	background-image: url("${D}36.png");
	background-image: ${R.WEBKIT_CSS}image-set(
		url("${D}18.png") 0.5x,
		url("${D}36.png") 1x,
		url("${D}72.png") 2x
	);
}`)}maybeUpdate(){if(this.chat.context.get("chat.emote-menu.enabled"))for(const g of this.MenuWrapper.instances)g.rebuildData()}defineClasses(){var A,N,Y,se,ue;const g=this,D=this.settings.provider,K=this.site.getReact(),H=K&&K.createElement;this.EmojiTonePicker=(A=class extends K.Component{constructor(Q){super(Q),this.onClick=()=>this.setState({open:!this.state.open}),this.onMouseEnter=()=>this.state.open||this.setState({emoji:this.pickRandomEmoji()}),this.onClickOutside=()=>this.state.open&&this.setState({open:!1}),this.clickTone=le=>{this.props.pickTone(le.currentTarget.dataset.tone),this.setState({open:!1})},this.element=null,this.saveRef=le=>this.element=le,this.state={open:!1,emoji:this.pickRandomEmoji(),tone:null}}componentDidMount(){this.element&&(this._clicker=new _.ClickOutside(this.element,this.onClickOutside))}componentWillUnmount(){this._clicker&&(this._clicker.destroy(),this._clicker=null)}pickRandomEmoji(){const Q=this.props.choices,le=Math.floor(Math.random()*Q.length);return Q[le]}renderTone(Q,le){return Q?H("button",{key:Q.code,"data-tone":le,class:"tw-interactive tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-y-05 tw-pd-x-2",onClick:this.clickTone},this.renderEmoji(Q)):null}renderToneMenu(){if(!this.state.open)return null;const Q=this.state.emoji;if(!Q||!Q.variants)return null;const le=Object.entries(Q.variants).map(([he,be])=>this.renderTone(be,he));return H("div",{class:"tw-absolute ffz-balloon ffz-il-tooltip--up ffz-il-tooltip--align-right ffz-balloon tw-block"},H("div",{class:"tw-border-b tw-border-l tw-border-r tw-border-t tw-border-radius-medium tw-c-background-base tw-elevation-1"},this.renderTone(Q,null),le))}renderEmoji(Q){if(!Q)return null;const le=Q.sheet_x*(g.emoji_size+2)+1,he=Q.sheet_y*(g.emoji_size+2)+1,be=100*le/g.emoji_sheet_remain,Ce=100*he/g.emoji_sheet_remain;return H("figure",{class:"ffz--emoji-tone-picker__emoji",style:{backgroundPosition:`${be}% ${Ce}%`}})}render(){const Q=this.state.emoji,le=this.props.tone,he=le&&Q.variants[le];return H("div",{ref:this.saveRef,class:"ffz--emoji-tone-picker tw-relative tw-mg-l-1"},H("button",{class:"tw-interactive tw-button tw-button--dropmenu ffz-button--hollow",onClick:this.onClick,onMouseEnter:this.onMouseEnter},H("span",{class:"tw-button__text"},this.renderEmoji(he||Q)),H("span",{class:"tw-button__icon tw-button__icon--right"},H("figure",{class:"ffz-i-down-dir"}))),this.renderToneMenu())}},G(A,"FFZEmojiTonePicker"),A),this.MenuSection=(N=class extends K.Component{constructor(Q){super(Q),this.ref=null,this.saveRef=be=>{this.ref&&this.props.stopObserving(this.ref),this.ref=be,be&&this.props.startObserving(this.ref,this)};const le=D.get("emote-menu.collapsed"),he=D.get("emote-menu.hidden-sets");this.state={active:!1,activeEmote:-1,hidden:he&&Q.data&&he.includes(Q.data.hide_key||Q.data.key),collapsed:le&&Q.data&&le.includes(Q.data.key),intersecting:!window.IntersectionObserver},this.keyHeading=this.keyHeading.bind(this),this.clickHeading=this.clickHeading.bind(this),this.clickEmote=this.clickEmote.bind(this),this.mouseEnter=()=>this.state.intersecting||this.setState({intersecting:!0}),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this)}componentDidMount(){this.props.addSection(this),this.ref&&this.props.startObserving(this.ref,this)}componentWillUnmount(){this.props.removeSection(this),this.ref&&this.props.stopObserving(this.ref)}keyInteract(Q){}clickEmote(Q){if(this.props.visibility_control){const ze=Q.currentTarget.dataset;let Me,ce=ze.id;if(ze.provider==="twitch")Me="twitch";else if(ze.provider==="ffz"){const ye=g.emotes.emote_sets[ze.set],we=ye&&ye.emotes[ce];if(!we)return;Me=ye.source||"ffz",ce=we.id}else return;g.emotes.toggleHidden(Me,ce);return}if(g.emotes.handleClick(Q,!0))return;let le="",he="";const be=Q.currentTarget.dataset.effects,Ce=Q.currentTarget.dataset.effectPrefix==="true";be?.length>0&&be!="0"&&g.emotes.target_emote&&(Ce?he=` ${g.emotes.target_emote.name}`:le=`${g.emotes.target_emote.name} `),this.props.onClickToken(`${le}${Q.currentTarget.dataset.name}${he}`)}keyHeading(Q){(Q.keyCode===R.KEYS.Enter||Q.keyCode===R.KEYS.Space)&&this.clickHeading()}clickHeading(){if(this.props.visibility_control){const Ce=D.get("emote-menu.hidden-sets")||[],ze=this.props.data.hide_key||this.props.data.key,Me=Ce.indexOf(ze);if(ze==="twitch-current-channel")return;Me===-1?(Ce.push(ze),this.setState({hidden:!0})):(Ce.splice(Me,1),this.setState({hidden:!1})),D.set("emote-menu.hidden-sets",Ce),g.emit("chat.emotes:change-set-hidden",ze);return}if(this.props.filtered)return;const Q=D.get("emote-menu.collapsed")||[],le=!this.state.collapsed,he=this.props.data.key,be=Q.indexOf(he);if(this.setState({collapsed:le}),le&&be===-1)Q.push(he);else if(!le&&be!==-1)Q.splice(be,1);else return;D.set("emote-menu.collapsed",Q)}onMouseEnter(Q){const le=Q.currentTarget.dataset.setId;this.setState({unlocked:le})}onMouseLeave(){this.setState({unlocked:null})}render(){const Q=this.props.data,le=this.props.filtered,he=this.props.visibility_control;let be=!(Q.is_favorites&&!this.props.combineTabs)&&this.props.showHeading;be===2?be=!le:be=!!be,he&&(be=!0);const Ce=he?this.state.hidden:!1,ze=he?Ce:be&&!le&&this.state.collapsed;if(!Q)return null;let Me;Q.image?Me=H("img",{class:`ffz--menu-badge${Q.image_large?" ffz--menu-badge__large":""}`,src:Q.image,srcSet:Q.image_set}):Me=H("figure",{class:`ffz--menu-badge ffz-i-${Q.icon||"zreknarf"}`});let ce;const ye=Q.renews&&Q.renews.getTime(),we=Q.ends&&Q.ends.getTime();ye>0?ce={icon:"calendar",message:g.i18n.t("emote-menu.sub-renews","This sub renews {seconds,humantime}.",{seconds:ye})}:we&&(Q.prime?ce={icon:"crown",message:g.i18n.t("emote-menu.sub-prime",`This is your free sub with Prime Gaming.
It ends {seconds,humantime}.`,{seconds:we})}:Q.gift?ce={icon:"gift",message:g.i18n.t("emote-menu.sub-gift-ends","This gifted sub ends {seconds,humantime}.",{seconds:we})}:ce={icon:"calendar-empty",message:g.i18n.t("emote-menu.sub-ends","This sub ends {seconds,humantime}.",{seconds:we})});let Ae=Q.source_i18n?g.i18n.t(Q.source_i18n,Q.source):Q.source;return Ae==null&&(Ae="FFZ"),H("section",{ref:this.saveRef,"data-key":Q.key,class:le?"filtered":"",onMouseEnter:this.mouseEnter},be?H("heading",{tabindex:"0",class:"tw-pd-1 tw-border-b tw-flex tw-flex-nowrap",onKeyDown:this.keyHeading,onClick:this.clickHeading},Me,H("div",{class:"tw-pd-l-05"},(Q.i18n?g.i18n.t(Q.i18n,Q.title):Q.title)||g.i18n.t("emote-menu.unknown","Unknown Source"),!he&&ce&&H("span",{class:`tw-mg-x-05 ffz--expiry-info ffz-tooltip ffz-i-${ce.icon}`,"data-tooltip-type":"html","data-title":ce.message})),H("div",{class:"tw-flex-grow-1"}),H("span",{class:!he&&Q.channel_source?"ffz-tooltip":"","data-title":Q.channel_source},he?Ce?g.i18n.t("emote-menu.visibility.hidden","Hidden"):g.i18n.t("emote-menu.visibility.visible","Visible"):Ae),!he&&le?"":H("figure",{class:`tw-pd-l-05 ffz-i-${ze?"left":"down"}-dir`})):null,ze||this.renderBody(be))}renderBody(Q){const le=this.props.data,he=this.props.filtered,be=le.locks&&le.locks[this.state.unlocked],Ce=le.filtered_emotes&&le.filtered_emotes.map(ze=>{if(he&&ze.locked)return;const Me=ze.locked&&(!be||!be.emotes.has(ze.id)),ce=Me&&le.locks&&le.locks[ze.set_id];let ye="";return ce&&(ce.id==="subwoofer"?ye=g.i18n.t("emote-menu.emote-subwoofer","Become an FFZ Subwoofer to unlock this emote."):ce.id==="cheer"?ye=g.i18n.t("emote-menu.emote-cheer","Cheer an additional {bits_remaining, plural, one {# bit} other {# bits}} to unlock this emote.",ce):ce.id==="follower"?ye=g.i18n.t("emote-menu.emote-follower","Follow {user} to unlock this emote in their channel.",ce):le.all_locked?ye=g.i18n.t("emote-menu.emote-sub","Subscribe for {price} to unlock this emote.",ce):ye=g.i18n.t("emote-menu.emote-up","Upgrade your sub to {price} to unlock this emote.",ce)),this.renderEmote(ze,Me,Q,ye)});return H("div",{class:"tw-pd-1 tw-border-b tw-c-background-alt tw-align-center"},Ce,!this.props.visibility_control&&!he&&this.renderSellout())}renderEmote(Q,le,he,be){if(!this.state.intersecting)return H("span",{key:Q.id,class:"emote-picker__placeholder",style:{width:`${Q.width||28}px`,height:`${Q.height||28}px`}});const Ce=this.props.visibility_control,ze=this.props.emote_modifiers[Q.id],Me=Array.isArray(ze)&&ze.length>0,ce=this.props.animated,ye=Ce&&Q.hidden,we=g.chat.context.get("chat.emote-menu.tooltips");let Ae,$e;return ce&&Q.animSrc?(Ae=Q.animSrc,$e=Q.animSrcSet):(Ae=Q.src,$e=Q.srcSet),H("button",{key:Q.id,class:`${we?"ffz-tooltip ":""}emote-picker__emote-link${!Ce&&le?" locked":""}${ye?" emote-hidden":""}`,"data-tooltip-type":"emote","data-provider":Q.provider,"data-id":Q.id,"data-set":Q.set_id,"data-code":Q.code,"data-modifiers":ze,"data-effects":Q.effects,"data-effect-prefix":Q.effect_prefix,"data-variant":Q.variant,"data-no-source":he,"data-name":Q.name,"aria-label":Q.name,"data-locked":Q.locked,"data-sellout":be,onClick:(this.props.visibility_control||!Q.locked)&&this.clickEmote},H("figure",{class:"emote-picker__emote-figure"},H("img",{class:`emote-picker__emote-image${Q.emoji?" ffz-emoji":""}`,src:Ae,srcSet:$e,alt:Q.name,height:Q.height?`${Q.height}px`:null,width:Q.width?`${Q.width}px`:null})),!Ce&&Me&&H("div",{class:"emote-button__options"}),!Ce&&Q.favorite&&H("figure",{class:"ffz--favorite ffz-i-star"}),!Ce&&le&&H("figure",{class:`ffz-i-${Q.lock_icon||"lock"}`}),ye&&H("figure",{class:"ffz-i-eye-off"}))}renderSellout(){const Q=this.props.data;if(!Q.all_locked||!Q.locks)return null;let le=Q.locks[this.state.unlocked],he=Object.values(Q.locks).filter(Ce=>Ce.id!=="cheer"),be=he.filter(Ce=>Ce.is_ffz).length>0;return!le&&Q.locks.length===1&&(le=Q.locks[0]),he.length?H("div",{class:"tw-mg-1 tw-border-t tw-pd-t-1 tw-mg-b-0"},be?g.i18n.t("emote-menu.ffz-unlock","This feature is available to FFZ Subwoofers."):le?g.i18n.t("emote-menu.sub-unlock","Subscribe for {price} to unlock {count, plural, one {# emote} other {# emotes}}",{price:le.price,count:le.emotes.size}):g.i18n.t("emote-menu.sub-basic","Subscribe to unlock some emotes"),be&&this.props.ffz_sub_data?.has_free_sub?H("div",{class:"tw-pd-y-1"},g.i18n.t("emote-menu.free-sub.about","As thanks for supporting us in the past, you can get one month of FFZ Subwoofer for free.")):null,H("div",{class:"ffz--sub-buttons tw-mg-t-05"},he.map(Ce=>Ce.hide_button?null:H("a",{key:Ce.price,class:"tw-button tw-border-radius-none",href:Ce.url,target:"_blank",rel:"noopener noreferrer","data-set-id":Ce.set_id,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},H("span",{class:"tw-button__text"},be&&this.props.ffz_sub_data?.has_free_sub?g.i18n.t("emote-menu.free-sub","Use My Free Month"):Ce.price))))):null}},G(N,"FFZMenuSection"),N),this.fine.wrap("ffz-menu-section",this.MenuSection),this.EmojiSection=(Y=class extends this.MenuSection{renderEmote(Q,le,he,be){const Ce=Q.x*(g.emoji_size+2)+1,ze=Q.y*(g.emoji_size+2)+1,Me=100*Ce/g.emoji_sheet_remain,ce=100*ze/g.emoji_sheet_remain,ye=g.chat.context.get("chat.emote-menu.tooltips");return H("button",{key:Q.id,class:`${ye?"ffz-tooltip ":""}emote-picker__emote-link${le?" locked":""}${Q.emoji?" emote-picker__emoji":""}`,"data-tooltip-type":"emote","data-provider":Q.provider,"data-id":Q.id,"data-set":Q.set_id,"data-code":Q.code,"data-variant":Q.variant,"data-no-source":he,"data-name":Q.name,"aria-label":Q.name,"data-locked":Q.locked,"data-sellout":be,onClick:!Q.locked&&this.clickEmote},H("figure",{class:"emote-picker__emote-figure",style:{backgroundPosition:`${Me}% ${ce}%`}}),Q.favorite&&H("figure",{class:"ffz--favorite ffz-i-star"}),le&&H("figure",{class:`ffz-i-${Q.lock_icon||"lock"}`}))}},G(Y,"FFZMenuEmojiSection"),Y);let V;const E=G(()=>requestAnimationFrame(()=>this.emit("tooltips:cleanup")),"doClear"),F=G(()=>{clearTimeout(V),setTimeout(E,100)},"clearTooltips");this.MenuErrorWrapper=(se=class extends K.Component{constructor(Q){super(Q),this.state={errored:!1,error:null}}static getDerivedStateFromError(Q){return{errored:!0,error:Q}}componentDidCatch(Q){g.log.capture(Q),g.log.error("Error rendering the FFZ Emote Menu."),this.setState({errored:!0,error:Q})}render(){if(this.state.errored){if(!this.props.visible)return null;const Q=g.chat.context.get("chat.emote-menu.reduced-padding");return H("div",{class:`ffz-balloon ffz-balloon--md ffz-il-tooltip--up ffz-il-tooltip--align-right tw-block tw-absolute ffz--emote-picker${Q?" reduced-padding":""}`,"data-a-target":"emote-picker"},H("div",{class:"tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base"},H("div",{class:"emote-picker__tab-content scrollable-area","data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},H("div",{class:"tw-align-center tw-pd-1"},H("div",{class:"tw-mg-b-1"},H("div",{class:"tw-mg-2"},H("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),g.i18n.t("emote-menu.error","There was an error rendering this menu."),H("br",null),g.settings.get("reports.error.enable")?g.i18n.t("emote-menu.error-report","An error report has been automatically submitted."):"",H("div",{class:"tw-mg-t-05 tw-border-t-1 tw-pd-t-05"},g.i18n.t("emote-menu.disable","As a temporary workaround, try disabling the FFZ Emote Menu in the FFZ Control Center.")))))))}return this.props.children}},G(se,"FFZEmoteMenuErrorWrapper"),se),this.MenuComponent=(ue=class extends K.Component{constructor(Q){super(Q),this.nav_ref=null,this.saveNavRef=le=>{this.nav_ref=le},this.ref=null,this.saveScrollRef=le=>{this.ref=le,this.createObserver()},this.sections=[],this.activeSection=-1,this.state={tab:null,active_nav:null,stayLoaded:g.chat.context.get("chat.emote-menu.stay-loaded"),quickNav:g.chat.context.get("chat.emote-menu.show-quick-nav"),animated:g.chat.context.get("chat.emotes.animated"),showHeading:g.chat.context.get("chat.emote-menu.show-heading"),tall:g.chat.context.get("chat.emote-menu.tall"),reducedPadding:g.chat.context.get("chat.emote-menu.reduced-padding"),combineTabs:g.chat.context.get("chat.emote-menu.combine-tabs"),showSearch:g.chat.context.get("chat.emote-menu.show-search"),clearSearch:g.chat.context.get("chat.emote-menu.clear-search"),hasNewEffects:!1,unlockedEffects:g.settings.provider.get("unlocked-effects",[]),tone:g.settings.provider.get("emoji-tone",null)},Q.visible&&(this.loadData(),this.state.wants_plan_info&&this.loadFFZPlanData(),this.state.wants_resub_info&&this.loadFFZSubData()),this.rebuildData(),this.observing=new Map,this.addSection=le=>{this.sections.includes(le)||this.sections.push(le)},this.removeSection=le=>{const he=this.sections.indexOf(le);he!==-1&&(this.sections.splice(he),he===this.activeSection?this.activeSection=-1:he<this.activeSection&&this.activeSection--)},this.startObserving=this.startObserving.bind(this),this.stopObserving=this.stopObserving.bind(this),this.handleObserve=this.handleObserve.bind(this),this.pickTone=this.pickTone.bind(this),this.clickTab=this.clickTab.bind(this),this.clickSideNav=this.clickSideNav.bind(this),this.handleFilterChange=this.handleFilterChange.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.toggleVisibilityControl=this.toggleVisibilityControl.bind(this)}createObserver(){if(this.observer){if(this._observed===this.ref)return;this.observer.disconnect(),this.observer=this._observed=null}if(!(!this.ref||!window.IntersectionObserver)){this._observed=this.ref,this.observer=new IntersectionObserver(this.handleObserve,{root:this.ref,rootMargin:"50px 0px",threshold:.01});for(const Q of this.observing.keys())this.observer.observe(Q);this.observeSoon()}}observeSoon(){requestAnimationFrame(()=>{this.observer&&this.handleObserve(this.observer.takeRecords())})}destroyObserver(){this.observer&&(this.observer.disconnect(),this.observer=this._observed=null)}scrollNavIntoView(){requestAnimationFrame(()=>{const Q=this.nav_ref?.querySelector?.(`button[data-key="${this.state.active_nav}"]`);Q&&$(Q)})}handleObserve(Q){let le=!1,he=this.state.active_nav;for(const be of Q){const Ce=this.observing.get(be.target),ze=be.isIntersecting;!Ce||Ce.state.intersecting===ze||(le=!0,Ce.setState({intersecting:ze}),ze&&(he=Ce.props?.data?.key))}le&&(requestAnimationFrame(F),!this.lock_active&&he!==this.state.active_nav&&this.setState({active_nav:he},()=>this.scrollNavIntoView()))}startObserving(Q,le){const he=this.observing.get(Q);le!==he&&(he&&this.stopObserving(Q),this.observing.set(Q,le),this.observer&&this.observer.observe(Q),this.observeSoon())}stopObserving(Q){this.observing.has(Q)&&(this.observing.delete(Q),this.observer&&this.observer.unobserve(Q))}componentDidMount(){this.ref&&this.createObserver(),g.chat.context.on("changed:chat.emotes.animated",this.updateSettingState,this),g.chat.context.on("changed:chat.emote-menu.stay-loaded",this.updateSettingState,this),g.chat.context.on("changed:chat.emote-menu.show-quick-nav",this.updateSettingState,this),g.chat.context.on("changed:chat.emote-menu.reduced-padding",this.updateSettingState,this),g.chat.context.on("changed:chat.emote-menu.show-heading",this.updateSettingState,this),g.chat.context.on("changed:chat.emote-menu.combine-tabs",this.updateSettingState,this),g.chat.context.on("changed:chat.emote-menu.show-search",this.updateSettingState,this),g.chat.context.on("changed:chat.emote-menu.clear-search",this.updateSettingState,this),g.chat.context.on("changed:chat.emote-menu.tall",this.updateSettingState,this),window.ffz_menu=this}componentWillUnmount(){this.destroyObserver(),g.chat.context.off("changed:chat.emotes.animated",this.updateSettingState,this),g.chat.context.off("changed:chat.emote-menu.stay-loaded",this.updateSettingState,this),g.chat.context.off("changed:chat.emote-menu.show-quick-nav",this.updateSettingState,this),g.chat.context.off("changed:chat.emote-menu.show-heading",this.updateSettingState,this),g.chat.context.off("changed:chat.emote-menu.reduced-padding",this.updateSettingState,this),g.chat.context.off("changed:chat.emote-menu.combine-tabs",this.updateSettingState,this),g.chat.context.off("changed:chat.emote-menu.show-search",this.updateSettingState,this),g.chat.context.off("changed:chat.emote-menu.clear-search",this.updateSettingState,this),g.chat.context.off("changed:chat.emote-menu.tall",this.updateSettingState,this),window.ffz_menu===this&&(window.ffz_menu=null)}updateSettingState(){this.setState({stayLoaded:g.chat.context.get("chat.emote-menu.stay-loaded"),quickNav:g.chat.context.get("chat.emote-menu.show-quick-nav"),animated:g.chat.context.get("chat.emotes.animated"),showHeading:g.chat.context.get("chat.emote-menu.show-heading"),reducedPadding:g.chat.context.get("chat.emote-menu.reduced-padding"),combineTabs:g.chat.context.get("chat.emote-menu.combine-tabs"),showSearch:g.chat.context.get("chat.emote-menu.show-search"),clearSearch:g.chat.context.get("chat.emote-menu.clear-search"),tall:g.chat.context.get("chat.emote-menu.tall")})}seeEffects(){this.state.hasNewEffects&&(g.settings.provider.set("unlocked-effects",this.state.unlockedEffects),this.setState({hasNewEffects:!1}))}pickTone(Q){Q=Q||null,g.settings.provider.set("emoji-tone",Q),this.setState(this.filterState(this.state.filter,this.buildEmoji(Object.assign({},this.state,{tone:Q}))))}clickSideNav(Q){const le=Q.currentTarget.dataset.key,he=this.ref?.querySelector?.(`section[data-key="${le}"]`);he&&(this.lock_active=!0,$(he),this.setState({active_nav:le}),setTimeout(()=>this.lock_active=!1,250))}clickTab(Q){const le=Q.currentTarget.dataset.tab;if(le==="effect"&&this.seeEffects(),this.state.combineTabs){let he;switch(le){case"fav":he=this.state.filtered_fav_sets;break;case"channel":he=this.state.filtered_channel_sets;break;case"effect":he=this.state.filtered_effect_sets;break;case"emoji":he=this.state.filtered_emoji_sets;break;case"all":default:he=this.state.filtered_all_sets;break}const be=he&&he[0],Ce=be&&this.ref?.querySelector?.(`section[data-key="${be.key}"]`);Ce&&$(Ce);return}this.setState({tab:le})}clickSettings(Q){const le=new o.FFZEvent({item:"chat.emote_menu",event:Q,errored:!1});g.emit("main_menu:open",le)}toggleVisibilityControl(){this.setState(this.filterState(this.state.filter,this.state,!this.state.visibility_control))}handleFilterChange(Q){this.setState(this.filterState(Q.target.value,this.state))}handleKeyDown(Q){if(Q.keyCode===R.KEYS.Escape)this.props.toggleVisibility();else return;Q.preventDefault()}loadData(Q=!1,le,he){if(he=he||this.state,!he)return!1;le=le||this.props;const be=le.emote_data&&le.emote_data.emoteSets,Ce=Array.isArray(be)?new Set(be.map(ze=>ze.id)):new Set;return Q=Q||he.set_data&&!(0,B.set_equals)(he.set_sets,Ce),he.set_data&&!Q?!1:(this.setState({loading:!0},()=>{g.getData(Ce,Q).then(ze=>{this.setState(this.filterState(this.state.filter,this.buildState(this.props,Object.assign({},this.state,{set_sets:Ce,set_data:ze,loading:!1}))))})}),!0)}loadFFZPlanData(Q=!1,le,he){return he=he||this.state,!he||he.ffz_plan_loading||he.ffz_sub_data&&!Q?!1:(this.setState({ffz_plan_loading:!0},()=>{g.getFFZSubPrices().then(be=>{this.setState(this.filterState(this.state.filter,this.buildState(this.props,Object.assign({},this.state,{ffz_plan_data:be,ffz_plan_loading:!1}))))})}),!0)}loadFFZSubData(Q=!1,le,he){return he=he||this.state,!he||he.ffz_loading||he.ffz_sub_data&&!Q?!1:(this.setState({ffz_loading:!0},()=>{g.getFFZSubData().then(be=>{this.setState(this.filterState(this.state.filter,this.buildState(this.props,Object.assign({},this.state,{ffz_sub_data:be,ffz_loading:!1}))))})}),!0)}filterState(Q,le,he){const be=Object.assign({},le);return he!=null?be.visibility_control=he:he=be.visibility_control,be.filter=Q,be.filtered=Q&&Q.length>0&&Q!==":"||!1,be.filtered_channel_sets=this.filterSets(Q,be.channel_sets,he),be.filtered_effect_sets=this.filterSets(Q,be.effect_sets,he),be.filtered_all_sets=this.filterSets(Q,be.all_sets,he),be.filtered_fav_sets=this.filterSets(Q,be.fav_sets,he),be.filtered_emoji_sets=this.filterSets(Q,be.emoji_sets,he),be.has_effect_tab=be.filtered_effect_sets.length>0,be}filterSets(Q,le,he){const be=[];if(!le||!le.length)return be;const Ce=Q&&Q.length>0&&Q!==":",ze=D.get("emote-menu.hidden-sets")||[];for(const Me of le){if(!he&&ze.includes(Me.key))continue;(Me.filtered_emotes=Me.emotes.filter(ye=>!he&&ye.hidden?!1:!Ce||!ye.locked&&this.doesEmoteMatch(Q,ye))).length&&be.push(Me)}return be}doesEmoteMatch(Q,le){if(!Q||!Q.length)return!0;const he=le.search||le.name,be=he.toLowerCase(),Ce=Q.toLowerCase(),ze=Q.startsWith(":"),Me=Ce.slice(1);if(Array.isArray(le.extra)){let ye=le.extra.length;for(;ye--;){if(!ze&&le.extra[ye].includes(Ce))return!0;if(ze&&le.extra[ye].startsWith(Me))return!0}}if(!ze)return be.includes(Ce);if(be.startsWith(Me))return!0;const ce=he.indexOf(Q.charAt(1).toUpperCase());return ce!==-1?be.slice(ce+1).startsWith(Ce.slice(2)):!1}buildEmoji(Q){const le=Object.assign({},Q),he=le.emoji_sets=[],be=g.emotes.getFavorites("emoji"),Ce=le.favorites=(le.favorites||[]).filter(ye=>!ye.emoji),ze=le.tone=le.tone||null,Me=le.tone_emoji=[],ce={};if(g.chat.context.get("chat.emote-menu.show-emoji")){let ye=g.chat.context.get("chat.emoji.style")||"twitter";a.Vf[ye]||(ye="twitter");for(const we of Object.values(g.emoji.emoji)){if(!we||!we.has[ye]||a.D3.includes(we.category))continue;if(we.variants){for(const it of we.names)if(x.includes(it)){Me.push(we);break}}const Ae=be.includes(we.code),$e=we.variants&&we.variants[ze],Ne=$e&&$e.has[ye],tt=Ne?$e:we;let qe=ce[we.category];qe||(qe=ce[we.category]=[],he.push({key:`emoji-${we.category}`,sort_key:a.of.indexOf(we.category),emoji:!0,image:g.emoji.getFullImage(tt.image),i18n:`emoji.category.${we.category.toSnakeCase()}`,title:a.aA[we.category]||we.category,src:"emoji",source:"Emoji",source_i18n:"emote-menu.emoji",emotes:qe}));const ot={provider:"emoji",id:we.sort,emoji:!0,code:we.code,name:tt.raw,variant:Ne&&ze,hidden:we.hidden,search:we.names[0],extra:we.names.length>1?we.names.map(it=>it.toLowerCase()):null,height:18,width:18,x:tt.sheet_x,y:tt.sheet_y,favorite:Ae,src:g.emoji.getFullImage(tt.image),srcSet:g.emoji.getFullImageSet(tt.image)};qe.push(ot),Ae&&Ce.push(ot)}}return le.has_emoji_tab=he.length>0,le.fav_sets=[{key:"favorites",title:"Favorites",i18n:"emote-menu.favorites",icon:"star",source:"",is_favorites:!0,emotes:Ce}],Ce.sort(this.getSorter()),he.sort(k),le}getAllSets(){return[...this.state.channel_sets||[],...this.state.effect_sets||[],...this.state.all_sets||[]]}getSorter(){return b[g.chat.context.get("chat.emote-menu.sort-emotes")]||b[0]||(()=>0)}buildState(Q,le){const he=Object.assign({},le),be=he.set_data||{},Ce=he.emote_modifiers={},ze=he.channel_sets=[],Me=he.all_sets=[],ce=he.effect_sets=[],ye=he.favorites=[];if(Q.loading||Q.error||he.loading||he.set_data&&this.loadData(!1,Q,he))return he;const we=this.getSorter(),Ae=g.chat.context.get("chat.emote-menu.sort-tiers-last"),$e=G((Ue,Be)=>{if(Ue.misc||Be.misc)return we(Ue,Be);if(!Ue.locked&&Be.locked)return-1;if(Ue.locked&&!Be.locked)return 1;if(Ae||Ue.locked||Be.locked)if(Ue.bits||Be.bits){if(Be.bits){if(!Ue.bits)return-1}else return 1;const at=Ue.bit_value||0,lt=Be.bit_value||0;if(c){const Qe=c.compare(at,lt);if(Qe!=0)return Qe}else{if(at<lt)return-1;if(at>lt)return 1}}else if(c){const at=c.compare(Ue.set_id,Be.set_id);if(at!=0)return at}else{if(Ue.set_id<Be.set_id)return-1;if(Ue.set_id>Be.set_id)return 1}return we(Ue,Be)},"sort_emotes"),Ne=Q.channel_data&&Q.channel_data.user,tt=Ne&&Ne.subscriptionProducts,qe=Ne&&Q.channel_data?.channel?.localEmoteSets,ot=Ne&&Ne.self?.follower!=null,it=!ot&&Q.user_id&&Ne?.id!=Q.user_id,st=Ne?.cheer?.badgeTierEmotes,pt=new Set;if(Array.isArray(qe))for(const Ue of qe)Ue?.id&&pt.add(Ue.id);const nt=Q.emote_data&&Q.emote_data.emoteSets,yt=Q.emote_data&&Q.emote_data.emoteMap,ht=g.emotes.getFavorites("twitch"),ut=g.emotes.getHidden("twitch"),He=new Set,We=[],Ke={},dt=new Set;if(Array.isArray(nt))for(const Ue of nt){if(!Ue||!Array.isArray(Ue.emotes))continue;const Be=Ue.id,at=parseInt(Be,10),lt=Ue.owner,Qe=pt.has(Be),et=!Qe&&at>5e8,Ze=R.TWITCH_POINTS_SETS.includes(at)||lt?.login==="channel_points",Re=Qe?Ne:Ze?null:lt,je=be[Be],Ye=et&&lt&&lt.id==Ne?.id;dt.add(Be);let Ge=`twitch-set-${Be}`,Le=0,Ve="twitch",Je=Re&&(Re.displayName||Re.login);if(Je?(Ge=`twitch-${Re?.id}`,Qe?g.emotes.setTwitchSetChannel(Be,{id:Be,type:R.EmoteTypes.Follower,owner:{id:Re.id,login:Re.login,displayName:Re.displayName}}):et?g.emotes.setTwitchSetChannel(Be,{id:Be,type:R.EmoteTypes.BitsTier,owner:{id:Re.id,login:Re.login,displayName:Re.displayName}}):g.emotes.setTwitchSetChannel(Be,{id:Be,type:R.EmoteTypes.Subscription,owner:{id:Re.id,login:Re.login,displayName:Re.displayName}})):Re?Je=g.i18n.t("emote-menu.unknown-set","Set #{set_id}",{set_id:Be}):Ze?(Je=g.i18n.t("emote-menu.points","Unlocked with Points"),Ge="twitch-points",Ve="channel-points",Le=45):R.TWITCH_GLOBAL_SETS.includes(at)?(Je=g.i18n.t("emote-menu.global","Global Emotes"),Ge="twitch-global",Le=100,g.emotes.setTwitchSetChannel(Be,{id:Be,type:R.EmoteTypes.Global,owner:null})):R.TWITCH_PRIME_SETS.includes(at)?(Je=g.i18n.t("emote_menu.prime","Prime"),Ge="twitch-prime",Ve="crown",Le=75,g.emotes.setTwitchSetChannel(Be,{id:Be,type:R.EmoteTypes.Prime,owner:null})):(Je=g.i18n.t("emote-menu.misc","Miscellaneous"),Ge="twitch-misc",Ve="inventory",Le=50),Qe)continue;let ft,mt;Ke[Ge]?(ft=Ke[Ge],mt=ft.emotes,je&&ft.bad&&(ft.bad=!1,ft.renews=je.renews,ft.ends=je.ends,ft.prime=je.prime,ft.gift=je.gift)):(mt=[],ft=Ke[Ge]={sort_key:Le,key:Ge,image:Re?.profileImageURL,image_large:!0,icon:Ve,title:Je,source:g.i18n.t("emote-menu.twitch","Twitch"),emotes:mt,renews:je?.renews,ends:je?.ends,prime:je?.prime,gift:je?.gift},je||(ft.bad=!0));let St=0;for(const gt of Ue.emotes){if(!gt||!gt.id||!gt.token)continue;const At=gt.id,Dt=R.KNOWN_CODES[gt.token]||gt.token,kt=yt&&yt[Dt];Ze||g.emotes.setTwitchEmoteSet(At,Be);const Tt=[""];if(Array.isArray(gt.modifiers)&&gt.modifiers.length&&g.chat.context.get("chat.emote-menu.modifiers")===1)for(const xt of gt.modifiers)Tt.push(`_${xt.code}`);for(const xt of Tt){const _t=`${At}${xt}`,Lt=`${Dt}${xt}`,Pt=ht.includes(_t),$t=kt&&kt.id!=_t,Mt=R.REPLACEMENTS[_t];let Ft,Ot,Bt,Rt;Mt&&g.chat.context.get("chat.fix-bad-emotes")?Ft=`${R.REPLACEMENT_BASE}${Mt}`:(Ft=(0,B.getTwitchEmoteURL)(_t,1,!1),Ot=(0,B.getTwitchEmoteSrcSet)(_t,!1),Bt=(0,B.getTwitchEmoteURL)(_t,1,!0),Rt=(0,B.getTwitchEmoteSrcSet)(_t,!0));const zt={provider:"twitch",id:_t,set_id:Be,name:Lt,src:Ft,srcSet:Ot,animSrc:Bt,animSrcSet:Rt,order:St++,overridden:$t?kt.id:null,misc:!Re,bits:et,hidden:ut.includes(_t),favorite:Pt};mt.push(zt),Ye&&We.push(zt),Pt&&!He.has(_t)&&ye.push(zt),He.add(_t)}}mt.length&&(mt.sort($e),Me.includes(ft)||Me.push(ft))}if(Array.isArray(qe)||Array.isArray(tt)||Array.isArray(st)){const Ue=g.badges.getTwitchBadge("subscriber","0",Ne.id,Ne.login),Be=[],at=new Set,lt={},Qe={sort_key:-10,key:"twitch-current-channel",hide_key:`twitch-${Ne.id}`,image:Ue&&Ue.image1x,image_set:Ue&&`${Ue.image1x} 1x, ${Ue.image2x} 2x, ${Ue.image4x} 4x`,icon:"twitch",title:g.i18n.t("emote-menu.main-set","Channel Emotes"),source:g.i18n.t("emote-menu.twitch","Twitch"),emotes:Be,locks:lt,all_locked:!0};if(Array.isArray(qe))for(const Ze of qe){if(!Ze||!Array.isArray(Ze.emotes))continue;const Re=Ze.id;let je;it&&(lt[Re]={set_id:Re,id:"follower",user:Ne?.displayName||Ne?.login,hide_button:!0,emotes:je=new Set});let Ye=0;for(const Ge of Ze.emotes){if(!Ge||!Ge.id||!Ge.token)continue;const Le=Ge.id,Ve=R.KNOWN_CODES[Ge.token]||Ge.token,Je=He.has(Le),ft=ht.includes(Le),mt={provider:"twitch",id:Le,set_id:Re,name:Ve,order:Ye++,src:(0,B.getTwitchEmoteURL)(Le,1,!1),srcSet:(0,B.getTwitchEmoteSrcSet)(Le,!1),animSrc:(0,B.getTwitchEmoteURL)(Le,1,!0),animSrcSet:(0,B.getTwitchEmoteSrcSet)(Le,!0),favorite:ft,hidden:ut.includes(Le),locked:it,lock_icon:"heart"};Be.push(mt),ft&&!Je&&ye.push(mt),He.add(Le),je&&je.add(Le)}}if(Array.isArray(tt))for(const Ze of tt){if(!Ze||!Array.isArray(Ze.emotes))continue;const Re=Ze.emoteSetID,je=be[Re],Ye=!dt.has(Re);let Ge;je&&(Qe.renews=je.renews,Qe.ends=je.ends,Qe.prime=je.prime,Qe.gift=je.gift&&je.gift.isGift),Ye?lt[Re]={set_id:Re,id:Ze.id,price:Ze.price||m[Ze.tier],url:Ze.url,emotes:Ge=new Set(at)}:Qe.all_locked=!1;let Le=0;for(const Ve of Ze.emotes){if(!Ve||!Ve.id||!Ve.token)continue;const Je=Ve.id,ft=R.KNOWN_CODES[Ve.token]||Ve.token,mt=He.has(Je),St=ht.includes(Je),gt={provider:"twitch",id:Je,set_id:Re,name:ft,order:Le++,locked:Ye&&!mt,src:(0,B.getTwitchEmoteURL)(Je,1,!1),srcSet:(0,B.getTwitchEmoteSrcSet)(Je,!1),animSrc:(0,B.getTwitchEmoteURL)(Je,1,!0),animSrcSet:(0,B.getTwitchEmoteSrcSet)(Je,!0),favorite:St,hidden:ut.includes(Je)};Be.push(gt),!Ye&&St&&!mt&&ye.push(gt),He.add(Je),Ge&&(at.add(Je),Ge.add(Je))}}const et=new Set;if(Array.isArray(st)){let Ze;for(const Re of st){if(!Re||!Re.id||!Re.bitsBadgeTierSummary)continue;const je=Re.id,Ye=Re.setID,Ge=Re.bitsBadgeTierSummary,Le=!He.has(je)&&!Ge.self?.isUnlocked;Le&&(lt[Ye]={set_id:Ye,id:"cheer",price:null,bits:Ge.threshold,bits_remaining:Ge.self?.numberOfBitsUntilUnlock??Ge.threshold,emotes:new Set([Re.id])});const Ve=ht.includes(je),Je={provider:"twitch",id:je,set_id:Ye,name:Re.token,locked:Le,order:Ze++,src:(0,B.getTwitchEmoteURL)(je,1,!1),srcSet:(0,B.getTwitchEmoteSrcSet)(je,!1),animSrc:(0,B.getTwitchEmoteURL)(je,1,!0),animSrcSet:(0,B.getTwitchEmoteSrcSet)(je,!0),bits:!0,bit_value:Ge.threshold,favorite:Ve,hidden:ut.includes(je)};Be.push(Je),!Le&&Ve&&!He.has(je)&&ye.push(Je),et.add(je),He.add(je)}}if(We.length)for(const Ze of We)et.has(Ze.id)||Be.push(Ze);Be.length&&(Be.sort($e),ze.push(Qe))}let rt=!1,vt=!1,bt=!1;const wt=[...g.settings.provider.get("unlocked-effects",[])];if(g.chat.context.get("chat.emotes.enabled")>1){const Ue=g.site.getUser(),Be=g.chat.context.get("chat.emote-menu.effect-tab"),at=g.emotes.getRoomSetsWithSources(Ue?.id,Ue?.login,Q.channel_id,null),lt=g.emotes.getSubSetsWithSources(),Qe=g.emotes.getGlobalSetsWithSources(Ue?.id,Ue?.login),et=new Set,Ze={};let Re={};for(const[Ye,Ge,Le]of at){if(et.has(Ye))continue;et.add(Ye);const Ve=this.processFFZSet(Ye,Ge,ye,Ze,Re,!1,void 0,Le,Q.channel_id);Ve&&(Ve.emotes.sort($e),ze.includes(Ve)||ze.push(Ve))}Re={};const je=Qe.map(Ye=>Ye?.[0]?.id);for(const[Ye,Ge]of lt){if(et.has(Ye))continue;et.add(Ye);const Le=!je.includes(Ye.id);rt=!0;const Ve=this.processFFZSet(Ye,Ge,ye,Ze,Re,Le,he);Ve&&(Ve.emotes.sort($e),Be&&!ce.includes(Ve)&&Ve.has_effects?(bt=this.checkNewEffects(Ve.emotes,wt)||bt,ce.push(Ve)):Me.includes(Ve)||Me.push(Ve))}Re={};for(const[Ye,Ge]of Qe){if(et.has(Ye))continue;et.add(Ye);const Le=this.processFFZSet(Ye,Ge,ye,Ze,Re);Le&&(Le.emotes.sort($e),Be&&!ce.includes(Le)&&Le.has_effects?(bt=this.checkNewEffects(Le.emotes,wt)||bt,ce.push(Le)):Me.includes(Le)||Me.push(Le),!ze.includes(Le)&&(0,B.maybe_call)(Le.force_global,this,Ye,Q.channel_data&&Q.channel_data.user,Ue)&&ze.push(Le))}}return he.wants_resub_info=rt,he.wants_plan_info=vt,this.props.visible&&(he.tab==="effects"&&(bt=!1),vt&&this.loadFFZPlanData(),rt&&this.loadFFZSubData()),ze.sort(k),ce.sort(k),Me.sort(k),he.has_channel_tab=ze.length>0,he.has_effect_tab=ce.length>0,he.hasNewEffects=ce.length>0&&bt,he.unlockedEffects=wt,this.buildEmoji(he)}checkNewEffects(Q,le){let he=!1;for(const be of Q)be&&!be.locked&&be.id&&be.provider==="ffz"&&!le.includes(be.id)&&(he=!0,le.push(be.id));return he}processFFZSet(Q,le,he,be,Ce,ze=!1,Me,ce,ye=null){if(!Q||!Q.emotes)return null;let we;if(ce){const He=g.parent.shared_room_data?.get(ce);we=He?.displayName??He?.login}const Ae=Q.source||"ffz",$e=g.emotes.getFavorites(Ae),Ne=g.emotes.getHidden(Ae),tt=be[Ae]=be[Ae]||new Set,qe=`${Q.merge_source||Ae}-${Q.merge_id||Q.id}`,ot=g.emotes.providers.get(le),it=ot&&ot.menu_name?ot.menu_i18n_key?g.i18n.t(ot.menu_i18n_key,ot.menu_name,ot):ot.menu_name:Q.source||"FFZ",st=le==="ffz-main"||Q.title_is_channel?we?g.i18n.t("emote-menu.source-set","{channel}'s Emotes",{channel:we}):g.i18n.t("emote-menu.main-set","Channel Emotes"):Q.title||g.i18n.t("emote-menu.unknown-set","Set #{set_id}",{set_id:Q.id});let pt=ot&&ot.sort_key||Q.sort;pt==null&&(pt=Q.title.toLowerCase().includes("global")?100:0),ce&&ce!==ye&&(pt+=50);let nt,yt,ht;Ce[qe]?(nt=Ce[qe],yt=nt.emotes,qe===`${Ae}-${Q.id}`&&Object.assign(nt,{sort_key:pt,image:Q.icon,title:st,source:it,channel_source:we,force_global:Q.force_global})):(yt=[],nt=Ce[qe]={sort_key:pt,key:qe,image:Q.icon,icon:"zreknarf",title:st,source:it,channel_source:we,emotes:yt,force_global:Q.force_global,all_locked:!0});const ut=(Me||this.state)?.ffz_sub_data?.sets?.[Q.id];ut&&(nt.renews=ut.next_bill_date,nt.ends=ut.expires_at),ze?(nt.locks=nt.locks||{},nt.locks[Q.id]={set_id:Q.id,id:"subwoofer",is_ffz:!0,price:"More Info",url:"https://www.frankerfacez.com/subscribe",emotes:ht=new Set}):nt.all_locked=!1;for(const He of Object.values(Q.emotes))if(!He.hidden){const We=$e.includes(He.id),Ke={provider:"ffz",id:He.id,set_id:Q.id,src:He.src,srcSet:He.srcSet,animSrc:He.animSrc,animSrcSet:He.animSrcSet,effects:He.modifier?He.modifier_flags:0,effect_prefix:He.modifier?He.modifier_prefix:!1,name:He.name,favorite:We,locked:ze,hidden:Ne.includes(He.id),height:He.height,width:He.width};yt.push(Ke),!ze&&We&&!tt.has(He.id)&&(he.push(Ke),tt.add(He.id)),ze&&ht.add(He.id),He.modifier&&He.modifier_flags&&(nt.has_effects=!0)}if(yt.length)return nt}rebuildData(){const Q=this.buildState(this.props,this.state);this.setState(this.filterState(Q.filter,Q))}componentDidUpdate(Q){if(this.props.visible&&!Q.visible&&(this.loadData(),this.state.wants_plan_info&&this.loadFFZPlanData(),this.state.wants_resub_info&&this.loadFFZSubData()),!this.props.visible&&Q.visible&&this.state.clearSearch){this.setState(this.filterState("",this.state));return}const le=this.props.channel_data,he=Q.channel_data,be=le?.user!==he?.user||le?.channel!==he?.channel,Ce=this.props.emote_data,ze=Q.emote_data,Me=!(0,B.deep_equals)(Ce?.emoteSets,ze?.emoteSets)||!(0,B.deep_equals)(Ce?.emoteMap,ze?.emoteMap);(be||Me||this.props.user_id!==Q.user_id||this.props.channel_id!==Q.channel_id||this.props.loading!==Q.loading||this.props.error!==Q.error)&&(g.log.debug("Updating emote menu data. cd",be,", ed",Me),this.rebuildData())}renderError(){return H("div",{class:"tw-align-center tw-pd-1"},H("div",{class:"tw-mg-b-1"},H("div",{class:"tw-mg-2"},H("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),g.i18n.t("emote-menu.error","There was an error rendering this menu.")),H("button",{class:"tw-button",onClick:this.forceUpdate},H("span",{class:"tw-button__text"},g.i18n.t("error.try-again","Try Again"))))}renderEmpty(){return H("div",{class:"tw-align-center tw-pd-1"},H("div",{class:"tw-mg-2"},H("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),this.state.filtered?g.i18n.t("emote-menu.empty-search","There are no matching emotes."):this.state.tab==="fav"?g.i18n.t("emote-menu.empty-favs","You don't have any favorite emotes. To favorite an emote, find it and {hotkey}-Click it.",{hotkey:R.IS_OSX?"\u2318":"Ctrl"}):g.i18n.t("emote-menu.empty","There's nothing here."))}renderLoading(){return H("div",{class:"tw-align-center tw-pd-1"},H("h1",{class:"tw-mg-5 ffz-i-zreknarf loading"}),g.i18n.t("emote-menu.loading","Loading..."))}render(){if(!this.props.visible&&(!this.state.stayLoaded||!this.loadedOnce))return null;const Q=this.state.loading||this.props.loading,le=this.state.reducedPadding,he=this.state.combineTabs;Q||(this.loadedOnce=!0);let be,Ce,ze,Me,ce;if(he)Ce=[this.state.filtered_fav_sets,this.state.filtered_channel_sets,this.state.filtered_effect_sets,this.state.filtered_all_sets,this.state.filtered_emoji_sets].flat();else switch(be=this.state.tab||g.chat.context.get("chat.emote-menu.default-tab"),(be==="effect"&&!this.state.has_effect_tab||be==="channel"&&!this.state.has_channel_tab||be==="emoji"&&!this.state.has_emoji_tab)&&(be="all"),ze=be==="emoji",Me=be==="fav",ce=be==="effect",be){case"fav":Ce=this.state.filtered_fav_sets;break;case"channel":Ce=this.state.filtered_channel_sets;break;case"effect":Ce=this.state.filtered_effect_sets;break;case"emoji":Ce=this.state.filtered_emoji_sets;break;case"all":default:Ce=this.state.filtered_all_sets;break}const ye=this.state.visibility_control,we=this.props.source==="whisper";return H("div",{class:`tw-block${this.props.visible?"":" tw-hide"}`,style:{display:this.props.visible?null:"none !important"}},H("div",{class:"tw-absolute ffz-attached ffz-attached--right ffz-attached--up"},H("div",{class:`ffz-balloon ffz-balloon--auto tw-inline-block tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-2 ffz--emote-picker${this.state.tall?" ffz--emote-picker__tall":""}${le?" reduced-padding":""}`,"data-a-target":"emote-picker",role:"dialog"},H("div",{class:`emote-picker${we?"__whisper":""}`},H("div",{class:"tw-flex"},H("div",{class:`emote-picker__tab-content${we?"-whisper":""} tw-full-width scrollable-area scrollable-area--suppress-scroll-x`,"data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},H("div",{ref:this.saveScrollRef,class:"simplebar-scroll-content"},H("div",{class:"simplebar-content"},Q&&this.renderLoading(),!Q&&Ce&&Ce.map((Ae,$e)=>Ae&&(!ye||!Ae.emoji&&!Ae.is_favorites)&&H(Ae.emoji?g.EmojiSection:g.MenuSection,{key:Ae.key,idx:$e,data:Ae,ffz_sub_data:this.state.ffz_sub_data,emote_modifiers:this.state.emote_modifiers,animated:this.state.animated,combineTabs:this.state.combineTabs,showHeading:this.state.showHeading,filtered:this.state.filtered,visibility_control:ye,onClickToken:this.props.onClickToken,addSection:this.addSection,removeSection:this.removeSection,startObserving:this.startObserving,stopObserving:this.stopObserving})),!Q&&(!Ce||!Ce.length)&&this.renderEmpty()))),!Q&&this.state.quickNav&&!Me&&H("div",{class:`emote-picker__nav_content${we?"-whisper":""} tw-block tw-border-radius-none tw-c-background-alt-2`},H("div",{class:`emote-picker__nav-content-overflow${we?"-whisper":""} scrollable-area scrollable-area--suppress-scroll-x`,"data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},H("div",{ref:this.saveNavRef,class:"simplebar-scroll-content"},H("div",{class:"simplebar-content"},!Q&&Ce&&Ce.map(Ae=>{if(!Ae||ye&&(Ae.is_favorites||Ae.emoji))return null;const $e=this.state.active_nav===Ae.key;return H("button",{key:Ae.key,class:`${$e?"emote-picker-tab-item-wrapper__active ":""}${le?"tw-mg-y-05":"tw-mg-y-1"} tw-c-text-inherit tw-interactable ffz-interactive ffz-interactable--hover-enabled ffz-interactable--default tw-block tw-full-width ffz-tooltip ffz-tooltip--no-mouse`,"data-key":Ae.key,"data-title":`${Ae.i18n?g.i18n.t(Ae.i18n,Ae.title):Ae.title}
${Ae.source_i18n?g.i18n.t(Ae.source_i18n,Ae.source):Ae.source}${Ae.channel_source?` (${Ae.channel_source})`:""}`,"data-tooltip-side":"left",onClick:this.clickSideNav},H("div",{class:`tw-align-items-center tw-flex tw-justify-content-center ${le?"":"tw-pd-x-05 "}tw-pd-y-05${$e?" emote-picker-tab-item-avatar__active tw-c-text-link":""}`},Ae.image?H("figure",{class:"ffz-avatar ffz-avatar--size-20"},H("img",{class:"tw-block tw-border-radius-rounded tw-img tw-image-avatar",src:Ae.image,srcSet:Ae.image_set})):H("figure",{class:`ffz-emote-picker--nav-icon ffz-i-${Ae.icon||"zreknarf"}`})))}),he&&H("div",{class:"tw-mg-y-1 tw-mg-x-05 tw-border-t"}),he&&H("button",{class:"tw-mg-y-1 tw-c-text-inherit tw-interactable ffz-interactive ffz-interactable--hover-enabled ffz-interactable--default tw-block tw-full-width ffz-tooltip ffz-tooltip--no-mouse","data-title":g.i18n.t("emote-menu.settings","Open Settings"),"data-tooltip-side":"left",onClick:this.clickSettings},H("div",{class:`tw-align-items-center tw-flex tw-justify-content-center ${le?"":"tw-pd-x-05 "}tw-pd-y-05`},H("figure",{class:"ffz-emote-picker--nav-icon ffz-i-cog"})))))))),H("div",{class:"emote-picker__controls-container tw-relative"},(ze||this.state.showSearch)&&H("div",{class:"tw-border-t tw-pd-1"},H("div",{class:"tw-flex"},H("input",{type:"text",class:"tw-block tw-border-radius-medium tw-font-size-6 tw-full-width ffz-input tw-pd-x-1 tw-pd-y-05",placeholder:ze?g.i18n.t("emote-menu.search-emoji","Search for Emoji"):g.i18n.t("emote-menu.search","Search for Emotes"),value:this.state.filter,autoFocus:!0,autoCapitalize:"off",autoCorrect:"off",onChange:this.handleFilterChange,onKeyDown:this.handleKeyDown}),(he||ze)&&!ye&&this.state.has_emoji_tab&&H(g.EmojiTonePicker,{tone:this.state.tone,choices:this.state.tone_emoji,pickTone:this.pickTone}),(he||!ze)&&H("div",{class:"tw-relative ffz-il-tooltip__container tw-mg-l-1"},H("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon--primary ffz-core-button tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative${this.state.visibility_control?" ffz-core-button--primary":" tw-button-icon"}`,onClick:this.toggleVisibilityControl},H("span",{class:"tw-button-icon__icon tw-mg-x-05"},H("figure",{class:this.state.visibility_control?"ffz-i-eye-off":"ffz-i-eye"}))),H("div",{class:"ffz-il-tooltip ffz-il-tooltip--up ffz-il-tooltip--align-right"},this.state.visibility_control?g.i18n.t("emote-menu.toggle-hide.on","Exit Emote Visibility Control"):g.i18n.t("emote-menu.toggle-hide.off","Emote Visibility Control"),H("div",{class:"tw-mg-t-1 ffz--tooltip-explain"},g.i18n.t("emote-menu.toggle-hide.info","Emote Visibility Control allows you to hide emotes from your emote menu, either individually or by set. With Emote Visibility Control enabled, just click an emote to hide or unhide it. Please note that you will still see the emotes in chat if someone uses them, but they won't appear in your emote menu.")))))),he&&this.state.quickNav?null:H("div",{class:"emote-picker__tab-nav-container tw-flex tw-border-t tw-c-background-alt"},!ye&&H("div",{class:`emote-picker-tab-item${be==="fav"?" emote-picker-tab-item--active":""} tw-relative`},H("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${be==="fav"?" ffz-interactable--selected":""}`,id:"emote-picker__fav","data-tab":"fav","data-tooltip-type":"html","data-title":g.i18n.t("emote-menu.favorites","Favorites"),onClick:this.clickTab},H("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},H("figure",{class:"ffz-i-star"})))),this.state.has_channel_tab&&H("div",{class:`emote-picker-tab-item${be==="channel"?" emote-picker-tab-item--active":""} tw-relative`},H("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${be==="channel"?" ffz-interactable--selected":""}`,id:"emote-picker__channel","data-tab":"channel","data-tooltip-type":"html","data-title":g.i18n.t("emote-menu.channel","Channel"),onClick:this.clickTab},H("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},H("figure",{class:"ffz-i-camera"})))),this.state.has_effect_tab&&H("div",{class:`emote-picker-tab-item${be==="effect"?" emote-picker-tab-item--active":""} tw-relative`},H("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${be==="effect"?" ffz-interactable--selected":""}`,id:"emote-picker__effect","data-tab":"effect","data-tooltip-type":"html","data-title":g.i18n.t("emote-menu.effects","Emote Effects"),onClick:this.clickTab},this.state.hasNewEffects&&H("div",{class:"ffz-new-indicator"}),H("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},H("figure",{class:"ffz-i-fx"})))),H("div",{class:`emote-picker-tab-item${be==="all"?" emote-picker-tab-item--active":""} tw-relative`},H("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${be==="all"?" ffz-interactable--selected":""}`,id:"emote-picker__all","data-tab":"all","data-tooltip-type":"html","data-title":g.i18n.t("emote-menu.my-emotes","My Emotes"),onClick:this.clickTab},H("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},H("figure",{class:"ffz-i-channels"})))),!ye&&this.state.has_emoji_tab&&H("div",{class:`emote-picker-tab-item${be==="emoji"?" emote-picker-tab-item--active":""} tw-relative`},H("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${be==="emoji"?" ffz-interactable--selected":""}`,id:"emote-picker__emoji","data-tab":"emoji","data-tooltip-type":"html","data-title":g.i18n.t("emote-menu.emoji","Emoji"),onClick:this.clickTab},H("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},H("figure",{class:"ffz-i-smile"})))),H("div",{class:"tw-flex-grow-1"}),H("div",{class:"emote-picker-tab-item tw-relative"},H("button",{class:"ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive","data-tooltip-type":"html","data-title":g.i18n.t("emote-menu.settings","Open Settings"),onClick:this.clickSettings},H("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},H("figure",{class:"ffz-i-cog"}))))))))))}},G(ue,"FFZEmoteMenuComponent"),ue),this.fine.wrap("ffz-emote-menu",this.MenuComponent)}async getFFZSubPrices(){let g;try{g=await fetch(`${this.staging.api}/payment/plans`).then(K=>K.ok?K.json():null)}catch(K){this.log.error("Unable to load subscription prices from server.",K),g=null}const D={sets:{}};for(const K of Object.values(g.plans)){if(!Array.isArray(K.temporary_collections))continue;let H;for(const V of Object.values(g.gateway_plans))if(V.plan_id===K.id&&V.months===1){H=V.prices;break}if(H)for(const V of K.temporary_collections)D.sets[V]={plan_id:K.id,prices:H}}return D}async getFFZSubData(){if(!this.resolve("site").getUser())return null;const D=await this.resolve("socket").getBareAPIToken();if(!D)return null;let K;try{K=await fetch(`${this.staging.api}/v2/subscription/status?include=plan`,{headers:{Authorization:`Bearer ${D}`}}).then(V=>V.ok?V.json():null)}catch(V){this.log.error("Unable to load subscription status from server.",V),K=null}if(!K)return{error:!0};const H={has_free_sub:K.user?.bonus_month_eligible??!1,sets:{}};if(K.user?.active_subs)for(const V of Object.values(K.user.active_subs)){const E=K.plans?.[V.id];if(Array.isArray(E?.temporary_collections))for(const F of E.temporary_collections)H.sets[F]={plan_id:V.id,expires_at:V.expires_at?new Date(V.expires_at):null,next_bill_date:V.next_bill_date?new Date(V.next_bill_date):null}}return H}async getData(g,D,K=null,H=[]){if(this._data){if(!D&&(0,B.set_equals)(g,this._data_sets))return this._data;this._data=null,this._data_sets=null}let V;try{V=await this.apollo.client.query({query:C(),variables:{first:75,after:K,criteria:{filter:"ALL"}},fetchPolicy:D?"network-only":"cache-first"})}catch(Y){return this.log.warn("Error fetching additional emote menu data.",Y),this._data=null}const E={},F=(0,B.get)("data.currentUser.subscriptionBenefits.edges.@each.node",V),A=(0,B.get)("data.currentUser.subscriptionBenefits.pageInfo.hasNextPage",V),N=(0,B.get)("data.currentUser.subscriptionBenefits.edges.@last.cursor",V);if(H=H.concat(F),A)return this.getData(g,D,N,H);if(H&&H.length)for(const Y of H){const se=Y&&Y.product,ue=se&&se.emoteSetID;ue&&(E[ue]={ends:r(Y.endsAt),renews:r(Y.renewsAt),prime:Y.purchasedWithPrime,set_id:ue,type:se.type,gift:Y.gift?.isGift})}return this._data_sets=g,this._data=E}};G(De,"EmoteMenu");let h=De;h.getData=(0,B.once)(h.getData),h.getFFZSubData=(0,B.once)(h.getFFZSubData),h.getFFZSubPrices=(0,B.once)(h.getFFZSubPrices);const M=Intl.Collator(),L=Intl.Collator(void 0,{sensitivity:"accent"}),T=0,O=1,P=2,j=3,Z=4;function q(Oe){return Oe?Oe.type==="emote"?Oe.emoteName:Oe.type==="text"?Oe.text:Array.isArray(Oe.children)?Oe.children.map(q).join(""):"":""}G(q,"getNodeText");function X(Oe,g){let D=0,K=0,H=Oe;for(;K<g.length;){const V=g[K];for(let E=0;E<V;E++)D+=q(H[E]).length;H=Array.isArray(H[V])?H[V]:H[V]?.children,K++}return D}G(X,"getNodeOffset");const Ie=class Ie extends z.default{constructor(...g){super(...g),this.inject("chat"),this.inject("chat.actions"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.inject("site"),this.settings.add("chat.hype.display-input",{default:!0,ui:{path:"Chat > Hype Chat >> Input",title:"Allow the Hype Chat button to appear in the chat input element.",component:"setting-check-box"}}),this.settings.add("chat.inline-preview.enabled",{default:!0,ui:{path:"Chat > Input >> Appearance",title:"Display in-line previews of FrankerFaceZ emotes when entering a chat message.",description:"**Note:** This feature is temperamental. It may not display all emotes, and emote effects and overlay emotes are not displayed correctly. Once this setting has been enabled, it cannot be reasonably disabled and will remain active until you refresh the page.",component:"setting-check-box"}}),this.settings.add("chat.mru.enabled",{default:!0,ui:{path:"Chat > Input >> Recent Messages",title:"Allow pressing up and down to recall previously sent chat messages.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.ffz-emotes",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of FrankerFaceZ emotes.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.emoji",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of emoji.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.emotes-without-colon",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of emotes without typing a colon. (:)",description:"This will prevent the tab-completion of usernames without the @ prefix.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.limit-results",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Limit tab-completion results to 25.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.prioritize-favorites",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Prioritize favorite emotes at the top.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.prioritize-prefix-matches",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Prioritize emotes that start with user input.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.matching",{default:1,ui:{path:"Chat > Input >> Tab Completion",title:"Emote Matching Type",description:"1: `ppa` would match `Kappa`\n\n2: `sip` would match `cohhSip` but not `Gossip`\n\n3: `pasta` would match `pastaThat` but not `HoldThat`",component:"setting-select-box",data:[{value:1,title:"1: Anything (Twitch style)"},{value:2,title:"2: Non-Prefix (Old FFZ style)"},{value:3,title:"3: Exact (Case-Insensitive)"}]}}),this.ChatInput=this.fine.define("chat-input",D=>D&&D.setLocalChatInputRef&&D.setLocalAutocompleteInputRef,v.Z.CHAT_ROUTES),this.EmoteSuggestions=this.fine.define("tab-emote-suggestions",D=>D&&D.getMatches&&D.autocompleteType==="emote",v.Z.CHAT_ROUTES),this.MentionSuggestions=this.fine.define("tab-mention-suggestions",D=>D&&D.getMentions&&D.renderMention,v.Z.CHAT_ROUTES),this.CommandSuggestions=this.fine.define("tab-cmd-suggestions",D=>D&&D.getMatches&&D.doesCommandMatchTerm,v.Z.CHAT_ROUTES),this.EmoteUsageCount={TriHard:196568036,Kappa:192158118,"4Head":155758710,PogChamp:151485090,cmonBruh:146352878,BibleThump:56472964,WutFace:45069031,Kreygasm:41387580,DansGame:38097659,SMOrc:34734484,KappaPride:34262839,VoHiYo:27886434,SwiftRage:24561900,ResidentSleeper:24438298,EleGiggle:19891526,FailFish:19118343,NotLikeThis:18802905,Keepo:18351415,BabyRage:18220906,MingLee:18026207,HeyGuys:14851569,ANELE:14648986,PJSalt:14438861}}async onEnable(){this.chat.context.on("changed:chat.hype.display-input",()=>this.ChatInput.forceUpdate()),this.chat.context.on("changed:chat.actions.room",()=>this.ChatInput.forceUpdate()),this.chat.context.on("changed:chat.actions.room-above",()=>this.ChatInput.forceUpdate()),this.chat.context.on("changed:chat.tab-complete.emotes-without-colon",H=>{for(const V of this.EmoteSuggestions.instances)V.canBeTriggeredByTab=H;for(const V of this.MentionSuggestions.instances)V.canBeTriggeredByTab=!H}),this.use_previews=this.chat.context.get("chat.inline-preview.enabled"),this.chat.context.on("changed:chat.inline-preview.enabled",H=>{if(!this.use_previews&&(this.use_previews=H,H))for(const V of this.ChatInput.instances)this.installPreviewObserver(V),V.ffzInjectEmotes(),V.forceUpdate(),this.emit("site:dom-update","chat-input",V)});const g=await this.site.findReact(),D=g&&g.createElement;if(!D)return this.log.warn("Unable to get React.");const K=this;this.ChatInput.ready((H,V)=>{const E=H.prototype.render;H.prototype.render=function(){const F=E.call(this);try{if(!K.chat.context.get("chat.hype.display-input")){const he=(0,_.findReactFragment)(F,be=>be.key==="paidPinnedMessage");he&&(he.type=()=>null)}const N=K.chat.context.get("chat.actions.room-above"),Y=K.chat.context.get("context.chat_state")||{},se=N?(0,_.findReactFragment)(F,he=>he.props&&Array.isArray(he.props.children)):(0,_.findReactFragment)(F,he=>he.props&&he.props.className==="chat-input__buttons-container");if(!se||!se.props||!se.props.children)return F;const ue=this.props;if(!ue||!ue.channelID)return F;const _e=ue.sessionUser?{id:ue.sessionUser.id,login:ue.sessionUser.login,displayName:ue.sessionUser.displayName,mod:ue.isCurrentUserModerator,staff:ue.isStaff}:null,Q={id:ue.channelID,login:ue.channelLogin,displayName:ue.channelDisplayName,emoteOnly:ue.emoteOnlyMode,slowMode:ue.slowMode,slowDuration:ue.slowModeDuration,subsMode:ue.subsOnlyMode,r9kMode:Y.r9k,followersOnly:Y.followersOnly,followersDuration:Y.followersOnlyRequirement},le=K.actions.renderRoom(K.chat.context.get("context.chat.showModIcons"),_e,Q,N,D);N?se.props.children.unshift(le||null):se.props.children.splice(1,0,le||null)}catch(A){K.log.error(A),K.log.capture(A)}return F};for(const F of V)F.forceUpdate(),this.emit("site:dom-update","chat-input",F),this.updateEmoteCompletion(F),this.overrideChatInput(F),F.ffzInjectEmotes(),this.installPreviewObserver(F)}),this.EmoteSuggestions.ready((H,V)=>{for(const E of V)this.overrideEmoteMatcher(E)}),this.MentionSuggestions.ready((H,V)=>{for(const E of V)this.overrideMentionMatcher(E)}),this.CommandSuggestions.ready((H,V)=>{for(const E of V)this.overrideCommandMatcher(E)}),this.ChatInput.on("update",this.updateEmoteCompletion,this),this.ChatInput.on("mount",this.overrideChatInput,this),this.ChatInput.on("mount",this.installPreviewObserver,this),this.ChatInput.on("unmount",this.removePreviewObserver,this),this.EmoteSuggestions.on("mount",this.overrideEmoteMatcher,this),this.MentionSuggestions.on("mount",this.overrideMentionMatcher,this),this.CommandSuggestions.on("mount",this.overrideCommandMatcher,this),this.chat.context.on("changed:chat.emotes.animated",this.uncacheTabCompletion,this),this.chat.context.on("changed:chat.emotes.enabled",this.uncacheTabCompletion,this),this.chat.context.on("changed:chat.tab-complete.matching",this.uncacheTabCompletion,this),this.on("chat.emotes:change-hidden",this.uncacheTabCompletion,this),this.on("chat.emotes:change-set-hidden",this.uncacheTabCompletion,this),this.on("chat.emotes:change-favorite",this.uncacheTabCompletion,this),this.on("chat.emotes:update-default-sets",this.uncacheTabCompletion,this),this.on("chat.emotes:update-user-sets",this.uncacheTabCompletion,this),this.on("chat.emotes:update-room-sets",this.uncacheTabCompletion,this),this.on("site.css_tweaks:update-chat-css",this.resizeInput,this)}uncacheTabCompletion(){for(const g of this.EmoteSuggestions.instances)g.ffz_ffz_cache=null,g.ffz_twitch_cache=null;if(this.use_previews)for(const g of this.ChatInput.instances)g.ffzInjectEmotes(),g.forceUpdate(),this.emit("site:dom-update","chat-input",g)}updateInput(){for(const g of this.ChatInput.instances)g&&(g.forceUpdate(),this.emit("site:dom-update","chat-input",g))}resizeInput(){this._resize_waiter&&cancelAnimationFrame(this._resize_waiter),this._resize_waiter=requestAnimationFrame(()=>this._resizeInput())}_resizeInput(){this._resize_waiter=null;for(const g of this.ChatInput.instances)g.resizeInput()}installPreviewObserver(g){if(g._ffz_preview_observer||!window.MutationObserver||!this.use_previews)return;const D=this.fine.getHostNode(g),K=D&&D.querySelector(".chat-input__textarea");K&&(g._ffz_preview_observer=new MutationObserver(H=>{for(const V of H)for(const E of V.addedNodes)E instanceof Element&&this.checkForPreviews(g,E)}),g._ffz_preview_observer.observe(K,{childList:!0,subtree:!0}))}checkForPreviews(g,D){if(D.querySelector?.('span[data-a-target="chat-input-emote-preview"]'))for(const K of document.querySelectorAll(".tw-tooltip-layer img.chat-line__message--emote"))K&&K.src.startsWith("https://static-cdn.jtvnw.net/emoticons/v2/__FFZ__")&&this.updatePreview(g,K);for(const K of D.querySelectorAll?.("img.chat-line__message--emote"))K&&(K.dataset.ffzId||K.src.startsWith("https://static-cdn.jtvnw.net/emoticons/v2/__FFZ__"))&&this.updatePreview(g,K)}updatePreview(g,D){let K=D.dataset.ffzSet,H=D.dataset.ffzId;if(!H){const se=D.src.indexOf("__FFZ__",49),ue=D.src.slice(49,se),_e=ue.indexOf("::");if(_e===-1)return;K=ue.slice(0,_e),H=ue.slice(_e+2),D.dataset.ffzSet=K,D.dataset.ffzId=H}const V=this.emotes.emote_sets[K],E=V?.emotes?.[H];if(!E)return;const F=this.chat.context.get("chat.emotes.animated")>0;D.src=(F?E.animSrc:null)??E.src,D.srcset=(F?E.animSrcSet:null)??E.srcSet;const A=`${E.width}px`,N=`${E.height}px`;D.style.width=A,D.style.height=N;const Y=D.closest(".chat-image__container");if(Y){Y.style.width=A,Y.style.height=N;const se=Y.closest(".chat-line__message--emote-button");se&&(se.style.width=A,se.style.height=N,se._ffz_click_handler||(se._ffz_click_handler=this.previewClick.bind(this,E.id,V.id,E.name),se.addEventListener("click",se._ffz_click_handler)))}}previewClick(g,D,K,H){const V=this.makeEvent({provider:"ffz",id:g,set:D,name:K,source:H});this.emit("chat.emotes:click",V),V.defaultPrevented&&(H.preventDefault(),H.stopImmediatePropagation())}removePreviewObserver(g){g._ffz_preview_observer&&(g._ffz_preview_observer.disconnect(),g._ffz_preview_observer=null)}updateEmoteCompletion(g,D){D||(D=this.fine.searchTree(g,"tab-emote-suggestions",50)),D&&(D._ffz_user=g.props.sessionUser,D._ffz_channel_id=g.props.channelID,D._ffz_channel_login=g.props.channelLogin)}overrideChatInput(g){if(g._ffz_override)return;const D=this,K=g.onKeyDown,H=g.onMessageSend,V=g.resizeInput,E=g.componentDidUpdate;g.ffzInjectEmotes=function(){const F=this.props.emotes.findIndex(N=>N?.id==="FrankerFaceZWasHere"),A=D.createFakeEmoteSet(g);if(F===-1&&A)this.props.emotes.push(A);else if(F!==-1&&A)this.props.emotes.splice(F,1,A);else if(F!==-1&&!A)this.props.emotes.splice(F,1);else return},g.componentDidUpdate=function(F,...A){try{F.emotes!==this.props.emotes&&Array.isArray(this.props.emotes)&&g.ffzInjectEmotes()}catch(N){D.log.error("Error updating emote autocompletion data.",N)}E&&E.call(this,F,...A)},g.resizeInput=function(F,...A){try{if(F){if(g.chatInputRef instanceof Element){const N=getComputedStyle(g.chatInputRef),Y=N&&parseFloat(N.lineHeight||18)||18,se=Y*1+20.5,ue=Math.ceil((g.chatInputRef.scrollHeight-se)/Y),_e=Math.min(1+ue,4);g.setState({numInputRows:_e})}}else g.setState({numInputRows:1})}catch(N){return D.log.error("Error in resizeInput",N),V.call(this,F,...A)}},g.messageHistory=[],g.tempInput="",g.messageHistoryPos=-1,g.ffzGetValue=function(){return g.chatInputRef&&typeof g.chatInputRef.value=="string"?g.chatInputRef.value:g.state.value&&typeof g.state.value=="string"?g.state.value:""},g.ffzGetSelection=function(){if(typeof g.chatInputRef?.selectionEnd=="number")return[g.chatInputRef.selectionStart,g.chatInputRef.selectionEnd];if(g.chatInputRef?.state?.slateEditor){const F=g.chatInputRef.state.slateEditor,A=F.selection,N=F.children;if(!A?.anchor?.path||!A?.focus?.path)return[0,0];const Y=X(N,A.anchor.path)+A.anchor.offset,se=X(N,A.focus.path)+A.focus.offset;return Y<se?[Y,se]:[se,Y]}return[0,0]},g.ffzSetSelection=function(F,A){g.chatInputRef?.setSelectionRange&&g.chatInputRef.setSelectionRange(F,A)},g.onKeyDown=function(F){try{const A=F.charCode||F.keyCode;if(g.onEmotePickerToggle&&D.chat.context.get("chat.emote-menu.shortcut")&&F.key==="e"&&F.ctrlKey&&!F.altKey&&!F.shiftKey){g.onEmotePickerToggle(),F.preventDefault();return}const N=g.ffzGetValue();if(g.autocompleteInputRef&&g.chatInputRef&&D.chat.context.get("chat.mru.enabled")&&!F.shiftKey&&!F.ctrlKey&&!F.altKey){const Y=g.ffzGetSelection();if(A===38&&Y[0]===0&&Y[1]===0){if(!g.messageHistory.length)return;N&&g.messageHistoryPos===-1&&(g.tempInput=N),g.messageHistoryPos<g.messageHistory.length-1&&(g.messageHistoryPos++,g.autocompleteInputRef.setValue(g.messageHistory[g.messageHistoryPos]),g.ffzSetSelection(0));return}else if(A===40&&Y[0]>=N.length&&Y[1]===Y[0]){if(!g.messageHistory.length)return;g.messageHistoryPos>0?(g.messageHistoryPos--,g.autocompleteInputRef.setValue(g.messageHistory[g.messageHistoryPos]),g.ffzSetSelection(g.messageHistory[g.messageHistoryPos].length)):g.messageHistoryPos===0&&(g.autocompleteInputRef.setValue(g.tempInput),g.ffzSetSelection(g.tempInput.length),g.messageHistoryPos=-1);return}}A===R.KEYS.Escape&&!F.shiftKey&&!F.ctrlKey&&!F.altKey&&(g.props.isShowingEmotePicker?g.props.closeEmotePicker():g.props.tray&&(!g.state.value||!g.state.value.length)&&g.props.clearTray())}catch(A){D.log.capture(A),D.log.error(A)}K.call(this,F)},g.onMessageSend=function(F){try{if(D.chat.context.get("chat.mru.enabled")){const A=g.ffzGetValue();A&&A.length&&(!g.messageHistory.length||g.messageHistory[0]!==A)&&(g.messageHistory.unshift(A),g.messageHistory=g.messageHistory.slice(0,20)),g.messageHistoryPos=-1,g.tempInput=""}}catch(A){D.log.capture(A),D.log.error(A)}H.call(this,F)}}overrideMentionMatcher(g){g.canBeTriggeredByTab=!this.chat.context.get("chat.tab-complete.emotes-without-colon")}overrideCommandMatcher(g){if(g._ffz_override)return;g._ffz_override=!0,g.oldCommands=g.getCommands,g.oldMatches=g.getMatches,g.oldReplacement=g.determineReplacement;const D=this;g.getMatches=function(V,E,F){try{return F===0&&D.chat.CommandPrefixes.includes(V[0])?g.getCommands(V):null}catch(A){return D.log.error("Error getting matches from command handler.",A),g.oldCommands(V,E,F)}},g.getCommands=function(V){try{const E=g.props.getCommands(g.props.permissionLevel,{isEditor:g.props.isCurrentUserEditor}),F=D.fine.searchParent(g,_e=>_e?.props?.channelID&&_e?.props?.setTray,50),A=D.makeEvent({input:V,permissionLevel:g.props.permissionLevel,isEditor:g.props.isCurrentUserEditor,commands:E,__input:F,channel:F?{id:F.props.channelID,login:F.props.channelLogin}:null});if(D.emit("chat:get-tab-commands",A),!E||!E.length)return null;const N=V[0],Y=V.slice(1),se=E.filter(_e=>N===(_e.prefix??"/")&&g.doesCommandMatchTerm(_e,Y)).sort(g.sortCommands),ue=[];for(const _e of se){const Q=_e.commandArgs?.[0];let le;Q?.isRequired&&(le=`[${Q.name}]`),ue.push({current:V,replacement:g.determineReplacement(_e),description:_e.description,element:g.renderCommandSuggestion(_e,Y),group:_e.ffz_group?Array.isArray(_e.ffz_group)?D.i18n.t(..._e.ffz_group):_e.ffz_group:g.determineGroup(_e),selection:le})}return N!=="/"&&!ue.length?null:ue}catch(E){return console.error(E),g.oldCommands(V)}},g.determineReplacement=function(V){const E=g.oldReplacement(V);return(V.prefix??"/")!=="/"&&E.startsWith("/")?V.prefix+E.slice(1):E};const K=this.site.getReact(),H=K?.createElement;H&&(g.renderCommandSuggestion=function(V,E){const F=Array.isArray(V?.commandArgs)?V.commandArgs.map(A=>H("div",{class:`tw-mg-r-05${A.isRequired?"":" tw-c-text-alt"}`},"[",A.name,"]")):null;return H("div",{class:"tw-pd-05"},H("div",{class:"tw-flex"},H("div",{class:"tw-mg-r-05"},H("span",null,V.prefix??"/"),H("span",{class:"tw-semibold"},V.name)),F),H("p",{class:"tw-c-text-alt-2 tw-font-size-7"},V.description))})}createFakeEmoteSet(g){if(!this.use_previews)return null;if(!g._ffz_channel_login){const A=this.fine.searchParent(g,"chat-input",50);A&&this.updateEmoteCompletion(A,g)}const D=g._ffz_user,K=g._ffz_channel_id,H=g._ffz_channel_login;if(!H)return null;const V=this.emotes.getSets(D?.id,D?.login,K,H);if(!V||!V.length)return null;const E=[],F=new Set;for(const A of V){if(!A||!A.emotes)continue;const N=A.source||"ffz";for(const Y of Object.values(A.emotes))!Y||!Y.id||!Y.name||F.has(Y.name)||(F.add(Y.name),E.push({id:`__FFZ__${A.id}::${Y.id}__FFZ__`,modifiers:null,setID:"FrankerFaceZWasHere",token:Y.name}))}return{__typename:"EmoteSet",emotes:E,id:"FrankerFaceZWasHere",owner:null}}overrideEmoteMatcher(g){if(g._ffz_override)return;const D=this;g.canBeTriggeredByTab=this.chat.context.get("chat.tab-complete.emotes-without-colon"),g.getMatches=function(V,E){return E?V.length<2?null:g.getMatchedEmotes(V):V.startsWith(":")?V.length<3?null:g.getMatchedEmotes(V):null},g.doesEmoteMatchTerm=function(V,E){const F=V.name||V.token;if(!F)return T;if(F.startsWith(E))return Z;let A=V.tokenLower;A||(A=F.toLowerCase());const N=E.toLowerCase();if(A.startsWith(N))return j;const Y=F.indexOf(E.charAt(0).toUpperCase());return Y!==-1&&A.slice(Y+1).startsWith(N.slice(1))?P:A.includes(N)?O:T},g.getMatchedEmotes=function(V){const E=D.chat.context.get("chat.emotes.enabled"),F=D.chat.context.get("chat.tab-complete.limit-results");let A=E?D.getTwitchEmoteSuggestions(V,this):[];if(E>1&&D.chat.context.get("chat.tab-complete.ffz-emotes")){const N=D.getEmoteSuggestions(V,this);Array.isArray(N)&&N.length&&(A=A.concat(N))}if(D.chat.context.get("chat.tab-complete.emoji")){const N=D.getEmojiSuggestions(V,this);Array.isArray(N)&&N.length&&(A=Array.isArray(A)?A.concat(N):N)}return A=D.sortEmotes(A),F&&A.length>25?A.slice(0,25):A};const K=this.site.getReact(),H=K?.createElement;g.renderFFZEmojiSuggestion=function(V){return H(K.Fragment,null,H("div",{class:"tw-relative tw-flex-shrink-0 tw-pd-05",title:V.token,favorite:V.favorite},H("img",{class:"emote-autocomplete-provider__image ffz-emoji",src:V.src,srcSet:V.srcset}),V.favorite&&H("figure",{class:"ffz--favorite ffz-i-star"})),H("div",{class:"tw-ellipsis",title:V.token},V.token))},g.renderEmoteSuggestion=function(V){return H(K.Fragment,null,H("div",{class:"tw-relative tw-flex-shrink-0 tw-pd-05",title:V.token,favorite:V.favorite},H("img",{class:"emote-autocomplete-provider__image",srcSet:V.srcSet}),V.favorite&&H("figure",{class:"ffz--favorite ffz-i-star"})),H("div",{class:"tw-ellipsis",title:V.token},V.token))}}sortEmotes(g){const D=this.chat.context.get("chat.tab-complete.prioritize-favorites"),K=this.chat.context.get("chat.tab-complete.emotes-without-colon"),H=this.chat.context.get("chat.tab-complete.prioritize-prefix-matches");return g.sort((V,E)=>{const F=V.matched||V.replacement,A=E.matched||E.replacement;if(D&&V.favorite^E.favorite)return 0-V.favorite+E.favorite;if(H){const N=!!V.matched,Y=!!E.matched;if(N^Y)return K?0-N+Y:0-Y+N;const se=V.match_type===Z,ue=E.match_type===Z;if(se&&ue)return M.compare(F,A);if(se)return-1;if(ue)return 1;const _e=V.match_type===j,Q=E.match_type===j;return _e&&Q?L.compare(F,A):_e?-1:Q?1:M.compare(F,A)}return 0})}buildTwitchCache(g){if(!Array.isArray(g))return{emotes:[],length:0};const D=[],K=new Set,H=this.chat.context.get("chat.emotes.animated")>0,V=this.settings.provider.get("emote-menu.hidden-sets"),E=Array.isArray(V)&&V.length>0,F=this.emotes.getHidden("twitch"),A=this.emotes.getFavorites("twitch");for(const N of g){const Y=parseInt(N.id,10),se=N.owner,ue=R.TWITCH_POINTS_SETS.includes(Y)||se?.login==="channel_points",_e=ue?null:se;if(N.id==="FrankerFaceZWasHere")continue;let Q=`twitch-set-${N.id}`,le=null;if(_e?.login?(Q=`twitch-${_e.id}`,le=_e.displayName||_e.login):ue?Q="twitch-points":R.TWITCH_GLOBAL_SETS.includes(Y)?Q="twitch-global":R.TWITCH_PRIME_SETS.includes(Y)?Q="twitch-prime":Q="twitch-misc",!(E&&V.includes(Q)))for(const he of N.emotes){if(!he||!he.id||F.includes(he.id))continue;const be=he.id,Ce=R.KNOWN_CODES[he.token]||he.token;if(!Ce||K.has(Ce))continue;K.add(Ce);const ze=R.REPLACEMENTS[be];let Me;ze&&this.chat.context.get("chat.fix-bad-emotes")?Me=`${R.REPLACEMENT_BASE}${ze} 1x`:Me=(0,B.getTwitchEmoteSrcSet)(be,H),D.push({id:be,source:Q,extra:le,setID:N.id,token:Ce,tokenLower:Ce.toLowerCase(),srcSet:Me,favorite:A.includes(be)})}}return{emotes:D,length:g.length}}getTwitchEmoteSuggestions(g,D){D.ffz_twitch_cache?.length!==D.props.emotes?.length&&(D.ffz_twitch_cache=this.buildTwitchCache(D.props.emotes));const K=this.chat.context.get("chat.tab-complete.matching"),H=D.ffz_twitch_cache.emotes;if(!H.length)return[];const V=[],E=[],F=[],A=g.startsWith(":")?g.slice(1):g;for(const N of H){const Y=D.doesEmoteMatchTerm(N,A);if(Y<K)continue;const se={current:g,emote:N,replacement:N.token,element:D.renderEmoteSuggestion(N),favorite:N.favorite,count:this.EmoteUsageCount[N.token]||0,match_type:Y};Y<K||(se.count>0?V.push(se):Y>P?E.push(se):F.push(se))}return V.sort((N,Y)=>Y.count-N.count),E.sort((N,Y)=>M.compare(N.replacement,Y.replacement)),F.sort((N,Y)=>M.compare(N.replacement,Y.replacement)),V.concat(E).concat(F)}getEmojiSuggestions(g,D){if(!g.startsWith(":"))return[];let K=g.slice(1).toLowerCase();const H=this.chat.context.get("chat.emoji.style"),V=this.settings.provider.get("emoji-tone",null),E=this.emotes.getFavorites("emoji"),F=[],A=K.endsWith(":");A&&(K=K.slice(0,-1));const N=new Set;for(const Y in this.emoji.names)if(A?Y===K:Y.startsWith(K)){const se=this.emoji.emoji[this.emoji.names[Y]],ue=se.variants&&se.variants[V],_e=ue||se;if(se&&(H===0||_e.has[H])&&!N.has(_e.raw)){N.add(_e.raw);const Q=this.emoji.getFullImageSet(_e.image,H),le=`:${Y}:`,he=E.includes(se.code);F.push({current:g,emoji:_e,matched:le,srcSet:Q,replacement:_e.raw,element:D.renderFFZEmojiSuggestion({token:le,id:`emoji-${se.code}`,src:this.emoji.getFullImage(_e.image,H),srcSet:Q,favorite:he}),favorite:he})}}return F}buildFFZCache(g,D,K,H){const V=this.emotes.getSets(g,D,K,H);if(!V||!V.length)return{emotes:[],length:0,user_id:g,user_login:D,channel_id:K,channel_login:H};const E=[],F=this.chat.context.get("chat.emotes.animated")>0,A=this.settings.provider.get("emote-menu.hidden-sets"),N=Array.isArray(A)&&A.length>0,Y=new Set;for(const se of V){if(!se||!se.emotes)continue;const ue=se.source||"ffz",_e=se.source_line||`${se.source||"FFZ"} ${se.title||"Global"}`,Q=`${se.merge_source||ue}-${se.merge_id||se.id}`;if(N&&A.includes(Q))continue;const le=this.emotes.getHidden(ue),he=this.emotes.getFavorites(ue);for(const be of Object.values(se.emotes))!be||!be.id||be.hidden||le.includes(be.id)||Y.has(be.name)||be.name&&(Y.add(be.name),E.push({id:`${ue}-${be.id}`,source:ue,extra:_e,token:be.name,tokenLower:be.name.toLowerCase(),srcSet:F&&be.animSrcSet||be.srcSet,favorite:he.includes(be.id)}))}return{emotes:E,length:V.length}}getEmoteSuggestions(g,D){if(!D._ffz_channel_login){const se=this.fine.searchParent(D,"chat-input",50);se&&this.updateEmoteCompletion(se,D)}const K=this.chat.context.get("chat.tab-complete.matching"),H=D._ffz_user,V=D._ffz_channel_id,E=D._ffz_channel_login;if(!E)return[];let F=D.ffz_ffz_cache;(!F||F.user_id!==H?.id||F.user_login!==H?.login||F.channel_id!==V||F.channel_login!==E)&&(F=D.ffz_ffz_cache=this.buildFFZCache(H?.id,H?.login,V,E));const A=F.emotes;if(!A.length)return[];const N=g.startsWith(":")?g.slice(1):g,Y=[];for(const se of A){const ue=D.doesEmoteMatchTerm(se,N);ue<K||Y.push({current:g,emote:se,replacement:se.token,element:D.renderEmoteSuggestion(se),favorite:se.favorite,count:0,match_type:ue})}return Y}getInput(){for(const g of this.ChatInput.instances)if(!(!g.autocompleteInputRef||!g.state)&&g.state.value)return g.state.value;return null}pasteMessage(g,D){for(const K of this.ChatInput.instances)if(K?.props?.channelLogin===g){if(!K.autocompleteInputRef||!K.state)return;K.state.value&&(D=`${K.state.value} ${D}`),K.autocompleteInputRef.setValue(D),K.autocompleteInputRef.componentRef?.focus?.()}}};G(Ie,"Input");let ee=Ie;const Xe=class Xe extends z.default{constructor(...g){super(...g),this.inject("chat"),this.inject("settings"),this.inject("site.css_tweaks"),this.inject("site.fine"),this.last_login=null,this.settings.add("chat.viewer-cards.highlight-chat",{default:!1,ui:{path:"Chat > Viewer Cards >> Appearance",title:"Highlight messages from users with open viewer cards.",component:"setting-check-box"}}),this.settings.add("chat.viewer-cards.color",{default:"",ui:{path:"Chat > Viewer Cards >> Appearance",title:"Highlight Color",component:"setting-color-box"}}),this.settings.add("chat.viewer-cards.use-color",{requires:["chat.viewer-cards.highlight-chat","chat.viewer-cards.color"],process(D){if(D.get("chat.viewer-cards.highlight-chat"))return D.get("chat.viewer-cards.color")}}),this.ViewerCard=this.fine.define("chat-viewer-card",D=>D.props?.targetLogin&&D.props?.hideViewerCard)}onEnable(){this.chat.context.on("changed:chat.viewer-cards.highlight-chat",this.refreshStyle,this),this.chat.context.on("changed:chat.viewer-cards.color",this.refreshStyle,this),this.on("..:update-colors",this.refreshStyle,this),this.ViewerCard.on("mount",this.updateCard,this),this.ViewerCard.on("update",this.updateCard,this),this.ViewerCard.on("unmount",this.unmountCard,this)}refreshStyle(){this.updateStyle(this.last_login)}updateStyle(g){if(typeof g=="string"&&(g=g.toLowerCase()),this.last_login=g,g&&this.chat.context.get("chat.viewer-cards.highlight-chat")){let D=this.chat.context.get("chat.viewer-cards.color");D&&D.length?D=this.parent.inverse_colors.process(D):this.chat.context.get("theme.is-dark")?D="rgba(0,80,255,0.2)":D="rgba(128,170,255,0.2)",this.css_tweaks.set("viewer-card-highlight",`
body .chat-room .chat-scrollable-area__message-container > div:nth-child(1n+0) > .chat-line__message:not(.chat-line--inline):not(.something-nonexistent)[data-user="${g}"],
body .chat-room .chat-line__message:not(.chat-line--inline):nth-child(1n+0)[data-user="${g}"] {
	background-color: ${D} !important;
}`)}else this.css_tweaks.delete("viewer-card-highlight")}updateCard(g){this.updateStyle(g.props&&g.props.targetLogin)}unmountCard(){this.updateStyle()}};G(Xe,"ViewerCards");let te=Xe;const ne=(0,B.make_enum)("Post","Action"),pe=(0,B.make_enum)("Ban","Timeout","Delete"),oe=(0,B.make_enum)("MessageRejectedPrompt","CheerMessageRejectedPrompt","MessageRejected","MessageAllowed","MessageDenied","CheerMessageDenied","CheerMessageTimeout","MessageModApproved","MessageModDenied"),de=["Message","Notice","Moderation","ModerationAction","TargetedModerationAction","AutoMod","SubscriberOnlyMode","FollowerOnlyMode","SlowMode","EmoteOnlyMode","R9KMode","Connected","Disconnected","Reconnect","RoomMods","RoomState","BadgesUpdated"],me=(0,B.make_enum)("Message","ExtensionMessage","Moderation","ModerationAction","TargetedModerationAction","AutoMod","SubscriberOnlyMode","FollowerOnlyMode","SlowMode","EmoteOnlyMode","R9KMode","Connected","Disconnected","Reconnect","Subscription","Resubscription","GiftPaidUpgrade","AnonGiftPaidUpgrade","PrimePaidUpgrade","PrimeCommunityGiftReceivedEvent","ExtendSubscription","SubGift","AnonSubGift","Clear","RoomMods","RoomState","Raid","Unraid","Notice","Info","BadgesUpdated","Purchase","BitsCharity","CrateGift","RewardGift","SubMysteryGift","AnonSubMysteryGift","StandardPayForward","CommunityPayForward","FirstCheerMessage","FirstMessageHighlight","BitsBadgeTierMessage","InlinePrivateCallout","ChannelPointsReward","CommunityChallengeContribution","LiveMessageSeparator","RestrictedLowTrustUserMessage","CommunityIntroduction","Shoutout","AnnouncementMessage","CharityDonation","MessageIdUpdate","ViewerMilestone","GigantifiedEmote"),Ee=["Reconnect","RoomState","BadgesUpdated","Clear"],xe={pinned_re_sub:"share-resub",community_points_reward:"community-points-rewards",clip_live_nudge_chat_trigger:"clip-live-nudge",cheer_badge_grant:"bits-badge-tier"},Te={AppointedModerator:"appointed-moderator",BitsBadgeTier:"bits-badge-tier",BitsPowerUps:"bits-power-ups",ClipLiveNudge:"clip-live-nudge",CommunityMoment:"community-moment",CommunityPointsRewards:"community-points-rewards",CosmicAbyss:"cosmic-abyss",CreatorAnniversaries:"creator-anniversaries",Drop:"drop",EarnedSubBadge:"earned-sub-badge",FavoritedGuestCollab:"favorited-guest-collab",GiftBadgeExpiration:"gift-badge-expiration",GiftBadgeRestored:"gift-badge-restored",GiftBundleUpSell:"gift-bundle-up-sell",HypeTrainRewards:"hype-train-rewards",LapsedBitsUser:"lapsed-bits-user",PartnerPlusUpSellNudge:"partner-plus-up-sell-nudge",ReplyByKeyboard:"reply-by-keyboard",RequestToJoinAccepted:"request-to-join-accepted",STPromo:"st-promo",ShareResub:"share-resub",SubtemberPromoBits:"subtember-promo-bits",ThankSubGifter:"thank-sub-gifter",TurnOffAnimatedEmotes:"turn-off-animated-emotes",WalletDrop:"wallet-drop"},Pe=[],Se=["onBadgesUpdatedEvent"],ct=class ct extends z.default{constructor(...g){super(...g),this.should_enable=!0,this.shared_room_data=new Map,this.shared_rooms={},this.colors=new W.ColorAdjuster,this.inverse_colors=new W.ColorAdjuster,this.inject("settings"),this.inject("i18n"),this.inject("experiments"),this.inject("site"),this.inject("site.router"),this.inject("site.fine"),this.inject("site.web_munch"),this.inject("site.css_tweaks"),this.inject("site.subpump"),this.inject("chat"),this.inject(y),this.inject(w),this.inject(e),this.inject(h),this.inject(ee),this.inject(te),this.ChatLeaderboard=this.fine.define("chat-leaderboard",D=>D.props?.topItems&&(0,B.has)(D.props,"forceMiniView")&&(0,B.has)(D.props,"leaderboardType"),v.Z.CHAT_ROUTES),this.ChatService=this.fine.define("chat-service",D=>D.join&&D.client&&D.props.setChatConnectionAPI,v.Z.CHAT_ROUTES),this.ChatBuffer=this.fine.define("chat-buffer",D=>D.updateHandlers&&D.delayedMessageBuffer&&D.handleMessage,v.Z.CHAT_ROUTES),this.ChatController=this.fine.define("chat-controller",D=>D.parseOutgoingMessage&&D.onRoomStateUpdated&&D.renderNotifications,v.Z.CHAT_ROUTES),this.ChatRenderer=this.fine.define("chat-renderer",D=>D.mapMessagesToChatLines&&D.reportChatRenderSent,v.Z.CHAT_ROUTES),this.ChatContainer=this.fine.define("chat-container",D=>D.closeViewersList&&D.onChatInputFocus,v.Z.CHAT_ROUTES),this.ChatBufferConnector=this.fine.define("chat-buffer-connector",D=>D.clearBufferHandle&&D.syncBufferedMessages,v.Z.CHAT_ROUTES),this.joined_raids=new Set,this.RaidController=this.fine.define("raid-controller",D=>D.handleLeaveRaid&&D.handleJoinRaid,v.Z.CHAT_ROUTES),this.InlineCallout=this.fine.define("inline-callout",D=>D.showCTA&&D.toggleContextMenu&&D.actionClick,v.Z.CHAT_ROUTES),this.PinnedCallout=this.fine.define("pinned-callout",D=>D.getCalloutTitle&&D.buildCalloutProps&&D.pin,v.Z.CHAT_ROUTES),this.CalloutSelector=this.fine.define("callout-selector",D=>D.selectCalloutComponent&&D.props&&(0,B.has)(D.props,"callouts"),v.Z.CHAT_ROUTES),this.PointsButton=this.fine.define("points-button",D=>D.renderIcon&&D.renderFlame&&D.handleIconAnimationComplete,v.Z.CHAT_ROUTES),this.PointsClaimButton=this.fine.define("points-claim-button",D=>D.getClaim&&D.onClick&&D.props&&D.props.claimCommunityPoints,v.Z.CHAT_ROUTES),this.CommunityChestBanner=this.fine.define("community-chest-banner",D=>D.getLastGifterText&&D.getBannerText&&(0,B.has)(D,"finalCount"),v.Z.CHAT_ROUTES),this.PointsInfo=this.fine.define("points-info",D=>D.pointIcon!==void 0&&D.pointName!==void 0,v.Z.CHAT_ROUTES),this.GiftBanner=this.fine.define("gift-banner",D=>D.getBannerText&&D.onGiftMoreClick,v.Z.CHAT_ROUTES),this.settings.add("chat.subs.native",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display subscription notices using Twitch's native UI.",component:"setting-check-box"}}),this.settings.add("chat.filtering.show-reasons",{default:!1,ui:{path:"Chat > Filtering > General >> Appearance",title:"Display Reasons",description:"If this is enabled, the reasons a given message was highlighted will be displayed alongside the message. This is a simple display. Enable the debugging option below in Behavior for more details, but be aware that the debugging option has a slight performance impact compared to this.",component:"setting-select-box",data:[{value:!1,title:"Disabled"},{value:1,title:"Above Message"},{value:2,title:"Inline"}]}}),this.settings.add("chat.disable-handling",{default:null,requires:["context.disable-chat-processing"],process(D,K){return K!=null?!K:!!D.get("context.disable-chat-processing")},ui:{path:"Debugging > Chat >> Processing",title:"Enable processing of chat messages.",component:"setting-check-box",force_seen:!0}}),this.settings.addUI("debug.chat-test",{path:"Debugging > Chat >> Chat",component:"chat-tester",getChat:()=>this,force_seen:!0}),this.settings.add("chat.filtering.blocked-callouts",{default:[],type:"array_merge",always_inherit:!0,process:(D,K)=>{const H=new Set,V=this.callout_types??Te;for(const E of K)E?.v&&V[E.v]&&!Pe.includes(E.v)&&H.add(V[E.v]);return H},ui:{path:'Chat > Filtering > Block >> Callout Types @{"description":"This filter allows you to remove callouts of specific types from Twitch chat. Callouts are special messages that can be pinned to the bottom of chat and often have associated actions, like claiming a drop or sharing your resubscription."}',component:"blocked-types",data:()=>Object.keys(this.callout_types).filter(D=>!Pe.includes(D)).sort()}}),this.settings.add("chat.filtering.blocked-types",{default:[],type:"array_merge",always_inherit:!0,process(D,K){const H=new Set;for(const V of K)V?.v&&!de.includes(V.v)&&H.add(V.v);return H},ui:{path:'Chat > Filtering > Block >> Message Types @{"description":"This filter allows you to remove all messages of a certain type from Twitch chat. It can be used to filter system messages, such as Hosts or Raids. Some types, such as moderation actions, cannot be blocked to prevent chat functionality from breaking."}',component:"blocked-types",data:()=>Object.keys(this.chat_types).filter(D=>!de.includes(D)&&!/^\d+$/.test(D)).sort()}}),this.settings.add("chat.replies.style",{default:1,ui:{path:"Chat > Appearance >> Replies",title:"Style",description:"Twitch's default style adds a floating button to the right and displays a notice above messages that are replies. FrankerFaceZ uses an In-Line Chat Action (that can be removed in [Chat > Actions > In-Line](~chat.actions.in_line)) and uses an in-line mention to denote replies.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch (Default)"},{value:2,title:"FrankerFaceZ"}]}}),this.settings.add("channel.raids.no-autojoin",{default:!1,ui:{path:"Channel > Behavior >> Raids",title:"Do not automatically join raids.",component:"setting-check-box"}}),this.settings.add("chat.powerup.effects",{default:!0,ui:{path:"Chat > Appearance >> Community",title:'Allow "Message Effects" messages to appear in chat.',component:"setting-check-box",description:"*Note*: Only affects messages sent after you change this setting. You can use your own chat for testing."}}),this.settings.add("channel.raids.blocked-channels",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Channel > Behavior >> Raids: Blocked Channels @{"description": "You will not automatically join raids to channels listed here."}',component:"basic-terms",words:!1}}),this.settings.add("__filter:channel.raids.blocked-channels",{requires:["channel.raids.blocked-channels"],equals:"requirements",process(D){const K=D.get("channel.raids.blocked-channels");if(!K||!K.length)return null;const H=[];for(const V of K){const E=V.t;let F=V.v;E==="glob"?F=(0,B.glob_to_regex)(F):E!=="raw"&&(F=(0,B.escape_regex)(F)),!(!F||!F.length)&&H.push(F)}return H.length?new RegExp(`^(?:${H.join("|")})$`,"gi"):null}}),this.settings.add("chat.hide-community-highlights",{default:!1,ui:{path:"Chat > Appearance >> Community",title:"Hide all Community Highlights from the top of chat.",component:"setting-check-box",description:"Community Highlights are polls, community gift subs, etc. that float over the top of chat temporarily with no way to close them."}}),this.settings.add("chat.subs.gift-banner",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Display a banner at the top of chat when a mass gift sub happens.",component:"setting-check-box"}}),this.settings.add("chat.banners.last-events",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow the Support Activity Feed to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.charity",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow the charity fundraiser progress to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.hide-appleplus",{default:!1,ui:{path:"Chat > Appearance >> Community",title:"Hide the drop notification for getting AppleTV+ when you buy a subscription.",component:"setting-check-box",description:`**Note:** Normally, I wouldn't add something that directly affects an advertisement like this, but Twitch broke the "Don't show again" checkbox, so it's up to us to fix it.`}}),this.settings.add("chat.banners.hype-train",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow the Hype Train to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.shared-chat",{default:!0,ui:{path:"Chat > Shared Chat >> Behavior",title:"Allow the Shared Chat notice to be displayed in chat when a Shared Chat is enabled.",component:"setting-check-box"}}),this.settings.add("chat.banners.pinned-message",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow Pinned Messages to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.drops",{default:!0,ui:{path:"Chat > Drops >> Appearance",title:"Allow messages about Drops to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.polls",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow Polls to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.prediction",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow Predictions to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.callouts.clip",{default:!0,ui:{path:"Chat > Appearance >> Community",title:'Allow the "Chat seems active." clip suggestion to be displayed in chat.',component:"setting-check-box"}}),this.settings.add("chat.community-chest.show",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Display the Community Gift Chest banner.",component:"setting-check-box"}}),this.settings.add("chat.points.allow-highlight",{default:2,ui:{path:"Chat > Channel Points >> Appearance",title:"Highlight the message in chat when someone redeems Highlight My Message.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch Style"},{value:2,title:"FFZ Style"}]}}),this.settings.add("chat.points.show-callouts",{default:!0,ui:{path:"Chat > Channel Points >> General",title:"Display messages in chat about Channel Points rewards.",component:"setting-check-box"}}),this.settings.add("chat.points.show-button",{default:!0,ui:{path:"Chat > Channel Points >> General",title:"Display Channel Points button beneath chat.",component:"setting-check-box"}}),this.settings.add("chat.points.show-rewards",{default:!0,requires:["layout.portrait-min-chat"],process(D,K){return D.get("layout.portrait-min-chat")?!1:K},ui:{path:"Chat > Channel Points >> Behavior",title:"Allow available rewards to appear next to the Channel Points button.",component:"setting-check-box"}}),this.settings.add("chat.points.auto-rewards",{default:!1,ui:{path:"Chat > Channel Points >> Behavior",title:"Automatically claim bonus rewards.",component:"setting-check-box",force_seen:!0}}),this.settings.add("chat.drops.auto-rewards",{default:!1,ui:{path:"Chat > Drops >> Behavior",title:"Automatically claim drops.",component:"setting-check-box"}}),this.settings.add("chat.pin-resubs",{default:!1,ui:{path:"Chat > Behavior >> General",title:"Automatically pin re-subscription messages in chat.",component:"setting-check-box"}}),this.settings.add("chat.shared-chat.style",{default:null,ui:{path:"Chat > Shared Chat >> Appearance",title:"Pill Style",component:"setting-select-box",description:"This controls the appearance of the pill at the left-side of chat messages when a message is part of a Shared Chat. By default, this is Avatar for moderators and broadcasters and Hidden for everyone else.",data:[{value:null,title:"Automatic"},{value:0,title:"Hidden"},{value:1,title:"Channel Name"},{value:2,title:"Avatar"}]}}),this.settings.add("chat.shared-chat.username-tooltip",{default:!0,ui:{path:"Chat > Shared Chat >> Appearance",component:"setting-check-box",title:"Display the source channel of a chat message when hovering over the poster's username."}}),this.settings.add("chat.width",{default:null,ui:{path:'Chat > Appearance >> General @{"sort": -1}',title:"Width",description:"How wide chat should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process(D){return D=parseInt(D,10),isNaN(D)||!isFinite(D)||D<=0?null:D}}}),this.settings.add("chat.effective-width",{requires:["chat.width","context.ui.rightColumnWidth"],process(D){const K=D.get("chat.width");return K??(D.get("context.ui.rightColumnWidth")||340)}}),this.settings.add("chat.use-width",{requires:["chat.width","context.ui.rightColumnExpanded","context.isWatchParty"],process(D){return!D.get("context.ui.rightColumnExpanded")||D.get("context.isWatchParty")?!1:D.get("chat.width")!=null}}),this.settings.add("chat.bits.show-pinned",{requires:["chat.bits.show"],default:null,process(D,K){return K??D.get("chat.bits.show")},ui:{path:"Chat > Appearance >> Community",title:"Display Leaderboard",description:`The leaderboard shows the top cheerers and sub gifters in a channel.

By default due to a previous implementation, this inherits its value from [Chat > Bits and Cheering > Display Bits](~chat.bits_and_cheering).`,component:"setting-check-box"}}),this.settings.add("chat.bits.show-rewards",{requires:["chat.bits.show"],default:null,process(D,K){return K??D.get("chat.bits.show")},ui:{path:"Chat > Bits and Cheering >> Behavior",title:"Display messages when a cheer shares rewards to people in chat.",description:"By default, this inherits its value from Display Bits. This setting only affects newly arrived messages.",component:"setting-check-box"}}),this.settings.add("chat.bits.cheer-notice",{default:!0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Display a notice on chat messages that include cheers.",description:"This feature is intended to prevent possible confusion from chatters using emotes to fake cheers in messages. When enabled, messages that contain real cheers will display a message above them, similar to how resubscription messages or point redemptions with messages function.",component:"setting-check-box"}}),this.settings.add("chat.rituals.show",{default:!0,ui:{path:"Chat > Filtering > General >> Rituals",title:'Display ritual messages such as "User is new here! Say Hello!".',component:"setting-check-box"}}),this.settings.add("chat.extra-timestamps",{default:!0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Display timestamps on notices.",description:"When enabled, timestamps will be displayed on point redemptions, subscriptions, etc.",component:"setting-check-box"}}),this.settings.add("chat.hype.message-style",{default:1,ui:{path:"Chat > Hype Chat >> Appearance",title:"Hype Chat Style",component:"setting-select-box",description:"**Note**: Hype Chats that include messages will always have their messages displayed, regardless of setting. Changes made to this setting may not affect existing chat messages.",data:[{value:0,title:"Do Not Display"},{value:1,title:"Standard Twitch (Large, Colored, Limited FFZ Support)"},{value:2,title:"Minimal (Marked with System Message, No Colors)"}]}}),this.settings.add("chat.subs.show",{default:3,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display Subs in Chat",component:"setting-select-box",description:'**Note**: Messages sent with re-subs will always be displayed. This only controls the special "X subscribed!" message.',data:[{value:0,title:"Do Not Display"},{value:1,title:"Re-Subs with Messages Only"},{value:2,title:"Re-Subs Only"},{value:3,title:"Display All"}]}}),this.settings.add("chat.subs.compact",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display subscription notices in a more compact (classic style) form.",component:"setting-check-box"}}),this.settings.add("chat.subs.merge-gifts",{default:1e3,ui:{path:"Chat > Appearance >> Subscriptions",title:"Merge Mass Sub Gifts",component:"setting-select-box",data:[{value:1e3,title:"Disabled"},{value:50,title:"More than 50"},{value:20,title:"More than 20"},{value:10,title:"More than 10"},{value:5,title:"More than 5"},{value:0,title:"Always"}],description:`Merge mass gift subscriptions into a single message, depending on the quantity.
**Note:** Only affects newly gifted subs.`}}),this.settings.add("chat.subs.merge-gifts-visibility",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Expand merged mass sub gift messages by default.",component:"setting-check-box"}}),this.settings.add("chat.lines.alternate",{default:!1,ui:{path:"Chat > Appearance >> Chat Lines",title:"Display lines with alternating background colors.",component:"setting-check-box"}}),this.settings.add("chat.lines.padding",{default:!1,ui:{path:"Chat > Appearance >> Chat Lines",title:"Reduce padding around lines.",component:"setting-check-box"}}),this.settings.add("chat.lines.borders",{default:0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Separators",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Basic Line (1px Solid)"},{value:2,title:"3D Line (2px Groove)"},{value:3,title:"3D Line (2px Groove Inset)"},{value:4,title:"Wide Line (2px Solid)"}]}}),this.settings.add("chat.input.show-mod-view",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Mod View" button to appear in relevant channels.',component:"setting-check-box"}}),this.settings.add("chat.input.show-highlight",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Chat Highlight Settings" button to appear in relevant channels.',component:"setting-check-box"}}),this.settings.add("chat.input.show-shield",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Shield Mode" button to appear in relevant channels.',component:"setting-check-box"}}),this.settings.add("chat.input.show-elevate-your-message",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Elevate Your Message" button to be displayed.',component:"setting-check-box"}})}get currentChat(){for(const g of this.ChatController.instances)if(g&&g.chatService)return g;return null}updateColors(){const g=this.chat.context.get("theme.is-dark"),D=this.chat.context.get("chat.adjustment-mode"),K=this.chat.context.get("chat.adjustment-contrast"),H=this.colors,V=this.inverse_colors;let E=g,F=W.Color.RGBA.fromCSS(this.chat.context.get("theme.color.chat-background")||this.chat.context.get("theme.color.background"));F&&(E=F.toHSLA().l<.5),F=E?"#191919":"#E0E0E0";let A=!E,N=W.Color.RGBA.fromCSS(this.chat.context.get("theme.color.chat-text")||this.chat.context.get("theme.color.text"));N&&(A=N.toHSLA().l<.5),N=A?"#19171c":"#dad8de",H._base=F,H.mode=D,H.contrast=K,V._base=N,V.mode=D,V.contrast=K,this.chat_line.rerenderLines(),this.updateMentionCSS(),this.emit(":update-colors")}updateChatCSS(){this._update_css_waiter||(this._update_css_waiter=requestAnimationFrame(()=>this._updateChatCSS()))}_updateChatCSS(){cancelAnimationFrame(this._update_css_waiter),this._update_css_waiter=null;const g=this.chat.context.get("chat.effective-width"),D=this.chat.context.get("chat.actions.size"),K=this.chat.context.get("chat.actions.hover-size"),H=this.chat.context.get("chat.timestamp-size"),V=this.chat.context.get("chat.font-size"),E=this.chat.context.get("chat.lines.emote-alignment"),F=Math.round(20/12*V),A=Math.round(K*(2/3)),N=K-A;let Y=this.chat.context.get("chat.font-family")||"inherit";const[se,ue]=(0,I.jo)(Y);Y=se,this._font_unloader&&this._font_unloader(),this._font_unloader=ue,Y.indexOf(" ")!==-1&&Y.indexOf(",")===-1&&Y.indexOf('"')===-1&&Y.indexOf("'")===-1&&(Y=`"${Y}"`),H?this.css_tweaks.set("ts-size",`.chat-line__timestamp{font-size:${H/10}rem}`):this.css_tweaks.delete("ts-size"),this.css_tweaks.setVariable("chat-actions-size",`${D/10}rem`),this.css_tweaks.setVariable("chat-actions-hover-size",`${A/10}rem`),this.css_tweaks.setVariable("chat-actions-hover-padding",`${N/20}rem`),this.css_tweaks.setVariable("chat-font-size",`${V/10}rem`),this.css_tweaks.setVariable("chat-line-height",`${F/10}rem`),this.css_tweaks.setVariable("chat-font-family",Y),this.css_tweaks.setVariable("chat-width",`${g/10}rem`),this.css_tweaks.setVariable("negative-chat-width",`${-g/10}rem`),this.css_tweaks.toggle("chat-font",V!==13||Y!=="inherit"),this.css_tweaks.toggle("chat-width",this.settings.get("chat.use-width")),this.css_tweaks.toggle("chat-fix--watch-party",this.settings.get("context.isWatchParty")),this.css_tweaks.toggle("emote-alignment-padded",E===1),this.css_tweaks.toggle("emote-alignment-baseline",E===2),this.emit(":update-chat-css"),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}updateLineBorders(){const g=this.chat.context.get("chat.lines.borders");this.css_tweaks.toggle("chat-borders",g>0),this.css_tweaks.toggle("chat-borders-3d",g===2),this.css_tweaks.toggle("chat-borders-3d-inset",g===3),this.css_tweaks.toggle("chat-borders-wide",g===4)}updateMentionCSS(){const g=this.chat.context.get("chat.filtering.highlight-mentions");this.css_tweaks.toggle("chat-mention-token",this.chat.context.get("chat.filtering.highlight-tokens"));const D=this.chat.context.get("chat.filtering.mention-color");D?(this.css_tweaks.toggle("chat-mention-bg",!1),this.css_tweaks.toggle("chat-mention-bg-alt",!1),this.css_tweaks.toggle("chat-mention-bg-custom",!0),this.css_tweaks.setVariable("chat-mention-color",this.inverse_colors.process(D))):(this.css_tweaks.toggle("chat-mention-bg-custom",!1),this.css_tweaks.toggle("chat-mention-bg",g),this.css_tweaks.toggle("chat-mention-bg-alt",g&&this.chat.context.get("chat.lines.alternate")))}updatePointsInfo(g){const D=g?.pointIcon,K=g?.pointName;D?this.css_tweaks.set("points-icon",`.ffz--points-icon:before { display: none }
.ffz--points-icon:after {
	display: inline-block;
	margin: 0 0.5rem -0.6rem;
	background-image: url("${D.url}");
	background-image: ${R.WEBKIT_CSS}image-set(url("${D.url}") 1x, url("${D.url2x}") 2x, url("${D.url4x}") 4x);
}`):this.css_tweaks.delete("points-icon"),this.point_name=K||null}async grabTypes(){if(this.types_loaded)return;const g=await this.web_munch.findModule("chat-types"),D=await this.web_munch.findModule("callout-types");if(this.callout_types=D||Te,this.automod_types=g?.automod||oe,this.chat_types=g?.chat||me,this.message_types=g?.message||ne,this.mod_types=g?.mod||pe,!g)return;D&&this.chat.context.update("chat.filtering.blocked-callouts"),this.types_loaded=!0;const K=[];(0,B.shallow_object_equals)(this.callout_types,Te)||K.push("CALLOUT_TYPES"),(0,B.shallow_object_equals)(this.automod_types,oe)||K.push("AUTOMOD_TYPES"),(0,B.shallow_object_equals)(this.chat_types,me)||K.push("CHAT_TYPES"),(0,B.shallow_object_equals)(this.message_types,ne)||K.push("MESSAGE_TYPES"),(0,B.shallow_object_equals)(this.mod_types,pe)||K.push("MOD_TYPES"),K.length&&this.log.info("Chat Types have changed from static mappings for categories:",K.join(" "))}updateDisableHandling(){this.disable_handling=this.chat.context.get("chat.disable-handling")}onEnable(){this.on("site.web_munch:loaded",this.grabTypes),this.on("site.web_munch:loaded",this.defineClasses),this.grabTypes(),this.defineClasses(),this.chat.context.on("changed:chat.callouts.clip",this.updateCallouts,this),this.chat.context.on("changed:chat.filtering.blocked-callouts",this.updateCallouts,this),this.chat.context.on("changed:chat.points.show-callouts",this.updateCallouts,this),this.chat.context.on("changed:chat.points.show-button",()=>this.PointsButton.forceUpdate()),this.chat.context.on("changed:chat.points.show-rewards",()=>{this.PointsButton.forceUpdate(),this.PointsClaimButton.forceUpdate()}),this.chat.context.on("changed:chat.bits.show",()=>{this.PointsButton.forceUpdate()}),this.chat.context.on("changed:chat.banners.hype-train",this.cleanHighlights,this),this.chat.context.on("changed:chat.subs.gift-banner",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.polls",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.prediction",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.drops",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.pinned-message",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.hide-appleplus",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.shared-chat",this.cleanHighlights,this),this.chat.context.on("changed:chat.disable-handling",this.updateDisableHandling,this),this.chat.context.on("changed:chat.banners.charity",()=>{this.ChatContainer.forceUpdate()}),this.chat.context.on("changed:chat.subs.gift-banner",()=>this.GiftBanner.forceUpdate(),this),this.chat.context.on("changed:chat.effective-width",this.updateChatCSS,this),this.settings.main_context.on("changed:chat.use-width",this.updateChatCSS,this),this.chat.context.on("changed:chat.actions.size",this.updateChatCSS,this),this.chat.context.on("changed:chat.actions.hover-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.font-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.timestamp-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.font-family",this.updateChatCSS,this),this.chat.context.on("changed:chat.lines.emote-alignment",this.updateChatCSS,this),this.chat.context.on("changed:chat.adjustment-mode",this.updateColors,this),this.chat.context.on("changed:chat.adjustment-contrast",this.updateColors,this),this.chat.context.on("changed:theme.is-dark",this.updateColors,this),this.chat.context.on("changed:theme.color.background",this.updateColors,this),this.chat.context.on("changed:theme.color.chat-background",this.updateColors,this),this.chat.context.on("changed:theme.color.text",this.updateColors,this),this.chat.context.on("changed:theme.color.chat-text",this.updateColors,this),this.chat.context.on("changed:chat.lines.borders",this.updateLineBorders,this),this.chat.context.on("changed:chat.filtering.highlight-mentions",this.updateMentionCSS,this),this.chat.context.on("changed:chat.filtering.highlight-tokens",this.updateMentionCSS,this),this.chat.context.on("changed:chat.filtering.mention-color",this.updateMentionCSS,this),this.chat.context.on("changed:chat.pin-resubs",D=>{D&&(this.updateInlineCallouts(),this.updatePinnedCallouts())},this),this.chat.context.on("changed:chat.community-chest.show",()=>{this.CommunityChestBanner.forceUpdate(),this.updateCallouts()},this),this.chat.context.getChanges("chat.emotes.2x",D=>{this.css_tweaks.toggle("big-emoji",D>1),this.toggleEmoteJail()}),this.chat.context.getChanges("chat.emotes.limit-size",()=>this.toggleEmoteJail()),this.chat.context.getChanges("chat.banners.last-events",D=>this.css_tweaks.toggleHide("last-x-events",!D)),this.chat.context.getChanges("chat.input.show-mod-view",D=>this.css_tweaks.toggleHide("ci-mod-view",!D)),this.chat.context.getChanges("chat.input.show-highlight",D=>this.css_tweaks.toggleHide("ci-highlight-settings",!D)),this.chat.context.getChanges("chat.input.show-shield",D=>this.css_tweaks.toggleHide("ci-shield-mode",!D)),this.chat.context.getChanges("chat.lines.padding",D=>this.css_tweaks.toggle("chat-padding",D)),this.chat.context.getChanges("chat.bits.show",D=>this.css_tweaks.toggle("hide-bits",!D)),this.chat.context.on("changed:chat.bits.show-pinned",()=>this.ChatLeaderboard.forceUpdate()),this.chat.context.getChanges("chat.filtering.deleted-style",D=>{this.css_tweaks.toggle("chat-deleted-strike",D===1||D===2),this.css_tweaks.toggle("chat-deleted-fade",D<2)}),this.chat.context.getChanges("chat.filtering.clickable-mentions",D=>this.css_tweaks.toggle("clickable-mentions",D)),this.chat.context.getChanges("chat.filtering.bold-mentions",D=>this.css_tweaks.toggle("chat-mention-no-bold",!D)),this.chat.context.getChanges("chat.hide-community-highlights",D=>this.css_tweaks.toggleHide("community-highlights",D)),this.chat.context.getChanges("chat.lines.alternate",D=>{this.css_tweaks.toggle("chat-rows",D),this.updateMentionCSS()}),this.chat.context.getChanges("chat.input.show-elevate-your-message",D=>this.css_tweaks.toggleHide("elevate-your-message",!D)),this.updateDisableHandling(),this.updateChatCSS(),this.updateColors(),this.updateLineBorders(),this.on("chat:get-messages-late",(D,K,H,V)=>{if(!D)return;const E=new Set(V.map(F=>F.message?.id));for(const F of this.ChatBuffer.instances){for(const A of F.buffer){const N=A?.id;!N||E.has(N)||!A.ffz_standardized||(E.add(N),V.push({message:A,_instance:null,update:()=>null}))}for(const A of F.delayedMessageBuffer){const N=A?.event,Y=N?.id;!Y||E.has(Y)||!N.ffz_standardized||(E.add(Y),V.push({message:N,_instance:null,update:()=>null}))}}}),this.on("chat:get-tab-commands",D=>{D.commands.push({name:"reconnect",description:"Force chat to reconnect.",permissionLevel:0,ffz_group:"FrankerFaceZ"})}),this.on("chat:pre-send-message",D=>{const K=D.message,H=D._inst;/^\/reconnect ?/i.test(K)&&(D.preventDefault(),H.client?.reconnect?(H.addMessage({type:g.chat_types.Notice,message:g.i18n.t("chat.reconnect","FFZ is forcing chat to reconnect...")}),H.client.reconnect()):H.addMessage({type:g.chat_types.Notice,message:g.i18n.t("chat.reconnect.unable","FFZ is unable to force chat to reconnect.")}))}),this.RaidController.on("mount",this.wrapRaidController,this),this.RaidController.on("update",this.noAutoRaids,this),this.RaidController.ready((D,K)=>{for(const H of K)this.wrapRaidController(H)}),this.InlineCallout.on("mount",this.onInlineCallout,this),this.InlineCallout.on("update",this.onInlineCallout,this),this.InlineCallout.ready(()=>this.updateInlineCallouts()),this.PinnedCallout.on("mount",this.onPinnedCallout,this),this.PinnedCallout.on("update",this.onPinnedCallout,this),this.PinnedCallout.ready(()=>this.updatePinnedCallouts());const g=this;this.PointsInfo.on("mount",this.updatePointsInfo,this),this.PointsInfo.on("update",this.updatePointsInfo,this),this.PointsInfo.on("unmount",()=>this.updatePointsInfo(null)),this.PointsInfo.ready(()=>this.updatePointsInfo(this.PointsInfo.first)),this.ChatLeaderboard.ready(D=>{const K=D.prototype.render;D.prototype.render=function(){return g.chat.context.get("chat.bits.show-pinned")?K.call(this):null},this.ChatLeaderboard.forceUpdate()}),this.GiftBanner.ready(D=>{const K=D.prototype.render;D.prototype.render=function(){return g.chat.context.get("chat.subs.gift-banner")?K.call(this):null},this.GiftBanner.forceUpdate()}),this.CommunityChestBanner.ready(D=>{const K=D.prototype.render;D.prototype.render=function(){try{if(!g.chat.context.get("chat.community-chest.show"))return null}catch(H){g.log.capture(H),g.log.error(H)}return K.call(this)},this.CommunityChestBanner.forceUpdate()}),this.PointsButton.ready(D=>{const K=D.prototype.render;D.prototype.render=function(){try{if(!g.chat.context.get("chat.points.show-button"))return null;const H=this.state.animationQueue,V=this.props.bitsEnabled;g.chat.context.get("chat.points.show-rewards")||(this.state.animationQueue=[]),g.chat.context.get("chat.bits.show")||(this.props.bitsEnabled=!1);const E=K.call(this);return this.state.animationQueue=H,this.props.bitsEnabled=V,E}catch(H){g.log.capture(H),g.log.error(H)}return K.call(this)},this.PointsButton.forceUpdate()}),this.PointsClaimButton.ready(D=>{D.prototype.ffzHasOffer=function(){return!this.props.hidden&&!this.state?.error&&this.getClaim()!=null};const K=D.prototype.render;D.prototype.render=function(){try{if(this.ffzHasOffer()&&!this._ffz_timer&&g.chat.context.get("chat.points.auto-rewards")&&(this._ffz_timer=setTimeout(()=>{this._ffz_timer=null,this.onClick&&this.ffzHasOffer()&&this.onClick()},1e3+Math.floor(Math.random()*5e3))),!g.chat.context.get("chat.points.show-rewards"))return null}catch(H){g.log.capture(H),g.log.error(H)}return K.call(this)},this.PointsClaimButton.forceUpdate()}),this.ChatController.on("mount",this.chatMounted,this),this.ChatController.on("unmount",this.chatUnmounted,this),this.ChatController.on("update",this.chatUpdated,this),this.ChatService.ready((D,K)=>{this.wrapChatService(D);for(const H of K){H.client.events.removeAll(),H._ffzInstall();const V=H.joinedChannel,E=H.client?.session?.channelstate?.[`#${V}`]?.roomState;E&&this.updateChatState(E),H.addEventListeners(),H.props.setChatConnectionAPI({sendMessage:H.sendMessage,_ffz_inst:H})}}),this.ChatBuffer.ready((D,K)=>{this.wrapChatBuffer(D);for(const H of K){const V=H.props.messageHandlerAPI;V&&V.removeMessageHandler(H.handleMessage),H._ffzInstall(),V&&V.addMessageHandler(H.handleMessage),H.props.setMessageBufferAPI({addUpdateHandler:H.addUpdateHandler,removeUpdateHandler:H.removeUpdateHandler,getUnreadCount:H.getUnreadCount,getMessages:H.getMessages,getMessagesForHighlight:H.getMessagesForHighlight,getMessagesForAllHighlights:H.getMessagesForAllHighlights,isPaused:H.isPaused,setPaused:H.setPaused,hasNewerLeft:H.hasNewerLeft,loadNewer:H.loadNewer,loadNewest:H.loadNewest,_ffz_inst:H})}}),this.ChatBufferConnector.on("mount",this.connectorMounted,this),this.ChatBufferConnector.on("update",this.connectorUpdated,this),this.ChatBufferConnector.on("unmount",this.connectorUnmounted,this),this.ChatBufferConnector.ready((D,K)=>{for(const H of K)this.connectorMounted(H)}),this.ChatController.ready((D,K)=>{const H=this,V=D.prototype.componentDidCatch,E=D.prototype.render;D.prototype.componentDidCatch=function(F,A){const N=this.state.ffz_errors||0;if(N<100&&(this.setState({ffz_errors:N+1}),H.log.info("Error within Chat",F,A,N)),V)return V.call(this,F,A)},D.prototype.render=function(){if(this.state.ffz_errors>0){const F=H.site.getReact(),A=F&&F.createElement;return A?A("div",{className:"tw-border-l tw-c-background-alt-2 tw-c-text-base tw-full-width tw-full-height tw-align-items-center tw-flex tw-flex-column tw-justify-content-center tw-relative"},"There was an error displaying chat."):null}return E.call(this)};for(const F of K)this.chatMounted(F)}),this.ChatRenderer.on("mount",this.rendererMounted,this),this.ChatRenderer.on("unmount",this.rendererUnmounted,this),this.ChatRenderer.on("update",this.rendererUpdated,this),this.ChatRenderer.ready((D,K)=>{for(const H of K)this.rendererMounted(H)}),this.ChatContainer.on("mount",this.containerMounted,this),this.ChatContainer.on("unmount",this.containerUnmounted,this),this.ChatContainer.on("update",this.containerUpdated,this),this.CalloutSelector.ready((D,K)=>{const H=this,V=D.prototype.render;D.prototype.render=function(){try{if(H.CalloutStackHandler){const E=H.site.getReact(),F=V.call(this),A=F?.props?.children;return Array.isArray(A)&&A.push(E.createElement(H.CalloutStackHandler)),F}}catch{}return V.call(this)};for(const E of K)E.forceUpdate()}),this.ChatContainer.ready((D,K)=>{const H=this,V=D.prototype.render,E=D.prototype.componentDidCatch;D.prototype.ffzRender=function(){if(H.chat.context.get("chat.banners.charity"))return V.call(this);const F=this.props.campaignData;this.props.campaignData=null;let A;try{A=V.call(this)}catch(N){throw this.props.campaignData=F,N}return this.props.campaignData=F,A},D.prototype.render=function(){try{if(H.CommunityStackHandler){const F=H.site.getReact(),A=this.ffzRender(),N=A?.props?.children?.props?.children;return F&&Array.isArray(N)&&N.push(F.createElement(H.CommunityStackHandler)),A}}catch{}return this.ffzRender()},D.prototype.componentDidCatch=function(F,A){const N=this.state.ffz_errors||0;if(N<100&&(this.setState({ffz_errors:N+1}),H.log.info("Error within Chat Container",F,A,N)),E)return E.call(this,F,A)};for(const F of K)this.containerMounted(F)}),this.subpump.on(":pubsub-message",D=>{if(D.prefix!=="community-points-channel-v1"||this.disable_handling)return;if(D.prefix==="pinned-chat-updates-v1"){this.log.debug("Pinned Chat",D);return}const K=this.ChatService.first,H=D.message,V=H?.data?.redemption;if(!H||!K||H.type!=="reward-redeemed"||K.props.channelID!=V?.channel_id||V.user_input)return;const E=V.reward?.id&&(0,B.get)(V.reward.id,K.props.rewardMap);if(E&&!this.chat.context.get("chat.filtering.blocked-types").has("ChannelPointsReward")){const F={id:V.id,type:this.chat_types.Message,ffz_type:"points",ffz_reward:E,ffz_reward_highlight:(0,i.ZH)(E),messageParts:[],user:{id:V.user.id,login:V.user.login,displayName:V.user.display_name},timestamp:new Date(H.data.timestamp||V.redeemed_at).getTime()};K.postMessageToCurrentChannel({},F)}})}shouldHideCallout(g){if(!g)return;g=xe[g]??g.replace(/_/g,"-");const D=this.callout_types??Te,K=this.chat.context.get("chat.filtering.blocked-callouts");return!!(K&&K.has(g)||g===D.CommunityPointsRewards&&!this.chat.context.get("chat.points.show-callouts")||g===D.ClipLiveNudge&&!this.chat.context.get("chat.callouts.clip")||g==="prime_gift_bomb"&&!this.chat.context.get("chat.community-chest.show")||g==="megacheer_emote_recipient"&&!t.chat.context.get("chat.bits.show-rewards"))}updateCallouts(){this.updatePinnedCallouts(),this.updateInlineCallouts()}updatePinnedCallouts(){for(const g of this.PinnedCallout.instances)this.onPinnedCallout(g)}onPinnedCallout(g){const D=g.props,K=D?.event,H=K?.type;this.shouldHideCallout(H)&&(g.props.pinned?g.unpin():g.hide()),H==="share-resub"&&!D.pinned&&this.chat.context.get("chat.pin-resubs")&&!g._ffz_pinned&&(this.log.info("Automatically pinning re-sub notice."),g._ffz_pinned=!0,g.pin()),H==="drop"&&this.autoClickDrop(g)}updateInlineCallouts(){for(const g of this.InlineCallout.instances)this.onInlineCallout(g)}onInlineCallout(g){if(g.state.isHidden)return;const D=g.props?.event?.callout?.contextMenuProps,K=D?.event??g.props?.event,H=K?.type;if(this.shouldHideCallout(H)||this.shouldHideCallout(g.props?.event?.trackingType)){g.setState({isHidden:!0});return}if(H==="share-resub"&&this.chat.context.get("chat.pin-resubs")&&!g._ffz_pinned){const V=D?.onPin;V&&(this.log.info("Automatically pinning re-sub notice."),g._ffz_pinned=!0,g.hideOnContextMenuAction?g.hideOnContextMenuAction(V)():V())}H==="drop"&&this.autoClickDrop(g)}autoClickDrop(g){if((g.props?.event?.callout?.contextMenuProps?.event??g.props?.event)?.type!=="drop"||g._ffz_clicking||!this.chat.context.get("chat.drops.auto-rewards"))return;g._ffz_clicking=!0,this.resolve("site").awaitElement('button[data-a-target="chat-private-callout__primary-button"]',this.fine.getHostNode(g),1e4).then(V=>{g._ffz_clicking=!1,!((g.props?.event?.callout?.contextMenuProps?.event??g.props?.event)?.type!=="drop"||!this.chat.context.get("chat.drops.auto-rewards"))&&V.click()}).catch(()=>{g._ffz_clicking=!1})}wrapRaidController(g){if(g._ffz_wrapped)return this.noAutoRaids(g);g._ffz_wrapped=!0;const D=this,K=g.handleJoinRaid;g.handleJoinRaid=function(H,...V){const E=g.props&&g.props.raid&&g.props.raid.id;return H&&H.type&&E&&D.joined_raids.add(E),K.call(this,H,...V)},this.noAutoRaids(g)}noAutoRaids(g){g._ffz_no_raid||(g._ffz_no_raid=setTimeout(()=>{if(g._ffz_no_raid=null,g.props&&g.props.raid&&!g.isRaidCreator&&g.hasJoinedCurrentRaid){const D=g.props.raid.id;if(this.joined_raids.has(D))return;let K=this.settings.get("channel.raids.no-autojoin");if(!K){const H=this.settings.get("__filter:channel.raids.blocked-channels");if(H&&(g.props.raid.targetLogin&&H.test(g.props.raid.targetLogin)||g.props.raid.targetDisplayName&&H.test(g.props.raid.targetDisplayName))&&(K=!0),!K)return}this.log.info("Automatically leaving raid:",D),g.handleLeaveRaid()}}))}toggleEmoteJail(){const g=this.chat.context.get("chat.emotes.2x"),D=this.chat.context.get("chat.emotes.limit-size");this.css_tweaks.toggle("big-emote-jail",D&&!g),this.css_tweaks.toggle("bigger-emote-jail",D&&g)}cleanHighlights(){const g={community_sub_gift:this.chat.context.get("chat.subs.gift-banner"),megacheer:this.chat.context.get("chat.bits.show"),hype_train:this.chat.context.get("chat.banners.hype-train"),prediction:this.chat.context.get("chat.banners.prediction"),poll:this.chat.context.get("chat.banners.polls"),pinned_chat:this.chat.context.get("chat.banners.pinned-message"),"mw-drop-available":this.chat.context.get("chat.banners.drops"),shared_chat:this.chat.context.get("chat.banners.shared-chat")},D=this.community_stack?.highlights;if(Array.isArray(D))for(const K of D){if(!K||!K.event||!K.id)continue;const H=K.event.type;H&&(0,B.has)(g,H)&&!g[H]&&(this.log.info("Removing community highlight: ",H,"#",K.id),this.community_dispatch({type:"remove-highlight",id:K.id})),H==="mw-drop-available"&&K.event.detailsURL==="https://blog.twitch.tv/2024/07/26/sub-and-get-apple-tv/"&&this.chat.context.get("chat.banners.hide-appleplus")&&(this.log.info("Removing community highlight: ",H,"#",K.id),this.community_dispatch({type:"remove-highlight",id:K.id}))}}cleanCallouts(){const g=this.callout_stack;g?.pinnedCallout?.event?.type&&this.shouldHideCallout(g.pinnedCallout.event.type)&&g.unpinCallout(),g?.callouts?.[0]?.event?.type&&this.shouldHideCallout(g.callouts[0].event.type)&&g.clearCalloutType(g.callouts[0].event.type)}defineClasses(){if(this.CommunityStackHandler&&this.CalloutStackHandler)return!0;const g=this,D=this.site.getReact(),K=D?.createElement,H=this.web_munch.getModule("highlightstack"),V=this.web_munch.getModule("calloutstack");return K?(!this.CalloutStackHandler&&V&&(this.CalloutStackHandler=function(){const E=D.useContext(V.stack);return g.callout_stack=E,g.cleanCallouts(),null},this.CalloutSelector.forceUpdate()),!this.CommunityStackHandler&&H&&(this.CommunityStackHandler=function(){const E=D.useContext(H.stack),F=D.useContext(H.dispatch);return g.community_stack=E,g.community_dispatch=F,g.cleanHighlights(),null},this.ChatContainer.forceUpdate()),!0):!1}updateChatState(g){const D=this.chat.context.get("context.chat_state")||{};(0,B.deep_equals)(g,D)||(this.chat.context.updateContext({chat_state:g}),this.input.updateInput())}tryUpdateBadges(){this._badge_timer||(this._badge_timer=setTimeout(()=>this._tryUpdateBadges(),0))}_tryUpdateBadges(){this._badge_timer&&clearTimeout(this._badge_timer),this._badge_timer=null,this.log.info("Trying to update badge data from the chat container.");const g=this.ChatContainer.first;g&&this.containerUpdated(g,g.props)}wrapChatBuffer(g){if(g.prototype._ffz_was_here)return;const D=this,K=g.prototype.clear,H=g.prototype.flushRawMessages,V=g.prototype.componentDidMount;g.prototype._ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const E=this,F=E.handleMessage,A=E.props.setMessageBufferAPI;E.props.setMessageBufferAPI=function(N){return N&&(N._ffz_inst=E),A(N)},E.handleMessage=function(N){if(N)try{const Y=D.chat_types||{},se=D.mod_types||{};if(D.chat.context.get("chat.filtering.blocked-types").has(Y[N.type])||N.type===Y.ChannelPointsReward&&!(0,i.zZ)(N.reward)||N.type===Y.RewardGift&&!D.chat.context.get("chat.bits.show-rewards"))return;if(N.type===Y.Message){const _e=D.chat.standardizeMessage(N),Q=E._ffz_connector??E.ffzGetConnector();let le=_e.roomID=_e.roomID?_e.roomID:Q?.props?.channelID,he=_e.roomLogin=_e.roomLogin?_e.roomLogin:_e.channel?_e.channel.slice(1):Q?.props?.channelLogin;if(!he&&le){const Ce=D.chat.getRoom(le,null,!0);Ce&&Ce.login&&(he=_e.roomLogin=Ce.login)}if(!le&&he){const Ce=D.chat.getRoom(null,he,!0);Ce&&Ce.id&&(le=_e.roomID=Ce.id)}const be=D.site.getUser();if(be&&Q&&(be.moderator=Q.props.isCurrentUserModerator,be.staff=Q.props.isStaff),_e.ffz_tokens=_e.ffz_tokens||D.chat.tokenizeMessage(_e,be,!0),_e.ffz_removed)return;if(D.hasListeners("chat:receive-message")){const Ce=D.makeEvent({message:_e,inst:E,channel:he,channelID:le});if(D.emit("chat:receive-message",Ce),Ce.defaultPrevented||_e.ffz_removed)return}}else if(N.type===Y.Moderation){if(D.emit("chat:mod-user",N.moderationType,N.userLogin,N.targetMessageID,N),!E.props.isCurrentUserModerator){const _e=N.moderationType,Q=N.userLogin;let le;if(_e===se.Ban?le="ban":_e===se.Timeout?le="timeout":_e===se.Delete&&(le="delete"),le&&(N.moderationActionType=le),!E.moderatedUsers.has(Q)&&_e!==se.Delete){E.moderateBuffers([E.buffer,E.delayedMessageBuffer.map(he=>he.event)],Q,N),E.delayedMessageBuffer.push({event:N,time:Date.now(),shouldDelay:!1});return}}}else N.type===Y.Clear&&(D.chat.context.get("chat.filtering.ignore-clear")?N={type:Y.Info,message:D.i18n.t("chat.ignore-clear","An attempt by a moderator to clear chat was ignored.")}:D.emit("chat:clear-chat",N))}catch(Y){D.log.error("Error processing chat event.",Y),D.log.capture(Y,{extra:{msg:N}})}return F.call(E,N)},E.setPaused=function(N){E.paused!==N&&(E.paused=N,N||(E.slidingWindowEnd=Math.min(E.buffer.length,D.chat.context.get("chat.scrollback-length")),E.props.isBackground||E.notifySubscribers()))},E.loadNewer=function(){if(!E.hasNewerLeft())return;const N=Math.min(E.buffer.length,E.slidingWindowEnd+40),Y=Math.max(0,N-D.chat.context.get("chat.scrollback-length"));E.clear(E.buffer.length-Y),E.slidingWindowEnd=N-Y,E.props.isBackground||E.notifySubscribers()},E.loadNewest=function(){if(!E.hasNewerLeft())return;const N=D.chat.context.get("chat.scrollback-length");E.clear(N),E.slidingWindowEnd=Math.min(N,E.buffer.length),E.props.isBackground||E.notifySubscribers()},E.getMessages=function(){return E.buffer.slice(0,E.slidingWindowEnd+(E.ffz_extra||0))}},g.prototype.componentDidMount=function(){try{this._ffzInstall()}catch(E){D.log.error("Error installing FFZ features onto chat buffer.",E)}return V.call(this)},g.prototype.clear=function(E){try{E==null&&(E=0);const F=D.chat.context.get("chat.scrollback-length");if(!this.isPaused()&&E>F&&(E=F),E<=0)this.ffz_extra=0,this.buffer=[],this.delayedMessageBuffer=[],this.paused=!1;else{const A=this.buffer,N=D.chat_types||me,Y=A.length-E;if(Y>0){let se=0,ue;for(let _e=0;_e<Y;_e++)A[_e]&&!Ee.includes(N[A[_e].type])&&(se++,ue=_e);this.buffer=A.slice(se%2!==0?Math.max(Y-4,ue):Y),this.ffz_extra=A.length-E}else this.ffz_extra=0,this.buffer=this.buffer.slice(0);this.paused&&this.buffer.length>=900&&this.setPaused(!1)}}catch(F){return D.log.error("Error running clear",F),K.call(this,E)}},g.prototype.ffzGetConnector=function(){if(this._ffz_connector)return this._ffz_connector;const E=Date.now();if(E-(this._ffz_connect_tried||0)>5e3){this._ffz_connect_tried=E;const F=D.ChatBufferConnector.first;if(F?.props?.messageBufferAPI?._ffz_inst===this)return this._ffz_connector=F}},g.prototype.flushRawMessages=function(){try{const E=[],F=D.chat_types||me,A=Date.now(),N=D.chat.context.get("chat.delay"),Y=N===-1?this.delayDuration:N,se=A-Y,ue=this.shouldSeeBlockedAndDeletedMessages||this.props&&this.props.shouldSeeBlockedAndDeletedMessages,_e=this.hasNewerLeft(),Q=this.isPaused(),le=D.chat.context.get("chat.scrollback-length"),he=D.chat.context.get("chat.filtering.remove-deleted"),be=D.hasListeners("chat:buffer-message");let Ce=0,ze=this.slidingWindowEnd,Me=!1,ce;for(const ye of this.delayedMessageBuffer)if(ye.time<=se||!ye.shouldDelay){if(he!==0&&(he>1||!ue)&&this.isDeletable(ye.event)&&ye.event.deleted)continue;if(be){if(ce)ce._reset();else{ce=D.makeEvent({inst:this,channel:void 0,channelID:void 0,message:void 0});const $e=this._ffz_connector??this.ffzGetConnector(),Ne=$e&&$e.props.channelID;if(ce.channelID=Ne,Ne){const tt=D.chat.getRoom(Ne,null,!0);tt&&tt.login&&(ce.channel=tt.login)}}if(ce.message=ye.event,D.emit("chat:buffer-message",ce),ce.defaultPrevented||ye.event.ffz_removed)continue}const we=this.buffer[this.buffer.length-1],Ae=we?.type;!this.props.isLoadingHistoricalMessages&&!this.props.historicalMessages||Ae!==F.Connected||ye.event.type===F.Connected||this.buffer.find($e=>$e.type===F.LiveMessageSeparator)||this.buffer.push({type:F.LiveMessageSeparator,id:"live-message-separator"}),this.buffer.push(ye.event),Me=!0,this.paused||(this.buffer.length>le?Ce++:ze++)}else E.push(ye);this.delayedMessageBuffer=E,Me&&(this.clear(Math.min(900,this.buffer.length-Ce)),Ce===0&&ze===this.slidingWindowEnd&&_e===this.hasNewerLeft()&&Q===this.isPaused()||(this.slidingWindowEnd=ze,this.props.isBackground||this.notifySubscribers())),this.flushHighlightsBuffer&&this.flushHighlightsBuffer()}catch(E){return D.log.error("Error running flush.",E),H.call(this)}}}addNotice(g,D){if(!g)return!1;g.startsWith("#")&&(g=g.slice(1)),g=g.toLowerCase();for(const K of this.ChatService.instances)if(g==="*"||K.props.channelLogin.toLowerCase()===g){if(typeof D=="string")K.addMessage({type:(this.chat_types??me).Notice,message:D});else{const H=K.props,V=H.channelLogin,E=H.channelID;D.markdown&&((0,U.e)()||(0,U.Z)()),K.addMessage({type:(this.chat_types??me).Message,channel:`#${V}`,roomID:E,roomLogin:V,id:`ffz_notice_${(0,B.generateUUID)()}`,ffz_type:"notice",ffz_no_actions:!0,ffz_data:D,message:null,messageParts:[],timestamp:Date.now(),user:{userID:E,userLogin:V}})}return!0}return!1}sendMessage(g,D){const K=this.ChatService.first;if(!K||!g)return null;if(g.startsWith("#")&&(g=g.slice(1)),g.toLowerCase()!==K.props.channelLogin.toLowerCase())return K.client.sendCommand(g,D);K.sendMessage(D)}scheduleMystery(g){g.line&&(g._timer||(g._timer=setTimeout(()=>requestAnimationFrame(()=>{g._timer=null,g.line&&g.line.forceUpdate()}),250)))}wrapChatService(g){const D=this,K=g.prototype.componentDidMount,H=g.prototype.addEventListeners;g.prototype._ffz_was_here=!0,g.prototype._ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const V=this,E=this.sendMessage,F=G((...N)=>V.addMessage(...N),"addMessage"),A=G((N,Y)=>V.sendMessage(N,Y),"sendMessage");V.sendMessage=function(N,Y){if(N=N.replace(/\s+/g," "),N.startsWith("/ffz:")){N=N.slice(5).trim();const ue=N.indexOf(" ");let _e;ue===-1?(_e=N,N=""):(_e=N.slice(0,ue),N=N.slice(ue+1).trimStart());const Q=D.makeEvent({command:_e,message:N,extra:Y,context:D.chat.context,channel:V.props.channelLogin,_inst:V,addMessage:F,sendMessage:A}),le=`chat:ffz-command:${_e}`;return D.listeners(le)?.length>0?D.emit(le,Q):V.addMessage({type:D.chat_types.Notice,message:D.i18n.t("chat.ffz-command.invalid","No such command: /ffz:{subcmd}",{subcmd:_e})}),!1}const se=D.makeEvent({message:N,extra:Y,context:D.chat.context,channel:V.props.channelLogin,_inst:V,addMessage:F,sendMessage:A});if(D.emit("chat:pre-send-message",se),!se.defaultPrevented)return E.call(this,se.message,se.extra)}},g.prototype.componentDidMount=function(){try{this._ffzInstall()}catch(V){D.log.error("Error installing FFZ features onto chat service.",V)}return K.call(this)},g.prototype.addEventListeners=function(...V){if(!this._ffz_init){const E=this;for(const ce of Se){const ye=this[ce];ye&&(this[ce]=function(we,Ae){E._wrapped=we;const $e=ye.call(E,we,Ae);return E._wrapped=null,$e})}const F=this.onAnnouncementEvent;this.onAnnouncementEvent=function(ce){return F.call(this,ce)};const A=this.onSubscriptionEvent;this.onSubscriptionEvent=function(ce){try{if(D.chat.context.get("chat.filtering.blocked-types").has("Subscription"))return;if(D.disable_handling||D.chat.context.get("chat.subs.native"))return A.call(E,ce);if(D.chat.context.get("chat.subs.show")<3)return;ce.body="";const ye=E.convertMessage({message:ce});return ye.ffz_type="resub",ye.gift_theme=ce.giftTheme,ye.sharedChat=ce.sharedChat,ye.sub_goal=E.getGoalData?E.getGoalData(ce.goalData):null,ye.sub_plan=ce.methods,ye.sub_multi=ce.multiMonthData?.multiMonthDuration?{count:ce.multiMonthData.multiMonthDuration,tenure:ce.multiMonthData.multiMonthTenure}:null,E.postMessageToCurrentChannel(ce,ye)}catch(ye){return D.log.capture(ye,{extra:ce}),A.call(E,ce)}};const N=this.onRoomStateEvent;this.onRoomStateEvent=function(ce){try{const ye=ce.channel,we=D.chat.context.get("context.channel");ye&&(ye===we||ye===`#${we}`)&&D.updateChatState(ce.state)}catch(ye){D.log.capture(ye,{extra:ce})}return N.call(E,ce)};const Y=this.onPinnedChatEvent;this.onPinnedChatEvent=function(ce){try{const ye=D.chat.context.get("chat.hype.message-style");if(ye!==1){if(ce.isSystemMessage&&ye===0)return;const we=E.convertMessage(ce);return we.ffz_type="hype",we.sharedChat=ce.sharedChat,we.hype_amount=ce.amount,we.hype_canonical_amount=ce.canonical_amount,we.hype_currency=ce.currency,we.hype_exponent=ce.exponent,we.hype_level=ce.level,ce.isSystemMessage&&(we.message="",we.messageBody="",we.messageParts=[],ce.message.body=""),E.postMessageToCurrentChannel(ce,we)}}catch(ye){D.log.capture(ye,{extra:ce})}return Y.call(E,ce)};const se=this.onResubscriptionEvent;this.onResubscriptionEvent=function(ce){try{if(D.chat.context.get("chat.filtering.blocked-types").has("Resubscription"))return;if(D.disable_handling||D.chat.context.get("chat.subs.native"))return se.call(E,ce);if(D.chat.context.get("chat.subs.show")<2&&!ce.body)return;const ye=E.convertMessage({message:ce});return ye.ffz_type="resub",ye.sharedChat=ce.sharedChat,ye.gift_theme=ce.giftTheme,ye.sub_goal=E.getGoalData?E.getGoalData(ce.goalData):null,ye.sub_cumulative=ce.cumulativeMonths||0,ye.sub_streak=ce.streakMonths||0,ye.sub_share_streak=ce.shouldShareStreakTenure,ye.sub_months=ce.months,ye.sub_plan=ce.methods,ye.sub_multi=ce.multiMonthData?.multiMonthDuration?{count:ce.multiMonthData.multiMonthDuration,tenure:ce.multiMonthData.multiMonthTenure}:null,E.postMessageToCurrentChannel(ce,ye)}catch(ye){return D.log.capture(ye,{extra:ce}),se.call(E,ce)}};const ue=this.ffz_mysteries={},_e=this.onSubscriptionGiftEvent;this.onSubscriptionGiftEvent=function(ce){try{if(D.chat.context.get("chat.filtering.blocked-types").has("SubGift"))return;if(D.disable_handling||D.chat.context.get("chat.subs.native"))return _e.call(E,ce);const ye=`${ce.channel}:${ce.user.userID}`,we=ue[ye];if(we)if(we.expires<Date.now())ue[ye]=null;else{we.recipients.push({id:ce.recipientID,login:ce.recipientLogin,displayName:ce.recipientName}),we.recipients.length>=we.size&&(ue[ye]=null),we.line&&D.scheduleMystery(we);return}ce.body="";const Ae=E.convertMessage({message:ce});return Ae.ffz_type="sub_gift",Ae.sharedChat=ce.sharedChat,Ae.sub_recipient={id:ce.recipientID,login:ce.recipientLogin,displayName:ce.recipientName},Ae.gift_theme=ce.giftTheme,Ae.sub_goal=E.getGoalData?E.getGoalData(ce.goalData):null,Ae.sub_months=ce.giftMonths,Ae.sub_plan=ce.methods,Ae.sub_total=ce.senderCount,E.postMessageToCurrentChannel(ce,Ae)}catch(ye){return D.log.capture(ye,{extra:ce}),_e.call(E,ce)}};const Q=this.onCommunityIntroductionEvent;this.onCommunityIntroductionEvent=function(ce){try{if(D.disable_handling)return Q.call(this,ce);if(D.chat.context.get("chat.filtering.blocked-types").has("CommunityIntroduction")){const ye=E.convertMessage(ce);return ye.sharedChat=ce.sharedChat,E.postMessageToCurrentChannel(ce,ye)}}catch(ye){D.log.capture(ye,{extra:ce}),D.log.error(ye)}return Q.call(this,ce)};const le=this.onAnonSubscriptionGiftEvent;this.onAnonSubscriptionGiftEvent=function(ce){try{if(D.chat.context.get("chat.filtering.blocked-types").has("AnonSubGift"))return;if(D.disable_handling||D.chat.context.get("chat.subs.native"))return le.call(E,ce);const ye=`${ce.channel}:ANON`,we=ue[ye];if(we)if(we.expires<Date.now())ue[ye]=null;else{we.recipients.push({id:ce.recipientID,login:ce.recipientLogin,displayName:ce.recipientName}),we.recipients.length>=we.size&&(ue[ye]=null),we.line&&D.scheduleMystery(we);return}ce.body="";const Ae=E.convertMessage({message:ce});return Ae.ffz_type="sub_gift",Ae.sharedChat=ce.sharedChat,Ae.gift_theme=ce.giftTheme,Ae.sub_goal=E.getGoalData?E.getGoalData(ce.goalData):null,Ae.sub_anon=!0,Ae.sub_recipient={id:ce.recipientID,login:ce.recipientLogin,displayName:ce.recipientName},Ae.sub_months=ce.giftMonths,Ae.sub_plan=ce.methods,Ae.sub_total=ce.senderCount,E.postMessageToCurrentChannel(ce,Ae)}catch(ye){return D.log.capture(ye,{extra:ce}),le.call(E,ce)}};const he=this.onSubscriptionMysteryGiftEvent;this.onSubscriptionMysteryGiftEvent=function(ce){try{if(D.chat.context.get("chat.filtering.blocked-types").has("SubMysteryGift"))return;if(D.disable_handling||D.chat.context.get("chat.subs.native"))return he.call(E,ce);let ye=null;if(ce.massGiftCount>D.chat.context.get("chat.subs.merge-gifts")){const Ae=`${ce.channel}:${ce.user.userID}`;ye=ue[Ae]={recipients:[],size:ce.massGiftCount,expires:Date.now()+3e4}}ce.body="";const we=E.convertMessage({message:ce});return we.ffz_type="sub_mystery",we.sharedChat=ce.sharedChat,we.gift_theme=ce.giftTheme,we.sub_goal=E.getGoalData?E.getGoalData(ce.goalData):null,we.mystery=ye,we.sub_plan=ce.plan,we.sub_count=ce.massGiftCount,we.sub_total=ce.senderCount,E.postMessageToCurrentChannel(ce,we)}catch(ye){return D.log.capture(ye,{extra:ce}),he.call(E,ce)}};const be=this.onAnonSubscriptionMysteryGiftEvent;this.onAnonSubscriptionMysteryGiftEvent=function(ce){try{if(D.chat.context.get("chat.filtering.blocked-types").has("AnonSubMysteryGift"))return;if(D.disable_handling||D.chat.context.get("chat.subs.native"))return be.call(E,ce);let ye=null;if(ce.massGiftCount>D.chat.context.get("chat.subs.merge-gifts")){const Ae=`${ce.channel}:ANON`;ye=ue[Ae]={recipients:[],size:ce.massGiftCount,expires:Date.now()+3e4}}ce.body="";const we=E.convertMessage({message:ce});return we.ffz_type="sub_mystery",we.sharedChat=ce.sharedChat,we.sub_anon=!0,we.mystery=ye,we.sub_plan=ce.plan,we.sub_count=ce.massGiftCount,we.sub_total=ce.senderCount,E.postMessageToCurrentChannel(ce,we)}catch(ye){return D.log.capture(ye,{extra:ce}),be.call(E,ce)}};const Ce=this.onRitualEvent;this.onRitualEvent=function(ce){try{if(D.chat.context.get("chat.filtering.blocked-types").has("Ritual"))return;if(D.disable_handling)return Ce.call(E,ce);const ye=E.convertMessage(ce);return ye.sharedChat=ce.sharedChat,ye.ffz_type="ritual",ye.ritual=ce.type,E.postMessageToCurrentChannel(ce,ye)}catch(ye){return D.log.capture(ye,{extra:ce}),Ce.call(E,ce)}};const ze=this.onChannelPointsRewardEvent;this.onChannelPointsRewardEvent=function(ce){try{if(D.chat.context.get("chat.filtering.blocked-types").has("ChannelPointsReward"))return;if(D.disable_handling)return ze.call(E,ce);const ye=ce.rewardID&&(0,B.get)(ce.rewardID,E.props.rewardMap);if(ye){const we=E.convertMessage(ce);return D.chat.context.get("chat.powerup.effects")&&(0,i.zZ)(ye)&&ce.animationID?E.postMessageToCurrentChannel(ce,{type:D.chat_types.ChannelPointsReward,id:we.id,displayName:we.user.userDisplayName,login:we.user.userLogin,reward:ye,message:we,userID:we.user.userID,animationID:ce.animationID,sharedChat:ce.sharedChat}):(we.ffz_animation_id=ce.animationID,we.sharedChat=ce.sharedChat,we.ffz_type="points",we.ffz_reward=ye,we.ffz_reward_highlight=(0,i.ZH)(ye),E.postMessageToCurrentChannel(ce,we))}}catch(ye){D.log.error(ye),D.log.capture(ye,{extra:ce})}return ze.call(E,ce)};const Me=this.addMessage;this.addMessage=function(ce){const ye=E._wrapped;return ye&&!ce._ffz_checked?E.postMessageToCurrentChannel(ye,ce):Me.call(E,ce)},this._ffz_init=!0}return H.apply(this,...V)},g.prototype.postMessageToCurrentChannel=function(V,E){const F=E;if(E._ffz_checked=!0,(E.type===D.chat_types.ChannelPointsReward||E.type===D.chat_types.CommunityIntroduction||E.message?.user&E.message?.badgeDynamicData)&&(E=E.message),V.channel){let A=E.channel=V.channel.toLowerCase();if(A.startsWith("#")&&(A=A.slice(1)),A!==this.props.channelLogin.toLowerCase())return;E.roomLogin=A}if(E.ffz_first_msg=E.isFirstMsg||V.message?.isFirstMsg||!1,E.ffz_returning=V.message?.isReturningChatter||!1,V.message){const A=V.message.user,N=V.message.flags;if(A&&(E.emotes=A.emotes),N&&this.getFilterFlagOptions){const Y=this.props.isCurrentUserModerator&&D.chat.context.get("chat.automod.run-as-mod");Y&&(this.props.isCurrentUserModerator=!1),E.flags=this.getFilterFlagOptions(N),Y&&(this.props.isCurrentUserModerator=!0)}(!E.message||typeof E.message=="string")&&(typeof V.action=="string"?E.message=V.action:E.message=V.message.body)}this.addMessage(F)}}addRoom(g,D){if(D||(D=g.props),!D.channelID)return null;const K=g._ffz_room=this.chat.getRoom(D.channelID,D.channelLogin&&D.channelLogin.toLowerCase(),!1,!0);return K.ref(g),K}removeRoom(g){g._ffz_room&&(g._ffz_room.unref(g),g._ffz_room=null)}chatMounted(g,D){g.chatBuffer&&(g.chatBuffer.ffzController=g),D||(D=g.props),this.addRoom(g,D)&&(this.updateRoomBitsConfig(g,D.bitsConfig),this.settings.updateContext({moderator:D.isCurrentUserModerator,chatHidden:D.isHidden}),(D.isEmbedded||D.isPopout)&&this.settings.updateContext({channel:D.channelLogin&&D.channelLogin.toLowerCase(),channelID:D.channelID}),this.chat.context.updateContext({moderator:D.isCurrentUserModerator,channel:D.channelLogin&&D.channelLogin.toLowerCase(),channelID:D.channelID}))}chatUnmounted(g){g.chatBuffer&&g.chatBuffer.ffzController===this&&(g.chatBuffer.ffzController=null),(g.props.isEmbedded||g.props.isPopout)&&this.settings.updateContext({channel:null,channelID:null}),this.settings.updateContext({moderator:!1,chatHidden:!1}),this.chat.context.updateContext({moderator:!1,channel:null,channelID:null}),this.removeRoom(g)}chatUpdated(g,D){if(g.chatBuffer&&(g.chatBuffer.ffzController=g),!g._ffz_room||D.channelID!=g._ffz_room.id){this.removeRoom(g),g._ffz_mounted&&this.chatMounted(g);return}D.bitsConfig!==g.props.bitsConfig&&this.updateRoomBitsConfig(g,g.props.bitsConfig);let K=g.props.channelLogin;K&&(K=K.toLowerCase()),(g.props.isEmbedded||g.props.isPopout)&&this.settings.updateContext({channel:K,channelID:g.props.channelID}),this.settings.updateContext({moderator:g.props.isCurrentUserModerator,chatHidden:g.props.isHidden}),this.chat.context.updateContext({moderator:g.props.isCurrentUserModerator,channel:K,channelID:g.props.channelID})}updateRoomBitsConfig(g,D){const K=g._ffz_room;if(!K)return;let H=null;if(D&&Array.isArray(D.orderedActions)){H=new Set;for(const V of D.orderedActions)V&&V.prefix&&H.add(V.prefix)}!this._ffz_old_bits&&!H||(0,B.set_equals)(this._ffz_old_bits,H)||(this._ffz_old_bits=H,K.updateBitsConfig(ie(D)),this.chat_line.updateLineTokens())}connectorMounted(g){const D=g.props.messageBufferAPI;D&&D._ffz_inst&&D._ffz_inst._ffz_connector!==g&&(D._ffz_inst._ffz_connector=g)}connectorUpdated(g,D){const K=D.messageBufferAPI,H=g.props.messageBufferAPI;K!==H&&(K&&K._ffz_inst&&K._ffz_inst._ffz_connector===g&&(K._ffz_inst._ffz_connector=null),H&&H._ffz_inst&&H._ffz_inst._ffz_connector!==g&&(K._ffz_inst._ffz_connector=g))}connectorUnmounted(g){const D=g.props.messageBufferAPI;D&&D._ffz_inst&&D._ffz_inst._ffz_connector===g&&(D._ffz_inst._ffz_connector=null)}rendererMounted(g,D){D||(D=g.props),this.updateRendererSharedChats(g,D?.sharedChatDataByChannelID)}updateRendererSharedChats(g,D){if(D??(D=g.props.sharedChatDataByChannelID),g._ffz_cached_shared===D)return;this.shared_room_data=g._ffz_cached_shared=D,this.shared_rooms=g._ffz_shared_rooms=g._ffz_shared_rooms||{};const K=new Set(Object.keys(g._ffz_shared_rooms));let H=!1;if(D!=null)for(const[E,F]of D.entries()){K.delete(E);let A=g._ffz_shared_rooms[E];A||(A=this.chat.getRoom(E,F.login),A.ref(g),g._ffz_shared_rooms[E]=A);const N=F.badges?.channelsBySet;let Y=0;if(N)for(const se of N.values())for(const ue of se.values())Y++;A.badgeCount()!==Y&&(H=!0,A.updateBadges(N))}for(const E of K){const F=g._ffz_shared_rooms[E];F&&F.unref(g),F.unshareChat(),delete g._ffz_shared_rooms[E]}const V=Object.keys(g._ffz_shared_rooms);for(const E of Object.values(g._ffz_shared_rooms))E.shareChats(V);V.length>0&&this.settings.provider.get("shared-chat-notice")!==1&&(this.settings.provider.set("shared-chat-notice",1),this.addNotice("*",{icon:"ffz-i-zreknarf",message:this.i18n.t("chat.shared-chat.welcome","FrankerFaceZ: This is a Shared Chat, a new feature from Twitch to combine multiple stream chats into one. FrankerFaceZ support is early, so some messages might not look correct. Sorry for any trouble!")})),H&&this.chat_line.updateLineBadges()}rendererUnmounted(g){if(g._ffz_shared_rooms)for(const D of Object.values(g._ffz_shared_rooms))D.unref(g);g._ffz_shared_rooms=null,g._ffz_cached_shared=null,this.shared_room_data=new Map,this.shared_rooms={}}rendererUpdated(g,D){this.updateRendererSharedChats(g,D?.sharedChatDataByChannelID)}get shouldUpdateChannel(){const g=this.router.current_name;return v.Z.POPOUT_ROUTES.includes(g)||v.Z.SUNLIGHT_ROUTES.includes(g)}containerMounted(g,D){if(D||(D=g.props),!!this.addRoom(g,D)&&(this.updateRoomBitsConfig(g,D.bitsConfig),D.globalBadgeData?.badges?this.chat.badges.updateTwitchBadges(D.globalBadgeData.badges):D.data?.badges&&this.chat.badges.updateTwitchBadges(D.data.badges),D.data)){if(this.shouldUpdateChannel){const K=D.data.user?.primaryColorHex;this.resolve("site.channel").updateChannelColor(K),this.settings.updateContext({channel:D.channelLogin,channelID:D.channelID,channelColor:K})}this.updateRoomBadges(g,D.data.user&&D.data.user.broadcastBadges),this.updateRoomRules(g,D.chatRules)}}containerUnmounted(g){this.shouldUpdateChannel&&(this.resolve("site.channel").updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})),this.removeRoom(g)}containerUpdated(g,D){if(!g._ffz_room||D.channelID!=g._ffz_room.id){this.removeRoom(g),g._ffz_mounted&&this.containerMounted(g,D);return}if(D.bitsConfig!==g.props.bitsConfig&&this.updateRoomBitsConfig(g,D.bitsConfig),D.data&&v.Z.POPOUT_ROUTES.includes(this.router.current_name)){const F=D.data.user?.primaryColorHex;this.resolve("site.channel").updateChannelColor(F),this.settings.updateContext({channel:D.channelLogin,channelID:D.channelID,channelColor:F})}const K=D.data?.user?.broadcastBadges??[],H=g.props.data?.user?.broadcastBadges??[],V=D.globalBadgeData?.badges??[],E=g.props.globalBadgeData?.badges??[];(this.chat.badges.getTwitchBadgeCount()!==V.length||V.length!==E.length)&&this.chat.badges.updateTwitchBadges(V),(g._ffz_room.badgeCount()!==K.length||K.length!==H.length)&&this.updateRoomBadges(g,K),this.updateRoomRules(g,D.chatRules)}hasRoomBadges(g){const D=g._ffz_room;return D?D.hasBadges():!1}updateRoomBadges(g,D){const K=g._ffz_room;K&&(K.updateBadges(D),this.chat_line.updateLineBadges())}updateRoomRules(g,D){const K=g._ffz_room;K&&(K.rules=D)}};G(ct,"ChatHook");let re=ct;function ie(Oe){if(!Oe)return;const g={},D=Oe.indexedActions,K={};if(Array.isArray(Oe.tiers))for(const H of Oe.tiers)K[H.bits]=H.color;for(const H in D)if((0,B.has)(D,H)){const V=D[H],E=g[H]={id:V.id,prefix:V.prefix,tiers:[]};if(Oe?.getImage)for(const F of V.orderedTiers){const A={};for(const N of["light","dark"]){const Y=A[N]=A[N]||{},se=Y.static=Y.static||{},ue=Y.animated=Y.animated||{};for(const _e of[1,2,4])se[_e]=Oe.getImage(V.prefix,N,"static",F.bits,_e,"png"),ue[_e]=Oe.getImage(V.prefix,N,"animated",F.bits,_e,"gif")}E.tiers.push({amount:F.bits,color:F.color||K[F.bits]||"inherit",id:F.id,images:A})}else if(V.orderedTiers[0]?.images)for(const F of V.orderedTiers){const A={};for(const N of F.images){const Y=A[N.theme]=A[N.theme]||[],se=N.isAnimated?"animated":"static",ue=Y[se]=Y[se]||{};ue[N.dpiScale]=N.url}E.tiers.push({amount:F.bits,color:F.color||K[F.bits]||"inherit",id:F.id,images:A})}}return g}G(ie,"formatBitsConfig")},44615:(ae,J,d)=>{"use strict";d.d(J,{KC:()=>W,ZH:()=>I,_x:()=>U,at:()=>v,yg:()=>u,zZ:()=>z});function W(y){return y.pricingType==="BITS"}G(W,"doesRewardCostBits");function B(y){return y?.__typename==="CommunityPointsAutomaticReward"}G(B,"isAutomaticReward");function R(y){return y?.__typename==="CommunityPointsCustomReward"}G(R,"isCustomReward");function I(y){return B(y)&&y.type==="SEND_HIGHLIGHTED_MESSAGE"}G(I,"isHighlightedReward");function U(y){return y&&(y.title?.includes?.("FFZ:GE")||y.prompt?.includes?.("FFZ:GE"))}G(U,"isGiantEmoteReward");function z(y){return y?.type==="SEND_ANIMATED_MESSAGE"}G(z,"isMessageEffect");function v(y){const S=W(y);return B(y)?S?y.bitsCost||y.defaultBitsCost:y.cost||y.defaultCost:S?y.bitsCost:y.cost}G(v,"getRewardCost");function f(y){return B(y)?y.backgroundColor||y.defaultBackgroundColor:y.backgroundColor}G(f,"getRewardColor");function u(y,S){if(R(y))return y.title;switch(y.type){case"SEND_ANIMATED_MESSAGE":return S.t("chat.points.animated","Message Effects");case"SEND_HIGHLIGHTED_MESSAGE":return S.t("chat.points.highlighted","Highlight My Message");case"SINGLE_MESSAGE_BYPASS_SUB_MODE":return S.t("chat.points.bypass-sub","Send a Message in Sub-Only Mode");case"CHOSEN_SUB_EMOTE_UNLOCK":return S.t("chat.points.choose-emote","Choose an Emote to Unlock");case"RANDOM_SUB_EMOTE_UNLOCK":return S.t("chat.points.random-emote","Unlock a Random Sub Emote");case"CHOSEN_MODIFIED_SUB_EMOTE_UNLOCK":return S.t("chat.points.modify-emote","Modify a Single Emote");default:return S.t("chat.points.reward","Reward")}}G(u,"getRewardTitle")},6325:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>R});var W=d(22527),B=d(46949);const I=class I extends W.default{constructor(...z){super(...z),this.should_enable=!0,this.inject("settings"),this.inject("site.chat"),this.inject("chat.emotes")}onEnable(){this.hookEmoteMenu()}async hookEmoteMenu(){const z=await this.findEmoteMenu();if(!z)return this.log.info("Emote Menu for Twitch was not found after 60 seconds.");z.registerEmoteGetter("FrankerFaceZ",()=>{const v=this.chat.ChatContainer.first,f=v&&v.props;if(!f)return;const u=this.emotes.getSets(f.userID,f.currentUserLogin,f.channelID,f.channelLogin),y=this.resolve("chat"),S=(y?.context||this.settings)?.get?.("chat.emotes.animated")>0,n=[];for(const s of u)if(!(!s||!s.emotes)){for(const i in s.emotes)if((0,B.has)(s.emotes,i)){const l=s.emotes[i];if(l.hidden)continue;n.push({text:l.name,url:S&&l.animated?.[1]||l.urls[1],channel:`${s.source||"FrankerFaceZ"} ${s.title}`,badge:s.icon||"//cdn.frankerfacez.com/script/devicon.png"})}}return n})}async findEmoteMenu(z=0){return window.emoteMenu&&emoteMenu.registerEmoteGetter?emoteMenu:z>=6e4?null:(await(0,B.sleep)(100),this.findEmoteMenu(z+100))}};G(I,"CompatEmoteMenu");let R=I},17103:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>v});var W=d(22527),B=d(44589),R=d(46949),I=d(83342);const U=document.createElement("span"),z={"side-nav":".side-nav,#sideNav","side-nav-viewers":".side-nav-card__live-status","side-rec-channels":".side-nav .recommended-channels,.side-nav .side-nav-section + .side-nav-section:not(.online-friends):not(.bd--shelf)","side-friends":".side-nav .online-friends","side-closed-friends":".side-nav--collapsed .online-friends","side-closed-rec-channels":".side-nav--collapsed .recommended-channels,.side-nav--collapsed .side-nav-section + .side-nav-section:not(.online-friends):not(.bd--shelf)","side-offline-channels":".ffz--side-nav-card-offline","side-rerun-channels":".side-nav .ffz--side-nav-card-rerun","modview-hide-info":".modview-player-widget__hide-stream-info","community-highlights":".community-highlight-stack__card","elevate-your-message":'.chat-input__input-icons button[aria-label="ElevatedMessage"]',"prime-offers":".top-nav__prime","discover-luna":'.top-nav__external-link[data-a-target="try-presto-link"]',subtember:".subtember-gradient","player-gain-volume":'.video-player__container[data-compressed="true"] .volume-slider__slider-container:not(.ffz--player-gain)',"player-ext":".video-player .extension-taskbar,.video-player .extension-container,.video-player .extensions-dock__layout,.video-player .extensions-notifications,.video-player .extensions-video-overlay-size-container,.video-player .extensions-dock__layout","player-ext-hover":'.video-player__container[data-controls="false"] .extension-taskbar,.video-player__container[data-controls="false"] .extension-container,.video-player__container[data-controls="false"] .extensions-dock__layout,.video-player__container[data-controls="false"] .extensions-notifications,.video-player__container[data-controls="false"] .extensions-video-overlay-size-container',"player-cast":".video-player button:has(.tw-chromecast-button__icon)","player-event-bar":".channel-root .live-event-banner-ui__header","player-rerun-bar":'.channel-root__player-container div.tw-c-text-overlay:not([data-a-target="hosting-ui-header"])',"pinned-cheer":'.pinned-cheer,.pinned-cheer-v2,.channel-leaderboard,.channel-leaderboard-marquee,div[data-test-selector="channel-leaderboard-container"]',whispers:'body .whispers-open-threads,.tw-core-button[data-a-target="whisper-box-button"],.whispers__pill',"dir-live-ind":'.live-channel-card[data-ffz-type="live"] .tw-channel-status-text-indicator,article[data-ffz-type="live"] .tw-channel-status-text-indicator,.switcher-hopper__scroll-container .tw-tower a[data-ffz-type="live"] .tw-channel-status-text-indicator',"profile-hover":".preview-card .tw-relative:hover .ffz-channel-avatar","not-live-bar":'div[data-test-selector="non-live-video-banner-layout"]',"channel-live-ind":".channel-header__user .tw-channel-status-text-indicator,.channel-info-content .tw-halo__indicator",celebration:"body .celebration__overlay","last-x-events":".last-x-events_container","pinned-hype-chat":".paid-pinned-chat-message-list","side-stories":".side-nav__title + div[class*=storiesLeftNavSection]","ci-mod-view":'.chat-input__buttons-container a[href*="/moderator"]',"ci-highlight-settings":'.chat-input__buttons-container button[data-highlight-selector="chat-highlights-shortcut"]',"ci-shield-mode":'.chat-input__buttons-container > div:last-child button[class|="ScCoreButton"]:not([data-highlight-selector]):not([data-a-target])'},f=class f extends W.default{constructor(...y){super(...y),this.should_enable=!0,this.inject("settings"),this.style=new B.ManagedStyle,this.chunks={},this.chunks_loaded=!1,this._state={},this.settings.add("metadata.modview.hide-info",{default:!1,ui:{path:"Channel > Metadata >> Mod View",title:'Hide "Hide Stream Info Stripe" button.',component:"setting-check-box"},changed:S=>this.toggleHide("modview-hide-info",S)}),this.settings.add("metadata.viewers.no-native",{requires:["metadata.viewers"],default:null,process(S,n){return n??S.get("metadata.viewers")},changed:S=>this.toggle("hide-native-viewers",S),ui:{path:"Channel > Metadata >> Player",title:"Hide Twitch's native Viewer Count.",description:"By default, this is enabled whenever FFZ's own Viewer Count display is enabled to avoid redundant information.",component:"setting-check-box"}}),this.settings.add("metadata.uptime.no-native",{requires:["metadata.uptime"],default:null,process(S,n){return n??S.get("metadata.uptime")!==0},changed:S=>this.toggle("hide-native-uptime",S),ui:{path:"Channel > Metadata >> Player",title:"Hide Twitch's native Stream Uptime.",description:"By default, this is enabled whenever FFZ's own Stream Uptime display is enabled to avoid redundant information.",component:"setting-check-box"}}),this.settings.add("layout.use-chat-fix",{requires:["context.force_chat_fix","layout.swap-sidebars","layout.use-portrait","chat.use-width","context.isWatchParty"],process(S){return S.get("context.isWatchParty")?!1:S.get("context.force_chat_fix")||S.get("layout.swap-sidebars")||S.get("layout.use-portrait")||S.get("chat.use-width")},changed:S=>{S?this.toggle("chat-no-animate",!0):!S&&!this._no_anim_timer&&(this._no_anim_timer=requestAnimationFrame(()=>{this._no_anim_timer=null,this.settings.get("layout.use-chat-fix")||this.toggle("chat-no-animate",!1)})),this.toggle("chat-fix",S),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}}),this.settings.add("layout.side-nav.hide-stories",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Stories",component:"setting-check-box"}}),this.settings.add("layout.side-nav.show",{default:1,requires:["layout.use-portrait"],process(S,n){return n===2?!S.get("layout.use-portrait"):n},ui:{sort:-1,path:"Appearance > Layout >> Side Navigation",title:"Display Side Navigation",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"Hide in Portrait"}]},changed:S=>{this.toggle("hide-side-nav",!S),this.emit("site.layout:resize")}}),this.settings.add("layout.side-nav.hide-viewers",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Channel View Counts",component:"setting-check-box"},changed:S=>this.toggleHide("side-nav-viewers",S)}),this.settings.add("layout.side-nav.show-avatars",{default:!0,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Channel Avatars",component:"setting-check-box"},changed:S=>this.toggle("hide-side-nav-avatars",!S)}),this.settings.add("layout.side-nav.show-rec-channels",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Recommended / Popular Channels",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Side Navigation is Open"}]},changed:S=>{this.toggleHide("side-rec-channels",S===0),this.toggleHide("side-closed-rec-channels",S===2)}}),this.settings.add("layout.side-nav.show-friends",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Online Friends",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Side Navigation is Open"}]},changed:S=>{this.toggleHide("side-friends",S===0),this.toggleHide("side-closed-friends",S===2)}}),this.settings.add("layout.side-nav.hide-offline",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Offline Channels",component:"setting-check-box"},changed:S=>this.toggleHide("side-offline-channels",S)}),this.settings.add("layout.side-nav.rerun-style",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Reruns",component:"setting-select-box",data:[{value:0,title:"Do Not Display"},{value:1,title:"Normally"},{value:2,title:"Faded (33% Opacity)"}]},changed:S=>{this.toggleHide("side-rerun-channels",S===0),this.toggle("side-rerun-opacity",S===2)}}),this.settings.add("layout.swap-sidebars",{default:!1,requires:["context.isWatchParty"],process(S,n){return S.get("context.isWatchParty")?!1:n},ui:{path:"Appearance > Layout >> Side Navigation",title:"Swap Sidebars",description:"Swap navigation and chat to the opposite sides of the window.",component:"setting-check-box"},changed:S=>{this.toggle("swap-sidebars",S),this.emit("site.layout:resize")}}),this.settings.add("layout.minimal-navigation",{requires:["layout.theatre-navigation","context.isWatchParty"],default:!1,process(S,n){return S.get("context.isWatchParty")?!1:S.get("layout.theatre-navigation")?!0:n},ui:{path:"Appearance > Layout >> Top Navigation",title:"Minimize Navigation",description:"Slide the site navigation bar up out of view when it isn't in use.",component:"setting-check-box"},changed:S=>{this.toggle("minimal-navigation",S),this.emit("site.layout:resize")}}),this.settings.add("layout.theatre-navigation",{requires:["layout.is-theater-mode"],default:!1,process(S,n){return S.get("layout.is-theater-mode")?n:!1},ui:{path:"Appearance > Layout >> Top Navigation",title:"Show the minimized navigation bar when in theatre mode.",component:"setting-check-box"},changed:S=>{this.toggle("theatre-nav",S),this.emit("site.layout:resize")}}),this.settings.add("layout.subtember",{default:!0,ui:{path:"Appearance > Layout >> Channel",title:"Allow the Subtember upsell banner to appear.",component:"setting-check-box"}}),this.settings.add("layout.turbo-cta",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Allow the Twitch Turbo button to appear.",component:"setting-check-box"}}),this.settings.add("layout.prime-offers",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Show Prime Gaming Loot.",component:"setting-check-box"},changed:S=>this.toggleHide("prime-offers",!S)}),this.settings.add("layout.hide-discover-luna",{default:!1,ui:{path:"Appearance > Layout >> Top Navigation",title:'Hide the "Discover Luna" link.',component:"setting-check-box"},changed:S=>this.toggleHide("discover-luna",S)}),this.settings.add("whispers.show",{default:!0,ui:{path:"Chat > Whispers >> General",title:"Display Whispers",component:"setting-check-box"},changed:S=>{this.toggleHide("whispers",!S),this.emit("site.layout:resize")}}),this.settings.add("chat.hype.show-pinned",{default:!0,ui:{path:"Chat > Hype Chat >> Appearance",title:"Allow Hype Chat messages to appear pinned at the top of chat.",component:"setting-check-box"},changed:S=>this.toggleHide("pinned-hype-chat",!S)}),this.settings.add("chat.bits.show",{default:!0,ui:{order:-1,path:"Chat > Bits and Cheering >> Appearance",title:"Display Bits",description:"Display UI associated with bits. Note: This will not hide cheering in chat messages.",component:"setting-check-box"},changed:S=>this.toggle("hide-bits",!S)}),this.settings.add("channel.show-celebrations",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Allow Celebrations to appear.",description:"Celebrations are animations that cover the entire Twitch page.",component:"setting-check-box"},changed:S=>this.toggleHide("celebration",!S)}),this.settings.add("layout.theme.global-font",{default:"",ui:{path:"Appearance > Theme >> Fonts",title:"Font Family",description:'Override the font used for the entire Twitch website. The old default font was: `"Helvetica Neue",Helvetica,Arial,sans-serif`\n\nAny font available via [Google Fonts](https://fonts.google.com/) can be loaded by prefixing the font name with `google:`.',component:"setting-combo-box",data:()=>(0,I.R7)()},changed:()=>this.updateFont()}),this.settings.add("channel.hide-unfollow",{default:!1,ui:{path:"Channel > Appearance >> General",title:"Hide the Unfollow button.",component:"setting-check-box"},changed:S=>this.toggle("hide-unfollow-button",S)}),this.settings.add("channel.hide-live-indicator",{requires:["context.route.name"],process(S,n){return S.get("context.route.name")==="user"||S.get("context.route.name")==="user-home"?n:!1},default:!1,ui:{path:"Channel > Appearance >> General",title:'Hide the "LIVE" indicator on live channel pages.',component:"setting-check-box"},changed:S=>this.toggleHide("channel-live-ind",S)}),this.settings.add("channel.round-avatars",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Allow avatar images to be rounded.",component:"setting-check-box"},changed:S=>this.toggle("square-avatars",!S)})}onEnable(){this.toggleHide("modview-hide-info",this.settings.get("metadata.modview.hide-info")),this.toggleHide("side-nav-viewers",this.settings.get("layout.side-nav.hide-viewers")),this.toggle("hide-native-uptime",this.settings.get("metadata.uptime.no-native")),this.toggle("hide-native-viewers",this.settings.get("metadata.viewers.no-native")),this.toggle("chat-fix",this.settings.get("layout.use-chat-fix")),this.toggle("swap-sidebars",this.settings.get("layout.swap-sidebars")),this.toggle("minimal-navigation",this.settings.get("layout.minimal-navigation")),this.toggle("theatre-nav",this.settings.get("layout.theatre-navigation")),this.toggle("hide-side-nav-avatars",!this.settings.get("layout.side-nav.show-avatars")),this.toggle("hide-side-nav",!this.settings.get("layout.side-nav.show")),this.toggleHide("side-offline-channels",this.settings.get("layout.side-nav.hide-offline")),this.toggleHide("discover-luna",this.settings.get("layout.hide-discover-luna")),this.toggleHide("prime-offers",!this.settings.get("layout.prime-offers")),this.toggle("hide-unfollow-button",this.settings.get("channel.hide-unfollow")),this.toggleHide("pinned-hype-chat",!this.settings.get("chat.hype.show-pinned")),this.toggle("square-avatars",!this.settings.get("channel.round-avatars")),this.toggleHide("channel-live-ind",this.settings.get("channel.hide-live-indicator"));const y=this.settings.get("layout.side-nav.rerun-style");this.toggleHide("side-rerun-channels",y===0),this.toggle("side-rerun-opacity",y===2);const S=this.settings.get("layout.side-nav.show-rec-channels");this.toggleHide("side-rec-channels",S===0),this.toggleHide("side-closed-rec-channels",S===2);const n=this.settings.get("layout.side-nav.show-friends");this.toggleHide("side-friends",n===0),this.toggleHide("side-closed-friends",n===2),this.toggleHide("whispers",!this.settings.get("whispers.show")),this.toggleHide("celebration",!this.settings.get("channel.show-celebrations")),this.settings.getChanges("layout.subtember",s=>this.toggleHide("subtember",!s)),this.settings.getChanges("layout.side-nav.hide-stories",s=>this.toggleHide("side-stories",s)),this.updateFont(),this.updateTopNav(),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}updateTopNav(){requestAnimationFrame(()=>this.emit("site.layout:update-nav"))}updateFont(){let y=this.settings.get("layout.theme.global-font");if(y&&y.length){const[S,n]=(0,I.jo)(y);if(y=S,this._font_unloader&&this._font_unloader(),this._font_unloader=n,y.indexOf(" ")!==-1&&y.indexOf(",")===-1&&y.indexOf('"')===-1&&y.indexOf("'")===-1&&(y=`"${y}"`),U.style.fontFamily="",U.style.fontFamily=y,U.style.fontFamily){this.setVariable("global-font",y),this.toggle("global-font",!0);return}}this.toggle("global-font",!1),this.deleteVariable("global-font")}toggleHide(y,S){const n=`hide--${y}`;if(!S){this.style.delete(n);return}if(!(0,R.has)(z,y))throw new Error(`cannot find class for "${y}"`);this.style.set(n,`${z[y]} { display: none !important }`)}toggle(y,S){S=!!S,(this._state[y]??!1)!==S&&(this._state[y]=S,this._apply(y))}_apply(y){if(!this._state[y]){this.style&&this.style.delete(y);return}if(!this.style.has(y)){if(!this.chunks_loaded)return this.loadFromContext().then(()=>this._apply(y));if(!(0,R.has)(this.chunks,y)){this.log.warn(`Unknown chunk name "${y}" for toggle()`);return}this.style.set(y,this.chunks[y])}}set(y,S){return this.style.set(y,S)}delete(y){return this.style.delete(y)}setVariable(y,S,n="body"){this.style.set(`var--${y}`,`${n} { --ffz-${y}: ${S}; }`)}deleteVariable(y){this.style.delete(`var--${y}`)}loadFromContext(){if(!this.chunks_loaded)return new Promise(async y=>{const S=(await d.e(2597).then(d.bind(d,96677))).default;for(const n of S.keys()){const s=n.slice(2,n.length-(n.endsWith(".scss")?5:4));this.chunks[s]=S(n).default}this.emit("site.layout:resize"),this.chunks_loaded=!0,y()})}};G(f,"CSSTweaks");let v=f},95778:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>I});var W=d(22527),B=d(46949),R=d(89196);const U=class U extends W.default{constructor(...v){super(...v),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site.channel"),this.SunlightBroadcast=this.fine.define("sunlight-bcast",f=>f.getGame&&f.getTitle&&f.props?.data,R.Z.SUNLIGHT_ROUTES),this.SunlightManager=this.fine.define("sunlight-manager",f=>f.props?.channelID&&f.props.channelLogin&&(0,B.has)(f.props,"hostedChannel"),R.Z.SUNLIGHT_ROUTES)}onEnable(){this.SunlightManager.on("mount",this.updateSunlight,this),this.SunlightManager.on("update",this.updateSunlight,this),this.SunlightManager.on("unmount",this.removeSunlight,this),this.SunlightManager.ready((v,f)=>{for(const u of f)this.updateSunlight(u)}),this.SunlightBroadcast.on("mount",this.updateBroadcast,this),this.SunlightBroadcast.on("update",this.updateBroadcast,this),this.SunlightBroadcast.on("unmount",this.removeBroadcast,this),this.SunlightBroadcast.ready((v,f)=>{for(const u of f)this.updateBroadcast(u)})}updateSunlight(v){this.settings.updateContext({channel:(0,B.get)("props.channelLogin",v),channelID:(0,B.get)("props.channelID",v)})}removeSunlight(){this.settings.updateContext({channel:null,channelID:null})}updateBroadcast(v){const f=v.props?.data?.user?.broadcastSettings,u=f?.game;this.settings.updateContext({category:u?.name,categoryID:u?.id,title:f?.title})}removeBroadcast(){this.settings.updateContext({category:null,categoryID:null,title:null})}};G(U,"Dashboard");let I=U},96432:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{CARD_CONTEXTS:()=>z,CONTENT_FLAGS:()=>v,default:()=>y});var W=d(22527),B=d(83269),R=d(44589),I=d(46949);const S=class S extends W.default{constructor(...i){super(...i),this.inject("site"),this.inject("site.fine"),this.inject("site.apollo"),this.inject("i18n"),this.inject("settings"),this.GameHeader=this.fine.define("game-header",l=>l.props&&l.props.data&&l.getBannerImage&&l.getDirectoryCountAndTags,["dir-game-index","dir-community","dir-game-videos","dir-game-clips","dir-game-details"]),this.settings.addUI("directory.game.blocked-games",{path:`Directory > Categories @{"description": "Please note that due to limitations in Twitch's website, names here must be formatted exactly as displayed in your client. For best results, you can block or unblock categories directly from directory pages."} >> Blocked`,component:"game-list-editor",default:[],onUIChange:()=>this.parent.updateCards()}),this.settings.addUI("directory.game.hidden-thumbnails",{path:"Directory > Categories >> Hidden Thumbnails",component:"game-list-editor",default:[],onUIChange:()=>this.parent.updateCards()})}onEnable(){this.GameHeader.on("mount",this.updateGameHeader,this),this.GameHeader.on("update",this.updateGameHeader,this),this.GameHeader.on("unmount",()=>{this.settings.updateContext({category:null,categoryID:null})}),this.settings.provider.on("changed",i=>{if(i==="directory.game.blocked-games"||i==="directory.game.hidden-thumbnails"){this.parent.updateCards();for(const l of this.GameHeader.instances)this.updateGameHeader(l)}}),this.GameHeader.ready((i,l)=>{for(const w of l)this.updateGameHeader(w)}),this.on("site.router:route",i=>{i&&i.name==="dir-game-index"&&this.updateGameHeader()})}updateGameHeader(i){if(i===void 0){for(const w of this.GameHeader.instances)this.updateGameHeader(w);return}this.updateButtons(i);const l=i?.props?.data?.game;this.settings.updateContext({category:l?.name,categoryID:l?.id})}updateButtons(i){const l=this.fine.getChildNode(i);if((0,I.get)("data.game",i.props)==null||!l||!l.querySelector)return;const w=l.querySelector(".ffz-directory-buttons");w&&w.remove();const _=l.querySelector(".directory-header-new__info > div > div + div");if(!_)return;let o,e,a,p;const C=(0,I.get)("data.game.name",i.props)||i.props.directoryName,m=G(()=>{const $=this.settings.provider.get("directory.game.blocked-games",[]),r=$.includes(C);o.classList.toggle("active",r),e.textContent=r?this.i18n.t("directory.unblock","Unblock"):this.i18n.t("directory.block","Block")},"update_block"),x=G(()=>{const $=this.settings.provider.get("directory.game.hidden-thumbnails",[]),r=$.includes(C);a.classList.toggle("active",r),p.textContent=r?this.i18n.t("directory.show-thumbnails","Show Thumbnails"):this.i18n.t("directory.hide-thumbnails","Hide Thumbnails")},"update_hidden");o=(0,R.createElement)("button",{class:"tw-mg-r-1 tw-button ffz-directory-toggle-block",onClick:this.generateClickHandler("directory.game.blocked-games",C,m)},e=(0,R.createElement)("span",{class:"tw-button__text"})),m(),a=(0,R.createElement)("button",{class:"tw-button ffz-directory-toggle-thumbnail",onClick:this.generateClickHandler("directory.game.hidden-thumbnails",C,x)},p=(0,R.createElement)("span",{class:"tw-button__text"})),x(),_.appendChild((0,R.createElement)("div",{class:"tw-mg-t-1 ffz-directory-buttons"},o,a))}generateClickHandler(i,l,w){return _=>{_.preventDefault();const o=this.settings.provider.get(i)||[],e=o.indexOf(l);e===-1?o.push(l):o.splice(e,1),this.settings.provider.set(i,o),this.parent.updateCards(),w()}}};G(S,"Game");let U=S;const z=((s={})=>(s[s.SingleGameList=1]="SingleGameList",s[s.SingleChannelList=2]="SingleChannelList",s[s.MixedGameAndChannelList=3]="MixedGameAndChannelList",s))(),v=["DrugsIntoxication","Gambling","MatureGame","ProfanityVulgarity","SexualThemes","ViolentGraphic"];function f(s,i){return s[0].length&&s[1].push((0,I.addWordSeparators)(s[0].join("|"))),s[1].length?new RegExp(s[1].join("|"),i):null}G(f,"formatTerms");const u=["front-page","dir","dir-community","dir-community-index","dir-creative","dir-following","dir-game-index","dir-game-clips","dir-game-videos","dir-all","dir-category","user-videos","user-clips"],n=class n extends W.default{constructor(...i){super(...i),this.should_enable=!0,this.inject("site"),this.inject("site.elemental"),this.inject("site.fine"),this.inject("site.router"),this.inject("site.css_tweaks"),this.inject("site.twitch_data"),this.inject("i18n"),this.inject("settings"),this.inject(U),this.DirectoryCard=this.elemental.define("directory-card",'article[data-a-target^="video-carousel-card-"],article[data-a-target^="followed-vod-"],article[data-a-target^="card-"],div[data-a-target^="video-tower-card-"] article,div[data-a-target^="clips-card-"] article,.shelf-card__impression-wrapper article,.tw-tower div article',u,null,0,0),this.DirectoryExperimentCard=this.elemental.define("directory-experiment-card",".switcher-hopper__scroll-container .tw-tower > div > a",u,null,0,0),this.DirectoryGameCard=this.elemental.define("directory-game-card",".game-card[data-a-id]",u,null,0,0),this.DirectoryShelf=this.fine.define("directory-shelf",l=>l.shouldRenderNode&&l.props&&l.props.shelf,u),this.DirectorySorter=this.fine.define("directory-sorter",l=>l.getSortOptionLink&&l.getSortOptionText&&l.getSortOptionOnClick&&l.getFilterIDs,u),this.settings.add("directory.hidden.style",{default:2,ui:{path:'Directory > Categories >> Hidden Thumbnail Style @{"sort": 100}',title:"Hidden Style",component:"setting-select-box",sort:100,data:[{value:0,title:"Replace Image"},{value:1,title:"Replace Image and Blur Title"},{value:2,title:"Blur Image"},{value:3,title:"Blur Image and Title"}]},changed:l=>{this.css_tweaks.toggle("dir-no-blur",l<2),this.css_tweaks.toggle("dir-blur-title",l===1||l===3)}}),this.settings.add("directory.hide-costream-border",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Hide border on streams with guest stars.",component:"setting-check-box",getExtraTerms:()=>["costream","co-stream"]}}),this.settings.add("directory.hidden.reveal",{default:!1,ui:{path:"Directory > Categories >> Hidden Thumbnail Style",title:"Reveal hidden entries on mouse hover.",component:"setting-check-box",sort:101},changed:l=>this.css_tweaks.toggle("dir-reveal",l)}),this.settings.add("directory.uptime",{default:1,ui:{path:"Directory > Channels >> Appearance",title:"Stream Uptime",description:"Display the stream uptime on the channel cards.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enabled (with Seconds)"}]},changed:()=>this.updateCards()}),this.settings.add("directory.show-flags",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Display Content Flags on channel cards.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.hide-live",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show the Live indicator on channels that are live.",component:"setting-check-box"},changed:l=>this.css_tweaks.toggleHide("dir-live-ind",l)}),this.settings.add("directory.hide-promoted",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show Promoted streams in the directory.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.hide-vodcasts",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show reruns in the directory.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.hide-recommended",{default:!1,ui:{path:"Directory > Following >> Categories",title:"Do not show `Recommended Live Channels` in the Following Directory.",component:"setting-check-box"},changed:()=>this.DirectoryShelf.forceUpdate()}),this.settings.add("directory.block-users",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Block by Username",component:"basic-terms",words:!1}}),this.settings.add("__filter:directory.block-users",{requires:["directory.block-users"],equals:"requirements",process(l){const w=l.get("directory.block-users");if(!w||!w.length)return null;const _=[[],[]];for(const o of w){const e=o.t;let a=o.v;e==="glob"?a=(0,I.glob_to_regex)(a):e!=="raw"&&(a=(0,I.escape_regex)(a)),!(!a||!a.length)&&_[o.s?0:1].push(a)}return[_[0].length?new RegExp(`^(?:${_[0].join("|")})$`):null,_[1].length?new RegExp(`^(?:${_[1].join("|")})$`,"i"):null]},changed:()=>this.updateCards()}),this.settings.add("directory.block-titles",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Block by Title",component:"basic-terms"}}),this.settings.add("__filter:directory.block-titles",{requires:["directory.block-titles"],equals:"requirements",process(l){const w=l.get("directory.block-titles");if(!w||!w.length)return null;const _=[[[],[]],[[],[]]];for(const o of w){const e=o.t;let a=o.v;e==="glob"?a=(0,I.glob_to_regex)(a):e!=="raw"&&(a=(0,I.escape_regex)(a)),!(!a||!a.length)&&_[o.s?0:1][o.w?0:1].push(a)}return[f(_[0],"g"),f(_[1],"gi")]},changed:()=>this.updateCards()}),this.settings.add("directory.blocked-tags",{default:[],type:"basic_array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Block by Tag",component:"tag-list-editor"},changed:()=>this.updateCards()}),this.settings.add("directory.blur-titles",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Hide Thumbnails by Title",component:"basic-terms"}}),this.settings.add("__filter:directory.blur-titles",{requires:["directory.blur-titles"],equals:"requirements",process(l){const w=l.get("directory.blur-titles");if(!w||!w.length)return null;const _=[[[],[]],[[],[]]];for(const o of w){const e=o.t;let a=o.v;e==="glob"?a=(0,I.glob_to_regex)(a):e!=="raw"&&(a=(0,I.escape_regex)(a)),!(!a||!a.length)&&_[o.s?0:1][o.w?0:1].push(a)}return[f(_[0],"g"),f(_[1],"gi")]},changed:()=>this.updateCards()}),this.settings.add("directory.blur-tags",{default:[],type:"basic_array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Hide Thumbnails by Tag",component:"tag-list-editor"},changed:()=>this.updateCards()}),this.settings.add("directory.wait-flags",{default:!0,ui:{path:"Directory > Channels >> Appearance",title:"Hide Thumbnails for all channels until Content Flags have been loaded.",description:"We need to load content flags with a separate query, so they aren't immediately available to determine if a given stream should be hidden, or have its thumbnail blurred. This setting will blur ALL thumbnails until after we've finished loading the necessary content flag information, ensuring you don't see a flash of anything you would rather not.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.block-flags",{default:[],type:"array_merge",always_inherit:!0,process(l,w){const _=new Set;for(const o of w){let e=o?.v;e==="ViolentGrpahic"&&(e="ViolentGraphic"),e&&_.add(e)}return _},ui:{path:"Directory > Channels >> Block by Flag",component:"blocked-types",data:()=>[...v].sort()},changed:()=>this.updateCards()}),this.settings.add("directory.blur-flags",{default:[],type:"array_merge",always_inherit:!0,process(l,w){const _=new Set;for(const o of w)o?.v&&_.add(o.v);return _},ui:{path:"Directory > Channels >> Hide Thumbnails by Flag",component:"blocked-types",data:()=>[...v].sort()},changed:()=>this.updateCards()}),this.settings.add("directory.default-sort",{default:!1,ui:{path:"Directory > General >> General",title:"Force Default Sorting",component:"setting-select-box",data:[{value:!1,title:"Disabled"},{value:"RELEVANCE",title:"Recommended For You"},{value:"VIEWER_COUNT",title:"Viewers (High to Low)"},{value:"VIEWER_COUNT_ASC",title:"Viewers (Low to High)"},{value:"RECENT",title:"Recently Started"}]},changed:()=>this.updateSorting()}),this.routeClick=this.routeClick.bind(this)}onEnable(){this.css_tweaks.toggleHide("profile-hover",this.settings.get("directory.show-channel-avatars")===2),this.css_tweaks.toggleHide("dir-live-ind",this.settings.get("directory.hide-live")),this.css_tweaks.toggle("dir-reveal",this.settings.get("directory.hidden.reveal")),this.settings.getChanges("directory.hide-costream-border",w=>this.css_tweaks.toggle("hide-costream-border",w));const i=this.settings.get("directory.hidden.style");this.css_tweaks.toggle("dir-no-blur",i<2),this.css_tweaks.toggle("dir-blur-title",i===1||i===3),this.on("i18n:update",()=>this.updateCards()),this.DirectoryExperimentCard.on("mount",this.updateExpCard,this),this.DirectoryExperimentCard.on("mutate",this.updateExpCard,this),this.DirectoryExperimentCard.on("unmount",this.clearExpCard,this),this.DirectoryExperimentCard.each(w=>this.updateExpCard(w)),this.DirectoryCard.on("mount",this.updateCard,this),this.DirectoryCard.on("mutate",this.updateCard,this),this.DirectoryCard.on("unmount",this.clearCard,this),this.DirectoryCard.each(w=>this.updateCard(w)),this.DirectoryGameCard.on("mount",this.updateGameCard,this),this.DirectoryGameCard.on("mutate",this.updateGameCard,this),this.DirectoryGameCard.each(w=>this.updateGameCard(w)),this.DirectorySorter.on("mount",this.updateSorting,this),this.DirectorySorter.ready(()=>this.updateSorting());const l=this;this.DirectoryShelf.ready(w=>{const _=w.prototype.shouldRenderNode;w.prototype.shouldRenderNode=function(e,...a){try{let p;if(e.__typename==="Game"?p=e.name:e.game&&(p=e.game.name),p&&l.settings.provider.get("directory.game.blocked-games",[]).includes(p))return!1}catch(p){l.log.capture(p),l.log.error(p)}return _.call(this,e,...a)};const o=w.prototype.render;w.prototype.render=function(){try{if(l.settings.get("directory.hide-recommended")&&(0,I.get)("props.shelf.title.key",this)==="live_recs_following")return null}catch(e){l.log.capture(e)}return o.call(this)},this.DirectoryShelf.forceUpdate()})}updateSorting(i){if(!i){for(const _ of this.DirectorySorter.instances)this.updateSorting(_);return}const l=this.settings.get("directory.default-sort");if(!l||l===i.state?.activeOption)return;const w=i.getSortOptionLink(l,!1,i.props);w?.props?.linkTo&&(w.props.onClick&&w.props.onClick(),this.router.history.push(w.props.linkTo))}updateGameCard(i){const l=this.fine.getReactInstance(i);if(!l)return;const w=l.return?.memoizedProps;if(!w?.trackingProps?.category)return;const _=w.trackingProps.category,o=w.tagListProps?.tags;let e=!1;if(Array.isArray(o)){const C=this.settings.get("directory.blocked-tags",[]);if(C.length){for(const m of o)if(m?.id&&C.includes(m.id)){e=!0;break}}}const a=e||this.settings.provider.get("directory.game.blocked-games",[]).includes(_);let p=i.closest(".tw-tower > div");p||(p=i),p.querySelectorAll('a[data-a-target="tw-box-art-card-link"]').length<2&&p.classList.toggle("tw-hide",a)}updateCards(){this.DirectoryCard.each(i=>this.updateCard(i)),this.DirectoryExperimentCard.each(i=>this.updateExpCard(i)),this.DirectoryGameCard.each(i=>this.updateGameCard(i)),this.DirectoryShelf.forceUpdate(),this.emit(":update-cards")}clearCard(i,l=!1){this.clearUptime(i),this.clearFlags(i);const w=this._getTopRightContainer(i,l);w&&w.remove(),i._ffz_top_right=null}clearExpCard(i){return this.clearCard(i,!0)}updateCard(i){const l=this.fine.searchParentNode(i,_=>_.memoizedProps?.channelLogin);if(!l)return;const w=l.memoizedProps;return this._updateCard(i,!1,w,w.trackingProps)}updateExpCard(i){const l=this.fine.searchParentNode(i,o=>o.memoizedProps?.item?.channelID);if(!l)return;const w=l.memoizedProps,_=w.item;return this._updateCard(i,!0,_,w.tracking)}_updateCard(i,l,w,_){const o=w.categoryName||w.gameTitle||_?.game||_?.categoryName||_?.category,e=w.tags??w.tagListProps?.freeformTags,a=this.settings.get("directory.wait-flags"),p=this.settings.get("directory.show-flags"),C=this.settings.get("directory.blur-flags",[]),m=this.settings.get("directory.block-flags",[]),x=C.size>0||m.size>0,$=p||x;i._ffz_flags===void 0&&$&&(i._ffz_flags=null,w.slug||w.type==="clips"?i._ffz_flags=[]:w.vodID||w.type==="videos"?i._ffz_flags=[]:this.twitch_data.getStreamFlags(w.channelID,w.channelID?null:w.channelLogin).then(L=>{i._ffz_flags=L??[],l?this.updateExpCard(i):this.updateCard(i)}));let r=!1,c=!1;if(Array.isArray(e)){const L=this.settings.get("directory.blocked-tags",[]),T=this.settings.get("directory.blur-tags",[]);if(L.length||T.length)for(const O of e){if(O?.name){const P=O.name.toLowerCase();L.includes(P)&&(r=!0),T.includes(P)&&(c=!0)}if((r||!L.length)&&(c||!T.length))break}}let b=c;if(a&&x&&i._ffz_flags==null&&(b=!0),b||(b=this.settings.provider.get("directory.game.hidden-thumbnails",[]).includes(o)),!b&&C.size&&i._ffz_flags){for(const L of i._ffz_flags)if(L?.id&&C.has(L.id)){b=!0;break}}if(!b){const L=this.settings.get("__filter:directory.blur-titles");L&&(L[0]&&(L[0].lastIndex=-1),L[1]&&(L[1].lastIndex=-1),(L[0]&&L[0].test(w.title)||L[1]&&L[1].test(w.title))&&(b=!0))}const k=w.type??w.streamType;i.classList.toggle("ffz-hide-thumbnail",b),i.dataset.ffzType=k;let h=!1;if(r)h=!0;else if(k==="rerun"&&this.settings.get("directory.hide-vodcasts"))h=!0;else if(w.context!=null&&w.context!==z.SingleGameList&&this.settings.provider.get("directory.game.blocked-games",[]).includes(o))h=!0;else if((w.isPromotion||w.sourceType==="COMMUNITY_BOOST"||w.sourceType==="PROMOTION"||w.sourceType==="SPONSORED")&&this.settings.get("directory.hide-promoted"))h=!0;else{if(m.size&&i._ffz_flags){for(const L of i._ffz_flags)if(L?.id&&m.has(L.id)){h=!0;break}}if(!h){const L=this.settings.get("__filter:directory.block-users");L&&(L[0]&&(L[0].lastIndex=-1),L[1]&&(L[1].lastIndex=-1),(L[0]&&L[0].test(w.channelLogin)||L[1]&&L[1].test(w.channelLogin))&&(h=!0))}if(!h){const L=this.settings.get("__filter:directory.block-titles");L&&(L[0]&&(L[0].lastIndex=-1),L[1]&&(L[1].lastIndex=-1),(L[0]&&L[0].test(w.title)||L[1]&&L[1].test(w.title))&&(h=!0))}}let M=i.closest(".tw-tower > div");M||(M=i),M.querySelectorAll(".tw-aspect .tw-image:not(.tw-image-avatar)").length<2&&M.classList.toggle("tw-hide",h),this.updateUptime(i,w,l),this.updateFlags(i,l)}updateFlags(i,l=!1){if(!document.contains(i))return this.clearFlags(i);if(!this.settings.get("directory.show-flags")||!i._ffz_flags?.length)return this.clearFlags(i);const _=this._getTopRightContainer(i,!0,l);if(!_)return this.clearFlags(i);i.ffz_flags_el?i.contains(i.ffz_flags_el)||_.appendChild(i.ffz_flags_el):_.appendChild(i.ffz_flags_el=(0,R.createElement)("div",{class:"tw-mg-y-05 ffz-flags-element tw-relative ffz-il-tooltip__container"},(0,R.createElement)("div",{class:"tw-border-radius-small tw-c-background-overlay tw-c-text-overlay tw-flex tw-pd-x-05"},(0,R.createElement)("figure",{class:"ffz-i-flag"})),i.ffz_flags_tt=(0,R.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--pre ffz-il-tooltip--down ffz-il-tooltip--align-right"}))),i.ffz_flags_tt.textContent=this.i18n.t("metadata.flags.tooltip","Intended for certain audiences. May contain:")+`

`+i._ffz_flags.map(o=>o.localizedName).join(`
`)}clearFlags(i){i.ffz_flags_el&&(i.ffz_flags_el.remove(),i.ffz_flags_tt=null,i.ffz_flags_el=null)}_getTopRightContainer(i,l=!0,w=!1){let _=i._ffz_top_right??i.querySelector(".ffz-top-right");if(_||!l)return _;let o=w?i.querySelector(".tw-aspect .tw-image"):i.querySelector('a[data-a-target="preview-card-image-link"] > div');return o&&w&&(o=o.parentElement?.parentElement),o?(_=(0,R.createElement)("div",{"data-test-selector":"top-right-selector",class:"tw-absolute tw-mg-1 tw-right-0 tw-top-0 ffz-top-right tw-flex tw-flex-column tw-align-items-end"}),i._ffz_top_right=_,o.appendChild(_),_):null}updateUptime(i,l,w=!1){if(!document.contains(i))return this.clearUptime(i);const _=this.settings.get("directory.uptime"),o=this._getTopRightContainer(i,_>0,w);if(!o||_===0||l.viewCount||l.animatedImageProps||l.type==="videos"||l.type==="clips")return this.clearUptime(i);let e=l.createdAt;e||(i.ffz_stream_meta===void 0&&(i.ffz_stream_meta=null,this.twitch_data.getStreamMeta(null,l.channelLogin).then(m=>{i.ffz_stream_meta=m,this.updateUptime(i,l,w)})),e=i.ffz_stream_meta?.createdAt);const a=e&&new Date(e),p=a&&Math.floor((Date.now()-a)/1e3)||0;if(p<1)return this.clearUptime(i);const C=(0,B.duration_to_string)(p,!1,!1,!1,_===1);if(i.ffz_uptime_el||(i.ffz_uptime_el=o.querySelector(".ffz-uptime-element")),i.ffz_uptime_el?i.contains(i.ffz_uptime_el)||o.appendChild(i.ffz_uptime_el):o.appendChild(i.ffz_uptime_el=(0,R.createElement)("div",{class:"ffz-uptime-element tw-relative ffz-il-tooltip__container"},(0,R.createElement)("div",{class:"tw-border-radius-small tw-c-background-overlay tw-c-text-overlay tw-flex tw-pd-x-05"},(0,R.createElement)("div",{class:"tw-flex tw-c-text-live"},(0,R.createElement)("figure",{class:"ffz-i-clock"})),i.ffz_uptime_span=(0,R.createElement)("p",null)),(0,R.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-right"},this.i18n.t("metadata.uptime.tooltip","Stream Uptime"),i.ffz_uptime_tt=(0,R.createElement)("div",{class:"tw-pd-t-05"})))),i.ffz_uptime_span||(i.ffz_uptime_span=i.ffz_uptime_el.querySelector("p")),!i.ffz_uptime_span)return this.clearUptime(i);if(i.ffz_uptime_tt||(i.ffz_uptime_tt=i.ffz_uptime_el.querySelector(".ffz-il-tooltip > div")),!i.ffz_uptime_tt)return this.clearUptime(i);i.ffz_update_timer||(i.ffz_update_timer=setInterval(this.updateUptime.bind(this,i,l,w),1e3)),i.ffz_uptime_span.textContent=C,i.ffz_last_created_at!==e&&(i.ffz_uptime_tt.textContent=this.i18n.t("metadata.uptime.since","(since {since,datetime})",{since:a}),i.ffz_last_created_at=e)}clearUptime(i){i.ffz_update_timer&&(clearInterval(i.ffz_update_timer),i.ffz_update_timer=null),i.ffz_uptime_el&&(i.ffz_uptime_el.remove(),i.ffz_uptime_el=null,i.ffz_uptime_span=null,i.ffz_uptime_tt=null,i.ffz_last_created_at=null)}routeClick(i,l){if(i.preventDefault(),i.stopPropagation(),!l){const w=i.currentTarget;if(w){const _=w.dataset;_&&_.href?l=_.href:w.href&&(l=w.href)}}l&&this.router.history.push(l)}hijackUserClick(i,l,w=null){i.preventDefault(),i.stopPropagation(),w&&w(i,l),this.router.navigate("user",{userName:l})}};G(n,"Directory");let y=n},68318:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>z});var W=d(24431),B=d(22527),R=d(46949);const I=["user","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following"],U=["popout","embed-chat","dash-chat"],v=class v extends B.default{constructor(...u){super(...u),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject("site.elemental"),this.ResizeDetector=this.fine.define("resize-detector",y=>y.maybeDebounceOnScroll&&y.setGrowDivRef&&y.props.onResize),this.SideBar=this.elemental.define("sidebar",".side-bar-contents",null,{childNodes:!0,subtree:!0},1),this.settings.add("clips.layout.big",{default:!1,ui:{path:"Appearance > Layout >> Clips",title:"Allow the player to get larger on `clips.twitch.tv` pages.",description:"This only affects windows at least 1,200 pixels wide and attempts to make the player and chat replay as large as possible.",component:"setting-check-box"}}),this.settings.add("layout.portrait",{default:!1,ui:{path:"Appearance > Layout >> Channel",title:"Enable Portrait Mode",description:"In Portrait Mode, chat will be displayed beneath the player when the window is taller than it is wide.",component:"setting-check-box"}}),this.settings.add("layout.portrait-invert",{default:!1,ui:{path:"Appearance > Layout >> Channel",title:"When in portrait mode, place chat at the top.",component:"setting-check-box"},changed:y=>document.body.classList.toggle("ffz--portrait-invert",y)}),this.settings.add("layout.portrait-threshold",{default:1.25,ui:{path:"Appearance > Layout >> Channel",title:"Portrait Mode Threshold",description:"This is the Width to Height ratio at which point Portrait Mode will begin to activate.",component:"setting-text-box",process(y){return y=parseFloat(y,10),isNaN(y)||!isFinite(y)||y<=0?1.25:y}}}),this.settings.add("layout.portrait-min-chat",{default:!1,requires:["layout.use-portrait"],process(y,S){return y.get("layout.use-portrait")?S:!1},ui:{path:"Appearance > Layout >> Channel",title:"Use compact chat in Portrait Mode.",description:"When enabled, this minimizes the chat header and places the chat input box in line with the chat buttons in order to present a more compact chat able to display more lines with limited vertical space.",component:"setting-check-box"}}),this.settings.add("layout.use-portrait",{requires:["layout.portrait","layout.portrait-threshold","context.route.name","context.size","context.isWatchParty"],process(y){if(y.get("context.isWatchParty"))return!1;const S=y.get("context.size");return!S||!y.get("layout.portrait")||!I.includes(y.get("context.route.name"))?!1:S.width/S.height<=y.get("layout.portrait-threshold")},changed:()=>this.updatePortraitMode()}),this.settings.add("layout.inject-portrait",{requires:["layout.use-portrait","context.ui.rightColumnExpanded"],process(y){return y.get("layout.use-portrait")&&y.get("context.ui.rightColumnExpanded")}}),this.settings.add("layout.use-portrait-swapped",{requires:["layout.inject-portrait","layout.swap-sidebars"],process(y){return y.get("layout.inject-portrait")&&y.get("layout.swap-sidebars")}}),this.settings.add("layout.use-portrait-meta",{requires:["layout.inject-portrait","player.theatre.metadata"],process(y){return y.get("layout.inject-portrait")&&y.get("player.theatre.metadata")}}),this.settings.add("layout.use-portrait-meta-top",{requires:["layout.use-portrait-meta","layout.portrait-invert"],process(y){return y.get("layout.use-portrait-meta")&&!y.get("layout.portrait-invert")}}),this.settings.add("layout.is-theater-mode",{requires:["context.ui.theatreModeEnabled","context.fullscreen"],process(y){return y.get("context.fullscreen")?!1:y.get("context.ui.theatreModeEnabled")}}),this.settings.add("layout.show-portrait-chat",{requires:["layout.use-portrait","layout.portrait-extra-height","layout.portrait-extra-width"],process(){return!0},changed:()=>this.updatePortraitMode()}),this.settings.add("layout.portrait-extra-height",{requires:["context.new_channel","context.squad_bar","layout.is-theater-mode","player.theatre.no-whispers","whispers.show","layout.minimal-navigation"],process(y){let S=0;return y.get("layout.is-theater-mode")?(y.get("layout.minimal-navigation")&&(S+=1),y.get("whispers.show")&&!y.get("player.theatre.no-whispers")&&(S+=4)):(S=y.get("layout.minimal-navigation")?1:5,y.get("whispers.show")&&(S+=4),y.get("context.squad_bar")&&(S+=6),S+=y.get("context.new_channel")?1:5),S}}),this.settings.add("layout.portrait-extra-width",{require:["layout.side-nav.show","layout.is-theater-mode","context.ui.sideNavExpanded"],process(y){return!y.get("layout.side-nav.show")||y.get("layout.is-theater-mode")?0:y.get("context.ui.sideNavExpanded")?24:5}}),this.settings.add("layout.is-minimal",{require:["context.route.name"],process(y){return U.includes(y.get("context.route.name"))}})}onEnable(){document.body.classList.toggle("ffz--portrait-invert",this.settings.get("layout.portrait-invert")),this.on(":update-nav",this.updateNavLinks,this),this.on(":resize",this.handleResize,this),this.settings.getChanges("layout.portrait-min-chat",u=>this.css_tweaks.toggle("portrait-chat",u)),this.settings.getChanges("layout.inject-portrait",u=>this.css_tweaks.toggle("portrait",u)),this.settings.getChanges("layout.use-portrait-swapped",u=>this.css_tweaks.toggle("portrait-swapped",u)),this.settings.getChanges("layout.use-portrait-meta",u=>this.css_tweaks.toggle("portrait-metadata",u)),this.settings.getChanges("layout.use-portrait-meta-top",u=>this.css_tweaks.toggle("portrait-metadata-top",u)),this.settings.getChanges("layout.portrait-extra-width",u=>this.css_tweaks.setVariable("portrait-extra-width",`${u}rem`)),this.settings.getChanges("layout.portrait-extra-height",u=>this.css_tweaks.setVariable("portrait-extra-height",`${u}rem`)),this.on("site.directory:update-cards",()=>{this.SideBar.each(u=>this._updateSidebar(u))}),this.ResizeDetector.ready(()=>{this._needs_resize&&(this._needs_resize=!1,this.handleResize())}),this.SideBar.on("mount",this.updateSidebar,this),this.SideBar.on("mutate",this.updateSidebar,this),this.SideBar.each(u=>this.updateSidebar(u))}handleResize(){this._resize_timer||(this._resize_timer=setTimeout(()=>this._handleResize(),W.IS_FIREFOX?500:100))}_handleResize(){if(clearTimeout(this._resize_timer),this._resize_timer=null,!this.ResizeDetector.instances.size)this._needs_resize=!0;else{for(const u of this.ResizeDetector.instances)u?.onScroll?.();this.emit("site.player:fix-player")}}get is_minimal(){return this.settings.get("layout.is-minimal")}updateSidebar(u){u&&(u._ffz_update||(u._ffz_update=(0,R.debounce)(()=>requestAnimationFrame(()=>this._updateSidebar(u)),1e3,2)),u._ffz_update())}_updateSidebar(u){if(!u)return;const y=u.querySelectorAll(".side-nav-card"),S=this.settings.provider.get("directory.game.blocked-games",[]);for(const n of y){const s=this.fine.getReactInstance(n),i=s?.return?.return?.memoizedProps,l=i?.metadataRight?.props?.stream,w=l?.type==="rerun",_=l?.game?.displayName,o=i?.offline??!1;let e=!1;if(_&&S.includes(_)&&(e=!0),i?.isPromoted&&this.settings.get("directory.hide-promoted"))e=!0;else{if(!e){const a=this.settings.get("__filter:directory.block-users"),p=i?.userLogin;a&&p&&(a[0]&&(a[0].lastIndex=-1),a[1]&&(a[1].lastIndex=-1),(a[0]&&a[0].test(p)||a[1]&&a[1].test(p))&&(e=!0))}if(!e){const a=this.settings.get("__filter:directory.block-titles"),p=l?.broadcaster?.broadcastSettings?.title;a&&p&&(a[0]&&(a[0].lastIndex=-1),a[1]&&(a[1].lastIndex=-1),(a[0]&&a[0].test(p)||a[1]&&a[1].test(p))&&(e=!0))}}n.classList.toggle("ffz--side-nav-card-rerun",w),n.classList.toggle("ffz--side-nav-card-offline",o),n.classList.toggle("tw-hide",e)}}updateNavLinks(){}updatePortraitMode(){}};G(v,"Layout");let z=v},29333:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>z});var W=d(24431),B=d(22527),R=d(44589),I=d(89196),U=d(6170);const v=class v extends B.default{constructor(...u){super(...u),this.inject("i18n"),this.inject("settings"),this.inject("site"),this.inject("site.fine"),this.inject("site.elemental"),this.pauseToasts=this.pauseToasts.bind(this),this.unpauseToasts=this.unpauseToasts.bind(this),this.should_enable=!0,this._pill_content=null,this._has_update=!1,this._important_update=!1,this._new_settings=0,this._loading=!1,this.toasts=[],this.settings.add("ffz.show-new-settings",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Display an indicator on the FFZ Control Center button whenever there are new settings added to FrankerFaceZ.",component:"setting-check-box"},changed:()=>this.update()}),this.ModBar=this.fine.define("mod-view-bar",y=>y.actions&&y.updateRoot&&y.childContext,["mod-view"]),this.SunlightNav=this.elemental.define("sunlight-nav",".sunlight-top-nav > div > div > div > div:last-child > div",I.Z.SUNLIGHT_ROUTES,{attributes:!0},1),this.NavBar=this.fine.define("nav-bar",y=>y.renderOnsiteNotifications&&y.renderTwitchPrimeCrown),this.SquadBar=this.fine.define("squad-nav-bar",y=>y.exitSquadMode&&y.props&&y.props.squadID,["squad"]),this.MultiController=this.fine.define("multi-controller",y=>y.handleAddStream&&y.handleRemoveStream&&y.getInitialStreamLayout,["command-center"])}get loading(){return this._loading}set loading(u){u!==this._loading&&(this._loading=u,this.update())}get new_settings(){return this._new_settings}set new_settings(u){u!==this._new_settings&&(this._new_settings=u,this.update())}get has_new(){return this.settings.get("ffz.show-new-settings")&&this._new_settings>0}get important_update(){return this._important_update}set important_update(u){this._important_update=!1,this.update()}get has_update(){return this._has_update}get has_strings(){return this.i18n.new_strings>0||this.i18n.changed_strings>0}set has_update(u){u&&!this._has_update&&(this._important_update=!0),this._has_update=u,this.update()}get pill(){return this._pill_content}set pill(u){this._pill_content=u,this.update()}formatPill(){const u=this._pill_content;return typeof u=="number"?this.i18n.formatNumber(u):u==null&&this.has_new?this.i18n.formatNumber(this._new_settings):u}formatExtraPill(){if(this.has_update)return null;if(this.settings.disable_profiles)return(0,R.createElement)("figure",{class:"ffz-i-cog"});if(this.has_strings)return this.i18n.formatNumber(this.i18n.new_strings+this.i18n.changed_strings);const u=this.resolve("addons");return W.DEBUG&&u.has_dev?this.i18n.t("site.menu_button.dev","dev"):W.DEBUG&&!u.has_dev?this.i18n.t("site.menu_button.main-dev","m-dev"):!W.DEBUG&&u.has_dev?this.i18n.t("site.menu_button.addon-dev","a-dev"):null}updateToasts(){requestAnimationFrame(()=>this._updateToasts())}_updateToasts(){for(const u of this.NavBar.instances)this.updateButtonToast(u);for(const u of this.SquadBar.instances)this.updateButtonToast(u);for(const u of this.MultiController.instances)this.updateButtonToast(u);for(const u of this.SunlightNav.instances)this.updateButtonToast(null,u,!0);for(const u of this.ModBar.instances)this.updateButtonToast(u)}update(){requestAnimationFrame(()=>this._update())}_update(){for(const u of this.NavBar.instances)this.updateButton(u);for(const u of this.SquadBar.instances)this.updateButton(u);for(const u of this.MultiController.instances)this.updateButton(u);for(const u of this.SunlightNav.instances)this.updateButton(null,u,!0);for(const u of this.ModBar.instances)this.updateButton(u)}onEnable(){this.NavBar.ready(()=>this.update()),this.NavBar.on("mount",this.updateButton,this),this.NavBar.on("update",this.updateButton,this),this.SquadBar.ready(()=>this.update()),this.SquadBar.on("mount",this.updateButton,this),this.SquadBar.on("update",this.updateButton,this),this.MultiController.ready(()=>this.update()),this.MultiController.on("mount",this.updateButton,this),this.MultiController.on("update",this.updateButton,this),this.SunlightNav.on("mount",u=>this.updateButton(null,u,!0)),this.SunlightNav.on("mutate",u=>this.updateButton(null,u,!0)),this.SunlightNav.each(u=>this.updateButton(null,u,!0)),this.ModBar.ready(()=>this.update()),this.ModBar.on("mount",this.updateButton,this),this.ModBar.on("update",this.updateButton,this),this.on(":clicked",()=>this.important_update=!1),this.once(":clicked",this.loadMenu),this.on("i18n:new-strings",this.update),this.on("i18n:changed-strings",this.update),this.on("i18n:update",this.update),this.on("addons:data-loaded",this.update),this.once("settings:quota-exceeded",()=>{this.addError("site.menu_button.quota-exceeded","Your local storage space for this website is full, and settings cannot be saved. Please backup your settings and switch to a higher capacity provider in [Data Management > Storage >> Provider](~data_management.storage.tabs.provider).","ffz-i-attention",!0),this.update()}),this.on("settings:change-provider",()=>{this.addError("site.menu_button.changed","The FrankerFaceZ settings provider has changed. Please refresh this tab to avoid strange behavior."),this.update()})}addError(u,y,S="ffz-i-attention",n=!1){this.addToast({icon:S,text_i18n:u,text:y,markdown:n})}addToast(u){if(u.markdown&&!(0,U.e)())return(0,U.Z)().then(()=>this.addToast(u));this.toasts.push(u),!(this.toasts.length>5)&&this.updateToasts()}pauseToasts(){const u=Math.min(5,this.toasts.length),y=performance.now();this._toasts_paused=!0;for(let S=0;S<u;S++){const n=this.toasts[S];if(!n||!n.started)continue;n._timer&&(clearTimeout(n._timer),n._timer=null);const s=y-n.started,i=n.timeout-s;n.remaining=i,n.percentage=100*i/n.timeout,n.el&&n.el.replaceWith(this.renderToast(n))}}unpauseToasts(){const u=Math.min(5,this.toasts.length),y=performance.now();this._toasts_paused=!1;for(let S=0;S<u;S++){const n=this.toasts[S];if(!(!n||!n.started)){if(n.remaining){const s=n.timeout-n.remaining;n.started=y-s}n.el&&n.el.replaceWith(this.renderToast(n))}}}renderToasts(){const u=Math.min(5,this.toasts.length);if(!u)return null;const y=[];for(let S=0;S<u;S++)y.push(this.renderToast(this.toasts[S]));return y}renderToast(u){u._remove||(u._remove=()=>{u._timer&&(clearTimeout(u._timer),u._timer=null),u.el=null;const n=this.toasts.indexOf(u);n!==-1&&(this.toasts.splice(n,1),this.toasts.length||(this._toasts_paused=!1),this.updateToasts())});let y=null;const S=u.markdown?(0,U.e)():null;if(u.markdown&&!S)return null;if(u.timeout){const n=performance.now();u.started||(u.started=n);const s=n-u.started,i=u.timeout-s;let l;this._toasts_paused?l=u.percentage:u._timer||(u._timer=setTimeout(u._remove,i)),l==null&&(l=u.percentage=100*i/u.timeout),y=(0,R.createElement)("div",{class:"ffz-toast--progress tw-absolute tw-overflow-hidden tw-z-below"},(0,R.createElement)("div",{class:"tw-border-radius-rounded ffz-progress-bar ffz-progress-bar--countdown ffz-progress-bar--default ffz-progress-bar--mask",role:"progressbar","aria-valuenow":l,"aria-valuemin":"0","aria-valuemax":"100"},(0,R.createElement)("div",{class:"tw-block tw-border-bottom-left-radius-rounded tw-border-top-left-radius-rounded ffz-progress-bar__fill","data-a-target":"tw-progress-bar-animation",style:{width:`${l}%`,"animation-duration":`${i/1e3}s`}})))}return u.el=(0,R.createElement)("div",{class:`ffz-toast ffz-balloon ffz-balloon--lg tw-mg-y-1${this._toasts_paused?" ffz-toast--paused":""}`},(0,R.createElement)("div",{class:"tw-pd-1 tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4 tw-relative"},(0,R.createElement)("div",{class:"tw-flex tw-align-items-start"},u.icon&&(typeof u.icon=="string"?(0,R.createElement)("figure",{class:`tw-font-size-3 tw-pd-r-1 ${u.icon}`}):u.icon),u.render?u.render.call(this,u):null,u.title||u.text?(0,R.createElement)("div",{class:"tw-flex-grow-1"},u.title?(0,R.createElement)("header",{class:"tw-semibold tw-font-size-3 tw-pd-b-05"},u.title_i18n?this.i18n.tList(u.title_i18n,u.title,u):u.title):null,u.text?(0,R.createElement)("span",{class:`${u.lines?"ffz--line-clamp":""}`,style:{"--ffz-lines":u.lines}},u.markdown?(0,R.createElement)("span",{dangerouslySetInnerHTML:{__html:(0,U.e)().render(u.text_i18n?this.i18n.t(u.text_i18n,u.text,u):u.text)}}):null,u.markdown?null:u.text_i18n?this.i18n.tList(u.text_i18n,u.text,u):u.text):null):null,!u.unclosable&&(0,R.createElement)("button",{class:"tw-button-icon tw-mg-l-05 tw-relative ffz-il-tooltip__container",onClick:u._remove},(0,R.createElement)("span",{class:"tw-button-icon__icon"},(0,R.createElement)("figure",{class:"ffz-i-cancel"})))),y)),u.el}updateButtonToast(u,y,S){const n=(u||y)._ffz_toast_el;if(n){n.innerHTML="",(0,R.setChildren)(n,this.renderToasts(),!1,!0);return}this.updateButton(u,y,S)}updateButton(u,y,S){const n=this.fine.getChildNode(u);let s=!1,i=!1;if(y||(y=n&&n.querySelector(".top-nav__menu")),y||(n&&n.classList.contains("squad-stream-top-bar__container")?y=n:y=n&&n.querySelector(".squad-stream-top-bar__container"),y&&(s=!0)),!y&&u.handleAddStream&&(y=this.fine.searchTree(u,p=>p.classList&&p.classList.contains("multiview-stream-page__header")),y&&(s=!0)),!y&&u.getIsAdsEnabled&&(y=n&&n.querySelector(".sunlight-top-nav > .tw-flex > .tw-flex > .tw-justify-content-end > .tw-flex"),y&&(S=!0)),!y&&u.childContext&&(y=n&&n.querySelector(".modview-dock > div:last-child"),y&&(i=!0)),!y)return;if(!s&&!i&&!S){let p=null;try{p=y.querySelector(":scope > .tw-justify-content-end:last-child")}catch{}p?y=p:y=y.lastElementChild}let l,w=y.querySelector(".ffz-top-nav");w&&w.remove();const _=this.resolve("addons"),o=this.renderToasts(),e=this.formatPill(),a=this.formatExtraPill();if(w=(0,R.createElement)("div",{class:`ffz-top-nav ${i?"ffz-mod-view-button tw-relative tw-mg-b-1":`tw-align-self-center tw-flex-grow-0 tw-flex-nowrap tw-flex-shrink-0 tw-relative ${S?"tw-mg-l-05 tw-mg-r-2":"tw-mg-x-05"}`}`},(0,R.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},l=(0,R.createElement)("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative${this.loading?" loading":""}`,onClick:p=>this.handleClick(p,l),onContextMenu:p=>this.renderContext(p,l)},(0,R.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,R.createElement)("span",{class:"tw-button-icon__icon"},(0,R.createElement)("figure",{class:"ffz-i-zreknarf"})))),this.has_error&&(0,R.createElement)("div",{class:`tw-absolute ffz-balloon ffz-balloon--lg tw-block ${i?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right"}`},(0,R.createElement)("div",{class:"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4 tw-pd-1"},(0,R.createElement)("div",{class:"tw-flex tw-align-items-center"},(0,R.createElement)("div",{class:"tw-flex-grow-1"},this.error.i18n?this.i18n.t(this.error.i18n,this.error.text):this.error.text),this.error.permanent?null:(0,R.createElement)("button",{class:"tw-button-icon tw-mg-l-05 tw-relative ffz-il-tooltip__container",onClick:()=>this.error=null},(0,R.createElement)("span",{class:"tw-button-icon__icon"},(0,R.createElement)("figure",{class:"ffz-i-cancel"})))))),(0,R.createElement)("div",{class:`ffz-il-tooltip ${i?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right"}`},this.i18n.t("site.menu_button","FrankerFaceZ Control Center"),this.has_update&&(0,R.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.update-desc","There is an update available. Please refresh your page.")),this.settings.disable_profiles&&(0,R.createElement)("div",{class:"tw-mg-t-1"},this.i18n.tList("site.menu_button.no-settings",'Settings are disabled in this tab due to the inclusion of "{param}" in the URL.',{param:(0,R.createElement)("code",{class:"ffz-monospace"},"?ffz-no-settings")})),this._new_settings>0&&(0,R.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.new-desc","There {count,plural,one {is one new setting} other {are # new settings}}.",{count:this._new_settings})),this.has_strings&&(0,R.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.strings","There {added,plural,one {is # new string} other {are # new strings}} and {changed,plural,one {# changed string} other {# changed strings}}.",{added:this.i18n.new_strings,changed:this.i18n.changed_strings})),W.DEBUG&&(0,R.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.main-dev-desc","You are running a developer build of FrankerFaceZ.")),_.has_dev&&(0,R.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.addon-dev-desc","You have loaded add-on data from a local development server.")))),(u||y)._ffz_toast_el=(0,R.createElement)("div",{class:`ffz-toast--container tw-absolute tw-block ${i?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right"}`,onmouseenter:this.pauseToasts,onmouseleave:this.unpauseToasts},o),this.has_update&&(0,R.createElement)("div",{class:"ffz-menu__extra-pill tw-absolute"},(0,R.createElement)("div",{class:`tw-pill ${this.important_update?"tw-pill--notification":""}`},(0,R.createElement)("figure",{class:"ffz-i-arrows-cw"}))),a&&(0,R.createElement)("div",{class:"ffz-menu__extra-pill tw-absolute"},(0,R.createElement)("div",{class:"tw-pill"},a)),e&&(0,R.createElement)("div",{class:"ffz-menu__pill tw-absolute"},(0,R.createElement)("div",{class:"tw-pill"},e))),i)y.insertBefore(w,y.firstElementChild);else{let p=y.lastElementChild;p&&p.classList.contains("resize-detector")&&(p=p.previousElementSibling),p?y.insertBefore(w,p):y.appendChild(w)}this._ctx_open&&this.renderContext(null,l)}handleClick(u,y){if(u.shiftKey)return W.DEBUG&&u.ctrlKey?requestAnimationFrame(()=>this.i18n.openUI()):this.resolve("main_menu").openPopout();this.emit(":clicked",u,y)}renderButtonIcon(u){const y=this.settings.main_context.hasProfile(u);return(0,R.createElement)("figure",{class:`ffz--profile__icon ${y?"ffz-i-ok":u.toggled?"ffz-i-minus":"ffz-i-cancel"}`})}renderButtonTip(u){return u.toggled?this.settings.main_context.hasProfile(u)?this.i18n.t("setting.profiles.active","This profile is enabled and active."):this.i18n.t("setting.profiles.disabled.rules","This profile is enabled, but inactive due to its rules."):this.i18n.t("setting.profiles.disabled","This profile is disabled.")}renderContext(u,y){if(u){if(u.shiftKey||u.ctrlKey)return;u.preventDefault()}const S=y.parentElement.parentElement,n=S.classList.contains("ffz-mod-view-button");let s=S.querySelector(".ffz--menu-context");if(s)if(s._ffz_destroy)s._ffz_destroy();else return;const i=G(()=>{this._ctx_open=!1,s._ffz_outside&&s._ffz_outside.destroy(),s.remove()},"destroy"),l=[];for(const w of this.settings.__profiles){const _=(0,R.createElement)("button",{class:"tw-flex-shrink-0 tw-mg-r-1 tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-relative ffz-tooltip ffz-tooltip--no-mouse","data-title":this.renderButtonTip(w),onClick:e=>{w.toggled=!w.toggled,(0,R.setChildren)(_,this.renderButtonIcon(w)),_.dataset.title=this.renderButtonTip(w),_._ffz_tooltip?.rerender&&_._ffz_tooltip.rerender(),this.emit("tooltips:cleanup"),e.preventDefault(),e.stopPropagation()}},this.renderButtonIcon(w)),o=w.desc_i18n_key||w.i18n_key&&`${w.i18n_key}.description`;l.push((0,R.createElement)("div",{class:"tw-relative tw-border-b tw-pd-y-05 tw-pd-x-1 tw-flex"},_,(0,R.createElement)("div",null,(0,R.createElement)("h4",null,w.i18n_key?this.i18n.t(w.i18n_key,w.name,w):w.name,w.ephemeral&&(0,R.createElement)("div",{class:"tw-inline tw-mg-l-05 ffz-il-tooltip__container ffz--profile-row__icon ffz-i-user-secret tw-relative"},(0,R.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},this.i18n.t("setting.profiles.ephemeral","This profile is ephemeral.")))),w.description&&(0,R.createElement)("div",{class:"description"},o?this.i18n.t(o,w.description,w):w.description))))}s=(0,R.createElement)("div",{class:`tw-absolute ffz-attached ${n?"ffz-attached--up ffz-attached--left":"ffz-attached--down ffz-attached--right"}`},(0,R.createElement)("div",{class:"ffz-balloon ffz-balloon--lg tw-block ffz--menu-context"},(0,R.createElement)("div",{class:"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4"},(0,R.createElement)("div",{class:"tw-c-text-base tw-elevation-1 tw-flex tw-flex-shrink-0 tw-pd-x-1 tw-pd-y-05 tw-popover-header"},(0,R.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--left"},(0,R.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},(0,R.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden",onDblClick:()=>{this.emit("site.player:reset"),i()}},(0,R.createElement)("span",{class:"tw-button-icon__icon"},(0,R.createElement)("figure",{class:"ffz-i-t-reset"}))),(0,R.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-left"},this.i18n.t("player.reset_button.all","Reset All Players (Double-Click)")))),(0,R.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-column tw-flex-grow-1 tw-justify-content-center"},(0,R.createElement)("h5",{class:"tw-align-center tw-c-text-alt tw-semibold"},this.i18n.t("site.menu_button.profiles","Profiles"))),(0,R.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--right"},(0,R.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},(0,R.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden",onClick:w=>{this.openSettings(w,y),i()}},(0,R.createElement)("span",{class:"tw-button-icon__icon"},(0,R.createElement)("figure",{class:"ffz-i-cog"}))),(0,R.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},this.i18n.t("setting.profiles.configure","Configure")))),(0,R.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--right"},(0,R.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",onClick:i},(0,R.createElement)("span",{class:"tw-button-icon__icon"},(0,R.createElement)("figure",{class:"ffz-i-cancel"}))))),(0,R.createElement)("div",{class:"center-window__long-scrollable-area scrollable-area scrollable-area--suppress-scroll-x","data-simplebar":!0},l)))),s._ffz_destroy=i,s._ffz_outside=new R.ClickOutside(s,i),S.appendChild(s),this._ctx_open=!0}openSettings(u,y){const S=this.resolve("main_menu");S&&(S.requestPage("data_management.profiles"),!S.showing&&this.emit(":clicked",u,y))}loadMenu(u,y,S){const n=this.resolve("main_menu");n&&(S&&n.requestPage(S),!n.showing&&(this.loading=!0,n.enable(u).then(()=>{this.loading=!1}).catch(s=>{this.log.capture(s),this.log.error("Error enabling main menu.",s),this.addError("site.menu_button.error","There was an error loading the FFZ Control Center. Please refresh and try again."),this.loading=!1,this.once(":clicked",this.loadMenu)})))}onDisable(){this.off("i18n:update",this.update),this.off(":clicked",this.loadMenu)}};G(v,"MenuButton");let z=v},94296:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>R});var W=d(22527),B=d(46949);const I=class I extends W.default{constructor(...z){super(...z),this.inject("i18n"),this.inject("settings"),this.inject("site.channel"),this.inject("site.css_tweaks"),this.inject("site.fine"),this.inject("site.elemental"),this.inject("site.router"),this.inject("site.twitch_data"),this.inject("metadata"),this.inject("socket"),this.inject("pubsub"),this.should_enable=!0,this._cached_color=null,this._cached_channel=null,this._cached_id=null,this.Root=this.elemental.define("mod-view-root",".moderation-view-page",["mod-view"],{attributes:!0},1),this.ModInfoBar=this.elemental.define("mod-info-bar",".modview-player-widget__stream-info .simplebar-content",["mod-view"],{childNodes:!0,subtree:!0},1,3e4,!1),this.checkRoot=(0,B.debounce)(this.checkRoot,250),this.checkBar=(0,B.debounce)(this.checkBar,250)}onEnable(){this.Root.on("mount",this.updateRoot,this),this.Root.on("mutate",this.updateRoot,this),this.Root.on("unmount",this.removeRoot,this),this.Root.each(z=>this.updateRoot(z)),this.ModInfoBar.on("mount",this.updateBar,this),this.ModInfoBar.on("mutate",this.updateBar,this),this.ModInfoBar.on("unmount",this.removeBar,this),this.ModInfoBar.each(z=>this.updateBar(z)),this.router.on(":route",this.checkNavigation,this),this.checkNavigation()}updateSubscription(z,v){this._subbed_login===v&&this._subbed_id===z||(this._subbed_id&&(this.pubsub.unsubscribe(this,`twitch/${this._subbed_id}`),this._subbed_id=null),this._subbed_login&&(this.socket.unsubscribe(this,`channel.${this._subbed_login}`),this._subbed_login=null),z&&(this.pubsub.subscribe(this,`twitch/${z}`),this._subbed_id=z),v&&(this.socket.subscribe(this,`channel.${v}`),this._subbed_login=v))}checkNavigation(){this.router.current_name==="mod-view"&&(this.channel.updateChannelColor(this._cached_color),this.checkRoot())}checkBar(){this.ModInfoBar.clean()}checkRoot(){this.Root.each(z=>this.updateRoot(z))}updateRoot(z){const v=this.fine.getReactInstance(z);let f=null,u=v,y=0,S;for(;u!=null&&f==null&&y<10;){let n=u.memoizedState;for(S=0;n!=null&&f==null&&S<50;)f=n?.memoizedState?.current?.result?.data?.user??n?.memoizedState?.current?.previousData?.user,n=n?.next,S++;u=u?.child,y++}f?.id?this._cached_id!=f.id&&(this._cached_id=f.id,this._cached_channel=f,this._cached_color=null,this.updateSubscription(f.id,f.login),this.getChannelColor(z,f.id).then(n=>{this._cached_id==f.id&&(this._cached_color=n,this.channel.updateChannelColor(n),this.settings.updateContext({channelColor:n}))}).catch(()=>{this._cached_id==f.id&&(this._cached_color=null,this.channel.updateChannelColor(),this.settings.updateContext({channelColor:null}))}),this.settings.updateContext({channel:f.login,channelID:f.id})):this.removeRoot()}getChannelColor(z,v,f){const u=z._ffz_color_cache=z._ffz_color_cache||{};return v===u.channel_id&&Date.now()-u.saved<6e4?f?u.data:Promise.resolve(u.data):new Promise(async(y,S)=>{if(u.updating){u.updating.push([y,S]);return}u.channel_id=v,u.updating=[[y,S]];let n,s;try{n=await this.twitch_data.getChannelColor(v)}catch(l){n=null,s=l}const i=u.updating;if(u.updating=null,u.channel_id!==v){s=new Error("Outdated"),u.channel_id=null,u.data=null,u.saved=0;for(const l of i)l[1](s);return}u.data=n,u.saved=Date.now();for(const l of i)s?l[1](s):l[0](n)})}removeRoot(){this._cached_id=null,this._cached_channel=null,this._cached_color=null,this.updateSubscription(),this.channel.updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})}updateBar(z){const v=z.closest(".modview-player-widget__stream-info"),f=v&&this.fine.getReactInstance(v);let u=null,y=f?.return?.memoizedState,S=0;for(;y!=null&&u==null&&S<50;)u=y?.memoizedState?.current?.result?.data?.channel??y?.memoizedState?.current?.previousData?.channel,y=y?.next,S++;const n=u?.lastBroadcast,s=n?.title,i=n?.game;if(this._cached_bar_id!=u?.id&&(this._cached_bar_id=u?.id,this._cached_bar_channel=u),(s!=z._cached_title||i?.id!=z._cached_game)&&(z._cached_title=s,z._cached_game=i?.id,this.settings.updateContext({category:i?.name,categoryID:i?.id,title:s})),v){if(!v._ffz_cont){const l=v._ffz_cont=v.querySelector(".modview-player-widget__viewcount");l&&l.classList.add("ffz--mod-tray")}this.updateMetadata(v)}}removeBar(z){this.settings.updateContext({category:null,categoryID:null,title:null});const v=z.closest(".modview-player-widget__stream-info");if(v){if(v._ffz_cont&&v._ffz_cont.classList.remove("ffz--mod-tray"),v._ffz_cont=null,v._ffz_meta_timers){for(const f of Object.values(v._ffz_meta_timers))clearTimeout(f);v._ffz_meta_timers=null}v._ffz_update=null}}updateMetadata(z,v){const f=z._ffz_cont,u=this._cached_bar_channel;if(!f||!document.contains(f)){this.checkBar();return}if(!u?.id)return;v?Array.isArray(v)||(v=[v]):v=this.metadata.keys;const y=z._ffz_meta_timers=z._ffz_meta_timers||{},S=G(s=>this.updateMetadata(z,s),"refresh_fn"),n={channel:{id:u.id,login:u.login,display_name:u.displayName},el:z,getViewerCount:()=>0,getUserSelfImmediate:()=>null,getUserSelf:()=>null,getBroadcastID:()=>null};for(const s of v)this.metadata.definitions[s].modview&&this.metadata.renderLegacy(s,n,f,y,S)}};G(I,"ModView");let R=I},63155:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{PLAYER_ROUTES:()=>B,default:()=>R});var W=d(10789);const B=["front-page","user","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following","dash","squad","command-center","dash-stream-manager","mod-view","user-home"],I=class I extends W.Z{constructor(...z){super(...z),this.should_enable=!0,this.inject("site.router"),this.inject("metadata"),this.DataSource=this.fine.define("data-source",v=>v.consentMetadata&&v.onPlaying&&v.props&&v.props.data,B),this.Player=this.fine.define("highwind-player",v=>v.setPlayerActive&&v.props?.playerEvents&&v.props?.mediaPlayerInstance,B),this.TheatreHost=this.fine.define("theatre-host",v=>v.toggleTheatreMode&&v.props&&v.props.onTheatreModeEnabled,["user","user-home","video","user-video","user-clip"]),this.PlayerSource=this.fine.define("player-source",v=>v.setSrc&&v.setInitialPlaybackSettings,B)}repositionPlayer(){if(!this._mover){const z=document.querySelector(".channel-root__player");this._mover=this.fine.searchNode(z,v=>v.memoizedProps?.triggerPlayerReposition,50)}this._mover&&this._mover.memoizedProps.triggerPlayerReposition()}registerSettings(){super.registerSettings(),this.settings.add("player.home.autoplay",{default:!0,ui:{path:"Player > General >> Playback",title:"Auto-play featured broadcasters on the front page.",component:"setting-check-box"}}),this.settings.add("player.theatre.no-whispers",{default:!1,requires:["whispers.show"],process(z,v){return z.get("whispers.show")?v:!0},ui:{path:"Player > General >> Theatre Mode",title:"Hide whispers when Theatre Mode is enabled.",component:"setting-check-box"},changed:z=>this.css_tweaks.toggle("theatre-no-whispers",z)}),this.settings.add("player.theatre.metadata",{default:!1,requires:["context.route.name","layout.is-theater-mode"],process(z,v){return!z.get("layout.is-theater-mode")||z.get("context.route.name")==="video"?!1:v},ui:{path:"Player > General >> Theatre Mode",title:"Show metadata when mousing over the player.",component:"setting-check-box"},changed:z=>this.css_tweaks.toggle("theatre-metadata",z)}),this.settings.add("player.theatre.auto-enter",{default:!1,ui:{path:"Player > General >> Theatre Mode",title:"Automatically open Theatre Mode when visiting a channel.",component:"setting-check-box"}}),this.settings.add("player.fullscreen.auto-chat",{default:!1,ui:{path:"Player > General >> Fullscreen",title:"Automatically expand chat when entering fullscreen mode.",component:"setting-check-box"}}),this.settings.add("player.hide-event-bar",{default:!1,ui:{path:"Channel > Appearance >> General",title:"Hide the Event Bar",description:"Hide the Event Bar which appears above the player when there is an ongoing event for the current channel.",component:"setting-check-box"},changed:z=>{this.css_tweaks.toggleHide("player-event-bar",z),this.repositionPlayer()}})}async onEnable(){await super.onEnable(),this.css_tweaks.toggle("theatre-no-whispers",this.settings.get("player.theatre.no-whispers")),this.css_tweaks.toggle("theatre-metadata",this.settings.get("player.theatre.metadata")),this.css_tweaks.toggleHide("player-event-bar",this.settings.get("player.hide-event-bar")),this.on(":fix-player",this.repositionPlayer,this),this.on("site:fullscreen",this.maybeOpenChat,this),this.TheatreHost.on("mount",z=>{z._ffz_theater_start=Date.now(),this.tryTheatreMode(z)}),this.TheatreHost.on("update",this.tryTheatreMode,this),this.TheatreHost.ready((z,v)=>{const f=Date.now();for(const u of v)u._ffz_theater_start=f,this.tryTheatreMode(u)}),this.PlayerSource.on("mount",this.checkCarousel,this),this.PlayerSource.on("update",this.checkCarousel,this)}maybeOpenChat(){this.settings.get("player.fullscreen.auto-chat")&&this.parent.awaitElement(".right-column--collapsed .right-column__toggle-visibility button",document.fullscreenElement,1e3).then(z=>z.click())}shouldStopAutoplay(){return this.settings.get("player.no-autoplay")||!this.settings.get("player.home.autoplay")&&this.router.current?.name==="front-page"}checkCarousel(z){}getData(){return this.DataSource.first}tryTheatreMode(z){z._ffz_theater_timer||(z._ffz_theater_timer=setTimeout(()=>{z._ffz_theater_timer=null,!(!this.settings.get("player.theatre.auto-enter")||!z._ffz_mounted)&&this.router.current_name==="user"&&(z.props.channelHomeLive||z.props.channelHomeCarousel||z.props.theatreModeEnabled||Date.now()-(z._ffz_theater_start||0)>2e3||z.props.onTheatreModeEnabled&&z.props.onTheatreModeEnabled())},250))}repositionPlayer(){}updateSquadContext(){this.settings.updateContext({squad_bar:this.hasSquadBar})}get hasSquadBar(){return!1}};G(I,"Player");let R=I},24020:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>y});var W=d(22527),B=d(44589),R=d(14873);const I=d.p+"color_normalizer.css",U=["product","prime","turbo"],z=[-.62,-.578,-.539,-.469,-.4,-.32,-.21,-.098,0,.08,.151,.212,.271,.31,.351],v=":root{color-scheme: only light}",f=":root{forced-color-adjust: none}",u={dark:{c:{"background-brand":11,"background-accent":8,"background-accent-alt":7,"background-accent-alt-2":6,"background-button":7,"background-button-active":7,"background-button-focus":8,"background-button-hover":8,"background-button-primary-active":7,"background-button-primary-default":9,"background-button-primary-hover":8,"background-chat":1,"background-chat-alt":3,"background-chat-header":2,"background-graph":2,"background-graph-fill":8,"background-input-checkbox-checked":10,"background-input-checked":8,"background-interactable-selected":9,"background-modal":3,"background-progress-countdown-status":9,"background-progress-status":9,"background-range-fill":10,"background-subscriber-stream-tag-active":4,"background-subscriber-stream-tag-default":4,"background-subscriber-stream-tag-hover":3,"background-toggle-checked":2,"background-toggle-handle-checked":10,"background-top-nav":6,"border-brand":9,"border-button":7,"border-button-active":8,"border-button-focus":9,"border-button-hover":8,"border-input-checkbox-checked":10,"border-input-checkbox-focus":10,"border-input-focus":10,"border-interactable-selected":10,"border-range-handle":10,"border-subscriber-stream-tag":5,"border-tab-active":11,"border-tab-focus":11,"border-tab-hover":11,"border-toggle-checked":10,"border-toggle-focus":10,"border-whisper-incoming":10,"fill-brand":9,"text-button-text-active":"o2","text-link":10,"text-link-active":10,"text-link-focus":10,"text-link-hover":10,"text-link-visited":10,"text-overlay-link-active":13,"text-overlay-link-focus":13,"text-overlay-link-hover":13,"text-tab-active":11,"text-toggle-checked-icon":10,"text-tooltip":1,"text-button-text":10},s:{"button-active":[8," 0 0 6px 0",""],"button-focus":[8," 0 0 6px 0",""],input:[5," inset 0 0 0 1px",""],"input-focus":[8," 0 0 10px -2px",""],"interactable-focus":[8," 0 0 6px 0",""],"tab-focus":[11," 0 4px 6px -4px",""]}},light:{c:{"background-accent":8,"background-accent-alt":7,"background-accent-alt-2":6,"background-button":7,"background-button-active":7,"background-button-focus":8,"background-button-hover":8,"background-button-primary-active":7,"background-button-primary-default":9,"background-button-primary-hover":8,"background-chat":1,"background-chat-alt":3,"background-chat-header":2,"background-graph":15,"background-graph-fill":9,"background-input-checkbox-checked":9,"background-input-checked":8,"background-interactable-selected":9,"background-modal":3,"background-progress-countdown-status":8,"background-progress-status":8,"background-range-fill":9,"background-subscriber-stream-tag-active":13,"background-subscriber-stream-tag-default":13,"background-subscriber-stream-tag-hover":14,"background-toggle-checked":15,"background-top-nav":7,"background-toggle-handle-checked":10,"border-brand":9,"border-button":7,"border-button-active":8,"border-button-focus":9,"border-button-hover":8,"border-input-checkbox-checked":9,"border-input-checkbox-focus":9,"border-input-focus":9,"border-interactable-selected":9,"border-range-handle":9,"border-subscriber-stream-tag":10,"border-tab-active":8,"border-tab-focus":8,"border-tab-hover":8,"border-toggle-checked":9,"border-toggle-focus":9,"border-whisper-incoming":10,"fill-brand":9,"text-button-text-active":"o2","text-link":8,"text-link-active":9,"text-link-focus":9,"text-link-hover":9,"text-link-visited":9,"text-overlay-link-active":13,"text-overlay-link-focus":13,"text-overlay-link-hover":13,"text-tab-active":8,"text-toggle-checked-icon":9,"text-tooltip":1,"text-button-text":8,"background-tooltip":1,"text-button-text-focus":"o1","text-button-text-hover":"o1"},s:{"button-active":[8," 0 0 6px 0",""],"button-focus":[8," 0 0 6px 0",""],input:[5," inset 0 0 0 1px",""],"input-focus":[10," 0 0 10px -2px",""],"interactable-focus":[8," 0 0 6px 1px",""],"tab-focus":[8," 0 4px 6px -4px",""]}},accent_dark:{c:{"accent-hover":10,accent:9,"accent-primary-1":1,"accent-primary-2":5,"accent-primary-3":6,"accent-primary-4":7,"accent-primary-5":8},s:{}},accent_light:{c:{"accent-hover":10,accent:9,"accent-primary-1":1,"accent-primary-2":5,"accent-primary-3":6,"accent-primary-4":7,"accent-primary-5":8},s:{}}},S=class S extends W.default{constructor(...s){super(...s),this.inject("settings"),this.inject("site"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject("site.router"),this.should_enable=!0,this.settings.add("theme.high-contrast-tweaks",{default:null,requires:["context.is-forced-colors","theme.disable-high-contrast"],process(i,l){return l===null?i.get("theme.disable-high-contrast")?!1:i.get("context.is-forced-colors")??!1:l},ui:{path:"Appearance > Theme >> Tweaks",title:"Enable the use of High Contrast tweaks.",description:"This loads an additional set of styles when Forced Color / OS High Contrast mode is enabled to ensure page elements are displayed more appropriately.",component:"setting-check-box"}}),this.settings.add("theme.disable-high-contrast",{default:!1,ui:{path:"Appearance > Theme >> Tweaks",title:"Disable Forced Color / OS High Contrast",component:"setting-check-box",description:"Enabling this will instruct your browser to not respect your operating system's High Contrast settings when displaying Twitch. You may need to refresh for this to take full effect."},changed:()=>this.updateCSS()}),this.settings.add("theme.disable-auto-dark",{default:!1,ui:{path:'Appearance > Theme >> Tweaks @{"sort": 10}',title:"Disable Auto Dark Theme",component:"setting-check-box",description:"Enabling this will attempt to disable a browser's built-in automatic dark theme conversion for websites, which is unnecessary on Twitch and can cause display issues. This may not apply depending on your web browser and settings."},changed:()=>this.updateCSS()}),this.settings.add("theme.legacy-dark-input",{default:!1,ui:{path:"Appearance > Theme >> Tweaks",title:"Use old input element colors with dark theme.",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("theme.font.size",{default:13,process(i,l){if(typeof l!="number")try{l=parseFloat(l)}catch{l=null}return(!l||l<1||isNaN(l)||!isFinite(l)||l>25)&&(l=13),l},ui:{path:'Appearance > Theme >> Fonts @{"sort": 2}',title:"Font Size",description:"**Minimum:** `1`, **Maximum:** `25`, *Old Default:* `12`\n\nHow large should normal text be, in pixels. This may be affected by your browser's zoom and font settings.",component:"setting-text-box",type:"number"},changed:()=>this.updateFont()}),this.settings.add("theme.color.background",{default:"",ui:{path:'Appearance > Theme >> Colors @{"sort": 0, "description": "This is a quick preview of a new system coming soon to FrankerFaceZ. Expect heavy changes here, including separate Basic and Advanced modes, and better color selection."}',title:"Background",description:"Try `#0E0C13` for something close to the old dark theme, or `#0E0E0E` for a nice dark gray. Transparent colors not allowed.",component:"setting-color-box",sort:0,alpha:!1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.text",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Text",description:"If not set, this will automatically be set to white or black based on the brightness of the background.",component:"setting-color-box",sort:1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.accent",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Accent",description:"The accent color is used for buttons, links, etc.",component:"setting-color-box",alpha:!1,sort:2},changed:()=>this.updateCSS()}),this.settings.add("theme.color.tooltip.background",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Tooltip Background",description:"If not set, the tooltip settings will be automatically adjusted based on the brightness of the background.",component:"setting-color-box",alpha:!0,sort:10},changed:()=>this.updateCSS()}),this.settings.add("theme.color.tooltip.text",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Tooltip Text",component:"setting-color-box",sort:11},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-background",{default:"",ui:{path:'Appearance > Theme >> Chat Colors @{"sort":1}',title:"Background",component:"setting-color-box",sort:0,alpha:!1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-text",{default:"",ui:{path:"Appearance > Theme >> Chat Colors",title:"Text",description:"If not set, this will automatically be set to white or black based on the brightness of the background.",component:"setting-color-box",sort:1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-accent",{default:"",ui:{path:"Appearance > Theme >> Chat Colors",title:"Accent",description:"The accent color is used for buttons, links, etc.",component:"setting-color-box",alpha:!1,sort:2},changed:()=>this.updateCSS()}),this.settings.add("theme.can-dark",{requires:["context.route.name"],process(i){return!U.includes(i.get("context.route.name"))}}),this.settings.add("theme.is-dark",{requires:["context.force-dark","theme.can-dark","context.ui.theme","context.ui.theatreModeEnabled","context.route.name","context.location.search"],process(i){const l=i.get("context.force-theme");return l??(i.get("context.route.name")==="embed-chat"?(i.get("context.location.search")||"").includes("dark"):i.get("context.ui.theatreModeEnabled")||i.get("theme.can-dark")&&i.get("context.ui.theme")===1)},changed:()=>this.updateCSS()}),this.settings.add("theme.tooltips-dark",{requires:["theme.is-dark"],process(i){return!i.get("theme.is-dark")}}),this._style=null,this._normalizer=null}updateFont(){let s=this.settings.get("theme.font.size");if(typeof s=="string"&&/^[0-9.]+$/.test(s)?s=parseFloat(s):typeof s!="number"&&(s=null),!s||isNaN(s)||!isFinite(s)||s<1||s===13){this.css_tweaks.delete("font-size");return}s=s/10,this.css_tweaks.set("font-size",`html body {
	--font-size-1: ${4.153846153846154*s}rem;
	--font-size-2: ${2.769230769230769*s}rem;
	--font-size-3: ${1.8461538461538463*s}rem;
	--font-size-4: ${1.3846153846153846*s}rem;
	--font-size-5: ${1.0769230769230769*s}rem;
	--font-size-6: ${s}rem;
	--font-size-7: ${.9230769230769231*s}rem;
	--font-size-8: ${.9230769230769231*s}rem;
	--font-size-base: ${s}rem;
}
`)}generateBackgroundTextBlob(s){const i=s.toHSLA(),l=i.l,w=l<.5;return this.generateBackgroundBlob(s)+this.generateTextBlob(R.Color.RGBA.fromCSS(w?"#FFF":"#000"))}generateBackgroundBlob(s){const i=s.toHSLA(),l=i.l,w=l<.5;return[`--color-background-body:${s.toCSS()};`,`--color-background-input-focus:${s.toCSS()};`,`--color-background-base:${i._l(l+(w?.05:-.05)).toCSS()};`,`--color-background-alt:${i._l(l+(w?.1:-.1)).toCSS()};`,"--color-background-float:var(--color-background-alt);",`--color-background-alt-2:${i._l(l+(w?.15:-.15)).toCSS()};`].join("")}generateTextBlob(s){s.a<.4&&(s=s._a(.4));const i=s.a;return[`--color-text-base:${s.toCSS()};`,`--color-text-input:${s.toCSS()};`,`--color-text-label:${s.toCSS()};`,`--color-text-label-optional:${s._a(i-.4).toCSS()};`,`--color-text-alt:${s._a(i-.2).toCSS()};`,`--color-text-alt-2:${s._a(i-.4).toCSS()};`].join("")}generateAccentBlob(s,i){s.a<1&&(s=s._a(1));const l=s.toHSLA(),w=l.l,_=z.map(p=>p===0?s.toCSS():l._l(w+p).toCSS()),o=[],e=[];for(let p=0;p<_.length;p++)o.push(`--ffz-color-accent-${p+1}:${_[p]};`);let a=i?u.dark:u.light;for(const[p,C]of Object.entries(a.c))typeof C=="number"&&o.push(`--color-${p}:${_[C-1]};`);a=i?u.accent_dark:u.accent_light;for(const[p,C]of Object.entries(a.c))typeof C=="number"&&e.push(`--color-${p}:${_[C-1]} !important;`);return[o.join(""),e.join("")]}updateCSS(){if(this.settings.get("theme.disable-high-contrast")?this.css_tweaks.set("nofc",f):this.css_tweaks.delete("nofc"),this.settings.get("theme.disable-auto-dark")?this.css_tweaks.set("nodark",v):this.css_tweaks.delete("nodark"),this.css_tweaks.setVariable("border-color","var(--color-border-base)"),!this.settings.get("theme.can-dark")){this.toggleNormalizer(!1),this.toggleAccentNormal(!0),this.css_tweaks.delete("colors");return}let s=this.settings.get("theme.is-dark");const i=[],l=[],w=R.Color.RGBA.fromCSS(this.settings.get("theme.color.background"));if(w){w.a=1;const h=w.toHSLA();s=h.l<.5;try{const L=this.resolve("site").store,T=L.getState().ui.theme,O=s?1:0;T!==O&&L.dispatch({type:"core.ui.THEME_CHANGED",theme:O})}catch(L){this.log.warning("Unable to automatically set the Twitch Dark Theme state.",L)}i.push(this.generateBackgroundBlob(h)),s&&(i.push("--color-border-base: var(--color-opac-gl-2);"),i.push("--color-background-interactable-hover: var(--color-opac-gl-1);"),i.push("--color-background-interactable-active: var(--color-opac-gl-2);"),i.push("--color-background-button-text-hover: var(--color-opac-gl-1);"),i.push("--color-background-button-text-active: var(--color-opac-gl-2);"))}let _=R.Color.RGBA.fromCSS(this.settings.get("theme.color.text"));!_&&w&&(_=R.Color.RGBA.fromCSS(s?"#FFF":"#000")),_&&i.push(this.generateTextBlob(_)),s&&this.settings.get("theme.legacy-dark-input")&&i.push(`--color-background-input: var(--color-opac-w-4);
--color-background-input-overlay: var(--color-opac-b-4);
--color-background-input-overlay-focus: var(--color-black);
--color-background-selectable: var(--color-opac-w-3);
--color-background-selectable-hover: var(--color-opac-w-4);
--color-border-input: var(--color-opac-w-4);
--color-border-input-hover: var(--color-opac-w-6);
--color-border-input-overlay: var(--color-opac-w-6);
--color-border-input-overlay-hover: var(--color-opac-w-8);
--color-border-input-checkbox: var(--color-opac-w-10);
--color-border-selectable: var(--color-opac-w-2);
--color-border-selectable-hover: var(--color-opac-w-3);`);const o=R.Color.RGBA.fromCSS(this.settings.get("theme.color.accent"));if(this.toggleAccentNormal(!o),o){const h=this.generateAccentBlob(o,s);i.push(h[0]),l.push(h[1])}let e=R.Color.RGBA.fromCSS(this.settings.get("theme.color.tooltip.background")),a;!e&&w&&(e=R.Color.RGBA.fromCSS(s?"#FFF":"#000")),e?(i.push(`--color-background-tooltip: ${e.toCSS()};`),a=e.toHSLA().l<.5):a=!s;let p=R.Color.RGBA.fromCSS(this.settings.get("theme.color.tooltip.text"));const C=p||e;if(p||(p=R.Color.RGBA.fromCSS(a?"#FFF":"#000")),p){C&&i.push(`--color-text-tooltip: ${p.toCSS()};`);const h=p.toHSLA(),M=h.a;i.push(`--color-text-tooltip-alt: ${h._a(M-.2).toCSS()};`),i.push(`--color-text-tooltip-alt-2: ${h._a(M-.4).toCSS()};`)}const m=[],x=R.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-background"));let $=s;if(x){x.a=1;const h=x.toHSLA();$=h.l<.5,m.push(this.generateBackgroundBlob(h))}let r=R.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-text"));!r&&x&&(r=R.Color.RGBA.fromCSS($?"#FFF":"#000")),r&&m.push(this.generateTextBlob(r));const c=R.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-accent")),b=[];if(c){const h=this.generateAccentBlob(c,$);m.push(h[0]),b.push(h[1])}m.length?this.css_tweaks.set("chat-colors",`.moderation-view-page-widget .stream-chat,.chat-shell {${m.join(`
`)}}.moderation-view-page-widget .stream-chat .tw-accent-region,.chat-shell .tw-accent-region{${b.join(`
`)}}`):this.css_tweaks.delete("chat-colors"),this.toggleNormalizer(m.length||i.length);const k=s?"":":not(.settings-menu-button-component--forced-dark-theme)";i.length?this.css_tweaks.set("colors",`body,body .tw-root--theme-light,body .tw-root--theme-dark${k} {${i.join(`
`)}}.channel-info-content .tw-accent-region,.channel-info-content div[class^="ScAccentRegion"]{${l.join(`
`)}}`):this.css_tweaks.delete("colors")}toggleAccentNormal(s){if(s){const i=[];for(let l=0;l<15;l++)i.push(`--ffz-color-accent-${l+1}:var(--color-twitch-purple-${l+1});`);this.css_tweaks.set("accent-normal",`body {${i.join(`
`)}}`)}else this.css_tweaks.delete("accent-normal")}toggleNormalizer(s){if(this._normalizer){if(!s){this._normalizer.remove();return}}else{if(!s)return;this._normalizer=(0,B.createElement)("link",{rel:"stylesheet",type:"text/css",href:I})}document.head.contains(this._normalizer)||document.head.appendChild(this._normalizer)}onEnable(){let s;try{s=window.matchMedia("(forced-colors: active)")?.matches}catch{}this.settings.updateContext({"is-forced-colors":s??!1}),this.settings.getChanges("theme.high-contrast-tweaks",i=>{this.css_tweaks.toggle("hc-tweaks",i)}),this.updateCSS(),this.updateFont()}};G(S,"ThemeEngine");let y=S},4948:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>u});var W=d(46949),B=d(83269),R=d(6172),I=d(22527),U=d(24431);const z=/^([^\s]+) subscribed ([^.]+)\. They've subscribed for (\d+) months(?:[^!]+streak)?!/,v={1e3:1,2e3:2,3e3:3};function f(S){try{/^[\d-]+$/.test(S)&&(S=parseInt(S,10))}catch{}return(typeof S!="number"||isNaN(S)||!isFinite(S))&&(S=0),S}G(f,"parseParamInt");const y=class y extends I.default{constructor(...n){super(...n),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site"),this.inject("site.router"),this.inject("site.fine"),this.inject("chat"),this.inject("chat.emotes"),this.inject("chat.overrides"),this.injectAs("site_chat","site.chat"),this.inject("site.chat.chat_line.rich_content"),this.VideoChatController=this.fine.define("video-chat-controller",s=>s.onError&&s.videoData&&s.props?.comments,["user-video","user-clip","video"]),this.VideoChatLine=this.fine.define("video-chat-line",s=>s.onTimestampClickHandler&&s.props?.messageContext,["user-video","user-clip","video"]),this.settings.add("chat.video-chat.timestamps",{default:!0,ui:{path:"Chat > Chat on Videos >> Appearance",title:"Display timestamps alongside chat messages.",component:"setting-check-box"}}),this.settings.add("chat.video-chat.enabled",{default:!0,ui:{path:'Chat > Chat on Videos @{"description": "This feature is currently in beta. As such, you may experience issues when using FFZ features with Chat on Videos."} >> General',title:"Enable FrankerFaceZ features for Chat on Videos.",description:"Display FFZ badges, emotes, and other features in Chat on Videos. Moderation features may be unavailable when this is enabled.",component:"setting-check-box"}}),this.active_room=null}async onEnable(){var w;this.chat.context.on("changed:chat.video-chat.enabled",this.rerenderLines,this),this.chat.context.on("changed:chat.video-chat.timestamps",this.rerenderLines,this),this.on("chat.overrides:changed",_=>this.updateLinesByUser(_,null,!1,!1),this),this.on("chat:update-lines-by-user",this.updateLinesByUser,this),this.on("chat:update-line",this.updateLineById,this),this.on("chat:update-lines",this.updateLines,this),this.on("chat:rerender-lines",this.rerenderLines,this),this.on("chat:update-line-tokens",this.updateLineTokens,this),this.on("chat:update-line-badges",this.updateLineBadges,this),this.on("i18n:update",this.rerenderLines,this),this.on("chat.emotes:update-effects",this.checkEffects,this);for(const _ of U.RERENDER_SETTINGS)this.chat.context.on(`changed:${_}`,this.rerenderLines,this);for(const _ of U.UPDATE_TOKEN_SETTINGS)this.chat.context.on(`changed:${_}`,this.updateLineTokens,this);for(const _ of U.UPDATE_BADGE_SETTINGS)this.chat.context.on(`changed:${_}`,this.updateLineBadges,this);this.on("chat:get-messages",(_,o,e,a)=>{if(e)for(const p of this.VideoChatLine.instances){const C=p.props.messageContext;C.comment?._ffz_message&&a.push({message:C.comment._ffz_message,_instance:p,update:()=>p.forceUpdate()})}}),this.VideoChatController.on("mount",this.chatMounted,this),this.VideoChatController.on("unmount",this.chatUnmounted,this),this.VideoChatController.on("receive-props",this.chatUpdated,this),this.VideoChatController.ready((_,o)=>{for(const e of o)this.chatMounted(e)});const n=this,s=await this.site.findReact();if(!s)return;const i=s.createElement,l=this.rich_content&&this.rich_content.RichContent;this.MenuContainer=(w=class extends s.Component{constructor(o){super(o),this.onBanUser=()=>{this.props.onBanUserClick({bannedUser:this.props.context.comment.commenter,targetChannel:this.props.context.comment.channelId,comment:this.props.context.comment})},this.onDeleteComment=()=>{this.props.onDeleteCommentClick(this.props.context.comment)},this.onOpen=()=>{this.props.onDisableSync(),this.setState({force:!0})},this.onClose=()=>{this.setState({force:!1})},this.state={force:!1}}render(){return null}},G(w,"FFZMenuContainer"),w),this.VideoChatLine.ready(_=>{const o=_.prototype.render;_.prototype.ffzRenderMessage=function(e,a){const p=e.is_action,C=p?n.chat.context.get("chat.me-style"):0,m=C>=2,x=C===1||C===3,$=e.user,r=n.overrides.getColor($.id)||$.color,c=n.site_chat.colors.process(r),b=n.site.getUser();b&&(b.moderator=this.props.isCurrentUserModerator,b.staff=b.roles&&b.roles.isStaff);let k;if(e.system_msg===!0){const q=e.params||{};if(q["msg-id"]==="resub"){const ee=n.chat.context.get("chat.subs.show"),te=f(q["msg-param-months"]),ne=f(q["msg-param-cumulative-months"]),pe=ne||te;if(n.log.info("resub-notice setting:",ee,"months:",pe,"cumulative:",ne,"raw:",te),n.log.info("-> params:",q),ee===3||pe>1&&ee>0){const oe=f(q["msg-param-should-share-streak"])===1,de=q["msg-param-sub-plan"],me=de==="Prime",Ee=v[de]||1;n.log.info("-> share:",oe,"plan:",de,"tier:",Ee),k=n.i18n.tList("chat.sub.main","{user} subscribed {plan}. ",{user:i("span",{class:"tw-c-text-base tw-strong"},$.displayName),plan:me?n.i18n.t("chat.sub.twitch-prime","with Prime Gaming"):n.i18n.t("chat.sub.plan","at Tier {tier}",{tier:Ee})}),oe&&te>1?k.push(n.i18n.t("chat.sub.cumulative-months","They've subscribed for {cumulative,number} months, currently on a {streak,number} month streak!",{cumulative:ne,streak:te})):pe>1&&k.push(n.i18n.t("chat.sub.months","They've subscribed for {count,number} months!",{count:pe}))}}}else e.system_msg&&(k=e.system_msg);const h=e.ffz_tokens=e.ffz_tokens||n.chat.tokenizeMessage(e,b),M=l&&n.chat.pluckRichContent(h,e),L=n.chat.formatUser($,i),T=n.overrides.getName($.id);let O=e.ffz_user_class;O instanceof Set?O=[...O].join(" "):Array.isArray(O)&&(O=O.join(" "));const P={className:`video-chat__message-author notranslate${T?" ffz--name-override tw-relative ffz-il-tooltip__container":""} ${O??""}`,"data-test-selector":"comment-author-selector",href:`/${$.login}`,rel:"noopener noreferrer",target:"_blank",style:{color:c}};e.ffz_user_props&&Object.assign(P,e.ffz_user_props),e.ffz_user_style&&Object.assign(P.style,e.ffz_user_style);const j=i("a",P,T?[i("span",{className:"chat-author__display-name"},T),i("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},L)]:L);let Z=i("div",{class:"tw-flex-grow-1","data-room-id":e.roomID,"data-room":e.roomLogin,"data-user-id":$.id,"data-user":$.login},i("span",{class:"chat-line__message--badges"},n.chat.badges.render(e,i)),j,i("div",{"data-test-selector":"comment-message-selector",class:"tw-inline video-chat__message"},i("span",null,p?" ":": "),i("span",{class:`message ${m?"chat-line__message-body--italicized":""}`,style:{color:x?c:null}},n.chat.renderTokens(h,i)),M&&i(l,M)));return k&&(Z=i("div",{class:"tw-flex-grow-1"},i("div",{class:"tw-flex tw-c-text-alt-2"},i("div",null,k)),Z)),i("div",{class:"tw-align-items-start tw-flex tw-flex-nowrap tw-c-text-base"},Z,a?i(n.MenuContainer,{context:a,isCurrentUserModerator:this.props.isCurrentUserModerator,isExpandedLayout:this.props.isExpandedLayout,onBanUserClick:this.props.onBanUserClick,onDeleteCommentClick:this.props.onDeleteCommentClick,onDisableSync:this.props.onDisableSync,onReplyClick:this.onReplyClickHandler}):null)},_.prototype.ffzRenderExpanded=function(e){return e._reply_handler||(e._reply_handler=()=>this.onReplyClickHandler(e.user.login)),i("div",{class:"tw-align-items-center tw-flex tw-pd-t-05"},i("button",{class:"tw-button tw-button--text","data-test-selector":"parent-reply-button",onClick:e._reply_handler},i("span",{class:"tw-button__text tw-pd-0"},n.i18n.t("video-chat.reply","Reply"))),i("span",{class:"tw-c-text-alt-2 tw-font-size-7 tw-mg-l-05 tw-relative ffz-il-tooltip__container"},"\u2022 ",n.i18n.t("video-chat.time","{time,humantime} ago",{time:e.timestamp}),i("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-center ffz-il-tooltip--up",role:"tooltip"},n.i18n.formatDateTime(e.timestamp,"full"))))},_.prototype.render=function(){try{if(this._ffz_no_scan=!0,this.state?.showReplyForm||!n.chat.context.get("chat.video-chat.enabled"))return o.call(this);const e=this.props.messageContext,a=n.standardizeMessage(e.comment,e.author),p=this.ffzRenderMessage(a,e),C=this.props.hideTimestamp||!n.chat.context.get("chat.video-chat.timestamps"),m=a.mentioned&&a.mention_color?n.site_chat.inverse_colors.process(a.mention_color):null;if(a.ffz_removed)return null;const x=!m&&a.highlight&&n.chat.context.get("chat.points.allow-highlight");return i("div",{"data-test-selector":"message-layout",class:`tw-align-items-start tw-flex tw-flex-nowrap tw-full-width tw-pd-l-05 tw-pd-y-05 vod-message${a.is_sub?" ffz-notice-line ffz--subscribe-line":""}${a.highlight?" ffz-notice-line ffz--points-line":""}${x?" ffz--points-highlight ffz-custom-color":""}${a.mentioned?" ffz-mentioned":""}${m?" ffz-custom-color":""}`,style:{backgroundColor:m}},C||i("div",{"data-test-selector":"message-timestamp",class:"tw-align-right tw-flex tw-flex-shrink-0 vod-message__header"},i("div",{class:"tw-mg-r-05"},i("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},i("button",{class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this.onTimestampClickHandler},i("div",{class:"tw-pd-x-05"},i("p",{class:"tw-font-size-7"},(0,B.print_duration)(e.comment.contentOffset)))),i("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-left ffz-il-tooltip--up",role:"tooltip"},n.i18n.t("video-chat.jump","Jump to Video"))))),i("div",{class:"tw-full-width"},p,this.props.isExpandedLayout&&this.ffzRenderExpanded(a),e.replies&&e.replies.length>0&&i("div",{class:"qa-vod-chat-reply tw-mg-l-05 tw-mg-y-05 vod-message__reply"},e.comment.moreReplies&&i("div",{class:"tw-inline-block vod-message__show-more-replies"},i("button",{class:"tw-interactive tw-button tw-button--text",onClick:this.onLoadMoreRepliesClickHandler},i("span",{class:"tw-button__text","data-a-target":"tw-button-text"},n.i18n.t("video-chat.show-more","Show more replies...")))),i("ul",null,e.replies.map($=>i("li",{key:$.comment&&$.comment.id,class:"tw-mg-l-05"},this.ffzRenderMessage(n.standardizeMessage($.comment,$.author),$),this.props.isExpandedLayout&&this.ffzRenderExpanded(a)))))))}catch(e){return n.log.error("Problem rendering Chat",e),o.call(this)}},setTimeout(()=>this.VideoChatLine.forceUpdate())})}updateLines(){return this._updateLines()}rerenderLines(){this.VideoChatLine.forceUpdate()}updateLineTokens(){return this._updateLines(!0,!1)}updateLineBadges(){return this._updateLines(!1,!0)}_updateLines(n=!0,s=!0){for(const i of this.VideoChatLine.instances){const l=i.props.messageContext;if(l.comment&&(l.comment._ffz_message=null,Array.isArray(l.replies)))for(const w of l.replies)w.comment&&(w.comment._ffz_message=null)}this.VideoChatLine.forceUpdate()}updateLinesByUser(n,s){for(const i of this.VideoChatLine.instances){const l=i.props.messageContext;if(!l.comment)continue;const w=l.author;w&&(n&&n==w.id||s&&s==w.name)&&(l.comment._ffz_message=null,i.forceUpdate())}}updateLineById(n,s=!0,i=null){i==null&&(i=s);for(const l of this.VideoChatLine.instances){const w=l.props.messageContext;if(w.comment&&w.comment?.id===n){(s||i)&&(w.comment._ffz_message=null),l.forceUpdate();return}}}checkEffects(){for(const n of this.VideoChatLine.instances){const s=n.props.messageContext,i=s?.comment?._ffz_message,l=i?.ffz_tokens;if(l)for(const w of l)w.type==="emote"&&w.modifier_flags&&this.emotes.ensureEffect(w.modifier_flags)}}standardizeMessage(n,s){if(n._ffz_message)return n._ffz_message;const i=this.active_room||this.chat.getRoom(n.channelId,null,!0,!0),l=n.message.userNoticeParams,w=l&&l["msg-id"],_=n._ffz_message={id:n.id,user:{color:n.message.userColor,id:s.id,login:s.name,displayName:s.displayName,isIntl:s.name&&s.displayName&&s.displayName.trim().toLowerCase()!==s.name,type:s.type},roomLogin:i&&i.login,roomID:i&&i.id||n.channelId,ffz_badges:this.chat.badges.getBadges(s.id,s.login,i?.id,i?.login),badges:n.userBadges,messageParts:n.message.tokens,is_action:n.message.isAction,more_replies:n.moreReplies,timestamp:n.createdAt,ffz_context:"video",is_sub:w==="sub"||w==="resub",highlight:w==="highlighted-message",params:l};if(Array.isArray(_.messageParts)&&_.messageParts.length&&w==="resub"){let o=_.messageParts[0].content;if(typeof o=="string"){const e=z.exec(o);e&&(o=o.slice(e[0].length).trimLeft(),o.length&&(_.messageParts[0].ffz_content=o,_.system_msg=!0))}}return this.chat.detokenizeMessage(_),_}addRoom(n,s){s||(s=n.props);const i=(0,W.get)("data.video.owner",s);if(!i||!i.id)return null;const l=n._ffz_room=this.chat.getRoom(i.id,i.login&&i.login.toLowerCase(),!1,!0);return l.ref(n),l}removeRoom(n){n._ffz_room&&(n._ffz_room.unref(n),n._ffz_room=null)}chatMounted(n,s){s||(s=n.props),this.addRoom(n,s)&&(this.active_room=n._ffz_room,this.chat.badges.updateTwitchBadges((0,W.get)("data.badges",s)),this.updateRoomBadges(n,(0,W.get)("data.video.owner.broadcastBadges",s)),this.updateRoomBitsConfig(n,s.bitsConfig))}chatUpdated(n,s){if((0,W.get)("data.video.owner.id",s)!==(0,W.get)("data.video.owner.id",n.props)){this.removeRoom(n),this.chatMounted(n,s);return}const i=(0,W.get)("data.badges",s),l=(0,W.get)("data.badges",n.props),w=(0,W.get)("data.video.owner.broadcastBadges",s),_=(0,W.get)("data.video.owner.broadcastBadges",n.props);i!==l&&this.chat.badges.updateTwitchBadges(i),w!==_&&this.updateRoomBadges(n,w),s.bitsConfig!==n.props.bitsConfig&&this.updateRoomBitsConfig(n,s.bitsConfig);const o=(0,W.get)("data.video.owner",s);this.settings.updateContext({moderator:s.isCurrentUserModerator}),this.chat.context.updateContext({moderator:s.isCurrentUserModerator,channel:o?o.login:null,channelID:o?o.id:null})}chatUnmounted(n){this.active_room===n._ffz_room&&(this.active_room=null),this.removeRoom(n)}updateRoomBadges(n,s){const i=n._ffz_room;i&&i.updateBadges(s)}updateRoomBitsConfig(n,s){const i=n._ffz_room;i&&i.updateBitsConfig((0,R.formatBitsConfig)(s))}};G(y,"VideoChatHook");let u=y},29632:(ae,J,d)=>{"use strict";d.d(J,{default:()=>v});var W=d(22527),B=d(46949),R=d(5286),I=d(17159);const f=class f extends I.FFZEvent{constructor(n){super(n),this._changed=!1}markChanged(){return this._changed=!0,this}};G(f,"ApolloEvent");let U=f;const u=class u extends null{constructor(n){super(`${n.message}; Location: ${n.locations}`)}};G(u,"GQLError");let z=u;const y=class y extends W.default{constructor(...n){super(...n),this.modifiers={},this.post_modifiers={},this.inject("..fine")}get gqlPrint(){if(this._gql_print)return this._gql_print;const n=this.resolve("site.web_munch");return this._gql_print=n?.getModule?.("gql-printer")}onEnable(){let n=this.client;if(!n){const _=this.fine.react;if(n=(_&&_.stateNode)?.props?.client,_&&!n){let e=0,a=_;for(;!n?.queryManager&&a&&e++<20;)n=a?.memoizedProps?.client,a=a?.child;if(!n){const p=this.fine.searchTree(null,C=>C.props?.client?.queryManager,500);p&&(n=p.props.client)}}this.client=n}if(!n)return new Promise(()=>this.onEnable(),50);if(!this.client.link||!this.client.queryManager||!this.client.queryManager.link){this.log.error("Apollo does not have a Link. We are unable to manipulate queries.");return}this.hooked_query_init=!1;const s=this,i=this.client.queryManager.constructor.prototype,l=i.getCurrentQueryResult;if(i.getCurrentQueryResult=function(_,o=!0){const e=l.call(this,_,o);if(e&&e.partial)try{try{const a=_.getLastResult(),p=_.options;this.dataStore.getCache().read({query:p.query,variables:p.variables,previousResult:a?a.data:void 0,optimistic:o})}catch(a){if(a.toString().includes("Can't find field")&&_.lastResult&&!_.lastResult.loading&&!_.lastError&&Date.now()-(_._ffz_last_retry||0)>=12e4){const p=(0,B.get)("options.query.definitions.0.name",_),C=p&&p.kind==="Name"?p.value:`#${_.queryId}`;s.log.info("Forcing query to refetch due to missing field:",C),_._ffz_last_retry=Date.now(),_.refetch()}}}catch(a){s.log.capture(a)}return e},this.client.queryManager.queryStore){const _=this.client.queryManager.queryStore.initQuery;this.hooked_query_init=!0,this.client.queryManager.queryStore.initQuery=function(o){const e=this.store[o.queryId];return e&&e.queryString!==o.queryString&&(e.queryString=o.queryString),_.call(this,o)}}const w=this.ApolloLink=this.client.link.constructor;this.link=new w((_,o)=>{if(!this.enabled)return o(_);let e=_.variables;Object.keys(e).length||(e=void 0);try{this.hooked_query_init&&this.apolloPreFlight(_)}catch(a){return this.log.capture(a,{tags:{operation:_.operationName},extra:{variables:e}}),this.log.error("Error running Pre-Flight",a,_),o(_)}return o(_).map(a=>{a.extensions&&a.extensions.operationName===_.operationName&&this.log.crumb({level:"info",category:"gql",message:`${_.operationName} [${a.extensions&&a.extensions.durationMilliseconds||"??"}ms]`,data:{variables:e}});try{this.apolloPostFlight(a)}catch(p){this.log.capture(p,{tags:{operation:_.operationName},extra:{variables:e}}),this.log.error("Error running Post-Flight",p,a)}return a})}),this.old_link=this.client.link,this.old_qm_link=this.client.queryManager.link,this.client.link=w.from([this.link,this.old_link]),this.client.queryManager.link=w.from([this.link,this.old_qm_link])}onDisable(){this.client=this.printer=this._gql_print=this.old_link=this.old_qm_dedup=this.old_qm_link=null}apolloPreFlight(n){const s=n.operationName,i=this.modifiers[s],l=`:request.${s}`,w=this.hasListeners(l);if(!i&&!w)return;const _=this.client.queryManager,o=_&&_.queryIdsByName,e=_&&_.queries,a=o&&o[s],p=Array.isArray(a)?a[0]:a,C=e&&e.get(p);if(i)for(const x of i)typeof x=="function"?x(n):x[1]&&this.applyModifier(n,x[1]);let m=!!i;if(w){const x=new U({operation:s,request:n});this.emit(l,x),x._changed&&(m=!0)}if(m){const x=this.client.queryManager.queryStore.store[p],$=this.gqlPrint&&this.gqlPrint(n.query);x&&($?(x.queryString=$,n.query.loc.source.body=$,n.query.loc.end=$.length,C&&(C.document=n.query,C.observableQuery&&C.observableQuery.options&&(C.observableQuery.options.query=n.query))):(this.log.info("Unable to find GQL Print. Clearing store for query:",s),this.client.queryManager.queryStore.store[p]=null))}}apolloPostFlight(n){if(!n.extensions)return;const s=n.extensions.operationName,i=this.post_modifiers[s];if(i)for(const l of i)l(n);this.emit(`:response.${s}`,n.data)}applyModifier(n,s){n.query=(0,R.default)(n.query,s)}registerModifier(n,s,i=!0){if(typeof s!="function"){if(!i)throw new Error("post modifiers must be functions");s=[s,s]}(i?this.modifiers[n]=this.modifiers[n]||[]:this.post_modifiers[n]=this.post_modifiers[n]||[]).push(s)}unregisterModifier(n,s,i=!0){const l=i?this.modifiers[n]:this.post_modifiers[n];if(l){if(typeof s!="function")throw new Error("graphql modifiers cannot be removed");for(let w=0;w<l.length;w++){const _=l[w];if(typeof _=="function"?_===s:_[0]===s){l.splice(w,1);return}}}}getQuery(n){const s=this.client.queryManager?.queries;if(s)for(const i of s.values()){const l=i?.observableQuery;if(l?.queryName===n)return l}}maybeRefetch(n){const s=this.getQuery(n);!s||!s.lastResult||s.lastResult.stale||s.refetch()}ensureQuery(n,s,i=500,l=12e4){const w=this.getQuery(n);if(w){const _=w.lastResult;let o;_?_.loading?o=!0:typeof s=="function"?o=s(_):o=(0,B.get)(s,_)!==void 0:o=!1,!o&&Date.now()-(w._ffz_last_retry||0)>=l&&(w._ffz_last_retry=Date.now(),w.options.query=Object.assign({},w.options.query),i===0?w.refetch():i>0&&setTimeout(()=>{w.refetch()},i))}return w}getFromQuery(n,s,i=500,l=12e4){const w=this.getQuery(n),_=w&&w.lastResult;if(!w)return;let o;if(!(_&&(typeof s=="function"?o=s(_):o=(0,B.get)(s,_),_.loading)))return o===void 0&&Date.now()-(w._ffz_last_retry||0)>=l&&(w._ffz_last_retry=Date.now(),w.options.query=Object.assign({},w.options.query),i===0?w.refetch():i>0&&setTimeout(()=>w.refetch(),i)),o}};G(y,"Apollo");let v=y},6170:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>f,e:()=>u});var W=d(20857);let B,R,I,U;function z(){return B?Promise.resolve(B):new Promise((y,S)=>{if(I)return I.push([y,S]);I=[[y,S]],Promise.all([d.e(2009).then(d.t.bind(d,19404,23)),d.e(2009).then(d.t.bind(d,43496,23))]).then(n=>{B=n[0]?.default,R=n[1]?.default;const s=I;I=null;for(const i of s)i[0](B)}).catch(n=>{const s=I;I=null;for(const i of s)i[1](n)})})}G(z,"loadMD");function v(y){const S=y.renderer.rules.link_open||this.defaultRender;y.renderer.rules.link_open=function(n,s,i,l,w){const _=n[s];if(_&&_.type==="link_open"&&Array.isArray(_.attrs)){let o;for(const e of _.attrs)if(e[0]==="href"){o=e[1];break}if(o.startsWith("~")){let e;if(o==="~"){let a=s+1,p=[];for(;a<n.length;){const m=n[a],x=m?.type;if(x==="text")p.push(m);else if(x==="link_close")break;a++}p=p.map(m=>m.content).join(""),e=(0,W.Q)(p).map(m=>m.key).join(".")}else e=o.slice(1);if(e&&e.length){for(const a of _.attrs)if(a[0]==="class"){a[1]=a[1].replace(/ffz-tooltip/g,"");break}_.attrs.push(["data-settings-link",e]),_.attrs.push(["onclick",'FrankerFaceZ.get().resolve("main_menu").mdNavigate(this);return false'])}}}return S(n,s,i,l,w)}}G(v,"SettingsLinks"),v.defaultRender=function(y,S,n,s,i){return i.renderToken(y,S,n)};async function f(){if(!U){const y=await z();if(!y)return null;const S=U=new y({html:!1,linkify:!0});S.use(v),S.use(R,{attrs:{class:"ffz-tooltip",target:"_blank",rel:"noopener","data-tooltip-type":"link"}})}return U}G(f,"awaitMD");function u(y){if(U)return U;y&&f().then(S=>y(S))}G(u,"getMD")},83935:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>I});var W=d(22527),B=d(44589),R=d(8528);const U=class U extends W.default{constructor(v,f){super(v,f),this.settings=null,this.inject("settings"),this.color_cache=null,this.name_cache=null}onEnable(){this.settings.provider.on("changed",this.onProviderChange,this)}renderUserEditor(v,f){let u,y,S;const n=G(()=>{const i=u,l=y,w=S;u=y=S=null,i&&i.destroy(),l&&l.destroy(),w&&w.$destroy()},"destroy"),s=document.fullscreenElement??document.body.querySelector("#root>div")??document.body;y=new R.default(s,[],{logger:this.log,manual:!0,live:!1,html:!0,hover_events:!0,no_update:!0,no_auto_remove:!0,tooltipClass:"ffz-action-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"",arrowInner:"",innerClass:"",popper:{placement:"bottom",modifiers:{preventOverflow:{boundariesElement:s},flip:{behavior:["bottom","top","left","right"]}}},content:async(i,l)=>{const w=this.resolve("vue"),_=d.e(8586).then(d.bind(d,54337));if(!w)throw new Error("unable to load vue");const[,o]=await Promise.all([w.enable(),_]);return w.component("override-editor",o.default),S=new w.Vue({el:(0,B.createElement)("div"),render:e=>e("override-editor",{user:v,name:this.getName(v.id),color:this.getColor(v.id),originalName:v.displayName??v.login,originalColor:v.color,updateTip:()=>l.update(),setColor:a=>this.setColor(v.id,a),deleteColor:()=>this.deleteColor(v.id),setName:a=>this.setName(v.id,a),deleteName:()=>this.deleteName(v.id),close:()=>l.hide()})}),S.$el},onShow:async(i,l)=>{await l.waitForDom(),requestAnimationFrame(()=>{l.outer&&(u=new B.ClickOutside(l.outer,n))})},onMove:(i,l,w)=>{this.emit("tooltips:hover",i,l,w)},onLeave:(i,l,w)=>{this.emit("tooltips:leave",i,l,w)},onHide:n}),y._enter(f)}onProviderChange(v){v==="overrides.colors"&&this.color_cache?this.loadColors():v==="overrides.names"&&this.name_cache&&this.loadNames()}get colors(){return this.color_cache??this.loadColors()}get names(){return this.name_cache??this.loadNames()}loadColors(){let v,f=!0;this.color_cache?v=new Set(Object.keys(this.color_cache)):(f=!1,this.color_cache={},v=new Set);const u=this.settings.provider.get("overrides.colors");if(u)for(const[y,S]of Object.entries(u))v.delete(y),this.color_cache[y]!==S&&(this.color_cache[y]=S,f&&this.emit(":changed",y,"color",S));for(const y of v)this.color_cache[y]=void 0,f&&this.emit(":changed",y,"color",void 0);return this.color_cache}loadNames(){let v,f=!0;this.name_cache?v=new Set(Object.keys(this.name_cache)):(f=!1,this.name_cache={},v=new Set);const u=this.settings.provider.get("overrides.names");if(u)for(const[y,S]of Object.entries(u))v.delete(y),this.name_cache[y]!==S&&(this.name_cache[y]=S,f&&this.emit(":changed",y,"name",S));for(const y of v)this.name_cache[y]=void 0,f&&this.emit(":changed",y,"name",void 0);return this.name_cache}getColor(v){return this.colors[v]??null}getName(v){return this.names[v]??null}setColor(v,f){this.colors[v]!==f&&(this.colors[v]=f,this.settings.provider.set("overrides.colors",this.colors),this.emit(":changed",v,"color",f))}setName(v,f){this.names[v]!==f&&(this.names[v]=f,this.settings.provider.set("overrides.names",this.names),this.emit(":changed",v,"name",f))}deleteColor(v){this.setColor(v,void 0)}deleteName(v){this.setName(v,void 0)}};G(U,"Overrides");let I=U},22231:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>B});var W=d(46949);const R=class R{constructor(U,z,v,f){this.destroyed=!1,this._login=null,this.manager=U,this.room=z,this.emote_sets=null,this.badges=null,this._id=v,this.login=f,v&&((z??U).user_ids[v]=this)}destroy(){if(this.destroyed=!0,this.emote_sets){for(const z of this.emote_sets._cache)this.manager.emotes.unrefSet(z);this.emote_sets=null}this.badges&&(this.badges=null);const U=this.room||this.manager;U&&(this._login&&U.users&&U.users[this._login]===this&&(U.users[this._login]=null),U.user_ids&&U.user_ids[this._id]===this&&(U.user_ids[this._id]=null))}merge(U){if(!this.login&&U.login&&(this.login=U.login),U.emote_sets)for(const[z,v]of U.emote_sets.iterateSources())for(const f of v)this.addSet(z,f);if(U.badges)for(const[z,v]of U.badges.iterateSources())for(const f of v)this.addBadge(z,f.id,f)}_unloadAddon(U){return 0}get id(){return this._id}get login(){return this._login}set login(U){if(this._login===U)return;const z=this.room||this.manager;if(this._login&&z.users[this._login]===this&&(z.users[this._login]=null),this._login=U,!U)return;const v=z.users[U];v&&v!==this&&(v.login=null),this._login=U,z.users[U]=this}addBadge(U,z,v){if(this.destroyed)return!1;typeof z=="number"&&(z=`${z}`),v?v.id=z:v={id:z},this.badges||(this.badges=new W.SourcedSet(!1,this.manager.emotes.sourceSortFn));const f=this.badges.get(U);if(f){for(const u of f)if(u.id==z)return Object.assign(u,v),!1}return this.badges.push(U,v),!0}getBadges(){return this.badges?[...this.badges._cache]:[]}getBadge(U){if(this.badges){for(const z of this.badges._cache)if(z.id==U)return z}return null}removeBadge(U,z){if(!this.badges)return!1;const v=this.badges.get(U);if(v){for(const f of v)if(f.id==z)return this.badges.remove(U,f),!0}return!1}removeAllBadges(U){return!this.badges||!this.badges.has(U)?!1:(this.badges.delete(U),!0)}addSet(U,z,v){if(this.destroyed)return;this.emote_sets||(this.emote_sets=new W.SourcedSet),typeof z=="number"&&(z=`${z}`);let f=!1,u=!1;return this.emote_sets.sourceIncludes(U,z)||(f=!this.emote_sets.includes(z),this.emote_sets.push(U,z),u=!0),v&&this.manager.emotes.loadSetData(z,v),f&&(this.manager.emotes.refSet(z),this.manager.emotes.emit(":update-user-sets",this,U,z,!0)),u}removeAllSets(U){if(!this.emote_sets)return!1;const z=this.emote_sets.get(U);if(!Array.isArray(z)||!z.length)return!1;for(const v of z)this.removeSet(U,v);return!0}removeSet(U,z){if(this.emote_sets)return typeof z=="number"&&(z=`${z}`),this.emote_sets.sourceIncludes(U,z)?(this.emote_sets.remove(U,z),this.emote_sets.includes(z)||(this.manager.emotes.unrefSet(z),this.manager.emotes.emit(":update-user-sets",this,U,z,!1)),!0):!1}};G(R,"User");let B=R},89817:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>f});var W=d(24431),B=d(44589),R=d(46949),I=d(22527),U=d(83269),z=d(8528);const v=/^https:\/\/[^/]+\.(?:twitch\.tv|twitchcdn\.net)\/.+?\.mp4(?:\?.*)?$/,u=class u extends I.default{constructor(S,n){super(S,n),this.settings=null,this.i18n=null,this.tooltips=null,this.inject("settings"),this.inject("i18n"),this.inject("tooltips"),this.should_enable=!0,this.definitions={},this.settings.add("metadata.clip-download",{default:!0,ui:{path:"Channel > Metadata >> Clips",title:"Add a Download button for editors to clip pages.",description:"This adds a download button beneath the player on clip pages (the main site, not on `clips.twitch.tv`) for broadcasters and their editors.",component:"setting-check-box"},changed:()=>this.updateMetadata("clip-download")}),this.settings.add("metadata.player-stats",{default:!1,ui:{path:"Channel > Metadata >> Player",title:"Playback Statistics",description:"Show the current stream delay, with playback rate and dropped frames in the tooltip.",component:"setting-check-box",getExtraTerms:()=>["latency","bitrate"]},changed:()=>this.updateMetadata("player-stats")}),this.settings.add("metadata.stream-delay-warning",{default:0,ui:{path:"Channel > Metadata >> Player",title:"Stream Delay Warning",description:"When the current stream delay exceeds this number of seconds, display the stream delay in a warning color to draw attention to the large delay. Set to zero to disable.",component:"setting-text-box",process:"to_float",bounds:[0,!0]}}),this.settings.add("metadata.uptime",{default:2,ui:{path:"Channel > Metadata >> Player",title:"Stream Uptime",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enabled (with Seconds)"}]},changed:()=>this.updateMetadata("uptime")}),this.settings.add("metadata.viewers",{default:!1,ui:{path:"Channel > Metadata >> Player",title:"Alternative Viewer Count",description:"This displays the current channel's viewer count without an animation when it changes.",component:"setting-check-box"},changed:()=>this.updateMetadata("viewers")}),this.define("viewers",{refresh(){return this.settings.get("metadata.viewers")},setup(s){return{live:s.channel?.live&&s.channel?.live_since!=null,count:s.getViewerCount()}},order:1,icon:"ffz-i-viewers",label(s){return!this.settings.get("metadata.viewers")||!s.live?null:this.i18n.formatNumber(s.count)},tooltip(){return this.i18n.t("metadata.viewers","Viewer Count")},color:"var(--color-text-live)"}),this.define("uptime",{inherit:!0,no_arrow:!0,player:!0,refresh(){return this.settings.get("metadata.uptime")>0},setup(s){let i=s?.channel?.live_since;if(!i)return null;i instanceof Date||(i=new Date(i));const l=this.resolve("socket"),w=Date.now()-(l?._time_drift??0);return{created:i,uptime:i?Math.floor((w-i.getTime())/1e3):-1,getBroadcastID:s.getBroadcastID}},order:2,icon:"ffz-i-clock",label(s){const i=this.settings.get("metadata.uptime");return!i||!s?.created?null:(0,U.duration_to_string)(s.uptime,!1,!1,!1,i!==2)},tooltip(s){return s?.created?[this.i18n.t("metadata.uptime.tooltip","Stream Uptime"),(0,B.createElement)("div",{class:"tw-pd-t-05"},this.i18n.t("metadata.uptime.since","(since {since,datetime})",{since:s.created}))]:null},async popup(s,i){if(!s)return;const[l,w]=await Promise.all([navigator?.permissions?.query?.({name:"clipboard-write"}).then(a=>a?.state).catch(()=>null),s.getBroadcastID()?.catch(a=>null)]);if(!w)return(0,B.createElement)("div",null,this.i18n.t("metadata.uptime-no-id","Sorry, we couldn't find an archived video for the current broadcast."));const _=`https://www.twitch.tv/videos/${w}${s.uptime>0?`?t=${(0,U.durationForURL)(s.uptime)}`:""}`,o=l==="granted"||l==="prompt",e=o?a=>(navigator.clipboard.writeText(_),a.preventDefault(),!1):null;return i.element?.classList.add("ffz-balloon--lg"),(0,B.createElement)("div",null,(0,B.createElement)("div",{class:"tw-pd-b-1 tw-mg-b-1 tw-border-b tw-semibold"},this.i18n.t("metadata.uptime.link-to","Link to {time}",{time:(0,U.duration_to_string)(s.uptime,!1,!1,!1,!1)})),(0,B.createElement)("div",{class:"tw-flex tw-align-items-center"},(0,B.createElement)("input",{class:"tw-border-radius-medium tw-font-size-6 tw-pd-x-1 tw-pd-y-05 ffz-input tw-full-width",type:"text",value:_,onFocus:a=>a.target?.select()}),o&&(0,B.createElement)("div",{class:"tw-relative ffz-il-tooltip__container tw-mg-l-1"},(0,B.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative","aria-label":this.i18n.t("metadata.uptime.copy","Copy to Clipboard"),onClick:e},(0,B.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,B.createElement)("span",{class:"tw-button-icon__icon"},(0,B.createElement)("figure",{class:"ffz-i-docs"})))),(0,B.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up"},this.i18n.t("metadata.uptime.copy","Copy to Clipboard")))))}}),this.define("clip-download",{button:!0,inherit:!0,setup(s){if(!this.settings.get("metadata.clip-download"))return;const i=this.resolve("site.player"),l=i.current;if(!l)return;const w=l.mediaSinkManager||l.core?.mediaSinkManager,_=w?.video?.src;if(!_||!v.test(_))return;if(this.settings.get("metadata.clip-download.force")||this.resolve("site").getUser?.()?.id==s.channel.id||s.getUserSelfImmediate(s.refresh)?.isEditor)return _},label(s){if(s)return this.i18n.t("metadata.clip-download","Download")},icon:"ffz-i-download",click(s){const l=(this.settings.get("context.title")||"Untitled").replace(/[\\/:"*?<>|]+/,"_")+".mp4",w=(0,B.createElement)("a",{target:"_blank",download:l,href:s,style:{display:"none"}});document.body.appendChild(w),w.click(),w.remove()}}),this.define("player-stats",{button:!0,inherit:!0,modview:!0,player:!0,refresh(){return this.settings.get("metadata.player-stats")},setup(s){const i=this.resolve("site.player"),l=this.resolve("socket"),w=i.current;let _;if(!w)_=null;else if(typeof w.getPlaybackStats=="function")_=w.getPlaybackStats();else if(typeof w.getVideoInfo=="function"){const a=w.getVideoInfo();_={backendVersion:(0,R.maybe_call)(w.getVersion,w),bufferSize:a.video_buffer_size,displayResolution:`${a.vid_display_width}x${a.vid_display_height}`,fps:a.current_fps,hlsLatencyBroadcaster:a.hls_latency_broadcaster/1e3,hlsLatencyEncoder:a.hls_latency_encoder/1e3,memoryUsage:`${a.totalMemoryNumber} MB`,rate:(0,R.maybe_call)(w.getPlaybackRate,w)||1,playbackRate:a.current_bitrate,skippedFrames:a.dropped_frames,videoResolution:`${a.vid_width}x${a.vid_height}`}}else{const a=(0,R.maybe_call)(w.getVideoHeight,w)||0,p=(0,R.maybe_call)(w.getVideoWidth,w)||0,C=(0,R.maybe_call)(w.getDisplayHeight,w)||0,m=(0,R.maybe_call)(w.getDisplayWidth,w)||0;_={backendVersion:(0,R.maybe_call)(w.getVersion,w),bufferSize:(0,R.maybe_call)(w.getBufferDuration,w),displayResolution:`${m}x${C}`,videoResolution:`${p}x${a}`,videoHeight:a,videoWidth:p,displayHeight:C,displayWidth:m,rate:(0,R.maybe_call)(w.getPlaybackRate,w),fps:Math.floor((0,R.maybe_call)(w.getVideoFrameRate,w)||0),hlsLatencyBroadcaster:(0,R.maybe_call)(w.getLiveLatency,w)||0,playbackRate:Math.floor(((0,R.maybe_call)(w.getVideoBitRate,w)||0)/1e3),skippedFrames:(0,R.maybe_call)(w.getDroppedFrames,w)}}if(_){const a=w&&(0,R.maybe_call)(w.getHTMLVideoElement,w);_.avOffset=0,a?._ffz_context&&(_.avOffset=(a._ffz_context_offset??0)+a._ffz_context.currentTime-a.currentTime)}let o=!1;try{const a=w.core.state.path;if(a.includes("/api/channel/hls/")){const p=JSON.parse(new URL(a).searchParams.get("token"));o=p&&p.player_type&&p.player_type!=="site"?p.player_type:!1}}catch{}if(!_||_.hlsLatencyBroadcaster<-100)return null;let e=0;return l&&l.connected&&(e=l._time_drift),{is_player:s.is_player,stats:_,drift:e,rate:_.rate==null?1:_.rate,delay:_.hlsLatencyBroadcaster,old:_.hlsLatencyBroadcaster>180,tampered:o}},order:3,icon(s){return s?.rate>1?"ffz-i-fast-fw":"ffz-i-gauge"},label(s){if(!this.settings.get("metadata.player-stats")||!s?.delay||s.old)return null;const i=s.drift>5e3?"(!) ":"";return s.old?`${i}${s.delay.toFixed(2)}s old`:`${i}${s.delay.toFixed(2)}s`},click(){const s=this.resolve("site.player"),i=this.resolve("site.fine"),l=s.Player?.first,w=i&&l&&i.searchTree(l,e=>e.props?.setStatsOverlay,200),_=w&&i.getChildNode(l),o=_&&_.querySelector('[data-a-target="player-overlay-video-stats"]');w&&w.props.setStatsOverlay(o?0:1)},color(s){const i=this.settings.get("metadata.stream-delay-warning");if(!(i===0||!s?.delay||s.old)){if(s.delay>i*2)return s.is_player?"#f9b6b6":"#ec1313";if(s.delay>i)return s.is_player?"#fcb896":"#fc7835"}},tooltip(s){if(!s)return null;const i=s.tampered?(0,B.createElement)("div",{class:"tw-border-t tw-mg-t-05 tw-pd-t-05"},this.i18n.t("metadata.player-stats.tampered","Your player has an unexpected player type ({type}), which may affect your viewing experience.",{type:s.tampered})):null,l=s.drift>5e3?(0,B.createElement)("div",{class:"tw-border-b tw-mg-b-05 tw-pd-b-05"},this.i18n.t("metadata.player-stats.delay-warning","Your local clock seems to be off by roughly {count,number} seconds, which could make this inaccurate.",Math.round(s.drift/10)/100)):null,w=s.rate>1?(0,B.createElement)("div",{class:"tw-border-b tw-mg-b-05 tw-pd-b-05"},this.i18n.t("metadata.player-stats.rate-warning","Playing at {rate,number}x speed to reduce delay.",{rate:s.rate.toFixed(2)})):null;if(!s.stats||!s.delay)return[l,w,this.i18n.t("metadata.player-stats.latency-tip","Stream Latency"),i];const _=s.stats,o=this.i18n.t("metadata.player-stats.video-info",`Video: {videoResolution}p{fps}
Playback Rate: {playbackRate, number} Kbps
Dropped Frames: {skippedFrames, number}`,_),e=null,a=_.bufferSize>0?(0,B.createElement)("div",null,this.i18n.t("metadata.player-stats.buffered","Buffered: {buffered} seconds",{buffered:_.bufferSize.toFixed(2)})):null;return s.old?[l,this.i18n.t("metadata.player-stats.video-tip","Video Information"),(0,B.createElement)("div",{class:"tw-pd-t-05"},this.i18n.t("metadata.player-stats.broadcast-ago","Broadcast {count,number}s Ago",s.delay)),(0,B.createElement)("div",{class:"tw-pd-t-05"},o),e,a,i]:[l,w,this.i18n.t("metadata.player-stats.latency-tip","Stream Latency"),(0,B.createElement)("div",{class:"tw-pd-t-05"},o),e,a,i]}})}getAddonProxy(S,n,s){if(!S)return this;const i={},l=W.DEBUG||n?.dev;return i.define=(w,_)=>(_&&(_.__source=S),this.define(w,_)),(0,I.buildAddonProxy)(s,this,"metadata",i)}onEnable(){const S=this.tooltips.types.metadata=n=>{let s=n;if(s._ffz_stat?s=s._ffz_stat:s.classList.contains("ffz-stat")||(s=n.closest(".ffz-stat"),n._ffz_stat=s),!s)return;const i=s.dataset.key,l=i?.length?this.definitions[i]:null;return(0,R.maybe_call)(l?.tooltip,this,s._ffz_data)};S.onShow=(n,s)=>{const i=n._ffz_stat||n;i.tip=s},S.onHide=n=>{const s=n._ffz_stat||n;s.tip=null,s.tip_content=null},S.popperConfig=(n,s,i)=>(i.placement="bottom",i.modifiers.flip={behavior:["bottom","top"]},i),this.on("addon:fully-unload",n=>{const s=new Set;for(const[i,l]of Object.entries(this.definitions))l?.__source===n&&(s.add(i),this.definitions[i]=void 0);s.size&&(this.log.debug(`Cleaned up ${s.size} entries when unloading addon:`,n),this.updateMetadata([...s]))})}get keys(){return Object.keys(this.definitions)}define(S,n){this.definitions[S]=n,this.updateMetadata(S)}updateMetadata(S){const n=this.resolve("site.channel");if(n)for(const i of n.InfoBar.instances)n.updateMetadata(i,S);const s=this.resolve("site.player");if(s)for(const i of s.Player.instances)s.updateMetadata(i,S)}async renderLegacy(S,n,s,i,l){i[S]&&clearTimeout(i[S]);let w=s.querySelector(`.ffz-stat[data-key="${S}"]`);const _=this.definitions[S],o=G(()=>{w&&(w._ffz_destroy&&w._ffz_destroy(),w._ffz_destroy=null,w.remove())},"destroy");if(!_)return o();try{const e=G(()=>l(S),"ref_fn");n={...n,is_player:!1,refresh:e},_.setup&&(n=await _.setup.call(this,n));const a=(0,R.maybe_call)(_.refresh,this,n);a&&(i[S]=setTimeout(e,typeof a=="number"?a:1e3)),w=s.querySelector(`.ffz-stat[data-key="${S}"]`);let p,C,m;const x=(0,R.maybe_call)(_.label,this,n);if(!x)return o();const $=(0,R.maybe_call)(_.order,this,n),r=(0,R.maybe_call)(_.color,this,n)||"";if(w){if(p=w.querySelector(".ffz-stat-text"),!p)return o();if(m=w.dataset.icon||"",C=w.dataset.color||"",w._ffz_order!==$&&(w.style.order=`${w._ffz_order=$}`),w.tip){const c=(0,R.maybe_call)(_.tooltip,this,n);w.tip_content!==c&&(w.tip_content=c,w.tip?.element&&(w.tip.element.innerHTML="",(0,B.setChildren)(w.tip.element,c)))}}else{let c=m=(0,R.maybe_call)(_.icon,this,n),b=!1;if(_.button!==!1&&(_.popup||_.click)){b=!0;let k,h;const M=(0,R.maybe_call)(_.border,this,n),L=(0,R.maybe_call)(_.inherit,this,n);typeof c=="string"&&(c=(0,B.createElement)("span",{class:"tw-mg-r-05"},(0,B.createElement)("figure",{class:c}))),_.popup&&_.click?w=(0,B.createElement)("div",{class:`tw-align-items-center tw-inline-flex tw-relative ffz-il-tooltip__container ffz-stat tw-stat ffz-stat--fix-padding ${M?"tw-mg-r-1":"tw-mg-r-05 ffz-mg-l--05"}`,"data-key":S,tip_content:null},k=(0,B.createElement)("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-top-left-radius-medium ffz-core-button ffz-core-button--padded ffz-core-button--text ${L?"ffz-c-text-inherit":"tw-c-text-base"} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative ${M?"tw-border-l tw-border-t tw-border-b":"tw-font-size-5 tw-regular"}${_.tooltip?" ffz-tooltip ffz-tooltip--no-mouse":""}`,"data-tooltip-type":"metadata"},(0,B.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center tw-pd-x-1"},c,p=(0,B.createElement)("span",{class:"ffz-stat-text"}))),h=(0,B.createElement)("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-right-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--text ${L?"ffz-c-text-inherit":"tw-c-text-base"} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative ${M?"tw-border":"tw-font-size-5 tw-regular"}${_.tooltip?" ffz-tooltip ffz-tooltip--no-mouse":""}`,"data-tooltip-type":"metadata"},(0,B.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center"},(0,B.createElement)("span",null,(0,B.createElement)("figure",{class:"ffz-i-down-dir"}))))):k=h=w=(0,B.createElement)("button",{class:`ffz-stat tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-top-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--text ${L?"ffz-c-text-inherit":"tw-c-text-base"} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative tw-pd-x-05 ffz-stat--fix-padding ${M?"tw-border tw-mg-r-1":"tw-font-size-5 tw-regular tw-mg-r-05 ffz-mg-l--05"}${_.tooltip?" ffz-tooltip ffz-tooltip--no-mouse":""}`,"data-tooltip-type":"metadata","data-key":S,tip_content:null},(0,B.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center"},c,p=(0,B.createElement)("span",{class:"ffz-stat-text"}),_.popup&&!_.no_arrow&&(0,B.createElement)("span",{class:"tw-mg-l-05"},(0,B.createElement)("figure",{class:"ffz-i-down-dir"})))),_.click&&k.addEventListener("click",T=>!w||!k||k.disabled||k.classList.contains("disabled")||w.disabled||w.classList.contains("disabled")?!1:_.click?.call?.(this,w._ffz_data,T,()=>{l(S)})),_.popup&&h.addEventListener("click",()=>{if(!w||!h||h.disabled||h.classList.contains("disabled")||w.disabled||w.classList.contains("disabled"))return!1;if(w._ffz_popup&&w._ffz_destroy)return w._ffz_destroy();const T=[],O=G(q=>{T.push(q)},"add_close_listener"),P=w._ffz_destroy=()=>{for(const q of T)try{q()}catch(X){X instanceof Error&&this.log.capture(X,{tags:{metadata:S}}),this.log.error("Error when running a callback for pop-up destruction for metadata:",S,X)}if(w){if(w._ffz_outside&&w._ffz_outside.destroy(),w._ffz_popup){const q=w._ffz_popup;w._ffz_popup=null,q.destroy()}w._ffz_destroy=w._ffz_outside=null}},j=document.fullscreenElement||document.body.querySelector("#root>div")||document.body;(w._ffz_popup=new z.default(j,w,{logger:this.log,i18n:this.i18n,manual:!0,live:!1,html:!0,tooltipClass:"ffz-metadata-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"ffz-balloon__tail tw-overflow-hidden tw-absolute",arrowInner:"ffz-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base tw-absolute",innerClass:"tw-pd-1",popper:{placement:"top-end",modifiers:{preventOverflow:{boundariesElement:j},flip:{behavior:["top","bottom","left","right"]}}},content:(q,X)=>_.popup?.call(this,w?._ffz_data,X,()=>l(S),O),onShow:(q,X)=>setTimeout(()=>{w&&X.outer&&(w._ffz_outside=new B.ClickOutside(X.outer,P))}),onHide:P}))._enter(w)})}else typeof c=="string"&&(c=(0,B.createElement)("span",{class:"tw-stat__icon"},(0,B.createElement)("figure",{class:c}))),w=(0,B.createElement)("div",{class:`tw-align-items-center tw-inline-flex tw-relative ffz-il-tooltip__container ffz-stat tw-stat tw-mg-r-1${_.tooltip?" ffz-tooltip ffz-tooltip--no-mouse":""}`,"data-tooltip-type":"metadata","data-key":S,tip_content:null},c,p=(0,B.createElement)("span",{class:`${c?"tw-mg-l-05 ":""}ffz-stat-text tw-stat__value`})),_.click&&w.addEventListener("click",k=>{if(!w||w.disabled||w.classList.contains("disabled"))return!1;_.click?.call?.(this,w._ffz_data,k,()=>l(S))});w._ffz_order=$,$!=null&&(w.style.order=`${$}`),s.appendChild(w)}if(typeof _.icon=="function"){const c=(0,R.maybe_call)(_.icon,this,n);if(typeof c=="string"&&c!==m){w.dataset.icon=c;const b=w.querySelector("figure");b&&(b.className=c)}}C!==r&&(w.dataset.color=r,w.style.setProperty("color",r,"important")),w._ffz_data=n,p.innerHTML="",(0,B.setChildren)(p,x),_.disabled!==void 0&&(w.disabled=(0,R.maybe_call)(_.disabled,this,n))}catch(e){return e instanceof Error&&this.log.capture(e,{tags:{metadata:S}}),this.log.error(`Error rendering metadata for ${S}`,e),o()}}};G(u,"Metadata");let f=u},45655:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>v});var W=d(44589),B=d(46949),R=d(8528),I=d(22527),U=d(6170),z=d(24431);const f=class f extends I.default{constructor(y,S){super(y,S),this.i18n=null,this.types={},this.inject("i18n"),this.should_enable=!0,this.types.json=n=>{const s=n.dataset.title;return[s&&(0,W.createElement)("strong",null,s),(0,W.createElement)("code",{className:`block${s?" pd-t-05 border-t mg-t-05":""}`,style:{fontFamily:"monospace",textAlign:"left"}},n.dataset.data)]},this.types.child=n=>{const s=n.querySelector(":scope > .ffz-tooltip-child");return s?(n._ffz_child=s,s.remove(),s.classList.remove("ffz-tooltip-child"),s):null},this.types.child.onHide=n=>{const s=n._ffz_child;s&&(n._ffz_child=null,s.remove(),n.querySelector(":scope > .ffz-tooltip-child")||(s.classList.add("ffz-tooltip-child"),n.appendChild(s)))},this.types.markdown=(n,s)=>{s.add_class="ffz-tooltip--markdown";const i=(0,U.e)();return i?i.render(n.dataset.title):(0,U.Z)().then(l=>l.render(n.dataset.title))},this.types.text=n=>(0,W.sanitize)(n.dataset.title??""),this.types.html=n=>n.dataset.title,this.onFSChange=this.onFSChange.bind(this)}getAddonProxy(y,S,n){if(!y)return this;const s={},i=z.DEBUG||S?.dev;let l;return s.define=(w,_)=>(_&&(_.__source=y),this.define(w,_)),i&&(s.cleanup=()=>(n.log.warn('[DEV-CHECK] Instead of calling tooltips.cleanup(), you can emit the event "tooltips:cleanup"'),this.cleanup()),l={types:"Please use tooltips.define()"}),(0,I.buildAddonProxy)(n,this,"tooltips",s,l)}onEnable(){const y=this.getRoot();window.addEventListener("fullscreenchange",this.onFSChange),this.container=y,this.tip_element=y,this.tips=this._createInstance(y),this.on(":cleanup",this.cleanup),this.on("addon:fully-unload",S=>{let n=0;for(const[s,i]of Object.entries(this.types))i?.__source===S&&(n++,this.types[s]=void 0);n&&(this.log.debug(`Cleaned up ${n} entries when unloading addon:`,S),this.cleanup())})}define(y,S){this.types[y]=S}getRoot(){return document.querySelector(".sunlight-root")||document.querySelector("#root")||document.querySelector(".clips-root")||document.body}_createInstance(y,S="ffz-tooltip",n="text",s){return new R.default(y,S,{html:!0,i18n:this.i18n,live:!0,check_modifiers:!0,container:s||y,delayHide:this.checkDelayHide.bind(this,n),delayShow:this.checkDelayShow.bind(this,n),content:this.process.bind(this,n),interactive:this.checkInteractive.bind(this,n),hover_events:this.checkHoverEvents.bind(this,n),onShow:this.delegateOnShow.bind(this,n),onHide:this.delegateOnHide.bind(this,n),popperConfig:this.delegatePopperConfig.bind(this,n),popper:{placement:"top",modifiers:{flip:{}}},onHover:(i,l,w)=>{this.emit(":hover",i,l,w)},onLeave:(i,l,w)=>{this.emit(":leave",i,l,w)}})}onFSChange(){this.container||(this.container=this.getRoot());let y=this.container;document.fullscreenElement instanceof HTMLElement&&(y=document.fullscreenElement),y!==this.tip_element&&(this.tip_element=y,this.tips&&(this.tips.destroy(),this.tips=this._createInstance(y)))}cleanup(){this.tips&&this.tips.cleanup()}delegatePopperConfig(y,S,n,s){const i=S.dataset.tooltipType||y,l=this.types[i];return S.dataset.tooltipSide&&(s.placement=S.dataset.tooltipSide),l&&l.popperConfig?l.popperConfig(S,n,s):s}delegateOnShow(y,S,n){const s=S.dataset.tooltipType||y,i=this.types[s];i&&i.onShow&&i.onShow(S,n)}delegateOnHide(y,S,n){const s=S.dataset.tooltipType||y,i=this.types[s];i&&i.onHide&&i.onHide(S,n)}checkDelayShow(y,S,n){const s=S.dataset.tooltipType||y,i=this.types[s];return i?.delayShow!=null?(0,B.maybe_call)(i.delayShow,null,S,n):0}checkDelayHide(y,S,n){const s=S.dataset.tooltipType||y,i=this.types[s];return i?.delayHide!=null?(0,B.maybe_call)(i.delayHide,null,S,n):0}checkInteractive(y,S,n){const s=S.dataset.tooltipType||y,i=this.types[s];return i?.interactive!=null?(0,B.maybe_call)(i.interactive,null,S,n):!1}checkHoverEvents(y,S,n){const s=S.dataset.tooltipType||y,i=this.types[s];return i?.hover_events!=null?(0,B.maybe_call)(i.hover_events,null,S,n):!1}process(y,S,n){const s=S.dataset.tooltipType||y||"text",i=S.dataset.tooltipAlign,l=this.types[s];return i&&(n.align=i),l?l(S,n):[(0,W.createElement)("strong",null,"Unhandled Tooltip Type"),(0,W.createElement)("code",{className:"tw-block pd-t-05 border-t mg-t-05",style:{fontFamily:"monospace",textAlign:"left"}},JSON.stringify(S.dataset,null,4))]}};G(f,"TooltipProvider");let v=f},30020:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{Everything:()=>v,Experiments:()=>B,FavoriteEmotes:()=>I,HiddenEmotes:()=>R,Overrides:()=>U,Profiles:()=>z});var W=d(76393);const B={label:"Experiment Overrides",keys:["exp-lock","experiment-overrides"]},R={label:"Hidden Emotes",keys(f){const u=["emote-menu.hidden-sets"];for(const y of f.keys())y.startsWith("hidden-emotes.")&&u.push(y);return u}},I={label:"Favorited Emotes",keys(f){const u=[];for(const y of f.keys())y.startsWith("favorite-emotes.")&&u.push(y);return u}},U={label:"Name and Color Overrides",keys:["overrides.colors","overrides.names"]},z={label:"Profiles",clear(f,u){const y=["profiles"];for(const S of f.keys())/^p:\d+:/.test(S)&&y.push(S);for(const S of y)f.delete(S);u.loadProfiles()}},v={label:"Absolutely Everything",async clear(f,u){f.clear(),f.supportsBlobs&&f instanceof W.i9&&await f.clearBlobs(),u.loadProfiles()}}},47458:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>U});var W=d(17159),B=d(46949),R=d(39602);function I(v,f,u){if(!v||!Array.isArray(v.requires))return!1;for(const y of v.requires){const S=u.get(y),n=f.get(y);if(typeof S!=typeof n)return!0;if(Array.isArray(S)&&Array.isArray(n)){if(!(0,B.array_equals)(n,S))return!0}else if(n instanceof Set&&S instanceof Set){if(!(0,B.set_equals)(n,S))return!0}else if(n instanceof Map&&S instanceof Map){if(!(0,B.map_equals)(n,S))return!0}else if(n!==S)return!0}return!1}G(I,"compare_requirements");const z=class z extends W.EventEmitter{constructor(f,u){super(),this.__context=null,f instanceof z?(this.parent=f,this.manager=f.manager,this.parent.on("context_changed",this._rebuildContext,this)):(this.parent=null,this.manager=f),this.manager.__contexts.push(this),this._context=u||{},this.__ls_listening=!1,this.__ls_wanted=new Map,this.__cache=new Map,this.__meta=new Map,this.__profiles=[],this.order=[],this._rebuildContext()}destroy(){this.parent&&this.parent.off("context_changed",this._rebuildContext,this);for(const y of this.__profiles)y.off("changed",this._onChanged,this);const f=this.manager.__contexts,u=f.indexOf(this);u!==-1&&f.splice(u,1)}_watchLS(){this.__ls_listening||(this.__ls_listening=!0,this.manager.on(":ls-update",this._onLSUpdate,this))}_unwatchLS(){this.__ls_listening&&(this.__ls_listening=!1,this.manager.off(":ls-update",this._onLSUpdate,this))}_onLSUpdate(f){const u=this.__ls_wanted.get(`ls.${f}`);if(u)for(const y of u)this._update(y,y,[])}_rebuildContext(){this.__context=this.parent?Object.assign({},this.parent.__context||this.parent._context,this._context):this._context,this.selectProfiles()||this.rebuildCache(),this.emit("context_changed")}selectProfiles(){const f=[],u=this.order=[];if(!this.manager.disable_profiles)for(const S of this.manager.__profiles)S.toggled&&S.matches(this.__context)&&(f.push(S),u.push(S.id));if((0,B.array_equals)(this.__profiles,f))return!1;const y=new Set;for(const S of this.__profiles)f.includes(S)||(S.off("changed",this._onChanged,this),y.add(S.id));for(const S of f)this.__profiles.includes(S)||(S.on("changed",this._onChanged,this),y.add(S.id));return this.__profiles=f,this.emit("profiles_changed"),this.rebuildCache(),!0}rebuildCache(){const f=this.__cache,u=this.__meta,y=this.__meta=new Map;this.__cache=new Map;for(const[S,n]of f){const s=this.get(S),i=y.get(S),l=u.get(S),w=i?i.uses:null,_=l?l.uses:null,o=this.manager.definitions.get(S);let e=!1;!Array.isArray(o)&&o?.equals?o.equals==="requirements"?e=I(o,this.__cache,f):typeof o.equals=="function"&&(e=!o.equals(s,n,this.__cache,f)):Array.isArray(s)&&Array.isArray(n)?e=!(0,B.array_equals)(s,n):s instanceof Set&&n instanceof Set?e=!(0,B.set_equals)(s,n):s instanceof Map&&n instanceof Map?e=!(0,B.map_equals)(s,n):s!==n&&(e=!0),e&&(this.emit("changed",S,s,n),this.emit(`changed:${S}`,s,n)),(0,B.array_equals)(w,_)||(this.emit("uses_changed",S,w,_),this.emit(`uses_changed:${S}`,w,_))}}context(f){return new z(this,f)}updateContext(f){let u=!1;for(const y in f)if((0,B.has)(f,y)){const S=f[y];try{if((0,B.deep_equals)(S,this._context[y]))continue}catch{}this._context[y]=S,u=!0}u&&this._rebuildContext()}setContext(f){this._context={},this.updateContext(f)}_onChanged(f){this._update(f,f,[])}_update(f,u,y){if(this.__cache.has(f)){if(y.includes(f))throw new Error(`cyclic dependent chain when updating setting "${u}"`)}else return;y.push(f);const S=this.__cache.get(f),n=this.__meta.get(f),s=this._get(f,f,[]),i=this.__meta.get(f),l=n?n.uses:null,w=i?i.uses:null;if((0,B.array_equals)(w,l)||(this.emit("uses_changed",f,w,l),this.emit(`uses_changed:${f}`,w,l)),S===s)return;this.emit("changed",f,s,S),this.emit(`changed:${f}`,s,S);const _=this.manager.definitions.get(f);if(!Array.isArray(_)&&_?.required_by)for(const o of _.required_by)!o.startsWith("context.")&&!o.startsWith("ls.")&&this._update(o,u,Array.from(y))}_get(f,u,y){if(y.includes(f))throw new Error(`cyclic dependency when resolving setting "${u}"`);y.push(f);const S=this.manager.definitions.get(f),n=!Array.isArray(S)&&S?.type,s=n?R.ZP[n]:R.ZP.basic;if(!s)throw new Error(`non-existent setting type "${n}"`);const i=this._getRaw(f,s),l={uses:i?i[1]:null};let w=i?i[0]:void 0;if(S){if(Array.isArray(S))throw new Error(`non-existent setting "${f}" required when resolving setting "${u}"`);if(l.uses===null){const _=S.default;typeof _=="function"?w=_(this):w=_,s.default&&(w=s.default(w,S,this.manager.log))}if(S.requires)for(const _ of S.requires)if(_.startsWith("ls.")){this._watchLS();let o=this.__ls_wanted.get(_);o||this.__ls_wanted.set(_,o=new Set),o.add(f)}else!_.startsWith("context.")&&!this.__cache.has(_)&&this._get(_,u,Array.from(y));S.process&&(w=S.process(this,w,l))}return this.__cache.set(f,w),this.__meta.set(f,l),w}*profiles(){for(const f of this.__profiles)yield f}hasProfile(f){if(typeof f=="number"){for(const u of this.__profiles)if(u.id===f)return!0;return!1}return this.__profiles.includes(f)}_getRaw(f,u){if(!u)throw new Error(`non-existent type for ${f}`);return u.get(f,this.profiles(),this.manager.definitions.get(f),this.manager.log,this)}update(f){this._update(f,f,[])}get(f){return f.startsWith("ls.")?this.manager.getLS(f.slice(3)):f.startsWith("context.")?(0,B.get)(f.slice(8),this.__context):this.__cache.has(f)?this.__cache.get(f):this._get(f,f,[])}getChanges(f,u,y){this.onChange(f,u,y),u.call(y,this.get(f),void 0)}onChange(f,u,y){this.on(`changed:${f}`,u,y)}uses(f){return f.startsWith("ls.")||f.startsWith("context.")?null:(this.__meta.has(f)||this._get(f,f,[]),this.__meta.get(f)?.uses??null)}};G(z,"SettingsContext");let U=z},46162:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{AddonDebug:()=>e,And:()=>u,Category:()=>x,Channel:()=>m,Constant:()=>n,Debug:()=>o,Fullscreen:()=>w,If:()=>S,Invert:()=>f,Moderator:()=>_,Monitor:()=>r,NativeDarkTheme:()=>p,Or:()=>y,Page:()=>C,SquadMode:()=>a,TheaterMode:()=>l,Time:()=>i,Title:()=>$});var W=d(46949),B=d(37087),R=d(24431),I=d(68069);let U=null;function z(c){d.e(6530).then(d.t.bind(d,28820,23)).then(b=>{U=b.default,c&&c()})}G(z,"loadSafety");const v=G(()=>!1,"NeverMatch"),f={createTest(c,b,k){return(0,B.createTester)(c,b,!0,!1,k)},maxRules:1,childRules:!0,tall:!0,title:"Invert",i18n:"settings.filter.invert",default:()=>[],editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,9786))},u={createTest(c,b,k){return(0,B.createTester)(c,b,!1,!1,k)},childRules:!0,tall:!0,title:"And",i18n:"settings.filter.and",default:()=>[],editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,9786))},y={createTest(c,b,k){return(0,B.createTester)(c,b,!1,!0,k)},childRules:!0,tall:!0,title:"Or",i18n:"settings.filter.or",default:()=>[],editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,9786))},S={createTest(c,b,k){const h=(0,B.createTester)(c[0],b,!1,!1,k),M=(0,B.createTester)(c[1],b,!1,!1,k),L=(0,B.createTester)(c[2],b,!1,!1,k);return T=>h(T)?M(T):L(T)},childRules:!0,tall:!0,title:"If",i18n:"settings.filter.if",default:()=>[[],[],[]],editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,17907))},n={createTest(c){return c?()=>!0:v},title:"True or False",i18n:"settings.filter.true_false",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))};function s(c){if(typeof c!="string"||!c.length)return null;const b=c.indexOf(":");if(b===-1)return null;let k,h;try{k=parseInt(c.slice(0,b),10),h=parseInt(c.slice(b+1),10)}catch{return null}return k*60+h}G(s,"parseTime");const i={_captured:new Set,createTest(c){const b=s(c[0]),k=s(c[1]);return b==null||k==null?v:b<=k?()=>{i._captured.add(b),i._captured.add(k+1);const h=new Date,M=h.getHours()*60+h.getMinutes();return M>=b&&M<=k}:()=>{i._captured.add(b+1),i._captured.add(k);const h=new Date,M=h.getHours()*60+h.getMinutes();return M>=b||M<=k}},captured:()=>{const c=Array.from(i._captured);return i._captured=new Set,c.sort((b,k)=>b-k),c},title:"Time of Day",i18n:"settings.filter.time",default:()=>["08:00","18:00"],editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,64e3))},l={createTest(c){return b=>b.fullscreen?c===!1:b.ui?.theatreModeEnabled===c},title:"Theater Mode",i18n:"settings.filter.theater",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))},w={createTest(c){return b=>b.fullscreen===c},title:"Fullscreen",i18n:"settings.filter.fullscreen",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))},_={createTest(c){return b=>b.moderator===c},title:"Is Moderator",i18n:"settings.filter.moderator",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))},o={createTest(c){return()=>R.DEBUG===c},title:"Is Developer Mode",i18n:"settings.filter.dev",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))},e={createTest(c){return b=>b.addonDev==c},title:"Is Addon Developer Mode",i18n:"settings.filter.addon-dev",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))},a={createTest(c){return b=>b.ui?.squadModeEnabled===c},title:"Squad Mode",i18n:"settings.filter.squad",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))},p={createTest(c){const b=c?1:0;return k=>k.ui?.theme===b},title:"Dark Theme",i18n:"settings.filter.native-dark",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))},C={createTest(c){if(!c)return v;const b=c.route,k=[];if(Object.keys(c.values).length){const h=window.FrankerFaceZ?.get(),M=h&&h.resolve("site.router");if(!M)return v;const L=M.getRoute(b);if(!L||!L.parts)return v;let T=1;for(const O of L.parts)if(typeof O=="object"){const P=c.values[O.name];P&&P.length&&k.push([T,P.toLowerCase()]),T++}}return h=>{if(!h.route||!h.route_data||h.route.name!==b)return!1;for(const[M,L]of k){let T=h.route_data[M];if(typeof T=="string"&&(T=T.toLowerCase()),T!==L)return!1}return!0}},tall:!0,title:"Current Page",i18n:"settings.filter.page",default:()=>({route:"front-page",values:{}}),editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,38961))},m={createTest(c){const b=c?.login,k=c?.id;if(!k&&!b)return v;if(k){if(!b)return h=>h.channelID===k}else return h=>h.channel===b;return h=>h.channelID===k||h.channelID==null&&h.channel===b},title:"Current Channel",i18n:"settings.filter.channel",default:()=>({login:null,id:null}),editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,69370))},x={createTest(c){const b=c?.name,k=c?.id;if(!k&&!b)return v;if(k){if(!b)return h=>h.categoryID===k}else return h=>h.category===b;return h=>h.categoryID===k||h.categoryID==null&&h.category===b},title:"Current Category",i18n:"settings.filter.category",default:()=>({name:null,id:null}),editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,94344))},$={createTest(c,b,k){const h=c?.mode;let M=c?.title,L=!0;if(!M||!h)return v;if(h==="text")M=(0,W.escape_regex)(M),L=!1;else if(h==="glob")M=(0,W.glob_to_regex)(M);else if(h!=="raw")return v;if(L&&(U||z(k),!U||!U(M)))return v;let T;try{T=new RegExp(M,`g${c.sensitive?"":"i"}`)}catch{return v}return O=>(T.lastIndex=0,O.title?T.test(O.title):!1)},title:"Current Title",i18n:"settings.filter.title",default:()=>({title:"",mode:"text",sensitive:!1}),editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,43922))};let r=null;window.getScreenDetails&&(r={_used:!1,details:void 0,used:()=>{const c=r._used;return r._used=!1,c},createTest(c,b,k){if(!c?.label)return v;if(r._used=!0,k&&r.details===void 0){const h=window.FrankerFaceZ??window.FFZBridge,M=h?.get(),L=M?.resolve("settings");L&&L.createMonitorUpdate().then(()=>{k()})}return()=>{r._used=!0;const h=r.details;if(!h)return!1;const M=h.screens;return(0,W.matchScreen)(M,c)===h.currentScreen}},default:()=>({label:null}),title:"Current Monitor",i18n:"settings.filter.monitor",editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,57049))})},68069:(ae,J,d)=>{"use strict";d.d(J,{ZP:()=>i,eB:()=>s,lm:()=>I.Q});var W=d(24431),B=d(22527),R=d(46949),I=d(20857),U=d(81011),z=d(47458),v=d(33640),f=d(73617),u=d(46162),y=d(30020),S=d(76393);function n(_,o){try{return _.postMessage(o,"*"),!0}catch{return!1}}G(n,"postMessage");const s=["session"],w=class w extends B.default{constructor(o,e){super(o,e),this.provider=null,this._active_provider="local",this.disable_profiles=!1,this.providers={};for(const[a,p]of Object.entries(S.Cl))p.supported()&&(this.providers[a]=p);Object.seal(this.providers),this.updateSoon=(0,R.debounce)(()=>this.updateRoutes(),50,!1);try{const a=new URL(window.location).searchParams;a&&a.has("ffz-no-settings")&&(this.disable_profiles=!0)}catch{}this.__ls_scheduled=new Set,this.__ls_cache=new Map,this.__ls_hooked=!1,this._updateLS=this._updateLS.bind(this),this.__contexts=[],this.__profiles=[],this.__profile_ids={},this.__profile_uuids={},this.ui_structures=new Map,this.definitions=new Map,this.validators={};for(const a in f)(0,R.has)(f,a)&&(this.validators[a]=f[a]);this.processors={};for(const a in v)(0,R.has)(v,a)&&(this.processors[a]=v[a]);this.clearables={};for(const a in y)(0,R.has)(y,a)&&(this.clearables[a]=y[a]);this.filters={};for(const a in u)(0,R.has)(u,a)&&u[a]&&(this.filters[a]=u[a]);this._createProvider().then(a=>{this.provider=a,this.log.info(`Using Provider: ${a.constructor.name}`),a.on("changed",this._onProviderChange,this),a.on("quota-exceeded",p=>{this.emit(":quota-exceeded")}),a.on("change-provider",()=>{this.emit(":change-provider")}),this._provider_resolve&&this._provider_resolve(a)}),this.main_context=new z.Z(this),this.main_context.on("changed",(a,p,C)=>{this.emit(`:changed:${a}`,p,C)}),this.main_context.on("uses_changed",(a,p,C)=>{this.emit(`:uses_changed:${a}`,p,C)}),this.main_context.on("context_changed",()=>this._updateContextProxies()),this._context_proxies=new Set,window.addEventListener("message",a=>{const p=a.data?.ffz_type;p==="open-settings"?this.emit("main_menu:open"):p==="request-context"&&a.source&&(this._context_proxies.add(a.source),this._updateContextProxies(a.source))}),window.addEventListener("beforeunload",()=>{for(const a of this._context_proxies)n(a,{ffz_type:"context-gone"})}),this._start_time=performance.now(),this.enable()}_updateContextProxies(o){if(!o&&!this._context_proxies.size)return;const e=JSON.parse(JSON.stringify(this.main_context._context));for(const a of s)(0,R.has)(e,a)&&delete e[a];if(o)n(o,{ffz_type:"context-update",ctx:e});else for(const a of this._context_proxies)n(a,{ffz_type:"context-update",ctx:e})}addFilter(o,e){if(this.filters[o])return this.log.warn("Tried to add already existing filter",o);this.filters[o]=e,this.updateRoutes()}getFilterBasicEditor(){return()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))}generateLog(){const o=[];for(const[e,a]of this.main_context.__cache.entries())o.push(`${e}: ${JSON.stringify(a)}`);return o.join(`
`)}awaitProvider(){return this.provider?Promise.resolve(this.provider):this._provider_waiter?this._provider_waiter:this._provider_waiter=new Promise((o,e)=>{this._provider_resolve=o}).finally(()=>{this._provider_waiter=null,this._provider_resolve=null})}async onEnable(){if(await this.awaitProvider(),!this.provider)throw new Error("did not get provider");await this.provider.awaitReady(),this.on("site.router:updated-routes",this.updateRoutes,this),this.loadProfiles(!0);for(const e of this.__contexts)e.selectProfiles();const o=performance.now()-this._start_time;this.log.info(`Initialization complete after ${o.toFixed(5)}ms -- Values: ${this.provider.size} -- Profiles: ${this.__profiles.length}`),this.scheduleUpdates(),this.updateClock()}async createMonitorUpdate(){const o=u?.Monitor;if(!(!o||o.details!==void 0)){o.details=null;try{window.getScreenDetails?(o.details=await window.getScreenDetails(),o.details.addEventListener("currentscreenchange",()=>{for(const e of this.__contexts)e.selectProfiles()})):o.details=!1}catch(e){this.log.error("Unable to get monitor details",e),o.details=!1}}}updateClock(){const o=u?.Time?.captured?.();if(!o?.length)return;this._time_timer&&clearTimeout(this._time_timer);const e=new Date,a=e.getHours()*60+e.getMinutes();let p=this._time_next!=null?this._time_next:null;for(const m of o)m<=a||(p==null||m<p)&&(p=m);p==null&&(p=o[0]+1440);const C=(p-a)*60*1e3-59750+(6e4-Date.now()%6e4);this._time_timer=setTimeout(()=>{for(const m of this.__contexts)m.selectProfiles();this.updateClock()},C)}_updateLSKey(o){(this.__ls_cache.has(o)||this.__ls_cache.has(`raw.${o}`))&&(this.__ls_scheduled.add(o),this.__ls_timer||(this.__ls_timer=setTimeout(this._updateLS,0)))}_hookLS(){if(this.__ls_hooked)return;this.__ls_hooked=!0;const o=localStorage.setItem,e=this;localStorage.setItem=function(a,...p){try{e._updateLSKey(a)}catch{}return o.call(this,a,...p)},this._handleLSEvent=this._handleLSEvent.bind(this),window.addEventListener("storage",this._handleLSEvent)}_handleLSEvent(o){o.key&&o.storageArea===localStorage&&this._updateLSKey(o.key)}_updateLS(){clearTimeout(this.__ls_timer),this.__ls_timer=null;const o=this.__ls_scheduled;this.__ls_scheduled=new Set;for(const e of o){const a=this.__ls_cache.has(e),p=`raw.${e}`,C=this.__ls_cache.has(p);if(!C&&!a)continue;const m=localStorage.getItem(e);if(C&&(this.__ls_cache.set(p,m),this.emit(":ls-update",p,m)),a){let x;if(m)try{x=JSON.parse(m)}catch($){this.log.warn(`Unable to parse localStorage value as JSON for "${e}"`,$)}this.__ls_cache.set(e,x),this.emit(":ls-update",e,x)}}}getLS(o){if(this.__ls_cache.has(o))return this.__ls_cache.get(o);this.__ls_hooked||this._hookLS();const e=o.startsWith("raw."),a=localStorage.getItem(e?o.slice(4):o);let p;if(e)p=a;else try{p=a?JSON.parse(a):null}catch(C){this.log.warn(`Unable to parse localStorage value as JSON for "${o}"`,C)}return this.__ls_cache.set(o,p),p}async generateBackupFile(){const o=new Date,e=`${o.getFullYear()}-${o.getMonth()+1}-${o.getDate()}`;if(await this._needsZipBackup()){const p=await this._getZipBackup();return new File([p],`ffz-settings (${e}).zip`,{type:"application/zip"})}const a=await this.getSettingsDump();return new File([JSON.stringify(a)],`ffz-settings (${e}).json`,{type:"application/json;charset=utf-8"})}async _needsZipBackup(){if(await this.awaitProvider(),!this.provider||(await this.provider.awaitReady(),!(this.provider instanceof S.i9)||!this.provider.supportsBlobs))return!1;const o=await this.provider.blobKeys();return Array.isArray(o)?o.length>0:!1}async _getZipBackup(){if(await this.awaitProvider(),!this.provider)throw new Error("provider not available");await this.provider.awaitReady();const o=(await d.e(935).then(d.t.bind(d,29597,23))).default,e=new o,a=await this.getSettingsDump();e.file("settings.json",JSON.stringify(a));const p={};if(this.provider instanceof S.i9&&this.provider.supportsBlobs){const C=await this.provider.blobKeys();for(const m of C){const x=encodeURIComponent(m),$=await this.provider.getBlob(m);if(!$)continue;const r={key:m};if($ instanceof File)r.type="file",r.name=$.name,r.modified=$.lastModified,r.mime=$.type;else if($ instanceof Blob)r.type="blob";else if($ instanceof ArrayBuffer)r.type="ab";else if($ instanceof Uint8Array)r.type="ui8";else continue;p[x]=r,e.file(`blobs/${x}`,$)}}return e.file("blobs.json",JSON.stringify(p)),e.generateAsync({type:"blob"})}async getSettingsDump(){if(await this.awaitProvider(),!this.provider)return null;await this.provider.awaitReady();const o={version:2,type:"full",values:{}};for(const[e,a]of this.provider.entries())o.values[e]=a;return o}scheduleUpdates(){this._update_timer&&clearTimeout(this._update_timer),this._update_timer=setTimeout(()=>this.checkUpdates(),5e3)}async checkUpdates(){if(await this.awaitProvider(),await this.provider?.awaitReady(),!this.provider?.shouldUpdate)return;const o=[];for(const p of this.__profiles){if(!p||!p.url||p.pause_updates)continue;const C=p.checkUpdate();o.push(C instanceof Promise?C:Promise.resolve(C))}const e=await Promise.all(o);let a=0;for(const p of e)p&&a++;this.log.info(`Successfully refreshed ${a} of ${e.length} profiles from remote URLs.`)}getProviders(){return this.providers}getActiveProvider(){return this._active_provider}async _createProvider(){let o=localStorage.ffzProviderv2;if(o==null&&(o=localStorage.ffzProviderv2=await this.sniffProvider()),this.providers[o]){const e=new this.providers[o](this);return this._active_provider=o,e}return this._active_provider="local",new S.PY(this)}async sniffProvider(){const o=Array.from(Object.entries(this.providers));o.sort((e,a)=>(a[1].priority??0)-(e[1].priority??0));for(const[e,a]of o)if(a.supported()&&await a.hasContent())return e;return"local"}async changeProvider(o,e){if(!this.providers[o]||!this.providers[o].supported())throw new Error(`Invalid provider: ${o}`);if(o===this._active_provider||!this.provider)return;const a=this.provider;if(this.provider=null,a.broadcastTransfer(),e){const p=new this.providers[o](this);if(await p.awaitReady(),p.allowTransfer&&a.allowTransfer){a.disableEvents(),p.clear(),p instanceof S.i9&&p.supportsBlobs&&await p.clearBlobs(),await p.flush();for(const[C,m]of a.entries())p.set(C,m);if(a instanceof S.i9&&a.supportsBlobs&&p instanceof S.i9&&p.supportsBlobs){for(const C of await a.blobKeys()){const m=await a.getBlob(C);m&&await p.setBlob(C,m)}await a.clearBlobs()}a.clear(),await a.flush(),await p.flush()}}localStorage.ffzProviderv2=o,location.reload()}_onProviderChange(o,e,a){if(o==="profiles")return this.loadProfiles();if(!o.startsWith("p:"))return;o=o.slice(2);const p=o.indexOf(":");if(p===-1)return;const C=this.__profile_ids[o.slice(0,p)],m=o.slice(p+1);C&&!C.ephemeral&&(m===":enabled"?C.emit("toggled",C,a?!0:e):C.emit("changed",m,e,a))}updateRoutes(){for(const o of this.__profiles)o.clearMatcher();for(const o of this.__contexts)o.selectProfiles();this.updateClock()}_onProfileToggled(o,e){for(const a of this.__contexts)a.selectProfiles();this.updateClock(),this.emit(":profile-toggled",o,e)}profile(o){return this.__profile_uuids[o]??this.__profile_ids[o]??null}loadProfiles(o=!1){const e=this.__profile_ids,a=this.__profile_uuids,p=this.__profiles,C=this.__profile_ids={},m=this.__profiles=[],x=this.__profile_uuids={},$=new Set(p.map(L=>L.id)),r=new Set,c=new Set;let b=this.provider?.get("profiles")??[U.Z.Moderation,U.Z.Default];b?.length||(this.provider?.delete("profiles"),b=[U.Z.Moderation,U.Z.Default]);let k=!1;for(const L of b)L.uuid||(k=!0,L.i18n_key===U.Z.Default.i18n_key?L.uuid=U.Z.Default.uuid:L.i18n_key===U.Z.Moderation.i18n_key?L.uuid=U.Z.Moderation.uuid:L.uuid=(0,R.generateUUID)());k&&this.provider?.set("profiles",b);let h=!1,M=!1;for(const L of p)L.off("toggled",this._onProfileToggled,this),L.hotkey_enabled=!1;for(const L of b){const T=L.id,O=m.length,P=e[T],j=P?p.indexOf(P):-1;if($.delete(T),j!==O&&(h=!0),P&&(0,R.deep_equals)(P.data,L,!0)){j!==O&&(M=!0),m.push(C[T]=P),x[P.uuid]=P;continue}const Z=C[T]=new U.Z(this,L);P?(P.transferListeners(Z),c.add(T)):r.add(T),m.push(Z),x[Z.uuid]=Z,M=!0}for(const L of m)L.on("toggled",this._onProfileToggled,this),L.hotkey_enabled=!0;if(!(!M&&!$.size||o)){for(const L of this.__contexts)L.selectProfiles();this.updateClock();for(const L of r)this.emit(":profile-created",C[L]);for(const L of c)this.emit(":profile-changed",C[L]);h&&this.emit(":profiles-reordered")}}createProfile(o={}){if(!this.enabled)throw new Error("Unable to create profile before settings have initialized. Please await enable()");if(o.id!==void 0)throw new Error("You cannot specify an ID when creating a profile.");let e=0;for(;this.__profile_ids[e];)o.ephemeral?e--:e++;o.id=e,o.uuid=(0,R.generateUUID)(),o.name||(o.name=`Unnamed Profile ${this.__profiles.length+1}`);const a=this.__profile_ids[e]=new U.Z(this,o);return this.__profile_uuids[o.uuid]=a,this.__profiles.unshift(a),a.on("toggled",this._onProfileToggled,this),a.hotkey_enabled=!0,a.ephemeral||this._saveProfiles(),this.emit(":profile-created",a),a}deleteProfile(o){if(!this.enabled)throw new Error("Unable to delete profile before settings have initialized. Please await enable()");if(typeof o=="object"&&typeof o.id=="number")o=o.id;else if(typeof o!="number")throw new Error("Invalid profile");const e=this.__profile_ids[o];if(!e)return;if(this.__profiles.length===1)throw new Error("cannot delete only profile");e.off("toggled",this._onProfileToggled,this),e.clear(),this.__profile_ids[o]=null,this.__profile_uuids[e.uuid]=null;const a=this.__profiles.indexOf(e);a!==-1&&this.__profiles.splice(a,1),e.ephemeral||this._saveProfiles(),this.emit(":profile-deleted",e)}moveProfile(o,e){if(!this.enabled)throw new Error("Unable to move profiles before settings have initialized. Please await enable()");if(typeof o=="object"&&typeof o.id=="number")o=o.id;else if(typeof o!="number")throw new Error("Invalid profile");const a=this.__profile_ids[o];if(!a)return;const p=this.__profiles,C=p.indexOf(a);C!==e&&(p.splice(e,0,...p.splice(C,1)),a.ephemeral||this._saveProfiles(),this.emit(":profiles-reordered"))}saveProfile(o){if(!this.enabled)throw new Error("Unable to save profile before settings have initialized. Please await enable()");if(typeof o=="object"&&typeof o.id=="number")o=o.id;else if(typeof o!="number")throw new Error("Invalid profile");const e=this.__profile_ids[o];e&&(e.ephemeral||this._saveProfiles(),this.emit(":profile-changed",e))}_saveProfiles(){const o=this.__profiles.filter(e=>!e.ephemeral).map(e=>e.data);if(!o){this.createProfile({name:"Default Profile",i18n_key:"setting.profiles.default",description:"Settings that apply everywhere on Twitch."});return}this.provider?.set("profiles",o);for(const e of this.__contexts)e.selectProfiles();this.updateClock()}context(o){return this.main_context.context(o)}get(o){return this.main_context.get(o)}getChanges(o,e,a){return this.main_context.getChanges(o,e,a)}onChange(o,e,a){return this.main_context.onChange(o,e,a)}uses(o){return this.main_context.uses(o)}update(o){return this.main_context.update(o)}updateContext(o){return this.main_context.updateContext(o)}setContext(o){return this.main_context.setContext(o)}getAddonProxy(o,e,a){if(!o)return this;const p={},C=W.DEBUG||e?.dev;return p.add=(m,x)=>this.add(m,x,o),p.addUI=(m,x)=>this.addUI(m,x,o),p.addClearable=(m,x)=>this.addClearable(m,x,o),(0,B.buildAddonProxy)(a,this,"settings",p)}add(o,e,a){const p=this.definitions.get(o),C=(Array.isArray(p)?p:p?.required_by)??[];e.required_by=C,e.requires=e.requires??[],e.__source=a;for(const m of e.requires){const x=this.definitions.get(m);Array.isArray(x)?x.push(o):x?x.required_by?.push(o):this.definitions.set(m,[o])}if(e.ui){const m=e.ui;if(m.path_tokens=m.path_tokens?l(m.path_tokens):m.path?(0,I.Q)(m.path):void 0,a&&m.path_tokens&&m.path_tokens.length>=2&&m.path_tokens[0].key==="add_ons"){const x=this.resolve("addons"),$=x?.getAddon(a);if($){const r=m.path_tokens[1],c=[];c.push(`add_ons.changelog.${a}`),$.short_name&&c.push(`add_ons.changelog.${$.short_name.toSnakeCase()}`),$.name&&c.push(`add_ons.changelog.${$.name.toSnakeCase()}`),r.header_links=[{navigate:c,i18n_key:"home.changelog",title:"Changelog"}]}}if(!m.key&&o&&(m.key=o),!m.key&&m.title&&(m.key=m.title.toSnakeCase()),(m.component==="setting-select-box"||m.component==="setting-combo-box")&&Array.isArray(m.data)&&!m.no_i18n){const x=`${m.i18n_key||`setting.entry.${o}`}.values`;for(const $ of m.data)$.i18n_key===void 0&&$.value!==void 0&&($.i18n_key=`${x}.${$.value}`)}}e.changed&&this.on(`:changed:${o}`,e.changed),this.definitions.set(o,e),(!p||Array.isArray(p))&&this.emit(":added-definition",o,e)}remove(o){const e=this.definitions.get(o);if(e&&!Array.isArray(e)){if(Array.isArray(e.required_by)&&e.required_by.length>0?this.definitions.set(o,e.required_by):this.definitions.delete(o),Array.isArray(e.requires))for(const a of e.requires){let p=this.definitions.get(a);if(Array.isArray(p)){const C=p.indexOf(o);C!==-1&&p.splice(C,1)}else p?.required_by&&(p=p.required_by)}e.changed&&this.off(`:changed:${o}`,e.changed),this.emit(":removed-definition",o,e)}}addUI(o,e,a){let p;e.ui?p=e:p={ui:e},p.__source=a;const C=p.ui;C.path_tokens=C.path_tokens?l(C.path_tokens):C.path?(0,I.Q)(C.path):void 0,!C.key&&C.title&&(C.key=C.title.toSnakeCase());const m=this.ui_structures.get(o);this.ui_structures.set(o,p),m||this.emit(":added-definition",o,p)}addClearable(o,e,a){if(typeof o=="object"){for(const[p,C]of Object.entries(o))this.addClearable(p,C,a);return}else if(typeof o!="string")throw new Error("invalid key");e&&(e.__source=a,this.clearables[o]=e)}getClearables(){return(0,R.deep_copy)(this.clearables)}addProcessor(o,e){if(typeof o=="object"){for(const[a,p]of Object.entries(o))this.addProcessor(a,p);return}else if(typeof o!="string")throw new Error("invalid key");e&&(this.processors[o]=e)}getProcessor(o){return this.processors[o]??null}getProcessors(){return(0,R.deep_copy)(this.processors)}addValidator(o,e){if(typeof o=="object"){for(const[a,p]of Object.entries(o))this.addValidator(a,p);return}else if(typeof o!="string")throw new Error("invalid key");e&&(this.validators[o]=e)}getValidator(o){return this.validators[o]??null}getValidators(){return(0,R.deep_copy)(this.validators)}};G(w,"SettingsManager");let i=w;function l(_){for(let o=0,e=_.length;o<e;o++){const a=_[o];if(typeof a=="string"){_[o]={key:a.toSnakeCase(),title:a};continue}a.key||(a.key=a.title.toSnakeCase())}return _}G(l,"format_path_tokens")},33640:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{to_float:()=>I,to_int:()=>R});const W=Symbol("BAD");function B(U,z,v){if((typeof U!="number"||isNaN(U)||!isFinite(U))&&(U=W),U!==W){const f=v.bounds;Array.isArray(f)&&(f.length>=3?((f[1]?U<f[0]:U<=f[0])||(f[3]?U>f[2]:U>=f[2]))&&(U=W):f.length===2?typeof f[1]=="boolean"?(f[1]?U<f[0]:U<=f[0])&&(U=W):(U<f[0]||U>f[1])&&(U=W):f.length===1&&U<f[0]&&(U=W))}return U===W?z:U}G(B,"do_number");const R=G((U,z,v)=>(typeof U=="string"&&/^-?\d+$/.test(U)?U=parseInt(U,10):typeof U!="number"&&(U=W),B(U,z,v)),"to_int"),I=G((U,z,v)=>(typeof U=="string"&&/^-?[\d.]+$/.test(U)?U=parseFloat(U):typeof U!="number"&&(U=W),B(U,z,v)),"to_float")},81011:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>I});var W=d(17159),B=d(46949),R=d(37087);const U=class U extends W.EventEmitter{constructor(v,f){super(),this._enabled=!1,this.ephemeral=!1,this.id=-1,this.uuid=null,this.name=null,this.pause_updates=!1,this.show_toggle=!1,this._hotkey_enabled=!1,this.onShortcut=this.onShortcut.bind(this),this._hotkey_enabled=!1,this.manager=v,this.provider=v.provider,this.data=f,this.prefix=`p:${this.id}:`,this.enabled_key=`${this.prefix}:enabled`,this.ephemeral&&(this._enabled=!0,this._storage=new Map)}get data(){return{id:this.id,uuid:this.uuid,name:this.name,i18n_key:this.i18n_key,hotkey:this.hotkey,pause_updates:this.pause_updates,ephemeral:this.ephemeral,description:this.description,desc_i18n_key:this.desc_i18n_key,url:this.url,show_toggle:this.show_toggle,context:this.context}}set data(v){if(typeof v!="object")throw new TypeError("data must be an object");this.clearMatcher(),v.ephemeral&&(this.ephemeral=!0);for(const[f,u]of Object.entries(v))this[f]=u}clearMatcher(){this.matcher=null}matches(v){return this.matcher||(this.matcher=(0,R.createTester)(this.context,this.manager.filters,!1,!1,()=>this.manager.updateSoon())),this.matcher(v)}save(){this.ephemeral||this.manager.saveProfile(this.id)}getBackup(){const v={version:2,type:"profile",profile:this.data,toggled:this.toggled,values:{}};delete v.profile.ephemeral;for(const[f,u]of this.entries())v.values[f]=u;return v}async checkUpdate(){if(!this.url||this.pause_updates)return!1;const v=await(0,B.fetchJSON)(this.url);if(!v||v.type!=="profile"||!v.profile||!v.values)return!1;delete v.profile.ephemeral,delete v.profile.id,delete v.profile.uuid,delete v.profile.name,delete v.profile.i18n_key,delete v.profile.hotkey,delete v.profile.description,delete v.profile.desc_i18n_key,delete v.profile.url,delete v.profile.pause_updates,this.data=v.profile;const f=new Set(this.keys());for(const[u,y]of Object.entries(v.values))f.delete(u),this.set(u,y);for(const u of f)this.delete(u);return!0}get hotkey(){return this._hotkey}set hotkey(v){v!==this._hotkey&&(this._hotkey=v,this._hotkey_enabled&&this._updateHotkey())}get hotkey_enabled(){return this._hotkey_enabled}set hotkey_enabled(v){this._hotkey_enabled=!!v,this._updateHotkey()}_updateHotkey(){const v=this.Mousetrap=this.Mousetrap||window.Mousetrap;if(!v)return;const f=this._hotkey;this._bound_key&&(this._bound_key!==f||!this._hotkey_enabled)&&(v.unbind(this._bound_key),this._bound_key=null),this._hotkey_enabled&&f&&(0,B.isValidShortcut)(f)&&(v.bind(f,this.onShortcut),this._bound_key=f)}onShortcut(v){this.toggled=!this.toggled,v&&(v.stopPropagation(),v.preventDefault())}get toggled(){return this.ephemeral?this._enabled:this.provider.get(this.enabled_key,!0)}set toggled(v){v!==this.toggled&&(this.ephemeral?this._enabled=v:this.provider.set(this.enabled_key,v),this.emit("toggled",this,v))}setContext(v){if(this.id===0)throw new Error("cannot set context of default profile");this.context=v,this.clearMatcher(),this.save()}get(v,f){return this.ephemeral?this._storage&&this._storage.has(v)?this._storage.get(v):f??null:this.provider.get(this.prefix+v,f)}set(v,f){this.ephemeral?this._storage&&this._storage.set(v,f):this.provider.set(this.prefix+v,f),this.emit("changed",v,f,!1)}delete(v){this.ephemeral?this._storage&&this._storage.delete(v):this.provider.delete(this.prefix+v),this.emit("changed",v,void 0,!0)}has(v){return this.ephemeral?this._storage?this._storage.has(v):!1:this.provider.has(this.prefix+v)}keys(){if(this.ephemeral)return this._storage?Array.from(this._storage.keys()):[];const v=[],f=this.prefix,u=f.length;for(const y of this.provider.keys())y.startsWith(f)&&y!==this.enabled_key&&v.push(y.slice(u));return v}clear(){if(this.ephemeral){if(this._storage){const u=this.keys();this._storage.clear();for(const y of u)this.emit("changed",y,void 0,!0)}return}const v=this.prefix,f=v.length;for(const u of this.provider.keys())u.startsWith(v)&&u!==this.enabled_key&&(this.provider.delete(u),this.emit("changed",u.slice(f),void 0,!0))}*entries(){if(this.ephemeral){if(this._storage)for(const v of this._storage.entries())yield v}else{const v=this.prefix,f=v.length;for(const u of this.provider.keys())u.startsWith(v)&&u!==this.enabled_key&&(yield[u.slice(f),this.provider.get(u)])}}get size(){if(this.ephemeral)return this._storage?this._storage.size:0;const v=this.prefix;let f=0;for(const u of this.provider.keys())u.startsWith(v)&&u!==this.enabled_key&&f++;return f}};G(U,"SettingsProfile");let I=U;I.Default={id:0,uuid:"ffz_profile_default",name:"Default Profile",i18n_key:"setting.profiles.default",description:"Settings that apply everywhere on Twitch."},I.Moderation={id:1,uuid:"ffz_profile_moderation",name:"Moderation",i18n_key:"setting.profiles.moderation",description:"Settings that apply when you are a moderator of the current channel.",context:[{type:"Moderator",data:!0}]}},76393:(ae,J,d)=>{var m,x;"use strict";d.d(J,{Cl:()=>_,PY:()=>S,i9:()=>u});var W=d(38626),B=d(17159),R=d(46949),I=d(24431);const U=1,z=window.location.host!=="www.twitch.tv",v=window.location.host!=="www.youtube.com",o=class o extends B.EventEmitter{constructor(r){super(),this.ready=!1,this.manager=r,this.disabled=!1}static supported(){return!1}awaitReady(){return this.ready?Promise.resolve():Promise.reject(new Error("Not Implemented"))}get allowTransfer(){return this.constructor.allowTransfer}get shouldUpdate(){return this.constructor.shouldUpdate}};G(o,"SettingsProvider");let f=o;f.priority=0,f.allowTransfer=!0,f.shouldUpdate=!0;const e=class e extends f{get supportsBlobs(){return!0}isValidBlob(r){return this.supportsBlobs&&(0,W.isValidBlob)(r)}};G(e,"AdvancedSettingsProvider");let u=e;const a=class a extends u{constructor(r){super(r),this._start_time=performance.now(),this._rpc=new Map,this._cached=new Map,this.resolved_ready=!1,this.ready=!1,this._ready_wait=null,this._blobs=null,this._last_id=0}get supportsBlobs(){return this._blobs??!1}broadcastTransfer(){}disableEvents(){}resolveReady(r,c){this.manager&&this.manager.log.info(`${this.constructor.name} ready in ${(performance.now()-this._start_time).toFixed(5)}ms`),this.resolved_ready=!0,this.ready=r,r&&this._ready_wait_resolve?this._ready_wait_resolve():!r&&this._ready_wait_fail&&this._ready_wait_fail(c)}awaitReady(){return this.resolved_ready?this.ready?Promise.resolve():Promise.reject():this._ready_wait?this._ready_wait:this._ready_wait=new Promise((r,c)=>{this._ready_wait_resolve=r,this._ready_wait_fail=c}).finally(()=>{this._ready_wait=null,this._ready_wait_resolve=null,this._ready_wait_fail=null})}get(r,c){return this._cached.has(r)?this._cached.get(r):c}set(r,c){if(c===void 0){this.has(r)&&this.delete(r);return}this._cached.set(r,c),this.rpc({ffz_type:"set",key:r,value:c}).catch(b=>this.manager.log.error("Error setting value",b)),this.emit("set",r,c,!1)}delete(r){this._cached.delete(r),this.rpc({ffz_type:"delete",key:r}).catch(c=>this.manager.log.error("Error deleting value",c)),this.emit("set",r,void 0,!0)}clear(){const r=this._cached;this._cached=new Map;for(const c of r.keys())this.emit("changed",c,void 0,!0);this.rpc("clear").catch(c=>this.manager.log.error("Error clearing storage",c))}has(r){return this._cached.has(r)}keys(){return this._cached.keys()}entries(){return this._cached.entries()}get size(){return this._cached.size}async flush(){await this.rpc("flush")}async getBlob(r){const c=await this.rpc({ffz_type:"get-blob",key:r});return c?(0,W.deserializeBlob)(c):null}async setBlob(r,c){await this.rpc({ffz_type:"set-blob",key:r,value:await(0,W.serializeBlob)(c)})}async deleteBlob(r){await this.rpc({ffz_type:"delete-blob",key:r})}async hasBlob(r){return this.rpc({ffz_type:"has-blob",key:r})}async clearBlobs(){await this.rpc("clear-blobs")}async blobKeys(){return this.rpc("blob-keys")}rpc(r,c){const b=++this._last_id;return new Promise((k,h)=>{this._rpc.set(b,[k,h]);let M;typeof r=="string"?M={ffz_type:r}:M=r,M.id=b,this.send(M,c)})}handleMessage(r){r.ffz_type==="ready"?this.rpc("init-load").then(c=>{this._blobs=c.blobs;for(const[b,k]of Object.entries(c.values))this._cached.set(b,k);this.resolveReady(!0)}).catch(c=>{this.resolveReady(!1,c)}):r.ffz_type==="change"?this.onChange(r):r.ffz_type==="change-blob"?this.emit("changed-blob",r.key,r.deleted):r.ffz_type==="clear-blobs"?this.emit("clear-blobs"):r.ffz_type==="reply"||r.ffz_type==="reply-error"?this.onReply(r):this.manager.log.warn("Unknown Message",r.ffz_type,r)}onChange(r){const c=r.key,b=r.value;r.deleted?(this._cached.delete(c),this.emit("changed",c,void 0,!0)):(this._cached.set(c,b),this.emit("changed",c,b,!1))}onReply(r){const c=r.id,b=r.ffz_type==="reply",k=this._rpc.get(c);if(!k)return this.manager.log.warn("Received reply for unknown ID",c);this._rpc.delete(c),b?k[0](r.reply):k[1]()}};G(a,"RemoteSettingsProvider");let y=a;const p=class p extends f{constructor(r,c){super(r),this.prefix=c=c??"FFZ:setting:";const b=this._cached=new Map,k=c.length;for(const h in localStorage)if((0,R.has)(localStorage,h)&&h.startsWith(c)){const M=localStorage.getItem(h);if(M)try{b.set(h.slice(k),JSON.parse(M))}catch{this.manager.log.warn(`unable to parse value for ${h}`,M)}}this.ready=!0,window.BroadcastChannel?(this._broadcaster=new BroadcastChannel("ffz-settings")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this)):window.addEventListener("storage",this._boundHandleStorage=this.handleStorage.bind(this))}static supported(){return!0}static hasContent(r){r||(r="FFZ:setting:");for(const c in localStorage)if(c.startsWith(r)&&(0,R.has)(localStorage,c))return!0;return!1}broadcastTransfer(){this.broadcast({type:"change-provider"})}removeListeners(){this._broadcaster&&(this._boundHandleMessage&&this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null),this._boundHandleStorage&&(window.removeEventListener("storage",this._boundHandleStorage),this._boundHandleStorage=null)}disableEvents(){this.removeListeners(),this.broadcast=()=>{},this.emit=()=>{}}destroy(){this.disable(),this._cached.clear()}disable(){this.removeListeners(),this.disabled=!0}flush(){}broadcast(r){this._broadcaster&&this._broadcaster.postMessage(r)}handleMessage(r){if(this.disabled||!r.isTrusted||!r.data)return;this.manager.log.debug("storage broadcast event",r.data);const{type:c,key:b}=r.data;if(c==="change-provider")this.manager.log.info("Received notice of changed settings provider."),this.emit("change-provider"),this.disable(),this.disableEvents();else if(c==="set"){const k=JSON.parse(localStorage.getItem(this.prefix+b)??"null");this._cached.set(b,k),this.emit("changed",b,k,!1)}else if(c==="delete")this._cached.delete(b),this.emit("changed",b,void 0,!0);else if(c==="clear"){const k=Array.from(this._cached.keys());this._cached.clear();for(const h of k)this.emit("changed",h,void 0,!0)}}handleStorage(r){if(!this.disabled&&(this.manager.log.debug("storage event",r),r.storageArea===localStorage&&r.key&&r.key.startsWith(this.prefix))){const c=r.key.slice(this.prefix.length);let b=r.newValue;b===null?(this._cached.delete(c),this.emit("changed",c,void 0,!0)):(b=JSON.parse(b),this._cached.set(c,b),this.emit("changed",c,b,!1))}}get(r,c){return this._cached.has(r)?this._cached.get(r):c}set(r,c){if(!this.disabled){if(c===void 0){this.has(r)&&this.delete(r);return}this._cached.set(r,c);try{localStorage.setItem(this.prefix+r,JSON.stringify(c))}catch(b){throw this.manager&&this.manager.log.error(`An error occurred while trying to save a value to localStorage for key "${this.prefix+r}"`),b&&/quota/i.test(b.toString())&&this.emit("quota-exceeded",b),b}this.broadcast({type:"set",key:r}),this.emit("set",r,c,!1)}}delete(r){this.disabled||(this._cached.delete(r),localStorage.removeItem(this.prefix+r),this.broadcast({type:"delete",key:r}),this.emit("set",r,void 0,!0))}has(r){return this._cached.has(r)}keys(){return this._cached.keys()}clear(){if(this.disabled)return;const r=this._cached;this._cached=new Map;for(const c of r.keys())localStorage.removeItem(this.prefix+c),this.emit("changed",c,void 0,!0);this.broadcast({type:"clear"})}entries(){return this._cached.entries()}get size(){return this._cached.size}};G(p,"LocalStorageProvider");let S=p;S.priority=-1e3,S.title="Local Storage",S.description="[Local Storage](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API) is available on all platforms and fast to access, but has poorly defined capacity limits and may be cleared unexpectedly. Particularly, clearing cookies and cache in your browser will likely clear Local Storage as well.";const C=class C extends u{constructor(r,c=!0){super(r),this._last_tx=0,this.getDB=(0,R.once)(this.getDB),this._start_time=performance.now(),this._pending=new Set,this._flush_wait=null,this._lock=new R.TicketLock,this._cached=new Map,this.ready=!1,this._ready_wait=null,c&&(window.BroadcastChannel&&(this._broadcaster=new BroadcastChannel("ffz-settings")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this)),this._ready_wait=this.loadSettings().then(()=>{this.manager&&this.manager.log.info(`IDB ready in ${(performance.now()-this._start_time).toFixed(5)}ms`),this.ready=!0}).catch(b=>{this.manager&&this.manager.log.error(`IDB failed after ${(performance.now()-this._start_time).toFixed(5)}ms:`,b),this.ready=!1}).finally(()=>{this._ready_wait=null}))}static supported(){return window.indexedDB!=null}static hasContent(){return new Promise(r=>{const c=window.indexedDB.open("FFZ",U);c.onerror=()=>r(!1),c.onupgradeneeded=b=>{b.target instanceof IDBRequest&&b.target.transaction?.abort(),r(!1)},c.onsuccess=()=>{const b=c.result;let k;try{k=b.transaction(["settings"],"readonly").objectStore("settings")}catch{return r(!1)}const h=k.getAllKeys();h.onerror=()=>{b.close(),r(!1)},h.onsuccess=()=>{const M=Array.isArray(h.result)&&h.result.length>0;return b.close(),r(M)}}})}destroy(){this.disable(),this._cached.clear()}disable(){this.disabled=!0,this.removeListeners(),this.db&&(this.db.close(),this.db=null)}removeListeners(){this._broadcaster&&(this._boundHandleMessage&&this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null)}broadcastTransfer(){this.broadcast({type:"change-provider"})}disableEvents(){this.removeListeners(),this.broadcast=()=>{},this.emit=()=>{}}_onStart(r){this._pending||(this._pending=new Set),this._pending.add(r)}_onFinish(r){this._pending&&(this._pending.delete(r),this._pending.size)||this._flush_wait_resolve&&this._flush_wait_resolve()}flush(){return this._flush_wait?this._flush_wait:!this._pending||!this._pending.size?Promise.resolve():this._flush_wait=new Promise(r=>{this._flush_wait_resolve=r}).finally(()=>{this._flush_wait_resolve=null,this._flush_wait=null})}broadcast(r){this._broadcaster&&this._broadcaster.postMessage(r)}handleMessage(r){if(this.disabled||!r.isTrusted||!r.data)return;this.manager&&this.manager.log.debug("storage broadcast event",r.data);const{type:c,key:b}=r.data;if(c==="change-provider")this.manager.log.info("Received notice of changed settings provider."),this.emit("change-provider"),this.disable(),this.disableEvents();else if(c==="set")this._get(b).then(k=>{this._cached.set(b,k),this.emit("changed",b,k,!1)}).catch(k=>this.manager&&this.manager.log.error(`Error getting setting "${b}" from database`,k));else if(c==="delete")this._cached.delete(b),this.emit("changed",b,void 0,!0);else if(c==="clear"){const k=Array.from(this._cached.keys());this._cached.clear();for(const h of k)this.emit("changed",h,void 0,!0)}else c==="set-blob"?this.emit("changed-blob",b,!1):c==="delete-blob"?this.emit("changed-blob",b,!0):c==="clear-blobs"&&this.emit("clear-blobs")}awaitReady(){return this._ready_wait?this._ready_wait:this.ready?Promise.resolve():Promise.reject()}get(r,c){return this._cached.has(r)?this._cached.get(r):c}set(r,c){if(!this.disabled){if(c===void 0){this.has(r)&&this.delete(r);return}this._cached.set(r,c),this._set(r,c).then(()=>this.broadcast({type:"set",key:r})).catch(b=>this.manager&&this.manager.log.error(`Error saving setting "${r}" to database`,b)),this.emit("set",r,c,!1)}}delete(r){this.disabled||(this._cached.delete(r),this._delete(r).catch(c=>this.manager&&this.manager.log.error(`Error deleting setting "${r}" from database`,c)).then(()=>this.broadcast({type:"delete",key:r})),this.emit("set",r,void 0,!0))}has(r){return this._cached.has(r)}keys(){return this._cached.keys()}clear(){if(this.disabled)return;const r=this._cached;this._cached=new Map;for(const c of r.keys())this.emit("changed",c,void 0,!0);this._clear().catch(c=>this.manager&&this.manager.log.error("Error clearing database",c)).then(()=>this.broadcast({type:"clear"}))}entries(){return this._cached.entries()}get size(){return this._cached.size}getDB(r=!1){if(this.db)return Promise.resolve(this.db);if(this._db_wait)return this._db_wait;let c;return this._db_wait=c=new Promise((b,k)=>{const h=window.indexedDB.open("FFZ",U);this._onStart(h),h.onerror=M=>{this.manager&&this.manager.log.error("Error opening database.",M),k(M),this._onFinish(h)},h.onupgradeneeded=M=>{this.manager&&this.manager.log.info(`Upgrading database from version ${M.oldVersion} to ${U}`);const L=h.result;L.createObjectStore("settings",{keyPath:"k"}),L.createObjectStore("blobs")},h.onsuccess=()=>{this.manager&&this.manager.log.info(`Database opened. (After: ${(performance.now()-this._start_time).toFixed(5)}ms)`),this.db=h.result;try{const M=this.db.transaction(["settings","blobs"],"readonly");M.objectStore("settings"),M.objectStore("blobs")}catch(M){this.manager&&this.manager.log.error("Database in invalid state.",M);try{this.db.close()}catch{}if(this._onFinish(h),this.db=null,r)k(M);else{const L=window.indexedDB.deleteDatabase("FFZ");this._onStart(L),L.onerror=T=>{this.manager&&this.manager.log.error("Error deleting invalid database.",T),k(T),this._onFinish(L)},L.onsuccess=()=>{this.manager&&this.manager.log.info("Deleted invalid database."),this._onFinish(L),this._db_wait=null,this.getDB(!0).then(b).catch(k)}}return}b(this.db),this._onFinish(h)}}).finally(()=>{c===this._db_wait&&(this._db_wait=null)})}async loadSettings(){const r=await this.getDB(),c=r.transaction(["settings"],"readonly"),b=c.objectStore("settings"),k=this._last_tx++;return this._onStart(k),new Promise((h,M)=>{c.onabort=T=>{this.manager&&this.manager.log.error("Transaction aborted reading settings from database.",T),this._onFinish(k),M()};const L=b.getAll();L.onsuccess=()=>{for(const T of L.result)this._cached.set(T.k,T.v);this._onFinish(k),h()},L.onerror=T=>{this.manager&&this.manager.log.error("Error reading settings from database.",T),this._onFinish(k),M()}})}async _getKeys(){const r=await this.getDB(),c=r.transaction(["settings"],"readonly"),b=c.objectStore("settings"),k=this._last_tx++;return this._onStart(k),new Promise((h,M)=>{c.onabort=T=>{this.manager&&this.manager.log.error("Transaction aborted reading keys from database.",T),this._onFinish(k),M()};const L=b.getAllKeys();L.onsuccess=()=>{this._onFinish(k),h(L.result)},L.onerror=T=>{this.manager&&this.manager.log.error("Error reading keys from database.",T),this._onFinish(k),M()}})}async _get(r){const c=await this.getDB(),b=c.transaction(["settings"],"readonly"),k=b.objectStore("settings"),h=this._last_tx++;return this._onStart(h),new Promise((M,L)=>{b.onabort=O=>{this.manager&&this.manager.log.error("Transaction aborted reading value from database.",O),this._onFinish(h),L()};const T=k.get(r);T.onerror=O=>{this.manager&&this.manager.log.error("Error reading value from database.",O),this._onFinish(h),L()},T.onsuccess=()=>{this._onFinish(h),M(T.result.v)}})}async _set(r,c){if(this.disabled)return;const b=this._last_tx++;this._onStart(b);const k=await this._lock.wait(),h=await this.getDB(),M=h.transaction(["settings"],"readwrite"),L=M.objectStore("settings");return new Promise((T,O)=>{M.onabort=j=>{this.manager&&this.manager.log.error("Transaction aborted setting value to database.",j),k(),this._onFinish(b),O()};const P=L.put({k:r,v:c});P.onerror=j=>{this.manager&&this.manager.log.error("Error setting value to database.",j),k(),this._onFinish(b),O()},P.onsuccess=()=>{k(),this._onFinish(b),T()}})}async _delete(r){if(this.disabled)return;const c=this._last_tx++;this._onStart(c);const b=await this._lock.wait(),k=await this.getDB(),h=k.transaction(["settings"],"readwrite"),M=h.objectStore("settings");return new Promise((L,T)=>{h.onabort=P=>{this.manager&&this.manager.log.error("Transaction aborted deleting value from database.",P),b(),this._onFinish(c),T()};const O=M.delete(r);O.onerror=P=>{this.manager&&this.manager.log.error("Error deleting value from database.",P),b(),this._onFinish(c),T()},O.onsuccess=()=>{b(),this._onFinish(c),L()}})}async _clear(){if(this.disabled)return;const r=this._last_tx++;this._onStart(r);const c=await this._lock.wait(),b=await this.getDB(),k=b.transaction(["settings"],"readwrite"),h=k.objectStore("settings");return new Promise((M,L)=>{k.onabort=O=>{this.manager&&this.manager.log.error("Transaction aborted clearing database.",O),c(),this._onFinish(r),L()};const T=h.clear();T.onerror=O=>{this.manager&&this.manager.log.error("Error clearing database.",O),c(),this._onFinish(r),L()},T.onsuccess=()=>{c(),this._onFinish(r),M()}})}async getBlob(r){const c=await this.getDB(),b=c.transaction(["blobs"],"readonly"),k=b.objectStore("blobs");return new Promise((h,M)=>{const L=k.get(r);this._onStart(L),L.onerror=()=>{M(),this._onFinish(L)},L.onsuccess=T=>{(0,W.isValidBlob)(L.result)?h(L.result):M(),this._onFinish(L)}})}async setBlob(r,c){if(this.disabled)return;if(!this.isValidBlob(c))throw new Error("Invalid blob type");const b=await this.getDB(),k=b.transaction(["blobs"],"readwrite"),h=k.objectStore("blobs");return new Promise((M,L)=>{const T=h.put(c,r);this._onStart(T),T.onerror=()=>{L(),this._onFinish(T)},T.onsuccess=()=>{M(),this.broadcast({type:"set-blob",key:r}),this.emit("set-blob",r,c,!1),this._onFinish(T)}})}async deleteBlob(r){if(this.disabled)return;const c=await this.getDB(),b=c.transaction(["blobs"],"readwrite"),k=b.objectStore("blobs");return new Promise((h,M)=>{const L=k.delete(r);this._onStart(L),L.onerror=()=>{M(),this._onFinish(L)},L.onsuccess=()=>{h(),this.broadcast({type:"delete-blob",key:r}),this.emit("set-blob",r,void 0,!0),this._onFinish(L)}})}async hasBlob(r){return(await this.blobKeys()).includes(r)}async clearBlobs(){if(this.disabled)return;const r=await this.getDB(),c=r.transaction(["blobs"],"readwrite"),b=c.objectStore("blobs");return new Promise((k,h)=>{const M=b.clear();this._onStart(M),M.onerror=()=>{h(),this._onFinish(M)},M.onsuccess=()=>{k(),this.broadcast({type:"clear-blobs"}),this._onFinish(M)}})}async blobKeys(){const r=await this.getDB(),c=r.transaction(["blobs"],"readonly"),b=c.objectStore("blobs");return new Promise((k,h)=>{const M=b.getAllKeys();this._onStart(M),M.onerror=()=>{h(),this._onFinish(M)},M.onsuccess=()=>{Array.isArray(M.result)?k(M.result):h(),this._onFinish(M)}})}};G(C,"IndexedDBProvider");let n=C;n.priority=10,n.title="IndexedDB",n.description="[IndexedDB](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API) is available on most platforms, and has a slightly slower initialization time than Local Storage. IndexedDB has a higher storage capacity and is less likely to be cleared unexpectedly.";const s=(m=class extends y{constructor(r){super(r);const c=this.frame=document.createElement("iframe");c.src=this.manager.root.host==="youtube"?"//www.youtube.com/__ffz_bridge/":"//www.twitch.tv/p/ffz_bridge/",c.id="ffz-settings-bridge",c.style.width="0",c.style.height="0",this.onMessage=this.onMessage.bind(this),window.addEventListener("message",this.onMessage),document.body.appendChild(c)}static supported(){return z&&v}static hasContent(){return m.supported()}broadcastTransfer(){}disableEvents(){}onMessage(r){const c=r.data;!c||!c.ffz_type||this.handleMessage(c)}send(r,c){typeof r=="string"&&(r={ffz_type:r});try{this.frame.contentWindow.postMessage(r,"*",c?Array.isArray(c)?c:[c]:void 0)}catch(b){this.manager.log.error("Error sending message to bridge.",b,r,c)}}},G(m,"_CrossOriginStorageBridge2"),m);s.priority=100,s.title="Cross-Origin Storage Bridge",s.description="This provider uses an `<iframe>` to synchronize storage across subdomains. Due to the `<iframe>`, this provider takes longer than others to load, but should perform roughly the same once loaded. You should be using this on non-www subdomains of Twitch unless you don't want your settings to automatically synchronize for some reason.",s.allowTransfer=!1,s.shouldUpdate=!1;let i=s;const l=(x=class extends y{static supported(){return I.EXTENSION}static hasContent(){return x.supported()?new Promise(r=>{let c=!1,b=null;const k=G(M=>{if(M.source===window&&M.data&&M.data.type==="ffz_from_ext"){const L=M.data.data;L?.ffz_type==="has-keys"&&(c=!0,r(L.value),h())}},"listener"),h=G(()=>{c||(c=!0,r(!1)),b&&(clearTimeout(b),b=null),window.removeEventListener("message",k)},"cleanup");window.addEventListener("message",k),window.postMessage({type:"ffz_to_ext",data:{ffz_type:"check-has-keys"}},"*"),b=setTimeout(h,1e3)}):!1}constructor(r){super(r),this.onExtMessage=this.onExtMessage.bind(this),window.addEventListener("message",this.onExtMessage)}broadcastTransfer(){}disableEvents(){}onExtMessage(r){r.source===window&&r.data?.type==="ffz_from_ext"&&r.data.data?.ffz_type&&this.handleMessage(r.data.data)}send(r,c){typeof r=="string"&&(r={ffz_type:r});try{window.postMessage({type:"ffz_to_ext",data:r},"*",c?Array.isArray(c)?c:[c]:void 0)}catch(b){this.manager.log.error("Error sending message to extension.",b,r,c)}}},G(x,"_ExtensionProvider2"),x);l.priority=101,l.title="Browser Extension Storage",l.description="This provider uses a browser extension service worker to store settings in a location that should not suffer from issues due to storage partitioning or cache clearing.",l.allowTransfer=!0,l.shouldUpdate=!0;let w=null;const _={local:S,idb:n,cosb:i}},39602:(ae,J,d)=>{"use strict";d.d(J,{ZP:()=>z});const W=Symbol("default"),z={basic:{get(v,f){for(const u of f)if(u.has(v))return[u.get(v),[u.id]]}},object_merge:{get(v,f,u,y){const S=[],n=[];for(const s of f)if(s.has(v)){const i=s.get(v);if(!i||typeof i!="object"){y.warn(`Profile #${s.id} has an invalid value for "${v}" of type ${typeof i}. Skipping.`);continue}n.push(s.id),S.unshift(i)}if(n.length)return[Object.assign({},...S),n]}},basic_array_merge:{get(v,f,u,y){const S=[],n=[];for(const s of f)if(s.has(v)){const i=s.get(v);if(!Array.isArray(i)){y.warn(`Profile #${s.id} has an invalid value for "${v}"`);continue}n.push(s.id);for(const l of i)S.push(l)}if(n.length)return[S,n]}},array_merge:{default(v){const f=[];for(const u of v)u.t!=="inherit"&&u.t!=="skip"&&u.v&&f.push(u.v);return f},get(v,f,u,y,S){const n=[],s=[];let i=[],l=!1,w=f;u.inherit_default&&(w=[...f,W]);for(const _ of w){let o;if(_===W)o=u.default,typeof o=="function"&&(o=o(S));else if(_.has(v))o=_.get(v);else continue;if(!Array.isArray(o)){_!==W&&y.warn(`Profile #${_.id} has an invalid value for "${v}" of type ${typeof o}. Skipping.`);continue}const e=[];_!==W&&s.push(_.id);let a=!1;for(const p of o)if(l=!0,p.t==="inherit")a=!0;else{if(p.t==="skip")continue;a?e.push(p.v):n.push(p.v)}if(i=e.concat(i),!a&&!u.always_inherit)break}if(l)return[n.concat(i),s]}}}},73617:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{process_to_float:()=>R,process_to_int:()=>B});function W(I,U){if(typeof I!="number"||isNaN(I)||!isFinite(I))return!1;const z=U.bounds;if(Array.isArray(z)){if(z.length>=3){if((z[1]?I<z[0]:I<=z[0])||(z[3]?I>z[2]:I>=z[2]))return!1}else if(z.length===2){if(typeof z[1]=="boolean"){if(z[1]?I<z[0]:I<=z[0])return!1}else if(I<z[0]||I>z[1])return!1}else if(z.length===1&&I<z[0])return!1}return!0}G(W,"do_number");const B=G((I,U)=>{if(typeof I=="string"&&/^-?\d+$/.test(I))I=parseInt(I,10);else if(typeof I!="number")return!1;return W(I,U)},"process_to_int"),R=G((I,U)=>{if(typeof I=="string"&&/^-?[\d.]+$/.test(I))I=parseFloat(I);else if(typeof I!="number")return!1;return W(I,U)},"process_to_float")},34923:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>B});var W=d(22527);const R=class R extends W.default{constructor(U,z){super(U,z),this.settings=null,this.site=null,this.fine=null,this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site"),this.LoadableComponent=this.fine.define("loadable-component",v=>v.props?.component&&v.props.loader),this.ErrorBoundaryComponent=this.fine.define("error-boundary-component",v=>v.props?.name&&v.props?.onError&&v.props?.children&&v.onErrorBoundaryTestEmit),this.overrides=new Map}onEnable(){this.settings.getChanges("chat.hype.show-pinned",U=>{this.toggle("PaidPinnedChatMessageList",U)}),this.settings.getChanges("layout.turbo-cta",U=>{this.toggle("TopNav__TurboButton_Available",U)}),this.ErrorBoundaryComponent.ready((U,z)=>{this.log.debug("Found Error Boundary component wrapper.");const v=this,f=U.prototype,u=f.render;f.render=function(){try{const y=this.props.name;if(v.overrides.has(y)&&!v.shouldRender(y))return null}catch(y){console.error(y)}return u.call(this)},this.ErrorBoundaryComponent.updateInstances()}),this.LoadableComponent.ready((U,z)=>{this.log.debug("Found Loadable component wrapper.");const v=this,f=U.prototype,u=f.render;f.render=function(){try{const y=this.props.component;if(v.overrides.has(y)&&this.state){let S=this.state.Component;if(typeof S=="function"&&!S.ffzWrapped){const n=v.site.getReact(),s=n&&n.createElement;if(s){if(!S.ffzWrapper){let i=G(function(w){return v.shouldRender(l.props.component)?s(S,w):null},"FFZWrapper");const l=this;i.ffzWrapped=!0,i.displayName=`FFZWrapper(${this.props.component})`,S.ffzWrapper=i}this.state.Component=S.ffzWrapper}}}}catch(y){console.error(y)}return u.call(this)},this.LoadableComponent.updateInstances()})}toggle(U,z=null){const v=this.overrides.get(U)??!0;z==null?z=!v:z=!!z,z!==v&&(this.overrides.set(U,z),this.update(U))}update(U){for(const z of this.LoadableComponent.instances){const v=z.props?.component;v&&v===U&&z.forceUpdate()}for(const z of this.ErrorBoundaryComponent.instances){const v=z.props?.name;v&&v===U&&z.forceUpdate()}}shouldRender(U){return this.overrides.get(U)??!0}};G(R,"Loadable");let B=R},70052:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>R});var W=d(22527),B=d(44589);const I=class I extends W.default{constructor(z,v){super(z,v),this.i18n=null,this.fine=null,this.settings=null,this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.settings.add("sub-button.prime-notice",{default:!0,ui:{path:"Channel > Metadata >> Subscription",title:"Show Prime Reminder",description:"Display a crown on subscription buttons when your free channel sub with Prime is available.",component:"setting-check-box"},changed:()=>this.SubButton.forceUpdate()}),this.SubButton=this.fine.define("sub-button",f=>f.handleSubMenuAction&&f.openSubModal,["user","user-home","user-video","user-clip","video","user-videos","user-clips","user-collections","user-events","user-followers","user-following"])}onEnable(){this.settings.on(":changed:layout.swap-sidebars",()=>this.SubButton.forceUpdate()),this.SubButton.ready((z,v)=>{for(const f of v)this.updateSubButton(f)}),this.SubButton.on("mount",this.updateSubButton,this),this.SubButton.on("update",this.updateSubButton,this)}updateSubButton(z){const v=this.fine.getChildNode(z),f=v?.querySelector('button[data-a-target="subscribe-button"]');if(!f)return;const u=z.props,y=u.data&&u.data.user,S=y&&y.self,n=this.settings.get("sub-button.prime-notice")&&S&&S.canPrimeSubscribe&&!S.subscriptionBenefit,s=f.querySelector(".ffz--can-prime");if(n&&!s)f.insertBefore((0,B.createElement)("span",{class:"tw-button__icon tw-button__icon--left ffz--can-prime"},(0,B.createElement)("figure",{class:"ffz-i-crown ffz-tooltip","data-title":this.i18n.t("sub-button.prime","Your free channel sub with Prime is available.")})),f.firstElementChild),f.appendChild((0,B.createElement)("span",{class:"ffz--post-prime"}));else if(!n&&s){s.remove();const i=f.querySelector(".ffz--post-prime");i&&i.remove()}}};G(I,"SubButton");let R=I},38626:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{deserializeBlob:()=>R,isValidBlob:()=>W,serializeBlob:()=>B});function W(I){return I instanceof Blob||I instanceof File||I instanceof ArrayBuffer||I instanceof Uint8Array}G(W,"isValidBlob");async function B(I){if(!I)return null;if(I instanceof Blob)return{type:"blob",mime:I.type,buffer:await I.arrayBuffer()};if(I instanceof File)return{type:"file",mime:I.type,name:I.name,modified:I.lastModified,buffer:await I.arrayBuffer()};if(I instanceof ArrayBuffer)return{type:"ab",buffer:I};if(I instanceof Uint8Array)return{type:"u8",buffer:I.buffer};throw new TypeError("Invalid type")}G(B,"serializeBlob");function R(I){if(!I||!I.type)return null;if(I.type==="blob")return new Blob([I.buffer],{type:I.mime});if(I.type==="file")return new File([I.buffer],I.name,{type:I.mime,lastModified:I.modified});if(I.type==="ab")return I.buffer;if(I.type==="u8")return new Uint8Array(I.buffer);throw new TypeError("Invalid type")}G(R,"deserializeBlob")},14873:(ae,J,d)=>{var l;"use strict";d.r(J),d.d(J,{Color:()=>y,ColorAdjuster:()=>S,bit2linear:()=>B,hue2rgb:()=>W,linear2bit:()=>R});function W(o,e,a){return a<0&&(a+=1),a>1&&(a-=1),a<.16666666666666666?o+(e-o)*6*a:a<.5?e:a<.6666666666666666?o+(e-o)*(.6666666666666666-a)*6:o}G(W,"hue2rgb");function B(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}G(B,"bit2linear");function R(o){return o<=.0031308?o*12.92:Math.pow(1.055*o,.4166666666666667)-.055}G(R,"linear2bit");const n=class n{constructor(e,a,p,C){this.r=e||0,this.g=a||0,this.b=p||0,this.a=C||0}eq(e,a=!1){return e instanceof n?this.r===e.r&&this.g===e.g&&this.b===e.b&&(a||this.a===e.a):e?this.eq(e.toRGBA(),a):!1}_r(e){return new n(e,this.g,this.b,this.a)}_g(e){return new n(this.r,e,this.b,this.a)}_b(e){return new n(this.r,this.g,e,this.a)}_a(e){return new n(this.r,this.g,this.b,e)}static fromName(e){const a=y.getContext();a.clearRect(0,0,1,1),a.fillStyle=e,a.fillRect(0,0,1,1);const p=a.getImageData(0,0,1,1);return p?.data?.length!==4?null:new n(p.data[0],p.data[1],p.data[2],p.data[3]/255)}static fromCSS(e){return e=e&&e.trim(),e?.length?e.charAt(0)==="#"?n.fromHex(e):n.fromName(e):null}static fromHex(e){e.charAt(0)==="#"&&(e=e.slice(1));let a,p=255;return e.length===4?(p=parseInt(e[3],16)*17,e=e.slice(0,3)):e.length===8&&(p=parseInt(e.slice(6),16),e=e.slice(0,6)),e.length===3?a=(parseInt(e[0],16)*17<<16)+(parseInt(e[1],16)*17<<8)+parseInt(e[2],16)*17:a=parseInt(e,16),new n(a>>16,a>>8&255,a&255,p/255)}static fromHSVA(e,a,p,C){let m,x,$;const r=Math.floor(e*6),c=e*6-r,b=p*(1-a),k=p*(1-c*a),h=p*(1-(1-c)*a);switch(r%6){case 0:m=p,x=h,$=b;break;case 1:m=k,x=p,$=b;break;case 2:m=b,x=p,$=h;break;case 3:m=b,x=k,$=p;break;case 4:m=h,x=b,$=p;break;default:m=p,x=b,$=k}return new n(Math.round(Math.min(Math.max(0,m*255),255)),Math.round(Math.min(Math.max(0,x*255),255)),Math.round(Math.min(Math.max(0,$*255),255)),C===void 0?1:C)}static fromHSLA(e,a,p,C){if(a===0){const $=Math.round(Math.min(Math.max(0,255*p),255));return new n($,$,$,C===void 0?1:C)}const m=p<.5?p*(1+a):p+a-p*a,x=2*p-m;return new n(Math.round(Math.min(Math.max(0,255*W(x,m,e+.3333333333333333)),255)),Math.round(Math.min(Math.max(0,255*W(x,m,e)),255)),Math.round(Math.min(Math.max(0,255*W(x,m,e-.3333333333333333)),255)),C===void 0?1:C)}static fromXYZA(e,a,p,C){const m=3.240479*e-1.53715*a-.498535*p,x=-.969256*e+1.875992*a+.041556*p,$=.055648*e-.204043*a+1.057311*p;return new n(Math.max(0,Math.min(255,255*R(m))),Math.max(0,Math.min(255,255*R(x))),Math.max(0,Math.min(255,255*R($))),C===void 0?1:C)}toCSS(){return this.a!==1?`rgba(${this.r},${this.g},${this.b},${this.a})`:this.toHex()}toHex(){return`#${((Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)).toString(16).padStart(6,"0")}`}toRGBA(){return this}toHSVA(){return U.fromRGBA(this.r,this.g,this.b,this.a)}toHSLA(){return z.fromRGBA(this.r,this.g,this.b,this.a)}toXYZA(){return f.fromRGBA(this.r,this.g,this.b,this.a)}toLUVA(){return this.toXYZA().toLUVA()}get_Y(){return(.299*this.r+.587*this.g+.114*this.b)/255}luminance(){const e=B(this.r/255),a=B(this.g/255),p=B(this.b/255);return .2126*e+.7152*a+.0722*p}brighten(e){return e=typeof e=="number"?e:1,e=Math.round(255*(e/100)),new n(Math.max(0,Math.min(255,this.r+e)),Math.max(0,Math.min(255,this.g+e)),Math.max(0,Math.min(255,this.b+e)),this.a)}daltonize(e){let a;if(typeof e=="string")if(y.CVDMatrix.hasOwnProperty(e))a=y.CVDMatrix[e];else throw new Error("Invalid CVD matrix");else a=e;const p=a[0],C=a[1],m=a[2],x=a[3],$=a[4],r=a[5],c=a[6],b=a[7],k=a[8],h=17.8824*this.r+43.5161*this.g+4.11935*this.b,M=3.45565*this.r+27.1554*this.g+3.86714*this.b,L=.0299566*this.r+.184309*this.g+1.46709*this.b,T=p*h+C*M+m*L,O=x*h+$*M+r*L,P=c*h+b*M+k*L;let j=.0809444479*T+-.130504409*O+.116721066*P,Z=-.0102485335*T+.0540193266*O+-.113614708*P,q=-.000365296938*T+-.00412161469*O+.693511405*P;j=this.r-j,Z=this.g-Z,q=this.b-q;const X=0*j+0*Z+0*q,ee=.7*j+1*Z+0*q,te=.7*j+0*Z+1*q;return j=Math.min(Math.max(0,X+this.r),255),Z=Math.min(Math.max(0,ee+this.g),255),q=Math.min(Math.max(0,te+this.b),255),new n(j,Z,q,this.a)}};G(n,"RGBAColor");let I=n;const s=class s{constructor(e,a,p,C){this.h=e||0,this.s=a||0,this.v=p||0,this.a=C||0}eq(e,a=!1){return e instanceof s?this.h===e.h&&this.s===e.s&&this.v===e.v&&(a||this.a===e.a):e?this.eq(e.toHSVA(),a):!1}_h(e){return new s(e,this.s,this.v,this.a)}_s(e){return new s(this.h,e,this.v,this.a)}_v(e){return new s(this.h,this.s,e,this.a)}_a(e){return new s(this.h,this.s,this.v,e)}static fromRGBA(e,a,p,C){e/=255,a/=255,p/=255;const m=Math.max(e,a,p),x=Math.min(e,a,p),$=Math.min(Math.max(0,m-x),1),r=m===0?0:$/m,c=m;let b;if($===0)b=0;else{switch(m){case e:b=(a-p)/$+(a<p?6:0);break;case a:b=(p-e)/$+2;break;default:b=(e-a)/$+4}b/=6}return new s(b,r,c,C===void 0?1:C)}toCSS(){return this.toRGBA().toCSS()}toHex(){return this.toRGBA().toHex()}toRGBA(){return I.fromHSVA(this.h,this.s,this.v,this.a)}toHSVA(){return this}toHSLA(){return this.toRGBA().toHSLA()}toXYZA(){return this.toRGBA().toXYZA()}toLUVA(){return this.toRGBA().toLUVA()}};G(s,"HSVAColor");let U=s;const i=class i{constructor(e,a,p,C){this.h=e||0,this.s=a||0,this.l=p||0,this.a=C||0}eq(e,a=!1){return e instanceof i?this.h===e.h&&this.s===e.s&&this.l===e.l&&(a||this.a===e.a):e?this.eq(e.toHSLA(),a):!1}_h(e){return new i(e,this.s,this.l,this.a)}_s(e){return new i(this.h,e,this.l,this.a)}_l(e){return new i(this.h,this.s,e,this.a)}_a(e){return new i(this.h,this.s,this.l,e)}static fromRGBA(e,a,p,C){e/=255,a/=255,p/=255;const m=Math.max(e,a,p),x=Math.min(e,a,p),$=Math.min(Math.max(0,(m+x)/2),1),r=Math.min(Math.max(0,m-x),1);let c,b;if(r===0)c=b=0;else{switch(b=$>.5?r/(2-m-x):r/(m+x),m){case e:c=(a-p)/r+(a<p?6:0);break;case a:c=(p-e)/r+2;break;default:c=(e-a)/r+4}c/=6}return new i(c,b,$,C===void 0?1:C)}toCSS(){const e=this.a;return`hsl${e!==1?"a":""}(${Math.round(this.h*360)},${Math.round(this.s*100)}%,${Math.round(this.l*100)}%${e!==1?`,${this.a}`:""})`}toHex(){return this.toRGBA().toHex()}toRGBA(){return I.fromHSLA(this.h,this.s,this.l,this.a)}toHSLA(){return this}toHSVA(){return this.toRGBA().toHSVA()}toXYZA(){return this.toRGBA().toXYZA()}toLUVA(){return this.toRGBA().toLUVA()}targetLuminance(e){let a=this.s,p=0,C=1;a*=Math.pow(this.l>.5?-this.l:this.l-1,7)+1;let m=(C-p)/2,x=p+m;for(;m>152587890625e-16;m/=2,x=p+m)I.fromHSLA(this.h,a,x,1).luminance()>e?C=x:p=x;return new i(this.h,a,x,this.a)}};G(i,"HSLAColor");let z=i;const v=(l=class{constructor(e,a,p,C){this.x=e||0,this.y=a||0,this.z=p||0,this.a=C||0}eq(e,a=!1){return e instanceof l?this.x===e.x&&this.y===e.y&&this.z===e.z&&(a||this.a===e.a):e?this.eq(e.toXYZA(),a):!1}_x(e){return new l(e,this.y,this.z,this.a)}_y(e){return new l(this.x,e,this.z,this.a)}_z(e){return new l(this.x,this.y,e,this.a)}_a(e){return new l(this.x,this.y,this.z,e)}static fromRGBA(e,a,p,C){const m=B(e/255),x=B(a/255),$=B(p/255);return new l(.412453*m+.35758*x+.180423*$,.212671*m+.71516*x+.072169*$,.019334*m+.119193*x+.950227*$,C===void 0?1:C)}static fromLUVA(e,a,p,C){const m=1/(l.WHITE.x+15*l.WHITE.y+3*l.WHITE.z),x=4*l.WHITE.x*m,$=9*l.WHITE.y*m,r=e>8?Math.pow((e+16)/116,3):e/l.KAPPA,c=1/3*(52*e/(a+13*e*x)-1),b=-5*r,k=-1/3,h=r*(39*e/(p+13*e*$)-5),M=(h-b)/(c-k),L=M*c+b;return new l(M,r,L,C===void 0?1:C)}toCSS(){return this.toRGBA().toCSS()}toHex(){return this.toRGBA().toHex()}toRGBA(){return I.fromXYZA(this.x,this.y,this.z,this.a)}toHSLA(){return this.toRGBA().toHSLA()}toHSVA(){return this.toRGBA().toHSVA()}toXYZA(){return this}toLUVA(){return u.fromXYZA(this.x,this.y,this.z,this.a)}},G(l,"_XYZAColor2"),l);v.EPSILON=Math.pow(.20689655172413793,3),v.KAPPA=Math.pow(9.666666666666666,3),v.WHITE=null;let f=v;f.WHITE=new I(255,255,255,1).toXYZA();const w=class w{constructor(e,a,p,C){this.l=e||0,this.u=a||0,this.v=p||0,this.a=C||0}eq(e,a=!1){return e instanceof w?this.l===e.l&&this.u===e.u&&this.v===e.v&&(a||this.a===e.a):e?this.eq(e.toLUVA(),a):!1}_l(e){return new w(e,this.u,this.v,this.a)}_u(e){return new w(this.l,e,this.v,this.a)}_v(e){return new w(this.l,this.u,e,this.a)}_a(e){return new w(this.l,this.u,this.v,e)}static fromXYZA(e,a,p,C){const m=1/(f.WHITE.x+15*f.WHITE.y+3*f.WHITE.z),x=4*f.WHITE.x*m,$=9*f.WHITE.y*m,r=a/f.WHITE.y;let c=e+15*a+3*p;c===0&&(c=1);const b=1/c,k=4*e*b,h=9*a*b,M=r>f.EPSILON?116*Math.pow(r,1/3)-16:f.KAPPA*r,L=13*M*(k-x),T=13*M*(h-$);return new w(M,L,T,C===void 0?1:C)}toCSS(){return this.toRGBA().toCSS()}toHex(){return this.toRGBA().toHex()}toRGBA(){return this.toXYZA().toRGBA()}toHSLA(){return this.toRGBA().toHSLA()}toHSVA(){return this.toRGBA().toHSVA()}toXYZA(){return f.fromLUVA(this.l,this.u,this.v,this.a)}toLUVA(){return this}};G(w,"LUVAColor");let u=w;const y={CVDMatrix:{protanope:[0,2.02344,-2.52581,0,1,0,0,0,1],deuteranope:[1,0,0,.494207,0,1.24827,0,0,1],tritanope:[1,0,0,0,1,0,-.395913,.801109,0]},getCanvas(){return y._canvas||(y._canvas=document.createElement("canvas")),y._canvas},getContext:()=>(y._context||(y._context=y.getCanvas().getContext("2d")),y._context),RGBA:I,HSVA:U,HSLA:z,XYZA:f,LUVA:u,fromCSS(o){return I.fromCSS(o)}},_=class _{constructor(e="#232323",a=0,p=4.5){this._dark=!1,this._cache=new Map,this._luv=0,this._luma=0,this._contrast=p,this._base=e,this._mode=a,this.rebuildContrast()}get contrast(){return this._contrast}set contrast(e){this._contrast=e,this.rebuildContrast()}get base(){return this._base}set base(e){this._base=e,this.rebuildContrast()}get dark(){return this._dark}get mode(){return this._mode}set mode(e){this._mode=e,this.rebuildContrast()}rebuildContrast(){this._cache=new Map;const e=I.fromCSS(this._base);if(!e)throw new Error("Invalid base color");const a=e.luminance();(this._dark=a<.5)?(this._luv=new f(0,this._contrast*(e.toXYZA().y+.05)-.05,0,1).toLUVA().l,this._luma=this._contrast*(e.luminance()+.05)-.05):(this._luv=new f(0,(e.toXYZA().y+.05)/this._contrast-.05,0,1).toLUVA().l,this._luma=(e.luminance()+.05)/this._contrast-.05)}process(e,a=!1){if(!e)return null;if(this._mode===-1)return"";if(typeof e!="string"&&(e=e.toCSS()),this._mode===0)return e;if(this._cache.has(e))return this._cache.get(e);let p;try{p=I.fromCSS(e)}catch(m){if(a)throw m;return null}if(!p)return null;if(this._mode===1){const m=p.luminance();(this._dark?m<this._luma:m>this._luma)&&(p=p.toHSLA().targetLuminance(this._luma).toRGBA())}else if(this._mode===2){const m=p.toLUVA();(this._dark?m.l<this._luv:m.l>this._luv)&&(p=m._l(this._luv).toRGBA())}else if(this._mode===3)if(this._dark)for(;p.get_Y()<.5;){const m=p.toHSLA();p=m._l(Math.min(Math.max(0,.1+.9*m.l),1)).toRGBA()}else for(;p.get_Y()>=.5;){const m=p.toHSLA();p=m._l(Math.min(Math.max(0,.9*m.l),1)).toRGBA()}else if(this._mode===4){let m=0;if(this._dark)for(;p.luminance()<.15&&m++<127;)p=p.brighten();else for(;p.luminance()>.3&&m++<127;)p=p.brighten(-1)}const C=p.toCSS();return this._cache.set(e,C),C}};G(_,"ColorAdjuster");let S=_},45866:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>U});var W=d(72167),B=d.n(W),R=d(22527),I=d(46949);const z=class z extends R.default{constructor(f,u){super(f,u),this.fine=null,this.inject("..fine"),this.__routes=[],this.routes={},this.route_names={},this.current=null,this.current_name=null,this.current_state=null,this.match=null,this.location=null}onEnable(){const f=this.fine.searchTree(null,y=>y.props&&y.props.history),u=this.history=f&&f.props&&f.props.history;if(!u)return(0,I.sleep)(50).then(()=>this.onEnable());u.listen(y=>{this.enabled&&this._navigateTo(y)}),this._navigateTo(u.location)}navigate(f,u,y,S){this.history.push(this.getURL(f,u,y),S)}_navigateTo(f){this.log.debug("New Location",f);const u=window.location.host,y=f.pathname,S=f.search,n=f.state;y===this.location&&u===this.domain&&S===this.search&&(0,I.deep_equals)(n,this.current_state)||(this.old_location=this.location,this.old_search=this.search,this.old_domain=this.domain,this.old_state=this.current_state,this.location=y,this.search=S,this.domain=u,this.current_state=n,this._pickRoute())}_pickRoute(){const f=this.location,u=this.domain;this.old_route=this.current,this.old_name=this.current_name,this.old_match=this.match;for(const y of this.__routes){if(y.domain&&y.domain!==u)continue;const S=y.regex.exec(f);if(S&&(!y.state_fn||y.state_fn(this.current_state))){this.log.debug("Matching Route",y,S),this.current=y,this.current_name=y.name,this.match=S,this.emit(":route",y,S);return}}this.current=this.current_name=this.match=null,this.emit(":route",null,null)}getURL(f,u,y,...S){const n=this.routes[f];if(!n)throw new Error(`unable to find route "${f}"`);if(typeof u!="object"){const s=[u,y,...S];u={};let i=0;for(const l of n.parts)if(l&&l.name&&(u[l.name]=s[i],i++,i>=s.length))break}return n.url(u,y)}getRoute(f){return this.routes[f]}getRoutes(){return this.routes}getRouteNames(){for(const f of Object.keys(this.getRoutes()))this.getRouteName(f);return this.route_names}getRouteName(f){return this.route_names[f]||(this.route_names[f]=f.replace(/^dash-([a-z])/,(u,y)=>`Dashboard: ${y.toLocaleUpperCase()}`).replace(/(^|-)([a-z])/g,(u,y,S)=>`${y?" ":""}${S.toLocaleUpperCase()}`)),this.route_names[f]}routeName(f,u,y=!0){if(typeof f=="object"){for(const S in f)(0,I.has)(f,S)&&this.routeName(S,f[S],!1);y&&this.emit(":updated-route-names");return}u&&(this.route_names[f]=u,y&&this.emit(":updated-route-names"))}route(f,u,y=null,S=null,n=!0){if(typeof f=="object"){y=u;for(const w in f)(0,I.has)(f,w)&&this.route(w,f[w],y,S,!1);n&&(this.__routes.sort((w,_)=>_.score-w.score),this.location&&this._pickRoute(),this.emit(":updated-routes"));return}const s=(0,W.parse)(u),i=s.reduce((w,_)=>w+(typeof _=="string"?_.split("/").length-1:0),0),l=this.routes[f]={name:f,parts:s,score:i,domain:y,state_fn:S,regex:(0,W.tokensToRegExp)(s),url:(0,W.tokensToFunction)(s)};this.__routes.push(l),n&&(this.__routes.sort((w,_)=>_.score-w.score),this.location&&this._pickRoute(),this.emit(":updated-routes"))}};G(z,"FineRouter");let U=z},98247:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>R});var W=d(17159),B=d(22527);const z=class z extends B.default{constructor(u,y){super(u,y),this._route=null,this._wrappers=new Map,this._known_classes=new Map,this._observer=null,this._waiting=[],this._live_waiting=null}async onEnable(u=0){this.root_element||(this.root_element=await this.parent.awaitElement(this.selector||"body #root"));let y=this.root_element?._reactRootContainer;if(y?._internalRoot?.current&&(y=y?._internalRoot),y?.current){this.react_root=y,this.react=y?.current?.child;return}if(this.root_element&&!y){let S=z.findAccessor(this.root_element,"__reactContainer");if(S){this.react_root=null,this.react=this.root_element[S];return}}if(u>500)throw new Error("Unable to find React after 25 seconds");return this.root_element=null,new Promise(S=>setTimeout(S,50)).then(()=>this.onEnable(u+1))}onDisable(){this.react_root=this.root_element=this.react=this.accessor=null}static findAccessor(u,y){for(const S in u)if(y?S.startsWith(`${y}$`):S.startsWith("__reactInternalInstance$")||S.startsWith("__reactFiber$"))return S;return null}resolveNode(u){return!u&&this.react?this.react:u instanceof Node?this.getReactInstance(u):u?._reactInternals?u._reactInternals:u?._reactInternalFiber?u._reactInternalFiber:u||null}getReactInstance(u){return this.accessor||(this.accessor=z.findAccessor(u)),this.accessor?u[this.accessor]??u._reactRootContainer?._internalRoot?.current??u._reactRootContainer?.current??null:null}getOwner(u){return u=this.resolveNode(u),u?.return??null}getParentNode(u,y=100,S=!1){return this.searchParent(u,n=>n instanceof Node,y,0,S)}getChildNode(u,y=100,S=!1){return this.searchTree(u,n=>n instanceof Node,y,0,S)}getHostNode(u,y=100){return this.getChildNode(u,y)}getParent(u){return this.getOwner(u)}getFirstChild(u){return this.resolveNode(u)?.child??null}getChildren(u){const y=this.resolveNode(u);if(!y)return[];const S=[];let n=y.child;for(;n;)S.push(n),n=n.sibling;return S}searchParent(u,y,S=15,n=0,s=!0){if(n>S)return null;const i=this.resolveNode(u);if(!i)return null;if(typeof y=="string"){const w=this._wrappers.get(y);if(!w)throw new Error("invalid critera");if(!w.class)return null;y=G(_=>_&&_.constructor===w.class,"criteria")}const l=i.stateNode;if(l&&y(l,i))return l;if(i.return){const w=this.searchParent(i.return,y,S,n+1,s);if(w)return w}if(s&&l?.containerInfo){const w=l.containerInfo?.parentElement,_=w&&this.getReactInstance(w);if(_){const o=this.searchParent(_,y,S,n+1,s);if(o)return o}}return null}searchParentNode(u,y,S=15,n=0,s=!0){if(n>S)return null;const i=this.resolveNode(u);if(!i)return null;if(y(i))return i;if(i.return){const w=this.searchParentNode(i.return,y,S,n+1,s);if(w)return w}const l=i.stateNode;if(s&&l?.containerInfo){const w=l.containerInfo?.parentElement,_=w&&this.getReactInstance(w);if(_){const o=this.searchParentNode(_,y,S,n+1,s);if(o)return o}}return null}searchNode(u,y,S=15,n=0,s=!0){if(n>S)return null;const i=this.resolveNode(u);if(!i)return null;if(y(i))return i;if(i._ffz_no_scan||i.stateNode?._ffz_no_scan)return null;let l=i.child;for(;l;){const _=this.searchNode(l,y,S,n+1,s);if(_)return _;l=l.sibling}const w=i.stateNode;if(s&&w?.props?.root){const _=w.props.root._reactRootContainer;if(_){let o=_._internalRoot?.current||_.current;for(;o;){const e=this.searchNode(o,y,S,n+1,s);if(e)return e;o=o.sibling}}}return null}searchTree(u,y,S=15,n=0,s=!0,i){const l=this.resolveNode(u);if(i&&!(i instanceof Set)&&(i=new Set),!l||n>S)return i||null;if(typeof y=="string"){const o=this._wrappers.get(y);if(!o)throw new Error("invalid critera");if(!o.class)return i||null;y=G(e=>e&&e.constructor===o.class,"criteria")}const w=l.stateNode;if(w&&y(w,l))if(i)i.add(w);else return w;if(l._ffz_no_scan||l.stateNode?._ffz_no_scan)return i||null;let _=l.child;for(;_;){const o=this.searchTree(_,y,S,n+1,s,i);if(o&&!i)return o;_=_.sibling}if(s&&w?.props?.root){const o=w.props.root._reactRootContainer;if(o){let e=o._internalRoot?.current||o.current;for(;e;){const a=this.searchTree(e,y,S,n+1,s,i);if(a&&!i)return a;e=e.sibling}}}return i||null}findAllMatching(u,y,S=15,n=!0,s=!1,i=0,l=!0){const w=new Set;let _=G((o,e)=>!w.has(o)&&y(o,e),"crit");for(;;){const o=s?this.searchParent(u,_,S,i,l):this.searchTree(u,_,S,i,l);if(!o)break;if(n&&!w.size){const e=o.constructor;_=G((a,p)=>!w.has(a)&&a instanceof e&&y(a,p),"crit")}w.add(o)}return w}searchAll(u,y,S=15,n=0,s=null,i=!0){const l=this.resolveNode(u);if(s||(s={seen:new Set,classes:y.map(()=>null),out:y.map(()=>({cls:null,instances:new Set,depth:null})),max_depth:n}),!l||n>S)return s.out;n>s.max_depth&&(s.max_depth=n);const w=l.stateNode;if(w){const o=w.constructor,e=s.classes.indexOf(o);if(e!==-1)s.out[e].instances.add(w);else if(!s.seen.has(o)){let a=y.length;for(;a-- >0;)if(y[a](w,l)){s.classes[a]=s.out[a].cls=o,s.out[a].instances.add(w),s.out[a].depth=n;break}s.seen.add(o)}}if(l._ffz_no_scan||l.stateNode?._ffz_no_scan)return s.out;let _=l.child;for(;_;)this.searchAll(_,y,S,n+1,s,i),_=_.sibling;if(i&&w?.props?.root){const o=w.props.root._reactRootContainer;if(o){let e=o._internalRoot&&o._internalRoot.current||o.current;for(;e;)this.searchAll(e,y,S,n+1,s,i),e=e.sibling}}return s.out}route(u){this._route=u,this._updateLiveWaiting()}_updateLiveWaiting(){const u=this._live_waiting=[],y=this._waiting_crit=[],S=this._route;if(this._waiting)for(const n of this._waiting)n.routes===!1||!n.criteria||(!S||!n.routes?.length||n.routes.includes(S))&&(u.push(n),y.push(n.criteria));this._live_waiting.length?this._waiting_timer||this._startWaiting():this._stopWaiting()}define(u,y,S=null){if(this._wrappers.has(u))return this._wrappers.get(u);if(!y)throw new Error("cannot find definition and no criteria provided");const n=new U(u,y,S,this);this._wrappers.set(u,n);const s=this.react?this.searchAll(this.react,[y],1e3)[0]:null;return s?.cls?(n._set(s.cls,s.instances),this._known_classes.set(s.cls,n)):S!==!1&&(this._waiting.push(n),this._updateLiveWaiting()),n}wrap(u,y){let S;if(this._wrappers.has(u)?S=this._wrappers.get(u):(S=new U(u,null,null,this),this._wrappers.set(u,S)),y){if(S.class||S.criteria)throw new Error("tried setting a class on an already initialized FineWrapper");S._set(y,new Set),this._known_classes.set(y,S)}return S}_checkWaiters(u=null){if(this._live_waiting){Array.isArray(u)||(u=[u]);for(let y of u){if(!this._live_waiting.length||!this._waiting_crit)break;let S=null;if(!y&&this.react?S=this.react:y instanceof Node?S=this.getReactInstance(y):y?._reactInternals?S=y._reactInternals:y?._reactInternalFiber&&(S=y._reactInternalFiber),!S||S._ffz_no_scan||S.stateNode?._ffz_no_scan)continue;const n=this.searchAll(S,this._waiting_crit,1e3);let s=n.length;for(;s-- >0;)if(n[s].cls){const i=n[s],l=this._live_waiting.splice(s,1)[0];this._waiting_crit.splice(s,1);const w=this._waiting.indexOf(l);w!==-1&&this._waiting.splice(w,1),this.log.debug(`Found class for "${l.name}" at depth ${i.depth}`),l._set(i.cls,i.instances)}}this._live_waiting.length||this._stopWaiting()}}_startWaiting(){this.log.info("Installing MutationObserver."),this._waiting_timer=setInterval(()=>this._checkWaiters(),500),this._observer||(this._observer=new MutationObserver(u=>this._checkWaiters(u.map(y=>y.target)))),this._observer.observe(document.body,{childList:!0,subtree:!0})}_stopWaiting(){this.log.info("Stopping MutationObserver."),this._observer&&this._observer.disconnect(),this._waiting_timer&&clearInterval(this._waiting_timer),this._live_waiting=null,this._waiting_crit=null,this._waiting_timer=null}};G(z,"Fine");let R=z;const I={"will-mount":"UNSAFE_componentWillMount",mount:"componentDidMount",render:"render","receive-props":"UNSAFE_componentWillReceiveProps","should-update":"shouldComponentUpdate","will-update":"UNSAFE_componentWillUpdate",update:"componentDidUpdate",unmount:"componentWillUnmount"},v=class v extends W.EventEmitter{constructor(u,y,S,n){super(),this.name=u,this.criteria=y,this.fine=n,this.instances=new Set,this.routes=S??[],this._wrapped=new Map,this._class=null}get class(){return this._class}get first(){return this.toArray()[0]}__cleanListeners(){const u=super.__cleanListeners();for(const y of u){const S=I[y];if(S)try{this._unwrap(S)}catch{}}return u}toArray(){return Array.from(this.instances)}check(u=null,y=1e3){if(this._class||!this.criteria)return;const S=this.fine.findAllMatching(u,this.criteria,y);if(S.size){const n=Array.from(S);this._set(n[0].constructor,n)}}ready(u){this._class?u(this._class,this.instances):this.once("set",u)}each(u){for(const y of this.instances)u(y)}updateInstances(u=null,y=1e3){if(!this._class)return;const S=this.fine.findAllMatching(u,n=>n.constructor===this._class,y);for(const n of S)n._ffz_mounted=!0,this.instances.add(n)}_set(u,y){if(this._class)throw new Error("already have a class");this._class=u,u._ffz_wrapper=this;const S=this,n=this.instances,s=u.prototype,i=s.UNSAFE_componentWillMount,l=s.componentWillUnmount,w=s.UNSAFE_componentWillMount=i?function(...o){return this._ffz_mounted=!0,n.add(this),S.emit("will-mount",this,...o),i.apply(this,o)}:function(...o){this._ffz_mounted=!0,n.add(this),S.emit("will-mount",this,...o)},_=s.componentWillUnmount=l?function(...o){return S.emit("unmount",this,...o),n.delete(this),this._ffz_mounted=!1,l.apply(this,o)}:function(...o){S.emit("unmount",this,...o),n.delete(this),this._ffz_mounted=!1};this._wrapped.set("UNSAFE_componentWillMount",[w,i]),this._wrapped.set("componentWillUnmount",[_,l]);for(const o of this.events())this._maybeWrap(o);if(y)for(const o of y)o._ffz_mounted=!0,n.add(o);this.emit("set",u,n)}_add(u){for(const y of u)this.instances.add(y)}_maybeWrap(u){const y=I[u];!this._class||!y||this._wrapped.has(y)||this._wrap(u,y)}_wrap(u,y){if(this._wrapped.has(y)||!this._class)return;const S=this,n=this._class.prototype,s=n[y],i=n[y]=s?function(...l){return this._ffz_mounted||(this._ffz_mounted=!0,S.instances.add(this),S.emit("late-mount",this)),S.emit(u,this,...l),s.apply(this,l)}:y==="shouldComponentUpdate"?function(...l){return this._ffz_mounted||(this._ffz_mounted=!0,S.instances.add(this),S.emit("late-mount",this)),S.emit(u,this,...l),!0}:function(...l){this._ffz_mounted||(this._ffz_mounted=!0,S.instances.add(this),S.emit("late-mount",this)),S.emit(u,this,...l)};this._wrapped.set(y,[i,s])}_unwrap(u){const y=this._wrapped.get(u);if(!y||!this._class)return;const S=this._class.prototype,[n,s]=y;if(S[u]!==n)throw new Error("unable to unwrap -- prototype modified");S[u]=s,this._wrapped.delete(u)}forceUpdate(){for(const u of this.instances)try{u.forceUpdate(),this.fine.emit("site:dom-update",this.name,u)}catch(y){y instanceof Error&&this.fine.log.capture(y,{tags:{fine_wrapper:this.name}}),this.fine.log.error(`An error occurred when calling forceUpdate on an instance of ${this.name}`,y)}}on(u,y,S,n,s=!1){return this._maybeWrap(u),super.on(u,y,S,n,s)}once(u,y,S,n,s=!1){return this._maybeWrap(u),super.once(u,y,S,n,s)}many(u,y,S,n,s,i=!1){return this._maybeWrap(u),super.many(u,y,S,n,s,i)}waitFor(u,y,S,n=!1){return this._maybeWrap(u),super.waitFor(u,y,S,n)}};G(v,"FineWrapper");let U=v},24431:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{API_SERVER:()=>z,BAD_HOTKEYS:()=>s,DEBUG:()=>W,EMQX_SERVERS:()=>$,EXTENSION:()=>B,EmoteTypes:()=>O,IS_FIREFOX:()=>k,IS_OSX:()=>r,IS_WEBKIT:()=>b,IS_WIN:()=>c,KEYS:()=>_,KNOWN_CODES:()=>e,LINK_DATA_HOSTS:()=>m,NEW_API:()=>u,PUBSUB_CLUSTERS:()=>x,REPLACEMENTS:()=>p,REPLACEMENT_BASE:()=>a,RERENDER_SETTINGS:()=>i,RESOLVERS_REQUIRE_TOS:()=>P,SENTRY_ID:()=>y,SERVER:()=>R,SERVER_OR_EXT:()=>U,STAGING_API:()=>v,STAGING_CDN:()=>f,TWITCH_EMOTE_V2:()=>o,TWITCH_GLOBAL_SETS:()=>M,TWITCH_POINTS_SETS:()=>L,TWITCH_PRIME_SETS:()=>T,UPDATE_BADGE_SETTINGS:()=>l,UPDATE_TOKEN_SETTINGS:()=>w,WEBKIT_CSS:()=>h,WEIRD_EMOTE_SIZES:()=>n,WORD_SEPARATORS:()=>S,WS_CLUSTERS:()=>C});const W=localStorage.ffzDebugMode==="true"&&document.body.classList.contains("ffz-dev"),B=!0,R=W?"https://localhost:8000":"https://cdn2.frankerfacez.com";let I=`${R}/script`;B&&(I=d.p,I.endsWith("/")&&(I=I.slice(0,I.length-1)));const U=I,z="https://api.frankerfacez.com",v="https://api-staging.frankerfacez.com",f="https://cdn-staging.frankerfacez.com",u="https://api2.frankerfacez.com",y="https://74b46b3894114f399d51949c6d237489@sentry.frankerfacez.com/2",S="[\\s`~<>!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}\\u00A1\\u00A7\\u00AB\\u00B6\\u00B7\\u00BB\\u00BF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0AF0\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E3B\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65]",n={15:[21,27],16:[22,27],17:[20,27],18:[20,27],22:[19,27],25:[25,28],26:[20,27],28:[39,27],30:[29,27],32:[21,27],33:[25,32],34:[21,28],36:[36,30],40:[21,27],41:[19,27],46:[24,24],47:[24,24],50:[18,27],52:[32,32],65:[40,30],66:[20,27],69:[41,28],73:[21,30],74:[24,30],86:[36,30],87:[24,30],92:[23,30],244:[24,30],354:[20,30],357:[28,30],360:[22,30],483:[20,18],484:[20,22],485:[27,18],486:[21,32],487:[15,32],488:[29,24],489:[20,18],490:[20,18],491:[20,18],492:[20,18],493:[20,18],494:[20,18],495:[20,18],496:[20,18],497:[20,18],498:[20,18],499:[20,18],500:[20,18],501:[20,18],1896:[20,30],1898:[26,28],1899:[22,30],1900:[33,30],1901:[24,28],1902:[27,29],1904:[24,30],1906:[24,30]},s=["f","space","k","shift+up","shift+down","esc","m","?","alt+t","alt+x"],i=["chat.name-format","chat.me-style","chat.rituals.show","chat.subs.show","chat.subs.compact","chat.actions.inline","chat.actions.hover","chat.timestamp-format","chat.points.allow-highlight","chat.filtering.display-deleted","chat.filtering.display-mod-action","chat.replies.style","chat.bits.cheer-notice","chat.filtering.hidden-tokens","chat.hype.message-style","chat.filtering.show-reasons","chat.emotes.allow-gigantify","chat.shared-chat.username-tooltip","chat.shared-chat.style"],l=["chat.badges.style","chat.badges.hidden","chat.badges.custom-mod","chat.badges.custom-vip"],w=["chat.emotes.enabled","chat.emotes.2x","chat.emotes.animated","chat.emoji.style","chat.emoji.replace-joiner","chat.bits.stack","chat.rich.enabled","chat.rich.want-mid","chat.rich.hide-tokens","chat.rich.all-links","chat.rich.minimum-level","chat.filtering.process-own","chat.filtering.mention-priority","chat.filtering.debug","chat.fix-bad-emotes","__filter:highlight-terms","__filter:highlight-users","__filter:highlight-badges","__filter:block-terms","__filter:block-users","__filter:block-badges"],_={Tab:9,Enter:13,Shift:16,Control:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Meta:91,Context:93},o="//static-cdn.jtvnw.net/emoticons/v2",e={"#-?[\\\\/]":"#-/",":-?(?:7|L)":":-7","\\&lt\\;\\]":"<]","\\:-?(S|s)":":-S","\\:-?\\\\":":-\\","\\:\\&gt\\;":":>","B-?\\)":"B-)","\\:-?[z|Z|\\|]":":-Z","\\:-?\\)":":-)","\\:-?\\(":":-(","\\:-?(p|P)":":-P","\\;-?(p|P)":";-P","\\&lt\\;3":"<3","\\:-?[\\\\/]":":-/","\\;-?\\)":";-)","R-?\\)":"R-)","[oO](_|\\.)[oO]":"O.o","[o|O](_|\\.)[o|O]":"O.o","\\:-?D":":-D","\\:-?(o|O)":":-O","\\&gt\\;\\(":">(","Gr(a|e)yFace":"GrayFace"},a=`${R}/static/replacements/`,p={15:"15-JKanStyle.png",16:"16-OptimizePrime.png",17:"17-StoneLightning.png",18:"18-TheRinger.png",22:"22-RedCoat.png",26:"26-JonCarnage.png",30:"30-BCWarrior.png",33:"33-DansGame.png",36:"36-PJSalt.png"},C={Production:[["wss://catbag.frankerfacez.com/",.25],["wss://andknuckles.frankerfacez.com/",.8],["wss://tuturu.frankerfacez.com/",.7],["wss://lilz.frankerfacez.com/",1],["wss://yoohoo.frankerfacez.com/",1],["wss://pog.frankerfacez.com/",1],["wss://ayaya.frankerfacez.com/",1],["wss://champ.frankerfacez.com/",1]],Development:[["ws://127.0.0.1:7999/",1]]},m={localhost:{title:"Local Dev Server (Port 8002)",value:"https://localhost:8002",has_sse:!0},"localhost-cf":{title:"Local Dev Worker (Wrangler, Port 8787)",value:"https://localhost:8787"},Production:{title:"Production",value:"https://link-service.workers.frankerfacez.com"}},x={Production:"https://pubsub.frankerfacez.com",Staging:"https://pubsub-staging-alt.frankerfacez.com",EMQXTest:"emqx-test",Development:"https://stendec.dev/ps/"},$=["biblethump.frankerfacez.com"],r=navigator.platform?navigator.platform.indexOf("Mac")!==-1:/OS X/.test(navigator.userAgent),c=navigator.platform?navigator.platform.indexOf("Win")!==-1:/Windows/.test(navigator.userAgent),b=navigator.userAgent.indexOf("AppleWebKit/")!==-1&&navigator.userAgent.indexOf("Edge/")===-1,k=navigator.userAgent.indexOf("Firefox/")!==-1,h=b?"-webkit-":"",M=[0,33,42],L=[300238151],T=[457,793,19151,19194];var O=(j=>(j[j.Unknown=0]="Unknown",j[j.Prime=1]="Prime",j[j.Turbo=2]="Turbo",j[j.LimitedTime=3]="LimitedTime",j[j.ChannelPoints=4]="ChannelPoints",j[j.Unavailable=5]="Unavailable",j[j.Subscription=6]="Subscription",j[j.BitsTier=7]="BitsTier",j[j.Global=8]="Global",j[j.TwoFactor=9]="TwoFactor",j[j.Follower=10]="Follower",j))(O||{});const P={YouTube:{label:"You must agree to the YouTube Terms of Service to view this embed.",i18n_key:"embed.warn.youtube",i18n_links:"embed.warn.youtube.links",links:`To view YouTube embeds, you must agree to YouTube's Terms of Service:
* [Terms of Service](https://www.youtube.com/t/terms)
* [Privacy Policy](https://policies.google.com/privacy)`,i18n_accept:"embed.warn.youtube.agree",accept:"Yes, I accept the YouTube Terms of Service."}}},94417:(ae,J,d)=>{var f;"use strict";d.r(J),d.d(J,{Dialog:()=>z,default:()=>v,getDialogNextZ:()=>I});var W=d(17159),B=d(89196);let R=9e3;function I(){return R++}G(I,"getDialogNextZ");const U=(f=class extends W.EventEmitter{constructor(y,S={}){super(),this.selectors={exclusive:f.EXCLUSIVE,maximized:f.MAXIMIZED,normal:f.SELECTOR},S.selectors&&(this.selectors=Object.assign(this.selectors,S.selectors)),this._maximized=S.maximized||!1,this._exclusive=S.exclusive||!1,this.prepend=S.prepend||!1,this._element=null,this._visible=!1,typeof y=="function"?this.factory=y:this.element=y}get maximized(){return this._exclusive||this._maximized}set maximized(y){y=!!y,y!==this._maximized&&(this._visible?this.toggleSize():this._maximized=y)}get visible(){return this._visible}set visible(y){y=!!y,y!==this._visible&&this.toggleVisible()}get exclusive(){return this._exclusive}set exclusive(y){if(this._visible)throw new Error("cannot set exclusive flag when dialog already visible");this._exclusive=y}get element(){return this._element}set element(y){if(this._visible)throw new Error("cannot change element when dialog already visible");if(!(y instanceof Node))throw new Error("element must be an instance of Node");this._element=y}show(){this.visible=!0}hide(){this.visible=!1}maximize(){this.maximized=!0}restore(){this.maximized=!1}getContainer(){return document.querySelector(this._exclusive?this.selectors.exclusive:this._maximized?this.selectors.maximized:this.selectors.normal)}toggleVisible(y){if(y&&y.button!==0)return;const S=this.maximized,n=this._visible=!this._visible,s=this.getContainer();if(S&&s&&s.classList.toggle("ffz-has-dialog",n),!n){this._element&&this._element.remove(),this.emit("hide"),this.factory&&(this._element=null);return}if(s){if(this.factory){const i=this.factory();if(i instanceof Promise){i.then(l=>{this._element=l,this.prepend?s.insertBefore(l,s.firstChild):s.appendChild(l),this.emit("show")}).catch(l=>{this.emit("error",l)});return}else this._element=i}this._element&&(this.prepend?s.insertBefore(this._element,s.firstChild):s.appendChild(this._element),this.emit("show"))}}toggleSize(y){if(!this._visible||y&&y.button!==0||!this._element)return;this._maximized=!this._maximized;const S=this.maximized,n=this.getContainer(),s=this._element.parentElement;n!==s&&(S?n&&n.classList.add("ffz-has-dialog"):s&&s.classList.remove("ffz-has-dialog"),this._element.remove(),n&&(this.prepend?n.insertBefore(this._element,n.firstChild):n.appendChild(this._element)),this.emit("resize"))}},G(f,"_Dialog2"),f);U.EXCLUSIVE=B.Z.DIALOG_EXCLUSIVE,U.MAXIMIZED=B.Z.DIALOG_MAXIMIZED,U.SELECTOR=B.Z.DIALOG_SELECTOR;let z=U;const v=z},44589:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{ClickOutside:()=>e,ManagedStyle:()=>o,createElement:()=>y,findReactFragment:()=>u,hasSharedParent:()=>n,highlightJson:()=>a,off:()=>f,on:()=>v,openFile:()=>s,readFile:()=>i,sanitize:()=>w,setChildren:()=>S});var W=d(46949),B=d(24431);const R=["accept","accept-charset","accesskey","action","align","alt","async","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","crossorigin","data","data-*","datetime","default","defer","dir","dirname","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","integrity","ismap","itemprop","keytype","kind","label","lang","language","list","loop","low","manifest","max","maxlength","minlength","media","method","min","multiple","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","rel","required","reversed","rows","rowspan","sandbox","scope","scoped","seamless","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","type","usemap","value","width","wrap"],I=["controls","autoplay","loop"],U=document.createRange();function z(m){return m.replace(/[-_]\w/g,x=>x[1].toUpperCase())}G(z,"camelCase");function v(m,x,$,r){return m.addEventListener(x,$,r)}G(v,"on");function f(m,x,$,r){return m.removeEventListener(x,$,r)}G(f,"off");function u(m,x,$=25,r=0,c){if(!c)c=new Set;else if(c.has(m))return null;if(x(m))return m;if(r>=$)return null;if(c.add(m),m?.props?.children)if(Array.isArray(m.props.children)){for(const b of m.props.children)if(b)if(Array.isArray(b))for(const k of b){const h=u(k,x,$,r+1,c);if(h)return h}else{const k=u(b,x,$,r+1,c);if(k)return k}}else{const b=u(m.props.children,x,$,r+1,c);if(b)return b}return null}G(u,"findReactFragment");function y(m,x,...$){const r=document.createElement(m);if($.length===0?$=null:$.length===1&&($=$[0]),typeof x=="string")r.className=x;else if(x){for(const c in x)if((0,W.has)(x,c)){const b=c.toLowerCase(),k=x[c];if(b==="style")if(typeof k=="string")r.style.cssText=k;else if(k&&typeof k=="object")for(const[h,M]of Object.entries(k))(0,W.has)(r.style,h)||(0,W.has)(Object.getPrototypeOf(r.style),h)?r.style[h]=M:r.style.setProperty(h,k[h]);else B.DEBUG&&k!=null&&console.warn("unsupported style value",k);else if(b==="dataset")if(k&&typeof k=="object")for(const h in k)(0,W.has)(k,h)&&(r.dataset[z(h)]=k[h]);else B.DEBUG&&k!=null&&console.warn("unsupported dataset value",k);else c==="dangerouslySetInnerHTML"?k&&k.__html&&(r.innerHTML=k.__html):b.startsWith("on")?r.addEventListener(b.slice(2),k):b.startsWith("data-")?r.dataset[z(b.slice(5))]=k:I.includes(b)?k&&k!=="false"&&r.setAttribute(c,k):b.startsWith("aria-")||R.includes(b)?r.setAttribute(c,k):r[c]=k}}return $&&S(r,$),r}G(y,"createElement");function S(m,x,$=!1,r=!1){if($&&window.FrankerFaceZ.get().log.warn("call to setChildren with no_sanitize set to true -- this is no longer supported"),x instanceof Node)r||(m.innerHTML=""),m.appendChild(x);else if(Array.isArray(x)){r||(m.innerHTML="");for(const c of x)if(c instanceof Node)m.appendChild(c);else if(Array.isArray(c))S(m,c,$,!0);else if(c){const b=typeof c=="string"?c:String(c);m.appendChild(document.createTextNode(b))}}else if(x){const c=typeof x=="string"?x:String(x);m.appendChild(document.createTextNode(c))}}G(S,"setChildren");function n(m,x,$){for(;m;){if(m.contains(x))return!0;m=m.parentElement,$&&(m=m instanceof Element?m.closest($):null)}return!1}G(n,"hasSharedParent");function s(m,x){return new Promise($=>{const r=document.createElement("input");r.type="file",r.accept=m,r.multiple=x;let c=!1;r.onchange=()=>{if(!c){c=!0;const b=Array.from(r.files??[]);$(x?b:b[0])}},r.click()})}G(s,"openFile");function i(m,x="utf-8"){return new Promise(($,r)=>{const c=new FileReader;c.readAsText(m,x),c.onload=()=>$(c.result),c.onerror=b=>r(b)})}G(i,"readFile");const l=document.createElement("span");function w(m){l.textContent=m;const x=l.innerHTML;return l.textContent="",x}G(w,"sanitize");let _=0;const p=class p{constructor(x){this.id=x||_++,this._blocks={},this._style=y("style",{type:"text/css",id:`ffz--managed-style--${this.id}`}),document.head.appendChild(this._style)}destroy(){this._style&&this._style.remove(),this._blocks=null,this._style=null}clear(){this._blocks={},this._style.innerHTML=""}get(x){const $=this._blocks[x];if($)return $.textContent}has(x){return!!this._blocks[x]}set(x,$,r=!1){const c=this._blocks[x];if(c){if(!r&&c.textContent===$)return;c.textContent=$}else this._style.appendChild(this._blocks[x]=document.createTextNode($))}delete(x){const $=this._blocks[x];$&&(this._style.contains($)&&this._style.removeChild($),this._blocks[x]=null)}};G(p,"ManagedStyle");let o=p;const C=class C{constructor(x,$){this.el=x,this.cb=$,this._fn=this.handleClick.bind(this),document.documentElement.addEventListener("click",this._fn)}destroy(){this._fn&&document.documentElement.removeEventListener("click",this._fn),this.cb=this.el=this._fn=null}handleClick(x){this.cb&&this.el&&!this.el.contains(x.target)&&this.cb(x)}};G(C,"ClickOutside");let e=C;function a(m,x=!1,$=1,r=30){let c="",b="";if(x&&(c="    ".repeat($-1),b="    ".repeat($)),$>r)return'<span class="ffz-ct--obj-literal">&lt;nested&gt;</span>';if(m==null)return`<span class="ffz-ct--literal" depth="${$}">null</span>`;if(typeof m=="number"||typeof m=="boolean")return`<span class="ffz-ct--literal" depth="${$}">${m}</span>`;if(typeof m=="string")return`<span class=ffz-ct--string depth="${$}">${w(JSON.stringify(m))}</span>`;if(Array.isArray(m))return`<span class="ffz-ct--obj-open" depth="${$}">[</span>`+(m.length>0?m.map(h=>(x?`
${b}`:"")+a(h,x,$+1,r)).join(`<span class="ffz-ct--obj-sep" depth="${$}">, </span>`)+(x?`
${c}`:""):"")+`<span class="ffz-ct--obj-close" depth="${$}">]</span>`;const k=[];for(const[h,M]of Object.entries(m))k.length>0&&k.push(`<span class="ffz-ct--obj-sep" depth="${$}">, </span>`),x&&k.push(`
${b}`),k.push(`<span class="ffz-ct--obj-key" depth="${$}">${w(JSON.stringify(h))}</span><span class="ffz-ct--obj-key-sep" depth="${$}">: </span>`),k.push(a(M,x,$+1,r));return`<span class="ffz-ct--obj-open" depth="${$}">{</span>${k.join("")}${k.length&&x?`
${c}`:""}<span class="ffz-ct--obj-close" depth="${$}">}</span>`}G(a,"highlightJson")},17159:(ae,J,d)=>{var n;"use strict";d.r(J),d.d(J,{Detach:()=>W,EventEmitter:()=>v,FFZEvent:()=>f,FFZWaitableEvent:()=>u,HierarchicalEventEmitter:()=>y,StopPropagation:()=>B,default:()=>S});const W=Symbol("Detach"),B=Symbol("StopPropagation"),R=/([a-z])([A-Z])/g,I=/[ \t\W]/g,U=/^_+|_+$/g;String.prototype.toSlug=function(w="-"){let _=this;return _.normalize&&(_=_.normalize("NFD")),_.replace(/[\u0300-\u036f]/g,"").trim().toLowerCase().replace(/[^a-z0-9 ]/g,"").replace(/\s+/g,w)},String.prototype.toSnakeCase=function(){let w=this;return w.normalize&&(w=w.normalize("NFD")),w.replace(/[\u0300-\u036f]/g,"").trim().replace(R,"$1_$2").replace(I,"_").replace(U,"").toLowerCase()};const z=(n=class{constructor(){this.__listeners={},this.__running=new Set,this.__dead_events=0}__cleanListeners(){if(!this.__dead_events)return[];const _={},o=this.__listeners,e=[];for(const[a,p]of Object.entries(o))p?.length?_[a]=p:e.push(a);return this.__listeners=_,this.__dead_events=0,e}__sortListeners(_){if(this.__running.has(_))return;const o=this.__listeners[_];o&&o.sort((e,a)=>e[3]-a[3])}transferListeners(_){if(!(_ instanceof n))throw new Error("other must also be EventEmitter");if(!(_.events().length+_.__running.size)){_.__listeners=this.__listeners,_.__dead_events=this.__dead_events,this.__listeners={},this.__dead_events=0;return}for(const[e,a]of Object.entries(this.__listeners)){if(!a||!a.length)continue;let p=_.__listeners[e];Array.isArray(p)?(p.push(...a),_.__sortListeners(e)):_.__listeners[e]=a}this.__listeners={},this.__dead_events=0}makeEvent(_){return f.makeEvent(_)}makeWaitableEvent(_){return u.makeEvent(_)}on(_,o,e,a,p=!1){if(typeof o!="function")throw new TypeError("fn must be a function");const C=[o,e,!1,a??0,p],m=this.__listeners[_];return m?(p?m.unshift(C):m.push(C),this.__sortListeners(_)):this.__listeners[_]=[C],this}once(_,o,e,a,p=!1){return this.many(_,1,o,e,a,p)}many(_,o,e,a,p,C=!1){if(typeof e!="function")throw new TypeError("fn must be a function");if(typeof o!="number"||isNaN(o)||!isFinite(o)||o<1)throw new TypeError("ttl must be a positive, finite number");const m=[e,a,o,p??0,C],x=this.__listeners[_];return x?(C?x.unshift(m):x.push(m),this.__sortListeners(_)):this.__listeners[_]=[m],this}waitFor(_,o,e,a=!1){return new Promise(p=>{const C=[(...x)=>p(x),o,1,e??0,a],m=this.__listeners[_];m?(a?m.unshift(C):m.push(C),this.__sortListeners(_)):this.__listeners[_]=[C]})}off(_,o,e){if(_==null){if(!o&&!e)throw new Error("you must provide at least one constraint when removing listeners");for(const p in Object.keys(this.__listeners))this.__running.has(p)||this.off(p,o,e);return this}if(this.__running.has(_))throw new Error("concurrent modification: tried removing event listener while event is running");let a=this.__listeners[_];return a?(!o&&!e?a=null:(a=a.filter(([p,C])=>!((!o||p===o)&&(!e||e===C))),a.length||(a=null)),this.__listeners[_]=a,a||this.__dead_events++,this):this}offContext(_,o){return this.off(_,void 0,o)}events(){return this.__cleanListeners(),Object.keys(this.__listeners)}listeners(_){const o=this.__listeners[_];return o?Array.from(o):[]}hasListeners(_){return!!this.__listeners[_]}emit(_,...o){let e=this.__listeners[_];if(!e)return;if(this.__running.has(_))throw new Error("concurrent access: tried to emit event while event is running");const a=new Set;this.__listeners[_]=null,this.__running.add(_);for(const m of e){const[x,$,r]=m;let c;try{c=x.apply($,o)}catch(b){this.log&&(this.log.capture(b,{tags:{event:_},extra:{args:o}}),this.log.error(b))}if(c===W?a.add(m):r!==!1&&(r<=1?a.add(m):m[2]=r-1),c instanceof Promise&&o[0]instanceof u&&o[0].waitFor(c),o[0]instanceof f&&o[0].propagationStopped||c===B)break}if(a.size)for(const m of a){const x=e.indexOf(m);x!==-1&&e.splice(x,1)}let p=!1;const C=this.__listeners[_];C&&(e=e.concat(C),p=!0),e.length?this.__listeners[_]=e:(this.__listeners[_]=null,this.__dead_events++),this.__running.delete(_),p&&this.__sortListeners(_)}},G(n,"_EventEmitter2"),n);z.Detach=W,z.StopPropagation=B;let v=z;const s=class s{static makeEvent(_){return new s(_)}constructor(_){this.defaultPrevented=!1,this.propagationStopped=!1,Object.assign(this,_)}_reset(){this.defaultPrevented=!1,this.propagationStopped=!1}stopPropagation(){this.propagationStopped=!0}preventDefault(){this.defaultPrevented=!0}};G(s,"FFZEvent");let f=s;const i=class i extends f{constructor(){super(...arguments),this.__waiter_results=null}static makeEvent(_){return new i(_)}_wait(){if(this.__waiter)return this.__waiter;if(!this.__promises){const o=this.__waiter_results;return this.__waiter_results=null,o?Promise.resolve(o):null}const _=this.__promises;return this.__promises=null,this.__waiter=Promise.all(_).then(o=>(this.__waiter_results?this.__waiter_results.push(...o):this.__waiter_results=o,this.__waiter=null,this._wait()??[])).catch(o=>{throw this.__waiter=null,o})}_reset(){super._reset(),this.__waiter=null,this.__waiter_results=null,this.__promises=null}waitFor(_){this.__promises?this.__promises.push(_):this.__promises=[_]}};G(i,"FFZWaitableEvent");let u=i;const l=class l extends v{constructor(_,o){super(),this.name=_||(this.constructor.name||"").toSnakeCase(),this.parent=o,o?(this.root=o.root,this.__listeners=o.__listeners,this.__running=o.__running,this.__path=_&&o.__path?`${o.__path}.${_}`:_):(this.root=this,this.__path=void 0),this.__path_parts=this.__path?this.__path.split("."):[]}get path(){return this.__path}transferListeners(_){if(!(_ instanceof l&&_.root===this.root))throw new Error("Transfering listeners from a HierarchicalEventEmitter is not supported.")}abs_path(_){if(typeof _!="string"||!_.length)throw new TypeError("path must be a non-empty string");let o=0,e;const a=this.__path_parts,p=a.length;do{if(e=_.charAt(o),_.charAt(o)==="."){if(o>p)throw new Error("invalid path: reached top of stack");continue}break}while(++o<_.length);const C=e===":";if(o===0)return C&&this.__path?`${this.__path}${_}`:_;const m=a.slice(0,p-(o-1)).join("."),x=_.slice(o);if(m.length)if(x.length){if(C)return m+x}else return m;else return x;return`${m}.${x}`}on(_,o,e,a,p=!1){return super.on(this.abs_path(_),o,e,a,p)}once(_,o,e,a,p=!1){return super.once(this.abs_path(_),o,e,a,p)}many(_,o,e,a,p,C=!1){return super.many(this.abs_path(_),o,e,a,p,C)}waitFor(_,o,e,a=!1){return super.waitFor(this.abs_path(_),o,e,a)}off(_,o,e){return super.off(_&&this.abs_path(_),o,e)}listeners(_){return super.listeners(this.abs_path(_))}hasListeners(_){return super.hasListeners(this.abs_path(_))}emit(_,...o){return super.emit(this.abs_path(_),...o)}eventsWithChildren(){const _=super.events(),o=this.__path||"",e=o.length;return _.filter(a=>{const p=a.charAt(e);return a.startsWith(o)&&(p===""||p==="."||p===":")})}events(){const _=super.events(),o=this.__path||"",e=o.length;return _.filter(a=>{const p=a.charAt(e);return a.startsWith(o)&&(p===""||p===":")})}};G(l,"HierarchicalEventEmitter");let y=l;const S=y},37087:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{createTester:()=>W});function W(B,R,I=!1,U=!1,z){if(!Array.isArray(B)||!R)return I?()=>!1:()=>!0;const v=[],f=[];let u=0;for(const y of B){if(!y||!y.type)continue;const S=R[y.type];if(!S){u++,v.push(()=>!1),f.push(`f${u}`);continue}const n=S.createTest(y.data,R,z);n&&(u++,v.push(n),f.push(`f${u}`))}return v.length?v.length===1?I?y=>!v[0](y):v[0]:new Function(...f,"ctx",`return ${I?"!(":""}${f.map(y=>`${y}(ctx)`).join(U?" || ":" && ")}${I?")":""};`).bind(null,...v):I?()=>!1:()=>!0}G(W,"createTester")},61892:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{ALIASES:()=>R,ICONS:()=>I,load:()=>z,maybeLoad:()=>v});var W=d(44589);const B=d.p+"font-awesome.css",R={ban:["ban","block"],ok:["ok","unban","untimeout"],"clock-o":["clock-o","clock","timeout"],times:["remove","close","times"],cog:["gear","cog"],repeat:["rotate-right","repeat"],outdent:["dedent","outdent"],"picture-o":["photo","image","picture-o"],"pencil-square-o":["edit","pencil-square-o"],share:["mail-forward","share"],"exclamation-triangle":["warning","exclamation-triangle"],"bar-chart":["bar-chart-o","bar-chart"],cogs:["gears","cogs"],facebook:["facebook-f","facebook"],rss:["feed","rss"],users:["group","users"],link:["chain","link"],scissors:["cut","scissors"],"files-o":["copy","files-o"],"floppy-o":["save","floppy-o"],bars:["navicon","reorder","bars"],sort:["unsorted","sort"],"sort-desc":["sort-down","sort-desc"],"sort-asc":["sort-up","sort-asc"],undo:["rotate-left","undo"],gavel:["legal","gavel"],tachometer:["dashboard","tachometer"],bolt:["flash","bolt"],clipboard:["paste","clipboard"],mobile:["mobile-phone","mobile"],reply:["mail-reply","reply"],"reply-all":["mail-reply-all","reply-all"],"star-half-o":["star-half-empty","star-half-full","star-half-o"],"chain-broken":["unlink","chain-broken"],"caret-square-o-down":["toggle-down","caret-square-o-down"],"caret-square-o-up":["toggle-up","caret-square-o-up"],"caret-square-o-right":["toggle-right","caret-square-o-right"],eur:["euro","eur"],usd:["dollar","usd"],inr:["rupee","inr"],jpy:["cny","rmb","yen","jpy"],rub:["ruble","rouble","rub"],krw:["won","krw"],btc:["bitcoin","btc"],gratipay:["gittip","gratipay"],"caret-square-o-left":["toggle-left","caret-square-o-left"],try:["turkish-lira","try"],university:["institution","bank","university"],"graduation-cap":["mortar-board","graduation-cap"],car:["automobile","car"],taxi:["cab","taxi"],"file-image-o":["file-photo-o","file-picture-o","file-image-o"],"file-archive-o":["file-zip-o","file-archive-o"],"file-audio-o":["file-sound-o","file-audio-o"],"file-video-o":["file-movie-o","file-video-o"],"life-ring":["life-bouy","life-buoy","life-saver","support","life-ring"],rebel:["ra","resistance","rebel"],empire:["ge","empire"],"hacker-news":["y-combinator-square","yc-square","hacker-news"],weixin:["wechat","weixin"],"paper-plane":["send","paper-plane"],"paper-plane-o":["send-o","paper-plane-o"],"futbol-o":["soccer-ball-o","futbol-o"],ils:["shekel","sheqel","ils"],transgender:["intersex","transgender"],bed:["hotel","bed"],"y-combinator":["yc","y-combinator"],"battery-full":["battery-4","battery","battery-full"],"battery-three-quarters":["battery-3","battery-three-quarters"],"battery-half":["battery-2","battery-half"],"battery-quarter":["battery-1","battery-quarter"],"battery-empty":["battery-0","battery-empty"],"hourglass-start":["hourglass-1","hourglass-start"],"hourglass-half":["hourglass-2","hourglass-half"],"hourglass-end":["hourglass-3","hourglass-end"],"hand-rock-o":["hand-grab-o","hand-rock-o"],"hand-paper-o":["hand-stop-o","hand-paper-o"],television:["tv","television"],"american-sign-language-interpreting":["asl-interpreting","american-sign-language-interpreting"],deaf:["deafness","hard-of-hearing","deaf"],"sign-language":["signing","sign-language"],"google-plus-official":["google-plus-circle","google-plus-official"],"font-awesome":["fa","font-awesome"],"address-card":["vcard","address-card"],"address-card-o":["vcard-o","address-card-o"],"id-card":["drivers-license","id-card"],"id-card-o":["drivers-license-o","id-card-o"],"thermometer-full":["thermometer-4","thermometer","thermometer-full"],"thermometer-three-quarters":["thermometer-3","thermometer-three-quarters"],"thermometer-half":["thermometer-2","thermometer-half"],"thermometer-quarter":["thermometer-1","thermometer-quarter"],"thermometer-empty":["thermometer-0","thermometer-empty"],bath:["bathtub","s15","bath"],"window-close":["times-rectangle","window-close"],"window-close-o":["times-rectangle-o","window-close-o"]},I=["glass","music","search","envelope-o","heart","star","star-o","user","film","th-large","th","th-list","check","times","search-plus","search-minus","power-off","signal","cog","trash-o","home","file-o","clock-o","road","download","arrow-circle-o-down","arrow-circle-o-up","inbox","play-circle-o","repeat","refresh","list-alt","lock","flag","headphones","volume-off","volume-down","volume-up","qrcode","barcode","tag","tags","book","bookmark","print","camera","font","bold","italic","text-height","text-width","align-left","align-center","align-right","align-justify","list","outdent","indent","video-camera","picture-o","pencil","map-marker","adjust","tint","pencil-square-o","share-square-o","check-square-o","arrows","step-backward","fast-backward","backward","play","pause","stop","forward","fast-forward","step-forward","eject","chevron-left","chevron-right","plus-circle","minus-circle","times-circle","check-circle","question-circle","info-circle","crosshairs","times-circle-o","check-circle-o","ban","arrow-left","arrow-right","arrow-up","arrow-down","share","expand","compress","plus","minus","asterisk","exclamation-circle","gift","leaf","fire","eye","eye-slash","exclamation-triangle","plane","calendar","random","comment","magnet","chevron-up","chevron-down","retweet","shopping-cart","folder","folder-open","arrows-v","arrows-h","bar-chart","twitter-square","facebook-square","camera-retro","key","cogs","comments","thumbs-o-up","thumbs-o-down","star-half","heart-o","sign-out","linkedin-square","thumb-tack","external-link","sign-in","trophy","github-square","upload","lemon-o","phone","square-o","bookmark-o","phone-square","twitter","facebook","github","unlock","credit-card","rss","hdd-o","bullhorn","bell","certificate","hand-o-right","hand-o-left","hand-o-up","hand-o-down","arrow-circle-left","arrow-circle-right","arrow-circle-up","arrow-circle-down","globe","wrench","tasks","filter","briefcase","arrows-alt","users","link","cloud","flask","scissors","files-o","paperclip","floppy-o","square","bars","list-ul","list-ol","strikethrough","underline","table","magic","truck","pinterest","pinterest-square","google-plus-square","google-plus","money","caret-down","caret-up","caret-left","caret-right","columns","sort","sort-desc","sort-asc","envelope","linkedin","undo","gavel","tachometer","comment-o","comments-o","bolt","sitemap","umbrella","clipboard","lightbulb-o","exchange","cloud-download","cloud-upload","user-md","stethoscope","suitcase","bell-o","coffee","cutlery","file-text-o","building-o","hospital-o","ambulance","medkit","fighter-jet","beer","h-square","plus-square","angle-double-left","angle-double-right","angle-double-up","angle-double-down","angle-left","angle-right","angle-up","angle-down","desktop","laptop","tablet","mobile","circle-o","quote-left","quote-right","spinner","circle","reply","github-alt","folder-o","folder-open-o","smile-o","frown-o","meh-o","gamepad","keyboard-o","flag-o","flag-checkered","terminal","code","reply-all","star-half-o","location-arrow","crop","code-fork","chain-broken","question","info","exclamation","superscript","subscript","eraser","puzzle-piece","microphone","microphone-slash","shield","calendar-o","fire-extinguisher","rocket","maxcdn","chevron-circle-left","chevron-circle-right","chevron-circle-up","chevron-circle-down","html5","css3","anchor","unlock-alt","bullseye","ellipsis-h","ellipsis-v","rss-square","play-circle","ticket","minus-square","minus-square-o","level-up","level-down","check-square","pencil-square","external-link-square","share-square","compass","caret-square-o-down","caret-square-o-up","caret-square-o-right","eur","gbp","usd","inr","jpy","rub","krw","btc","file","file-text","sort-alpha-asc","sort-alpha-desc","sort-amount-asc","sort-amount-desc","sort-numeric-asc","sort-numeric-desc","thumbs-up","thumbs-down","youtube-square","youtube","xing","xing-square","youtube-play","dropbox","stack-overflow","instagram","flickr","adn","bitbucket","bitbucket-square","tumblr","tumblr-square","long-arrow-down","long-arrow-up","long-arrow-left","long-arrow-right","apple","windows","android","linux","dribbble","skype","foursquare","trello","female","male","gratipay","sun-o","moon-o","archive","bug","vk","weibo","renren","pagelines","stack-exchange","arrow-circle-o-right","arrow-circle-o-left","caret-square-o-left","dot-circle-o","wheelchair","vimeo-square","try","plus-square-o","space-shuttle","slack","envelope-square","wordpress","openid","university","graduation-cap","yahoo","google","reddit","reddit-square","stumbleupon-circle","stumbleupon","delicious","digg","pied-piper-pp","pied-piper-alt","drupal","joomla","language","fax","building","child","paw","spoon","cube","cubes","behance","behance-square","steam","steam-square","recycle","car","taxi","tree","spotify","deviantart","soundcloud","database","file-pdf-o","file-word-o","file-excel-o","file-powerpoint-o","file-image-o","file-archive-o","file-audio-o","file-video-o","file-code-o","vine","codepen","jsfiddle","life-ring","circle-o-notch","rebel","empire","git-square","git","hacker-news","tencent-weibo","qq","weixin","paper-plane","paper-plane-o","history","circle-thin","header","paragraph","sliders","share-alt","share-alt-square","bomb","futbol-o","tty","binoculars","plug","slideshare","twitch","yelp","newspaper-o","wifi","calculator","paypal","google-wallet","cc-visa","cc-mastercard","cc-discover","cc-amex","cc-paypal","cc-stripe","bell-slash","bell-slash-o","trash","copyright","at","eyedropper","paint-brush","birthday-cake","area-chart","pie-chart","line-chart","lastfm","lastfm-square","toggle-off","toggle-on","bicycle","bus","ioxhost","angellist","cc","ils","meanpath","buysellads","connectdevelop","dashcube","forumbee","leanpub","sellsy","shirtsinbulk","simplybuilt","skyatlas","cart-plus","cart-arrow-down","diamond","ship","user-secret","motorcycle","street-view","heartbeat","venus","mars","mercury","transgender","transgender-alt","venus-double","mars-double","venus-mars","mars-stroke","mars-stroke-v","mars-stroke-h","neuter","genderless","facebook-official","pinterest-p","whatsapp","server","user-plus","user-times","bed","viacoin","train","subway","medium","y-combinator","optin-monster","opencart","expeditedssl","battery-full","battery-three-quarters","battery-half","battery-quarter","battery-empty","mouse-pointer","i-cursor","object-group","object-ungroup","sticky-note","sticky-note-o","cc-jcb","cc-diners-club","clone","balance-scale","hourglass-o","hourglass-start","hourglass-half","hourglass-end","hourglass","hand-rock-o","hand-paper-o","hand-scissors-o","hand-lizard-o","hand-spock-o","hand-pointer-o","hand-peace-o","trademark","registered","creative-commons","gg","gg-circle","tripadvisor","odnoklassniki","odnoklassniki-square","get-pocket","wikipedia-w","safari","chrome","firefox","opera","internet-explorer","television","contao","500px","amazon","calendar-plus-o","calendar-minus-o","calendar-times-o","calendar-check-o","industry","map-pin","map-signs","map-o","map","commenting","commenting-o","houzz","vimeo","black-tie","fonticons","reddit-alien","edge","credit-card-alt","codiepie","modx","fort-awesome","usb","product-hunt","mixcloud","scribd","pause-circle","pause-circle-o","stop-circle","stop-circle-o","shopping-bag","shopping-basket","hashtag","bluetooth","bluetooth-b","percent","gitlab","wpbeginner","wpforms","envira","universal-access","wheelchair-alt","question-circle-o","blind","audio-description","volume-control-phone","braille","assistive-listening-systems","american-sign-language-interpreting","deaf","glide","glide-g","sign-language","low-vision","viadeo","viadeo-square","snapchat","snapchat-ghost","snapchat-square","pied-piper","first-order","yoast","themeisle","google-plus-official","font-awesome","handshake-o","envelope-open","envelope-open-o","linode","address-book","address-book-o","address-card","address-card-o","user-circle","user-circle-o","user-o","id-badge","id-card","id-card-o","quora","free-code-camp","telegram","thermometer-full","thermometer-three-quarters","thermometer-half","thermometer-quarter","thermometer-empty","shower","bath","podcast","window-maximize","window-minimize","window-restore","window-close","window-close-o","bandcamp","grav","etsy","imdb","ravelry","eercast","microchip","snowflake-o","superpowers","wpexplorer","meetup"];let U=!1;const z=G(()=>{U||(U=!0,document.head.appendChild((0,W.createElement)("link",{href:B,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"})))},"load"),v=G(f=>{U||!String(f).startsWith("fa-")&&!String(f).startsWith("ffz-fa")||z()},"maybeLoad")},83342:(ae,J,d)=>{"use strict";d.d(J,{R7:()=>l,jo:()=>w});var W=d(44589);const B=d.p+"opendyslexic.css",R=["Roobert","Arial","Arial Black","Verdana","Helvetica","Tahoma","Trebuchet MS","Impact","Didot","American Typewriter","Lucida Console","Monaco","Bradley Hand","Times New Roman","Georgia","Garamond","Courier New","Brush Script MT","Comic Sans MS"],I=document.fonts?.check?R.filter(_=>document.fonts.check(`16px ${_}`)).sort():R.sort(),U=["Roboto","Open Sans","Noto Sans JP","Lato","Montserrat","Roboto Condensed","Source Sans Pro","Oswald","Poppins","Noto Sans","Roboto Mono","Raleway","Ubuntu","Merriweather","Nunito","PT Sans","Roboto Slab","Playfair Display","Lora","Rubik","Mukta","Noto Sans KR","Work Sans","Nunito Sans","Nanum Gothic","Inter","Quicksand","PT Serif","Hind Siliguri","Titilium Web","Fira Sans","Noto Serif","Noto Sans TC","Karla"],z=new Map,v=new Map;function f(_){if(v.has(_))return;const o=encodeURIComponent(_),e=(0,W.createElement)("link",{id:`ffz-font-${o}`,rel:"stylesheet",href:`https://fonts.googleapis.com/css2?family=${o}`});v.set(_,e),document.head.appendChild(e)}G(f,"loadGoogleFont");function u(_){const o=v.get(_);o&&(v.delete(_),o.remove())}G(u,"unloadGoogleFont");const y=["OpenDyslexic","OpenDyslexicAlta","OpenDyslexicMono"];let S=0,n=null;function s(){n||(n=(0,W.createElement)("link",{id:"ffz-font-opendyslexic",rel:"stylesheet",type:"text/css",href:B}),document.head.appendChild(n))}G(s,"loadOpenDyslexic");function i(){n&&(n.remove(),n=null)}G(i,"unloadOpenDyslexic");function l(){const _=[{value:"",i18n_key:"setting.font.default",title:"Default"},{separator:!0,i18n_key:"setting.font.builtin",title:"Built-in Fonts"}];for(const o of I)_.push({value:o,title:o});_.push({separator:!0,i18n_key:"setting.font.dyslexic",title:"Dyslexia Fonts"});for(const o of y)_.push({value:o,title:o});_.push({separator:!0,i18n_key:"setting.font.google",title:"Google Fonts"});for(const o of U)_.push({value:`google:${o}`,title:o});return _}G(l,"getFontsList");function w(_){if(!_)return[_,null];if(y.includes(_)){S++,S===1&&s();let o=!1;return[_,G(()=>{o||(o=!0,S--,S||i())},"unloader")]}if(_.startsWith("google:")){const o=_.slice(7),e=(z.get(o)??0)+1;z.set(o,e),e===1&&f(o);let a=!1;return[o,G(()=>{if(!a){a=!0;const C=(z.get(o)??0)-1;C>0?z.set(o,C):(z.delete(o),u(o))}},"unloader")]}return[_,null]}G(w,"useFont")},5286:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{MERGE_METHODS:()=>W,default:()=>R,mergeList:()=>B});const W={Document:(I,U)=>(I.definitions&&U.definitions?I.definitions=B(I.definitions,U.definitions):U.definitions&&(I.definitions=U.definitions),I),Field:(I,U)=>(I.name&&(!U.name||U.name.value!==I.name.value)||(I.selectionSet&&U.selectionSet?I.selectionSet=R(I.selectionSet,U.selectionSet):U.selectionSet&&(I.selectionSet=U.selectionSet)),I),OperationDefinition:(I,U)=>(I.operation!==U.operation||(I.selectionSet&&U.selectionSet?I.selectionSet=R(I.selectionSet,U.selectionSet):U.selectionSet&&(I.selectionSet=U.selectionSet)),I),FragmentDefinition:(I,U)=>(I.typeCondition&&U.typeCondition&&(I.typeCondition.kind!==U.typeCondition.kind||I.typeCondition.name.value!=U.typeCondition.name.value)||(I.selectionSet&&U.selectionSet?I.selectionSet=R(I.selectionSet,U.selectionSet):U.selectionSet&&(I.selectionSet=U.selectionSet)),I),SelectionSet:(I,U)=>(I.selections&&U.selections?I.selections=B(I.selections,U.selections):U.selections&&(I.selections=U.selections),I)};function B(I,U){let z=!1;const v={};for(const f of I)!f||!f.name||f.name.kind!=="Name"||(f.operation&&(z=!0),v[f.name.value]=f);for(const f of U){if(!f||!f.name||f.name.kind!=="Name")continue;const u=f.name.value,y=v[u]?I.indexOf(v[u]):-1;if(y!==-1){if(I[y].operation&&f.operation&&I[y].operation!==f.operation)continue;I[y]=R(I[y],f),I[y].operation&&(z=!0)}else{if(z&&f.operation)continue;I.push(f)}}return I}G(B,"mergeList");function R(I,U){return I.kind!==U.kind?I:W[I.kind]?W[I.kind](I,U):I}G(R,"merge")},22527:(ae,J,d)=>{var s;"use strict";d.r(J),d.d(J,{CyclicDependencyError:()=>n,LoadState:()=>R,Module:()=>f,ModuleError:()=>S,State:()=>I,buildAddonProxy:()=>y,default:()=>u});var W=d(17159),B=d(46949),R=(w=>(w[w.Unloaded=0]="Unloaded",w[w.Loading=1]="Loading",w[w.Loaded=2]="Loaded",w[w.Unloading=3]="Unloading",w))(R||{}),I=(w=>(w[w.Disabled=0]="Disabled",w[w.Enabling=1]="Enabling",w[w.Enabled=2]="Enabled",w[w.Disabling=3]="Disabling",w))(I||{});const U=/^addon\.([^.]+)(?:\.|$)/i;function z(w){return U.exec(w)?.[1]}G(z,"extractAddonId");const v=(s=class extends W.default{constructor(_,o,e){if(!o&&_ instanceof s&&(o=_,_=void 0),super(_,o),this.load_dependents=null,this.dependents=null,this.references=null,this.__modules=o?o.__modules:{},this.children={},o?.__addon_id)this.__addon_id=o.__addon_id,this.__addon_root=o.__addon_root;else if(e){const p=z(this.__path);p&&(this.__addon_id=p,this.__addon_root=this)}o&&!o.children[this.name]&&(o.children[this.name]=this),this.root===this&&(this.__modules[this.__path||""]=this);let a=!!this.onLoad;if(!a){const p=this.__get_load_requires();a=Array.isArray(p)&&p.length>0}this.__load_state=a?0:2,this.__state=a||this.onEnable?0:2,this._time("instance"),this.emit(":registered",this)}get state(){return this.__state}get load_state(){return this.__load_state}get loaded(){return this.__load_state===2}get loading(){return this.__load_state===1}get enabled(){return this.__state===2}get enabling(){return this.__state===1}get addon_id(){return this.__addon_id}get addon_root(){return this.__addon_root}get addon_manifest(){if(this.__addon_id)return this.resolve("addons")?.getAddon(this.__addon_id)??this.__addon_root?.constructor?.info??void 0}get log(){return this.__log||(this.__log=this.parent&&this.parent.log?.get?.(this.name)),this.__log}set log(_){this.__log=_}_time(_){this.root.timing&&(typeof _!="object"&&(_={event:_}),_.module=this.__path||"core",this.root.timing.addEvent(_))}load(){return this.__load(this.__path,[])}unload(){return this.__unload(this.__path,[])}enable(){return this.__enable(this.__path,[])}disable(){return this.__disable(this.__path,[])}canUnload(){return this.__canUnload(this.__path,[])}canDisable(){return this.__canDisable(this.__path,[])}__load(_,o){const e=this.__path||this.name,a=this.__load_state;if(o.includes(this))return Promise.reject(new n(`cyclic load requirements when loading ${_}`,[...o,this]));if(this.load_requires)for(const p of this.load_requires){const C=this.__resolve(p);if(C instanceof s&&o.includes(C))return Promise.reject(new n(`cyclic load requirements when loading ${_}`,[...o,this,C]))}return o.push(this),a===1?this.__load_promise:a===2?Promise.resolve():a===3?Promise.reject(new S(`attempted to load module ${e} while module is being unloaded`)):(this._time("load-start"),this.__load_state=1,this.__load_promise=(async()=>{if(this.load_requires){const p=[];for(const C of this.load_requires){const m=this.__resolve(C);if(!m||!(m instanceof s))throw new S(`cannot find required module ${C} when loading ${e}`);p.push(m.__enable(_,Array.from(o)))}await Promise.all(p)}if(this.onLoad)return this._time("load-self"),this.onLoad()})().then(p=>(this.__load_state=2,this.__load_promise=null,this._time("load-end"),this.emit(":loaded",this),p)).catch(p=>{throw this.__load_state=0,this.__load_promise=null,this._time("load-end"),p}))}__canUnload(_,o){const e=this.__path||this.name,a=this.__load_state;if(o.includes(this))throw new n(`cyclic load requirements when checking if can unload ${_}`,[...o,this]);if(this.load_dependents){o.push(this);for(const p of this.load_dependents){const C=this.__resolve(p);if(C instanceof s){if(o.includes(C))throw new n(`cyclic load requirements when checking if can unload ${_}`,[...o,this,C]);if(!C.__canUnload(_,Array.from(o)))return!1}}}return a===3||a===0?!0:this.onLoad&&!this.onUnload?!1:a!==1}__unload(_,o){const e=this.__path||this.name,a=this.__load_state;if(o.includes(this))return Promise.reject(new n(`cyclic load requirements when unloading ${_}`,[...o,this]));if(this.load_dependents)for(const p of this.load_dependents){const C=this.__resolve(p);if(C instanceof s&&o.includes(C))return Promise.reject(new n(`cyclic load requirements when unloading ${_}`,[...o,this,C]))}return o.push(this),a===3?this.__load_promise:a===0?Promise.resolve():this.onLoad&&!this.onUnload?Promise.reject(new S(`attempted to unload module ${e} but module cannot be unloaded`)):a===1?Promise.reject(new S(`attempted to unload module ${e} while module is being loaded`)):(this._time("unload-start"),this.__load_state=3,this.__load_promise=(async()=>{if(this.__state!==0&&await this.disable(),this.load_dependents){const p=[];for(const C of this.load_dependents){const m=this.__resolve(C);!m||!(m instanceof s)||p.push(m.__unload(_,Array.from(o)))}await Promise.all(p)}if(this._time("unload-self"),this.onUnload)return this.onUnload()})().then(p=>(this.__load_state=0,this.__load_promise=null,this._time("unload-end"),this.emit(":unloaded",this),p)).catch(p=>{throw this.__load_state=2,this.__load_promise=null,this._time("unload-end"),p}))}__enable(_,o){const e=this.__path||this.name,a=this.__state;if(o.includes(this))return Promise.reject(new n(`cyclic requirements when enabling ${_}`,[...o,this]));if(this.requires)for(const p of this.requires){const C=this.__resolve(p);if(C instanceof s&&o.includes(C))return Promise.reject(new n(`cyclic requirements when enabling ${_}`,[...o,this,C]))}return o.push(this),a===1?this.__state_promise:a===2?Promise.resolve():a===3?Promise.reject(new S(`attempted to enable module ${e} while module is being disabled`)):(this._time("enable-start"),this.__state=1,this.__state_promise=(async()=>{const p=[],C=this.requires,m=this.__load_state;if(m===3)throw new S(`attempted to load module ${e} while module is being unloaded`);if((m===1||m===0)&&p.push(this.load()),C)for(const x of C){const $=this.__resolve(x);if(!$||!($ instanceof s))throw new S(`cannot find required module ${x} when enabling ${e}`);p.push($.__enable(_,Array.from(o)))}if(await Promise.all(p),this.onEnable)return this._time("enable-self"),this.onEnable()})().then(p=>(this.__state=2,this.__state_promise=null,this._time("enable-end"),this.emit(":enabled",this),p)).catch(p=>{throw this.__state=0,this.__state_promise=null,this._time("enable-end"),p}))}__canDisable(_,o){const e=this.__path||this.name,a=this.__state;if(o.includes(this))throw new n(`cyclic load requirements when checking if can disable ${_}`,[...o,this]);if(this.dependents){o.push(this);for(const p of this.dependents){const C=this.__resolve(p);if(C&&C instanceof s){if(o.includes(C))throw new n(`cyclic load requirements when checking if can disable ${_}`,[...o,this,C]);if(!C.__canDisable(_,Array.from(o)))return!1}}}if(a===3||a===0)return!0;if(this.onDisable){if(a===1)return!1}else return!1;return!0}__disable(_,o){const e=this.__path||this.name,a=this.__state;if(o.includes(this))return Promise.reject(new n(`cyclic requirements when disabling ${_}`,[...o,this]));if(this.dependents)for(const p of this.dependents){const C=this.__resolve(p);if(C instanceof s&&o.includes(C))return Promise.reject(new n(`cyclic requirements when disabling ${_}`,[...o,this,C]))}if(o.push(this),a===3)return this.__state_promise;if(a===0)return Promise.resolve();if(this.onDisable){if(a===1)return Promise.reject(new S(`attempted to disable module ${e} but module is being enabled`))}else return Promise.reject(new S(`attempted to disable module ${e} but module cannot be disabled`));return this._time("disable-start"),this.__state=3,this.__state_promise=(async()=>{if(this.__load_state!==2)throw new S(`attempted to disable module ${e} but module is unloaded -- weird state`);if(this.dependents){const p=[];for(const C of this.dependents){const m=this.__resolve(C);!m||!(m instanceof s)||p.push(m.__disable(_,Array.from(o)))}await Promise.all(p)}if(this.onDisable)return this._time("disable-self"),this.onDisable()})().then(p=>(this.__state=0,this.__state_promise=null,this._time("disable-end"),this.emit(":disabled",this),p)).catch(p=>{throw this.__state=2,this.__state_promise=null,this._time("disable-end"),p})}on(_,o,e,a,p=!1){return super.on(_,o,e===void 0?this:e,a,p)}once(_,o,e,a,p=!1){return super.once(_,o,e===void 0?this:e,a,p)}many(_,o,e,a,p,C=!1){return super.many(_,o,e,a===void 0?this:a,p,C)}waitFor(_,o,e,a=!1){return super.waitFor(_,o===void 0?this:o,e,a)}off(_,o,e){return super.off(_,o,e===void 0?this:e)}__resolve(_){return _ instanceof s?_:this.__modules[this.abs_path(_)]}resolve(_){let o=this.__resolve(_);return o instanceof s?(this.__processModule&&(o=this.__processModule(o)),o):null}hasModule(_){return this.__modules[this.abs_path(_)]instanceof s}__get_requires(){return(0,B.has)(this,"requires")?this.requires:(0,B.has)(this.constructor,"requires")?this.constructor.requires:null}__get_load_requires(){return(0,B.has)(this,"load_requires")?this.load_requires:(0,B.has)(this.constructor,"load_requires")?this.constructor.load_requires:null}__processModule(_){if(this.__addon_id&&_.getAddonProxy){const o=this.__addon_id;if(_.__proxies||(_.__proxies={}),_.__proxies[o])return _.__proxies[o];const e=this.__resolve("addons")?.getAddon?.(o),a=_.getAddonProxy(o,e,this.__addon_root??this,this);return a!==_&&(_.__proxies[o]=a),a}return _}inject(_,o,e=!0){(_ instanceof s||_&&_.prototype instanceof s)&&(e=o??!0,o=_,_=null);const a=this.requires=this.__get_requires()||[];if(o instanceof s)_||(_=o.constructor.name.toSnakeCase());else if(o&&o.prototype instanceof s)_||(_=o.name.toSnakeCase()),o=this.register(_,o);else if(_){const p=_;if(_=_.replace(/^(?:[^.]*\.)+/,""),o=this.__resolve(p),!o||!(o instanceof s))return o?o[2].push([this.__path,_]):this.__modules[this.abs_path(p)]=[[],[],[[this.__path,_]]],a.push(this.abs_path(p)),this[_]=null}else throw new TypeError("must provide a valid module name or class");if(!o)throw new Error(`cannot find module ${_} or no module provided`);return e&&a.push(o.abs_path(".")),this.enabled&&!o.enabled&&o.enable(),o.references.push([this.__path,_]),o instanceof s&&this.__processModule&&(o=this.__processModule(o)),this[_]=o}injectAs(_,o,e,a=!0){(o instanceof s||o&&o.prototype instanceof s)&&(a=e??!0,e=o,o=null);const p=this.requires=this.__get_requires()||[];if(e instanceof s)o||(o=e.constructor.name.toSnakeCase());else if(e&&e.prototype instanceof s)o||(o=e.name.toSnakeCase()),e=this.register(o,e);else if(o){const C=o;if(o=o.replace(/^(?:[^.]*\.)+/,""),e=this.__resolve(C),!e||!(e instanceof s))return e?e[2].push([this.__path,_]):this.__modules[this.abs_path(C)]=[[],[],[[this.__path,_]]],p.push(this.abs_path(C)),this[_]=null}else throw new TypeError("must provide a valid module name or class");if(!e)throw new Error(`cannot find module ${o} or no module provided`);return a&&p.push(e.abs_path(".")),this.enabled&&!e.enabled&&e.enable(),e.references.push([this.__path,_]),this.__processModule&&(e=this.__processModule(e)),this[_]=e}register(_,o,e=!1){_.prototype instanceof s&&(e=o,o=_,_=o.name.toSnakeCase());const a=this.abs_path(`.${_}`),p=o.prototype,C=this.__modules[a];if(!(p instanceof s))throw new TypeError(`Module ${_} is not subclass of Module.`);if(C instanceof s)throw new S(`Name Collision for Module ${a}`);const m=C||[[],[],[]];let x=this.__modules[a]=new o(_,this);const $=x.requires=x.__get_requires()||[],r=x.load_requires=x.__get_load_requires()||[];x.dependents=m[0],x.load_dependents=m[1],x.references=m[2];for(const c of $){const b=x.abs_path(c),k=this.__modules[b];k?Array.isArray(k)?k[0].push(a):k.dependents.push(a):this.__modules[b]=[[a],[],[]]}for(const c of r){const b=x.abs_path(c),k=this.__modules[b];k?Array.isArray(k)?k[1].push(a):k.load_dependents.push(a):this.__modules[b]=[[],[a],[]]}for(const[c,b]of m[2]){const k=this.__resolve(c);k&&!Array.isArray(k)?k[b]=x:this.log.warn(`Unable to find module "${c}" that wanted "${b}".`)}return this.__processModule&&(x=this.__processModule(x)),e&&(this[_]=x),x}async loadFromContext(_,o){o=o??this.log;const e={};for(const a of _.keys()){const p=await _(a),C=p.module||p.default,m=a.lastIndexOf("."),x=m>2?a.slice(2,m):a,$=x.endsWith("/index")?x.slice(0,-6):x;try{e[$]=this.register($,C)}catch(r){o&&r instanceof Error&&(o.capture(r,{extra:{module:$,path:a}}),o.warn(r,`Skipping ${a}`))}}return e}},G(s,"_Module2"),s);v.buildAddonProxy=y;let f=v;const u=f;function y(w,_,o,e,a,p){const C={get(m,x,$){let r=e[x];if(r!==void 0)return typeof r=="function"?r.bind(m):r;const c=a&&a[x];return w?.log&&c&&w.log.warn(`[DEV-CHECK] Accessed ${o}.${x} directly. ${typeof c=="string"?c:""}`),r=m[x],typeof r=="function"?r.bind(m):w&&r instanceof f?w.resolve(r):Reflect.get(m,x,$)}};return p?C:new Proxy(_,C)}G(y,"buildAddonProxy");const i=class i extends Error{};G(i,"ModuleError");let S=i;const l=class l extends S{constructor(_,o){super(`${_} (${o.map(e=>e.path).join(" => ")})`),this.modules=o}};G(l,"CyclicDependencyError");let n=l},46949:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{Mutex:()=>_,SourcedSet:()=>ne,TicketLock:()=>w,TimeoutError:()=>i,TranslatableError:()=>v,addWordSeparators:()=>j,array_equals:()=>a,b64ToArrayBuffer:()=>pe,debounce:()=>o,deep_copy:()=>b,deep_equals:()=>p,escape_regex:()=>P,fetchJSON:()=>Ee,generateHex:()=>te,generateUUID:()=>z,get:()=>r,getTwitchEmoteSrcSet:()=>I,getTwitchEmoteURL:()=>R,glob_to_regex:()=>q,has:()=>y,importRsaKey:()=>me,isValidShortcut:()=>U,makeAddonIdChecker:()=>h,make_enum:()=>n,make_enum_flags:()=>s,map_equals:()=>m,matchScreen:()=>u,maybe_call:()=>M,normalizeAddonIdForComparison:()=>k,once:()=>e,pick_random:()=>O,set_equals:()=>x,sha256:()=>f,shallow_copy:()=>c,shallow_object_equals:()=>C,sleep:()=>S,split_chars:()=>T,substr_count:()=>$,timeout:()=>l,truncate:()=>X});var W=d(24431);const B=Object.prototype.hasOwnProperty;function R(re,ie,fe=!1,ge=!0){return`${W.TWITCH_EMOTE_V2}/${re}/${fe?"default":"static"}/${ge?"dark":"light"}/${ie==4?3:ie}.0`}G(R,"getTwitchEmoteURL");function I(re,ie=!1,fe=!0,ge=!1){return ge?`${R(re,2,ie,fe)} 1x, ${R(re,4,ie,fe)} 2x`:`${R(re,1,ie,fe)} 1x, ${R(re,2,ie,fe)} 2x, ${R(re,4,ie,fe)} 4x`}G(I,"getTwitchEmoteSrcSet");function U(re){return re?(re=re.toLowerCase().trim(),!W.BAD_HOTKEYS.includes(re)):!1}G(U,"isValidShortcut");const z=crypto.randomUUID?()=>crypto.randomUUID():G(function re(ie){return ie?(ie^Math.random()*16>>ie/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,re)},"generateUUID2"),xe=class xe extends Error{constructor(ie,fe,ge){super(ie),this.i18n_key=fe,this.data=ge}toString(){const ie=window.FrankerFaceZ?.get(),fe=ie?.resolve("i18n");return fe&&this.i18n_key?fe.t(this.i18n_key,this.message,this.data):this.message}};G(xe,"TranslatableError");let v=xe;async function f(re){const ie=new TextEncoder().encode(re),fe=await crypto.subtle.digest("SHA-256",ie);return Array.from(new Uint8Array(fe)).map(ke=>ke.toString(16).padStart(2,"0")).join("")}G(f,"sha256");function u(re,ie){let fe,ge=0;for(let ve=0;ve<re.length;ve++){const ke=re[ve];if(ke.label!==ie.label)continue;let De=1;ie.left&&ie.left===ke.left&&(De+=15),ie.top&&ie.top===ke.top&&(De+=15),ie.width&&ie.width===ke.width&&(De+=10),ie.height&&ie.height===ke.height&&(De+=10),ie.index&&(De-=Math.abs(ie.index-ve)),De>ge&&(fe=ke,ge=De)}return fe}G(u,"matchScreen");function y(re,ie){return re?B.call(re,ie):!1}G(y,"has");function S(re){return new Promise(ie=>setTimeout(ie,re))}G(S,"sleep");function n(...re){const ie={};for(let fe=0,ge=re.length;fe<ge;fe++){const ve=re[fe];ie[ve]=fe,ie[fe]=ve}return ie}G(n,"make_enum");function s(...re){const ie={};ie.None=0,ie[0]="None";for(let fe=0,ge=re.length;fe<ge;fe++){const ve=re[fe],ke=Math.pow(2,fe);ie[ve]=ke,ie[ke]=ve}return ie}G(s,"make_enum_flags");const Te=class Te extends Error{constructor(ie){super(ie??"timeout")}};G(Te,"TimeoutError");let i=Te;function l(re,ie){return new Promise((fe,ge)=>{let ve=!1;const ke=setTimeout(()=>{ve||(ve=!0,ge(new i))},ie);re.then(De=>{ve||(ve=!0,clearTimeout(ke),fe(De))}).catch(De=>{ve||(ve=!0,clearTimeout(ke),ge(De))})})}G(l,"timeout");const Pe=class Pe{constructor(ie=1){this.limit=ie,this.__active=0,this.__waiting=[]}get available(){return this.__active<this.limit}__done(){for(this.__active--;this.__active<this.limit&&this.__waiting.length>0;){this.__active++;const ie=this.__waiting.shift();ie&&ie(this.__getTicket())}}__getTicket(){let ie=!0;return()=>{ie&&(ie=!1,this.__done())}}wait(){return this.__active<this.limit?(this.__active++,Promise.resolve(this.__getTicket())):new Promise(ie=>this.__waiting.push(ie))}};G(Pe,"TicketLock");let w=Pe;const _=w;function o(re,ie,fe=!1){let ge;if(fe){const ve=G(()=>ge=null,"later");return fe===2?G(function(...De){ge?(clearTimeout(ge),ge=setTimeout(()=>{ge=null,re.apply(this,De)},ie)):(re.apply(this,De),ge=setTimeout(ve,ie))},"debouncedFunction"):function(...ke){ge?clearTimeout(ge):re.apply(this,ke),ge=setTimeout(ve,ie)}}return function(...ve){ge&&clearTimeout(ge),ge=setTimeout(re.bind(this,...ve),ie)}}G(o,"debounce");function e(re){let ie;return G(function(...ge){if(ie)return ie;try{ie=Promise.resolve(re.call(this,...ge))}catch(ve){return Promise.reject(ve)}return ie.finally(()=>ie=void 0)},"onceFunction")}G(e,"once");function a(re,ie){if(!Array.isArray(re)||!Array.isArray(ie)||re.length!==ie.length)return!1;let fe=re.length;for(;fe--;)if(re[fe]!==ie[fe])return!1;return!0}G(a,"array_equals");function p(re,ie,fe=!1,ge,ve){if(re===ie)return!0;if(typeof re!=typeof ie||typeof re!="object"||re===null!=(ie===null))return!1;if(ge||(ge=new Set),ve||(ve=new Set),ge.has(re)||ve.has(ie))throw new Error("recursive structure detected");ge.add(re),ve.add(ie);const ke=Object.keys(re),De=Object.keys(ie);if(!fe&&!x(new Set(ke),new Set(De)))return!1;for(const Ie of ke)if(!p(re[Ie],ie[Ie],fe,new Set(ge),new Set(ve)))return!1;if(fe){for(const Ie of De)if(!ke.includes(Ie)&&!p(re[Ie],ie[Ie],fe,new Set(ge),new Set(ve)))return!1}return!0}G(p,"deep_equals");function C(re,ie){if(typeof re!="object"||typeof ie!="object")return!1;const fe=Object.keys(re);if(!x(new Set(fe),new Set(Object.keys(ie))))return!1;for(const ge of fe)if(re[ge]!==ie[ge])return!1;return!0}G(C,"shallow_object_equals");function m(re,ie){if(!(re instanceof Map)||!(ie instanceof Map)||re.size!==ie.size)return!1;for(const[fe,ge]of re)if(!ie.has(fe)||ie.get(fe)!==ge)return!1;return!0}G(m,"map_equals");function x(re,ie){if(!(re instanceof Set)||!(ie instanceof Set)||re.size!==ie.size)return!1;for(const fe of re)if(!ie.has(fe))return!1;return!0}G(x,"set_equals");function $(re,ie){let fe=0,ge=0;for(;ge<re.length;){const ve=re.indexOf(ie,ge);if(ve===-1)break;fe++,ge=ve+1}return fe}G($,"substr_count");function r(re,ie){let fe=re;if(typeof fe=="string"){if(B.call(ie,fe))return ie[fe];fe=fe.split(".")}for(let ge=0,ve=fe.length;ge<ve;ge++){const ke=fe[ge];if(ke==="@each"){const De=fe.slice(ge+1);if(De.length)if(Array.isArray(ie))ie=ie.map(Ie=>r(De,Ie));else{const Ie={};for(const Xe in ie)B.call(ie,Xe)&&(Ie[Xe]=r(De,ie[Xe]));ie=Ie}break}else ke==="@last"?ie=ie[ie.length-1]:ie=ie[ke];if(!ie)break}return ie}G(r,"get");function c(re,ie=2,fe){if(re==null)return re;if(re instanceof Promise||typeof re=="function")return null;if(typeof re!="object")return re;if(ie===0)return null;if(fe||(fe=new Set),fe.add(re),Array.isArray(re)){const ve=[];for(const ke of re)fe.has(ke)||ve.push(c(ke,ie-1,new Set(fe)));return ve}const ge={};for(const[ve,ke]of Object.entries(re))fe.has(ke)||(ge[ve]=c(ke,ie-1,new Set(fe)));return ge}G(c,"shallow_copy");function b(re,ie){if(re===null)return null;if(re===void 0)return;if(re instanceof Promise)return new Promise((ge,ve)=>re.then(ge).catch(ve));if(typeof re=="function")return function(...ge){return re.apply(this,ge)};if(re instanceof RegExp)return new RegExp(re.source,re.flags);if(re instanceof Date)return new Date(re);if(typeof re!="object")return re;if(ie||(ie=new Set),ie.has(re))throw new Error("recursive structure detected");if(ie.add(re),Array.isArray(re))return re.map(ge=>b(ge,new Set(ie)));if(re instanceof Set){const ge=new Set;for(const ve of re)typeof ve=="object"?ge.add(b(ve)):ge.add(ve);return ge}if(re instanceof Map){const ge=new Map;for(const[ve,ke]of re.entries()){let De=typeof ve=="object"?b(ve):ve,Ie=typeof ke=="object"?b(ke):ke;ge.set(De,Ie)}return ge}const fe={};for(const[ge,ve]of Object.entries(re))typeof ve=="object"?fe[ge]=b(ve,new Set(ie)):fe[ge]=ve;return fe}G(b,"deep_copy");function k(re){return re.toLowerCase().replace(/[\.\_\-]+/,"-")}G(k,"normalizeAddonIdForComparison");function h(re){return re=P(k(re)),re=re.replace(/-+/g,"[._-]+"),re=re.replace(/\bbttv\b/g,"(?:bttv|betterttv)"),re=re.replace(/\b7tv\b/g,"(?:7tv|seventv)"),re=re.replace(/\bpronouns\b/g,"(?:pronouns|addon-pn)"),new RegExp("\\b"+re+"\\b","i")}G(h,"makeAddonIdChecker");function M(re,ie,...fe){return typeof re=="function"?ie?re.call(ie,...fe):re(...fe):re}G(M,"maybe_call");const L=/[^\uD800-\uDFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDFFF]/g;function T(re){return re===""?[]:re.match(L)}G(T,"split_chars");function O(re){if(!re)return null;if(!Array.isArray(re)){const ie=Object.keys(re);return re[O(ie)]}return re[Math.floor(Math.random()*re.length)]}G(O,"pick_random");const P=RegExp.escape||G(function(ie){return ie.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},"escape_regex2");function j(re){return`(^|.*?${W.WORD_SEPARATORS})(?:${re})(?=$|${W.WORD_SEPARATORS})`}G(j,"addWordSeparators");const Z="/$^+.()=!|";function q(re){if(typeof re!="string")throw new TypeError("input must be a string");let ie="",fe=0;for(let ge=0,ve=re.length;ge<ve;ge++){const ke=re[ge];if(Z.includes(ke))ie+=`\\${ke}`;else if(ke==="\\"){ge++;const De=re[ge];De&&(Z.includes(De)?ie+=`\\${De}`:ie+=De)}else if(ke==="?")ie+=".";else if(ke==="[")ie+=ke,re[ge+1]==="!"&&(ge++,ie+="^");else if(ke==="]")ie+=ke;else if(ke==="{")ie+="(?:",fe++;else if(ke==="}")fe>0&&(ie+=")",fe--);else if(ke===","&&fe>0)ie+="|";else if(ke==="*"){let De=1;for(;re[ge+1]==="*";)De++,ge++;De>1?ie+=".*?":ie+="[^\\s]*?"}else ie+=ke}return ie}G(q,"glob_to_regex");function X(re,ie=100,fe=15,ge="\u2026",ve=!0,ke=!0){if(!re||!re.length)return re;ke&&(re=re.trim());let De=ve?re.indexOf(`
`):-1;if((De===-1||De>ie)&&(De=ie),re.length<=De)return re;let Ie=re.slice(0,De).trimEnd();if(fe>0&&Ie.length>=De){let Xe=re.slice(De).search(/\s+/);if(Xe===-1&&fe+De>re.length&&(Xe=re.length-De),Xe!==-1&&Xe<=fe){if(re.length<=De+Xe)return re;Ie=re.slice(0,De+Xe)}}return Ie+ge}G(X,"truncate");function ee(re){return re.toString(16).padStart(2,"0")}G(ee,"decimalToHex");function te(re=40){const ie=new Uint8Array(re/2);return window.crypto.getRandomValues(ie),Array.from(ie,ee).join("")}G(te,"generateHex");const Se=class Se{constructor(ie=!1,fe){this._use_set=ie,this._cache=ie?new Set:[],this._sourceSortFn=fe}resortSources(){this._sorted_sources=null,this._sources&&this._sources.size>1&&this._rebuild()}setSortFunction(ie){this._sourceSortFn!==ie&&(this._sourceSortFn=ie,this.resortSources())}_sortSources(){if(!this._sources||this._sources.size===0){this._sorted_sources=[];return}if(this._sources.size===1||!this._sourceSortFn){this._sorted_sources=[...this._sources.values()];return}const ie=[...this._sources?.entries()];ie.sort((fe,ge)=>this._sourceSortFn(fe[0],ge[0])),this._sorted_sources=ie.map(fe=>fe[1])}_rebuild(){if(!this._sources)return;const ie=this._use_set,fe=this._cache=ie?new Set:[];this._sorted_sources||this._sortSources();for(const ge of this._sorted_sources)for(const ve of ge)ie?fe.add(ve):fe.includes(ve)||fe.push(ve)}get(ie){return this._sources&&this._sources.get(ie)}has(ie){return this._sources?this._sources.has(ie):!1}*iterateSources(){if(this._sources)for(const ie of this._sources)yield ie}sourceIncludes(ie,fe){const ge=this._sources&&this._sources.get(ie);return ge&&ge.includes(fe)}includes(ie){return this._use_set?this._cache.has(ie):this._cache.includes(ie)}delete(ie){this._sources&&this._sources.has(ie)&&(this._sources.delete(ie),this._sorted_sources=null,this._rebuild())}extend(ie,...fe){this._sources||(this._sources=new Map);const ge=this._sources.get(ie);if(ge)for(const ke of fe)ge.includes(ke)||ge.push(ke);else this._sources.set(ie,fe),this._sorted_sources=null;if(this._sourceSortFn!=null&&this._sources.size>1)this._rebuild();else{const ke=this._use_set,De=this._cache;for(const Ie of fe)ke?De.add(Ie):De.includes(Ie)||De.push(Ie)}}set(ie,fe){if(Array.isArray(fe)||(fe=[fe]),!fe.length)return this.delete(ie);this._sources||(this._sources=new Map);const ge=this._sources.has(ie);this._sources.set(ie,fe),this._sorted_sources=null;const ve=this._sourceSortFn!=null&&this._sources.size>1;if(ge||ve)this._rebuild();else{const ke=this._use_set,De=this._cache;for(const Ie of fe)ke?De.add(Ie):De.includes(Ie)||De.push(Ie)}}push(ie,fe){if(!this._sources)return this.set(ie,fe);const ge=this._sources.get(ie);if(ge?.length){if(ge.includes(fe))return}else return this.set(ie,fe);ge.push(fe),this._sourceSortFn!=null&&this._sources.size>1?this._rebuild():this._use_set?this._cache.add(fe):this._cache.includes(fe)||this._cache.push(fe)}remove(ie,fe){if(!this._sources||!this._sources.has(ie))return;const ge=this._sources.get(ie),ve=ge?ge.indexOf(fe):-1;ve!==-1&&(ge.splice(ve,1),this._rebuild())}};G(Se,"SourcedSet");let ne=Se;function pe(re){const ie=atob(re),fe=ie.length,ge=new ArrayBuffer(fe),ve=new Uint8Array(ge);for(let ke=0,De=ie.length;ke<De;ke++)ve[ke]=ie.charCodeAt(ke);return ge}G(pe,"b64ToArrayBuffer");const oe=/-----BEGIN (.+?) KEY-----/,de=/-----END (.+?) KEY-----/;function me(re,ie=["verify"]){const fe=oe.exec(re),ge=de.exec(re);if(!fe||!ge||fe[1]!==ge[1])throw new Error("invalid key");const ve=/\bPRIVATE\b/i.test(fe[1]),ke=fe.index+fe[0].length,De=ge.index,Ie=re.slice(ke,De).replace(/\n/g,"").trim(),Xe=pe(Ie);return crypto.subtle.importKey(ve?"pkcs8":"spki",Xe,{name:"RSA-PSS",hash:"SHA-256"},!0,ie)}G(me,"importRsaKey");function Ee(re,ie,fe=null){return fetch(re,ie).then(ge=>ge.ok?ge.json():null).catch(()=>fe)}G(Ee,"fetchJSON")},20857:(ae,J,d)=>{"use strict";d.d(J,{Q:()=>W});function W(I){return B({path:I,i:0})}G(W,"parse");function B(I){const U=I.path,z=U.length,v=[];let f=null,u=null,y=!1,S=!1;for(;I.i<z;){const n=I.i,s=U[n],i=U[n+1];if(f||(f={}),u||(u=""),s==="@"&&i==="{"){I.i++;const o=R(I);o&&Object.assign(f,o);continue}const l=s==="~"&&i===">",w=s===">"&&i===">";if(!(!w&&s===">")&&!w&&!l){u+=s,I.i++;continue}(l||w)&&I.i++,f.title=u.trim(),f.key=f.title.toSnakeCase(),f.page=S,f.tab=y,S=w,y=l,v.push(f),f=u=null,I.i++}return f&&u&&(f.title=u.trim(),f.key=f.title.toSnakeCase(),f.page=S,f.tab=y,v.push(f)),v}G(B,"parseAST");function R(I){const U=I.path,z=U.length,v=I.i;I.i++;const f=["{"];let u=!1;for(;I.i<z&&f.length;){const y=I.i,S=U[y];if(u){if(S==="\\"){I.i++;continue}(S==='"'||S==="'")&&S===u&&(f.pop(),u=!1)}else{if((S==='"'||S==="'")&&(u=S,f.push(S)),(S==="{"||S==="[")&&f.push(S),S==="]"&&f.pop()!=="[")throw new SyntaxError("Invalid JSON");if(S==="}"&&f.pop()!=="{")throw new SyntaxError("Invalid JSON")}I.i++}return JSON.parse(U.slice(v,I.i))}G(R,"parseJSON")},83269:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{durationForChat:()=>I,durationForURL:()=>U,duration_to_string:()=>B,getBuster:()=>W,print_duration:()=>R});function W(z=5){const v=Math.floor(Date.now()/1e3);return v-v%z}G(W,"getBuster");function B(z,v,f,u,y){const S=z%60;let n=Math.floor(z/60),s=Math.floor(n/60),i="";if(n=n%60,v){const w=Math.floor(s/24);if(s=s%24,f&&w>0)return`${i} days`;i=w>0?`${w} days, `:""}const l=u===!1||i?.length>0||s>0;return`${i}${l?`${i&&s<10?"0":""}${s}:`:""}${l&&n<10?"0":""}${n}${y?"":`:${S<10?"0":""}${S}`}`}G(B,"duration_to_string");function R(z){let v=Math.floor(z/60);const f=Math.floor(v/60);return v%=60,z%=60,`${f>0?`${f}:${v<10?"0":""}`:""}${v}:${z<10?"0":""}${z}`}G(R,"print_duration");function I(z){const v=z%60;let f=Math.floor(z/60),u=Math.floor(f/60);const y=Math.floor(u/24);return f=f%60,u=u%24,`${y>0?`${y}d`:""}${u>0?`${u}h`:""}${f>0?`${f}m`:""}${v>0?`${v}s`:""}`}G(I,"durationForChat");function U(z){const v=z%60;let f=Math.floor(z/60);const u=Math.floor(f/60);return f=f%60,`${u>0?`${u}h`:""}${f>0?`${f}m`:""}${v>0?`${v}s`:""}`}G(U,"durationForURL")},8528:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{DefaultOptions:()=>z,NoContent:()=>U,Tooltip:()=>v,default:()=>f,makeReference:()=>y,normalizeModifiers:()=>u});var W=d(44589),B=d(46949),R=d(78224);let I=0;const U=Symbol("NoContent"),z={html:!1,delayShow:0,delayHide:0,live:!0,tooltipClass:"ffz__tooltip",innerClass:"ffz__tooltip--inner",arrowClass:"ffz__tooltip--arrow"},n=class n{constructor(i,l,w){if(this.shift_state=!1,this.ctrl_state=!1,typeof i=="string"&&(i=document.querySelector(i)),!(i instanceof HTMLElement))throw new TypeError("invalid parent");if(this.options=Object.assign({},z,w),this.live=this.options.live,this.parent=i,this.container=this.options.container||this.parent,this.cls=l,this.options.check_modifiers&&this.installModifiers(),this.live)this.cls=l,this.elements=new Set;else{let _;if(typeof l=="string")_=Array.from(i.querySelectorAll(l));else if(Array.isArray(l))_=l;else if(l instanceof HTMLElement)_=[l];else throw new TypeError("invalid elements");this.elements=new Set(_)}if(this._accessor=`_ffz_tooltip$${I++}`,this._onMouseOut=_=>{const o=_.target;if(o&&o.dataset?.forceOpen!=="true")return this._exit(o)},!this.options.manual)if(this.live)this._onMouseOver=_=>{this.updateShift(_.shiftKey,_.ctrlKey);const o=_.target;o&&o.classList&&o.classList.contains(this.cls)&&o.dataset?.forceOpen!=="true"&&this._enter(o)},i.addEventListener("mouseover",this._onMouseOver),i.addEventListener("mouseout",this._onMouseOut);else if(this._onMouseOver=_=>{this.updateShift(_.shiftKey,_.ctrlKey);const o=_.target;this.elements.has(o)&&o.dataset.forceOpen!=="true"&&this._enter(o)},this.elements.size<=5)for(const _ of this.elements)_.addEventListener("mouseenter",this._onMouseOver),_.addEventListener("mouseleave",this._onMouseOut);else i.addEventListener("mouseover",this._onMouseOver),i.addEventListener("mouseout",this._onMouseOut)}destroy(){if(this.removeModifiers(),!this.options.manual)if(this.live||this.elements.size>5)this._onMouseOver&&this.parent.removeEventListener("mouseover",this._onMouseOver),this.parent.removeEventListener("mouseout",this._onMouseOut);else for(const i of this.elements)this._onMouseOver&&i.removeEventListener("mouseenter",this._onMouseOver),i.removeEventListener("mouseleave",this._onMouseOut);for(const i of this.elements){const l=i[this._accessor];l&&l.visible&&this.hide(l),i[this._accessor]=null,i._ffz_tooltip=null}this.elements=null,this._onMouseOut=this._onMouseOver=null,this.container=null,this.parent=null}installModifiers(){this._keyUpdate||(this._keyUpdate=i=>this.updateShift(i.shiftKey,i.ctrlKey),window.addEventListener("keydown",this._keyUpdate),window.addEventListener("keyup",this._keyUpdate))}removeModifiers(){this._keyUpdate&&(window.removeEventListener("keydown",this._keyUpdate),window.removeEventListener("keyup",this._keyUpdate),this._keyUpdate=null)}updateShift(i,l){i===this.shift_state&&l===this.ctrl_state||(this.shift_state=i,this.ctrl_state=l,this._shift_af||(this._shift_af=requestAnimationFrame(()=>{if(this._shift_af=null,this.elements)for(const w of this.elements){const _=w[this._accessor];_&&_.outer&&(_.outer.dataset.shift=`${this.shift_state}`,_.outer.dataset.ctrl=`${this.ctrl_state}`,_.update())}})))}cleanup(){if(!(this.options.manual||!this.elements))for(const i of this.elements){const l=i[this._accessor];document.body.contains(i)||l&&l.visible&&this.hide(l)}}_enter(i){let l=i[this._accessor];if(l||(l=i[this._accessor]={target:i}),l.state=!0,l._show_timer&&(clearTimeout(l._show_timer),l._show_timer=null),l.visible)return;const w=(0,B.maybe_call)(this.options.delayShow,null,i,l);w===0?this.show(l):l._show_timer=setTimeout(()=>{l._show_timer=null,l.state&&this.show(l)},w)}_exit(i){const l=i[this._accessor];if(!l||(l.state=!1,l._show_timer&&(clearTimeout(l._show_timer),l._show_timer=null),!l.visible))return;const w=(0,B.maybe_call)(this.options.delayHide,null,i,l);w===0?this.hide(l):l._show_timer=setTimeout(()=>{l._show_timer=null,l.state||this.hide(l)},w)}show(i){const l=this.options,w=i.target;this.elements.add(w),w._ffz_tooltip=i,i._wait_promise=null,i.waitForDom=()=>i.element?Promise.resolve():(i._wait_promise||(i._wait_promise=new Promise(b=>i._waiter=b)),i._wait_promise),i.update=()=>i._update(),i.show=()=>{let b=w[this._accessor];b||(b=w[this._accessor]={target:w}),this.show(b)},i.hide=()=>this.hide(i),i.rerender=()=>{i.visible&&(i.hide(),i.show())};let _=(0,B.maybe_call)(l.content,null,w,i);if(_===void 0&&(_=i.target.title),i.visible||_===U||!_&&!l.onShow)return;const o=(0,W.createElement)("div",{className:l.arrowClass,"x-arrow":!0}),e=i.element=(0,W.createElement)("div",l.innerClass),a=i.outer=(0,W.createElement)("div",{className:l.tooltipClass,"data-shift":this.shift_state,"data-ctrl":this.ctrl_state},[e,o]);if(l.arrowInner&&o.appendChild((0,W.createElement)("div",l.arrowInner)),i.align&&e.classList.add(`${l.innerClass}--align-${i.align}`),i.add_class){for(const b of Array.isArray(i.add_class)?i.add_class:[i.add_class])e.classList.add(b);i.add_class=void 0}const p=(0,B.maybe_call)(l.interactive,null,w,i),C=(0,B.maybe_call)(l.hover_events,null,w,i);a.classList.toggle("interactive",p||!1),(!l.manual||C&&(l.onHover||l.onLeave||l.onMove))&&(C&&l.onMove&&a.addEventListener("mousemove",a._ffz_move_handler=b=>{this.updateShift(b.shiftKey,b.ctrlKey),l.onMove(w,i,b)}),a.addEventListener("mouseover",a._ffz_over_handler=b=>{!l.no_auto_remove&&!document.contains(w)&&this.hide(i),C&&l.onHover&&l.onHover(w,i,b),l.manual||((0,B.maybe_call)(l.interactive,null,w,i)?this._enter(w):w.dataset.forceOpen!=="true"&&this._exit(w))}),a.addEventListener("mouseout",a._ffz_out_handler=b=>{C&&l.onLeave&&l.onLeave(w,i,b),!l.manual&&w.dataset.forceOpen!=="true"&&this._exit(w)}));const m=(0,B.maybe_call)(l.html,null,w,i),x=m?"innerHTML":"textContent",$={flip:{behavior:["top","bottom","left","right"]},offset:{offset:[0,10]},arrow:{element:o}};let r=Object.assign({modifiers:$},l.popper);r.modifiers=Object.assign($,r.modifiers),l.popperConfig&&(r=l.popperConfig(w,i,r)??r),r.onUpdate=(0,B.debounce)(()=>{!l.no_auto_remove&&!document.contains(i.target)&&this.hide(i)},250);let c=w;l.no_update&&(c=y(w)),i._update=()=>{i.popper&&i.popper.forceUpdate()},i._waiter&&i._waiter(),i._waiter=null,i._wait_promise=null,_ instanceof Promise?(e.innerHTML='<div class="ffz-i-zreknarf loader"></div>',_.then(b=>{if(!b)return this.hide(i);m&&(b instanceof Node||Array.isArray(b))?(e.innerHTML="",(0,W.setChildren)(e,b,l.sanitizeChildren)):e[x]=b,i._update()}).catch(b=>{this.options.logger&&this.options.logger.error("Error rendering tooltip content.",b),this.options.i18n?e.textContent=this.options.i18n.t("tooltip.render-error",`There was an error rendering this tooltip.
{err}`,{err:b}):e.textContent=`There was an error rendering this tooltip.
${b}`,i._update()})):_&&(m&&(_ instanceof Node||Array.isArray(_))?(0,W.setChildren)(e,_,l.sanitizeChildren):e[x]=_),r.modifiers=u(r.modifiers),i.popper=(0,R.fi)(c,a,r),this.container.appendChild(a),i.visible=!0,l.onShow&&l.onShow(w,i)}hide(i){const l=this.options;if(l.onHide&&l.onHide(i.target,i),i.popper&&(i.popper.destroy(),i.popper=null),i.outer){const w=i.outer;w._ffz_over_handler&&w.removeEventListener("mouseover",w._ffz_over_handler),w._ffz_out_handler&&w.removeEventListener("mouseout",w._ffz_out_handler),w._ffz_move_handler&&w.removeEventListener("mousemove",w._ffz_move_handler),w.remove(),i.outer=w._ffz_out_handler=w._ffz_over_handler=null}this.live&&this.elements&&this.elements.delete(i.target),i.target._ffz_tooltip===i&&(i.target._ffz_tooltip=null),i.target[this._accessor]=null,i._update=i.rerender=i.update=S,i.element=null,i.visible=!1}};G(n,"Tooltip");let v=n;const f=v;function u(s){const i=[];for(const[l,w]of Object.entries(s)){const _={name:l};if(w&&typeof w=="object"&&!Array.isArray(w)){(0,B.has)(w,"enabled")&&(_.enabled=w.enabled);const o=Object.keys(w);(o.length>1||o.length===1&&o[0]!=="enabled")&&(_.options=w)}i.push(_)}return i}G(u,"normalizeModifiers");function y(s,i,l=0,w=0){let _;if(s instanceof HTMLElement){const e=s.getBoundingClientRect();_=e.x,i=e.y,l=e.height,w=e.width}else _=s;return{getBoundingClientRect:()=>({top:i,bottom:i+l,y:i,left:_,right:_+w,x:s,height:l,width:w}),clientWidth:w,clientHeight:l}}G(y,"makeReference");function S(){}G(S,"noop")},2356:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{DEFAULT_FORMATS:()=>S,DEFAULT_TYPES:()=>y,TranslationCore:()=>n,default:()=>s,getCardinalName:()=>_,getOrdinalName:()=>a});var W=d(51722),B=d.n(W),R=d(92045),I=d.n(R),U=d(46949),z=d(83269),v=d(22923),f=d.n(v);B().extend(I());const u={allowTags:!1,requireOther:!1},y={tostring(C){return`${C}`},select(C,m,x,$,r,c){const b=m.o&&(m.o[C]||m.o.other);if(b)return this._processAST(b,c,x)},plural(C,m,x,$,r,c){const b=m.o&&(m.o[`=${C}`]||m.o[_(x,C)]||m.o.other);if(b)return this._processAST(b,c,x)},selectordinal(C,m,x,$,r,c){const b=m.o&&(m.o[`=${C}`]||m.o[a(x,C)]||m.o.other);if(b)return this._processAST(b,c,x)},number(C,m){if(typeof C!="number"){let x=parseFloat(C);if((isNaN(x)||!isFinite(x))&&(x=parseInt(C,10)),isNaN(x)||!isFinite(x))return C;C=x}return this.formatNumber(C,m.f)},currency(C,m){if(typeof C!="number"){let x=parseFloat(C);if((isNaN(x)||!isFinite(x))&&(x=parseInt(C,10)),isNaN(x)||!isFinite(x))return C;C=x}return this.formatCurrency(C,m.f)},date(C,m){return this.formatDate(C,m.f)},time(C,m){return this.formatTime(C,m.f)},datetime(C,m){return this.formatDateTime(C,m.f)},duration(C){return this.formatDuration(C)},localestring(C){return this.toLocaleString(C)},relativetime(C,m){return this.formatRelativeTime(C,m.f)},humantime(C,m){return this.formatRelativeTime(C,m.f)},en_plural:C=>C!==1?"s":""},S={number:{currency:{style:"currency"},percent:{style:"percent"},long_percent:{style:"percent",minimumFractionDigits:2}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},default:{},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}},datetime:{short:{month:"numeric",day:"numeric",year:"2-digit",hour:"numeric",minute:"numeric"},medium:{},long:{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},p=class p{constructor(m){if(m=m||{},this.warn=m.warn,this._locale=m.locale||"en",this._dayjs_locale=m.dayjsLocale||"en",this.defaultLocale=m.defaultLocale||this._locale,this.transformation=null,this.defaultDateFormat=m.defaultDateFormat??"default",this.defaultTimeFormat=m.defaultTimeFormat??"short",this.defaultDateTimeFormat=m.defaultDateTimeFormat??"medium",this.phrases=new Map,this.cache=new Map,this.numberFormats=new Map,this.currencyFormats=new Map,this.formats=Object.assign({},S),m.formats){const x=Object.keys(m.formats);for(const $ of x)this.formats[$]=Object.assign({},this.formats[$],m.formats[$])}this.types=Object.assign({},y,m.types||{}),this.parser=new(f())(Object.assign({},u,m.parserOptions)),m.phrases&&this.extend(m.phrases)}get locale(){return this._locale}set locale(m){m!==this._locale&&(this._locale=m,this.numberFormats.clear(),this.currencyFormats.clear())}toLocaleString(m){return m?.toLocaleString?m.toLocaleString(this._locale):typeof m!="string"?`${m}`:m}formatRelativeTime(m,x){const $=B()(m),r=x==="plain";try{return $.locale(this._dayjs_locale).fromNow(r)}catch{return $.fromNow(r)}}formatCurrency(m,x){let $=this.currencyFormats.get(x);return $||($=new Intl.NumberFormat(navigator.languages,{style:"currency",currency:x}),this.currencyFormats.set(x,$)),$.format(m)}formatNumber(m,x){let $=this.numberFormats.get(x);return $||(this.formats.number[x]?$=new Intl.NumberFormat(this.locale,this.formats.number[x]):typeof x=="number"?$=new Intl.NumberFormat(this.locale,{minimumFractionDigits:x,maximumFractionDigits:x}):$=new Intl.NumberFormat(this.locale),this.numberFormats.set(x,$)),$.format(m)}formatDuration(m){return(0,z.duration_to_string)(m)}formatDate(m,x){if(x||(x=this.defaultDateFormat),x&&!this.formats.date[x]){const $=B()(m);try{return $.locale(this._dayjs_locale).format(x)}catch{return $.format(x)}}return m instanceof Date||(m=new Date(m)),m.toLocaleDateString(this._locale,this.formats.date[x]||{})}formatTime(m,x){if(x||(x=this.defaultTimeFormat),x&&!this.formats.time[x]){const $=B()(m);try{return $.locale(this._dayjs_locale).format(x)}catch{return $.format(x)}}return m instanceof Date||(m=new Date(m)),m.toLocaleTimeString(this._locale,this.formats.time[x]||{})}formatDateTime(m,x){if(x||(x=this.defaultDateTimeFormat),x&&!this.formats.datetime[x]){const $=B()(m);try{return $.locale(this._dayjs_locale).format(x)}catch{return $.format(x)}}return m instanceof Date||(m=new Date(m)),m.toLocaleString(this._locale,this.formats.datetime[x]||{})}extend(m,x){const $=[];if(!m||typeof m!="object")return $;for(const r of Object.keys(m)){const c=x?r==="_"?x:`${x}.${r}`:r,b=m[r];if(typeof b=="object")$.push(...this.extend(b,c));else{let k;try{k=this.parser.parse(b)}catch(h){this.warn&&this.warn(`Error parsing i18n phrase for key "${c}": ${b}`,h);continue}this.phrases.set(c,b),this.cache.set(c,k),$.push(c)}}return $}unset(m,x){typeof m=="string"&&(m=[m]);const $=Array.isArray(m)?m:Object.keys(m);for(const r of $){const c=x?r==="_"?x:`${x}.${r}`:r;typeof m[r]=="object"?this.unset(m,c):(this.phrases.delete(c),this.cache.delete(c))}}has(m){return this.phrases.has(m)}set(m,x){const $=this.parser.parse(x);this.phrases.set(m,x),this.cache.set(m,$)}clear(){this.phrases.clear(),this.cache.clear()}replace(m){this.clear(),this.extend(m)}_preTransform(m,x,$,r={}){let c,b,k=$??{};if(typeof k=="number"&&(k={count:k}),!r.noCache&&this.phrases.has(m))c=this.cache.get(m)??[],b=this.locale;else if(!r.noCache&&this.cache.has(m))c=this.cache.get(m)??[],b=this.defaultLocale;else{let h=null;try{h=this.parser.parse(x)}catch(M){if(r.throwParse)throw M;!r.noWarn&&this.warn&&this.warn(`Error parsing i18n phrase for key "${m}": ${x}`,M),c=["parsing error"],b=this.defaultLocale}h?(c=h,b=this.locale,r.noCache||(this.locale===this.defaultLocale&&this.phrases.set(m,x),this.cache.set(m,h))):(c=[],b=this.defaultLocale)}return this.transformation&&(c=this.transformation(m,c)),[c,k,b]}t(m,x,$,r){return i(this.tList(m,x,$,r))}tList(m,x,$,r){return this._processAST(...this._preTransform(m,x,$,r))}formatNode(m,x,$,r,c){if(!m||typeof m!="object")return m;$==null&&($=this.locale);const b=(0,U.get)(m.v,x);if(b==null)return null;if(m.t){const k=this.types[m.t];if(k)return k.call(this,b,m,$,r,c,x);this.warn&&this.warn(`Encountered unknown type "${m.t}" when formatting node.`)}return b}_processAST(m,x,$){const r=[];for(const c of m){const b=this.formatNode(c,x,$,r,m);b!=null&&r.push(b)}return r}};G(p,"TranslationCore");let n=p;const s=n;function i(C){return Array.isArray(C)?C.map(i).join(""):`${C}`}G(i,"listToString");let l=null,w=null;function _(C,m){return(!l||C!==w)&&(l=new Intl.PluralRules(C,{type:"cardinal"}),w=C),l.select(m)}G(_,"getCardinalName");let o=null,e=null;function a(C,m){return(!o||C!==e)&&(o=new Intl.PluralRules(C,{type:"ordinal"}),e=C),o.select(m)}G(a,"getOrdinalName")},27040:(ae,J,d)=>{"use strict";d.d(J,{default:()=>R});var W=d(22527),B=d(46949);const I=class I extends W.default{constructor(z,v){super(z,v),this.apollo=null,this.site=null,this.site=this.parent,this.inject("site.apollo"),this._waiting_user_ids=new Map,this._waiting_user_logins=new Map,this._waiting_stream_ids=new Map,this._waiting_stream_logins=new Map,this._waiting_flag_ids=new Map,this._waiting_flag_logins=new Map,this.tag_cache=new Map,this._waiting_tags=new Map,this._loadStreams=(0,B.debounce)(this._loadStreams,50)}queryApollo(z,v,f){let u;return!v&&!f&&"query"in z&&z.query?u=z:(u={query:z,variables:v},f&&(u=Object.assign(u,f))),this.apollo.client.query(u)}mutate(z,v,f){let u;return!v&&!f&&"mutation"in z&&z.mutation?u=z:(u={mutation:z,variables:v},f&&(u=Object.assign(u,f))),this.apollo.client.mutate(u)}get languageCode(){const z=this.site.getSession();return z&&z.languageCode||"en"}get locale(){const z=this.site.getSession();return z&&z.locale||"en-US"}async getBadges(){const z=await this.queryApollo(await d.e(3224).then(d.t.bind(d,68905,23)));return(0,B.get)("data.badges",z)}async getMatchingCategories(z,v=15,f=null){const u=await this.queryApollo(await d.e(3224).then(d.t.bind(d,29817,23)),{query:z,first:v,cursor:f}),y=(0,B.get)("data.searchCategories.edges.@each.node",u)??[],S=z.toLowerCase();return Array.isArray(y)&&y.sort((n,s)=>{const i=n&&(n.name?.toLowerCase?.()===S||n?.displayName?.toLowerCase?.()===S),l=n&&(s.name?.toLowerCase?.()===S||s?.displayName?.toLowerCase?.()===S);return i&&!l?-1:!i&&l?1:0}),{cursor:(0,B.get)("data.searchCategories.edges.@last.cursor",u),items:y,finished:!(0,B.get)("data.searchCategories.pageInfo.hasNextPage",u),count:(0,B.get)("data.searchCategories.totalCount",u)||0}}async getCategory(z,v){const f=await this.queryApollo(await d.e(3224).then(d.t.bind(d,95373,23)),{id:z,name:v});return(0,B.get)("data.game",f)}async deleteChatMessage(z,v){z=String(z);const f=await this.mutate({mutation:await d.e(3224).then(d.t.bind(d,4223,23)),variables:{input:{channelID:z,messageID:v}}}),u=(0,B.get)("data.deleteChatMessage.responseCode",f);if(u==="TARGET_IS_BROADCASTER")throw new B.TranslatableError("You cannot delete the broadcaster's messages.","chat.delete.forbidden.broadcaster");if(u==="TARGET_IS_MODERATOR")throw new B.TranslatableError("You cannot delete messages from moderator {displayName}.","chat.delete.forbidden.moderator",(0,B.get)("data.deleteChatMessage.message.sender",f));if(u!=="SUCCESS")throw new B.TranslatableError("You don't have permission to delete messages.","chat.delete.forbidden");return!0}async getMatchingUsers(z,v=15,f=null){const u=await this.queryApollo(await d.e(3224).then(d.t.bind(d,4176,23)),{query:z,first:v,cursor:f}),y=(0,B.get)("data.searchUsers.edges.@each.node",u)??[],S=z.toLowerCase();return Array.isArray(y)&&y.sort((n,s)=>{const i=n&&(n.login?.toLowerCase?.()===S||n?.displayName?.toLowerCase?.()===S),l=n&&(s.login?.toLowerCase?.()===S||s?.displayName?.toLowerCase?.()===S);return i&&!l?-1:!i&&l?1:0}),{cursor:(0,B.get)("data.searchUsers.edges.@last.cursor",u),items:y,finished:!(0,B.get)("data.searchUsers.pageInfo.hasNextPage",u),count:(0,B.get)("data.searchUsers.totalCount",u)||0}}async getUser(z,v){const f=await this.queryApollo(await d.e(3224).then(d.t.bind(d,2247,23)),{id:z,login:v});return(0,B.get)("data.user",f)}async getUserGame(z,v){const f=await this.queryApollo(await d.e(3224).then(d.t.bind(d,34489,23)),{id:z,login:v});return(0,B.get)("data.user.broadcastSettings.game",f)}async getUserSelf(z,v){const f=await this.queryApollo(await d.e(3224).then(d.t.bind(d,23333,23)),{id:z,login:v});return(0,B.get)("data.user.self",f)}async getUserFollowed(z,v){const f=await this.queryApollo(await d.e(3224).then(d.t.bind(d,70470,23)),{id:z,login:v});return(0,B.get)("data.user.self.follower",f)}async followUser(z,v=!1){z=String(z),v=!!v;const f=await this.mutate({mutation:await d.e(3224).then(d.t.bind(d,33886,23)),variables:{input:{targetID:z,disableNotifications:v}}});console.log("result",f);const u=(0,B.get)("data.followUser.error",f);if(u?.code)throw new Error(u.code);return(0,B.get)("data.followUser.follow",f)}async unfollowUser(z,v=!1){z=String(z),v=!!v;const f=await this.mutate({mutation:await d.e(3224).then(d.t.bind(d,65199,23)),variables:{input:{targetID:z}}});return console.log("result",f),(0,B.get)("data.unfollowUser.follow",f)}async getLastBroadcast(z,v){const f=await this.queryApollo(await d.e(3224).then(d.t.bind(d,27991,23)),{id:z,login:v});return(0,B.get)("data.user.lastBroadcast",f)}getUserBasic(z,v){return new Promise((f,u)=>{z?this._waiting_user_ids.has(z)?this._waiting_user_ids.get(z).push([f,u]):this._waiting_user_ids.set(z,[[f,u]]):v?this._waiting_user_logins.has(v)?this._waiting_user_logins.get(v).push([f,u]):this._waiting_user_logins.set(v,[[f,u]]):u("id and login cannot both be null"),this._loading_users||this._loadUsers()})}async _loadUsers(){if(this._loading_users)return;this._loading_users=!0;const z=[...this._waiting_user_ids.keys()].slice(0,50),v=50-z.length,f=v>0?[...this._waiting_user_logins.keys()].slice(0,v):[];let u;try{const n=await this.queryApollo({query:await d.e(3224).then(d.t.bind(d,59649,23)),variables:{ids:z.length?z:null,logins:f.length?f:null}});u=(0,B.get)("data.users",n)}catch(n){for(const s of z){const i=this._waiting_user_ids.get(s);this._waiting_user_ids.delete(s);for(const l of i)l[1](n)}for(const s of f){const i=this._waiting_user_logins.get(s);this._waiting_user_logins.delete(s);for(const l of i)l[1](n)}return}const y=new Set(z),S=new Set(f);if(Array.isArray(u))for(const n of u){if(!n||!n.id)continue;y.delete(n.id),S.delete(n.login);let s=this._waiting_user_ids.get(n.id);if(s){this._waiting_user_ids.delete(n.id);for(const i of s)i[0](n)}if(s=this._waiting_user_logins.get(n.login),s){this._waiting_user_logins.delete(n.login);for(const i of s)i[0](n)}}for(const n of y){const s=this._waiting_user_ids.get(n);if(s){this._waiting_user_ids.delete(n);for(const i of s)i[0](null)}}for(const n of S){const s=this._waiting_user_logins.get(n);if(s){this._waiting_user_logins.delete(n);for(const i of s)i[0](null)}}this._loading_users=!1,(this._waiting_user_ids.size||this._waiting_user_logins.size)&&this._loadUsers()}async getBroadcastID(z,v){const f=await this.queryApollo({query:await d.e(3224).then(d.t.bind(d,33929,23)),variables:{id:z,login:v}});return(0,B.get)("data.user.stream.archiveVideo.id",f)}async getChannelColor(z,v){const f=await this.queryApollo({query:await d.e(3224).then(d.t.bind(d,30252,23)),variables:{id:z,login:v}});return(0,B.get)("data.user.primaryColorHex",f)}async getPoll(z){const v=await this.queryApollo({query:await d.e(3224).then(d.t.bind(d,89218,23)),variables:{id:z}});return(0,B.get)("data.poll",v)}async createPoll(z,v,f,u={}){if(typeof v!="string")throw new TypeError("title must be string");if(!Array.isArray(f)||f.some(s=>typeof s!="string"))throw new TypeError("choices must be array of strings");let y=u.bits||0,S=u.duration||60;(typeof y!="number"||y<0)&&(y=0),(typeof S!="number"||S<0)&&(S=60);const n=await this.mutate({mutation:await d.e(3224).then(d.t.bind(d,31902,23)),variables:{input:{bitsCost:y,bitsVoting:y>0,choices:f.map(s=>({title:s})),durationSeconds:S,ownedBy:`${z}`,subscriberMultiplier:u.subscriberMultiplier||!1,subscriberOnly:u.subscriberOnly||!1,title:v}}});return(0,B.get)("data.createPoll.poll",n)}async archivePoll(z){const v=await this.mutate({mutation:await d.e(3224).then(d.t.bind(d,83852,23)),variables:{id:z}});return(0,B.get)("data.archivePoll.poll",v)}async terminatePoll(z){const v=await this.mutate({mutation:await d.e(3224).then(d.t.bind(d,20685,23)),variables:{id:z}});return(0,B.get)("data.terminatePoll.poll",v)}getStreamMeta(z,v){return new Promise((f,u)=>{z?this._waiting_stream_ids.has(z)?this._waiting_stream_ids.get(z).push([f,u]):this._waiting_stream_ids.set(z,[[f,u]]):v?this._waiting_stream_logins.has(v)?this._waiting_stream_logins.get(v).push([f,u]):this._waiting_stream_logins.set(v,[[f,u]]):u("id and login cannot both be null"),this._loading_streams||this._loadStreams()})}async _loadStreams(){if(this._loading_streams)return;this._loading_streams=!0;const z=[...this._waiting_stream_ids.keys()].slice(0,50),v=50-z.length,f=v>0?[...this._waiting_stream_logins.keys()].slice(0,v):[];let u;try{const n=await this.queryApollo({query:await d.e(3224).then(d.t.bind(d,61421,23)),variables:{ids:z.length?z:null,logins:f.length?f:null}});u=(0,B.get)("data.users",n)}catch(n){for(const s of z){const i=this._waiting_stream_ids.get(s);this._waiting_stream_ids.delete(s);for(const l of i)l[1](n)}for(const s of f){const i=this._waiting_stream_logins.get(s);this._waiting_stream_logins.delete(s);for(const l of i)l[1](n)}return}const y=new Set(z),S=new Set(f);if(Array.isArray(u))for(const n of u){if(!n||!n.id)continue;y.delete(n.id),S.delete(n.login);let s=this._waiting_stream_ids.get(n.id);if(s){this._waiting_stream_ids.delete(n.id);for(const i of s)i[0](n.stream)}if(s=this._waiting_stream_logins.get(n.login),s){this._waiting_stream_logins.delete(n.login);for(const i of s)i[0](n.stream)}}for(const n of y){const s=this._waiting_stream_ids.get(n);if(s){this._waiting_stream_ids.delete(n);for(const i of s)i[0](null)}}for(const n of S){const s=this._waiting_stream_logins.get(n);if(s){this._waiting_stream_logins.delete(n);for(const i of s)i[0](null)}}this._loading_streams=!1,(this._waiting_stream_ids.size||this._waiting_stream_logins.size)&&this._loadStreams()}getStreamFlags(z,v){return new Promise((f,u)=>{if(typeof z=="number"&&(z=`${z}`),z){const y=this._waiting_flag_ids.get(z);y?y.push([f,u]):this._waiting_flag_ids.set(z,[[f,u]])}else if(v){const y=this._waiting_flag_logins.get(v);y?y.push([f,u]):this._waiting_flag_logins.set(v,[[f,u]])}else u("id and login cannot both be null");this._loading_flags||this._loadStreamFlags()})}async _loadStreamFlags(){if(this._loading_flags)return;this._loading_flags=!0;const z=[...this._waiting_flag_ids.keys()].slice(0,50),v=50-z.length,f=v>0?[...this._waiting_flag_logins.keys()].slice(0,v):[];let u;try{const n=await this.queryApollo({query:await d.e(3224).then(d.t.bind(d,9808,23)),variables:{ids:z.length?z:null,logins:f.length?f:null}});u=(0,B.get)("data.users",n)}catch(n){for(const s of z){const i=this._waiting_flag_ids.get(s);if(i){this._waiting_flag_ids.delete(s);for(const l of i)l[1](n)}}for(const s of f){const i=this._waiting_flag_logins.get(s);if(i){this._waiting_flag_logins.delete(s);for(const l of i)l[1](n)}}return}const y=new Set(z),S=new Set(f);if(Array.isArray(u))for(const n of u){if(!n||!n.id)continue;y.delete(n.id),S.delete(n.login);let s=this._waiting_flag_ids.get(n.id);if(s){this._waiting_flag_ids.delete(n.id);for(const i of s)i[0](n.stream?.contentClassificationLabels)}if(s=this._waiting_flag_logins.get(n.login),s){this._waiting_flag_logins.delete(n.login);for(const i of s)i[0](n.stream?.contentClassificationLabels)}}for(const n of y){const s=this._waiting_flag_ids.get(n);if(s){this._waiting_flag_ids.delete(n);for(const i of s)i[0](null)}}for(const n of S){const s=this._waiting_flag_logins.get(n);if(s){this._waiting_flag_logins.delete(n);for(const i of s)i[0](null)}}this._loading_flags=!1,(this._waiting_flag_ids.size||this._waiting_flag_logins.size)&&this._loadStreamFlags()}async getMatchingTags(z){const f=(await this.queryApollo({query:await d.e(3224).then(d.t.bind(d,50873,23)),variables:{query:z,first:100}}))?.data?.searchFreeformTags?.edges;if(!Array.isArray(f)||!f.length)return[];const u=[];for(const y of f){const S=y?.node?.tagName;S&&u.push(S)}return u}};G(I,"TwitchData");let R=I},36e3:ae=>{var J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetClipInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"slug"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"clip"},arguments:[{kind:"Argument",name:{kind:"Name",value:"slug"},value:{kind:"Variable",name:{kind:"Name",value:"slug"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"curator"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"broadcaster"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"game"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"thumbnailURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"86"}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"IntValue",value:"45"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"viewCount"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:184}};J.loc.source={body:"query FFZ_GetClipInfo($slug:ID!){clip(slug:$slug){id curator{id login displayName}broadcaster{id login displayName}game{id displayName}title thumbnailURL(width:86 height:45)viewCount}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var d={};function W(z){return z.filter(function(v){if(v.kind!=="FragmentDefinition")return!0;var f=v.name.value;return d[f]?!1:(d[f]=!0,!0)})}G(W,"unique");function B(z,v){if(z.kind==="FragmentSpread")v.add(z.name.value);else if(z.kind==="VariableDefinition"){var f=z.type;f.kind==="NamedType"&&v.add(f.name.value)}z.selectionSet&&z.selectionSet.selections.forEach(function(u){B(u,v)}),z.variableDefinitions&&z.variableDefinitions.forEach(function(u){B(u,v)}),z.definitions&&z.definitions.forEach(function(u){B(u,v)})}G(B,"collectFragmentReferences");var R={};G(function(){J.definitions.forEach(function(v){if(v.name){var f=new Set;B(v,f),R[v.name.value]=f}})},"extractReferences")();function I(z,v){for(var f=0;f<z.definitions.length;f++){var u=z.definitions[f];if(u.name&&u.name.value==v)return u}}G(I,"findOperation");function U(z,v){var f={kind:z.kind,definitions:[I(z,v)]};z.hasOwnProperty("loc")&&(f.loc=z.loc);var u=R[v]||new Set,y=new Set,S=new Set;for(u.forEach(function(s){S.add(s)});S.size>0;){var n=S;S=new Set,n.forEach(function(s){if(!y.has(s)){y.add(s);var i=R[s]||new Set;i.forEach(function(l){S.add(l)})}})}return y.forEach(function(s){var i=I(z,s);i&&f.definitions.push(i)}),f}G(U,"oneQuery"),ae.exports=J,ae.exports.FFZ_GetClipInfo=U(J,"FFZ_GetClipInfo")},98750:ae=>{var J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetEmoteInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"artist"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"setID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"text"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionProduct"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:174}};J.loc.source={body:"query FFZ_GetEmoteInfo($id:ID!){emote(id:$id){id artist{id login displayName}owner{id login displayName}setID text subscriptionProduct{id state owner{id login displayName}}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var d={};function W(z){return z.filter(function(v){if(v.kind!=="FragmentDefinition")return!0;var f=v.name.value;return d[f]?!1:(d[f]=!0,!0)})}G(W,"unique");function B(z,v){if(z.kind==="FragmentSpread")v.add(z.name.value);else if(z.kind==="VariableDefinition"){var f=z.type;f.kind==="NamedType"&&v.add(f.name.value)}z.selectionSet&&z.selectionSet.selections.forEach(function(u){B(u,v)}),z.variableDefinitions&&z.variableDefinitions.forEach(function(u){B(u,v)}),z.definitions&&z.definitions.forEach(function(u){B(u,v)})}G(B,"collectFragmentReferences");var R={};G(function(){J.definitions.forEach(function(v){if(v.name){var f=new Set;B(v,f),R[v.name.value]=f}})},"extractReferences")();function I(z,v){for(var f=0;f<z.definitions.length;f++){var u=z.definitions[f];if(u.name&&u.name.value==v)return u}}G(I,"findOperation");function U(z,v){var f={kind:z.kind,definitions:[I(z,v)]};z.hasOwnProperty("loc")&&(f.loc=z.loc);var u=R[v]||new Set,y=new Set,S=new Set;for(u.forEach(function(s){S.add(s)});S.size>0;){var n=S;S=new Set,n.forEach(function(s){if(!y.has(s)){y.add(s);var i=R[s]||new Set;i.forEach(function(l){S.add(l)})}})}return y.forEach(function(s){var i=I(z,s);i&&f.definitions.push(i)}),f}G(U,"oneQuery"),ae.exports=J,ae.exports.FFZ_GetEmoteInfo=U(J,"FFZ_GetEmoteInfo")},60795:ae=>{var J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetEmoteSetInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emoteSet"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionProducts"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emoteSetID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:126}};J.loc.source={body:"query FFZ_GetEmoteSetInfo($id:ID!){emoteSet(id:$id){id owner{id login displayName subscriptionProducts{id emoteSetID state}}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var d={};function W(z){return z.filter(function(v){if(v.kind!=="FragmentDefinition")return!0;var f=v.name.value;return d[f]?!1:(d[f]=!0,!0)})}G(W,"unique");function B(z,v){if(z.kind==="FragmentSpread")v.add(z.name.value);else if(z.kind==="VariableDefinition"){var f=z.type;f.kind==="NamedType"&&v.add(f.name.value)}z.selectionSet&&z.selectionSet.selections.forEach(function(u){B(u,v)}),z.variableDefinitions&&z.variableDefinitions.forEach(function(u){B(u,v)}),z.definitions&&z.definitions.forEach(function(u){B(u,v)})}G(B,"collectFragmentReferences");var R={};G(function(){J.definitions.forEach(function(v){if(v.name){var f=new Set;B(v,f),R[v.name.value]=f}})},"extractReferences")();function I(z,v){for(var f=0;f<z.definitions.length;f++){var u=z.definitions[f];if(u.name&&u.name.value==v)return u}}G(I,"findOperation");function U(z,v){var f={kind:z.kind,definitions:[I(z,v)]};z.hasOwnProperty("loc")&&(f.loc=z.loc);var u=R[v]||new Set,y=new Set,S=new Set;for(u.forEach(function(s){S.add(s)});S.size>0;){var n=S;S=new Set,n.forEach(function(s){if(!y.has(s)){y.add(s);var i=R[s]||new Set;i.forEach(function(l){S.add(l)})}})}return y.forEach(function(s){var i=I(z,s);i&&f.definitions.push(i)}),f}G(U,"oneQuery"),ae.exports=J,ae.exports.FFZ_GetEmoteSetInfo=U(J,"FFZ_GetEmoteSetInfo")},87590:ae=>{var J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetVideoInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"video"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"previewThumbnailURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"320"}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"IntValue",value:"180"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"lengthSeconds"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"publishedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"viewCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"game"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profileImageURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"50"}}],directives:[]}]}}]}}]}}],loc:{start:0,end:207}};J.loc.source={body:"query FFZ_GetVideoInfo($id:ID!){video(id:$id){id title previewThumbnailURL(width:320 height:180)lengthSeconds publishedAt viewCount game{id displayName}owner{id login displayName profileImageURL(width:50)}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var d={};function W(z){return z.filter(function(v){if(v.kind!=="FragmentDefinition")return!0;var f=v.name.value;return d[f]?!1:(d[f]=!0,!0)})}G(W,"unique");function B(z,v){if(z.kind==="FragmentSpread")v.add(z.name.value);else if(z.kind==="VariableDefinition"){var f=z.type;f.kind==="NamedType"&&v.add(f.name.value)}z.selectionSet&&z.selectionSet.selections.forEach(function(u){B(u,v)}),z.variableDefinitions&&z.variableDefinitions.forEach(function(u){B(u,v)}),z.definitions&&z.definitions.forEach(function(u){B(u,v)})}G(B,"collectFragmentReferences");var R={};G(function(){J.definitions.forEach(function(v){if(v.name){var f=new Set;B(v,f),R[v.name.value]=f}})},"extractReferences")();function I(z,v){for(var f=0;f<z.definitions.length;f++){var u=z.definitions[f];if(u.name&&u.name.value==v)return u}}G(I,"findOperation");function U(z,v){var f={kind:z.kind,definitions:[I(z,v)]};z.hasOwnProperty("loc")&&(f.loc=z.loc);var u=R[v]||new Set,y=new Set,S=new Set;for(u.forEach(function(s){S.add(s)});S.size>0;){var n=S;S=new Set,n.forEach(function(s){if(!y.has(s)){y.add(s);var i=R[s]||new Set;i.forEach(function(l){S.add(l)})}})}return y.forEach(function(s){var i=I(z,s);i&&f.definitions.push(i)}),f}G(U,"oneQuery"),ae.exports=J,ae.exports.FFZ_GetVideoInfo=U(J,"FFZ_GetVideoInfo")},96883:ae=>{var J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_EmoteCard"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"emoteID"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"emoteID"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"setID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"artist"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"channel"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"localEmoteSets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emotes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"stream"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"follower"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"followedAt"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"subscriptionBenefit"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tier"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"subscriptionProducts"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tier"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emotes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"priceInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"currency"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"price"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"bitsBadgeTierSummary"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"threshold"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isUnlocked"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"numberOfBitsUntilUnlock"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:418}};J.loc.source={body:"query FFZ_EmoteCard($emoteID:ID!){emote(id:$emoteID){id type token setID artist{id login displayName}owner{id login displayName channel{id localEmoteSets{id emotes{id token}}}stream{id type}self{follower{followedAt}subscriptionBenefit{id tier}}subscriptionProducts{id displayName tier name url emotes{id token}priceInfo{id currency price}}}bitsBadgeTierSummary{threshold self{isUnlocked numberOfBitsUntilUnlock}}type}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var d={};function W(z){return z.filter(function(v){if(v.kind!=="FragmentDefinition")return!0;var f=v.name.value;return d[f]?!1:(d[f]=!0,!0)})}G(W,"unique");function B(z,v){if(z.kind==="FragmentSpread")v.add(z.name.value);else if(z.kind==="VariableDefinition"){var f=z.type;f.kind==="NamedType"&&v.add(f.name.value)}z.selectionSet&&z.selectionSet.selections.forEach(function(u){B(u,v)}),z.variableDefinitions&&z.variableDefinitions.forEach(function(u){B(u,v)}),z.definitions&&z.definitions.forEach(function(u){B(u,v)})}G(B,"collectFragmentReferences");var R={};G(function(){J.definitions.forEach(function(v){if(v.name){var f=new Set;B(v,f),R[v.name.value]=f}})},"extractReferences")();function I(z,v){for(var f=0;f<z.definitions.length;f++){var u=z.definitions[f];if(u.name&&u.name.value==v)return u}}G(I,"findOperation");function U(z,v){var f={kind:z.kind,definitions:[I(z,v)]};z.hasOwnProperty("loc")&&(f.loc=z.loc);var u=R[v]||new Set,y=new Set,S=new Set;for(u.forEach(function(s){S.add(s)});S.size>0;){var n=S;S=new Set,n.forEach(function(s){if(!y.has(s)){y.add(s);var i=R[s]||new Set;i.forEach(function(l){S.add(l)})}})}return y.forEach(function(s){var i=I(z,s);i&&f.definitions.push(i)}),f}G(U,"oneQuery"),ae.exports=J,ae.exports.FFZ_EmoteCard=U(J,"FFZ_EmoteCard")},90424:ae=>{var J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_EmoteMenu_SubStatus"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"after"}},type:{kind:"NamedType",name:{kind:"Name",value:"Cursor"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"criteria"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SubscriptionBenefitCriteriaInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentUser"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionBenefits"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"after"}}},{kind:"Argument",name:{kind:"Name",value:"criteria"},value:{kind:"Variable",name:{kind:"Name",value:"criteria"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"pageInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasNextPage"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"edges"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cursor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"node"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"gift"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isGift"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"purchasedWithPrime"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"endsAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"renewsAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"product"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emoteSetID"},arguments:[],directives:[]}]}}]}}]}}]}}]}}]}}],loc:{start:0,end:296}};J.loc.source={body:"query FFZ_EmoteMenu_SubStatus($first:Int$after:Cursor$criteria:SubscriptionBenefitCriteriaInput!){currentUser{id subscriptionBenefits(first:$first after:$after criteria:$criteria){pageInfo{hasNextPage}edges{cursor node{id gift{isGift}purchasedWithPrime endsAt renewsAt product{id emoteSetID}}}}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var d={};function W(z){return z.filter(function(v){if(v.kind!=="FragmentDefinition")return!0;var f=v.name.value;return d[f]?!1:(d[f]=!0,!0)})}G(W,"unique");function B(z,v){if(z.kind==="FragmentSpread")v.add(z.name.value);else if(z.kind==="VariableDefinition"){var f=z.type;f.kind==="NamedType"&&v.add(f.name.value)}z.selectionSet&&z.selectionSet.selections.forEach(function(u){B(u,v)}),z.variableDefinitions&&z.variableDefinitions.forEach(function(u){B(u,v)}),z.definitions&&z.definitions.forEach(function(u){B(u,v)})}G(B,"collectFragmentReferences");var R={};G(function(){J.definitions.forEach(function(v){if(v.name){var f=new Set;B(v,f),R[v.name.value]=f}})},"extractReferences")();function I(z,v){for(var f=0;f<z.definitions.length;f++){var u=z.definitions[f];if(u.name&&u.name.value==v)return u}}G(I,"findOperation");function U(z,v){var f={kind:z.kind,definitions:[I(z,v)]};z.hasOwnProperty("loc")&&(f.loc=z.loc);var u=R[v]||new Set,y=new Set,S=new Set;for(u.forEach(function(s){S.add(s)});S.size>0;){var n=S;S=new Set,n.forEach(function(s){if(!y.has(s)){y.add(s);var i=R[s]||new Set;i.forEach(function(l){S.add(l)})}})}return y.forEach(function(s){var i=I(z,s);i&&f.definitions.push(i)}),f}G(U,"oneQuery"),ae.exports=J,ae.exports.FFZ_EmoteMenu_SubStatus=U(J,"FFZ_EmoteMenu_SubStatus")},4866:(ae,J,d)=>{var W=d(89),B=d(49388),R=d(64311),I=d(45138);function U(z,v,f){if(arguments.length<2&&(f=z,z=null,v=null),this.capacity=f,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-cache: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-cache: capacity should be a finite positive integer.");var u=R.getPointerArray(f);this.forward=new u(f),this.backward=new u(f),this.K=typeof z=="function"?new z(f):new Array(f),this.V=typeof v=="function"?new v(f):new Array(f),this.size=0,this.head=0,this.tail=0,this.items={}}G(U,"LRUCache"),U.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items={}},U.prototype.splayOnTop=function(z){var v=this.head;if(this.head===z)return this;var f=this.backward[z],u=this.forward[z];return this.tail===z?this.tail=f:this.backward[u]=f,this.forward[f]=u,this.backward[v]=z,this.head=z,this.forward[z]=v,this},U.prototype.set=function(z,v){var f=this.items[z];if(typeof f<"u"){this.splayOnTop(f),this.V[f]=v;return}this.size<this.capacity?f=this.size++:(f=this.tail,this.tail=this.backward[f],delete this.items[this.K[f]]),this.items[z]=f,this.K[f]=z,this.V[f]=v,this.forward[f]=this.head,this.backward[this.head]=f,this.head=f},U.prototype.setpop=function(z,v){var f=null,u=null,y=this.items[z];return typeof y<"u"?(this.splayOnTop(y),f=this.V[y],this.V[y]=v,{evicted:!1,key:z,value:f}):(this.size<this.capacity?y=this.size++:(y=this.tail,this.tail=this.backward[y],f=this.V[y],u=this.K[y],delete this.items[this.K[y]]),this.items[z]=y,this.K[y]=z,this.V[y]=v,this.forward[y]=this.head,this.backward[this.head]=y,this.head=y,u?{evicted:!0,key:u,value:f}:null)},U.prototype.has=function(z){return z in this.items},U.prototype.get=function(z){var v=this.items[z];if(!(typeof v>"u"))return this.splayOnTop(v),this.V[v]},U.prototype.peek=function(z){var v=this.items[z];if(!(typeof v>"u"))return this.V[v]},U.prototype.forEach=function(z,v){v=arguments.length>1?v:this;for(var f=0,u=this.size,y=this.head,S=this.K,n=this.V,s=this.forward;f<u;)z.call(v,n[y],S[y],this),y=s[y],f++},U.prototype.keys=function(){var z=0,v=this.size,f=this.head,u=this.K,y=this.forward;return new W(function(){if(z>=v)return{done:!0};var S=u[f];return z++,z<v&&(f=y[f]),{done:!1,value:S}})},U.prototype.values=function(){var z=0,v=this.size,f=this.head,u=this.V,y=this.forward;return new W(function(){if(z>=v)return{done:!0};var S=u[f];return z++,z<v&&(f=y[f]),{done:!1,value:S}})},U.prototype.entries=function(){var z=0,v=this.size,f=this.head,u=this.K,y=this.V,S=this.forward;return new W(function(){if(z>=v)return{done:!0};var n=u[f],s=y[f];return z++,z<v&&(f=S[f]),{done:!1,value:[n,s]}})},typeof Symbol<"u"&&(U.prototype[Symbol.iterator]=U.prototype.entries),U.prototype.inspect=function(){for(var z=new Map,v=this.entries(),f;f=v.next(),!f.done;)z.set(f.value[0],f.value[1]);return Object.defineProperty(z,"constructor",{value:U,enumerable:!1}),z},typeof Symbol<"u"&&(U.prototype[Symbol.for("nodejs.util.inspect.custom")]=U.prototype.inspect),U.from=function(z,v,f,u){if(arguments.length<2){if(u=I.guessLength(z),typeof u!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(u=v,v=null,f=null);var y=new U(v,f,u);return B(z,function(S,n){y.set(n,S)}),y},ae.exports=U},45138:(ae,J,d)=>{var W=d(49388),B=d(64311);function R(v){return Array.isArray(v)||B.isTypedArray(v)}G(R,"isArrayLike");function I(v){if(typeof v.length=="number")return v.length;if(typeof v.size=="number")return v.size}G(I,"guessLength");function U(v){var f=I(v),u=typeof f=="number"?new Array(f):[],y=0;return W(v,function(S){u[y++]=S}),u}G(U,"toArray");function z(v){var f=I(v),u=typeof f=="number"?B.getPointerArray(f):Array,y=typeof f=="number"?new Array(f):[],S=typeof f=="number"?new u(f):[],n=0;return W(v,function(s){y[n]=s,S[n]=n++}),[y,S]}G(z,"toArrayWithIndices"),J.isArrayLike=R,J.guessLength=I,J.toArray=U,J.toArrayWithIndices=z},64311:(ae,J)=>{var d=Math.pow(2,8)-1,W=Math.pow(2,16)-1,B=Math.pow(2,32)-1,R=Math.pow(2,7)-1,I=Math.pow(2,15)-1,U=Math.pow(2,31)-1;J.getPointerArray=function(v){var f=v-1;if(f<=d)return Uint8Array;if(f<=W)return Uint16Array;if(f<=B)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},J.getSignedPointerArray=function(v){var f=v-1;return f<=R?Int8Array:f<=I?Int16Array:f<=U?Int32Array:Float64Array},J.getNumberType=function(v){return v===(v|0)?Math.sign(v)===-1?v<=127&&v>=-128?Int8Array:v<=32767&&v>=-32768?Int16Array:Int32Array:v<=255?Uint8Array:v<=65535?Uint16Array:Uint32Array:Float64Array};var z={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};J.getMinimalRepresentation=function(v,f){var u=null,y=0,S,n,s,i,l;for(i=0,l=v.length;i<l;i++)s=f?f(v[i]):v[i],n=J.getNumberType(s),S=z[n.name],S>y&&(y=S,u=n);return u},J.isTypedArray=function(v){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(v)},J.concat=function(){var v=0,f,u,y;for(f=0,y=arguments.length;f<y;f++)v+=arguments[f].length;var S=new arguments[0].constructor(v);for(f=0,u=0;f<y;f++)S.set(arguments[f],u),u+=arguments[f].length;return S},J.indices=function(v){for(var f=J.getPointerArray(v),u=new f(v),y=0;y<v;y++)u[y]=y;return u}},49388:(ae,J,d)=>{var W=d(18713),B=W.ARRAY_BUFFER_SUPPORT,R=W.SYMBOL_SUPPORT;ae.exports=G(function(U,z){var v,f,u,y,S;if(!U)throw new Error("obliterator/forEach: invalid iterable.");if(typeof z!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(U)||B&&ArrayBuffer.isView(U)||typeof U=="string"||U.toString()==="[object Arguments]"){for(u=0,y=U.length;u<y;u++)z(U[u],u);return}if(typeof U.forEach=="function"){U.forEach(z);return}if(R&&Symbol.iterator in U&&typeof U.next!="function"&&(U=U[Symbol.iterator]()),typeof U.next=="function"){for(v=U,u=0;S=v.next(),S.done!==!0;)z(S.value,u),u++;return}for(f in U)U.hasOwnProperty(f)&&z(U[f],f)},"forEach")},89:ae=>{function J(d){if(typeof d!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=d}G(J,"Iterator"),typeof Symbol<"u"&&(J.prototype[Symbol.iterator]=function(){return this}),J.of=function(){var d=arguments,W=d.length,B=0;return new J(function(){return B>=W?{done:!0}:{done:!1,value:d[B++]}})},J.empty=function(){var d=new J(function(){return{done:!0}});return d},J.fromSequence=function(d){var W=0,B=d.length;return new J(function(){return W>=B?{done:!0}:{done:!1,value:d[W++]}})},J.is=function(d){return d instanceof J?!0:typeof d=="object"&&d!==null&&typeof d.next=="function"},ae.exports=J},18713:(ae,J)=>{J.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u",J.SYMBOL_SUPPORT=typeof Symbol<"u"},72167:ae=>{ae.exports=s,ae.exports.match=R,ae.exports.regexpToFunction=I,ae.exports.parse=W,ae.exports.compile=B,ae.exports.tokensToFunction=U,ae.exports.tokensToRegExp=n;var J="/",d=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function W(i,l){for(var w=[],_=0,o=0,e="",a=l&&l.delimiter||J,p=l&&l.whitelist||void 0,C=!1,m;(m=d.exec(i))!==null;){var x=m[0],$=m[1],r=m.index;if(e+=i.slice(o,r),o=r+x.length,$){e+=$[1],C=!0;continue}var c="",b=m[2],k=m[3],h=m[4],M=m[5];if(!C&&e.length){var L=e.length-1,T=e[L],O=p?p.indexOf(T)>-1:!0;O&&(c=T,e=e.slice(0,L))}e&&(w.push(e),e="",C=!1);var P=M==="+"||M==="*",j=M==="?"||M==="*",Z=k||h,q=c||a;w.push({name:b||_++,prefix:c,delimiter:q,optional:j,repeat:P,pattern:Z?v(Z):"[^"+z(q===a?q:q+a)+"]+?"})}return(e||o<i.length)&&w.push(e+i.substr(o)),w}G(W,"parse");function B(i,l){return U(W(i,l),l)}G(B,"compile");function R(i,l){var w=[],_=s(i,w,l);return I(_,w)}G(R,"match");function I(i,l){return function(w,_){var o=i.exec(w);if(!o)return!1;for(var e=o[0],a=o.index,p={},C=_&&_.decode||decodeURIComponent,m=1;m<o.length;m++)if(o[m]!==void 0){var x=l[m-1];x.repeat?p[x.name]=o[m].split(x.delimiter).map(function($){return C($,x)}):p[x.name]=C(o[m],x)}return{path:e,index:a,params:p}}}G(I,"regexpToFunction");function U(i,l){for(var w=new Array(i.length),_=0;_<i.length;_++)typeof i[_]=="object"&&(w[_]=new RegExp("^(?:"+i[_].pattern+")$",f(l)));return function(o,e){for(var a="",p=e&&e.encode||encodeURIComponent,C=e?e.validate!==!1:!0,m=0;m<i.length;m++){var x=i[m];if(typeof x=="string"){a+=x;continue}var $=o?o[x.name]:void 0,r;if(Array.isArray($)){if(!x.repeat)throw new TypeError('Expected "'+x.name+'" to not repeat, but got array');if($.length===0){if(x.optional)continue;throw new TypeError('Expected "'+x.name+'" to not be empty')}for(var c=0;c<$.length;c++){if(r=p($[c],x),C&&!w[m].test(r))throw new TypeError('Expected all "'+x.name+'" to match "'+x.pattern+'"');a+=(c===0?x.prefix:x.delimiter)+r}continue}if(typeof $=="string"||typeof $=="number"||typeof $=="boolean"){if(r=p(String($),x),C&&!w[m].test(r))throw new TypeError('Expected "'+x.name+'" to match "'+x.pattern+'", but got "'+r+'"');a+=x.prefix+r;continue}if(!x.optional)throw new TypeError('Expected "'+x.name+'" to be '+(x.repeat?"an array":"a string"))}return a}}G(U,"tokensToFunction");function z(i){return i.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}G(z,"escapeString");function v(i){return i.replace(/([=!:$/()])/g,"\\$1")}G(v,"escapeGroup");function f(i){return i&&i.sensitive?"":"i"}G(f,"flags");function u(i,l){if(!l)return i;var w=i.source.match(/\((?!\?)/g);if(w)for(var _=0;_<w.length;_++)l.push({name:_,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return i}G(u,"regexpToRegexp");function y(i,l,w){for(var _=[],o=0;o<i.length;o++)_.push(s(i[o],l,w).source);return new RegExp("(?:"+_.join("|")+")",f(w))}G(y,"arrayToRegexp");function S(i,l,w){return n(W(i,w),l,w)}G(S,"stringToRegexp");function n(i,l,w){w=w||{};for(var _=w.strict,o=w.start!==!1,e=w.end!==!1,a=w.delimiter||J,p=[].concat(w.endsWith||[]).map(z).concat("$").join("|"),C=o?"^":"",m=0;m<i.length;m++){var x=i[m];if(typeof x=="string")C+=z(x);else{var $=x.repeat?"(?:"+x.pattern+")(?:"+z(x.delimiter)+"(?:"+x.pattern+"))*":x.pattern;l&&l.push(x),x.optional?x.prefix?C+="(?:"+z(x.prefix)+"("+$+"))?":C+="("+$+")?":C+=z(x.prefix)+"("+$+")"}}if(e)_||(C+="(?:"+z(a)+")?"),C+=p==="$"?"$":"(?="+p+")";else{var r=i[i.length-1],c=typeof r=="string"?r[r.length-1]===a:r===void 0;_||(C+="(?:"+z(a)+"(?="+p+"))?"),c||(C+="(?="+z(a)+"|"+p+")")}return new RegExp(C,f(w))}G(n,"tokensToRegExp");function s(i,l,w){return i instanceof RegExp?u(i,l):Array.isArray(i)?y(i,l,w):S(i,l,w)}G(s,"pathToRegexp")},73637:(ae,J,d)=>{var W={"./af.js":[20179,1081],"./am.js":[61783,5380],"./ar-dz.js":[98136,5215],"./ar-iq.js":[82690,789],"./ar-kw.js":[62009,5151],"./ar-ly.js":[49408,1722],"./ar-ma.js":[87330,909],"./ar-sa.js":[66575,5012],"./ar-tn.js":[5742,8757],"./ar.js":[46567,3030],"./az.js":[14319,8736],"./be.js":[41737,2244],"./bg.js":[86835,6757],"./bi.js":[50045,8111],"./bm.js":[65561,9082],"./bn.js":[57602,4667],"./bo.js":[92594,3134],"./br.js":[34467,3968],"./bs.js":[53169,9248],"./ca.js":[97569,4178],"./cs.js":[30625,5123],"./cv.js":[6326,4060],"./cy.js":[49268,3166],"./da.js":[11559,4103],"./de-at.js":[12369,5954],"./de-ch.js":[71107,7168],"./de.js":[24569,300],"./dv.js":[25427,5528],"./el.js":[90524,1784],"./en-au.js":[29061,4634],"./en-ca.js":[31304,2928],"./en-gb.js":[84252,627],"./en-ie.js":[48757,2730],"./en-il.js":[98038,9],"./en-in.js":[7282,6644],"./en-nz.js":[97960,485],"./en-sg.js":[435,3949],"./en-tt.js":[90954,5818],"./en.js":[22039,427],"./eo.js":[39399,3923],"./es-do.js":[47688,4026],"./es-mx.js":[81773,2972],"./es-pr.js":[66106,5624],"./es-us.js":[18541,187],"./es.js":[23607,172],"./et.js":[29776,9040],"./eu.js":[20166,6960],"./fa.js":[28288,6633],"./fi.js":[88189,5928],"./fo.js":[49697,9627],"./fr-ca.js":[15296,7007],"./fr-ch.js":[53415,7063],"./fr.js":[4938,3674],"./fy.js":[7811,8733],"./ga.js":[3368,6020],"./gd.js":[53560,3017],"./gl.js":[85222,4466],"./gom-latn.js":[38546,6099],"./gu.js":[78309,6993],"./he.js":[41436,9706],"./hi.js":[463,7409],"./hr.js":[27147,3793],"./ht.js":[95139,3104],"./hu.js":[18224,6994],"./hy-am.js":[25976,365],"./id.js":[74970,2698],"./is.js":[799,1087],"./it-ch.js":[6071,8302],"./it.js":[97727,8744],"./ja.js":[78117,9418],"./jv.js":[22281,3496],"./ka.js":[87931,3099],"./kk.js":[52334,1494],"./km.js":[35155,6169],"./kn.js":[72879,9701],"./ko.js":[62905,5929],"./ku.js":[34078,8555],"./ky.js":[24026,2819],"./lb.js":[62619,8124],"./lo.js":[29979,1462],"./lt.js":[75887,6903],"./lv.js":[35493,2437],"./me.js":[50532,4518],"./mi.js":[73059,3883],"./mk.js":[17450,3512],"./ml.js":[66422,8996],"./mn.js":[16428,8753],"./mr.js":[35778,3294],"./ms-my.js":[40583,2593],"./ms.js":[33650,6881],"./mt.js":[6045,4863],"./my.js":[74361,3741],"./nb.js":[10697,3148],"./ne.js":[16608,3868],"./nl-be.js":[11377,7953],"./nl.js":[6987,9724],"./nn.js":[8758,9663],"./oc-lnc.js":[68064,9495],"./pa-in.js":[16767,838],"./pl.js":[28012,8705],"./pt-br.js":[19978,3639],"./pt.js":[51357,7479],"./ro.js":[71948,3905],"./ru.js":[3381,8700],"./rw.js":[79914,3128],"./sd.js":[90126,7087],"./se.js":[46319,8723],"./si.js":[99008,9797],"./sk.js":[84600,6512],"./sl.js":[64955,3951],"./sq.js":[74716,3392],"./sr-cyrl.js":[55854,1532],"./sr.js":[23534,1907],"./ss.js":[19239,7003],"./sv-fi.js":[57972,9047],"./sv.js":[43032,8919],"./sw.js":[60125,4176],"./ta.js":[1565,9872],"./te.js":[92516,5825],"./tet.js":[26712,4984],"./tg.js":[39351,4653],"./th.js":[89225,5389],"./tk.js":[48485,2355],"./tl-ph.js":[17517,2343],"./tlh.js":[35984,3508],"./tr.js":[33092,2661],"./tzl.js":[69109,6199],"./tzm-latn.js":[13637,6782],"./tzm.js":[38063,1785],"./ug-cn.js":[98490,8256],"./uk.js":[65589,6190],"./ur.js":[85859,3199],"./uz-latn.js":[96588,3290],"./uz.js":[45589,9238],"./vi.js":[41191,357],"./x-pseudo.js":[59018,6858],"./yo.js":[14163,8898],"./zh-cn.js":[9073,5352],"./zh-hk.js":[74828,8638],"./zh-tw.js":[78141,4101],"./zh.js":[42882,5235]};function B(R){if(!d.o(W,R))return Promise.resolve().then(()=>{var z=new Error("Cannot find module '"+R+"'");throw z.code="MODULE_NOT_FOUND",z});var I=W[R],U=I[0];return d.e(I[1]).then(()=>d.t(U,23))}G(B,"webpackAsyncContext"),B.keys=()=>Object.keys(W),B.id=73637,ae.exports=B},10952:(ae,J,d)=>{var W={"./chat/index.js":89959,"./emote_card/index.jsx":99733,"./link_card/index.jsx":88082,"./main_menu/index.js":5624,"./metadata.tsx":89817,"./tooltips.ts":45655,"./translation_ui/index.js":19745};function B(I){var U=R(I);return d(U)}G(B,"webpackContext");function R(I){if(!d.o(W,I)){var U=new Error("Cannot find module '"+I+"'");throw U.code="MODULE_NOT_FOUND",U}return W[I]}G(R,"webpackContextResolve"),B.keys=G(function(){return Object.keys(W)},"webpackContextKeys"),B.resolve=R,ae.exports=B,B.id=10952},41152:(ae,J,d)=>{var W={"./bits_button.js":24531,"./bttv_compat.js":11746,"./channel.jsx":74756,"./chat/index.js":6172,"./compat_emote_menu.js":6325,"./css_tweaks/index.js":17103,"./dashboard.js":95778,"./directory/index.jsx":96432,"./layout.js":68318,"./loadable.tsx":34923,"./menu_button.jsx":29333,"./mod-view.jsx":94296,"./player.jsx":63155,"./sub_button.tsx":70052,"./theme/index.js":24020,"./video_chat/index.jsx":4948};function B(I){var U=R(I);return d(U)}G(B,"webpackContext");function R(I){if(!d.o(W,I)){var U=new Error("Cannot find module '"+I+"'");throw U.code="MODULE_NOT_FOUND",U}return W[I]}G(R,"webpackContextResolve"),B.keys=G(function(){return Object.keys(W)},"webpackContextKeys"),B.resolve=R,ae.exports=B,B.id=41152},77074:(ae,J,d)=>{"use strict";ae.exports=d.p+"experiments.json"},24290:ae=>{"use strict";ae.exports=ffzVue},91054:()=>{}},Ct={};function Fe(ae){var J=Ct[ae];if(J!==void 0)return J.exports;var d=Ct[ae]={exports:{}};return Et[ae].call(d.exports,d,d.exports,Fe),d.exports}G(Fe,"__webpack_require__"),Fe.m=Et,Fe.n=ae=>{var J=ae&&ae.__esModule?()=>ae.default:()=>ae;return Fe.d(J,{a:J}),J},(()=>{var ae=Object.getPrototypeOf?d=>Object.getPrototypeOf(d):d=>d.__proto__,J;Fe.t=function(d,W){if(W&1&&(d=this(d)),W&8||typeof d=="object"&&d&&(W&4&&d.__esModule||W&16&&typeof d.then=="function"))return d;var B=Object.create(null);Fe.r(B);var R={};J=J||[null,ae({}),ae([]),ae(ae)];for(var I=W&2&&d;typeof I=="object"&&!~J.indexOf(I);I=ae(I))Object.getOwnPropertyNames(I).forEach(U=>R[U]=()=>d[U]);return R.default=()=>d,Fe.d(B,R),B}})(),Fe.d=(ae,J)=>{for(var d in J)Fe.o(J,d)&&!Fe.o(ae,d)&&Object.defineProperty(ae,d,{enumerable:!0,get:J[d]})},Fe.f={},Fe.e=ae=>Promise.all(Object.keys(Fe.f).reduce((J,d)=>(Fe.f[d](ae,J),J),[])),Fe.u=ae=>""+({9:"i18n-33",172:"i18n-44",187:"i18n-43",204:"menu-md4",208:"rich_tokens",300:"i18n-26",357:"i18n-134",365:"i18n-64",427:"i18n-38",485:"i18n-35",627:"i18n-31",789:"i18n-3",838:"i18n-98",909:"i18n-6",935:"zip",1081:"i18n-0",1087:"i18n-66",1462:"i18n-79",1494:"i18n-72",1532:"i18n-111",1722:"i18n-5",1784:"i18n-28",1785:"i18n-128",1871:"translation-ui",1907:"i18n-112",2009:"markdown",2086:"main-menu",2244:"i18n-11",2343:"i18n-123",2348:"chat",2355:"i18n-122",2437:"i18n-81",2593:"i18n-88",2597:"site-css-tweaks",2661:"i18n-125",2698:"i18n-65",2730:"i18n-32",2819:"i18n-77",2928:"i18n-30",2972:"i18n-41",3017:"i18n-55",3030:"i18n-9",3099:"i18n-71",3104:"i18n-62",3128:"i18n-104",3134:"i18n-16",3148:"i18n-92",3166:"i18n-22",3199:"i18n-131",3224:"queries",3290:"i18n-132",3294:"i18n-87",3392:"i18n-110",3496:"i18n-70",3508:"i18n-124",3512:"i18n-84",3639:"i18n-100",3674:"i18n-52",3741:"i18n-91",3793:"i18n-61",3868:"i18n-93",3883:"i18n-83",3905:"i18n-102",3923:"i18n-39",3949:"i18n-36",3951:"i18n-109",3968:"i18n-17",4026:"i18n-40",4060:"i18n-21",4101:"i18n-139",4103:"i18n-23",4164:"menu-md1",4176:"i18n-116",4178:"i18n-19",4466:"i18n-56",4518:"i18n-82",4634:"i18n-29",4653:"i18n-120",4667:"i18n-15",4863:"i18n-90",4984:"i18n-119",5012:"i18n-7",5123:"i18n-20",5151:"i18n-4",5215:"i18n-2",5235:"i18n-140",5352:"i18n-137",5380:"i18n-1",5389:"i18n-121",5528:"i18n-27",5624:"i18n-42",5818:"i18n-37",5825:"i18n-118",5928:"i18n-48",5929:"i18n-75",5954:"i18n-24",6020:"i18n-54",6099:"i18n-57",6115:"emote-cards",6169:"i18n-73",6190:"i18n-130",6199:"i18n-126",6512:"i18n-108",6530:"regex",6633:"i18n-47",6644:"i18n-34",6757:"i18n-12",6782:"i18n-127",6858:"i18n-135",6881:"i18n-89",6903:"i18n-80",6960:"i18n-46",6993:"i18n-58",6994:"i18n-63",7003:"i18n-113",7007:"i18n-50",7063:"i18n-51",7087:"i18n-105",7168:"i18n-25",7409:"i18n-60",7479:"i18n-101",7485:"vue",7629:"menu-md0",7953:"i18n-94",8111:"i18n-13",8124:"i18n-78",8163:"menu-md5",8256:"i18n-129",8302:"i18n-67",8555:"i18n-76",8586:"overrides",8638:"i18n-138",8700:"i18n-103",8705:"i18n-99",8723:"i18n-106",8733:"i18n-53",8736:"i18n-10",8744:"i18n-68",8753:"i18n-86",8757:"i18n-8",8898:"i18n-136",8919:"i18n-115",8996:"i18n-85",9040:"i18n-45",9047:"i18n-114",9082:"i18n-14",9238:"i18n-133",9248:"i18n-18",9418:"i18n-69",9442:"vue-chat",9495:"i18n-97",9627:"i18n-49",9663:"i18n-96",9701:"i18n-74",9706:"i18n-59",9724:"i18n-95",9797:"i18n-107",9872:"i18n-117"}[ae]||ae)+".js",Fe.h=()=>"965cd6a229543443152b",Fe.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),Fe.o=(ae,J)=>Object.prototype.hasOwnProperty.call(ae,J),(()=>{var ae={},J="frankerfacez:";Fe.l=(d,W,B,R)=>{if(ae[d]){ae[d].push(W);return}var I,U;if(B!==void 0)for(var z=document.getElementsByTagName("script"),v=0;v<z.length;v++){var f=z[v];if(f.getAttribute("src")==d||f.getAttribute("data-webpack")==J+B){I=f;break}}I||(U=!0,I=document.createElement("script"),I.charset="utf-8",I.timeout=120,Fe.nc&&I.setAttribute("nonce",Fe.nc),I.setAttribute("data-webpack",J+B),I.src=d,I.src.indexOf(window.location.origin+"/")!==0&&(I.crossOrigin="anonymous")),ae[d]=[W];var u=G((S,n)=>{I.onerror=I.onload=null,clearTimeout(y);var s=ae[d];if(delete ae[d],I.parentNode&&I.parentNode.removeChild(I),s&&s.forEach(i=>i(n)),S)return S(n)},"onScriptComplete"),y=setTimeout(u.bind(null,void 0,{type:"timeout",target:I}),12e4);I.onerror=u.bind(null,I.onerror),I.onload=u.bind(null,I.onload),U&&document.head.appendChild(I)}})(),Fe.r=ae=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(ae,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(ae,"__esModule",{value:!0})},Fe.j=8363,(()=>{var ae;Fe.g.importScripts&&(ae=Fe.g.location+"");var J=Fe.g.document;if(!ae&&J&&(J.currentScript&&(ae=J.currentScript.src),!ae)){var d=J.getElementsByTagName("script");if(d.length)for(var W=d.length-1;W>-1&&!ae;)ae=d[W--].src}if(!ae)throw new Error("Automatic publicPath is not supported in this browser");ae=ae.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),Fe.p=ae})(),(()=>{var ae={8363:0,2682:0};Fe.f.j=(W,B)=>{var R=Fe.o(ae,W)?ae[W]:void 0;if(R!==0)if(R)B.push(R[2]);else{var I=new Promise((f,u)=>R=ae[W]=[f,u]);B.push(R[2]=I);var U=Fe.p+Fe.u(W),z=new Error,v=G(f=>{if(Fe.o(ae,W)&&(R=ae[W],R!==0&&(ae[W]=void 0),R)){var u=f&&(f.type==="load"?"missing":f.type),y=f&&f.target&&f.target.src;z.message="Loading chunk "+W+` failed.
(`+u+": "+y+")",z.name="ChunkLoadError",z.type=u,z.request=y,R[1](z)}},"loadingEnded");Fe.l(U,v,"chunk-"+W,W)}};var J=G((W,B)=>{var[R,I,U]=B,z,v,f=0;if(R.some(y=>ae[y]!==0)){for(z in I)Fe.o(I,z)&&(Fe.m[z]=I[z]);if(U)var u=U(Fe)}for(W&&W(B);f<R.length;f++)v=R[f],Fe.o(ae,v)&&ae[v]&&ae[v][0](),ae[v]=0},"webpackJsonpCallback"),d=globalThis.ffzWebpackJsonp=globalThis.ffzWebpackJsonp||[];d.forEach(J.bind(null,0)),d.push=J.bind(null,d.push.bind(d))})();var Ut={};(()=>{var ve,H;"use strict";var ae={};Fe.r(ae),Fe.d(ae,{LogLevel:()=>R,Logger:()=>z,default:()=>v});var J={};Fe.r(J),Fe.d(J,{Addon:()=>pe});var d=Fe(51722),W=Fe.n(d);const B={1:"debug",2:"info",4:"warn",8:"error"};var R=(V=>(V[V.Verbose=0]="Verbose",V[V.Debug=1]="Debug",V[V.Info=2]="Info",V[V.Warning=4]="Warning",V[V.Error=8]="Error",V[V.Off=99]="Off",V))(R||{});function I(){const V=localStorage.ffzLogLevel;if(!V)return null;const E=V.toUpperCase(),F=z[E];return typeof F=="number"?F:/^\d+$/.test(V)?parseInt(V,10):null}G(I,"readLSLevel");const U=(ve=class{constructor(E,F,A,N){this.root=E?E.root:this,this.parent=E,this.name=F,this.root==this&&(this.init=!1,this.captured_init=[],this.label="FFZ"),this.enabled=!0,this.level=A??(E&&E.level)??I()??ve.DEFAULT_LEVEL,this.raven=N||E&&E.raven,this.children={}}hi(E,F){const A=F??E.constructor?.version_info;this.info(`FrankerFaceZ v${A} (s:${E.host} f:${E.flavor} b:${A?.build} c:${A?.commit||"null"})`);try{const N=new URL(location.toString());N.search="",this.info(`Initial URL: ${N}`)}catch(N){this.warn("Unable to read location.",N)}}get(E,F){return this.children[E]||(this.children[E]=new ve(this,this.name?`${this.name}.${E}`:E,F)),this.children[E]}verbose(E,...F){return this.invoke(0,E,F)}verboseColor(E,F,...A){return this.invokeColor(ve.VERBOSE,E,F,A)}debug(E,...F){return this.invoke(ve.DEBUG,E,F)}debugColor(E,F,...A){return this.invokeColor(ve.DEBUG,E,F,A)}info(E,...F){return this.invoke(ve.INFO,E,F)}infoColor(E,F,...A){return this.invokeColor(ve.INFO,E,F,A)}warn(E,...F){return this.invoke(ve.WARN,E,F)}warnColor(E,F,...A){return this.invokeColor(ve.WARN,E,F,A)}warning(E,...F){return this.invoke(ve.WARN,E,F)}warningColor(E,F,...A){return this.invokeColor(ve.WARN,E,F,A)}error(E,...F){return this.invoke(ve.ERROR,E,F)}errorColor(E,F,...A){return this.invokeColor(ve.ERROR,E,F,A)}crumb(...E){if(this.raven)return this.raven.captureBreadcrumb(...E)}capture(E,F,...A){if(this.raven&&(F=F||{},F.logger||(F.logger=this.name),this.raven.captureException(E,F)),A.length){const N=A.shift();return this.error(N,...A)}}invokeColor(E,F,A,...N){if(!this.enabled||E<this.level)return;if(Array.isArray(A)||(A=[A]),E>0){let se=F;typeof se=="string"&&(se=se.replace(/%c/g,"")),N.length&&(se=`${se} ${N.join(" ")}`),this.root.init&&this.root.captured_init&&this.root.captured_init.push({time:Date.now(),category:this.name,message:se,level:B[E]||E}),this.crumb({message:se,category:this.name,level:B[E]||E})}const Y=E<2?"color:#999999":"";this.name?(typeof F=="string"?F=`%c${this.root.label} [%c${this.name}%c]:%c ${F}`:(N.unshift(F),F=`%c${this.root.label} [%c${this.name}%c]:%c`),A.unshift("color:#755000; font-weight:bold",Y,"color:#755000; font-weight:bold",Y)):(typeof F=="string"?F=`%c${this.root.label}:%c ${F}`:(N.unshift(F),F=`%c${this.root.label}:%c`),A.unshift("color:#755000; font-weight:bold",Y)),E<2?console.debug(F,...A,...N):E<4?console.info(F,...A,...N):E<8?console.warn(F,...A,...N):E<99&&console.error(F,...A,...N)}invoke(E,F,A){if(!this.enabled||E<this.level||E>=99)return;const N=A?[F,...A]:[F];if(E>0){const ue=N.join(" ");this.root.init&&this.root.captured_init&&this.root.captured_init.push({time:Date.now(),category:this.name,message:ue,level:B[E]||E}),this.crumb({message:ue,category:this.name,level:B[E]||E})}const Y=E<2?"color:#999999":"";let se="";if(Y!=="")for(;N.length>0&&typeof N[0]=="string";)se+=" "+N.shift();this.name?N.unshift(`%c${this.root.label} [%c${this.name}%c]:%c${se}`,"color:#755000; font-weight:bold",Y,"color:#755000; font-weight:bold",Y):N.unshift(`%c${this.root.label}:%c${se}`,"color:#755000; font-weight:bold",Y),E<2?console.debug(...N):E<4?console.info(...N):E<8?console.warn(...N):E<99&&console.error(...N)}},G(ve,"_Logger2"),ve);U.Levels=R,U.VERBOSE=0,U.DEBUG=1,U.INFO=2,U.WARN=4,U.WARNING=4,U.ERROR=8,U.OFF=99,U.DEFAULT_LEVEL=2;let z=U;const v=z;var f=Fe(22527),u=Fe(46949),y=Fe(24431),S=Fe(68069),n=Fe(44589),s=Fe(83269);const ke=class ke extends f.default{constructor(E,F){super(E,F),this.i18n=null,this.load_tracker=null,this.settings=null,this.should_enable=!0,this.inject("settings"),this.inject("i18n"),this.inject("load_tracker"),this.load_requires=["settings"],this.target=this.parent.flavor||"unknown",this.has_dev=!1,this.reload_required=!1,this.addons={},this.enabled_addons=[],this.versions={},this.load_tracker.schedule("chat-data","addon-initial")}onLoad(){this._loader=this.loadAddonData()}onEnable(){this.settings.addUI("add-ons",{path:'Add-Ons @{"description": "Add-Ons are additional modules, often written by other people, that can be loaded automatically by FrankerFaceZ to add new capabilities and behaviors to the extension and Twitch.", "profile_warning": false}',component:"addon-list",title:"Add-Ons",no_filter:!0,getExtraTerms:()=>Object.values(this.addons).map(E=>E.search_terms),getFFZ:()=>this,isReady:()=>this.enabled,getAddons:()=>Object.values(this.addons),getVersions:()=>(0,u.deep_copy)(this.versions),hasAddon:E=>this.hasAddon(E),getVersion:E=>this.getVersion(E),doesAddonTarget:E=>this.doesAddonTarget(E),isAddonEnabled:E=>this.isAddonEnabled(E),isAddonExternal:E=>this.isAddonExternal(E),enableAddon:E=>this.enableAddon(E),disableAddon:E=>this.disableAddon(E),reloadAddon:E=>this.reloadAddon(E),canReloadAddon:E=>this.canReloadAddon(E),isReloadRequired:()=>this.reload_required,refresh:()=>window.location.reload(),on:(...E)=>this.on(...E),off:(...E)=>this.off(...E)}),y.EXTENSION||this.settings.add("addons.dev.server",{default:!1,ui:{path:"Add-Ons >> Development",title:"Use Local Development Server",description:"Attempt to load add-ons from local development server on port 8001.",component:"setting-check-box"}}),this.on("i18n:update",this.rebuildAddonSearch,this),this.settings.provider.on("changed",this.onProviderChange,this),this._loader?.then(()=>{this.enabled_addons=this.settings.provider.get("addons.enabled",[]);for(const E of this.enabled_addons)this.hasAddon(E)&&this.doesAddonTarget(E)&&this._enableAddon(E).catch(F=>{this.log.error(`An error occured while enabling the add-on "${E}":`,F),this.log.capture(F)});this.load_tracker.notify("chat-data","addon-initial"),this.emit(":ready")})}doesAddonTarget(E){const F=this.getAddon(E);if(!F)return!1;const A=F.targets??["main"];return Array.isArray(A)?A.includes(this.target):!1}generateLog(){const E=["Known"];for(const[F,A]of Object.entries(this.addons)){if(Array.isArray(A))continue;const N=this.versions[F];E.push(`${F} | ${this.isAddonEnabled(F)?"enabled":"disabled"} | ${N?`${N} | `:""}${A.dev?"dev | ":""}${this.isAddonExternal(F)?"external | ":""}${A.short_name} v${A.version}`)}E.push(""),E.push("Modules");for(const[F,A]of Object.entries(this.__modules))A&&E.push(`${A.loaded?"loaded  ":A.loading?"loading ":"unloaded"} | ${A.enabled?"enabled ":A.enabling?"enabling":"disabled"} | ${F}`);return E.join(`
`)}onProviderChange(E,F){if(E!="addons.enabled")return;const A=Array.isArray(F)?F:[],N=[...this.enabled_addons];for(const Y of N)A.includes(Y)||this.disableAddon(Y,!1);for(const Y of A)N.includes(Y)||this.enableAddon(Y,!1)}async loadAddonData(){const[E,F]=await Promise.all([(0,u.fetchJSON)(`${y.SERVER_OR_EXT}/addons.json?_=${(0,s.getBuster)(30)}`),!y.EXTENSION&&this.settings.get("addons.dev.server")?(0,u.fetchJSON)(`https://localhost:8001/script/addons.json?_=${(0,s.getBuster)()}`):null]);if(Array.isArray(E)){const A=`${y.SERVER_OR_EXT}/addons/`;for(const N of E)N.icon&&(N.icon=new URL(N.icon,A).toString()),this.addAddon(N,!1)}if(Array.isArray(F)){this.has_dev=!0;for(const A of F)this.addAddon(A,!0)}this.settings.updateContext({addonDev:this.has_dev}),this.rebuildAddonSearch(),this.emit(":data-loaded")}setVersion(E,F){this.versions[E]=F}addAddon(E,F=!1){let A=E;const N=this.addons[A.id];this.addons[A.id]=A,A.name=A.name??A.id,A.dev=F,A.requires=A.requires||[],A.required_by=Array.isArray(N)?N:N&&N.required_by||[],A.updated&&(A.updated=new Date(A.updated)),A.created&&(A.created=new Date(A.created)),A._search=A.search_terms;for(const Y of A.requires){const se=this.addons[Y];Array.isArray(se)?se.push(A.id):se?se.required_by.push(A.id):this.addons[Y]=[A.id]}(!N||Array.isArray(N))&&this.settings.addUI(`addon-changelog.${A.id}`,{path:`Add-Ons > Changelog > ${A.name}`,component:"changelog",force_seen:!0,addons:!0,addon:(0,u.deep_copy)(A),getFFZ:()=>this,getVersion:()=>this.versions[A.id]}),this.emit(":added",A.id,A)}rebuildAddonSearch(){for(const E of Object.values(this.addons)){if(Array.isArray(E))continue;const F=new Set([E._search,E.name,E.short_name,E.author,E.description]);this.i18n.locale!=="en"&&(E.name_i18n&&F.add(this.i18n.t(E.name_i18n,E.name)),E.short_name_i18n&&F.add(this.i18n.t(E.short_name_i18n,E.short_name)),E.author_i18n&&F.add(this.i18n.t(E.author_i18n,E.author)),E.maintainer_i18n&&F.add(this.i18n.t(E.maintainer_i18n,E.maintainer)),E.description_i18n&&F.add(this.i18n.t(E.description_i18n,E.description))),E.search_terms=[...F].map(A=>A?A.toLocaleLowerCase():"").join(`
`)}}isAddonEnabled(E){return this.isAddonExternal(E)?!0:this.enabled_addons.includes(E)}getAddon(E){const F=this.addons[E]??null;return Array.isArray(F)?null:F}hasAddon(E){return this.getAddon(E)!=null}getVersion(E){const F=this.getAddon(E);if(!F)throw new Error(`Unknown add-on id: ${E}`);const A=this.resolve(`addon.${E}`);if(A){if("version"in A)return A.version;if(A.constructor&&"version"in A.constructor)return A.constructor.version}return F.version}isAddonExternal(E){if(!this.hasAddon(E))throw new Error(`Unknown add-on id: ${E}`);const F=this.resolve(`addon.${E}`);return F?document.head.querySelector(`script#ffz-loaded-addon-${E}`)?F.external||F.constructor?.external:!0:!1}canReloadAddon(E){if(!this.hasAddon(E))throw new Error(`Unknown add-on id: ${E}`);let F=this.resolve(`addon.${E}`);if(!F||!F.canDisable()||!F.canUnload())return!1;if(F.children){for(const A of Object.values(F.children))if(!A.canDisable()||!A.canUnload())return!1}return!0}async fullyUnloadModule(E){if(!(!E||!E.addon_id)){if(E.children)for(const F of Object.values(E.children))await this.fullyUnloadModule(F);await E.disable(),await E.unload(),E.parent instanceof f.default&&E.parent.children[E.name]===E&&delete E.parent.children[E.name];for(const F of E.references){const A=this.resolve(F[0]),N=F[1];A[N]===E&&(A[N]=null)}this.emit(":fully-unload",E.addon_id),this.__modules[E.__path]===E&&delete this.__modules[E.__path],this.off(void 0,void 0,E);for(const F of this.settings.__contexts)F.off(void 0,void 0,E);for(const[F,A]of Array.from(this.settings.definitions.entries()))!Array.isArray(A)&&A?.__source===E.addon_id&&this.settings.remove(F);E.__log=null}}async reloadAddon(E){const F=this.getAddon(E),A=this.resolve("site.menu_button");if(!F)throw new Error(`Unknown add-on id: ${E}`);const N=performance.now();let Y=this.resolve(`addon.${E}`);if(Y)try{await this.fullyUnloadModule(Y)}catch(_e){throw A&&A.addToast({title_i18n:"addons.reload.toast-error",title:"Error Reloading Add-On",text_i18n:"addons.reload.toast-error.unload",text:`Unable to unload existing modules for add-on "{addon_id}":

{error}`,icon:"ffz-i-attention",addon_id:E,error:String(_e)}),_e}let se=document.querySelector(`script#ffz-loaded-addon-${F.id}`);se&&se.remove(),window.ffzAddonsWebpackJsonp&&(window.ffzAddonsWebpackJsonp=void 0);try{await this._enableAddon(E)}catch(_e){throw A&&A.addToast({title_i18n:"addons.reload.toast-error",title:"Error Reloading Add-On",text_i18n:"addons.reload.toast-error.reload",text:`Unable to load new module for add-on "{addon_id}":

{error}`,error:String(_e),icon:"ffz-i-attention",addon_id:E}),_e}const ue=performance.now();A&&A.addToast({title_i18n:"addons.reload.toast",title:"Reloaded Add-On",text_i18n:"addons.reload.toast.text",text:'Successfully reloaded add-on "{addon_id}" in {duration}ms.',icon:"ffz-i-info",addon_id:E,timeout:5e3,duration:Math.round(100*(ue-N))/100})}async _enableAddon(E){const F=this.getAddon(E);if(!F)throw new Error(`Unknown add-on id: ${E}`);if(Array.isArray(F.load_events))for(const N of F.load_events)this.load_tracker.schedule(N,`addon.${E}`);await this.loadAddon(E);const A=this.resolve(`addon.${E}`);if(A&&!A.enabled&&await A.enable(),Array.isArray(F.load_events))for(const N of F.load_events)this.load_tracker.notify(N,`addon.${E}`,!1)}async loadAddon(E){const F=this.getAddon(E);if(!F)throw new Error(`Unknown add-on id: ${E}`);await this.i18n.loadChunk(`addon.${E}`);let A=this.resolve(`addon.${E}`);if(A){A.loaded||await A.load(),this.emit(":addon-loaded",E);return}document.head.appendChild((0,n.createElement)("script",{id:`ffz-loaded-addon-${F.id}`,type:"text/javascript",src:F.src||`${F.dev?"https://localhost:8001/script":y.SERVER_OR_EXT}/addons/${F.id}/script.js?_=${(0,s.getBuster)(30)}`,crossorigin:"anonymous"})),await(0,u.timeout)(this.waitFor(`addon.${E}:registered`),6e4),A=this.resolve(`addon.${E}`),A&&!A.loaded&&await A.load(),this.emit(":addon-loaded",E)}unloadAddon(E){const F=this.resolve(`addon.${E}`);if(F)return F.unload()}enableAddon(E,F=!0){const A=this.getAddon(E);if(!A)throw new Error(`Unknown add-on id: ${E}`);if(!this.isAddonEnabled(E)){if(Array.isArray(A.requires))for(const N of A.requires){if(!this.hasAddon(N))throw new Error(`Unknown add-on id: ${N}`);this.enableAddon(N)}this.emit(":addon-enabled",E),this.enabled_addons.push(E),F&&this.settings.provider.set("addons.enabled",this.enabled_addons),this.doesAddonTarget(E)&&this._enableAddon(E).catch(N=>{this.log.error(`An error occured while enabling the add-on "${E}":`,N),this.log.capture(N)})}}async disableAddon(E,F=!0){const A=this.getAddon(E);if(!A)throw new Error(`Unknown add-on id: ${E}`);if(this.isAddonExternal(E))throw new Error(`Cannot disable external add-on with id: ${E}`);if(this.isAddonEnabled(E)){if(Array.isArray(A.required_by)){const N=[];for(const Y of A.required_by)N.push(this.disableAddon(Y));await Promise.all(N)}this.emit(":addon-disabled",E),this.enabled_addons.splice(this.enabled_addons.indexOf(E),1),F&&this.settings.provider.set("addons.enabled",this.enabled_addons);try{const N=this.resolve(`addon.${E}`);N&&await N.disable()}catch{this.reload_required=!0,this.emit(":reload-required")}}}};G(ke,"AddonManager");let i=ke;/*! js-cookie v3.0.5 | MIT */function l(V){for(var E=1;E<arguments.length;E++){var F=arguments[E];for(var A in F)V[A]=F[A]}return V}G(l,"js_cookie_assign");var w={read:function(V){return V[0]==='"'&&(V=V.slice(1,-1)),V.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(V){return encodeURIComponent(V).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function _(V,E){function F(N,Y,se){if(!(typeof document>"u")){se=l({},E,se),typeof se.expires=="number"&&(se.expires=new Date(Date.now()+se.expires*864e5)),se.expires&&(se.expires=se.expires.toUTCString()),N=encodeURIComponent(N).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var ue="";for(var _e in se)se[_e]&&(ue+="; "+_e,se[_e]!==!0&&(ue+="="+se[_e].split(";")[0]));return document.cookie=N+"="+V.write(Y,N)+ue}}G(F,"set");function A(N){if(!(typeof document>"u"||arguments.length&&!N)){for(var Y=document.cookie?document.cookie.split("; "):[],se={},ue=0;ue<Y.length;ue++){var _e=Y[ue].split("="),Q=_e.slice(1).join("=");try{var le=decodeURIComponent(_e[0]);if(se[le]=V.read(Q,le),N===le)break}catch{}}return N?se[N]:se}}return G(A,"get"),Object.create({set:F,get:A,remove:function(N,Y){F(N,"",l({},Y,{expires:-1}))},withAttributes:function(N){return _(this.converter,l({},this.attributes,N))},withConverter:function(N){return _(l({},this.converter,N),this.attributes)}},{attributes:{value:Object.freeze(E)},converter:{value:Object.freeze(V)}})}G(_,"init");var o=_(w,{path:"/"}),e=Fe(99968),a=Fe.n(e);const p="experiment_overrides",C={expires:7,domain:".twitch.tv"},m=Fe(77074);var x=(V=>(V[V.Unknown=0]="Unknown",V[V.Device=1]="Device",V[V.User=2]="User",V[V.Channel=3]="Channel",V))(x||{});function $(V){return"t"in V}G($,"isTwitchExperiment");function r(V){return"description"in V}G(r,"isFFZExperiment");function c(V,E){return V.rarity<E.rarity?-1:V.rarity>E.rarity?1:V.name<E.name?-1:V.name>E.name?1:0}G(c,"sortExperimentLog");const De=class De extends f.default{constructor(E,F){super(E,F),this.settings=null,this.get=this.getAssignment,this.inject("settings"),this.settings.addUI("experiments",{path:"Debugging > Experiments",component:"experiments",no_filter:!0,getExtraTerms:()=>{const A=[];for(const[N,Y]of Object.entries(this.experiments))A.push(N),Y.name&&A.push(Y.name),Y.description&&A.push(Y.description);for(const[N,Y]of Object.entries(this.getTwitchExperiments()))A.push(N),Y.name&&A.push(Y.name);return A},is_locked:()=>this.getControlsLocked(),unlock:()=>this.unlockControls(),unique_id:()=>this.unique_id,ffz_data:()=>(0,u.deep_copy)(this.experiments),twitch_data:()=>(0,u.deep_copy)(this.getTwitchExperiments()),usingTwitchExperiment:A=>this.usingTwitchExperiment(A),getTwitchAssignment:A=>this.getTwitchAssignment(A),getTwitchType:A=>this.getTwitchType(A),hasTwitchOverride:A=>this.hasTwitchOverride(A),setTwitchOverride:(A,N)=>this.setTwitchOverride(A,N),deleteTwitchOverride:A=>this.deleteTwitchOverride(A),getAssignment:A=>this.getAssignment(A),hasOverride:A=>this.hasOverride(A),setOverride:(A,N)=>this.setOverride(A,N),deleteOverride:A=>this.deleteOverride(A),on:(...A)=>this.on(...A),off:(...A)=>this.off(...A)}),this.unique_id=o.get("unique_id"),this.Cookie=o,this.experiments={},this.cache=new Map}getControlsLocked(){if(y.DEBUG)return!1;const E=this.settings.provider.get("exp-lock",0);return isNaN(E)||!isFinite(E)?!0:Date.now()-E>=864e5}unlockControls(){this.settings.provider.set("exp-lock",Date.now())}async onLoad(){await this.loadExperiments()}async loadExperiments(){let E;try{E=await(0,u.fetchJSON)(y.DEBUG?m:`${y.SERVER}/script/experiments.json?_=${(0,s.getBuster)()}`)}catch(N){this.log.warn("Unable to load experiment data.",N);return}if(!E)return;this.experiments=E;const F=this.cache;this.cache=new Map;let A=0;for(const[N,Y]of F.entries()){const se=this.getAssignment(N);Y!==se&&(A++,this.emit(":changed",N,se,Y),this.emit(`:changed:${N}`,se,Y))}this.log.info(`Loaded information on ${Object.keys(E).length} experiments.${A>0?` ${A} values updated.`:""}`)}onEnable(){this.on("pubsub:command:reload_experiments",this.loadExperiments,this),this.on("pubsub:command:update_experiment",E=>{this.updateExperiment(E.key,E.data)},this)}updateExperiment(E,F){if(this.log.info(`Received updated data for experiment "${E}" via PubSub.`,F),Array.isArray(F)){const A=this.experiments[E];if(!A)return;A.groups=F}else F?.groups&&(this.experiments[E]=F);this._rebuildKey(E)}generateLog(){const E=[`Unique ID: ${this.unique_id}`,""],F=[];for(const[Y,se]of Object.entries(this.experiments)){const ue=this.getAssignment(Y),_e=this.hasOverride(Y);let Q=0,le=0;for(const he of se.groups)he.value===ue&&(Q=he.weight),le+=he.weight;!_e&&Q===le||F.push({key:Y,name:se.name,value:ue,override:_e,rarity:Q/le})}F.sort(c);for(const Y of F)E.push(`FFZ | ${Y.name}: ${Y.value}${Y.override?" (Override)":""} (r:${Y.rarity})`);const A=[],N=this.settings.get("context.channel");for(const[Y,se]of Object.entries(this.getTwitchExperiments())){if(!this.usingTwitchExperiment(Y))continue;const ue=this.getTwitchAssignment(Y),_e=this.hasTwitchOverride(Y);let Q=0,le=0;for(const he of se.groups)he.value===ue&&(Q=he.weight),le+=he.weight;!_e&&Q===le||A.push({key:Y,name:se.name,value:ue,override:_e,type:this.getTwitchTypeByKey(Y),rarity:Q/le})}A.sort(c);for(const Y of A)E.push(`Twitch | ${Y.name}: ${Y.value}${Y.override?" (Override)":""} (r:${Y.rarity}, t:${Y.type}${Y.type==="channel_id"?`, c:${N}`:""})`);return E.join(`
`)}getTwitchType(E){const F=this.resolve("site")?.getCore?.();return F?.experiments?.getExperimentType?F.experiments.getExperimentType(E):E===1?"device_id":E===2?"user_id":E===3?"channel_id":E}getTwitchTypeByKey(E){const F=this.getTwitchExperiments(),A=F?.[E];return A?.t?this.getTwitchType(A.t):null}getTwitchExperiments(){if(window.__twilightSettings)return window.__twilightSettings.experiments??{};const E=this.resolve("site")?.getCore?.();return E&&E.experiments.experiments||{}}usingTwitchExperiment(E){const F=this.resolve("site")?.getCore?.();return F&&(0,u.has)(F.experiments.assignments,E)}_getOverrideCookie(){const E=o.get(p);let F;try{F=E?JSON.parse(E):{}}catch{F={}}return F.experiments||(F.experiments={}),F.disabled||(F.disabled=[]),F}_saveOverrideCookie(E){E&&(!E.experiments||!Object.keys(E.experiments).length)&&(!E.disabled||!E.disabled.length)&&(E=void 0),E?o.set(p,JSON.stringify(E),C):o.remove(p,C)}_checkExternalAccess(){let E;try{E=new Error().stack}catch(A){try{E=A.stack}catch{}}if(!E)return;E=E.split(/\s*\n+\s*/g).filter(A=>A.startsWith("at "));let F=!1;for(const A of E)if(!A.includes(y.SERVER_OR_EXT)){F=!0;break}F&&this.log.warn("Detected access by external script.")}setTwitchOverride(E,F){const A=this._getOverrideCookie(),N=A.experiments,Y=A.disabled;this._checkExternalAccess(),N[E]=F;const se=Y.indexOf(E);se!=-1&&Y.splice(se,1),this._saveOverrideCookie(A);const ue=this.resolve("site")?.getCore?.();ue&&(ue.experiments.overrides[E]=F),this._rebuildTwitchKey(E,!0,F)}deleteTwitchOverride(E){const F=this._getOverrideCookie(),A=F.experiments;if(this._checkExternalAccess(),!(0,u.has)(A,E))return;const N=A[E];delete A[E],this._saveOverrideCookie(F);const Y=this.resolve("site")?.getCore?.();Y&&delete Y.experiments.overrides[E],this._rebuildTwitchKey(E,!1,N)}hasTwitchOverride(E){const F=this._getOverrideCookie(),A=F.experiments;return(0,u.has)(A,E)}getTwitchAssignment(E,F=null){const A=this.resolve("site")?.getCore?.(),N=A&&A.experiments;if(!N)return null;if(!N.hasInitialized&&N.initialize)try{N.initialize()}catch(ue){this.log.warn("Error attempting to initialize Twitch experiments tracker.",ue)}if(N.overrides&&N.overrides[E])return N.overrides[E];const Y=N.experiments[E],se=this.getTwitchType(Y?.t??0);return se==="channel_id"?N.getAssignmentById(E,{bucketing:{type:1,value:F??this.settings.get("context.channelID")}}):N.assignments?.[E]?N.assignments[E]:se==="device_id"?N.selectTreatment(E,Y,this.unique_id):se==="user_id"?N.selectTreatment(E,Y,this.resolve("site")?.getUser?.()?.id):null}getTwitchKeyFromName(E){const F=this.getTwitchExperiments();if(F){E=E.toLowerCase();for(const A in F)if((0,u.has)(F,A)){const N=F[A];if(N&&N.name&&N.name.toLowerCase()===E)return A}}}getTwitchAssignmentByName(E,F=null){const A=this.getTwitchKeyFromName(E);return A?this.getTwitchAssignment(A,F):null}_rebuildTwitchKey(E,F,A){const N=this.resolve("site")?.getCore?.(),Y=N.experiments,se=(0,u.has)(Y.assignments,E)?Y.assignments[E]:null;if(se!==A){const ue=F?A:se;this.emit(":twitch-changed",E,ue,se),this.emit(`:twitch-changed:${E}`,ue,se)}}setOverride(E,F){const A=this.settings.provider.get("experiment-overrides",{});A[E]=F,this.settings.provider.set("experiment-overrides",A),this._rebuildKey(E)}deleteOverride(E){const F=this.settings.provider.get("experiment-overrides");!F||!(0,u.has)(F,E)||(delete F[E],Object.keys(F).length?this.settings.provider.set("experiment-overrides",F):this.settings.provider.delete("experiment-overrides"),this._rebuildKey(E))}hasOverride(E){const F=this.settings.provider.get("experiment-overrides");return F?(0,u.has)(F,E):!1}getAssignment(E){if(this.cache.has(E))return this.cache.get(E);const F=this.experiments[E];if(!F)return this.log.warn(`Tried to get assignment for experiment "${E}" which is not known.`),null;const A=this.settings.provider.get("experiment-overrides"),N=A&&(0,u.has)(A,E)?A[E]:De.selectGroup(E,F,this.unique_id??"");return this.cache.set(E,N),N}_rebuildKey(E){if(!this.cache.has(E))return;const F=this.cache.get(E);this.cache.delete(E);const A=this.getAssignment(E);A!==F&&(this.emit(":changed",E,A,F),this.emit(`:changed:${E}`,A,F))}static selectGroup(E,F,A){const N=E+A+(F.seed||""),Y=F.groups.reduce((ue,_e)=>ue+_e.weight,0);let se=(a()(N).words[0]>>>0)/Math.pow(2,32);for(const ue of F.groups)if(se-=ue.weight/Y,se<=0)return ue.value;return null}};G(De,"ExperimentManager");let b=De;var k=Fe(67392);const h={DISCONNECTED:0,CONNECTING:1,CONNECTED:2},M="683b45e4-f853-4c45-bf96-7d799cc93e34",Ie=class Ie extends f.default{constructor(...E){super(...E),this.inject("settings"),this.inject("experiments"),this.settings.addUI("socket.info",{path:'Debugging > Socket >> Info @{"sort": -1000}',force_seen:!0,no_filter:!0,component:"socket-info",getSocket:()=>this}),this.settings.add("auth.mode",{default:"chat",ui:{path:"Data Management > Authentication >> General",title:"Authentication Provider",description:"Which method should the FrankerFaceZ client use to authenticate against the FFZ servers when necessary?",component:"setting-select-box",force_seen:!0,data:[{value:"chat",title:"Twitch Chat"},{value:!1,title:"Disabled (No Authentication)"}]},changed:()=>this._cached_token=null}),this.settings.add("socket.use-cluster",{default:"Production",ui:{path:'Debugging @{"expanded": false, "sort": 9999} > Socket >> General',title:"Server Cluster",description:"Which server cluster to connect to. Do not change this unless you are actually doing development work on the socket server backend. Doing so will break all features relying on the socket server, including emote information lookups, link tooltips, and live data updates.",component:"setting-select-box",data:[{value:null,title:"Disabled"}].concat(Object.keys(y.WS_CLUSTERS).map(F=>({value:F,title:F})))}}),this._want_connected=!1,this._topics=new Map,this._pending=[],this._awaiting=new Map,this._socket=null,this._state=0,this._last_id=1,this._delay=0,this._last_ping=null,this._time_drift=0,this._host_idx=-1,this._host_pool=-1,this.settings.on(":changed:socket.use-cluster",()=>{this._host=null,this.disconnected?this.connect():this.reconnect()}),this.on(":command:reconnect",this.reconnect,this),this.on(":command:do_authorize",F=>{const A=this.resolve("site.chat"),N=A&&A.ChatService.first,Y=N.client&&N.client.connection;Y&&Y.send&&Y.send(`PRIVMSG #frankerfacezauthorizer :AUTH ${F}`)}),this.enable()}onEnable(){}onDisable(){this.disconnect()}get connected(){return this._state===h.CONNECTED}get connecting(){return this._state===h.CONNECTING}get disconnected(){return this._state===h.DISCONNECTED}getAPIToken(){return this.settings.get("auth.mode")==="chat"?this._getAPIToken_Chat():Promise.reject(new Error("The user has disabled authentication."))}_getAPIToken_Chat(){return this._cached_token&&this._cached_token.expires>Date.now()+15e3?Promise.resolve(this._cached_token):this._token_waiters?new Promise((E,F)=>this._token_waiters.push([E,F])):(this._token_waiters=[],new Promise((E,F)=>{this._token_waiters.push([E,F]);let A=!1,N=null;const Y=G(_e=>{if(A)return;clearTimeout(N),A=!0,this.log.error("Unable to get API token.",_e);const Q=this._token_waiters;this._token_waiters=null;for(const le of Q)le[1](_e)},"fail"),se=this.resolve("site")?.getUser?.();if(!se||!se.id)return Y(new Error("Unable to get current user or not logged in."));const ue=new EventSource(`https://api.frankerfacez.com/auth/ext_verify/${se.id}`);(0,n.on)(ue,"challenge",_e=>{const Q=this.resolve("site.chat")?.ChatService?.first?.client?.connection;Q&&Q.send&&Q.send(`PRIVMSG #frankerfacezauthorizer :AUTH ${_e.data}`)}),(0,n.on)(ue,"token",_e=>{if(A)return;clearTimeout(N);let Q=null;try{Q=JSON.parse(_e.data)}catch(he){Y(he);return}if(!Q||!Q.token){Y(new Error("Received empty token from server."));return}Q.expires=new Date(Q.expires).getTime(),this._cached_token=Q,A=!0;const le=this._token_waiters;this._token_waiters=null;for(const he of le)he[0](Q)}),(0,n.on)(ue,"error",_e=>{Y(_e)}),(0,n.on)(ue,"close",()=>{ue.close(),A||Y(new Error("Connection closed unexpectedly."))}),N=setTimeout(()=>{Y(new Error("timeout"))},5e3)}))}async getBareAPIToken(){return(await this.getAPIToken())?.token}selectHost(){const E=this.settings.get("socket.use-cluster"),F=y.WS_CLUSTERS[E],A=F&&F.length;if(!A)return null;let N=0,Y=A;for(;Y-- >0;)N+=F[Y][1];let se=Math.random()*N;for(let ue=0;ue<A;ue++)if(se-=F[ue][1],se<=0)return F[ue][0];return F[A-1][0]}_reconnect(){this._reconnect_timer||(this._delay<6e4?this._delay+=(Math.floor(Math.random()*15)+5)*1e3:this._delay=(Math.floor(Math.random()*60)+30)*1e3,this._reconnect_timer=setTimeout(()=>{this.connect()},this._delay))}reconnect(){this.disconnect(),this._reconnect()}connect(){if(this._want_connected=!0,this._reconnect_timer&&(clearTimeout(this._reconnect_timer),this._reconnect_timer=null),!this.disconnected)return;const E=this._host=this._host||this.selectHost();if(!E)return;this._state=h.CONNECTING,this._last_id=1,this._delay=0,this._last_ping=null,this.log.info(`Using Server: ${E}`);let F;try{F=this._socket=new WebSocket(E)}catch(A){this._state=h.DISCONNECTED,this._reconnect(),this.log.error("Unable to create WebSocket.",A);return}F.onopen=()=>{if(this._socket!==F)return this.log.warn("A socket connected that is not our primary socket."),F.close();this._state=h.CONNECTED,this._sent_user=!1,this.log.info("Connected."),this._ping_time=performance.now(),this._send("hello",[`ffz_${window.FrankerFaceZ.version_info}`,M],(Y,se)=>{if(!Y)return this.log.warn("Error Saying Hello",se);this._on_pong(!1,Y,se[1])});const A=this.resolve("site"),N=G(()=>{if(this._sent_user||!this.connected)return;const Y=A.getUser();Y&&Y.login?(this._sent_user=!0,this._send("setuser",Y.login)):A.enabled||this.once("site:enabled",N,this)},"send_user");N();for(const Y of this._topics.keys())this._send("sub",Y);for(const[Y,se,ue]of this._pending)this._send(Y,se,ue);this._pending=[],this._send("ready",this._offline_time||0),this._offline_time=null,this.emit(":connected")},F.onerror=()=>{F===this._socket&&(this._offline_time||(this._offline_time=Date.now()))},F.onclose=A=>{if(F!==this._socket)return;const N=this._state;this.log.info(`Disconnected. (${A.code}:${A.reason})`),this._state=h.DISCONNECTED;for(const[Y,se]of this._awaiting){const ue=new Error("disconnected");try{typeof se=="function"?se(!1,ue):se[1](ue)}catch(_e){this.log.warn(`Callback Error #${Y}`,_e)}}this._awaiting.clear(),this._want_connected&&(this._offline_time||(this._offline_time=Date.now()),N!==h.CONNECTED&&(this._host=null),this._reconnect(),this.emit(":closed",A.code,A.reason))},F.onmessage=A=>{if(F!==this._socket)return;const N=A.data,Y=N.indexOf(" ");if(Y===-1)return this.log.warn("Malformed message from server.",A.data);const se=parseInt(N.slice(0,Y),10),ue=N.indexOf(" ",Y+1),_e=N.slice(Y+1,ue===-1?N.length:ue),Q=ue===-1?void 0:JSON.parse(N.slice(ue+1));if(se===-1)this.log.debug(`Received Command: ${_e}`,Q),this.emit(`:command:${_e}`,Q);else{const le=_e==="ok",he=this._awaiting.get(se);he?(this._awaiting.delete(se),typeof he=="function"?he(le,Q):he[le?0:1](Q)):(!le||y.DEBUG)&&this.log.info(`Received Reply #${se}:`,le?"OK":"Error",Q)}}}disconnect(){if(this._want_connected=!1,this._reconnect_timer&&(clearTimeout(this._reconnect_timer),this._reconnect_timer=null),!this.disconnected){try{this._socket.close()}catch{}this._socket=null,this._state=h.DISCONNECTED,this.emit(":disconnected")}}_on_pong(E,F,A){const N=performance.now();if(!F)this._ping_time=null,E||this.log.warn("Error Pinging Server",A);else if(this._ping_time){const Y=Date.now(),se=N-this._ping_time,ue=this._last_ping=se/2;this._ping_time=null;const _e=this._time_drift=Y-(A+ue);E||(this.log.info("Server Time:",new Date(A).toISOString()),this.log.info(" Local Time:",new Date(Y).toISOString()),this.log.info(`  Est. Ping: ${ue.toFixed(5)}ms`),this.log.info(`Time Offset: ${_e/1e3}`),Math.abs(_e)>3e5&&this.log.warn("Local time differs from server time by more than 5 minutes."))}this.emit(":pong")}ping(E){this._ping_time||!this.connected||(this._ping_time=performance.now(),this._send("ping",void 0,(F,A)=>this._on_pong(E,F,A)))}_send(E,F,A){if(!this.connected)return this.log.warn(`Tried sending command "${E}" while disconnected.`);const N=this._last_id++;A&&this._awaiting.set(N,A),this._socket.send(`${N} ${E}${F!==void 0?` ${JSON.stringify(F)}`:""}`)}send(E,...F){F.length===1?F=F[0]:F.length||(F=void 0),this.connected?this._send(E,F):this._pending.push([E,F])}call(E,...F){return F.length===1?F=F[0]:F.length||(F=void 0),new Promise((A,N)=>{this.connected?this._send(E,F,[A,N]):this._pending.push([E,F,[A,N]])})}subscribe(E,...F){const A=this._topics;let N=!1;for(const Y of F)A.has(Y)||(this.connected&&this._send("sub",Y),A.set(Y,new Set),N=!0),A.get(Y).add(E);N&&this.emit(":sub-change")}unsubscribe(E,...F){const A=this._topics;let N=!1;for(const Y of F){if(!A.has(Y))continue;const se=A.get(Y);se.delete(E),se.size||(N=!0,A.delete(Y),this.connected&&this._send("unsub",Y))}N&&this.emit(":sub-change")}get topics(){return Array.from(this._topics.keys())}};G(Ie,"SocketClient");let L=Ie;L.State=h;var T=Fe(17159),O=(V=>(V[V.Disconnected=0]="Disconnected",V[V.Connecting=1]="Connecting",V[V.Connected=2]="Connected",V))(O||{});function P(V){let E=V.length;const F=[V];for(;(E=V.lastIndexOf("/",E-1))!==-1;)F.push(`${V.slice(0,E)}/*`);return F.push("*"),F}G(P,"enumerateSubs");const Xe=class Xe extends T.EventEmitter{constructor(){super(),this._ws=null,this._topics=new Set,this._live_topics=new Set,this._want_connection=!1,this._state=0,this._reconnectTimer=null,this._failedConnections=0,this._performReconnect=this._performReconnect.bind(this)}_reconnect(E=!0){if(this._reconnectTimer)return;let F=250+(E?Math.floor(this._failedConnections*(Math.random()*5e3)+5e3):0);this._reconnectTimer=setTimeout(this._performReconnect,F)}_performReconnect(){if(this._reconnectTimer=null,this._ws&&(this._ws.close(),this._ws=null,this._state=0),this._live_topics=new Set(this._topics),!this._live_topics.size)return;this._state=1;const E=new URL("wss://pubsub.workers.frankerfacez.com/ws");if(this._live_topics.size>10)E.searchParams.append("t","*");else for(const A of this._live_topics)E.searchParams.append("t",A);const F=this._ws=new WebSocket(E.toString());F.addEventListener("open",A=>{this._state=2,this._failedConnections=0,this.emit("connect",A)}),F.addEventListener("error",A=>{this.emit("error",A)}),F.addEventListener("close",A=>{this._ws=null,this._state=0,this.emit("disconnect",A),this._want_connection&&this._reconnect()}),F.addEventListener("message",A=>{if(typeof A.data=="string"){let N;try{N=JSON.parse(A.data)}catch{return}if(!N.topic||typeof N.topic!="string")return;if(this._live_topics.size>10&&!this._live_topics.has(N.topic)){let Y=!1;for(const se of P(N.topic))if(this._live_topics.has(se)){Y=!0;break}if(!Y)return}this.emit("message",N)}})}get connected(){return this._state===2}get connecting(){return this._state===1}get disconnected(){return this._state===0}connect(){this._want_connection=!0,this._reconnect(!1)}disconnect(){this._want_connection=!1,this._failedConnections=0,this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=null),this._ws&&(this._ws.close(),this._ws=null,this._state=0,this.emit("disconnect",null))}subscribe(E){Array.isArray(E)||(E=[E]);for(const F of E)this._topics.add(F);this._want_connection&&!(0,u.set_equals)(this._topics,this._live_topics)&&this._reconnect()}unsubscribe(E){Array.isArray(E)||(E=[E]);for(const F of E)this._topics.delete(F);this._want_connection&&!(0,u.set_equals)(this._topics,this._live_topics)&&this._reconnect()}};G(Xe,"PubSubClient");let j=Xe;const ct=class ct extends f.default{constructor(E,F){super(E,F),this.experiments=null,this.settings=null,this.inject("settings"),this.inject("experiments"),this.settings.add("pubsub.enabled",{default:()=>this.experiments.getAssignment("worker_pubsub")??!1,ui:{path:'Debugging @{"expanded": false, "sort": 9999} > PubSub >> General',title:"Enable PubSub.",description:"Whether or not you want your client to connect to FrankerFaceZ's PubSub system. This is still in testing and should be left alone unless you know what you're doing.",force_seen:!0,component:"setting-check-box"},changed:A=>A?this.connect():this.disconnect()}),this._topics=new Map,this._client=null}onEnable(){this.subscribe(null,"global"),this.connect(),this.on("experiments:changed:worker_pubsub",this._updateSetting,this)}onDisable(){this.off("experiments:changed:worker_pubsub",this._updateSetting,this),this.disconnect(),this.unsubscribe(null,"global")}_updateSetting(){this.settings.update("pubsub.enabled")}get connected(){return this._client!=null}reconnect(){this.disconnect(),this.connect()}async connect(){if(this._client||!this.settings.get("pubsub.enabled"))return;const E=this._client=new j;E.on("connect",()=>{this.log.info("Connected to PubSub.")}),E.on("disconnect",()=>{this.log.info("Disconnected from PubSub.")}),E.on("error",A=>{this.log.error("Error in PubSub",A)}),E.on("message",A=>{const N=A.topic,Y=A.data;if(!Y?.cmd){this.log.debug(`Received message on topic "${N}":`,Y),this.emit(":message",N,Y);return}Y.topic=N,this.log.debug(`Received command on topic "${N}" for command "${Y.cmd}":`,Y.data),this.emit(`:command:${Y.cmd}`,Y.data,Y)});const F=[...this._topics.keys()];E.subscribe(F),await E.connect()}disconnect(){this._client&&(this._client.disconnect(),this._client=null)}subscribe(E,...F){const A=this._topics;let N=!1;for(const Y of F){let se=A.get(Y);se?se.add(E):(this._client&&this._client.subscribe(Y),se=new Set,se.add(E),A.set(Y,se),N=!0)}N&&this.emit(":sub-change")}unsubscribe(E,...F){const A=this._topics;let N=!1;for(const Y of F){const se=A.get(Y);se&&(se.delete(E),se.size||(N=!0,A.delete(Y),this._client&&this._client.unsubscribe(Y)))}N&&this.emit(":sub-change")}get topics(){return Array.from(this._topics.keys())}};G(ct,"PubSub");let Z=ct;var q=Fe(89196);const Oe=class Oe extends f.default{constructor(E,F){super(E,F),this.Vue=null,this.i18n=null,this.key="ffz-stuff",this._components={},this.inject("i18n")}async onLoad(){const E=window.ffzVue=this.Vue=(await Promise.all([Fe.e(4047),Fe.e(7485)]).then(Fe.bind(Fe,35702))).default,F=this._components,[A,N,Y]=await Promise.all([Promise.all([Fe.e(4047),Fe.e(7485)]).then(Fe.bind(Fe,6108)),Promise.all([Fe.e(4047),Fe.e(7485)]).then(Fe.t.bind(Fe,59010,19)),Promise.all([Fe.e(4047),Fe.e(7485)]).then(Fe.bind(Fe,8222))]);this.component(Y.default),E.use(A),E.mixin(N.mixin);for(const se in F)(0,u.has)(F,se)&&E.component(se,F[se]);this._components=null,E.use(this)}component(E,F){if(typeof E=="function")for(const A of E.keys())this.component(A.slice(2,A.length-4),E(A).default);else if(typeof E=="object")for(const A in E)(0,u.has)(E,A)&&this.component(A,E[A]);else this.Vue?this.Vue.component(E,F):this._components&&(this._components[E]=F)}install(E){const F=this;this._vue_i18n||(this._vue_i18n=new E({data(){return{locale:F.i18n.locale,phrases:{}}},methods:{tNumber_(A,N){return this.locale,F.i18n.formatNumber(A,N)},tDate_(A,N){return this.locale,F.i18n.formatDate(A,N)},tTime_(A,N){return this.locale,F.i18n.formatTime(A,N)},tDateTime_(A,N){return this.locale,F.i18n.formatDateTime(A,N)},t_(A,N,Y){return this.locale&&this.phrases[A],F.i18n.t(A,N,Y)},tList_(A,N,Y){return this.locale&&this.phrases[A],F.i18n.tList(A,N,Y)},tNode_(A,N){return this.locale,F.i18n.formatNode(A,N)},setLocale(A){F.i18n.locale=A}}}),this.on("i18n:transform",()=>{this._vue_i18n.locale=this.i18n.locale,this._vue_i18n.phrases={}}),this.on("i18n:changed",()=>{this._vue_i18n.locale=this.i18n.locale,this._vue_i18n.phrases={}}),this.on("i18n:loaded",A=>{const N=this._vue_i18n,Y=N.phrases;for(const se of A)N.$set(Y,se,(Y[se]||0)+1)}),E.prototype.$i18n=this._vue_i18n),E.component("t-list",{props:{tag:{required:!1},phrase:{type:String,required:!0},default:{type:String,required:!0},data:{type:Object,required:!1}},render(A){return A(this.tag||"span",this.$i18n.tList_(this.phrase,this.default,Object.assign({},this.data,this.$scopedSlots)).map(N=>typeof N=="function"?N():N))}}),E.mixin({methods:{reactNavigate(A,N,Y){const se=F.resolve("site.router");se&&se.history&&(N&&(N.preventDefault(),N.stopPropagation()),se.history.push(A,Y??void 0))},getReactURL(A,N,Y,...se){return F.resolve("site.router").getURL(A,N,Y,...se)},getI18n(){return F.i18n},t(A,N,Y){return this.$i18n.t_(A,N,Y)},tList(A,N,Y){return this.$i18n.tList_(A,N,Y)},tNode(A,N){return this.$i18n.tNode_(A,N)},tNumber(A,N){return this.$i18n.tNumber_(A,N)},tDate(A,N){return this.$i18n.tDate_(A,N)},tTime(A,N){return this.$i18n.tTime_(A,N)},tDateTime(A,N){return this.$i18n.tDateTime_(A,N)}}})}};G(Oe,"VueModule");let X=Oe;const ee=X,g=class g extends f.default{constructor(E,F){super(E,F),this.settings=null,this.api=y.API_SERVER,this.cdn=y.SERVER,this.active=!1,this.inject("settings"),this.settings.add("data.use-staging",{default:!1,ui:{path:'Debugging > Data Sources >> Staging @{"sort": -1}',force_seen:!0,title:"Use staging as data source.",component:"setting-check-box"}}),this.updateStaging(!1)}onEnable(){this.settings.getChanges("data.use-staging",this.updateStaging,this)}updateStaging(E){this.active=E,this.api=E?y.STAGING_API:y.API_SERVER,this.cdn=E?y.STAGING_CDN:y.SERVER,this.emit(":updated",this.api,this.cdn)}};G(g,"StagingSelector");let te=g;const D=class D extends f.default{constructor(E,F){super(E,F),this.pending_loads=new Map,this.settings=null,this.should_enable=!0,this.inject("settings"),this.settings.add("chat.update-when-loaded",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Update existing chat messages when loading new data.",component:"setting-check-box",description:"This may cause elements in chat to move, so you may wish to disable this when performing moderation."}})}onEnable(){this.on(":schedule",this.schedule)}schedule(E,F){let A=this.pending_loads.get(E);(!A||!A.pending||!A.timers)&&(A={pending:new Set,timers:{},success:!1},this.pending_loads.set(E,A)),!A.pending.has(F)&&(A.pending.add(F),A.timers[F]=setTimeout(()=>this.notify(E,F,!1),15e3))}notify(E,F,A=!0){const N=this.pending_loads.get(E);if(!(!N||!N.pending||!N.timers)&&(N.timers[F]&&(clearTimeout(N.timers[F]),N.timers[F]=null),!!N.pending.has(F)&&(N.pending.delete(F),A&&(N.success=!0),!N.pending.size))){const Y=Object.keys(N.timers);this.log.debug("complete",E,Y),N.success&&this.emit(`:complete:${E}`,Y),this.pending_loads.delete(E)}}};G(D,"LoadTracker");let ne=D;const K=class K extends f.default{constructor(E,F){super(E,F,!0),this.i18n=null,this.settings=null,this.inject("i18n"),this.inject("settings")}populate(E,F){return this.log.warn("[DEV-CHECK] populate() has been renamed to loadFromContext(). The populate() name is deprecated."),this.loadFromContext(E,F)}static register(E,F,A){if(typeof E=="object"&&(F=E,E=F.id||void 0),!E)if(this.name)E=this.name.toSnakeCase();else throw new Error("Unable to register module without ID.");!F&&this.info&&(F=this.info),A&&(this.version=A);const N=window.FrankerFaceZ.get(),Y=N?.addons;Y&&(F?(F.id=E,Y.addAddon(F)):Y.hasAddon(E)||Y.addAddon({id:E}),A&&Y.setVersion(E,A));try{N.register(`addon.${E}`,this)}catch(se){if(se instanceof Error&&se.message&&se.message.includes("Name Collision for Module")){const ue=N.resolve(`addon.${E}`);ue&&(ue.external=!0)}throw se}}};G(K,"Addon");let pe=K;var oe=Fe(38626),de=Fe(14873),me=Fe(94417),Ee=Fe(61892),xe=Fe(5286),Te=Fe(8528),Pe=Fe(2356),Se=Fe(37087);const re=(H=class extends f.default{constructor(){super();const E=performance.now();H.instance=this,this.host="twitch",this.flavor="main",this.name="frankerfacez",this.__state=f.State.Disabled,this.__modules.core=this,this._time("instance"),this.log=new v(null,null,null),this.log.init=!0,this.core_log=this.log.get("core"),this.log.hi(this,H.version_info),this.inject("settings",S.ZP),this.inject("experiments",b),this.inject("i18n",k.ZP),this.inject("staging",te),this.inject("load_tracker",ne),this.inject("socket",L),this.inject("pubsub",Z),this.inject("site",q.Z),this.inject("addons",i),this.register("vue",ee),this.discoverModules().then(()=>this.enable()).then(()=>this.enableInitialModules()).then(()=>{const F=performance.now()-E;this.core_log.info(`Initialization complete in ${F.toFixed(5)}ms.`),this.log.init=!1}).catch(F=>{this.core_log.error("An error occurred during initialization.",F),this.log.init=!1})}static get(){return H.instance}async generateLog(){const E=[];for(const[A,N]of Object.entries(this.__modules))N instanceof f.default&&N.generateLog&&N!=this&&E.push((async()=>{try{return[A,await(0,u.timeout)(Promise.resolve(N.generateLog()),5e3)]}catch(Y){return[A,`Error: ${Y}`]}})());const F=await Promise.all(E);if(this.log.captured_init&&this.log.captured_init.length>0){const A=[];for(const N of this.log.captured_init){const Y=W()(N.time).locale("en").format("H:mm:ss");A.push(`[${Y}] ${N.level} | ${N.category||"core"}: ${N.message}`)}F.unshift(["initialization",A.join(`
`)])}return F.map(A=>`${A[0]}
-------------------------------------------------------------------------------
${typeof A[1]=="string"?A[1]:JSON.stringify(A[1],null,4)}`).join(`

`)}async discoverModules(){const E=await Fe(10952),F=this.loadFromContext(E,this.core_log);this.core_log.info(`Loaded descriptions of ${Object.keys(F).length} modules.`)}async enableInitialModules(){const E=[];for(const F of Object.values(this.__modules))F instanceof f.default&&F.should_enable&&E.push(F.enable());return Promise.all(E)}},G(H,"_FrankerFaceZ2"),H);re.instance=null,re.version_info=null,re.Logger=v,re.utilities={addon:J,blobs:oe,color:de,constants:y,dialog:me,dom:n,events:T,fontAwesome:Ee,graphql:xe,logging:ae,module:f,object:u,time:s,tooltip:Te,i18n:Pe,filtering:Se};let ie=re;const fe=ie.version_info=Object.freeze({major:4,minor:76,revision:4,extra:It?.length&&It[0],commit:"15c33281ad9d1b7898ab3739c0844740210b602b",build:"0",hash:Fe.h(),toString:()=>`${fe.major}.${fe.minor}.${fe.revision}${fe.build?`.${fe.build}`:""}${fe.extra||""}${y.DEBUG?"-dev":""}`}),ge=null;window.FrankerFaceZ=ie,window.ffz=new ie})()})();})();

//# sourceMappingURL=avalon.js.map