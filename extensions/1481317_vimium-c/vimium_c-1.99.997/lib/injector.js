"use strict";var VimiumInjector;(()=>{let t=VimiumInjector,e={id:"",alive:-1,host:"",version:"",cache:null,clickable:void 0,eval:null,reload:null,checkIfEnabled:null,$:null,$h:null,$m:null,$r:null,$g:null,getCommandCount:null,callback:null,destroy:null};if(t)for(let n of Object.keys(t))e[n]=t[n];e.alive=-1,e.$g=null,VimiumInjector=e})(),(function(t,e){function n(t,n){let l,i,a=VimiumInjector,m=a&&a.clickable,h=a&&a.callback;if(!t){let e=n&&n.message,c=o.id||location.host||location.protocol;if(i=!!(e&&e.lastIndexOf("not exist")>=0&&o.id),false===t?l=": not in the allow list.":!i&&n?l=e?`:\n\t${e}`:": no backend found.":s>3?(l=e?`:\n\t${e}`:`: retried but failed (${t}).`,i=false):(setTimeout(f,200*s),s++,i=true),!i){l=l||` (${s} retries).`;let t="color:red",e="color:auto";console.log("%cVimium C%c: %cfail%c to inject into %c%s%c %s",t,e,t,e,"color:#0c85e9",c,e,l),h&&a.callback(-1,l)}}a&&"function"==typeof a.destroy&&a.destroy(true);let v=t?t.h:"",b=VimiumInjector={id:d,alive:0,host:t?t.host:"",version:t?t.version:"",cache:null,clickable:m,eval:null,reload:e(u),checkIfEnabled:null,$:null,$h:t=>"vimium-c."+t+v,$m(t){VimiumInjector&&VimiumInjector.$r("object"==typeof t?t.t:t)},$r(){},$g:null!=r?""===r||"true"===r.toLowerCase():null,getCommandCount:null,callback:h||null,destroy:null},$=document.documentElement;if(!(t&&$ instanceof HTMLHtmlElement))return n;let g=document.contains(c)?c:(document.head||$).lastChild||document.head,k=g.nextSibling,p=g.parentElement,C=[];for(let e of t.s){let t=document.createElement("script");t.type="text/javascript",t.async=false,t.src=e,p.insertBefore(t,k),C.push(t)}C.length>0&&(C[C.length-1].onload=function(){this.onload=null;for(let t=C.length;0<=--t;)C[t].remove()}),h&&b.callback(0,"loading")}function l(){a(()=>{a(()=>{setTimeout(f,0)},{timeout:67})},{timeout:330})}let o=browser.runtime,c=document.currentScript,u=c.src,i=u.indexOf("://")+3,r=c.dataset.blockFocus,a=requestIdleCallback,s=1,d=u.slice(i,u.indexOf("/",i));d=c.dataset.vimiumId||"vimium-c@gdh1995.cn",d=c.dataset.extensionId||d,VimiumInjector.id=d;let f=()=>{try{o.sendMessage(d,{handler:99,scripts:true}).then(n,t=>n(void 0,t))}catch(t){console.log("Can not send message to the extension of %o: %s",d,t&&t.message||t+"")}};"loading"!==document.readyState?l():addEventListener("DOMContentLoaded",l,{capture:true,once:true})})(0,t=>e=>{function n(){let n=document.documentElement,l=document.head||document.body||n,o=document.createElement("script");l&&(o.type="text/javascript",o.async=false,o.src=t,console.log("%cVimium C%c begins to reload%s.","color:red","color:auto",1===e?" because it has been updated.":""),l.append(o))}let l=VimiumInjector;if(l){let t=l.clickable;"function"==typeof l.destroy&&l.destroy(true),l.clickable=t}e?setTimeout(n,200):n()}),(!document.currentScript||"false"!==(document.currentScript.dataset.vimiumHooks||"").toLowerCase())&&null!==VimiumInjector.clickable&&(function(){VimiumInjector.clickable=VimiumInjector.clickable||new WeakSet;let t=EventTarget,e=t.prototype,n=e.addEventListener;if(true===n.vimiumHooked)return;let l=HTMLAnchorElement,o=Element,c=e.addEventListener=function addEventListener(t,e){"click"===t&&!(this instanceof l)&&e&&this instanceof o&&VimiumInjector&&VimiumInjector.clickable&&VimiumInjector.clickable.add(this);let c=arguments,u=c.length;return 2===u?n.call(this,t,e):3===u?n.call(this,t,e,c[2]):n.apply(this,c)},u=Function.prototype,i=u.toString,r=u.toString=function toString(){return i.apply(this===c?n:this===r?i:this,arguments)};c.vimiumHooked=true,t.vimiumRemoveHooks=()=>{delete t.vimiumRemoveHooks,e.addEventListener===c&&(e.addEventListener=n),u.toString===r&&(u.toString=i)},c.prototype=r.prototype=void 0})();