import{JSDOM}from"./jsdom.js";const{window}=new JSDOM("");function X2JS(t){"use strict";void 0===(t=t||{}).escapeMode&&(t.escapeMode=!0),t.attributePrefix=t.attributePrefix||"_",t.arrayAccessForm=t.arrayAccessForm||"none",t.emptyNodeForm=t.emptyNodeForm||"text",void 0===t.enableToStringFunc&&(t.enableToStringFunc=!0),t.arrayAccessFormPaths=t.arrayAccessFormPaths||[],void 0===t.skipEmptyTextNodesForObj&&(t.skipEmptyTextNodesForObj=!0),void 0===t.stripWhitespaces&&(t.stripWhitespaces=!0),t.datetimeAccessFormPaths=t.datetimeAccessFormPaths||[],void 0===t.useDoubleQuotes&&(t.useDoubleQuotes=!1),t.xmlElementsFilter=t.xmlElementsFilter||[],t.jsonPropertiesFilter=t.jsonPropertiesFilter||[],void 0===t.keepCData&&(t.keepCData=!1);var e={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};function n(t){var e=t.localName;return null==e&&(e=t.baseName),null!=e&&""!=e||(e=t.nodeName),e}function r(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):t}function i(t,e,n,r){for(var i=0;i<t.length;i++){var a=t[i];if("string"==typeof a){if(a==r)break}else if(a instanceof RegExp){if(a.test(r))break}else if("function"==typeof a&&a(e,n,r))break}return i!=t.length}function a(e,n,r){"property"===t.arrayAccessForm&&(e[n]instanceof Array?e[n+"_asArray"]=e[n]:e[n+"_asArray"]=[e[n]]),!(e[n]instanceof Array)&&t.arrayAccessFormPaths.length>0&&i(t.arrayAccessFormPaths,e,n,r)&&(e[n]=[e[n]])}function s(t){var e=t.split(/[-T:+Z]/g),n=new Date(e[0],e[1]-1,e[2]),r=e[5].split(".");if(n.setHours(e[3],e[4],r[0]),r.length>1&&n.setMilliseconds(r[1]),e[6]&&e[7]){var i=60*e[6]+Number(e[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(t)?"-":"+")?-1*i:i),n.setMinutes(n.getMinutes()-i-n.getTimezoneOffset())}else-1!==t.indexOf("Z",t.length-1)&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())));return n}function o(n,r,a,s){return!(r==e.ELEMENT_NODE&&t.xmlElementsFilter.length>0)||i(t.xmlElementsFilter,n,a,s)}function l(r,c){if(r.nodeType==e.DOCUMENT_NODE){for(var u=new Object,_=r.childNodes,f=0;f<_.length;f++)(d=_.item(f)).nodeType==e.ELEMENT_NODE&&(u[p=n(d)]=l(d,p));return u}if(r.nodeType==e.ELEMENT_NODE){for((u=new Object).__cnt=0,_=r.childNodes,f=0;f<_.length;f++){var d,p=n(d=_.item(f));if(d.nodeType!=e.COMMENT_NODE){var m=c+"."+p;o(u,d.nodeType,p,m)&&(u.__cnt++,null==u[p]?(u[p]=l(d,m),a(u,p,m)):(null!=u[p]&&(u[p]instanceof Array||(u[p]=[u[p]],a(u,p,m))),u[p][u[p].length]=l(d,m)))}}for(var x=0;x<r.attributes.length;x++){var g=r.attributes.item(x);u.__cnt++,u[t.attributePrefix+g.name]=g.value}var h=function(t){return t.prefix}(r);return null!=h&&""!=h&&(u.__cnt++,u.__prefix=h),null!=u["#text"]&&(u.__text=u["#text"],u.__text instanceof Array&&(u.__text=u.__text.join("\n")),t.stripWhitespaces&&(u.__text=u.__text.trim()),delete u["#text"],"property"==t.arrayAccessForm&&delete u["#text_asArray"],u.__text=function(e,n,r){if(t.datetimeAccessFormPaths.length>0){var a=r.split(".#")[0];return i(t.datetimeAccessFormPaths,e,n,a)?s(e):e}return e}(u.__text,p,c+"."+p)),null!=u["#cdata-section"]&&(u.__cdata=u["#cdata-section"],delete u["#cdata-section"],"property"==t.arrayAccessForm&&delete u["#cdata-section_asArray"]),0==u.__cnt&&"text"==t.emptyNodeForm?u="":1==u.__cnt&&null!=u.__text?u=u.__text:1!=u.__cnt||null==u.__cdata||t.keepCData?u.__cnt>1&&null!=u.__text&&t.skipEmptyTextNodesForObj&&(t.stripWhitespaces&&""==u.__text||""==u.__text.trim())&&delete u.__text:u=u.__cdata,delete u.__cnt,!t.enableToStringFunc||null==u.__text&&null==u.__cdata||(u.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),u}if(r.nodeType==e.TEXT_NODE||r.nodeType==e.CDATA_SECTION_NODE)return r.nodeValue}function c(e,n,i,a){var s="<"+(null!=e&&null!=e.__prefix?e.__prefix+":":"")+n;if(null!=i)for(var o=0;o<i.length;o++){var l=i[o],c=e[l];t.escapeMode&&(c=r(c)),s+=" "+l.substr(t.attributePrefix.length)+"=",t.useDoubleQuotes?s+='"'+c+'"':s+="'"+c+"'"}return s+(a?"/>":">")}function u(t,e){return"</"+(null!=t.__prefix?t.__prefix+":":"")+e+">"}function _(e,n){return"property"==t.arrayAccessForm&&(i="_asArray",-1!==(r=n.toString()).indexOf(i,r.length-8))||0==n.toString().indexOf(t.attributePrefix)||0==n.toString().indexOf("__")||e[n]instanceof Function;var r,i}function f(t){var e=0;if(t instanceof Object)for(var n in t)_(t,n)||e++;return e}function d(e,n,r){return 0==t.jsonPropertiesFilter.length||""==r||i(t.jsonPropertiesFilter,e,n,r)}function p(e){var n=[];if(e instanceof Object)for(var r in e)-1==r.toString().indexOf("__")&&0==r.toString().indexOf(t.attributePrefix)&&n.push(r);return n}function m(e){var n="";return e instanceof Object?n+=function(e){var n="";return null!=e.__cdata&&(n+="<![CDATA["+e.__cdata+"]]>"),null!=e.__text&&(t.escapeMode?n+=r(e.__text):n+=e.__text),n}(e):null!=e&&(t.escapeMode?n+=r(e):n+=e),n}function x(t,e){return""===t?e:t+"."+e}function g(t,e,n,r){var i="";if(0==t.length)i+=c(t,e,n,!0);else for(var a=0;a<t.length;a++)i+=c(t[a],e,p(t[a]),!1),i+=h(t[a],x(r,e)),i+=u(t[a],e);return i}function h(t,e){var n="";if(f(t)>0)for(var r in t)if(!_(t,r)&&(""==e||d(t,r,x(e,r)))){var i=t[r],a=p(i);null==i||null==i?n+=c(i,r,a,!0):i instanceof Object?i instanceof Array?n+=g(i,r,a,e):i instanceof Date?(n+=c(i,r,a,!1),n+=i.toISOString(),n+=u(i,r)):f(i)>0||null!=i.__text||null!=i.__cdata?(n+=c(i,r,a,!1),n+=h(i,x(e,r)),n+=u(i,r)):n+=c(i,r,a,!0):(n+=c(i,r,a,!1),n+=m(i),n+=u(i,r))}return n+m(t)}this.parseXmlString=function(t){var e;if(window.ActiveXObject,void 0===t)return null;if(window.DOMParser){var n=new window.DOMParser;try{(e=n.parseFromString(t,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(e=null)}catch(t){e=null}}else 0==t.indexOf("<?")&&(t=t.substr(t.indexOf("?>")+2)),(e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t);return e},this.asArray=function(t){return void 0===t||null==t?[]:t instanceof Array?t:[t]},this.toXmlDateTime=function(t){return t instanceof Date?t.toISOString():"number"==typeof t?new Date(t).toISOString():null},this.asDateTime=function(t){return"string"==typeof t?s(t):t},this.xml2json=function(t){return l(t)},this.xml_str2json=function(t){var e=this.parseXmlString(t);return null!=e?this.xml2json(e):null},this.json2xml_str=function(t){return h(t,"")},this.json2xml=function(t){var e=this.json2xml_str(t);return this.parseXmlString(e)},this.getVersion=function(){return"1.2.0"}}export{X2JS};