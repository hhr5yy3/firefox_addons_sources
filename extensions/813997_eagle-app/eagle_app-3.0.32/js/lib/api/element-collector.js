class ElementCollector{async getCollectableItems(){var e=this.#getBgImageElements(),t=this.#getImagesElements(),n=this.#getSVGsElements(),a=this.#getVideosElements(),r=[];for(const l of[...e,...t,...n,...a])try{var i=await eagle.elementInspector.getMeta(l.element);r.push({...l,elementMeta:i})}catch(e){}return r}async getIframeCollectableItems(){return new Promise(t=>{if(0===[...document.querySelectorAll("iframe")].filter(e=>9e4<e.clientWidth*e.clientWidth).length)return t([]);chrome.runtime.sendMessage({channel:"batch-save-iframe"},e=>{try{return e?.data&&0<e?.data.length?t(...e.data):t([])}catch(e){return t([])}})})}async getShadowRootCollectableItems(){return new Promise(e=>e(function(e){let n=[];return function t(e){e.shadowRoot&&t(e.shadowRoot),Array.from(e.children).forEach(e=>{t(e)}),"IMG"===e.tagName&&e.src&&n.push(e.src)}(e),n}(document.documentElement).map(e=>({type:"image",elementMeta:{src:e}}))))}#getImagesElements(){let r=[];return $("img").each((e,t)=>{var n=t.naturalWidth,a=t.naturalHeight;n<5||a<5||r.push({type:"image",width:n,height:a,element:t})}),r}#getSVGsElements(){let r=[];return $("svg").each((e,t)=>{var n=t.width,a=t.height;t.width<5||t.height<5||r.push({type:"svg",width:n,height:a,src:(n=t,n=(new XMLSerializer).serializeToString(n),"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n)))),element:t})}),r}#getVideosElements(){let o=[];return $("video").each((e,n)=>{const a=n.videoWidth,r=n.videoHeight,i=n.currentSrc||n.src||"";if(n.duration&&!i.startsWith("blob:")){var t=$(n).find("source");const l=["video/mp4","video/webm"];0<t.length?t.each((e,t)=>{i==t.src&&l.includes(t.type)&&o.push({type:"video",width:a,height:r,duration:n.duration,element:n})}):[".mp4",".webm"].some(e=>i.includes(e))&&o.push({type:"video",width:a,height:r,duration:n.duration,element:n})}}),o}#getBgImageElements(){var e=[...document.querySelectorAll("body, body *")];let r=[];return e.forEach(e=>{let t=$(e).css("background-image");var n,a;t&&"none"!==t&&-1===t.indexOf("gradient")&&(t&&-1===t.indexOf("data:image")&&(t=t.replace(/url\((['"])?(.*?)\1\)/gi,"$2")),{width:n,height:a}=e.getBoundingClientRect(),n<5||a<5||r.push({type:"bg-image",width:n,height:a,element:e}))}),r}}eagle.elementCollector=new ElementCollector;