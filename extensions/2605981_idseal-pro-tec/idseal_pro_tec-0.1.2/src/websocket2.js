var webSocketClient;const socketMessageListener=e=>{var t=JSON.parse(e.data);if("FIREFOX"==t.Browser||"NOTSPECIFIED"==t.Browser)switch(console.log(JSON.stringify(t)),t.Command){case"pong":webSocketClient.socketSendMessage("ping");break;case"SCRAMBLE":GenerateFingerprint();break;case"TRACKINGONOFF":"ON"==t.Value?(TrackingBlocker=!0,GenerateFingerprint()):TrackingBlocker=!1,UpdatePopupData(),saveChanges();break;case"ADBLOCKERONOFF":"ON"==t.Value?EnableAdBlocker():DisableAdBlocker(),UpdatePopupData();break;case"SETLANGUAGE":let e=t.Value.toLowerCase();console.log("SET LANG: "+e);let o=!1;translation.forEach(t=>{t.lang===e&&(o=!0)}),o?browser.storage.local.set({lang:e},function(){}):browser.storage.local.set({lang:"en"},function(){});break;case"WHITELIST":MergeWhitelist(t.Value);break;case"WHITELISTMERGED":Whitelist=t.Value;break;default:if(t.Regged){switch(t.Regged){case"0xa":startTrial();break;case"0x1":startPremium()}var s=t.Expire^x;browser.storage.sync.set({exp:s},function(){})}}},socketOpenListener=e=>{socketSendMessage({Browser:"FIREFOX",Command:"CONNECTED",Value:""})},socketCloseListener=e=>{try{(webSocketClient=new WebSocket("ws://localhost/IDSealPro-Tec/")).addEventListener("open",socketOpenListener),webSocketClient.addEventListener("message",socketMessageListener),webSocketClient.addEventListener("close",socketCloseListener)}catch(e){}};function socketSendMessage(e){webSocketClient&&1==webSocketClient.readyState&&webSocketClient.send(JSON.stringify(e))}function saveToStorage(){browser.storage.sync.set({_$:_$},function(){})}function startTrial(){_$=!1,saveToStorage(),browser.browserAction.disable(),TrackingBlocker=!1,DisableAdBlocker(),saveChanges()}function startPremium(){_$=!0,saveToStorage(),browser.browserAction.enable(),GenerateFingerprint(),saveChanges(),UpdatePopupData()}socketCloseListener();