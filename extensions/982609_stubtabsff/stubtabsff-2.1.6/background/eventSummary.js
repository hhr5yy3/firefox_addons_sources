// Copyright (c) Zanger LLC. All rights reserved.

var tmConsoleWindow=null;function onTMEventWindowCreated(windowInfo){tmConsoleWindow=windowInfo;log.log(`Successfully opened the ticketmaster console window: ${JSON.stringify(windowInfo)}`);}
function onTMEventWindowError(error){log.log(`Error opening the ticketmaster console window: ${error}`);}
async function openEventSummary(tab){if(license.valid){log.log("Open event summary for tabId="+tab.id+", title="+tab.title);var url=tab.url;var expression=/((.*(ticketmaster|livenation)\.com)(.*\/event\/)([0-9A-F]+).*)/i;var regex=new RegExp(expression);var match=regex.exec(url);if(match!=null&&match.length>=6){var eventId=match[5];var popupURL=browser.extension.getURL("popup/event_summary.html");var lic=null;promise=browser.storage.local.get('license.license');await promise.then(function(object){if(object['license.license']===undefined)return;lic=object['license.license'].core;});var creating=browser.windows.create({url:popupURL+"?license="+lic+"&eventId="+eventId+"&type=ticket-summary&title="+encodeURIComponent(tab.title),type:"popup",height:500,width:500});creating.then(onTMEventWindowCreated,onTMEventWindowError);}else{alert("This URL is not a ticketmaster event URL");}}}