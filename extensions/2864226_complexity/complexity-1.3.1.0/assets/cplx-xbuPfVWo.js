import{j as e,c as U,v as Me}from"./cplx-DEt7CUyc.js";import{R as S,a as _,b as I,u as q,c as le,d as Be,p as N,s as g,C as Ne,e as y,f as m,g as W,h as Pe}from"./cplx-CWPpH3dB.js";import{D as Ie,g as qe,a as Te,b as ke,c as Oe,d as Ee,e as Ae,P as A}from"./cplx-BsCYqTWz.js";import{r as d}from"./cplx-M4JPizzD.js";import{c as Re,s as Fe,i as He,b as G}from"./cplx-BqwXc_LR.js";import{Q as Qe,a as Le,u as ie}from"./cplx-B42KOvrD.js";import{u as ce,a as ze}from"./cplx-BB1imbNT.js";import{s as ue}from"./cplx-Bey00KRS.js";import{V as ne,W as De,X as Ke,K as w,Y as se,D as Ve,i as Ue,q as $,E as We}from"./cplx-CVsLL7Ku.js";import{t as h,u as _e,v as R,w as Ge,x as $e,y as de,j as Xe}from"./cplx-CejnDNPm.js";import{T as M}from"./cplx-Cqfmi6PF.js";import{S as X,a as B,b as Y,c as J,d as Z,e as ee,f as te,g as me,h as pe}from"./cplx-DLB-E6VW.js";import{S as F,a as H,b as Ye}from"./cplx-DSxkwD9v.js";import{U as j,r as xe,T,w as Je}from"./cplx-Cdcyb6EG.js";import{l as E,g as he,P as Ze}from"./cplx-AFeO3sEC.js";import{A as et}from"./cplx-DZHkAxBZ.js";import{S as tt,a as ot,b as nt}from"./cplx--i0pL27w.js";import{$ as C}from"./cplx-BbAh7E-i.js";import{C as k,a as fe,b as st,c as rt,d as at,e as lt,f as it}from"./cplx-C7vqVxs5.js";import{P as ct,u as ut,a as dt}from"./cplx-gki37G4r.js";import{B as re}from"./cplx-CCGYIZQf.js";import{g as we}from"./cplx-CvSOQQlQ.js";import{c as ae,P as ge}from"./cplx-CVOZpI4d.js";import{a as P}from"./cplx-SsoyhRxE.js";import{S as mt,u as pt}from"./cplx-BTLFyVTA.js";import"./cplx-BpeHHEix.js";import"./cplx-CIDXzIHh.js";import"./cplx-CzQHx1MX.js";import"./cplx-Bzmv935M.js";import"./cplx-CZMWhpfy.js";import"./cplx-Mn-h5XDX.js";import"./cplx-DewpVJ-0.js";import"./cplx-DD6dUv5H.js";import"./cplx-Dy60Fcq0.js";import"./cplx-CgmVhoKz.js";import"./cplx-km2FGkQ4.js";import"./cplx-hUtawQMb.js";import"./cplx-2ekRUlSR.js";import"./cplx-DC-QQLj-.js";import"./cplx-B814hFp-.js";import"./cplx-wwbq-DDb.js";import"./cplx-D37zsf-y.js";import"./cplx-DSnlyBAv.js";import"./cplx-CXGk_GMP.js";import"./cplx-CCS6eJc0.js";import"./cplx-B19A3gYQ.js";import"./cplx-C-SYgQKx.js";import"./cplx-D9K5ecXe.js";import"./cplx-CEwbiDR6.js";var xt=class extends Qe{constructor(t,s){super(t,s)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t,s){super.setOptions({...t,behavior:ne()},s)}getOptimisticResult(t){return t.behavior=ne(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,s){var b,V;const{state:n}=t,r=super.createResult(t,s),{isFetching:o,isRefetching:a,isError:l,isRefetchError:i}=r,c=(V=(b=n.fetchMeta)==null?void 0:b.fetchMore)==null?void 0:V.direction,u=l&&c==="forward",p=o&&c==="forward",x=l&&c==="backward",f=o&&c==="backward";return{...r,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:De(s,n.data),hasPreviousPage:Ke(s,n.data),isFetchNextPageError:u,isFetchingNextPage:p,isFetchPreviousPageError:x,isFetchingPreviousPage:f,isRefetchError:i&&!u&&!x,isRefetching:a&&!p&&!f}}};function ht(t,s){return Le(t,xt)}const ft="[cplx-follow-up-query-box]{border-radius:calc(var(--radius) - 2px);border:1px solid var(--border-darker)!important;background:var(--secondary);box-shadow:0 0 10px #0003!important}[cplx-follow-up-query-box]>div{border-radius:calc(var(--radius) - 2px)}[cplx-follow-up-query-box]>div>div{border-radius:calc(var(--radius) - 2px);transition:none!important;animation:none!important;transform:none!important}[cplx-follow-up-query-box]>div>div>div{display:grid!important;grid-template-columns:repeat(3,minmax(0,1fr))!important;grid-template-rows:1fr auto!important}[cplx-follow-up-query-box]>div>div>div>div:nth-child(1){order:0;grid-column:span 3 / span 3;grid-column-start:1}[cplx-follow-up-query-box]>div>div>div>div:nth-child(2){grid-column:span 2 / span 2;grid-column-start:1;align-items:center;order:1}[cplx-follow-up-query-box]>div>div>div>div:nth-child(3){grid-column:span 1 / span 1}[cplx-follow-up-query-box] button:has(svg[data-icon=circle-plus]){width:2rem;height:2rem;border-radius:calc(var(--radius) - 2px)}[cplx-follow-up-query-box] button:has(svg[data-icon=circle-plus]) svg{width:1rem;height:1rem}@media (min-width: 768px){.pointer-events-none.fixed.bottom-mobileNavHeight{bottom:0;margin-top:0}}",wt=t=>Re()(Fe(He(s=>({...t})))),ye=d.createContext(null),Q=({children:t,storeValue:s})=>{const[n]=d.useState(()=>wt(s));return d.useEffect(()=>{n.setState(s)},[n,s]),e.jsx(ye,{value:{store:s},children:t})};function O(){const t=d.use(ye);if(!t)throw new Error("useScopedQueryBoxContext must be used within a ScopedQueryBoxProvider");return t}function gt(){return e.jsx(X,{children:S.map(t=>e.jsx(B,{checkboxOnSingleItem:!0,item:t.value,className:"tw-w-[150px] tw-overflow-hidden tw-p-2 tw-font-medium",children:e.jsx("span",{className:"tw-grow-1 tw-line-clamp-1",children:t.label})},t.value))})}function yt({...t}){return e.jsx(F,{lazyMount:!0,unmountOnExit:!0,...t,children:e.jsx(H,{side:"bottom",className:"tw-flex tw-flex-col tw-gap-2",children:S.map(s=>e.jsx(B,{checkboxOnSingleItem:!0,item:s.value,className:"tw-flex tw-items-center tw-gap-2 tw-py-3 tw-font-medium",children:e.jsx("span",{className:"tw-grow-1",children:s.label})},s.value))})})}function je({value:t,setValue:s,recencyData:n}){const{isMobile:r}=G();return e.jsxs(Y,{lazyMount:!0,unmountOnExit:!0,portal:!1,collection:J({items:S,itemToString:o=>o.label,itemToValue:o=>o.value}),value:[t],className:"tw-h-8",onValueChange:({value:o})=>{s(o[0]),setTimeout(()=>{j.getActiveQueryBoxTextarea().trigger("focus")},100)},onKeyDown:o=>{o.key===w.Key.Escape&&(o.preventDefault(),o.stopPropagation(),setTimeout(()=>{j.getActiveQueryBoxTextarea().trigger("focus")},100))},children:[e.jsx(M,{content:h("plugin-focus-selector:focusWebRecencySelector.tooltip",{mode:n.label}),children:e.jsx(Z,{variant:"ghost",className:"tw-h-full tw-w-fit tw-px-2",children:e.jsxs(ee,{className:"tw-flex tw-items-center tw-gap-1",children:[e.jsx(_e,{className:"tw-size-4"}),n.value!=="ALL"&&e.jsx("span",{className:"tw-hidden md:tw-inline",children:n.label})]})})}),e.jsx(te,{children:({open:o,setOpen:a})=>r?e.jsx(yt,{open:o,onOpenChange:({open:l})=>a(l)}):e.jsx(gt,{})})]})}function jt(){const{url:t}=_(),s=xe(t).pathname.split("/").pop()||"",{selectedRecency:n,setSelectedRecency:r}=I(c=>({selectedRecency:c.selectedRecency,setSelectedRecency:c.setSelectedRecency})),o=ce(q(c=>c.threadComponents.messageBlocks),100),{data:a,refetch:l}=ie({queryKey:["vDom","firstMessageFocusMode",s],queryFn:async()=>await ue("reactVdom:getMessageFocusMode",{index:0},"window"),refetchOnReconnect:!1,refetchOnWindowFocus:!1,enabled:s!=="new"&&!!o&&o.length>0});if(d.useEffect(()=>{l()},[o,t,l]),!a||!le.includes(a))return null;const i=S.find(c=>c.value===n);return i==null?null:e.jsx(je,{value:n,setValue:r,recencyData:i})}function vt({...t}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"0.8em",height:"0.8em",viewBox:"0 0 164 164",...t,children:[e.jsx("path",{fill:"currentColor",d:"M138.291 0h30.731v30.731h-30.731z"}),e.jsx("path",{d:"M0 0h30.731v30.731H0zm0 30.731h30.731v30.731H0zm0 30.732h30.731v30.731H0zm0 30.731h30.731v30.731H0z"}),e.jsx("path",{d:"M0 122.925h30.731v30.731H0z"}),e.jsx("path",{fill:"currentColor",d:"M15.366 0h30.731v30.731H15.366z"}),e.jsx("path",{fill:"currentColor",d:"M138.291 30.731h30.731v30.731h-30.731zm-122.925 0h30.731v30.731H15.366z"}),e.jsx("path",{d:"M92.194 30.731h30.731v30.731H92.194z"}),e.jsx("path",{fill:"currentColor",d:"M107.56 30.731h30.731v30.731H107.56zm-61.463 0h30.731v30.731H46.097z"}),e.jsx("path",{fill:"currentColor",d:"M76.828 61.463h30.731v30.731H76.828zm30.732 0h30.731v30.731H107.56zm-61.463 0h30.731v30.731H46.097z"}),e.jsx("path",{d:"M61.463 92.194h30.731v30.731H61.463z"}),e.jsx("path",{fill:"currentColor",d:"M76.828 92.194h30.731v30.731H76.828z"}),e.jsx("path",{fill:"currentColor",d:"M138.291 61.463h30.731v30.731h-30.731zm-122.925 0h30.731v30.731H15.366z"}),e.jsx("path",{d:"M122.925 92.194h30.731v30.731h-30.731z"}),e.jsx("path",{fill:"currentColor",d:"M138.291 92.194h30.731v30.731h-30.731z"}),e.jsx("path",{d:"M122.925 122.925h30.731v30.731h-30.731z"}),e.jsx("path",{fill:"currentColor",d:"M15.366 92.194h30.731v30.731H15.366z"}),e.jsx("path",{fill:"currentColor",d:"M138.291 122.925h30.731v30.731h-30.731zm-122.925 0h30.731v30.731H15.366z"})]})}function bt({...t}){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"0.8em",height:"0.8em",viewBox:"0 0 1000 1000",...t,children:e.jsxs("g",{children:[e.jsx("polygon",{fill:"currentColor",points:"226.83 411.15 501.31 803.15 623.31 803.15 348.82 411.15 226.83 411.15"}),e.jsx("polygon",{fill:"currentColor",points:"348.72 628.87 226.69 803.15 348.77 803.15 409.76 716.05 348.72 628.87"}),e.jsx("polygon",{fill:"currentColor",points:"651.23 196.85 440.28 498.12 501.32 585.29 773.31 196.85 651.23 196.85"}),e.jsx("polygon",{fill:"currentColor",points:"673.31 383.25 673.31 803.15 773.31 803.15 773.31 240.44 673.31 383.25"})]})})}const ve={Anthropic:tt,OpenAI:et,xAI:bt,Perplexity:ot,Google:nt,Mistral:vt};function Ct(t){var s=d.useState(function(){return se(typeof t=="function"?t():t,!0)}),n=s[1];return[s[0],d.useCallback(function(r){n(typeof r=="function"?Ve(r):se(r))},[])]}function oe(){const{data:t}=Be(),s=d.useCallback(o=>{if(o.unknownLimit)return null;switch(o.code){case"claude3opus":return(t==null?void 0:t.opus_limit)??0;case"o1":return(t==null?void 0:t.o1_limit)??0;case"turbo":return 1/0;default:return(t==null?void 0:t.gpt4_limit)??0}},[t]),[n,r]=Ct({});return d.useEffect(()=>{r(o=>{E.forEach(a=>{o[a.code]=s(a)})})},[t,s,r]),n}function St(){const t=oe(),s=d.useMemo(()=>he(),[]);return e.jsx(X,{className:"custom-scrollbar tw-max-h-[40svh] tw-max-w-[200px] tw-overflow-auto tw-font-sans",children:s.map(({provider:n,models:r})=>e.jsxs(me,{children:[e.jsx(pe,{children:n}),r.map(o=>{const a=ve[n];return e.jsx(M,{content:t[o.code]===1/0?"Unlimited":t[o.code],disabled:t[o.code]==null,positioning:{placement:"right",gutter:10},children:e.jsx(B,{item:o.code,className:"tw-font-medium tw-text-foreground",children:e.jsxs("div",{className:"tw-flex tw-max-w-full tw-items-center tw-justify-around tw-gap-2",children:[a!=null?e.jsx(a,{className:"tw-size-4"}):e.jsx(R,{className:"tw-size-4"}),e.jsx("span",{className:"tw-truncate",children:o.label})]})},o.code)},o.code)})]},n))})}function Mt({...t}){const s=oe(),n=d.useMemo(()=>he(),[]);return e.jsx(F,{lazyMount:!0,unmountOnExit:!0,...t,children:e.jsx(H,{side:"bottom",className:"tw-space-y-6",children:n.map(({provider:r,models:o})=>e.jsxs(me,{className:"tw-space-y-3",children:[e.jsx(pe,{className:"tw-text-lg",children:r}),o.map(a=>{const l=ve[r];return l==null?null:e.jsx(B,{item:a.code,className:"tw-py-3 tw-font-medium",children:e.jsxs("div",{className:"tw-flex tw-w-full tw-max-w-full tw-items-center tw-justify-between tw-gap-4",children:[e.jsxs("div",{className:"tw-flex tw-items-center tw-gap-3",children:[Ue(e.jsx(l,{}))?e.jsx(l,{className:"tw-size-5"}):e.jsx(R,{className:"tw-size-5"}),e.jsx("span",{className:"tw-truncate",children:a.label})]}),e.jsx("div",{className:"tw-text-sm tw-text-muted-foreground",children:s[a.code]})]})},a.code)})]},r))})})}function Bt({value:t}){var a;const{store:{type:s}}=O(),n=E.find(l=>l.code===t),r=oe();if(n==null)return null;const o=r[n.code];return e.jsxs("div",{className:"tw-flex tw-min-h-8 tw-items-center tw-justify-center tw-gap-1",children:[e.jsx(R,{className:"tw-size-4"}),e.jsxs("div",{className:U("tw-relative",{"tw-hidden md:tw-block":s!=="follow-up"}),children:[e.jsx(ee,{className:"tw-font-medium",children:(a=E.find(l=>l.code===t))==null?void 0:a.shortLabel}),o!=null&&o<=100&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"tw-invisible tw-text-[.5rem] tw-text-primary",children:o}),e.jsx("span",{className:"tw-absolute -tw-right-1 -tw-top-2 tw-text-[.5rem] tw-text-primary",children:o})]})]})]})}function L(){const{isMobile:t}=G(),s=I(o=>o.selectedLanguageModel),n=I(o=>o.setSelectedLanguageModel),r=o=>{o.value[0]!=null&&(n(o.value[0]),setTimeout(()=>{j.getActiveQueryBoxTextarea().trigger("focus")},100))};return e.jsxs(Y,{lazyMount:!0,unmountOnExit:!0,portal:!1,"data-testid":T.QUERY_BOX.LANGUAGE_MODEL_SELECTOR,collection:J({items:E.map(o=>o.code)}),value:[s],onValueChange:r,onKeyDown:o=>{o.key===w.Key.Escape&&(o.preventDefault(),o.stopPropagation(),setTimeout(()=>{j.getActiveQueryBoxTextarea().trigger("focus")},100))},children:[e.jsx(M,{content:h("plugin-model-selectors:languageModelSelector.tooltip"),positioning:{gutter:8},children:e.jsx(Z,{variant:"ghost",children:e.jsx(Bt,{value:s})})}),e.jsx(te,{children:({open:o,setOpen:a})=>t?e.jsx(Mt,{open:o,onOpenChange:({open:l})=>a(l)}):e.jsx(St,{})})]})}function z(){const t=async()=>{const s=j.getActiveQueryBoxTextarea();if(!s.length)return;s.trigger("focus");const n=s[0],{selectionStart:r,value:o}=n,a=r>0&&o[r-1]!==" ",l=r<o.length&&o[r]!==" ";let i="";a&&(i+=" "),i+="/",l&&(i+=" ");const c=new KeyboardEvent("keydown",{key:"/",bubbles:!0,cancelable:!0});n.dispatchEvent(c),document.execCommand("insertText",!1,i);const u=r+(a?2:1);n.setSelectionRange(u,u)};return e.jsx(M,{content:h("plugin-slash-command-menu:slashCommandMenu.triggerButton.label"),children:e.jsx("button",{className:"tw-flex tw-min-h-8 tw-w-max tw-cursor-pointer tw-items-center tw-justify-between tw-gap-1 tw-rounded-md tw-px-2 tw-text-center tw-text-sm tw-font-medium tw-text-muted-foreground tw-outline-none tw-transition-all tw-duration-150 placeholder:tw-text-muted-foreground hover:tw-bg-primary-foreground hover:tw-text-foreground focus-visible:tw-bg-primary-foreground focus-visible:tw-outline-none active:tw-scale-95 disabled:tw-cursor-not-allowed disabled:tw-opacity-50 [&>span]:!tw-truncate",onClick:t,children:e.jsx(Ge,{className:"tw-size-4"})})})}function Nt(){const[t,s]=d.useState(!1),n=()=>{we().deleteAll(),$.invalidateQueries({queryKey:N.infinite._def}),s(!1)};return e.jsxs(Ie,{lazyMount:!0,unmountOnExit:!0,open:t,onOpenChange:({open:r})=>s(r),children:[e.jsx(qe,{asChild:!0,children:e.jsx("div",{className:"tw-ml-auto tw-cursor-pointer tw-text-xs tw-text-muted-foreground tw-transition-colors hover:tw-text-foreground hover:tw-underline",children:h("plugin-slash-command-menu:slashCommandMenu.filterItems.promptHistory.clearButton.label")})}),e.jsxs(Te,{children:[e.jsxs(ke,{children:[e.jsx(Oe,{children:h("plugin-slash-command-menu:slashCommandMenu.filterItems.promptHistory.clearButton.dialog.title")}),e.jsx(Ee,{children:h("plugin-slash-command-menu:slashCommandMenu.filterItems.promptHistory.clearButton.dialog.description")})]}),e.jsxs(Ae,{children:[e.jsx(re,{variant:"outline",onClick:()=>s(!1),children:h("plugin-slash-command-menu:slashCommandMenu.filterItems.promptHistory.clearButton.dialog.actions.cancel")}),e.jsx(re,{variant:"destructive",onClick:n,children:h("plugin-slash-command-menu:slashCommandMenu.filterItems.promptHistory.clearButton.dialog.actions.confirm")})]})]})]})}function Pt({item:t,isHighlighted:s,onDelete:n}){const r=d.useRef(null);return e.jsx(k,{value:t.id,keywords:t.keywords,onSelect:()=>{g.getState().setIsOpen(!1),g.getState().queryBoxAction.insertTextAtCaret(t.prompt)},onKeyDown:o=>{var a;o.key===w.Key.Delete?n(t.id):o.ctrlKey&&o.key==="c"&&((a=r.current)==null||a.click())},children:e.jsxs("div",{className:"tw-flex tw-w-full tw-items-start tw-justify-between tw-gap-4",children:[e.jsx("div",{className:"",children:e.jsx("div",{className:"tw-line-clamp-3 tw-whitespace-pre-wrap",children:t.prompt.trim()})}),e.jsxs("div",{className:"tw-flex tw-flex-shrink-0 tw-items-center tw-gap-2 tw-text-xs tw-text-muted-foreground",children:[s&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{ref:r,content:t.prompt,iconProps:{className:"tw-size-3"},onClick:o=>{o.stopPropagation()}}),e.jsx("div",{className:"tw-text-muted-foreground tw-transition-colors hover:tw-text-foreground",onClick:o=>{o.stopPropagation(),n(t.id)},children:e.jsx($e,{})})]}),e.jsx("div",{children:Me(t.createdAt)})]})]})},t.id)}function It({searchValue:t,enabled:s}){const n=ze(t),r=ht({queryKey:N.infinite({searchTerm:t}).queryKey,queryFn:a=>N.infinite({searchTerm:t}).queryFn(a),initialData:()=>$.getQueryData(N.infinite({searchTerm:n??""}).queryKey),initialPageParam:0,getNextPageParam:(a,l)=>l.reduce((c,u)=>c+u.items.length,0)<a.total?l.length:void 0,enabled:s}),o=d.useMemo(()=>{var a;return(a=r.data)==null?void 0:a.pages.flatMap(l=>l.items.map(i=>({id:i.id,prompt:i.prompt,createdAt:new Date(i.createdAt).toISOString(),keywords:i.prompt.split(" ")})))},[r.data]);return{...r,items:o}}function qt(){const t=d.useRef(null),{isOpen:s,selectedValue:n}=y(),r=ce(y(u=>u.searchValue),200),{items:o,isFetching:a,hasNextPage:l,fetchNextPage:i}=It({searchValue:r,enabled:s});Tt({items:o});const c=d.useCallback(u=>{we().delete(u),$.invalidateQueries({queryKey:N.infinite._def})},[]);return d.useEffect(()=>{o&&n&&o.slice(-3).some(x=>x.id===n)&&l&&!a&&i()},[n,o,l,a,i]),d.useEffect(()=>{const u=new IntersectionObserver(x=>{var f;x.length>0&&((f=x[0])!=null&&f.isIntersecting)&&l&&!a&&i()},{threshold:.1}),p=t.current;return p&&u.observe(p),()=>{p&&u.unobserve(p)}},[l,a,i]),o==null||o.length===0?null:e.jsxs(fe,{heading:e.jsxs("div",{className:"tw-flex tw-items-center tw-gap-1 tw-text-muted-foreground",children:[e.jsx(de,{}),e.jsx("span",{children:"auto-saved prompts"}),e.jsx(Nt,{})]}),children:[o.map(u=>e.jsx(Pt,{item:u,isHighlighted:n===u.id,onDelete:c},u.id)),e.jsx("div",{ref:t,className:"tw-h-1"})]})}function Tt({items:t}){const{selectedValue:s,setSelectedValue:n}=y();d.useEffect(()=>{var o;(t==null?void 0:t.findIndex(a=>a.id===s))===-1&&n(((o=t==null?void 0:t[0])==null?void 0:o.id)??"")},[t,s,n])}function kt(){const{store:t}=O();if(!["main","main-modal"].includes(t.type))return null;const s=h("plugin-slash-command-menu:slashCommandMenu.actionItems.changeFocusMode.label");return e.jsx(k,{value:"f",keywords:s.split(" "),className:"tw-min-h-10",onSelect:()=>{g.getState().queryBoxAction.deleteTriggerWord(),g.getState().setIsOpen(!1),setTimeout(()=>{C(`[data-testid=${T.QUERY_BOX.FOCUS_SELECTOR}] button:last`).trigger("click")},0)},children:e.jsx("div",{className:"tw-flex tw-items-center tw-gap-2",children:e.jsxs("div",{className:"tw-flex tw-items-center tw-gap-2",children:[e.jsx(Xe,{className:"tw-size-4"}),e.jsx("div",{children:s})]})})})}function Ot(){const t=h("plugin-slash-command-menu:slashCommandMenu.actionItems.changeModel.label");return e.jsx(m,{allowedAccountTypes:["pro","enterprise"],children:e.jsx(k,{value:"m",keywords:t.split(" "),className:"tw-min-h-10",onSelect:()=>{g.getState().queryBoxAction.deleteTriggerWord(),g.getState().setIsOpen(!1),setTimeout(()=>{C(`[data-testid=${T.QUERY_BOX.LANGUAGE_MODEL_SELECTOR}] button:last`).trigger("click")},0)},children:e.jsx("div",{className:"tw-flex tw-items-center tw-gap-2",children:e.jsxs("div",{className:"tw-flex tw-items-center tw-gap-2",children:[e.jsx(R,{className:"tw-size-4"}),e.jsx("div",{children:t})]})})})})}function Et(){const t=h("plugin-slash-command-menu:slashCommandMenu.actionItems.searchSpaces.label");return e.jsx(k,{value:"s",keywords:t.split(" "),className:"tw-min-h-10",onSelect:()=>{g.getState().queryBoxAction.deleteTriggerWord(),g.getState().setIsOpen(!1),ae.getState().setOpen(!0),ae.getState().setFilter("spaces")},children:e.jsx("div",{className:"tw-flex tw-items-center tw-gap-2",children:e.jsxs("div",{className:"tw-flex tw-items-center tw-gap-2",children:[e.jsx(ge,{className:"tw-size-4"}),e.jsx("div",{children:t})]})})})}function At(){return e.jsxs(e.Fragment,{children:[e.jsx(m,{allowedAccountTypes:["free","pro"],dependentPluginIds:["queryBox:focusSelector"],children:e.jsx(kt,{})}),e.jsx(m,{allowedAccountTypes:["pro","enterprise"],dependentPluginIds:["queryBox:languageModelSelector"],children:e.jsx(Ot,{})}),e.jsx(m,{dependentPluginIds:["commandMenu"],children:e.jsx(Et,{})})]})}function Rt(){const{setFilter:t}=y(),s=h("plugin-slash-command-menu:slashCommandMenu.filterItems.promptHistory.label"),n=h("plugin-slash-command-menu:slashCommandMenu.filterItems.promptHistory.description");return e.jsxs(k,{value:"h",keywords:s.split(" "),className:"tw-min-h-10",onSelect:()=>{t("promptHistory"),g.getState().queryBoxAction.clearSearchValue()},children:[e.jsxs("div",{className:"tw-flex tw-items-center tw-gap-2",children:[e.jsxs("div",{className:"tw-flex tw-items-center tw-gap-2",children:[e.jsx(de,{className:"tw-size-4"}),e.jsx("div",{children:s})]}),n&&e.jsxs("div",{className:"tw-text-muted-foreground",children:["(",n,")"]})]}),e.jsx(st,{children:"/h"})]})}function Ft(){return e.jsx(Rt,{})}function Ht({queryBoxAnchor:t,commandRef:s,setIsOpen:n}){const r=C(t??{}).find("textarea"),o=d.useCallback(a=>{var c;const l=a.relatedTarget;l&&((c=s.current)!=null&&c.contains(l)||s.current===l||l===r[0])||n(!1)},[r,s,n]);d.useEffect(()=>{if(r.length)return r.on("blur",o),()=>{r.off("blur",o)}},[r,o])}function Qt({queryBoxAnchor:t,commandInputRef:s,isOpen:n}){const r=C(t??{}).find("textarea"),o=d.useCallback(a=>{var u;if(!n)return;const l=[w.Key.ArrowUp,w.Key.ArrowDown,w.Key.Enter,w.Key.Delete].includes(a.key),i=a.ctrlKey||a.metaKey,c=["c"].includes(a.key);!l&&!(i&&c)||(a.preventDefault(),a.stopPropagation(),(u=s.current)==null||u.dispatchEvent(new KeyboardEvent("keydown",a)))},[s,n]);d.useEffect(()=>{if(r.length)return r.on("keydown",o),()=>{r.off("keydown",o)}},[r,o])}function Lt({queryBoxAnchor:t,isOpen:s,setIsOpen:n,setSearchValue:r}){const o=C(t??{}).find("textarea"),a=y(i=>i.setSearchValueBoundary);d.useEffect(()=>{s||a({ignoreLeftCount:null,ignoreRightCount:null})},[s,a]);const l=d.useCallback(i=>{setTimeout(()=>{if(s){if(i.key===w.Key.Escape){n(!1);return}const c=y.getState().searchValueBoundary,u=!(c.ignoreLeftCount==null||c.ignoreRightCount==null)&&(o[0].selectionStart<c.ignoreLeftCount||o[0].selectionStart>o[0].value.length-c.ignoreRightCount);if(c.ignoreLeftCount==null||c.ignoreRightCount==null||u)return n(!1);const p=o[0].value.slice(c.ignoreLeftCount-1,o[0].value.length-c.ignoreRightCount);if(!p.startsWith("/"))return n(!1);r(p.slice(1))}else{const{word:c}=j.getWordOnCaret(o[0]),u=i.key==="/"&&c==="/",p=i.key===w.Key.Backspace&&c==="/";if(!u&&!p)return;n(!0),g.setState(x=>{x.searchValueBoundary.ignoreLeftCount=o[0].selectionStart;const f=o[0].value.slice(x.searchValueBoundary.ignoreLeftCount-1).search(/\s/);let v;if(f===-1)v=0;else{const b=f+x.searchValueBoundary.ignoreLeftCount;b===o[0].value.length-1?v=0:v=o[0].value.length-b+1}x.searchValueBoundary.ignoreRightCount=v})}},10)},[o,s,n,r]);d.useEffect(()=>{if(o.length)return o.on("keydown",l),()=>{o.off("keydown",l)}},[o,l])}function zt({queryBoxAnchor:t,commandRef:s,commandInputRef:n}){const{isOpen:r,setIsOpen:o,setSearchValue:a}=y();Ht({queryBoxAnchor:t,commandRef:s,setIsOpen:o}),Qt({queryBoxAnchor:t,commandInputRef:n,isOpen:r}),Lt({queryBoxAnchor:t,isOpen:r,setIsOpen:o,setSearchValue:a})}function D({anchor:t}){const{store:s}=O(),n=s.type==="main",r=j.getActiveQueryBox()[0]===t,{isOpen:o}=y(),a=d.useRef(null),l=d.useRef(null);zt({queryBoxAnchor:t,commandRef:a,commandInputRef:l});const i=Kt({anchor:t});return!t||!document.contains(t)||!r?null:(n&&C(t).find(">div").toggleClass("[&>div]:!tw-rounded-t-none",o),e.jsx(ct,{value:i,unmountOnExit:!0,lazyMount:!0,children:e.jsx(Vt,{commandRef:a,commandInputRef:l,anchor:t})}))}const Dt=["promptHistory"],Kt=({anchor:t})=>{const{store:s}=O(),n=s.type==="main",r=s.type==="space",{isOpen:o}=y();return ut({open:o,positioning:{placement:r?"bottom-start":"top-start",gutter:n?1:5,flip:!!r,getAnchorRect:()=>(t==null?void 0:t.getBoundingClientRect())??null},portalled:!1,autoFocus:!1,modal:!1})},Vt=({commandRef:t,commandInputRef:s,anchor:n})=>{const{store:r}=O(),{selectedValue:o,setSelectedValue:a,searchValue:l,filter:i}=y(),c=!(i!=null&&Dt.includes(i));return e.jsx(dt,{ref:t,className:U("tw-overflow-y-auto tw-border-border tw-p-0 tw-font-medium tw-shadow-none",{"tw-rounded-b-none tw-border-2 tw-border-b-0":r.type==="main"}),portal:!1,style:{width:n.clientWidth},children:e.jsxs(rt,{filter:(u,p,x)=>{const v=i==null&&p.length<=1?u:u+((x==null?void 0:x.join(""))??"").replace(/\s+/g,"").toLowerCase(),b=p.replace(/\s+/g,"").toLowerCase();return v.includes(b)?1:0},shouldFilter:c,value:o,className:U("tw-bg-background dark:tw-bg-secondary",{"tw-rounded-b-none":r.type==="main"}),onValueChange:a,children:[e.jsx(at,{ref:s,value:l,className:"tw-hidden",onKeyDown:u=>{var x;if(u.key===w.Key.Enter)return;const p=(x=t.current)==null?void 0:x.querySelectorAll("[cmdk-item]");p==null||p.forEach(f=>{f.getAttribute("aria-selected")==="true"&&f.dispatchEvent(new KeyboardEvent("keydown",u))})}}),e.jsxs(lt,{className:"tw-max-h-[200px]",children:[e.jsx(it,{children:"No results found"}),i===null&&e.jsxs(fe,{children:[e.jsx(Ft,{}),e.jsx(At,{})]}),i==="promptHistory"&&e.jsx(qt,{})]})]})})};function K(t){if(!t)return null;const s=C(t).find("textarea").parent().next();return s.length?s[0]:null}function Ut(){const t=q(n=>n.queryBoxes.followUpQueryBox),s=K(t);return e.jsx(Q,{storeValue:{type:"follow-up"},children:e.jsxs(A,{container:s,children:[e.jsxs("div",{className:"tw-flex tw-flex-wrap tw-items-center md:tw-flex-nowrap",children:[e.jsx(m,{desktopOnly:!0,allowedAccountTypes:["free","pro"],dependentPluginIds:["queryBox:focusSelector:webRecency"],children:e.jsx(jt,{})}),e.jsx(m,{desktopOnly:!0,dependentPluginIds:["queryBox:slashCommandMenu:promptHistory"],additionalCheck:({settings:n})=>n==null?void 0:n.plugins["queryBox:slashCommandMenu:promptHistory"].showTriggerButton,children:e.jsx(z,{})}),e.jsx(m,{allowedAccountTypes:["pro","enterprise"],dependentPluginIds:["queryBox:languageModelSelector"],additionalCheck:({settings:n})=>n==null?void 0:n.plugins["queryBox:languageModelSelector"].followUp,children:e.jsx(L,{})})]}),e.jsx(m,{desktopOnly:!0,dependentPluginIds:["queryBox:slashCommandMenu:promptHistory"],children:e.jsx(D,{anchor:t})})]})})}function Wt(){return e.jsx(X,{className:"tw-max-h-[45dvh]",children:P.map(t=>e.jsxs(B,{item:t.code,className:"tw-flex tw-flex-col tw-items-start tw-gap-1 tw-font-medium tw-text-foreground",children:[e.jsxs("div",{className:"tw-flex tw-items-center tw-gap-2",children:[e.jsx(t.Icon,{className:"tw-size-4"}),e.jsx("div",{children:t.label})]}),e.jsx("div",{className:"tw-text-xs tw-text-muted-foreground",children:t.description})]},t.code))})}function _t({...t}){return e.jsx(F,{lazyMount:!0,unmountOnExit:!0,...t,children:e.jsx(H,{side:"bottom",className:"tw-flex tw-flex-col tw-gap-2",children:P.map(s=>e.jsxs(B,{item:s.code,className:"tw-flex tw-flex-col tw-items-start tw-gap-2 tw-py-3 tw-font-medium tw-text-foreground",children:[e.jsxs("div",{className:"tw-flex tw-items-center tw-gap-3",children:[e.jsx(s.Icon,{className:"tw-size-5"}),e.jsx("div",{children:s.label})]}),e.jsx("div",{className:"tw-text-sm tw-text-muted-foreground",children:s.description})]},s.code))})})}const Gt="[cplx-main-query-box] span button:has(svg[data-icon=bars-filter]),[cplx-main-query-box] span button:has(svg[data-icon=chevron-down]),[cplx-main-modal-query-box] span button:has(svg[data-icon=bars-filter]),[cplx-main-modal-query-box] span button:has(svg[data-icon=chevron-down]){display:none}[cplx-main-query-box] button svg[data-icon=circle-plus]+div,[cplx-main-modal-query-box] button svg[data-icon=circle-plus]+div{display:none}";function be(){W({id:"hide-native-focus-selector",css:Gt});const{isMobile:t}=G(),{selectedFocusMode:s,setSelectedFocusMode:n}=I(o=>({selectedFocusMode:o.selectedFocusMode,setSelectedFocusMode:o.setSelectedFocusMode})),r=P.find(o=>o.code===s)??P[0];return d.useEffect(()=>{ue("reactVdom:setFocusMode",{focusMode:s},"window")},[s]),e.jsxs(Y,{lazyMount:!0,unmountOnExit:!0,portal:!1,collection:J({items:P,itemToString:o=>o.label,itemToValue:o=>o.code}),value:[s],className:"tw-h-full","data-testid":T.QUERY_BOX.FOCUS_SELECTOR,onValueChange:({value:o})=>{n(o[0]),setTimeout(()=>{j.getActiveQueryBoxTextarea().trigger("focus")},100)},onKeyDown:o=>{o.key===w.Key.Escape&&(o.preventDefault(),o.stopPropagation(),setTimeout(()=>{j.getActiveQueryBoxTextarea().trigger("focus")},100))},children:[e.jsx(M,{content:h("plugin-focus-selector:focusSelector.tooltip",{mode:r.label}),children:e.jsx(Z,{variant:"ghost",className:"tw-h-full tw-w-fit tw-px-2",children:e.jsx(ee,{children:e.jsx("div",{className:"tw-flex tw-items-center tw-gap-2",children:e.jsx(r.Icon,{className:"tw-size-4"})})})})}),e.jsx(te,{children:({open:o,setOpen:a})=>t?e.jsx(_t,{open:o,onOpenChange:({open:l})=>a(l)}):e.jsx(Wt,{})})]})}function Ce(){const{selectedRecency:t,setSelectedRecency:s,selectedFocusMode:n}=I(o=>({selectedRecency:o.selectedRecency,setSelectedRecency:o.setSelectedRecency,selectedFocusMode:o.selectedFocusMode}));if(!le.includes(n))return null;const r=S.find(o=>o.value===t)??S[0];return e.jsx(je,{value:t,setValue:s,recencyData:r})}function $t({children:t}){const[s,n]=d.useState(!1);return e.jsxs(F,{lazyMount:!0,open:s,onOpenChange:({open:r})=>n(r),children:[e.jsx(M,{content:h("plugin-space-navigator:spaceNavigator.button.label"),children:e.jsx(Ye,{asChild:!0,children:t})}),e.jsx(H,{side:"bottom",className:"tw-p-0",children:e.jsx(mt,{setOpen:n})})]})}function Se(){var a,l;const{data:t}=ie(Pe.spaces),s=_(i=>i.url),n=xe(s).pathname.split("/").pop(),r=(a=t==null?void 0:t.find(i=>i.slug===n||i.uuid===n))==null?void 0:a.title;return((l=pt().find(i=>i.name==="pplx.is-incognito"))==null?void 0:l.value)==="true"?null:e.jsx($t,{children:e.jsxs("button",{className:"tw-flex tw-min-h-8 tw-w-max tw-cursor-pointer tw-items-center tw-justify-between tw-gap-1 tw-rounded-md tw-px-2 tw-text-center tw-text-sm tw-font-medium tw-text-muted-foreground tw-outline-none tw-transition-all tw-duration-150 placeholder:tw-text-muted-foreground hover:tw-bg-primary-foreground hover:tw-text-foreground focus-visible:tw-bg-primary-foreground focus-visible:tw-outline-none active:tw-scale-95 disabled:tw-cursor-not-allowed disabled:tw-opacity-50 [&>span]:!tw-truncate","data-testid":T.QUERY_BOX.SPACE_NAVIGATOR,children:[e.jsx(ge,{className:"tw-size-4"}),r&&e.jsx("div",{className:"tw-hidden md:tw-block",children:r})]})})}function Xt(){const t=q(n=>n.queryBoxes.mainQueryBox),s=K(t);return e.jsx(Q,{storeValue:{type:"main"},children:e.jsxs(A,{container:s,children:[e.jsxs("div",{className:"tw-flex tw-flex-wrap tw-items-center md:tw-flex-nowrap",children:[e.jsx(m,{allowedAccountTypes:["free","pro"],dependentPluginIds:["queryBox:focusSelector"],children:e.jsx(be,{})}),e.jsx(m,{allowedAccountTypes:["free","pro"],dependentPluginIds:["queryBox:focusSelector:webRecency"],children:e.jsx(Ce,{})}),e.jsx(m,{desktopOnly:!0,dependentPluginIds:["queryBox:slashCommandMenu:promptHistory"],additionalCheck:({settings:n})=>n==null?void 0:n.plugins["queryBox:slashCommandMenu:promptHistory"].showTriggerButton,children:e.jsx(z,{})}),e.jsx(m,{mobileOnly:!0,requiresLoggedIn:!0,dependentPluginIds:["queryBox:spaceNavigator"],children:e.jsx(Se,{})}),e.jsx(m,{allowedAccountTypes:["pro","enterprise"],dependentPluginIds:["queryBox:languageModelSelector"],additionalCheck:({settings:n})=>n==null?void 0:n.plugins["queryBox:languageModelSelector"].main,children:e.jsx(L,{})})]}),e.jsx(m,{desktopOnly:!0,dependentPluginIds:["queryBox:slashCommandMenu:promptHistory"],children:e.jsx(D,{anchor:t})})]})})}const Yt="[cplx-main-query-box] div:has(>textarea)+div,[cplx-space-query-box] div:has(>textarea)+div{grid-column-start:1!important;grid-column-end:3!important;display:flex;flex-wrap:wrap;row-gap:.25rem}[cplx-main-query-box] button:not([aria-label=Submit]):not([data-testid=copilot-toggle]).rounded-full,[cplx-space-query-box] button:not([aria-label=Submit]):not([data-testid=copilot-toggle]).rounded-full{border-radius:.375rem!important}";function Jt(){const t=q(n=>n.queryBoxes.mainModalQueryBox),s=K(t);return e.jsx(Q,{storeValue:{type:"main-modal"},children:e.jsxs(A,{container:s,children:[e.jsxs("div",{className:"tw-flex tw-flex-wrap tw-items-center md:tw-flex-nowrap",children:[e.jsx(m,{allowedAccountTypes:["free","pro"],dependentPluginIds:["queryBox:focusSelector"],children:e.jsx(be,{})}),e.jsx(m,{allowedAccountTypes:["free","pro"],dependentPluginIds:["queryBox:focusSelector:webRecency"],children:e.jsx(Ce,{})}),e.jsx(m,{desktopOnly:!0,dependentPluginIds:["queryBox:slashCommandMenu:promptHistory"],additionalCheck:({settings:n})=>n==null?void 0:n.plugins["queryBox:slashCommandMenu:promptHistory"].showTriggerButton,children:e.jsx(z,{})}),e.jsx(m,{allowedAccountTypes:["pro","enterprise"],dependentPluginIds:["queryBox:languageModelSelector"],additionalCheck:({settings:n})=>n==null?void 0:n.plugins["queryBox:languageModelSelector"].main,children:e.jsx(L,{})})]}),e.jsx(m,{desktopOnly:!0,dependentPluginIds:["queryBox:slashCommandMenu:promptHistory"],children:e.jsx(D,{anchor:t})})]})})}function Zt(){const t=q(n=>n.queryBoxes.spaceQueryBox),s=K(t);return e.jsx(Q,{storeValue:{type:"space"},children:e.jsxs(A,{container:s,children:[e.jsxs("div",{className:"tw-flex tw-flex-wrap tw-items-center md:tw-flex-nowrap",children:[e.jsx(m,{desktopOnly:!0,dependentPluginIds:["queryBox:slashCommandMenu:promptHistory"],additionalCheck:({settings:n})=>n==null?void 0:n.plugins["queryBox:slashCommandMenu:promptHistory"].showTriggerButton,children:e.jsx(z,{})}),e.jsx(m,{mobileOnly:!0,requiresLoggedIn:!0,dependentPluginIds:["queryBox:spaceNavigator"],children:e.jsx(Se,{})}),e.jsx(m,{allowedAccountTypes:["pro","enterprise"],dependentPluginIds:["queryBox:languageModelSelector"],additionalCheck:({settings:n})=>n==null?void 0:n.plugins["queryBox:languageModelSelector"].main,children:e.jsx(L,{})})]}),e.jsx(m,{desktopOnly:!0,dependentPluginIds:["queryBox:slashCommandMenu:promptHistory"],children:e.jsx(D,{anchor:t})})]})})}function Jo(){return eo(),e.jsxs(e.Fragment,{children:[e.jsx(Xt,{}),e.jsx(Jt,{}),e.jsx(Zt,{}),e.jsx(Ut,{})]})}function eo(){const t=Je(_().url),{pluginsEnableStates:s}=Ze.getCachedSync(),n=We.getCachedSync(),r=(n==null?void 0:n.plugins["queryBox:languageModelSelector"].main)&&((s==null?void 0:s["queryBox:languageModelSelector"])||(s==null?void 0:s["queryBox:spaceNavigator"])||(s==null?void 0:s["queryBox:slashCommandMenu:promptHistory"])&&(n==null?void 0:n.plugins["queryBox:slashCommandMenu:promptHistory"].showTriggerButton)),o=t==="thread"&&(n==null?void 0:n.plugins["queryBox:languageModelSelector"].followUp)&&((s==null?void 0:s["queryBox:languageModelSelector"])||(s==null?void 0:s["queryBox:slashCommandMenu:promptHistory"])&&(n==null?void 0:n.plugins["queryBox:slashCommandMenu:promptHistory"].showTriggerButton));W({id:"cplx-main-query-box",css:Yt,inject:r}),W({id:"cplx-follow-up-query-box",css:ft,inject:o})}export{Jo as default};
