(()=>{"use strict";var t,e,s={6304:(t,e,s)=>{s.d(e,{W:()=>r});let r=s(4323).lQ},9830:(t,e,s)=>{s.d(e,{J:()=>i,W:()=>a});var r=s(910);const i=new r.F("sync",(()=>({}))),a=new r.F("version",(()=>0))},7880:(t,e,s)=>{s.d(e,{h:()=>r});const r={state:"none",message:(0,s(4590).tr)("login_login_create"),details:"With account you will be able to synchronize your dials between devices and your dials will be securely backed-up."}},4352:(t,e,s)=>{s.d(e,{L:()=>n});var r=s(4323),i=s(6801),a=s(6062);function n(...t){new Set(t.length?t:[void 0]).forEach(o)}async function o(t){const e={type:"data_changed",groupId:t};(0,i._z)(a.Dy?e:{type:"broadcast",message:e}).catch(r.lQ)}},6663:(t,e,s)=>{var r;s.d(e,{P:()=>r}),(t=>{t[t.default=0]="default",t[t.background=1]="background",t[t.visit=2]="visit",t[t.hiddenVisit=3]="hiddenVisit"})(r||(r={}))},4162:(t,e,s)=>{var r,i,a,n,o;s.d(e,{G_:()=>r}),(t=>{t[t.Home=0]="Home",t[t.Pro=1]="Pro",t[t.Enterprise=2]="Enterprise"})(r||(r={})),(t=>{t[t.gift=0]="gift",t[t.kofi=1]="kofi"})(i||(i={})),(t=>{t[t.Pro=1]="Pro",t[t.Enterprise=2]="Enterprise",t[t.Family=3]="Family"})(a||(a={})),(t=>{t[t.OneYear=12]="OneYear",t[t.ThreeYears=36]="ThreeYears",t[t.TenYears=120]="TenYears"})(n||(n={})),(t=>{t[t.Placebo=0]="Placebo",t[t.Pro=1]="Pro",t[t.Enterprise=2]="Enterprise",t[t.Gold=3]="Gold",t[t.Platinum=4]="Platinum",t[t.Diamond=5]="Diamond",t[t.Family_3=6]="Family_3",t[t.Enterprise_5=7]="Enterprise_5",t[t.Enterprise_10=8]="Enterprise_10",t[t.Enterprise_20=9]="Enterprise_20"})(o||(o={}))},4559:(t,e,s)=>{s.d(e,{B:()=>i,O1:()=>a,uT:()=>n});var r=s(1962);const i=()=>(0,r.$H)("dials-container"),a=()=>(0,r.$H)("groups"),n=()=>(0,r.$H)("dials")},3143:(t,e,s)=>{s.d(e,{i:()=>a});var r=s(6683),i=s(1484);function a(t,e){const s=[];let a=!1,n=0;for(const o of e){const e=o.size||0;if(e!==r.ZU.NORMAL){if(0===n){if(a)return s;n=(0,i.Q)(e)-1,s.length=0}else n--;s.push(o),o.domId===t.domId&&(a=!0)}else{if(a)return s;s.length=0,n=0}}return s}},1038:(t,e,s)=>{s.d(e,{f:()=>d});var r=s(1374),i=s(6683),a=s(5524),n=s(1484),o=s(9719),c=s(7526),l=s(3143);function d(t,e,s,d){const u=e.map((t=>t.clone())),h=u.find((t=>t.domId===s.domId)),g=h.size||0,p=(0,n.Q)(d),m=(0,n.Q)(g),w=Math.abs(p-m);if(g!==d){if(g===i.ZU.NORMAL);else{const t=(0,l.i)(h,u);if(t.length<m)return(0,a.vV)("bad cluster size");if(p>=m);else{if(t.filter((t=>t.isEmptyDial())).length<w)return;for(let e=u.length-1,s=0;e>=0;e--){const r=u[e];if(r.isEmptyDial()&&t.some((t=>t.domId===r.domId))&&(u.splice(e,1),++s>=w))break}}t.forEach((t=>t.size=d))}if(p>m){const e=Array(w).fill(0).map(((e,s)=>new o.I((0,c.V)(),t,{size:d}))),s=(0,r.SL)(u,(t=>t.domId===h.domId));s>=0&&u.splice(s+1,0,...e)}return h.size=d,u}}},1484:(t,e,s)=>{s.d(e,{M:()=>a,Q:()=>i});var r=s(6683);const i=t=>Math.imul(...a(t));function a(t){switch(t){case r.ZU.V_HALF:return[2,1];case r.ZU.H_HALF:return[1,2];case r.ZU.V_THIRD:return[3,1];case r.ZU.H_THIRD:return[1,3];case r.ZU.V_FOURTH:return[4,1];case r.ZU.H_FOURTH:return[1,4];default:return[t+1,t+1]}}},841:(t,e,s)=>{s.d(e,{v:()=>r});const r={width:300,height:225,androidWidth:240,androidHeight:195,listWidth:300,androidListWidth:228}},9:(t,e,s)=>{s.d(e,{Ks:()=>c,QY:()=>l});var r=s(4424),i=s(1374),a=s(4323),n=s(9719),o=s(5717);function c(t,e){const{rows:s,cols:r,dials:a,dynamic:c,list:l,grid:d}=t,u=s+("row"===e?1:0),h=r+("column"===e?1:0),g=function(t,e,s,r,a,c,l,d,u){let h=o.M6.dialsToClusters(e);if(a||c||l)h=h.filter((t=>!t.isEmptyDial())).concat(new o.uP(n.I.createEmptyDial(t)));else{const e=d*u-h.length;if(e>0){const s=Array(e).fill(0).map((()=>new o.uP(n.I.createEmptyDial(t))));h.push(...s)}const a=s-d,c=r-u;if(a>=0&&c>0)for(let e=d;e>0;e--)for(let s=0;s<c;s++)h.splice(e*u,0,new o.uP(n.I.createEmptyDial(t)));if(a<=0||c<0)for(let t=d;t>0;t--)for(let e=0;e<-c;e++){const s=t*u-1-e;h[s].isEmptyDial()&&h.splice(s,1)}h.reverse(),h.length>s*r&&Array(h.length-s*r).fill(0).forEach((()=>(0,i.M$)(h,(t=>t.isEmptyDial())))),h.reverse();for(let e=h.length;e<s*r;e++)h.push(new o.uP(n.I.createEmptyDial(t)))}return o.M6.clustersToDials(h)}(t.id,a,u,h,c,l,d,s,r);return Object.assign(t,{rows:u,cols:h,dials:g})}function l(t,e,s){const n=o.M6.dialsToClusters(e.dials),c=(0,i.SL)(n,(t=>t.includes(s)));c<0&&(0,a.qb)("dial not found");const l="row"===t?r.q:r.W,d=l(c,e.cols);return n.filter(((t,s)=>d===l(s,e.cols)))}},5904:(t,e,s)=>{s.d(e,{x:()=>n});var r=s(5953),i=s(9887),a=s(2441);class n{areas;height;width;constructor(t){this.areas=t,this.height=this.areas.length,this.width=this.areas.at(0)?.length||0}getCoordinates(t){let e=-1,s=-1;const i=this.areas.findIndex((r=>{if(e=r.indexOf(t),-1!==e)return s=r.lastIndexOf(t),!0}));if(-1===i)return;const a=this.areas.findLastIndex((s=>s.includes(t,e)));return new r.$(e,i,s,a)}getConflictsInRange(t,{left:e,top:s,right:r,bottom:i},a){const n=new Map;for(let o=s;o<=i;o++){const s=this.areas[o];if(!s)return a?n:void 0;for(let i=e;i<=r;i++){const e=s[i];if(void 0===e&&!a)return;if(e&&e!==t){const t=n.get(e);t?t.push({x:i,y:o}):n.set(e,[{x:i,y:o}])}}}return n}hasConflictsInRange(t,{left:e,top:s,right:r,bottom:i}){if(e<0||s<0||r>=this.width||i>=this.height)return!0;for(let a=s;a<=i;a++){const s=this.areas[a];for(let i=e;i<=r;i++){const e=s[i];if(e&&e!==t)return!0}}return!1}replaceCells({left:t,top:e,right:s,bottom:r},i){for(let a=e;a<=r;a++){const e=this.areas[a];for(let r=t;r<=s;r++)e[r]=i}return this}removeItems(t){for(let e=0;e<this.height;e++){const s=this.areas[e];for(let e=0;e<this.width;e++)t.has(s[e])&&(s[e]=0)}return this}insertItems(t,e,s){const r=this.clone(),i=t[Symbol.iterator]();for(let t=0;t<r.height;t++)for(let a=0;a<r.width;a++){const n=a+e-1,o=t+s-1;if(n>=r.width||o>=r.height||r.hasConflictsInRange(-1,{left:a,right:n,top:t,bottom:o}))continue;const{done:c,value:l}=i.next();if(c)return r;r.replaceCells({left:a,right:n,top:t,bottom:o},l)}if(i.next().done)return r}resize(t,e){const s=this.height+e,r=this.width+t,a=t>0?[]:this.getConflictsInRange(-1,{left:this.width+t,top:0,right:this.width-1,bottom:this.height-1},!0),o=e>0?[]:this.getConflictsInRange(-1,{left:0,top:this.height+e,right:this.width+t-1,bottom:this.height-1},!0),c=Array.from(new Map([...a,...o]),(([s,r])=>new i.o(s,this,r,t,e))).sort(i.o.getSortBySizeAndDistance(Math.floor(s/2),Math.floor(r/2))),l=this.clone();c.forEach((t=>l.replaceCells(t.coordinates,0)));return{grid:new n(Array.from({length:s},((t,e)=>{const s=l.areas[e]||[];return[...s,...Array.from({length:r-s.length},(()=>0))].slice(0,r)}))),conflicts:c}}getCommonDimension(){const t=new a._;for(let e=0;e<this.height;e++){const s=this.areas[e];for(let r=0;r<this.width;r++){const i=s[r];i&&t.push(i,{x:r,y:e})}}const e=Array.from(t,(([t,e])=>{const{x:s,y:r}=e[0],{x:i,y:a}=e.at(-1);return{width:i-s+1,height:a-r+1}})),s=new a._;return e.forEach((t=>s.push(`${t.width}x${t.height}`,t))),Array.from(s.values()).sort(((t,e)=>e.length-t.length)).at(0)?.at(0)}replaceItem(t,e){return t!==e&&this.areas.some((e=>e.includes(t)))?this.areas.map((s=>s.map((s=>s===t?e:s===e?0:s)))):this.areas}swapItems(t,e){return this.areas.map((s=>s.map((s=>s===t?e:s===e?t:s))))}getMaximumNewItemSize(t){const e=this.height*this.width,s=Math.floor(Math.min(4,this.height/2,this.width/2,Math.sqrt(e/t)))||1;return{width:s,height:Math.min(3,s)}}clone(){return new n(this.areas.map((t=>t.slice())))}getItems(){const t=new Set(this.areas.flat());return t.delete(0),t}}},9887:(t,e,s)=>{s.d(e,{o:()=>r});class r{item;grid;overlaps;offsetX;offsetY;coordinates;itemSize;evadingVector;constructor(t,e,s,r,i){this.item=t,this.grid=e,this.overlaps=s,this.offsetX=r,this.offsetY=i,this.coordinates=this.grid.getCoordinates(this.item),this.itemSize=this.coordinates.width*this.coordinates.height,this.evadingVector=this.computeEvadingVector()}computeEvadingVector(){const{left:t,top:e,right:s,bottom:r,width:i,height:a}=this.coordinates,{offsetX:n,offsetY:o}=this;let c=0,l=0;for(let n=e;n<=r;n++)for(let r=t;r<=s;r++)if(this.overlaps.some((t=>t.x===r&&t.y===n))){const s=i/2,o=a/2;r+1>t+s&&c--,r<t+s&&c++,n+1>e+o&&l--,n<e+o&&l++}return c||l?{x:c,y:l}:{x:n,y:o}}*moveToEmptySpace(t){const e=Math.max(t.width,t.height),{x:s,y:r}=this.evadingVector,i=function*(t){const[e,s]=t.map((t=>Math.sign(t)));for(let t=1;t<1e3;t++){const r=2*t+1,i=Math.floor(r/2),a=[],n=[],o=[],c=[];for(let e=0;e<r;e++){const s=e-i;for(let e=0;e<r;e++){const r=e-i;Math.abs(s)+Math.abs(r)===t&&(s&&r?s>0&&r>0?a.push([s,r]):s<0&&r<0?n.push([s,r]):o.push([s,r]):c.push([s,r]))}}for(const t of[a,o,n,c]){t.sort((([t,e],[s,r])=>t!==s?s-t:r-e));for(const r of t){const[t,i]=r;e&&s?yield[t*e,i*s]:s&&!e?yield[i,t*s]:e&&!s?yield[i*e,t]:yield r}}}}([s,r]);for(const[s,r]of i){if(s>e)break;const i=this.coordinates.offset(s,r);t.hasConflictsInRange(this.item,i)||(yield t.clone().replaceCells(i,this.item))}}static getSortBySizeAndDistance(t,e){return(s,r)=>{const i=r.itemSize-s.itemSize;if(i)return i;const[a,n]=[s,r].map((s=>Math.abs(s.coordinates.top-t)+Math.abs(s.coordinates.left-e)));return a-n}}}},6664:(t,e,s)=>{s.d(e,{J:()=>f});var r=s(5904),i=s(5953),a=s(9100),n=s(9887);class o{item;grid;coordinates;constructor(t,e){this.item=t,this.grid=e,this.coordinates=this.grid.getCoordinates(this.item)}offset(t,e,s){const{left:r,top:o,right:c,bottom:l,width:d,height:u}=this.coordinates,h="move"===s,g=h?(0,a.n)(0,this.grid.width-d,r+t):r,p=h?(0,a.n)(0,this.grid.height-u,o+e):o,m=h?g+d-1:(0,a.n)(r,this.grid.width-1,c+t),w=h?p+u-1:(0,a.n)(o,this.grid.height-1,l+e);if(m===c&&w===l&&g===r&&p===o)return;const f=this.grid.getConflictsInRange(this.item,new i.$(g,p,m,w));if(!f)return;const y=Array.from(f,(([s,r])=>new n.o(s,this.grid,r,t,e))).sort(n.o.getSortBySizeAndDistance(o,r));return{coordinates:new i.$(g,p,m,w),conflicts:y}}}var c=s(1282);class l{grid;clone(){return new l(this.grid.areas)}get areas(){return this.grid.areas}get width(){return this.grid.width}get height(){return this.grid.height}constructor(t){this.grid=new r.x(t)}move(t,e,s,r="move"){if(0===e&&0===s)return this.grid;const i=new o(t,this.grid);if(!i.coordinates)return;const a=i.offset(e,s,r);if(!a)return this.grid;const n=this.grid.clone();n.replaceCells(i.coordinates,0),a.conflicts.forEach((t=>n.replaceCells(t.coordinates,0))),n.replaceCells(a.coordinates,i.item);try{return this.resolveConflicts(n,a.conflicts)||this.resolveConflicts(n,a.conflicts.toReversed())}catch(t){}}placeItem(t,e,s){const r=this.grid.clone(),{width:i,height:a}=r.getCommonDimension()||r.getMaximumNewItemSize(1);for(let n=i,o=a;n>0;n--,o=Math.max(1,o-1)){const i={left:e,top:s,right:e+n-1,bottom:s+o-1};if(!r.hasConflictsInRange(-1,i))return{grid:r.replaceCells(i,t),itemWidth:n,itemHeight:o}}}resizeGrid(t,e){const{width:s,height:r}=this.grid;if(t===s&&e===r)return this;const{grid:i,conflicts:a}=this.grid.resize(t-s,e-r),n=this.resolveConflicts(i,a);return n?(this.grid=n,this):void 0}resolveConflicts(t,e,s=performance.now()+200){if(performance.now()>s)throw Error("grid_timeout");const[r,...i]=e;if(!r)return t;const a=r.moveToEmptySpace(t);for(const t of a){const e=this.resolveConflicts(t,i,s);if(e)return e}}updateGrid(t){const e=this.grid.getCommonDimension();if(!e){const e=l.fromItems(t,this.width,this.height);return e?(this.grid=e,this):void 0}const s=new Set(t),r=this.grid.getItems(),i=(0,c.tX)(r,s),a=(0,c.tX)(s,r),n=this.grid.clone();n.removeItems(i);const o=n.insertItems(a,e.width,e.height);if(o)return this.grid=o,this}static fromItems(t,e,s){const i=Array.from({length:s},(()=>Array.from({length:e},(()=>0)))),a=new r.x(i),{width:n}=a.getMaximumNewItemSize(t.length);for(const[e,s]of[[4,3],[3,3],[3,2],[2,2],[1,1]]){if(e>n)continue;const r=a.insertItems(t,e,s);if(r)return r}}}var d=s(3694),u=s(1361),h=s(4559),g=s(2780),p=s(4323),m=s(1470),w=s(2846);class f{gridData;groupId;dialsNode;handlers;_currentAreas;get rows(){return this._currentAreas.length}get cols(){return this._currentAreas[0].length||0}constructor(t,e,s=(0,h.uT)()){this.gridData=t,this.groupId=e,this.dialsNode=s,this.handlers=new u.G,this.applyGridLayout(t),this._currentAreas=t.areas}static create(t){if(!t.grid)throw new Error("Not a grid!");return new f(t.grid,t.id)}applyGridLayout(t){this._currentAreas=t.areas,this.previewGridLayout(t)}previewGridLayout(t){const e=t.areas.flatMap((t=>`"${t.map((t=>t?`d${t}`:".")).join(" ")}"`)).join("\n");this.dialsNode.style.setProperty("--grid-template-areas",e),this.dialsNode.style.setProperty("--grid-rows",`${this.rows}`),this.dialsNode.style.setProperty("--grid-cols",`${this.cols}`)}placeItem(t,{x:e,y:s}){const r=new l(this._currentAreas),i=this.dialsNode.getBoundingClientRect();e-=i.left,s-=i.top;const a=i.width/r.width,n=i.height/r.height,o=Math.floor(e/a),c=Math.floor(s/n),d=[[-1,-1],[-2,-2],[-1,-2],[-2,-1],[0,-2],[-2,0],[-1,0],[0,-1],[0,0]].map((([e,s])=>{const i=r.placeItem(t.areaNumber,o+e,c+s);return i&&{grid:i.grid,priority:(i.grid.hasConflictsInRange(-1,{left:o,right:o,top:c,bottom:c})?1e3:0)+i.itemWidth*i.itemHeight}})).filter(p.zz).sort(((t,e)=>e.priority-t.priority)).at(0);if(d)return this.previewGridLayout(d.grid),{areas:d.grid.areas}}static normalizeGrid(t,e,s,r){e=e.slice(0,-1),this.makeDialsUnique(e);const i=e.map((t=>t.created));if(0===t.areas.length){const e=l.fromItems(i,r||24,s||12);if(!e)throw new Error("Cannot create grid, dimensions are too small");return{...t,areas:e.areas}}const a=new l(t.areas);if(s&&r&&(s!==a.height||r!==a.width)){if(!a.resizeGrid(r,s))throw new Error("Cannot resize grid, dimensions are too small")}if(!a.updateGrid(i))throw new Error("Cannot update grid");return{...t,areas:a.grid.areas}}static makeDialsUnique(t){const e=new Set;for(const s of t){let t=s.created||(0,d.Sy)();for(;e.has(t);)t++;s.created=t,e.add(t)}}startDrag(t){t.dataTransfer.setDragImage(new Image,0,0);const e=new l(this.gridData.areas);let s=!1,r=!1;this.handlers.addListener((0,h.O1)(),"change",(t=>s=!0));const i=(0,h.B)();i.classList.remove("stopped_moving"),this.handlers.addListener(document.documentElement,"dragend",(async t=>{if(r=!0,this.handlers.clearAll(),s||"none"===t.dataTransfer?.dropEffect)return this.applyGridLayout(this.gridData),void i.classList.add("stopped_moving");this.gridData.areas=this._currentAreas,this.applyGridLayout(this.gridData),await w.M.action("updateGroup",{groupId:this.groupId,update:{grid:this.gridData}})}));const a={left:t.x,top:t.y},n=this.dialsNode.getBoundingClientRect(),o=n.width/e.width,c=n.height/e.height,d=t.currentTarget,u=parseInt(d.style.getPropertyValue("grid-area").slice(1));if(!u)throw Error("Cannot find grid item");const f=d.getBoundingClientRect(),y=parseFloat(window.getComputedStyle(document.documentElement).fontSize),v=t.x>f.right-y&&t.y>f.bottom-y,{scrollLeft:_,scrollTop:b}=i,I=new g.v("one_by_last_one");this.handlers.addListener(this.dialsNode,"dragover",(t=>{t.dataTransfer.dropEffect="move",I.addWork((async()=>{if(r||s)return;if(t.ctrlKey||t.shiftKey||t.altKey||t.metaKey)return s=!0,this.applyGridLayout(this.gridData),void i.classList.add("stopped_moving");const n={left:t.x+(i.scrollLeft-_),top:t.y+(i.scrollTop-b)},l=(0,m.FP)(n,a),d=e.move(u,Math.round(l.left/o),Math.round(l.top/c),v?"resize":"move");d&&this.applyGridLayout(d),await(0,p.BK)(50)}))}))}static showEmptyDial(t){(0,h.B)().classList.toggle("show_empty",t)}}},5953:(t,e,s)=>{s.d(e,{$:()=>r});class r{left;top;right;bottom;width;height;constructor(t,e,s,r,i=s-t+1,a=r-e+1){this.left=t,this.top=e,this.right=s,this.bottom=r,this.width=i,this.height=a}offset(t,e){return new r(this.left+t,this.top+e,this.right+t,this.bottom+e,this.width,this.height)}}},8654:(t,e,s)=>{s.d(e,{j:()=>i});var r=s(6795);Object.freeze(["up","right","down","left"]);const i=Object.freeze({up:{type:r.EM.HOME_GROUP},right:{type:r.EM.NEXT_GROUP},left:{type:r.EM.PREV_GROUP},down:{type:r.EM.NONE}})},3943:(t,e,s)=>{s.d(e,{z:()=>r});const r={dark:"",light:"white"}},2399:(t,e,s)=>{s.d(e,{D:()=>o});var r=s(6683),i=s(8794),a=s(2846),n=s(5048);async function o(t,e){const s=!!e&&e.type===r.kh.GROUP,o=(0,n._V)(t);await i.SR.update((e=>(a.M.GROUPS.forEach((r=>r.dials.filter((e=>e.url===o&&(!s||t>r.id))).forEach((t=>e.push([r.id,t.url]))))),e)))}},7139:(t,e,s)=>{s(9074),s(4323),s(1055)},5048:(t,e,s)=>{s.d(e,{$K:()=>a,b3:()=>n,O5:()=>o,hx:()=>c,l8:()=>i,_V:()=>d,m4:()=>l,Ty:()=>h,om:()=>u});s(4323);var r=s(5360);const i='a[id^="dial_"]',a=31,n=7,o=13,c="#00AAFF",l=t=>parseInt(t.slice(t.lastIndexOf("#")+1)),d=t=>"#"+t,u=t=>parseInt(t.slice(5));const h=(0,r.M)((function(t){if(!t)return"";const e=t.toLowerCase().replace(new RegExp(String.raw`^https?://(www.)?`),"");return e.endsWith("/")?e.slice(0,-1):e}))},2036:(t,e,s)=>{s.d(e,{Dg:()=>u,FJ:()=>p,KL:()=>d,Lf:()=>l});var r=s(8794),i=s(4323),a=s(7302),n=s(4162),o=(s(9074),s(9574)),c=s(6062);s(1962);const l=(0,a.Z)(""),d=(0,a.Z)("dial.html"),u=location.href.startsWith(d),h=t=>!!t&&t.license>n.G_.Home||!1,g=c.Dy?()=>r.P3.get():(0,o.m)((()=>r.P3.get())),p=()=>g().then(h);(0,i.Lt)(p)},8794:(t,e,s)=>{s.d(e,{L8:()=>g,P3:()=>l,SR:()=>p,T6:()=>u,_V:()=>h,fF:()=>c,ne:()=>d});var r=s(910),i=s(6683),a=s(4323),n=s(7880),o=s(2447);const c={type:"image/webp",quality:.5},l=(Object.freeze({type:i.O8.AUTO_GENERATED,value:0,position:i.X.FULL_WIDTH}),new r.F("user",(()=>null))),d=(new r.F("weather_data",(()=>({})),{storageArea:"local"}),new r.F("last_dial_background",a.s6,{storageArea:"localStorage",localStorageTextOnly:!0}),new r.F("defaultGroup",a.s6,{storageArea:"localStorage"})),u=new r.F("_device_pixel_ratio",(()=>1)),h=(new o.e("favicon",(()=>"128.png")),new r.F("_noNextOverride",(()=>!1)),new r.F("lastReloads",(()=>({}))),new r.F("add_current_tabs",(()=>[]),{storageArea:"session"}),new r.F("add_image_to_dial",(()=>{}),{storageArea:"session"}),new r.F("copied_dial",(()=>null),{storageArea:"session"})),g=new r.F("cut_link",(()=>null),{storageArea:"session"}),p=new r.F("parent_reload",(()=>[]),{storageArea:"session"});new r.F("sync_status",(()=>n.h),{storageArea:"session"})},6795:(t,e,s)=>{var r,i,a,n;s.d(e,{Cr:()=>a,EM:()=>i,Gj:()=>n}),(t=>{t[t.none=0]="none",t[t.enlarge=1]="enlarge",t[t.open=2]="open",t[t.openNewTab=3]="openNewTab"})(r||(r={})),(t=>{t[t.NONE=0]="NONE",t[t.OPEN_GROUP=1]="OPEN_GROUP",t[t.NEXT_GROUP=2]="NEXT_GROUP",t[t.PREV_GROUP=3]="PREV_GROUP",t[t.HOME_GROUP=4]="HOME_GROUP"})(i||(i={})),(t=>{t[t.fillSpace=0]="fillSpace",t[t.center=1]="center",t[t.scroll=2]="scroll"})(a||(a={})),(t=>{t[t.NORMAL=0]="NORMAL",t[t.LOCK=1]="LOCK",t[t.HIDDEN=2]="HIDDEN"})(n||(n={}))},4099:(t,e,s)=>{s.d(e,{O:()=>o});var r=s(3456),i=s(6062),a=s(6801);const n=new r.k;function o(t,e){i.Dy?n.notifyAll([t,e]):(0,a._z)({type:"updateFavicon",onlyIfMissing:!0,url:e,groupId:t})}},7552:(t,e,s)=>{var r,i,a,n;s.d(e,{Pb:()=>i,ew:()=>a,mU:()=>n,p0:()=>r}),(t=>{t.DB_OP_READ_WRITE="readwrite",t.DB_OP_READONLY="readonly"})(r||(r={})),(t=>{t.NEXT="next",t.PREV="prev",t.NEXT_UNIQUE="nextunique",t.PREV_UNIQUE="prevunique"})(i||(i={})),(t=>{t.DB_IMAGE="image",t.DB_HISTORY="history",t.DB_ORIGINAL="original",t.DB_PREVIOUS="previous",t.DB_RUNTIME="runtime"})(a||(a={})),(t=>{t.GROUP_INDEX="group"})(n||(n={}))},1305:(t,e,s)=>{s.d(e,{i:()=>o});var r=s(5524);var i=s(7552),a=s(4214),n=s(683);class o{name;version;static async withDB(t){const e=new o("group_speed_dial",10);try{return await t(e)}catch(e){throw(0,r.vV)("db operation failed",e,t.name),e}finally{e.close()}}promise;debugName;constructor(t,e){this.name=t,this.version=e,this.debugName=0,this.promise=this.open()}async open(){return this.promise=new Promise(((t,e)=>{const s=self.indexedDB.open(this.name,this.version);s.onupgradeneeded=t=>{(0,r.cO)("DB: onupgradeneeded");const a=s.result;a.onerror=a.onabort=e,a.objectStoreNames.contains(i.ew.DB_IMAGE)||a.createObjectStore(i.ew.DB_IMAGE,{keyPath:["url","group"]}),a.objectStoreNames.contains(i.ew.DB_ORIGINAL)||a.createObjectStore(i.ew.DB_ORIGINAL,{keyPath:["url","group"]}),a.objectStoreNames.contains(i.ew.DB_PREVIOUS)||a.createObjectStore(i.ew.DB_PREVIOUS,{keyPath:["url","group"]}),a.objectStoreNames.contains(i.ew.DB_HISTORY)||a.createObjectStore(i.ew.DB_HISTORY,{keyPath:"id",autoIncrement:!0}),a.objectStoreNames.contains(i.ew.DB_RUNTIME)||a.createObjectStore(i.ew.DB_RUNTIME,{keyPath:"key"});const n=s.transaction.objectStore(i.ew.DB_IMAGE);n.indexNames.contains(i.mU.GROUP_INDEX)||n.createIndex(i.mU.GROUP_INDEX,i.mU.GROUP_INDEX,{unique:!1})},s.onerror=e,s.onsuccess=()=>{const e=s.result;e.addEventListener("close",(()=>(0,r.cO)(`DB: closed unexpectedly ${this.debugName}`))),t(e)}}))}dbWeakTransactionStore(t,e,s){const i=t.transaction([e],s);return i.onerror=i.onabort=t=>(0,r.vV)(`DB ${e}`,t,s),i.objectStore(e)}dbTransaction(t,e,s){const i=t.transaction([e],s),a=new Promise(((t,a)=>{i.oncomplete=t,i.onerror=i.onabort=t=>{(0,r.vV)(`DB transaction ${e}`,t,s),a(t)}}));return[i,a]}async dbOperation(t,e,...s){return new Promise(((i,a)=>{const n=t[e].apply(t,s);n.onerror=t=>{(0,r.vV)(`DB op failed ${e}`,t,s),a(t)},n.onsuccess=()=>{i(n.result)}}))}async dbTransactionOperation(t,e,s,...r){const i=await this.promise;return new Promise((async(a,n)=>{const[o,c]=this.dbTransaction(i,t,e);this.dbOperation(o.objectStore(t),s,...r).then((t=>c.then((()=>a(t))))).catch(n)}))}async close(){(await this.promise).close()}async mapEachRecord(t,{map:e=((t,e)=>t),direction:s=i.Pb.NEXT,filter:a=((t,e)=>!0),filterMode:n="all"}={}){const o=(await this.promise).transaction([t],i.p0.DB_OP_READONLY);o.onerror=o.onabort=e=>(0,r.vV)(`DB mapEachRecord in ${t}`,e);const c=o.objectStore(t);return new Promise(((i,o)=>{const l=[];let d=0,u=0;const h=c.openCursor(null,s);h.onerror=e=>{(0,r.vV)(`DB ${t}`,e),o()},h.onsuccess=function(){const t=this.result;if(t){const s=a(t.value,u++);if("take_while"===n&&!s)return void i(l);s&&l.push(e(t.value,d++)),t.continue()}else i(l)}}))}async updateEachRecordAsync(t,e){const s=await this.dbTransactionOperation(t,i.p0.DB_OP_READONLY,"getAllKeys");return await(0,n.f)(s.map((s=>async()=>{const r=await this.dbTransactionOperation(t,i.p0.DB_OP_READONLY,"get",s).catch(console.error);if(!r)return!1;return await e(r)&&await this.dbTransactionOperation(t,i.p0.DB_OP_READ_WRITE,"put",r),!0})))}async getThumbnails(t){const e=await this.promise,s=this.dbWeakTransactionStore(e,i.ew.DB_IMAGE,i.p0.DB_OP_READONLY).index(i.mU.GROUP_INDEX),r=await this.dbOperation(s,"getAll",t);return(0,a.W)(r,"url")}async moveDbDial(t,e,s,r=s){const i=await this.getDbDial(t,s);return!!i&&(await this.removeDial(e,r),await this.updateDial(e,r,(t=>{const e=Object.assign(i,t);Object.assign(t,e)}),!0),!0)}async updateDial(t,e,s,a=!0,n=!0){const[o,c]=this.dbTransaction(await this.promise,i.ew.DB_IMAGE,i.p0.DB_OP_READ_WRITE),l=o.objectStore(i.ew.DB_IMAGE),d=await this.dbOperation(l,"get",[e,t]);if(!a&&!d)throw(0,r.vV)("forbidden dbDial creation",null,[e,t]),Error("forbidden dbDial creation");const u=d||{url:e,group:t};return n&&(this.backupPrevious({...u}),u.version=Date.now()),delete u.img,delete u.icon,s(u),await this.dbOperation(l,"put",u),await c,u}async backupPrevious(t){await this.dbTransactionOperation(i.ew.DB_PREVIOUS,i.p0.DB_OP_READ_WRITE,"put",t)}async getDialLikeData(t,e,s){if(!isNaN(t)&&e)return await this.dbTransactionOperation(s,i.p0.DB_OP_READONLY,"get",[e,t])}async getDbDial(t,e){return await this.getDialLikeData(t,e,i.ew.DB_IMAGE)}async removeDial(t,e){await this.dbTransactionOperation(i.ew.DB_IMAGE,i.p0.DB_OP_READ_WRITE,"delete",[e,t]),await this.dbTransactionOperation(i.ew.DB_PREVIOUS,i.p0.DB_OP_READ_WRITE,"delete",[e,t]),await this.dbTransactionOperation(i.ew.DB_ORIGINAL,i.p0.DB_OP_READ_WRITE,"delete",[e,t])}async deleteDbDial(t,e){if(isNaN(t)||!e)return;await this.dbTransactionOperation(i.ew.DB_IMAGE,i.p0.DB_OP_READ_WRITE,"delete",[e,t]);return!0}async getPrevious(t,e){return this.getDialLikeData(t,e,i.ew.DB_PREVIOUS)}async restorePreviousThumbnail(t,e){const s=await this.getPrevious(t,e);return!!s&&(await this.updateDial(t,e,(t=>{Object.assign(t,{hash:void 0},s,{version:t.version})}),!1),!0)}}},8289:(t,e,s)=>{s.d(e,{Z:()=>r});const r=t=>/^#(\d+)$/.test(t||"")},5444:(t,e,s)=>{s.d(e,{N:()=>n});var r=s(5229),i=s(8289),a=s(6672);function n(t){return t=(0,r.I)(t||""),(0,i.Z)(t)?"":(0,a.lX)(t,!0)}},1596:(t,e,s)=>{function r(t,e){let s=0;for(let r=0;r<t.length;r++)for(let i=0,a=t[r];i<a.dials.length;i++)if(e(a.dials[i],a,s++,i))return a.dials[i]}s.d(e,{E:()=>r})},3683:(t,e,s)=>{function r(t="",e=[]){if(!(t=t.trim())||e.some((e=>t.startsWith(e))))return"";try{return new URL(t).href}catch(e){try{return new URL("http://"+t).href}catch(t){return""}}}s.d(e,{d:()=>r})},6683:(t,e,s)=>{var r,i,a,n,o,c,l,d,u,h,g,p,m,w,f,y,v,_,b,I,D,A,E,S,R;s.d(e,{$C:()=>u,C2:()=>I,NO:()=>o,O8:()=>i,Q0:()=>D,X:()=>a,ZU:()=>m,d0:()=>y,kh:()=>d,kw:()=>b,oB:()=>A,pK:()=>R,xk:()=>n}),(t=>{t.NONE="",t.COLOR="color",t.GRADIENT="gradient",t.URL="url",t.FILE="data",t.BING="bing",t.PAGE="page"})(r||(r={})),(t=>{t[t.AUTO_GENERATED=0]="AUTO_GENERATED",t[t.FILE=1]="FILE",t[t.URL=2]="URL",t[t.PUBLIC=3]="PUBLIC",t[t.MAKE_TEXT=4]="MAKE_TEXT",t[t.BLANK=5]="BLANK",t[t.CLIPBOARD=6]="CLIPBOARD"})(i||(i={})),(t=>{t[t.CENTER=0]="CENTER",t[t.FULL_WIDTH=1]="FULL_WIDTH",t[t.COVER=2]="COVER",t[t.FILL=3]="FILL"})(a||(a={})),(t=>{t[t.solid=0]="solid",t[t.transparent=1]="transparent",t[t.legacy=9]="legacy"})(n||(n={})),(t=>{t[t.solid=0]="solid",t[t.shadow=1]="shadow",t[t.none=9]="none"})(o||(o={})),(t=>{t[t.CURRENT_TAB=0]="CURRENT_TAB",t[t.NEW_FOCUSED_TAB=1]="NEW_FOCUSED_TAB",t[t.NEW_TAB=2]="NEW_TAB",t[t.NEW_WINDOW=3]="NEW_WINDOW",t[t.NEW_PRIVATE_WINDOW=4]="NEW_PRIVATE_WINDOW"})(c||(c={})),(t=>{t[t.ASK=0]="ASK",t[t.RETURN=1]="RETURN",t[t.STAY=2]="STAY"})(l||(l={})),(t=>{t[t.URL=0]="URL",t[t.GROUP=1]="GROUP",t[t.TEXT=3]="TEXT",t[t.SEARCH=4]="SEARCH",t[t.LIVE=5]="LIVE",t[t.MULTI=6]="MULTI",t[t.SESSION=7]="SESSION",t[t.TOP_SITES=8]="TOP_SITES",t[t.TIMER=9]="TIMER",t[t.WEATHER=10]="WEATHER"})(d||(d={})),(t=>{t[t.countdown=0]="countdown",t[t.alarm=1]="alarm",t[t.stopwatch=2]="stopwatch"})(u||(u={})),(t=>{t[t.FLEXIBLE=0]="FLEXIBLE",t[t.FIXED=1]="FIXED"})(h||(h={})),(t=>{t[t.FILL=0]="FILL",t[t.CENTER=1]="CENTER",t[t.SCROLL=2]="SCROLL",t[t.DYNAMIC=3]="DYNAMIC",t[t.GRID=4]="GRID",t[t.LIST=5]="LIST"})(g||(g={})),(t=>{t[t.row=0]="row",t[t.column=1]="column"})(p||(p={})),(t=>{t[t.NORMAL=0]="NORMAL",t[t.SMALL=1]="SMALL",t[t.TINY=2]="TINY",t[t.MICRO=3]="MICRO",t[t.V_HALF=4]="V_HALF",t[t.H_HALF=5]="H_HALF",t[t.V_THIRD=6]="V_THIRD",t[t.H_THIRD=7]="H_THIRD",t[t.V_FOURTH=8]="V_FOURTH",t[t.H_FOURTH=9]="H_FOURTH"})(m||(m={})),(t=>{t[t.COLOR=0]="COLOR",t[t.GRADIENT=1]="GRADIENT",t[t.FILE=2]="FILE",t[t.URL=3]="URL",t[t.NONE=4]="NONE"})(w||(w={})),(t=>{t[t.linear=0]="linear",t[t.radialEllipse=1]="radialEllipse",t[t.radialCircle=2]="radialCircle"})(f||(f={})),(t=>{t[t.AUTO=0]="AUTO",t[t.CUSTOM=1]="CUSTOM"})(y||(y={})),(t=>{t[t.REFRESH_ALL=0]="REFRESH_ALL",t[t.REFRESH_THIS_GROUP=1]="REFRESH_THIS_GROUP",t[t.REFRESH_MISSING=2]="REFRESH_MISSING",t[t.REFRESH_GROUP_DIALS=3]="REFRESH_GROUP_DIALS",t[t.REFRESH_AUTO_RELOAD=4]="REFRESH_AUTO_RELOAD"})(v||(v={})),(t=>{t[t.spinner=1]="spinner",t[t.hidden=2]="hidden"})(_||(_={})),(t=>{t[t.ReloadEvery=0]="ReloadEvery",t[t.Daily=1]="Daily",t[t.Monthly=2]="Monthly",t[t.WeekDays=3]="WeekDays",t[t.Weekends=4]="Weekends",t[t.Monday=5]="Monday",t[t.Tuesday=6]="Tuesday",t[t.Wednesday=7]="Wednesday",t[t.Thursday=8]="Thursday",t[t.Friday=9]="Friday",t[t.Saturday=10]="Saturday",t[t.Sunday=11]="Sunday"})(b||(b={})),(t=>{t[t.openAll=0]="openAll",t[t.nothing=1]="nothing"})(I||(I={})),(t=>{t[t.openLink=0]="openLink",t[t.openAll=1]="openAll"})(D||(D={})),(t=>{t[t.manual=0]="manual",t[t.createdAsc=1]="createdAsc",t[t.createdDesc=2]="createdDesc",t[t.nameAsc=3]="nameAsc",t[t.nameDesc=4]="nameDesc",t[t.urlAsc=5]="urlAsc",t[t.urlDesc=6]="urlDesc"})(A||(A={})),(t=>{t.General="general",t.Visual="visual",t.Background="background",t.Gestures="gestures",t.Settings="settings",t.TopSites="topSites"})(E||(E={})),(t=>{t[t.browserExit=0]="browserExit",t[t.tabClose=1]="tabClose"})(S||(S={})),(t=>{t[t.unlock=0]="unlock",t[t.rememberPassword=1]="rememberPassword",t[t.setupPassword=2]="setupPassword",t[t.changePassword=3]="changePassword",t[t.recoveryPassword=4]="recoveryPassword"})(R||(R={}))},2572:(t,e,s)=>{s(9074)},9074:(t,e,s)=>{},519:(t,e,s)=>{s.d(e,{ak:()=>o,mv:()=>a,rH:()=>n});var r=s(7302),i=s(7283);const a="svg/globe.svg",n=(0,r.Z)(a),o=(0,i.H)("icons/tags/tag (65).svg")},6635:(t,e,s)=>{s.d(e,{S:()=>g});var r=s(910),i=s(6062),a=s(9180),n=s(170);var o=s(8408),c=s(2036),l=s(7384),d=s(6801),u=s(4590),h=s(2846);const g=new class{storageKey;backgroundScriptCallback;storage;alarmName;constructor(t,e){this.storageKey=t,this.backgroundScriptCallback=e,this.storage=new r.F(this.storageKey,(()=>({lastEntered:Date.now(),isDisabled:!0,remindInHours:3}))),this.alarmName=`help_remember_${this.storageKey}`,i.Dy&&((0,n.Q)(),browser.alarms.onAlarm.addListener((({name:t,scheduledTime:e})=>{t===this.alarmName&&this.backgroundScriptCallback()})),this.checkAndSchedule())}async checkAndSchedule(){const{isDisabled:t,lastEntered:e,remindInHours:s}=await this.storage.get();if(t)return;const r=e+(0,a.xE)(s)-Date.now();browser.alarms.create(this.alarmName,{delayInMinutes:(0,a.$L)(r)})}async setState(t){await this.storage.update((e=>(e.isDisabled=!t,e))),t&&this.checkAndSchedule()}async restartNewCycle(t){await this.storage.reset(),await this.setState(t)}async remembered(){await this.storage.update((t=>(t.lastEntered=Date.now(),t.remindInHours=Math.min(720,2*t.remindInHours),t))),this.checkAndSchedule()}}("help_remember_pass",(async()=>{const[t]=await browser.tabs.query({title:(0,u.tr)("pwd_forget_warning")});if(t||!h.M.METADATA.hasPassword())return;const e=await(0,o.K)(c.KL,{inNewTab:!0,active:!1});await(0,l.p)(e.id),(0,d.hC)(e.id,{type:"help_remember_pwd"})}))},8204:(t,e,s)=>{s.d(e,{e:()=>u});var r=s(910),i=s(5017),a=s(6683),n=s(6801),o=s(7398),c=s(2062),l=s(4323),d=s(4721);class u{sessionStoreKey;getHashOptions;unlockOptions;verifyCRC_GetSecret;resetPasswordAndData;helpRememberPassword;cryptoStore;constructor(t,e,s,i,a,n){this.sessionStoreKey=t,this.getHashOptions=e,this.unlockOptions=s,this.verifyCRC_GetSecret=i,this.resetPasswordAndData=a,this.helpRememberPassword=n,this.cryptoStore=new r.F(this.sessionStoreKey,(()=>null),{storageArea:"session"})}get canResetPassword(){return!!this.resetPasswordAndData}get passwordHint(){return this.getHashOptions()?.hint}async savePassword(t){await this.cryptoStore.set({hash:t})}async resetPassword(){this.canResetPassword&&(await(this.helpRememberPassword?.setState(!1)),await(this.resetPasswordAndData?.()))}async verifyPassword(t,e=!0){const s=this.getHashOptions();if(!s)return!1;const r=await(0,o.Er)(t,s),i=await this.verifyHashAndGetSecret(r.hash),a=!!await new c.k(r).unwrapKey(i||s.secret).catch(l.s6);return a&&e&&await this.savePassword(r.hash),a}async verifyHashAndGetSecret(t){if(!this.verifyCRC_GetSecret)return"";const e=await(0,d.d)(t,"SHA-256");return this.verifyCRC_GetSecret?.(e)}async lock(){await this.cryptoStore.remove()}async isUnlocked(){return!!await this.cryptoStore.get()}async unlockIfNeeded(t){{const t=await this.cryptoStore.get();if(t)return await this.verifyHashAndGetSecret(t.hash),!0}const e=await(await(0,i.C)()).pwdPrompt(this,a.pK.unlock,t);return e&&(0,n._z)({type:"broadcast",message:{type:"redraw_dials"}}),e}async decryptData(t){await this.unlockIfNeeded();const e=await this.cryptoStore.get();if(e)return await(this.verifyCRC_GetSecret?.(await(0,d.d)(e.hash,"SHA-256"))),await t.decrypt(e.hash)}lockKeyVaultEverywhere(){(0,n._z)({type:"broadcast",message:{type:"keyVault_lock"}})}}},5017:(t,e,s)=>{s.d(e,{C:()=>r});const r=()=>Promise.all([s.e(274),s.e(353)]).then(s.bind(s,7774))},2221:(t,e,s)=>{s.d(e,{KY:()=>u,j_:()=>g,lw:()=>h});var r=s(3943),i=s(7548),a=s(4069),n=s(910),o=(s(2572),s(2665),s(5048)),c=s(6663),l=s(6683);const d=()=>({ICON:"/128.png",PRIMARY_COLOR:o.hx,THEME:"default",TEMPLATE_COLOR:r.z.dark,DEFAULT_RELOAD_METHOD:c.P.default,AR_SCREEN_RESOLUTION:l.d0.AUTO,VR_DEFAULT_WIDTH:1280,SIDE_BAR_SIZE:256,DIAL_PADDING:12,SPLIT_DIAL_GAP:50,DIAL_BORDER_TYPE:l.NO.solid,DIAL_SHADOW_BLUR:10,DIAL_TITLE_CENTER:!0,DIAL_BORDER_RADIUS:0,DIAL_BORDER_COLOR:"#888888",DIAL_SHADOW_COLOR:"#888888",DIAL_HEADER_STYLE:l.xk.solid,DIAL_DARK_HEAD_BACKGROUND:"#222222",DIAL_LIGHT_HEAD_BACKGROUND:"#FFFFFF",MAX_FRAME_RELOAD_TIME:10,RELOAD_PLUS_DELAY:5,NORMAL_RELOAD_DELAY:100,BY_VISIT_DELAY:800,AUTO_THUMBNAIL_PAGES:"youtube.com\nm.youtube.com\nyoutu.be\nvimeo.com",AUTO_THUMBNAIL_POSITION:l.X.FULL_WIDTH,ACTIVATE_GROUP_HOVER_DELAY:25,DIAL_FONT_SIZE:16,DIAL_FONT_FAMILY:"",KEY_DELAY:950,DISABLED_DIALS_MENU:[],DISABLED_GROUPS_MENU:[],GROUPS_SIZE:o.O5,GROUPS_HEIGHT:o.$K,GROUP_PADDING:o.b3,GROUP_NAME_AS_TITLE:!0,GROUP_ICON_IN_TITLE:!0,USER_CONSENT_GOOGLE_FAVICON:!0,ACTIVE_PAGE_DETECTION:!0,GESTURE_BTN_RIGHT:!0,BACKGROUND_URL:"https://source.unsplash.com/random?orientation=landscape&size=1920x1080",AUTO_BACKUP_DAYS_INTERVAL:14,AUTO_BACKUP_KEEP_COUNT:4,AUTO_BACKUP_FOLDER_NAME:"gsd",VISIT_JPEG_HIGH_RESOLUTION:!0,ANDROID_MIN_DIAL_SIZE:100}),u=new n.F("options",d,void 0),h=d(),g=(async()=>(Object.assign(h,{...await a.Vq?{AR_DISABLE_THIS_DEVICE:!0,DIAL_PADDING:4,DISABLE_QUICK_EDIT:!0}:{}}),(0,i.Q)(u,h)))()},1481:(t,e,s)=>{s.d(e,{f:()=>o});var r=s(1962),i=s(519),a=s(6672);const n=[["http://localhost","svg/localhost (7).svg"],["http",i.mv],["about:","png/domains/about-blank.svg"],[`${r.$b}://extensions`,"icons/tags/tag (25).svg"],[`${r.$b}://settings`,"svg/gear.svg"]];function o(t){for(const[e,s]of n){if("http"===e&&(0,a.K9)(t))return"svg/ip.svg";if(t.startsWith(e))return s}return i.mv}},4424:(t,e,s)=>{s.d(e,{W:()=>r,q:()=>i});const r=(t,e)=>t%e,i=(t,e)=>Math.floor(t/e)},6801:(t,e,s)=>{s.d(e,{CB:()=>o,_z:()=>a,hC:()=>n});var r=s(6062),i=s(6304);const a=t=>browser.runtime.sendMessage(t),n=async(t,e,s)=>browser.tabs.sendMessage(t,e,s),o=async t=>r.Dy?(0,i.W)(t,{}):browser.runtime.sendMessage(t)},2542:(t,e,s)=>{s.d(e,{Z:()=>r});const r=t=>t.type===i,i="cp"},1650:(t,e,s)=>{s.d(e,{v:()=>i});var r=s(4069);let i=!0;r.Vq.then((t=>{t&&(i=!1)}))},5717:(t,e,s)=>{s.d(e,{M6:()=>n,uP:()=>o});var r=s(6683),i=s(1484),a=s(1374);class n{static validateAndFixClusters(t){const e=[];for(let s=0;s<t.length;s++){const n=t[s],o=n.size||r.ZU.NORMAL;if(o===r.ZU.NORMAL){e.push(n);continue}const c=(0,i.Q)(o),l=(0,a.v6)(t.slice(s),((t,e)=>(t.size||r.ZU.NORMAL)===o&&e<c));e.push(...l),s+=Math.max(0,l.length-1);const d=c-l.length;d>0&&e.push(...Array.from({length:d},(()=>({size:o}))))}return e}static dialsToClusters(t){const e=Array();for(let s=0;s<t.length;s++){const a=t[s],n=a.size||r.ZU.NORMAL;if(n!==r.ZU.NORMAL){const r=Array(),a=(0,i.Q)(n),o=s;for(let e=0;e<a;e++,s++)r.push(t[s]);e.push(new c(r)),s=o+a-1}else e.push(new o(a))}return e}static clustersToDials(t){const e=Array();for(let s=0;s<t.length;s++){const r=t[s];r.dials?e.push(...r.dials):e.push(r.dial)}return e}equalsTo(t){return this.dial===t.dial}includes(t){return this.dial===t||!!this.dials?.includes(t)}}class o extends n{dial;dials;constructor(t){super(),this.dial=t,this.dials=void 0}isEmptyDial(){return this.dial.isEmptyDial()}}class c extends n{dials;dial;constructor(t){super(),this.dials=t,this.dial=void 0}isEmptyDial(){return this.dials.every((t=>t.isEmptyDial()))}equalsTo(t){return t.dials?.length===this.dials.length&&t.dials.every(((t,e)=>t===this.dials[e]))}}},7644:(t,e,s)=>{s.d(e,{_:()=>m});var r=s(6683),i=s(6419),a=s(2742),n=s(9501),o=s(8873),c=s(1416),l=s(2806),d=s(9719),u=s(6684),h=s(8032),g=s(7683),p=s(1360);function m(t,e,s){switch(e.type){case r.kh.URL:return new i.O(t,s,e);case r.kh.LIVE:return new a.r(t,s,e);case r.kh.GROUP:return new n.O(t,s,e);case r.kh.TEXT:return new o.i(t,s,e);case r.kh.SEARCH:return new c.t(t,s,e);case r.kh.MULTI:return new l.U(t,s,e);case r.kh.SESSION:return new u.F(t,s,e);case r.kh.TOP_SITES:return new h.O(t,s,e);case r.kh.TIMER:return new g.W(t,s,e);case r.kh.WEATHER:return new p.r(t,s,e);default:return new d.I(t,s,e)}}},4046:(t,e,s)=>{s.d(e,{h:()=>l});var r=s(6683),i=(s(4323),s(5048)),a=s(1305),n=s(4352),o=s(5444),c=s(1962);class l{index;groupId;domId;type;url;getAbsoluteURL(){return this.url||""}name;size;note;created;get gridAreaName(){return`d${this.created}`}get areaNumber(){return this.created||this.index+1e3}thumbnail;crop;reload;visual;settings;distraction;text;providers;live;multi;session;topSites;timer;weather;constructor(t,e){this.index=t,this.groupId=e,this.domId=`dial_${this.index}`,this.size||(this.size=r.ZU.NORMAL)}isSingleLinkDial(){return!1}isLinkDial(){return!1}getLinks(){return this.isSingleLinkDial()?[this.url]:this.multi?this.multi.links.map((t=>t.url)):[]}isGroupDial(){return!1}isTextDial(){return!1}isSearchDial(){return!1}isLiveDial(){return!1}isUrlDial(){return!1}isMultiDial(){return!1}isWeatherDial(){return!1}isTimerDial(){return!1}isSessionDial(){return!1}isTopSitesDial(){return!1}isEmptyDial(){return!1}isNotEmptyDial(){return!this.isEmptyDial()}includesLinkCore(t){return this.isSingleLinkDial()&&(0,i.Ty)(this.url)===t||!!this.multi?.links.some((e=>(0,i.Ty)(e.url)===t))}hash(){return`${this.type};${this.size};${this.name};${this.note};${this.created||0};${this.getLinks().join("")};${this.text?.value||""};${JSON.stringify(this.providers)}`}compare(t){return this.index===t.index&&this.groupId===t.groupId}canHaveThumbnail(){return!1}async hasCustomThumbnail(){if(!this.thumbnail||this.thumbnail.type===r.O8.AUTO_GENERATED||!this.canHaveThumbnail())return!1;const t=await a.i.withDB((async t=>t.getDbDial(this.groupId,this.url)));return!(!t?.imgBlob&&!t?.img)}isAlmostSameDomain(t){const e=(0,o.N)(this.url||""),s=(0,o.N)(t);return e===s||e.startsWith(s.slice(0,s.lastIndexOf(".")))}setSpinner(t=!0){(0,c.$H)(this.domId)?.classList.toggle("reloading",t)}upgrade(){this.size=r.ZU.NORMAL}static updateDB(t,e,s,r){return a.i.withDB((async i=>{await i.moveDbDial(t,s,e,r),(0,n.L)(t,s)}))}}},9719:(t,e,s)=>{s.d(e,{I:()=>a});var r=s(4046),i=s(4323);class a extends r.h{type=void 0;isEmptyDial(){return!0}size;get gridAreaName(){return`d${this.areaNumber}`}get areaNumber(){return this.index+1e3}constructor(t,e,s){super(t,e),Object.assign(this,s)}clone(){return new a(this.index,this.groupId,(0,i.WR)(this))}static createEmptyDial(t){return new a(-1,t,{})}}},7319:(t,e,s)=>{s.d(e,{$:()=>h});var r=s(4623),i=s(2846),a=s(4323);class n extends r.Y{clone(){return new n((0,a.WR)(this))}getSavingInfo(){return"-locked-"}async onBeforeOpen(){return!this.lock||await i.M.masterKeyVault.unlockIfNeeded()}async getDials(){return await this.isUnlocked()?super.getDials():[]}async getDialsToDraw(){return await this.isUnlocked()?this.getDials():[]}async isUnlocked(){return!this.lock||await i.M.masterKeyVault.isUnlocked()}}var o=s(9998),c=(s(6672),s(6419)),l=s(6683),d=s(519);class u extends n{clone(){return new u((0,a.WR)(this))}async getAutoReloadPoweredDials(){return[]}async findDuplicates(t){return[]}async getDials(){if(this.topSites&&o.Jk&&browser.topSites){return(await browser.topSites.get({includeFavicon:!0,newtab:!0,limit:100}).catch((()=>[]))).map((({title:t,url:e,favicon:s},r)=>{const i=s||d.rH;return new c.O(r,this.id,{name:t||"",url:e,thumbnail:{type:l.O8.URL,value:i,position:l.X.CENTER}})}))}return this.dials}}function h(t){switch(!0){case!!t.topSites:return new u(t);case!!t.lock:return new n(t);default:return new r.Y(t)}}},9501:(t,e,s)=>{s.d(e,{O:()=>h});var r=s(6683),i=s(489),a=s(5048),n=s(1589),o=s(7283),c=s(2846),l=s(519),d=s(2036),u=s(4323);class h extends i.z{type=r.kh.GROUP;isGroupDial(){return!0}url;getAbsoluteURL(){return d.KL+this.url}thumbnail;crop;reload;visual;settings;#t=[];static fromUserInput(t,e,s,r,i){const n=new h(t,e,{name:"",...i,url:(0,a._V)(s)});return r&&n.#t.push(r),n}isSingleLinkDial(){return!0}isLinkDial(){return!0}canHaveThumbnail(){return!0}constructor(t,e,s){super(t,e),Object.assign(this,s)}async preSaveAction(t){for(const t of this.#t)await t();this.#t.length=0}getTargetGroupId(){return(0,a.m4)(this.url)}clone(){return new h(this.index,this.groupId,(0,u.WR)(this))}styleIcon(t,e){const s=c.M.groupById(this.getTargetGroupId()),r=s.iconId;return t.setAttribute("style",r?new n.v(0,"",r,s.color||o.e).getIconStyle():l.ak),t}}},2742:(t,e,s)=>{s.d(e,{r:()=>o});var r=s(489),i=s(6683),a=s(519),n=s(4323);class o extends r.z{type=i.kh.LIVE;isLiveDial(){return!0}url;live;thumbnail;crop;reload;visual;settings;constructor(t,e,s){super(t,e),Object.assign(this,s)}static fromUserInput(t,e,s,r,i){return new o(t,e,{name:"",...i,url:s,live:r})}isSingleLinkDial(){return!0}isLinkDial(){return!0}canHaveThumbnail(){return!0}clone(){return new o(this.index,this.groupId,(0,n.WR)(this))}styleIcon(t,e){return t.src=e||a.rH,t}}},2806:(t,e,s)=>{s.d(e,{U:()=>L});var r=s(6683),i=s(489),a=s(1374),n=s(9944),o=s(6672),c=s(3683),l=s(4323),d=s(2399),u=s(4590),h=s(2846),g=s(2036),p=s(3672),m=s(8289),w=s(9719),f=s(1009),y=s(4352),v=s(4099),_=s(7283),b=s(8794),I=s(5076),D=s(1962),A=s(5048),E=s(9501),S=s(6419);class R{fn;weakMap;constructor(t){this.fn=t,this.weakMap=new WeakMap}getOrFetch(t){if(this.weakMap.has(t))return this.weakMap.get(t);{const e=this.fn(t);return this.weakMap.set(t,e),e}}}var T=s(8282),O=s(3694),k=s(9676);class L extends i.z{type=r.kh.MULTI;isMultiDial(){return!0}multi;thumbnail;visual;settings;isLinkDial(){return!0}#e=new R((t=>(0,m.Z)(t.url)?new E.O(this.index,this.groupId,t):new S.O(this.index,this.groupId,t)));constructor(t,e,s){super(t,e),Object.assign(this,s)}getLinksAsDials(){return this.multi.links.map((t=>this.#e.getOrFetch(t)))}static fromUserInput(t,e,s,r){s.links=s.links.filter((t=>t.url)).map((t=>(t.url=function(t){return t.startsWith(g.KL)?(0,p.u)(t,g.KL):(0,m.Z)(t)?t:(0,c.d)(t)}(t.url),t)));const i=new L(t,e,{name:"",...r,multi:s});return i.normalizeLinks(),i}async postSaveAction(t){this.multi.links.forEach((e=>(0,v.O)(t,e.url)));const e=(await Promise.allSettled(this.multi.links.filter((t=>!t.name)).map((async t=>({url:t.url,title:await(0,k.w)(4e3,"",(()=>(0,f.E)(t.url)))}))))).filter(n.s).map((t=>t.value));this.multi.links.forEach(((t,s)=>{t.name||=e.find((({url:e})=>e===t.url))?.title||(0,o.QV)(t.url)})),this.normalizeLinks(),await h.M.action("replaceDial",{groupId:t,dial:this},(0,u.tr)("save_dial_names_saved")),(0,y.L)(t)}normalizeLinks(){this.multi.links.forEach(((t,e)=>{t.created||=(0,O.Sy)()+e,t.name||=(0,o.QV)(t.url),t.url||=T.pf})),this.multi.links=(0,a.vC)(this.multi.links,"url"),this.multi.sortBy&&this.multi.links.sort(((t,e)=>{switch(this.multi.sortBy){case r.oB.createdAsc:return t.created-e.created;case r.oB.createdDesc:return e.created-t.created;case r.oB.nameAsc:return t.name.localeCompare(e.name);case r.oB.nameDesc:return e.name.localeCompare(t.name);case r.oB.urlAsc:return t.url.localeCompare(e.url);case r.oB.urlDesc:return e.url.localeCompare(t.url);default:return 0}}))}static async mergeDials(t,e,s,r,i=!1){const a=r.clone(),n=h.M.groupById(t),o=(await Promise.all(e.map((t=>n.dialByIndex(t).then((t=>t?.clone())))))).filter(l.zz),c=a.name,g=(a.index,o.flatMap((t=>t.isMultiDial()?(0,l.WR)(t.multi.links):[{name:t.name||"",url:t.url||T.pf}]))),p=L.convertDialToMulti(a,g);await h.M.action("replaceDials",{list:[...i?[]:o.map((e=>({groupId:t,dial:new w.I(e.index,t,{})}))),{groupId:s,dial:p}]},(0,u.tr)("save_dial_moved",`${o.map((t=>`"${t.name}"`)).join(", ")} => "${c}"`)),(0,d.D)(s),i||(0,d.D)(t)}static convertDialToMulti(t,e,s=Number.MAX_SAFE_INTEGER){return t.isMultiDial()?(t.multi.links.splice(s,0,...e),t.normalizeLinks(),t):L.fromUserInput(t.index,t.groupId,{links:[{name:t.name,url:t.url},...e],titleAction:r.C2.openAll,linkAction:r.Q0.openLink},{name:"",thumbnail:t.thumbnail,visual:t.visual,settings:t.settings})}static async pasteLink(t,e){const s=L.getItemIndex(e),r=await b.L8.get();if(r){const e=t.index===r.dialIndex&&t.groupId===r.groupId?t:(await h.M.groupById(r.groupId).dialByIndex(r.dialIndex))?.clone();if(e&&e.isMultiDial()){const[i]=e.multi.links.splice(r.linkIndex,1),a=L.convertDialToMulti(t.clone(),[i],s);await h.M.action("replaceDials",{list:[{groupId:r.groupId,dial:e},{groupId:a.groupId,dial:a}]},(0,u.tr)("save_link_moved",`"${e.name}" => "${a.name}"`)),await b.L8.reset()}return}const i=await b._V.get();if(i?.length){const e=(await Promise.all(i.map((async t=>(await h.M.groupById(t.groupId).dialByIndex(t.dialIndex))?.clone())))).filter((e=>!!e&&!e.compare(t)&&(e.isMultiDial()||e.isLinkDial()))),r=e.flatMap((t=>t?.isMultiDial()?t.multi.links:t?[{name:t.name,url:t.url,created:t.created}]:[])),a=L.convertDialToMulti(t.clone(),r,s);await h.M.action("replaceDials",{list:[...e.map((t=>({groupId:t.groupId,dial:new w.I(t.index,t.groupId,{})}))),{groupId:a.groupId,dial:a}]},(0,u.tr)("save_link_pasted",`${e.map((t=>`"${t.name}"`)).join(", ")} => "${a.name}"`)),await b._V.reset()}}async removeClickedLinkAndSave(t){await(0,I.J)(L.getItemIndex(t),(async t=>{this.multi.links.splice(t,1),await h.M.action("replaceDial",{groupId:this.groupId,dial:this},(0,u.tr)("remove_from_multi"))}))}async cutLink(t){const e=L.getItemIndex(t)||0;await b.L8.set({groupId:this.groupId,dialIndex:this.index,linkIndex:e});const s=(0,D.EW)(t)?.closest(A.l8);Array.from(s?.querySelectorAll("ul > li")||[]).at(e)?.classList.add("is_cut")}static getItemIndex(t){const e=parseInt((0,D.EW)(t)?.closest("li")?.dataset.index||"");return isNaN(e)?void 0:e}clone(){return new L(this.index,this.groupId,(0,l.WR)(this))}styleIcon(t,e){return t.setAttribute("style",(0,_.H)("svg/multi (1).svg")),t}}},489:(t,e,s)=>{s.d(e,{z:()=>a});var r=s(4046),i=s(3694);class a extends r.h{type;name;size;note;created=(0,i.Sy)();distraction;constructor(t,e){super(t,e),this.name||(this.name="")}async preSaveAction(t){}postSaveAction(t){}}},1416:(t,e,s)=>{s.d(e,{t:()=>u});var r=s(6683),i=s(489),a=s(2542),n=s(6672),o=s(8168),c=s(4099),l=s(7283),d=s(4323);class u extends i.z{type=r.kh.SEARCH;isSearchDial(){return!0}providers;thumbnail;visual;settings;constructor(t,e,s){super(t,e),Object.assign(this,s)}static fromUserInput(t,e,s,r){return s.filter(a.Z).forEach((t=>{t.name??=(0,o.BB)((0,n.lX)(t.url,!0))})),new u(t,e,{name:"",...r,providers:s})}async postSaveAction(t){await Promise.all(this.providers.filter(a.Z).map((e=>(0,c.O)(t,e.url))))}clone(){return new u(this.index,this.groupId,(0,d.WR)(this))}styleIcon(t,e){return t.setAttribute("style",(0,l.H)("svg/search_d (3).svg")),t}}},6684:(t,e,s)=>{s.d(e,{F:()=>u});var r=s(6683),i=s(489),a=s(1650),n=s(2036),o=s(7283),c=s(4323),l=s(7137);const d=[n.Lf,"chrome://newtab","https://auth.tampermonkey.net/oauth"];class u extends i.z{type=r.kh.SESSION;isSessionDial(){return!0}session;thumbnail;visual;settings;isLinkDial(){return!0}constructor(t,e,s){super(t,e),Object.assign(this,s)}static fromUserInput(t,e,s,r){return new u(t,e,{name:"",...r,session:s})}async getRecentlyClosed(){if(!a.v||!browser.sessions)return[];const t=await browser.sessions.getRecentlyClosed(),e=t=>!t?.hidden&&!d.some((e=>t?.url?.startsWith(e)));return t.filter((t=>{const{window:s,tab:r}=t;return s?.tabs&&(s.tabs=s.tabs.filter(e),s.tabs.forEach((t=>t.sessionId=s.sessionId))),e(r)}))}async restoreSession(t){const{tab:e,window:s}=await browser.sessions.restore(t),r=e?await browser.windows.get(e.windowId):s;r.focused||await browser.windows.update(r.id,{focused:!0})}canHaveThumbnail(){return!1}static async askForPermission(){return(0,l.x)("sessions")}clone(){return new u(this.index,this.groupId,(0,c.WR)(this))}styleIcon(t,e){return t.setAttribute("style",(0,o.H)("svg/recent (2).svg")),t}}},8873:(t,e,s)=>{s.d(e,{i:()=>o});var r=s(6683),i=s(489),a=s(7283),n=s(4323);class o extends i.z{type=r.kh.TEXT;isTextDial(){return!0}text;thumbnail;visual;constructor(t,e,s){super(t,e),Object.assign(this,s)}static fromUserInput(t,e,s,r){return new o(t,e,{name:"",...r,text:s})}clone(){return new o(this.index,this.groupId,(0,n.WR)(this))}styleIcon(t,e){return t.setAttribute("style",(0,a.H)("svg/note_t.svg")),t}}},7683:(t,e,s)=>{s.d(e,{W:()=>f});var r=s(6683),i=s(489),a=s(6265),n=s(9598),o=s(4590),c=s(6004);class l extends a.w{index;id;value;type;constructor(t,e,s=""){super(t,e,r.$C.countdown,s),this.index=t,this.id=e,this.value=s,this.type=r.$C.countdown}async start(){browser.alarms.create(this.alarmName,{delayInMinutes:super.getMinutes()})}async stop(){await browser.alarms.clear(this.alarmName)}async renderHead(){return(0,c.nl)([(0,n.u)("label",`${(0,o.tr)("timer_type_0")}:`),super.formatSeconds(this.getSeconds())])}async renderBody(){const t=await this.getScheduledTime();return super.formatSeconds(t?(t-Date.now())/1e3:0)}}class d extends a.w{index;id;value;type;constructor(t,e,s=""){super(t,e,r.$C.alarm,s),this.index=t,this.id=e,this.value=s,this.type=r.$C.alarm}async start(){const{hours:t,minutes:e,seconds:s}=super.getTime(),r=new Date;r.setHours(t),r.setMinutes(e),r.setSeconds(s),r<new Date&&r.setDate(r.getDate()+1),browser.alarms.create(this.alarmName,{when:r.getTime()})}async stop(){await browser.alarms.clear(this.alarmName)}async renderHead(){return(0,c.nl)([(0,n.u)("label",`${(0,o.tr)("timer_type_1")}:`),(0,n.z)("span",{class:"timer_time",textContent:this.value})])}async renderBody(){const t=await this.getScheduledTime();return super.formatSeconds(t?(t-Date.now())/1e3:0)}}var u=s(910),h=s(2460),g=s(5524);class p extends a.w{index;id;type;store;runningIcons;pausedIcons;stoppedIcons;async getScheduledTime(){}constructor(t,e){super(t,e,r.$C.stopwatch),this.index=t,this.id=e,this.type=r.$C.stopwatch,this.store=new u.F(this.alarmName,(()=>{}),{storageArea:"localStorage"}),this.runningIcons=[1,0,1],this.pausedIcons=[1,1,0],this.stoppedIcons=[0,1,0]}async isPaused(){const t=await this.store.get(),e=t?.paused.at(-1);return Boolean(e?.start&&!e?.end)}async isRunning(){return!!await this.store.get()}async start(){await(await this.isRunning()?this.pause():this.store.set({paused:[],startTime:Date.now()}))}async stop(){return(0,g.cO)(`Stopwatch cleared: ${(await this.renderBody()).textContent}`),this.store.remove()}async pause(){let t=!1;return await this.store.update((e=>{if(e){const s=e.paused.at(-1);!s||s.end?e.paused.push({start:Date.now()}):(s.end=Date.now(),t=!0)}return e})),t}async measure(){const t=await this.store.get();if(!t)return 0;const e=Date.now(),s=(0,h.RM)(t.paused.map((t=>(t.end||e)-t.start)));return e-t.startTime-s}async renderHead(){return(0,n.u)("label",`${(0,o.tr)("timer_type_2")}:`)}async renderBody(){return super.formatSeconds(await this.measure()/1e3)}}var m=s(7283),w=s(4323);class f extends i.z{type=r.kh.TIMER;isTimerDial(){return!0}timer;thumbnail;visual;settings;isLinkDial(){return!1}canHaveThumbnail(){return!1}constructor(t,e,s){super(t,e),Object.assign(this,s)}static fromUserInput(t,e,s,r){return new f(t,e,{name:"",...r,timer:s})}getTimerControls(){return this.timer.timers.map(((t,e)=>{switch(t.type){case r.$C.countdown:return new l(e,this.created,t.value);case r.$C.alarm:return new d(e,this.created,t.value);case r.$C.stopwatch:return new p(e,this.created)}}))}clone(){return new f(this.index,this.groupId,(0,w.WR)(this))}styleIcon(t,e){return t.setAttribute("style",(0,m.H)("svg/timer (2).svg")),t}}},8032:(t,e,s)=>{s.d(e,{O:()=>d});var r=s(6683),i=s(489),a=s(9998),n=(s(6672),s(519)),o=s(7283),c=s(4323),l=s(7137);class d extends i.z{type=r.kh.TOP_SITES;isTopSitesDial(){return!0}topSites;thumbnail;visual;settings;isLinkDial(){return!0}constructor(t,e,s){super(t,e),Object.assign(this,s)}static fromUserInput(t,e,s,r){return new d(t,e,{name:"",...r,topSites:s})}async getTopSites(){if(!a.Jk||!browser.topSites)return[];return(await browser.topSites.get({includeFavicon:!0,newtab:!0,limit:100}).catch((()=>[]))).map((({title:t,url:e,favicon:s},r)=>({name:t||"",url:e,icon:s||n.rH})))}canHaveThumbnail(){return!1}static async askForPermission(){return(0,l.x)("topSites")}clone(){return new d(this.index,this.groupId,(0,c.WR)(this))}styleIcon(t,e){return t.setAttribute("style",(0,o.H)("svg/list-with-dots.svg")),t}}},6419:(t,e,s)=>{s.d(e,{O:()=>l});var r=s(489),i=s(6683),a=s(1962),n=s(7283),o=s(1481),c=s(4323);class l extends r.z{type=i.kh.URL;isUrlDial(){return!0}url="";thumbnail;crop;reload;visual;settings;constructor(t,e,s){super(t,e),Object.assign(this,s),this.url||(this.url="")}static fromUserInput(t,e,s,r){return new l(t,e,{name:"",...r,url:s})}isSingleLinkDial(){return!0}isLinkDial(){return!0}canHaveThumbnail(){return!0}clone(){return new l(this.index,this.groupId,(0,c.WR)(this))}styleIcon(t,e){return e?t.src=e:(t.src=a.RO,t.setAttribute("style",(0,n.H)((0,o.f)(this.url)))),t}}},1360:(t,e,s)=>{s.d(e,{r:()=>o});var r=s(6683),i=s(489),a=s(7283),n=s(4323);class o extends i.z{type=r.kh.WEATHER;isWeatherDial(){return!0}weather;thumbnail;visual;settings;isLinkDial(){return!1}canHaveThumbnail(){return!1}constructor(t,e,s){super(t,e),Object.assign(this,s)}static fromUserInput(t,e,s,r){return new o(t,e,{name:"",...r,weather:s})}getWeatherUUID(){return`${this.weather.units}_${this.weather.lat}_${this.weather.lon}`}clone(){return new o(this.index,this.groupId,(0,n.WR)(this))}styleIcon(t,e){return t.setAttribute("style",(0,a.H)("svg/weather.svg")),t}}},6808:(t,e,s)=>{s.d(e,{v3:()=>l});var r=s(4590),i=s(7319),a=s(4069),n=s(841);const o=3,c=4;function l(t,{name:e="",dimensions:s,archived:l=!1,isDefaultFirstGroup:d=!1,sourceGroup:u}={}){const h=d&&a.m0,{rows:g,cols:p}=s||(u?{rows:u.rows,cols:u.cols}:h?{rows:7,cols:3}:{rows:o,cols:c}),m=Object.assign({},{id:t,name:d?(0,r.tr)("default_home_group_name"):e||(0,r.ZB)("group_generated_name",t),iconId:d?37:void 0,rows:g,cols:p,...h?{dynamic:{width:n.v.androidWidth,height:n.v.androidHeight}}:{},dials:Array(g*p).fill(0).map((()=>({}))),archived:l,...u?{ratio:u.ratio,dynamic:u.dynamic,list:u.list,background:u.background,gestures:u.gestures,color:u.color,rowColor:u.rowColor,colColor:u.colColor}:{}});return(0,i.$)(m)}},4623:(t,e,s)=>{s.d(e,{Y:()=>v});var r=s(6795),i=s(1374),a=s(5048),n=s(6683),o=s(4323),c=s(7644),l=s(9719),d=s(5717),u=s(2846),h=s(8654),g=s(8794),p=s(1589),m=s(2036),w=s(7283),f=s(6664),y=s(5904);class v{clone(){return new v((0,o.WR)(this))}static DEFAULT_ROWS=3;static DEFAULT_COLS=4;id;name;getSavingInfo(){return this.name}cols;rows;dials;async getDials(){return this.dials}archived;background;createBackgroundFileURL(){return`about:blank#${this.id}`}getAbsoluteURL(){return m.KL+`#${this.id}`}colColor;color;distraction;gestures;options;container;getGestures(){return this.gestures||h.j}dynamic;list;grid;topSites;lock;ratio;rowColor;iconId;constructor(t){Object.assign(this,t),this.options??={},this.dials=t.dials.map(((e,s)=>(0,c._)(s,e,t.id)))}async onBeforeOpen(){return!0}async findDuplicates(t){const e=(0,a.Ty)(t);return(await this.getDials()).filter((t=>t.includesLinkCore(e)))}styleIcon(t=document.createElement("img"),e=this.color||w.e,s=0){const r=this.iconId||s;return r&&t.setAttribute("style",new p.v(0,"",r,e).getIconStyle()),t}async insertNewLink(t){const[e]=t.url?await this.findDuplicates(t.url):[];if(e)return"multi"in e||(e.name=t.name),{action:"update",dial:e};const s=(0,i.SL)(this.dials,(t=>t.isEmptyDial())),r=s>=0?s:this.dials.length;return this.replaceDial(t,r),{action:"insert",dial:t}}removeDial(t){const e=this.dials[t];return this.replaceDial(new l.I(t,this.id,e),t)}replaceDial(t,e=this.dials.length){const s=t.clone();e<0&&(e=this.dials.length);this.dials.length;const r=this.dials[e],i=this.dials[e]?.size??n.ZU.NORMAL;return this.dials=[...this.dials.slice(0,e),s,...this.dials.slice(e+1)],s.size=i,this.grid&&r?.created&&s.created&&(this.grid.areas=new y.x(this.grid.areas).replaceItem(r.created,s.created)),s}hasDynamicLayout(){return Boolean(this.dynamic||this.list||this.topSites||this.grid)}isFlexibleLayout(){return!(this.dynamic||this.list||this.ratio||this.grid&&this.grid.position!==r.Cr.fillSpace)}getLastEmptyDial(){const t=this.dials.at(-1);if(t?.isEmptyDial())return t}async isUnlocked(){return!0}getPosition(){return u.M.GROUPS.findIndex((t=>t.id===this.id))}getDialIndex(t){return this.dials.indexOf(t)}getOrCreateEmptyDialIndex(t=0){const e=this.dials.findIndex(((e,s)=>s>=t&&e.isEmptyDial()));return e>=0?e:(this.dials=this.dials.concat(l.I.createEmptyDial(this.id)),this.dials.length-1)}activateGroup(t){window.dispatchEvent(new CustomEvent("change_active_group",{detail:t??this.id}))}async getNeighbouringGroup(t,e,{isProductivityOn:s=!1}={}){const r=await u.M.getVisibleGroups();let i=this;for(const a of Array(r.length))if(i=i._getNeighbouringGroup(r,t,e),!i.distraction||!s)return i}_getNeighbouringGroup(t,e,s){const r=t.findIndex((t=>t.id===this.id)),i="next"===e?r+1:r-1;switch(s){case"loop":return t[i<0?t.length-1:i%t.length];case"stay":return t[i<0?0:i>=t.length?t.length-1:i];case"none":return i<0||i>=t.length?void 0:t[i]}}async executeGesture(t,e){const s=this.getGestures()[t];switch(s?.type){case r.EM.OPEN_GROUP:return this.activateGroup(s.groupId),!0;case r.EM.HOME_GROUP:return this.activateGroup(await g.ne.get()??u.M.GROUPS[0].id),!0;case r.EM.NEXT_GROUP:return this.activateGroup((await this.getNeighbouringGroup("next","loop",{isProductivityOn:e})).id),!0;case r.EM.PREV_GROUP:return this.activateGroup((await this.getNeighbouringGroup("prev","loop",{isProductivityOn:e})).id),!0}return!1}async getDialsToDraw(){return this.getDials()}async getAutoReloadPoweredDials(){return this.list?[]:(await this.getDials()).filter((t=>t.url&&t.reload&&(!t.thumbnail||t.thumbnail.type===n.O8.AUTO_GENERATED)))}async dialByIndex(t){return(await this.getDials()).at(t)}dialById(t){const e=(0,a.om)(t),s=this.dials[e];if(!s)throw`Dial not found!!! ${t} / ${this.id}`;return s}upgrade(){this.dials.forEach((t=>t.upgrade())),this.archived=!1,delete this.rowColor,delete this.colColor}serialize(){let t=this.dials.filter((t=>!t.isEmptyDial()||!(this.list||this.grid||this.dynamic&&!t.size))).map(((t,e)=>t.isEmptyDial()?{...t.size?{size:t.size}:{}}:{name:t.name,note:t.note,created:t.created&&(t.created<3e7?60*t.created+e:t.created),size:t.size,type:t.type,...t.url?{url:t.url}:{},...t.live?{live:t.live}:{},...t.text?{text:t.text}:{},...t.multi?{multi:Object.assign({links:[],titleAction:n.C2.openAll,linkAction:n.Q0.openLink},t.multi)}:{},...t.session?{session:t.session}:{},...t.topSites?{topSites:t.topSites}:{},...t.timer?{timer:t.timer}:{},...t.weather?{weather:t.weather}:{},...t.providers?{providers:t.providers}:{},...t.thumbnail?{thumbnail:t.thumbnail}:{},...t.reload?{reload:t.reload}:{},...t.crop?{crop:t.crop}:{},...t.settings?{settings:t.settings}:{},...t.distraction?{distraction:t.distraction}:{},...t.visual?{visual:t.visual}:{}}));if((this.list||this.grid)&&t.forEach((t=>t.size=n.ZU.NORMAL)),this.topSites)t.length=0;else if(this.dynamic||this.list||this.grid)t.push({});else{t=d.M6.validateAndFixClusters(t);const e=d.M6.dialsToClusters(this.dials),s=this.rows*this.cols;e.length>s&&(this.rows=Math.ceil(e.length/this.cols));for(let e=t.length;e<s;e++)t.push({})}return this.grid&&(this.grid=f.J.normalizeGrid(this.grid,t)),{id:this.id,name:this.name,rows:(0,o.Kg)(this.rows)?parseInt(this.rows):this.rows,cols:(0,o.Kg)(this.cols)?parseInt(this.cols):this.cols,ratio:this.ratio,dynamic:this.dynamic,list:this.list,grid:this.grid,topSites:this.topSites,background:this.background,color:this.color,iconId:this.iconId,archived:this.archived,rowColor:this.rowColor,colColor:this.colColor,distraction:this.distraction,container:this.container,gestures:this.gestures,options:this.options,lock:this.lock,dials:t}}}},7111:(t,e,s)=>{s.d(e,{j:()=>a});var r=s(6683),i=s(5048);function a(t,e,s){t.flatMap(((t,a,n)=>function(t,e,a){const n=[],o=(0,i._V)(t),c=(0,i._V)(e);return s?.forEach((s=>{s.group===t&&n.push((()=>s.group=e)),s.url===o&&n.push((()=>s.url=c))})),a.forEach((s=>{s.id===t&&n.push((()=>s.id=e)),s.dials.forEach((t=>{t.type===r.kh.GROUP&&t.url===o&&n.push((()=>t.url=c)),t.type===r.kh.MULTI&&t.multi?.links.forEach((t=>{t.url===o&&n.push((()=>t.url=c))}))}))})),n}(t.id,e+a,n))).forEach((t=>t()))}},2846:(t,e,s)=>{s.d(e,{M:()=>$});var r=s(6795),i=s(4323),a=s(6808),n=s(2801),o=s(4590),c=s(1374),l=s(2399),d=s(1038),u=s(9719),h=s(9),g=s(5717);function p(t,e){return(0,c.SL)(t,(t=>t===e||e.equalsTo(t)))}var m=s(1589);class w{masterPassword;tags;constructor(t){Object.assign(this,t),this.tags=(t.tags||[{id:1,icon:36,name:(0,o.tr)("tag_work"),color:"#0095ff"},{id:2,icon:29,name:(0,o.tr)("tag_play"),color:"#00d200"},{id:3,icon:31,name:(0,o.tr)("tag_shopping"),color:"#e94335"}].concat([])).map((t=>new m.v(t.id,t.name,t.icon,t.color)))}getUserTags(){return this.tags.map((t=>new m.v(t.id,t.name,t.icon,t.color)))}tagById(t){const e=this.tags.find((e=>e.id===t));return e?new m.v(e.id,e.name,e.icon,e.color):void 0}hasPassword(){return!!this.masterPassword}getMasterPasswordHint(){return this.masterPassword?.options.hint||""}}var f=s(6672);class y{optionsAutoSync;optionsManual;constructor(t){Object.assign(this,t)}}var v=s(6382),_=s(6062),b=s(5048),I=s(9830),D=s(910),A=s(7319),E=s(4352),S=s(1596),R=s(2542),T=s(1305);async function O(t,e,s){const r=(0,c.BO)(t.url||t.multi?.links.map((t=>t.url))||t.providers?.filter(R.Z).map((t=>t.url))||[]);for(const t of r)await T.i.withDB((r=>r.moveDbDial(e,s,t)))}var k=s(9180);var L=s(2221),P=s(8204),C=s(9114),x=s(6635),N=s(6801),M=(s(7139),s(5076)),B=s(2036),U=s(7111),G=s(2352),H=s(7384),F=s(4069),W=s(5904),z=s(6664);const V="masterPasswordHash"+(C.O?"_incognito":""),$=new class extends v.c{DATA_IS_UP_TO_DATE=new D.F("syncTime",(()=>Date.now()));DATA_LAST_CHANGE=new D.F("lastChangeInfo",i.s6);promise;fields={groups:"groups",metadata:"metadata",sync:"sync"};_executor=new n.V(1);_saveCallbacks=[];masterKeyVault=new P.e(V,(()=>this.METADATA.masterPassword?.options),void 0,void 0,(()=>this.action("removeMasterPassword",{})),x.S);_groups=[];_metadata=new w({});_sync=new y({});get GROUPS(){return this._groups}get METADATA(){return this._metadata}get SYNC(){return this._sync}hasOwnGroups=!0;constructor(){super(),this.promise=browser.storage.local.get([this.fields.groups,this.fields.metadata,this.fields.sync]).then((async({[this.fields.groups]:t,[this.fields.metadata]:e,[this.fields.sync]:s})=>(await Promise.all([L.j_,F.Vq,o.P$]),await this.loadGroups(t),this._metadata=new w(e||{}),this._sync=new y(s),this))),browser.storage.local.onChanged.addListener((async t=>{const e=t[I.J.key],s=t[this.DATA_IS_UP_TO_DATE.key],r=t[this.fields.groups],a=t[this.fields.metadata];(r||a||e)&&(a&&(this._metadata=new w(a.newValue||{})),r&&await this.loadGroups(r.newValue),super.notifyChange({type:r||a?"data":"sync",isDirty:!!s&&0===s.newValue,sync:this.SYNC,groups:this.GROUPS,metadata:this.METADATA,lastChangeInfo:t.lastChangeInfo?.newValue,serialize:()=>this.serialize()}),(0,i.XB)(this._saveCallbacks))}))}async loadGroups(t){if(!t?.length&&_.Dy){const t=(0,a.v3)(0,{isDefaultFirstGroup:!0});await this.action("addGroup",{newGroup:t,addonInit:!0})}else this._groups=(t||[]).map(A.$)}async action(t,e,s=""){switch(t){case"addGroup":{const{newGroup:t,position:r,addonInit:i}=e;return this._groups||(this._groups=[]),this._groups.splice(r??this._groups.length,0,(0,A.$)(t)),void await this.saveState(s||(0,o.tr)("save_group_created"),{dontUpdateVersion:i})}case"newSyncData":case"importData":{const{groups:r,metadata:a,sync:n,version:c,replaceExisting:l,source:d,dontUpdateVersion:u}=e,h="shared"===d;h&&(0,U.j)(r,this.getNewGroupId());const g=r.map(A.$);if(h&&!await(0,B.FJ)()&&g.forEach((t=>t.upgrade())),this._groups=l?g:this._groups.concat(g),a&&(this._metadata=new w(a)),n&&(this._sync=new y(n)),await this.saveState(s||(0,o.tr)("import_done_text"),{dontUpdateVersion:u,version:c,setDirty:"newSyncData"===t?Date.now():0}),h){(0,N.CB)({type:"download_missing_favicons"});const t=await(0,G.e6)();await(0,H.p)(t.id,(()=>browser.tabs.update(t.id,{url:`${B.KL}#${g[0].id}`}))),await(0,N.hC)(t.id,{type:"import_shared_complete",importedGroups:g.map((t=>t.id))}).catch(i.lQ)}return}case"importShared":{const{groupId:t}=e;return!1}case"moveGroup":{const{groupId:t,targetGroupId:r}=e,i=this.getGroupIndexById(t),a=this.getGroupIndexById(r);if(i<0||i>=this._groups.length||a<0||a>=this._groups.length)return;this._groups.splice(a,0,this._groups.splice(i,1)[0]);const n=this.groupById(t);return void await this.saveState(s||(0,o.tr)("save_group_moved",`Group: "${n.getSavingInfo()}"`))}case"deleteGroup":{const{groupId:t}=e,r=this.groupById(t);if(r){this._groups=(0,c.M$)(this._groups,(t=>t.id===r.id));const t=(0,b._V)(r.id);this._groups.forEach((e=>{e.dials.forEach(((s,r)=>{s.url===t&&e.removeDial(r)}))})),await this.saveState(s||(0,o.tr)("save_group_deleted",r.getSavingInfo()))}return}case"updateGroup":{const{groupId:t,update:r,newPosition:a}=e,n=this.groupById(t),l=r.name;if(l&&l!==n.name){const e=(0,b._V)(t);this.GROUPS.forEach((s=>{s.id===t&&(s.name=l),s.dials.forEach((t=>{t.url===e&&(t.name=l)}))}))}return Object.assign(n,r),(0,i.qS)(a)&&(0,c.VE)(this._groups,this.getGroupIndexById(t),a),void await this.saveState(s||(0,o.tr)("save_group_edited",n.getSavingInfo()),{forceCallback:!0})}case"insertLinksToGroup":{const{groupId:t,links:r}=e,i=this.groupById(t),a=await Promise.all(r.map((t=>i.insertNewLink(t))));return(0,c.RD)(this._groups,(t=>t.id===i.id),i),await this.saveState(s||(0,o.tr)("save_dial_edited",this.getDialLogInfo(a.map((t=>t.dial.name)).join(", "),i))),a}case"removeDial":{const{groupId:t,index:r}=e,i=this.groupById(t),a=i.dials[r];return(0,l.D)(t,a),i.removeDial(r),void await this.saveState(s||(0,o.tr)("save_dial_removed",this.getDialLogInfo(a.name,i)))}case"resizeDial":{const{groupId:t,dial:r,dialSize:i}=e,a=this.groupById(t),n=(0,d.f)(t,a.dials,r,i);return void(n&&(a.dials=n,await this.saveState(s||(0,o.tr)("save_dial_resized",this.getDialLogInfo(r.name,a)))))}case"updateDialNameIfNeeded":{const{groupId:t,url:r,newName:i}=e,a=this.groupById(t),n=i.trim().slice(0,128),c=a.dials.filter((t=>t.url&&t.url===r&&t.name!==n&&(t.name===(0,f.QV)(r)||t.settings?.FETCH_NEW_NAME)));return void(n&&c.length>0&&(c.forEach((t=>t.name=n)),await this.saveState(s||(0,o.tr)("save_dial_names_saved",this.getDialLogInfo(c.map((t=>t.name)).join(", "),a)))))}case"replaceDial":case"replaceDials":{const{list:r}="replaceDial"===t?{list:[e]}:e;return r.forEach((({dial:t,groupId:e,gridPlacement:s})=>{const r=this.groupById(e);if(r.replaceDial(t,t.index),s&&r.grid){const e=z.J.create(r).placeItem(t,s);e&&(r.grid.areas=e.areas)}})),void await this.saveState(s||(0,o.tr)("save_dial_edited",this.getDialLogInfo(r.map((t=>t.dial.name)).join(", "),this.groupById(r[0]?.groupId))),{forceCallback:!0,editedDialsTypes:r.map((t=>t.dial.type))})}case"swapDials":{const{srcGroupId:t,destGroupId:r,srcDialIndex:a,destDialIndex:n,operation:d,gridPlacement:m}=e;if(t===r&&a===n)return;const w=this.groupById(t),f=this.groupById(r),y=w.dials[a],v=n<0?f.getOrCreateEmptyDialIndex():n,_=f.dials[v];switch(d){case"swap":case"cut":case"copy":const t="swap"===d?_:"copy"===d?y:"cut"===d?u.I.createEmptyDial(w.id):(0,i.qb)("n/a");if(w===f&&f.grid)f.grid.areas=new W.x(f.grid.areas).swapItems(y.created,_.created);else if(w.replaceDial(t,y.index),f.replaceDial(y,_.index),m&&f.grid&&_.isEmptyDial()){const t=z.J.create(f).placeItem(y,m);t&&(f.grid.areas=t.areas)}break;case"up":case"down":case"left":case"right":const e=function(t,e,s,r){const a="left"===r||"right"===r,n="left"===r||"up"===r,o=!n,l=a?"row":"column";let d=(0,h.QY)(l,e,s);const u=e=>(e.dial?.isEmptyDial()||e.dial===t)&&!e.dials,m=(0,i.t1)(u);d.every((t=>!u(t)))&&(0,h.Ks)(e,a?"column":"row"),d=(0,h.QY)(l,e,s);const w=(0,c.SL)(d,(t=>t.includes(s)));w<0&&(0,i.qb)("bad dial index");const f=[d.slice(w),d.slice(0,w+1).reverse()],[y,v]=f;n&&f.reverse();const[_]=f.filter((t=>t.some(u))),b=_===y,I=!b,D=g.M6.dialsToClusters(e.dials),A=(0,c.v6)(_,m,{closedInterval:!0});return(0,c.qm)(A).slice(b&&o||I&&n?1:0).map((([t,e])=>{const s=p(D,t),r=p(D,e);return s>=0&&r>=0?()=>(0,c.VE)(D,s,r):i.lQ})).reverse().forEach(i.g7),e.dials=g.M6.clustersToDials(D),_.find(u).dial}(y,f,_,d),s=w.getDialIndex(y),r=f.getDialIndex(e);w.replaceDial(e,s),f.replaceDial(y,r)}return await this.saveState(s||(0,o.tr)("save_dial_moved",this.getDialLogInfo(y.name,f))),t!==r&&(await O(y,t,r),"swap"===d&&await O(_,r,t)),(0,E.L)(t,r),void(0,l.D)(r)}case"moveDials":{const{srcGroupId:t,destGroupId:r,srcDialIndexes:a,destDialIndex:n,operation:c}=e,d=this.groupById(t),h=this.groupById(r),g=a.map((t=>d.dials[t])).filter((t=>t.isNotEmptyDial()));g.forEach((t=>d.replaceDial(new u.I(t.index,d.id,{}),t.index)));for(const e of g){const s=h.getOrCreateEmptyDialIndex(n),a=h.dials[s];h.replaceDial(e,a.index),t!==r&&await O(e,t,r).catch(i.lQ)}return await this.saveState(s||(0,o.tr)("save_dial_moved",this.getDialLogInfo(g.map((t=>t.name)).join(", "),h))),(0,E.L)(t,r),void(0,l.D)(r)}case"removeDials":{const{srcGroupId:t,srcDialIndexes:r}=e,i=this.groupById(t),a=r.map((t=>i.dials[t]));return a.forEach((t=>i.removeDial(t.index))),await this.saveState(s||(0,o.tr)("save_dial_removed",this.getDialLogInfo(a.map((t=>t.name)).join(", "),i))),(0,E.L)(t,i.id),void(0,l.D)(i.id)}case"addDial":{const{groupId:t,dial:r}=e,i=this.groupById(t);return i.dials=i.dials.concat(r),void await this.saveState(s||(0,o.tr)("save_dial_edited",this.getDialLogInfo(r.name,i)))}case"deleteDial":return void(0,i.SJ)();case"updateProductivity":{const{selectedGroups:t,selectedDialsPerGroup:s}=e,r=JSON.stringify(this.GROUPS);return this.GROUPS.forEach((e=>{t.has(e.id)?e.distraction={}:e.distraction&&delete e.distraction;const r=s.get(e.id);e.dials.forEach(((t,e)=>{r.has(e)?t.distraction={}:t.distraction&&delete t.distraction}))})),void(r!==JSON.stringify(this.GROUPS)&&await this.saveState((0,o.tr)("save_productivity_selection_changed")))}case"saveMasterPassword":{const{pwdId:t,options:s}=e;return this.METADATA.masterPassword={id:t,options:s,name:"master password"},void await this.saveState((0,o.tr)("save_new_master_password"))}case"removeMasterPassword":return this._groups=this._groups.filter((t=>!t.lock?.passwordId)),this.METADATA.masterPassword=void 0,await this.saveState((0,o.tr)("save_removed_master_password")),(0,N._z)({type:"broadcast",message:{type:"redraw_dials"}}),void self.location.reload();case"updateTags":{const{tags:t,operation:s}=e;return this.METADATA.tags=t.map((t=>new m.v(t.id,t.name,t.icon,t.color))),void await this.saveState((0,o.tr)("save_tags_updated")+" - "+s)}}}async saveState(t,{dontUpdateVersion:e=!1,version:s=Date.now(),forceCallback:r=!1,editedDialsTypes:a=Array(),setDirty:n=0}={}){const o={...this.serialize(),lastChangeInfo:{date:Date.now(),name:t,editedDialsTypes:a.filter(i.zz)},[this.DATA_IS_UP_TO_DATE.key]:n||0,...e?{}:{[I.W.key]:s}};r&&(o._forceCallback=Date.now(),(0,M.J)(o.groups.at(0),(t=>t._forceCallback=Date.now()))),await this._executor.addWork((async()=>{await Promise.all([Promise.race([(0,i.BK)(500),new Promise((t=>this._saveCallbacks.push(t)))]),browser.storage.local.set(o)]),await(0,i.BK)(1)}))}getDialLogInfo(t,e){return e.lock?(0,o.tr)("save_locked_group_change"):`Group: "${e.name}"; Dial: "${(t||"").slice(0,32)}"`}async wasRecentlyChanged(){const t=await this.DATA_LAST_CHANGE.get();return!!t&&t.date+(0,k.xF)(2)>Date.now()}async getRecentChangeInfo(){return(await this.DATA_LAST_CHANGE.get())?.name||""}async isDirty(){return 0===await this.DATA_IS_UP_TO_DATE.get()}async clearDirty(){await this.DATA_IS_UP_TO_DATE.reset()}groupById(t){return this.GROUPS.find((e=>e.id===t))||this.GROUPS[0]}dialByUrl(t,e){return this.groupById(t).dials.find((t=>"url"in t&&t.url===e))}dialByCreated(t){return(0,S.E)(this._groups,(e=>e.created===t))}async findDuplicateDial(t){return await async function(t,e){for(let s=0;s<t.length;s++){const r=t[s];if(await e(r,s,t))return r}}(this.GROUPS,(async e=>(await e.findDuplicates(t)).length>0))}cloneGroups(){return this.GROUPS.map((t=>t.clone()))}getVisibleGroups(t=!1){return(0,c.dS)(t?this.cloneGroups():this.GROUPS,(async t=>!t.lock||t.lock.visibility!==r.Gj.HIDDEN||await t.isUnlocked()))}getNewGroupId(){return 1+Math.max(-1,...this.GROUPS.map((t=>t.id)))}serialize(){return{groups:this._groups.map((t=>t.serialize())),metadata:this._metadata}}getGroupIndexById(t){return this._groups.findIndex((e=>e.id===t))}isEmpty(){return 0===this._groups.length}}},1589:(t,e,s)=>{s.d(e,{v:()=>n});var r=s(4067),i=s(4590),a=s(7302);class n{id;name;icon;color;static TOTAL_TAGS=68;static GROUP_TAG=65;constructor(t,e,s,r){this.id=t,this.name=e,this.icon=s,this.color=r}getIconStyle(){return(0,r.W)((0,a.Z)(`/icons/tags/tag (${this.icon}).svg`),this.color)}static getEmptyTag(){return new n(0,(0,i.tr)("tag_none"),0,"#888888")}}},7283:(t,e,s)=>{s.d(e,{H:()=>n,e:()=>a});var r=s(4067),i=s(7302);const a="var(--primary)",n=t=>(0,r.W)((0,i.Z)(t),"var(--primary)")},5229:(t,e,s)=>{s.d(e,{I:()=>i});var r=s(3672);const i=t=>t.startsWith("ext+container")?(0,r.u)(t,"url=","&",!0):t},6265:(t,e,s)=>{s.d(e,{w:()=>c});var r=s(9598),i=s(3694),a=s(3635),n=s(7302),o=s(4323);class c{index;id;type;value;static ALARM_PREFIX="timer_";static TIMER_INDEX_DATASET="data-timer-index";timerName;alarmName;static getTimerDataFromAlarm(t){if(!t.startsWith(this.ALARM_PREFIX))return null;const[e,s,r,i]=t.split("_").map((t=>parseInt(t)));return{timerType:s,dialCreated:r,timerIndex:i}}domNodes;isRefreshing;runningIcons;pausedIcons;stoppedIcons;getTime(){const[t=0,e=0,s=0]=this.value.split(":").map((t=>parseInt(t)||0));return{hours:t,minutes:e,seconds:s}}getSeconds(){const{hours:t,minutes:e,seconds:s}=this.getTime();return 3600*t+60*e+s}getMinutes(){return this.getSeconds()/60}constructor(t,e,s,i=""){this.index=t,this.id=e,this.type=s,this.value=i,this.timerName=`${c.ALARM_PREFIX}${this.type}`,this.alarmName=`${this.timerName}_${this.id}_${this.index}`,this.isRefreshing=!1,this.runningIcons=[1,0,0],this.pausedIcons=[0,0,0],this.stoppedIcons=[0,1,0];const a=(0,r.z)("div",{class:"timer_head"}),o=(0,r.z)("div",{class:"timer_body"}),l=(0,r.z)("div",{class:"timer_actions"},[(0,r.z)("img",{"data-stop":"1",class:"timer_action invert icon-button",src:(0,n.Z)("svg/stop.svg")}),(0,r.z)("img",{"data-play":"1",class:"timer_action invert icon-button",src:(0,n.Z)("svg/play.svg")}),(0,r.z)("img",{"data-pause":"1",class:"timer_action invert icon-button",src:(0,n.Z)("svg/pause.svg")})]),d=(0,r.z)("li",{class:`flex ${this.timerName}`,[c.TIMER_INDEX_DATASET]:this.index},[(0,r.z)("div",{class:"timer_left flex-column"},[a,o]),l]);this.domNodes={head:a,body:o,actions:l,container:d},this.domNodes.container.onclick=async t=>{const e=t.target.dataset;switch(!0){case!!e.play:await this.start();break;case!!e.pause:await this.pause();break;case!!e.stop:await this.stop();break;default:await this.defaultAction()}await this.updateBodyDOM(),this.registerRefresher()}}async pause(){return!1}defaultAction(){Array.from(this.domNodes.actions.querySelectorAll(".timer_action:not(.hidden)")).at(-1).click()}isRunning(){return this.getScheduledTime().then(Boolean)}isPaused(){return Promise.resolve(!1)}async updateBodyDOM(){const[t,e,s]=await Promise.all([this.renderBody(),this.isRunning(),this.isPaused()]);this.domNodes.body.replaceChildren(t);const r=s?this.pausedIcons:e?this.runningIcons:this.stoppedIcons;for(const t of[0,1,2])this.domNodes.actions.children.item(t).classList.toggle("hidden",!r[t]);this.domNodes.container.classList.toggle("timer_active",e&&!s)}async getScheduledTime(){const t=await browser.alarms.get(this.alarmName);if(!(t&&t.scheduledTime<Date.now()))return t?.scheduledTime}formatSeconds(t){const e=(0,i.Xm)(Math.round(t)).map((t=>t.toString().padStart(2,"0"))).map(((t,e,s)=>(0,r.z)("span",{textContent:`${t}${e+1===s.length?"":":"}`,class:"00"===t?"zeros":""})));return(0,r.z)("span",{class:"timer_time"},e)}async buildDOM(t){const[e]=await Promise.all([this.isRunning(),this.updateBodyDOM(),this.renderHead().then((t=>this.domNodes.head.replaceChildren(t)))]);if(e){t((()=>this.updateScrollTop()));this.registerRefresher()}return this.domNodes.container}updateScrollTop(){const t=this.domNodes.container.parentElement;if(!t)return;const{top:e,height:s}=this.domNodes.container.getBoundingClientRect(),{top:r,height:i}=t.getBoundingClientRect();e<r?t.scrollTop-=r-e:e+s>r+i&&(t.scrollTop+=e+s-r-i)}async registerRefresher(){if(!this.isRefreshing)for(this.isRefreshing=!0,await(0,a.Q)((()=>this.domNodes.container.isConnected),{delay:100,initDelay:100});this.isRefreshing;)this.domNodes.container.isConnected?await this.updateBodyDOM():this.isRefreshing=!1,await(0,o.BK)(200)}}},9998:(t,e,s)=>{s.d(e,{Jk:()=>i});var r=s(4069);s(9773),s(8671),s(8408);let i=!0;r.Vq.then((t=>{t&&(i=!1)}))},2665:(t,e,s)=>{var r=s(910);s(1055);new r.F("_bearer_tkn_",(()=>""),{storageArea:"local"})},1374:(t,e,s)=>{s.d(e,{BO:()=>u,E6:()=>l,M$:()=>o,RD:()=>c,SL:()=>a,VE:()=>h,dS:()=>g,qm:()=>p,v6:()=>n,vC:()=>d});var r=s(4214),i=(s(4261),s(683));function a(t,e){for(let s=0;s<t.length;s++)if(e(t[s]))return s;return-1}function n(t,e,{closedInterval:s=!1}={}){for(let r=0;r<t.length;r++)if(!e(t[r],r))return t.slice(0,s?r+1:r);return t.slice()}function o(t,e){return c(t,e)}function c(t,e,...s){for(let r=0;r<t.length;r++)if(e(t[r]))return t.splice(r,1,...s),t;return t}function l(t,e){for(let s=t.length-1;s>=0;s--)t[s]===e&&t.splice(s,1);return t}const d=(t,e)=>Object.values((0,r.W)(t,e));const u=t=>Array.isArray(t)?t:[t];function h(t,e,s){const r=t[e];return t[e]=t[s],t[s]=r,t}async function g(t,e,{executeSynchronously:s=!1}={}){const r=await(s?(0,i.f)(t.map(((t,s,r)=>()=>e(t,s,r)))):Promise.all(t.map(e)));return t.filter(((t,e)=>r[e]))}function p(t){const e=[];for(let s=0;s<t.length-1;s++)e.push([t[s],t[s+1]]);return e}},4261:(t,e,s)=>{},959:(t,e,s)=>{var r,i;s.d(e,{E:()=>r}),(t=>{t.sync="sync",t.local="local",t.session="session"})(r||(r={})),(t=>{t.loading="loading",t.complete="complete"})(i||(i={}))},7384:(t,e,s)=>{s.d(e,{p:()=>o});var r=s(4323),i=s(1374);const a=new Set,n=new Array;async function o(t,e){if(e&&(a.delete(t),await e()),!a.has(t))return new Promise(((e,s)=>{const a={tabId:t,resolve:e};n.push(a),(0,r.BK)(1e4).then((()=>{(0,i.E6)(n,a),s(new Error("timeout waiting for tab"))}))}))}browser.runtime.onMessage.addListener(((t,e)=>{if("___ext_tab_ready"===t.type){const t=e.tab?.id||0;a.add(t),n.forEach((({tabId:e,resolve:s})=>{e===t&&s()}))}}))},9114:(t,e,s)=>{s.d(e,{O:()=>r});const r=!!browser.extension.inIncognitoContext},7137:(t,e,s)=>{s.d(e,{x:()=>i});const r=new Map;async function i(t){if(r.has(t))return r.get(t);const e=browser.permissions.request({permissions:[t]}).catch((t=>!1));return r.set(t,e),e.finally((()=>r.delete(t)))}},7302:(t,e,s)=>{s.d(e,{Z:()=>i});s(9074);var r=s(1055);s(4323);const i=t=>r.x&&!browser?.runtime?t:browser.runtime.getURL(t)},7852:(t,e,s)=>{function r(t){const e=parseInt(t.replace("#",""),16);return[e>>16&255,e>>8&255,255&e]}s.d(e,{E:()=>r})},2062:(t,e,s)=>{s.d(e,{k:()=>i});var r=s(9254);class i{keyPromise;constructor(t){this.keyPromise=i.getWrappingKey(t)}async wrapKey(t){const e=await self.crypto.subtle.wrapKey("raw",t,await this.keyPromise,"AES-KW");return(0,r.JR)(e)}async unwrapKey(t){return self.crypto.subtle.unwrapKey("raw",(0,r.Al)(t),await this.keyPromise,"AES-KW","AES-GCM",!0,["encrypt","decrypt"])}static async getWrappingKey(t){const e=await self.crypto.subtle.importKey("raw",(0,r.Al)(t.hash),"PBKDF2",!1,["deriveBits","deriveKey"]);return self.crypto.subtle.deriveKey({name:"PBKDF2",salt:new Uint8Array(t.options.salt),hash:"SHA-256",iterations:t.options.iterations<=1e6?t.options.iterations:1e5},e,{name:"AES-KW",length:256},!0,["wrapKey","unwrapKey"])}}},4721:(t,e,s)=>{s.d(e,{d:()=>i});var r=s(4323);async function i(t,e){const s=(0,r.Kg)(t)?(new TextEncoder).encode(t):t;return Array.from(new Uint8Array(await self.crypto.subtle.digest(e,s))).map((t=>t.toString(16).padStart(2,"0"))).join("")}},9254:(t,e,s)=>{function r(t){return self.crypto.subtle.importKey("raw",(new TextEncoder).encode(t),"PBKDF2",!1,["deriveBits","deriveKey"])}function i(t){return String.fromCharCode(...new Uint8Array(t))}function a(t){const e=new ArrayBuffer(t.length),s=new Uint8Array(e);for(let e=0,r=t.length;e<r;e++)s[e]=t.charCodeAt(e);return s}function n(t){return Array.from(self.crypto.getRandomValues(new Uint8Array(t/8)))}s.d(e,{Al:()=>a,JR:()=>i,Tc:()=>r,gU:()=>n})},7398:(t,e,s)=>{s.d(e,{Er:()=>n,qi:()=>c});var r=s(4716),i=s(9254),a=s(2062);async function n(t,e){const{hint:s="",name:a="PBKDF2",salt:n=[...self.crypto.getRandomValues(new Uint8Array(16))],iterations:o=1e5,hash:c="SHA-256"}=e,l=await(0,i.Tc)(t),d=await(0,r.e)(`Hashing with: ${a}, ${c}, ${o.toLocaleString()}`,(()=>self.crypto.subtle.deriveBits({name:a,salt:new Uint8Array(n),iterations:o,hash:c},l,256)));return{hash:(0,i.JR)(d),options:{name:a,salt:n,iterations:o,hash:c,hint:s,..."secret"in e?{secret:e.secret}:{}}}}async function o(t,e,s={}){const r=await n(t,s),i=await new a.k(r).wrapKey(e);return{hash:r.hash,options:{...r.options,secret:i}}}async function c(t,e,s,r={}){const i=await o(t,s,r),a=await o(e,s,{iterations:r.iterations||1e6,salt:[...self.crypto.getRandomValues(new Uint8Array(r.salt?.length||16))]});return{hash:i.hash,options:{...i.options,recoverySecret:a.options.secret,recoverySalt:a.options.salt}}}},3694:(t,e,s)=>{s.d(e,{Sy:()=>r,Xm:()=>n,aG:()=>a,dR:()=>i});const r=()=>Math.floor(Date.now()/1e3);function i(t,e,s,r){const i=new Date;return function(t,e){const s=e-t.getDay();t.setDate(t.getDate()+s)}(i,t),i.setHours(e,s,r,0),i}function a(t=new Date,e){return e(t),t.getTime()}function n(t){const e=t<0?"ceil":"floor";return t?[Math[e](t/3600),Math[e](t%3600/60),t%60]:[0,0,0]}},9180:(t,e,s)=>{s.d(e,{$L:()=>n,n:()=>r,xE:()=>a,xF:()=>i});const r=t=>1e3*t,i=t=>6e4*t,a=t=>36e5*t,n=t=>Math.round(t/6e4)},170:(t,e,s)=>{s.d(e,{Q:()=>r});s(6062);function r(){0}},4069:(t,e,s)=>{s.d(e,{EL:()=>r,Vq:()=>a,cI:()=>n,m0:()=>i});s(4648);async function r(){return browser.runtime.getBrowserInfo?browser.runtime.getBrowserInfo().then((t=>parseInt(t.version))):0}let i=!1;const a=browser.runtime.getPlatformInfo?.().then((t=>i="android"===t.os))||Promise.resolve(!1);let n=!0;a.then((t=>n=!t))},4648:(t,e,s)=>{s.d(e,{J:()=>r});const r=()=>"moz-extension:"!==self.location.protocol},6062:(t,e,s)=>{s.d(e,{Dy:()=>r,XM:()=>i});const r=self.location.href===browser.runtime.getManifest().background?.page||"/_generated_background_page.html"===self.location.pathname;const i=()=>self.location.href===browser.runtime.getManifest().options_ui.page},9773:(t,e,s)=>{},9451:(t,e,s)=>{s.d(e,{g:()=>r});const r=new(s(910).F)("_errorLogger",(()=>Array()),{storageArea:"session"})},5524:(t,e,s)=>{s.d(e,{cO:()=>o,t$:()=>l,vV:()=>c});var r=s(4323),i=s(6062),a=s(9451);const n=t=>a.g.update((e=>{const s=JSON.stringify(t);return s.length>1e4&&(t={name:"Error message is too long",time:Date.now(),context:"x",data:s.slice(0,5e3)+"... (truncated) ..."+s.slice(-100)}),e.push(t),e.slice(-50)}));function o(t,e){const s={name:e?t+" | "+d(e):t,time:Date.now(),context:i.Dy?"bc":"fr"};n(s)}function c(t,e,s){const r=Error().stack,a={name:t,context:i.Dy?"bc":"fr",errName:e?.name||e?.target?.error?.name,errMessage:e?.message||e?.target?.error?.message,err:String(e),data:d(s),time:Date.now(),stack:r};n(a)}function l(t,e){return s=>(c(t,s,e),Promise.reject(s))}function d(t){try{return(0,r.Kg)(t)?t:JSON.stringify(t)}catch(e){return String(t)}}},2801:(t,e,s)=>{s.d(e,{V:()=>a});var r=s(4323),i=s(1374);class a{maxConcurrentJobs;options;_work;_runningJobs;_lastRunDoneTime;constructor(t=1,e={}){this.maxConcurrentJobs=t,this.options=e,this._work=this.options.initialWork||[],this._runningJobs=[],this._lastRunDoneTime=0}hasFreeSlot(){return this._runningJobs.length<(0,r.oA)(this.maxConcurrentJobs)}getRunningJobsCount(){return this._runningJobs.length}getPendingJobsCount(){return this._work.length}async addWork(t,e){if(this.options.uniquePredicate){const t=t=>this.options.uniquePredicate(t.info,e),s=this._work.find(t)||this._runningJobs.find(t);if(s)return s.getPromise()}const s=new Promise(((r,a)=>{const n={info:e,getPromise:()=>s,fn:()=>{const s=t();s.finally((async()=>{(0,i.E6)(this._runningJobs,n),this.options.afterEach&&await this.options.afterEach(e),s.then(r,a).finally((()=>{Promise.resolve().then((()=>this.startWork())),this._lastRunDoneTime=Date.now()}))}))}};this._work.push(n),this.startWork()}));return s}async startWork(){if(this.options.minDelayAfterRun&&this._work.length>0){const t=Date.now()-this._lastRunDoneTime;t<this.options.minDelayAfterRun&&await(0,r.BK)(this.options.minDelayAfterRun-t)}for(;this._work.length>0&&this._runningJobs.length<(0,r.oA)(this.maxConcurrentJobs)&&(0===this._runningJobs.length||!this.options.canRunWithOthers||this.options.canRunWithOthers(this._work[0].info,this._runningJobs.map((t=>t.info))));){const t=this._work.shift();this._runningJobs.push(t),this.options.beforeEach&&await this.options.beforeEach(t.info),t.fn()}}}},9574:(t,e,s)=>{function r(t){let e,s=!1;return(...r)=>s?e:(s=!0,e=t(...r))}s.d(e,{m:()=>r})},683:(t,e,s)=>{s.d(e,{f:()=>i});var r=s(4323);async function i(t,{beforeEach:e=r.lQ,afterEach:s=r.lQ,ignoreExceptions:i=!1}={}){const a=Array(t.length);for(let r=0;r<t.length;r++){await e(r);const n=t[r],o=await(i?n().then((t=>[t])).catch((t=>[void 0,t||"unknown GSD error"])):n().then((t=>[t])));a[r]=o,await s(r,o)}return a}},2780:(t,e,s)=>{s.d(e,{v:()=>r});class r{mode;workList;isRunning;constructor(t){this.mode=t,this.workList=[],this.isRunning=!1}addWork(t){return new Promise((e=>{this.workList.push({job:t,resolve:e}),this.startWork()}))}async startWork(){if(!this.isRunning&&this.workList.length){switch(this.isRunning=!0,this.mode){case"one_by_one":{const{job:t,resolve:e}=this.workList.shift();await t().then(e);break}case"one_by_last_one":const t=this.workList.slice();this.workList.length=0;const{job:e,resolve:s}=t.at(-1);await e(),t.forEach((t=>t.resolve()))}this.isRunning=!1,this.startWork()}}}},3635:(t,e,s)=>{s.d(e,{Q:()=>i});var r=s(4323);async function i(t,{delay:e,initDelay:s,maxDelay:i}){for(s&&await(0,r.BK)(s);;){const s=await t();if(s)return s;await(0,r.BK)(e),e*=2,i&&(e=Math.min(e,i))}}},9676:(t,e,s)=>{s.d(e,{w:()=>i});var r=s(4323);function i(t,e,s){return new Promise(((i,a)=>{const n=setTimeout((()=>{try{i((0,r.oA)(e))}catch(t){a(t)}}),t);s().finally((()=>{clearTimeout(n)})).then(i,a)}))}},8063:(t,e,s)=>{s.d(e,{F:()=>o});var r=s(235),i=s(4323),a=s(9180);const n=new Map;async function o(t){const e=n.get(t)||fetch(t,{signal:(0,r.n)(12e3)});n.set(t,e);const s=await e;return(0,i.BK)((0,a.xF)(5)).then((()=>n.delete(t))),s.clone()}},235:(t,e,s)=>{function r(t){const e=new AbortController;return setTimeout((()=>e.abort()),t),e.signal}s.d(e,{n:()=>r})},1009:(t,e,s)=>{s.d(e,{E:()=>a});var r=s(1434),i=s(8063);async function a(t,e=!0){const s=await(await(e?i.F:fetch)(t)).text(),[{nodes:a}]=await(0,r.$)(s,[{query:"head > title",attributes:["textContent"]}]);return a?.at(0)?.textContent.trim()||""}},8282:(t,e,s)=>{s.d(e,{P4:()=>i,pf:()=>r});const r="about:blank",i="<all_urls>"},9598:(t,e,s)=>{s.d(e,{u:()=>n,z:()=>a});var r=s(4323);const i=new Set(["svg","path","circle","text"]);function a(t,e,s=[]){const a=i.has(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);if(e){const t=(0,r.Kg)(e)?{textContent:e}:e;Object.entries(t).forEach((([e,s])=>{switch(e){case"text":case"textContent":a[e]=s;break;case"handlers":Object.assign(a,t.handlers);break;default:a.setAttribute(e,s)}}))}for(const t of s)a.appendChild(t);return a}function n(t,e){const s=document.createElement(t);return s.textContent=e,s}},3773:(t,e,s)=>{function r(t,e){const s=(new self.DOMParser).parseFromString(t,"text/html");return e.map((({query:t,attributes:e})=>({query:t,nodes:Array.from(s.querySelectorAll(t)).map((t=>Object.fromEntries(e.map((e=>[e,("textContent"===e?t.textContent:t.getAttribute(e))||""])))))})))}s.d(e,{x:()=>r})},1434:(t,e,s)=>{s.d(e,{$:()=>a});var r=s(9676),i=s(3773);async function a(t,e){if(self.DOMParser)return(0,i.x)(t,e);{const s={type:"_ext_dom_extractor_query",htmlText:t,queries:e},i=await(0,r.w)(5e3,null,(()=>browser.runtime.sendMessage(s).catch((()=>null))));if(i)return i}const s=(await browser.tabs.query({discarded:!1})).filter((t=>t.url?.startsWith("http"))).sort(((t,e)=>+e.active-+t.active)).slice(0,5);for(const a of s)try{return await(0,r.w)(5e3,(()=>Promise.reject()),(()=>browser.scripting.executeScript({target:{tabId:a.id,allFrames:!1},args:[t,e],func:i.x}).then((([t])=>t.result||e.map((t=>({query:t.query,nodes:[]})))))))}catch(t){}throw"DOMParser not available"}},1361:(t,e,s)=>{s.d(e,{G:()=>i});var r=s(4323);class i{_handlers=[];constructor(){}clearAll(){(0,r.XB)(this._handlers)}addListener(t,e,s,r){t.addEventListener(e,s,r),this._handlers.push((()=>t.removeEventListener(e,s,r)))}addClass(t,e){t.classList.add(e),this._handlers.push((()=>t.classList.remove(e)))}addOnClearHandler(t){this._handlers.push(t)}}},6004:(t,e,s)=>{s.d(e,{nl:()=>r});s(4323),s(8168),s(4590),s(7302),s(1962),s(9598),s(5076);function r(t){const e=document.createDocumentFragment();for(let s=0;s<t.length;s++)e.appendChild(t[s]);return e}},1962:(t,e,s)=>{s.d(e,{$H:()=>a,$b:()=>i,EW:()=>n,RO:()=>r});const r="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",i="firefox",a=t=>document.getElementById(t);function n(t){return t?t.target:void 0}},4590:(t,e,s)=>{s.d(e,{P$:()=>n,ZB:()=>c,tr:()=>o});var r=s(4323);s(1374);const[i,a]=(0,r.Mj)(),n=Promise.resolve(),o=(t,e)=>t?browser.i18n.getMessage(t,e):"",c=(t,...e)=>o(t,e.map((t=>String(t))));new Map},4067:(t,e,s)=>{s.d(e,{W:()=>r});const r=(t,e)=>`background-color: ${e};\n-webkit-mask: url('${t}') center center / contain no-repeat;\nmask: url('${t}') center center / contain no-repeat;`},2460:(t,e,s)=>{s.d(e,{RM:()=>r});const r=t=>{let e=0;for(let s=0;s<t.length;s++)e+=t[s];return e}},9100:(t,e,s)=>{s.d(e,{n:()=>r});const r=(t,e,s)=>Math.max(t,Math.min(e,s||0))},7526:(t,e,s)=>{s.d(e,{V:()=>r});const r=(()=>{let t=0;return()=>++t})()},4214:(t,e,s)=>{function r(t,e){const s={};if(!t)return s;for(let r=0;r<t.length;r++){const i=t[r];s[i[e]]=i}return s}s.d(e,{W:()=>r})},1470:(t,e,s)=>{function r(t,e){return function(t){const e=Object.getOwnPropertyNames(t);for(let s=0;s<e.length;s++)delete t[e[s]]}(t),Object.assign(t,e)}s.d(e,{FP:()=>a,PT:()=>r,uJ:()=>i});const i=(t,...e)=>(e.forEach((e=>delete t[e])),t),a=(t,e)=>Object.keys(t).reduce(((s,r)=>(s[r]=t[r]-e[r],s)),{})},6382:(t,e,s)=>{s.d(e,{c:()=>r});class r{subscribers=[];addOnChange(t){this.subscribers.push(t)}removeOnChange(t){this.subscribers=this.subscribers.filter((e=>e!==t))}hasOnChange(t){return this.subscribers.includes(t)}notifyChange(t){this.subscribers.forEach((e=>{try{e(t)}catch(t){}}))}}},9944:(t,e,s)=>{s.d(e,{s:()=>r,y:()=>i});const r=t=>"fulfilled"===t.status,i=t=>t instanceof Promise},1282:(t,e,s)=>{s.d(e,{tX:()=>r});const r=(t,e)=>new Set([...t].filter((t=>!e.has(t))))},5360:(t,e,s)=>{function r(t,{arraySeparator:e=""}={}){const s=new Map;return r=>{const i=Array.isArray(r)?r.join(e):r;if(s.hasOwnProperty(i))return s.get(i);{const e=t(r);return s.set(i,e),e}}}s.d(e,{M:()=>r})},2447:(t,e,s)=>{s.d(e,{e:()=>r});class r{key;getDefaultValue;storageArea;constructor(t,e,s="localStorage"){this.key=t,this.getDefaultValue=e,this.storageArea=s}set(t){try{self[this.storageArea].setItem(this.key,JSON.stringify(t))}catch(t){}return t}reset(){this.set(this.getDefaultValue())}remove(){try{self[this.storageArea].removeItem(this.key)}catch(t){}}get(){try{return JSON.parse(self[this.storageArea].getItem(this.key)||"")}catch(t){return this.getDefaultValue()}}}},2441:(t,e,s)=>{s.d(e,{_:()=>r});class r extends Map{get(t){return super.get(t)||[]}has(t){return this.get(t).length>0}push(t,e){const s=this.get(t);return s.push(e),super.set(t,s)}remove(t,e){const s=this.get(t),r=s.findIndex(e);return r>=0?(s.splice(r,1),0===s.length&&super.delete(t),1):0}}},910:(t,e,s)=>{s.d(e,{F:()=>g});var r=s(4323),i=s(8815),a=s(2801),n=s(9574),o=s(9944),c=s(6062),l=s(4648),d=s(170),u=s(959);class h{key;options;_listeners;_listenForChangesFn;storageArea;constructor(t,e={storageArea:"local"}){this.key=t,this.options=e,this._listeners=Array(),this._listenForChangesFn=(0,n.m)((()=>{u.E[this.storageArea]&&browser.storage[this.storageArea].onChanged.addListener((t=>{t[this.key]&&this._listeners.forEach((e=>e(t[this.key])))}))})),this.storageArea=e.storageArea}async addOnChangeListener(t,{dummyInitValue:e}={}){if(this._listeners.push(t),(0,d.Q)(),this._listenForChangesFn(),e){const s=(0,o.y)(e)?await e:e;t({newValue:s,oldValue:s})}}}class g extends h{key;getDefaultValue;options;_updateExecutor;_setExecutor;get legacyStore(){return"localStorage"===this.storageArea?self.localStorage:self.sessionStorage}constructor(t,e,s={storageArea:"local"}){super(t,s),this.key=t,this.getDefaultValue=e,this.options=s,this._updateExecutor=new a.V,this._setExecutor=new a.V}async reset(){return this.set(await this.getDefaultValue())}async orDefault(t){return t.hasOwnProperty(this.key)?t[this.key]:await this.getDefaultValue()}async get(){const t="custom"===this.storageArea?await this.options.customDataSource.get()||await this.getDefaultValue():"remote"===this.storageArea?await(await fetch(this.options.remoteApi.url,await this.getRequestInit())).json()||await this.getDefaultValue():"localStorage"===this.storageArea||"sessionStorage"===this.storageArea?this.options.localStorageTextOnly?(0,i.g)((()=>this.legacyStore.getItem(this.key)),(()=>""))||await this.getDefaultValue():await(0,i.g)((()=>JSON.parse(this.legacyStore.getItem(this.key)||"")),(()=>this.getDefaultValue())):await browser.storage[this.storageArea].get(this.key).then((t=>this.orDefault(t)));return this.options.onBeforeLoad?await this.options.onBeforeLoad(t):t}async remove(){return"custom"===this.storageArea?await this.options.customDataSource.remove():"remote"===this.storageArea?(await fetch(this.options.remoteApi.url,await this.getRequestInit("DELETE"))).json():"localStorage"===this.storageArea||"sessionStorage"===this.storageArea?(0,i.g)((()=>this.legacyStore.removeItem(this.key))):browser.storage[this.storageArea].remove(this.key)}async update(t){return this._updateExecutor.addWork((()=>this.get().then(t).then((t=>this.set(t)))))}async set(t){return this._setExecutor.addWork((async()=>{t=this.options.onBeforeSave?await this.options.onBeforeSave(t):t;const e=await("custom"===this.storageArea?await this.options.customDataSource.set(t):"remote"===this.storageArea?void await fetch(this.options.remoteApi.url,await this.getRequestInit("POST",JSON.stringify(t))):"localStorage"===this.storageArea||"sessionStorage"===this.storageArea?(0,i.g)((()=>this.legacyStore.setItem(this.key,this.options.localStorageTextOnly?String(t):JSON.stringify(t)))):browser.storage[this.storageArea].set({[this.key]:t}));return"session"===this.storageArea&&await(0,r.BK)(1),e}))}async setWith(t,e){return"remote"===this.storageArea||"custom"===this.storageArea||"localStorage"===this.storageArea||"sessionStorage"===this.storageArea?(0,r.qb)("missing"):browser.storage[this.storageArea].set(Object.assign({[this.key]:t},e))}async getWith(...t){const e=t.map((t=>(0,r.Kg)(t)?t:t.key)),s="remote"===this.storageArea||"custom"===this.storageArea||"localStorage"===this.storageArea||"sessionStorage"===this.storageArea?(0,r.qb)("missing"):await browser.storage[this.storageArea].get([this.key,...e]),i=await this.orDefault(s),a=t.map((async t=>(0,r.Kg)(t)?s[t]:await t.orDefault(s)));return[i,...await Promise.all(a)]}async getRequestInit(t="GET",e){const s=await(0,r.oA)(this.options.remoteApi.GET_Headers),i=await(this.options.remoteApi.authToken?.());return{method:t,body:e,...s,...i?{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json",...s?.headers}}:{}}}}(0,l.J)()?browser.storage.session={get:t=>browser.runtime.sendMessage({type:"_session_store_get",key:t}),set:t=>browser.runtime.sendMessage({type:"_session_store_set",items:t}),remove:t=>browser.runtime.sendMessage({type:"_session_store_remove",key:t}),clear:()=>Promise.resolve(),onChanged:{addListener:()=>({removeListener:()=>{}}),removeListener:()=>({removeListener:()=>{}}),hasListener:()=>!1}}:c.Dy&&browser.runtime.onMessage.addListener((t=>{switch(t.type){case"_session_store_get":return browser.storage.session.get(t.key);case"_session_store_set":return browser.storage.session.set(t.items);case"_session_store_remove":return browser.storage.session.remove(t.key)}}))},7548:(t,e,s)=>{s.d(e,{Q:()=>a});var r=s(1470),i=s(959);async function a(t,e){const s=t.storageArea;i.E[s]&&browser.storage[s].onChanged.addListener((s=>{s[t.key]&&(0,r.PT)(e,s[t.key].newValue||{})}));const a=await t.get();if(!a)return await t.set(e),e;return Object.entries(e).filter((([t])=>!a.hasOwnProperty(t))).map((([t,e])=>a[t]=e)).length>0&&await t.set(a),(0,r.PT)(e,a||{})}},8408:(t,e,s)=>{s.d(e,{K:()=>c});var r=s(2352),i=s(6062),a=s(4323),n=s(1374),o=s(4069);async function c(t,e={}){const s=(0,n.BO)(t),{cookieStoreId:c,inNewTab:d=!1,nextToCurrent:u=!1,active:h=!1,inNewWindow:g=!1,windowId:p,windowOptions:m={},forceIncognitoWindow:w=!1,stopOpenerTabId:f,_directCall:y}=e,v=g||w;if(!i.Dy&&!y)return function(t,e){if(e._directCall)throw Error("infinite loop???");return e._directCall=!0,browser.runtime.sendMessage(new l(t,e))}(s,e);const _=c,b=_?{cookieStoreId:c}:{},[I,...D]=s,A=await E(I,0,p);return D.forEach(((t,e)=>E(t,e+1,A.windowId))),A;async function E(t,e,s){const i=_&&!d&&!v&&0===e;if(v)return browser.windows.create({url:t,...m,...b,...w?{incognito:!0}:{}}).then((t=>t?.tabs[0]));if(d||i||e>0){const n=h&&0===e,c=await(0,r.e6)()||{id:void 0,index:void 0},l=(0,a.f3)(c.index)?c.index+1:void 0,d=o.m0||!!f,g=e=>browser.tabs.create({url:t,...b,windowId:s,active:n,...u?{index:l}:{},...e?{}:{openerTabId:c.id}}),p=d?await g(d):await g(d).catch((()=>g(!0)));return i&&c.id&&browser.tabs.remove(c.id),p}return await browser.tabs.update({url:t})}}class l{links;options;type;constructor(t,e){this.links=t,this.options=e,this.type="openURL"}}i.Dy&&browser.runtime.onMessage.addListener((t=>{if("openURL"===t.type)return c(t.links,t.options)}))},2352:(t,e,s)=>{s.d(e,{FA:()=>a,HG:()=>n,e6:()=>i});var r=s(4069);async function i(){const[t]=await browser.tabs.query(r.m0?{active:!0}:{active:!0,lastFocusedWindow:!0});return t}const a=i,n=()=>browser.tabs.getCurrent().then((t=>t?.id?browser.tabs.remove(t.id):void 0))},3672:(t,e,s)=>{function r(t,e,s,r){let i=0,a=0,n=t.length;return e&&(i=(a=t.indexOf(e))+e.length),s&&(n=t.indexOf(s,i)),n<0&&r&&(n=t.length),n<0||a<0?"":t.substring(i,n)}s.d(e,{u:()=>r})},8168:(t,e,s)=>{s.d(e,{BB:()=>r});const r=t=>t.charAt(0).toUpperCase()+t.substring(1)},8671:(t,e,s)=>{},4716:(t,e,s)=>{s.d(e,{e:()=>i});class r{name;options;startTime;stopTime;logger;performance;constructor(t,e={}){this.name=t,this.options=e,this.startTime=0,this.stopTime=0,this.logger=this.options.logger||console,this.performance=this.options.performance||self.performance,this.options=Object.assign({startNow:!0,round:!0,logTimeAbove:0},e),this.options.startNow&&this.start()}start(){this.startTime=this.performance.now()}stop(t=""){if(!this.options.enableInProd)return;this.stopTime=this.performance.now();const e=this.stopTime-this.startTime;if(e<this.options.logTimeAbove)return;const s=`${this.name} ${t} time: ${(this.options.round?Math.round(e):e).toLocaleString("en-US")}`;return this.logger.log(s),s}diff(t=""){const e=this.startTime;this.stopTime&&(this.startTime=this.stopTime);const s=this.stop(t);return this.startTime=e,s}}async function i(t,e,s){const i=new r(t,s),a=await e();return i.stop(),a}},5076:(t,e,s)=>{function r(t,e){if(null!=t)return e(t)}s.d(e,{J:()=>r})},3456:(t,e,s)=>{s.d(e,{k:()=>i});var r=s(1374);class i{_listeners=[];constructor(){}register(t){this._listeners.push(t)}unregister(t){(0,r.E6)(this._listeners,t)}notifyAll(t){this._listeners.forEach((e=>e(t)))}}},8815:(t,e,s)=>{function r(t,e){try{return t()}catch(t){return e?.(t)}}s.d(e,{g:()=>r})},6672:(t,e,s)=>{s.d(e,{K9:()=>n,QV:()=>i,lX:()=>a});var r=s(8168);const i=(t="")=>(0,r.BB)(t.trim().replace(/.*:\/\/(www\.)?|^www\./,"").replace(/\/$/,""));function a(t,e=!1){try{const s=new URL(t).hostname;return e&&s.startsWith("www.")?s.substring(4):s}catch(t){return""}}function n(t){return/^https?:\/\/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/.test(t)}},4323:(t,e,s)=>{s.d(e,{BK:()=>b,Et:()=>p,Kg:()=>u,Lm:()=>h,Lt:()=>c,Mj:()=>I,SJ:()=>d,WR:()=>_,XB:()=>v,bJ:()=>i,f3:()=>m,g7:()=>y,lQ:()=>r,oA:()=>w,qS:()=>g,qb:()=>l,s6:()=>n,t1:()=>o,x2:()=>a,zz:()=>f});const r=(...t)=>{},i=(...t)=>!1,a=(...t)=>!0,n=(...t)=>{},o=t=>(...e)=>!t(...e),c=t=>async(...e)=>!await t(...e),l=t=>{throw Error(t)},d=()=>l("not implemented"),u=t=>"string"==typeof t,h=t=>"boolean"==typeof t,g=t=>"number"==typeof t,p=t=>(t=>!isNaN(t-parseFloat(t)))(t),m=t=>Number.isFinite(t),w=t=>"function"==typeof t?t():t,f=t=>!!t,y=t=>t(),v=(t,e=[])=>{let s;for(;s=t.pop();)s.apply(null,e)},_=t=>JSON.parse(JSON.stringify(t)),b=t=>new Promise((e=>setTimeout(e,t)));function I(){let t,e;return[new Promise(((s,r)=>{t=s,e=r})),t,e]}},1055:(t,e,s)=>{s.d(e,{x:()=>r});const r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}},r={};function i(t){var e=r[t];if(void 0!==e)return e.exports;var a=r[t]={exports:{}};return s[t].call(a.exports,a,a.exports,i),a.exports}i.m=s,i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.f={},i.e=t=>Promise.all(Object.keys(i.f).reduce(((e,s)=>(i.f[s](t,e),e)),[])),i.u=t=>(({353:"unlock_vault_module",702:"vuetify_module"}[t]||t)+".js"),i.miniCssF=t=>(({353:"unlock_vault_module",702:"vuetify_module"}[t]||t)+".css"),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="group_speed_dial:",i.l=(s,r,a,n)=>{if(t[s])t[s].push(r);else{var o,c;if(void 0!==a)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==s||u.getAttribute("data-webpack")==e+a){o=u;break}}o||(c=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.setAttribute("data-webpack",e+a),o.src=s),t[s]=[r];var h=(e,r)=>{o.onerror=o.onload=null,clearTimeout(g);var i=t[s];if(delete t[s],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach((t=>t(r))),e)return e(r)},g=setTimeout(h.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=h.bind(null,o.onerror),o.onload=h.bind(null,o.onload),c&&document.head.appendChild(o)}},i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.p="/",(()=>{if("undefined"!=typeof document){var t=t=>new Promise(((e,s)=>{var r=i.miniCssF(t),a=i.p+r;if(((t,e)=>{for(var s=document.getElementsByTagName("link"),r=0;r<s.length;r++){var i=(n=s[r]).getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(i===t||i===e))return n}var a=document.getElementsByTagName("style");for(r=0;r<a.length;r++){var n;if((i=(n=a[r]).getAttribute("data-href"))===t||i===e)return n}})(r,a))return e();((t,e,s,r,a)=>{var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",i.nc&&(n.nonce=i.nc),n.onerror=n.onload=s=>{if(n.onerror=n.onload=null,"load"===s.type)r();else{var i=s&&s.type,o=s&&s.target&&s.target.href||e,c=new Error("Loading CSS chunk "+t+" failed.\n("+i+": "+o+")");c.name="ChunkLoadError",c.code="CSS_CHUNK_LOAD_FAILED",c.type=i,c.request=o,n.parentNode&&n.parentNode.removeChild(n),a(c)}},n.href=e,s?s.parentNode.insertBefore(n,s.nextSibling):document.head.appendChild(n)})(t,a,null,e,s)})),e={0:0};i.f.miniCss=(s,r)=>{e[s]?r.push(e[s]):0!==e[s]&&{353:1,525:1,702:1}[s]&&r.push(e[s]=t(s).then((()=>{e[s]=0}),(t=>{throw delete e[s],t})))}}})(),(()=>{var t={0:0};i.f.j=(e,s)=>{var r=i.o(t,e)?t[e]:void 0;if(0!==r)if(r)s.push(r[2]);else{var a=new Promise(((s,i)=>r=t[e]=[s,i]));s.push(r[2]=a);var n=i.p+i.u(e),o=new Error;i.l(n,(s=>{if(i.o(t,e)&&(0!==(r=t[e])&&(t[e]=void 0),r)){var a=s&&("load"===s.type?"missing":s.type),n=s&&s.target&&s.target.src;o.message="Loading chunk "+e+" failed.\n("+a+": "+n+")",o.name="ChunkLoadError",o.type=a,o.request=n,r[1](o)}}),"chunk-"+e,e)}};var e=(e,s)=>{var r,a,[n,o,c]=s,l=0;if(n.some((e=>0!==t[e]))){for(r in o)i.o(o,r)&&(i.m[r]=o[r]);if(c)c(i)}for(e&&e(s);l<n.length;l++)a=n[l],i.o(t,a)&&t[a]&&t[a][0](),t[a]=0},s=globalThis.webpackChunkgroup_speed_dial=globalThis.webpackChunkgroup_speed_dial||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})();var a=i(4323),n=i(4648),o=i(7302),c=i(1055),l=i(6382);const d=()=>[];const u=void 0;class h extends l.c{storageArea;onChanged;constructor(t){super(),this.storageArea=t,this.onChanged=new BroadcastChannel(`web_ext_storage.${this.storageArea}.onChanged`),this.onChanged.onmessage=t=>{const e=t.data;this.notifyChange(e)},this.onChanged.onmessageerror=console.error}async notifyAllContexts(t){this.notifyChange(t),await u,this.onChanged.postMessage(t)}async withDb(t){const e=self.indexedDB.open(`web_ext_storage.${this.storageArea}`,1);return new Promise(((t,s)=>{e.onerror=()=>s(e.error),e.onsuccess=()=>t(e.result),e.onupgradeneeded=()=>{const t=e.result;t.objectStoreNames.contains("data")||t.createObjectStore("data",{keyPath:"key"})}})).then(t).finally((()=>e.result.close()))}async getMultipleItems(t,e){const s=e.map((e=>new Promise(((s,r)=>{const i=t.get(e);i.onerror=()=>r(i.error),i.onsuccess=()=>s(i.result)}))));return Object.fromEntries((await Promise.all(s)).filter(a.zz).map((t=>[t.key,t.value])))}async get(t){return this.withDb((async e=>{const s=e.transaction("data","readonly").objectStore("data");if(Array.isArray(t))return this.getMultipleItems(s,t);const r=s.getAll(t);return new Promise(((t,e)=>{r.onerror=()=>e(r.error),r.onsuccess=()=>t(r.result.reduce(((t,{key:e,value:s})=>(t[e]=s,t)),{}))}))}))}async set(t){return this.withDb((async e=>{const s=e.transaction("data","readwrite"),r=s.objectStore("data"),i=await this.getMultipleItems(r,Object.keys(t)),a={};for(const[e,s]of Object.entries(t))r.put({key:e,value:s}),a[e]={oldValue:i[e],newValue:s};return new Promise(((t,e)=>{s.onerror=()=>e(s.error),s.oncomplete=()=>{this.notifyAllContexts(a),t()}}))}))}async remove(t){return this.withDb((async e=>{const s=e.transaction("data","readwrite"),r=s.objectStore("data");t=Array.isArray(t)?t:[t];const i=await this.getMultipleItems(r,t);for(const e of t)r.delete(e);return new Promise(((e,r)=>{s.onerror=()=>r(s.error),s.oncomplete=()=>{const s={};for(const e of t)s[e]={oldValue:i[e]};this.notifyAllContexts(s),e()}}))}))}async clear(){return this.withDb((async t=>{const e=t.transaction("data","readwrite");return e.objectStore("data").clear(),new Promise(((t,s)=>{e.onerror=()=>s(e.error),e.oncomplete=()=>t()}))}))}async getBytesInUse(){return this.withDb((async t=>{const e=t.transaction("data","readonly").objectStore("data").getAll();return new Promise(((t,s)=>{e.onerror=()=>s(e.error),e.onsuccess=()=>{const s=e.result.reduce(((t,{key:e,value:s})=>t+e.length+JSON.stringify(s).length),0);t(s)}}))}))}static getBrowserPolyfill(t){const e=new h(t);return"session"===t&&c.x&&self.addEventListener("activate",(()=>e.clear())),{get:e.get.bind(e),set:e.set.bind(e),remove:e.remove.bind(e),clear:e.clear.bind(e),getBytesInUse:e.getBytesInUse.bind(e),onChanged:{addListener:e.addOnChange.bind(e),removeListener:e.removeOnChange.bind(e),hasListener:e.hasOnChange.bind(e)}}}}i(5076);var g=i(9574);class p{_callback;promise;constructor(t){this._callback=t}execute(){return this.promise||(this.promise=this._callback().finally((()=>{this.promise=void 0}))),this.promise}}const m=(t,e,s)=>{const r=s.value;return s.value=function(...t){if(c.x)return r.apply(this,t)},s};function w(t,e,s,r){var i,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,s,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(n=(a<3?i(n):a>3?i(e,s,n):i(e,s))||n);return a>3&&n&&Object.defineProperty(e,s,n),n}class f extends l.c{broadcast;storage;constructor(){super(),this.broadcast=new BroadcastChannel("web_ext_alarms"),this.storage=h.getBrowserPolyfill("_internal_alarms"),this.infiniteAlarmsCheck()}async clearAll(){return await this.storage.clear(),!0}async clear(t=""){const{[t]:e}=await this.storage.get(t);return!!e&&(await this.storage.remove(t),!0)}async create(t,e){const[s,r]="string"==typeof t?[t,e]:["",t],i=Date.now(),a={name:s,scheduledTime:r.periodInMinutes?this.computeNextRun(r.periodInMinutes):r.when||i+6e4*(r.delayInMinutes||0),periodInMinutes:r.periodInMinutes};a.scheduledTime<i?this.notifyAllContexts(a):await this.storage.set({[s]:a})}async get(t=""){const{[t]:e}=await this.storage.get(t);return e}async getAll(){const t=await this.storage.get();return Object.values(t)}async infiniteAlarmsCheck(){for(;;)await this.checkForDueAlarms(),await(0,a.BK)(12e3)}async checkForDueAlarms(){const t=Date.now(),e=(await this.getAll()).filter((e=>e.scheduledTime<=t));for(const t of e)this.notifyAllContexts(t),t.periodInMinutes?(t.scheduledTime=this.computeNextRun(t.periodInMinutes),await this.storage.set({[t.name]:t})):await this.storage.remove(t.name)}computeNextRun(t){return Date.now()+6e4*t}async notifyAllContexts(t){this.notifyChange(t),await u,this.broadcast.postMessage(t)}static getBrowserPolyfill(){const t=new f;return{get:t.get.bind(t),getAll:t.getAll.bind(t),create:t.create.bind(t),clear:t.clear.bind(t),clearAll:t.clearAll.bind(t),onAlarm:{addListener:t.addOnChange.bind(t),hasListener:t.hasOnChange.bind(t),removeListener:t.removeOnChange.bind(t)}}}}w([m],f.prototype,"infiniteAlarmsCheck",null),w([m,(t,e,s)=>{let r;const i=s.value,a=new p((async()=>i.apply(r)));s.value=function(){return r=this,a.execute()}}],f.prototype,"checkForDueAlarms",null);var y=i(8282);(0,n.J)()||(browser.windows||(browser.windows={}),browser.windows.getCurrent||(browser.windows.getCurrent=async t=>{const e=await browser.tabs.query({}),s=e.find((t=>t.active));return{id:s?.windowId??1,title:s?.title??"",focused:!0,alwaysOnTop:!1,incognito:!!browser.extension.inIncognitoContext,...t?.populate?{tabs:e}:{},state:"maximized",type:"normal",height:screen.availHeight,width:screen.availWidth,top:0,left:0}}),browser.windows.getLastFocused||(browser.windows.getLastFocused=async t=>browser.windows.getCurrent(t)),browser.windows.get||(browser.windows.get=async(t,e)=>{const[s]=await browser.tabs.query({windowId:t});return{...await browser.windows.getCurrent(e),id:s?.windowId??1,title:s?.title??"",focused:s?.active}}),browser.windows.getAll||(browser.windows.getAll=async t=>!1!==t?.windowTypes?.includes("normal")?[await browser.windows.getCurrent(t)]:[]),browser.windows.update||(browser.windows.update=async(t,e)=>{if(e.focused||"maximized"===e.state){const[e]=await browser.tabs.query({windowId:t});e&&await browser.tabs.update(e.id,{active:!0})}return browser.windows.getCurrent()}),browser.windows.remove||(browser.windows.remove=async t=>{const[e]=await browser.tabs.query({windowId:t});e&&await browser.tabs.remove(e.id)}),browser.windows.create||(browser.windows.create=async t=>{const e=t?.url?Array.isArray(t.url)?t.url:[t.url]:[y.pf];for(const s of e)await browser.tabs.create({url:s,active:t?.focused});const s=await browser.windows.getCurrent({populate:!0});return s.tabs=s.tabs.filter((t=>t.windowId===s.id)),s}));const v=c.x?Promise.resolve():new Promise((t=>"complete"===document.readyState||"interactive"===document.readyState?t():document.addEventListener("DOMContentLoaded",(()=>t()))));var _=i(4590);v.then((()=>_.P$)).then((function(){const t=document.querySelectorAll("[data-i]");for(let e=0,s=t.length;e<s;e++){const s=t[e],r=s.dataset,i=r.i,a=r.p,n=a?(0,_.tr)(i,a.split("|")):(0,_.tr)(i);s.appendChild(document.createTextNode(n))}const e=document.querySelectorAll("[data-a]");for(let t=0,s=e.length;t<s;t++){const s=e[t];let[r,i]=s.dataset.a.split("|");i=(0,_.tr)(i),r?s.setAttribute(r,i):s.appendChild(document.createTextNode(i))}}));var b=i(6062),I=i(4069);const D=async t=>(await fetch(t)).blob(),A=()=>new Promise((t=>{window.requestAnimationFrame(t)}));var E=i(683);const S=t=>Promise.reject(Error(t)),R=t=>e=>(t(e),Promise.reject(e));class T{fn;data;resolve;reject;constructor(t,e,s,r){this.fn=t,this.data=e,this.resolve=s,this.reject=r}}var O=i(2801);const k=new Set;const L=browser.tabs.getCurrent();let P=0;const C=L.then((t=>P=t?.id||0));async function x(t,{hidden:e},s){if(!1===e){const{tabs:e=[]}=await browser.windows.getCurrent({populate:!0});if(e.filter((t=>!t.hidden)).length<=2){const e=(await browser.windows.getAll({windowTypes:["normal"]})).find((t=>t.id!==s.windowId));e?(await browser.tabs.move(t,{windowId:e.id,index:-1}),await browser.tabs.hide(s.id)):await browser.tabs.remove(t)}}}var N=i(5524),M=i(6801),B=i(2352);function U(t,e,{maximumDelay:s=0}={}){let r=-1,i=-1,n=a.lQ;function o(){r>0&&self.clearTimeout(r),s&&i>0&&self.clearTimeout(i),r=i=-1,n=a.lQ}return c.flush=()=>n(),c.cancel=()=>(-1!==r||-1!==i)&&(o(),!0),c;function c(a=e,c=t){if(self.clearTimeout(r),r=-1,!1===c)return;const l=n=()=>{o(),a()};r=self.setTimeout(l,c),s&&i<0&&(i=self.setTimeout(l,s))}}async function G(t){try{await(browser.tabs.warmup?.(t))}catch(t){}}new(i(910).F)("reloading_monitor",(()=>[]));var H=i(9676),F=i(2221);async function W(t,e={}){return await G(t),I.m0&&await browser.tabs.update(t,{active:!0}),b.Dy&&await(0,H.w)(2e3,null,(()=>(0,M.hC)(t,{type:"screenshot_imminent"}).catch(a.lQ))),null}const z=new O.V(1);async function V(t,e={}){return z.addWork((async()=>b.Dy?async function(t,e){const s=await browser.tabs.get(t);if(s.discarded)throw"tab is discarded";const r=await W(t,e);r?.id??s.windowId;e.noDelay||await(0,a.BK)(400);return await browser.tabs.captureTab(s.id,{format:"png",rect:e.rect,scale:e.scale}).catch(R((t=>{0}))).catch((0,N.t$)("takeScreenShot ",{...s,favIconUrl:""}))}(t,e):(0,M._z)({type:"capture_tab",tabId:t,options:e})))}var $=i(9598);var K=i(9180);var j=i(8815);class q{key;callback;static PREFIX="dom_c_";constructor(t,e){this.key=t,this.callback=e,v.then((()=>{const s=(0,j.g)((()=>window.localStorage.getItem(q.PREFIX+t)))||"";e(t,s)}))}update(t){(0,j.g)((()=>window.localStorage.setItem(q.PREFIX+this.key,t))),this.execute(t)}execute(t){this.callback(this.key,t)}}var J=i(3943);const X=new q("white",((t,e)=>{document.documentElement.classList.toggle(t,e===J.z.light)})),Y=t=>function(t,e){return new Promise(((s,r)=>{const i=new FileReader;i.onload=t=>s(i.result),i.onerror=i.onabort=r,i[e](t)}))}(t,"readAsDataURL");const Z=(0,g.m)((async()=>{if(!self.OffscreenCanvas)return!1;const t=new self.OffscreenCanvas(2,2),e=t.getContext("2d");e.fillStyle="rgb(255, 0, 0)",e.fillRect(0,0,1,1);const s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAFElEQVQIW2P8z8Dwn5GBgRGIIQAAHyUCAymYnnsAAAAASUVORK5CYII="===await Y(await t.convertToBlob({type:"image/png"}));return s}));async function Q(){return await Z()}async function tt(t,e,s){return"convertToBlob"in t?t.convertToBlob({type:e,quality:s}):new Promise(((r,i)=>t.toBlob((t=>t?r(t):i(Error("empty blob!"))),e,s)))}async function et(t,e,s,r,i){const a=await async function(t,e){if(await Q())return new self.OffscreenCanvas(t,e);{const s=document.createElementNS("http://www.w3.org/1999/xhtml","html:canvas");return s.width=t,s.height=e,s}}(r,i),n=a.getContext("2d"),o=await async function(t){if(await Q()){const e=await D(t);return await self.createImageBitmap(e)}return new Promise(((e,s)=>{const r=document.createElement("img");r.addEventListener("error",s),r.addEventListener("load",(()=>{e(r)})),r.src=t}))}(t),c=window.devicePixelRatio;return n.drawImage(o,e*c,s*c,r*c,i*c,0,0,r,i),[n,a]}i(9773);var st=i(7852);const rt=["#f9f9fa","#2a2a2e","#1C1B22"].map((t=>{const[e,s,r]=(0,st.E)(t);return[e,s,r,255]}));function it(t){return rt.some((e=>function(t,[e,s,r,i]){const{data:a,height:n,width:o}=t,c=a.length/2,l=Math.floor(n/2);for(let t=0;t<c;t+=4*o){const n=a[t],c=a[t+1],d=a[t+2],u=a[t+3];if(n!==e||c!==s||d!==r||u!==i)return!1;t===4*o*(l-1)&&(t=4*(o-1))}for(let t=0;t<4*o;t+=4){const n=a[t],o=a[t+1],c=a[t+2],l=a[t+3];if(n!==e||o!==s||c!==r||l!==i)return!1}return!0}(t,e)))}var at=i(8794);async function nt(t,{left:e,top:s,width:r,height:i,isGroupDial:a,flagBadName:n},{normalImage:o,blackImage:c},l){const[d,u]=await et(o,e,s,r,i),h=d.getImageData(0,0,r,i);if(a&&c){const[t,a]=await async function(t,e,s,r,i){const[a,n]=await et(t,e,s,r,i),o=await tt(n,"png"),c=await Y(o),l=a.getImageData(0,0,r,i);return[c,l]}(c,e,s,r,i);d.putImageData(function(t,e){const s=e.data,r=t.data;for(let t=0;t<r.length;t+=4){const e=Math.abs(r[t]-s[t]),i=Math.abs(r[t+1]-s[t+1]),a=Math.abs(r[t+2]-s[t+2]);if(e||i||a){const s=255-Math.round((e+i+a)/3);s>=256||s<0||(r[t+3]=s)}}return t}(h,a),0,0)}{let e,s;if(!a&&(e=function(t,e=99){const{data:s}=t,r=[0,0,0,0].map((()=>Array.from({length:256},(()=>0)))),[i,a,n,o]=r,c=s.length;for(let t=0;t<c;t+=4){const e=s[t],r=s[t+1],c=s[t+2],l=s[t+3];++i[e],++a[r],++n[c],++o[l]}const l=e/100,d=c/4;return r.map((t=>Math.max(...t)/d)).every((t=>t>=l))}(h,l))||n&&(s=it(h)))return void(0,N.vV)(`problem with thumbnail: isSolid: ${e}, badName: ${n}, errorPage: ${s}`,void 0,t)}return await tt(u,at.fF.type,at.fF.quality)}const ot=(0,I.EL)().then((t=>{}));var ct=i(2846);var lt=i(4099),dt=i(1305);var ut=i(1470),ht=i(6683),gt=i(8289),pt=i(3694);class mt{groupId;url;dial;dialsEnvironment;type;delay;isManualReload;isVisibleSpin;refreshMethod;value;cloud;isGroupDial;lastRunTime;nextRunTime;constructor(t,e,s,r,i,a,n=0,o,c,l,d,u){this.groupId=e,this.url=s,this.dial=r,this.dialsEnvironment=i,this.type=a,this.delay=n,this.isManualReload=o,this.isVisibleSpin=c,this.refreshMethod=l,this.value=d,this.cloud=u,this.isGroupDial=(0,gt.Z)(s),this.lastRunTime=t[this.getKey()]||0,this.nextRunTime=this.getNextScheduleTime()}getKey(){return mt.getKey(this)}static getKey(t){return t.groupId+t.url}getNextScheduleTime(){const t=new Date,e=t.getTime(),s=this.value||Number.MAX_SAFE_INTEGER,[r,i,a]=(0,pt.Xm)(s),n=this.lastRunTime;function o(t){const s=(0,pt.dR)(t,r,i,a).getTime(),o=(0,pt.dR)(t-7,r,i,a).getTime(),c=(0,pt.dR)(t+7,r,i,a).getTime();return s<e?n<s?e:c:n<o?e:s}switch(this.type){case ht.kw.ReloadEvery:return n+1e3*s;case ht.kw.Daily:{const t=(new Date).setHours(r,i,a,0),s=(new Date).setHours(r-24,i,a,0),o=(new Date).setHours(r+24,i,a,0);return t<e?n<t?e:o:n<s?e:t}case ht.kw.Monthly:{const s=(0,pt.aG)(new Date,(t=>{t.setDate(1),t.setHours(r,i,a,0)})),o=(0,pt.aG)(new Date,(t=>{t.setDate(0),t.setDate(1),t.setHours(r,i,a,0)})),c=new Date(t.getFullYear(),t.getMonth()+1,1,r,i,a,0).getTime();return s<e?n<s?e:c:n<o?e:s}case ht.kw.WeekDays:return Math.min(...[1,2,3,4,5].map(o));case ht.kw.Weekends:return Math.min(...[0,6].map(o));case ht.kw.Monday:return o(1);case ht.kw.Tuesday:return o(2);case ht.kw.Wednesday:return o(3);case ht.kw.Thursday:return o(4);case ht.kw.Friday:return o(5);case ht.kw.Saturday:return o(6);case ht.kw.Sunday:return o(0);default:return}}}class wt{dial;groupId;isGroupDial;url;width;height;upscale;title;flagBadName;node;isManualReload;left;top;constructor(t,e,s,r,i,a,n,o,c,l,d){this.dial=t,this.groupId=e,this.isGroupDial=s,this.url=r,this.width=i,this.height=a,this.upscale=n,this.title=o,this.flagBadName=c,this.node=l,this.isManualReload=d,this.left=this.top=0}}var ft=i(7526),yt=i(6795);const vt=(t,e=!0)=>e?(e,s)=>(e[t]||0)-(s[t]||0):(e,s)=>(s[t]||0)-(e[t]||0);async function _t(){const t=(await browser.windows.getAll({populate:!0,windowTypes:["normal"]})).flatMap((t=>t.tabs.filter((t=>!t.discarded&&t.url.startsWith("http"))).slice(-2))),e=(await Promise.all(t.map((t=>{return e=t.id,(0,H.w)(900,void 0,(async()=>await browser.scripting.executeScript({target:{tabId:e,allFrames:!1},func:()=>({innerWidth:window.innerWidth,innerHeight:window.innerHeight,availWidth:window.screen.availWidth,availHeight:window.screen.availHeight,outerWidth:window.outerWidth,outerHeight:window.outerHeight,pixelRatio:window.devicePixelRatio})}).then((([t])=>t.result)).catch(a.s6)));var e})))).filter(a.zz).sort(vt(1,!1)),{availWidth:s,availHeight:r}=e[0]||{};return s&&r?{width:s,height:r}:await(0,M._z)({type:"getScreenInfo"}).then((t=>({width:t?.availWidth||1920,height:t?.availHeight||1080})))}var bt=i(1484),It=i(5904);const Dt=()=>{try{return!c.x&&window.self!==window.top}catch(t){return!0}};var At=i(2036);"ontouchstart"in self||navigator.maxTouchPoints;const Et=!1,St=((0,o.Z)("reload/reload.html"),Dt()&&At.Dg);const Rt=180,Tt=76;async function Ot(t,e,s,r,i){i||={devicePixelRatio:await at.T6.get()};const[a,n]=F.lw.AR_SCREEN_RESOLUTION===ht.d0.CUSTOM?[F.lw.AR_SCREEN_WIDTH||1280,F.lw.AR_SCREEN_HEIGHT||720]:await async function(){const t=b.Dy?await _t():await(0,M._z)({type:"findBiggestScreenSize"}).catch((()=>({width:window.screen.availWidth,height:window.screen.availHeight}))),{width:e,height:s}=t||{width:1920,height:1080},r=e/s,i=St||F.lw.HIDE_TOP_BAR?0:F.lw.GROUPS_HEIGHT,a=s-Tt-i;return r>2.7?[e,2*a]:[e,a]}(),o=function(t,e,{devicePixelRatio:s},r,i,a){const n=r/i,o=F.lw.NO_TITLE||e.visual?.noTitle?0:1.5*F.lw.DIAL_FONT_SIZE,c=2*function(t){const e=t?.DIAL_PADDING??F.lw.DIAL_PADDING;return St&&I.m0?Math.max(32,5*e):Et?e/2:e}(t.options),l=c+o;let d=s*(r/t.cols-c),u=s*(i/t.rows-l);if(t.ratio){const[e,s,r]=t.ratio,i=e/s;e*t.cols/(s*t.rows)>n||r?u=d/i-o-1.5*(e-s):d=u*i}else if(t.grid){const a=new It.x(t.grid.areas),{width:h,height:g}=a.getCoordinates(e.created)||{width:2,height:2};if(d=s*(r*(h/a.width)-c),u=s*(i*(g/a.height)-l),t.grid.position!==yt.Cr.fillSpace){a.width/a.height>n||t.grid.position===yt.Cr.scroll?u=g*d/h-o:d=h*u/g}}else if(t.dynamic){const{width:e,height:s}=t.dynamic;d=e,u=s-o}else if(t.list)return{width:t.list.width,height:.8*t.list.width};const[h,g]=(0,bt.M)(e.size||ht.ZU.NORMAL);return{width:d*a/h,height:u*a/g}}(t,e,i,a,n,r);let c=e.thumbnail&&e.thumbnail.position!==ht.X.FULL_WIDTH||(0,gt.Z)(e.url)||!t.isFlexibleLayout()?0:Rt;return s&&I.m0&&o.height>o.width&&(o.height=o.width,c=0),{...o,extraHeight:o.height+c}}const kt=1e3;function Lt({scale:t,vrX:e,vrY:s,posX:r,posY:i},a){const n=a/kt;return`\nleft: ${r*n}px;\ntop: ${i*n}px;\nwidth: ${e}px;\nheight: ${s}px;\ntransform: scale(${t*a/1e6});`}function Pt(t=""){return!t||["facebook.com","paypal.com","google.com","vk.com"].some((e=>t.includes(e)))?"":"allow-scripts allow-same-origin"}var Ct=i(5229);async function xt(t,e,{timeout:s=(0,K.n)(10)}={}){return(await Promise.all((await browser.webNavigation.getAllFrames({tabId:e})).map((r=>(0,H.w)(s,void 0,(()=>browser.scripting.executeScript({target:{tabId:e,frameIds:[r.frameId]},func:()=>window.name}).then((([t])=>t.result)).catch((()=>"")).then((e=>e===t?r.frameId:void 0)))))))).find(a.qS)}function Nt(t,e,s={}){return(0,H.w)(2e3,(()=>(0,N.vV)(`hideScrollbars timeout: ${t}, ${e}`)),(()=>async function(t,e,{frameId:s,frameName:r,scaleDown:i}={}){const n=((0,a.Et)(s)?s:r?await xt(r,t):void 0)||0;{const e=n?[n]:(await browser.webNavigation.getAllFrames({tabId:t}).catch((()=>[{frameId:0}]))).map((t=>t.frameId));await Promise.all(e.map((e=>browser.scripting.executeScript({injectImmediately:!0,target:{tabId:t,frameIds:[e]},files:[...d(),"/content_scripts/cs_prepare_shooting.js"]}).catch(a.lQ))))}i&&await(0,M.hC)(t,{type:"cs_scale_down",scaleDown:i},{frameId:s}).catch(a.lQ)}(t,0,s)))}function Mt(){return{devicePixelRatio:window.devicePixelRatio}}async function Bt(t,{url:e,groupId:s,isManualReload:r,isGroupDial:i},n,o){const c=`_gsd_reloading_frame_${(0,ft.V)()}`,l=o.settings||{},d=I.m0?1:self.devicePixelRatio>=1.5?1.5:2,{width:u,extraHeight:h}=await Ot(n,o,i,d,Mt()),g={...function(t,e,s){const r=t.VR_DEFAULT_WIDTH||1280;return{scale:Math.ceil(1e6/r),vrX:r,vrY:Math.round(r*s/e),posX:0,posY:0}}(F.lw,u,h),...o.crop||{}},p=(0,$.z)("div",{class:"reload_container",style:`width: ${u}px; height: ${h}px;`});if(t.appendChild(p),i)await new Promise((t=>{p.appendChild((0,$.z)("iframe",{handlers:{onload:t},style:`background: #000000; ${Lt(g,u)}`,src:At.KL+e}))})),await(0,a.BK)(500);else{const t=new Promise((t=>{p.appendChild((0,$.z)("iframe",{name:c,handlers:{onload:t},referrerpolicy:"no-referrer",style:Lt(g,u),sandbox:Pt(l.NO_SCRIPT?"":e),src:(0,Ct.I)(e)}))}));await(0,H.w)((0,K.n)(F.lw.MAX_FRAME_RELOAD_TIME),(()=>(0,N.cO)("iframe timeout")),(()=>t));const s=await C,n=(await browser.tabs.get(s)).active;await G(s);const d=await xt(c,s)??0;await Nt(s,i,{frameId:d}),await function(t,{frameId:e,frameName:s,timeWithoutTraffic:r=(0,K.n)(1),timeout:i=(0,K.n)(10)}={}){return new Promise((async n=>{await G(t);const o=e??(s?await xt(s,t):null),c=setTimeout((()=>g("timeout")),i),l=new Set,d=U(r,(()=>{g(`request idle, size: ${l.size}`)}));function u(t){(0,a.qS)(o)&&o!==t.frameId||l.add(t.requestId)}function h(t){(0,a.qS)(o)&&o!==t.frameId||(l.delete(t.requestId),d())}function g(t){self.clearTimeout(c),browser.webRequest.onBeforeRequest.removeListener(u),browser.webRequest.onCompleted.removeListener(h),n()}d(),browser.webRequest.onBeforeRequest.addListener(u,{tabId:t,urls:[y.P4]}),browser.webRequest.onCompleted.addListener(h,{tabId:t,urls:[y.P4]})}))}(s,{frameId:d,timeout:(0,K.n)(10),timeWithoutTraffic:(0,K.n)(n?.5:2)}),await G(s),await(0,a.BK)((0,K.n)(o.reload?.delay||0)),r||await(0,a.BK)((0,K.n)(I.cI?4:.5))}const{title:m,flagBadName:w}=i?{title:"",flagBadName:!1}:await async function(t,{tabIdPromise:e=C,timeoutMs:s=(0,K.n)(10)}){return(0,H.w)(s,(()=>S("timeout when getting iframe title")),(async()=>{const s=await e,r=await browser.scripting.executeScript({func:()=>[document.title,window.name],target:{tabId:s,allFrames:!0}}).then((t=>t.map((t=>t.result)).filter(a.zz))),[i]=r.find((([e,s])=>s===t))||(0,a.qb)("frame not found");return i}))}(c,{tabIdPromise:C}).then((t=>({title:t,flagBadName:!1}))).catch((t=>({title:"",flagBadName:!0})));return new wt(o,s,i,e,u,h,d,m,w,p,r)}const Ut=Dt(),Gt=browser.runtime.getPlatformInfo().then((t=>"x86-32"===t.arch));let Ht=4;Gt.then((t=>{t&&(Ht=2)}));const Ft=new class{name;storage;constructor(t){this.name=t,this.storage=[]}log(...t){this.storage.push(...t.map((t=>String(t))))}popLogs(){const t=[this.name+":",...this.storage].join("\n");return this.storage.length=0,t}}("reload"),Wt=(0,$.z)("div",{class:"r_container"}),zt=(...t)=>{Ut||Vt(),Ft.log(t)},Vt=U((0,K.xF)(3),(async()=>{await $t("WARNING: reloading tab was opened for too long without interactions"),F.lw.AR_KEEP_PINNED_TAB||(0,B.HG)()}));async function $t(t){const e=JSON.stringify((0,ut.uJ)(await browser.tabs.getCurrent(),"favIconUrl","url","title","mutedInfo","sharingState")),s=JSON.stringify(await browser.windows.getCurrent());(0,N.vV)(`${t}:\nTab info:\n${e}\nWindow info:\n${s}\n${Ft.popLogs()}\nReload tab log END`)}const Kt=U(200,(()=>(0,M._z)({type:"reload_spinners"})),{maximumDelay:300}),jt=new class{toKey;_map;constructor(t){this.toKey=t,this._map=new Map}get size(){return this._map.size}get(t){return this._map.get(this.toKey(t))}add(t){return this._map.set(this.toKey(t),t)}clear(){return this._map.clear()}delete(t){return this._map.delete(this.toKey(t))}has(t){return this._map.has(this.toKey(t))}values(){return this._map.values()}}(mt.getKey);browser.runtime.onMessage.addListener((t=>{switch(t.type){case"getScreenInfo":return Promise.resolve({availWidth:window.screen.availWidth,availHeight:window.screen.availHeight});case"reload_work":return async function(t){await Xt,zt("addWork: ",JSON.stringify(t));const e=()=>jt.delete(t);if(jt.has(t))return jt.get(t).promise;const s=async function(t){await qt.addWork((async()=>{const e=ct.M.groupById(t.groupId),s=ct.M.dialByUrl(t.groupId,t.url),r=await Bt(Wt,t,e,s);zt("iframe loaded",r),await Jt.addWork({data:{work:t,frame:r},fn:async(e,s)=>{const i=await nt(e,r,s,99);if(i)await async function(t,e,s){if(!s)return;const r="string"==typeof s?await D(s):s;return await dt.i.withDB((async s=>{(await s.updateDial(t,e,(t=>{t.imgBlob=r,delete t.hash}))).iconBlob||(0,lt.O)(t,e)}))}(e.work.groupId,e.work.url,i),await ct.M.action("updateDialNameIfNeeded",{groupId:e.work.groupId,url:e.work.url,newName:e.frame.title});else{const s=(0,M._z)({type:"by_visit_invisible",groupId:e.work.groupId,url:e.work.url,reloadOptions:{notify:!0,manual:t.isManualReload,dialsEnvironment:Mt()}});qt.getPendingJobsCount()>0&&await s.catch(a.lQ)}}})}),t)}(t).then((()=>(e(),jt.size)),R(e)).finally((()=>{zt("work finished: ",t.url)}));return jt.add({...t,promise:s}),Kt(),s}(t.work);case"reload_get_running_count":return Promise.resolve(jt.size);case"reload_get_running_for_group":return Promise.resolve([...jt.values()].filter((e=>e.groupId===t.groupId)).map(a.WR));case"screenshot_imminent":return async function(){zt("shooting imminent");document.getElementsByName("iframe").forEach((t=>(0,a.zz)(t.getBoundingClientRect())));const t=await browser.windows.getCurrent();await async function(t){(await browser.tabs.get(t)).active&&await A()}(P);const e=I.m0?700:"minimized"===t.state?2e3:1e3;await(0,a.BK)((F.lw.NORMAL_RELOAD_DELAY||100)+e),zt("shooting imminent - done")}()}}));const qt=new O.V((()=>Ht),{canRunWithOthers:(t,e)=>!I.m0&&(!t.isGroupDial||e.every((e=>e.groupId===t.groupId)))}),Jt=(({onBeforeBatch:t=(()=>{}),onAfterBatch:e=a.lQ,getAllConcurrentJobs:s=(()=>1),maxConcurrentJobs:r=1}={})=>{const i=Array();let n=!1;return{addWork:async function({fn:t,data:e}){return new Promise(((s,r)=>{i.push(new T(t,e,s,r)),o()}))}};async function o(){const c=i.length;if(n||0===c)return;const l=s();if(c>=(0,a.oA)(r)||c===l){n=!0;const s=i.splice(0,(0,a.oA)(r)),c=s.map((t=>t.data)),l=await t(c).catch(R((t=>s.forEach((e=>e.reject(t)))))),d=await(0,E.f)(s.map((t=>()=>t.fn(t.data,l))),{ignoreExceptions:!0});await e(c,l,d),n=!1,s.forEach(((t,e)=>{const[s,r]=d[e];r?t.reject(r):t.resolve(s)})),self.setTimeout(o)}}})({getAllConcurrentJobs:()=>qt.getRunningJobsCount(),maxConcurrentJobs:()=>Ht,onBeforeBatch:async function(t){await async function(t){return browser.tabs.setZoom?.(t,1).catch(a.lQ)}(P);const e=t=>window.parent.document.querySelector(".reloading_iframe")?.classList.toggle("is_shooting",t);document.documentElement.classList.remove("is_loading"),e(!0);const s=await(0,B.FA)();s&&await browser.windows.get(s.windowId);window.innerWidth,window.innerHeight;zt("preparing tab for shooting"),await W(P);zt("tab is ready, shooting now");const{normalImage:r,blackImage:i}=await async function(t){return e("vertical");async function e(e="vertical"){const{height:r,width:i}=Wt.getBoundingClientRect(),a=Ut?window.parent.innerHeight:0,n=t.some((({frame:t})=>t.isGroupDial));return s(n,{x:0,y:a,width:i,height:r})}async function s(e,s){return{blackImage:e?await r():void 0,normalImage:await V(P,{noDelay:!0,rect:s})};async function r(){r("#000000");const e=await V(P,{noDelay:!0,rect:s});return r("#ffffff"),e;function r(e){t.filter((({frame:t})=>t.isGroupDial)).forEach((({frame:t})=>{t.node.firstElementChild.style.background=e}))}}}}(t);return t.forEach((({frame:t})=>{const{left:e,top:s}=t.node.getBoundingClientRect();t.left=e,t.top=s})),document.documentElement.classList.add("is_loading"),e(!1),t.forEach((t=>t.frame.node.remove())),{focusedTab:s,normalImage:r,blackImage:i}},onAfterBatch:async function(t,{focusedTab:e}){I.m0&&0===qt.getPendingJobsCount()&&e?.id&&await browser.tabs.update(e.id,{active:!0})}});const Xt=async function(){zt("starting reloading"),browser.runtime.sendMessage({type:"___ext_tab_ready"}),async function(t){if(k.has(t))return;k.add(t);const e=t;await browser.declarativeNetRequest.updateSessionRules({removeRuleIds:[e],addRules:[{id:e,condition:{tabIds:[t],resourceTypes:["sub_frame"]},action:{type:"modifyHeaders",responseHeaders:[{header:"x-frame-options",operation:"remove"},{header:"content-security-policy",operation:"remove"},{header:"permissions-policy",operation:"remove"}],requestHeaders:[{header:"sec-fetch-dest",operation:"remove"}]}}]})}(await C),await Promise.all([ct.M.promise,Gt,I.Vq,v,ot]),await at.T6.get()!==self.devicePixelRatio&&at.T6.set(self.devicePixelRatio),document.body.insertAdjacentElement("afterbegin",Wt),async function(){I.m0||browser.tabs.onUpdated.hasListener(x)||browser.tabs.onUpdated.addListener(x,{tabId:await C,properties:["hidden"]})}();const t=()=>X.execute(F.lw.TEMPLATE_COLOR||"");browser.storage.local.onChanged.addListener((e=>{e.options&&t()})),t(),function(t){const e=browser.runtime.connect({name:t});self.setInterval((()=>e.postMessage({type:"_keepalive"})),2e4)}("reload_page")}()})();