(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{195:function(e,t,n){},197:function(e,t,n){"use strict";n(195)},198:function(e,t,n){"use strict";var i=n(3),c=n.n(i),s=n(4),a=n.n(s),o=n(6),r=n.n(o),u=n(13),l=n.n(u),h=function(){function e(){c()(this,e),this.db=new l.a("asset_caches",{revs_limit:1}),this.maxLimit=2e3,this.init()}return a()(e,[{key:"init",value:function(){return this.db.createIndex({index:{fields:["cached_at"]}})}},{key:"checkLimitationAndRemove",value:function(){var e=this;this.db.allDocs().then((function(t){var n=t.rows.length-e.maxLimit;n>0&&e.db.find({selector:{cached_at:{$gte:null}},sort:[{cached_at:"asc"}],limit:n}).then((function(t){t.docs.forEach((function(t){e.db.remove(t).catch((function(e){console.log(e)}))}))}))}))}},{key:"putAsset",value:function(e,t){var n=this;return this.checkLimitationAndRemove(),new Promise((function(i){n.db.get(e).then((function(){i()})).catch((function(){i(n.db.put({_id:e,asset:t,cached_at:parseInt((Date.now()+"").substr(0,10))}))}))}))}},{key:"retrieveAsset",value:function(e){var t=this;return new Promise((function(n,i){t.db.get(e).then((function(e){n(e)})).catch((function(e){i(e)}))}))}}]),e}(),d=function(){function e(){c()(this,e),this.assetCacheRepo=new h,this.cachedAssets=new Map,this.cachedLimit=1e3}return a()(e,[{key:"getCache",value:function(e){var t=this;return new Promise((function(n){t.cachedAssets.size>t.cachedLimit&&t.cachedAssets.delete(t.cachedAssets.entries().next()),t.cachedAssets.has(e)?n(t.cachedAssets.get(e)):t.assetCacheRepo.retrieveAsset(e).then((function(i){t.cachedAssets.has(e)||t.cachedAssets.set(e,i.asset.data),n(i.asset.data)})).catch((function(i){console.log(i),t.fetchAsset(e).then((function(i){if(i.length<=102400)return t.assetCacheRepo.putAsset(e,{url:e,data:i}),void n(i);n(i)})).catch((function(t){n(e)}))}))}))}},{key:"fetchAsset",value:function(e){return new Promise((function(t,n){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){if(200===i.status){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(i.response)}else n(Error("Cannot fetch asset from remote"))},i.onerror=function(e){n(e)},i.send()}))}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();r()(d,"instance",void 0);var m={props:{placeholder:{required:!1,type:String,default:""},src:{required:!0,type:String},defaultImage:{type:String,default:"data:image/gif;base64,R0lGODlhAQABAIAAAN/f3wAAACH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMTQgNzkuMTUxNDgxLCAyMDEzLzAzLzEzLTEyOjA5OjE1ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjhFRUMzOEMwMDY4QjExRUFCMTUwRDEyRjc1QThERDhDIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjhFRUMzOEMxMDY4QjExRUFCMTUwRDEyRjc1QThERDhDIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OEVFQzM4QkUwNjhCMTFFQUIxNTBEMTJGNzVBOEREOEMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OEVFQzM4QkYwNjhCMTFFQUIxNTBEMTJGNzVBOEREOEMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4B//79/Pv6+fj39vX08/Lx8O/u7ezr6uno5+bl5OPi4eDf3t3c29rZ2NfW1dTT0tHQz87NzMvKycjHxsXEw8LBwL++vby7urm4t7a1tLOysbCvrq2sq6qpqKempaSjoqGgn56dnJuamZiXlpWUk5KRkI+OjYyLiomIh4aFhIOCgYB/fn18e3p5eHd2dXRzcnFwb25tbGtqaWhnZmVkY2JhYF9eXVxbWllYV1ZVVFNSUVBPTk1MS0pJSEdGRURDQkFAPz49PDs6OTg3NjU0MzIxMC8uLSwrKikoJyYlJCMiISAfHh0cGxoZGBcWFRQTEhEQDw4NDAsKCQgHBgUEAwIBAAAh+QQAAAAAACwAAAAAAQABAAACAkQBADs="},mode:{required:!1,type:String,default:"image"},cacheService:{type:Object,default:function(){return d.getInstance()}}},data:function(){return{imageSrc:null}},computed:{usedSrc:function(){return this.imageSrc||this.placeholder}},watch:{src:function(e){var t=this;this.imageSrc=this.defaultImage,this.cacheService.getCache(e).then((function(e){t.imageSrc=e}))}},mounted:function(){var e=this;this.cacheService.getCache(this.src).then((function(t){e.imageSrc=t}))}},p=(n(197),n(1)),v=Object(p.a)(m,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"cacheable-image"},["image"===this.mode?t("img",{attrs:{src:this.usedSrc}}):"background"===this.mode?t("div",{staticClass:"cacheable-image-bg",style:{backgroundImage:"url("+this.usedSrc+")"}}):this._e()])}),[],!1,null,null,null);t.a=v.exports},210:function(e,t,n){"use strict";n.r(t);var i=n(198),c=n(165),s=n(155),a={components:{"cacheable-image":i.a,"app-suggest":c.a},data:function(){return{image:"https://s.pximg.net/www/images/logo/pixiv-logo.svg",pixivOminaIcon:"https://raw.githubusercontent.com/leoding86/webextension-pixiv-toolkit/master/src/statics/remote/img/pixiv-omina.png"}},created:function(){this.illustHistory=new s.a},methods:{resetVersionNumber:function(){browser.storage.local.set({version:"0.0.1",guideShowed:!1},(function(){browser.storage.local.get(null,(function(e){console.log(e),alert(e.version)}))}))},insertData:function(){this.putExampleData(70114228,70124228).then((function(){console.log("complete")})).catch((function(){console.log("error")}))},putExampleData:function(e,t){var n=this,i="https://www.pixiv.net/ajax/illust/"+e;return console.log("request "+i),new Promise((function(c){var s=new XMLHttpRequest;s.open("get",i),s.addEventListener("loadend",(function(){var i;try{!1===(i=JSON.parse(s.responseText)).error&&i.body&&n.illustHistory.putIllust({id:i.body.illustId,title:i.body.illustTitle,images:i.body.urls,type:i.body.illustType,viewed_at:Math.floor(Date.now()),r:0!==i.body.xRestrict})}catch(e){}++e>t?c():c(n.putExampleData(e,t))})),s.send()}))}}},o=n(1),r=Object(o.a)(a,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container container--big"},[n("h1",[e._v("!!! TEST AREA !!!")]),e._v(" "),n("h1",[e._v("Components")]),e._v(" "),n("h2",[e._v("cacheable-image component")]),e._v(" "),n("cacheable-image",{staticStyle:{width:"100px",height:"100px",border:"1px solid #000"},attrs:{mode:"background",src:e.image}}),e._v(" "),n("h2",[e._v("app-suggest component")]),e._v(" "),n("div",[n("app-suggest",{staticStyle:{width:"200px",border:"1px solid #000"},attrs:{icon:e.pixivOminaIcon,title:"Pixiv Omina",subTitle:"Sub title",link:"https://www.github.com"}})],1),e._v(" "),n("h1",[e._v("Debug actions")]),e._v(" "),n("div",[n("v-btn",{on:{click:e.resetVersionNumber}},[e._v("Reset version number")]),e._v(" "),n("v-btn",{on:{click:e.insertData}},[e._v("Insert histories")])],1)],1)}),[],!1,null,null,null);t.default=r.exports}}]);