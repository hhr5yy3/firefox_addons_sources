import{I as ut,S as xt,Q as pt,a as _t,b as bt,c as gt,G as yt,d as mt,e as jt,f as wt,P as ht,g as St,E as qt,O as $t,h as Pt,i as kt,j as It,k as Et}from"./shared-C3NPy9VQ.js";import{aS as v,t as Ct,a1 as At,R as g,X as _,aQ as Tt,J as d,aR as Ot,k as Z,P as y,y as M,B as a,C as Lt,D as r,a4 as ee,Y as re,L as R,n as e,W as C,af as Mt,aT as Rt,ab as U,T as i,al as me,a8 as je,a5 as Nt,ag as Kt,ae as Bt,aW as Vt,u as te,H as x,ak as Ut,s as N,V as W,Q as Wt,aa as we,U as he,a9 as Yt,aG as Dt,aU as A,az as T,ap as Y,a6 as Gt,aJ as Ft,aX as Qt,aV as Ht}from"./hex2rgb-DVuTvaj6.js";async function D(G){let se=!1;try{await v.tabs.sendMessage(G,{type:ut})===!0&&(se=!0)}catch{}if(!se){const P=chrome.runtime.getURL("").startsWith("moz-extension://");await v.scripting.insertCSS({target:{tabId:G},files:[P?"../contentScripts/style.css":"contentScripts/style.css"]}),await v.scripting.executeScript({target:{tabId:G},files:[P?"../contentScripts/index.global.js":"contentScripts/index.global.js"],injectImmediately:!0})}}var Xt=r('<div bg-sky="" bg-opacity-15="" c-sky="" text-xs="" px-2="" py-1="" mx-2="" class="svelte-xj5qfe">Alpha on Android</div>'),Jt=r('<div class="i-mingcute-book-6-fill svelte-xj5qfe"></div>'),zt=r('<div class="i-mingcute-clipboard-fill svelte-xj5qfe"></div>'),Zt=r('<div class="i-mingcute-search-2-fill svelte-xj5qfe"></div>'),es=r('<div class="i-mingcute-color-picker-fill svelte-xj5qfe"></div>'),ts=r('<div class="i-mingcute-settings-3-line svelte-xj5qfe"></div>'),ss=r('<div flex="" flex-row="" gap-4="" class="svelte-xj5qfe"><div flex="" justify-center="" items-center="" flex-col="" class="svelte-xj5qfe"><div text-xl="" class="svelte-xj5qfe"> </div> <div text-xs="" c-text-tertiary="" font-semibold="" class="svelte-xj5qfe">Known words</div></div> <div flex="" justify-center="" items-center="" flex-col="" class="svelte-xj5qfe"><div text-xl="" class="svelte-xj5qfe"> </div> <div text-xs="" c-text-tertiary="" font-semibold="" class="svelte-xj5qfe">Seen words</div></div></div>'),as=r('<div flex="" flex-row="" justify-center="" items-center="" gap-2="" text-sm="" font-semibold="" class="svelte-xj5qfe"><!> Loading words statuses ...</div>'),is=r('<div font-semibold="" text-xs="" c-red="" class="svelte-xj5qfe">Something went wrong while parsing this page. Please retry.</div>'),rs=r('<div font-semibold="" text-xs="" c-yellow="" class="svelte-xj5qfe"> </div>'),ls=r('<div flex="" flex-row="" justify-center="" items-center="" gap-2="" text-xs="" class="svelte-xj5qfe"><div class="i-mingcute-chart-line-fill svelte-xj5qfe"></div> <div class="svelte-xj5qfe">Webpage stats</div></div>'),os=r('<div flex="" flex-row="" justify-center="" items-center="" gap-2="" text-xs="" class="svelte-xj5qfe"><div class="i-mingcute-chart-line-fill svelte-xj5qfe"></div> <div class="svelte-xj5qfe">Video stats</div></div>'),ns=r('<div flex="" flex-row="" justify-center="" items-center="" gap-2="" text-xs="" class="svelte-xj5qfe"><div class="i-mingcute-settings-3-fill svelte-xj5qfe"></div> <div class="svelte-xj5qfe">Video settings</div></div>'),ds=r('<div flex="" flex-row="" justify-center="" items-center="" gap-2="" text-xs="" class="svelte-xj5qfe"><div class="i-mingcute-subtitle-fill svelte-xj5qfe"></div> <div class="svelte-xj5qfe">Open subtitles browser</div></div>'),vs=r('<div font-semibold="" text-xs="" c-text-tertiary="" pt-1="" class="svelte-xj5qfe"><!></div> <div flex="" flex-row="" flex-wrap="" justify-center="" items-center="" mt-2="" class="svelte-xj5qfe"><!> <!> <!> <!></div>',1),cs=r('<div class="i-mingcute-check-fill svelte-xj5qfe" c-green="" pl-2=""></div>'),fs=r('<div class="i-mingcute-close-fill svelte-xj5qfe" c-red="" pl-2=""></div>'),us=r('<div flex="" flex-row="" items-center="" justify-center="" class="svelte-xj5qfe"><span font-semibold="" text-sm="" class="svelte-xj5qfe">Auto generated subtitle</span> <div class="i-mingcute-warning-fill svelte-xj5qfe" c-orange="" pl-2=""></div></div>'),xs=r('<option class="svelte-xj5qfe"> </option>'),ps=r('<option class="svelte-xj5qfe">Off</option> <!>',1),_s=r('<div flex="" flex-row="" items-center="" justify-center="" font-semibold="" text-sm="" pt-2="" pb-1="" class="svelte-xj5qfe"><div c-text-tertiary="" text-xs="" class="svelte-xj5qfe">Second subtitle</div></div> <!>',1),bs=r('<div flex="" flex-col="" justify-center="" pt-4="" class="svelte-xj5qfe"><div flex="" flex-row="" items-center="" justify-center="" class="svelte-xj5qfe"><span font-semibold="" text-sm="" class="svelte-xj5qfe">Youtube detected</span> <div class="i-mingcute-check-fill svelte-xj5qfe" c-green="" pl-2=""></div></div> <div flex="" flex-row="" items-center="" justify-center="" class="svelte-xj5qfe"><span font-semibold="" text-sm="" class="svelte-xj5qfe">Korean subtitle available</span> <!></div> <!> <!></div>'),gs=r('<div class="i-mingcute-check-fill svelte-xj5qfe" c-green="" pl-2=""></div>'),ys=r('<div class="i-mingcute-close-fill svelte-xj5qfe" c-red="" pl-2=""></div>'),ms=r('<div flex="" flex-row="" items-center="" justify-center="" font-medium="" text-sm="" c-text-tertiary="" class="svelte-xj5qfe">Hint: Manually select Korean subtitle in the netflix player + reload the page</div>'),js=r('<option class="svelte-xj5qfe"> </option>'),ws=r('<option class="svelte-xj5qfe">Off</option> <!>',1),hs=r('<div flex="" flex-row="" items-center="" justify-center="" font-semibold="" text-sm="" pt-2="" pb-1="" class="svelte-xj5qfe"><div c-text-tertiary="" text-xs="" class="svelte-xj5qfe">Second subtitle</div></div> <!>',1),Ss=r('<div flex="" flex-col="" justify-center="" pt-4="" class="svelte-xj5qfe"><div flex="" flex-row="" items-center="" justify-center="" class="svelte-xj5qfe"><span font-semibold="" text-sm="" class="svelte-xj5qfe">Netflix detected</span> <div class="i-mingcute-check-fill svelte-xj5qfe" c-green="" pl-2=""></div></div> <div flex="" flex-row="" items-center="" justify-center="" class="svelte-xj5qfe"><span font-semibold="" text-sm="" class="svelte-xj5qfe">Korean subtitle available</span> <!></div> <!> <!></div>'),qs=r('<div class="i-mingcute-check-fill svelte-xj5qfe" c-green="" pl-2=""></div>'),$s=r('<div class="i-mingcute-close-fill svelte-xj5qfe" c-red="" pl-2=""></div>'),Ps=r('<div flex="" flex-row="" items-center="" justify-center="" font-semibold="" text-sm="" class="svelte-xj5qfe"><div c-text-tertiary="" text-xs="" class="svelte-xj5qfe"> </div></div>'),ks=r('<option class="svelte-xj5qfe"> </option>'),Is=r('<option class="svelte-xj5qfe">Off</option> <!>',1),Es=r('<div flex="" flex-row="" items-center="" justify-center="" font-semibold="" text-sm="" pt-2="" pb-1="" class="svelte-xj5qfe"><div c-text-tertiary="" text-xs="" class="svelte-xj5qfe">Second subtitle</div></div> <!>',1),Cs=r('<div flex="" flex-col="" justify-center="" pt-4="" class="svelte-xj5qfe"><div flex="" flex-row="" items-center="" justify-center="" class="svelte-xj5qfe"><span font-semibold="" text-sm="" class="svelte-xj5qfe">Viki detected</span> <div class="i-mingcute-check-fill svelte-xj5qfe" c-green="" pl-2=""></div></div> <div flex="" flex-row="" items-center="" justify-center="" class="svelte-xj5qfe"><span font-semibold="" text-sm="" class="svelte-xj5qfe">Korean subtitle available</span> <!></div> <!> <!></div>'),As=r('<div flex="" flex-row="" w-full="" items-center="" gap-1="" class="svelte-xj5qfe"><div c-text-tertiary="" text-xs="" class="svelte-xj5qfe"></div> <!> <div flex-grow="" class="svelte-xj5qfe"></div> <a target="_blank" class="svelte-xj5qfe"><!></a> <a target="_blank" class="svelte-xj5qfe"><!></a> <a target="_blank" class="svelte-xj5qfe"><!></a> <!> <!></div> <div text-2xl="" font-medium="" pb-2="" pt-1="" class="svelte-xj5qfe"></div> <!> <div py-2="" class="svelte-xj5qfe"></div> <div flex="" flex-row="" justify-center="" pb-4="" class="svelte-xj5qfe"><!></div> <div flex="" flex-row="" flex-wrap="" class="svelte-xj5qfe"><!></div> <!> <!> <!> <!> <!> <!>',1),Ts=r('<main text-center="" bg-background-primary="" c-text-primary=""><div pa-4="" flex="" flex-col="" items-center="" class="svelte-xj5qfe"><!></div></main>');function Os(G,se){var Oe;Ct(se,!0);const P=At(),Se=()=>ee(Nt,"$supabaseInstance",P),le=()=>ee(Kt,"$supabaseSession",P),De=()=>ee(Qt,"$isSubscribed",P),qe=()=>ee(Ut,"$colorPreferences",P),$e=()=>ee(Dt,"$wordCountStore",P);let Ge=Bt,Fe=Vt,oe=g(!1),ne=g(!1),K=g(_({isYoutube:!1,hasKoSubtitle:!1,isAutoGenerated:!1})),B=g(_({isNetflix:!1,hasKoSubtitle:!1})),O=g(_({isViki:!1,hasKoSubtitle:!1,completion:0})),de=g(!1),F=g(!1),Q=g(!1),ve=g(!1),V=g(null),Pe=g(_([])),ke=g(_([])),Ie=g(_([])),H=g("none"),X=g("none"),J=g("none"),ce=g(!1),fe=N(Gt),ae=g(null);async function Ee(){chrome.runtime.openOptionsPage(),window.close()}async function Ce(){var s;let t=new Date().getTime();try{d(oe,!0),d(Q,!1);let b=(s=(await v.tabs.query({active:!0,currentWindow:!0})).at(0))==null?void 0:s.id;b?(await D(b),await v.tabs.sendMessage(b,{type:ht})||d(Q,!0)):d(Q,!0)}catch(f){console.error("Failed to parse page",f),d(Q,!0)}finally{let f=new Date().getTime()-t;f<500&&await new Promise(b=>setTimeout(b,500-f)),d(oe,!1),d(de,!0)}}async function Qe(){var t;try{d(ne,!0);let f=(t=(await v.tabs.query({active:!0,currentWindow:!0})).at(0))==null?void 0:t.id;f&&(await D(f),await v.tabs.sendMessage(f,{type:qt}))}catch(s){console.error("Failed to parse page",s)}finally{d(ne,!1)}}Se().auth.getSession().then(async t=>{t.data.session===null?Ee().then(()=>window.close()):He()});function He(){Tt().then(t=>{d(ae,_(Object.keys(t).length))}),v.runtime.sendMessage({type:xt}),d(ce,!1),v.tabs.query({active:!0,currentWindow:!0}).then(async t=>{var s;try{let f=(s=t[0])==null?void 0:s.id;f&&(await D(f),await(async b=>(d(K,_(b[0])),d(B,_(b[1])),d(O,_(b[2])),d(de,_(b[3])),d(V,_(b[4])),d(Pe,_(b[5])),d(ke,_(b[6])),d(Ie,_(b[7]))))(await Promise.all([v.tabs.sendMessage(f,{type:pt}),v.tabs.sendMessage(f,{type:_t}),v.tabs.sendMessage(f,{type:bt}),v.tabs.sendMessage(f,{type:gt}),v.tabs.sendMessage(f,{type:yt}),v.tabs.sendMessage(f,{type:mt}),v.tabs.sendMessage(f,{type:jt}),v.tabs.sendMessage(f,{type:wt})])))}catch(f){console.error("Failed to load additional info",f)}finally{d(ce,!0)}}),Ot(Se(),le())}function Ae(t,s){t.type===St&&s.id===v.runtime.id&&d(F,_(t.loading))}v.runtime.onMessage.hasListener(Ae)||v.runtime.onMessage.addListener(Ae);function Xe(t){const s=document.documentElement;s.style.setProperty("--kr-color-background-primary",A(t.backgroundPrimaryColor??T.backgroundPrimaryColor)),s.style.setProperty("--kr-color-background-secondary",A(t.backgroundSecondaryColor??T.backgroundSecondaryColor)),s.style.setProperty("--kr-color-text-primary",A(t.textPrimaryColor??T.textPrimaryColor)),s.style.setProperty("--kr-color-text-secondary",A(t.textSecondaryColor??T.textSecondaryColor)),s.style.setProperty("--kr-color-text-tertiary",A(t.textTertiaryColor??T.textTertiaryColor)),s.style.setProperty("--kr-color-orange",A(t.orange??T.orange)),s.style.setProperty("--kr-color-red",A(t.red??T.red)),s.style.setProperty("--kr-color-green",A(t.green??T.green)),s.style.setProperty("--kr-color-yellow",A(t.yellow??T.yellow)),s.style.setProperty("--kr-color-blue",A(t.blue??T.blue))}async function Je(){try{let s=(await v.tabs.query({active:!0,currentWindow:!0}))[0].id;s&&(await D(s),await v.tabs.sendMessage(s,{type:$t})),window.close()}catch(t){console.error("Failed to open page stats",t)}}async function ze(){try{let s=(await v.tabs.query({active:!0,currentWindow:!0}))[0].id;s&&(await D(s),await v.tabs.sendMessage(s,{type:Pt})),window.close()}catch(t){console.error("Failed to open video stats",t)}}async function Ze(){try{let s=(await v.tabs.query({active:!0,currentWindow:!0}))[0].id;s&&(await D(s),await v.tabs.sendMessage(s,{type:kt})),window.close()}catch(t){console.error("Failed to open page video settings",t)}}async function et(){try{d(ve,!0);let s=(await v.tabs.query({active:!0,currentWindow:!0}))[0].id;s&&(await D(s),await v.tabs.sendMessage(s,{type:It})),window.close()}catch(t){console.error("Failed to open subtitles browser",t)}finally{d(ve,!1)}}(Oe=chrome.commands)==null||Oe.onCommand.addListener(function(t){t==="parse"&&Ce()});function tt(...t){d(H,_(e(V)??"none")),d(X,_(e(V)??"none")),d(J,_(e(V)??"none"))}function ue(t){t==="none"&&(t=null),t!==e(V)&&v.tabs.query({active:!0,currentWindow:!0}).then(async s=>{var b;let f=(b=s[0])==null?void 0:b.id;f&&(await v.tabs.sendMessage(f,{type:Et,subId:t}),d(V,_(t)))})}let st=N(()=>{var t;return(t=le())==null?void 0:t.access_token}),xe=N(()=>e(K).isYoutube&&e(K).hasKoSubtitle||e(B).isNetflix&&e(B).hasKoSubtitle||e(O).isViki&&e(O).hasKoSubtitle),Te=N(()=>!e(st)||!De()||e(oe)||e(F)||e(ne)||!e(ce)),at=N(()=>Ft.awaitReady());Z(()=>{e(V),te(()=>{tt()})}),Z(()=>{e(H),te(()=>{ue(e(H))})}),Z(()=>{e(X),te(()=>{ue(e(X))})}),Z(()=>{e(J),te(()=>{ue(e(J))})}),Z(()=>{qe(),te(()=>{Xe(qe())})});var pe=Ts(),it=x(pe),rt=x(it);y(rt,le,t=>{var s=As(),f=R(s),b=x(f);b.textContent=`v${Ge}`;var _e=i(b,2);y(_e,()=>e(fe),c=>{var l=Xt();a(c,l)});var be=i(_e,4),lt=x(be);C(lt,{tooltip:"Open study",children:(c,l)=>{var o=Jt();a(c,o)},$$slots:{default:!0}});var ge=i(be,2),ot=x(ge);C(ot,{tooltip:"Open scratchpad",children:(c,l)=>{var o=zt();a(c,o)},$$slots:{default:!0}});var ye=i(ge,2),nt=x(ye);C(nt,{tooltip:"Open dictionary",children:(c,l)=>{var o=Zt();a(c,o)},$$slots:{default:!0}});var Le=i(ye,2);C(Le,{get disabled(){return e(Te)},tooltip:"Extract content from this page to create a document in Kimchi Reader",$$events:{click:Qe},children:(c,l)=>{var o=es();a(c,o)},$$slots:{default:!0}});var dt=i(Le,2);C(dt,{tooltip:"Open options",$$events:{click:Ee},children:(c,l)=>{var o=ts();a(c,o)},$$slots:{default:!0}});var Me=i(f,2);Me.textContent=Fe;var Re=i(Me,2);Mt(Re);var Ne=i(Re,4),vt=x(Ne);Rt(vt,()=>e(at),c=>{var l=as(),o=x(l);Wt(o,{height:"12px",width:"12px",thickness:"2px"}),a(c,l)},(c,l)=>{var o=ss(),k=x(o),h=x(k),I=x(h),u=i(k,2),n=x(u),$=x(n);M(()=>{W(I,$e().known),W($,$e().seen)}),a(c,o)});var Ke=i(Ne,2),ct=x(Ke);C(ct,{get disabled(){return e(Te)},tooltip:"Parse this page (text & video if available)",$$events:{click:Ce},children:(c,l)=>{var o=re("Parse");a(c,o)},$$slots:{default:!0}});var Be=i(Ke,2);y(Be,()=>e(Q),c=>{var l=is();U(1,l,()=>Y),a(c,l)});var Ve=i(Be,2);y(Ve,()=>e(ae)!==null&&e(ae)>25,c=>{var l=rs(),o=x(l);M(()=>W(o,`You have ${e(ae)??""} statuses waiting to be uploaded, that seems like a lot and shouldn't happen!
          This might be a bug and you might lose these if not solved.`)),U(1,l,()=>Y),a(c,l)});var Ue=i(Ve,2);y(Ue,()=>e(de),c=>{var l=vs(),o=R(l),k=x(o);y(k,()=>e(fe),p=>{var S=re("Parse done! Exit extension to view page.");a(p,S)},p=>{var S=re("Parse done! Check the page.");a(p,S)});var h=i(o,2),I=x(h);C(I,{tooltip:"Open stats for the webpage content",dense:!0,$$events:{click:Je},children:(p,S)=>{var q=ls();a(p,q)},$$slots:{default:!0}});var u=i(I,2),n=N(()=>e(F)||!e(xe));C(u,{tooltip:"Open stats for the video on the webpage",dense:!0,get disabled(){return e(n)},$$events:{click:ze},children:(p,S)=>{var q=os();a(p,q)},$$slots:{default:!0}});var $=i(u,2),j=N(()=>e(F)||!e(xe));C($,{tooltip:"Open video settings for this page",dense:!0,get disabled(){return e(j)},$$events:{click:Ze},children:(p,S)=>{var q=ns();a(p,q)},$$slots:{default:!0}});var ie=i($,2),E=N(()=>e(F)||!e(xe)||e(ve));C(ie,{tooltip:"Open subtitles browser for this video",dense:!0,get disabled(){return e(E)},$$events:{click:et},children:(p,S)=>{var q=ds();a(p,q)},$$slots:{default:!0}}),U(1,o,()=>Y),U(1,h,()=>Y),a(c,l)});var We=i(Ue,2);y(We,()=>e(K).isYoutube,c=>{var l=bs(),o=i(x(l),2),k=i(x(o),2);y(k,()=>e(K).hasKoSubtitle,u=>{var n=cs();a(u,n)},u=>{var n=fs();a(u,n)});var h=i(o,2);y(h,()=>e(K).isAutoGenerated,u=>{var n=us();a(u,n)});var I=i(h,2);y(I,()=>e(K).hasKoSubtitle,u=>{var n=_s(),$=i(R(n),2);me($,{get value(){return e(X)},set value(j){d(X,_(j))},dense:!0,children:(j,ie)=>{var E=ps(),p=R(E);p.value=(p.__value="none")==null?"":"none";var S=i(p,2);je(S,17,()=>e(ke),we,(q,m)=>{var w=xs(),L={},z=x(w);M(()=>{L!==(L=e(m).id)&&(w.value=(w.__value=e(m).id)==null?"":e(m).id),W(z,e(m).label)}),a(q,w)}),a(j,E)},$$slots:{default:!0}}),a(u,n)}),U(1,l,()=>Y),a(c,l)});var Ye=i(We,2);y(Ye,()=>e(B).isNetflix,c=>{var l=Ss(),o=i(x(l),2),k=i(x(o),2);y(k,()=>e(B).hasKoSubtitle,u=>{var n=gs();a(u,n)},u=>{var n=ys();a(u,n)});var h=i(o,2);y(h,()=>!e(B).hasKoSubtitle,u=>{var n=ms();a(u,n)});var I=i(h,2);y(I,()=>e(B).hasKoSubtitle,u=>{var n=hs(),$=i(R(n),2);me($,{get value(){return e(H)},set value(j){d(H,_(j))},dense:!0,children:(j,ie)=>{var E=ws(),p=R(E);p.value=(p.__value="none")==null?"":"none";var S=i(p,2);je(S,17,()=>e(Pe),we,(q,m)=>{var w=js(),L={},z=x(w);M(()=>{L!==(L=e(m).id)&&(w.value=(w.__value=e(m).id)==null?"":e(m).id),W(z,`${e(m).label??""} ${(e(m).type==="closedcaptions"?"CC":"")??""} (${e(m).language??""})`)}),a(q,w)}),a(j,E)},$$slots:{default:!0}}),a(u,n)}),U(1,l,()=>Y),a(c,l)});var ft=i(Ye,2);y(ft,()=>e(O).isViki,c=>{var l=Cs(),o=i(x(l),2),k=i(x(o),2);y(k,()=>e(O).hasKoSubtitle,u=>{var n=qs();a(u,n)},u=>{var n=$s();a(u,n)});var h=i(o,2);y(h,()=>e(O).completion,u=>{var n=Ps(),$=x(n),j=x($);M(()=>W(j,`(Subtitle completion ${e(O).completion??""}%)`)),a(u,n)});var I=i(h,2);y(I,()=>e(O).hasKoSubtitle,u=>{var n=Es(),$=i(R(n),2);me($,{get value(){return e(J)},set value(j){d(J,_(j))},dense:!0,children:(j,ie)=>{var E=Is(),p=R(E);p.value=(p.__value="none")==null?"":"none";var S=i(p,2);je(S,17,()=>e(Ie),we,(q,m)=>{var w=ks(),L={},z=x(w);M(()=>{L!==(L=e(m).id)&&(w.value=(w.__value=e(m).id)==null?"":e(m).id),W(z,`${e(m).label??""} (${e(m).completion??""})`)}),a(q,w)}),a(j,E)},$$slots:{default:!0}}),a(u,n)}),U(1,l,()=>Y),a(c,l)}),M(()=>{he(be,"href","https://kimchi-reader.app/study"),he(ge,"href","https://kimchi-reader.app/scratchpad"),he(ye,"href","https://kimchi-reader.app/dict")}),a(t,s)},t=>{var s=re("...");a(t,s)}),M(()=>Yt(pe,`${(e(fe)?"w-100vw min-h-100vh":"w-75")??""} svelte-xj5qfe`)),a(G,pe),Lt()}Ht(Os,{target:document.getElementById("app")});
