!function(c){function t(t){for(var e,n,a=t[0],r=t[1],s=t[2],i=0,o=[];i<a.length;i++)n=a[i],Object.prototype.hasOwnProperty.call(h,n)&&h[n]&&o.push(h[n][0]),h[n]=0;for(e in r)Object.prototype.hasOwnProperty.call(r,e)&&(c[e]=r[e]);for(d&&d(t);o.length;)o.shift()();return l.push.apply(l,s||[]),u()}function u(){for(var t,e=0;e<l.length;e++){for(var n=l[e],a=!0,r=1;r<n.length;r++){var s=n[r];0!==h[s]&&(a=!1)}a&&(l.splice(e--,1),t=i(i.s=n[0]))}return t}var n={},h={1:0},l=[];function i(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return c[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}i.m=c,i.c=n,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="";var e=window.webpackJsonp=window.webpackJsonp||[],a=e.push.bind(e);e.push=t,e=e.slice();for(var r=0;r<e.length;r++)t(e[r]);var d=a;l.push([369,0]),u()}({3:function(t,e,n){"use strict";n.d(e,"b",function(){return a}),n.d(e,"a",function(){return r});var a={RETENTION:"Retention",INSTALL_BAR:"Install Bar",SETTINGS:"Settings",VISITED_MERCHANT:"Visited merchant",AUTH:"Auth form",FORGOT_PASSWORD:"Forgot Password",NATIVE_LOGIN:"Native Login",NATIVE_SIGN_UP:"Native Sign Up",ACTIVATION_BUTTON:"Activation Button",CAA_INJECTION_FIRST_TIME:"CaaInjectionFirstTime",SERP__INJECTION_FIRST_TIME:"SerpInjectionFirstTime",EXTENSION:"Extension",POPUP:"UserActivityInPopup",SLIDER_TUTORIAL:"SliderInjectionFirstTime",UPDATE_STORE:"Store",UPDATE_LOCAL:"Local"},r={RETENTION_LIFE:"Life",INSTALL_BAR_RENDER:"Render",INSTALL_BAR_BTN:"BTN",INSTALL_BAR_HELPER_CLOSE:"Helper Close",INSTALL_BAR_HELPER_BTN:"Helper BTN",INSTALL_BAR_CLOSE:"Close",INSTALL_BAR_ACTIVATED:"Activated",INSTALL_BAR_GO_HOME_PAGE:"Go Home Page",SETTINGS_OPEN:"Open",VISITED_MERCHANT_VISIT:"Visit",AUTH_RENDER:"Render",AUTH_SUCCESS:"Auth success",AUTH_CLOSE:"Close",AUTH_FACEBOOK_BTN:"Facebook BTN",AUTH_GOOGLE_BTN:"Google BTN",AUTH_VK_BTN:"VK BTN",AUTH_GO_TERMS:"Go Terms",AUTH_GO_PRIVACY:"Go Privacy",FORGOT_PASSWORD_BTN:"BTN",NATIVE_LOGIN_BTN:"BTN",NATIVE_SIGN_UP_BTN:"BTN",ACTIVATION_BUTTON_RENDER:"Render",ACTIVATION_BUTTON_BTN:"BTN",ACTIVATION_BUTTON_CLOSE:"Close",ACTIVATION_BUTTON_GET_LATER_BTN:"Get later BTN",CAA_INJECTION_FIRST_TIME_RENDER:"Render",CAA_INJECTION_FIRST_TIME_OUTBOUND:"Outbound",CAA_INJECTION_FIRST_TIME_BTN:"BTN",SLIDER_INJECTION_FIRST_TIME_RENDER:"Render",SLIDER_INJECTION_FIRST_TIME_OUTBOUND:"Outbound",SLIDER_INJECTION_FIRST_TIME_BTN:"BTN",SERP__INJECTION_FIRST_TIME_RENDER:"Render",EXTENSION_INSTALLED:"Installed",EXTENSION_DISABLE:"Disable",EXTENSION_ENABLE:"Enable",EXTENSION_REMOVE:"Remove",EXTENSION_INSTALL:"Install",POPUP_LOGO_CLICK:"LogoClick",POPUP_SEARCH_OFFER_CLICK:"SearchOfferClick",POPUP_ACTIVATE_CASHBACK_CLICK:"ActivateCashbackClick",POPUP_TOP_OFFER_CLICK:"TopOfferButtonClick",POPUP_RECENT_OFFER_CLICK:"RecentOfferButtonClick",POPUP_TOP_DEAL_CLICK:"TopDealButtonClick",POPUP_TOP_DEAL_COUPON_COPY:"TopDealCouponCopy",POPUP_FOOTER_HOME:"FooterHome",POPUP_FOOTER_ALL_STORES:"FooterAllStores",POPUP_FOOTER_SETTINGS:"FooterSettings",POPUP_USER_INFO:"UserInfo",POPUP_SHOPPING_TRIP:"ShoppingTrip",NOTIFICATION_SHOW:"Render",NOTIFICATION_CLICK:"ActivateCashbackClick",NOTIFICATION_CLOSE:"CloseNotification",UPDATE_DEPLOYED:"Deployed",UPDATE_NOT_DEPLOYED:"Not deployed"}},364:function(t,e,n){"use strict";var a=n(11),T=n.n(a),r=n(32),A=n.n(r),s=n(0),O=n.n(s),i=n(7),w=n.n(i),o=n(17),x=n.n(o),c=n(19),E=n.n(c),u=n(28),_=n.n(u),h=n(62),j=n.n(h),l=n(25),C=n.n(l),d=n(56),N=n.n(d),f=n(31),P=n.n(f),p=n(343),R=n.n(p),v=n(42),L=n.n(v),m=n(344),U=n.n(m),g=n(51),D=n.n(g),b=n(345),B=n.n(b),k=n(20),M=n.n(k),y=n(57),F=n.n(y),S=n(47),G=n.n(S),I=n(10),q=n.n(I),z=n(35),V=n.n(z),H=n(71),K=n.n(H),X=n(23),J=n.n(X),Y=n(63),W=n.n(Y),$=n(26),Q=n.n($),Z=n(1),tt=n(2),et=n.n(tt),nt=n(4),at=n(6),rt=function(){function t(){x()(this,t),this.currentFrame=0,this.timer=null,this.tabId=null,this.type="transparent",this.frames={main:["images/48x48.png"],transparent:["images/toolbarIcon/48x48.png"],success:Array.from(Array(67),function(t,e){return"images/success/".concat(e+1,".png")}),fail:Array.from(Array(37),function(t,e){return"images/fail/".concat(e+1,".png")})},this.loadImages()}var e;return E()(t,[{key:"setBadge",value:function(t){chrome.browserAction.setBadgeText({text:"".concat(t)})}},{key:"setIcon",value:function(t,e,n){var a=1<arguments.length&&void 0!==e?e:0,r=2<arguments.length?n:void 0;chrome.browserAction.setIcon({path:this.frames[t][a],tabId:r})}},{key:"start",value:function(t,e){this.stop().animate(t,e)}},{key:"end",value:function(t,e){this.setIcon(t,this.frames[t].length-1,e)}},{key:"stop",value:function(){return clearTimeout(this.timer),this.currentFrame=0,this}},{key:"animate",value:function(t,e){var n=this;clearTimeout(this.timer);var a=this.frames[t].length-1;this.currentFrame<=a?(this.setIcon(t,this.currentFrame,e),this.currentFrame+=1,this.timer=setTimeout(function(){return n.animate(t,e)},50)):this.stop()}},{key:"loadImageAsDataURL",value:function(t){return fetch(t).then(function(t){return t.blob()}).then(function(n){return new Promise(function(t){var e=new FileReader;e.onloadend=function(){return t(e.result)},e.onerror=function(){return t(null)},e.readAsDataURL(n)})}).catch(function(){return null})}},{key:"loadImages",value:(e=w()(O.a.mark(function t(){var e,n=this;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=Object.keys(this.frames),t.abrupt("return",Promise.all(e.map(function(){var e=w()(O.a.mark(function t(e){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(n.frames[e].map(function(){var e=w()(O.a.mark(function t(e){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",n.loadImageAsDataURL(e));case 1:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()));case 2:return n.frames[e]=t.sent,n.frames[e]=n.frames[e].filter(function(t){return t}),t.abrupt("return",n.frames[e]);case 5:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}())));case 2:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})}]),t}(),st=function(){function r(t){var e=t.name,n=t.url,a=t.options;x()(this,r),this.name=e,this.url=n,this.options=Object.assign({updateInterval:36e5,updateErrorInterval:3e4},a),this.updateTime=null,this.updateTimer=null,this.updateController=null}function t(t){return e.apply(this,arguments)}var e;return E()(r,[{key:"init",value:function(){var t=this;return this.load().then(function(){return t.update()})}},{key:"parse",value:function(t){return t}},{key:"refreshUpdateTimer",value:function(t){var e=this,n=t.time,a=void 0===n?Date.now():n,r=t.interval,s=void 0===r?this.options.updateInterval:r,i=t.force;clearInterval(this.updateTimer),this.updateTime=a,this.save(),this.updateTimer=setInterval(function(){clearInterval(e.updateTimer),e.update(i)},a+s-Date.now())}},{key:"save",value:function(){var t;Object(Z.setStorageData)((t={},T()(t,"".concat(this.name,".updateTime"),this.updateTime),T()(t,"".concat(this.name,".data"),this.data),t))}},{key:"load",value:function(){var e=this;return Object(Z.getStorageData)(["".concat(this.name,".updateTime"),"".concat(this.name,".data")]).then(function(t){e.updateTime=t["".concat(e.name,".updateTime")]||0,e.data=t["".concat(e.name,".data")]})}},{key:"update",value:function(t,e){var n=this;return this.updateTime+this.options.updateInterval<Date.now()||t?this.fetch({options:e}).then(function(){n.refreshUpdateTimer({}),n.options.updateErrorInterval=3e4}).catch(function(){n.options.updateErrorInterval*=Math.floor(5*Math.random())+2,n.refreshUpdateTimer({interval:n.options.updateErrorInterval,force:!0})}):(this.refreshUpdateTimer({time:this.updateTime}),Promise.resolve())}},{key:"fetch",value:(e=function(t){var e=this,n=t.url,a=void 0===n?this.url:n;this.updateController&&this.updateController.abort(),this.updateController=new AbortController;var r=this.updateController.signal;return fetch(a,{signal:r}).then(function(t){return t.json()}).then(function(t){return e.data=e.parse(t),e.save(),e.data}).catch(function(t){})},t.toString=function(){return e.toString()},t)}]),r}(),it=function(t){function a(t){var e;x()(this,a);var n=["background_image","site","logo","name","deep_link","isTopStore","get_later_common","get_later_extra","custom_cpa_v2","coupon_count","config"].join(",");return(e=_()(this,C()(a).call(this,{name:"merchants",url:"".concat(nt.x.MERCHANTS,"?language=").concat(t.getLanguage(),"&fields=").concat(n,"&isStore=").concat(t.isStore?"1":"0"),updateDelay:144e5}))).fields=n,e.states=[],e.offersUpdateDelay=9e5,e.pingDelay=nt.o.DELAY,e.pingUpdateTime=Date.now()-e.pingDelay,e.getGeo=t.getGeo,e.isStore=t.isStore,e.parseMerchant=e.parseMerchant.bind(j()(e)),e}var e,n,r,s,i;return P()(a,t),E()(a,[{key:"init",value:function(){var t=this;return this.load().then(function(){return t.update()})}},{key:"parseMerchant",value:function(t){var e=q()(t,"config.IB",!this.isStore),n=q()(t,"config.ButtonCB",!0),a=q()(t,"config.ButtonCAA",!0),r=q()(t,"config.Notice",!0),s=q()(t,"config.UACB",!0),i=q()(t,"config.Serp",!0),o=q()(t,"config.specialMode",!1),c=q()(t,"config.ACBNA",!0);return{url:t.site,logo:t.logo,name:t.name,id:"".concat(t.id),network:t.network,isTopStore:t.isTopStore,activationUrl:t.deep_link,couponCount:t.coupon_count,isUpTo:t.custom_cpa_v2.upTo,cashback:t.custom_cpa_v2.valueStr,backgroundImage:t.background_image,domain:Object(at.e)(t.site.toLowerCase()),isSerp:i&&!o,isNotifications:r&&!o,isInstallButton:e&&!o,isCAA:a&&r&&!o,isCashback:n&&r&&!o,isPopup:!o&&n,isACBAvailable:s,isACBNotActivated:c}}},{key:"parse",value:function(t){return t.offers.map(this.parseMerchant)}},{key:"parseCoupons",value:function(t){return F()(t.coupons,function(t){return{id:t.id,name:t.name,description:t.description,retailerId:t.offer_id,code:t.promo_code,url:t.url,image:t.image,counter:t.counter,type:t.coupon_type,isSpecialDeal:t.is_special_deal,valid:Object(at.o)(t.active_to,"/"),validFrom:t.start_date,network:t.network}})}},{key:"update",value:(i=w()(O.a.mark(function t(e){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N()(C()(a.prototype),"update",this).call(this,e);case 2:this.updateStates(),this.refreshPingTimer();case 4:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"pingUrl",value:(s=w()(O.a.mark(function t(){var e,n,a,r,s,i;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Z.getStorageData)("cashback.settings");case 2:return e=t.sent,n=e["cashback.settings"]||{},a=n.language,r=navigator.language.slice(0,2),s=new Date(this.pingUpdateTime||Date.now()-2*this.pingDelay),s=Math.floor(s/this.pingDelay)*this.pingDelay,i=new URLSearchParams({isStore:this.isStore?"1":"0",from:Math.floor(s/1e3),geo:this.getGeo()||"us"}),t.abrupt("return","".concat(nt.o.API_URL,"/").concat(a||r,"?").concat(i.toString()));case 9:case"end":return t.stop()}},t,this)})),function(){return s.apply(this,arguments)})},{key:"refreshPingTimer",value:function(){var t=this;clearInterval(this.pingUpdateTimer),this.pingUpdateTimer=setInterval(function(){clearInterval(t.pingUpdateTimer),t.ping()},this.pingDelay)}},{key:"ping",value:(r=w()(O.a.mark(function t(){var e,n,a,r=this;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.pingUrl();case 2:return e=t.sent,t.prev=3,t.next=6,fetch(e);case 6:return n=t.sent,t.next=9,n.json();case 9:a=t.sent,G()(a.offers)||(Q()(a.offers,function(t){var e="".concat(t.id);if("1"!==t.active)D()(r.data,function(t){return t.id===e}),D()(r.states,function(t){return t.id===e});else{var n=J()(r.data,function(t){return t.id===e}),a=r.parseMerchant(t);n?M()(n,a):r.data.push(a)}}),this.save());case 11:return t.prev=11,this.pingUpdateTime=Date.now(),this.refreshPingTimer(),t.finish(11);case 15:case"end":return t.stop()}},t,this,[[3,,11,15]])})),function(){return r.apply(this,arguments)})},{key:"updateMerchantOffers",value:(n=w()(O.a.mark(function t(e){var n,a,r,s,i,o,c,u,h;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.id,a=e.language,r=void 0===a?null:a,s=J()(this.data,function(t){return t.id===n}),(i=s&&J()(this.states,function(t){return t.id===n})).offersUpdateTime=i.offersUpdateTime,!s||i.offersUpdateTime+this.offersUpdateDelay>L()())return t.abrupt("return",Promise.resolve());t.next=6;break;case 6:return o=["id","offer_id","name","promo_code","is_special_deal","active_to","url","description","geos","network"].join(","),c={fields:o,language:r,offer_id:n},t.next=10,fetch("".concat(nt.x.COUPONS,"?").concat(new URLSearchParams(c).toString()));case 10:return u=t.sent,t.next=13,u.json();case 13:return h=t.sent,s.coupons=this.parseCoupons(h),i.offersUpdateTime=L()(),t.abrupt("return",s);case 17:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"getByUrl",value:function(t){var e=Object(at.e)(t);if(e)return J()(this.data,function(t){return t.domain===e})}},{key:"getById",value:function(e){return J()(this.data,function(t){return t.id===e})}},{key:"refreshStates",value:function(){Q()(this.states,function(t){M()(t,Z.BaseMerchants.defaultState())})}},{key:"resetStates",value:function(){this.states=this.states.map(function(t){return M()({id:t.id},Z.BaseMerchants.defaultState())})}},{key:"resetCashback",value:function(t){var e=t.id,n=J()(this.data,function(t){return t.id===e}),a=n&&J()(this.states,function(t){return t.id===e});n&&a&&(a.activated=!1,a.showNotification=!0,this.setState(a))}},{key:"checkTabsOnLoading",value:(e=w()(O.a.mark(function t(a){var e,n,r=this;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(at.l)({status:"loading"});case 2:return e=t.sent,n=e.find(function(t){var e=t.url,n=r.getByUrl(e);return q()(n,"id")===a}),t.abrupt("return",!n);case 5:case"end":return t.stop()}},t)})),function(t){return e.apply(this,arguments)})}]),a}(function(t){function i(t){var e,n=t.name,a=t.url,r=t.options,s=void 0===r?{}:r;return x()(this,i),(e=_()(this,C()(i).call(this,{name:n,url:a,options:s}))).step=0,e.stepData=[],e}function e(){return n.apply(this,arguments)}var n;return P()(i,t),E()(i,[{key:"fullUrl",value:function(){return"".concat(this.url).concat(this.url.includes("?")?"&":"?","step=").concat(this.step)}},{key:"next",value:function(){this.step+=1}},{key:"stop",value:function(t){return t.count<500}},{key:"reset",value:function(){this.step=0,this.stepData=[]}},{key:"fetch",value:(n=function(){var e=this;return this.next(),fetch(this.fullUrl()).then(function(t){return t.json()}).then(function(t){return e.stepData=e.stepData.concat(e.parse(t)),e.stop(t)?(e.data=e.stepData.slice(),e.save(),e.reset(),e.data):e.fetch()}).catch(function(){throw e.reset(),new Error})},e.toString=function(){return n.toString()},e)}]),i}(st));Object(at.m)([it,Z.BaseMerchants],["update","constructor","getByUrl","refreshStates","resetStates"]);var ot=it,ct=n(183),ut=n.n(ct),ht=function(t){function h(){return x()(this,h),_()(this,C()(h).call(this,{name:"configs"}))}function e(){return n.apply(this,arguments)}var n;return P()(h,t),E()(h,[{key:"fetch",value:(n=function(){var u=this;this.updateController&&this.updateController.abort(),this.updateController=new AbortController;var t=F()([nt.x.ACTIVATION_PARAMS,nt.x.CAA_CONFIGS,nt.x.COOKIE_CONFIG,nt.x.TERMINATOR,nt.x.ORDERS_CONFIG,nt.x.SERP_CONFIGS,nt.x.THANOS_CONFIG],function(t){return e=t,u.updateController,fetch(e).then(function(t){if(200!==t.status)throw Error("invalid status");return t.json()}).catch(function(){return[]});var e});return Promise.all(t).then(function(t){var e=A()(t,7),n=A()(e[0],1)[0],a=e[1],r=e[2],s=e[3],i=e[4],o=e[5],c=e[6];u.data={activationParams:n,caaConfigs:a,cookieConfig:r,terminatorConfig:h.mergeTerminatorConfigs(s),orderConfig:i,serpConfigs:o,thanosConfig:c},u.save()})},e.toString=function(){return n.toString()},e)}],[{key:"mergeTerminatorConfigs",value:function(a){return a.map(function(t){var e=a.find(function(t){return"0"===t.id}),n={};return n.id=t.id,n.cookies=M()({},t.cookies,e.cookies),n.localStorage=ut()(t.localStorage||[],e.localStorage||[]),n.sessionStorage=ut()(t.sessionStorage||[],e.sessionStorage||[]),n})}}]),h}(st),lt=function(t){function e(){return x()(this,e),_()(this,C()(e).call(this,{name:"topCoupons",url:nt.x.COUPONS}))}return P()(e,t),E()(e,[{key:"parse",value:function(t){return F()(t.coupons,function(t){return{id:t.id,name:t.name,description:t.description,retailerId:t.offer_id,code:t.promo_code,url:t.url,image:t.image,counter:t.counter,type:t.coupon_type,isSpecialDeal:t.is_special_deal,valid:Object(at.o)(t.active_to,"/"),validFrom:t.start_date,network:t.network}})}},{key:"fetch",value:function(){var t={fields:["id","offer_id","name","promo_code","is_special_deal","active_to","url","description","geos"].join(","),language:null};return N()(C()(e.prototype),"fetch",this).call(this,{url:"".concat(this.url,"?").concat(new URLSearchParams(t).toString(),"&isSpecialDeal=1")})}}]),e}(st),dt=function(t){function n(t){var e=t.options;return x()(this,n),_()(this,C()(n).call(this,{name:"user",url:nt.x.USER_INFO,updateDelay:144e5,options:e}))}var e;return P()(n,t),E()(n,[{key:"parse",value:function(t){return t.user}},{key:"resetUserState",value:(e=w()(O.a.mark(function t(){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(at.t)({action:"updateUser",data:{user:null}});case 3:return t.prev=3,this.clear(),t.finish(3);case 6:case"end":return t.stop()}},t,this,[[0,,3,6]])})),function(){return e.apply(this,arguments)})},{key:"clear",value:function(){return Object(at.p)(["".concat(this.name,".lastUpdate"),"".concat(this.name,".data")])}}]),n}(Z.DynamicFetcher),ft=new Error("token is empty"),pt=new Error("refresh token is empty"),vt=new Error("unable to update refresh token");function mt(t){return{accessToken:t.access_token,refreshToken:t.refresh_token,expiresIn:t.expires_in,issuedAt:t.issued_at}}var gt=function(){function t(){x()(this,t),this.isAuthenticated=!1,this.tokenStorageKey="auth.token"}var e,n,a,r,s,i;return E()(t,[{key:"setAuthenticatedStatus",value:function(t){this.isAuthenticated=t}},{key:"refreshToken",value:(i=w()(O.a.mark(function t(e){var n,a,r,s;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw ft;case 2:if(e.refreshToken){t.next=4;break}throw pt;case 4:return n={method:"POST",headers:{Authorization:"Bearer ".concat(e.refreshToken)}},t.prev=5,t.next=8,fetch(nt.x.REFRESH_TOKEN,n);case 8:return a=t.sent,t.next=11,a.json();case 11:return r=t.sent,s=mt(r),t.next=15,this.setAuthToken(s);case 15:return t.abrupt("return",s);case 18:throw t.prev=18,t.t0=t.catch(5),this.setAuthenticatedStatus(!1),vt;case 22:case"end":return t.stop()}},t,this,[[5,18]])})),function(t){return i.apply(this,arguments)})},{key:"signIn",value:(s=w()(O.a.mark(function t(e){var n,a,r,s,i,o;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.email,a=e.password,r=JSON.stringify({email:n,password:a}),t.next=4,fetch(nt.x.USER_SIGN_IN,{method:"POST",headers:nt.f,body:r});case 4:if(200!==(s=t.sent).status)return t.next=8,s.json();t.next=9;break;case 8:throw t.sent;case 9:return t.next=11,s.json();case 11:return i=t.sent,o=mt(i),t.next=15,this.setAuthToken(o);case 15:return t.abrupt("return",o);case 16:case"end":return t.stop()}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"signUp",value:(r=w()(O.a.mark(function t(e){var n,a,r,s,i,o,c,u,h,l,d,f,p,v;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.email,a=e.password,r=e.phone,s=e.firstName,i=e.lastName,o=e.birthDate,c=e.gender,u=void 0===c?"":c,h=e.inviteToken,l=void 0===h?"":h,d=JSON.stringify({email:n,password:a,phone:r,gender:u,invite_token:l,first_name:s,last_name:i,birth_date:o}),t.next=4,fetch(nt.x.USER_SIGN_UP,{method:"POST",headers:nt.f,body:d});case 4:if(200!==(f=t.sent).status)return t.next=8,f.json();t.next=9;break;case 8:throw t.sent;case 9:return t.next=11,f.json();case 11:return p=t.sent,v=mt(p),t.next=15,this.setAuthToken(v);case 15:return t.abrupt("return",v);case 16:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"getAuthHeader",value:(a=w()(O.a.mark(function t(){var e;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAuthToken();case 2:if(e=t.sent,1e3*e.expiresIn-new Date<0)return t.next=7,this.refreshToken(e);t.next=8;break;case 7:e=t.sent;case 8:return t.abrupt("return",{Authorization:"Bearer ".concat(e.accessToken)});case 9:case"end":return t.stop()}},t,this)})),function(){return a.apply(this,arguments)})},{key:"getAuthToken",value:(n=w()(O.a.mark(function t(){var e,n;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(Z.getStorageData)(this.tokenStorageKey);case 3:if(e=t.sent,(n=e[this.tokenStorageKey])&&n.accessToken){t.next=8;break}return this.setAuthenticatedStatus(!1),t.abrupt("return",void 0);case 8:return t.abrupt("return",n);case 11:return t.prev=11,t.t0=t.catch(0),t.abrupt("return",null);case 14:case"end":return t.stop()}},t,this,[[0,11]])})),function(){return n.apply(this,arguments)})},{key:"setAuthToken",value:(e=w()(O.a.mark(function t(e){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&e.accessToken)return t.next=3,Object(at.s)(T()({},this.tokenStorageKey,e));t.next=6;break;case 3:this.setAuthenticatedStatus(!0),t.next=9;break;case 6:return t.next=8,Object(at.s)(T()({},this.tokenStorageKey,null));case 8:this.setAuthenticatedStatus(!1);case 9:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})}]),t}();function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function kt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(n),!0).forEach(function(t){T()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var yt=function(){function a(t){var e=t.authService,n=t.sessionsStore;x()(this,a),this.extId=void 0,this.authService=e,this.sessionsStore=n,this.init=this.init.bind(this)}var t,e,n,r,s;return E()(a,[{key:"linkExtensionWithUserTransaction",value:(s=w()(O.a.mark(function t(){var e,n,a;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.authService.getAuthHeader();case 2:return e=t.sent,n=kt({},nt.f,{},e),a={extensionId:this.extId},t.next=7,fetch(nt.x.EXTENSION_SYNC_USER,{method:"POST",headers:n,body:JSON.stringify(a)});case 7:case"end":return t.stop()}},t,this)})),function(){return s.apply(this,arguments)})},{key:"generateXid",value:function(){return"ext-".concat(Z.Analytics.uuidv4())}},{key:"createTransaction",value:(r=w()(O.a.mark(function t(e){var n,a,r,s,i,o,c,u,h,l,d;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.merchantId,a=void 0===n?"":n,r=e.network,s=void 0===r?"":r,i=e.xid,o={xid:i,network:s,offer_id:a,extension_id:this.extId},t.prev=2,t.next=5,this.authService.getAuthHeader();case 5:u=t.sent,c=kt({},nt.f,{},u),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),c=nt.f;case 12:return t.next=14,fetch(nt.x.TRANSACTIONS_CREATE,{headers:c,method:"POST",body:JSON.stringify(o)});case 14:if((h=t.sent).ok)return t.next=18,h.json();t.next=20;break;case 18:l=t.sent,a&&(d={merchantId:a,data:{xid:i,shoppingTrip:l.transaction_id,lastActivation:Date.now()}},this.sessionsStore.updateSession(d));case 20:case"end":return t.stop()}},t,this,[[2,9]])})),function(t){return r.apply(this,arguments)})},{key:"syncLastMallbeyTransaction",value:(n=w()(O.a.mark(function t(){var e,n,a,r,s,i;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.authService.getAuthHeader();case 2:return e=t.sent,n=kt({},nt.f,{},e),t.next=6,fetch(nt.x.TRANSACTIONS_LAST,{method:"POST",headers:n});case 6:return a=t.sent,t.next=9,a.json();case 9:if(r=t.sent,s=r.transaction,/^ext-*/.test(s.xid))throw Error("transaction is created by extension");t.next=14;break;case 14:i={merchantId:s.offer_id,data:{xid:s.xid,shoppingTrip:s.id}},this.sessionsStore.updateSession(i);case 16:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"makeOrder",value:(e=w()(O.a.mark(function t(e){var n,a,r,s,i,o,c,u,h,l,d,f,p,v;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.merchantId,a=e.orderId,r=e.session,s=e.orderSum,i=void 0===s?0:s,o=r.xid,c=r.id,u=r.attributes,h=void 0===u?null:u,l=Math.round((new Date).getTime()/1e3),d={xid:o,orderSum:i,timestamp:l,sessionId:c,cookie:JSON.stringify(h),orderID:a,offer_id:n,ext_id:this.extId},f=nt.f,t.prev=5,t.next=8,this.authService.getAuthHeader();case 8:p=t.sent,f=kt({},f,{},p),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(5);case 15:return t.prev=15,t.next=18,fetch(nt.x.TRANSACTIONS_ORDER,{method:"POST",headers:f,body:JSON.stringify(d)});case 18:return v=t.sent,t.abrupt("return",v.json());case 22:return t.prev=22,t.t1=t.catch(15),t.abrupt("return",!0);case 26:case"end":return t.stop()}},t,this,[[5,12],[15,22]])})),function(t){return e.apply(this,arguments)})},{key:"init",value:(t=w()(O.a.mark(function t(){var e,n,a;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Z.getStorageData)(nt.j);case 2:if(e=t.sent,n=e[nt.j]){t.next=22;break}if("PC"!==chrome.i18n.getMessage("appClient")){t.next=9;break}n=Z.Analytics.uuidv4(),t.next=12;break;case 9:return n=chrome.i18n.getMessage("appClient"),t.next=12,fetch("https://topaudit.online/install/app?client=".concat(n)).catch();case 12:return Object(Z.setStorageData)(T()({},nt.j,n)),a={extension_id:n},t.prev=14,t.next=17,fetch(nt.x.EXTENSION_CREATION,{method:"POST",headers:nt.f,body:JSON.stringify(a)});case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(14);case 22:this.extId=n,this.isStore=nt.r.UUID.test(n);case 24:case"end":return t.stop()}},t,this,[[14,19]])})),function(){return t.apply(this,arguments)})}]),a}(),St=n(39),It=n.n(St),Tt=n(170),wt=n.n(Tt),xt=n(346),At=n.n(xt),Ot=function(t){function s(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.lang,a=void 0===n?navigator.language.slice(0,2):n,r=e.prefix;return x()(this,s),t=r?_()(this,C()(s).call(this,{name:"".concat(r,"_translations")})):_()(this,C()(s).call(this,{name:"translations"})),nt.u.includes(a)?t.language=a:t.language=nt.h,_()(t)}var e;return P()(s,t),E()(s,[{key:"setLanguage",value:(e=w()(O.a.mark(function t(e){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return nt.u.includes(e)?this.language=e:this.language=nt.h,t.next=3,this.fetch();case 3:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"fetch",value:function(){this.updateController&&this.updateController.abort(),this.updateController=new AbortController;var t=nt.x.TRANSLATIONS.replace("%language",this.language);return N()(C()(s.prototype),"fetch",this).call(this,{url:t})}},{key:"handleDoubleCurlyBracers",value:function(n){var a=this;At()(n,function(t,e){n[e]&&(wt()(n[e])?n[e]=n[e].replace(/{{/g,"{").replace(/}}/g,"}"):It()(n[e])&&a.handleDoubleCurlyBracers(n[e]))})}},{key:"parse",value:function(t){return this.handleDoubleCurlyBracers(t),t}}]),s}(st),Et=n(347),_t=n.n(Et),jt=n(348),Ct=n.n(jt),Nt=n(64),Pt=n.n(Nt),Rt=n(349),Lt=n.n(Rt);function Ut(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}var Dt=function(){function n(t){var e=t.sendMerchantVisitAnalytics;x()(this,n),this.name="sessions",this.dataKey="".concat(this.name,".data"),this.sessions=[],this.sendMerchantVisitAnalytics=e,this.loadSessionsFromStorage(),this.saveSessionsToStorage=Pt()(this.saveSessionsToStorage,2e3),this.sortSessions=Pt()(this.sortSessions,1e3)}var t;return E()(n,[{key:"loadSessionsFromStorage",value:(t=w()(O.a.mark(function t(){var e,n;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Z.getStorageData)(this.dataKey);case 2:(e=t.sent)&&(n=e[this.dataKey]||[],this.sessions=n.map(function(t){return Ct()(t,["id","activated"])}),this.sortSessions());case 4:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"saveSessionsToStorage",value:function(){Object(Z.setStorageData)(T()({},this.dataKey,this.sessions))}},{key:"cleanSessionsStorage",value:function(){this.sessions=[],Object(Z.setStorageData)(T()({},this.dataKey,[]))}},{key:"resetSessionId",value:function(t){var e=t.merchantId;V()(this.sessions,function(t){t.merchantId===e&&delete t.id}),this.saveSessionsToStorage()}},{key:"sortSessions",value:function(){this.sessions=Lt()(this.sessions,function(t){return t.lastVisitTime||0},["desc"])}},{key:"updateSession",value:function(t){var e=t.merchantId,n=t.data,a=void 0===n?{}:n;if(e){var r=this.getSessionByMerchantId(e),s=q()(r,"id");if(r){var i=r.id,o=void 0===i?Z.Analytics.uuidv4():i;M()(r,{id:o},a,{ts:Date.now()})}else{var c=a.id,u=void 0===c?Z.Analytics.uuidv4():c,h=a.activated,l=void 0!==h&&h;r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ut(Object(n),!0).forEach(function(t){T()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ut(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},_t()(a,["id","activated"]),{id:u,merchantId:e,ts:Date.now(),activated:l}),this.sessions.push(r)}var d=q()(r,"id");d&&s!==d&&this.sendMerchantVisitAnalytics({session:r}),this.sortSessions(),this.saveSessionsToStorage()}}},{key:"getRecentSessions",value:function(t){var e=t.count,n=void 0===e?10:e;return this.sessions.slice(0,n).filter(function(t){return t.lastVisitTime})}},{key:"getSessionByMerchantId",value:function(t){return J()(this.sessions,{merchantId:t})}}]),n}(),Bt=n(3),Mt=function(t){function o(t){var e;x()(this,o),e=_()(this,C()(o).call(this,t));var n=t.transactionService,a=t.sessionsStore,r=t.settings,s=t.getGeo,i=t.getLanguage;return e.name="analytics",e.lastStatusUpdateKey="".concat(e.name,".lastStatusUpdate"),e.lastStatusUpdate=void 0,e.transactionService=n,e.sessionsStore=a,e.settings=r,e.browser=Object(at.h)(),e.os=navigator.platform,e.extVersion=chrome.runtime.getManifest().version,e.getGeo=s,e.getLanguage=i,e.setEvents(),e.initExtensionStatusUpdate(),e}var e,n,a,r,s;return P()(o,t),E()(o,[{key:"setEvents",value:function(){this.setExtensionsEvents()}},{key:"send",value:function(){this.settings.allowDataCollection}},{key:"loadLastStatusUpdate",value:(s=w()(O.a.mark(function t(){var e;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Z.getStorageData)(this.lastStatusUpdateKey);case 2:e=t.sent,this.lastStatusUpdate=q()(e,"".concat(this.dataKey));case 4:case"end":return t.stop()}},t,this)})),function(){return s.apply(this,arguments)})},{key:"saveLastStatusUpdate",value:function(){return Object(at.s)(T()({},this.lastStatusUpdateKey,this.lastStatusUpdate))}},{key:"shouldUpdateExtensionStatus",value:function(){return!(this.lastStatusUpdate&&12<=Object(at.k)(this.lastStatusUpdate))}},{key:"extendWithUserData",value:function(t){if(this.settings.allowDataCollection){var e={os:this.os,browser:this.browser,language:this.getLanguage()||null,location:this.getGeo(null)||null};M()(t,e)}}},{key:"extensionStatusUpdate",value:(r=w()(O.a.mark(function t(){var e;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e={extension_id:this.transactionService.extId,extension_version:this.extVersion,category:1},this.extendWithUserData(e),t.next=4,fetch(nt.x.ANALYTIC_EXT_STATISTICS,{method:"POST",body:JSON.stringify(e),headers:nt.f});case 4:return this.lastStatusUpdate=Date.now(),t.next=7,this.saveLastStatusUpdate();case 7:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"initExtensionStatusUpdate",value:(a=w()(O.a.mark(function t(){var e=this;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadLastStatusUpdate();case 2:if(this.shouldUpdateExtensionStatus())return t.prev=3,t.next=6,this.extensionStatusUpdate();t.next=11;break;case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3);case 11:this.updateInterval=setInterval(function(){e.shouldUpdateExtensionStatus()&&e.extensionStatusUpdate()},36e5);case 12:case"end":return t.stop()}},t,this,[[3,8]])})),function(){return a.apply(this,arguments)})},{key:"sendMallberyMerchantVisit",value:(n=w()(O.a.mark(function t(e){var n,a,r,s;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.session,a=e.merchantName,r=n.merchantId,s={category:2,offer_id:+r,extension_id:this.transactionService.extId,extension_version:this.extVersion},this.extendWithUserData(s),t.next=6,fetch(nt.x.ANALYTIC_EXT_STATISTICS,{method:"POST",body:JSON.stringify(s),headers:nt.f});case 6:a&&this.send({ec:Bt.b.VISITED_MERCHANT,ea:Bt.a.VISITED_MERCHANT_VISIT,el:a});case 7:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"sendMallberyAnalyticsGA",value:(e=w()(O.a.mark(function t(e){var n,a,r,s;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.el,a=e.ec,r=e.ea,s={category:a,label:n,action:r,extension_id:this.transactionService.extId,extension_version:this.extVersion},this.extendWithUserData(s),t.next=5,fetch(nt.x.ANALYTIC_GA,{method:"POST",body:JSON.stringify(s),headers:nt.f});case 5:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"setExtensionsEvents",value:function(){var e=this;chrome.management.onUninstalled.addListener(function(t){e.send({ec:Bt.b.EXTENSION,ea:Bt.a.EXTENSION_REMOVE,el:"string"==typeof t?t:t.id})}),chrome.management.onInstalled.addListener(function(t){e.send({ec:Bt.b.EXTENSION,ea:Bt.a.EXTENSION_INSTALL,el:t.id})}),chrome.management.onEnabled.addListener(function(t){e.send({ec:Bt.b.EXTENSION,ea:Bt.a.EXTENSION_ENABLE,el:t.id})}),chrome.management.onDisabled.addListener(function(t){e.send({ec:Bt.b.EXTENSION,ea:Bt.a.EXTENSION_DISABLE,el:t.id})})}}]),o}(Z.Analytics),Ft=function(){function e(t){x()(this,e),this.name="terminator",this.dataKey="".concat(this.name,".merchantDomains"),this.merchantDomains={},this.merchantRequestListeners={},this.tabs=t.tabs,this.configs=t.configs,this.merchants=t.merchants,this.getMerchantAndState=t.getMerchantAndState,this.loadDomainsFromStorage(),this.throttledSetStorageData=Pt()(Z.setStorageData,2e3)}var n,t;return E()(e,[{key:"loadDomainsFromStorage",value:(t=w()(O.a.mark(function t(){var e;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Z.getStorageData)(this.dataKey);case 2:(e=t.sent)&&(this.merchantDomains=e[this.dataKey]||{});case 4:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"hasConfig",value:function(e){return!!this.configs.find(function(t){return t.id===e})}},{key:"getPageRequestsDomains",value:function(t,e){var a=this,n=t.tabId,r=t.merchantId,s=1<arguments.length&&void 0!==e&&e,i={urls:["<all_urls>"],tabId:n,types:["main_frame","sub_frame","image","script"]};this.merchantRequestListeners[r]||(this.merchantRequestListeners[r]={listener:function(t){var e=a.merchantDomains[r]||{data:{}},n=new URL(t.url).origin;e.data[n]=Date.now(),a.merchantDomains[r]=e}}),s?chrome.webRequest.onBeforeRequest.removeListener(this.merchantRequestListeners[r].listener):q()(this.merchantRequestListeners[r],"tabId")||(chrome.webRequest.onBeforeRequest.addListener(this.merchantRequestListeners[r].listener,i),this.merchantRequestListeners[r].tabId=!0)}},{key:"getMerchantTabs",value:function(e){var n={},a=this.tabs;return Object.keys(a).forEach(function(t){a[t].merchantId===e&&(n[t]=!0)}),n}},{key:"awaitTabLoaded",value:function(s){var i=this;return G()(this.getMerchantTabs(s))?"skip":new Promise(function(n){var a,r=setInterval(w()(O.a.mark(function t(){var e;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.merchants.checkTabsOnLoading(s);case 2:e=t.sent,0<Object.keys(q()(i.merchantDomains,"".concat(s,".data"),{})).length&&e&&(clearInterval(r),clearTimeout(a),i.throttledSetStorageData(T()({},i.dataKey,i.merchantDomains)),n());case 4:case"end":return t.stop()}},t)})),1e3);a=setTimeout(function(){clearInterval(r),clearTimeout(a),i.throttledSetStorageData(T()({},i.dataKey,i.merchantDomains)),n()},12e4)})}},{key:"terminate",value:(n=w()(O.a.mark(function t(e){var n,a,r,s,i,o,c,u,h,l,d,f=this;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.merchantId,a=e.sender,r=e.activeTab,s=this.configs.find(function(t){return t.id===n})){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,this.awaitTabLoaded(n);case 6:if("skip"===t.sent)return t.abrupt("return");t.next=9;break;case 9:return i=q()(a,"tab.id",r),this.getPageRequestsDomains({tabId:r,merchantId:n},!0),o="\n    (() => {\n      const clearStorage = (storage, config) => {\n        if (config[0] !== '*') {\n          const storageKeys = { ...storage };\n          config.forEach((configKey) => {\n            if (storageKeys[configKey]) {\n              delete storageKeys[configKey];\n            }\n          });\n          Object.keys(storageKeys).forEach((key) => {\n            storage.removeItem(key);\n          });\n        }\n        };\n        const localConfig = ".concat(JSON.stringify(s.localStorage),";\n        const sessionConfig = ").concat(JSON.stringify(s.sessionStorage),";\n        clearStorage(localStorage, localConfig);\n        clearStorage(sessionStorage, sessionConfig);\n    })()\n    "),chrome.tabs.executeScript(i,{code:o,allFrames:!0,runAt:"document_end"}),c=this.merchantDomains[n].data,u=c&&Object.keys(c),h=s.cookies,l=Object.keys(h),d=u.map(function(){var e=w()(O.a.mark(function t(r){var e,n,a,s;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return Date.now()-c[r]>nt.w&&delete c[r],e=f.merchants.getByUrl(r),n=e?{domain:e.domain}:{url:r},t.next=5,Object(at.i)(n);case 5:return a=t.sent,s=a.map(function(){var e=w()(O.a.mark(function t(e){var n,a;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=!0,a=l.find(function(t){return e.domain.includes(t)}),h[a]&&(1===h[a].length&&"*"===h[a][0]?n=!1:h[a].forEach(function(t){t===e.name&&(n=!1)})),n&&chrome.cookies.remove({url:r,name:e.name});case 4:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()),t.next=9,Promise.all(s);case 9:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()),t.next=20,Promise.all(d);case 20:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})}]),e}(),Gt=n(350),qt=n.n(Gt),zt=function(){function e(t){x()(this,e),this.name="thanos",this.data={},this.configs=t.configs[0]||[],this.browser=t.browser,this.state=!1,this.allExt=[],this.ignoreId="",this.init()}var t,n,a,r,s;return E()(e,[{key:"init",value:(s=w()(O.a.mark(function t(){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAllExtension();case 2:return this.allExt=t.sent,t.t0=q.a,t.next=6,this.getSelf();case 6:return t.t1=t.sent,this.ignoreId=(0,t.t0)(t.t1,"id"),t.next=10,this.controller(!1,"anyTime");case 10:case"end":return t.stop()}},t,this)})),function(){return s.apply(this,arguments)})},{key:"controller",value:(r=w()(O.a.mark(function t(e){var n,a,r=this,s=arguments;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=1<s.length&&void 0!==s[1]?s[1]:"activationTime",t.next=3,this.checkState();case 3:if(this.state){t.next=5;break}return t.abrupt("return");case 5:return a=qt()(q()(this.configs,n,[]),this.allExt),t.next=8,Q()(a,function(t){r.toggleExtension(t,e)});case 8:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"getAllExtension",value:(a=w()(O.a.mark(function t(){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(n){chrome.management.getAll(function(t){var e=t.filter(function(t){return t.enabled});n(e.map(function(t){return t.id}))})}));case 1:case"end":return t.stop()}},t)})),function(){return a.apply(this,arguments)})},{key:"getSelf",value:(n=w()(O.a.mark(function t(){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t){chrome.management.getSelf(t)}));case 1:case"end":return t.stop()}},t)})),function(){return n.apply(this,arguments)})},{key:"toggleExtension",value:function(t,e){var n=!(1<arguments.length&&void 0!==e)||e;try{if(t===this.ignoreId)return;chrome.management.setEnabled(t,n)}catch(t){}}},{key:"checkState",value:(t=w()(O.a.mark(function t(){var e,n;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Z.getStorageData)("cashback.settings");case 2:e=t.sent,n=q()(e["cashback.settings"],"isAgreementAccepted")||!q()(e["cashback.settings"],"deployed"),this.state="yabrowser"!==this.browser&&"firefox"!==this.browser&&!!chrome.management.getAll&&n;case 5:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})}]),e}();function Vt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function Ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vt(Object(n),!0).forEach(function(t){T()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}n.d(e,"a",function(){return Kt});var Kt=function(t){function n(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return x()(this,n),(t=_()(this,C()(n).call(this,e))).userInfo=null,t.authService=new gt,t.sessionsStore=new Dt({sendMerchantVisitAnalytics:t.sendMerchantVisitAnalytics.bind(j()(t))}),t.transactionService=new yt({authService:t.authService,sessionsStore:t.sessionsStore}),t.showInstallBar=!0,t.settings={allowDataCollection:!0,autoCashBack:!1,theme:"autoswitch",sliderSize:"normal",darkTheme:!1,blackListCAAEnabled:!1,blackListCAA:[],blackListSliderEnabled:!1,blackListSlider:[],isSerpEnabled:!0,successSliderEnabled:!0,lastChanceSliderEnabled:!0,postPurchaseSliderEnabled:!0,timeSince:"20:00",timeTo:"08:00",analyticsClientId:null,signUpShowed:!1,language:navigator.language.slice(0,2),deployed:!1,showAgreement:!0,showAgreementAgain:null,isAgreementAccepted:!1,tutorial:{caa:!0,serp:!0,slider:!0},activationResetTimeWithCookie:2592e5,activationResetTimeWithoutCookie:36e5},t.isLoginClosed=!1,t.autoCashBackPool=[],t.activationPool=[],t.configs=new ht,t.topCoupons=new lt,t.icon=new rt,t.translations=new Ot,t.fallbackTranslations=new Ot({prefix:"fallback",lang:nt.h}),t.tabs={},t.browser=Object(at.h)(),t.checkLogin={},t.updateIcon(),t.contextInitState=t.transactionService.init().finally(function(){return t.merchants=new ot({isStore:t.transactionService.isStore,getLanguage:t.getLanguage.bind(j()(t)),getGeo:t.getGeo.bind(j()(t))}),t.init()}),t.setInstalledEvent(),t.notifyLaterList=[],t}var e,a,r,s,i,o,c,u,h,l,d,f,p,v,m,g,b,k,y,S,I;return P()(n,t),E()(n,[{key:"init",value:(I=w()(O.a.mark(function t(){var e,n,a=this;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkUserToken(),t.next=3,Promise.all([this.merchants.init(),this.topCoupons.init(),this.configs.init(),this.translations.fetch(),this.fallbackTranslations.fetch(),this.setLegacySettings().then(function(){return a.settings.deployed&&(a.updateIcon(),chrome.browserAction.setPopup({popup:"popup.html"})),a.initAnalytics()})]);case 3:this.terminator=new Ft({tabs:this.tabs,configs:this.configs.data.terminatorConfig,merchants:this.merchants,getMerchantAndState:this.getMerchantAndState.bind(this)}),this.thanos=new zt({configs:this.configs.data.thanosConfig,browser:this.browser}),this.setEvents(),this.updateIcon(),e=this.configs.data||{},n=e.activationParams,this.activationPatterns=n||this.activationPatterns;case 9:case"end":return t.stop()}},t,this)})),function(){return I.apply(this,arguments)})},{key:"setLegacySettings",value:(S=w()(O.a.mark(function t(){var e,n,a,r,s,i,o,c,u,h,l,d,f,p,v,m,g,b,k,y,S,I,T,w,x;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([Object(Z.getStorageData)("cashback.settings"),Object(Z.getStorageData)("CACHE"),Object(Z.getStorageData)("options"),Object(Z.getStorageData)("launchCashbackModule")]);case 2:e=t.sent,n=A()(e,4),a=n[0],r=n[1].CACHE,s=n[2].options,i=n[3].launchCashbackModule,o={deployed:i||this.settings.deployed},r&&(c=r.ids,u=r.tutorial,h=void 0===u?{}:u,M()(o,{analyticsClientId:c&&c.clientId&&c.clientId.data,tutorial:{caa:h.Caa,serp:h.Serp,slider:h.Slider}})),s&&(l=s.allowDataCollect,d=s.autoCashback,f=s.theme,p=s.timeSince,v=s.timeTo,m=s.isBlockedCAA,g=s.blockedCAA,b=s.blockedSlider,k=s.isBlockedSlider,y=s.size,S=s.showSerps,I=s.showPostPurchase,T=s.showLastChance,w=s.showActiveSlider,M()(o,{allowDataCollection:l,autoCashBack:d,theme:f.toLowerCase(),timeSince:p,timeTo:v,blackListCAA:g,blackListCAAEnabled:m,blackListSlider:b,blackListSliderEnabled:k,sliderSize:y,isSerpEnabled:S,postPurchaseSliderEnabled:I,lastChanceSliderEnabled:T,successSliderEnabled:w})),(x=a["cashback.settings"]||{}).isAgreementAccepted?x.showAgreement=!1:x.showAgreementAgain<=L()()||void 0===x.showAgreement?x.showAgreement=!0:x.showAgreement=!1,M()(this.settings,o,x),this.saveSettings();case 15:case"end":return t.stop()}},t,this)})),function(){return S.apply(this,arguments)})},{key:"setUninstallEvent",value:function(){chrome.runtime.setUninstallURL(nt.x.UNINSTALL_PAGE+this.transactionService.extId)}},{key:"setInstalledEvent",value:function(){var i=this;chrome.runtime.onInstalled.addListener(function(){var e=w()(O.a.mark(function t(e){var n,a,r,s;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.reason,t.next=3,i.contextInitState;case 3:"install"===n?(chrome.tabs.create({url:nt.x.AFTER_INSTALL_PAGE}),i.settings.deployed=!0,i.saveSettings(),i.updateOpenedHomePages(),i.analytics.send({ec:Bt.b.EXTENSION,ea:Bt.a.EXTENSION_INSTALL,el:chrome.runtime.id}),chrome.management.getAll(function(t){var e=t.map(function(t){return t.id});i.analytics.send({ec:Bt.b.EXTENSION,ea:Bt.a.EXTENSION_INSTALLED,el:e})}),a=window.navigator.vendor,r=window.navigator.userAgent,s=a?r.match(/OPR/)?"Opera":r.match(/YaBrowser/)?"Yandex":"Chrome":r.match(/Edge/)?"Edge":"Firefox",i.analytics.send({ec:Bt.b.RETENTION,ea:Bt.a.RETENTION_LIFE,el:s})):"update"===n&&i.analytics.send({ec:i.transactionService.isStore?Bt.b.UPDATE_STORE:Bt.b.UPDATE_LOCAL,ea:i.settings.deployed?Bt.a.UPDATE_DEPLOYED:Bt.a.UPDATE_NOT_DEPLOYED,el:i.analytics.extVersion});case 4:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}())}},{key:"checkUserToken",value:(y=w()(O.a.mark(function t(){var e,n,a,r,s,i,o,c,u=arguments;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=0<u.length&&void 0!==u[0]&&u[0],t.next=3,this.authService.getAuthToken();case 3:if(n=t.sent){t.next=6;break}return t.abrupt("return");case 6:if(t.prev=6,a=1e3*n.expiresIn-new Date<0,r=e||null===this.userInfo,a)return t.next=12,this.authService.refreshToken(n);t.next=14;break;case 12:n=t.sent,r=!0;case 14:if(s=q()(this.userInfo,"data.email"),!this.userInfo||r)return i={headers:{Authorization:"Bearer ".concat(n.accessToken)}},this.userInfo=new dt({options:i}),t.next=20,this.userInfo.update(!0);t.next=42;break;case 20:if(Object(at.t)({action:"updateUser",data:{user:this.userInfo}}),t.prev=21,(o=q()(this.userInfo,"data.language"))&&o!==this.translations.language)return t.next=26,this.translations.setLanguage(o);t.next=27;break;case 26:q()(this,"settings.language")!==o&&this.updateSettings({request:{data:{language:o}}});case 27:t.next=32;break;case 29:t.prev=29,t.t0=t.catch(21);case 32:if(c=q()(this.userInfo,"data.email"),s!==c)return t.prev=34,t.next=37,this.transactionService.linkExtensionWithUserTransaction();t.next=42;break;case 37:t.next=42;break;case 39:t.prev=39,t.t1=t.catch(34);case 42:t.next=47;break;case 44:t.prev=44,t.t2=t.catch(6);case 47:case"end":return t.stop()}},t,this,[[6,44],[21,29],[34,39]])})),function(){return y.apply(this,arguments)})},{key:"getUser",value:(k=w()(O.a.mark(function t(e){var n,a;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.sendResponse,t.next=3,this.checkUserToken();case 3:if(this.userInfo)return t.next=6,this.userInfo.update(!1);t.next=10;break;case 6:a=t.sent,n(a),t.next=11;break;case 10:n(null);case 11:case"end":return t.stop()}},t,this)})),function(t){return k.apply(this,arguments)})},{key:"initAnalytics",value:function(){this.settings.analyticsClientId||(this.settings.analyticsClientId=Z.Analytics.uuidv4(),this.saveSettings()),this.analytics=new Mt({tid:nt.k,cid:this.settings.analyticsClientId,transactionService:this.transactionService,sessionsStore:this.sessionsStore,settings:this.settings,getGeo:this.getGeo.bind(this),getLanguage:this.getLanguage.bind(this)}),this.setUninstallEvent()}},{key:"sendAnalytics",value:function(t){var e=t.request;this.analytics.send(e.data)}},{key:"updateTabsState",value:function(t){var e=t.tabId,n=t.url,a=t.merchantId,r=!1;a&&(r=-1===K()(Object.values(this.tabs),{merchantId:a}));var s=this.tabs[e]||{},i=q()(s,"url","");return s=M()({},s,{url:n,previousUrl:i,merchantId:a}),this.tabs[e]=s,r&&this.sessionsStore.updateSession({merchantId:a}),s}},{key:"removeTabsState",value:function(t){var e=t.tabId,n=q()(this.tabs,"".concat(e,".merchantId"));delete this.tabs[e],n&&(-1!==K()(Object.values(this.tabs),{merchantId:n})||this.sessionsStore.resetSessionId({merchantId:n}))}},{key:"setEvents",value:function(){var c=this;chrome.webNavigation.onBeforeNavigate.addListener(function(t){0===t.frameId&&(c.check(t),c.checkUserToken())}),chrome.tabs.onRemoved.addListener(function(t){c.removeTabsState({tabId:t}),c.updateIcon()}),chrome.tabs.onUpdated.addListener(function(){var a=w()(O.a.mark(function t(e,n,a){var r,s,i,o;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=a.url,"loading"!==n.status){t.next=15;break}if(c.check({url:r,tabId:e}),t.prev=3,s=c.updateTabsState({tabId:e,url:r}),(i=s.previousUrl)&&nt.m.test(i))return t.next=8,c.transactionService.syncLastMallbeyTransaction();t.next=9;break;case 8:c.setActivation({tabId:e});case 9:return t.prev=9,c.checkMerchantStatus({url:r,tabId:e}),c.updateIcon(),t.finish(9);case 13:t.next=30;break;case 15:if("complete"!==n.status){t.next=30;break}if(nt.g.test(r)&&c.checkUserToken(!0).catch(),(o=J()(c.activations,function(t){return t.tabId===e})||{}).removable)return t.next=21,Object(at.a)(nt.b);t.next=24;break;case 21:c.removeActivation(o),t.next=30;break;case 24:return t.next=26,c.checkMerchantReactivation({url:r,tabId:e});case 26:if(t.sent){t.next=30;break}return t.next=30,c.checkCookiesAndUrlParams({url:r});case 30:case"end":return t.stop()}},t,null,[[3,,9,13]])}));return function(t,e,n){return a.apply(this,arguments)}}()),chrome.tabs.onActivated.addListener(function(){c.updateIcon()}),chrome.windows.onFocusChanged.addListener(function(){c.updateIcon()}),chrome.runtime.onMessage.addListener(function(e,n,a){if(e&&"function"==typeof c[e.action]){var r=!1,s=function(t){r=!0,a(t)};(function(){var t=w()(O.a.mark(function t(){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c[e.action]({request:e,sender:n,sendResponse:s}));case 1:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}})()().finally(function(){r||a(null)})}return!0})}},{key:"check",value:function(t){this.checkActivation(t),this.checkSuppression(t)}},{key:"checkActivation",value:function(t){var e=t.url;nt.r.ACTIVATION.test(e)&&N()(C()(n.prototype),"checkActivation",this).call(this,t)}},{key:"getPartnerConfigByMerchant",value:function(t){var e=t.id,n=t.network,a=J()(this.configs.data.cookieConfig,function(t){return t.offer_id===e}),r=q()(a,"config.partners",[]);return J()(r,function(t){return t.partner===n})||{}}},{key:"checkCookiesAndUrlParams",value:(b=w()(O.a.mark(function t(e){var n,a,r,s,i,o,c,u,h,l,d,f,p;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.url,a=this.getMerchantAndState({url:n}),r=a.merchant,s=a.state,r){t.next=4;break}return t.abrupt("return");case 4:if(i=this.getPartnerConfigByMerchant(r),o=i.url,c=i.cookie,u={},h=c&&0<c.length,l=!0,h)return t.next=11,Object(at.i)({url:n});t.next=15;break;case 11:d=t.sent,Q()(c,function(t){var e=t.key,n=t.value,a=J()(d,function(t){return t.name===e}),r=q()(a,"value",null);(u[e]=r)&&-1!==r.indexOf(n)||(l=!1)}),t.next=16;break;case 15:o&&o.length&&(h=!1,f=Object(at.f)(n),Q()(o,function(t){var e=t.key,n=t.value,a=f[e];u[e]=a||null,a&&-1!==a.indexOf(n)||(l=!1)}));case 16:if(!s.activated||l){t.next=25;break}if(p=h?{autoReactivated:!0}:{activated:!1},this.merchants.setState({id:s.id,data:p}),h)return t.next=22,this.activate({request:{data:{url:r.activationUrl,merchantId:r.id,tab:"new",autoCashBack:r.autoCashBack}}});t.next=24;break;case 22:t.next=25;break;case 24:!1===h&&Object(at.t)({action:"reactivate",data:{merchant:M()({},s,p),showReactivation:!0}});case 25:this.sessionsStore.updateSession({merchantId:r.id,data:{attributes:u,isCookieParamsExist:h,lastVisitTime:Date.now()}});case 26:case"end":return t.stop()}},t,this)})),function(t){return b.apply(this,arguments)})},{key:"checkMerchantReactivation",value:(g=w()(O.a.mark(function t(e){var n,a,r,s,i,o,c,u,h;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.url,a=e.tabId,r=this.merchants.getByUrl(n)){t.next=4;break}return t.abrupt("return",!1);case 4:if((s=this.sessionsStore.getSessionByMerchantId(r.id))&&s.lastActivation){t.next=7;break}return t.abrupt("return",!1);case 7:if(i=Object(at.k)(s.lastActivation),o=U()(s.isCookieParamsExist),c=this.settings,u=c.activationResetTimeWithCookie,h=c.activationResetTimeWithoutCookie,o&&u<=i||!o&&h<=i)return this.merchants.resetCashback({id:r.id}),this.checkMerchantStatus({url:n,tabId:a}),this.updateIcon(),t.abrupt("return",!0);t.next=15;break;case 15:return t.abrupt("return",!1);case 16:case"end":return t.stop()}},t,this)})),function(t){return g.apply(this,arguments)})},{key:"updateIcon",value:(m=w()(O.a.mark(function t(){var e,l,d=this;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.settings.deployed){t.next=3;break}return chrome.browserAction.setTitle({title:" "}),t.abrupt("return",this.icon.start("transparent"));case 3:return chrome.browserAction.setTitle({title:""}),t.next=6,Object(at.l)();case 6:return e=t.sent,t.next=9,Object(at.j)();case 9:return l=t.sent,t.abrupt("return",Q()(e,function(t){var e=t.url,n=t.id,a=t.active,r=t.windowId,s=d.getMerchantAndState({url:e}),i=s.merchant,o=s.state,c="main",u=null;i&&i.isPopup&&(u=d.sessionsStore.getSessionByMerchantId(i.id),c=o.activated&&d.userInfo?"success":"fail");var h=a&&r===l.id&&!q()(u,"activated");d.icon[h?"start":"end"](c,n)}));case 11:case"end":return t.stop()}},t,this)})),function(){return m.apply(this,arguments)})},{key:"updateOpenedHomePages",value:function(){this.settings.deployed&&chrome.tabs.query({url:"*://".concat(nt.i,"/*"),active:!1},function(t){return t.forEach(function(t){var e=t.id;return chrome.tabs.reload(e)})})}},{key:"checkAutoCashBack",value:(v=w()(O.a.mark(function t(e){var n,a,r,s,i,o,c,u,h,l,d,f,p;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.merchant,a=e.state,r=e.tabId,s=this.settings,i=s.autoCashBack,o=s.deployed,c=n.isCashback,u=n.isACBAvailable,h=n.isACBNotActivated,l=n.activationUrl,d=n.id,this.terminator.hasConfig(d)||c){t.next=5;break}return t.abrupt("return");case 5:if(f=o&&i&&u||!o&&h,p=a.activated,f&&!p)return this.autoCashBackPool.push({merchantId:n.id,excludedTabId:r}),t.next=11,this.activate({request:{data:{url:l,merchantId:d,tab:"new",autoCashBack:!0}}});t.next=11;break;case 11:case"end":return t.stop()}},t,this)})),function(t){return v.apply(this,arguments)})},{key:"updateMerchantSession",value:function(t){var e=t.request.data,n=e.merchantId,a=e.data;this.sessionsStore.updateSession({merchantId:n,data:a})}},{key:"checkMerchantStatus",value:(p=w()(O.a.mark(function t(e){var n,a,r,s,i,o,c,u,h,l;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.url,a=e.tabId,r=this.getMerchantAndState({url:n}),s=r.merchant,i=r.state,this.updateTabsState({tabId:a,url:n,merchantId:q()(s,"id")}),s){t.next=5;break}return t.abrupt("return",!1);case 5:if(this.configs.data.terminatorConfig.find(function(t){return t.id===s.id})&&this.terminator.getPageRequestsDomains({tabId:a,merchantId:s.id}),this.merchants.updateMerchantOffers({id:s.id,language:this.translations.language}),o=J()(this.activations,function(t){return t.tabId===a}),c=J()(this.suppressions,function(t){return t.tabId===a}),u=this.sessionsStore.getSessionByMerchantId(s.id),o||J()(this.autoCashBackPool,function(t){return s.id===t.merchantId})||!1===u.isCookieParamsExist){t.next=14;break}return t.next=13,Object(at.a)(R()(nt.e,nt.d));case 13:this.checkAutoCashBack({merchant:s,state:i,tabId:a});case 14:if(c||o){t.next=16;break}return t.abrupt("return",!1);case 16:return h=q()(u,"activated"),l={suppressed:!!c,activated:!!o,autoActivated:o.autoCashBack,showNotification:!(c&&!o||h)},this.merchants.setState({url:n,id:s.id,data:l,tabId:a}),c&&(clearTimeout(c.timer),D()(this.suppressions,function(t){return t.tabId===a})),t.abrupt("return",!0);case 21:case"end":return t.stop()}},t,this)})),function(t){return p.apply(this,arguments)})},{key:"getMerchantAndState",value:function(t){var e,n=t.url,a=void 0===n?null:n,r=t.id;(e=a?this.merchants.getByUrl(a):J()(this.merchants.data,function(t){return t.id===r}))&&e.id&&this.sessionsStore.updateSession({merchantId:e.id});var s=e&&J()(this.merchants.states,function(t){return t.id===e.id});return{merchant:e,state:s}}},{key:"updateMerchantState",value:function(t){var e=t.request,n=t.sender,a=void 0===n?{}:n;this.merchants.setState({url:a.url,id:e.data.id,data:e.data.state}),this.updateIcon()}},{key:"navigate",value:function(t){var a=this,e=t.request,r=t.sender,n=e.data,s=n.url,i=n.merchantId,o=n.tab;this.transactionService.createTransaction({merchantId:i}).then(function(t){var e=t.xid,n=s+e;"new"===o?chrome.tabs.create({url:n},function(t){var e=t.id;return a.setActivation({tabId:e})}):chrome.tabs.update(r.tab.id,{url:n},function(t){var e=t.id;a.setActivation({tabId:e})})})}},{key:"openSettings",value:(f=w()(O.a.mark(function t(e){var n,a,r,s;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.sender,a=(void 0===n?{}:n).tab,t.next=4,Object(Z.getAllTabs)();case 4:if(r=t.sent,s=J()(r,function(t){return t.url===nt.n}))return t.abrupt("return",chrome.tabs.update(s.id,{active:!0,highlighted:!0}));t.next=8;break;case 8:return t.abrupt("return",chrome.tabs.create({url:nt.n,active:!0,windowId:a&&a.windowId}));case 9:case"end":return t.stop()}},t)})),function(t){return f.apply(this,arguments)})},{key:"activate",value:(d=w()(O.a.mark(function t(e){var n,a,r,s,i,o,c,u,h,l,d,f,p,v,m,g,b,k,y,S,I,T,w,x=this;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.request,a=e.sender,r=n.data,s=r.url,i=r.merchantId,o=r.tab,c=r.autoCashBack,u=r.showLogin,h=void 0!==u&&u,l=r.sa2,t.next=4,this.thanos.controller(!1,"anyTime");case 4:return t.next=6,this.thanos.controller(!1,"activationTime");case 6:return t.next=8,Object(Z.getActiveTab)().then(function(t){return t.id});case 8:if(d=t.sent,f=this.sessionsStore.getSessionByMerchantId(i),p=q()(f,"lastActivation",0),Date.now()-p<nt.b||J()(this.activationPool,function(t){return t===i}))return t.abrupt("return");t.next=13;break;case 13:return this.activationPool.push(i),t.prev=14,t.next=17,this.terminator.terminate({merchantId:i,sender:a,activeTab:d});case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(14);case 22:if(v=this.transactionService.generateXid(),this.transactionService.createTransaction({merchantId:i,xid:v}),m="".concat(nt.x.INTERSTITIAL_PAGE).concat(encodeURIComponent(s+v+(l?"&sa2=".concat(l):""))),g=this.merchants.getById(i),b=this.getPartnerConfigByMerchant(g),k=b.url,y=q()(a,"tab.id",d),G()(k)){t.next=35;break}S=q()(f,"attributes",{}),I=Object.entries(S).map(function(t){var e=A()(t,2),n=e[0],a=e[1];return"".concat(n,"=").concat(a)}).join("&"),T="".concat(m,"&").concat(I),chrome.tabs.update(y,{url:T},function(t){var e=t.id;return x.setActivation({tabId:e})}),t.next=43;break;case 35:t.t1=o,t.next="new"===t.t1?38:"new_tab"===t.t1?40:42;break;case 38:return"firefox"===this.browser||"opera"===this.browser?chrome.tabs.create({url:m,active:!1,openerTabId:y},function(t){var e=t.id;x.setActivation({tabId:e,removable:!0,autoCashBack:c}),h&&chrome.tabs.sendMessage(h,{action:"invokeLogin"})}):(w="yabrowser"===this.browser?"panel":"normal",chrome.windows.create({url:"chrome-search://local-ntp/local-ntp.html",state:"minimized",type:w},function(t){chrome.tabs.update(t.tabs[0].id,{url:m,active:!1,openerTabId:t.tabs[0].id},function(){x.setActivation({tabId:t.tabs[0].id,removable:!0,autoCashBack:c}),h&&chrome.tabs.sendMessage(h,{action:"invokeLogin"})})})),t.abrupt("break",43);case 40:return"firefox"===this.browser||"opera"===this.browser?chrome.tabs.create({url:m,active:!0},function(t){var e=t.id;x.setActivation({tabId:e,removable:!1,autoCashBack:c}),x.userInfo||(x.checkLogin[e]=!0)}):chrome.tabs.create({url:m},function(t){var e=t.id;x.setActivation({tabId:e,removable:!1,autoCashBack:c}),x.userInfo||(x.checkLogin[e]=!0)}),t.abrupt("break",43);case 42:chrome.tabs.update(a.tab.id,{url:m},function(t){var e=t.id;return x.setActivation({tabId:e})});case 43:D()(this.activationPool,function(t){return t===i});case 44:case"end":return t.stop()}},t,this,[[14,19]])})),function(t){return d.apply(this,arguments)})},{key:"setActivation",value:function(e){var t=this,n=J()(this.activations,function(t){return t.tabId===e.tabId});n||(n=e,this.activations.push(n)),clearTimeout(n.timer),n.timer=setTimeout(function(){t.removeActivation(n)},n.removable?nt.c:3e4)}},{key:"removeActivation",value:function(t){var e=this,n=t.tabId,a=t.removable;if(clearTimeout(t.timer),this.thanos.controller(!0,"activationTime"),a)try{return chrome.tabs.remove(n,function(){return D()(e.activations,function(t){return t.tabId===n})})}catch(t){}return D()(this.activations,function(t){return t.tabId===n})}},{key:"initContent",value:function(t){var e=t.sender,n=t.sendResponse;this.isDark();var a=e.url,r=this.checkLogin[e.tab.id],s=this.getMerchantAndState({url:a}),i=s.merchant,o=s.state,c=!1;if(i){var u=this.sessionsStore.getSessionByMerchantId(i.id);c=q()(u,"activated")}var h={merchant:M()({},o,i,{showNotification:q()(o,"showNotification")&&!c}),user:this.userInfo,settings:this.settings,showInstallBar:this.showInstallBar,isMerchant:!!i};r&&i&&(W()(h,{forceLogin:!0}),delete this.checkLogin[e.tab.id]),!this.userInfo&&!this.isLoginClosed&&o&&o.activated&&o.showNotification&&W()(h,{forceLogin:!0}),n(h)}},{key:"getMerchant",value:(l=w()(O.a.mark(function t(e){var n,a,r,s,i,o,c,u,h,l;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.request,a=void 0===n?{}:n,r=e.sender,s=void 0===r?{}:r,i=e.sendResponse,o=a.data||s,c=o.url,u=this.merchants.getByUrl(c),h=this.translations.language,u)return l=J()(this.merchants.states,function(t){return t.id===u.id}),t.next=8,this.merchants.updateMerchantOffers({id:u.id,language:h});t.next=9;break;case 8:return t.abrupt("return",i(M()({},u,l)));case 9:return t.abrupt("return",i(null));case 10:case"end":return t.stop()}},t,this)})),function(t){return l.apply(this,arguments)})},{key:"formatRecentMerchants",value:function(t){var e=0<arguments.length&&void 0!==t?t:5,n=this.sessionsStore.getRecentSessions({count:e}),r=this.merchants.data,s=[];return n.forEach(function(t){var e=t.merchantId,n=t.ts,a=J()(r,function(t){return t.id===e});a&&s.push(Ht({},a,{ts:n}))}),s}},{key:"getRecentMerchants",value:function(t){var e=t.request;(0,t.sendResponse)(this.formatRecentMerchants(e.data.count))}},{key:"getAllMerchants",value:function(t){var e=t.request,n=t.sendResponse,a=e.data.fields,r=this.merchants.data;a&&!G()(a)&&(r=F()(this.merchants.data,function(t){return B()(t,a)})),n(r)}},{key:"isDark",value:function(){if("autoswitch"===this.settings.theme){var t=et()(this.settings.timeSince,"HH:mm"),e=et()(this.settings.timeTo,"HH:mm");this.settings.darkTheme=t.isBefore(e)&&et()().isBetween(t,e)||t.isAfter(e)&&!et()().isBetween(e,t)}else this.settings.darkTheme="dark"===this.settings.theme;return this.settings.darkTheme}},{key:"getConfigs",value:function(t){(0,t.sendResponse)(this.configs.data)}},{key:"getCurrentI18nLang",value:function(t){(0,t.sendResponse)({lang:this.translations.language})}},{key:"getI18nInitContext",value:function(t){var e=t.sendResponse,n=this.fallbackTranslations,a=n.data,r=n.language,s=this.translations;e({fallbackLang:r,fallbackTranslations:a,translations:s.data,lang:s.language})}},{key:"setI18nLang",value:(h=w()(O.a.mark(function t(e){var n;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.request,t.prev=1,t.next=4,this.translations.setLanguage(n.data.lang);case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1);case 9:case"end":return t.stop()}},t,this,[[1,6]])})),function(t){return h.apply(this,arguments)})},{key:"getTranslation",value:function(t){var e=t.request,n=t.sendResponse;e.data&&e.data.lang===nt.h?n(this.fallbackTranslations.data):n(this.translations.data)}},{key:"saveSettings",value:function(){Object(Z.setStorageData)({"cashback.settings":this.settings}),this.settings.deployed&&(chrome.browserAction.setPopup({popup:"popup.html"}),this.updateIcon())}},{key:"updateSettings",value:function(t){var e=t.request.data;"replace"===e.flag?this.settings[e.key]=e.newData:M()(this.settings,e),this.saveSettings(),this.updateTranslations()}},{key:"updateTranslations",value:(u=w()(O.a.mark(function t(){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.settings.language!==this.translations.language)return this.translations.language=this.settings.language,t.abrupt("return",this.translations.fetch());t.next=3;break;case 3:return t.abrupt("return",!1);case 4:case"end":return t.stop()}},t,this)})),function(){return u.apply(this,arguments)})},{key:"userSignIn",value:(c=w()(O.a.mark(function t(e){var n,a;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.request,a=e.sendResponse,t.prev=1,t.next=4,this.authService.signIn(n.data);case 4:return t.next=6,this.checkUserToken();case 6:a({success:!0}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),a(t.t0);case 12:case"end":return t.stop()}},t,this,[[1,9]])})),function(t){return c.apply(this,arguments)})},{key:"userSignUp",value:(o=w()(O.a.mark(function t(e){var n,a;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.request,a=e.sendResponse,t.prev=1,t.next=4,this.authService.signUp(n.data);case 4:return t.next=6,this.checkUserToken();case 6:a({success:!0}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),a(t.t0);case 12:case"end":return t.stop()}},t,this,[[1,9]])})),function(t){return o.apply(this,arguments)})},{key:"updateAuthToken",value:(i=w()(O.a.mark(function t(e){var n,a;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.request,a=q()(n,"data"))return t.next=5,this.authService.setAuthToken(a);t.next=7;break;case 5:return t.next=7,this.checkUserToken();case 7:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"logout",value:(s=w()(O.a.mark(function t(){var e;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.userInfo)return t.next=3,Promise.all([this.sessionsStore.cleanSessionsStorage(),this.authService.setAuthToken(null),this.merchants.resetStates(),this.userInfo.resetUserState()]);t.next=8;break;case 3:return this.userInfo=null,t.next=6,Object(Z.getAllTabs)();case 6:e=t.sent,V()(e,function(t){var e=t.id,n=t.url;!t.active&&nt.g.test(n)&&chrome.tabs.reload(e)});case 8:case"end":return t.stop()}},t,this)})),function(){return s.apply(this,arguments)})},{key:"syncAuthWithSite",value:(r=w()(O.a.mark(function t(e){var n,a,r,s,i,o,c;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.sender,a=e.request,!n.tab.active||!nt.g.test(n.tab.url)){t.next=15;break}if(r=a.data,s=r.isUserAuthorizedOnSite,i=r.auth,o=r.interval,r.changed||!o)return t.next=6,this.authService.getAuthToken();t.next=15;break;case 6:if(c=t.sent,!s&&c)return t.next=10,this.logout();t.next=12;break;case 10:t.next=15;break;case 12:if(s&&!c)return t.next=15,this.updateAuthToken({request:{data:i}});t.next=15;break;case 15:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"refreshAllDomainTabs",value:(a=w()(O.a.mark(function t(e){var n,a,r,s,i;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.sender,a=e.request,n.tab.active){t.next=3;break}return t.abrupt("return");case 3:return r=q()(a,"data.initialDestination"),s=n.tab.id,t.next=7,Object(Z.getAllTabs)();case 7:i=t.sent,V()(i,function(t){var e=t.id,n=t.url;nt.g.test(n)&&(s===e&&r?chrome.tabs.update(e,{url:r}):chrome.tabs.reload(e))});case 9:case"end":return t.stop()}},t)})),function(t){return a.apply(this,arguments)})},{key:"getAuthToken",value:(e=w()(O.a.mark(function t(e){var n,a,r;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.sendResponse,t.next=3,this.authService.getAuthToken();case 3:(a=t.sent)?(r=q()(this.userInfo,"data.email"),n(Ht({},a,{email:r}))):n(null);case 5:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"sendOrder",value:function(t){var e=t.request,n=e.data.merchantId,a=this.sessionsStore.getSessionByMerchantId(n);this.transactionService.makeOrder(M()({},e.data,{session:a}))}},{key:"sendMerchantVisitAnalytics",value:function(t){var e=t.session;if(this.analytics){var n=this.merchants.getById(e.merchantId),a=q()(n,"name");this.analytics.sendMallberyMerchantVisit({session:e,merchantName:a})}}},{key:"updateConfigField",value:function(t){var e=t.request.data,n=e.field,a=e.state;this[n]=a,Object(at.t)({action:"update",data:T()({},n,a)})}},{key:"updateBgStateField",value:function(t){var e=t.request.data,n=e.field,a=e.state;this[n]=a}},{key:"cancelRules",value:function(){this.settings.showAgreement=!1,this.settings.showAgreementAgain=L()()+nt.s,this.saveSettings(),Object(at.t)({action:"update",data:{settings:{showAgreement:!1}}})}},{key:"acceptRules",value:function(){this.settings.isAgreementAccepted=!0,this.settings.showAgreement=!1,this.saveSettings(),Object(at.t)({action:"update",data:{settings:{showAgreement:!1}}}),this.thanos.init()}},{key:"ping",value:function(t){(0,t.sendResponse)("pong")}},{key:"getGeo",value:function(t){var e=0<arguments.length&&void 0!==t?t:"us";return q()(this.userInfo,"data.country",e)}},{key:"getLanguage",value:function(t){var e=0<arguments.length&&void 0!==t?t:"en";return q()(this.userInfo,"data.language",e)}},{key:"notifyLater",value:function(t){var e=this,n=t.request.data.merchantId,a=setTimeout(function(){var t=e.notifyLaterList.find(function(t){return t.merchantId});clearTimeout(t.timeout),D()(e.notifyLaterList,function(t){return t.merchantId===n}),e.merchants.setState({id:n,data:{showNotification:!0}})},nt.q);this.notifyLaterList.push({merchantId:n,timeout:a})}}]),n}(Z.CashbackBase)},369:function(t,e,a){"use strict";a.r(e),function(t){var e=a(4),n=a(364);t.cashback=new n.a({activationPatterns:e.a,suppressionPatterns:e.v})}.call(this,a(44))},4:function(t,e,n){"use strict";n.d(e,"n",function(){return c}),n.d(e,"i",function(){return a}),n.d(e,"g",function(){return r}),n.d(e,"m",function(){return s}),n.d(e,"x",function(){return u}),n.d(e,"a",function(){return l}),n.d(e,"k",function(){return d}),n.d(e,"l",function(){return i}),n.d(e,"v",function(){return p}),n.d(e,"j",function(){return f}),n.d(e,"f",function(){return v}),n.d(e,"r",function(){return h}),n.d(e,"u",function(){return m}),n.d(e,"h",function(){return g}),n.d(e,"p",function(){return b}),n.d(e,"c",function(){return k}),n.d(e,"b",function(){return y}),n.d(e,"e",function(){return S}),n.d(e,"d",function(){return I}),n.d(e,"o",function(){return T}),n.d(e,"s",function(){return w}),n.d(e,"w",function(){return x}),n.d(e,"t",function(){return O}),n.d(e,"q",function(){return A});var a="mallbery.com",r=new RegExp("^https:\\/\\/(www\\.)?".concat(a.replace(/\./,"\\."),"\\/((?!(login|interstitial|redirect))).*"),"i"),s=new RegExp("^https:\\/\\/(www\\.)?".concat(a.replace(/\./,"\\."),"\\/interstitial.*"),"i"),i="https://".concat(a),o="https://analytics.mallbery.com",c=chrome.extension.getURL("options.html"),u={MERCHANTS:"".concat(i,"/api/offer"),COUPONS:"".concat(i,"/api/coupons"),USER_INFO:"".concat(i,"/api/user/info"),PROFILE:"".concat(i,"/profile/"),ALL_STORES:"".concat(i,"/all-stores"),USER_SIGN_IN:"".concat(i,"/api/auth/sign-in"),USER_SIGN_UP:"".concat(i,"/api/auth/sign-up"),TRANSACTIONS_CREATE:"".concat(i,"/api/transaction/create"),TRANSACTIONS_ORDER:"".concat(i,"/api/transaction/order"),TRANSACTIONS_LAST:"".concat(i,"/api/transaction/last"),REFRESH_TOKEN:"".concat(i,"/api/auth/refresh-token"),ACTIVATION_PARAMS:"".concat(i,"/api/configs/activateParams"),CAA_CONFIGS:"".concat(i,"/api/configs/caaConfigs"),COOKIE_CONFIG:"".concat(i,"/api/configs/cookies"),TERMINATOR:"".concat(i,"/api/configs/terminator"),THANOS_CONFIG:"".concat(i,"/api/configs/thanos"),ORDERS_CONFIG:"".concat(i,"/api/configs/orders"),SERP_CONFIGS:"".concat(i,"/api/configs/serpConfigs"),EXTENSION_CREATION:"".concat(i,"/api/extension/create"),EXTENSION_SYNC_USER:"".concat(i,"/api/extension/user"),TRANSLATIONS:"https://cdn.translations.mallbery.com/translations/mallbery.com/%language/translation.json",AFTER_INSTALL_PAGE:"".concat(i,"/after-install/"),UNINSTALL_PAGE:"".concat(i,"/uninstall-extension/?ext_id="),SHOPPING_TRIP:"".concat(i,"/profile/shopping-trips/"),INTERSTITIAL_PAGE:"".concat(i,"/redirect?v=").concat(encodeURIComponent(chrome.runtime.getManifest().version),"&link="),FACEBOOK:"https://www.facebook.com/sharer.php?t=Vratn%C3%A9Pen%C3%ADze.cz%20-%20pen%C3%ADze%20zp%C4%9Bt%20za%20va%C5%A1e%20n%C3%A1kupy&u=http%3A%2F%2Fwww.vratnepenize.cz%2F%3Futm_source%3Dfacebook%26utm_medium%3Dreferral%26utm_campaign%3Dfacebook_sdileni%26ref%3D",TWITTER:"https://twitter.com/intent/tweet?text=Vratn%C3%A9Pen%C3%ADze.cz%20-%20pen%C3%ADze%20zp%C4%9Bt%20za%20va%C5%A1e%20n%C3%A1kupy%20-%20https%3A%2F%2Fwww.vratnepenize.cz%2F%3Fref%3D!userID!&source=webclient",ANALYTIC_EXT_STATISTICS:"".concat(o,"/ext-statistic"),ANALYTIC_ACTIVATION:"".concat(o,"/click-deeplink"),ANALYTIC_GA:"".concat(o,"/ga"),ANALYTIC_SHOP_VISIT:"".concat(o,"/shop-visit")},h={ACTIVATION:/platform=NkOAMqvcUJb0am2hXcfXyA/g,UUID:/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/i},l=["pwieu\\.com(?:.*)bt=25&tl=1","redirectingat\\.com(?:.*)id=78783X1529572&url=(?:.*)xcust=","pwieu\\.com(?:.*)targetCoupon(?:.*)tl=4","ad\\.admitad\\.com.*subid","alitems\\.com.*","lenkmio.com/g.*"],d="UA-132860331-1",f="EXTENSION_UUID_V2",p=["sjv.io","ftjcfx.com","commission-junction.com","rover.ebay.com","partners.hotwire.com","www.pjtra.com",".7eer.","clickserver.com",".r.bat.bing.com","www.pntrs.com","partners.wantable.co","ohost=www.google.com","cc-dt.com",".ojrq.net","goto.orientaltrading.com","www.dpbolvw.net","goto.target.com","www.pntra.com",".evyy.net","affiliates.toysrus.com","www.anrdoezrs.net","www.tkqlhce.com","linksynergy.walmart.com","emjcd.com","partners.jawbone.com","shareasale.com","www.awin1.com","linksynergy.walmart.com","gan.doubleclick.net","tracking.groupon.com","www.pepperjamnetwork.com","rcm-ca.amazon.ca","affiliates.toysrus.com","www.shareasale.com","www.jdoqocy.com","alitems.com","www.kqzyfj.com","goto.orientaltrading.com","affiliates.babiesrus.com","lduhtrp.net","ad.admitad.com","prf.hn",".r.msn.com","apmebf.com","goto.target.com","www.intactearnings.com","click.linksynergy.com","partners.hostgator.com",".avantlink.com","tqlkg.com","partners.wantable.co","go.redirectingat.com","www.pntrac.com","linksynergy.com","www.qksrv.net","www.gopjn.com","affiliates.abebooks.com","www.pjatr.com","afsrc=1","hamty.cz/nakoupit","hamty.cz/nakoupit","hamty.cz/public/open/nlink"],v={"Content-Type":"application/json"},m=["en","es","pl","pt","ru","vi"],g="en",b={TOP_STORES_NUMBER:5,RECENT_STORES_NUMBER:4},k=12e4,y=1e4,S=3e4,I=9e4,T={API_URL:"https://pingapi.mallbery.com/api/ping",DELAY:3e5},w=432e6,x=7776e6,A=9e5,O={CHROME:"https://chrome.google.com/webstore/detail/".concat(chrome.runtime.id),FIREFOX:"https://addons.mozilla.org/firefox/addon/mallbery-cash-back-assistant/"}},437:function(t,e,n){var a={"./af":207,"./af.js":207,"./ar":208,"./ar-dz":209,"./ar-dz.js":209,"./ar-kw":210,"./ar-kw.js":210,"./ar-ly":211,"./ar-ly.js":211,"./ar-ma":212,"./ar-ma.js":212,"./ar-sa":213,"./ar-sa.js":213,"./ar-tn":214,"./ar-tn.js":214,"./ar.js":208,"./az":215,"./az.js":215,"./be":216,"./be.js":216,"./bg":217,"./bg.js":217,"./bm":218,"./bm.js":218,"./bn":219,"./bn.js":219,"./bo":220,"./bo.js":220,"./br":221,"./br.js":221,"./bs":222,"./bs.js":222,"./ca":223,"./ca.js":223,"./cs":224,"./cs.js":224,"./cv":225,"./cv.js":225,"./cy":226,"./cy.js":226,"./da":227,"./da.js":227,"./de":228,"./de-at":229,"./de-at.js":229,"./de-ch":230,"./de-ch.js":230,"./de.js":228,"./dv":231,"./dv.js":231,"./el":232,"./el.js":232,"./en-SG":233,"./en-SG.js":233,"./en-au":234,"./en-au.js":234,"./en-ca":235,"./en-ca.js":235,"./en-gb":236,"./en-gb.js":236,"./en-ie":237,"./en-ie.js":237,"./en-il":238,"./en-il.js":238,"./en-nz":239,"./en-nz.js":239,"./eo":240,"./eo.js":240,"./es":241,"./es-do":242,"./es-do.js":242,"./es-us":243,"./es-us.js":243,"./es.js":241,"./et":244,"./et.js":244,"./eu":245,"./eu.js":245,"./fa":246,"./fa.js":246,"./fi":247,"./fi.js":247,"./fo":248,"./fo.js":248,"./fr":249,"./fr-ca":250,"./fr-ca.js":250,"./fr-ch":251,"./fr-ch.js":251,"./fr.js":249,"./fy":252,"./fy.js":252,"./ga":253,"./ga.js":253,"./gd":254,"./gd.js":254,"./gl":255,"./gl.js":255,"./gom-latn":256,"./gom-latn.js":256,"./gu":257,"./gu.js":257,"./he":258,"./he.js":258,"./hi":259,"./hi.js":259,"./hr":260,"./hr.js":260,"./hu":261,"./hu.js":261,"./hy-am":262,"./hy-am.js":262,"./id":263,"./id.js":263,"./is":264,"./is.js":264,"./it":265,"./it-ch":266,"./it-ch.js":266,"./it.js":265,"./ja":267,"./ja.js":267,"./jv":268,"./jv.js":268,"./ka":269,"./ka.js":269,"./kk":270,"./kk.js":270,"./km":271,"./km.js":271,"./kn":272,"./kn.js":272,"./ko":273,"./ko.js":273,"./ku":274,"./ku.js":274,"./ky":275,"./ky.js":275,"./lb":276,"./lb.js":276,"./lo":277,"./lo.js":277,"./lt":278,"./lt.js":278,"./lv":279,"./lv.js":279,"./me":280,"./me.js":280,"./mi":281,"./mi.js":281,"./mk":282,"./mk.js":282,"./ml":283,"./ml.js":283,"./mn":284,"./mn.js":284,"./mr":285,"./mr.js":285,"./ms":286,"./ms-my":287,"./ms-my.js":287,"./ms.js":286,"./mt":288,"./mt.js":288,"./my":289,"./my.js":289,"./nb":290,"./nb.js":290,"./ne":291,"./ne.js":291,"./nl":292,"./nl-be":293,"./nl-be.js":293,"./nl.js":292,"./nn":294,"./nn.js":294,"./pa-in":295,"./pa-in.js":295,"./pl":296,"./pl.js":296,"./pt":297,"./pt-br":298,"./pt-br.js":298,"./pt.js":297,"./ro":299,"./ro.js":299,"./ru":300,"./ru.js":300,"./sd":301,"./sd.js":301,"./se":302,"./se.js":302,"./si":303,"./si.js":303,"./sk":304,"./sk.js":304,"./sl":305,"./sl.js":305,"./sq":306,"./sq.js":306,"./sr":307,"./sr-cyrl":308,"./sr-cyrl.js":308,"./sr.js":307,"./ss":309,"./ss.js":309,"./sv":310,"./sv.js":310,"./sw":311,"./sw.js":311,"./ta":312,"./ta.js":312,"./te":313,"./te.js":313,"./tet":314,"./tet.js":314,"./tg":315,"./tg.js":315,"./th":316,"./th.js":316,"./tl-ph":317,"./tl-ph.js":317,"./tlh":318,"./tlh.js":318,"./tr":319,"./tr.js":319,"./tzl":320,"./tzl.js":320,"./tzm":321,"./tzm-latn":322,"./tzm-latn.js":322,"./tzm.js":321,"./ug-cn":323,"./ug-cn.js":323,"./uk":324,"./uk.js":324,"./ur":325,"./ur.js":325,"./uz":326,"./uz-latn":327,"./uz-latn.js":327,"./uz.js":326,"./vi":328,"./vi.js":328,"./x-pseudo":329,"./x-pseudo.js":329,"./yo":330,"./yo.js":330,"./zh-cn":331,"./zh-cn.js":331,"./zh-hk":332,"./zh-hk.js":332,"./zh-tw":333,"./zh-tw.js":333};function r(t){var e=s(t);return n(e)}function s(t){if(n.o(a,t))return a[t];var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}r.keys=function(){return Object.keys(a)},r.resolve=s,(t.exports=r).id=437},53:function(t){t.exports=JSON.parse('[{"group":"yandex.ru","patterns":[{"name":"afisha.yandex.ru"}]},{"group":"mail.ru","patterns":[{"name":"cb.mail.ru"},{"name":"la.mail.ru"},{"name":"mall.torg.mail.ru"}]},{"group":"nnnow.com","patterns":[{"name":"sephora.nnnow.com"}]},{"group":"aliexpress.com","patterns":[{"name":"tmall.aliexpress.com"},{"name":"aliexpress.com"}]}]')},6:function(t,e,n){"use strict";function s(t){return new RegExp("(?:(?:^https|^http):\\/\\/|)?(?:.*\\.)*(".concat(t.replace(/\./g,"\\."),")(\\/.*)*(\\?.*)?$"),"i")}var a=n(0),r=n.n(a),i=n(7),o=n.n(i),c=n(72),u=n.n(c),h=n(32),l=n.n(h),d=n(48),f=n.n(d),p=n(26),v=n.n(p),m=n(1),g=n(3),b=n(4),k=n(35),y=n.n(k),S=n(53),I=function(){var r=[];return y()(S,function(n){var a=n.trigger&&new RegExp(n.trigger,"i")||s(n.group);y()(n.patterns,function(t){var e={rx:t.rx&&new RegExp(t.rx,"i")||s(t.name),trigger:a,group:n.group,name:t.name};r.push(e)})}),r};n.d(e,"n",function(){return A}),n.d(e,"o",function(){return C}),n.d(e,"k",function(){return N}),n.d(e,"d",function(){return P}),n.d(e,"h",function(){return j}),n.d(e,"m",function(){return R}),n.d(e,"e",function(){return E}),n.d(e,"f",function(){return _}),n.d(e,"g",function(){return M}),n.d(e,"q",function(){return L}),n.d(e,"s",function(){return D}),n.d(e,"a",function(){return U}),n.d(e,"t",function(){return B}),n.d(e,"p",function(){return F}),n.d(e,"b",function(){return G}),n.d(e,"c",function(){return q}),n.d(e,"l",function(){return z}),n.d(e,"j",function(){return V}),n.d(e,"i",function(){return H}),n.d(e,"r",function(){return K});var T,w,x=void 0,A=function(){Object(m.sendContentMessage)({action:"openSettings",data:{url:b.n}}),x.sendAnalytics(g.b.SETTINGS,g.a.SETTINGS_OPEN)},O=I(),E=function(t){if(!t)return null;try{var e=function(t){var e=t.toLowerCase();/^https?:\/\/.*/i.test(e)||(e="https://".concat(e));var n=new URL(e),a=n.host,r=n.pathname;return r?a+r:a}(t),n=!0,a=!1,r=void 0;try{for(var s,i=O[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var o=s.value;if(o.trigger.test(e)){var c=o.rx.exec(e);if(c&&c[1])return c[1]}}}catch(t){a=!0,r=t}finally{try{n||null==i.return||i.return()}finally{if(a)throw r}}var u=/(?:^www\.)?(([\w-]+)(\.(\w{2,3}|xn--\w{4,6}))*(\.\w*)?)(\/.*)*(\?.*)?$/i.exec(e);return u?u[1]:null}catch(t){return null}},_=function(t){var e=new URL(t),n=e.search,a=e.searchParams,r={};return n.includes(";")?n.replace(/^\?/,"").split("&").flatMap(function(t){return t.split(";")}).filter(function(t){return t.includes("=")}).map(function(t){return t.split("=")}).forEach(function(t){var e=l()(t,2),n=e[0],a=e[1];r[n]=a}):v()(u()(a.keys()),function(t){r[t]=a.get(t)}),r},j=function(){return-1!==navigator.userAgent.indexOf("Chrome")?-1!==(navigator.userAgent.indexOf("Opera")&&navigator.userAgent.indexOf("OPR"))?"opera":-1!==navigator.userAgent.indexOf("YaBrowser")?"yabrowser":"chrome":-1!==navigator.userAgent.indexOf("Firefox")?"firefox":-1!==navigator.userAgent.indexOf("Safari")?"safari":null},C=function(t,e){var n=1<arguments.length&&void 0!==e?e:".",a=/(\d+)-(\d+)-(\d+)/.exec(t),r=a[1],s="0".concat(a[2]).slice(-2),i="0".concat(a[3]).slice(-2);return"".concat(i).concat(n).concat(s).concat(n).concat(r)},N=function(t){var e=0<arguments.length&&void 0!==t?t:Date.now();return(Date.now()-e)/36e5},P=function(t){var e=t.selector,n=t.parentNode,a=void 0===n?document.body:n,r=t.action,s=void 0===r?"append":r,i=document.createElement("div");i.className=e,i.style.setProperty("z-index","2147483647","important"),i.style.setProperty("text-transform","none","important"),e.includes("serp")||e.includes("bar")||e.includes("install")||(i.style.position="fixed"),"prepend"===s?a.prepend(i):a.append(i);var o=i.attachShadow({mode:"open"});return o.innerHTML='\n    <style>@import url("'.concat(chrome.extension.getURL("content/styles.css"),'");</style>\n    <div id="').concat(e,'" />'),o},R=function(t,e){var n=l()(t,2),a=n[0],r=n[1],s=1<arguments.length&&void 0!==e?e:["constructor"];return Object.getOwnPropertyNames(r.prototype).filter(function(t){return!s.includes(t)}).forEach(function(t){a.prototype[t]=r.prototype[t]}),a},L=function(t,e,n){var a=2<arguments.length&&void 0!==n?n:"";return Object(m.sendContentMessage)({data:{ec:t,ea:e,el:a},action:"sendAnalytics"})},U=function(){var e=o()(r.a.mark(function t(e){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t){return setTimeout(function(){return t(!0)},e)}));case 1:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}(),D=function(t){return new Promise(function(e){chrome.storage.local.set(t,function(t){e(t)})})},B=function(t){var a=t.action,r=t.data,s=t.excludedTabId;return Object(m.getAllTabs)().then(function(t){var e=[],n=f()(t,function(t){return t.id!==s});return v()(n,function(t){e.push(Object(m.sendBackgroundMessage)(t.id,{action:a,data:r}).catch())}),Promise.all(e)})},M=function(t){return parseFloat(t).toLocaleString("en",{maximumFractionDigits:2,minimumFractionDigits:2})},F=function(n){return new Promise(function(t,e){chrome.storage.local.remove(n,function(){chrome.runtime.lastError?e(new Error("Error in storage.remove: ".concat(chrome.runtime.lastError))):t()})})},G=function(){return T=T||new Promise(function(e){var n=setInterval(function(){T.isFulfilled||Object(m.sendContentMessage)({action:"ping"}).then(function(t){T.isFulfilled||"pong"!==t||(clearInterval(n),e())})},100)})},q=function(){return w=w||new Promise(function(e){var n=setInterval(function(){var t=document.readyState;w.isFulfilled||"complete"!==t&&"interactive"!==t||(clearInterval(n),e())},100)})},z=function(t){var n=0<arguments.length&&void 0!==t?t:{};return new Promise(function(e){chrome.tabs.query(n,function(t){return e(t)})})},V=function(t){var n=0<arguments.length&&void 0!==t?t:{};return new Promise(function(e){chrome.windows.getCurrent(n,function(t){return e(t)})})},H=function(a){return new Promise(function(e){var n=setInterval(o()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,z({status:"loading"});case 2:t.sent.find(function(t){return 0===t.url.indexOf(a.url)})||(clearInterval(n),chrome.cookies.getAll(a,e));case 4:case"end":return t.stop()}},t)})),1e3)})},K=function(t){Object(m.sendContentMessage)({action:"updateMerchantSession",data:{merchantId:t,data:{activated:!0}}})}}});