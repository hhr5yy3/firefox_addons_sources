const e=browser;document.body.setAttribute("data-version",e.runtime.getManifest().version);let t=null;e.storage.local.get(["queue"],(async({queue:s})=>{s?(s.tabId=await new Promise((s=>{e.runtime.sendMessage({cmd:"GET_TAB_ID",parameter:{}},(a=>{t=new BroadcastChannel(`channel-${a}`),t.addEventListener("message",(s=>{const{id:a,cmd:o,data:n,response:r}=s.data;if("FIREFOX_FETCH"!==o)if("GET_ALL_STORAGE"!==o)e.runtime.sendMessage({cmd:o,parameter:n},(e=>{r&&t.postMessage({id:a,data:e})}));else{const{storageKey:s}=n;e.runtime.sendMessage({cmd:"GET_STORAGE",parameter:{storageKey:s}},(e=>{r&&t.postMessage({id:a,data:e})}))}else e.runtime.sendMessage({cmd:o,parameter:n},(e=>{if(r){if(!e)return void t.postMessage({id:a,data:{ok:!1,statusText:"Response is null"}});if(!e.ok)return void t.postMessage({id:a,data:e});fetch(e.blobURL).then((e=>{if(e.ok)return e.blob();t.postMessage({id:a,data:{ok:!1,statusText:`Fetch Error-${e.status}`}})})).then((e=>{t.postMessage({id:a,data:{ok:!0,blobURL:URL.createObjectURL(e)}})})).catch((e=>{t.postMessage({id:a,data:{ok:!1,statusText:e.name}})})).finally((()=>{URL.revokeObjectURL(e.blobURL)}))}}))})),window.addEventListener("beforeunload",(function(){t.close()})),s(a)}))})),e.storage.local.remove(["queue"])):s=null;new BroadcastChannel("fetchv-temporary-channel").postMessage(s?JSON.stringify(s):s),s&&e.storage.local.get(["tasks"],(({tasks:t})=>{t||(t=[]),t.push({tabId:s.tabId,url:s.url}),e.storage.local.set({tasks:t})}))}));