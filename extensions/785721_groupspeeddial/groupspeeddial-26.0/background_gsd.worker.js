/*! For license information please see background_gsd.worker.js.LICENSE.txt */
(()=>{var t,e,r={611:function(){var t=(()=>{"use strict";var e=3,r="function"==typeof setImmediate?setImmediate:setTimeout,s=4294967296,a=[4294967295,-s],i=[0,-0x8000000000000000],n=[0,0],o=[1,0];function c(t,r){postMessage({action:e,cbn:r,result:t})}function u(t){var e=[];return e[t-1]=void 0,e}function l(t,e){return p(t[0]+e[0],t[1]+e[1])}function d(t,e){return function(t,e){var r;r=e,e<0&&(r+=s);return[r,t*s]}(~~Math.max(Math.min(t[1]/s,2147483647),-2147483648)&~~Math.max(Math.min(e[1]/s,2147483647),-2147483648),w(t)&w(e))}function h(t,e){var r,s;return t[0]==e[0]&&t[1]==e[1]?0:(r=t[1]<0,s=e[1]<0,r&&!s?-1:!r&&s?1:v(t,e)[1]<0?-1:1)}function p(t,e){var r,a;for(t%=0x10000000000000000,e=(e%=0x10000000000000000)-(r=e%s)+(a=Math.floor(t/s)*s),t=t-a+r;t<0;)t+=s,e-=s;for(;t>4294967295;)t-=s,e+=s;for(e%=0x10000000000000000;e>0x7fffffff00000000;)e-=0x10000000000000000;for(;e<-0x8000000000000000;)e+=0x10000000000000000;return[t,e]}function m(t,e){return t[0]==e[0]&&t[1]==e[1]}function f(t){return t>=0?[t,0]:[t+s,-s]}function w(t){return t[0]>=2147483648?~~Math.max(Math.min(t[0]-s,2147483647),-2147483648):~~Math.max(Math.min(t[0],2147483647),-2147483648)}function g(t){return t<=30?1<<t:g(30)*g(t-30)}function _(t,e){var r,a,o,c;if(e&=63,m(t,i))return e?n:t;if(t[1]<0)throw new Error("Neg");return c=g(e),a=t[1]*c%0x10000000000000000,(a+=r=(o=t[0]*c)-o%s)>=0x8000000000000000&&(a-=0x10000000000000000),[o-=r,a]}function y(t,e){var r;return r=g(e&=63),p(Math.floor(t[0]/r),t[1]/r)}function v(t,e){return p(t[0]-e[0],t[1]-e[1])}function b(t,e){return t.buf=e,t.pos=0,t.count=e.length,t}function D(t){return t.pos>=t.count?-1:255&t.buf[t.pos++]}function I(t,e,r,s){return t.pos>=t.count?-1:(s=Math.min(s,t.count-t.pos),O(t.buf,t.pos,e,r,s),t.pos+=s,s)}function E(t){return t.buf=u(32),t.count=0,t}function A(t){var e=t.buf;return e.length=t.count,e}function S(t,e){t.buf[t.count++]=e<<24>>24}function P(t,e,r,s){O(e,r,t.buf,t.count,s),t.count+=s}function O(t,e,r,s,a){for(var i=0;i<a;++i)r[s+i]=t[e+i]}function T(e,r,s,i,o){var c,l;if(h(i,a)<0)throw new Error("invalid length "+i);for(e.length_0=i,c=function(t){var e;for(t._repDistances=u(4),t._optimum=[],t._rangeEncoder={},t._isMatch=u(192),t._isRep=u(12),t._isRepG0=u(12),t._isRepG1=u(12),t._isRepG2=u(12),t._isRep0Long=u(192),t._posSlotEncoder=[],t._posEncoders=u(114),t._posAlignEncoder=Et({},4),t._lenEncoder=pt({}),t._repMatchLenEncoder=pt({}),t._literalEncoder={},t._matchDistances=[],t._posSlotPrices=[],t._distancesPrices=[],t._alignPrices=u(16),t.reps=u(4),t.repLens=u(4),t.processedInSize=[n],t.processedOutSize=[n],t.finished=[0],t.properties=u(5),t.tempPrices=u(128),t._longestMatchLength=0,t._matchFinderType=1,t._numDistancePairs=0,t._numFastBytesPrev=-1,t.backRes=0,e=0;e<4096;++e)t._optimum[e]={};for(e=0;e<4;++e)t._posSlotEncoder[e]=Et({},6);return t}({}),function(t,e){((t,e)=>{t._dictionarySize=e;for(var r=0;e>1<<r;++r);t._distTableSize=2*r})(e,1<<t.s),e._numFastBytes=t.f,((t,e)=>{var r=t._matchFinderType;t._matchFinderType=e,t._matchFinder&&r!=t._matchFinderType&&(t._dictionarySizePrev=-1,t._matchFinder=null)})(e,t.m),e._numLiteralPosStateBits=0,e._numLiteralContextBits=3,e._posStateBits=2,e._posStateMask=3}(o,c),c._writeEndMark=void 0===t.disableEndMark,function(t,e){t.properties[0]=9*(5*t._posStateBits+t._numLiteralPosStateBits)+t._numLiteralContextBits<<24>>24;for(var r=0;r<4;++r)t.properties[1+r]=t._dictionarySize>>8*r<<24>>24;P(e,t.properties,0,5)}(c,s),l=0;l<64;l+=8)S(s,255&w(y(i,l)));e.chunker=(c._needReleaseMFStream=0,c._inStream=r,c._finished=0,function(t){var e,r;t._matchFinder||(e={},r=4,t._matchFinderType||(r=2),function(t,e){t.HASH_ARRAY=e>2,t.HASH_ARRAY?(t.kNumHashDirectBytes=0,t.kMinMatchCheck=4,t.kFixHashSize=66560):(t.kNumHashDirectBytes=2,t.kMinMatchCheck=3,t.kFixHashSize=0)}(e,r),t._matchFinder=e);if(function(t,e,r){var s,a;if(null!=t.m_Coders&&t.m_NumPrevBits==r&&t.m_NumPosBits==e)return;for(t.m_NumPosBits=e,t.m_PosMask=(1<<e)-1,t.m_NumPrevBits=r,a=1<<t.m_NumPrevBits+t.m_NumPosBits,t.m_Coders=u(a),s=0;s<a;++s)t.m_Coders[s]=yt({})}(t._literalEncoder,t._numLiteralPosStateBits,t._numLiteralContextBits),t._dictionarySize==t._dictionarySizePrev&&t._numFastBytesPrev==t._numFastBytes)return;(function(t,e,r,s,a){var i,n;e<1073741567&&(t._cutValue=16+(s>>1),function(t,e,r,s){var a;t._keepSizeBefore=e,t._keepSizeAfter=r,a=e+r+s,(null==t._bufferBase||t._blockSize!=a)&&(t._bufferBase=null,t._blockSize=a,t._bufferBase=u(t._blockSize));t._pointerToLastSafePosition=t._blockSize-r}(t,e+r,s+a,256+~~((e+r+s+a)/2)),t._matchMaxLen=s,i=e+1,t._cyclicBufferSize!=i&&(t._son=u(2*(t._cyclicBufferSize=i))),n=65536,t.HASH_ARRAY&&(n=e-1,n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,n>>=1,(n|=65535)>16777216&&(n>>=1),t._hashMask=n,++n,n+=t.kFixHashSize),n!=t._hashSizeSum&&(t._hash=u(t._hashSizeSum=n)))})(t._matchFinder,t._dictionarySize,4096,t._numFastBytes,274),t._dictionarySizePrev=t._dictionarySize,t._numFastBytesPrev=t._numFastBytes}(c),c._rangeEncoder.Stream=s,function(t){(function(t){t._state=0,t._previousByte=0;for(var e=0;e<4;++e)t._repDistances[e]=0})(t),function(t){t._position=n,t.Low=n,t.Range=-1,t._cacheSize=1,t._cache=0}(t._rangeEncoder),Bt(t._isMatch),Bt(t._isRep0Long),Bt(t._isRep),Bt(t._isRepG0),Bt(t._isRepG1),Bt(t._isRepG2),Bt(t._posEncoders),function(t){var e,r=1<<t.m_NumPrevBits+t.m_NumPosBits;for(e=0;e<r;++e)Bt(t.m_Coders[e].m_Encoders)}(t._literalEncoder);for(var e=0;e<4;++e)Bt(t._posSlotEncoder[e].Models);lt(t._lenEncoder,1<<t._posStateBits),lt(t._repMatchLenEncoder,1<<t._posStateBits),Bt(t._posAlignEncoder.Models),t._longestMatchWasFound=0,t._optimumEndIndex=0,t._optimumCurrentIndex=0,t._additionalOffset=0}(c),et(c),tt(c),c._lenEncoder._tableSize=c._numFastBytes+1-2,ft(c._lenEncoder,1<<c._posStateBits),c._repMatchLenEncoder._tableSize=c._numFastBytes+1-2,ft(c._repMatchLenEncoder,1<<c._posStateBits),c.nowPos64=n,function(t,e){return t.encoder=e,t.decoder=null,t.alive=1,t}({},c))}function k(t,e,r){return t.output=E({}),T(t,b({},e),t.output,f(e.length),r),t}function R(t,e,r){var s,i,o,c,l="",d=[];for(i=0;i<5;++i){if(-1==(o=D(e)))throw new Error("truncated input");d[i]=o<<24>>24}if(s=function(t){t.m_OutWindow={},t.m_RangeDecoder={},t.m_IsMatchDecoders=u(192),t.m_IsRepDecoders=u(12),t.m_IsRepG0Decoders=u(12),t.m_IsRepG1Decoders=u(12),t.m_IsRepG2Decoders=u(12),t.m_IsRep0LongDecoders=u(192),t.m_PosSlotDecoder=u(4),t.m_PosDecoders=u(114),t.m_PosAlignDecoder=Dt({},4),t.m_LenDecoder=q({}),t.m_RepLenDecoder=q({}),t.m_LiteralDecoder={};for(var e=0;e<4;++e)t.m_PosSlotDecoder[e]=Dt({},6);return t}({}),!function(t,e){var r,s,a,i,n,o,c;if(e.length<5)return 0;for(c=255&e[0],a=c%9,i=(o=~~(c/9))%5,n=~~(o/5),r=0,s=0;s<4;++s)r+=(255&e[1+s])<<8*s;if(r>99999999||!function(t,e,r,s){if(e>8||r>4||s>4)return 0;!function(t,e,r){var s,a;if(null!=t.m_Coders&&t.m_NumPrevBits==r&&t.m_NumPosBits==e)return;for(t.m_NumPosBits=e,t.m_PosMask=(1<<e)-1,t.m_NumPrevBits=r,a=1<<t.m_NumPrevBits+t.m_NumPosBits,t.m_Coders=u(a),s=0;s<a;++s)t.m_Coders[s]=X({})}(t.m_LiteralDecoder,r,e);var a=1<<s;return j(t.m_LenDecoder,a),j(t.m_RepLenDecoder,a),t.m_PosStateMask=a-1,1}(t,a,i,n))return 0;return function(t,e){if(e<0)return 0;t.m_DictionarySize!=e&&(t.m_DictionarySize=e,t.m_DictionarySizeCheck=Math.max(t.m_DictionarySize,1),function(t,e){null!=t._buffer&&t._windowSize==e||(t._buffer=u(e));t._windowSize=e,t._pos=0,t._streamPos=0}(t.m_OutWindow,Math.max(t.m_DictionarySizeCheck,4096)));return 1}(t,r)}(s,d))throw new Error("corrupted input");for(i=0;i<64;i+=8){if(-1==(o=D(e)))throw new Error("truncated input");1==(o=o.toString(16)).length&&(o="0"+o),l=o+""+l}/^0+$|^f+$/i.test(l)?t.length_0=a:(c=parseInt(l,16),t.length_0=c>4294967295?a:f(c)),t.chunker=function(t,e,r,s){return t.m_RangeDecoder.Stream=e,W(t.m_OutWindow),t.m_OutWindow._stream=r,function(t){t.m_OutWindow._streamPos=0,t.m_OutWindow._pos=0,Bt(t.m_IsMatchDecoders),Bt(t.m_IsRep0LongDecoders),Bt(t.m_IsRepDecoders),Bt(t.m_IsRepG0Decoders),Bt(t.m_IsRepG1Decoders),Bt(t.m_IsRepG2Decoders),Bt(t.m_PosDecoders),function(t){var e,r;for(r=1<<t.m_NumPrevBits+t.m_NumPosBits,e=0;e<r;++e)Bt(t.m_Coders[e].m_Decoders)}(t.m_LiteralDecoder);for(var e=0;e<4;++e)Bt(t.m_PosSlotDecoder[e].Models);Z(t.m_LenDecoder),Z(t.m_RepLenDecoder),Bt(t.m_PosAlignDecoder.Models),function(t){t.Code=0,t.Range=-1;for(var e=0;e<5;++e)t.Code=t.Code<<8|D(t.Stream)}(t.m_RangeDecoder)}(t),t.state=0,t.rep0=0,t.rep1=0,t.rep2=0,t.rep3=0,t.outSize=s,t.nowPos64=n,t.prevByte=0,function(t,e){return t.decoder=e,t.encoder=null,t.alive=1,t}({},t)}(s,e,r,t.length_0)}function B(t,e){return t.output=E({}),R(t,b({},e),t.output),t}function L(t,e){return t._bufferBase[t._bufferOffset+t._pos+e]}function C(t,e,r,s){var a,i;for(t._streamEndWasReached&&t._pos+e+s>t._streamPos&&(s=t._streamPos-(t._pos+e)),++r,i=t._bufferOffset+t._pos+e,a=0;a<s&&t._bufferBase[i+a]==t._bufferBase[i+a-r];++a);return a}function M(t){return t._streamPos-t._pos}function x(t){var e,r;if(!t._streamEndWasReached)for(;;){if(!(r=-t._bufferOffset+t._blockSize-t._streamPos))return;if(-1==(e=I(t._stream,t._bufferBase,t._bufferOffset+t._streamPos,r)))return t._posLimit=t._streamPos,t._bufferOffset+t._posLimit>t._pointerToLastSafePosition&&(t._posLimit=t._pointerToLastSafePosition-t._bufferOffset),void(t._streamEndWasReached=1);t._streamPos+=e,t._streamPos>=t._pos+t._keepSizeAfter&&(t._posLimit=t._streamPos-t._keepSizeAfter)}}function N(t,e){t._bufferOffset+=e,t._posLimit-=e,t._pos-=e,t._streamPos-=e}var U=(()=>{var t,e,r,s=[];for(t=0;t<256;++t){for(r=t,e=0;e<8;++e)0!=(1&r)?r=r>>>1^-306674912:r>>>=1;s[t]=r}return s})();function G(t){var e;++t._cyclicBufferPos>=t._cyclicBufferSize&&(t._cyclicBufferPos=0),function(t){++t._pos,t._pos>t._posLimit&&(t._bufferOffset+t._pos>t._pointerToLastSafePosition&&(t=>{var e,r,s;for((s=t._bufferOffset+t._pos-t._keepSizeBefore)>0&&--s,r=t._bufferOffset+t._streamPos-s,e=0;e<r;++e)t._bufferBase[e]=t._bufferBase[s+e];t._bufferOffset-=s})(t),x(t))}(t),1073741823==t._pos&&(e=t._pos-t._cyclicBufferSize,F(t._son,2*t._cyclicBufferSize,e),F(t._hash,t._hashSizeSum,e),N(t,e))}function F(t,e,r){var s,a;for(s=0;s<e;++s)(a=t[s]||0)<=r?a=0:a-=r,t[s]=a}function z(t){var e=t._pos-t._streamPos;e&&(P(t._stream,t._buffer,t._streamPos,e),t._pos>=t._windowSize&&(t._pos=0),t._streamPos=t._pos)}function H(t,e){var r=t._pos-e-1;return r<0&&(r+=t._windowSize),t._buffer[r]}function W(t){z(t),t._stream=null}function $(t){return(t-=2)<4?t:3}function V(t){return t<4?0:t<10?t-3:t-6}function K(t){if(!t.alive)throw new Error("bad state");return t.encoder?function(t){(function(t,e,r,s){var a,i,c,u,d,p,g,_,y,b,D,I,E,A,S;e[0]=n,r[0]=n,s[0]=1,t._inStream&&(t._matchFinder._stream=t._inStream,function(t){t._bufferOffset=0,t._pos=0,t._streamPos=0,t._streamEndWasReached=0,x(t),t._cyclicBufferPos=0,N(t,-1)}(t._matchFinder),t._needReleaseMFStream=1,t._inStream=null);if(t._finished)return;if(t._finished=1,A=t.nowPos64,m(t.nowPos64,n)){if(!M(t._matchFinder))return void rt(t,w(t.nowPos64));ot(t),E=w(t.nowPos64)&t._posStateMask,Ct(t._rangeEncoder,t._isMatch,(t._state<<4)+E,0),t._state=V(t._state),c=L(t._matchFinder,-t._additionalOffset),gt(wt(t._literalEncoder,w(t.nowPos64),t._previousByte),t._rangeEncoder,c),t._previousByte=c,--t._additionalOffset,t.nowPos64=l(t.nowPos64,o)}if(!M(t._matchFinder))return void rt(t,w(t.nowPos64));for(;;){if(g=st(t,w(t.nowPos64)),b=t.backRes,E=w(t.nowPos64)&t._posStateMask,i=(t._state<<4)+E,1==g&&-1==b)Ct(t._rangeEncoder,t._isMatch,i,0),c=L(t._matchFinder,-t._additionalOffset),S=wt(t._literalEncoder,w(t.nowPos64),t._previousByte),t._state<7?gt(S,t._rangeEncoder,c):(y=L(t._matchFinder,-t._repDistances[0]-1-t._additionalOffset),_t(S,t._rangeEncoder,y,c)),t._previousByte=c,t._state=V(t._state);else{if(Ct(t._rangeEncoder,t._isMatch,i,1),b<4){if(Ct(t._rangeEncoder,t._isRep,t._state,1),b?(Ct(t._rangeEncoder,t._isRepG0,t._state,1),1==b?Ct(t._rangeEncoder,t._isRepG1,t._state,0):(Ct(t._rangeEncoder,t._isRepG1,t._state,1),Ct(t._rangeEncoder,t._isRepG2,t._state,b-2))):(Ct(t._rangeEncoder,t._isRepG0,t._state,0),Ct(t._rangeEncoder,t._isRep0Long,i,1==g?0:1)),1==g?t._state=t._state<7?9:11:(ht(t._repMatchLenEncoder,t._rangeEncoder,g-2,E),t._state=t._state<7?8:11),u=t._repDistances[b],0!=b){for(p=b;p>=1;--p)t._repDistances[p]=t._repDistances[p-1];t._repDistances[0]=u}}else{for(Ct(t._rangeEncoder,t._isRep,t._state,0),t._state=t._state<7?7:10,ht(t._lenEncoder,t._rangeEncoder,g-2,E),I=ut(b-=4),_=$(g),At(t._posSlotEncoder[_],t._rangeEncoder,I),I>=4&&(D=b-(a=(2|1&I)<<(d=(I>>1)-1)),I<14?Tt(t._posEncoders,a-I-1,t._rangeEncoder,d,D):(Mt(t._rangeEncoder,D>>4,d-4),Pt(t._posAlignEncoder,t._rangeEncoder,15&D),++t._alignPriceCount)),u=b,p=3;p>=1;--p)t._repDistances[p]=t._repDistances[p-1];t._repDistances[0]=u,++t._matchPriceCount}t._previousByte=L(t._matchFinder,g-1-t._additionalOffset)}if(t._additionalOffset-=g,t.nowPos64=l(t.nowPos64,f(g)),!t._additionalOffset){if(t._matchPriceCount>=128&&et(t),t._alignPriceCount>=16&&tt(t),e[0]=t.nowPos64,r[0]=xt(t._rangeEncoder),!M(t._matchFinder))return void rt(t,w(t.nowPos64));if(h(v(t.nowPos64,A),[4096,0])>=0)return t._finished=0,void(s[0]=0)}}})(t.encoder,t.encoder.processedInSize,t.encoder.processedOutSize,t.encoder.finished),t.inBytesProcessed=t.encoder.processedInSize[0],t.encoder.finished[0]&&(!function(t){ct(t),t._rangeEncoder.Stream=null}(t.encoder),t.alive=0)}(t):function(t){var e=function(t){var e,r,s,a,i,n;if(n=w(t.nowPos64)&t.m_PosStateMask,Rt(t.m_RangeDecoder,t.m_IsMatchDecoders,(t.state<<4)+n)){if(Rt(t.m_RangeDecoder,t.m_IsRepDecoders,t.state))s=0,Rt(t.m_RangeDecoder,t.m_IsRepG0Decoders,t.state)?(Rt(t.m_RangeDecoder,t.m_IsRepG1Decoders,t.state)?(Rt(t.m_RangeDecoder,t.m_IsRepG2Decoders,t.state)?(r=t.rep3,t.rep3=t.rep2):r=t.rep2,t.rep2=t.rep1):r=t.rep1,t.rep1=t.rep0,t.rep0=r):Rt(t.m_RangeDecoder,t.m_IsRep0LongDecoders,(t.state<<4)+n)||(t.state=t.state<7?9:11,s=1),s||(s=Y(t.m_RepLenDecoder,t.m_RangeDecoder,n)+2,t.state=t.state<7?8:11);else if(t.rep3=t.rep2,t.rep2=t.rep1,t.rep1=t.rep0,s=2+Y(t.m_LenDecoder,t.m_RangeDecoder,n),t.state=t.state<7?7:10,(i=It(t.m_PosSlotDecoder[$(s)],t.m_RangeDecoder))>=4){if(a=(i>>1)-1,t.rep0=(2|1&i)<<a,i<14)t.rep0+=function(t,e,r,s){var a,i,n=1,o=0;for(i=0;i<s;++i)a=Rt(r,t,e+n),n<<=1,n+=a,o|=a<<i;return o}(t.m_PosDecoders,t.rep0-i-1,t.m_RangeDecoder,a);else if(t.rep0+=function(t,e){var r,s,a=0;for(r=e;0!=r;--r)t.Range>>>=1,s=t.Code-t.Range>>>31,t.Code-=t.Range&s-1,a=a<<1|1-s,-16777216&t.Range||(t.Code=t.Code<<8|D(t.Stream),t.Range<<=8);return a}(t.m_RangeDecoder,a-4)<<4,t.rep0+=function(t,e){var r,s,a=1,i=0;for(s=0;s<t.NumBitLevels;++s)r=Rt(e,t.Models,a),a<<=1,a+=r,i|=r<<s;return i}(t.m_PosAlignDecoder,t.m_RangeDecoder),t.rep0<0)return-1==t.rep0?1:-1}else t.rep0=i;if(h(f(t.rep0),t.nowPos64)>=0||t.rep0>=t.m_DictionarySizeCheck)return-1;!function(t,e,r){var s=t._pos-e-1;for(s<0&&(s+=t._windowSize);0!=r;--r)s>=t._windowSize&&(s=0),t._buffer[t._pos++]=t._buffer[s++],t._pos>=t._windowSize&&z(t)}(t.m_OutWindow,t.rep0,s),t.nowPos64=l(t.nowPos64,f(s)),t.prevByte=H(t.m_OutWindow,0)}else e=function(t,e,r){return t.m_Coders[((e&t.m_PosMask)<<t.m_NumPrevBits)+((255&r)>>>8-t.m_NumPrevBits)]}(t.m_LiteralDecoder,w(t.nowPos64),t.prevByte),t.state<7?t.prevByte=function(t,e){var r=1;do{r=r<<1|Rt(e,t.m_Decoders,r)}while(r<256);return r<<24>>24}(e,t.m_RangeDecoder):t.prevByte=function(t,e,r){var s,a,i=1;do{if(a=r>>7&1,r<<=1,i=i<<1|(s=Rt(e,t.m_Decoders,(1+a<<8)+i)),a!=s){for(;i<256;)i=i<<1|Rt(e,t.m_Decoders,i);break}}while(i<256);return i<<24>>24}(e,t.m_RangeDecoder,H(t.m_OutWindow,t.rep0)),function(t,e){t._buffer[t._pos++]=e,t._pos>=t._windowSize&&z(t)}(t.m_OutWindow,t.prevByte),t.state=V(t.state),t.nowPos64=l(t.nowPos64,o);return 0}(t.decoder);if(-1==e)throw new Error("corrupted input");t.inBytesProcessed=a,t.outBytesProcessed=t.decoder.nowPos64,(e||h(t.decoder.outSize,n)>=0&&h(t.decoder.nowPos64,t.decoder.outSize)>=0)&&(z(t.decoder.m_OutWindow),W(t.decoder.m_OutWindow),t.decoder.m_RangeDecoder.Stream=null,t.alive=0)}(t),t.alive}function j(t,e){for(;t.m_NumPosStates<e;++t.m_NumPosStates)t.m_LowCoder[t.m_NumPosStates]=Dt({},3),t.m_MidCoder[t.m_NumPosStates]=Dt({},3)}function Y(t,e,r){if(!Rt(e,t.m_Choice,0))return It(t.m_LowCoder[r],e);var s=8;return Rt(e,t.m_Choice,1)?s+=8+It(t.m_HighCoder,e):s+=It(t.m_MidCoder[r],e),s}function q(t){return t.m_Choice=u(2),t.m_LowCoder=u(16),t.m_MidCoder=u(16),t.m_HighCoder=Dt({},8),t.m_NumPosStates=0,t}function Z(t){Bt(t.m_Choice);for(var e=0;e<t.m_NumPosStates;++e)Bt(t.m_LowCoder[e].Models),Bt(t.m_MidCoder[e].Models);Bt(t.m_HighCoder.Models)}function X(t){return t.m_Decoders=u(768),t}var J=(()=>{var t,e,r,s=2,a=[0,1];for(r=2;r<22;++r)for(e=1<<(r>>1)-1,t=0;t<e;++t,++s)a[s]=r<<24>>24;return a})();function Q(t,e){var r,s,a,i;t._optimumEndIndex=e,a=t._optimum[e].PosPrev,s=t._optimum[e].BackPrev;do{t._optimum[e].Prev1IsChar&&(bt(t._optimum[a]),t._optimum[a].PosPrev=a-1,t._optimum[e].Prev2&&(t._optimum[a-1].Prev1IsChar=0,t._optimum[a-1].PosPrev=t._optimum[e].PosPrev2,t._optimum[a-1].BackPrev=t._optimum[e].BackPrev2)),i=a,r=s,s=t._optimum[i].BackPrev,a=t._optimum[i].PosPrev,t._optimum[i].BackPrev=r,t._optimum[i].PosPrev=e,e=i}while(e>0);return t.backRes=t._optimum[0].BackPrev,t._optimumCurrentIndex=t._optimum[0].PosPrev,t._optimumCurrentIndex}function tt(t){for(var e=0;e<16;++e)t._alignPrices[e]=Ot(t._posAlignEncoder,e);t._alignPriceCount=0}function et(t){var e,r,s,a,i,n,o,c;for(a=4;a<128;++a)e=(2|1&(n=ut(a)))<<(s=(n>>1)-1),t.tempPrices[a]=kt(t._posEncoders,e-n-1,s,a-e);for(i=0;i<4;++i){for(r=t._posSlotEncoder[i],o=i<<6,n=0;n<t._distTableSize;++n)t._posSlotPrices[o+n]=St(r,n);for(n=14;n<t._distTableSize;++n)t._posSlotPrices[o+n]+=(n>>1)-1-4<<6;for(c=128*i,a=0;a<4;++a)t._distancesPrices[c+a]=t._posSlotPrices[o+a];for(;a<128;++a)t._distancesPrices[c+a]=t._posSlotPrices[o+ut(a)]+t.tempPrices[a]}t._matchPriceCount=0}function rt(t,e){ct(t),function(t,e){if(!t._writeEndMark)return;Ct(t._rangeEncoder,t._isMatch,(t._state<<4)+e,1),Ct(t._rangeEncoder,t._isRep,t._state,0),t._state=t._state<7?7:10,ht(t._lenEncoder,t._rangeEncoder,0,e);var r=$(2);At(t._posSlotEncoder[r],t._rangeEncoder,63),Mt(t._rangeEncoder,67108863,26),Pt(t._posAlignEncoder,t._rangeEncoder,15)}(t,e&t._posStateMask);for(var r=0;r<5;++r)Nt(t._rangeEncoder)}function st(t,e){var r,s,a,i,n,o,c,u,l,d,h,p,m,f,w,g,_,y,v,b,D,I,E,A,S,P,O,T,k,R,B,x,N,U,G,F,z,H,W,$,K,j,Y,q;if(t._optimumEndIndex!=t._optimumCurrentIndex)return m=t._optimum[t._optimumCurrentIndex].PosPrev-t._optimumCurrentIndex,t.backRes=t._optimum[t._optimumCurrentIndex].BackPrev,t._optimumCurrentIndex=t._optimum[t._optimumCurrentIndex].PosPrev,m;if(t._optimumCurrentIndex=t._optimumEndIndex=0,t._longestMatchWasFound?(p=t._longestMatchLength,t._longestMatchWasFound=0):p=ot(t),P=t._numDistancePairs,(A=M(t._matchFinder)+1)<2)return t.backRes=-1,1;for(A>273&&(A=273),W=0,l=0;l<4;++l)t.reps[l]=t._repDistances[l],t.repLens[l]=C(t._matchFinder,-1,t.reps[l],273),t.repLens[l]>t.repLens[W]&&(W=l);if(t.repLens[W]>=t._numFastBytes)return t.backRes=W,nt(t,(m=t.repLens[W])-1),m;if(p>=t._numFastBytes)return t.backRes=t._matchDistances[P-1]+4,nt(t,p-1),p;if(c=L(t._matchFinder,-1),_=L(t._matchFinder,-t._repDistances[0]-1-1),p<2&&c!=_&&t.repLens[W]<2)return t.backRes=-1,1;if(t._optimum[0].State=t._state,N=e&t._posStateMask,t._optimum[1].Price=Lt[t._isMatch[(t._state<<4)+N]>>>2]+vt(wt(t._literalEncoder,e,t._previousByte),t._state>=7,_,c),bt(t._optimum[1]),H=(y=Lt[2048-t._isMatch[(t._state<<4)+N]>>>2])+Lt[2048-t._isRep[t._state]>>>2],_==c&&($=H+function(t,e,r){return Lt[t._isRepG0[e]>>>2]+Lt[t._isRep0Long[(e<<4)+r]>>>2]}(t,t._state,N),$<t._optimum[1].Price&&(t._optimum[1].Price=$,function(t){t.BackPrev=0,t.Prev1IsChar=0}(t._optimum[1]))),(h=p>=t.repLens[W]?p:t.repLens[W])<2)return t.backRes=t._optimum[1].BackPrev,1;t._optimum[1].PosPrev=0,t._optimum[0].Backs0=t.reps[0],t._optimum[0].Backs1=t.reps[1],t._optimum[0].Backs2=t.reps[2],t._optimum[0].Backs3=t.reps[3],d=h;do{t._optimum[d--].Price=268435455}while(d>=2);for(l=0;l<4;++l)if(!((z=t.repLens[l])<2)){G=H+it(t,l,t._state,N);do{(i=G+mt(t._repMatchLenEncoder,z-2,N))<(R=t._optimum[z]).Price&&(R.Price=i,R.PosPrev=0,R.BackPrev=l,R.Prev1IsChar=0)}while(--z>=2)}if(E=y+Lt[t._isRep[t._state]>>>2],(d=t.repLens[0]>=2?t.repLens[0]+1:2)<=p){for(O=0;d>t._matchDistances[O];)O+=2;for(;(i=E+at(t,u=t._matchDistances[O+1],d,N))<(R=t._optimum[d]).Price&&(R.Price=i,R.PosPrev=0,R.BackPrev=u+4,R.Prev1IsChar=0),d!=t._matchDistances[O]||(O+=2)!=P;++d);}for(r=0;;){if(++r==h)return Q(t,r);if(v=ot(t),P=t._numDistancePairs,v>=t._numFastBytes)return t._longestMatchLength=v,t._longestMatchWasFound=1,Q(t,r);if(++e,x=t._optimum[r].PosPrev,t._optimum[r].Prev1IsChar?(--x,t._optimum[r].Prev2?(j=t._optimum[t._optimum[r].PosPrev2].State,j=t._optimum[r].BackPrev2<4?j<7?8:11:j<7?7:10):j=t._optimum[x].State,j=V(j)):j=t._optimum[x].State,x==r-1?j=t._optimum[r].BackPrev?V(j):j<7?9:11:(t._optimum[r].Prev1IsChar&&t._optimum[r].Prev2?(x=t._optimum[r].PosPrev2,B=t._optimum[r].BackPrev2,j=j<7?8:11):j=(B=t._optimum[r].BackPrev)<4?j<7?8:11:j<7?7:10,k=t._optimum[x],B<4?B?1==B?(t.reps[0]=k.Backs1,t.reps[1]=k.Backs0,t.reps[2]=k.Backs2,t.reps[3]=k.Backs3):2==B?(t.reps[0]=k.Backs2,t.reps[1]=k.Backs0,t.reps[2]=k.Backs1,t.reps[3]=k.Backs3):(t.reps[0]=k.Backs3,t.reps[1]=k.Backs0,t.reps[2]=k.Backs1,t.reps[3]=k.Backs2):(t.reps[0]=k.Backs0,t.reps[1]=k.Backs1,t.reps[2]=k.Backs2,t.reps[3]=k.Backs3):(t.reps[0]=B-4,t.reps[1]=k.Backs0,t.reps[2]=k.Backs1,t.reps[3]=k.Backs2)),t._optimum[r].State=j,t._optimum[r].Backs0=t.reps[0],t._optimum[r].Backs1=t.reps[1],t._optimum[r].Backs2=t.reps[2],t._optimum[r].Backs3=t.reps[3],o=t._optimum[r].Price,c=L(t._matchFinder,-1),_=L(t._matchFinder,-t.reps[0]-1-1),N=e&t._posStateMask,b=0,(s=o+Lt[t._isMatch[(j<<4)+N]>>>2]+vt(wt(t._literalEncoder,e,L(t._matchFinder,-2)),j>=7,_,c))<(D=t._optimum[r+1]).Price&&(D.Price=s,D.PosPrev=r,D.BackPrev=-1,D.Prev1IsChar=0,b=1),H=(y=o+Lt[2048-t._isMatch[(j<<4)+N]>>>2])+Lt[2048-t._isRep[j]>>>2],_!=c||D.PosPrev<r&&!D.BackPrev||($=H+(Lt[t._isRepG0[j]>>>2]+Lt[t._isRep0Long[(j<<4)+N]>>>2]))<=D.Price&&(D.Price=$,D.PosPrev=r,D.BackPrev=0,D.Prev1IsChar=0,b=1),!((A=S=4095-r<(S=M(t._matchFinder)+1)?4095-r:S)<2)){if(A>t._numFastBytes&&(A=t._numFastBytes),!b&&_!=c&&(q=Math.min(S-1,t._numFastBytes),(w=C(t._matchFinder,0,t.reps[0],q))>=2)){for(Y=V(j),U=e+1&t._posStateMask,I=s+Lt[2048-t._isMatch[(Y<<4)+U]>>>2]+Lt[2048-t._isRep[Y]>>>2],T=r+1+w;h<T;)t._optimum[++h].Price=268435455;(i=I+(mt(t._repMatchLenEncoder,w-2,U)+it(t,0,Y,U)))<(R=t._optimum[T]).Price&&(R.Price=i,R.PosPrev=r+1,R.BackPrev=0,R.Prev1IsChar=1,R.Prev2=0)}for(K=2,F=0;F<4;++F)if(!((f=C(t._matchFinder,-1,t.reps[F],A))<2)){g=f;do{for(;h<r+f;)t._optimum[++h].Price=268435455;(i=H+(mt(t._repMatchLenEncoder,f-2,N)+it(t,F,j,N)))<(R=t._optimum[r+f]).Price&&(R.Price=i,R.PosPrev=r,R.BackPrev=F,R.Prev1IsChar=0)}while(--f>=2);if(f=g,F||(K=f+1),f<S&&(q=Math.min(S-1-f,t._numFastBytes),(w=C(t._matchFinder,f,t.reps[F],q))>=2)){for(Y=j<7?8:11,U=e+f&t._posStateMask,a=H+(mt(t._repMatchLenEncoder,f-2,N)+it(t,F,j,N))+Lt[t._isMatch[(Y<<4)+U]>>>2]+vt(wt(t._literalEncoder,e+f,L(t._matchFinder,f-1-1)),1,L(t._matchFinder,f-1-(t.reps[F]+1)),L(t._matchFinder,f-1)),Y=V(Y),U=e+f+1&t._posStateMask,I=a+Lt[2048-t._isMatch[(Y<<4)+U]>>>2]+Lt[2048-t._isRep[Y]>>>2],T=f+1+w;h<r+T;)t._optimum[++h].Price=268435455;(i=I+(mt(t._repMatchLenEncoder,w-2,U)+it(t,0,Y,U)))<(R=t._optimum[r+T]).Price&&(R.Price=i,R.PosPrev=r+f+1,R.BackPrev=0,R.Prev1IsChar=1,R.Prev2=1,R.PosPrev2=r,R.BackPrev2=F)}}if(v>A){for(v=A,P=0;v>t._matchDistances[P];P+=2);t._matchDistances[P]=v,P+=2}if(v>=K){for(E=y+Lt[t._isRep[j]>>>2];h<r+v;)t._optimum[++h].Price=268435455;for(O=0;K>t._matchDistances[O];)O+=2;for(f=K;;++f)if((i=E+at(t,n=t._matchDistances[O+1],f,N))<(R=t._optimum[r+f]).Price&&(R.Price=i,R.PosPrev=r,R.BackPrev=n+4,R.Prev1IsChar=0),f==t._matchDistances[O]){if(f<S&&(q=Math.min(S-1-f,t._numFastBytes),(w=C(t._matchFinder,f,n,q))>=2)){for(Y=j<7?7:10,U=e+f&t._posStateMask,a=i+Lt[t._isMatch[(Y<<4)+U]>>>2]+vt(wt(t._literalEncoder,e+f,L(t._matchFinder,f-1-1)),1,L(t._matchFinder,f-(n+1)-1),L(t._matchFinder,f-1)),Y=V(Y),U=e+f+1&t._posStateMask,I=a+Lt[2048-t._isMatch[(Y<<4)+U]>>>2]+Lt[2048-t._isRep[Y]>>>2],T=f+1+w;h<r+T;)t._optimum[++h].Price=268435455;(i=I+(mt(t._repMatchLenEncoder,w-2,U)+it(t,0,Y,U)))<(R=t._optimum[r+T]).Price&&(R.Price=i,R.PosPrev=r+f+1,R.BackPrev=0,R.Prev1IsChar=1,R.Prev2=1,R.PosPrev2=r,R.BackPrev2=n+4)}if((O+=2)==P)break}}}}}function at(t,e,r,s){var a=$(r);return(e<128?t._distancesPrices[128*a+e]:t._posSlotPrices[(a<<6)+function(t){if(t<131072)return J[t>>6]+12;if(t<134217728)return J[t>>16]+32;return J[t>>26]+52}(e)]+t._alignPrices[15&e])+mt(t._lenEncoder,r-2,s)}function it(t,e,r,s){var a;return e?(a=Lt[2048-t._isRepG0[r]>>>2],1==e?a+=Lt[t._isRepG1[r]>>>2]:(a+=Lt[2048-t._isRepG1[r]>>>2],a+=Ut(t._isRepG2[r],e-2))):(a=Lt[t._isRepG0[r]>>>2],a+=Lt[2048-t._isRep0Long[(r<<4)+s]>>>2]),a}function nt(t,e){e>0&&(!function(t,e){var r,s,a,i,n,o,c,u,l,d,h,p,m,f,w,g,_;do{if(t._pos+t._matchMaxLen<=t._streamPos)p=t._matchMaxLen;else if((p=t._streamPos-t._pos)<t.kMinMatchCheck){G(t);continue}for(m=t._pos>t._cyclicBufferSize?t._pos-t._cyclicBufferSize:0,s=t._bufferOffset+t._pos,t.HASH_ARRAY?(o=1023&(_=U[255&t._bufferBase[s]]^255&t._bufferBase[s+1]),t._hash[o]=t._pos,c=65535&(_^=(255&t._bufferBase[s+2])<<8),t._hash[1024+c]=t._pos,u=(_^U[255&t._bufferBase[s+3]]<<5)&t._hashMask):u=255&t._bufferBase[s]^(255&t._bufferBase[s+1])<<8,a=t._hash[t.kFixHashSize+u],t._hash[t.kFixHashSize+u]=t._pos,w=1+(t._cyclicBufferPos<<1),g=t._cyclicBufferPos<<1,d=h=t.kNumHashDirectBytes,r=t._cutValue;;){if(a<=m||0==r--){t._son[w]=t._son[g]=0;break}if(i=((n=t._pos-a)<=t._cyclicBufferPos?t._cyclicBufferPos-n:t._cyclicBufferPos-n+t._cyclicBufferSize)<<1,f=t._bufferOffset+a,l=d<h?d:h,t._bufferBase[f+l]==t._bufferBase[s+l]){for(;++l!=p&&t._bufferBase[f+l]==t._bufferBase[s+l];);if(l==p){t._son[g]=t._son[i],t._son[w]=t._son[i+1];break}}(255&t._bufferBase[f+l])<(255&t._bufferBase[s+l])?(t._son[g]=a,g=i+1,a=t._son[g],h=l):(t._son[w]=a,w=i,a=t._son[w],d=l)}G(t)}while(0!=--e)}(t._matchFinder,e),t._additionalOffset+=e)}function ot(t){var e=0;return t._numDistancePairs=function(t,e){var r,s,a,i,n,o,c,u,l,d,h,p,m,f,w,g,_,y,v,b,D;if(t._pos+t._matchMaxLen<=t._streamPos)f=t._matchMaxLen;else if((f=t._streamPos-t._pos)<t.kMinMatchCheck)return G(t),0;for(_=0,w=t._pos>t._cyclicBufferSize?t._pos-t._cyclicBufferSize:0,s=t._bufferOffset+t._pos,g=1,u=0,l=0,t.HASH_ARRAY?(u=1023&(D=U[255&t._bufferBase[s]]^255&t._bufferBase[s+1]),l=65535&(D^=(255&t._bufferBase[s+2])<<8),d=(D^U[255&t._bufferBase[s+3]]<<5)&t._hashMask):d=255&t._bufferBase[s]^(255&t._bufferBase[s+1])<<8,a=t._hash[t.kFixHashSize+d]||0,t.HASH_ARRAY&&(i=t._hash[u]||0,n=t._hash[1024+l]||0,t._hash[u]=t._pos,t._hash[1024+l]=t._pos,i>w&&t._bufferBase[t._bufferOffset+i]==t._bufferBase[s]&&(e[_++]=g=2,e[_++]=t._pos-i-1),n>w&&t._bufferBase[t._bufferOffset+n]==t._bufferBase[s]&&(n==i&&(_-=2),e[_++]=g=3,e[_++]=t._pos-n-1,i=n),0!=_&&i==a&&(_-=2,g=1)),t._hash[t.kFixHashSize+d]=t._pos,v=1+(t._cyclicBufferPos<<1),b=t._cyclicBufferPos<<1,p=m=t.kNumHashDirectBytes,0!=t.kNumHashDirectBytes&&a>w&&t._bufferBase[t._bufferOffset+a+t.kNumHashDirectBytes]!=t._bufferBase[s+t.kNumHashDirectBytes]&&(e[_++]=g=t.kNumHashDirectBytes,e[_++]=t._pos-a-1),r=t._cutValue;;){if(a<=w||0==r--){t._son[v]=t._son[b]=0;break}if(o=((c=t._pos-a)<=t._cyclicBufferPos?t._cyclicBufferPos-c:t._cyclicBufferPos-c+t._cyclicBufferSize)<<1,y=t._bufferOffset+a,h=p<m?p:m,t._bufferBase[y+h]==t._bufferBase[s+h]){for(;++h!=f&&t._bufferBase[y+h]==t._bufferBase[s+h];);if(g<h&&(e[_++]=g=h,e[_++]=c-1,h==f)){t._son[b]=t._son[o],t._son[v]=t._son[o+1];break}}(255&t._bufferBase[y+h])<(255&t._bufferBase[s+h])?(t._son[b]=a,b=o+1,a=t._son[b],m=h):(t._son[v]=a,v=o,a=t._son[v],p=h)}return G(t),_}(t._matchFinder,t._matchDistances),t._numDistancePairs>0&&(e=t._matchDistances[t._numDistancePairs-2])==t._numFastBytes&&(e+=C(t._matchFinder,e-1,t._matchDistances[t._numDistancePairs-1],273-e)),++t._additionalOffset,e}function ct(t){t._matchFinder&&t._needReleaseMFStream&&(t._matchFinder._stream=null,t._needReleaseMFStream=0)}function ut(t){return t<2048?J[t]:t<2097152?J[t>>10]+20:J[t>>20]+40}function lt(t,e){Bt(t._choice);for(var r=0;r<e;++r)Bt(t._lowCoder[r].Models),Bt(t._midCoder[r].Models);Bt(t._highCoder.Models)}function dt(t,e,r,s,a){var i,n,o,c,u;for(i=Lt[t._choice[0]>>>2],o=(n=Lt[2048-t._choice[0]>>>2])+Lt[t._choice[1]>>>2],c=n+Lt[2048-t._choice[1]>>>2],u=0,u=0;u<8;++u){if(u>=r)return;s[a+u]=i+St(t._lowCoder[e],u)}for(;u<16;++u){if(u>=r)return;s[a+u]=o+St(t._midCoder[e],u-8)}for(;u<r;++u)s[a+u]=c+St(t._highCoder,u-8-8)}function ht(t,e,r,s){!function(t,e,r,s){r<8?(Ct(e,t._choice,0,0),At(t._lowCoder[s],e,r)):(r-=8,Ct(e,t._choice,0,1),r<8?(Ct(e,t._choice,1,0),At(t._midCoder[s],e,r)):(Ct(e,t._choice,1,1),At(t._highCoder,e,r-8)))}(t,e,r,s),0==--t._counters[s]&&(dt(t,s,t._tableSize,t._prices,272*s),t._counters[s]=t._tableSize)}function pt(t){return function(t){t._choice=u(2),t._lowCoder=u(16),t._midCoder=u(16),t._highCoder=Et({},8);for(var e=0;e<16;++e)t._lowCoder[e]=Et({},3),t._midCoder[e]=Et({},3)}(t),t._prices=[],t._counters=[],t}function mt(t,e,r){return t._prices[272*r+e]}function ft(t,e){for(var r=0;r<e;++r)dt(t,r,t._tableSize,t._prices,272*r),t._counters[r]=t._tableSize}function wt(t,e,r){return t.m_Coders[((e&t.m_PosMask)<<t.m_NumPrevBits)+((255&r)>>>8-t.m_NumPrevBits)]}function gt(t,e,r){var s,a,i=1;for(a=7;a>=0;--a)s=r>>a&1,Ct(e,t.m_Encoders,i,s),i=i<<1|s}function _t(t,e,r,s){var a,i,n,o,c=1,u=1;for(i=7;i>=0;--i)a=s>>i&1,o=u,c&&(o+=1+(n=r>>i&1)<<8,c=n==a),Ct(e,t.m_Encoders,o,a),u=u<<1|a}function yt(t){return t.m_Encoders=u(768),t}function vt(t,e,r,s){var a,i,n=1,o=7,c=0;if(e)for(;o>=0;--o)if(i=r>>o&1,a=s>>o&1,c+=Ut(t.m_Encoders[(1+i<<8)+n],a),n=n<<1|a,i!=a){--o;break}for(;o>=0;--o)a=s>>o&1,c+=Ut(t.m_Encoders[n],a),n=n<<1|a;return c}function bt(t){t.BackPrev=-1,t.Prev1IsChar=0}function Dt(t,e){return t.NumBitLevels=e,t.Models=u(1<<e),t}function It(t,e){var r,s=1;for(r=t.NumBitLevels;0!=r;--r)s=(s<<1)+Rt(e,t.Models,s);return s-(1<<t.NumBitLevels)}function Et(t,e){return t.NumBitLevels=e,t.Models=u(1<<e),t}function At(t,e,r){var s,a,i=1;for(a=t.NumBitLevels;0!=a;)s=r>>>--a&1,Ct(e,t.Models,i,s),i=i<<1|s}function St(t,e){var r,s,a=1,i=0;for(s=t.NumBitLevels;0!=s;)r=e>>>--s&1,i+=Ut(t.Models[a],r),a=(a<<1)+r;return i}function Pt(t,e,r){var s,a,i=1;for(a=0;a<t.NumBitLevels;++a)s=1&r,Ct(e,t.Models,i,s),i=i<<1|s,r>>=1}function Ot(t,e){var r,s,a=1,i=0;for(s=t.NumBitLevels;0!=s;--s)r=1&e,e>>>=1,i+=Ut(t.Models[a],r),a=a<<1|r;return i}function Tt(t,e,r,s,a){var i,n,o=1;for(n=0;n<s;++n)Ct(r,t,e+o,i=1&a),o=o<<1|i,a>>=1}function kt(t,e,r,s){var a,i,n=1,o=0;for(i=r;0!=i;--i)a=1&s,s>>>=1,o+=Lt[(2047&(t[e+n]-a^-a))>>>2],n=n<<1|a;return o}function Rt(t,e,r){var s,a=e[r];return s=(t.Range>>>11)*a,(-2147483648^t.Code)<(-2147483648^s)?(t.Range=s,e[r]=a+(2048-a>>>5)<<16>>16,-16777216&t.Range||(t.Code=t.Code<<8|D(t.Stream),t.Range<<=8),0):(t.Range-=s,t.Code-=s,e[r]=a-(a>>>5)<<16>>16,-16777216&t.Range||(t.Code=t.Code<<8|D(t.Stream),t.Range<<=8),1)}function Bt(t){for(var e=t.length-1;e>=0;--e)t[e]=1024}var Lt=(()=>{var t,e,r,s=[];for(e=8;e>=0;--e)for(t=1<<9-e,r=1<<9-e-1;r<t;++r)s[r]=(e<<6)+(t-r<<6>>>9-e-1);return s})();function Ct(t,e,r,s){var a,i=e[r];a=(t.Range>>>11)*i,s?(t.Low=l(t.Low,d(f(a),[4294967295,0])),t.Range-=a,e[r]=i-(i>>>5)<<16>>16):(t.Range=a,e[r]=i+(2048-i>>>5)<<16>>16),-16777216&t.Range||(t.Range<<=8,Nt(t))}function Mt(t,e,r){for(var s=r-1;s>=0;--s)t.Range>>>=1,1==(e>>>s&1)&&(t.Low=l(t.Low,f(t.Range))),-16777216&t.Range||(t.Range<<=8,Nt(t))}function xt(t){return l(l(f(t._cacheSize),t._position),[4,0])}function Nt(t){var e,r,s,a,i=w((r=t.Low,s=32,a=y(r,s&=63),r[1]<0&&(a=l(a,_([2,0],63-s))),a));if(0!=i||h(t.Low,[4278190080,0])<0){t._position=l(t._position,f(t._cacheSize)),e=t._cache;do{S(t.Stream,e+i),e=255}while(0!=--t._cacheSize);t._cache=w(t.Low)>>>24}++t._cacheSize,t.Low=_(d(t.Low,[16777215,0]),8)}function Ut(t,e){return Lt[(2047&(t-e^-e))>>>2]}function Gt(t){for(var e,r,s,a=0,i=0,n=t.length,o=[],c=[];a<n;++a,++i){if(128&(e=255&t[a]))if(192==(224&e)){if(a+1>=n)return t;if(128!=(192&(r=255&t[++a])))return t;c[i]=(31&e)<<6|63&r}else{if(224!=(240&e))return t;if(a+2>=n)return t;if(128!=(192&(r=255&t[++a])))return t;if(128!=(192&(s=255&t[++a])))return t;c[i]=(15&e)<<12|(63&r)<<6|63&s}else{if(!e)return t;c[i]=e}16383==i&&(o.push(String.fromCharCode.apply(String,c)),i=-1)}return i>0&&(c.length=i,o.push(String.fromCharCode.apply(String,c))),o.join("")}function Ft(t){var e,r,s,a=[],i=0,n=t.length;if("object"==typeof t)return t;for(function(t,e,r,s,a){var i;for(i=e;i<r;++i)s[a++]=t.charCodeAt(i)}(t,0,n,a,0),s=0;s<n;++s)(e=a[s])>=1&&e<=127?++i:i+=!e||e>=128&&e<=2047?2:3;for(r=[],i=0,s=0;s<n;++s)(e=a[s])>=1&&e<=127?r[i++]=e<<24>>24:!e||e>=128&&e<=2047?(r[i++]=(192|e>>6&31)<<24>>24,r[i++]=(128|63&e)<<24>>24):(r[i++]=(224|e>>12&15)<<24>>24,r[i++]=(128|e>>6&63)<<24>>24,r[i++]=(128|63&e)<<24>>24);return r}function zt(t){return t[1]+t[0]}var Ht,Wt=(Ht=[{s:16,f:64,m:0},{s:20,f:64,m:0},{s:19,f:64,m:1},{s:20,f:64,m:1},{s:21,f:128,m:1},{s:22,f:128,m:1},{s:23,f:128,m:1},{s:24,f:255,m:1},{s:25,f:255,m:1}],t=>Ht[t-1]||Ht[6]);return"undefined"==typeof onmessage||"undefined"!=typeof window&&void 0!==window.document||(onmessage=e=>{e&&e.data&&(2==e.data.action?t.decompress(e.data.data,e.data.cbn):1==e.data.action&&t.compress(e.data.data,e.data.mode,e.data.cbn))}),{compress:function(t,e,s,a){var i,n,o={},u=void 0===s&&void 0===a;if("function"!=typeof s&&(n=s,s=a=0),a=a||(t=>{if(void 0!==n)return c(t,n)}),s=s||((t,e)=>{if(void 0!==n)return postMessage({action:1,cbn:n,result:t,error:e})}),u){for(o.c=k({},Ft(t),Wt(e));K(o.c.chunker););return A(o.c.output)}try{o.c=k({},Ft(t),Wt(e)),a(0)}catch(t){return s(null,t)}r((function t(){try{for(var e,n=(new Date).getTime();K(o.c.chunker);)if(i=zt(o.c.chunker.inBytesProcessed)/zt(o.c.length_0),(new Date).getTime()-n>200)return a(i),r(t,0),0;a(1),e=A(o.c.output),r(s.bind(null,e),0)}catch(t){s(null,t)}}),0)},decompress:function(t,e,s){var a,i,n,o,u={},l=void 0===e&&void 0===s;if("function"!=typeof e&&(i=e,e=s=0),s=s||(t=>{if(void 0!==i)return c(n?t:-1,i)}),e=e||((t,e)=>{if(void 0!==i)return postMessage({action:2,cbn:i,result:t,error:e})}),l){for(u.d=B({},t);K(u.d.chunker););return Gt(A(u.d.output))}try{u.d=B({},t),o=zt(u.d.length_0),n=o>-1,s(0)}catch(t){return e(null,t)}r((function t(){try{for(var i,c=0,l=(new Date).getTime();K(u.d.chunker);)if(++c%1e3==0&&(new Date).getTime()-l>200)return n&&(a=zt(u.d.chunker.decoder.nowPos64)/o,s(a)),r(t,0),0;s(1),i=Gt(A(u.d.output)),r(e.bind(null,i),0)}catch(t){e(null,t)}}),0)}}})();this.j=t},6304:(t,e,r)=>{"use strict";r.d(e,{W:()=>s,w:()=>a});let s=r(4323).lQ;function a(t){s=t}},5448:(t,e,r)=>{"use strict";r.d(e,{G:()=>c});var s=r(2846),a=r(2542),i=r(7552),n=r(5524),o=r(6683);async function c(t){await s.M.promise;const e=s.M.GROUPS,r=new Set;for(let t=0;t<e.length;t++){const s=e[t];s.background?.type===o.sf.FILE&&r.add(s.id+s.createBackgroundFileURL());for(let t=0;t<s.dials.length;t++){const e=s.dials[t];e.url?r.add(s.id+e.url):e.multi&&Array.isArray(e.multi.links)?e.multi.links.forEach((t=>r.add(s.id+t.url))):e.providers&&Array.isArray(e.providers)&&e.providers.filter(a.Z).forEach((t=>r.add(s.id+t.url)))}}if(0!==r.size)for(const e of[i.ew.DB_IMAGE,i.ew.DB_PREVIOUS,i.ew.DB_ORIGINAL]){const s=await t.mapEachRecord(e,{filter:t=>!r.has(t.group+t.url),map:t=>({groupId:t.group,url:t.url})});for(const{groupId:r,url:a}of s)await t.removeDial(r,a).catch((t=>(0,n.vV)(`cannot delete dial from "${e}", row: [${r}, ${a}]`,t)));(0,n.cO)(`DB cleanup complete, from table: "${e}" deleted ${s.length} rows:`)}}},9232:(t,e,r)=>{"use strict";r.r(e),r.d(e,{backupToSync:()=>S,getLocalStorageBackup:()=>T,getSyncBackups:()=>O});var s=r(4323);var a=r(3380),i=r(5772),n=r(5524),o=r(1374),c=r(5422),u=r(1061),l=r(7371),d=(r(2460),r(9180)),h=r(2846),p=r(1305),m=r(5448),f=r(9676),w=r(4716);const g=(0,d.Lm)(15),_=3,y=5e5,v="_bck_",b=v+"sync_backup",D=7692,I=101900,E=(t,e)=>`${v}${t}_p${e}`;async function A(){const t=(e=await browser.storage.sync.get(),Object.entries(e).filter((([t])=>t.startsWith(v))).map((([t,e])=>({key:t,strData:e,created:parseInt(t.slice(v.length)),partNumber:parseInt(t.split("_p")[1])}))));var e;const r=(0,o.vC)(t,"created").sort((0,i.s)("created",!1)).slice(_).map((t=>t.created)),s=new Set(r),{true:n,false:c}=(0,a.eg)(t,(t=>s.has(t.created)));return n.length>0&&await browser.storage.sync.remove(n.map((t=>t.key))),c}async function S(){const t=await A(),e=Math.max(0,...t.map((t=>t.created))),r=Date.now();if(r-e<g)return;await(0,f.w)(1e4,s.lQ,(()=>p.i.withDB(m.G)));const a=await async function(t){const e=JSON.stringify((0,c.E)(t));if(e.length>y)return"";const r=new w.w("compression"),s=await(0,l.v)(e);r.diff("lzma: "+s.length);const a=await(0,u.h)(s);return r.diff("base93: "+a.length),a.length>I?"":a}(h.M.serialize());try{self.localStorage.setItem(b,a)}catch(t){(0,n.vV)("localStorage backup failed",t)}const i=function(t,e){const r=new Array(Math.ceil(t.length/e)),s=Math.ceil(t.length/e);for(let a=0,i=0;a<s;++a,i+=e)r[a]=t.slice(i,i+e);return r}(a,D);0===i.length&&((0,n.vV)("too much data, won't fit in sync no matter what..."),i.push(""));const o=Object.fromEntries(i.map(((t,e)=>[E(r,e),t])));await browser.storage.sync.set(o).catch((async t=>{(0,n.vV)("backupToSync",t),await async function(){const t=await A(),e=Math.min(...t.map((t=>t.created))),r=t.filter((t=>t.created===e)).map((t=>t.key));r.length>0&&await browser.storage.sync.remove(r)}(),await browser.storage.sync.set(o)}))}async function P(t){const e=await(0,l.O)(await(0,u.A)(t));return(0,c.z)(JSON.parse(e))}async function O(){const t=await A(),e=(0,a.$z)(t,(t=>t.created));return(await Promise.all(Object.entries(e).map((async([t,e])=>{const r=e.sort((0,i.s)("partNumber")).map((t=>t.strData)).join("");if(0===r.length)return;const{groups:s,metadata:a}=await P(r);return{date:parseInt(t),groups:s,metadata:a}})))).filter(s.zz)}async function T(){const t=self.localStorage.getItem(b);if(t)return{...await P(t),date:Date.now()}}},9830:(t,e,r)=>{"use strict";r.d(e,{J:()=>a,W:()=>i});var s=r(910);const a=new s.F("sync",(()=>({}))),i=new s.F("version",(()=>0))},7880:(t,e,r)=>{"use strict";r.d(e,{h:()=>s});const s={state:"none",message:(0,r(4590).tr)("login_login_create"),details:"With account you will be able to synchronize your dials between devices and your dials will be securely backed-up."}},5422:(t,e,r)=>{"use strict";r.d(e,{E:()=>o,z:()=>c});var s=r(4323),a=r(2542),i=r(611);const n=function(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let t=0;t<e.length;t++)e[t]=255;for(let r=0;r<t.length;r++){const s=t.charAt(r),a=s.charCodeAt(0);if(255!==e[a])throw new TypeError(s+" is ambiguous");e[a]=r}const r=t.length,s=t.charAt(0),a=Math.log(r)/Math.log(256),i=Math.log(256)/Math.log(r);function n(t){if("string"!=typeof t)throw new TypeError("Expected String");if(0===t.length)return new Uint8Array;let i=0,n=0,o=0;for(;t[i]===s;)n++,i++;const c=(t.length-i)*a+1>>>0,u=new Uint8Array(c);for(;t[i];){let s=e[t.charCodeAt(i)];if(255===s)return;let a=0;for(let t=c-1;(0!==s||a<o)&&-1!==t;t--,a++)s+=r*u[t]>>>0,u[t]=s%256>>>0,s=s/256>>>0;if(0!==s)throw new Error("Non-zero carry");o=a,i++}let l=c-o;for(;l!==c&&0===u[l];)l++;const d=new Uint8Array(n+(c-l));let h=n;for(;l!==c;)d[h++]=u[l++];return d}return{encode:function(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===e.length)return"";let a=0,n=0,o=0;const c=e.length;for(;o!==c&&0===e[o];)o++,a++;const u=(c-o)*i+1>>>0,l=new Uint8Array(u);for(;o!==c;){let t=e[o],s=0;for(let e=u-1;(0!==t||s<n)&&-1!==e;e--,s++)t+=256*l[e]>>>0,l[e]=t%r>>>0,t=t/r>>>0;if(0!==t)throw new Error("Non-zero carry");n=s,o++}let d=u-n;for(;d!==u&&0===l[d];)d++;let h=s.repeat(a);for(;d<u;++d)h+=t.charAt(l[d]);return h},decodeUnsafe:n,decode:function(t){const e=n(t);if(e)return e;throw new Error("Non-base"+r+" character")}}};function o({groups:t,metadata:e,sync:r}){return{groups:t.map((t=>f(d(t)))),sync:r||{},metadata:e}}function c({groups:t,sync:e,metadata:r}){return{groups:t.map(p),sync:e||{},metadata:r||{}}}const u=t=>t?1:0,l=new class{base94=n(" !#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~");compress(t){const e=JSON.stringify(t),r=i.j.compress(e,9);return this.base94.encode(r)}decompress(t){const e=this.base94.decode(t),r=i.j.decompress(e);return JSON.parse(r)}},d=t=>[t.id,t.name,t.rows,t.cols,t.dials.map(h),t.ratio||0,t.color||0,t.background?[t.background.type,t.background.value,u(t.background.onlyName)]:0,t.archived?1:0,t.rowColor?Object.entries(t.rowColor).map((([t,e])=>[parseInt(t),e])):0,t.colColor?Object.entries(t.colColor).map((([t,e])=>[parseInt(t),e])):0,t.distraction?[]:0,t.dynamic?[t.dynamic.width,t.dynamic.height]:0,t.lock?[t.lock.passwordId,t.lock.visibility,u(t.lock.encrypted)]:0,t.list?[t.list.width,t.list.direction]:0,t.topSites?[]:0,t.iconId||0,t.container||0,t.grid?l.compress(t.grid):0,t.options||0];function h(t){const e=t.thumbnail,r=t.reload,i=t.crop,n=t.settings,o=t.text,c=t.live,l=t.multi,d=t.session,h=t.topSites,p=t.timer,m=t.weather,w=t.distraction,g=t.providers,_=t.visual,y=(0,s.f3)(t.type)||t.size?[t.name||0,t.type??null,t.url||0,t.note||0,e?[e.type||0,e.value||0,e.position||0,0,0,e.background]:0,r?[r.type||0,r.value||0,r.delay||0,r.method||0,r.cloud?[r.cloud.server]:0]:0,i?[i.scale||0,i.vrX||0,i.vrY||0,i.posX||0,i.posY||0]:0,n?[u(n.FETCH_NEW_NAME),u(n.NO_SCRIPT),n.OPEN_DIAL_IN||0,n.OPEN_IN_CONTAINER||"",n.TAG_ID||0]:0,t.created||0,t.size||0,o?[o.value||"",u(o.CLICK_TO_CLIPBOARD)]:0,g?g.map((t=>(0,a.Z)(t)?[t.type,t.url,t.name,t.icon||0,u(t.raw)]:[t.type,u(t.raw)])):0,c?[u(c.hideScrollbars),u(c.noInteraction)]:0,l?[l.links.map((({name:t,url:e,created:r})=>[t,e,r||0])),l.titleAction,l.linkAction,l.sortBy||0]:0,w?[]:0,_?[u(_.noTitle),_.padding||0,u(_.noIcon),_.titleColor||"",_.titleBackground||""]:0,d?[]:0,h?[]:0,p?[p.timers.map((t=>[t.type,t.value||""]))]:0,m?[m.theme,m.units,m.city,m.lat,m.lon,u(m.current),m.forecastDays]:0]:0;return y?f(y):y}function p(t){return{id:t[0]||0,name:t[1],rows:t[2],cols:t[3],dials:t[4].map(m),ratio:t[5]||void 0,color:t[6]||void 0,background:t[7]&&{type:t[7][0],value:t[7][1],onlyName:!!t[7][2]}||void 0,archived:!!t[8],rowColor:t[9]?Object.fromEntries(t[9]):void 0,colColor:t[10]?Object.fromEntries(t[10]):void 0,distraction:t[11]?{}:void 0,dynamic:t[12]&&{width:t[12][0],height:t[12][1]}||void 0,lock:t[13]&&{passwordId:t[13][0],visibility:t[13][1],encrypted:Boolean(t[13][2])}||void 0,list:t[14]&&{width:t[14][0],direction:t[14][1]}||void 0,topSites:t[15]&&{}||void 0,iconId:t[16]||0,container:t[17]||void 0,grid:t[18]?l.decompress(t[18]):void 0,options:t[19]||{}}}function m(t){if(!t)return{};const e={name:t[0]||void 0,type:(0,s.f3)(t[1])?t[1]:void 0,url:t[2]||void 0,note:t[3]||void 0,created:t[8]||void 0,size:t[9]||void 0};if(t[4]){const[r,s,a,i,n,o]=t[4];e.thumbnail={type:r,value:s,position:a,background:o}}if(t[5]){const[r,s,a,i,n]=t[5];if(e.reload={type:r,value:s,delay:a,method:i},n){const[t]=n;e.reload.cloud={server:t}}}if(t[6]){const[r,s,a,i,n]=t[6];e.crop={scale:r,vrX:s,vrY:a,posX:i,posY:n}}if(t[7]){const[r,s,a,i,n]=t[7];e.settings={FETCH_NEW_NAME:!!r,NO_SCRIPT:!!s,OPEN_DIAL_IN:a,OPEN_IN_CONTAINER:i,TAG_ID:n||0}}if(t[10]){const[r,s]=t[10];e.text={value:r,CLICK_TO_CLIPBOARD:!!s}}if(t[11]){const r=t[11];e.providers=r.map((t=>t[0]===a.S?{type:t[0],url:t[1],name:t[2],icon:t[3]||void 0,raw:!!t[4]}:{type:t[0],raw:!!t[1]}))}if(t[12]){const[r,s]=t[12];e.live={hideScrollbars:!!r,noInteraction:!!s}}if(t[13]){const[r,s,a,i]=t[13];e.multi={links:r.map((([t,e,r])=>({name:t,url:e,created:r}))),titleAction:s,linkAction:a,sortBy:i}}if(t[14]){const r=t[14];e.distraction=r?{}:void 0}if(t[15]){const[r,s,a,i,n]=t[15];e.visual={noTitle:!!r,padding:s,noIcon:!!a,titleColor:i,titleBackground:n}}if(t[16]){const r=t[16];e.session=r?{}:void 0}if(t[17]){const r=t[17];e.topSites=r?{}:void 0}if(t[18]){const r=t[18],s=r[0];e.timer=r?{timers:s.map((([t,e])=>({type:t,value:e})))}:void 0}if(t[19]){const[r,s,a,i,n,o,c]=t[19];e.weather={theme:r,units:s,city:a,lat:i,lon:n,current:!!o,forecastDays:c}}return e}function f(t){const e=t.findLastIndex((t=>0!==t));return t.slice(0,e+1)}},4352:(t,e,r)=>{"use strict";r.d(e,{L:()=>n});var s=r(4323),a=r(6801),i=r(6062);function n(...t){new Set(t.length?t:[void 0]).forEach(o)}async function o(t){const e={type:"data_changed",groupId:t};(0,a._z)(i.Dy?e:{type:"broadcast",message:e}).catch(s.lQ)}},6663:(t,e,r)=>{"use strict";var s;r.d(e,{P:()=>s}),(t=>{t[t.default=0]="default",t[t.background=1]="background",t[t.visit=2]="visit",t[t.hiddenVisit=3]="hiddenVisit"})(s||(s={}))},4162:(t,e,r)=>{"use strict";var s,a,i,n,o;r.d(e,{G_:()=>s}),(t=>{t[t.Home=0]="Home",t[t.Pro=1]="Pro",t[t.Enterprise=2]="Enterprise"})(s||(s={})),(t=>{t[t.gift=0]="gift",t[t.kofi=1]="kofi"})(a||(a={})),(t=>{t[t.Pro=1]="Pro",t[t.Enterprise=2]="Enterprise",t[t.Family=3]="Family"})(i||(i={})),(t=>{t[t.OneYear=12]="OneYear",t[t.ThreeYears=36]="ThreeYears",t[t.TenYears=120]="TenYears"})(n||(n={})),(t=>{t[t.Placebo=0]="Placebo",t[t.Pro=1]="Pro",t[t.Enterprise=2]="Enterprise",t[t.Gold=3]="Gold",t[t.Platinum=4]="Platinum",t[t.Diamond=5]="Diamond",t[t.Family_3=6]="Family_3",t[t.Enterprise_5=7]="Enterprise_5",t[t.Enterprise_10=8]="Enterprise_10",t[t.Enterprise_20=9]="Enterprise_20"})(o||(o={}))},4559:(t,e,r)=>{"use strict";r.d(e,{B:()=>a,O1:()=>i,uT:()=>n});var s=r(1962);const a=()=>(0,s.$H)("dials-container"),i=()=>(0,s.$H)("groups"),n=()=>(0,s.$H)("dials")},3143:(t,e,r)=>{"use strict";r.d(e,{i:()=>i});var s=r(6683),a=r(1484);function i(t,e){const r=[];let i=!1,n=0;for(const o of e){const e=o.size||0;if(e!==s.ZU.NORMAL){if(0===n){if(i)return r;n=(0,a.Q)(e)-1,r.length=0}else n--;r.push(o),o.domId===t.domId&&(i=!0)}else{if(i)return r;r.length=0,n=0}}return r}},1038:(t,e,r)=>{"use strict";r.d(e,{f:()=>l});var s=r(1374),a=r(6683),i=r(5524),n=r(1484),o=r(9719),c=r(7526),u=r(3143);function l(t,e,r,l){const d=e.map((t=>t.clone())),h=d.find((t=>t.domId===r.domId)),p=h.size||0,m=(0,n.Q)(l),f=(0,n.Q)(p),w=Math.abs(m-f);if(p!==l){if(p===a.ZU.NORMAL);else{const t=(0,u.i)(h,d);if(t.length<f)return(0,i.vV)("bad cluster size");if(m>=f);else{if(t.filter((t=>t.isEmptyDial())).length<w)return;for(let e=d.length-1,r=0;e>=0;e--){const s=d[e];if(s.isEmptyDial()&&t.some((t=>t.domId===s.domId))&&(d.splice(e,1),++r>=w))break}}t.forEach((t=>t.size=l))}if(m>f){const e=Array(w).fill(0).map(((e,r)=>new o.I((0,c.V)(),t,{size:l}))),r=(0,s.SL)(d,(t=>t.domId===h.domId));r>=0&&d.splice(r+1,0,...e)}return h.size=l,d}}},1484:(t,e,r)=>{"use strict";r.d(e,{M:()=>i,Q:()=>a});var s=r(6683);const a=t=>Math.imul(...i(t));function i(t){switch(t){case s.ZU.V_HALF:return[2,1];case s.ZU.H_HALF:return[1,2];case s.ZU.V_THIRD:return[3,1];case s.ZU.H_THIRD:return[1,3];case s.ZU.V_FOURTH:return[4,1];case s.ZU.H_FOURTH:return[1,4];default:return[t+1,t+1]}}},841:(t,e,r)=>{"use strict";r.d(e,{v:()=>s});const s={width:300,height:225,androidWidth:240,androidHeight:195,listWidth:300,androidListWidth:228}},9:(t,e,r)=>{"use strict";r.d(e,{Ks:()=>c,QY:()=>u});var s=r(4424),a=r(1374),i=r(4323),n=r(9719),o=r(5717);function c(t,e){const{rows:r,cols:s,dials:i,dynamic:c,list:u,grid:l}=t,d=r+("row"===e?1:0),h=s+("column"===e?1:0),p=function(t,e,r,s,i,c,u,l,d){let h=o.M6.dialsToClusters(e);if(i||c||u)h=h.filter((t=>!t.isEmptyDial())).concat(new o.uP(n.I.createEmptyDial(t)));else{const e=l*d-h.length;if(e>0){const r=Array(e).fill(0).map((()=>new o.uP(n.I.createEmptyDial(t))));h.push(...r)}const i=r-l,c=s-d;if(i>=0&&c>0)for(let e=l;e>0;e--)for(let r=0;r<c;r++)h.splice(e*d,0,new o.uP(n.I.createEmptyDial(t)));if(i<=0||c<0)for(let t=l;t>0;t--)for(let e=0;e<-c;e++){const r=t*d-1-e;h[r].isEmptyDial()&&h.splice(r,1)}h.reverse(),h.length>r*s&&Array(h.length-r*s).fill(0).forEach((()=>(0,a.M$)(h,(t=>t.isEmptyDial())))),h.reverse();for(let e=h.length;e<r*s;e++)h.push(new o.uP(n.I.createEmptyDial(t)))}return o.M6.clustersToDials(h)}(t.id,i,d,h,c,u,l,r,s);return Object.assign(t,{rows:d,cols:h,dials:p})}function u(t,e,r){const n=o.M6.dialsToClusters(e.dials),c=(0,a.SL)(n,(t=>t.includes(r)));c<0&&(0,i.qb)("dial not found");const u="row"===t?s.q:s.W,l=u(c,e.cols);return n.filter(((t,r)=>l===u(r,e.cols)))}},5904:(t,e,r)=>{"use strict";r.d(e,{x:()=>n});var s=r(5953),a=r(9887),i=r(2441);class n{areas;height;width;constructor(t){this.areas=t,this.height=this.areas.length,this.width=this.areas.at(0)?.length||0}getCoordinates(t){let e=-1,r=-1;const a=this.areas.findIndex((s=>{if(e=s.indexOf(t),-1!==e)return r=s.lastIndexOf(t),!0}));if(-1===a)return;const i=this.areas.findLastIndex((r=>r.includes(t,e)));return new s.$(e,a,r,i)}getConflictsInRange(t,{left:e,top:r,right:s,bottom:a},i){const n=new Map;for(let o=r;o<=a;o++){const r=this.areas[o];if(!r)return i?n:void 0;for(let a=e;a<=s;a++){const e=r[a];if(void 0===e&&!i)return;if(e&&e!==t){const t=n.get(e);t?t.push({x:a,y:o}):n.set(e,[{x:a,y:o}])}}}return n}hasConflictsInRange(t,{left:e,top:r,right:s,bottom:a}){if(e<0||r<0||s>=this.width||a>=this.height)return!0;for(let i=r;i<=a;i++){const r=this.areas[i];for(let a=e;a<=s;a++){const e=r[a];if(e&&e!==t)return!0}}return!1}replaceCells({left:t,top:e,right:r,bottom:s},a){for(let i=e;i<=s;i++){const e=this.areas[i];for(let s=t;s<=r;s++)e[s]=a}return this}removeItems(t){for(let e=0;e<this.height;e++){const r=this.areas[e];for(let e=0;e<this.width;e++)t.has(r[e])&&(r[e]=0)}return this}insertItems(t,e,r){const s=this.clone(),a=t[Symbol.iterator]();for(let t=0;t<s.height;t++)for(let i=0;i<s.width;i++){const n=i+e-1,o=t+r-1;if(n>=s.width||o>=s.height||s.hasConflictsInRange(-1,{left:i,right:n,top:t,bottom:o}))continue;const{done:c,value:u}=a.next();if(c)return s;s.replaceCells({left:i,right:n,top:t,bottom:o},u)}if(a.next().done)return s}resize(t,e){const r=this.height+e,s=this.width+t,i=t>0?[]:this.getConflictsInRange(-1,{left:this.width+t,top:0,right:this.width-1,bottom:this.height-1},!0),o=e>0?[]:this.getConflictsInRange(-1,{left:0,top:this.height+e,right:this.width+t-1,bottom:this.height-1},!0),c=Array.from(new Map([...i,...o]),(([r,s])=>new a.o(r,this,s,t,e))).sort(a.o.getSortBySizeAndDistance(Math.floor(r/2),Math.floor(s/2))),u=this.clone();c.forEach((t=>u.replaceCells(t.coordinates,0)));return{grid:new n(Array.from({length:r},((t,e)=>{const r=u.areas[e]||[];return[...r,...Array.from({length:s-r.length},(()=>0))].slice(0,s)}))),conflicts:c}}getCommonDimension(){const t=new i._;for(let e=0;e<this.height;e++){const r=this.areas[e];for(let s=0;s<this.width;s++){const a=r[s];a&&t.push(a,{x:s,y:e})}}const e=Array.from(t,(([t,e])=>{const{x:r,y:s}=e[0],{x:a,y:i}=e.at(-1);return{width:a-r+1,height:i-s+1}})),r=new i._;return e.forEach((t=>r.push(`${t.width}x${t.height}`,t))),Array.from(r.values()).sort(((t,e)=>e.length-t.length)).at(0)?.at(0)}replaceItem(t,e){return t!==e&&this.areas.some((e=>e.includes(t)))?this.areas.map((r=>r.map((r=>r===t?e:r===e?0:r)))):this.areas}swapItems(t,e){return this.areas.map((r=>r.map((r=>r===t?e:r===e?t:r))))}getMaximumNewItemSize(t){const e=this.height*this.width,r=Math.floor(Math.min(4,this.height/2,this.width/2,Math.sqrt(e/t)))||1;return{width:r,height:Math.min(3,r)}}clone(){return new n(this.areas.map((t=>t.slice())))}getItems(){const t=new Set(this.areas.flat());return t.delete(0),t}}},9887:(t,e,r)=>{"use strict";r.d(e,{o:()=>s});class s{item;grid;overlaps;offsetX;offsetY;coordinates;itemSize;evadingVector;constructor(t,e,r,s,a){this.item=t,this.grid=e,this.overlaps=r,this.offsetX=s,this.offsetY=a,this.coordinates=this.grid.getCoordinates(this.item),this.itemSize=this.coordinates.width*this.coordinates.height,this.evadingVector=this.computeEvadingVector()}computeEvadingVector(){const{left:t,top:e,right:r,bottom:s,width:a,height:i}=this.coordinates,{offsetX:n,offsetY:o}=this;let c=0,u=0;for(let n=e;n<=s;n++)for(let s=t;s<=r;s++)if(this.overlaps.some((t=>t.x===s&&t.y===n))){const r=a/2,o=i/2;s+1>t+r&&c--,s<t+r&&c++,n+1>e+o&&u--,n<e+o&&u++}return c||u?{x:c,y:u}:{x:n,y:o}}*moveToEmptySpace(t){const e=Math.max(t.width,t.height),{x:r,y:s}=this.evadingVector,a=function*(t){const[e,r]=t.map((t=>Math.sign(t)));for(let t=1;t<1e3;t++){const s=2*t+1,a=Math.floor(s/2),i=[],n=[],o=[],c=[];for(let e=0;e<s;e++){const r=e-a;for(let e=0;e<s;e++){const s=e-a;Math.abs(r)+Math.abs(s)===t&&(r&&s?r>0&&s>0?i.push([r,s]):r<0&&s<0?n.push([r,s]):o.push([r,s]):c.push([r,s]))}}for(const t of[i,o,n,c]){t.sort((([t,e],[r,s])=>t!==r?r-t:s-e));for(const s of t){const[t,a]=s;e&&r?yield[t*e,a*r]:r&&!e?yield[a,t*r]:e&&!r?yield[a*e,t]:yield s}}}}([r,s]);for(const[r,s]of a){if(r>e)break;const a=this.coordinates.offset(r,s);t.hasConflictsInRange(this.item,a)||(yield t.clone().replaceCells(a,this.item))}}static getSortBySizeAndDistance(t,e){return(r,s)=>{const a=s.itemSize-r.itemSize;if(a)return a;const[i,n]=[r,s].map((r=>Math.abs(r.coordinates.top-t)+Math.abs(r.coordinates.left-e)));return i-n}}}},6664:(t,e,r)=>{"use strict";r.d(e,{J:()=>g});var s=r(5904),a=r(5953),i=r(9100),n=r(9887);class o{item;grid;coordinates;constructor(t,e){this.item=t,this.grid=e,this.coordinates=this.grid.getCoordinates(this.item)}offset(t,e,r){const{left:s,top:o,right:c,bottom:u,width:l,height:d}=this.coordinates,h="move"===r,p=h?(0,i.n)(0,this.grid.width-l,s+t):s,m=h?(0,i.n)(0,this.grid.height-d,o+e):o,f=h?p+l-1:(0,i.n)(s,this.grid.width-1,c+t),w=h?m+d-1:(0,i.n)(o,this.grid.height-1,u+e);if(f===c&&w===u&&p===s&&m===o)return;const g=this.grid.getConflictsInRange(this.item,new a.$(p,m,f,w));if(!g)return;const _=Array.from(g,(([r,s])=>new n.o(r,this.grid,s,t,e))).sort(n.o.getSortBySizeAndDistance(o,s));return{coordinates:new a.$(p,m,f,w),conflicts:_}}}var c=r(1282);class u{grid;clone(){return new u(this.grid.areas)}get areas(){return this.grid.areas}get width(){return this.grid.width}get height(){return this.grid.height}constructor(t){this.grid=new s.x(t)}move(t,e,r,s="move"){if(0===e&&0===r)return this.grid;const a=new o(t,this.grid);if(!a.coordinates)return;const i=a.offset(e,r,s);if(!i)return this.grid;const n=this.grid.clone();n.replaceCells(a.coordinates,0),i.conflicts.forEach((t=>n.replaceCells(t.coordinates,0))),n.replaceCells(i.coordinates,a.item);try{return this.resolveConflicts(n,i.conflicts)||this.resolveConflicts(n,i.conflicts.toReversed())}catch(t){}}placeItem(t,e,r){const s=this.grid.clone(),{width:a,height:i}=s.getCommonDimension()||s.getMaximumNewItemSize(1);for(let n=a,o=i;n>0;n--,o=Math.max(1,o-1)){const a={left:e,top:r,right:e+n-1,bottom:r+o-1};if(!s.hasConflictsInRange(-1,a))return{grid:s.replaceCells(a,t),itemWidth:n,itemHeight:o}}}resizeGrid(t,e){const{width:r,height:s}=this.grid;if(t===r&&e===s)return this;const{grid:a,conflicts:i}=this.grid.resize(t-r,e-s),n=this.resolveConflicts(a,i);return n?(this.grid=n,this):void 0}resolveConflicts(t,e,r=performance.now()+200){if(performance.now()>r)throw Error("grid_timeout");const[s,...a]=e;if(!s)return t;const i=s.moveToEmptySpace(t);for(const t of i){const e=this.resolveConflicts(t,a,r);if(e)return e}}updateGrid(t){const e=this.grid.getCommonDimension();if(!e){const e=u.fromItems(t,this.width,this.height);return e?(this.grid=e,this):void 0}const r=new Set(t),s=this.grid.getItems(),a=(0,c.tX)(s,r),i=(0,c.tX)(r,s),n=this.grid.clone();n.removeItems(a);const o=n.insertItems(i,e.width,e.height);if(o)return this.grid=o,this}static fromItems(t,e,r){const a=Array.from({length:r},(()=>Array.from({length:e},(()=>0)))),i=new s.x(a),{width:n}=i.getMaximumNewItemSize(t.length);for(const[e,r]of[[4,3],[3,3],[3,2],[2,2],[1,1]]){if(e>n)continue;const s=i.insertItems(t,e,r);if(s)return s}}}var l=r(3694),d=r(1361),h=r(4559),p=r(2780),m=r(4323),f=r(1470),w=r(2846);class g{gridData;groupId;dialsNode;handlers;_currentAreas;get rows(){return this._currentAreas.length}get cols(){return this._currentAreas[0].length||0}constructor(t,e,r=(0,h.uT)()){this.gridData=t,this.groupId=e,this.dialsNode=r,this.handlers=new d.G,this.applyGridLayout(t),this._currentAreas=t.areas}static create(t){if(!t.grid)throw new Error("Not a grid!");return new g(t.grid,t.id)}applyGridLayout(t){this._currentAreas=t.areas,this.previewGridLayout(t)}previewGridLayout(t){const e=t.areas.flatMap((t=>`"${t.map((t=>t?`d${t}`:".")).join(" ")}"`)).join("\n");this.dialsNode.style.setProperty("--grid-template-areas",e),this.dialsNode.style.setProperty("--grid-rows",`${this.rows}`),this.dialsNode.style.setProperty("--grid-cols",`${this.cols}`)}placeItem(t,{x:e,y:r}){const s=new u(this._currentAreas),a=this.dialsNode.getBoundingClientRect();e-=a.left,r-=a.top;const i=a.width/s.width,n=a.height/s.height,o=Math.floor(e/i),c=Math.floor(r/n),l=[[-1,-1],[-2,-2],[-1,-2],[-2,-1],[0,-2],[-2,0],[-1,0],[0,-1],[0,0]].map((([e,r])=>{const a=s.placeItem(t.areaNumber,o+e,c+r);return a&&{grid:a.grid,priority:(a.grid.hasConflictsInRange(-1,{left:o,right:o,top:c,bottom:c})?1e3:0)+a.itemWidth*a.itemHeight}})).filter(m.zz).sort(((t,e)=>e.priority-t.priority)).at(0);if(l)return this.previewGridLayout(l.grid),{areas:l.grid.areas}}static normalizeGrid(t,e,r,s){e=e.slice(0,-1),this.makeDialsUnique(e);const a=e.map((t=>t.created));if(0===t.areas.length){const e=u.fromItems(a,s||24,r||12);if(!e)throw new Error("Cannot create grid, dimensions are too small");return{...t,areas:e.areas}}const i=new u(t.areas);if(r&&s&&(r!==i.height||s!==i.width)){if(!i.resizeGrid(s,r))throw new Error("Cannot resize grid, dimensions are too small")}if(!i.updateGrid(a))throw new Error("Cannot update grid");return{...t,areas:i.grid.areas}}static makeDialsUnique(t){const e=new Set;for(const r of t){let t=r.created||(0,l.Sy)();for(;e.has(t);)t++;r.created=t,e.add(t)}}startDrag(t){t.dataTransfer.setDragImage(new Image,0,0);const e=new u(this.gridData.areas);let r=!1,s=!1;this.handlers.addListener((0,h.O1)(),"change",(t=>r=!0));const a=(0,h.B)();a.classList.remove("stopped_moving"),this.handlers.addListener(document.documentElement,"dragend",(async t=>{if(s=!0,this.handlers.clearAll(),r||"none"===t.dataTransfer?.dropEffect)return this.applyGridLayout(this.gridData),void a.classList.add("stopped_moving");this.gridData.areas=this._currentAreas,this.applyGridLayout(this.gridData),await w.M.action("updateGroup",{groupId:this.groupId,update:{grid:this.gridData}})}));const i={left:t.x,top:t.y},n=this.dialsNode.getBoundingClientRect(),o=n.width/e.width,c=n.height/e.height,l=t.currentTarget,d=parseInt(l.style.getPropertyValue("grid-area").slice(1));if(!d)throw Error("Cannot find grid item");const g=l.getBoundingClientRect(),_=parseFloat(window.getComputedStyle(document.documentElement).fontSize),y=t.x>g.right-_&&t.y>g.bottom-_,{scrollLeft:v,scrollTop:b}=a,D=new p.v("one_by_last_one");this.handlers.addListener(this.dialsNode,"dragover",(t=>{t.dataTransfer.dropEffect="move",D.addWork((async()=>{if(s||r)return;if(t.ctrlKey||t.shiftKey||t.altKey||t.metaKey)return r=!0,this.applyGridLayout(this.gridData),void a.classList.add("stopped_moving");const n={left:t.x+(a.scrollLeft-v),top:t.y+(a.scrollTop-b)},u=(0,f.FP)(n,i),l=e.move(d,Math.round(u.left/o),Math.round(u.top/c),y?"resize":"move");l&&this.applyGridLayout(l),await(0,m.BK)(50)}))}))}static showEmptyDial(t){(0,h.B)().classList.toggle("show_empty",t)}}},5953:(t,e,r)=>{"use strict";r.d(e,{$:()=>s});class s{left;top;right;bottom;width;height;constructor(t,e,r,s,a=r-t+1,i=s-e+1){this.left=t,this.top=e,this.right=r,this.bottom=s,this.width=a,this.height=i}offset(t,e){return new s(this.left+t,this.top+e,this.right+t,this.bottom+e,this.width,this.height)}}},8654:(t,e,r)=>{"use strict";r.d(e,{j:()=>a});var s=r(6795);Object.freeze(["up","right","down","left"]);const a=Object.freeze({up:{type:s.EM.HOME_GROUP},right:{type:s.EM.NEXT_GROUP},left:{type:s.EM.PREV_GROUP},down:{type:s.EM.NONE}})},3943:(t,e,r)=>{"use strict";r.d(e,{z:()=>s});const s={dark:"",light:"white"}},2399:(t,e,r)=>{"use strict";r.d(e,{D:()=>o});var s=r(6683),a=r(8794),i=r(2846),n=r(5048);async function o(t,e){const r=!!e&&e.type===s.kh.GROUP,o=(0,n._V)(t);await a.SR.update((e=>(i.M.GROUPS.forEach((s=>s.dials.filter((e=>e.url===o&&(!r||t>s.id))).forEach((t=>e.push([s.id,t.url]))))),e)))}},7139:(t,e,r)=>{"use strict";r(9074),r(4323),r(1055)},5048:(t,e,r)=>{"use strict";r.d(e,{$K:()=>i,b3:()=>n,O5:()=>o,hx:()=>c,l8:()=>a,_V:()=>l,m4:()=>u,Ty:()=>h,om:()=>d});r(4323);var s=r(5360);const a='a[id^="dial_"]',i=31,n=7,o=13,c="#00AAFF",u=t=>parseInt(t.slice(t.lastIndexOf("#")+1)),l=t=>"#"+t,d=t=>parseInt(t.slice(5));const h=(0,s.M)((function(t){if(!t)return"";const e=t.toLowerCase().replace(new RegExp(String.raw`^https?://(www.)?`),"");return e.endsWith("/")?e.slice(0,-1):e}))},2036:(t,e,r)=>{"use strict";r.d(e,{Dg:()=>d,FJ:()=>m,KL:()=>l,Lf:()=>u,wz:()=>p});var s=r(8794),a=r(4323),i=r(7302),n=r(4162),o=(r(9074),r(9574)),c=r(6062);r(1962);const u=(0,i.Z)(""),l=(0,i.Z)("dial.html"),d=location.href.startsWith(l),h=t=>!!t&&t.license>n.G_.Home||!1,p=c.Dy?()=>s.P3.get():(0,o.m)((()=>s.P3.get())),m=()=>p().then(h);(0,a.Lt)(m)},8794:(t,e,r)=>{"use strict";r.d(e,{L8:()=>_,P3:()=>l,SR:()=>y,T6:()=>p,ZB:()=>m,_V:()=>g,c9:()=>w,ci:()=>d,fF:()=>c,fX:()=>u,ne:()=>h,qA:()=>f,wd:()=>v});var s=r(910),a=r(6683),i=r(4323),n=r(7880),o=r(2447);const c={type:"image/webp",quality:.5},u=Object.freeze({type:a.O8.AUTO_GENERATED,value:0,position:a.X.FULL_WIDTH}),l=new s.F("user",(()=>null)),d=new s.F("weather_data",(()=>({})),{storageArea:"local"}),h=(new s.F("last_dial_background",i.s6,{storageArea:"localStorage",localStorageTextOnly:!0}),new s.F("defaultGroup",i.s6,{storageArea:"localStorage"})),p=new s.F("_device_pixel_ratio",(()=>1)),m=(new o.e("favicon",(()=>"128.png")),new s.F("_noNextOverride",(()=>!1)),new s.F("lastReloads",(()=>({})))),f=new s.F("add_current_tabs",(()=>[]),{storageArea:"session"}),w=new s.F("add_image_to_dial",(()=>{}),{storageArea:"session"}),g=new s.F("copied_dial",(()=>null),{storageArea:"session"}),_=new s.F("cut_link",(()=>null),{storageArea:"session"}),y=new s.F("parent_reload",(()=>[]),{storageArea:"session"}),v=new s.F("sync_status",(()=>n.h),{storageArea:"session"})},6795:(t,e,r)=>{"use strict";var s,a,i,n;r.d(e,{Cr:()=>i,EM:()=>a,Gj:()=>n}),(t=>{t[t.none=0]="none",t[t.enlarge=1]="enlarge",t[t.open=2]="open",t[t.openNewTab=3]="openNewTab"})(s||(s={})),(t=>{t[t.NONE=0]="NONE",t[t.OPEN_GROUP=1]="OPEN_GROUP",t[t.NEXT_GROUP=2]="NEXT_GROUP",t[t.PREV_GROUP=3]="PREV_GROUP",t[t.HOME_GROUP=4]="HOME_GROUP"})(a||(a={})),(t=>{t[t.fillSpace=0]="fillSpace",t[t.center=1]="center",t[t.scroll=2]="scroll"})(i||(i={})),(t=>{t[t.NORMAL=0]="NORMAL",t[t.LOCK=1]="LOCK",t[t.HIDDEN=2]="HIDDEN"})(n||(n={}))},4099:(t,e,r)=>{"use strict";r.d(e,{L:()=>n,O:()=>o});var s=r(3456),a=r(6062),i=r(6801);const n=new s.k;function o(t,e){a.Dy?n.notifyAll([t,e]):(0,i._z)({type:"updateFavicon",onlyIfMissing:!0,url:e,groupId:t})}},7552:(t,e,r)=>{"use strict";var s,a,i,n;r.d(e,{Pb:()=>a,ew:()=>i,mU:()=>n,p0:()=>s,yH:()=>o}),(t=>{t.DB_OP_READ_WRITE="readwrite",t.DB_OP_READONLY="readonly"})(s||(s={})),(t=>{t.NEXT="next",t.PREV="prev",t.NEXT_UNIQUE="nextunique",t.PREV_UNIQUE="prevunique"})(a||(a={})),(t=>{t.DB_IMAGE="image",t.DB_HISTORY="history",t.DB_ORIGINAL="original",t.DB_PREVIOUS="previous",t.DB_RUNTIME="runtime"})(i||(i={})),(t=>{t.GROUP_INDEX="group"})(n||(n={}));const o="backups_FileSystemDirectoryHandle"},1305:(t,e,r)=>{"use strict";r.d(e,{i:()=>o});var s=r(5524);var a=r(7552),i=r(4214),n=r(683);class o{name;version;static async withDB(t){const e=new o("group_speed_dial",10);try{return await t(e)}catch(e){throw(0,s.vV)("db operation failed",e,t.name),e}finally{e.close()}}promise;debugName;constructor(t,e){this.name=t,this.version=e,this.debugName=0,this.promise=this.open()}async open(){return this.promise=new Promise(((t,e)=>{const r=self.indexedDB.open(this.name,this.version);r.onupgradeneeded=t=>{(0,s.cO)("DB: onupgradeneeded");const i=r.result;i.onerror=i.onabort=e,i.objectStoreNames.contains(a.ew.DB_IMAGE)||i.createObjectStore(a.ew.DB_IMAGE,{keyPath:["url","group"]}),i.objectStoreNames.contains(a.ew.DB_ORIGINAL)||i.createObjectStore(a.ew.DB_ORIGINAL,{keyPath:["url","group"]}),i.objectStoreNames.contains(a.ew.DB_PREVIOUS)||i.createObjectStore(a.ew.DB_PREVIOUS,{keyPath:["url","group"]}),i.objectStoreNames.contains(a.ew.DB_HISTORY)||i.createObjectStore(a.ew.DB_HISTORY,{keyPath:"id",autoIncrement:!0}),i.objectStoreNames.contains(a.ew.DB_RUNTIME)||i.createObjectStore(a.ew.DB_RUNTIME,{keyPath:"key"});const n=r.transaction.objectStore(a.ew.DB_IMAGE);n.indexNames.contains(a.mU.GROUP_INDEX)||n.createIndex(a.mU.GROUP_INDEX,a.mU.GROUP_INDEX,{unique:!1})},r.onerror=e,r.onsuccess=()=>{const e=r.result;e.addEventListener("close",(()=>(0,s.cO)(`DB: closed unexpectedly ${this.debugName}`))),t(e)}}))}dbWeakTransactionStore(t,e,r){const a=t.transaction([e],r);return a.onerror=a.onabort=t=>(0,s.vV)(`DB ${e}`,t,r),a.objectStore(e)}dbTransaction(t,e,r){const a=t.transaction([e],r),i=new Promise(((t,i)=>{a.oncomplete=t,a.onerror=a.onabort=t=>{(0,s.vV)(`DB transaction ${e}`,t,r),i(t)}}));return[a,i]}async dbOperation(t,e,...r){return new Promise(((a,i)=>{const n=t[e].apply(t,r);n.onerror=t=>{(0,s.vV)(`DB op failed ${e}`,t,r),i(t)},n.onsuccess=()=>{a(n.result)}}))}async dbTransactionOperation(t,e,r,...s){const a=await this.promise;return new Promise((async(i,n)=>{const[o,c]=this.dbTransaction(a,t,e);this.dbOperation(o.objectStore(t),r,...s).then((t=>c.then((()=>i(t))))).catch(n)}))}async close(){(await this.promise).close()}async mapEachRecord(t,{map:e=((t,e)=>t),direction:r=a.Pb.NEXT,filter:i=((t,e)=>!0),filterMode:n="all"}={}){const o=(await this.promise).transaction([t],a.p0.DB_OP_READONLY);o.onerror=o.onabort=e=>(0,s.vV)(`DB mapEachRecord in ${t}`,e);const c=o.objectStore(t);return new Promise(((a,o)=>{const u=[];let l=0,d=0;const h=c.openCursor(null,r);h.onerror=e=>{(0,s.vV)(`DB ${t}`,e),o()},h.onsuccess=function(){const t=this.result;if(t){const r=i(t.value,d++);if("take_while"===n&&!r)return void a(u);r&&u.push(e(t.value,l++)),t.continue()}else a(u)}}))}async updateEachRecordAsync(t,e){const r=await this.dbTransactionOperation(t,a.p0.DB_OP_READONLY,"getAllKeys");return await(0,n.f)(r.map((r=>async()=>{const s=await this.dbTransactionOperation(t,a.p0.DB_OP_READONLY,"get",r).catch(console.error);if(!s)return!1;return await e(s)&&await this.dbTransactionOperation(t,a.p0.DB_OP_READ_WRITE,"put",s),!0})))}async getThumbnails(t){const e=await this.promise,r=this.dbWeakTransactionStore(e,a.ew.DB_IMAGE,a.p0.DB_OP_READONLY).index(a.mU.GROUP_INDEX),s=await this.dbOperation(r,"getAll",t);return(0,i.W)(s,"url")}async moveDbDial(t,e,r,s=r){const a=await this.getDbDial(t,r);return!!a&&(await this.removeDial(e,s),await this.updateDial(e,s,(t=>{const e=Object.assign(a,t);Object.assign(t,e)}),!0),!0)}async updateDial(t,e,r,i=!0,n=!0){const[o,c]=this.dbTransaction(await this.promise,a.ew.DB_IMAGE,a.p0.DB_OP_READ_WRITE),u=o.objectStore(a.ew.DB_IMAGE),l=await this.dbOperation(u,"get",[e,t]);if(!i&&!l)throw(0,s.vV)("forbidden dbDial creation",null,[e,t]),Error("forbidden dbDial creation");const d=l||{url:e,group:t};return n&&(this.backupPrevious({...d}),d.version=Date.now()),delete d.img,delete d.icon,r(d),await this.dbOperation(u,"put",d),await c,d}async backupPrevious(t){await this.dbTransactionOperation(a.ew.DB_PREVIOUS,a.p0.DB_OP_READ_WRITE,"put",t)}async getDialLikeData(t,e,r){if(!isNaN(t)&&e)return await this.dbTransactionOperation(r,a.p0.DB_OP_READONLY,"get",[e,t])}async getDbDial(t,e){return await this.getDialLikeData(t,e,a.ew.DB_IMAGE)}async removeDial(t,e){await this.dbTransactionOperation(a.ew.DB_IMAGE,a.p0.DB_OP_READ_WRITE,"delete",[e,t]),await this.dbTransactionOperation(a.ew.DB_PREVIOUS,a.p0.DB_OP_READ_WRITE,"delete",[e,t]),await this.dbTransactionOperation(a.ew.DB_ORIGINAL,a.p0.DB_OP_READ_WRITE,"delete",[e,t])}async deleteDbDial(t,e){if(isNaN(t)||!e)return;await this.dbTransactionOperation(a.ew.DB_IMAGE,a.p0.DB_OP_READ_WRITE,"delete",[e,t]);return!0}async getPrevious(t,e){return this.getDialLikeData(t,e,a.ew.DB_PREVIOUS)}async restorePreviousThumbnail(t,e){const r=await this.getPrevious(t,e);return!!r&&(await this.updateDial(t,e,(t=>{Object.assign(t,{hash:void 0},r,{version:t.version})}),!1),!0)}}},8289:(t,e,r)=>{"use strict";r.d(e,{Z:()=>s});const s=t=>/^#(\d+)$/.test(t||"")},5444:(t,e,r)=>{"use strict";r.d(e,{N:()=>n});var s=r(5229),a=r(8289),i=r(6672);function n(t){return t=(0,s.I)(t||""),(0,a.Z)(t)?"":(0,i.lX)(t,!0)}},1596:(t,e,r)=>{"use strict";function s(t,e){let r=0;for(let s=0;s<t.length;s++)for(let a=0,i=t[s];a<i.dials.length;a++)if(e(i.dials[a],i,r++,a))return i.dials[a]}r.d(e,{E:()=>s})},3683:(t,e,r)=>{"use strict";function s(t="",e=[]){if(!(t=t.trim())||e.some((e=>t.startsWith(e))))return"";try{return new URL(t).href}catch(e){try{return new URL("http://"+t).href}catch(t){return""}}}r.d(e,{d:()=>s})},6683:(t,e,r)=>{"use strict";var s,a,i,n,o,c,u,l,d,h,p,m,f,w,g,_,y,v,b,D,I,E,A,S,P;r.d(e,{$C:()=>d,C2:()=>D,NO:()=>o,O8:()=>a,Q0:()=>I,X:()=>i,ZU:()=>f,cG:()=>s,d0:()=>_,kh:()=>l,kw:()=>b,oB:()=>E,pK:()=>P,sf:()=>w,xk:()=>n}),(t=>{t.NONE="",t.COLOR="color",t.GRADIENT="gradient",t.URL="url",t.FILE="data",t.BING="bing",t.PAGE="page"})(s||(s={})),(t=>{t[t.AUTO_GENERATED=0]="AUTO_GENERATED",t[t.FILE=1]="FILE",t[t.URL=2]="URL",t[t.PUBLIC=3]="PUBLIC",t[t.MAKE_TEXT=4]="MAKE_TEXT",t[t.BLANK=5]="BLANK",t[t.CLIPBOARD=6]="CLIPBOARD"})(a||(a={})),(t=>{t[t.CENTER=0]="CENTER",t[t.FULL_WIDTH=1]="FULL_WIDTH",t[t.COVER=2]="COVER",t[t.FILL=3]="FILL"})(i||(i={})),(t=>{t[t.solid=0]="solid",t[t.transparent=1]="transparent",t[t.legacy=9]="legacy"})(n||(n={})),(t=>{t[t.solid=0]="solid",t[t.shadow=1]="shadow",t[t.none=9]="none"})(o||(o={})),(t=>{t[t.CURRENT_TAB=0]="CURRENT_TAB",t[t.NEW_FOCUSED_TAB=1]="NEW_FOCUSED_TAB",t[t.NEW_TAB=2]="NEW_TAB",t[t.NEW_WINDOW=3]="NEW_WINDOW",t[t.NEW_PRIVATE_WINDOW=4]="NEW_PRIVATE_WINDOW"})(c||(c={})),(t=>{t[t.ASK=0]="ASK",t[t.RETURN=1]="RETURN",t[t.STAY=2]="STAY"})(u||(u={})),(t=>{t[t.URL=0]="URL",t[t.GROUP=1]="GROUP",t[t.TEXT=3]="TEXT",t[t.SEARCH=4]="SEARCH",t[t.LIVE=5]="LIVE",t[t.MULTI=6]="MULTI",t[t.SESSION=7]="SESSION",t[t.TOP_SITES=8]="TOP_SITES",t[t.TIMER=9]="TIMER",t[t.WEATHER=10]="WEATHER"})(l||(l={})),(t=>{t[t.countdown=0]="countdown",t[t.alarm=1]="alarm",t[t.stopwatch=2]="stopwatch"})(d||(d={})),(t=>{t[t.FLEXIBLE=0]="FLEXIBLE",t[t.FIXED=1]="FIXED"})(h||(h={})),(t=>{t[t.FILL=0]="FILL",t[t.CENTER=1]="CENTER",t[t.SCROLL=2]="SCROLL",t[t.DYNAMIC=3]="DYNAMIC",t[t.GRID=4]="GRID",t[t.LIST=5]="LIST"})(p||(p={})),(t=>{t[t.row=0]="row",t[t.column=1]="column"})(m||(m={})),(t=>{t[t.NORMAL=0]="NORMAL",t[t.SMALL=1]="SMALL",t[t.TINY=2]="TINY",t[t.MICRO=3]="MICRO",t[t.V_HALF=4]="V_HALF",t[t.H_HALF=5]="H_HALF",t[t.V_THIRD=6]="V_THIRD",t[t.H_THIRD=7]="H_THIRD",t[t.V_FOURTH=8]="V_FOURTH",t[t.H_FOURTH=9]="H_FOURTH"})(f||(f={})),(t=>{t[t.COLOR=0]="COLOR",t[t.GRADIENT=1]="GRADIENT",t[t.FILE=2]="FILE",t[t.URL=3]="URL",t[t.NONE=4]="NONE"})(w||(w={})),(t=>{t[t.linear=0]="linear",t[t.radialEllipse=1]="radialEllipse",t[t.radialCircle=2]="radialCircle"})(g||(g={})),(t=>{t[t.AUTO=0]="AUTO",t[t.CUSTOM=1]="CUSTOM"})(_||(_={})),(t=>{t[t.REFRESH_ALL=0]="REFRESH_ALL",t[t.REFRESH_THIS_GROUP=1]="REFRESH_THIS_GROUP",t[t.REFRESH_MISSING=2]="REFRESH_MISSING",t[t.REFRESH_GROUP_DIALS=3]="REFRESH_GROUP_DIALS",t[t.REFRESH_AUTO_RELOAD=4]="REFRESH_AUTO_RELOAD"})(y||(y={})),(t=>{t[t.spinner=1]="spinner",t[t.hidden=2]="hidden"})(v||(v={})),(t=>{t[t.ReloadEvery=0]="ReloadEvery",t[t.Daily=1]="Daily",t[t.Monthly=2]="Monthly",t[t.WeekDays=3]="WeekDays",t[t.Weekends=4]="Weekends",t[t.Monday=5]="Monday",t[t.Tuesday=6]="Tuesday",t[t.Wednesday=7]="Wednesday",t[t.Thursday=8]="Thursday",t[t.Friday=9]="Friday",t[t.Saturday=10]="Saturday",t[t.Sunday=11]="Sunday"})(b||(b={})),(t=>{t[t.openAll=0]="openAll",t[t.nothing=1]="nothing"})(D||(D={})),(t=>{t[t.openLink=0]="openLink",t[t.openAll=1]="openAll"})(I||(I={})),(t=>{t[t.manual=0]="manual",t[t.createdAsc=1]="createdAsc",t[t.createdDesc=2]="createdDesc",t[t.nameAsc=3]="nameAsc",t[t.nameDesc=4]="nameDesc",t[t.urlAsc=5]="urlAsc",t[t.urlDesc=6]="urlDesc"})(E||(E={})),(t=>{t.General="general",t.Visual="visual",t.Background="background",t.Gestures="gestures",t.Settings="settings",t.TopSites="topSites"})(A||(A={})),(t=>{t[t.browserExit=0]="browserExit",t[t.tabClose=1]="tabClose"})(S||(S={})),(t=>{t[t.unlock=0]="unlock",t[t.rememberPassword=1]="rememberPassword",t[t.setupPassword=2]="setupPassword",t[t.changePassword=3]="changePassword",t[t.recoveryPassword=4]="recoveryPassword"})(P||(P={}))},2572:(t,e,r)=>{"use strict";r.d(e,{Fr:()=>i,JR:()=>a});var s=r(9074);const a=(t,e,r,a,i,n)=>`${s.UB}/pub/img/${t}/${e}/${r}-${a}-${i}.${n}`,i=(t,e,r)=>`${s.UB}/pub/pub_img/${t}/0-${e}.${r}`},9074:(t,e,r)=>{"use strict";r.d(e,{UB:()=>s,Vd:()=>i,ff:()=>a});const s="https://group-speed-dial.fastaddons.com",a="https://img.fastaddons.com",i=s},519:(t,e,r)=>{"use strict";r.d(e,{ak:()=>o,mv:()=>i,rH:()=>n});var s=r(7302),a=r(7283);const i="svg/globe.svg",n=(0,s.Z)(i),o=(0,a.H)("icons/tags/tag (65).svg")},6635:(t,e,r)=>{"use strict";r.d(e,{S:()=>p});var s=r(910),a=r(6062),i=r(9180),n=r(170);var o=r(8408),c=r(2036),u=r(7384),l=r(6801),d=r(4590),h=r(2846);const p=new class{storageKey;backgroundScriptCallback;storage;alarmName;constructor(t,e){this.storageKey=t,this.backgroundScriptCallback=e,this.storage=new s.F(this.storageKey,(()=>({lastEntered:Date.now(),isDisabled:!0,remindInHours:3}))),this.alarmName=`help_remember_${this.storageKey}`,a.Dy&&((0,n.Q)(),browser.alarms.onAlarm.addListener((({name:t,scheduledTime:e})=>{t===this.alarmName&&this.backgroundScriptCallback()})),this.checkAndSchedule())}async checkAndSchedule(){const{isDisabled:t,lastEntered:e,remindInHours:r}=await this.storage.get();if(t)return;const s=e+(0,i.xE)(r)-Date.now();browser.alarms.create(this.alarmName,{delayInMinutes:(0,i.$L)(s)})}async setState(t){await this.storage.update((e=>(e.isDisabled=!t,e))),t&&this.checkAndSchedule()}async restartNewCycle(t){await this.storage.reset(),await this.setState(t)}async remembered(){await this.storage.update((t=>(t.lastEntered=Date.now(),t.remindInHours=Math.min(720,2*t.remindInHours),t))),this.checkAndSchedule()}}("help_remember_pass",(async()=>{const[t]=await browser.tabs.query({title:(0,d.tr)("pwd_forget_warning")});if(t||!h.M.METADATA.hasPassword())return;const e=await(0,o.K)(c.KL,{inNewTab:!0,active:!1});await(0,u.p)(e.id),(0,l.hC)(e.id,{type:"help_remember_pwd"})}))},8204:(t,e,r)=>{"use strict";r.d(e,{e:()=>d});var s=r(910),a=r(5017),i=r(6683),n=r(6801),o=r(7398),c=r(2062),u=r(4323),l=r(4721);class d{sessionStoreKey;getHashOptions;unlockOptions;verifyCRC_GetSecret;resetPasswordAndData;helpRememberPassword;cryptoStore;constructor(t,e,r,a,i,n){this.sessionStoreKey=t,this.getHashOptions=e,this.unlockOptions=r,this.verifyCRC_GetSecret=a,this.resetPasswordAndData=i,this.helpRememberPassword=n,this.cryptoStore=new s.F(this.sessionStoreKey,(()=>null),{storageArea:"session"})}get canResetPassword(){return!!this.resetPasswordAndData}get passwordHint(){return this.getHashOptions()?.hint}async savePassword(t){await this.cryptoStore.set({hash:t})}async resetPassword(){this.canResetPassword&&(await(this.helpRememberPassword?.setState(!1)),await(this.resetPasswordAndData?.()))}async verifyPassword(t,e=!0){const r=this.getHashOptions();if(!r)return!1;const s=await(0,o.Er)(t,r),a=await this.verifyHashAndGetSecret(s.hash),i=!!await new c.k(s).unwrapKey(a||r.secret).catch(u.s6);return i&&e&&await this.savePassword(s.hash),i}async verifyHashAndGetSecret(t){if(!this.verifyCRC_GetSecret)return"";const e=await(0,l.d)(t,"SHA-256");return this.verifyCRC_GetSecret?.(e)}async lock(){await this.cryptoStore.remove()}async isUnlocked(){return!!await this.cryptoStore.get()}async unlockIfNeeded(t){{const t=await this.cryptoStore.get();if(t)return await this.verifyHashAndGetSecret(t.hash),!0}const e=await(await(0,a.C)()).pwdPrompt(this,i.pK.unlock,t);return e&&(0,n._z)({type:"broadcast",message:{type:"redraw_dials"}}),e}async decryptData(t){await this.unlockIfNeeded();const e=await this.cryptoStore.get();if(e)return await(this.verifyCRC_GetSecret?.(await(0,l.d)(e.hash,"SHA-256"))),await t.decrypt(e.hash)}lockKeyVaultEverywhere(){(0,n._z)({type:"broadcast",message:{type:"keyVault_lock"}})}}},5017:(t,e,r)=>{"use strict";r.d(e,{C:()=>s});const s=()=>Promise.all([r.e(274),r.e(353)]).then(r.bind(r,7774))},2221:(t,e,r)=>{"use strict";r.d(e,{KY:()=>d,j_:()=>p,lw:()=>h});var s=r(3943),a=r(7548),i=r(4069),n=r(910),o=(r(2572),r(2665),r(5048)),c=r(6663),u=r(6683);const l=()=>({ICON:"/128.png",PRIMARY_COLOR:o.hx,THEME:"default",TEMPLATE_COLOR:s.z.dark,DEFAULT_RELOAD_METHOD:c.P.default,AR_SCREEN_RESOLUTION:u.d0.AUTO,VR_DEFAULT_WIDTH:1280,SIDE_BAR_SIZE:256,DIAL_PADDING:12,SPLIT_DIAL_GAP:50,DIAL_BORDER_TYPE:u.NO.solid,DIAL_SHADOW_BLUR:10,DIAL_TITLE_CENTER:!0,DIAL_BORDER_RADIUS:0,DIAL_BORDER_COLOR:"#888888",DIAL_SHADOW_COLOR:"#888888",DIAL_HEADER_STYLE:u.xk.solid,DIAL_DARK_HEAD_BACKGROUND:"#222222",DIAL_LIGHT_HEAD_BACKGROUND:"#FFFFFF",MAX_FRAME_RELOAD_TIME:10,RELOAD_PLUS_DELAY:5,NORMAL_RELOAD_DELAY:100,BY_VISIT_DELAY:800,AUTO_THUMBNAIL_PAGES:"youtube.com\nm.youtube.com\nyoutu.be\nvimeo.com",AUTO_THUMBNAIL_POSITION:u.X.FULL_WIDTH,ACTIVATE_GROUP_HOVER_DELAY:25,DIAL_FONT_SIZE:16,DIAL_FONT_FAMILY:"",KEY_DELAY:950,DISABLED_DIALS_MENU:[],DISABLED_GROUPS_MENU:[],GROUPS_SIZE:o.O5,GROUPS_HEIGHT:o.$K,GROUP_PADDING:o.b3,GROUP_NAME_AS_TITLE:!0,GROUP_ICON_IN_TITLE:!0,USER_CONSENT_GOOGLE_FAVICON:!0,ACTIVE_PAGE_DETECTION:!0,GESTURE_BTN_RIGHT:!0,BACKGROUND_URL:"https://source.unsplash.com/random?orientation=landscape&size=1920x1080",AUTO_BACKUP_DAYS_INTERVAL:14,AUTO_BACKUP_KEEP_COUNT:4,AUTO_BACKUP_FOLDER_NAME:"gsd",VISIT_JPEG_HIGH_RESOLUTION:!0,ANDROID_MIN_DIAL_SIZE:100}),d=new n.F("options",l,void 0),h=l(),p=(async()=>(Object.assign(h,{...await i.Vq?{AR_DISABLE_THIS_DEVICE:!0,DIAL_PADDING:4,DISABLE_QUICK_EDIT:!0}:{}}),(0,a.Q)(d,h)))()},1481:(t,e,r)=>{"use strict";r.d(e,{f:()=>o});var s=r(1962),a=r(519),i=r(6672);const n=[["http://localhost","svg/localhost (7).svg"],["http",a.mv],["about:","png/domains/about-blank.svg"],[`${s.$b}://extensions`,"icons/tags/tag (25).svg"],[`${s.$b}://settings`,"svg/gear.svg"]];function o(t){for(const[e,r]of n){if("http"===e&&(0,i.K9)(t))return"svg/ip.svg";if(t.startsWith(e))return r}return a.mv}},4424:(t,e,r)=>{"use strict";r.d(e,{W:()=>s,q:()=>a});const s=(t,e)=>t%e,a=(t,e)=>Math.floor(t/e)},6801:(t,e,r)=>{"use strict";r.d(e,{CB:()=>o,_z:()=>i,hC:()=>n});var s=r(6062),a=r(6304);const i=t=>browser.runtime.sendMessage(t),n=async(t,e,r)=>browser.tabs.sendMessage(t,e,r),o=async t=>s.Dy?(0,a.W)(t,{}):browser.runtime.sendMessage(t)},2542:(t,e,r)=>{"use strict";r.d(e,{S:()=>a,Z:()=>s});const s=t=>t.type===a,a="cp"},1650:(t,e,r)=>{"use strict";r.d(e,{v:()=>a});var s=r(4069);let a=!0;s.Vq.then((t=>{t&&(a=!1)}))},5717:(t,e,r)=>{"use strict";r.d(e,{M6:()=>n,uP:()=>o});var s=r(6683),a=r(1484),i=r(1374);class n{static validateAndFixClusters(t){const e=[];for(let r=0;r<t.length;r++){const n=t[r],o=n.size||s.ZU.NORMAL;if(o===s.ZU.NORMAL){e.push(n);continue}const c=(0,a.Q)(o),u=(0,i.v6)(t.slice(r),((t,e)=>(t.size||s.ZU.NORMAL)===o&&e<c));e.push(...u),r+=Math.max(0,u.length-1);const l=c-u.length;l>0&&e.push(...Array.from({length:l},(()=>({size:o}))))}return e}static dialsToClusters(t){const e=Array();for(let r=0;r<t.length;r++){const i=t[r],n=i.size||s.ZU.NORMAL;if(n!==s.ZU.NORMAL){const s=Array(),i=(0,a.Q)(n),o=r;for(let e=0;e<i;e++,r++)s.push(t[r]);e.push(new c(s)),r=o+i-1}else e.push(new o(i))}return e}static clustersToDials(t){const e=Array();for(let r=0;r<t.length;r++){const s=t[r];s.dials?e.push(...s.dials):e.push(s.dial)}return e}equalsTo(t){return this.dial===t.dial}includes(t){return this.dial===t||!!this.dials?.includes(t)}}class o extends n{dial;dials;constructor(t){super(),this.dial=t,this.dials=void 0}isEmptyDial(){return this.dial.isEmptyDial()}}class c extends n{dials;dial;constructor(t){super(),this.dials=t,this.dial=void 0}isEmptyDial(){return this.dials.every((t=>t.isEmptyDial()))}equalsTo(t){return t.dials?.length===this.dials.length&&t.dials.every(((t,e)=>t===this.dials[e]))}}},7644:(t,e,r)=>{"use strict";r.d(e,{_:()=>f});var s=r(6683),a=r(6419),i=r(2742),n=r(9501),o=r(8873),c=r(1416),u=r(2806),l=r(9719),d=r(6684),h=r(8032),p=r(7683),m=r(1360);function f(t,e,r){switch(e.type){case s.kh.URL:return new a.O(t,r,e);case s.kh.LIVE:return new i.r(t,r,e);case s.kh.GROUP:return new n.O(t,r,e);case s.kh.TEXT:return new o.i(t,r,e);case s.kh.SEARCH:return new c.t(t,r,e);case s.kh.MULTI:return new u.U(t,r,e);case s.kh.SESSION:return new d.F(t,r,e);case s.kh.TOP_SITES:return new h.O(t,r,e);case s.kh.TIMER:return new p.W(t,r,e);case s.kh.WEATHER:return new m.r(t,r,e);default:return new l.I(t,r,e)}}},4046:(t,e,r)=>{"use strict";r.d(e,{h:()=>u});var s=r(6683),a=(r(4323),r(5048)),i=r(1305),n=r(4352),o=r(5444),c=r(1962);class u{index;groupId;domId;type;url;getAbsoluteURL(){return this.url||""}name;size;note;created;get gridAreaName(){return`d${this.created}`}get areaNumber(){return this.created||this.index+1e3}thumbnail;crop;reload;visual;settings;distraction;text;providers;live;multi;session;topSites;timer;weather;constructor(t,e){this.index=t,this.groupId=e,this.domId=`dial_${this.index}`,this.size||(this.size=s.ZU.NORMAL)}isSingleLinkDial(){return!1}isLinkDial(){return!1}getLinks(){return this.isSingleLinkDial()?[this.url]:this.multi?this.multi.links.map((t=>t.url)):[]}isGroupDial(){return!1}isTextDial(){return!1}isSearchDial(){return!1}isLiveDial(){return!1}isUrlDial(){return!1}isMultiDial(){return!1}isWeatherDial(){return!1}isTimerDial(){return!1}isSessionDial(){return!1}isTopSitesDial(){return!1}isEmptyDial(){return!1}isNotEmptyDial(){return!this.isEmptyDial()}includesLinkCore(t){return this.isSingleLinkDial()&&(0,a.Ty)(this.url)===t||!!this.multi?.links.some((e=>(0,a.Ty)(e.url)===t))}hash(){return`${this.type};${this.size};${this.name};${this.note};${this.created||0};${this.getLinks().join("")};${this.text?.value||""};${JSON.stringify(this.providers)}`}compare(t){return this.index===t.index&&this.groupId===t.groupId}canHaveThumbnail(){return!1}async hasCustomThumbnail(){if(!this.thumbnail||this.thumbnail.type===s.O8.AUTO_GENERATED||!this.canHaveThumbnail())return!1;const t=await i.i.withDB((async t=>t.getDbDial(this.groupId,this.url)));return!(!t?.imgBlob&&!t?.img)}isAlmostSameDomain(t){const e=(0,o.N)(this.url||""),r=(0,o.N)(t);return e===r||e.startsWith(r.slice(0,r.lastIndexOf(".")))}setSpinner(t=!0){(0,c.$H)(this.domId)?.classList.toggle("reloading",t)}upgrade(){this.size=s.ZU.NORMAL}static updateDB(t,e,r,s){return i.i.withDB((async a=>{await a.moveDbDial(t,r,e,s),(0,n.L)(t,r)}))}}},9719:(t,e,r)=>{"use strict";r.d(e,{I:()=>i});var s=r(4046),a=r(4323);class i extends s.h{type=void 0;isEmptyDial(){return!0}size;get gridAreaName(){return`d${this.areaNumber}`}get areaNumber(){return this.index+1e3}constructor(t,e,r){super(t,e),Object.assign(this,r)}clone(){return new i(this.index,this.groupId,(0,a.WR)(this))}static createEmptyDial(t){return new i(-1,t,{})}}},7319:(t,e,r)=>{"use strict";r.d(e,{$:()=>h});var s=r(4623),a=r(2846),i=r(4323);class n extends s.Y{clone(){return new n((0,i.WR)(this))}getSavingInfo(){return"-locked-"}async onBeforeOpen(){return!this.lock||await a.M.masterKeyVault.unlockIfNeeded()}async getDials(){return await this.isUnlocked()?super.getDials():[]}async getDialsToDraw(){return await this.isUnlocked()?this.getDials():[]}async isUnlocked(){return!this.lock||await a.M.masterKeyVault.isUnlocked()}}var o=r(9998),c=(r(6672),r(6419)),u=r(6683),l=r(519);class d extends n{clone(){return new d((0,i.WR)(this))}async getAutoReloadPoweredDials(){return[]}async findDuplicates(t){return[]}async getDials(){if(this.topSites&&o.Jk&&browser.topSites){return(await browser.topSites.get({includeFavicon:!0,newtab:!0,limit:100}).catch((()=>[]))).map((({title:t,url:e,favicon:r},s)=>{const a=r||l.rH;return new c.O(s,this.id,{name:t||"",url:e,thumbnail:{type:u.O8.URL,value:a,position:u.X.CENTER}})}))}return this.dials}}function h(t){switch(!0){case!!t.topSites:return new d(t);case!!t.lock:return new n(t);default:return new s.Y(t)}}},9501:(t,e,r)=>{"use strict";r.d(e,{O:()=>h});var s=r(6683),a=r(489),i=r(5048),n=r(1589),o=r(7283),c=r(2846),u=r(519),l=r(2036),d=r(4323);class h extends a.z{type=s.kh.GROUP;isGroupDial(){return!0}url;getAbsoluteURL(){return l.KL+this.url}thumbnail;crop;reload;visual;settings;#t=[];static fromUserInput(t,e,r,s,a){const n=new h(t,e,{name:"",...a,url:(0,i._V)(r)});return s&&n.#t.push(s),n}isSingleLinkDial(){return!0}isLinkDial(){return!0}canHaveThumbnail(){return!0}constructor(t,e,r){super(t,e),Object.assign(this,r)}async preSaveAction(t){for(const t of this.#t)await t();this.#t.length=0}getTargetGroupId(){return(0,i.m4)(this.url)}clone(){return new h(this.index,this.groupId,(0,d.WR)(this))}styleIcon(t,e){const r=c.M.groupById(this.getTargetGroupId()),s=r.iconId;return t.setAttribute("style",s?new n.v(0,"",s,r.color||o.e).getIconStyle():u.ak),t}}},2742:(t,e,r)=>{"use strict";r.d(e,{r:()=>o});var s=r(489),a=r(6683),i=r(519),n=r(4323);class o extends s.z{type=a.kh.LIVE;isLiveDial(){return!0}url;live;thumbnail;crop;reload;visual;settings;constructor(t,e,r){super(t,e),Object.assign(this,r)}static fromUserInput(t,e,r,s,a){return new o(t,e,{name:"",...a,url:r,live:s})}isSingleLinkDial(){return!0}isLinkDial(){return!0}canHaveThumbnail(){return!0}clone(){return new o(this.index,this.groupId,(0,n.WR)(this))}styleIcon(t,e){return t.src=e||i.rH,t}}},2806:(t,e,r)=>{"use strict";r.d(e,{U:()=>R});var s=r(6683),a=r(489),i=r(1374),n=r(9944),o=r(6672),c=r(3683),u=r(4323),l=r(2399),d=r(4590),h=r(2846),p=r(2036),m=r(3672),f=r(8289),w=r(9719),g=r(1009),_=r(4352),y=r(4099),v=r(7283),b=r(8794),D=r(5076),I=r(1962),E=r(5048),A=r(9501),S=r(6419);class P{fn;weakMap;constructor(t){this.fn=t,this.weakMap=new WeakMap}getOrFetch(t){if(this.weakMap.has(t))return this.weakMap.get(t);{const e=this.fn(t);return this.weakMap.set(t,e),e}}}var O=r(8282),T=r(3694),k=r(9676);class R extends a.z{type=s.kh.MULTI;isMultiDial(){return!0}multi;thumbnail;visual;settings;isLinkDial(){return!0}#e=new P((t=>(0,f.Z)(t.url)?new A.O(this.index,this.groupId,t):new S.O(this.index,this.groupId,t)));constructor(t,e,r){super(t,e),Object.assign(this,r)}getLinksAsDials(){return this.multi.links.map((t=>this.#e.getOrFetch(t)))}static fromUserInput(t,e,r,s){r.links=r.links.filter((t=>t.url)).map((t=>(t.url=function(t){return t.startsWith(p.KL)?(0,m.u)(t,p.KL):(0,f.Z)(t)?t:(0,c.d)(t)}(t.url),t)));const a=new R(t,e,{name:"",...s,multi:r});return a.normalizeLinks(),a}async postSaveAction(t){this.multi.links.forEach((e=>(0,y.O)(t,e.url)));const e=(await Promise.allSettled(this.multi.links.filter((t=>!t.name)).map((async t=>({url:t.url,title:await(0,k.w)(4e3,"",(()=>(0,g.E)(t.url)))}))))).filter(n.s).map((t=>t.value));this.multi.links.forEach(((t,r)=>{t.name||=e.find((({url:e})=>e===t.url))?.title||(0,o.QV)(t.url)})),this.normalizeLinks(),await h.M.action("replaceDial",{groupId:t,dial:this},(0,d.tr)("save_dial_names_saved")),(0,_.L)(t)}normalizeLinks(){this.multi.links.forEach(((t,e)=>{t.created||=(0,T.Sy)()+e,t.name||=(0,o.QV)(t.url),t.url||=O.pf})),this.multi.links=(0,i.vC)(this.multi.links,"url"),this.multi.sortBy&&this.multi.links.sort(((t,e)=>{switch(this.multi.sortBy){case s.oB.createdAsc:return t.created-e.created;case s.oB.createdDesc:return e.created-t.created;case s.oB.nameAsc:return t.name.localeCompare(e.name);case s.oB.nameDesc:return e.name.localeCompare(t.name);case s.oB.urlAsc:return t.url.localeCompare(e.url);case s.oB.urlDesc:return e.url.localeCompare(t.url);default:return 0}}))}static async mergeDials(t,e,r,s,a=!1){const i=s.clone(),n=h.M.groupById(t),o=(await Promise.all(e.map((t=>n.dialByIndex(t).then((t=>t?.clone())))))).filter(u.zz),c=i.name,p=(i.index,o.flatMap((t=>t.isMultiDial()?(0,u.WR)(t.multi.links):[{name:t.name||"",url:t.url||O.pf}]))),m=R.convertDialToMulti(i,p);await h.M.action("replaceDials",{list:[...a?[]:o.map((e=>({groupId:t,dial:new w.I(e.index,t,{})}))),{groupId:r,dial:m}]},(0,d.tr)("save_dial_moved",`${o.map((t=>`"${t.name}"`)).join(", ")} => "${c}"`)),(0,l.D)(r),a||(0,l.D)(t)}static convertDialToMulti(t,e,r=Number.MAX_SAFE_INTEGER){return t.isMultiDial()?(t.multi.links.splice(r,0,...e),t.normalizeLinks(),t):R.fromUserInput(t.index,t.groupId,{links:[{name:t.name,url:t.url},...e],titleAction:s.C2.openAll,linkAction:s.Q0.openLink},{name:"",thumbnail:t.thumbnail,visual:t.visual,settings:t.settings})}static async pasteLink(t,e){const r=R.getItemIndex(e),s=await b.L8.get();if(s){const e=t.index===s.dialIndex&&t.groupId===s.groupId?t:(await h.M.groupById(s.groupId).dialByIndex(s.dialIndex))?.clone();if(e&&e.isMultiDial()){const[a]=e.multi.links.splice(s.linkIndex,1),i=R.convertDialToMulti(t.clone(),[a],r);await h.M.action("replaceDials",{list:[{groupId:s.groupId,dial:e},{groupId:i.groupId,dial:i}]},(0,d.tr)("save_link_moved",`"${e.name}" => "${i.name}"`)),await b.L8.reset()}return}const a=await b._V.get();if(a?.length){const e=(await Promise.all(a.map((async t=>(await h.M.groupById(t.groupId).dialByIndex(t.dialIndex))?.clone())))).filter((e=>!!e&&!e.compare(t)&&(e.isMultiDial()||e.isLinkDial()))),s=e.flatMap((t=>t?.isMultiDial()?t.multi.links:t?[{name:t.name,url:t.url,created:t.created}]:[])),i=R.convertDialToMulti(t.clone(),s,r);await h.M.action("replaceDials",{list:[...e.map((t=>({groupId:t.groupId,dial:new w.I(t.index,t.groupId,{})}))),{groupId:i.groupId,dial:i}]},(0,d.tr)("save_link_pasted",`${e.map((t=>`"${t.name}"`)).join(", ")} => "${i.name}"`)),await b._V.reset()}}async removeClickedLinkAndSave(t){await(0,D.J)(R.getItemIndex(t),(async t=>{this.multi.links.splice(t,1),await h.M.action("replaceDial",{groupId:this.groupId,dial:this},(0,d.tr)("remove_from_multi"))}))}async cutLink(t){const e=R.getItemIndex(t)||0;await b.L8.set({groupId:this.groupId,dialIndex:this.index,linkIndex:e});const r=(0,I.EW)(t)?.closest(E.l8);Array.from(r?.querySelectorAll("ul > li")||[]).at(e)?.classList.add("is_cut")}static getItemIndex(t){const e=parseInt((0,I.EW)(t)?.closest("li")?.dataset.index||"");return isNaN(e)?void 0:e}clone(){return new R(this.index,this.groupId,(0,u.WR)(this))}styleIcon(t,e){return t.setAttribute("style",(0,v.H)("svg/multi (1).svg")),t}}},489:(t,e,r)=>{"use strict";r.d(e,{z:()=>i});var s=r(4046),a=r(3694);class i extends s.h{type;name;size;note;created=(0,a.Sy)();distraction;constructor(t,e){super(t,e),this.name||(this.name="")}async preSaveAction(t){}postSaveAction(t){}}},1416:(t,e,r)=>{"use strict";r.d(e,{t:()=>d});var s=r(6683),a=r(489),i=r(2542),n=r(6672),o=r(8168),c=r(4099),u=r(7283),l=r(4323);class d extends a.z{type=s.kh.SEARCH;isSearchDial(){return!0}providers;thumbnail;visual;settings;constructor(t,e,r){super(t,e),Object.assign(this,r)}static fromUserInput(t,e,r,s){return r.filter(i.Z).forEach((t=>{t.name??=(0,o.BB)((0,n.lX)(t.url,!0))})),new d(t,e,{name:"",...s,providers:r})}async postSaveAction(t){await Promise.all(this.providers.filter(i.Z).map((e=>(0,c.O)(t,e.url))))}clone(){return new d(this.index,this.groupId,(0,l.WR)(this))}styleIcon(t,e){return t.setAttribute("style",(0,u.H)("svg/search_d (3).svg")),t}}},6684:(t,e,r)=>{"use strict";r.d(e,{F:()=>d});var s=r(6683),a=r(489),i=r(1650),n=r(2036),o=r(7283),c=r(4323),u=r(7137);const l=[n.Lf,"chrome://newtab","https://auth.tampermonkey.net/oauth"];class d extends a.z{type=s.kh.SESSION;isSessionDial(){return!0}session;thumbnail;visual;settings;isLinkDial(){return!0}constructor(t,e,r){super(t,e),Object.assign(this,r)}static fromUserInput(t,e,r,s){return new d(t,e,{name:"",...s,session:r})}async getRecentlyClosed(){if(!i.v||!browser.sessions)return[];const t=await browser.sessions.getRecentlyClosed(),e=t=>!t?.hidden&&!l.some((e=>t?.url?.startsWith(e)));return t.filter((t=>{const{window:r,tab:s}=t;return r?.tabs&&(r.tabs=r.tabs.filter(e),r.tabs.forEach((t=>t.sessionId=r.sessionId))),e(s)}))}async restoreSession(t){const{tab:e,window:r}=await browser.sessions.restore(t),s=e?await browser.windows.get(e.windowId):r;s.focused||await browser.windows.update(s.id,{focused:!0})}canHaveThumbnail(){return!1}static async askForPermission(){return(0,u.x)("sessions")}clone(){return new d(this.index,this.groupId,(0,c.WR)(this))}styleIcon(t,e){return t.setAttribute("style",(0,o.H)("svg/recent (2).svg")),t}}},8873:(t,e,r)=>{"use strict";r.d(e,{i:()=>o});var s=r(6683),a=r(489),i=r(7283),n=r(4323);class o extends a.z{type=s.kh.TEXT;isTextDial(){return!0}text;thumbnail;visual;constructor(t,e,r){super(t,e),Object.assign(this,r)}static fromUserInput(t,e,r,s){return new o(t,e,{name:"",...s,text:r})}clone(){return new o(this.index,this.groupId,(0,n.WR)(this))}styleIcon(t,e){return t.setAttribute("style",(0,i.H)("svg/note_t.svg")),t}}},7683:(t,e,r)=>{"use strict";r.d(e,{W:()=>g});var s=r(6683),a=r(489),i=r(6265),n=r(9598),o=r(4590),c=r(6004);class u extends i.w{index;id;value;type;constructor(t,e,r=""){super(t,e,s.$C.countdown,r),this.index=t,this.id=e,this.value=r,this.type=s.$C.countdown}async start(){browser.alarms.create(this.alarmName,{delayInMinutes:super.getMinutes()})}async stop(){await browser.alarms.clear(this.alarmName)}async renderHead(){return(0,c.nl)([(0,n.u)("label",`${(0,o.tr)("timer_type_0")}:`),super.formatSeconds(this.getSeconds())])}async renderBody(){const t=await this.getScheduledTime();return super.formatSeconds(t?(t-Date.now())/1e3:0)}}class l extends i.w{index;id;value;type;constructor(t,e,r=""){super(t,e,s.$C.alarm,r),this.index=t,this.id=e,this.value=r,this.type=s.$C.alarm}async start(){const{hours:t,minutes:e,seconds:r}=super.getTime(),s=new Date;s.setHours(t),s.setMinutes(e),s.setSeconds(r),s<new Date&&s.setDate(s.getDate()+1),browser.alarms.create(this.alarmName,{when:s.getTime()})}async stop(){await browser.alarms.clear(this.alarmName)}async renderHead(){return(0,c.nl)([(0,n.u)("label",`${(0,o.tr)("timer_type_1")}:`),(0,n.z)("span",{class:"timer_time",textContent:this.value})])}async renderBody(){const t=await this.getScheduledTime();return super.formatSeconds(t?(t-Date.now())/1e3:0)}}var d=r(910),h=r(2460),p=r(5524);class m extends i.w{index;id;type;store;runningIcons;pausedIcons;stoppedIcons;async getScheduledTime(){}constructor(t,e){super(t,e,s.$C.stopwatch),this.index=t,this.id=e,this.type=s.$C.stopwatch,this.store=new d.F(this.alarmName,(()=>{}),{storageArea:"localStorage"}),this.runningIcons=[1,0,1],this.pausedIcons=[1,1,0],this.stoppedIcons=[0,1,0]}async isPaused(){const t=await this.store.get(),e=t?.paused.at(-1);return Boolean(e?.start&&!e?.end)}async isRunning(){return!!await this.store.get()}async start(){await(await this.isRunning()?this.pause():this.store.set({paused:[],startTime:Date.now()}))}async stop(){return(0,p.cO)(`Stopwatch cleared: ${(await this.renderBody()).textContent}`),this.store.remove()}async pause(){let t=!1;return await this.store.update((e=>{if(e){const r=e.paused.at(-1);!r||r.end?e.paused.push({start:Date.now()}):(r.end=Date.now(),t=!0)}return e})),t}async measure(){const t=await this.store.get();if(!t)return 0;const e=Date.now(),r=(0,h.RM)(t.paused.map((t=>(t.end||e)-t.start)));return e-t.startTime-r}async renderHead(){return(0,n.u)("label",`${(0,o.tr)("timer_type_2")}:`)}async renderBody(){return super.formatSeconds(await this.measure()/1e3)}}var f=r(7283),w=r(4323);class g extends a.z{type=s.kh.TIMER;isTimerDial(){return!0}timer;thumbnail;visual;settings;isLinkDial(){return!1}canHaveThumbnail(){return!1}constructor(t,e,r){super(t,e),Object.assign(this,r)}static fromUserInput(t,e,r,s){return new g(t,e,{name:"",...s,timer:r})}getTimerControls(){return this.timer.timers.map(((t,e)=>{switch(t.type){case s.$C.countdown:return new u(e,this.created,t.value);case s.$C.alarm:return new l(e,this.created,t.value);case s.$C.stopwatch:return new m(e,this.created)}}))}clone(){return new g(this.index,this.groupId,(0,w.WR)(this))}styleIcon(t,e){return t.setAttribute("style",(0,f.H)("svg/timer (2).svg")),t}}},8032:(t,e,r)=>{"use strict";r.d(e,{O:()=>l});var s=r(6683),a=r(489),i=r(9998),n=(r(6672),r(519)),o=r(7283),c=r(4323),u=r(7137);class l extends a.z{type=s.kh.TOP_SITES;isTopSitesDial(){return!0}topSites;thumbnail;visual;settings;isLinkDial(){return!0}constructor(t,e,r){super(t,e),Object.assign(this,r)}static fromUserInput(t,e,r,s){return new l(t,e,{name:"",...s,topSites:r})}async getTopSites(){if(!i.Jk||!browser.topSites)return[];return(await browser.topSites.get({includeFavicon:!0,newtab:!0,limit:100}).catch((()=>[]))).map((({title:t,url:e,favicon:r},s)=>({name:t||"",url:e,icon:r||n.rH})))}canHaveThumbnail(){return!1}static async askForPermission(){return(0,u.x)("topSites")}clone(){return new l(this.index,this.groupId,(0,c.WR)(this))}styleIcon(t,e){return t.setAttribute("style",(0,o.H)("svg/list-with-dots.svg")),t}}},6419:(t,e,r)=>{"use strict";r.d(e,{O:()=>u});var s=r(489),a=r(6683),i=r(1962),n=r(7283),o=r(1481),c=r(4323);class u extends s.z{type=a.kh.URL;isUrlDial(){return!0}url="";thumbnail;crop;reload;visual;settings;constructor(t,e,r){super(t,e),Object.assign(this,r),this.url||(this.url="")}static fromUserInput(t,e,r,s){return new u(t,e,{name:"",...s,url:r})}isSingleLinkDial(){return!0}isLinkDial(){return!0}canHaveThumbnail(){return!0}clone(){return new u(this.index,this.groupId,(0,c.WR)(this))}styleIcon(t,e){return e?t.src=e:(t.src=i.RO,t.setAttribute("style",(0,n.H)((0,o.f)(this.url)))),t}}},1360:(t,e,r)=>{"use strict";r.d(e,{r:()=>o});var s=r(6683),a=r(489),i=r(7283),n=r(4323);class o extends a.z{type=s.kh.WEATHER;isWeatherDial(){return!0}weather;thumbnail;visual;settings;isLinkDial(){return!1}canHaveThumbnail(){return!1}constructor(t,e,r){super(t,e),Object.assign(this,r)}static fromUserInput(t,e,r,s){return new o(t,e,{name:"",...s,weather:r})}getWeatherUUID(){return`${this.weather.units}_${this.weather.lat}_${this.weather.lon}`}clone(){return new o(this.index,this.groupId,(0,n.WR)(this))}styleIcon(t,e){return t.setAttribute("style",(0,i.H)("svg/weather.svg")),t}}},6808:(t,e,r)=>{"use strict";r.d(e,{v3:()=>u});var s=r(4590),a=r(7319),i=r(4069),n=r(841);const o=3,c=4;function u(t,{name:e="",dimensions:r,archived:u=!1,isDefaultFirstGroup:l=!1,sourceGroup:d}={}){const h=l&&i.m0,{rows:p,cols:m}=r||(d?{rows:d.rows,cols:d.cols}:h?{rows:7,cols:3}:{rows:o,cols:c}),f=Object.assign({},{id:t,name:l?(0,s.tr)("default_home_group_name"):e||(0,s.ZB)("group_generated_name",t),iconId:l?37:void 0,rows:p,cols:m,...h?{dynamic:{width:n.v.androidWidth,height:n.v.androidHeight}}:{},dials:Array(p*m).fill(0).map((()=>({}))),archived:u,...d?{ratio:d.ratio,dynamic:d.dynamic,list:d.list,background:d.background,gestures:d.gestures,color:d.color,rowColor:d.rowColor,colColor:d.colColor}:{}});return(0,a.$)(f)}},4623:(t,e,r)=>{"use strict";r.d(e,{Y:()=>y});var s=r(6795),a=r(1374),i=r(5048),n=r(6683),o=r(4323),c=r(7644),u=r(9719),l=r(5717),d=r(2846),h=r(8654),p=r(8794),m=r(1589),f=r(2036),w=r(7283),g=r(6664),_=r(5904);class y{clone(){return new y((0,o.WR)(this))}static DEFAULT_ROWS=3;static DEFAULT_COLS=4;id;name;getSavingInfo(){return this.name}cols;rows;dials;async getDials(){return this.dials}archived;background;createBackgroundFileURL(){return`about:blank#${this.id}`}getAbsoluteURL(){return f.KL+`#${this.id}`}colColor;color;distraction;gestures;options;container;getGestures(){return this.gestures||h.j}dynamic;list;grid;topSites;lock;ratio;rowColor;iconId;constructor(t){Object.assign(this,t),this.options??={},this.dials=t.dials.map(((e,r)=>(0,c._)(r,e,t.id)))}async onBeforeOpen(){return!0}async findDuplicates(t){const e=(0,i.Ty)(t);return(await this.getDials()).filter((t=>t.includesLinkCore(e)))}styleIcon(t=document.createElement("img"),e=this.color||w.e,r=0){const s=this.iconId||r;return s&&t.setAttribute("style",new m.v(0,"",s,e).getIconStyle()),t}async insertNewLink(t){const[e]=t.url?await this.findDuplicates(t.url):[];if(e)return"multi"in e||(e.name=t.name),{action:"update",dial:e};const r=(0,a.SL)(this.dials,(t=>t.isEmptyDial())),s=r>=0?r:this.dials.length;return this.replaceDial(t,s),{action:"insert",dial:t}}removeDial(t){const e=this.dials[t];return this.replaceDial(new u.I(t,this.id,e),t)}replaceDial(t,e=this.dials.length){const r=t.clone();e<0&&(e=this.dials.length);this.dials.length;const s=this.dials[e],a=this.dials[e]?.size??n.ZU.NORMAL;return this.dials=[...this.dials.slice(0,e),r,...this.dials.slice(e+1)],r.size=a,this.grid&&s?.created&&r.created&&(this.grid.areas=new _.x(this.grid.areas).replaceItem(s.created,r.created)),r}hasDynamicLayout(){return Boolean(this.dynamic||this.list||this.topSites||this.grid)}isFlexibleLayout(){return!(this.dynamic||this.list||this.ratio||this.grid&&this.grid.position!==s.Cr.fillSpace)}getLastEmptyDial(){const t=this.dials.at(-1);if(t?.isEmptyDial())return t}async isUnlocked(){return!0}getPosition(){return d.M.GROUPS.findIndex((t=>t.id===this.id))}getDialIndex(t){return this.dials.indexOf(t)}getOrCreateEmptyDialIndex(t=0){const e=this.dials.findIndex(((e,r)=>r>=t&&e.isEmptyDial()));return e>=0?e:(this.dials=this.dials.concat(u.I.createEmptyDial(this.id)),this.dials.length-1)}activateGroup(t){window.dispatchEvent(new CustomEvent("change_active_group",{detail:t??this.id}))}async getNeighbouringGroup(t,e,{isProductivityOn:r=!1}={}){const s=await d.M.getVisibleGroups();let a=this;for(const i of Array(s.length))if(a=a._getNeighbouringGroup(s,t,e),!a.distraction||!r)return a}_getNeighbouringGroup(t,e,r){const s=t.findIndex((t=>t.id===this.id)),a="next"===e?s+1:s-1;switch(r){case"loop":return t[a<0?t.length-1:a%t.length];case"stay":return t[a<0?0:a>=t.length?t.length-1:a];case"none":return a<0||a>=t.length?void 0:t[a]}}async executeGesture(t,e){const r=this.getGestures()[t];switch(r?.type){case s.EM.OPEN_GROUP:return this.activateGroup(r.groupId),!0;case s.EM.HOME_GROUP:return this.activateGroup(await p.ne.get()??d.M.GROUPS[0].id),!0;case s.EM.NEXT_GROUP:return this.activateGroup((await this.getNeighbouringGroup("next","loop",{isProductivityOn:e})).id),!0;case s.EM.PREV_GROUP:return this.activateGroup((await this.getNeighbouringGroup("prev","loop",{isProductivityOn:e})).id),!0}return!1}async getDialsToDraw(){return this.getDials()}async getAutoReloadPoweredDials(){return this.list?[]:(await this.getDials()).filter((t=>t.url&&t.reload&&(!t.thumbnail||t.thumbnail.type===n.O8.AUTO_GENERATED)))}async dialByIndex(t){return(await this.getDials()).at(t)}dialById(t){const e=(0,i.om)(t),r=this.dials[e];if(!r)throw`Dial not found!!! ${t} / ${this.id}`;return r}upgrade(){this.dials.forEach((t=>t.upgrade())),this.archived=!1,delete this.rowColor,delete this.colColor}serialize(){let t=this.dials.filter((t=>!t.isEmptyDial()||!(this.list||this.grid||this.dynamic&&!t.size))).map(((t,e)=>t.isEmptyDial()?{...t.size?{size:t.size}:{}}:{name:t.name,note:t.note,created:t.created&&(t.created<3e7?60*t.created+e:t.created),size:t.size,type:t.type,...t.url?{url:t.url}:{},...t.live?{live:t.live}:{},...t.text?{text:t.text}:{},...t.multi?{multi:Object.assign({links:[],titleAction:n.C2.openAll,linkAction:n.Q0.openLink},t.multi)}:{},...t.session?{session:t.session}:{},...t.topSites?{topSites:t.topSites}:{},...t.timer?{timer:t.timer}:{},...t.weather?{weather:t.weather}:{},...t.providers?{providers:t.providers}:{},...t.thumbnail?{thumbnail:t.thumbnail}:{},...t.reload?{reload:t.reload}:{},...t.crop?{crop:t.crop}:{},...t.settings?{settings:t.settings}:{},...t.distraction?{distraction:t.distraction}:{},...t.visual?{visual:t.visual}:{}}));if((this.list||this.grid)&&t.forEach((t=>t.size=n.ZU.NORMAL)),this.topSites)t.length=0;else if(this.dynamic||this.list||this.grid)t.push({});else{t=l.M6.validateAndFixClusters(t);const e=l.M6.dialsToClusters(this.dials),r=this.rows*this.cols;e.length>r&&(this.rows=Math.ceil(e.length/this.cols));for(let e=t.length;e<r;e++)t.push({})}return this.grid&&(this.grid=g.J.normalizeGrid(this.grid,t)),{id:this.id,name:this.name,rows:(0,o.Kg)(this.rows)?parseInt(this.rows):this.rows,cols:(0,o.Kg)(this.cols)?parseInt(this.cols):this.cols,ratio:this.ratio,dynamic:this.dynamic,list:this.list,grid:this.grid,topSites:this.topSites,background:this.background,color:this.color,iconId:this.iconId,archived:this.archived,rowColor:this.rowColor,colColor:this.colColor,distraction:this.distraction,container:this.container,gestures:this.gestures,options:this.options,lock:this.lock,dials:t}}}},7111:(t,e,r)=>{"use strict";r.d(e,{j:()=>i});var s=r(6683),a=r(5048);function i(t,e,r){t.flatMap(((t,i,n)=>function(t,e,i){const n=[],o=(0,a._V)(t),c=(0,a._V)(e);return r?.forEach((r=>{r.group===t&&n.push((()=>r.group=e)),r.url===o&&n.push((()=>r.url=c))})),i.forEach((r=>{r.id===t&&n.push((()=>r.id=e)),r.dials.forEach((t=>{t.type===s.kh.GROUP&&t.url===o&&n.push((()=>t.url=c)),t.type===s.kh.MULTI&&t.multi?.links.forEach((t=>{t.url===o&&n.push((()=>t.url=c))}))}))})),n}(t.id,e+i,n))).forEach((t=>t()))}},2846:(t,e,r)=>{"use strict";r.d(e,{M:()=>V});var s=r(6795),a=r(4323),i=r(6808),n=r(2801),o=r(4590),c=r(1374),u=r(2399),l=r(1038),d=r(9719),h=r(9),p=r(5717);function m(t,e){return(0,c.SL)(t,(t=>t===e||e.equalsTo(t)))}var f=r(1589);class w{masterPassword;tags;constructor(t){Object.assign(this,t),this.tags=(t.tags||[{id:1,icon:36,name:(0,o.tr)("tag_work"),color:"#0095ff"},{id:2,icon:29,name:(0,o.tr)("tag_play"),color:"#00d200"},{id:3,icon:31,name:(0,o.tr)("tag_shopping"),color:"#e94335"}].concat([])).map((t=>new f.v(t.id,t.name,t.icon,t.color)))}getUserTags(){return this.tags.map((t=>new f.v(t.id,t.name,t.icon,t.color)))}tagById(t){const e=this.tags.find((e=>e.id===t));return e?new f.v(e.id,e.name,e.icon,e.color):void 0}hasPassword(){return!!this.masterPassword}getMasterPasswordHint(){return this.masterPassword?.options.hint||""}}var g=r(6672);class _{optionsAutoSync;optionsManual;constructor(t){Object.assign(this,t)}}var y=r(6382),v=r(6062),b=r(5048),D=r(9830),I=r(910),E=r(7319),A=r(4352),S=r(1596),P=r(2542),O=r(1305);async function T(t,e,r){const s=(0,c.BO)(t.url||t.multi?.links.map((t=>t.url))||t.providers?.filter(P.Z).map((t=>t.url))||[]);for(const t of s)await O.i.withDB((s=>s.moveDbDial(e,r,t)))}var k=r(9180);var R=r(2221),B=r(8204),L=r(9114),C=r(6635),M=r(6801),x=(r(7139),r(5076)),N=r(2036),U=r(7111),G=r(2352),F=r(7384),z=r(4069),H=r(5904),W=r(6664);const $="masterPasswordHash"+(L.O?"_incognito":""),V=new class extends y.c{DATA_IS_UP_TO_DATE=new I.F("syncTime",(()=>Date.now()));DATA_LAST_CHANGE=new I.F("lastChangeInfo",a.s6);promise;fields={groups:"groups",metadata:"metadata",sync:"sync"};_executor=new n.V(1);_saveCallbacks=[];masterKeyVault=new B.e($,(()=>this.METADATA.masterPassword?.options),void 0,void 0,(()=>this.action("removeMasterPassword",{})),C.S);_groups=[];_metadata=new w({});_sync=new _({});get GROUPS(){return this._groups}get METADATA(){return this._metadata}get SYNC(){return this._sync}hasOwnGroups=!0;constructor(){super(),this.promise=browser.storage.local.get([this.fields.groups,this.fields.metadata,this.fields.sync]).then((async({[this.fields.groups]:t,[this.fields.metadata]:e,[this.fields.sync]:r})=>(await Promise.all([R.j_,z.Vq,o.P$]),await this.loadGroups(t),this._metadata=new w(e||{}),this._sync=new _(r),this))),browser.storage.local.onChanged.addListener((async t=>{const e=t[D.J.key],r=t[this.DATA_IS_UP_TO_DATE.key],s=t[this.fields.groups],i=t[this.fields.metadata];(s||i||e)&&(i&&(this._metadata=new w(i.newValue||{})),s&&await this.loadGroups(s.newValue),super.notifyChange({type:s||i?"data":"sync",isDirty:!!r&&0===r.newValue,sync:this.SYNC,groups:this.GROUPS,metadata:this.METADATA,lastChangeInfo:t.lastChangeInfo?.newValue,serialize:()=>this.serialize()}),(0,a.XB)(this._saveCallbacks))}))}async loadGroups(t){if(!t?.length&&v.Dy){const t=(0,i.v3)(0,{isDefaultFirstGroup:!0});await this.action("addGroup",{newGroup:t,addonInit:!0})}else this._groups=(t||[]).map(E.$)}async action(t,e,r=""){switch(t){case"addGroup":{const{newGroup:t,position:s,addonInit:a}=e;return this._groups||(this._groups=[]),this._groups.splice(s??this._groups.length,0,(0,E.$)(t)),void await this.saveState(r||(0,o.tr)("save_group_created"),{dontUpdateVersion:a})}case"newSyncData":case"importData":{const{groups:s,metadata:i,sync:n,version:c,replaceExisting:u,source:l,dontUpdateVersion:d}=e,h="shared"===l;h&&(0,U.j)(s,this.getNewGroupId());const p=s.map(E.$);if(h&&!await(0,N.FJ)()&&p.forEach((t=>t.upgrade())),this._groups=u?p:this._groups.concat(p),i&&(this._metadata=new w(i)),n&&(this._sync=new _(n)),await this.saveState(r||(0,o.tr)("import_done_text"),{dontUpdateVersion:d,version:c,setDirty:"newSyncData"===t?Date.now():0}),h){(0,M.CB)({type:"download_missing_favicons"});const t=await(0,G.e6)();await(0,F.p)(t.id,(()=>browser.tabs.update(t.id,{url:`${N.KL}#${p[0].id}`}))),await(0,M.hC)(t.id,{type:"import_shared_complete",importedGroups:p.map((t=>t.id))}).catch(a.lQ)}return}case"importShared":{const{groupId:t}=e;return!1}case"moveGroup":{const{groupId:t,targetGroupId:s}=e,a=this.getGroupIndexById(t),i=this.getGroupIndexById(s);if(a<0||a>=this._groups.length||i<0||i>=this._groups.length)return;this._groups.splice(i,0,this._groups.splice(a,1)[0]);const n=this.groupById(t);return void await this.saveState(r||(0,o.tr)("save_group_moved",`Group: "${n.getSavingInfo()}"`))}case"deleteGroup":{const{groupId:t}=e,s=this.groupById(t);if(s){this._groups=(0,c.M$)(this._groups,(t=>t.id===s.id));const t=(0,b._V)(s.id);this._groups.forEach((e=>{e.dials.forEach(((r,s)=>{r.url===t&&e.removeDial(s)}))})),await this.saveState(r||(0,o.tr)("save_group_deleted",s.getSavingInfo()))}return}case"updateGroup":{const{groupId:t,update:s,newPosition:i}=e,n=this.groupById(t),u=s.name;if(u&&u!==n.name){const e=(0,b._V)(t);this.GROUPS.forEach((r=>{r.id===t&&(r.name=u),r.dials.forEach((t=>{t.url===e&&(t.name=u)}))}))}return Object.assign(n,s),(0,a.qS)(i)&&(0,c.VE)(this._groups,this.getGroupIndexById(t),i),void await this.saveState(r||(0,o.tr)("save_group_edited",n.getSavingInfo()),{forceCallback:!0})}case"insertLinksToGroup":{const{groupId:t,links:s}=e,a=this.groupById(t),i=await Promise.all(s.map((t=>a.insertNewLink(t))));return(0,c.RD)(this._groups,(t=>t.id===a.id),a),await this.saveState(r||(0,o.tr)("save_dial_edited",this.getDialLogInfo(i.map((t=>t.dial.name)).join(", "),a))),i}case"removeDial":{const{groupId:t,index:s}=e,a=this.groupById(t),i=a.dials[s];return(0,u.D)(t,i),a.removeDial(s),void await this.saveState(r||(0,o.tr)("save_dial_removed",this.getDialLogInfo(i.name,a)))}case"resizeDial":{const{groupId:t,dial:s,dialSize:a}=e,i=this.groupById(t),n=(0,l.f)(t,i.dials,s,a);return void(n&&(i.dials=n,await this.saveState(r||(0,o.tr)("save_dial_resized",this.getDialLogInfo(s.name,i)))))}case"updateDialNameIfNeeded":{const{groupId:t,url:s,newName:a}=e,i=this.groupById(t),n=a.trim().slice(0,128),c=i.dials.filter((t=>t.url&&t.url===s&&t.name!==n&&(t.name===(0,g.QV)(s)||t.settings?.FETCH_NEW_NAME)));return void(n&&c.length>0&&(c.forEach((t=>t.name=n)),await this.saveState(r||(0,o.tr)("save_dial_names_saved",this.getDialLogInfo(c.map((t=>t.name)).join(", "),i)))))}case"replaceDial":case"replaceDials":{const{list:s}="replaceDial"===t?{list:[e]}:e;return s.forEach((({dial:t,groupId:e,gridPlacement:r})=>{const s=this.groupById(e);if(s.replaceDial(t,t.index),r&&s.grid){const e=W.J.create(s).placeItem(t,r);e&&(s.grid.areas=e.areas)}})),void await this.saveState(r||(0,o.tr)("save_dial_edited",this.getDialLogInfo(s.map((t=>t.dial.name)).join(", "),this.groupById(s[0]?.groupId))),{forceCallback:!0,editedDialsTypes:s.map((t=>t.dial.type))})}case"swapDials":{const{srcGroupId:t,destGroupId:s,srcDialIndex:i,destDialIndex:n,operation:l,gridPlacement:f}=e;if(t===s&&i===n)return;const w=this.groupById(t),g=this.groupById(s),_=w.dials[i],y=n<0?g.getOrCreateEmptyDialIndex():n,v=g.dials[y];switch(l){case"swap":case"cut":case"copy":const t="swap"===l?v:"copy"===l?_:"cut"===l?d.I.createEmptyDial(w.id):(0,a.qb)("n/a");if(w===g&&g.grid)g.grid.areas=new H.x(g.grid.areas).swapItems(_.created,v.created);else if(w.replaceDial(t,_.index),g.replaceDial(_,v.index),f&&g.grid&&v.isEmptyDial()){const t=W.J.create(g).placeItem(_,f);t&&(g.grid.areas=t.areas)}break;case"up":case"down":case"left":case"right":const e=function(t,e,r,s){const i="left"===s||"right"===s,n="left"===s||"up"===s,o=!n,u=i?"row":"column";let l=(0,h.QY)(u,e,r);const d=e=>(e.dial?.isEmptyDial()||e.dial===t)&&!e.dials,f=(0,a.t1)(d);l.every((t=>!d(t)))&&(0,h.Ks)(e,i?"column":"row"),l=(0,h.QY)(u,e,r);const w=(0,c.SL)(l,(t=>t.includes(r)));w<0&&(0,a.qb)("bad dial index");const g=[l.slice(w),l.slice(0,w+1).reverse()],[_,y]=g;n&&g.reverse();const[v]=g.filter((t=>t.some(d))),b=v===_,D=!b,I=p.M6.dialsToClusters(e.dials),E=(0,c.v6)(v,f,{closedInterval:!0});return(0,c.qm)(E).slice(b&&o||D&&n?1:0).map((([t,e])=>{const r=m(I,t),s=m(I,e);return r>=0&&s>=0?()=>(0,c.VE)(I,r,s):a.lQ})).reverse().forEach(a.g7),e.dials=p.M6.clustersToDials(I),v.find(d).dial}(_,g,v,l),r=w.getDialIndex(_),s=g.getDialIndex(e);w.replaceDial(e,r),g.replaceDial(_,s)}return await this.saveState(r||(0,o.tr)("save_dial_moved",this.getDialLogInfo(_.name,g))),t!==s&&(await T(_,t,s),"swap"===l&&await T(v,s,t)),(0,A.L)(t,s),void(0,u.D)(s)}case"moveDials":{const{srcGroupId:t,destGroupId:s,srcDialIndexes:i,destDialIndex:n,operation:c}=e,l=this.groupById(t),h=this.groupById(s),p=i.map((t=>l.dials[t])).filter((t=>t.isNotEmptyDial()));p.forEach((t=>l.replaceDial(new d.I(t.index,l.id,{}),t.index)));for(const e of p){const r=h.getOrCreateEmptyDialIndex(n),i=h.dials[r];h.replaceDial(e,i.index),t!==s&&await T(e,t,s).catch(a.lQ)}return await this.saveState(r||(0,o.tr)("save_dial_moved",this.getDialLogInfo(p.map((t=>t.name)).join(", "),h))),(0,A.L)(t,s),void(0,u.D)(s)}case"removeDials":{const{srcGroupId:t,srcDialIndexes:s}=e,a=this.groupById(t),i=s.map((t=>a.dials[t]));return i.forEach((t=>a.removeDial(t.index))),await this.saveState(r||(0,o.tr)("save_dial_removed",this.getDialLogInfo(i.map((t=>t.name)).join(", "),a))),(0,A.L)(t,a.id),void(0,u.D)(a.id)}case"addDial":{const{groupId:t,dial:s}=e,a=this.groupById(t);return a.dials=a.dials.concat(s),void await this.saveState(r||(0,o.tr)("save_dial_edited",this.getDialLogInfo(s.name,a)))}case"deleteDial":return void(0,a.SJ)();case"updateProductivity":{const{selectedGroups:t,selectedDialsPerGroup:r}=e,s=JSON.stringify(this.GROUPS);return this.GROUPS.forEach((e=>{t.has(e.id)?e.distraction={}:e.distraction&&delete e.distraction;const s=r.get(e.id);e.dials.forEach(((t,e)=>{s.has(e)?t.distraction={}:t.distraction&&delete t.distraction}))})),void(s!==JSON.stringify(this.GROUPS)&&await this.saveState((0,o.tr)("save_productivity_selection_changed")))}case"saveMasterPassword":{const{pwdId:t,options:r}=e;return this.METADATA.masterPassword={id:t,options:r,name:"master password"},void await this.saveState((0,o.tr)("save_new_master_password"))}case"removeMasterPassword":return this._groups=this._groups.filter((t=>!t.lock?.passwordId)),this.METADATA.masterPassword=void 0,await this.saveState((0,o.tr)("save_removed_master_password")),(0,M._z)({type:"broadcast",message:{type:"redraw_dials"}}),void self.location.reload();case"updateTags":{const{tags:t,operation:r}=e;return this.METADATA.tags=t.map((t=>new f.v(t.id,t.name,t.icon,t.color))),void await this.saveState((0,o.tr)("save_tags_updated")+" - "+r)}}}async saveState(t,{dontUpdateVersion:e=!1,version:r=Date.now(),forceCallback:s=!1,editedDialsTypes:i=Array(),setDirty:n=0}={}){const o={...this.serialize(),lastChangeInfo:{date:Date.now(),name:t,editedDialsTypes:i.filter(a.zz)},[this.DATA_IS_UP_TO_DATE.key]:n||0,...e?{}:{[D.W.key]:r}};s&&(o._forceCallback=Date.now(),(0,x.J)(o.groups.at(0),(t=>t._forceCallback=Date.now()))),await this._executor.addWork((async()=>{await Promise.all([Promise.race([(0,a.BK)(500),new Promise((t=>this._saveCallbacks.push(t)))]),browser.storage.local.set(o)]),await(0,a.BK)(1)}))}getDialLogInfo(t,e){return e.lock?(0,o.tr)("save_locked_group_change"):`Group: "${e.name}"; Dial: "${(t||"").slice(0,32)}"`}async wasRecentlyChanged(){const t=await this.DATA_LAST_CHANGE.get();return!!t&&t.date+(0,k.xF)(2)>Date.now()}async getRecentChangeInfo(){return(await this.DATA_LAST_CHANGE.get())?.name||""}async isDirty(){return 0===await this.DATA_IS_UP_TO_DATE.get()}async clearDirty(){await this.DATA_IS_UP_TO_DATE.reset()}groupById(t){return this.GROUPS.find((e=>e.id===t))||this.GROUPS[0]}dialByUrl(t,e){return this.groupById(t).dials.find((t=>"url"in t&&t.url===e))}dialByCreated(t){return(0,S.E)(this._groups,(e=>e.created===t))}async findDuplicateDial(t){return await async function(t,e){for(let r=0;r<t.length;r++){const s=t[r];if(await e(s,r,t))return s}}(this.GROUPS,(async e=>(await e.findDuplicates(t)).length>0))}cloneGroups(){return this.GROUPS.map((t=>t.clone()))}getVisibleGroups(t=!1){return(0,c.dS)(t?this.cloneGroups():this.GROUPS,(async t=>!t.lock||t.lock.visibility!==s.Gj.HIDDEN||await t.isUnlocked()))}getNewGroupId(){return 1+Math.max(-1,...this.GROUPS.map((t=>t.id)))}serialize(){return{groups:this._groups.map((t=>t.serialize())),metadata:this._metadata}}getGroupIndexById(t){return this._groups.findIndex((e=>e.id===t))}isEmpty(){return 0===this._groups.length}}},1589:(t,e,r)=>{"use strict";r.d(e,{v:()=>n});var s=r(4067),a=r(4590),i=r(7302);class n{id;name;icon;color;static TOTAL_TAGS=68;static GROUP_TAG=65;constructor(t,e,r,s){this.id=t,this.name=e,this.icon=r,this.color=s}getIconStyle(){return(0,s.W)((0,i.Z)(`/icons/tags/tag (${this.icon}).svg`),this.color)}static getEmptyTag(){return new n(0,(0,a.tr)("tag_none"),0,"#888888")}}},7283:(t,e,r)=>{"use strict";r.d(e,{H:()=>n,e:()=>i});var s=r(4067),a=r(7302);const i="var(--primary)",n=t=>(0,s.W)((0,a.Z)(t),"var(--primary)")},5229:(t,e,r)=>{"use strict";r.d(e,{I:()=>a});var s=r(3672);const a=t=>t.startsWith("ext+container")?(0,s.u)(t,"url=","&",!0):t},6265:(t,e,r)=>{"use strict";r.d(e,{w:()=>c});var s=r(9598),a=r(3694),i=r(3635),n=r(7302),o=r(4323);class c{index;id;type;value;static ALARM_PREFIX="timer_";static TIMER_INDEX_DATASET="data-timer-index";timerName;alarmName;static getTimerDataFromAlarm(t){if(!t.startsWith(this.ALARM_PREFIX))return null;const[e,r,s,a]=t.split("_").map((t=>parseInt(t)));return{timerType:r,dialCreated:s,timerIndex:a}}domNodes;isRefreshing;runningIcons;pausedIcons;stoppedIcons;getTime(){const[t=0,e=0,r=0]=this.value.split(":").map((t=>parseInt(t)||0));return{hours:t,minutes:e,seconds:r}}getSeconds(){const{hours:t,minutes:e,seconds:r}=this.getTime();return 3600*t+60*e+r}getMinutes(){return this.getSeconds()/60}constructor(t,e,r,a=""){this.index=t,this.id=e,this.type=r,this.value=a,this.timerName=`${c.ALARM_PREFIX}${this.type}`,this.alarmName=`${this.timerName}_${this.id}_${this.index}`,this.isRefreshing=!1,this.runningIcons=[1,0,0],this.pausedIcons=[0,0,0],this.stoppedIcons=[0,1,0];const i=(0,s.z)("div",{class:"timer_head"}),o=(0,s.z)("div",{class:"timer_body"}),u=(0,s.z)("div",{class:"timer_actions"},[(0,s.z)("img",{"data-stop":"1",class:"timer_action invert icon-button",src:(0,n.Z)("svg/stop.svg")}),(0,s.z)("img",{"data-play":"1",class:"timer_action invert icon-button",src:(0,n.Z)("svg/play.svg")}),(0,s.z)("img",{"data-pause":"1",class:"timer_action invert icon-button",src:(0,n.Z)("svg/pause.svg")})]),l=(0,s.z)("li",{class:`flex ${this.timerName}`,[c.TIMER_INDEX_DATASET]:this.index},[(0,s.z)("div",{class:"timer_left flex-column"},[i,o]),u]);this.domNodes={head:i,body:o,actions:u,container:l},this.domNodes.container.onclick=async t=>{const e=t.target.dataset;switch(!0){case!!e.play:await this.start();break;case!!e.pause:await this.pause();break;case!!e.stop:await this.stop();break;default:await this.defaultAction()}await this.updateBodyDOM(),this.registerRefresher()}}async pause(){return!1}defaultAction(){Array.from(this.domNodes.actions.querySelectorAll(".timer_action:not(.hidden)")).at(-1).click()}isRunning(){return this.getScheduledTime().then(Boolean)}isPaused(){return Promise.resolve(!1)}async updateBodyDOM(){const[t,e,r]=await Promise.all([this.renderBody(),this.isRunning(),this.isPaused()]);this.domNodes.body.replaceChildren(t);const s=r?this.pausedIcons:e?this.runningIcons:this.stoppedIcons;for(const t of[0,1,2])this.domNodes.actions.children.item(t).classList.toggle("hidden",!s[t]);this.domNodes.container.classList.toggle("timer_active",e&&!r)}async getScheduledTime(){const t=await browser.alarms.get(this.alarmName);if(!(t&&t.scheduledTime<Date.now()))return t?.scheduledTime}formatSeconds(t){const e=(0,a.Xm)(Math.round(t)).map((t=>t.toString().padStart(2,"0"))).map(((t,e,r)=>(0,s.z)("span",{textContent:`${t}${e+1===r.length?"":":"}`,class:"00"===t?"zeros":""})));return(0,s.z)("span",{class:"timer_time"},e)}async buildDOM(t){const[e]=await Promise.all([this.isRunning(),this.updateBodyDOM(),this.renderHead().then((t=>this.domNodes.head.replaceChildren(t)))]);if(e){t((()=>this.updateScrollTop()));this.registerRefresher()}return this.domNodes.container}updateScrollTop(){const t=this.domNodes.container.parentElement;if(!t)return;const{top:e,height:r}=this.domNodes.container.getBoundingClientRect(),{top:s,height:a}=t.getBoundingClientRect();e<s?t.scrollTop-=s-e:e+r>s+a&&(t.scrollTop+=e+r-s-a)}async registerRefresher(){if(!this.isRefreshing)for(this.isRefreshing=!0,await(0,i.Q)((()=>this.domNodes.container.isConnected),{delay:100,initDelay:100});this.isRefreshing;)this.domNodes.container.isConnected?await this.updateBodyDOM():this.isRefreshing=!1,await(0,o.BK)(200)}}},9998:(t,e,r)=>{"use strict";r.d(e,{Jk:()=>a});var s=r(4069);r(9773),r(8671),r(8408);let a=!0;s.Vq.then((t=>{t&&(a=!1)}))},2665:(t,e,r)=>{"use strict";r.d(e,{$x:()=>a,c4:()=>n,lV:()=>o});var s=r(910);r(1055);const a="_bearer_tkn_",i=new s.F(a,(()=>""),{storageArea:"local"}),n=()=>i.get();async function o(t){await i.set(t)}},1374:(t,e,r)=>{"use strict";r.d(e,{BO:()=>p,E6:()=>u,Jd:()=>h,M$:()=>o,RD:()=>c,SL:()=>i,VE:()=>m,dS:()=>f,jw:()=>l,qm:()=>w,v6:()=>n,vC:()=>d});var s=r(4214),a=(r(4261),r(683));function i(t,e){for(let r=0;r<t.length;r++)if(e(t[r]))return r;return-1}function n(t,e,{closedInterval:r=!1}={}){for(let s=0;s<t.length;s++)if(!e(t[s],s))return t.slice(0,r?s+1:s);return t.slice()}function o(t,e){return c(t,e)}function c(t,e,...r){for(let s=0;s<t.length;s++)if(e(t[s]))return t.splice(s,1,...r),t;return t}function u(t,e){for(let r=t.length-1;r>=0;r--)t[r]===e&&t.splice(r,1);return t}const l=t=>[...new Set(t)],d=(t,e)=>Object.values((0,s.W)(t,e));function h(t,e){const r=new Map;for(let s=0;s<t.length;s++){const a=t[s];r.set(e(a),a)}return Array.from(r.values())}const p=t=>Array.isArray(t)?t:[t];function m(t,e,r){const s=t[e];return t[e]=t[r],t[r]=s,t}async function f(t,e,{executeSynchronously:r=!1}={}){const s=await(r?(0,a.f)(t.map(((t,r,s)=>()=>e(t,r,s)))):Promise.all(t.map(e)));return t.filter(((t,e)=>s[e]))}function w(t){const e=[];for(let r=0;r<t.length-1;r++)e.push([t[r],t[r+1]]);return e}},3380:(t,e,r)=>{"use strict";function s(t,e){const r=[],s=[];for(let a=0;a<t.length;a++){const i=t[a];(e(i,a)?r:s).push(i)}return{true:r,false:s}}function a(t,e,r={}){for(let s=0;s<t.length;s++){const a=t[s],i=String(e(a,s)),n=r[i];n?n.push(a):r[i]=[a]}return r}function i(t,e){const r={};return Object.entries(t).forEach((([t,s])=>{r[t]=a(s,e)})),r}function n(t,e){const{true:r=[],false:s=[]}=a(t,e),i=[...r.slice(1),...s];return[r[0],i]}r.d(e,{$z:()=>a,Zg:()=>n,eg:()=>s,i8:()=>i})},5772:(t,e,r)=>{"use strict";r.d(e,{s:()=>s});const s=(t,e=!0)=>e?(e,r)=>(e[t]||0)-(r[t]||0):(e,r)=>(r[t]||0)-(e[t]||0)},4261:(t,e,r)=>{"use strict";r.d(e,{E:()=>s});class s{startValue;minValue;maxValue;_index;constructor(t,e,r){this.startValue=t,this.minValue=e,this.maxValue=r,this._index=t}get current(){return this._index}get isLast(){return this._index===this.maxValue}get isFirst(){return this._index===this.minValue}setValue(t){this._index=t}getNext(){return this._index>=this.maxValue?this._index=this.minValue:++this._index}getPrevious(){return this._index<=this.minValue?this._index=this.maxValue:--this._index}map(t){const e=[],r=this._index;let s=0;do{e.push(t(this._index,s++))}while(r!==this.getNext());return e}}},959:(t,e,r)=>{"use strict";var s,a;r.d(e,{E:()=>s}),(t=>{t.sync="sync",t.local="local",t.session="session"})(s||(s={})),(t=>{t.loading="loading",t.complete="complete"})(a||(a={}))},7384:(t,e,r)=>{"use strict";r.d(e,{p:()=>o});var s=r(4323),a=r(1374);const i=new Set,n=new Array;async function o(t,e){if(e&&(i.delete(t),await e()),!i.has(t))return new Promise(((e,r)=>{const i={tabId:t,resolve:e};n.push(i),(0,s.BK)(1e4).then((()=>{(0,a.E6)(n,i),r(new Error("timeout waiting for tab"))}))}))}browser.runtime.onMessage.addListener(((t,e)=>{if("___ext_tab_ready"===t.type){const t=e.tab?.id||0;i.add(t),n.forEach((({tabId:e,resolve:r})=>{e===t&&r()}))}}))},9114:(t,e,r)=>{"use strict";r.d(e,{N:()=>a,O:()=>s});const s=!!browser.extension.inIncognitoContext,a=!1},7137:(t,e,r)=>{"use strict";r.d(e,{x:()=>a});const s=new Map;async function a(t){if(s.has(t))return s.get(t);const e=browser.permissions.request({permissions:[t]}).catch((t=>!1));return s.set(t,e),e.finally((()=>s.delete(t)))}},7302:(t,e,r)=>{"use strict";r.d(e,{Z:()=>a});r(9074);var s=r(1055);r(4323);const a=t=>s.x&&!browser?.runtime?t:browser.runtime.getURL(t)},2062:(t,e,r)=>{"use strict";r.d(e,{k:()=>a});var s=r(9254);class a{keyPromise;constructor(t){this.keyPromise=a.getWrappingKey(t)}async wrapKey(t){const e=await self.crypto.subtle.wrapKey("raw",t,await this.keyPromise,"AES-KW");return(0,s.JR)(e)}async unwrapKey(t){return self.crypto.subtle.unwrapKey("raw",(0,s.Al)(t),await this.keyPromise,"AES-KW","AES-GCM",!0,["encrypt","decrypt"])}static async getWrappingKey(t){const e=await self.crypto.subtle.importKey("raw",(0,s.Al)(t.hash),"PBKDF2",!1,["deriveBits","deriveKey"]);return self.crypto.subtle.deriveKey({name:"PBKDF2",salt:new Uint8Array(t.options.salt),hash:"SHA-256",iterations:t.options.iterations<=1e6?t.options.iterations:1e5},e,{name:"AES-KW",length:256},!0,["wrapKey","unwrapKey"])}}},4721:(t,e,r)=>{"use strict";r.d(e,{d:()=>a,e:()=>i});var s=r(4323);async function a(t,e){const r=(0,s.Kg)(t)?(new TextEncoder).encode(t):t;return Array.from(new Uint8Array(await self.crypto.subtle.digest(e,r))).map((t=>t.toString(16).padStart(2,"0"))).join("")}const i=t=>a(t,"SHA-1")},9254:(t,e,r)=>{"use strict";function s(t){return self.crypto.subtle.importKey("raw",(new TextEncoder).encode(t),"PBKDF2",!1,["deriveBits","deriveKey"])}function a(t){return String.fromCharCode(...new Uint8Array(t))}function i(t){const e=new ArrayBuffer(t.length),r=new Uint8Array(e);for(let e=0,s=t.length;e<s;e++)r[e]=t.charCodeAt(e);return r}function n(t){return Array.from(self.crypto.getRandomValues(new Uint8Array(t/8)))}r.d(e,{Al:()=>i,JR:()=>a,Tc:()=>s,gU:()=>n})},7398:(t,e,r)=>{"use strict";r.d(e,{Er:()=>n,qi:()=>c});var s=r(4716),a=r(9254),i=r(2062);async function n(t,e){const{hint:r="",name:i="PBKDF2",salt:n=[...self.crypto.getRandomValues(new Uint8Array(16))],iterations:o=1e5,hash:c="SHA-256"}=e,u=await(0,a.Tc)(t),l=await(0,s.e)(`Hashing with: ${i}, ${c}, ${o.toLocaleString()}`,(()=>self.crypto.subtle.deriveBits({name:i,salt:new Uint8Array(n),iterations:o,hash:c},u,256)));return{hash:(0,a.JR)(l),options:{name:i,salt:n,iterations:o,hash:c,hint:r,..."secret"in e?{secret:e.secret}:{}}}}async function o(t,e,r={}){const s=await n(t,r),a=await new i.k(s).wrapKey(e);return{hash:s.hash,options:{...s.options,secret:a}}}async function c(t,e,r,s={}){const a=await o(t,r,s),i=await o(e,r,{iterations:s.iterations||1e6,salt:[...self.crypto.getRandomValues(new Uint8Array(s.salt?.length||16))]});return{hash:a.hash,options:{...a.options,recoverySecret:i.options.secret,recoverySalt:i.options.salt}}}},3694:(t,e,r)=>{"use strict";r.d(e,{Ib:()=>n,JY:()=>i,Sy:()=>s,Wu:()=>l,Xm:()=>u,_k:()=>a,aG:()=>c,dR:()=>o});const s=()=>Math.floor(Date.now()/1e3),a=()=>Math.floor(Date.now()/864e5),i=({date:t=new Date,separator:e="_"}={})=>[t.getFullYear(),t.getMonth()+1,t.getDate(),e,t.getHours(),t.getMinutes(),t.getSeconds()].map((t=>t===e?t:`${t}`.padStart(2,"0"))).join(e);function n(t=Date.now()){const e=new Date(t);return`${e.toLocaleDateString()} ${e.toLocaleTimeString()}`}function o(t,e,r,s){const a=new Date;return function(t,e){const r=e-t.getDay();t.setDate(t.getDate()+r)}(a,t),a.setHours(e,r,s,0),a}function c(t=new Date,e){return e(t),t.getTime()}function u(t){const e=t<0?"ceil":"floor";return t?[Math[e](t/3600),Math[e](t%3600/60),t%60]:[0,0,0]}const l=(t,e)=>60*t+e},9180:(t,e,r)=>{"use strict";r.d(e,{$L:()=>o,Lm:()=>n,n:()=>s,xE:()=>i,xF:()=>a});const s=t=>1e3*t,a=t=>6e4*t,i=t=>36e5*t,n=t=>864e5*t,o=t=>Math.round(t/6e4)},1061:(t,e,r)=>{"use strict";r.d(e,{A:()=>o,h:()=>n});var s=r(4681);function a(){return new Worker(r.p+"base_x.worker.worker.js")}r(1055);const i=" !#$%&'()*+,-./0123456789:;=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~";async function n(t){return(0,s.c)(a,{type:"encode",alphabet:i,buffer:t})}async function o(t){return(0,s.c)(a,{type:"decode",alphabet:i,data:t})}},170:(t,e,r)=>{"use strict";r.d(e,{Q:()=>s});r(6062);function s(){0}},4069:(t,e,r)=>{"use strict";r.d(e,{Vq:()=>a,cI:()=>i,m0:()=>s});r(4648);let s=!1;const a=browser.runtime.getPlatformInfo?.().then((t=>s="android"===t.os))||Promise.resolve(!1);let i=!0;a.then((t=>i=!t))},4648:(t,e,r)=>{"use strict";r.d(e,{J:()=>s});const s=()=>"moz-extension:"!==self.location.protocol},6062:(t,e,r)=>{"use strict";r.d(e,{Dy:()=>s,XM:()=>a});const s=self.location.href===browser.runtime.getManifest().background?.page||"/_generated_background_page.html"===self.location.pathname;const a=()=>self.location.href===browser.runtime.getManifest().options_ui.page},9773:(t,e,r)=>{"use strict"},9451:(t,e,r)=>{"use strict";r.d(e,{g:()=>s});const s=new(r(910).F)("_errorLogger",(()=>Array()),{storageArea:"session"})},5524:(t,e,r)=>{"use strict";r.d(e,{cO:()=>o,jW:()=>c,t$:()=>l,vV:()=>u});var s=r(4323),a=r(6062),i=r(9451);const n=t=>i.g.update((e=>{const r=JSON.stringify(t);return r.length>1e4&&(t={name:"Error message is too long",time:Date.now(),context:"x",data:r.slice(0,5e3)+"... (truncated) ..."+r.slice(-100)}),e.push(t),e.slice(-50)}));function o(t,e){const r={name:e?t+" | "+d(e):t,time:Date.now(),context:a.Dy?"bc":"fr"};n(r)}const c=t=>e=>(o(t),e);function u(t,e,r){const s=Error().stack,i={name:t,context:a.Dy?"bc":"fr",errName:e?.name||e?.target?.error?.name,errMessage:e?.message||e?.target?.error?.message,err:String(e),data:d(r),time:Date.now(),stack:s};n(i)}function l(t,e){return r=>(u(t,r,e),Promise.reject(r))}function d(t){try{return(0,s.Kg)(t)?t:JSON.stringify(t)}catch(e){return String(t)}}},2801:(t,e,r)=>{"use strict";r.d(e,{V:()=>i});var s=r(4323),a=r(1374);class i{maxConcurrentJobs;options;_work;_runningJobs;_lastRunDoneTime;constructor(t=1,e={}){this.maxConcurrentJobs=t,this.options=e,this._work=this.options.initialWork||[],this._runningJobs=[],this._lastRunDoneTime=0}hasFreeSlot(){return this._runningJobs.length<(0,s.oA)(this.maxConcurrentJobs)}getRunningJobsCount(){return this._runningJobs.length}getPendingJobsCount(){return this._work.length}async addWork(t,e){if(this.options.uniquePredicate){const t=t=>this.options.uniquePredicate(t.info,e),r=this._work.find(t)||this._runningJobs.find(t);if(r)return r.getPromise()}const r=new Promise(((s,i)=>{const n={info:e,getPromise:()=>r,fn:()=>{const r=t();r.finally((async()=>{(0,a.E6)(this._runningJobs,n),this.options.afterEach&&await this.options.afterEach(e),r.then(s,i).finally((()=>{Promise.resolve().then((()=>this.startWork())),this._lastRunDoneTime=Date.now()}))}))}};this._work.push(n),this.startWork()}));return r}async startWork(){if(this.options.minDelayAfterRun&&this._work.length>0){const t=Date.now()-this._lastRunDoneTime;t<this.options.minDelayAfterRun&&await(0,s.BK)(this.options.minDelayAfterRun-t)}for(;this._work.length>0&&this._runningJobs.length<(0,s.oA)(this.maxConcurrentJobs)&&(0===this._runningJobs.length||!this.options.canRunWithOthers||this.options.canRunWithOthers(this._work[0].info,this._runningJobs.map((t=>t.info))));){const t=this._work.shift();this._runningJobs.push(t),this.options.beforeEach&&await this.options.beforeEach(t.info),t.fn()}}}},9574:(t,e,r)=>{"use strict";function s(t){let e,r=!1;return(...s)=>r?e:(r=!0,e=t(...s))}r.d(e,{m:()=>s})},683:(t,e,r)=>{"use strict";r.d(e,{f:()=>a});var s=r(4323);async function a(t,{beforeEach:e=s.lQ,afterEach:r=s.lQ,ignoreExceptions:a=!1}={}){const i=Array(t.length);for(let s=0;s<t.length;s++){await e(s);const n=t[s],o=await(a?n().then((t=>[t])).catch((t=>[void 0,t||"unknown GSD error"])):n().then((t=>[t])));i[s]=o,await r(s,o)}return i}},2780:(t,e,r)=>{"use strict";r.d(e,{v:()=>s});class s{mode;workList;isRunning;constructor(t){this.mode=t,this.workList=[],this.isRunning=!1}addWork(t){return new Promise((e=>{this.workList.push({job:t,resolve:e}),this.startWork()}))}async startWork(){if(!this.isRunning&&this.workList.length){switch(this.isRunning=!0,this.mode){case"one_by_one":{const{job:t,resolve:e}=this.workList.shift();await t().then(e);break}case"one_by_last_one":const t=this.workList.slice();this.workList.length=0;const{job:e,resolve:r}=t.at(-1);await e(),t.forEach((t=>t.resolve()))}this.isRunning=!1,this.startWork()}}}},3635:(t,e,r)=>{"use strict";r.d(e,{Q:()=>a});var s=r(4323);async function a(t,{delay:e,initDelay:r,maxDelay:a}){for(r&&await(0,s.BK)(r);;){const r=await t();if(r)return r;await(0,s.BK)(e),e*=2,a&&(e=Math.min(e,a))}}},9676:(t,e,r)=>{"use strict";r.d(e,{w:()=>a});var s=r(4323);function a(t,e,r){return new Promise(((a,i)=>{const n=setTimeout((()=>{try{a((0,s.oA)(e))}catch(t){i(t)}}),t);r().finally((()=>{clearTimeout(n)})).then(a,i)}))}},8063:(t,e,r)=>{"use strict";r.d(e,{F:()=>o});var s=r(235),a=r(4323),i=r(9180);const n=new Map;async function o(t){const e=n.get(t)||fetch(t,{signal:(0,s.n)(12e3)});n.set(t,e);const r=await e;return(0,a.BK)((0,i.xF)(5)).then((()=>n.delete(t))),r.clone()}},235:(t,e,r)=>{"use strict";function s(t){const e=new AbortController;return setTimeout((()=>e.abort()),t),e.signal}r.d(e,{n:()=>s})},1009:(t,e,r)=>{"use strict";r.d(e,{E:()=>i});var s=r(1434),a=r(8063);async function i(t,e=!0){const r=await(await(e?a.F:fetch)(t)).text(),[{nodes:i}]=await(0,s.$)(r,[{query:"head > title",attributes:["textContent"]}]);return i?.at(0)?.textContent.trim()||""}},8282:(t,e,r)=>{"use strict";r.d(e,{P4:()=>a,pf:()=>s});const s="about:blank",a="<all_urls>"},9598:(t,e,r)=>{"use strict";r.d(e,{u:()=>n,z:()=>i});var s=r(4323);const a=new Set(["svg","path","circle","text"]);function i(t,e,r=[]){const i=a.has(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);if(e){const t=(0,s.Kg)(e)?{textContent:e}:e;Object.entries(t).forEach((([e,r])=>{switch(e){case"text":case"textContent":i[e]=r;break;case"handlers":Object.assign(i,t.handlers);break;default:i.setAttribute(e,r)}}))}for(const t of r)i.appendChild(t);return i}function n(t,e){const r=document.createElement(t);return r.textContent=e,r}},3773:(t,e,r)=>{"use strict";function s(t,e){const r=(new self.DOMParser).parseFromString(t,"text/html");return e.map((({query:t,attributes:e})=>({query:t,nodes:Array.from(r.querySelectorAll(t)).map((t=>Object.fromEntries(e.map((e=>[e,("textContent"===e?t.textContent:t.getAttribute(e))||""])))))})))}r.d(e,{x:()=>s})},1434:(t,e,r)=>{"use strict";r.d(e,{$:()=>i});var s=r(9676),a=r(3773);async function i(t,e){if(self.DOMParser)return(0,a.x)(t,e);{const r={type:"_ext_dom_extractor_query",htmlText:t,queries:e},a=await(0,s.w)(5e3,null,(()=>browser.runtime.sendMessage(r).catch((()=>null))));if(a)return a}const r=(await browser.tabs.query({discarded:!1})).filter((t=>t.url?.startsWith("http"))).sort(((t,e)=>+e.active-+t.active)).slice(0,5);for(const i of r)try{return await(0,s.w)(5e3,(()=>Promise.reject()),(()=>browser.scripting.executeScript({target:{tabId:i.id,allFrames:!1},args:[t,e],func:a.x}).then((([t])=>t.result||e.map((t=>({query:t.query,nodes:[]})))))))}catch(t){}throw"DOMParser not available"}},1361:(t,e,r)=>{"use strict";r.d(e,{G:()=>a});var s=r(4323);class a{_handlers=[];constructor(){}clearAll(){(0,s.XB)(this._handlers)}addListener(t,e,r,s){t.addEventListener(e,r,s),this._handlers.push((()=>t.removeEventListener(e,r,s)))}addClass(t,e){t.classList.add(e),this._handlers.push((()=>t.classList.remove(e)))}addOnClearHandler(t){this._handlers.push(t)}}},6004:(t,e,r)=>{"use strict";r.d(e,{nl:()=>s});r(4323),r(8168),r(4590),r(7302),r(1962),r(9598),r(5076);function s(t){const e=document.createDocumentFragment();for(let r=0;r<t.length;r++)e.appendChild(t[r]);return e}},1962:(t,e,r)=>{"use strict";r.d(e,{$H:()=>i,$b:()=>a,EW:()=>n,RO:()=>s});const s="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",a="firefox",i=t=>document.getElementById(t);function n(t){return t?t.target:void 0}},4590:(t,e,r)=>{"use strict";r.d(e,{P$:()=>n,ZB:()=>c,tr:()=>o});var s=r(4323);r(1374);const[a,i]=(0,s.Mj)(),n=Promise.resolve(),o=(t,e)=>t?browser.i18n.getMessage(t,e):"",c=(t,...e)=>o(t,e.map((t=>String(t))));new Map},4067:(t,e,r)=>{"use strict";r.d(e,{W:()=>s});const s=(t,e)=>`background-color: ${e};\n-webkit-mask: url('${t}') center center / contain no-repeat;\nmask: url('${t}') center center / contain no-repeat;`},7371:(t,e,r)=>{"use strict";r.d(e,{v:()=>i,O:()=>n});var s=r(4681);function a(){return new Worker(r.p+"lzma_high_compressor.worker.worker.js")}r(611),r(1055);async function i(t,e=9){return(0,s.c)(a,{type:"compress",mode:e,data:t})}async function n(t){return(0,s.c)(a,{type:"decompress",byteArray:t})}},2460:(t,e,r)=>{"use strict";r.d(e,{FK:()=>a,RM:()=>s});const s=t=>{let e=0;for(let r=0;r<t.length;r++)e+=t[r];return e},a=t=>Math.floor(100*t)/100},9100:(t,e,r)=>{"use strict";r.d(e,{n:()=>s});const s=(t,e,r)=>Math.max(t,Math.min(e,r||0))},7526:(t,e,r)=>{"use strict";r.d(e,{V:()=>s});const s=(()=>{let t=0;return()=>++t})()},4214:(t,e,r)=>{"use strict";function s(t,e,r,s,a){for(let i=0;i<r.length;i++){const n=r[i];s&&t.hasOwnProperty(n)||a&&!e.hasOwnProperty(n)||(t[n]=e[n])}return t}function a(t,e){const r={};if(!t)return r;for(let s=0;s<t.length;s++){const a=t[s];r[a[e]]=a}return r}r.d(e,{W:()=>a,X:()=>s})},1470:(t,e,r)=>{"use strict";function s(t,e){return function(t){const e=Object.getOwnPropertyNames(t);for(let r=0;r<e.length;r++)delete t[e[r]]}(t),Object.assign(t,e)}r.d(e,{FP:()=>i,PT:()=>s,oD:()=>a});const a=t=>Object.fromEntries(Object.entries(t).map((([t,e])=>[t,String(e)]))),i=(t,e)=>Object.keys(t).reduce(((r,s)=>(r[s]=t[s]-e[s],r)),{})},6382:(t,e,r)=>{"use strict";r.d(e,{c:()=>s});class s{subscribers=[];addOnChange(t){this.subscribers.push(t)}removeOnChange(t){this.subscribers=this.subscribers.filter((e=>e!==t))}hasOnChange(t){return this.subscribers.includes(t)}notifyChange(t){this.subscribers.forEach((e=>{try{e(t)}catch(t){}}))}}},9944:(t,e,r)=>{"use strict";r.d(e,{s:()=>s,y:()=>a});const s=t=>"fulfilled"===t.status,a=t=>t instanceof Promise},1282:(t,e,r)=>{"use strict";r.d(e,{tX:()=>s});const s=(t,e)=>new Set([...t].filter((t=>!e.has(t))))},5360:(t,e,r)=>{"use strict";function s(t,{arraySeparator:e="ô"}={}){const r=new Map;return s=>{const a=Array.isArray(s)?s.join(e):s;if(r.hasOwnProperty(a))return r.get(a);{const e=t(s);return r.set(a,e),e}}}r.d(e,{M:()=>s})},2447:(t,e,r)=>{"use strict";r.d(e,{e:()=>s});class s{key;getDefaultValue;storageArea;constructor(t,e,r="localStorage"){this.key=t,this.getDefaultValue=e,this.storageArea=r}set(t){try{self[this.storageArea].setItem(this.key,JSON.stringify(t))}catch(t){}return t}reset(){this.set(this.getDefaultValue())}remove(){try{self[this.storageArea].removeItem(this.key)}catch(t){}}get(){try{return JSON.parse(self[this.storageArea].getItem(this.key)||"")}catch(t){return this.getDefaultValue()}}}},2441:(t,e,r)=>{"use strict";r.d(e,{_:()=>s});class s extends Map{get(t){return super.get(t)||[]}has(t){return this.get(t).length>0}push(t,e){const r=this.get(t);return r.push(e),super.set(t,r)}remove(t,e){const r=this.get(t),s=r.findIndex(e);return s>=0?(r.splice(s,1),0===r.length&&super.delete(t),1):0}}},910:(t,e,r)=>{"use strict";r.d(e,{F:()=>p});var s=r(4323),a=r(8815),i=r(2801),n=r(9574),o=r(9944),c=r(6062),u=r(4648),l=r(170),d=r(959);class h{key;options;_listeners;_listenForChangesFn;storageArea;constructor(t,e={storageArea:"local"}){this.key=t,this.options=e,this._listeners=Array(),this._listenForChangesFn=(0,n.m)((()=>{d.E[this.storageArea]&&browser.storage[this.storageArea].onChanged.addListener((t=>{t[this.key]&&this._listeners.forEach((e=>e(t[this.key])))}))})),this.storageArea=e.storageArea}async addOnChangeListener(t,{dummyInitValue:e}={}){if(this._listeners.push(t),(0,l.Q)(),this._listenForChangesFn(),e){const r=(0,o.y)(e)?await e:e;t({newValue:r,oldValue:r})}}}class p extends h{key;getDefaultValue;options;_updateExecutor;_setExecutor;get legacyStore(){return"localStorage"===this.storageArea?self.localStorage:self.sessionStorage}constructor(t,e,r={storageArea:"local"}){super(t,r),this.key=t,this.getDefaultValue=e,this.options=r,this._updateExecutor=new i.V,this._setExecutor=new i.V}async reset(){return this.set(await this.getDefaultValue())}async orDefault(t){return t.hasOwnProperty(this.key)?t[this.key]:await this.getDefaultValue()}async get(){const t="custom"===this.storageArea?await this.options.customDataSource.get()||await this.getDefaultValue():"remote"===this.storageArea?await(await fetch(this.options.remoteApi.url,await this.getRequestInit())).json()||await this.getDefaultValue():"localStorage"===this.storageArea||"sessionStorage"===this.storageArea?this.options.localStorageTextOnly?(0,a.g)((()=>this.legacyStore.getItem(this.key)),(()=>""))||await this.getDefaultValue():await(0,a.g)((()=>JSON.parse(this.legacyStore.getItem(this.key)||"")),(()=>this.getDefaultValue())):await browser.storage[this.storageArea].get(this.key).then((t=>this.orDefault(t)));return this.options.onBeforeLoad?await this.options.onBeforeLoad(t):t}async remove(){return"custom"===this.storageArea?await this.options.customDataSource.remove():"remote"===this.storageArea?(await fetch(this.options.remoteApi.url,await this.getRequestInit("DELETE"))).json():"localStorage"===this.storageArea||"sessionStorage"===this.storageArea?(0,a.g)((()=>this.legacyStore.removeItem(this.key))):browser.storage[this.storageArea].remove(this.key)}async update(t){return this._updateExecutor.addWork((()=>this.get().then(t).then((t=>this.set(t)))))}async set(t){return this._setExecutor.addWork((async()=>{t=this.options.onBeforeSave?await this.options.onBeforeSave(t):t;const e=await("custom"===this.storageArea?await this.options.customDataSource.set(t):"remote"===this.storageArea?void await fetch(this.options.remoteApi.url,await this.getRequestInit("POST",JSON.stringify(t))):"localStorage"===this.storageArea||"sessionStorage"===this.storageArea?(0,a.g)((()=>this.legacyStore.setItem(this.key,this.options.localStorageTextOnly?String(t):JSON.stringify(t)))):browser.storage[this.storageArea].set({[this.key]:t}));return"session"===this.storageArea&&await(0,s.BK)(1),e}))}async setWith(t,e){return"remote"===this.storageArea||"custom"===this.storageArea||"localStorage"===this.storageArea||"sessionStorage"===this.storageArea?(0,s.qb)("missing"):browser.storage[this.storageArea].set(Object.assign({[this.key]:t},e))}async getWith(...t){const e=t.map((t=>(0,s.Kg)(t)?t:t.key)),r="remote"===this.storageArea||"custom"===this.storageArea||"localStorage"===this.storageArea||"sessionStorage"===this.storageArea?(0,s.qb)("missing"):await browser.storage[this.storageArea].get([this.key,...e]),a=await this.orDefault(r),i=t.map((async t=>(0,s.Kg)(t)?r[t]:await t.orDefault(r)));return[a,...await Promise.all(i)]}async getRequestInit(t="GET",e){const r=await(0,s.oA)(this.options.remoteApi.GET_Headers),a=await(this.options.remoteApi.authToken?.());return{method:t,body:e,...r,...a?{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json",...r?.headers}}:{}}}}(0,u.J)()?browser.storage.session={get:t=>browser.runtime.sendMessage({type:"_session_store_get",key:t}),set:t=>browser.runtime.sendMessage({type:"_session_store_set",items:t}),remove:t=>browser.runtime.sendMessage({type:"_session_store_remove",key:t}),clear:()=>Promise.resolve(),onChanged:{addListener:()=>({removeListener:()=>{}}),removeListener:()=>({removeListener:()=>{}}),hasListener:()=>!1}}:c.Dy&&browser.runtime.onMessage.addListener((t=>{switch(t.type){case"_session_store_get":return browser.storage.session.get(t.key);case"_session_store_set":return browser.storage.session.set(t.items);case"_session_store_remove":return browser.storage.session.remove(t.key)}}))},7548:(t,e,r)=>{"use strict";r.d(e,{Q:()=>i});var s=r(1470),a=r(959);async function i(t,e){const r=t.storageArea;a.E[r]&&browser.storage[r].onChanged.addListener((r=>{r[t.key]&&(0,s.PT)(e,r[t.key].newValue||{})}));const i=await t.get();if(!i)return await t.set(e),e;return Object.entries(e).filter((([t])=>!i.hasOwnProperty(t))).map((([t,e])=>i[t]=e)).length>0&&await t.set(i),(0,s.PT)(e,i||{})}},8408:(t,e,r)=>{"use strict";r.d(e,{K:()=>c});var s=r(2352),a=r(6062),i=r(4323),n=r(1374),o=r(4069);async function c(t,e={}){const r=(0,n.BO)(t),{cookieStoreId:c,inNewTab:l=!1,nextToCurrent:d=!1,active:h=!1,inNewWindow:p=!1,windowId:m,windowOptions:f={},forceIncognitoWindow:w=!1,stopOpenerTabId:g,_directCall:_}=e,y=p||w;if(!a.Dy&&!_)return function(t,e){if(e._directCall)throw Error("infinite loop???");return e._directCall=!0,browser.runtime.sendMessage(new u(t,e))}(r,e);const v=c,b=v?{cookieStoreId:c}:{},[D,...I]=r,E=await A(D,0,m);return I.forEach(((t,e)=>A(t,e+1,E.windowId))),E;async function A(t,e,r){const a=v&&!l&&!y&&0===e;if(y)return browser.windows.create({url:t,...f,...b,...w?{incognito:!0}:{}}).then((t=>t?.tabs[0]));if(l||a||e>0){const n=h&&0===e,c=await(0,s.e6)()||{id:void 0,index:void 0},u=(0,i.f3)(c.index)?c.index+1:void 0,l=o.m0||!!g,p=e=>browser.tabs.create({url:t,...b,windowId:r,active:n,...d?{index:u}:{},...e?{}:{openerTabId:c.id}}),m=l?await p(l):await p(l).catch((()=>p(!0)));return a&&c.id&&browser.tabs.remove(c.id),m}return await browser.tabs.update({url:t})}}class u{links;options;type;constructor(t,e){this.links=t,this.options=e,this.type="openURL"}}a.Dy&&browser.runtime.onMessage.addListener((t=>{if("openURL"===t.type)return c(t.links,t.options)}))},2352:(t,e,r)=>{"use strict";r.d(e,{HG:()=>i,e6:()=>a});var s=r(4069);async function a(){const[t]=await browser.tabs.query(s.m0?{active:!0}:{active:!0,lastFocusedWindow:!0});return t}const i=()=>browser.tabs.getCurrent().then((t=>t?.id?browser.tabs.remove(t.id):void 0))},3672:(t,e,r)=>{"use strict";function s(t,e,r,s){let a=0,i=0,n=t.length;return e&&(a=(i=t.indexOf(e))+e.length),r&&(n=t.indexOf(r,a)),n<0&&s&&(n=t.length),n<0||i<0?"":t.substring(a,n)}r.d(e,{u:()=>s})},8168:(t,e,r)=>{"use strict";r.d(e,{BB:()=>s});const s=t=>t.charAt(0).toUpperCase()+t.substring(1)},8671:(t,e,r)=>{"use strict"},4716:(t,e,r)=>{"use strict";r.d(e,{e:()=>a,w:()=>s});class s{name;options;startTime;stopTime;logger;performance;constructor(t,e={}){this.name=t,this.options=e,this.startTime=0,this.stopTime=0,this.logger=this.options.logger||console,this.performance=this.options.performance||self.performance,this.options=Object.assign({startNow:!0,round:!0,logTimeAbove:0},e),this.options.startNow&&this.start()}start(){this.startTime=this.performance.now()}stop(t=""){if(!this.options.enableInProd)return;this.stopTime=this.performance.now();const e=this.stopTime-this.startTime;if(e<this.options.logTimeAbove)return;const r=`${this.name} ${t} time: ${(this.options.round?Math.round(e):e).toLocaleString("en-US")}`;return this.logger.log(r),r}diff(t=""){const e=this.startTime;this.stopTime&&(this.startTime=this.stopTime);const r=this.stop(t);return this.startTime=e,r}}async function a(t,e,r){const a=new s(t,r),i=await e();return a.stop(),i}},5076:(t,e,r)=>{"use strict";function s(t,e){if(null!=t)return e(t)}r.d(e,{J:()=>s})},3456:(t,e,r)=>{"use strict";r.d(e,{k:()=>a});var s=r(1374);class a{_listeners=[];constructor(){}register(t){this._listeners.push(t)}unregister(t){(0,s.E6)(this._listeners,t)}notifyAll(t){this._listeners.forEach((e=>e(t)))}}},8815:(t,e,r)=>{"use strict";function s(t,e){try{return t()}catch(t){return e?.(t)}}async function a(t,e){try{return await t()}catch(t){return e(t)}}r.d(e,{E:()=>a,g:()=>s})},6672:(t,e,r)=>{"use strict";r.d(e,{K9:()=>o,QV:()=>a,bZ:()=>n,lX:()=>i});var s=r(8168);const a=(t="")=>(0,s.BB)(t.trim().replace(/.*:\/\/(www\.)?|^www\./,"").replace(/\/$/,""));function i(t,e=!1){try{const r=new URL(t).hostname;return e&&r.startsWith("www.")?r.substring(4):r}catch(t){return""}}function n(t){try{return new URL(t).origin}catch(t){return""}}function o(t){return/^https?:\/\/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/.test(t)}},4323:(t,e,r)=>{"use strict";r.d(e,{BK:()=>I,Et:()=>w,Gv:()=>h,Kg:()=>d,Lm:()=>p,Lt:()=>c,Mj:()=>E,SJ:()=>l,Tn:()=>m,WR:()=>D,XB:()=>b,bJ:()=>a,f3:()=>g,g7:()=>v,lQ:()=>s,oA:()=>_,qS:()=>f,qb:()=>u,s6:()=>n,t1:()=>o,x2:()=>i,zz:()=>y});const s=(...t)=>{},a=(...t)=>!1,i=(...t)=>!0,n=(...t)=>{},o=t=>(...e)=>!t(...e),c=t=>async(...e)=>!await t(...e),u=t=>{throw Error(t)},l=()=>u("not implemented"),d=t=>"string"==typeof t,h=t=>null!==t&&"object"==typeof t,p=t=>"boolean"==typeof t,m=t=>"function"==typeof t,f=t=>"number"==typeof t,w=t=>(t=>!isNaN(t-parseFloat(t)))(t),g=t=>Number.isFinite(t),_=t=>m(t)?t():t,y=t=>!!t,v=t=>t(),b=(t,e=[])=>{let r;for(;r=t.pop();)r.apply(null,e)},D=t=>JSON.parse(JSON.stringify(t)),I=t=>new Promise((e=>setTimeout(e,t)));function E(){let t,e;return[new Promise(((r,s)=>{t=r,e=s})),t,e]}},4681:(t,e,r)=>{"use strict";function s(t,e){const r=t();return new Promise(((t,s)=>{r.postMessage(e),r.onmessageerror=s,r.onerror=s,r.onmessage=e=>t(e.data)})).finally((()=>r.terminate()))}r.d(e,{c:()=>s})},1055:(t,e,r)=>{"use strict";r.d(e,{x:()=>s});const s="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope},1550:(t,e,r)=>{"use strict";var s;r.d(e,{Co:()=>i,Rl:()=>a,Uy:()=>s}),(t=>{t[t.light=0]="light",t[t.dark=1]="dark",t[t.system=2]="system"})(s||(s={}));const a=t=>t?1:0,i="(prefers-color-scheme: dark)"}},s={};function a(t){var e=s[t];if(void 0!==e)return e.exports;var i=s[t]={exports:{}};return r[t].call(i.exports,i,i.exports,a),i.exports}a.m=r,a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},a.f={},a.e=t=>Promise.all(Object.keys(a.f).reduce(((e,r)=>(a.f[r](t,e),e)),[])),a.u=t=>(({353:"unlock_vault_module",702:"vuetify_module",900:"storage_sync_backup_module"}[t]||t)+".js"),a.miniCssF=t=>(({353:"unlock_vault_module",702:"vuetify_module"}[t]||t)+".css"),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="group_speed_dial:",a.l=(r,s,i,n)=>{if(t[r])t[r].push(s);else{var o,c;if(void 0!==i)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var d=u[l];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==e+i){o=d;break}}o||(c=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,a.nc&&o.setAttribute("nonce",a.nc),o.setAttribute("data-webpack",e+i),o.src=r),t[r]=[s];var h=(e,s)=>{o.onerror=o.onload=null,clearTimeout(p);var a=t[r];if(delete t[r],o.parentNode&&o.parentNode.removeChild(o),a&&a.forEach((t=>t(s))),e)return e(s)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=h.bind(null,o.onerror),o.onload=h.bind(null,o.onload),c&&document.head.appendChild(o)}},a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.p="/",(()=>{if("undefined"!=typeof document){var t=t=>new Promise(((e,r)=>{var s=a.miniCssF(t),i=a.p+s;if(((t,e)=>{for(var r=document.getElementsByTagName("link"),s=0;s<r.length;s++){var a=(n=r[s]).getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(a===t||a===e))return n}var i=document.getElementsByTagName("style");for(s=0;s<i.length;s++){var n;if((a=(n=i[s]).getAttribute("data-href"))===t||a===e)return n}})(s,i))return e();((t,e,r,s,i)=>{var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",a.nc&&(n.nonce=a.nc),n.onerror=n.onload=r=>{if(n.onerror=n.onload=null,"load"===r.type)s();else{var a=r&&r.type,o=r&&r.target&&r.target.href||e,c=new Error("Loading CSS chunk "+t+" failed.\n("+a+": "+o+")");c.name="ChunkLoadError",c.code="CSS_CHUNK_LOAD_FAILED",c.type=a,c.request=o,n.parentNode&&n.parentNode.removeChild(n),i(c)}},n.href=e,r?r.parentNode.insertBefore(n,r.nextSibling):document.head.appendChild(n)})(t,i,null,e,r)})),e={48:0,900:0,611:0};a.f.miniCss=(r,s)=>{e[r]?s.push(e[r]):0!==e[r]&&{353:1,525:1,702:1}[r]&&s.push(e[r]=t(r).then((()=>{e[r]=0}),(t=>{throw delete e[r],t})))}}})(),(()=>{var t={48:0,900:0,611:0};a.f.j=(e,r)=>{var s=a.o(t,e)?t[e]:void 0;if(0!==s)if(s)r.push(s[2]);else{var i=new Promise(((r,a)=>s=t[e]=[r,a]));r.push(s[2]=i);var n=a.p+a.u(e),o=new Error;a.l(n,(r=>{if(a.o(t,e)&&(0!==(s=t[e])&&(t[e]=void 0),s)){var i=r&&("load"===r.type?"missing":r.type),n=r&&r.target&&r.target.src;o.message="Loading chunk "+e+" failed.\n("+i+": "+n+")",o.name="ChunkLoadError",o.type=i,o.request=n,s[1](o)}}),"chunk-"+e,e)}};var e=(e,r)=>{var s,i,[n,o,c]=r,u=0;if(n.some((e=>0!==t[e]))){for(s in o)a.o(o,s)&&(a.m[s]=o[s]);if(c)c(a)}for(e&&e(r);u<n.length;u++)i=n[u],a.o(t,i)&&t[i]&&t[i][0](),t[i]=0},r=globalThis.webpackChunkgroup_speed_dial=globalThis.webpackChunkgroup_speed_dial||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})(),(()=>{"use strict";var t=a(4323),e=a(4648),r=a(7302),s=a(1055),i=a(6382);const n=()=>[];const o=void 0;class c extends i.c{storageArea;onChanged;constructor(t){super(),this.storageArea=t,this.onChanged=new BroadcastChannel(`web_ext_storage.${this.storageArea}.onChanged`),this.onChanged.onmessage=t=>{const e=t.data;this.notifyChange(e)},this.onChanged.onmessageerror=console.error}async notifyAllContexts(t){this.notifyChange(t),await o,this.onChanged.postMessage(t)}async withDb(t){const e=self.indexedDB.open(`web_ext_storage.${this.storageArea}`,1);return new Promise(((t,r)=>{e.onerror=()=>r(e.error),e.onsuccess=()=>t(e.result),e.onupgradeneeded=()=>{const t=e.result;t.objectStoreNames.contains("data")||t.createObjectStore("data",{keyPath:"key"})}})).then(t).finally((()=>e.result.close()))}async getMultipleItems(e,r){const s=r.map((t=>new Promise(((r,s)=>{const a=e.get(t);a.onerror=()=>s(a.error),a.onsuccess=()=>r(a.result)}))));return Object.fromEntries((await Promise.all(s)).filter(t.zz).map((t=>[t.key,t.value])))}async get(t){return this.withDb((async e=>{const r=e.transaction("data","readonly").objectStore("data");if(Array.isArray(t))return this.getMultipleItems(r,t);const s=r.getAll(t);return new Promise(((t,e)=>{s.onerror=()=>e(s.error),s.onsuccess=()=>t(s.result.reduce(((t,{key:e,value:r})=>(t[e]=r,t)),{}))}))}))}async set(t){return this.withDb((async e=>{const r=e.transaction("data","readwrite"),s=r.objectStore("data"),a=await this.getMultipleItems(s,Object.keys(t)),i={};for(const[e,r]of Object.entries(t))s.put({key:e,value:r}),i[e]={oldValue:a[e],newValue:r};return new Promise(((t,e)=>{r.onerror=()=>e(r.error),r.oncomplete=()=>{this.notifyAllContexts(i),t()}}))}))}async remove(t){return this.withDb((async e=>{const r=e.transaction("data","readwrite"),s=r.objectStore("data");t=Array.isArray(t)?t:[t];const a=await this.getMultipleItems(s,t);for(const e of t)s.delete(e);return new Promise(((e,s)=>{r.onerror=()=>s(r.error),r.oncomplete=()=>{const r={};for(const e of t)r[e]={oldValue:a[e]};this.notifyAllContexts(r),e()}}))}))}async clear(){return this.withDb((async t=>{const e=t.transaction("data","readwrite");return e.objectStore("data").clear(),new Promise(((t,r)=>{e.onerror=()=>r(e.error),e.oncomplete=()=>t()}))}))}async getBytesInUse(){return this.withDb((async t=>{const e=t.transaction("data","readonly").objectStore("data").getAll();return new Promise(((t,r)=>{e.onerror=()=>r(e.error),e.onsuccess=()=>{const r=e.result.reduce(((t,{key:e,value:r})=>t+e.length+JSON.stringify(r).length),0);t(r)}}))}))}static getBrowserPolyfill(t){const e=new c(t);return"session"===t&&s.x&&self.addEventListener("activate",(()=>e.clear())),{get:e.get.bind(e),set:e.set.bind(e),remove:e.remove.bind(e),clear:e.clear.bind(e),getBytesInUse:e.getBytesInUse.bind(e),onChanged:{addListener:e.addOnChange.bind(e),removeListener:e.removeOnChange.bind(e),hasListener:e.hasOnChange.bind(e)}}}}var u=a(5076),l=a(9574);class d{_callback;promise;constructor(t){this._callback=t}execute(){return this.promise||(this.promise=this._callback().finally((()=>{this.promise=void 0}))),this.promise}}const h=(t,e,r)=>{let s;const a=r.value,i=new d((async()=>a.apply(s)));r.value=function(){return s=this,i.execute()}},p=(t,e,r)=>{const a=r.value;return r.value=function(...t){if(s.x)return a.apply(this,t)},r};function m(t,e,r,s){var a,i=arguments.length,n=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,r,s);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(n=(i<3?a(n):i>3?a(e,r,n):a(e,r))||n);return i>3&&n&&Object.defineProperty(e,r,n),n}class f extends i.c{broadcast;storage;constructor(){super(),this.broadcast=new BroadcastChannel("web_ext_alarms"),this.storage=c.getBrowserPolyfill("_internal_alarms"),this.infiniteAlarmsCheck()}async clearAll(){return await this.storage.clear(),!0}async clear(t=""){const{[t]:e}=await this.storage.get(t);return!!e&&(await this.storage.remove(t),!0)}async create(t,e){const[r,s]="string"==typeof t?[t,e]:["",t],a=Date.now(),i={name:r,scheduledTime:s.periodInMinutes?this.computeNextRun(s.periodInMinutes):s.when||a+6e4*(s.delayInMinutes||0),periodInMinutes:s.periodInMinutes};i.scheduledTime<a?this.notifyAllContexts(i):await this.storage.set({[r]:i})}async get(t=""){const{[t]:e}=await this.storage.get(t);return e}async getAll(){const t=await this.storage.get();return Object.values(t)}async infiniteAlarmsCheck(){for(;;)await this.checkForDueAlarms(),await(0,t.BK)(12e3)}async checkForDueAlarms(){const t=Date.now(),e=(await this.getAll()).filter((e=>e.scheduledTime<=t));for(const t of e)this.notifyAllContexts(t),t.periodInMinutes?(t.scheduledTime=this.computeNextRun(t.periodInMinutes),await this.storage.set({[t.name]:t})):await this.storage.remove(t.name)}computeNextRun(t){return Date.now()+6e4*t}async notifyAllContexts(t){this.notifyChange(t),await o,this.broadcast.postMessage(t)}static getBrowserPolyfill(){const t=new f;return{get:t.get.bind(t),getAll:t.getAll.bind(t),create:t.create.bind(t),clear:t.clear.bind(t),clearAll:t.clearAll.bind(t),onAlarm:{addListener:t.addOnChange.bind(t),hasListener:t.hasOnChange.bind(t),removeListener:t.removeOnChange.bind(t)}}}}m([p],f.prototype,"infiniteAlarmsCheck",null),m([p,h],f.prototype,"checkForDueAlarms",null);var w=a(8282);(0,e.J)()||(browser.windows||(browser.windows={}),browser.windows.getCurrent||(browser.windows.getCurrent=async t=>{const e=await browser.tabs.query({}),r=e.find((t=>t.active));return{id:r?.windowId??1,title:r?.title??"",focused:!0,alwaysOnTop:!1,incognito:!!browser.extension.inIncognitoContext,...t?.populate?{tabs:e}:{},state:"maximized",type:"normal",height:screen.availHeight,width:screen.availWidth,top:0,left:0}}),browser.windows.getLastFocused||(browser.windows.getLastFocused=async t=>browser.windows.getCurrent(t)),browser.windows.get||(browser.windows.get=async(t,e)=>{const[r]=await browser.tabs.query({windowId:t});return{...await browser.windows.getCurrent(e),id:r?.windowId??1,title:r?.title??"",focused:r?.active}}),browser.windows.getAll||(browser.windows.getAll=async t=>!1!==t?.windowTypes?.includes("normal")?[await browser.windows.getCurrent(t)]:[]),browser.windows.update||(browser.windows.update=async(t,e)=>{if(e.focused||"maximized"===e.state){const[e]=await browser.tabs.query({windowId:t});e&&await browser.tabs.update(e.id,{active:!0})}return browser.windows.getCurrent()}),browser.windows.remove||(browser.windows.remove=async t=>{const[e]=await browser.tabs.query({windowId:t});e&&await browser.tabs.remove(e.id)}),browser.windows.create||(browser.windows.create=async t=>{const e=t?.url?Array.isArray(t.url)?t.url:[t.url]:[w.pf];for(const r of e)await browser.tabs.create({url:r,active:t?.focused});const r=await browser.windows.getCurrent({populate:!0});return r.tabs=r.tabs.filter((t=>t.windowId===r.id)),r}));var g=a(2036),_=a(2221),y=a(8408);browser.commands?.onCommand.addListener((async t=>{if("open-dials"===t){if(await _.j_,_.lw.KEY_DISABLE_F4)return;(0,y.K)(g.KL,{active:!0,inNewTab:!_.lw.KEY_F4_ACTIVE_HERE,nextToCurrent:_.lw.KEY_NEXT_TO_CURRENT})}}));var v=a(1962);var b=a(1374),D=a(4352);async function I(e,{timeout:r=0,checkCurrentState:s=!0}={}){return new Promise((async(a,i)=>{const n=()=>browser.tabs.onUpdated.removeListener(o);if(r&&setTimeout((()=>{n(),i(Error("timeout"))}),r),browser.tabs.onUpdated.addListener(o),s){await(0,t.BK)(42);const r=await browser.tabs.get(e);"complete"===r.status&&r.url!==w.pf&&(n(),a(r))}function o(t,{status:r},s){t===e&&"complete"===r&&s&&s.url!==w.pf&&(n(),a(s))}}))}var E=a(8794),A=a(9676),S=a(9180);async function P(e,r,{timeout:s=(0,S.n)(10)}={}){return(await Promise.all((await browser.webNavigation.getAllFrames({tabId:r})).map((t=>(0,A.w)(s,void 0,(()=>browser.scripting.executeScript({target:{tabId:r,frameIds:[t.frameId]},func:()=>window.name}).then((([t])=>t.result)).catch((()=>"")).then((r=>r===e?t.frameId:void 0)))))))).find(t.qS)}function O(e,r,{maximumDelay:s=0}={}){let a=-1,i=-1,n=t.lQ;function o(){a>0&&self.clearTimeout(a),s&&i>0&&self.clearTimeout(i),a=i=-1,n=t.lQ}return c.flush=()=>n(),c.cancel=()=>(-1!==a||-1!==i)&&(o(),!0),c;function c(t=r,c=e){if(self.clearTimeout(a),a=-1,!1===c)return;const u=n=()=>{o(),t()};a=self.setTimeout(u,c),s&&i<0&&(i=self.setTimeout(u,s))}}async function T(t){try{await(browser.tabs.warmup?.(t))}catch(t){}}function k(e,{frameId:r,frameName:s,timeWithoutTraffic:a=(0,S.n)(1),timeout:i=(0,S.n)(10)}={}){return new Promise((async n=>{await T(e);const o=r??(s?await P(s,e):null),c=setTimeout((()=>p("timeout")),i),u=new Set,l=O(a,(()=>{p(`request idle, size: ${u.size}`)}));function d(e){(0,t.qS)(o)&&o!==e.frameId||u.add(e.requestId)}function h(e){(0,t.qS)(o)&&o!==e.frameId||(u.delete(e.requestId),l())}function p(t){self.clearTimeout(c),browser.webRequest.onBeforeRequest.removeListener(d),browser.webRequest.onCompleted.removeListener(h),n()}l(),browser.webRequest.onBeforeRequest.addListener(d,{tabId:e,urls:[w.P4]}),browser.webRequest.onCompleted.addListener(h,{tabId:e,urls:[w.P4]})}))}var R=a(6801),B=a(5524);function L(e,r,s={}){return(0,A.w)(2e3,(()=>(0,B.vV)(`hideScrollbars timeout: ${e}, ${r}`)),(()=>async function(e,r,{frameId:s,frameName:a,scaleDown:i}={}){const o=((0,t.Et)(s)?s:a?await P(a,e):void 0)||0;{const r=o?[o]:(await browser.webNavigation.getAllFrames({tabId:e}).catch((()=>[{frameId:0}]))).map((t=>t.frameId));await Promise.all(r.map((r=>browser.scripting.executeScript({injectImmediately:!0,target:{tabId:e,frameIds:[r]},files:[...n(),"/content_scripts/cs_prepare_shooting.js"]}).catch(t.lQ))))}i&&await(0,R.hC)(e,{type:"cs_scale_down",scaleDown:i},{frameId:s}).catch(t.lQ)}(e,0,s)))}var C=a(6795),M=a(5772);async function x(){const e=(await browser.windows.getAll({populate:!0,windowTypes:["normal"]})).flatMap((t=>t.tabs.filter((t=>!t.discarded&&t.url.startsWith("http"))).slice(-2))),r=(await Promise.all(e.map((t=>N(t.id))))).filter(t.zz).sort((0,M.s)(1,!1)),{availWidth:s,availHeight:a}=r[0]||{};return s&&a?{width:s,height:a}:await(0,R._z)({type:"getScreenInfo"}).then((t=>({width:t?.availWidth||1920,height:t?.availHeight||1080})))}function N(e){return(0,A.w)(900,void 0,(async()=>await browser.scripting.executeScript({target:{tabId:e,allFrames:!1},func:()=>({innerWidth:window.innerWidth,innerHeight:window.innerHeight,availWidth:window.screen.availWidth,availHeight:window.screen.availHeight,outerWidth:window.outerWidth,outerHeight:window.outerHeight,pixelRatio:window.devicePixelRatio})}).then((([t])=>t.result)).catch(t.s6)))}var U=a(6683),G=a(1484),F=a(6062),z=a(4069),H=a(5904),W=a(8289);"ontouchstart"in self||navigator.maxTouchPoints;const $=!1,V=(0,r.Z)("reload/reload.html"),K=(()=>{try{return!s.x&&window.self!==window.top}catch(t){return!0}})()&&g.Dg;const j=180,Y=76;async function q(t,e,r,s,a){a||={devicePixelRatio:await E.T6.get()};const[i,n]=_.lw.AR_SCREEN_RESOLUTION===U.d0.CUSTOM?[_.lw.AR_SCREEN_WIDTH||1280,_.lw.AR_SCREEN_HEIGHT||720]:await async function(){const t=F.Dy?await x():await(0,R._z)({type:"findBiggestScreenSize"}).catch((()=>({width:window.screen.availWidth,height:window.screen.availHeight}))),{width:e,height:r}=t||{width:1920,height:1080},s=e/r,a=K||_.lw.HIDE_TOP_BAR?0:_.lw.GROUPS_HEIGHT,i=r-Y-a;return s>2.7?[e,2*i]:[e,i]}(),o=function(t,e,{devicePixelRatio:r},s,a,i){const n=s/a,o=_.lw.NO_TITLE||e.visual?.noTitle?0:1.5*_.lw.DIAL_FONT_SIZE,c=2*function(t){const e=t?.DIAL_PADDING??_.lw.DIAL_PADDING;return K&&z.m0?Math.max(32,5*e):$?e/2:e}(t.options),u=c+o;let l=r*(s/t.cols-c),d=r*(a/t.rows-u);if(t.ratio){const[e,r,s]=t.ratio,a=e/r;e*t.cols/(r*t.rows)>n||s?d=l/a-o-1.5*(e-r):l=d*a}else if(t.grid){const i=new H.x(t.grid.areas),{width:h,height:p}=i.getCoordinates(e.created)||{width:2,height:2};if(l=r*(s*(h/i.width)-c),d=r*(a*(p/i.height)-u),t.grid.position!==C.Cr.fillSpace){i.width/i.height>n||t.grid.position===C.Cr.scroll?d=p*l/h-o:l=h*d/p}}else if(t.dynamic){const{width:e,height:r}=t.dynamic;l=e,d=r-o}else if(t.list)return{width:t.list.width,height:.8*t.list.width};const[h,p]=(0,G.M)(e.size||U.ZU.NORMAL);return{width:l*i/h,height:d*i/p}}(t,e,a,i,n,s);let c=e.thumbnail&&e.thumbnail.position!==U.X.FULL_WIDTH||(0,W.Z)(e.url)||!t.isFlexibleLayout()?0:j;return r&&z.m0&&o.height>o.width&&(o.height=o.width,c=0),{...o,extraHeight:o.height+c}}var Z=a(2542),X=a(2801),J=a(910);new J.F("reloading_monitor",(()=>[]));async function Q({name:e="",callback:r,retryCount:s,initialDelay:a=0,repeatDelay:i=0,increasingDelay:n=!1}){let o;a&&await(0,t.BK)(a);for(let e=0;e<s;e++){o=r(e);if(await o.then(t.x2,(t=>{})))break;await(0,t.BK)(n?i*e:i)}return o}const tt=t=>Promise.reject(Error(t)),et=t=>e=>(t(e),Promise.reject(e)),rt=new X.V(1);async function st(e,r={}){return rt.addWork((async()=>F.Dy?async function(e,r){const s=await browser.tabs.get(e);if(s.discarded)throw"tab is discarded";const a=await async function(e,r={}){return await T(e),z.m0&&await browser.tabs.update(e,{active:!0}),F.Dy&&await(0,A.w)(2e3,null,(()=>(0,R.hC)(e,{type:"screenshot_imminent"}).catch(t.lQ))),null}(e,r);a?.id??s.windowId;r.noDelay||await(0,t.BK)(400);return await browser.tabs.captureTab(s.id,{format:"png",rect:r.rect,scale:r.scale}).catch(et((t=>{0}))).catch((0,B.t$)("takeScreenShot ",{...s,favIconUrl:""}))}(e,r):(0,R._z)({type:"capture_tab",tabId:e,options:r})))}const at=Symbol();async function it(t){const e=[];for(let r=0;r<t.length;r++){const s=t[r],a=await s().catch((()=>at));a!==at&&e.push(a)}return e}var nt=a(7526);const ot=new Map,ct={getAllDonePromise:()=>Promise.all(ot.values()).then(t.lQ),clearScreenshots:()=>ot.clear(),async scheduleClean(){const e=[...ot.keys()];await(0,t.BK)((0,S.xF)(4)),e.forEach((t=>ot.delete(t)))},popScreenshotById(t){const e=ot.get(t);return ot.delete(t),e},setScreenshot(t){const e=(0,nt.V)()+1;return ot.set(e,t),e}};var ut=a(235);async function lt(t,{timeout:e=1e4,responseCallback:r}={}){const s=await fetch(t,{signal:(0,ut.n)(e)});r?.(s.clone());const a=s.headers.get("content-type")||"",i="image/";if(s.ok&&a.startsWith(i)){const t=await s.blob();if(t.type.startsWith(i)&&t.size>0)return t;throw Error(`wrong image type/size: ${t.type} / ${t.size}`)}throw Error(`wrong image fetch status/contentType: ${s.status} / ${a}`)}var dt=a(8815),ht=a(6672),pt=a(1434),mt=a(9074);class ft{durationInMS;storageKey;storageArea;store;lastPromise;constructor(t,e,r){this.durationInMS=t,this.storageKey=e,this.storageArea=r,this.store=new J.F(this.storageKey,(()=>({value:null,time:0})),{storageArea:this.storageArea}),this.lastPromise=null}getOrFetch(e){return this.lastPromise?this.lastPromise:this.lastPromise=new Promise((async r=>{const s=await this.store.get(),{value:a,time:i}=(0,t.Gv)(s)?s:await this.store.getDefaultValue(),n=Date.now();if(n-i>this.durationInMS){const t=await e();await this.store.set({value:t,time:n}),r(t)}else r(a)})).finally((()=>this.lastPromise=null))}}const wt=new X.V(2),gt=(async()=>(await new ft((0,S.Lm)(10),"failed_favicons_cache","local").getOrFetch((async()=>{self.caches?.delete("failed_favicons_cache")})),self.caches?.open("failed_favicons_cache")))();async function _t(t,e){const r=await gt;r&&(e.ok?await r.delete(t):await r.put(t,e))}var yt=a(2846),vt=a(1305);const bt=async t=>(await fetch(t)).blob();const Dt=t=>function(t,e){return new Promise(((r,s)=>{const a=new FileReader;a.onload=t=>r(a.result),a.onerror=a.onabort=s,a[e](t)}))}(t,"readAsDataURL");const It=(0,l.m)((async()=>{if(!self.OffscreenCanvas)return!1;const t=new self.OffscreenCanvas(2,2),e=t.getContext("2d");e.fillStyle="rgb(255, 0, 0)",e.fillRect(0,0,1,1);const r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAFElEQVQIW2P8z8Dwn5GBgRGIIQAAHyUCAymYnnsAAAAASUVORK5CYII="===await Dt(await t.convertToBlob({type:"image/png"}));return r}));async function Et(){return await It()}var At=a(4099),St=a(4590),Pt=a(3694),Ot=a(3380),Tt=a(4721),kt=a(5422),Rt=a(9114),Bt=(a(8168),a(9830)),Lt=a(4214);const Ct=["BACKGROUND_DATA"],Mt=Ct.concat("AUTO_OPTIONS_SYNC","AR_DISABLE_THIS_DEVICE","DISABLE_DIALS_SYNC","USER_CONSENT_PUBLIC_UPLOAD"),xt=t=>t?Ct:Mt;async function Nt(e){if(!e?.value)return;const r=(0,t.WR)(e.value);await _.KY.update((t=>((0,Lt.X)(r,t,xt(e.isManual)),r)))}var Ut=a(683),Gt=a(2572);const Ft=new J.F("add_current_processed",(()=>[]),{storageArea:"session"});var zt=a(2665);function Ht(t=""){const e=t.split(".")[1]?.trim()||"";try{const t=JSON.parse(decodeURIComponent(atob(e).replace(/(.)/g,((t,e)=>{let r=e.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r=`0${r}`),`%${r}`})))),r=new Date(1e3*t.iat),s=new Date(1e3*t.exp),a=new Date,i=Math.abs(a.getTime()-r.getTime()),n=Math.abs(a.getTime()-s.getTime());return a<s&&n<i}catch(t){return!1}}var Wt=a(1470);const $t=15e3;async function Vt(t,e,r,s){return(await Kt(t,e,r,s)).json()}async function Kt(t,e,r,s){const a=r instanceof Blob,i=r instanceof FormData;return await fetch(qt(t,e),{method:"POST",signal:(0,ut.n)(s?.timeout||$t),body:a||i?r:r?JSON.stringify(r):void 0,headers:{Authorization:`Bearer ${await(0,zt.c4)()}`,...i?{}:{"Content-Type":a?r.type:"application/json"},Accept:"application/json",...s?.headers}})}async function jt(t,e,r){return await fetch(qt(t,e),{method:"GET",signal:(0,ut.n)(r?.timeout||$t),headers:{Authorization:`Bearer ${await(0,zt.c4)()}`,...r?.headers}})}async function Yt(t,e,r){return(await jt(t,e,r)).json()}function qt(e,r){const s=new URLSearchParams((0,Wt.oD)(r)),a=e.replace(new RegExp(String.raw`:(\w+)`,"g"),(e=>{const r=e.slice(1),a=s.get(r)??(0,t.qb)(`missing parameter: ${r}`);return s.delete(r),a})),i=Array.from(s.keys()).length?`?${s}`:"";return`${mt.Vd}/api/${a}${i}`}const Zt=new class{LOCAL_DATA_VERSION=new J.F("dataVersion",(()=>25));async upgradePerformed(){return!(25===await this.LOCAL_DATA_VERSION.get())&&(await this.LOCAL_DATA_VERSION.set(25),!0)}};var Xt=a(4162),Jt=a(170);browser.runtime.onStartup.addListener((()=>{}));const Qt="_ext_started",te=(async()=>{if(!F.Dy)return!1;const{[Qt]:t}=await browser.storage.session.get(Qt);return!t&&(await browser.storage.session.set({[Qt]:Date.now()}),!0)})(),ee=new Promise((t=>te.then((e=>e&&t()))));class re{name;callback;constructor(t,e){this.name=t,this.callback=e,e&&this.addListener(e)}create(t){browser.alarms.create(this.name,t)}createOnStart(t){ee.then((()=>this.create(t)))}clear(){return browser.alarms.clear(this.name)}addListener(t){(0,Jt.Q)(),browser.alarms.onAlarm.addListener((e=>e.name===this.name&&t(e)))}now(){this.create({when:Date.now()})}}var se=a(9100),ae=a(5229);var ie=a(7880);const ne=3145728,oe=(0,S.xF)(1);class ce{urlHash;ext;version;groupId;constructor(t,e,r,s){this.urlHash=e,this.ext=s,this.version=parseInt(r),this.groupId=parseInt(t)}toString(){return this.groupId+this.urlHash+this.version+this.ext}}const ue=new J.F("last_user_id",(()=>"")),le=new class extends i.c{constructor(){super()}},de=new J.F("failed_requests",(()=>[]),{storageArea:"session"}),he=(()=>{let e=0;E.P3.addOnChangeListener((r=>{r.newValue?.license&&r.newValue._serverCRC!==e&&(0,t.BK)(10).then((()=>E.P3.update((t=>(t.license=0,t)))))})),new re("sync_dials",(()=>o())).createOnStart({periodInMinutes:60});const r=O((0,S.n)(9),o);let s=2,a=!1,i=!1;const n=new ft(oe,"_thumbnailsSyncCoolDownExecutor","local");return{promise:async function(){if(Rt.N)return;0;if(yt.M.addOnChange((({isDirty:t})=>t&&u(9))),await yt.M.promise,await te){const e=await Zt.upgradePerformed();a&&await(0,t.BK)(2e3),await o({replaceLocal:e}),await async function(){if(Ht(await(0,zt.c4)())){const t=await Vt("auth/refresh_token",{});t?.accessToken&&await(0,zt.lV)(t.accessToken)}}()}}(),flushChanges:()=>r.flush(),waitForOnlineStatus:async function(){for(;;)if(await(0,t.BK)(1e3),!a&&2===s)return},publicUpload:async function(t,e){return await vt.i.withDB((async r=>{const s=e.thumbnail||E.fX,a=s.position;if(s.type===U.O8.BLANK)return;const i=s.type===U.O8.URL,n=s.type===U.O8.URL?await lt(s.value):(await r.getDbDial(t,e.url))?.imgBlob;if(!n||n.size>ne)return tt("image not found or too big");const o=(c=e.url,c=(0,ae.I)(c||""),(0,W.Z)(c)?"gl.fastaddons.com":(0,ht.lX)(c,!0));var c;if(!o||o.length>512)return tt(`invalid domain: "${o}"`);const u=encodeURIComponent(e.name.substring(0,128)),l=await Vt("pub_img/:domain/:position/:name",{domain:o,position:a,name:u},n),{result:d,domain:h,hash:p,ext:m}=l;if(!h||!p||!m)return tt("invalid server response");await r.updateDial(t,e.url,(t=>{t.hash=p,i&&(t.imgBlob=n)}),!0,!1),e.thumbnail=Object.assign(e.thumbnail||{},{type:U.O8.PUBLIC,value:[h,p,m],position:a}),await yt.M.action("replaceDial",{groupId:t,dial:e})}))},synchronizeThumbnails:v,synchronize:o};async function o({force:e=!1,forceDownloadPrivate:o=!1,withRedirect:u=!1,replaceLocal:h=!1,replaceRemote:y=!1,withDelay:b=!1,remoteUserId:D="",userClick:I=!1}={}){if(Rt.N)return;await yt.M.promise;const A=await(0,g.wz)();if(!A&&!e||a||i)return;a=!0;const S=await ue.get(),P=A?.id||S||"";try{f("working",(0,St.tr)("sync_working"),(0,St.tr)("sync_syncing")),await(0,t.BK)(b?500:0),await async function(){if(!await browser.permissions.contains({origins:[w.P4]})&&!await browser.permissions.contains({origins:[`${mt.Vd}/*`]}))throw f("no_permission","ERROR: missing permissions",`Sync. cannot work without access to "${mt.Vd}.\nAnd without access to all sites, many other features won't work as well.`),"no_permission"}();const e=await Bt.W.get(),r=await yt.M.isDirty();h||!e||!r&&!y||_.lw.DISABLE_DIALS_SYNC?await async function(t,e,r=!1){const s=await(0,dt.E)((()=>jt("sync_group_dial_3",{userId:t,version:r?0:e||1})),(t=>({status:599,ok:!1,statusText:`network error ${t}`,json:async()=>({})})));if(s.status>=500)return c();if(401===s.status)return await l(u);const a=await s.json();s.ok&&a.user&&await d(a.user);if(_.lw.DISABLE_DIALS_SYNC)return;switch(a.type){case"empty":return O();case"ok":if(e>a.version)return O();p(a.version);break;case"new":const{groups:t,metadata:r,sync:i}=(0,kt.z)(a.data);await yt.M.action("newSyncData",{groups:t,metadata:r,sync:i,version:a.version,replaceExisting:!0},(0,St.tr)("sync_synced_ok")),await async function(t){if(_.lw.AUTO_OPTIONS_SYNC)return Nt(t)}(i.optionsAutoSync),le.notifyChange(),p();break;default:return m(s.statusText,s.status)}await T()}(P,_.lw.DISABLE_DIALS_SYNC?Date.now()+1e10:e,h):await O(y,D),s=2}catch(t){}finally{a=!1}return;async function O(t=!1,e){if(_.lw.DISABLE_DIALS_SYNC)return;r.cancel(),t&&(await Bt.W.set(Date.now()),e&&await E.P3.update((t=>(t||(t={name:"",supporter:0,license:Xt.G_.Home}),t.id=e,t))));const s=await(0,g.wz)(),a=await Bt.W.get(),i=(0,kt.E)({groups:yt.M.GROUPS,sync:yt.M.SYNC,metadata:yt.M.METADATA}),n=await(0,dt.E)((()=>Kt("sync_group_dial_3",{version:a,userId:e||s?.id||""},i)),(t=>({status:599,ok:!1,statusText:`network error ${t}`,json:async()=>({})})));if(n.status>=500)return c();if(401===n.status)return await l(u);const o=await n.json();switch(o.type){case"mismatch":return function(t){f("mismatch",(0,St.tr)("sync_err_user_mismatch_"),(0,St.tr)("sync_err_wrong_account"),{remoteUserId:t})}(o.remoteUserId);case"not_empty":return function(t){f("not_empty",(0,St.tr)("sync_err_not_empty"),(0,St.tr)("sync_err_server_not_empty"),{remoteUserId:t})}(o.remoteUserId);case"conflict":return void f("conflict",(0,St.tr)("sync_err_conflict"),(0,St.tr)("sync_err_server_newer"));case"ok":return await d(o.user),await yt.M.clearDirty(),p(),void await T();default:return 413===n.status&&await _.KY.update((t=>(t.DISABLE_DIALS_SYNC=!0,t))),m(n.statusText,n.status)}}async function T(){I||!_.lw.PRO_THUMBNAIL_SYNC?await v({userClick:I,forceDownloadPrivate:o||h}):await n.getOrFetch((()=>v({forceDownloadPrivate:o||h})))}}function c(){throw s=(0,se.n)(2,600,2*s),32===s&&E.P3.update((t=>(t.license=0,t))),u(s),m("error",0),"network error"}function u(t){const e=(0,se.n)(4,600,t);r(void 0,(0,S.n)(e))}async function l(e){(0,zt.lV)(""),await E.P3.reset(),h(),e&&((0,y.K)(mt.Vd),(0,R._z)({type:"poison_pill_popup"}).catch(t.lQ),h())}async function d(t){var r;r=1e8,e=Math.floor(Math.random()*r),await E.P3.set({...t,_serverCRC:e});const s=await ue.get(),a=t.id;s!==a&&await ue.set(a),s&&s!==a&&async function(t){await Ft.update((e=>(e.push(t),e)))}({type:"changed_account"})}function h(){const{state:t,message:e,details:r}=ie.h;f(t,e,r)}function p(t=Date.now()){f("synced",(0,St.tr)("sync_synced"),(0,St.tr)("sync_sync_ok")+"\n"+(0,Pt.Ib)(t))}function m(t="unknown error",e=0){f("error",(0,St.ZB)("sync_err_label",e||""),t)}function f(t,e,r,s){E.wd.set({state:t,message:e,details:r,data:s||{}})}async function v({userClick:e=!1,forceDownloadPrivate:r=!1}={}){if(i)return;const{id:s}=await(0,g.wz)()||{id:""},a=!s||!_.lw.PRO_THUMBNAIL_SYNC&&!r||!!_.lw.DISABLE_DIALS_SYNC,n=!_.lw.PRO_THUMBNAIL_SYNC&&r,o=await z.Vq||n,c=await de.get();return i=!0,await vt.i.withDB((async function(r){const s=a?[]:await Yt("img/all",{});const i=Array.isArray(s)?s.map((t=>t.split(/[-.]/))).map((([t,e,r,s])=>new ce(t,e,r,s))):[],n=(0,Ot.i8)((0,Ot.$z)(i,(t=>t.groupId)),(t=>t.urlHash)),m=(await it(yt.M.GROUPS.flatMap((t=>(0,b.vC)(t.dials.filter((t=>t.isSingleLinkDial())),"url").map((s=>()=>async function(t,e,r,s,a,i){if(!r.url)return!1;const{thumbnail:n=E.fX,url:o,reload:c}=r,p=await(0,Tt.e)(o),m=s[e]||{},f=(m[p]||[]).sort((0,M.s)("version",!1))[0]||new ce(String(e),p,"0",""),{version:w,ext:g}=f,{type:y,value:v,position:b}=n,D=y||U.O8.AUTO_GENERATED,I=D===U.O8.URL,A=D===U.O8.PUBLIC,S=D===U.O8.BLANK;if(I||S||a&&!A)return!1;const P=await t.getDbDial(e,o),{version:O=0,imgBlob:T,iconBlob:k,hash:R}=P||{},B=!!T,L=O||Date.now(),C=(s,a,...i)=>{const n=()=>(k||fe.updateFavicon(e,o),a(t,e,o,i).then((()=>c))),c={priority:s,groupId:e,dial:r,_name:a.name,execute:n,usedServerImage:[u,d].includes(a)?f:void 0};return c},x=()=>({priority:0,groupId:e,dial:r,usedServerImage:f});if(n.type===U.O8.PUBLIC&&Array.isArray(n.value)){const[t,e,r]=n.value;return e!==R?C(1,h,e,t,r):x()}return B&&!O&&w?C(3,u,w):B&&(!w||O>w&&(!c||i||_.lw.SYNC_AUTO_RELOAD))?C(9,l,L,p,T):!B&&w||O<w?C(2,d,w,p,g):x()}(r,t.id,s,n,a,e).catch((0,B.t$)("computeDialDiff for dial:",s)))))))).filter(t.zz);const w=m.filter((t=>t.execute)).sort((0,M.s)("priority")),g=new Set;let y;try{for(const[t,e]of w.entries())y=e._name,v=t+1,I=w.length,f("working",(0,St.ZB)("sync_thumbnails_progress",v,I),(0,St.tr)("sync_syncing")),await e.execute(),g.add(e.groupId)}catch(t){(0,B.vV)("thumbnails sync",t,y)}finally{(0,D.L)(...g)}var v,I;if(!a&&!o){const e=new Set(m.map((t=>t.usedServerImage?.toString())).filter(t.zz)),r=i.filter((t=>!e.has(t.toString()))).map((({groupId:t,urlHash:e,version:r,ext:s})=>()=>async function(t,e,r,s,a){await async function(t,e){return(await fetch(qt(t,e),{method:"DELETE",signal:(0,ut.n)($t),headers:{Authorization:`Bearer ${await(0,zt.c4)()}`}})).json()}("img/:groupId/:urlHash/:version/:ext",{groupId:e,urlHash:r,version:s,ext:a})}(0,t,e,r,s)));await(0,Ut.f)(r)}c.forEach((t=>{})),p()})).catch((0,B.t$)("sync thumbnails","")).finally((()=>{i=!1,de.set(c)}));async function u(t,e,r,[s]){await t.updateDial(e,r,(t=>{t.version=s,delete t.hash}),!1,!1)}async function l(t,e,r,[s,a,i]){if(o)return;if(i.size>ne)return tt("image > 3MB");const n=new FormData;n.append("file",i);const c=await Kt("img/private",{groupId:e,urlHash:a,version:s},n);if(!c.ok)throw new Error(`[${c.status}] thumbnail upload failed: ${JSON.stringify(await c.json())}`)}async function d(t,e,r,[a,i,n]){if(!s)return;const o=(0,Gt.JR)(s,0,e,i,a,n);if(c.includes(o))return;const u=await lt(o).catch(et((()=>c.push(o))));await m(t,e,r,a,void 0,u)}async function h(t,e,r,[s,a,i]){const n=(0,Gt.Fr)(a,s,i);if(c.includes(n))return;const o=await lt(n).catch(et((()=>c.push(n))));await m(t,e,r,0,s,o)}async function m(t,e,r,s,a,i){await t.updateDial(e,r,(t=>{t.version=s,t.hash=a,i&&(t.imgBlob=i)}),!0,!0)}}})();const pe=((t,e)=>{const r=function(t,{arraySeparator:e="ô"}={}){const r=new Map;return async s=>{const a=Array.isArray(s)?s.join(e):s;if(r.has(a))return r.get(a);{const e=await t(s);return r.set(a,e),e}}}((async r=>O(t,(()=>e(r)))));return async t=>(await r(t))()})(700,(t=>(0,D.L)(t)));class me{constructor(){At.L.register((([t,e])=>{this.updateFavicon(t,e,{onlyIfMissing:!0})})),le.addOnChange((()=>this.updateMissingFavicons()))}async takeScreen(t,e,{dialSize:r,alignLeft:s,screenshotId:a,delay:i,tabToReturnToId:n,dialsEnvironment:o}){if(this.updateFavicon(t,e),a){const i=await ct.popScreenshotById(a);if(!i)throw"screenshot not found";await this.saveThumbnailToDial(t,e,i,{dialSize:r,alignLeft:s,dialsEnvironment:o})}else await this.createThumbnailByVisit(t,e,o,r,i,s,n);pe(t)}async createThumbnailByVisit(e,s,a,i,n,o,c){const u=(0,W.Z)(s),l=(await(0,y.K)(u?(0,r.Z)(`dial.html${s}`):s,{inNewTab:!0,nextToCurrent:!0,active:!0})).id;try{await I(l,{timeout:(0,S.n)(_.lw.MAX_FRAME_RELOAD_TIME)}).catch(t.lQ),await L(l,u),await k(l,{timeout:4e3,timeWithoutTraffic:1e3}),await(0,t.BK)(u?300:n);const r=await st(l),{title:c}=await browser.tabs.get(l);await this.saveThumbnailToDial(e,s,r,{pageTitle:c,dialSize:i,alignLeft:o,dialsEnvironment:a})}catch(t){throw(0,B.vV)("createThumbnailByVisit failed",t),t}finally{c&&(browser.tabs.update(c,{active:!0}),browser.tabs.remove(l))}}async saveThumbnailToDial(e,r,s,{dialSize:a,alignLeft:i,pageTitle:n,dialsEnvironment:o}){const c=await this.screenshotToDialImageBlob(s,e,r,a,{center:!i,dialsEnvironment:o});await vt.i.withDB((t=>t.updateDial(e,r,(t=>{t.imgBlob=c,delete t.hash})))),await yt.M.action("updateDialNameIfNeeded",{groupId:e,url:r,newName:n||""}).catch(t.lQ)}async loadImageToCanvas(t,e,r,s=!1){const a=await async function(t,e){if(await Et())return new self.OffscreenCanvas(t,e);{const r=document.createElementNS("http://www.w3.org/1999/xhtml","html:canvas");return r.width=t,r.height=e,r}}(e,r),i=a.getContext("2d"),n=await async function(t){if(await Et()){const e=await bt(t);return await self.createImageBitmap(e)}return new Promise(((e,r)=>{const s=document.createElement("img");s.addEventListener("error",r),s.addEventListener("load",(()=>{e(s)})),s.src=t}))}(t),o=n.width/n.height,c=e/r,[u,l]=o>c?[Math.ceil(r*o),r]:[e,Math.ceil(e/o)],d=s?0:-u/2+e/2;return i.drawImage(n,d,0,u,l),[i,a]}async screenshotToDialImageBlob(t,e,r,s,{center:a=!1,scale:i=(_.lw.VISIT_JPEG_HIGH_RESOLUTION?2:1),dialsEnvironment:n}={}){const o=yt.M.dialByUrl(e,r),{width:c,height:u}=await q(yt.M.groupById(e),o,!0,i,n),[l,d]=await this.loadImageToCanvas(t,c,u,!a);return await async function(t,e,r){return"convertToBlob"in t?t.convertToBlob({type:e,quality:r}):new Promise(((s,a)=>t.toBlob((t=>t?s(t):a(Error("empty blob!"))),e,r)))}(d,E.fF.type,E.fF.quality)}async updateFavicon(e,s,{onlyIfMissing:a=!1,db:i=null}={}){async function n(i){if(a){const t=(await i.getDbDial(e,s))?.iconBlob;if(t)return}const n=await function(e){return wt.addWork((async()=>{const s=(0,ht.bZ)(e),a=(0,ht.lX)(e,!0);if(!s)return;if(e.includes("google.com/maps")||"maps.google.com"===a)return(await fetch((0,r.Z)("svg/search_providers/google_maps.svg"))).blob();const i=(await(0,dt.E)((async()=>{const t=await fetch(e,{signal:(0,ut.n)((0,S.n)(12))});_t(e,t.clone());const r=await t.text(),[{nodes:s}]=await(0,pt.$)(r,[{query:'\nhead > link[rel=icon],\nhead > link[rel=apple-touch-icon],\nhead > link[rel="shortcut icon"],\nhead > link[rel="alternate icon"]',attributes:["href","sizes"]}]);return s}),(()=>[]))).map((t=>{const e=t.href;return{priority:parseInt(t.sizes||"0")+(e.endsWith(".svg")?1e4:10),url:e.startsWith("/")?s+e:e.startsWith("http")||e.startsWith("data:image/")?e:`${s}/${e}`}})).concat({priority:5,url:`${s}/favicon.ico`}).concat({priority:1,url:`${mt.ff}/fav/?d=${a}`}).concat(_.lw.USER_CONSENT_GOOGLE_FAVICON?{priority:0,url:`https://www.google.com/s2/favicons?sz=64&domain=${a}`}:[]).sort((0,M.s)("priority",!1)).map((t=>t.url));for(const r of new Set(i)){const s=await lt(r,{responseCallback:t=>_t(e,t)}).catch(t.bJ);if(s&&s.size<1e5)return s}}))}(s);n&&await i.updateDial(e,s,(t=>{t.iconBlob=n}),!0,!1)}s.startsWith("http")&&(0,ht.bZ)(s)&&!await async function(t){const e=await gt;return!!e&&e.match(t).then(Boolean)}(s)&&(await(i?n(i):vt.i.withDB(n)),pe(e))}async updateMissingFavicons(){await yt.M.promise,await vt.i.withDB((async e=>{const r=()=>Math.random()-.5,s=yt.M.GROUPS.flatMap((s=>{const a=s.dials.flatMap((t=>t.url?t.url:t.isSearchDial()?(t.providers||[]).filter(Z.Z).map((t=>t.url)):t.isMultiDial()?t.multi?.links.map((t=>t.url)):void 0));return(0,b.jw)(a).filter(t.zz).sort(r).map((t=>()=>this.updateFavicon(s.id,t,{onlyIfMissing:!0,db:e})))}));await it(s.sort(r))}))}}!function(t,e,r,s){var a,i=arguments.length,n=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,r,s);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(n=(i<3?a(n):i>3?a(e,r,n):a(e,r))||n);i>3&&n&&Object.defineProperty(e,r,n)}([h],me.prototype,"updateMissingFavicons",null);const fe=new me,we=!1,ge=(t,e)=>Q({retryCount:1,repeatDelay:1e3,callback:r=>t().catch((0,B.t$)(`tabOperation failed: ${e}`,r))});const _e=new class{intervalMinutes;_callbacks;_lastWakeDetectedTime;constructor(e){this.intervalMinutes=e,this._callbacks=[],this._lastWakeDetectedTime=0;const r=(0,S.xF)(this.intervalMinutes);let s=Date.now();new re("_wake_up_detector",(()=>{const e=Date.now();e-s>r+(0,S.xF)(2)&&(this._lastWakeDetectedTime=e,this._callbacks.forEach(t.g7)),s=e})).createOnStart({periodInMinutes:e})}addListener(t){this._callbacks.push(t)}wasSleepDetectedIn(t){const e=Date.now()-this._lastWakeDetectedTime<(0,S.n)(t);return e}}(30);async function ye(){const t=(await browser.windows.getAll({windowTypes:["normal"],populate:!1})).filter((t=>!t.incognito&&t.id&&!0)).sort((0,M.s)("width",!1));return t.find((t=>t.focused))}const ve=(0,t.Tn)(browser.tabs?.hide);var be=a(7384),De=a(3635);const Ie=new X.V(1);async function Ee(){return Ie.addWork((async()=>{const e=await async function(){const t=await browser.tabs.query({}),e=await Promise.all(t.filter((t=>t.url.startsWith(V))).map((t=>async function(t){if(t.discarded)return{error:"discarded",tab:t};return(0,A.w)(3e3,(()=>Promise.reject({tab:t,error:"timeout"})),(()=>(0,R.hC)(t.id,{type:"reload_get_running_count"}).then((()=>({tab:t}))).catch((e=>({tab:t,error:`error: ${e?.name}, ${e?.message}`})))))}(t)))),[r,s]=(0,Ot.Zg)(e,(t=>!t.error));return s.forEach((t=>{(0,B.cO)(`reloading tab issue: ${t.error||"more than one reloading tab!"}`),browser.tabs.remove(t.tab.id)})),r?.tab}();return e||async function(){const e=await(0,De.Q)(ye,{delay:9e3,maxDelay:9e3}),r=await browser.tabs.create({url:V,active:we,pinned:!1===ve,windowId:e.id});z.m0||await browser.tabs.update(r.id,{muted:!0});ve&&!we&&await browser.tabs.hide(r.id);return await(0,be.p)(r.id).catch(t.lQ),r}().catch((0,B.t$)("createWorkingTab ",""))}))}async function Ae(e,r,s,{notify:a=!0}={}){const i=(0,t.qS)(s)?await ct.popScreenshotById(s):s;i&&(await async function(t,e,r){if(!r)return;const s="string"==typeof r?await bt(r):r;return await vt.i.withDB((async r=>{(await r.updateDial(t,e,(t=>{t.imgBlob=s,delete t.hash}))).iconBlob||(0,At.O)(t,e)}))}(e,r,i),a&&(0,D.L)(e))}async function Se(t,e){const s=e.toLowerCase(),a=["chrome.google.com/webstore","chromewebstore.google.com"],i=s===w.pf,n=a.some((t=>s.includes(t))),o=!function(t){return/^(http|#|file|ext\+)/.test(t)}(s);if(o||i){const a=yt.M.dialByUrl(t,e);a.thumbnail=Object.assign(a.thumbnail||{},{type:U.O8.AUTO_GENERATED,value:0,position:U.X.CENTER}),a.visual=Object.assign(a.visual||{},{padding:6}),await yt.M.action("replaceDial",{groupId:t,dial:a});const o=await Dt(await(await fetch((0,r.Z)(i?"/png/domains/about-blank.svg":n?"/png/domains/chrome_web_store_badge.svg":s.startsWith(`${v.$b}://extensions`)?"/png/domains/chrome_extensions.svg":s.startsWith(`${v.$b}://settings`)?"/png/domains/chrome_settings.svg":"/png/domains/about-blank.svg"))).blob());return await Ae(t,e,o,{notify:!0}),n&&await yt.M.action("updateDialNameIfNeeded",{groupId:t,url:e,newName:"Web Store"}),!0}return!1}async function Pe(e,{targetWidth:r,targetZoom:s,minDelta:a},i){if(z.m0)return i(1);const n=await browser.tabs.getZoom(e),o=s||await async function(t,e){const{width:r}=await browser.windows.get((await browser.tabs.get(t)).windowId);return r/e||1}(e,r);return a&&Math.abs(o-n)<a?i(n):(await browser.tabs.setZoom(e,o).catch(t.lQ),await(0,t.BK)(500),i(o).finally((()=>browser.tabs.setZoom(e,n).catch(t.lQ))))}var Oe=a(2352);async function Te(e,r,{notify:s=!0,dialsEnvironment:a}={}){const i=yt.M.dialByUrl(e,r);if(!i)return;const n=i.type===U.kh.GROUP,o=(0,S.n)(_.lw.MAX_FRAME_RELOAD_TIME),c=await ye(),u=(await browser.tabs.create({url:n?g.KL+r:(0,ae.I)(r),active:we,pinned:!ve,windowId:c?.id})).id;ve&&!we&&await browser.tabs.hide(u),await I(u,{timeout:o}).catch(t.lQ),await k(u,{timeWithoutTraffic:1e3,timeout:o});const{title:l}=await browser.tabs.get(u),d=await(0,Oe.e6)();const{width:h,height:p}=await q(yt.M.groupById(e),i,!0,2,a),m=await Pe(u,{targetWidth:_.lw.VR_DEFAULT_WIDTH||1280,minDelta:.04},(async t=>{const e=await N(u);await L(u,n,{scaleDown:undefined});const r=e?.pixelRatio||1,s=(await browser.tabs.get(u)).width/r;return await st(u,{reActivateTabId:d.id,rect:{x:0,y:0,width:s,height:p*s/h}})})).finally((async()=>{await browser.tabs.get(u)&&await ge((()=>browser.tabs.remove(u)),`removing tab ${u}`)})),f=await fe.screenshotToDialImageBlob(m,e,r,i.size,{center:!0,scale:2,dialsEnvironment:a});await Ae(e,r,f,{notify:s}),await yt.M.action("updateDialNameIfNeeded",{groupId:e,url:r,newName:l||""})}class ke{groupId;url;dial;dialsEnvironment;type;delay;isManualReload;isVisibleSpin;refreshMethod;value;cloud;isGroupDial;lastRunTime;nextRunTime;constructor(t,e,r,s,a,i,n=0,o,c,u,l,d){this.groupId=e,this.url=r,this.dial=s,this.dialsEnvironment=a,this.type=i,this.delay=n,this.isManualReload=o,this.isVisibleSpin=c,this.refreshMethod=u,this.value=l,this.cloud=d,this.isGroupDial=(0,W.Z)(r),this.lastRunTime=t[this.getKey()]||0,this.nextRunTime=this.getNextScheduleTime()}getKey(){return ke.getKey(this)}static getKey(t){return t.groupId+t.url}getNextScheduleTime(){const t=new Date,e=t.getTime(),r=this.value||Number.MAX_SAFE_INTEGER,[s,a,i]=(0,Pt.Xm)(r),n=this.lastRunTime;function o(t){const r=(0,Pt.dR)(t,s,a,i).getTime(),o=(0,Pt.dR)(t-7,s,a,i).getTime(),c=(0,Pt.dR)(t+7,s,a,i).getTime();return r<e?n<r?e:c:n<o?e:r}switch(this.type){case U.kw.ReloadEvery:return n+1e3*r;case U.kw.Daily:{const t=(new Date).setHours(s,a,i,0),r=(new Date).setHours(s-24,a,i,0),o=(new Date).setHours(s+24,a,i,0);return t<e?n<t?e:o:n<r?e:t}case U.kw.Monthly:{const r=(0,Pt.aG)(new Date,(t=>{t.setDate(1),t.setHours(s,a,i,0)})),o=(0,Pt.aG)(new Date,(t=>{t.setDate(0),t.setDate(1),t.setHours(s,a,i,0)})),c=new Date(t.getFullYear(),t.getMonth()+1,1,s,a,i,0).getTime();return r<e?n<r?e:c:n<o?e:r}case U.kw.WeekDays:return Math.min(...[1,2,3,4,5].map(o));case U.kw.Weekends:return Math.min(...[0,6].map(o));case U.kw.Monday:return o(1);case U.kw.Tuesday:return o(2);case U.kw.Wednesday:return o(3);case U.kw.Thursday:return o(4);case U.kw.Friday:return o(5);case U.kw.Saturday:return o(6);case U.kw.Sunday:return o(0);default:return}}}var Re=a(6663);async function Be(t){const e=self.setInterval((()=>browser.runtime.getPlatformInfo()),2e4);return await t().finally((()=>self.clearInterval(e)))}async function Le(t,e,{invisible:r=!0,manual:s=!1,dialsEnvironment:a}){if(await Se(t,e))return;const i=yt.M.dialByUrl(t,e);await ze(new ke({},t,e,i,a,-1,i?.reload?.delay,s,!r,Re.P.background))}const Ce=new class{consolidateDelay;callback;stack;timeoutId;promise;constructor(t,e){this.consolidateDelay=t,this.callback=e,this.stack=Array(),this.timeoutId=-1}execute(t){return this.timeoutId<0&&(this.promise=new Promise(((t,e)=>{this.timeoutId=self.setTimeout((()=>{this.timeoutId=-1;const r=this.stack;this.stack=[],this.callback(r).then(t,e)}),this.consolidateDelay)}))),this.stack.push(...t),this.promise}}(50,(async function(e){if(0===e.length)return;if(e=(0,b.Jd)(e,(t=>t.getKey())),_e.wasSleepDetectedIn(7))return(0,t.BK)(9e3);await he.waitForOnlineStatus();const{[Re.P.visit]:r=[],[Re.P.hiddenVisit]:s=[],[Re.P.background]:a=[],[Re.P.default]:i=[],[-1]:n=[]}=(0,Ot.$z)(e,(t=>t.cloud?-1:t.refreshMethod));if(r.length){const e=await(0,Oe.e6)();for(const s of r)await fe.takeScreen(s.groupId,s.url,{tabToReturnToId:e?.id||0,dialsEnvironment:s.dialsEnvironment}).catch(t.lQ),await Ge(s)}for(const e of s)await Te(e.groupId,e.url,{dialsEnvironment:e.dialsEnvironment}).catch(t.lQ),await Ge(e);const o=(0,l.m)(Ee);await Promise.all([...a,...i].map((async t=>ze(t,await o())))),await Be((async()=>{for(const t of n)await Fe(t)}))}));yt.M.addOnChange((({type:t})=>"data"===t&&Ne()));const Me=te.then((async t=>{t&&(await async function(){const t=await E.ZB.get(),e=Date.now()-(0,S.Lm)(60),r=Object.entries(t).filter((([t,r])=>r<e));r.length&&((0,B.cO)(`cleaning old last reloads: ${r.length}`),await E.ZB.update((async t=>{for(const[e]of r)delete t[e];return t})))}(),await Ne())})).catch(t.lQ),xe=new re("auto_reload_schedule",(async function(){await Me;const e=await Ue(),r=Date.now(),s=e.filter((t=>t.nextRunTime<=r)).sort((0,M.s)("isGroupDial"));s.length&&(0,B.cO)(`auto_reload starting: ${s.length}, method: ${(0,b.jw)(s.map((t=>t.refreshMethod))).join(", ")}`);await Ce.execute(s).catch(t.lQ),await Ne()}));async function Ne(){const e=(await Ue()).map((t=>t.nextRunTime)).filter(t.zz);if(e.length){const t=Math.min(...e);xe.create({when:t})}}async function Ue(){if(await yt.M.promise,_.lw.AR_DISABLE_THIS_DEVICE)return[];return(await async function(){const t=await E.ZB.get();return(await Promise.all(yt.M.GROUPS.map((async t=>[t,await t.getAutoReloadPoweredDials()])))).flatMap((([e,r])=>r.map((r=>new ke(t,e.id,r.url,r,void 0,r.reload.type,r.reload.delay,!1,!1,r.crop?Re.P.background:r.reload.method||_.lw.DEFAULT_RELOAD_METHOD||Re.P.background,r.reload.value,r.reload.cloud)))))}()).filter((t=>t.nextRunTime))}async function Ge(t){await E.ZB.update((async e=>(e[t.getKey()]=6e4*Math.ceil(Date.now()/6e4),e)))}async function Fe(t){if(!t.isGroupDial)try{await Vt("img/reload",{},{server:t.cloud.server,url:t.url,groupId:t.groupId,refreshMethod:t.refreshMethod,delay:t.delay,...await q(yt.M.groupById(t.groupId),t.dial,!0,1,t.dialsEnvironment)},{timeout:(0,S.xF)(4)});await Ge(t)}catch(e){(0,B.vV)("cloud reload failed",e,t)}}async function ze(e,r,s=0){r=r||await Ee();0!==await(0,R.hC)(r.id,{type:"reload_work",work:e}).catch((t=>((0,B.vV)("reloading failed, unexpected error",t,e),0)))||we||await async function(e){if(z.cI&&_.lw.AR_KEEP_PINNED_TAB)return;const r=await browser.tabs.get(e).catch(t.lQ);r&&await ge((()=>browser.tabs.remove(e)),`closing reloading tab: ${e}`)}(r.id).catch(t.lQ),await Ge(e),(0,D.L)(e.groupId)}const He=["moz-extension","safari-web-extension","chrome","opera","edge","brave","vivaldi","about"];async function We(t=!1){const e=await browser.tabs.query({highlighted:!0,currentWindow:!0}),r=(e.length>1||t?e:await browser.tabs.query({pinned:!1,...z.m0?{}:{currentWindow:!0},...z.cI?{hidden:!1}:{}})).filter((t=>{return!!(e=t.url)&&!He.some((t=>e?.startsWith(t)));var e}));return(0,b.vC)(r,"url")}var $e=a(6419);const Ve=new class{_workingList=Array();constructor(){E.qA.addOnChangeListener((({newValue:t})=>{t?.length||ct.scheduleClean()}))}closeTabs(){this._workingList.forEach((({tab:t})=>t&&browser.tabs.remove(t.id)))}async addSelectedTabsToDial(t){const e=await We(!0);e.length||e.push(t),await this.takeScreenshotsAndOpenDialsPage(t,e.map((e=>({url:e.url,title:e.title,tab:e,returnTabId:t.id}))))}async addCurrentPageToDial(t){t||=await(0,Oe.e6)(),await this.takeScreenshotsAndOpenDialsPage(t,[{url:t.url,title:t.title,tab:t,returnTabId:t.id}])}async addAllTabsToDial(){const t=await(0,Oe.e6)(),e=await We();await this.takeScreenshotsAndOpenDialsPage(t,e.map((e=>({url:e.url,title:e.title,tab:e,returnTabId:t.id}))))}async addLinkToDial(t,e,r){e&&await this.takeScreenshotsAndOpenDialsPage(t,[{url:e,title:r,returnTabId:t.id}])}async addLinkToGroup(e,r,s,a){try{const i=(a?e.linkText:r.title)||"",n=a?e.linkUrl:r.url||e.pageUrl;if(!n)return{type:"error",message:"Error: URL not found"};const[o]=await yt.M.action("insertLinksToGroup",{links:[new $e.O(-1,s,{name:i,url:n})],groupId:s}),[{screenshotId:c}]=this.getLinksDataWithScreenshots([{url:n,title:i,returnTabId:r.id,tab:a?void 0:r}]),u="insert"===o.action;return c?await fe.takeScreen(s,n,{dialSize:o.dial.size,screenshotId:c}).catch(t.lQ):u&&Le(s,n,{manual:!0,invisible:!1}),u?{type:"success",message:`Dial created in group: ${yt.M.groupById(s).name}`}:{type:"warning",message:(0,St.tr)("duplicate_dial_found",yt.M.groupById(s).name)}}catch(t){return{type:"error",message:`Error: unknown issue: ${t?.message}`}}}getLinksDataWithScreenshots(t){return ct.clearScreenshots(),this._workingList=t.filter((t=>t.url)).map((t=>(t.tab&&!t.tab.discarded&&(t.screenshotId=ct.setScreenshot((async()=>{const e=t.tab,r=await(browser.tabs.getZoom?.(e.id))??1,s=e.width/r;return st(e.id,{noDelay:!0,chromeActivateOnly:!0,rect:{x:0,y:0,width:s,height:s}}).catch((()=>""))})())),t)))}async takeScreenshotsAndOpenDialsPage(t,e){e=(0,b.vC)(e,"url");const s=this.getLinksDataWithScreenshots(e);await E.qA.set(s),await z.Vq&&(await ct.getAllDonePromise(),await browser.tabs.update(t.id,{active:!0})),await(0,y.K)((0,r.Z)("dial.html?add_pages=true"),{inNewTab:!0,nextToCurrent:!0,active:!0})}async addImageToDial(t){const e=await lt(t),s=ct.setScreenshot(Dt(e));await E.c9.set({type:e.type,size:e.size,screenshotId:s}),await(0,y.K)((0,r.Z)("dial.html?add_image=true"),{inNewTab:!0,nextToCurrent:!0,active:!0})}};let Ke=[];je();async function je(){return Ke=await(browser.contextualIdentities?.query({}))||[]}browser.contextualIdentities?.onCreated.addListener(je),browser.contextualIdentities?.onUpdated.addListener(je);const Ye=t=>qe(t)?.cookieStoreId;function qe(t){if(t)return Ke.find((e=>e.name===t))}function Ze({links:t,inNewTab:e,cookieStoreId:r,containerName:s,active:a,inNewWindow:i,nextToCurrent:n,windowId:o,inIncognitoWindow:c,stopOpenerTabId:u}){const l=(0,b.BO)(t).map((t=>t.startsWith("#")&&!isNaN(parseInt(t.slice(1)))?g.KL+t:t));return(0,y.K)(l,{inNewTab:e,nextToCurrent:n,active:a,stopOpenerTabId:u,inNewWindow:i,windowId:o,forceIncognitoWindow:c,cookieStoreId:r||Ye(s)})}var Xe=a(1596);const Je=(()=>{return browser.runtime.onMessageExternal.addListener((function(e){if(!(0,t.Gv)(e))return;switch(e.type){case"getSettings":break;case"#":!async function(t,e,r){if(isNaN(t))return;const s=!r,a=_.lw.KEY_TO_GROUP_DIAL,i=(t||10)-1,n=a&&("ctrl"===a&&s||"alt"===a&&r||"shift"===a&&e)?yt.M.GROUPS[i]&&`#${yt.M.GROUPS[i].id}`:(0,u.J)((0,Xe.E)(_.lw.DIAL_ONLY_CURRENT_GROUP?[await c()]:yt.M.GROUPS,((t,e,r)=>r===i)),(t=>t.multi?.links.map((t=>t.url))||t.url));if(!n)return;const o=_.lw.KEY_NEW_TAB||e;!o&&_.lw.KEY_FORCE_PAGE_FOCUS?(0,Oe.e6)().then((t=>{Ze({links:n,inNewTab:!0,nextToCurrent:!0,active:!0}),browser.tabs.remove(t.id)})):Ze({links:n,inNewTab:o,nextToCurrent:_.lw.KEY_NEXT_TO_CURRENT,active:!0});async function c(){const t=await(0,Oe.e6)(),e=await(0,R.hC)(t.id,{type:"getCurrentGroupId"}).catch((()=>-1))||-1;return yt.M.groupById(e)}}(e.value,e.isShift,e.isAlt)}return r()})),_.KY.addOnChangeListener((()=>e().catch(t.lQ))),e().catch(t.lQ),{notify:e};async function e(){return browser.runtime.sendMessage("admin@fastaddons.com_Ctrl_GroupSpeedDial",await r())}async function r(){const t=await _.j_;return{KEY_DELAY:t.KEY_DELAY,KEY_EXTENDED_MODE:t.KEY_EXTENDED_MODE,KEY_DISABLE_ALT:t.KEY_DISABLE_ALT,KEY_DISABLE_CTRL:t.KEY_DISABLE_CTRL,KEY_DISABLE_SHIFT:t.KEY_DISABLE_SHIFT,KEY_DISABLE_ZERO:t.KEY_DISABLE_ZERO}}})();var Qe=a(7552);yt.M.addOnChange((async function({type:t,lastChangeInfo:e,serialize:r}){if("data"!==t)return;return await vt.i.withDB((async t=>{const s={date:e?.date||Date.now(),name:e?.name||"unknown change",...r()};await t.dbTransactionOperation(Qe.ew.DB_HISTORY,Qe.p0.DB_OP_READ_WRITE,"put",s).catch((0,B.t$)("add to history",e))}))})),new re("clearOldHistory",(async function(){return await vt.i.withDB((async t=>{const[e,r]=t.dbTransaction(await t.promise,Qe.ew.DB_HISTORY,Qe.p0.DB_OP_READ_WRITE),s=e.objectStore(Qe.ew.DB_HISTORY),a=await t.dbOperation(s,"getAll"),i=a.length-64;for(let e=0;e<i;e++)await t.dbOperation(s,"delete",a[e].id);await r}))})).createOnStart({delayInMinutes:12});class tr{id;title;contexts;optionName;constructor(t,e,r,s){this.id=t,this.title=e,this.contexts=r,this.optionName=s}async build(e,r,s,a){return!(await _.j_)[this.optionName]&&(browser.contextMenus.create({id:e||this.id,parentId:s,...s&&a?{icons:{16:a}}:{},title:r||this.title,contexts:(0,t.oA)(this.contexts)}),!0)}}var er=a(1550);async function rr(t){if(!self.matchMedia?.(er.Co).matches)return t;const e=await(await fetch(t)).text(),r=`<svg xmlns="http://www.w3.org/2000/svg">\n  <filter id="invertFilter">\n    <feColorMatrix in="SourceGraphic" type="matrix" values="-1 0 0 0 1 0 -1 0 0 1 0 0 -1 0 1 0 0 0 1 0"/>\n  </filter>\n  <image filter="url(#invertFilter)" href="data:image/svg+xml,${encodeURIComponent(e)}" x="0" y="0" height="100%" width="100%" preserveAspectRatio="xMidYMid meet"/>\n</svg>`;return`data:image/svg+xml,${encodeURIComponent(r)}`}if(browser.contextMenus){const t=O(300,(async function(){await yt.M.promise,await browser.contextMenus.removeAll();for(const t of sr){await t.build()&&_.lw.CONTEXT_MENU_SHOW_GROUPS&&["add_page_to_dial","add_link_to_dial"].includes(t.id)&&(await t.build(t.id+"_child",(0,St.tr)("cm_choose_dial"),t.id,await rr("/svg/right(0).svg")),browser.contextMenus.create({id:`separator_${t.id}`,parentId:t.id,type:"separator"}),await ar(t.id,t.contexts))}}));yt.M.addOnChange((({type:e})=>"data"===e&&t())),_.KY.addOnChangeListener((()=>t())),browser.runtime.onInstalled.addListener((()=>t())),browser.runtime.onStartup.addListener((()=>t()))}browser.contextMenus?.onClicked.addListener((async function(t,e){if(await yt.M.promise,!e)throw Error("missing tab data");const r=String(t.menuItemId);switch(r){case"add_page_to_dial_child":case"add_page_to_dial":return Ve.addCurrentPageToDial(e);case"add_link_to_dial_child":case"add_link_to_dial":return Ve.addLinkToDial(e,t.linkUrl,t.linkText);case"use_image_as_thumbnail":return Ve.addImageToDial(t.srcUrl);case"add_tab_to_dial":return Ve.addSelectedTabsToDial(e);default:if(r.startsWith("generated_group,")){const[s,a,i,n]=r.split(","),o="isLink"===n;if(await yt.M.findDuplicateDial(o?t.linkUrl:e.url))o?Ve.addLinkToDial(e,t.linkUrl,t.linkText):Ve.addCurrentPageToDial(e);else{const{type:r,message:s}=await Ve.addLinkToGroup(t,e,parseInt(i),o);await async function(t,e,r,s){await browser.scripting.executeScript({target:{tabId:t},args:[s,e,r],func:(t,e,r)=>{const s=document.createElement("div");document.body.appendChild(s);const a=s.attachShadow({mode:"open"}),i=document.createElement("style"),n="success"===t;i.textContent=`\n:host {\n  all: initial !important;\n  z-index: 2147483647 !important;\n  position: fixed !important;\n  top: 50% !important;\n  left: 50% !important;\n  transform: translate(-50%, -50%) !important;\n}\n.box {\n  color: #fff;\n  background: hsl(${n?120:"warning"===t?60:0}, 100%, 32%);\n  padding: 24px;\n  border-radius: 12px;\n  box-shadow: 0 0 24px #000;\n  text-align: center;\n  font-family: Verdana, system-ui, sans-serif;\n}\n.box > * { margin: 0 }\n.box > * + * { margin-top: 16px }\nbutton {\n  font-size: 16px;\n  padding: 4px 24px;\n}\n`,a.appendChild(i);const o=Object.assign(document.createElement("div"),{className:"box"});a.appendChild(o),o.appendChild(Object.assign(document.createElement("h2"),{textContent:e})),o.appendChild(Object.assign(document.createElement("p"),{textContent:r})),n?(window.addEventListener("click",(()=>s.remove()),{once:!0}),self.setTimeout((()=>s.remove()),3e3)):o.appendChild(Object.assign(document.createElement("button"),{textContent:browser.i18n.getMessage("label_close"),onclick:()=>s.remove()}))}})}(e.id,(0,St.tr)(`title_${r}`),s,r)}}}}));const sr=[new tr("add_page_to_dial",(0,St.tr)("add_page"),(()=>[..._.lw.DISABLE_CONTEXT_MENU_IMAGE?["image"]:[],..._.lw.DISABLE_CONTEXT_MENU_LINK_ADD?["link"]:[],"page","selection","video","frame","editable","audio","browser_action"]),"DISABLE_CONTEXT_MENU_ADD"),new tr("add_link_to_dial",(0,St.tr)("add_link"),["link"],"DISABLE_CONTEXT_MENU_LINK_ADD"),new tr("use_image_as_thumbnail",(0,St.tr)("use_image_as_thumbnail"),["image"],"DISABLE_CONTEXT_MENU_IMAGE"),new tr("add_tab_to_dial",(0,St.tr)("add_dial"),["tab"],"DISABLE_CONTEXT_TAB_ADD")];async function ar(e,r){const s=(0,t.oA)(r),a=s.includes("link"),i=(await yt.M.getVisibleGroups()).filter((t=>!t.archived&&!t.topSites));for(const t of i)browser.contextMenus.create({id:`generated_group,${e},${t.id},${a?"isLink":""}`,enabled:t.dials.some((t=>t.isEmptyDial())),title:t.name,contexts:s,parentId:e,icons:{16:t.iconId?await rr(`/icons/tags/tag (${t.iconId}).svg`):"/svg/empty.svg"}})}var ir=a(5448);new class{constructor(){this.reload(),new re("_weather_fetch",(()=>this.reload())).createOnStart({periodInMinutes:50}),yt.M.addOnChange((t=>{"data"===t.type&&t.lastChangeInfo?.editedDialsTypes?.includes(U.kh.WEATHER)&&this.reload()})),le.addOnChange((()=>this.reload()))}async reload(){await yt.M.promise;const t=yt.M.GROUPS.flatMap((t=>t.dials.filter((t=>t.isWeatherDial())))),e={},r=new Set;for(const s of t){const{lat:t,lon:a,units:i,current:n,forecastDays:o}=s.weather;if(!t||!a)continue;const c=await jt("open-weather/get/:lat/:lon/:units",{lat:t,lon:a,units:i});if(!c.ok)return void(0,B.vV)("weather issue",c.status,c.statusText);{const t=await c.json();if("error"in t)return void(0,B.vV)("server weather error");e[s.getWeatherUUID()]=t}r.add(s.groupId)}await E.ci.set(e),r.size&&(0,D.L)(...r)}};var nr=a(9232);Rt.N||new re("storage_sync_backup",nr.backupToSync).createOnStart({delayInMinutes:120});const or=new J.F("__install_date",(()=>{}),{storageArea:"sync"});browser.runtime.onInstalled.addListener((async({reason:t})=>{if("install"===t){const t=await or.get();Array.isArray(t)||await or.set([(0,Pt._k)(),(0,Pt._k)()])}}));a(6635);var cr=a(6265);browser.alarms.onAlarm.addListener((async t=>{const e=cr.w.getTimerDataFromAlarm(t.name);if(!e)return;const{timerType:r,timerIndex:s,dialCreated:a}=e,i=yt.M.dialByCreated(a),n=(await browser.windows.create({type:"normal",state:"normal",url:g.KL})).tabs[0].id;await(0,be.p)(n),(0,R.hC)(n,{type:"alarm",timerType:r,groupId:i.groupId,dialDomId:i.domId,timerIndex:s})}));const ur=self.caches?.open("background_image").catch(t.s6);async function lr(){const t=await ur;if(t)return Promise.all(Array.from(await t.keys()).map((e=>t.delete(e))))}new re("clearBackgroundImageCache",lr).createOnStart({periodInMinutes:480}),browser.runtime.onStartup.addListener(lr);Promise.resolve();ee.then((async function(){const{ICON:t}=await _.j_;await browser.browserAction.setIcon({path:t})}));var dr=a(7548);const hr="productivity_mode",pr={schedulerEnabled:!1,startTime:"8:00",endTime:"17:00",daysActive:[!1,!0,!0,!0,!0,!0,!1]},mr=new J.F("productivity_mode",(()=>{})),fr=(0,dr.Q)(mr,pr);function wr(){const[t,e]=pr.startTime.split(":").map((t=>parseInt(t))),[r,s]=pr.endTime.split(":").map((t=>parseInt(t)));return{s:(0,Pt.Wu)(t,e),e:(0,Pt.Wu)(r,s),startH:t,startM:e,endH:r,endM:s}}function gr(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var s,a,i=r.call(t),n=[];try{for(;(void 0===e||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(t){a={error:t}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return n}var _r;(t=>{t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(_r||(_r={}));var yr={type:"xstate.init"};function vr(t){return void 0===t?[]:[].concat(t)}function br(t){return{type:"xstate.assign",assignment:t}}function Dr(t,e){return"string"==typeof(t="string"==typeof t&&e&&e[t]?e[t]:t)?{type:t}:"function"==typeof t?{type:t.name,exec:t}:t}function Ir(t){return e=>t===e}function Er(t){return"string"==typeof t?{type:t}:t}function Ar(t,e){return{value:t,context:e,actions:[],changed:!1,matches:Ir(t)}}function Sr(t,e,r){var s=e,a=!1;return[t.filter((t=>{if("xstate.assign"===t.type){a=!0;var e=Object.assign({},s);return"function"==typeof t.assignment?e=t.assignment(s,r):Object.keys(t.assignment).forEach((a=>{e[a]="function"==typeof t.assignment[a]?t.assignment[a](s,r):t.assignment[a]})),s=e,!1}return!0})),s,a]}var Pr=(t,e)=>t.actions.forEach((r=>{var s=r.exec;return s&&s(t.context,e)}));const Or=function(t,e){void 0===e&&(e={});var r=gr(Sr(vr(t.states[t.initial].entry).map((t=>Dr(t,e.actions))),t.context,yr),2),s=r[0],a=r[1],i={config:t,_options:e,initialState:{value:t.initial,actions:s,context:a,matches:Ir(t.initial)},transition:(e,r)=>{var s,a,n="string"==typeof e?{value:e,context:t.context}:e,o=n.value,c=n.context,u=Er(r),l=t.states[o];if(l.on){var d=vr(l.on[u.type]);"*"in l.on&&d.push.apply(d,function(t,e,r){if(r||2===arguments.length)for(var s,a=0,i=e.length;a<i;a++)!s&&a in e||(s||(s=Array.prototype.slice.call(e,0,a)),s[a]=e[a]);return t.concat(s||Array.prototype.slice.call(e))}([],gr(vr(l.on["*"])),!1));try{for(var h=(t=>{var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],s=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:()=>(t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t})};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")})(d),p=h.next();!p.done;p=h.next()){var m=p.value;if(void 0===m)return Ar(o,c);var f="string"==typeof m?{target:m}:m,w=f.target,g=f.actions,_=void 0===g?[]:g,y=f.cond,v=void 0===y?()=>!0:y,b=void 0===w,D=null!=w?w:o,I=t.states[D];if(v(c,u)){var E=gr(Sr((b?vr(_):[].concat(l.exit,_,I.entry).filter((t=>t))).map((t=>Dr(t,i._options.actions))),c,u),3),A=E[0],S=E[1],P=E[2],O=null!=w?w:o;return{value:O,context:S,actions:A,changed:w!==o||A.length>0||P,matches:Ir(O)}}}}catch(t){s={error:t}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(s)throw s.error}}}return Ar(o,c)}};return i}({initial:"off",context:{totalMinutes:0,startedAt:0,pausedAt:0,pausedForMinutes:0},states:{off:{on:{ACTIVATE:{target:"active"},ACTIVATE_MANUAL:{target:"activeManual"},RESUME:{target:"activeManual"}}},active:{on:{PAUSE:{target:"paused"},OFF:{target:"off"},ACTIVATE:{target:"active"}},entry:br(((t,e)=>{const{s:r,e:s,startH:a,startM:i}=wr();return{startedAt:[0,-24].map((t=>(new Date).setHours(t+a,i,0,0))).find((t=>t<Date.now())),pausedAt:0,pausedForMinutes:0,totalMinutes:r<s?s-r:s-r+1440}}))},activeManual:{on:{PAUSE:{target:"pausedManual"},OFF:{target:"off"}},entry:br(((t,e)=>({startedAt:Date.now(),pausedAt:0,pausedForMinutes:0,totalMinutes:0})))},paused:{on:{RESUME:{target:"active"},ACTIVATE:{target:"active"},OFF:{target:"off"},PAUSE:{target:"paused"}},entry:[br(((t,e)=>({startedAt:0,pausedAt:Date.now(),pausedForMinutes:"PAUSE"===e.type?e.minutes:0}))),(t,e)=>{browser.alarms.create(hr,{delayInMinutes:"PAUSE"===e.type&&e.minutes||1})}]},pausedManual:{on:{RESUME:{target:"activeManual"},ACTIVATE_MANUAL:{target:"activeManual"},OFF:{target:"off"},PAUSE:{target:"pausedManual"}},entry:[br(((t,e)=>({startedAt:0,pausedAt:Date.now(),pausedForMinutes:"PAUSE"===e.type?e.minutes:0}))),(t,e)=>{browser.alarms.create(hr,{delayInMinutes:"PAUSE"===e.type&&e.minutes||1})}]}}}),Tr=function(t){var e=t.initialState,r=_r.NotStarted,s=new Set,a={_machine:t,send:a=>{r===_r.Running&&(e=t.transition(e,a),Pr(e,Er(a)),s.forEach((t=>t(e))))},subscribe:t=>(s.add(t),t(e),{unsubscribe:()=>s.delete(t)}),start:s=>{if(s){var i="object"==typeof s?s:{context:t.config.context,value:s};e={value:i.value,actions:[],context:i.context,matches:Ir(i.value)}}else e=t.initialState;return r=_r.Running,Pr(e,yr),a},stop:()=>(r=_r.Stopped,s.clear(),a),get state(){return e},get status(){return r}};return a}(Or);Tr.subscribe((({value:e,changed:r,context:s})=>{r?(0,R._z)({type:"productivityStateChange",state:{value:e,context:s}}).catch(t.lQ):"off"===e&&(s.pausedAt,s.startedAt)}));const kr=new re(hr,Lr);mr.addOnChangeListener(Lr);const Rr=async function(){await fr,Tr.start(),Br(),pr.schedulerEnabled&&await Lr()}();function Br(){if(!pr.schedulerEnabled)return;const{s:t,e}=wr(),r=Date.now(),s=pr.daysActive.flatMap(((r,s)=>r?[t,e].map((t=>(0,Pt.dR)(s,0,t,0).getTime())):[])).flatMap((t=>[t,t+(0,S.Lm)(7)])).filter((t=>t>r)),a=Math.min(...s);kr.create({when:a})}async function Lr(){await fr;const t=pr.schedulerEnabled,e=Tr.state.value;if(t||"active"===e){const e=!!t&&function(){const{s:t,e}=wr(),r=function(){const t=new Date;return(0,Pt.Wu)(t.getHours(),t.getMinutes())}();return pr.daysActive[(new Date).getDay()]&&(t<=e&&t<=r&&r<e||t>=e&&(t<=r||r<e))}();Tr.send(e?{type:"ACTIVATE"}:{type:"OFF"}),Br()}"pausedManual"===e&&Tr.send({type:"RESUME"})}var Cr=a(4261);const Mr=new J.F("_bing_data",(()=>({images:[],index:0})),{storageArea:"local"}),xr=new class{IMAGES_COUNT=8;BING_HOST="https://www.bing.com";coolDownExecutor=new ft((0,S.xE)(3),"bing_images_fetch","local");iterator=Mr.get().then((t=>new Cr.E(t.index||0,0,this.IMAGES_COUNT-1)));isEnabled=!1;constructor(){new re("_bing_image_of_day",(()=>this.reload())).createOnStart({periodInMinutes:240}),_.KY.addOnChangeListener((({newValue:t})=>{this.isEnabled=t?.BACKGROUND===U.cG.BING,this.isEnabled&&this.reload()}),{dummyInitValue:_.j_})}async next(){(await this.iterator).getNext(),await this.updateData()}async previous(){(await this.iterator).getPrevious(),await this.updateData()}async reload(){this.isEnabled&&await this.coolDownExecutor.getOrFetch((async()=>{const t=await Q({retryCount:3,repeatDelay:2e3,increasingDelay:!0,callback:async()=>{const t=await fetch(`${this.BING_HOST}/HPImageArchive.aspx?format=js&idx=0&n=${this.IMAGES_COUNT}&mkt=en-US`);return t.ok||(0,B.vV)("bing fetch failed",null,t.status),(await t.json()).images}});(0,B.cO)("BING - new images:",t?.length);const e=t.map((t=>({title:t.title,url:this.BING_HOST+t.url,quiz:this.BING_HOST+t.quiz,info:t.copyrightlink})));await this.updateData(e)}))}async updateData(t){const e=await this.iterator;await Mr.update((r=>(t&&(r.images=t),r.index=e.current,r.current=r.images?.[e.current]?.url||"",r)))}};var Nr=a(5048);async function Ur(t){const e=parseFloat(t);e<10.6&&(await async function(){if(Rt.N)return;await vt.i.withDB((async t=>{for(const e of[Qe.ew.DB_IMAGE,Qe.ew.DB_PREVIOUS])await t.updateEachRecordAsync(e,(async t=>{try{t.img&&(t.imgBlob=await bt(t.img)),t.icon&&(t.iconBlob=await bt(t.icon))}catch(t){(0,B.vV)("base64 to blob failed",t)}return t}));await t.dbTransactionOperation(Qe.ew.DB_ORIGINAL,Qe.p0.DB_OP_READ_WRITE,"clear")})),(0,D.L)()}(),(0,B.cO)("hotfix_10_6 applied")),e<20&&(await async function(){await _.j_,await _.KY.update((t=>(delete t.BING_IMAGES,delete t.BING_IMAGE,delete t.BING_INDEX,t)))}(),(0,B.cO)("hotfix_20_0_LegacyBING_and_Fields applied")),e<20.3&&(await async function(){if(Rt.N)return;await vt.i.withDB((async t=>{for(const e of[Qe.ew.DB_IMAGE,Qe.ew.DB_PREVIOUS])await t.updateEachRecordAsync(e,(async t=>{try{t.img&&!t.imgBlob&&(t.imgBlob=await bt(t.img)),t.icon&&!t.iconBlob&&(t.iconBlob=await bt(t.icon)),delete t.img,delete t.icon}catch(t){(0,B.vV)("base64 to blob failed",t)}return t}));await t.dbTransactionOperation(Qe.ew.DB_ORIGINAL,Qe.p0.DB_OP_READ_WRITE,"clear")})),(0,D.L)()}(),(0,B.cO)("hotfix_20_0 applied"),await browser.storage.local.remove(["___thumbnails","super_speed","_chromeIncognitoPing","_chromeIncognitoReady","_chromeIncognitoGetDialData","_chromeIncognitoDialData"])),e<21.1&&(await async function(){const t=(await browser.alarms.getAll()).map((t=>t.name)).filter((t=>t.match(new RegExp(String.raw`.*-.*-0\..*`)))).concat("_error_logger","AutoReload");for(const e of t)await browser.alarms.clear(e)}(),(0,B.cO)("hotfix_21_1_BadPersistentAlarmsRemoval applied")),e<21.2&&(await _.j_,await _.KY.update((t=>{const e=t.DIAL_FONT_SIZE||12;return e<20&&(t.DIAL_FONT_SIZE=e+4),t})),(0,B.cO)("hotfix_21_2 font-size migration applied")),e<24.5&&(await _.j_,await _.KY.update((t=>(t.DIAL_HEADER_STYLE=t.TRANSPARENT_HEAD?U.xk.transparent:U.xk.legacy,t.GROUPS_SIZE===Nr.O5&&25===t.GROUPS_HEIGHT&&4===t.GROUP_PADDING&&(t.GROUPS_HEIGHT=Nr.$K,t.GROUP_PADDING=Nr.b3),t))),(0,B.cO)("hotfix 24.5 style_migration applied"))}class Gr{async isInContainer(t){return t?.cookieStoreId&&await async function(t){return await browser.contextualIdentities.get(t.cookieStoreId).then((()=>!0),(()=>!1))}(t)}async isInDefaultContainer(t){return!await this.isInContainer(t)}async returnHome(t,e){if(await this.isInContainer(t))return;const r=await(0,Oe.e6)();await(0,be.p)(r.id,(()=>browser.tabs.update(r.id,{url:`${g.KL}${e?`#${e}`:""}`})))}async getAuthTokenForWebsite(t){return await this.isInContainer(t)?"":(0,zt.c4)()}async setNewToken(e,r){if(await this.isInContainer(e))return!1;if(await(0,t.BK)(200),await(0,zt.lV)(r),r){const t=await Yt("img/all",{});Array.isArray(t)&&t.length&&(await _.KY.update((t=>(t.PRO_THUMBNAIL_SYNC=!0,t))),he.synchronize({force:!0,forceDownloadPrivate:!0}))}return!0}}var Fr,zr=a(7644),Hr=a(6304);(t=>{t[t.Search=0]="Search",t[t.OptionsGeneral=1]="OptionsGeneral",t[t.OptionsDials=2]="OptionsDials",t[t.OptionsGroups=3]="OptionsGroups",t[t.OptionsBackground=4]="OptionsBackground",t[t.OptionsContextMenu=5]="OptionsContextMenu",t[t.OptionsThumbnails=6]="OptionsThumbnails",t[t.OptionsShortcuts=7]="OptionsShortcuts",t[t.OptionsSynchronization=8]="OptionsSynchronization",t[t.OptionsImportBackup=9]="OptionsImportBackup",t[t.OptionsImport3rdParty=10]="OptionsImport3rdParty",t[t.StorageInfo=11]="StorageInfo",t[t.About=12]="About",t[t.Upgrade=13]="Upgrade"})(Fr||(Fr={}));const Wr=()=>Promise.all([a.e(611),a.e(900)]).then(a.bind(a,9232));var $r=a(7137);const Vr=new J.F("last_backup_time",(()=>0)),Kr=new class{getLastBackupTime(){return Vr.get()}updateLastBackupTime(){return Vr.set(Date.now())}async saveDirectoryHandle(t){const e={key:Qe.yH,value:t};await vt.i.withDB((t=>t.dbTransactionOperation(Qe.ew.DB_RUNTIME,Qe.p0.DB_OP_READ_WRITE,"put",e)))}async getDirectoryHandle(){return _.lw.AUTO_BACKUP?{name:_.lw.AUTO_BACKUP_FOLDER_NAME||"gsd",queryPermission:async()=>await browser.permissions.contains({permissions:["downloads"]})?"granted":"prompt",requestPermission:async()=>await(0,$r.x)("downloads")?"granted":"denied"}:void 0}async verifyGrantedPermission(){const t=await this.getDirectoryHandle();return"granted"===await(t?.requestPermission({mode:"readwrite"}))}async createNewBackup(t=!1){return await(0,R._z)({type:"create_automatic_backup",isManual:t})}async disable(){await vt.i.withDB((t=>t.dbTransactionOperation(Qe.ew.DB_RUNTIME,Qe.p0.DB_OP_READ_WRITE,"delete",Qe.yH))),await _.KY.update((t=>(t.AUTO_BACKUP=!1,t)))}},jr="group_speed_dial",Yr=()=>`backup_${(0,Pt.JY)()}`;let qr=0;async function Zr(e=!1){await _.j_;const r=Date.now(),s=await Kr.getDirectoryHandle();if(!s||!e&&r-qr<(0,S.xE)(1))return"denied";qr=r;const a=JSON.stringify(await async function(e=!1){const r=await browser.storage.local.get().catch((async e=>{const[r]=(await vt.i.withDB((t=>t.dbTransactionOperation(Qe.ew.DB_HISTORY,Qe.p0.DB_OP_READONLY,"getAll"))).catch((async e=>{const{getLocalStorageBackup:r,getSyncBackups:s}=await Wr(),a=await r().catch(t.lQ);return a?[a]:await s()}))).sort((0,M.s)("date",!1));if(!r)throw"no backup found, all storage is broken :(";return{groups:r.groups,metadata:r.metadata}}));return r.___thumbnails=e?await async function(){return await vt.i.withDB((async e=>(await(0,ir.G)(e),it(await e.mapEachRecord(Qe.ew.DB_IMAGE,{map:e=>async()=>({...e,icon:e.iconBlob?await Dt(e.iconBlob).catch(t.s6):void 0,img:e.imgBlob?await Dt(e.imgBlob).catch(t.s6):void 0,iconBlob:void 0,imgBlob:void 0})})))))}().catch((()=>[])):[],delete r[zt.$x],Object.keys(r).filter((t=>t.startsWith("thumb_version_"))).forEach((t=>delete r[t])),r}(!0));if(s instanceof FileSystemDirectoryHandle){const t=await s.getFileHandle(`${Yr()}.${jr}`,{create:!0}),e=await t.createWritable();await e.write(a),await e.close();const r=(await Array.fromAsync(s.keys())).filter((t=>t.endsWith(`.${jr}`))).sort().slice(0,-_.lw.AUTO_BACKUP_KEEP_COUNT);await Promise.all(r.map((t=>s.removeEntry(t)))),(0,B.cO)("deleted old backups:",r)}else{const t=URL.createObjectURL(new Blob([a],{type:"application/json"})),e=await browser.downloads.download({url:t,saveAs:!1,filename:`${_.lw.AUTO_BACKUP_FOLDER_NAME}/${Yr()}.${jr}`});await browser.downloads.erase({id:e}),URL.revokeObjectURL(t)}return await Kr.updateLastBackupTime(),"granted"}browser.runtime.onInstalled.addListener((async({reason:t,previousVersion:e})=>{(0,B.cO)(`onInstalled: ${t} ${e}`),"install"===t?(await yt.M.promise,(0,y.K)(g.KL,{inNewTab:!0,nextToCurrent:!0,active:!0})):"update"===t&&(await Ur(e).catch((r=>(0,B.vV)("migrations failed",r,{reason:t,previousVersion:e}))),fe.updateMissingFavicons())}));const Xr=(0,l.m)((()=>(0,B.cO)("First tab starts loading."))),Jr=(t,e)=>{switch(t.type){case"health_check":return Xr(),Qr;case"getImages":return vt.i.withDB((e=>e.getThumbnails(t.groupId)));case"getDbDial":return vt.i.withDB((e=>e.getDbDial(t.groupId,t.url)));case"broadcast":browser.runtime.sendMessage(t.message);break;case"getScreenInfo":return e.tab?.id?(0,R.hC)(e.tab.id,{type:"getScreenInfo"}):void 0;case"selfMessage":return(0,R.hC)(e.tab.id,t.message);case"add_current":return Ve.addCurrentPageToDial();case"add_all_current":return Ve.addAllTabsToDial();case"add_closeTabs":return Ve.closeTabs();case"save_db_image":return Ae(t.groupId,t.url,"img"in t?t.img:t.screenshotId,{notify:t.notify});case"take_screen":return fe.takeScreen(t.groupId,t.url,Object.assign(t,{tabToReturnToId:t.tabToReturnToId||e.tab.id}));case"updateFavicon":return fe.updateFavicon(t.groupId,t.url,{onlyIfMissing:t.onlyIfMissing});case"download_missing_favicons":return fe.updateMissingFavicons();case"capture_tab":return st(t.tabId,t.options);case"cs_return_home":return(new Gr).returnHome(e.tab,t.groupId);case"cs_get_token":return(new Gr).getAuthTokenForWebsite(e.tab);case"cs_web_token_update":return(new Gr).setNewToken(e.tab,t.token);case"cs_is_default_container":return(new Gr).isInDefaultContainer(e.tab);case"cs_shared_groups_import":return yt.M.action("importData",{groups:t.groups,replaceExisting:!1,source:"shared"});case"findBiggestScreenSize":return x();case"by_visit_invisible":return Te(t.groupId,t.url,t.reloadOptions);case"background_reload":return Le(t.groupId,t.url,t.reloadOptions);case"createThumbnailForBlockedPage":return Se(t.groupId,t.url);case"getProductivityState":return async function(){return await Rr,Tr.state}();case"setProductivityMode":return async function(t){await Rr,Tr.send(t)}(t.value);case"sync":return he.synchronize(t);case"public_upload":return he.publicUpload(t.groupId,(0,zr._)(t.dial.index,t.dial,t.groupId));case"synchronize_thumbnails":return he.synchronizeThumbnails();case"bingNext":return xr.next();case"bingPrevious":return xr.previous();case"detect_ctrl_addon":return Je.notify();case"create_automatic_backup":return Zr(t.isManual)}};(0,Hr.w)(Jr),browser.runtime.onMessage.addListener(Jr),browser.runtime.onConnect.addListener((t=>{if("dials_page"===t.name)t.onDisconnect.addListener((()=>he.flushChanges()));t.onMessage.addListener((()=>{}))}));const Qr=async function(){await yt.M.promise.then((0,B.jW)("store ready")),_.lw.DEBUG_KEEP_SW_ALIVE&&Be((()=>new Promise((t=>{}))))}().then(t.x2).catch(et((t=>(0,B.vV)("background failed",t))))})()})();