"use strict";(self.webpackChunkchrome_extension=self.webpackChunkchrome_extension||[]).push([[13],{16772:(e,t,r)=>{r.d(t,{N:()=>j});var n=r(15215),i=r(22924),s=r(34549),o=r(78868),a=r(89404),u=r(71805),c=r(3976),d=r(69038),l=r(54769),h=r(64988),f=r(32658),g=r(88319),p=r(16807),m=r(76888),_=r(88835),y=function(e){var t=window.open(e,"_self");return t?Promise.resolve(t):Promise.reject()},v=r(48287),b=r(37070),w=r(35166),S=r(33523),A="undefined"!=typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("amplify_default"):"@@amplify_default",I=function(e,t,r){o.Y.dispatch("auth",{event:e,data:t,message:r},"Auth",A)},P=new s.C("OAuth");const U=function(){function e(e){var t=e.config,r=e.cognitoClientId,n=e.scopes,i=void 0===n?[]:n;if(this._urlOpener=t.urlOpener||y,this._config=t,this._cognitoClientId=r,!this.isValidScopes(i))throw Error("scopes must be a String Array");this._scopes=i}return e.prototype.isValidScopes=function(e){return Array.isArray(e)&&e.every((function(e){return"string"==typeof e}))},e.prototype.oauthSignIn=function(e,t,r,s,o,a){void 0===e&&(e="code"),void 0===o&&(o=i.qB.Cognito);var u=this._generateState(32),c=a?u+"-"+(0,f.r)(a):u;!function(e){window.sessionStorage.setItem("oauth_state",e)}(c);var d,l=this._generateRandom(128);d=l,window.sessionStorage.setItem("ouath_pkce_key",d);var h=this._generateChallenge(l),g=this._scopes.join(" "),p="https://"+t+"/oauth2/authorize?"+Object.entries((0,n.__assign)((0,n.__assign)({redirect_uri:r,response_type:e,client_id:s,identity_provider:o,scope:g,state:c},"code"===e?{code_challenge:h}:{}),"code"===e?{code_challenge_method:"S256"}:{})).map((function(e){var t=(0,n.__read)(e,2),r=t[0],i=t[1];return encodeURIComponent(r)+"="+encodeURIComponent(i)})).join("&");P.debug("Redirecting to "+p),this._urlOpener(p,r)},e.prototype._handleCodeFlow=function(e){return(0,n.__awaiter)(this,void 0,void 0,(function(){var t,r,s,o,a,c,d,l,h,f,g,p,m,y,v,S;return(0,n.__generator)(this,(function(A){switch(A.label){case 0:return t=((0,_.parse)(e).query||"").split("&").map((function(e){return e.split("=")})).reduce((function(e,t){var r,i=(0,n.__read)(t,2),s=i[0],o=i[1];return(0,n.__assign)((0,n.__assign)({},e),((r={})[s]=o,r))}),{code:void 0}).code,r=(0,_.parse)(e).pathname||"/",s=(0,_.parse)(this._config.redirectSignIn).pathname||"/",t&&r===s?(o="https://"+this._config.domain+"/oauth2/token",I("codeFlow",{},"Retrieving tokens from "+o),a=(0,i.fz)(this._config)?this._cognitoClientId:this._config.clientID,c=(0,i.fz)(this._config)?this._config.redirectSignIn:this._config.redirectUri,U=window.sessionStorage.getItem("ouath_pkce_key"),window.sessionStorage.removeItem("ouath_pkce_key"),d=U,l=(0,n.__assign)({grant_type:"authorization_code",code:t,client_id:a,redirect_uri:c},d?{code_verifier:d}:{}),P.debug("Calling token endpoint: "+o+" with",l),h=Object.entries(l).map((function(e){var t=(0,n.__read)(e,2),r=t[0],i=t[1];return encodeURIComponent(r)+"="+encodeURIComponent(i)})).join("&"),f={category:b.b7.Auth,action:b.BM.FederatedSignIn},[4,fetch(o,{method:"POST",headers:(S={"Content-Type":"application/x-www-form-urlencoded"},S[w.Y]=(0,u.fE)(f),S),body:h})]):[2];case 1:return[4,A.sent().json()];case 2:if(g=A.sent(),p=g.access_token,m=g.refresh_token,y=g.id_token,v=g.error)throw new Error(v);return[2,{accessToken:p,refreshToken:m,idToken:y}]}var U}))}))},e.prototype._handleImplicitFlow=function(e){return(0,n.__awaiter)(this,void 0,void 0,(function(){var t,r,i;return(0,n.__generator)(this,(function(s){return t=((0,_.parse)(e).hash||"#").substr(1).split("&").map((function(e){return e.split("=")})).reduce((function(e,t){var r,i=(0,n.__read)(t,2),s=i[0],o=i[1];return(0,n.__assign)((0,n.__assign)({},e),((r={})[s]=o,r))}),{id_token:void 0,access_token:void 0}),r=t.id_token,i=t.access_token,I("implicitFlow",{},"Got tokens from "+e),P.debug("Retrieving implicit tokens from "+e+" with"),[2,{accessToken:i,idToken:r,refreshToken:null}]}))}))},e.prototype.handleAuthResponse=function(e){return(0,n.__awaiter)(this,void 0,void 0,(function(){var t,r,i,s,o,a,u;return(0,n.__generator)(this,(function(c){switch(c.label){case 0:if(c.trys.push([0,5,,6]),t=e?(0,n.__assign)((0,n.__assign)({},((0,_.parse)(e).hash||"#").substr(1).split("&").map((function(e){return e.split("=")})).reduce((function(e,t){var r=(0,n.__read)(t,2),i=r[0],s=r[1];return e[i]=s,e}),{})),((0,_.parse)(e).query||"").split("&").map((function(e){return e.split("=")})).reduce((function(e,t){var r=(0,n.__read)(t,2),i=r[0],s=r[1];return e[i]=s,e}),{})):{},r=t.error,i=t.error_description,r)throw new Error(i);return s=this._validateState(t),P.debug("Starting "+this._config.responseType+" flow with "+e),"code"!==this._config.responseType?[3,2]:(o=[{}],[4,this._handleCodeFlow(e)]);case 1:return[2,n.__assign.apply(void 0,[n.__assign.apply(void 0,o.concat([c.sent()])),{state:s}])];case 2:return a=[{}],[4,this._handleImplicitFlow(e)];case 3:return[2,n.__assign.apply(void 0,[n.__assign.apply(void 0,a.concat([c.sent()])),{state:s}])];case 4:return[3,6];case 5:throw u=c.sent(),P.debug("Error handling auth response.",u),u;case 6:return[2]}}))}))},e.prototype._validateState=function(e){if(e){var t,r=(t=window.sessionStorage.getItem("oauth_state"),window.sessionStorage.removeItem("oauth_state"),t),n=e.state;if(r&&r!==n)throw new Error("Invalid state in OAuth flow");return n}},e.prototype.signOut=function(){return(0,n.__awaiter)(this,void 0,void 0,(function(){var e,t,r;return(0,n.__generator)(this,(function(s){return e="https://"+this._config.domain+"/logout?",t=(0,i.fz)(this._config)?this._cognitoClientId:this._config.oauth.clientID,r=(0,i.fz)(this._config)?this._config.redirectSignOut:this._config.returnTo,e+=Object.entries({client_id:t,logout_uri:encodeURIComponent(r)}).map((function(e){var t=(0,n.__read)(e,2);return t[0]+"="+t[1]})).join("&"),I("oAuthSignOut",{oAuth:"signOut"},"Signing out from "+e),P.debug("Signing out from "+e),[2,this._urlOpener(e,r)]}))}))},e.prototype._generateState=function(e){for(var t="",r=e,n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";r>0;--r)t+=n[Math.round(61*Math.random())];return t},e.prototype._generateChallenge=function(e){var t=new S.Sha256;t.update(e);var r=t.digestSync(),n=v.Buffer.from(r).toString("base64");return this._base64URL(n)},e.prototype._base64URL=function(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},e.prototype._generateRandom=function(e){var t=new Uint8Array(e);if("undefined"!=typeof window&&window.crypto)window.crypto.getRandomValues(t);else for(var r=0;r<e;r+=1)t[r]=66*Math.random()|0;return this._bufferToString(t)},e.prototype._bufferToString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=[],n=0;n<e.byteLength;n+=1){var i=e[n]%62;r.push(t[i])}return r.join("")},e}();var E;!function(e){e.DEFAULT_MSG="Authentication Error",e.EMPTY_EMAIL="Email cannot be empty",e.EMPTY_PHONE="Phone number cannot be empty",e.EMPTY_USERNAME="Username cannot be empty",e.INVALID_USERNAME="The username should either be a string or one of the sign in types",e.EMPTY_PASSWORD="Password cannot be empty",e.EMPTY_CODE="Confirmation code cannot be empty",e.SIGN_UP_ERROR="Error creating account",e.NO_MFA="No valid MFA method provided",e.INVALID_MFA="Invalid MFA type",e.EMPTY_CHALLENGE="Challenge response cannot be empty",e.NO_USER_SESSION="Failed to get the session because the user is empty",e.NETWORK_ERROR="Network Error",e.DEVICE_CONFIG="Device tracking has not been configured in this User Pool",e.AUTOSIGNIN_ERROR="Please use your credentials to sign in"}(E||(E={}));var C=new s.C("AuthError"),M=function(e){function t(r){var n=this,i=T[r],s=i.message,o=i.log;return(n=e.call(this,s)||this).constructor=t,Object.setPrototypeOf(n,t.prototype),n.name="AuthError",n.log=o||s,C.error(n.log),n}return(0,n.__extends)(t,e),t}(Error),O=function(e){function t(r){var n=e.call(this,r)||this;return n.constructor=t,Object.setPrototypeOf(n,t.prototype),n.name="NoUserPoolError",n}return(0,n.__extends)(t,e),t}(M),T={noConfig:{message:E.DEFAULT_MSG,log:"\n            Error: Amplify has not been configured correctly.\n            This error is typically caused by one of the following scenarios:\n\n            1. Make sure you're passing the awsconfig object to Amplify.configure() in your app's entry point\n                See https://aws-amplify.github.io/docs/js/authentication#configure-your-app for more information\n            \n            2. There might be multiple conflicting versions of amplify packages in your node_modules.\n\t\t\t\tRefer to our docs site for help upgrading Amplify packages (https://docs.amplify.aws/lib/troubleshooting/upgrading/q/platform/js)\n        "},missingAuthConfig:{message:E.DEFAULT_MSG,log:"\n            Error: Amplify has not been configured correctly. \n            The configuration object is missing required auth properties.\n            This error is typically caused by one of the following scenarios:\n\n            1. Did you run `amplify push` after adding auth via `amplify add auth`?\n                See https://aws-amplify.github.io/docs/js/authentication#amplify-project-setup for more information\n\n            2. This could also be caused by multiple conflicting versions of amplify packages, see (https://docs.amplify.aws/lib/troubleshooting/upgrading/q/platform/js) for help upgrading Amplify packages.\n        "},emptyUsername:{message:E.EMPTY_USERNAME},invalidUsername:{message:E.INVALID_USERNAME},emptyPassword:{message:E.EMPTY_PASSWORD},emptyCode:{message:E.EMPTY_CODE},signUpError:{message:E.SIGN_UP_ERROR,log:"The first parameter should either be non-null string or object"},noMFA:{message:E.NO_MFA},invalidMFA:{message:E.INVALID_MFA},emptyChallengeResponse:{message:E.EMPTY_CHALLENGE},noUserSession:{message:E.NO_USER_SESSION},deviceConfig:{message:E.DEVICE_CONFIG},networkError:{message:E.NETWORK_ERROR},autoSignInError:{message:E.AUTOSIGNIN_ERROR},default:{message:E.DEFAULT_MSG}},k=new s.C("AuthClass"),N="aws.cognito.signin.user.admin",F="undefined"!=typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("amplify_default"):"@@amplify_default",R=function(e,t,r){o.Y.dispatch("auth",{event:e,data:t,message:r},"Auth",F)},j=new(function(){function e(e){var t=this;this.userPool=null,this.user=null,this.oAuthFlowInProgress=!1,this.autoSignInInitiated=!1,this.inflightSessionPromise=null,this.inflightSessionPromiseCounter=0,this.Credentials=a.J,this.wrapRefreshSessionCallback=function(e){return function(t,r){return r?R("tokenRefresh",void 0,"New token retrieved"):R("tokenRefresh_failure",t,"Failed to retrieve new token"),e(t,r)}},this.configure(e),this.currentCredentials=this.currentCredentials.bind(this),this.currentUserCredentials=this.currentUserCredentials.bind(this),o.Y.listen("auth",(function(e){switch(e.payload.event){case"verify":case"signIn":t._storage.setItem("amplify-signin-with-hostedUI","false");break;case"signOut":t._storage.removeItem("amplify-signin-with-hostedUI");break;case"cognitoHostedUI":t._storage.setItem("amplify-signin-with-hostedUI","true")}})),(0,m.m)(),(0,m.A)(u.OD.framework),u.OD.observeFrameworkChanges((function(){(0,m.A)(u.OD.framework)}))}return e.prototype.getModuleName=function(){return"Auth"},e.prototype.configure=function(e){var t=this;if(!e)return this._config||{};k.debug("configure Auth");var r=Object.assign({},this._config,(0,c.s)(e).Auth,e);this._config=r;var n=this._config,s=n.userPoolId,o=n.userPoolWebClientId,a=n.cookieStorage,u=n.oauth,f=n.region,g=n.identityPoolId,m=n.mandatorySignIn,_=n.refreshHandlers,y=n.identityPoolRegion,v=n.clientMetadata,b=n.endpoint,w=n.storage;if(w){if(!this._isValidAuthStorage(w))throw k.error("The storage in the Auth config is not valid!"),new Error("Empty storage object");this._storage=w}else this._storage=a?new p.W6(a):e.ssr?new d.l:(new l.i).getStorage();if(this._storageSync=Promise.resolve(),"function"==typeof this._storage.sync&&(this._storageSync=this._storage.sync()),s){var S={UserPoolId:s,ClientId:o,endpoint:b};S.Storage=this._storage,this.userPool=new p.NE(S,this.wrapRefreshSessionCallback)}this.Credentials.configure({mandatorySignIn:m,region:f,userPoolId:s,identityPoolId:g,refreshHandlers:_,storage:this._storage,identityPoolRegion:y});var A=u?(0,i.fz)(this._config.oauth)?u:u.awsCognito:void 0;if(A){var I=Object.assign({cognitoClientId:o,UserPoolId:s,domain:A.domain,scopes:A.scope,redirectSignIn:A.redirectSignIn,redirectSignOut:A.redirectSignOut,responseType:A.responseType,Storage:this._storage,urlOpener:A.urlOpener,clientMetadata:v},A.options);this._oAuthHandler=new U({scopes:I.scopes,config:I,cognitoClientId:I.cognitoClientId});var P={};!function(e){if((0,h.gy)().isBrowser&&window.location)e({url:window.location.href});else if(!(0,h.gy)().isNode)throw new Error("Not supported")}((function(e){var r=e.url;P[r]||(P[r]=!0,t._handleAuthResponse(r))}))}(R("configured",null,"The Auth category has been configured successfully"),this.autoSignInInitiated||"function"!=typeof this._storage.getItem)||(this.isTrueStorageValue("amplify-polling-started")&&(R("autoSignIn_failure",null,i.Wo.AutoSignInError),this._storage.removeItem("amplify-auto-sign-in")),this._storage.removeItem("amplify-polling-started"));return this._config},e.prototype.signUp=function(e){for(var t,r,n,s=this,o=[],a=1;a<arguments.length;a++)o[a-1]=arguments[a];if(!this.userPool)return this.rejectNoUserPool();var u,c=null,d=null,l=[],h=null,f={enabled:!1},g={},m={};if(e&&"string"==typeof e){c=e,d=o?o[0]:null;var _=o?o[1]:null,y=o?o[2]:null;_&&l.push(new p.HB({Name:"email",Value:_})),y&&l.push(new p.HB({Name:"phone_number",Value:y}))}else{if(!e||"object"!=typeof e)return this.rejectAuthError(i.Wo.SignUpError);c=e.username,d=e.password,e&&e.clientMetadata?u=e.clientMetadata:this._config.clientMetadata&&(u=this._config.clientMetadata);var v=e.attributes;v&&Object.keys(v).map((function(e){l.push(new p.HB({Name:e,Value:v[e]}))}));var b=e.validationData;b&&(h=[],Object.keys(b).map((function(e){h.push(new p.HB({Name:e,Value:b[e]}))}))),(f=null!==(t=e.autoSignIn)&&void 0!==t?t:{enabled:!1}).enabled&&(this._storage.setItem("amplify-auto-sign-in","true"),g=null!==(r=f.validationData)&&void 0!==r?r:{},m=null!==(n=f.clientMetaData)&&void 0!==n?n:{})}return c?d?(k.debug("signUp attrs:",l),k.debug("signUp validation data:",h),new Promise((function(e,t){s.userPool.signUp(c,d,l,h,(function(r,n){r?(R("signUp_failure",r,c+" failed to signup"),t(r)):(R("signUp",n,c+" has signed up successfully"),f.enabled&&s.handleAutoSignIn(c,d,g,m,n),e(n))}),u)}))):this.rejectAuthError(i.Wo.EmptyPassword):this.rejectAuthError(i.Wo.EmptyUsername)},e.prototype.handleAutoSignIn=function(e,t,r,n,i){this.autoSignInInitiated=!0;var s=new p.By({Username:e,Password:t,ValidationData:r,ClientMetadata:n});i.userConfirmed?this.signInAfterUserConfirmed(s):"link"===this._config.signUpVerificationMethod?this.handleLinkAutoSignIn(s):this.handleCodeAutoSignIn(s)},e.prototype.handleCodeAutoSignIn=function(e){var t=this,r=function(n){"confirmSignUp"===n.payload.event&&t.signInAfterUserConfirmed(e,r)};o.Y.listen("auth",r)},e.prototype.handleLinkAutoSignIn=function(e){var t=this;this._storage.setItem("amplify-polling-started","true");var r=Date.now(),n=setInterval((function(){Date.now()-r>18e4?(clearInterval(n),R("autoSignIn_failure",null,"Please confirm your account and use your credentials to sign in."),t._storage.removeItem("amplify-auto-sign-in")):t.signInAfterUserConfirmed(e,null,n)}),5e3)},e.prototype.signInAfterUserConfirmed=function(e,t,r){return(0,n.__awaiter)(this,void 0,void 0,(function(){var i,s,a=this;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:i=this.createCognitoUser(e.getUsername()),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,i.authenticateUser(e,this.authCallbacks(i,(function(n){R("autoSignIn",n,e.getUsername()+" has signed in successfully"),t&&o.Y.remove("auth",t),r&&(clearInterval(r),a._storage.removeItem("amplify-polling-started")),a._storage.removeItem("amplify-auto-sign-in")}),(function(e){k.error(e),a._storage.removeItem("amplify-auto-sign-in")})))];case 2:return n.sent(),[3,4];case 3:return s=n.sent(),k.error(s),[3,4];case 4:return[2]}}))}))},e.prototype.confirmSignUp=function(e,t,r){var n=this;if(!this.userPool)return this.rejectNoUserPool();if(!e)return this.rejectAuthError(i.Wo.EmptyUsername);if(!t)return this.rejectAuthError(i.Wo.EmptyCode);var s,o=this.createCognitoUser(e),a=!r||"boolean"!=typeof r.forceAliasCreation||r.forceAliasCreation;return r&&r.clientMetadata?s=r.clientMetadata:this._config.clientMetadata&&(s=this._config.clientMetadata),new Promise((function(r,u){o.confirmRegistration(t,a,(function(t,s){t?u(t):(R("confirmSignUp",s,e+" has been confirmed successfully"),n.isTrueStorageValue("amplify-auto-sign-in")&&!n.autoSignInInitiated&&(R("autoSignIn_failure",null,i.Wo.AutoSignInError),n._storage.removeItem("amplify-auto-sign-in")),r(s))}),s)}))},e.prototype.isTrueStorageValue=function(e){var t=this._storage.getItem(e);return!!t&&"true"===t},e.prototype.resendSignUp=function(e,t){if(void 0===t&&(t=this._config.clientMetadata),!this.userPool)return this.rejectNoUserPool();if(!e)return this.rejectAuthError(i.Wo.EmptyUsername);var r=this.createCognitoUser(e);return new Promise((function(e,n){r.resendConfirmationCode((function(t,r){t?n(t):e(r)}),t)}))},e.prototype.signIn=function(e,t,r){if(void 0===r&&(r=this._config.clientMetadata),!this.userPool)return this.rejectNoUserPool();var n=null,s=null,o={};if("string"==typeof e)n=e,s=t;else{if(!(0,i.O9)(e))return this.rejectAuthError(i.Wo.InvalidUsername);void 0!==t&&k.warn("The password should be defined under the first parameter object!"),n=e.username,s=e.password,o=e.validationData}if(!n)return this.rejectAuthError(i.Wo.EmptyUsername);var a=new p.By({Username:n,Password:s,ValidationData:o,ClientMetadata:r});return s?this.signInWithPassword(a):this.signInWithoutPassword(a)},e.prototype.authCallbacks=function(e,t,r){var i=this,s=this;return{onSuccess:function(o){return(0,n.__awaiter)(i,void 0,void 0,(function(){var i,a,u,c;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:k.debug(o),delete e.challengeName,delete e.challengeParam,n.label=1;case 1:return n.trys.push([1,4,5,9]),[4,this.Credentials.clear()];case 2:return n.sent(),[4,this.Credentials.set(o,"session")];case 3:return i=n.sent(),k.debug("succeed to get cognito credentials",i),[3,9];case 4:return a=n.sent(),k.debug("cannot get cognito credentials",a),[3,9];case 5:return n.trys.push([5,7,,8]),[4,this.currentUserPoolUser()];case 6:return u=n.sent(),s.user=u,R("signIn",u,"A user "+e.getUsername()+" has been signed in"),t(u),[3,8];case 7:return c=n.sent(),k.error("Failed to get the signed in user",c),r(c),[3,8];case 8:return[7];case 9:return[2]}}))}))},onFailure:function(t){k.debug("signIn failure",t),R("signIn_failure",t,e.getUsername()+" failed to signin"),r(t)},customChallenge:function(r){k.debug("signIn custom challenge answer required"),e.challengeName="CUSTOM_CHALLENGE",e.challengeParam=r,t(e)},mfaRequired:function(r,n){k.debug("signIn MFA required"),e.challengeName=r,e.challengeParam=n,t(e)},mfaSetup:function(r,n){k.debug("signIn mfa setup",r),e.challengeName=r,e.challengeParam=n,t(e)},newPasswordRequired:function(r,n){k.debug("signIn new password"),e.challengeName="NEW_PASSWORD_REQUIRED",e.challengeParam={userAttributes:r,requiredAttributes:n},t(e)},totpRequired:function(r,n){k.debug("signIn totpRequired"),e.challengeName=r,e.challengeParam=n,t(e)},selectMFAType:function(r,n){k.debug("signIn selectMFAType",r),e.challengeName=r,e.challengeParam=n,t(e)}}},e.prototype.signInWithPassword=function(e){var t=this;if(this.pendingSignIn)throw new Error("Pending sign-in attempt already in progress");var r=this.createCognitoUser(e.getUsername());return this.pendingSignIn=new Promise((function(n,i){r.authenticateUser(e,t.authCallbacks(r,(function(e){t.pendingSignIn=null,n(e)}),(function(e){t.pendingSignIn=null,i(e)})))})),this.pendingSignIn},e.prototype.signInWithoutPassword=function(e){var t=this,r=this.createCognitoUser(e.getUsername());return r.setAuthenticationFlowType("CUSTOM_AUTH"),new Promise((function(n,i){r.initiateAuth(e,t.authCallbacks(r,n,i))}))},e.prototype.getMFAOptions=function(e){return new Promise((function(t,r){e.getMFAOptions((function(e,n){if(e)return k.debug("get MFA Options failed",e),void r(e);k.debug("get MFA options success",n),t(n)}))}))},e.prototype.getPreferredMFA=function(e,t){var r=this,i=this;return new Promise((function(s,o){var a=r._config.clientMetadata,u=!!t&&t.bypassCache;e.getUserData((function(t,a){return(0,n.__awaiter)(r,void 0,void 0,(function(){var r,u;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:if(!t)return[3,5];if(k.debug("getting preferred mfa failed",t),!this.isSessionInvalid(t))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.cleanUpInvalidSession(e)];case 2:return n.sent(),[3,4];case 3:return r=n.sent(),o(new Error("Session is invalid due to: "+t.message+" and failed to clean up invalid session: "+r.message)),[2];case 4:return o(t),[2];case 5:return(u=i._getMfaTypeFromUserData(a))?(s(u),[2]):(o("invalid MFA Type"),[2])}}))}))}),{bypassCache:u,clientMetadata:a})}))},e.prototype._getMfaTypeFromUserData=function(e){var t=null,r=e.PreferredMfaSetting;if(r)t=r;else{var n=e.UserMFASettingList;if(n)0===n.length?t="NOMFA":k.debug("invalid case for getPreferredMFA",e);else t=e.MFAOptions?"SMS_MFA":"NOMFA"}return t},e.prototype._getUserData=function(e,t){var r=this;return new Promise((function(i,s){e.getUserData((function(t,o){return(0,n.__awaiter)(r,void 0,void 0,(function(){var r;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:if(!t)return[3,5];if(k.debug("getting user data failed",t),!this.isSessionInvalid(t))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.cleanUpInvalidSession(e)];case 2:return n.sent(),[3,4];case 3:return r=n.sent(),s(new Error("Session is invalid due to: "+t.message+" and failed to clean up invalid session: "+r.message)),[2];case 4:return s(t),[2];case 5:i(o),n.label=6;case 6:return[2]}}))}))}),t)}))},e.prototype.setPreferredMFA=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,s,o,a,u,c,d=this;return(0,n.__generator)(this,(function(l){switch(l.label){case 0:return r=this._config.clientMetadata,[4,this._getUserData(e,{bypassCache:!0,clientMetadata:r})];case 1:switch(s=l.sent(),o=null,a=null,t){case"TOTP":case"SOFTWARE_TOKEN_MFA":return[3,2];case"SMS":case"SMS_MFA":return[3,3];case"NOMFA":return[3,4]}return[3,6];case 2:return a={PreferredMfa:!0,Enabled:!0},[3,7];case 3:return o={PreferredMfa:!0,Enabled:!0},[3,7];case 4:return u=s.UserMFASettingList,[4,this._getMfaTypeFromUserData(s)];case 5:if("NOMFA"===(c=l.sent()))return[2,Promise.resolve("No change for mfa type")];if("SMS_MFA"===c)o={PreferredMfa:!1,Enabled:!1};else{if("SOFTWARE_TOKEN_MFA"!==c)return[2,this.rejectAuthError(i.Wo.InvalidMFA)];a={PreferredMfa:!1,Enabled:!1}}return u&&0!==u.length&&u.forEach((function(e){"SMS_MFA"===e?o={PreferredMfa:!1,Enabled:!1}:"SOFTWARE_TOKEN_MFA"===e&&(a={PreferredMfa:!1,Enabled:!1})})),[3,7];case 6:return k.debug("no validmfa method provided"),[2,this.rejectAuthError(i.Wo.NoMFA)];case 7:return[2,new Promise((function(t,i){e.setUserMfaPreference(o,a,(function(s,o){if(s)return k.debug("Set user mfa preference error",s),i(s);k.debug("Set user mfa success",o),k.debug("Caching the latest user data into local"),e.getUserData((function(r,s){return(0,n.__awaiter)(d,void 0,void 0,(function(){var s;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:if(!r)return[3,5];if(k.debug("getting user data failed",r),!this.isSessionInvalid(r))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.cleanUpInvalidSession(e)];case 2:return n.sent(),[3,4];case 3:return s=n.sent(),i(new Error("Session is invalid due to: "+r.message+" and failed to clean up invalid session: "+s.message)),[2];case 4:return[2,i(r)];case 5:return[2,t(o)]}}))}))}),{bypassCache:!0,clientMetadata:r})}))}))]}}))}))},e.prototype.disableSMS=function(e){return new Promise((function(t,r){e.disableMFA((function(e,n){if(e)return k.debug("disable mfa failed",e),void r(e);k.debug("disable mfa succeed",n),t(n)}))}))},e.prototype.enableSMS=function(e){return new Promise((function(t,r){e.enableMFA((function(e,n){if(e)return k.debug("enable mfa failed",e),void r(e);k.debug("enable mfa succeed",n),t(n)}))}))},e.prototype.setupTOTP=function(e){return new Promise((function(t,r){e.associateSoftwareToken({onFailure:function(e){k.debug("associateSoftwareToken failed",e),r(e)},associateSecretCode:function(e){k.debug("associateSoftwareToken success",e),t(e)}})}))},e.prototype.verifyTotpToken=function(e,t){var r;k.debug("verification totp token",e,t),e&&"function"==typeof e.getSignInUserSession&&(r=e.getSignInUserSession());var n=null==r?void 0:r.isValid();return new Promise((function(r,i){e.verifySoftwareToken(t,"My TOTP device",{onFailure:function(e){k.debug("verifyTotpToken failed",e),i(e)},onSuccess:function(t){n||R("signIn",e,"A user "+e.getUsername()+" has been signed in"),R("verify",e,"A user "+e.getUsername()+" has been verified"),k.debug("verifyTotpToken success",t),r(t)}})}))},e.prototype.confirmSignIn=function(e,t,r,s){var o=this;if(void 0===s&&(s=this._config.clientMetadata),!t)return this.rejectAuthError(i.Wo.EmptyCode);var a=this;return new Promise((function(i,u){e.sendMFACode(t,{onSuccess:function(t){return(0,n.__awaiter)(o,void 0,void 0,(function(){var r,s,o,u;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:k.debug(t),n.label=1;case 1:return n.trys.push([1,4,5,10]),[4,this.Credentials.clear()];case 2:return n.sent(),[4,this.Credentials.set(t,"session")];case 3:return r=n.sent(),k.debug("succeed to get cognito credentials",r),[3,10];case 4:return s=n.sent(),k.debug("cannot get cognito credentials",s),[3,10];case 5:a.user=e,n.label=6;case 6:return n.trys.push([6,8,,9]),[4,this.currentUserPoolUser()];case 7:return o=n.sent(),e.attributes=o.attributes,[3,9];case 8:return u=n.sent(),k.debug("cannot get updated Cognito User",u),[3,9];case 9:return R("signIn",e,"A user "+e.getUsername()+" has been signed in"),i(e),[7];case 10:return[2]}}))}))},onFailure:function(e){k.debug("confirm signIn failure",e),u(e)}},r,s)}))},e.prototype.completeNewPassword=function(e,t,r,s){var o=this;if(void 0===r&&(r={}),void 0===s&&(s=this._config.clientMetadata),!t)return this.rejectAuthError(i.Wo.EmptyPassword);var a=this;return new Promise((function(i,u){e.completeNewPasswordChallenge(t,r,{onSuccess:function(t){return(0,n.__awaiter)(o,void 0,void 0,(function(){var r,s;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:k.debug(t),n.label=1;case 1:return n.trys.push([1,4,5,6]),[4,this.Credentials.clear()];case 2:return n.sent(),[4,this.Credentials.set(t,"session")];case 3:return r=n.sent(),k.debug("succeed to get cognito credentials",r),[3,6];case 4:return s=n.sent(),k.debug("cannot get cognito credentials",s),[3,6];case 5:return a.user=e,R("signIn",e,"A user "+e.getUsername()+" has been signed in"),i(e),[7];case 6:return[2]}}))}))},onFailure:function(e){k.debug("completeNewPassword failure",e),R("completeNewPassword_failure",e,o.user+" failed to complete the new password flow"),u(e)},mfaRequired:function(t,r){k.debug("signIn MFA required"),e.challengeName=t,e.challengeParam=r,i(e)},mfaSetup:function(t,r){k.debug("signIn mfa setup",t),e.challengeName=t,e.challengeParam=r,i(e)},totpRequired:function(t,r){k.debug("signIn mfa setup",t),e.challengeName=t,e.challengeParam=r,i(e)}},s)}))},e.prototype.sendCustomChallengeAnswer=function(e,t,r){var n=this;if(void 0===r&&(r=this._config.clientMetadata),!this.userPool)return this.rejectNoUserPool();if(!t)return this.rejectAuthError(i.Wo.EmptyChallengeResponse);return new Promise((function(i,s){e.sendCustomChallengeAnswer(t,n.authCallbacks(e,i,s),r)}))},e.prototype.deleteUserAttributes=function(e,t){var r=this;return new Promise((function(n,i){r.userSession(e).then((function(r){e.deleteAttributes(t,(function(e,t){return e?i(e):n(t)}))}))}))},e.prototype.deleteUser=function(){return(0,n.__awaiter)(this,void 0,void 0,(function(){var e,t,r=this;return(0,n.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._storageSync];case 1:return i.sent(),[3,3];case 2:throw e=i.sent(),k.debug("Failed to sync cache info into memory",e),new Error(e);case 3:return t=this._oAuthHandler&&"true"===this._storage.getItem("amplify-signin-with-hostedUI"),[2,new Promise((function(e,i){return(0,n.__awaiter)(r,void 0,void 0,(function(){var r,s=this;return(0,n.__generator)(this,(function(o){if(this.userPool){if(!(r=this.userPool.getCurrentUser()))return k.debug("Failed to get user from user pool"),[2,i(new Error("No current user."))];r.getSession((function(o,a){return(0,n.__awaiter)(s,void 0,void 0,(function(){var s,a=this;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:if(!o)return[3,5];if(k.debug("Failed to get the user session",o),!this.isSessionInvalid(o))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.cleanUpInvalidSession(r)];case 2:return n.sent(),[3,4];case 3:return s=n.sent(),i(new Error("Session is invalid due to: "+o.message+" and failed to clean up invalid session: "+s.message)),[2];case 4:return[2,i(o)];case 5:r.deleteUser((function(n,s){if(n)i(n);else{R("userDeleted",s,"The authenticated user has been deleted."),r.signOut(),a.user=null;try{a.cleanCachedItems()}catch(e){k.debug("failed to clear cached items")}t?a.oAuthSignOutRedirect(e,i):(R("signOut",a.user,"A user has been signed out"),e(s))}})),n.label=6;case 6:return[2]}}))}))}))}else k.debug("no Congito User pool"),i(new Error("Cognito User pool does not exist"));return[2]}))}))}))]}}))}))},e.prototype.updateUserAttributes=function(e,t,r){var n=this;void 0===r&&(r=this._config.clientMetadata);var i=[],s=this;return new Promise((function(o,a){s.userSession(e).then((function(s){for(var u in t)if("sub"!==u&&u.indexOf("_verified")<0){var c={Name:u,Value:t[u]};i.push(c)}e.updateAttributes(i,(function(e,r,i){if(e)return R("updateUserAttributes_failure",e,"Failed to update attributes"),a(e);var s=n.createUpdateAttributesResultList(t,null==i?void 0:i.CodeDeliveryDetailsList);return R("updateUserAttributes",s,"Attributes successfully updated"),o(r)}),r)}))}))},e.prototype.createUpdateAttributesResultList=function(e,t){var r={};return Object.keys(e).forEach((function(e){r[e]={isUpdated:!0};var n=null==t?void 0:t.find((function(t){return t.AttributeName===e}));n&&(r[e].isUpdated=!1,r[e].codeDeliveryDetails=n)})),r},e.prototype.userAttributes=function(e){var t=this;return new Promise((function(r,n){t.userSession(e).then((function(t){e.getUserAttributes((function(e,t){e?n(e):r(t)}))}))}))},e.prototype.verifiedContact=function(e){var t=this;return this.userAttributes(e).then((function(e){var r=t.attributesToObject(e),n={},i={};return r.email&&(r.email_verified?i.email=r.email:n.email=r.email),r.phone_number&&(r.phone_number_verified?i.phone_number=r.phone_number:n.phone_number=r.phone_number),{verified:i,unverified:n}}))},e.prototype.isErrorWithMessage=function(e){return"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"message")},e.prototype.isTokenRevokedError=function(e){return this.isErrorWithMessage(e)&&"Access Token has been revoked"===e.message},e.prototype.isRefreshTokenRevokedError=function(e){return this.isErrorWithMessage(e)&&"Refresh Token has been revoked"===e.message},e.prototype.isUserDisabledError=function(e){return this.isErrorWithMessage(e)&&"User is disabled."===e.message},e.prototype.isUserDoesNotExistError=function(e){return this.isErrorWithMessage(e)&&"User does not exist."===e.message},e.prototype.isRefreshTokenExpiredError=function(e){return this.isErrorWithMessage(e)&&"Refresh Token has expired"===e.message},e.prototype.isPasswordResetRequiredError=function(e){return this.isErrorWithMessage(e)&&"Password reset required for the user"===e.message},e.prototype.isSignedInHostedUI=function(){return this._oAuthHandler&&"true"===this._storage.getItem("amplify-signin-with-hostedUI")},e.prototype.isSessionInvalid=function(e){return this.isUserDisabledError(e)||this.isUserDoesNotExistError(e)||this.isTokenRevokedError(e)||this.isRefreshTokenRevokedError(e)||this.isRefreshTokenExpiredError(e)||this.isPasswordResetRequiredError(e)},e.prototype.cleanUpInvalidSession=function(e){return(0,n.__awaiter)(this,void 0,void 0,(function(){var t=this;return(0,n.__generator)(this,(function(r){switch(r.label){case 0:e.signOut(),this.user=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.cleanCachedItems()];case 2:return r.sent(),[3,4];case 3:return r.sent(),k.debug("failed to clear cached items"),[3,4];case 4:return this.isSignedInHostedUI()?[2,new Promise((function(e,r){t.oAuthSignOutRedirect(e,r)}))]:(R("signOut",this.user,"A user has been signed out"),[2])}}))}))},e.prototype.currentUserPoolUser=function(e){var t=this;return this.userPool?new Promise((function(r,i){t._storageSync.then((function(){return(0,n.__awaiter)(t,void 0,void 0,(function(){var t,s,a,u,c,d,l=this;return(0,n.__generator)(this,(function(h){switch(h.label){case 0:return this.isOAuthInProgress()?(k.debug("OAuth signIn in progress, waiting for resolution..."),[4,new Promise((function(e){var t=setTimeout((function(){k.debug("OAuth signIn in progress timeout"),o.Y.remove("auth",r),e()}),1e4);function r(n){var i=n.payload.event;"cognitoHostedUI"!==i&&"cognitoHostedUI_failure"!==i||(k.debug("OAuth signIn resolved: "+i),clearTimeout(t),o.Y.remove("auth",r),e())}o.Y.listen("auth",r)}))]):[3,2];case 1:h.sent(),h.label=2;case 2:if(!(t=this.userPool.getCurrentUser()))return k.debug("Failed to get user from user pool"),i("No current user"),[2];h.label=3;case 3:return h.trys.push([3,7,,8]),[4,this._userSession(t)];case 4:return s=h.sent(),(a=!!e&&e.bypassCache)?[4,this.Credentials.clear()]:[3,6];case 5:h.sent(),h.label=6;case 6:return u=this._config.clientMetadata,c=s.getAccessToken().decodePayload().scope,(void 0===c?"":c).split(" ").includes(N)?(t.getUserData((function(e,s){return(0,n.__awaiter)(l,void 0,void 0,(function(){var o,a,u,c,d,l,h;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:if(!e)return[3,7];if(k.debug("getting user data failed",e),!this.isSessionInvalid(e))return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.cleanUpInvalidSession(t)];case 2:return n.sent(),[3,4];case 3:return o=n.sent(),i(new Error("Session is invalid due to: "+e.message+" and failed to clean up invalid session: "+o.message)),[2];case 4:return i(e),[3,6];case 5:r(t),n.label=6;case 6:return[2];case 7:for(a=s.PreferredMfaSetting||"NOMFA",u=[],c=0;c<s.UserAttributes.length;c++)d={Name:s.UserAttributes[c].Name,Value:s.UserAttributes[c].Value},l=new p.HB(d),u.push(l);return h=this.attributesToObject(u),Object.assign(t,{attributes:h,preferredMFA:a}),[2,r(t)]}}))}))}),{bypassCache:a,clientMetadata:u}),[3,8]):(k.debug("Unable to get the user data because the "+N+" is not in the scopes of the access token"),[2,r(t)]);case 7:return d=h.sent(),i(d),[3,8];case 8:return[2]}}))}))})).catch((function(e){return k.debug("Failed to sync cache info into memory",e),i(e)}))})):this.rejectNoUserPool()},e.prototype.isOAuthInProgress=function(){return this.oAuthFlowInProgress},e.prototype.currentAuthenticatedUser=function(e){return(0,n.__awaiter)(this,void 0,void 0,(function(){var t,r,i,s,o;return(0,n.__generator)(this,(function(a){switch(a.label){case 0:k.debug("getting current authenticated user"),t=null,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this._storageSync];case 2:return a.sent(),[3,4];case 3:throw r=a.sent(),k.debug("Failed to sync cache info into memory",r),r;case 4:try{(i=JSON.parse(this._storage.getItem("aws-amplify-federatedInfo")))&&(t=(0,n.__assign)((0,n.__assign)({},i.user),{token:i.token}))}catch(e){k.debug("cannot load federated user from auth storage")}return t?(this.user=t,k.debug("get current authenticated federated user",this.user),[2,this.user]):[3,5];case 5:k.debug("get current authenticated userpool user"),s=null,a.label=6;case 6:return a.trys.push([6,8,,9]),[4,this.currentUserPoolUser(e)];case 7:return s=a.sent(),[3,9];case 8:return"No userPool"===(o=a.sent())&&k.error("Cannot get the current user because the user pool is missing. Please make sure the Auth module is configured with a valid Cognito User Pool ID"),k.debug("The user is not authenticated by the error",o),[2,Promise.reject("The user is not authenticated")];case 9:return this.user=s,[2,this.user]}}))}))},e.prototype.currentSession=function(){var e=this;return k.debug("Getting current session"),this.userPool?new Promise((function(t,r){e.currentUserPoolUser().then((function(n){e.userSession(n).then((function(e){t(e)})).catch((function(e){k.debug("Failed to get the current session",e),r(e)}))})).catch((function(e){k.debug("Failed to get the current user",e),r(e)}))})):Promise.reject(new Error("No User Pool in the configuration."))},e.prototype._userSession=function(e){return(0,n.__awaiter)(this,void 0,void 0,(function(){var t,r,s=this;return(0,n.__generator)(this,(function(o){switch(o.label){case 0:if(!e)return k.debug("the user is null"),[2,this.rejectAuthError(i.Wo.NoUserSession)];t=this._config.clientMetadata,0===this.inflightSessionPromiseCounter&&(this.inflightSessionPromise=new Promise((function(r,i){e.getSession((function(t,o){return(0,n.__awaiter)(s,void 0,void 0,(function(){var s;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:if(!t)return[3,5];if(k.debug("Failed to get the session from user",e),!this.isSessionInvalid(t))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.cleanUpInvalidSession(e)];case 2:return n.sent(),[3,4];case 3:return s=n.sent(),i(new Error("Session is invalid due to: "+t.message+" and failed to clean up invalid session: "+s.message)),[2];case 4:return i(t),[2];case 5:return k.debug("Succeed to get the user session",o),r(o),[2]}}))}))}),{clientMetadata:t})}))),this.inflightSessionPromiseCounter++,o.label=1;case 1:return o.trys.push([1,,3,4]),[4,this.inflightSessionPromise];case 2:return r=o.sent(),e.signInUserSession=r,[2,r];case 3:return this.inflightSessionPromiseCounter--,[7];case 4:return[2]}}))}))},e.prototype.userSession=function(e){return this._userSession(e)},e.prototype.currentUserCredentials=function(){return(0,n.__awaiter)(this,void 0,void 0,(function(){var e,t,r=this;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:k.debug("Getting current user credentials"),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._storageSync];case 2:return n.sent(),[3,4];case 3:throw e=n.sent(),k.debug("Failed to sync cache info into memory",e),e;case 4:t=null;try{t=JSON.parse(this._storage.getItem("aws-amplify-federatedInfo"))}catch(e){k.debug("failed to get or parse item aws-amplify-federatedInfo",e)}return t?[2,this.Credentials.refreshFederatedToken(t)]:[2,this.currentSession().then((function(e){return k.debug("getting session success",e),r.Credentials.set(e,"session")})).catch((function(){return k.debug("getting guest credentials"),r.Credentials.set(null,"guest")}))]}}))}))},e.prototype.currentCredentials=function(){return k.debug("getting current credentials"),this.Credentials.get()},e.prototype.verifyUserAttribute=function(e,t,r){return void 0===r&&(r=this._config.clientMetadata),new Promise((function(n,i){e.getAttributeVerificationCode(t,{onSuccess:function(e){return n(e)},onFailure:function(e){return i(e)}},r)}))},e.prototype.verifyUserAttributeSubmit=function(e,t,r){return r?new Promise((function(n,i){e.verifyAttribute(t,r,{onSuccess:function(e){n(e)},onFailure:function(e){i(e)}})})):this.rejectAuthError(i.Wo.EmptyCode)},e.prototype.verifyCurrentUserAttribute=function(e){var t=this;return t.currentUserPoolUser().then((function(r){return t.verifyUserAttribute(r,e)}))},e.prototype.verifyCurrentUserAttributeSubmit=function(e,t){var r=this;return r.currentUserPoolUser().then((function(n){return r.verifyUserAttributeSubmit(n,e,t)}))},e.prototype.cognitoIdentitySignOut=function(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function(){var r,i,s=this;return(0,n.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this._storageSync];case 1:return o.sent(),[3,3];case 2:throw r=o.sent(),k.debug("Failed to sync cache info into memory",r),r;case 3:return i=this._oAuthHandler&&"true"===this._storage.getItem("amplify-signin-with-hostedUI"),[2,new Promise((function(r,o){if(e&&e.global){k.debug("user global sign out",t);var a=s._config.clientMetadata;t.getSession((function(e,a){return(0,n.__awaiter)(s,void 0,void 0,(function(){var s,a=this;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:if(!e)return[3,5];if(k.debug("failed to get the user session",e),!this.isSessionInvalid(e))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.cleanUpInvalidSession(t)];case 2:return n.sent(),[3,4];case 3:return s=n.sent(),o(new Error("Session is invalid due to: "+e.message+" and failed to clean up invalid session: "+s.message)),[2];case 4:return[2,o(e)];case 5:return t.globalSignOut({onSuccess:function(e){if(k.debug("global sign out success"),!i)return r();a.oAuthSignOutRedirect(r,o)},onFailure:function(e){return k.debug("global sign out failed",e),o(e)}}),[2]}}))}))}),{clientMetadata:a})}else k.debug("user sign out",t),t.signOut((function(){if(!i)return r();s.oAuthSignOutRedirect(r,o)}))}))]}}))}))},e.prototype.oAuthSignOutRedirect=function(e,t){(0,h.gy)().isBrowser?this.oAuthSignOutRedirectOrReject(t):this.oAuthSignOutAndResolve(e)},e.prototype.oAuthSignOutAndResolve=function(e){this._oAuthHandler.signOut(),e()},e.prototype.oAuthSignOutRedirectOrReject=function(e){this._oAuthHandler.signOut(),setTimeout((function(){return e(Error("Signout timeout fail"))}),3e3)},e.prototype.signOut=function(e){return void 0===e&&(e={}),(0,n.__awaiter)(this,void 0,void 0,(function(){var t,r;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.cleanCachedItems()];case 1:return n.sent(),[3,3];case 2:return n.sent(),k.debug("failed to clear cached items"),[3,3];case 3:if(!this.userPool)return[3,11];n.label=4;case 4:return n.trys.push([4,6,,7]),[4,this._storageSync];case 5:return n.sent(),[3,7];case 6:throw t=n.sent(),k.debug("Failed to sync cache info into memory",t),t;case 7:return(r=this.userPool.getCurrentUser())?[4,this.cognitoIdentitySignOut(e,r)]:[3,9];case 8:return n.sent(),[3,10];case 9:k.debug("no current Cognito user"),n.label=10;case 10:return[3,12];case 11:k.debug("no Cognito User pool"),n.label=12;case 12:return R("signOut",this.user,"A user has been signed out"),this.user=null,[2]}}))}))},e.prototype.cleanCachedItems=function(){return(0,n.__awaiter)(this,void 0,void 0,(function(){return(0,n.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.Credentials.clear()];case 1:return e.sent(),[2]}}))}))},e.prototype.changePassword=function(e,t,r,n){var i=this;return void 0===n&&(n=this._config.clientMetadata),new Promise((function(s,o){i.userSession(e).then((function(i){e.changePassword(t,r,(function(e,t){return e?(k.debug("change password failure",e),o(e)):s(t)}),n)}))}))},e.prototype.forgotPassword=function(e,t){if(void 0===t&&(t=this._config.clientMetadata),!this.userPool)return this.rejectNoUserPool();if(!e)return this.rejectAuthError(i.Wo.EmptyUsername);var r=this.createCognitoUser(e);return new Promise((function(n,i){r.forgotPassword({onSuccess:function(){n()},onFailure:function(t){k.debug("forgot password failure",t),R("forgotPassword_failure",t,e+" forgotPassword failed"),i(t)},inputVerificationCode:function(t){R("forgotPassword",r,e+" has initiated forgot password flow"),n(t)}},t)}))},e.prototype.forgotPasswordSubmit=function(e,t,r,n){if(void 0===n&&(n=this._config.clientMetadata),!this.userPool)return this.rejectNoUserPool();if(!e)return this.rejectAuthError(i.Wo.EmptyUsername);if(!t)return this.rejectAuthError(i.Wo.EmptyCode);if(!r)return this.rejectAuthError(i.Wo.EmptyPassword);var s=this.createCognitoUser(e);return new Promise((function(i,o){s.confirmPassword(t,r,{onSuccess:function(t){R("forgotPasswordSubmit",s,e+" forgotPasswordSubmit successful"),i(t)},onFailure:function(t){R("forgotPasswordSubmit_failure",t,e+" forgotPasswordSubmit failed"),o(t)}},n)}))},e.prototype.currentUserInfo=function(){return(0,n.__awaiter)(this,void 0,void 0,(function(){var e,t,r,i,s,o,a;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:return(e=this.Credentials.getCredSource())&&"aws"!==e&&"userPool"!==e?[3,9]:[4,this.currentUserPoolUser().catch((function(e){return k.error(e)}))];case 1:if(!(a=n.sent()))return[2,null];n.label=2;case 2:return n.trys.push([2,8,,9]),[4,this.userAttributes(a)];case 3:t=n.sent(),r=this.attributesToObject(t),i=null,n.label=4;case 4:return n.trys.push([4,6,,7]),[4,this.currentCredentials()];case 5:return i=n.sent(),[3,7];case 6:return s=n.sent(),k.debug("Failed to retrieve credentials while getting current user info",s),[3,7];case 7:return[2,{id:i?i.identityId:void 0,username:a.getUsername(),attributes:r}];case 8:return o=n.sent(),k.error("currentUserInfo error",o),[2,{}];case 9:return"federated"===e?[2,(a=this.user)||{}]:[2]}}))}))},e.prototype.federatedSignIn=function(e,t,r){return(0,n.__awaiter)(this,void 0,void 0,(function(){var s,o,a,u,c,d,l,h,f,g,p;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:if(!this._config.identityPoolId&&!this._config.userPoolId)throw new Error("Federation requires either a User Pool or Identity Pool in config");if(void 0===e&&this._config.identityPoolId&&!this._config.userPoolId)throw new Error("Federation with Identity Pools requires tokens passed as arguments");return(0,i.Ze)(e)||(0,i.qr)(e)||(0,i.f$)(e)||void 0===e?(s=e||{provider:i.qB.Cognito},c=(0,i.Ze)(s)?s.provider:s.customProvider,(0,i.Ze)(s),o=s.customState,this._config.userPoolId&&(a=(0,i.fz)(this._config.oauth)?this._config.userPoolWebClientId:this._config.oauth.clientID,u=(0,i.fz)(this._config.oauth)?this._config.oauth.redirectSignIn:this._config.oauth.redirectUri,this._oAuthHandler.oauthSignIn(this._config.oauth.responseType,this._config.oauth.domain,u,a,c,o)),[3,4]):[3,1];case 1:c=e;try{(d=JSON.stringify(JSON.parse(this._storage.getItem("aws-amplify-federatedInfo")).user))&&k.warn("There is already a signed in user: "+d+" in your app.\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tYou should not call Auth.federatedSignIn method again as it may cause unexpected behavior.")}catch(e){}return l=t.token,h=t.identity_id,f=t.expires_at,[4,this.Credentials.set({provider:c,token:l,identity_id:h,user:r,expires_at:f},"federation")];case 2:return g=n.sent(),[4,this.currentAuthenticatedUser()];case 3:return p=n.sent(),R("signIn",p,"A user "+p.username+" has been signed in"),k.debug("federated sign in credentials",g),[2,g];case 4:return[2]}}))}))},e.prototype._handleAuthResponse=function(e){return(0,n.__awaiter)(this,void 0,void 0,(function(){var t,r,i,s,o,a,u,c,d,l,g,m,y,v;return(0,n.__generator)(this,(function(b){switch(b.label){case 0:if(this.oAuthFlowInProgress)return k.debug("Skipping URL "+e+" current flow in progress"),[2];b.label=1;case 1:if(b.trys.push([1,,8,9]),this.oAuthFlowInProgress=!0,!this._config.userPoolId)throw new Error("OAuth responses require a User Pool defined in config");if(R("parsingCallbackUrl",{url:e},"The callback url is being parsed"),t=e||((0,h.gy)().isBrowser?window.location.href:""),r=!!((0,_.parse)(t).query||"").split("&").map((function(e){return e.split("=")})).find((function(e){var t=(0,n.__read)(e,1)[0];return"code"===t||"error"===t})),i=!!((0,_.parse)(t).hash||"#").substr(1).split("&").map((function(e){return e.split("=")})).find((function(e){var t=(0,n.__read)(e,1)[0];return"access_token"===t||"error"===t})),!r&&!i)return[3,7];this._storage.setItem("amplify-redirected-from-hosted-ui","true"),b.label=2;case 2:return b.trys.push([2,6,,7]),[4,this._oAuthHandler.handleAuthResponse(t)];case 3:return s=b.sent(),o=s.accessToken,a=s.idToken,u=s.refreshToken,c=s.state,d=new p.p4({IdToken:new p.Yw({IdToken:a}),RefreshToken:new p.c9({RefreshToken:u}),AccessToken:new p.pD({AccessToken:o})}),l=void 0,this._config.identityPoolId?[4,this.Credentials.set(d,"session")]:[3,5];case 4:l=b.sent(),k.debug("AWS credentials",l),b.label=5;case 5:return g=/-/.test(c),(m=this.createCognitoUser(d.getIdToken().decodePayload()["cognito:username"])).setSignInUserSession(d),window&&void 0!==window.history&&window.history.replaceState(window.history.state,"",this._config.oauth.redirectSignIn),R("signIn",m,"A user "+m.getUsername()+" has been signed in"),R("cognitoHostedUI",m,"A user "+m.getUsername()+" has been signed in via Cognito Hosted UI"),g&&(y=c.split("-").splice(1).join("-"),R("customOAuthState",(0,f.l)(y),"State for user "+m.getUsername())),[2,l];case 6:return v=b.sent(),k.debug("Error in cognito hosted auth response",v),window&&void 0!==window.history&&window.history.replaceState(window.history.state,"",this._config.oauth.redirectSignIn),R("signIn_failure",v,"The OAuth response flow failed"),R("cognitoHostedUI_failure",v,"A failure occurred when returning to the Cognito Hosted UI"),R("customState_failure",v,"A failure occurred when returning state"),[3,7];case 7:return[3,9];case 8:return this.oAuthFlowInProgress=!1,[7];case 9:return[2]}}))}))},e.prototype.essentialCredentials=function(e){return{accessKeyId:e.accessKeyId,sessionToken:e.sessionToken,secretAccessKey:e.secretAccessKey,identityId:e.identityId,authenticated:e.authenticated}},e.prototype.attributesToObject=function(e){var t=this,r={};return e&&e.map((function(e){"email_verified"===e.Name||"phone_number_verified"===e.Name?r[e.Name]=t.isTruthyString(e.Value)||!0===e.Value:r[e.Name]=e.Value})),r},e.prototype.isTruthyString=function(e){return"function"==typeof e.toLowerCase&&"true"===e.toLowerCase()},e.prototype.createCognitoUser=function(e){var t={Username:e,Pool:this.userPool};t.Storage=this._storage;var r=this._config.authenticationFlowType,n=new p.TU(t);return r&&n.setAuthenticationFlowType(r),n},e.prototype._isValidAuthStorage=function(e){return!!e&&"function"==typeof e.getItem&&"function"==typeof e.setItem&&"function"==typeof e.removeItem&&"function"==typeof e.clear},e.prototype.noUserPoolErrorHandler=function(e){return!e||e.userPoolId&&e.identityPoolId?i.Wo.NoConfig:i.Wo.MissingAuthConfig},e.prototype.rejectAuthError=function(e){return Promise.reject(new M(e))},e.prototype.rejectNoUserPool=function(){var e=this.noUserPoolErrorHandler(this._config);return Promise.reject(new O(e))},e.prototype.rememberDevice=function(){return(0,n.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,n.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.currentUserPoolUser()];case 1:return e=r.sent(),[3,3];case 2:return t=r.sent(),k.debug("The user is not authenticated by the error",t),[2,Promise.reject("The user is not authenticated")];case 3:return e.getCachedDeviceKeyAndPassword(),[2,new Promise((function(t,r){e.setDeviceStatusRemembered({onSuccess:function(e){t(e)},onFailure:function(e){"InvalidParameterException"===e.code?r(new M(i.Wo.DeviceConfig)):"NetworkError"===e.code?r(new M(i.Wo.NetworkError)):r(e)}})}))]}}))}))},e.prototype.forgetDevice=function(){return(0,n.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,n.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.currentUserPoolUser()];case 1:return e=r.sent(),[3,3];case 2:return t=r.sent(),k.debug("The user is not authenticated by the error",t),[2,Promise.reject("The user is not authenticated")];case 3:return e.getCachedDeviceKeyAndPassword(),[2,new Promise((function(t,r){e.forgetDevice({onSuccess:function(e){t(e)},onFailure:function(e){"InvalidParameterException"===e.code?r(new M(i.Wo.DeviceConfig)):"NetworkError"===e.code?r(new M(i.Wo.NetworkError)):r(e)}})}))]}}))}))},e.prototype.fetchDevices=function(){return(0,n.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,n.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.currentUserPoolUser()];case 1:return e=r.sent(),[3,3];case 2:throw t=r.sent(),k.debug("The user is not authenticated by the error",t),new Error("The user is not authenticated");case 3:return e.getCachedDeviceKeyAndPassword(),[2,new Promise((function(t,r){var n={onSuccess:function(e){var r=e.Devices.map((function(e){var t=e.DeviceAttributes.find((function(e){return"device_name"===e.Name}))||{};return{id:e.DeviceKey,name:t.Value}}));t(r)},onFailure:function(e){"InvalidParameterException"===e.code?r(new M(i.Wo.DeviceConfig)):"NetworkError"===e.code?r(new M(i.Wo.NetworkError)):r(e)}};e.listDevices(60,null,n)}))]}}))}))},e}())(null);g.H.register(j)},22924:(e,t,r)=>{var n,i,s;function o(e){return e&&!!["provider"].find((function(t){return e.hasOwnProperty(t)}))}function a(e){return e&&!!["customProvider"].find((function(t){return e.hasOwnProperty(t)}))}function u(e){return e&&!!["customState"].find((function(t){return e.hasOwnProperty(t)}))}function c(e){return void 0!==e.redirectSignIn}function d(e){return!!e.username}r.d(t,{O9:()=>d,Tv:()=>s,Wo:()=>i,Ze:()=>o,f$:()=>u,fz:()=>c,qB:()=>n,qr:()=>a}),function(e){e.Cognito="COGNITO",e.Google="Google",e.Facebook="Facebook",e.Amazon="LoginWithAmazon",e.Apple="SignInWithApple"}(n||(n={})),function(e){e.NoConfig="noConfig",e.MissingAuthConfig="missingAuthConfig",e.EmptyUsername="emptyUsername",e.InvalidUsername="invalidUsername",e.EmptyPassword="emptyPassword",e.EmptyCode="emptyCode",e.SignUpError="signUpError",e.NoMFA="noMFA",e.InvalidMFA="invalidMFA",e.EmptyChallengeResponse="emptyChallengeResponse",e.NoUserSession="noUserSession",e.Default="default",e.DeviceConfig="deviceConfig",e.NetworkError="networkError",e.AutoSignInError="autoSignInError"}(i||(i={})),function(e){e.API_KEY="API_KEY",e.AWS_IAM="AWS_IAM",e.OPENID_CONNECT="OPENID_CONNECT",e.AMAZON_COGNITO_USER_POOLS="AMAZON_COGNITO_USER_POOLS",e.AWS_LAMBDA="AWS_LAMBDA"}(s||(s={}))}}]);