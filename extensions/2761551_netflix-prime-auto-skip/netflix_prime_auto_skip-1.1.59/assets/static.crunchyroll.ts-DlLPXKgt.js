import{s as p}from"./content-script-D7YBjZpd.js";import{u as x,w as q,d as w}from"./storeTypes-CGrbvTi_.js";import"./chunk-QIZ4XBKF-C_NfkaUr.js";import"./_commonjsHelpers-CqkleIqs.js";const{data:c,promise:E}=x("settings",w),L={attributes:!0,childList:!0,subtree:!0};async function F(){console.log("%cStreaming enhanced","color: #00aeef;font-size: 2em;"),console.log("Settings",c.value)}async function B(){await E,F(),c.value.Crunchyroll.disableNumpad&&R(),c.value.Video.doubleClick&&V(),_.observe(document,L),c.value.Video.playOnFullScreen&&v(),q(c,(e,t)=>{var l;console.log("settings changed",e),(!t||e.Video.playOnFullScreen!==((l=t==null?void 0:t.Video)==null?void 0:l.playOnFullScreen))&&v()},{deep:!0})}async function O(e,t,l){typeof e=="number"&&typeof t=="number"&&t>e&&(console.log(l,t-e),c.value.Statistics[l]+=t-e,p("increaseBadge",{},"background"))}const _=new MutationObserver(T);function T(){var l,o,n;const e=document.querySelector("video");if(!e)return;const t=e==null?void 0:e.currentTime;(l=c.value.Crunchyroll)!=null&&l.skipIntro&&j(e,t),(o=c.value.Crunchyroll)!=null&&o.speedSlider&&N(e),(n=c.value.Video)!=null&&n.scrollVolume&&I(e)}async function I(e){const t=document.querySelector('[data-testid="vilos-volume_container"]:not(.enhanced)');t&&(t.classList.add("enhanced"),t.addEventListener("wheel",l=>{var r,i,s,a;l.preventDefault();let o=e.volume;l.deltaY<0?o=Math.min(1,o+.1):o=Math.max(0,o-.1),e.volume=o;const n=(a=(s=(i=(r=document.querySelector('div[data-testid="vilos-volume_slider"]'))==null?void 0:r.children)==null?void 0:i[1])==null?void 0:s.firstChild)==null?void 0:a.firstChild;n&&(n.style.transform=`translateX(${o*61}px) translateX(-8px) scale(1)`)}))}function S(){const e=document.querySelector("video");document.fullscreenElement&&e&&(e.play(),console.log("auto-played on fullscreen"),c.value.Statistics.SegmentsSkipped++,p("increaseBadge",{},"background"))}async function v(){var e;(e=c.value.Video)!=null&&e.playOnFullScreen?(console.log("started observing| PlayOnFullScreen"),addEventListener("fullscreenchange",S)):(console.log("stopped observing| PlayOnFullScreen"),removeEventListener("fullscreenchange",S))}let y=!1,d=!1;async function b(e,t){c.value.Crunchyroll.dubLanguage={lang:e,index:t}}async function P(){const e=document.querySelectorAll('[data-testid="vilos-settings_radio_item"]');e&&e.forEach((t,l)=>{var r,i,s,a,m;const o=(s=(i=(r=t.querySelector("circle.dot"))==null?void 0:r.parentNode)==null?void 0:i.parentNode)==null?void 0:s.querySelector(".r-jwli3a");let n=((a=t.querySelector('[dir="auto"]'))==null?void 0:a.textContent)??"";o&&((m=c.value.Crunchyroll.dubLanguage)==null?void 0:m.lang)!=(o==null?void 0:o.textContent)&&b(n,l),t.addEventListener("click",function(){var g;n=((g=t.querySelector('[dir="auto"]'))==null?void 0:g.textContent)??"",b(n,l)})})}function M(){const e=document.querySelector('[data-testid="vilos-settings_audio_track_submenu"]');e?e.addEventListener("click",function(){d||(d=!0,setTimeout(function(){P()},200))}):d&&setTimeout(function(){d=!1},1e3)}let f=!1,k,h;async function j(e,t){var l,o,n,r;if(M(),f)document.querySelector(".reverse-button")||C(e,k,h);else{const i=document.querySelector('[data-testid="skipIntroText"]');i&&!y&&(y=!0,setTimeout(function(){i==null||i.click(),y=!1,console.log("Intro skipped",i),setTimeout(function(){A(e,t,e==null?void 0:e.currentTime),O(t,e==null?void 0:e.currentTime,"IntroTimeSkipped")},600)},((o=(l=c.value.Crunchyroll)==null?void 0:l.dubLanguage)==null?void 0:o.index)===0||((r=(n=c.value.Crunchyroll)==null?void 0:n.dubLanguage)==null?void 0:r.index)==null?0:2e3))}}function C(e,t,l){if(f)return;const o=document.createElement("div");o.setAttribute("class","reverse-button css-1dbjc4n r-1awozwy r-lj0ial r-1jd5jdk r-1loqt21 r-18u37iz r-eu3ka r-1777fci r-kuhrb7 r-ymttw5 r-u8s1d r-1ff5aok r-1otgn73"),o.style.color="white",o.textContent="Watch skipped ?";const n=setTimeout(()=>{o.remove()},5e3);o.onclick=function(){f=!0,e.currentTime=t,o.remove(),clearTimeout(n);const i=l-t+2;setTimeout(function(){f=!1},i*1e3)};const r=document.querySelector("#velocity-overlay-package");r&&r.appendChild(o)}async function A(e,t,l){k=t,h=l,C(e,t,l)}let u;async function G(e){u=e}async function N(e){var t;if(e&&!document.querySelector("#videoSpeedSlider")){const o=(t=document.querySelector("#settingsControl"))==null?void 0:t.parentElement;if(o){u=u||e.playbackRate;const n=document.createElement("input");n.id="videoSpeedSlider",n.type="range",n.min=c.value.General.sliderMin.toString(),n.max=c.value.General.sliderMax.toString(),n.value=(u*10).toString(),n.step=c.value.General.sliderSteps.toString(),n.style.display="none",n.style.width="200px";const r=document.createElement("p");r.id="videoSpeed",r.textContent=u?u.toFixed(1)+"x":"1.0x",r.style.color="white",r.style.margin="auto",r.style.padding="0 5px",o.prepend(n,r),u&&(e.playbackRate=u),r.onclick=function(i){i.stopPropagation(),n.style.display=n.style.display==="block"?"none":"block"},n.onclick=function(i){i.stopPropagation()},n.oninput=function(i){i.stopPropagation(),r.textContent=(parseInt(n.value)/10).toFixed(1)+"x",e.playbackRate=parseInt(n.value)/10,G(parseInt(n.value)/10)}}}}async function R(){addEventListener("keydown",async function(e){e.location===3&&(console.log("key blocked: "+e.key),e.stopPropagation(),c.value.Statistics.SegmentsSkipped++,p("increaseBadge",{},"background"))},!0)}async function V(){var e;(e=c.value.Video)!=null&&e.doubleClick?document.ondblclick=function(){document.querySelector("video")&&(document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen())}:document.ondblclick=null}B();
