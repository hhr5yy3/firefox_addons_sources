function e(e,t,n,i){Object.defineProperty(e,t,{get:n,set:i,enumerable:!0,configurable:!0})}var t,n=globalThis,i={},a={},s=n.parcelRequire94c2;null==s&&((s=function(e){if(e in i)return i[e].exports;if(e in a){var t=a[e];delete a[e];var n={id:e,exports:{}};return i[e]=n,t.call(n.exports,n,n.exports),n.exports}var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){a[e]=t},n.parcelRequire94c2=s);var r=s.register;r("k82Ot",function(e,t){var n=s("d8ymB");function i(e){document.getElementById("error-text").innerText=e.message,(0,n.default).getOrCreateInstance(document.getElementById("error-toast")).show()}window.addEventListener("error",function(e){return i(e.error),!1}),window.addEventListener("unhandledrejection",function(e){return i(e.reason),!1})}),r("d8ymB",function(t,n){e(t.exports,"default",()=>_);var i=s("hnAIs"),a=s("e3sMm"),r=s("8L2u6"),o=s("8psKi");let l=".bs.toast",d=`mouseover${l}`,c=`mouseout${l}`,u=`focusin${l}`,m=`focusout${l}`,p=`hide${l}`,h=`hidden${l}`,g=`show${l}`,f=`shown${l}`,w="hide",y="show",b="showing",E={animation:"boolean",autohide:"boolean",delay:"number"},I={animation:!0,autohide:!0,delay:5e3};class v extends i.default{constructor(e,t){super(e,t),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return I}static get DefaultType(){return E}static get NAME(){return"toast"}show(){(0,a.default).trigger(this._element,g).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(w),(0,o.reflow)(this._element),this._element.classList.add(y,b),this._queueCallback(()=>{this._element.classList.remove(b),(0,a.default).trigger(this._element,f),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&!(0,a.default).trigger(this._element,p).defaultPrevented&&(this._element.classList.add(b),this._queueCallback(()=>{this._element.classList.add(w),this._element.classList.remove(b,y),(0,a.default).trigger(this._element,h)},this._element,this._config.animation))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(y),super.dispose()}isShown(){return this._element.classList.contains(y)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(e,t){switch(e.type){case"mouseover":case"mouseout":this._hasMouseInteraction=t;break;case"focusin":case"focusout":this._hasKeyboardInteraction=t}if(t){this._clearTimeout();return}let n=e.relatedTarget;this._element===n||this._element.contains(n)||this._maybeScheduleHide()}_setListeners(){(0,a.default).on(this._element,d,e=>this._onInteraction(e,!0)),(0,a.default).on(this._element,c,e=>this._onInteraction(e,!1)),(0,a.default).on(this._element,u,e=>this._onInteraction(e,!0)),(0,a.default).on(this._element,m,e=>this._onInteraction(e,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(e){return this.each(function(){let t=v.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw TypeError(`No method named "${e}"`);t[e](this)}})}}(0,r.enableDismissTrigger)(v),(0,o.defineJQueryPlugin)(v);var _=v}),r("8L2u6",function(t,n){e(t.exports,"enableDismissTrigger",()=>o);var i=s("e3sMm"),a=s("5Xvlb"),r=s("8psKi");let o=(e,t="hide")=>{let n=`click.dismiss${e.EVENT_KEY}`,s=e.NAME;(0,i.default).on(document,n,`[data-bs-dismiss="${s}"]`,function(n){if(["A","AREA"].includes(this.tagName)&&n.preventDefault(),(0,r.isDisabled)(this))return;let i=(0,a.default).getElementFromSelector(this)||this.closest(`.${s}`);e.getOrCreateInstance(i)[t]()})}}),s("k82Ot"),s("eme3Z"),t=function(e){for(var t,n=e.length,i=n%3,a=[],s=0,r=n-i;s<r;s+=16383)a.push(function(e,t,n){for(var i,a=[],s=t;s<n;s+=3)a.push(o[(i=(e[s]<<16&0xff0000)+(e[s+1]<<8&65280)+(255&e[s+2]))>>18&63]+o[i>>12&63]+o[i>>6&63]+o[63&i]);return a.join("")}(e,s,s+16383>r?r:s+16383));return 1===i?a.push(o[(t=e[n-1])>>2]+o[t<<4&63]+"=="):2===i&&a.push(o[(t=(e[n-2]<<8)+e[n-1])>>10]+o[t>>4&63]+o[t<<2&63]+"="),a.join("")};for(var o=[],l=[],d=("undefined"!=typeof Uint8Array&&Uint8Array,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),c=0,u=d.length;c<u;++c)o[c]=d[c],l[d.charCodeAt(c)]=c;l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63;var m=s("8DrFe"),p=s("d8ymB"),h=s("eZukr"),g=s("46EnQ"),f=s("fEci9"),w=s("foKjy"),y=s("4rDM0");function b(e){if("linux"===e.os||"mac"===e.os||"openbsd"===e.os){let t=document.getElementById("web-app-profile-warn-issue");switch(e.os){case"linux":case"openbsd":t.href="https://github.com/filips123/PWAsForFirefox/issues/322",t.innerText="#322";break;case"mac":t.href="https://github.com/filips123/PWAsForFirefox/issues/81",t.innerText="#81"}document.getElementById("web-app-profile-warn-box").classList.remove("d-none")}}async function E(){let e,n,i,a,s,r,o;let l=document.getElementById("web-app-form"),d=document.getElementById("web-app-submit");{let e=document.getElementById("web-app-categories");for(let t of y.knownCategories)e.add(new Option(t,t))}for(let e of document.querySelectorAll(".form-select-tags"))e.tagsInstance=new h.default(e);let c=await browser.runtime.getPlatformInfo();document.addEventListener(f.EVENT_LOCALIZATION_READY,b.bind(null,c));try{({manifestUrl:e,documentUrl:n,pageInfo:i}=await (0,f.obtainUrls)())}catch(i){console.error(i);let e=document.getElementById("error-text");e.replaceChildren();let t=document.createElement("p");t.innerText=await (0,w.getMessage)("installPageContentScriptError"),e.append(t);let n=(await browser.tabs.query({active:!0,currentWindow:!0}))[0];if(n.url&&["firefox.com","mozilla.com","mozilla.net","mozilla.org"].some(e=>n.url.includes(e))){let t=document.createElement("p");t.replaceChildren(g.sanitize(await (0,w.getMessage)("installPageContentScriptErrorRestricted"),{RETURN_DOM_FRAGMENT:!0,ALLOWED_TAGS:["a"],ADD_ATTR:["target"]})),e.append(t)}(0,p.default).getOrCreateInstance(document.getElementById("error-toast")).show();return}if(e)try{s=await (0,f.obtainManifest)(e,n),a=!0}catch(e){console.log(e),a=!1}else a=!1;a||document.getElementById("web-app-use-manifest-box").classList.add("d-none");let u=await (0,f.obtainSiteList)(),E=await (0,f.obtainProfileList)();a?(r=s.name||s.short_name||new URL(s.scope).host,o=s.description||""):(r=i.name||new URL(n).host,o=i.description||""),document.getElementById("web-app-name").setAttribute("placeholder",r),document.getElementById("web-app-description").setAttribute("placeholder",o),document.getElementById("web-app-start-url").setAttribute("placeholder",s?.start_url||n);let I=document.getElementById("web-app-categories");for(let e of s?.categories?.map(e=>f.sanitizeString(e)).filter(e=>e)||[])I.tagsInstance.addItem(e,e);let v=document.getElementById("web-app-keywords");for(let e of s?.keywords?.map(e=>f.sanitizeString(e)).filter(e=>e)||[])v.tagsInstance.addItem(e,e);let _=document.getElementById("web-app-profile");for(let e of Object.values(E))_.add(new Option(e.name||e.ulid,e.ulid));_.add(new Option(await (0,w.getMessage)("installPageCreateProfile"),"create-new-profile"));let L="linux"===c.os||"mac"===c.os||"openbsd"===c.os;_.add(new Option(await (0,w.getMessage)("installPageAutoCreateProfile"),"auto-create-new-profile",L,L));let B=_.value;_.addEventListener("change",async function(e){if("create-new-profile"!==this.value){B=this.value;return}document.getElementById("new-profile-name").value="",document.getElementById("new-profile-description").value="";let t=document.getElementById("new-profile-create");t.disabled=!1,t.innerText=await (0,w.getMessage)("buttonCreateDefault");let n=(await browser.storage.local.get([f.PREF_DEFAULT_PROFILE_TEMPLATE]))[f.PREF_DEFAULT_PROFILE_TEMPLATE];document.getElementById("new-profile-template").value=n||null,(0,m.default).getOrCreateInstance(document.getElementById("new-profile-modal"),{backdrop:"static",keyboard:!1}).show(),e.preventDefault()});let T=function(){_.value=B};document.getElementById("new-profile-cancel1").addEventListener("click",T),document.getElementById("new-profile-cancel2").addEventListener("click",T),document.getElementById("new-profile-create").addEventListener("click",async function(){let e=document.getElementById("new-profile-name").value||null,t=document.getElementById("new-profile-description").value||null,n=document.getElementById("new-profile-template").value||null;this.disabled=!0,this.innerText=await (0,w.getMessage)("buttonCreateProcessing");let i=await browser.runtime.sendNativeMessage("firefoxpwa",{cmd:"CreateProfile",params:{name:e,description:t,template:n}});if("Error"===i.type)throw Error(i.data);if("ProfileCreated"!==i.type)throw Error(`Received invalid response type: ${i.type}`);(0,p.default).getOrCreateInstance(document.getElementById("error-toast")).hide();let a=i.data;_.add(new Option(e??a,a,!0,!0),_.length-2),_.value=a,B=a,(0,m.default).getOrCreateInstance(document.getElementById("new-profile-modal"),{backdrop:"static",keyboard:!1}).hide()}),l.classList.add("was-validated"),d.disabled=!1,d.innerText=await (0,w.getMessage)("buttonWebAppInstallDefault");let A=async function(){let e=document.getElementById("web-app-name-invalid"),t=this.value||this.getAttribute("placeholder");if(Object.values(u).map(e=>e.config.name||e.manifest.name||e.manifest.short_name||new URL(e.manifest.scope).host).includes(t)){this.setCustomValidity(await (0,w.getMessage)("webAppValidationNameReuse")),e.innerText=this.validationMessage;return}this.setCustomValidity("")},C=document.getElementById("web-app-name");C.addEventListener("input",A),A.call(C);let M=async function(){let e=document.getElementById("web-app-start-url-invalid"),t=document.getElementById("web-app-start-url-warning");if(!this.value){this.setCustomValidity(""),this.classList.remove("is-warning");return}if(this.validity.typeMismatch){this.classList.remove("is-warning"),this.setCustomValidity(await (0,w.getMessage)("webAppValidationStartURLInvalid")),e.innerText=this.validationMessage;return}if(!a){this.classList.remove("is-warning"),this.setCustomValidity("");return}let n=new URL(this.value),i=new URL(s.scope);if(n.origin!==i.origin||!n.pathname.startsWith(i.pathname)){this.setCustomValidity(""),t.innerText=`${await (0,w.getMessage)("webAppValidationStartURLScope")} ${i}`,this.classList.add("is-warning");return}this.setCustomValidity(""),this.classList.remove("is-warning")},x=document.getElementById("web-app-start-url");x.addEventListener("input",M),M.call(x);let P=async function(){let e=document.getElementById("web-app-icon-url-invalid");if(!this.value){this.setCustomValidity("");return}if(this.validity.typeMismatch){this.setCustomValidity(await (0,w.getMessage)("webAppValidationIconURLInvalid")),e.innerText=this.validationMessage;return}this.setCustomValidity("")},O=document.getElementById("web-app-icon-url");O.addEventListener("input",P),P.call(O);let R=async function(){let t=document.getElementById("web-app-profile-invalid");if(Object.values(u).filter(t=>t.config.manifest_url===e).map(e=>e.profile).includes(this.value)){this.setCustomValidity(await (0,w.getMessage)("webAppValidationProfileLimit")),t.innerText=this.validationMessage;return}this.setCustomValidity("")},S=document.getElementById("web-app-profile");S.addEventListener("input",R),R.call(S),d.onclick=async r=>{if(r.preventDefault(),r.stopPropagation(),!l.checkValidity())return;d.disabled=!0,d.innerText=await (0,w.getMessage)("buttonWebAppInstallProcessing"),document.getElementById("web-app-use-manifest").checked||(a=!1);let o=document.getElementById("web-app-launch-now").checked||!1,c=document.getElementById("web-app-start-url").value||null,u=document.getElementById("web-app-icon-url").value||null,m=document.getElementById("web-app-profile").value||null,h=document.getElementById("web-app-name").value||null,g=document.getElementById("web-app-description").value||null,y=[...document.getElementById("web-app-categories").selectedOptions].map(e=>e.value),b=s?.categories?.map(e=>f.sanitizeString(e)).filter(e=>e)||[],E=y.toString()!==b.toString()?y:null,I=[...document.getElementById("web-app-keywords").selectedOptions].map(e=>e.value),v=s?.keywords?.map(e=>f.sanitizeString(e)).filter(e=>e)||[],_=I.toString()!==v.toString()?I:null;if(a||(s={start_url:c||n,name:document.getElementById("web-app-name").getAttribute("placeholder")||i.name,description:document.getElementById("web-app-description").getAttribute("placeholder")||i.description,icons:i.icons},e="data:application/manifest+json;base64,"+t(new TextEncoder().encode(JSON.stringify(s)))),"auto-create-new-profile"===m){let e=h||s.name||s.short_name||new URL(s.scope).host,t=(await browser.storage.local.get([f.PREF_DEFAULT_PROFILE_TEMPLATE]))[f.PREF_DEFAULT_PROFILE_TEMPLATE],n=await browser.runtime.sendNativeMessage("firefoxpwa",{cmd:"CreateProfile",params:{name:e||null,template:t||null}});if("Error"===n.type)throw Error(n.data);if("ProfileCreated"!==n.type)throw Error(`Received invalid response type: ${n.type}`);m=n.data}let L=await browser.runtime.sendNativeMessage("firefoxpwa",{cmd:"InstallSite",params:{manifest_url:e,document_url:n,start_url:c,icon_url:u,profile:m,name:h,description:g,categories:E,keywords:_,launch_now:o}});if("Error"===L.type)throw Error(L.data);if("SiteInstalled"!==L.type)throw Error(`Received invalid response type: ${L.type}`);(0,p.default).getOrCreateInstance(document.getElementById("error-toast")).hide(),d.disabled=!0,d.innerText=await (0,w.getMessage)("buttonWebAppInstallFinished");let B=(await browser.tabs.query({active:!0,currentWindow:!0}))[0];await browser.pageAction.setIcon({tabId:B.id,path:"/images/page-action-launch.svg"}),browser.pageAction.setTitle({tabId:B.id,title:browser.i18n.getMessage("actionLaunchSite")}),browser.pageAction.setPopup({tabId:B.id,popup:"/sites/launch.html"}),setTimeout(async()=>{window.close()},5e3)}}(0,f.setPopupSize)(),E();