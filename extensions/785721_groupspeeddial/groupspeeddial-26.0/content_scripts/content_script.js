(()=>{"use strict";const e=e=>!!e,t=e=>new Promise((t=>setTimeout(t,e)));const s="https://group-speed-dial.fastaddons.com",r=s,n="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;class o{subscribers=[];addOnChange(e){this.subscribers.push(e)}removeOnChange(e){this.subscribers=this.subscribers.filter((t=>t!==e))}hasOnChange(e){return this.subscribers.includes(e)}notifyChange(e){this.subscribers.forEach((t=>{try{t(e)}catch(e){}}))}}const a=void 0;class i extends o{storageArea;onChanged;constructor(e){super(),this.storageArea=e,this.onChanged=new BroadcastChannel(`web_ext_storage.${this.storageArea}.onChanged`),this.onChanged.onmessage=e=>{const t=e.data;this.notifyChange(t)},this.onChanged.onmessageerror=console.error}async notifyAllContexts(e){this.notifyChange(e),await a,this.onChanged.postMessage(e)}async withDb(e){const t=self.indexedDB.open(`web_ext_storage.${this.storageArea}`,1);return new Promise(((e,s)=>{t.onerror=()=>s(t.error),t.onsuccess=()=>e(t.result),t.onupgradeneeded=()=>{const e=t.result;e.objectStoreNames.contains("data")||e.createObjectStore("data",{keyPath:"key"})}})).then(e).finally((()=>t.result.close()))}async getMultipleItems(t,s){const r=s.map((e=>new Promise(((s,r)=>{const n=t.get(e);n.onerror=()=>r(n.error),n.onsuccess=()=>s(n.result)}))));return Object.fromEntries((await Promise.all(r)).filter(e).map((e=>[e.key,e.value])))}async get(e){return this.withDb((async t=>{const s=t.transaction("data","readonly").objectStore("data");if(Array.isArray(e))return this.getMultipleItems(s,e);const r=s.getAll(e);return new Promise(((e,t)=>{r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result.reduce(((e,{key:t,value:s})=>(e[t]=s,e)),{}))}))}))}async set(e){return this.withDb((async t=>{const s=t.transaction("data","readwrite"),r=s.objectStore("data"),n=await this.getMultipleItems(r,Object.keys(e)),o={};for(const[t,s]of Object.entries(e))r.put({key:t,value:s}),o[t]={oldValue:n[t],newValue:s};return new Promise(((e,t)=>{s.onerror=()=>t(s.error),s.oncomplete=()=>{this.notifyAllContexts(o),e()}}))}))}async remove(e){return this.withDb((async t=>{const s=t.transaction("data","readwrite"),r=s.objectStore("data");e=Array.isArray(e)?e:[e];const n=await this.getMultipleItems(r,e);for(const t of e)r.delete(t);return new Promise(((t,r)=>{s.onerror=()=>r(s.error),s.oncomplete=()=>{const s={};for(const t of e)s[t]={oldValue:n[t]};this.notifyAllContexts(s),t()}}))}))}async clear(){return this.withDb((async e=>{const t=e.transaction("data","readwrite");return t.objectStore("data").clear(),new Promise(((e,s)=>{t.onerror=()=>s(t.error),t.oncomplete=()=>e()}))}))}async getBytesInUse(){return this.withDb((async e=>{const t=e.transaction("data","readonly").objectStore("data").getAll();return new Promise(((e,s)=>{t.onerror=()=>s(t.error),t.onsuccess=()=>{const s=t.result.reduce(((e,{key:t,value:s})=>e+t.length+JSON.stringify(s).length),0);e(s)}}))}))}static getBrowserPolyfill(e){const t=new i(e);return"session"===e&&n&&self.addEventListener("activate",(()=>t.clear())),{get:t.get.bind(t),set:t.set.bind(t),remove:t.remove.bind(t),clear:t.clear.bind(t),getBytesInUse:t.getBytesInUse.bind(t),onChanged:{addListener:t.addOnChange.bind(t),removeListener:t.removeOnChange.bind(t),hasListener:t.hasOnChange.bind(t)}}}}class c{_callback;promise;constructor(e){this._callback=e}execute(){return this.promise||(this.promise=this._callback().finally((()=>{this.promise=void 0}))),this.promise}}const d=(e,t,s)=>{const r=s.value;return s.value=function(...e){if(n)return r.apply(this,e)},s};function l(e,t,s,r){var n,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var i=e.length-1;i>=0;i--)(n=e[i])&&(a=(o<3?n(a):o>3?n(t,s,a):n(t,s))||a);return o>3&&a&&Object.defineProperty(t,s,a),a}class w extends o{broadcast;storage;constructor(){super(),this.broadcast=new BroadcastChannel("web_ext_alarms"),this.storage=i.getBrowserPolyfill("_internal_alarms"),this.infiniteAlarmsCheck()}async clearAll(){return await this.storage.clear(),!0}async clear(e=""){const{[e]:t}=await this.storage.get(e);return!!t&&(await this.storage.remove(e),!0)}async create(e,t){const[s,r]="string"==typeof e?[e,t]:["",e],n=Date.now(),o={name:s,scheduledTime:r.periodInMinutes?this.computeNextRun(r.periodInMinutes):r.when||n+6e4*(r.delayInMinutes||0),periodInMinutes:r.periodInMinutes};o.scheduledTime<n?this.notifyAllContexts(o):await this.storage.set({[s]:o})}async get(e=""){const{[e]:t}=await this.storage.get(e);return t}async getAll(){const e=await this.storage.get();return Object.values(e)}async infiniteAlarmsCheck(){for(;;)await this.checkForDueAlarms(),await t(12e3)}async checkForDueAlarms(){const e=Date.now(),t=(await this.getAll()).filter((t=>t.scheduledTime<=e));for(const e of t)this.notifyAllContexts(e),e.periodInMinutes?(e.scheduledTime=this.computeNextRun(e.periodInMinutes),await this.storage.set({[e.name]:e})):await this.storage.remove(e.name)}computeNextRun(e){return Date.now()+6e4*e}async notifyAllContexts(e){this.notifyChange(e),await a,this.broadcast.postMessage(e)}static getBrowserPolyfill(){const e=new w;return{get:e.get.bind(e),getAll:e.getAll.bind(e),create:e.create.bind(e),clear:e.clear.bind(e),clearAll:e.clearAll.bind(e),onAlarm:{addListener:e.addOnChange.bind(e),hasListener:e.hasOnChange.bind(e),removeListener:e.removeOnChange.bind(e)}}}}l([d],w.prototype,"infiniteAlarmsCheck",null),l([d,(e,t,s)=>{let r;const n=s.value,o=new c((async()=>n.apply(r)));s.value=function(){return r=this,o.execute()}}],w.prototype,"checkForDueAlarms",null);"moz-extension:"===self.location.protocol&&(browser.windows||(browser.windows={}),browser.windows.getCurrent||(browser.windows.getCurrent=async e=>{const t=await browser.tabs.query({}),s=t.find((e=>e.active));return{id:s?.windowId??1,title:s?.title??"",focused:!0,alwaysOnTop:!1,incognito:!!browser.extension.inIncognitoContext,...e?.populate?{tabs:t}:{},state:"maximized",type:"normal",height:screen.availHeight,width:screen.availWidth,top:0,left:0}}),browser.windows.getLastFocused||(browser.windows.getLastFocused=async e=>browser.windows.getCurrent(e)),browser.windows.get||(browser.windows.get=async(e,t)=>{const[s]=await browser.tabs.query({windowId:e});return{...await browser.windows.getCurrent(t),id:s?.windowId??1,title:s?.title??"",focused:s?.active}}),browser.windows.getAll||(browser.windows.getAll=async e=>!1!==e?.windowTypes?.includes("normal")?[await browser.windows.getCurrent(e)]:[]),browser.windows.update||(browser.windows.update=async(e,t)=>{if(t.focused||"maximized"===t.state){const[t]=await browser.tabs.query({windowId:e});t&&await browser.tabs.update(t.id,{active:!0})}return browser.windows.getCurrent()}),browser.windows.remove||(browser.windows.remove=async e=>{const[t]=await browser.tabs.query({windowId:e});t&&await browser.tabs.remove(t.id)}),browser.windows.create||(browser.windows.create=async e=>{const t=e?.url?Array.isArray(e.url)?e.url:[e.url]:["about:blank"];for(const s of t)await browser.tabs.create({url:s,active:e?.focused});const s=await browser.windows.getCurrent({populate:!0});return s.tabs=s.tabs.filter((e=>e.windowId===s.id)),s}));self.location.href===browser.runtime.getManifest().background?.page||self.location.pathname;const u=e=>browser.runtime.sendMessage(e),h=n?Promise.resolve():new Promise((e=>"complete"===document.readyState||"interactive"===document.readyState?e():document.addEventListener("DOMContentLoaded",(()=>e())))),g=new Promise((e=>document&&"complete"===document.readyState?e():window.addEventListener("load",(()=>e()))));new Promise((e=>window.addEventListener("load",e)));(async()=>{if(!await u({type:"cs_is_default_container"}))return;window.addEventListener("message",(async function(e){if(e.source!==window||e.origin!==r||!e.data.type.startsWith("gsd_"))return;switch(e.data.type){case"gsd_return_home":u({type:"cs_return_home"});break;case"gsd_update_token":u({type:"cs_web_token_update",token:e.data.token});break;case"gsd_get_token":const t=await u({type:"cs_get_token"});t&&window.postMessage({type:"gsd_token",token:t},r);break;case"gsd_shared_groups":const s=e.data.groups;Array.isArray(s)&&s.length&&await u({type:"cs_shared_groups_import",groups:s}).catch(console.error)}}),!1);const e=()=>window.postMessage({type:"gsd_ext_ready"},r);await h,e(),await g,e(),self.setTimeout(e,1e3)})()})();