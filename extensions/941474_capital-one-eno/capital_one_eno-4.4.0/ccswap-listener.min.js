function doCardSwap(e,a,t){const n=setInterval((function(){if("undefined"==typeof automaton)return;clearInterval(n);const o=t.path;let r="",i="",d="",s="",l="",u="";const c=a&&a.response&&a.response.data;if(c){const e=c.address;e&&(r=e.addressLine1||" ",i=e.addressLine2||" ",d=e.city,s=e.stateCode,l=e.postalCode),u=c.phoneNumber||" "}let m=window.location.href.toString(),b=document.getElementById("ctl00_ContentInfo_CreditCard_CreditCardNumber_txtCCNum");m&&m.indexOf("united.com")>=0&&b&&(b.style.display="none");let p=(new automaton.SimpleMapVariableResolver).addVariable(new automaton.Variable("customerName",e.customerName)).addVariable(new automaton.Variable("customerNameNew",e.customerName+"\n")).addVariable(new automaton.Variable("customerFirstName",e.customerName.split(" ")[0])).addVariable(new automaton.Variable("customerLastName",e.customerName.split(" ")[1])).addVariable(new automaton.Variable("address1",r)).addVariable(new automaton.Variable("address2",i)).addVariable(new automaton.Variable("city",d)).addVariable(new automaton.Variable("state",s)).addVariable(new automaton.Variable("postalCode",l)).addVariable(new automaton.Variable("phoneNumber",u)).addVariable(new automaton.Variable("currentYear",(new Date).getFullYear()%100+"")).addVariable(new automaton.Variable("creditCardNumber",e.response.tokenDetails.cardToken)).addVariable(new automaton.Variable("creditCardNumberNew",e.response.tokenDetails.cardToken+"\n")).addVariable(new automaton.Variable("cardLastFour",e.response.tokenDetails.cardToken.substring(12))).addVariable(new automaton.Variable("cvv",e.response.cvv)).addVariable(new automaton.Variable("cvvNew",e.response.cvv+"\n")).addVariable(new automaton.Variable("expirationMonth",e.response.tokenExpirationDate.split("/")[0])).addVariable(new automaton.Variable("expirationMonthZeroBased",e.response.tokenExpirationDate.split("/")[0]-1+"")).addVariable(new automaton.Variable("expirationYear",e.response.tokenExpirationDate.split("/")[1])).addVariable(new automaton.Variable("VISAorMASTERCARD","4"===e.response.tokenDetails.cardToken.substring(0,1)?"VISA":"MASTERCARD")).addVariable(new automaton.Variable("VIorMC","4"===e.response.tokenDetails.cardToken.substring(0,1)?"VI":"MC")).addVariable(new automaton.Variable("VorM","4"===e.response.tokenDetails.cardToken.substring(0,1)?"V":"M"));const V=new automaton.InBrowserExecutionEngine;(new automaton.StepExecutor).engine(V).variableResolver(p).executeScenario(o,(function(e){const a=e[e.length-1];if(a.isSuccessfullyRun())return void notifyContentScript({action:"msg_ccswap_done",mdxId:t.mdxId,pathVersion:t.pathVersion});let n=0,o=-1;for(let a=0;a<e.length;a++)e[a].isSuccessfullyRun()&&(n++,o=a);if(0===n||null==a.getUrl()||e[o].url===e[o+1].url)return void notifyContentScript({action:"msg_ccswap_error",mdxId:t.mdxId,pathVersion:t.pathVersion,lastSuccessfulStep:o});notifyContentScript({action:"msg_ccswap_resume_needed",nextUrl:o>-1&&void 0!==e[o].url?e[o+1].url:null})}))}),100)}function addHiddenElementForAutomaton(){const e=document.createElement("div"),a=document.getElementsByTagName("body")[0];e.setAttribute("id","ccswapHiddenElement"),e.setAttribute("style","display: none;"),a.appendChild(e)}function notifyContentScript(e){window.parent.postMessage(e,"*")}window.addEventListener("message",(function(e){if(e.data&&e.data.action)switch(e.data.action){case"do_card_swap":doCardSwap(e.data.cardDetail,e.data.addressResponse,e.data.merchant);break;case"automaton_still_running":notifyContentScript({action:"automaton_still_running"})}})),"complete"===document.readyState?addHiddenElementForAutomaton():window.addEventListener?window.addEventListener("load",addHiddenElementForAutomaton,!1):window.attachEvent&&window.attachEvent("onload",addHiddenElementForAutomaton);