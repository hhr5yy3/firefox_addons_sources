import{s as p}from"./content-script-D7YBjZpd.js";import{s as b,P as v,c as x,p as _}from"./shared-functions-50IQFOKT.js";import{u as D,r as A,d as E}from"./storeTypes-CGrbvTi_.js";import"./chunk-QIZ4XBKF-C_NfkaUr.js";import"./_commonjsHelpers-CqkleIqs.js";b(v.Disney);const{data:l,promise:q}=D("settings",E),f=window.location.hostname,u=/disneyplus|starplus/i.test(f),y=/hotstar/i.test(f),S=/starplus/i.test(f);let a=0;const C={attributes:!0,childList:!0,subtree:!0};async function T(){console.log("%cStreaming enhanced","color: #00aeef;font-size: 2em;"),console.log("Settings",l.value)}async function h(e,n,t){typeof e=="number"&&typeof n=="number"&&n>e&&(console.log(t,n-e),l.value.Statistics[t]+=n-e,p("increaseBadge",{},"background"))}async function k(e=1e3){setTimeout(()=>{a=0},e)}const g=A(1);async function w(){await q,T(),y&&O(),N.observe(document,C),setInterval(function(){var n;const e=Array.from(document.querySelectorAll("video")).find(t=>t.checkVisibility());(n=l.value.Disney)!=null&&n.skipAd&&B(e)},300)}const N=new MutationObserver(P);function P(){var t,o,s,c,i;const e=Array.from(document.querySelectorAll("video")).find(r=>r.checkVisibility()),n=e==null?void 0:e.currentTime;(t=l.value.Disney)!=null&&t.skipIntro&&V(e,n),Y(n),(o=l.value.Disney)!=null&&o.watchCredits&&R(),(s=l.value.Disney)!=null&&s.speedSlider&&H(e),u&&(M(),(c=l.value.Disney)!=null&&c.selfAd&&X(e,n)),(i=l.value.Video)!=null&&i.scrollVolume&&F(e)}async function B(e){if(e){const n=document.querySelector("div.overlay_interstitials__content_time_display");if(n){const o=_(n==null?void 0:n.textContent);o&&o>=1&&a!=e.currentTime&&(a==0&&(console.log("Disney Ad skipped, length:",o,"s"),l.value.Statistics.DisneyAdTimeSkipped+=o,l.value.Statistics.SegmentsSkipped++,p("increaseBadge",{},"background")),a=e.currentTime,e.currentTime+=o)}else a=0;const t=document.querySelector("p.toast-notification__text[aria-hidden='true']");t!=null&&t.checkVisibility()&&(t.remove(),l.value.Statistics.SegmentsSkipped++,p("increaseBadge",{},"background"))}}async function F(e){const n=document.querySelector("div.audio-control:not(.enhanced)");n&&(n.classList.add("enhanced"),n.addEventListener("wheel",t=>{var i;console.log("wheel");let o=e.volume;t.deltaY<0?o=Math.min(1,o+.1):o=Math.max(0,o-.1),e.volume=o;const s=n.querySelector(".slider-container"),c=(i=s==null?void 0:s.firstChild)==null?void 0:i.children;if(c.length>2){const r=c[1],d=c[2];r.style.strokeDashoffset=100-o*100+"px",r.style.height=o*100+"%",d.style.height=o*100+"%"}}))}async function V(e,n){var o,s,c;let t;u?t=S?document.querySelector('[data-gv2elementkey="playNext"]'):document.querySelector(".skip__button"):t=(s=(o=document.evaluate("//span[contains(., 'Skip Intro')]",document,null,XPathResult.ANY_TYPE,null))==null?void 0:o.iterateNext())==null?void 0:s.parentElement,t&&!((c=document.querySelector('[data-testid="icon-restart"]'))!=null&&c.parentElement)&&(t.click(),console.log("Intro/Recap skipped",t),setTimeout(function(){h(n,e==null?void 0:e.currentTime,"IntroTimeSkipped")},600))}async function Y(e){var t,o,s,c;let n;if(S?n=document.querySelector('[data-gv2elementkey="playNext"]'):u?n=(t=document.querySelector('[data-testid="icon-restart"]'))==null?void 0:t.parentElement:n=(s=(o=document.evaluate("//span[contains(., 'Next Episode')]",document,null,XPathResult.ANY_TYPE,null))==null?void 0:o.iterateNext())==null?void 0:s.parentElement,n&&!n.getAttribute("data-testid")){const i=e;if(i&&a!=i){const r=document.fullscreenElement!==null;a=i,(c=l.value.Disney)!=null&&c.skipCredits&&(n.click(),console.log("Credits skipped",n),l.value.Statistics.SegmentsSkipped++,p("increaseBadge",{},"background"),k()),y||setTimeout(function(){if(r&&document.fullscreenElement==null){let d=function(){chrome.runtime.sendMessage({type:"exitFullscreen"}),console.log("exitFullscreen"),removeEventListener("fullscreenchange",d)};chrome.runtime.sendMessage({type:"fullscreen"}),addEventListener("fullscreenchange",d),document.onkeydown=function(m){"key"in m&&(m.key==="Escape"||m.key==="Esc")&&chrome.runtime.sendMessage({type:"exitFullscreen"})},console.log("fullscreen")}},1e3)}}}async function M(){var n;const e=(n=document.querySelector('[data-testid="browser-action-button"]'))==null?void 0:n.parentElement;if(e&&!document.querySelector("#homeButton")){const t=document.createElement("button");t.textContent="Home",t.id="homeButton",t.style.cssText='color: white;background-color: #40424A;border: rgb(64, 66, 74);border-radius: 5px;padding: 0 2px 0 2px;height: 56px;padding-left: 24px;padding-right: 24px;letter-spacing: 1.76px;font-size: 15px;  text-transform: uppercase;cursor: pointer;font-family:"Avenir-World-for-Disney-Demi", sans-serif;',t.onmouseover=function(){t.style.backgroundColor="#474a53"},t.onmouseout=function(){t.style.backgroundColor="#40424A"},t.onclick=function(){window.location.href="/"},e.appendChild(t)}}async function R(){var n,t,o,s,c;let e;if(S?e=document.querySelector('[data-gv2elementkey="playNext"]'):u&&!document.querySelector('[data-testid="playback-action-button"]')?e=(n=document.querySelector('[data-testid="icon-restart"]'))==null?void 0:n.parentElement:e=(o=(t=document.evaluate("//span[contains(., 'Next Episode')]",document,null,XPathResult.ANY_TYPE,null))==null?void 0:t.iterateNext())==null?void 0:o.parentElement,e){let i;if(u&&(i=(s=/\d+/.exec((e==null?void 0:e.textContent)??""))==null?void 0:s[0]),y&&!((c=document.evaluate("//span[contains(., 'My Space')]",document,null,XPathResult.ANY_TYPE,null))!=null&&c.iterateNext())||i&&a!=i){const r=Array.from(document.querySelectorAll("video")).find(d=>d.checkVisibility());r&&(r.click(),a=i??0,console.log("Credits Watched",e),l.value.Statistics.SegmentsSkipped++,p("increaseBadge",{},"background"),k())}}}const I="pointer-events: auto;background: rgb(221, 221, 221);display: none;width:200px;",L="height:10px;min-width:40px;color:#f9f9f9;pointer-events: auto;position: relative;bottom: 8px;padding: 0 5px;";async function H(e){var n,t,o,s;if(e){const c=document.querySelector("#videoSpeedSlider");if(c){const i=document.querySelector("#videoSpeed");e.playbackRate!==parseFloat(c.value)/10&&(e.playbackRate=parseFloat(c.value)/10),c.oninput=function(){const r=parseFloat(c.value);i&&(i.textContent=(r/10).toFixed(1)+"x"),e.playbackRate=r/10,g.value=r/10}}else{let i;u?i=document.querySelector(".controls__right"):i=(s=(o=(t=(n=document.querySelector(".icon-player-landscape"))==null?void 0:n.parentElement)==null?void 0:t.parentElement)==null?void 0:o.parentElement)==null?void 0:s.parentElement,i&&x(e,g,i,I,L)}}}async function X(e,n){if(u){const t=document.querySelector(".overlay_interstitials__promo_skip_button");t&&(t.click(),console.log("SelfAd skipped",t),setTimeout(function(){h(n,e==null?void 0:e.currentTime,"DisneyAdTimeSkipped")},600))}}async function O(){var e;(e=l.value.Video)!=null&&e.doubleClick?document.ondblclick=function(){var n,t,o,s;(t=(n=document.querySelector(".icon-player-landscape"))==null?void 0:n.closest("button"))==null||t.click(),(s=(o=document.querySelector(".icon-player-portrait"))==null?void 0:o.closest("button"))==null||s.click()}:document.ondblclick=null}w();
