(()=>{"use strict";var e={6813:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});var a,n=s(5109),r=(a=s(5099))&&a.__esModule?a:{default:a},c=void 0,i=void 0,o=void 0,l=void 0,d=null;async function u(){var e=await fetch(r.default.URL_TOP_MERCHANTS,{headers:{Accept:"application/json"},credentials:"include"});return g(e=await e.json()),c}function g(e){c=e}async function f(){var e=await fetch(r.default.URL_TOP_SAVINGS,{headers:{Accept:"application/json"},credentials:"include"});return h((e=await e.json()).data),i}function h(e){i=e}function p(e){o=e}async function m(){var e=await fetch(r.default.URL_ALL_MERCHANTS,{headers:{Accept:"application/json"},credentials:"include"});return p(e=await e.json()),o}async function v(){var e=await fetch(r.default.URL_ACCOUNT,{headers:{Accept:"application/json"},credentials:"include"});return(e=await e.json()).error?null:(w(e),e)}function w(e){l=e}t.default={fetchTopMerchants:u,getTopMerchants:function(){return c?Promise.resolve(c):u()},setTopMerchants:g,getMerchantById:function(e){return o.find((function(t){return t.id===e}))},setMerchantById:function(e){o[o.indexOf(o.find((function(t){return t.id===e.id})))]=e},fetchTopSavings:f,getTopSavings:function(){return i?Promise.resolve(i):f()},setTopSavings:h,fetchAllMerchants:m,getAllMerchants:function(){return o?Promise.resolve(o):m()},setAllMerchants:p,findMerchantByUrl:function(e){if(!o)return null;for(var t=0;t<o.length;t++){var s=o[t];if(new RegExp(s.pattern).test(e))return s}return null},getCurrentMerchant:function(){return d},setCurrentMerchant:function(e){return d=e},fetchUser:v,getUser:async function(){var e=await chrome.cookies.get({url:n.URL_DOMAIN,name:"sessionLoggedIn"});return e?"true"!==e.value?(w(null),null):"true"!==e.value||l?l:v():(w(null),null)},setUser:w,isAuthed:function(){return!!l},getSettings:async function(){return{serpEnabled:(await chrome.storage.local.get({serpEnabled:"undefined"})).serpEnabled,notificationEnabled:(await chrome.storage.local.get({notificationEnabled:"undefined"})).notificationEnabled}}}},5099:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={URL_TOP_MERCHANTS:"https://backend.pigogo.gr/api/v1/shops?limit=31&extension",URL_TOP_SAVINGS:"https://backend.pigogo.gr/api/v1/savings?limit=31&extension&featured",URL_ALL_MERCHANTS:"https://backend.pigogo.gr/api/v1/shops?extension",URL_ACCOUNT:"https://backend.pigogo.gr/api/v1/users/self?extension",DATA_FETCH_INTERVAL:36e5}},4459:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});var a,n=(a=s(6813))&&a.__esModule?a:{default:a};t.default={update:function(e){var t;"Safari"!==framework.browser.name&&(n.default.findMerchantByUrl(e)?chrome.action.setIcon({path:{18:"../img/neutral_18.png"}}):(t="undefined"==t?chrome:t,chrome.action.setIcon({path:{18:"../img/bw_18x18.png"}})))}}},5109:(e,t)=>{var s;function a(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}Object.defineProperty(t,"__esModule",{value:!0});var n=t.URL_REGISTER="https://www.pigogo.gr/?signup",r=t.URL_LOGIN="https://www.pigogo.gr/?login",c=t.URL_SEARCH="https://www.pigogo.gr/search?keyword=",i=t.URL_LOGOUT="https://backend.pigogo.gr/api/v1/users/actions/log-out",o=t.URL_OVERVIEW="https://www.pigogo.gr/user/overview",l=t.URL_PURCHASES="https://www.pigogo.gr/user/purchases",d=t.URL_FAQ="https://www.pigogo.gr/faq",u=t.URL_CSRF="https://backend.pigogo.gr/sanctum/csrf-cookie",g=t.URL_SHOP="https://backend.pigogo.gr/api/v1/shops?extension&slug=",f=(t.URL_CATEGORIES="https://backend.pigogo.gr/api/v1/menu-categories?filter=parents",t.URL_DOMAIN="https://www.pigogo.gr/");t.URL_STORES="https://www.pigogo.gr/stores",t.URL_SAVINGS="https://www.pigogo.gr/offers",t.default=(a(s={URL_LOGIN:r,URL_REGISTER:n,URL_FAQ:d,URL_SEARCH:c,URL_LOGOUT:i,URL_OVERVIEW:o,URL_PURCHASES:l},"URL_FAQ",d),a(s,"URL_CSRF",u),a(s,"URL_DOMAIN",f),a(s,"URL_SHOP",g),s)}},t={};function s(a){var n=t[a];if(void 0!==n)return n.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,s),r.exports}(()=>{var e=n(s(6813)),t=n(s(5099)),a=n(s(4459));function n(e){return e&&e.__esModule?e:{default:e}}function r(t,s,a){var n=a.url.match(/pigogo\.gr\/co\/rv\/(\d+)/);if(n&&2===n.length){var r=Number(n[1]),c=e.default.getMerchantById(r);c&&(c.sliderAccessCount=4,chrome.storage.local.get({merchantsRevisited:{}}).then((async function(e){e.merchantsRevisited[r.toString()]={lastAccess:Date.now(),sliderAccessCount:c.sliderAccessCount},await chrome.storage.local.set({merchantsRevisited:e.merchantsRevisited})})),e.default.setMerchantById(c))}}function c(t){a.default.update(t);var s=e.default.findMerchantByUrl(t);e.default.setCurrentMerchant(s)}function i(){e.default.fetchAllMerchants(),e.default.fetchTopMerchants(),e.default.fetchTopSavings(),e.default.fetchUser()}window.bg=e.default,a.default.update(),async function(){chrome.runtime.getURL("").startsWith("moz-extension://")?(chrome.action.onClicked.addListener((async function(e){await chrome.permissions.request({origins:["<all_urls>","*://www.pigogo.gr/*","*://backend.pigogo.gr/*"]}),chrome.action.setPopup({popup:"../popup/popup.html"})})),chrome.runtime.onMessage.addListener((function(t,s,a){if("getAllMerchants"==t.message)a(e.default.getAllMerchants());else if("getTopMerchants"==t.message)a(e.default.getTopMerchants());else if("getTopSavings"==t.message)a(e.default.getTopSavings());else if("getUser"==t.message)a(e.default.getUser());else if("getCurrentMerchant"==t.message)a(e.default.getCurrentMerchant());else if("contentLoaded"==t.message)c(t.url),a();else if("activateMerchant"==t.message){var n=t.id;e.default.getMerchantById(n).activated=!0,a()}else if("suspendMerchant"==t.message){var r=t.id,i=e.default.getMerchantById(r);t.val?(i.sliderAccessCount=t.val,i.sliderAccessCount+=1,chrome.storage.local.get({merchantsRevisited:{}}).then((async function(e){e.merchantsRevisited[r.toString()]={lastAccess:Date.now(),sliderAccessCount:i.sliderAccessCount},await chrome.storage.local.set({merchantsRevisited:e.merchantsRevisited})})),e.default.setMerchantById(i),a(i)):(i.sliderAccessCount=i.hasOwnProperty("sliderAccessCount")?i.sliderAccessCount:0,i.sliderAccessCount+=1,chrome.storage.local.get({merchantsRevisited:{}}).then((async function(t){var s=t.merchantsRevisited;s[r.toString()]?Date.now()-s[r.toString()].lastAccess<36e5?(s[r.toString()]={lastAccess:Date.now(),sliderAccessCount:s[r.toString()].sliderAccessCount+1},await chrome.storage.local.set({merchantsRevisited:s}),i.sliderAccessCount=s[r.toString()].sliderAccessCount,e.default.setMerchantById(i)):(s[r.toString()]={lastAccess:Date.now(),sliderAccessCount:1},await chrome.storage.local.set({merchantsRevisited:s}),i.sliderAccessCount=1,e.default.setMerchantById(i)):(s[r.toString()]={lastAccess:Date.now(),sliderAccessCount:i.sliderAccessCount},await chrome.storage.local.set({merchantsRevisited:s}),e.default.setMerchantById(i))})),a(i))}else if("findMerchantByUrl"==t.message){var o=t.url;a(e.default.findMerchantByUrl(o))}else if("getMerchantById"==t.message){var l=t.id;a(e.default.getMerchantById(l))}else"getSettings"==t.message?a(e.default.getSettings()):"openNewTab"==t.message&&a(chrome.tabs.create({url:t.url}));return!0}))):chrome.runtime.onMessage.addListener((async function(t,s,a){if("getAllMerchants"==t.message)a(await e.default.getAllMerchants());else if("getTopMerchants"==t.message)a(await e.default.getTopMerchants());else if("getTopSavings"==t.message)a(await e.default.getTopSavings());else if("getUser"==t.message)a(await e.default.getUser());else if("getCurrentMerchant"==t.message)a(e.default.getCurrentMerchant());else if("contentLoaded"==t.message)c(t.url),a();else if("activateMerchant"==t.message){var n=t.id;e.default.getMerchantById(n).activated=!0,a()}else if("suspendMerchant"==t.message){var r=t.id,i=await e.default.getMerchantById(r);t.val?(i.sliderAccessCount=t.val,i.sliderAccessCount+=1,chrome.storage.local.get({merchantsRevisited:{}}).then((async function(e){e.merchantsRevisited[r.toString()]={lastAccess:Date.now(),sliderAccessCount:i.sliderAccessCount},await chrome.storage.local.set({merchantsRevisited:e.merchantsRevisited})})),e.default.setMerchantById(i),a(i)):(i.sliderAccessCount=i.hasOwnProperty("sliderAccessCount")?i.sliderAccessCount:0,i.sliderAccessCount+=1,chrome.storage.local.get({merchantsRevisited:{}}).then((async function(t){var s=t.merchantsRevisited;s[r.toString()]?Date.now()-s[r.toString()].lastAccess<36e5?(s[r.toString()]={lastAccess:Date.now(),sliderAccessCount:s[r.toString()].sliderAccessCount+1},await chrome.storage.local.set({merchantsRevisited:s}),i.sliderAccessCount=s[r.toString()].sliderAccessCount,e.default.setMerchantById(i)):(s[r.toString()]={lastAccess:Date.now(),sliderAccessCount:1},await chrome.storage.local.set({merchantsRevisited:s}),i.sliderAccessCount=1,e.default.setMerchantById(i)):(s[r.toString()]={lastAccess:Date.now(),sliderAccessCount:i.sliderAccessCount},await chrome.storage.local.set({merchantsRevisited:s}),e.default.setMerchantById(i))})),a(i))}else if("findMerchantByUrl"==t.message){var o=t.url;a(await e.default.findMerchantByUrl(o))}else if("getMerchantById"==t.message){var l=t.id;a(await e.default.getMerchantById(l))}else"getSettings"==t.message?a(await e.default.getSettings()):"openNewTab"==t.message&&a(await chrome.tabs.create({url:t.url}))})),chrome.tabs.onActivated.addListener((async function(){chrome.tabs.query({active:!0,lastFocusedWindow:!0},(function(e){c(e[0].url)}))})),chrome.tabs.onUpdated.addListener((function(e,t,s){c(s.url)})),chrome.tabs.onUpdated.addListener((function(e,t,s){return r(0,0,s)})),chrome.tabs.onActivated.addListener((async function(){chrome.tabs.query({active:!0,lastFocusedWindow:!0},(function(e){r(0,0,e=e[0])}))}))}(),async function(){var e=await chrome.storage.local.get({serpEnabled:"undefined"}),t=await chrome.storage.local.get({notificationEnabled:"undefined"});"undefined"===e.serpEnabled&&await chrome.storage.local.set({serpEnabled:!0}),"undefined"===t.notificationEnabled&&await chrome.storage.local.set({notificationEnabled:!0}),await chrome.storage.local.set({merchantsRevisited:{}})}(),i(),setInterval(i,t.default.DATA_FETCH_INTERVAL)})()})();