(()=>{"use strict";var t={895:t=>{let e;function n(){return e.clear()}async function s(t){const n=await e.get("settings"),s=n&&n.settings?n.settings:{};Object.assign(s,t),e.set({settings:s})}async function o(){const t=await e.get("settings");return t&&t.settings?t.settings:{}}e=browser.storage.local,t.exports={clear:n,setSettings:s,getSettings:o,saveIdToPath:function(t,n){e.set({[t]:n}).catch((t=>console.log("error on save id",t)))},getCloudcastPathFromId:async function(t){const n=await e.get(t).catch((t=>{}));return 0===Object.keys(n).length&&n.constructor===Object?void 0:n[t]},getCloudcastByPath:async function(t){const n=await e.get(t).catch((t=>{}));return void 0===n||0===Object.keys(n).length&&n.constructor===Object?void 0:n[t]},setMixData:async function(t){const r=t.path;try{await e.set({[r]:t})}catch(a){if(console.error(`Error on save for mixData ${r}`,a),a.name&&a.name.toLowerCase().includes("quota")){const a=await o();await n(),await s(a),await e.set({[r]:t})}}},getMultipleMixData:async function(t){const n=await e.get(t).catch((t=>{console.error(t)}));return n?t.filter((t=>!!n[t])).map((t=>n[t])):[]}}},524:t=>{XMLHttpRequest=content.XMLHttpRequest,t.exports={fetch:function(t,e){return new Promise(((n,s)=>{const o=new XMLHttpRequest;o.responseType="json",o.open("POST","https://app.mixcloud.com/graphql"),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("X-CSRFToken",function(t){const e=("; "+document.cookie).split("; "+t+"=");if(2===e.length)return e.pop().split(";").shift()}("csrftoken")),o.withCredentials=!0,o.onreadystatechange=function(t){this.readyState===XMLHttpRequest.DONE&&200!==this.status&&s(new Error("response status:"+o.status+" ("+o.statusText+")"))},o.onload=function(){n({xhrResponse:o.response})},o.send(JSON.stringify({id:"MwT",query:e,variables:t}))}))}}}},e={};function n(s){var o=e[s];if(void 0!==o)return o.exports;var r=e[s]={exports:{}};return t[s](r,r.exports,n),r.exports}(()=>{const t=n(524),e=n(895);function s(t){const e=chrome.runtime.getURL("icons/icon48.png"),n=chrome.runtime.getURL("onboarding/ext-icon.png"),s=t?chrome.runtime.getURL("onboarding/onboarding-install.html"):chrome.runtime.getURL("onboarding/onboarding-update.html");fetch(s).then((t=>t.text())).then((t=>{document.body.insertAdjacentHTML("afterbegin",t);const s=document.getElementById("mwt-dialog");document.getElementsByClassName("mwt-img-margin")[0].setAttribute("src",e);const o=document.getElementsByClassName("mwt-ext-icon")[0];o&&o.setAttribute("src",n);document.getElementsByClassName("mwt-rounded-button")[0].addEventListener("click",(()=>{s.close()})),s.showModal()})).catch((t=>{console.error("Error in retrieving onboarding.html :",t)}))}e.getSettings().then((t=>{!0===t.onboardingInstall?(t.onboardingInstall=!1,e.setSettings(t),setTimeout((()=>s(!0)),1e3)):!0===t.onboardingUpdate&&(t.onboardingUpdate=!1,e.setSettings(t),setTimeout((()=>s(!1)),1e3))})),chrome.runtime.onMessage.addListener(((e,n,s)=>{if("requestTracklist"===e.action)return function(e,n,s,o){return t.fetch(e,n).then((t=>{o(t)})).catch((t=>{console.error("Error on graphQLFetcher.fetch : "+t),o(null)})),!0}(e.variables,e.query,0,s);"playTrack"===e.action?function(t,e){0;setTimeout((()=>{const e=document.getElementsByTagName("audio")[0];e&&(e.currentTime=t)}),200),e({})}(e.timestamp,s):"requestMixPathFromPlayer"===e.action&&function(t){const e=Array.from(document.getElementsByClassName("styles__PlainLink-css-in-js__sc-1fruqy3-2")).map((t=>({text:t.firstChild.firstChild.nodeValue,hrefParts:t.href.replace("https://www.mixcloud.com/","").split("/")}))).filter((t=>3===t.hrefParts.length));e&&e.length>0?t({mixTitle:e[0].text,mixPath:"/"+e[0].hrefParts[0]+"/"+e[0].hrefParts[1]+"/"}):t(null)}(s)}))})()})();