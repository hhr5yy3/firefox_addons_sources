(() => {
async function Ue(o){let a=window.location.href.split("/my-events/")[0]+`/api/render/googleconsole/config?_format=json&time=${Date.now}`,r=await(await fetch(a,{headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.9","content-type":"application/json","ot-tracer-sampled":"true",priority:"u=1, i","sec-ch-ua-mobile":"?1","sec-ch-ua-platform":'"Android"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin"},referrer:"https://am.ticketmaster.com/jaguars/my-events/4893",referrerPolicy:"strict-origin-when-cross-origin",body:null,method:"GET",mode:"cors",credentials:"include"})).json();window.googleClientId=r.ClientID,o()}function Le(){const o=document.createElement("div");o.id="g_id_signin",document.querySelector('[data-testid="actions"]').appendChild(o),google.accounts.id.initialize({client_id:window.googleClientId,callback:Je}),google.accounts.id.renderButton(o,{theme:"outline",size:"large"}),google.accounts.id.prompt()}async function Je(o){console.log("Encoded JWT ID token: "+o.credential);let a=await fetch(`${window.location.href.split("/my-events/")[0]}/session/token?_format=json&time=${Date.now()}`,{headers:{accept:"application/json, text/plain, */*","content-type":"application/json"},referrer:"https://am.ticketmaster.com/",referrerPolicy:"strict-origin-when-cross-origin",body:null,method:"GET",mode:"cors",credentials:"include"}),i=await a.text();console.log(i),a=await fetch(`${window.location.href.split("/my-events/")[0]}/api/google/binding?_format=json&time=${Date.now()}`,{headers:{accept:"application/json, text/plain, */*","content-type":"application/json","X-CSRF-Token":i},referrer:"https://am.ticketmaster.com/",referrerPolicy:"strict-origin-when-cross-origin",body:JSON.stringify({googleIdToken:o.credential}),method:"POST",mode:"cors",credentials:"include"}),a.status==200?alert("Success binding to your gmail account. Have fun making links!"):alert("The gmail you are attempting is not a match to the gmail connected to this wallet. If this is a mistake please try again or contact Ticketmaster for further assistance.");let r=await a.text();console.log(r)}async function Fe(){for(;!document.querySelector('[data-testid="actions"]')||!window.google;)await new Promise(o=>setTimeout(o,300));await new Promise(o=>setTimeout(o,5e3)),Ue(Le)}const Be=async(o,a)=>{var w,D,N,v,j;let i=`https://am.ticketmaster.com/${a}/api/v2/member/events/${o}?_format=json&time=${Date.now()}`,r=await fetch(i,{credentials:"include"}),t=await r.json();if(!((w=t==null?void 0:t.events)!=null&&w.sections)){console.log(t),console.log("ERROR: Didn't find sections inside the event");return}let n=t.events,d=n.hostEventId,e=[];for(let f=0;f<n.sections.length;f++){let p=n.sections[f];for(let C=0;C<p.rows.length;C++){let b=p.rows[C];for(let m=0;m<b.seats.length;m++){let g=b.seats[m],O=g.id,T=g.barcode,u=!1,$={entryGate:g.gatePortal,ticketType:(D=g==null?void 0:g.priceType)==null?void 0:D.name,prices:g==null?void 0:g.purchasePrice};e.push({...g,id:O,barcode:T,addedValue:u,additionalInfo:$})}}}r=await fetch(`https://am.ticketmaster.com/${a}/session/token?_format=json&time=${Date.now()}`,{headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.9","content-type":"application/json","sec-ch-ua-mobile":"?1","sec-ch-ua-platform":'"Android"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin"},referrer:`https://am.ticketmaster.com/${a}/my-events/${o}`,referrerPolicy:"strict-origin-when-cross-origin",body:null,method:"GET",mode:"cors",credentials:"include"});let s=await r.text();for(let f=0;f<5&&(await new Promise(p=>setTimeout(p,5e3)),r=await fetch(`https://am.ticketmaster.com/${a}/api/render-ticket/secure-barcode?_format=json`,{headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.9","cache-control":"no-cache","content-type":"application/json",pragma:"no-cache","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-csrf-token":s.trim()},body:JSON.stringify({deviceOs:"ANDROID",hostEventId:d,ticket_ids:e.map(p=>({id:p.id,barcode:p.barcode,addedValue:p.addedValue,additionalInfo:p.additionalInfo}))}),referrer:`https://am.ticketmaster.com/${a}/my-events/${o}`,referrerPolicy:"strict-origin-when-cross-origin",method:"POST",mode:"cors",credentials:"include"}),t=await r.json(),console.log(t),!t.tickets);f++);let h=t.tickets.reduce((f,p)=>{var T,u,$,E;let C=e.find(A=>A.id===p.ticketId),b=n.date.dateOverrideText||"",m=n.date.timeOverrideText||"",g;if(n.date.datetime&&!b){n.date.datetime=new Date(n.date.datetime);const A={weekday:"short",month:"short",day:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0,timeZone:(T=n.date.datetime)==null?void 0:T.timezone};g=new Intl.DateTimeFormat("en-US",A).format(n.date.datetime),m&&(g=g.slice(0,17)+" . "+m)}else g=(b||"TBA")+" . "+m;let O="";try{O=JSON.parse(atob(document.cookie.split(";").find(A=>A.includes("id-token")).replace("id-token=","").split(".")[1])).email}catch{try{O=JSON.parse(document.querySelector('[data-drupal-selector="drupal-settings-json"]').textContent).componentConfigData.userInfo.email}catch{}}return f[p.barcode]={eventId:p.eventId,eventName:n.name,eventDate:n.date.datetime,eventDateString:g,venueName:n.venue.name,barcode:p.barcode,token:p.token,id:p.ticketId,row:p.row,seat:p.seat,section:p.section,ticketType:C.priceType.name,exitPortal:C.gatePortal,ticketBack:{value:p.barcode,ticketBackTermsText:""},email:O,address1:n.venue.address.streetAddress.line1,city:(u=n.venue.address)==null?void 0:u.city,postalCode:($=n.venue.address)==null?void 0:$.postalCode,region:(E=n.venue.address)==null?void 0:E.stateCode,site:"TM",theme:"AM"},f},{});return h=Object.values(h),{site:"TM",theme:"AM",eventId:h[0].eventId,eventName:n.name,venueName:n.venue.name,eventDate:n.date.datetime,eventDateString:h[0].eventDateString,address1:n.venue.address.streetAddress.line1,city:(N=n.venue.address)==null?void 0:N.city,postalCode:(v=n.venue.address)==null?void 0:v.postalCode,region:(j=n.venue.address)==null?void 0:j.stateCode,tickets:h}},Ge=async o=>{try{console.log("AM: ",o);let i=document.location.href.split(window.location.hostname+"/")[1].split("/")[0],r=`https://am.ticketmaster.com/${i}/api/v2/member/events?_format=json&time=${Date.now()}`,d=((await(await fetch(r,{credentials:"include"})).json())._embedded.events||[]).map(w=>w.id);if(!d)return{success:!1,message:"No events found."};let e=[],s=5,h=0;for(let w of d){for(;h>s;)await new Promise(D=>setTimeout(D,100));h++,e.push(Be(w,i).catch(console.log).finally(()=>{h--}))}return e=await Promise.all(e),{success:!0,orders:(e||[]).filter(Boolean)}}catch(a){return console.log("getOrdersList",a),{success:!1,message:"Failed to get orders list, please make sure you are still logged in am.ticketmaster."}}};var be,ke;(ke=(be=window==null?void 0:window.location)==null?void 0:be.href)!=null&&ke.includes&&window.location.href.includes("am.ticketmaster.com")&&(setInterval(()=>{try{let o=JSON.parse(atob(document.cookie.split(";").find(a=>a.includes("id-token")).replace("id-token=","").split(".")[1])).email;o&&(document.title=o)}catch{try{let a=JSON.parse(document.querySelector('[data-drupal-selector="drupal-settings-json"]').textContent).componentConfigData.userInfo.email;a&&(document.title=a)}catch{}}},1e3),Fe());const ze={getOrdersList:Ge},qe=async o=>{var a,i,r,t,n,d,e,s;try{console.log("AXS: ",o);let h=JSON.parse(atob(document.cookie.split("axsid_user=")[1].split(";")[0].split(".").at(0))).oauth.access_token;if(!h)return null;let N=(await(await fetch(`https://accounts.discovery-prod.axs.com/v1/Users/profile?includeVeritixData=true&ContextId=0&access_token=${h}&clientId=11`)).json()).profile,v=`https://accounts.discovery-prod.axs.com/v1/Tickets/upcoming?contextId=0&access_token=${h}&includeExternalOrders=true&includeUpgradeOffers=true&includeFinancialData=false&ignoreCache=true&bc=`,f=await(await fetch(v,{credentials:"include",headers:{accept:"application/json","Content-Type":"application/json"}})).json(),p=f.events,C=f.tickets,b=[];for(let m of p){let g=m.text,O=((a=m==null?void 0:m.axsEvent)==null?void 0:a.cmsEventDateTime)||(m.time||"").replace("Z",""),T=m.venue.title,u=((i=m.axsEvent)==null?void 0:i.id)||m.flashEventConfigId,$=m.flashEventConfigId,E=m.tickets,A=O,k=C.filter(l=>E.includes(l.seatid)).filter(l=>l.flashMemberId).map(l=>{var I,S,M,U,c;let R=l.flashMemberId,J=l.region;if(!R)return;let F=N.memberAttributes.find(y=>y.id==R&&y.region==J).mobileId;if(F)return{id:l.seatid||l.id,type:l.type,barcode:l.fullBarcode,section:l.section,purchaseId:l.orderno,row:l.row,seat:l.seat,ticketId:l.primarySeatId,eventDateString:A,backgroundImg:m.imageFromCms,timezone:l.timezone||((I=m.axsEvent)==null?void 0:I.timeZoneAbbreviation)||"",doorDateTime:(S=m.axsEvent)==null?void 0:S.doorDateTime,city:((M=m==null?void 0:m.venue)==null?void 0:M.city)||"",state:((U=m==null?void 0:m.venue)==null?void 0:U.state)||"",venueUrl:m.axsEvent.venue.venueUrl||((c=m==null?void 0:m.venue)==null?void 0:c.venueUrl)||"",firstName:N.first_name,lastName:N.last_name,externalEntranceInfo:l.externalEntranceInfo,priceLabel:l.priceLabel,seatNeighborhood:l.seatNeighborhood,token:{memberId:R,mobileId:F,clientId:"101"},generalAdmission:l.isGa,theme:"AXS",site:"AXS",checked:!0}});b.push({site:"AXS",theme:"AXS",eventName:g,eventDate:O,eventDateString:O,timezone:(r=k[0])==null?void 0:r.timezone,backgroundImg:(t=k==null?void 0:k[0])==null?void 0:t.backgroundImg,doorDateTime:(n=k[0])==null?void 0:n.doorDateTime,venueUrl:(d=k[0])==null?void 0:d.venueUrl,firstName:(e=k[0])==null?void 0:e.firstName,lastName:(s=k[0])==null?void 0:s.lastName,venueName:T,eventId:u,tickets:k.map(l=>({id:l.id,type:l.type,email:JSON.parse(atob(document.cookie.split("axsid_user=")[1].split(";")[0].split(".").at(0))).email,barcode:l.fullBarcode,section:l.section,row:l.row,seat:l.seat,ticketId:l.primarySeatId,city:l.city,state:l.state,externalEntranceInfo:l.externalEntranceInfo,priceLabel:l.priceLabel,seatNeighborhood:l.seatNeighborhood,token:l.token,generalAdmission:l.generalAdmission,purchaseId:l.purchaseId,theme:"AXS"}))})}return{success:!0,orders:b}}catch(h){return console.log("getOrdersList",h),{success:!1,message:"Failed to get orders list, please make sure you are still logged in fanaccount.axs.com."}}};var Ie,Se;(Se=(Ie=window==null?void 0:window.location)==null?void 0:Ie.href)!=null&&Se.includes&&window.location.href.includes("fanaccount.axs.com")&&setInterval(()=>{try{let o=JSON.parse(atob(document.cookie.split("axsid_user=")[1].split(";")[0])).email;o&&(document.title=o)}catch{}},1e3);const He={getOrdersList:qe},Ve=async o=>{var a,i;try{console.log("MLB: ",o);let r=localStorage.getItem("okta-token-storage"),t=(i=(a=JSON.parse(r||"{}"))==null?void 0:a.accessToken)==null?void 0:i.accessToken;if(!t)return null;let e=(await(await fetch("https://prod.boxoffice.mlb.com/api/v2/users/ticketSummaries?ballpark_summary=true&refresh=true&includeForwards=true",{credentials:"include",headers:{accept:"application/json","Content-Type":"application/json",authorization:`Bearer ${t}`,"mlb-boxoffice-client":"kZjXdxY46+JBMm1wYk7Hw1mEsKvTdrQvDMQlH+fe"}})).json()).summaries||[],s=[];for(let h of e){let w=h.event.name||h.event.awayTeamName+" @ "+h.event.homeTeamName,D=h.event.time_local,N=h.event.venueName,v=h.event.gamePk,j=h.event.awayTeamId,f=h.event.homeTeamId;s.push({site:"MLB",eventName:w,eventDate:D,venueName:N,eventId:v,awayTeamId:j,homeTeamId:f,accessToken:t})}return{success:!0,orders:(s||[]).filter(Boolean)}}catch(r){return console.log("getOrdersList",r),{success:!1,message:"Failed to get orders list, please make sure email is verified first or refresh event page and try again."}}};async function Ce({eventName:o,homeTeamId:a,eventId:i,accessToken:r,eventDate:t,venueName:n,awayTeamId:d},e=3){var s;try{let w=await(await fetch(`https://prod.boxoffice.mlb.com/api/v2/users/tickets?teamID=${a}&eventID=${i}&includeTicketBack=true&ballpark_summary=true&refresh=false`,{credentials:"include",headers:{accept:"application/json","Content-Type":"application/json",authorization:`Bearer ${r}`,"mlb-boxoffice-client":"kZjXdxY46+JBMm1wYk7Hw1mEsKvTdrQvDMQlH+fe"}})).json(),D=(w==null?void 0:w.tickets)||[],N=localStorage.getItem("okta-token-storage"),v=JSON.parse(N||"{}").access_token.claims.sub,j="",f=D.filter(p=>{var C,b,m,g,O;return!((C=p.barcode)!=null&&C.available)||!((b=p.barcode)!=null&&b.message)?(j="Barcodes are on delay, barcodeless delivery isn't available through bulk tool.",!1):((m=p==null?void 0:p.ticketAccount)==null?void 0:m.provider)!=="TDC"&&!((g=p.barcode)!=null&&g.barcodeSecret)?(((O=p.ticketAccount)==null?void 0:O.provider)==="TM"?j="Link isn't available in MLB. Please generate this link through am.ticketmaster":j="Link isn't available in MLB. Please check ballpark app to see where the tickets will be available at.",!1):!0}).map(p=>{var C,b,m;return{id:p.ticketID,section:(C=p.location.section)==null?void 0:C.value,row:(b=p.location.row)==null?void 0:b.value,seat:(m=p.location.seat)==null?void 0:m.value,barcode:p.barcode,email:v,backgroundImg:p.backgroundImg,homeTeamId:p.event.homeTeamId,awayTeamId:p.event.awayTeamId,homeTeamName:p.event.homeTeamName,awayTeamName:p.event.awayTeamName,ticketBack:p.ticketBack,extendedData:p.extendedData,nameOnAccount:p.ticketAccount.nameOnAccount,accountId:p.ticketAccount.accountID,eventId:p.event.gamePk,eventDateString:p.event.time_local,eventTimezone:p.event.time_zone_local,venueName:p.event.venueName,eventName:p.event.awayTeamName+" @ "+p.event.homeTeamName,site:"MLB",theme:"BALLPARK"}});return{site:"MLB",siteId:2,theme:"BALLPARK",email:v,eventName:o,eventDate:t,eventDateString:t,backgroundImg:(s=f==null?void 0:f[0])==null?void 0:s.backgroundImg,message:j,venueName:n,eventId:i,homeTeamId:a,awayTeamId:d,tickets:f}}catch(h){if(console.log("getSingleOrder",h),e>0)return await Ce({eventName:o,homeTeamId:a,eventId:i,accessToken:r,eventDate:t,venueName:n,awayTeamId:d},e-1)}}var Te,Oe;(Oe=(Te=window==null?void 0:window.location)==null?void 0:Te.href)!=null&&Oe.includes&&window.location.href.includes("mlb.com")&&setInterval(()=>{try{let o=localStorage.getItem("okta-token-storage"),a=JSON.parse(o||"{}").access_token.claims.sub;a&&(document.title=a)}catch{}},1e3);const ye={getOrdersList:Ve,getSingleOrder:Ce};function Ke(){let o="",a=[8,4,4,4,12],i=[];for(let r=0;r<a.length;r++){let t="";for(let n=0;n<a[r];n++)t+=Math.floor(Math.random()*16).toString(16);i.push(t)}return o=i.join("-"),o}async function Xe({eventId:o,site:a}){try{return await(await fetch(`https://securemypass.com/api/v1/events?site=${a}&eventId=${o}`)).json()}catch(i){throw console.error("Error fetching event data:",i),i}}async function Ze({orderToken:o,purchaseId:a,email:i}){var p,C,b,m,g,O,T,u,$,E,A,k,l,R,J,F,I,S,M,U;let r=await fetch(`https://${window.location.hostname.replace("www.","my.")}/view-order/json/order/${o}?lang=en-us`,{credentials:"include"}),t=await r.json(),n=JSON.parse(JSON.stringify(t));n.items=n.items.map(c=>{let y=c.tickets;return y=y.filter(B=>{var z;return((z=B==null?void 0:B.location)==null?void 0:z.seat)!=="SHELL"&&B.status!=="VOIDED"}),y!=null&&y.length?(c.tickets=y,c):null}).filter(Boolean);let d=(C=(p=n==null?void 0:n.items)==null?void 0:p[0])==null?void 0:C.id,e=[],s;for(let c of n.items){d=c.id;let y=await Xe({eventId:d,site:"TM"});s=y==null?void 0:y.discoveryId;let B=!!((b=((c==null?void 0:c.eligibilities)||[]).find(x=>x.type=="RET"))!=null&&b.eligible),z=!!((m=((c==null?void 0:c.eligibilities)||[]).find(x=>x.type=="MOBILE"))!=null&&m.eligible)||n.delivery.type==="MOBILE_ENTRY"||n.delivery.name==="Mobile"||!!n.items.find(x=>x.tickets.find(H=>H.barcode));if((B||z)&&(c!=null&&c.tickets.find(x=>x==null?void 0:x.barcode))){if(s){let P=`https://${window.location.hostname.replace("www.","my.")}/deliver-tickets/async/json/order/${o}/view?eventId=${s}`;r=await fetch(P,{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),t=await r.json();let q=(g=t==null?void 0:t._link)==null?void 0:g.source;if(q)for(let V=0;V<30&&(await new Promise(Z=>setTimeout(Z,2e3)),r=await fetch(q,{credentials:"include",headers:{}}),t=await r.json().catch(()=>{}),!(t!=null&&t.outputs||(t==null?void 0:t.responseCode)!==202));V++);}let x=(t==null?void 0:t.outputs)||[],H=[];c.tickets.forEach(P=>{P!=null&&P.barcode&&H.push({barcode:P.barcode,eventId:c.id,name:c.name,location:P.location})}),console.log("Getting Token Map: ",n.id),r=await fetch(`https://${window.location.hostname.replace("www.","my.")}/deliver-tickets/async/json/order/${encodeURIComponent(n.id)}/ret?safeTix=${!B&&z?"False":"True"}`,{credentials:"include",headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({deviceId:Ke(),deviceOs:"IOS",deviceType:"WEB",tickets:[...H.map(P=>({eventId:P.eventId,section:P.location.section,row:P.location.row,seat:P.location.seat,barcode:P.barcode+"e",addedValue:!1}))]})}),t=await r.json(),console.log("Stream: ",t,r.status);let X=(O=t==null?void 0:t._link)==null?void 0:O.source;if(X)for(let P=0;P<30&&(await new Promise(q=>setTimeout(q,2e3)),r=await fetch(X,{credentials:"include",headers:{}}),t=await r.json().catch(()=>{}),!(t!=null&&t.tokenMap||(t==null?void 0:t.responseCode)!==202));P++);t!=null&&t.tokenMap?(console.log("TokenMap found."),c={...c,tickets:c.tickets.map(P=>{var q;return{...P,streamToken:t==null?void 0:t.tokenMap[P.barcode+"e"],streamInfo:(q=x.find(V=>V.data.value.includes(P.barcode||"0x00")))==null?void 0:q.data}})},e.push(c)):console.log("Error finding tokenMap...")}else console.log("No Barcodes found.")}if(n.items=e,console.log("Final Order: ",n),!n.items.find(c=>{var y;return(y=c==null?void 0:c.tickets)==null?void 0:y.length}))return;const h=n.items[0].dateRange,w=new Date(h.startDate),D={weekday:"short",month:"short",day:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0,timeZone:h.timezone};let v=new Intl.DateTimeFormat("en-US",D).format(w),j=[];for(let c of n.items||[]){c.tickets.sort((y,B)=>{const z=y.id.toLowerCase(),x=B.id.toLowerCase();return z.localeCompare(x)});for(let y of c.tickets)(T=y.streamToken)!=null&&T.barcode&&j.push({id:y.id,section:y.location.section,purchaseId:a,row:y.location.row,seat:y.location.seat||y.id,barcode:y.barcode,eventName:c.name,venueName:c.venue.name,eventId:c.id,ticketType:(u=y.ticketType)==null?void 0:u.name,exitPortal:($=y.streamInfo)==null?void 0:$.exitPortal,ticketBack:y==null?void 0:y.streamInfo,token:(E=y==null?void 0:y.streamToken)==null?void 0:E.barcode,eventDateString:v,address1:(A=c.venue.location)==null?void 0:A.address1,city:(k=c.venue.location)==null?void 0:k.city,postalCode:(l=c.venue.location)==null?void 0:l.postalCode,region:(R=c.venue.location)==null?void 0:R.region,generalAdmission:y.location.generalAdmission,charges:y.charges,type:c.type,site:"TM",theme:"TM"})}let f={};for(let c of j||[])f[c.eventId]={...f[c.eventId]||{},eventName:c.eventName,eventDate:c.eventDate,eventDateString:c.eventDateString,venueName:c.venueName,eventId:c.eventId,address1:c.address1,city:c.city,postalCode:c.postalCode,region:c.region,site:"TM",theme:"TM",tickets:[...((J=f[c.eventId])==null?void 0:J.tickets)||[],{id:c.id,email:i,token:c.token,section:c.section,row:c.row,seat:c.seat,ticketType:c.ticketType||c.type==="UPSELL"?(I=(F=c.charges)==null?void 0:F[0])==null?void 0:I.name:null,comment:c.exitPortal,barcode:((S=c==null?void 0:c.ticketBack)==null?void 0:S.value)||(c.barcode||"").replace("e","")+"e",ticketBackTermsText:(U=(M=c.ticketBack)==null?void 0:M.branding)==null?void 0:U.termsText,generalAdmission:c.generalAdmission,purchaseId:a}]};return Object.values(f)}const Ye=async o=>{try{console.log("TM: ",o);let r=(await(await fetch(`https://${window.location.host.replace("www.","my.")}/list-orders/json/upcoming`,{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","cache-control":"no-cache",pragma:"no-cache",priority:"u=1, i","x-tmlangcode":"en-us","x-tmplatform":"global","x-tmregion":"200"},referrer:`https://${window.location.hostname}/user/orders`,referrerPolicy:"strict-origin-when-cross-origin",body:null,method:"GET",mode:"cors",credentials:"include"})).json()).orders||[],t=[],n=0,d=2;for(let e of r){for(;n>=d;)await new Promise(D=>setTimeout(D,100));n++;let s=e.id,h=e.name,w=JSON.parse(atob(document.cookie.split("id-token=")[1].split(";")[0].split(".")[1])).email;t.push(Ze({orderToken:s,purchaseId:h,email:w}).catch(console.log).finally(()=>{n--}))}return t=await Promise.all(t),{success:!0,orders:(t||[]).filter(Boolean).flat()}}catch(a){return console.log("getOrdersList",a),{success:!1,message:"Failed to get orders list, please make sure email is verified first or refresh event page and try again."}}};async function We(o){let r=(await(await fetch(`https://securemypass.com/client-api/stream-links/google-client-id?siteId=1&url=${window.location.href}`)).json()).clientId;window.googleClientId=r,o()}function Qe(){const o=document.createElement("div");o.id="g_id_signin",document.querySelector("[class^=styles__actions]").appendChild(o),google.accounts.id.initialize({client_id:window.googleClientId,callback:et}),google.accounts.id.renderButton(o,{theme:"outline",size:"large"}),google.accounts.id.prompt()}async function et(o){var t;console.log("Encoded JWT ID token: "+o.credential);let a=await fetch(`${window.location.href.split("/order/")[0]}/deliver-tickets/async/json/complete-account-binding`,{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/json",priority:"u=1, i","sec-ch-ua-mobile":"?1","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin"},referrer:"https://my.ticketmaster.com/order/Z7IVgZOxvZ16kGUGFPa/tickets?eventId=0D006089BF872448",referrerPolicy:"strict-origin-when-cross-origin",body:JSON.stringify({googleIdToken:o.credential}),method:"POST",mode:"cors",credentials:"include"}),i=await a.json(),r=(t=i==null?void 0:i._link)==null?void 0:t.source;for(let n=0;n<30&&(await new Promise(d=>setTimeout(d,2e3)),a=await fetch(r,{credentials:"include",headers:{}}),i=await a.json().catch(()=>{}),!(a.status>=200&&a.status<300&&i.responseCode!==202||(i==null?void 0:i.responseCode)!==202));n++);a.status>=200&&a.status<300&&!(i!=null&&i.errorType)?alert("Success binding to your gmail account. Have fun making links!"):alert("The gmail you are attempting is not a match to the gmail connected to this wallet. If this is a mistake please try again or contact Ticketmaster for further assistance.")}async function tt(){for(;!document.querySelector("[class^=styles__actions]")||!window.google;)await new Promise(o=>setTimeout(o,300));We(Qe)}var je,De;(De=(je=window==null?void 0:window.location)==null?void 0:je.href)!=null&&De.includes&&(window.location.href.includes("my.ticketmaster.")||window.location.href.includes("my.livenation.")||window.location.href.includes("www.ticketmaster.com")||window.location.href.includes("www.livenation.com"))&&(setInterval(()=>{try{let o=JSON.parse(atob(document.cookie.split("id-token=")[1].split(";")[0].split(".")[1])).email;o&&(document.title=o)}catch{}},1e3),tt());const at={getOrdersList:Ye};async function ot(){let o=await fetch(window.location.href).then(r=>r.text()),a=o.split("AF_initDataCallback(")[1].split(");`")[0].split(");<\/script>")[0];const i=new URLSearchParams(window.location.search).get("state");i&&(o=await(await fetch("https://securemypass.com/api/v1/stream-links/parse-google-wallet-code",{method:"POST",body:JSON.stringify({code:a,eventId:i}),headers:{"content-type":"Application/JSON"}})).json(),o!=null&&o.ticket&&(document.title=o.ticket.section+"-"+o.ticket.row+"-"+o.ticket.seat))}var Ne;(Ne=window.location.href)!=null&&Ne.includes("pay.google.com")&&ot();let _e="SecureMyPass";console.log("SecureMyPass_Web_Module_Active");async function K(o,{data:a}){window.postMessage({source:_e,method:o,...a||{}},"*")}function nt(){let o="",a=[8,4,4,4,12],i=[];for(let r=0;r<a.length;r++){let t="";for(let n=0;n<a[r];n++)t+=Math.floor(Math.random()*16).toString(16);i.push(t)}return o=i.join("-"),o}async function it({eventId:o,site:a}){try{return await(await fetch(`https://securemypass.com/api/v1/events?site=${a}&eventId=${o}`)).json()}catch(i){throw console.error("Error fetching event data:",i),i}}async function st(o,a){var O,T,u,$,E,A,k,l,R,J,F,I,S,M,U,c,y,B,z,x,H,X,P,q,V,Z,te,ae,oe,ne,ie,se,re,le,ce,de,me,pe,ue,fe,he,ge,we,ve;let i=window.location.href,r=i.split("/user/order/")[1].split("/")[0],t=i.split("/view")[0].split("/").at(-1),n=JSON.parse(atob(document.cookie.split("id-token=")[1].split(";")[0].split(".")[1])).email,d=await fetch(`https://${window.location.hostname}/api/eventinfo/${t}`,{credentials:"include",headers:{...window.location.hostname.includes(".co.uk")?{}:{"x-tmlangcode":"en-us","x-tmplatform":"global","x-tmregion":((E=($=(u=(T=(O=window==null?void 0:window.__NEXT_DATA__)==null?void 0:O.props)==null?void 0:T.pageProps)==null?void 0:u.initialReduxState)==null?void 0:$.regions)==null?void 0:E.code)||"200","x-tmevent":t}}}),e=await d.json(),s=e==null?void 0:e.discoEventId,h=(A=e==null?void 0:e.venue)==null?void 0:A.name,w=(k=e==null?void 0:e.venue)==null?void 0:k.streetAddress,D=((l=e==null?void 0:e.venue)==null?void 0:l.zip)||((R=e==null?void 0:e.venue)==null?void 0:R.postalCode),N=(J=e==null?void 0:e.venue)==null?void 0:J.country,v=(F=e==null?void 0:e.venue)==null?void 0:F.city,j=((I=e==null?void 0:e.dates)==null?void 0:I.eventDate)||"";d=await fetch(`https://${window.location.hostname}/api/user/orders/${decodeURIComponent(r)}`,{credentials:"include",headers:{...window.location.hostname.includes(".co.uk")?{}:{"x-tmlangcode":"en-us","x-tmplatform":"global","x-tmregion":((y=(c=(U=(M=(S=window==null?void 0:window.__NEXT_DATA__)==null?void 0:S.props)==null?void 0:M.pageProps)==null?void 0:U.initialReduxState)==null?void 0:c.regions)==null?void 0:y.code)||"200"}}});let f=await d.json();if(!f||!((z=(B=f.order)==null?void 0:B.tickets)!=null&&z.length))return{success:!1,message:"Unable to get tickets info, please refresh and try again."};(x=f==null?void 0:f.venues)!=null&&x[0]&&(h=(H=f==null?void 0:f.venues)==null?void 0:H[0].name,N=(X=f==null?void 0:f.venues)==null?void 0:X[0].country,(P=f==null?void 0:f.venues)==null||P[0].state,v=(q=f==null?void 0:f.venues)==null?void 0:q[0].city);let p=f.order.tickets,C=f.order.orderToken,b=[],m=[],g=[];try{g=await(await fetch("https://www.ticketmaster.co.uk/api/user/entry-media",{headers:{...window.location.hostname.includes(".co.uk")?{"x-tmlangcode":"en-gb","x-tmplatform":"global","x-tmregion":"601","content-type":"application/json"}:{"x-tmlangcode":"en-us","x-tmplatform":"global","x-tmregion":((oe=(ae=(te=(Z=(V=window==null?void 0:window.__NEXT_DATA__)==null?void 0:V.props)==null?void 0:Z.pageProps)==null?void 0:te.initialReduxState)==null?void 0:ae.regions)==null?void 0:oe.code)||"200","content-type":"application/json"}},referrer:"https://www.ticketmaster.co.uk/user/order/",referrerPolicy:"strict-origin-when-cross-origin",body:JSON.stringify({orderToken:C,eventId:p[0].eventId,ticketIds:p.map(Y=>Y.id)}),method:"POST",mode:"cors",credentials:"include"})).json(),Array.isArray(g)||(g=[])}catch(_){console.log(_)}if(h.toLowerCase()=="intuit dome"){let _=a==null?void 0:a.SOTC;if(console.log("HAVE COOKIE NOW: ",_),_){let L=await(await fetch("https://securemypass.com/client-api/stream-links/app-token",{method:"POST",headers:{"content-type":"Application/json"},body:JSON.stringify({purchaseId:"",accessToken:_,orderToken:"",venueName:h,discoveryId:s||t,email:n})})).json();m=(L==null?void 0:L.parsed)||[]}}for(let _ of p){let Y=_.eventId,L=m.find(G=>G.id===_.id),$e=L==null?void 0:L.pass_data,W=L==null?void 0:L.token,Q=g.find(G=>G.ticketId==_.id);!W&&!((se=(ie=(ne=_.ticketPrint)==null?void 0:ne.entryMedia)==null?void 0:ie.find(G=>G.subType==="safetix"))!=null&&se.token)&&((re=_.ticketPrint)==null?void 0:re.eligibility)==="eligible"&&((ce=(le=_.ticketPrint)==null?void 0:le.entryMedia)!=null&&ce.find(Re=>Re.subType==="qrCode"))&&_.ticketPrint.rawBarcodeNumber&&(W=btoa(JSON.stringify({b:_.ticketPrint.rawBarcodeNumber,rt:"barcode"})));let Ee=!!((me=((de=_.ticketPrint)==null?void 0:de.reasons)||[])!=null&&me.includes("ticketNotReleased")),ee=f.events.find(G=>G.id===Y),Ae=ee.title,Pe=ee.venueId;j=((ue=(pe=ee.startDateTime||"")==null?void 0:pe.toString())==null?void 0:ue.slice(0,19))||j.toString().slice(0,19);let Me=new Intl.DateTimeFormat("en-US",{weekday:"short",month:"short",day:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0}).format(new Date(j)),xe={eventId:_.eventId,eventName:Ae,eventDate:j,eventDateString:Me,venueName:h,venueId:Pe,address1:w,city:v,postalCode:D,country:N,discoveryId:s,email:n,purchaseId:f.order.reference,pass_data:$e,backgroundImg:(L==null?void 0:L.backgroundImg)||((fe=f.events[0])==null?void 0:fe.imageUrl),deliveryId:_.deliveryId,comment:_.entryGate,id:_.id,row:_.row,section:_.section,status:_.status,barcode:(he=_.ticketPrint)==null?void 0:he.barcodeNumber,seat:_.seat,token:(Q==null?void 0:Q.token)||((ve=(we=(ge=_.ticketPrint)==null?void 0:ge.entryMedia)==null?void 0:we.find(G=>G.subType==="safetix"))==null?void 0:ve.token)||W||"0",ticketBackTermsText:(_.seatAttributes||[]).map(G=>G.value+".").filter(Boolean).join(" "),onDelay:Ee};b.push(xe)}return b}async function rt(o,a){var w,D,N,v,j,f,p,C,b,m,g,O;let i=o.orderToken,r,t,n=JSON.parse(atob(document.cookie.split("id-token=")[1].split(";")[0].split(".")[1])).email,d=await fetch(`https://${window.location.hostname}/view-order/json/order/${i}?lang=en-us`,{credentials:"include"}),e=await d.json(),s=JSON.parse(JSON.stringify(e)),h=s.inAppOnly;if(s.items=s.items.map(T=>{let u=T.tickets||[];return u=u.filter($=>{var E;return((E=$==null?void 0:$.location)==null?void 0:E.seat)!=="SHELL"&&$.status!=="VOIDED"}),u!=null&&u.length?(T.tickets=u,T):null}).filter(Boolean),h){console.log("COOKIE::::",a);let T=a==null?void 0:a.SOTC;console.log("HAVE COOKIE NOW: ",T);let u=[];if(T){let E=await(await fetch("https://securemypass.com/client-api/stream-links/app-token",{method:"POST",headers:{"content-type":"Application/json"},body:JSON.stringify({purchaseId:s.name||"_NONE_",accessToken:T,orderToken:i})})).json();u=(E==null?void 0:E.parsed)||[],s.items=s.items.map(A=>({...A,tickets:A.tickets.map(k=>{let l=u.find(J=>J.id===k.id),R=(l==null?void 0:l.token)&&{barcode:l.token,appToken:!0};return{...k,deviceKeyBindingRequired:l==null?void 0:l.deviceKeyBindingRequired,deviceBindingApplied:l==null?void 0:l.deviceBindingApplied,deliveryDate:l==null?void 0:l.deliveryDate,pass_data:l==null?void 0:l.pass_data,barcode:(l==null?void 0:l.barcode)||(k==null?void 0:k.barcode),streamToken:R,inAppOnly:h,backgroundImg:l==null?void 0:l.backgroundImg,streamInfo:{exitPortal:l==null?void 0:l.entry_gate,branding:{termsText:l==null?void 0:l.ticketBackTermsText}}}})}))}}else{t=(D=(w=s==null?void 0:s.items)==null?void 0:w[0])==null?void 0:D.id;let T=[];for(let u of s.items){t=u.id;let $=await it({eventId:t,site:"TM"});r=$==null?void 0:$.discoveryId;let E=!!((N=((u==null?void 0:u.eligibilities)||[]).find(k=>k.type=="RET"))!=null&&N.eligible),A=!!((v=((u==null?void 0:u.eligibilities)||[]).find(k=>k.type=="MOBILE"))!=null&&v.eligible)||((j=s==null?void 0:s.delivery)==null?void 0:j.type)==="MOBILE_ENTRY"||((f=s==null?void 0:s.delivery)==null?void 0:f.name)==="Mobile"||!!s.items.find(k=>k.tickets.find(l=>l.barcode));if((E||A)&&(u!=null&&u.tickets.find(k=>k==null?void 0:k.barcode))){if(r){let I=`https://${window.location.hostname}/deliver-tickets/async/json/order/${i}/view?eventId=${r}`;d=await fetch(I,{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),e=await d.json();let S=(p=e==null?void 0:e._link)==null?void 0:p.source;if(S)for(let M=0;M<10&&(await new Promise(U=>setTimeout(U,2e3)),d=await fetch(S,{credentials:"include",headers:{}}),e=await d.json().catch(()=>{}),!(e!=null&&e.outputs||(e==null?void 0:e.responseCode)!==202));M++);}let k=(e==null?void 0:e.outputs)||[],l=[];u.tickets.forEach(I=>{I!=null&&I.barcode&&l.push({barcode:I.barcode,eventId:u.id,name:u.name,location:I.location})}),console.log("Getting Token Map: ",s.id);let R=(b=(C=s==null?void 0:s._links)==null?void 0:C.ret)==null?void 0:b.source;d=await fetch(R||`https://${window.location.hostname}/deliver-tickets/async/json/order/${encodeURIComponent(s.id)}/ret?safeTix=${!E&&A?"false":"true"}`,{credentials:"include",headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({deviceId:nt(),deviceOs:"ANDROID",deviceType:"WEB",tickets:[...l.map(I=>({eventId:I.eventId,section:I.location.section,row:I.location.row,seat:I.location.seat,barcode:I.barcode+"e",addedValue:!1}))]})}),e=await d.json(),console.log("Stream: ",e,d.status);let J=(m=e==null?void 0:e._link)==null?void 0:m.source;if(J)for(let I=0;I<10&&(await new Promise(S=>setTimeout(S,2e3)),d=await fetch(J,{credentials:"include",headers:{}}),e=await d.json().catch(()=>{}),!(e!=null&&e.tokenMap||(e==null?void 0:e.responseCode)!==202&&(e==null?void 0:e.responseCode)!==500||e.responseCode==500&&I>1));I++);let F=[];if(!((O=(g=Object.values((e==null?void 0:e.tokenMap)||{}))==null?void 0:g[0])!=null&&O.barcode)){console.log("COOKIE::::",a);let I=a==null?void 0:a.SOTC;if(console.log("HAVE COOKIE NOW: ",I),I){let M=await(await fetch("https://securemypass.com/client-api/stream-links/app-token",{method:"POST",headers:{"content-type":"Application/json"},body:JSON.stringify({purchaseId:s.name||"_NONE_",accessToken:I,orderToken:i,email:n})})).json();F=(M==null?void 0:M.parsed)||[]}}!(e!=null&&e.tokenMap)&&!F.length?(console.log("Error finding tokenMap..."),T.push(u)):(console.log("TokenMap/mobiletix found."),u={...u,tickets:u.tickets.map(I=>{var U,c;let S=F.find(y=>y.id===I.id),M=S!=null&&S.token?{barcode:S.token,appToken:!0}:(U=e==null?void 0:e.tokenMap)==null?void 0:U[(I==null?void 0:I.barcode)+"e"];return{...I,deviceKeyBindingRequired:S==null?void 0:S.deviceKeyBindingRequired,deviceBindingApplied:S==null?void 0:S.deviceBindingApplied,deliveryDate:S==null?void 0:S.deliveryDate,pass_data:S==null?void 0:S.pass_data,barcode:(S==null?void 0:S.barcode)||(I==null?void 0:I.barcode),streamToken:M,inAppOnly:!!(S!=null&&S.token),streamInfo:(c=k.find(y=>y.data.value.includes(I.barcode||"0x00")))==null?void 0:c.data,backgroundImg:S==null?void 0:S.backgroundImg}})},T.push(u))}else console.log("No Barcodes found.")}s.items=T,console.log("Final Order: ",s)}return s&&(s.email=n),s}async function lt(o){var p,C;let a;try{a=JSON.parse(atob(document.cookie.split(";").find(b=>b.includes("id-token")).replace("id-token=","").split(".")[1])).email}catch{try{a=JSON.parse(document.querySelector('[data-drupal-selector="drupal-settings-json"]').textContent).componentConfigData.userInfo.email}catch{}}let i=window.location.href.split("my-events/")[1].split("?")[0].split("/")[0],r=document.location.href.split("/my-events")[0],t=`${r}/api/v2/member/events/${i}?_format=json`,n=r.split(window.location.hostname+"/")[1].split("/")[0],d=await fetch(t,{credentials:"include"}),e=await d.json();if(!((p=e==null?void 0:e.events)!=null&&p.sections)){console.log(e),console.log("ERROR: Didn't find sections inside the event");return}let s=e.events,h=s.hostEventId,w=[];for(let b=0;b<s.sections.length;b++){let m=s.sections[b];for(let g=0;g<m.rows.length;g++){let O=m.rows[g];for(let T=0;T<O.seats.length;T++){let u=O.seats[T],$=u.id,E=u.barcode+"J",A=!1,k={entryGate:u.gatePortal,ticketType:(C=u==null?void 0:u.priceType)==null?void 0:C.name,prices:u==null?void 0:u.purchasePrice};E&&w.push({...u,id:$,barcode:E,addedValue:A,additionalInfo:k})}}}d=await fetch(`https://am.ticketmaster.com/${n}/api/member/list?_format=json&time=${Date.now()}`,{headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.9","content-type":"application/json","sec-ch-ua-mobile":"?1","sec-ch-ua-platform":'"Android"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin"},referrer:`https://am.ticketmaster.com/${n}/my-events/${i}`,referrerPolicy:"strict-origin-when-cross-origin",body:null,method:"GET",mode:"cors",credentials:"include"}),e=await d.json();let D=e[0].memberId;d=await fetch(`https://am.ticketmaster.com/${n}/session/token?_format=json&time=${Date.now()}`,{headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.9","content-type":"application/json","sec-ch-ua-mobile":"?1","sec-ch-ua-platform":'"Android"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin"},referrer:`https://am.ticketmaster.com/${n}/my-events/${i}`,referrerPolicy:"strict-origin-when-cross-origin",body:null,method:"GET",mode:"cors",credentials:"include"});let N=await d.text();console.log({csrfToken:N});const v=10;let j=[];for(let b=0;b<w.length;b+=v){const m=w.slice(b,b+v);let g,O;for(let T=0;T<5;T++)if(await new Promise(u=>setTimeout(u,5e3)),g=await fetch(`https://am.ticketmaster.com/${n}/api/render-ticket/secure-barcode?time=${Date.now()}&amid=${encodeURIComponent(btoa(D+"--"+Date.now()))}&_format=json`,{headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.9","cache-control":"no-cache","content-type":"application/json",pragma:"no-cache","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-csrf-token":N.trim()},body:JSON.stringify({deviceOs:"ANDROID",hostEventId:h,ticket_ids:m.map(u=>({id:u.id,barcode:u.barcode,addedValue:u.addedValue,additionalInfo:u.additionalInfo}))}),referrer:`https://am.ticketmaster.com/${n}/my-events/${i}`,referrerPolicy:"strict-origin-when-cross-origin",method:"POST",mode:"cors",credentials:"include"}),O=await g.json(),O.tickets){j=j.concat(O.tickets);break}}console.log(j);let f=j.reduce((b,m)=>{var O,T,u,$,E,A,k,l;let g=w.find(R=>R.id===m.ticketId);return b[m.barcode]={eventId:m.eventId,barcode:m.barcode,token:m.token,id:m.ticketId,row:m.row,seat:m.seat,section:m.section,pass_data:m.passData?{...m.passData||{},android:{...((O=m.passData)==null?void 0:O.android)||{}}}:{},eventName:s.name,venueName:s.venue.name,ticketType:((T=g==null?void 0:g.priceType)==null?void 0:T.name)||"",exitPortal:g==null?void 0:g.gatePortal,ticketBack:{value:m.barcode,ticketBackTermsText:""},eventDate:($=(u=s.date.datetime)==null?void 0:u.toString())==null?void 0:$.slice(0,19),eventDateOverride:s.date.dateOverrideText||"",eventTimeOverride:s.date.timeOverrideText||"",address1:s.venue.address.streetAddress.line1,city:(E=s.venue.address)==null?void 0:E.city,postalCode:(A=s.venue.address)==null?void 0:A.postalCode,region:(k=s.venue.address)==null?void 0:k.stateCode,backgroundImg:(l=s.imagesLinks)==null?void 0:l.mobile,site:"TM",theme:"AM",email:a},b},{});return console.log("Got results: ",f),f}async function ct(o){var r,t;let a=localStorage.getItem("okta-token-storage");console.log("GOT TOKENS FROM LOCAL STORAGE...");let i=(t=(r=JSON.parse(a||"{}"))==null?void 0:r.accessToken)==null?void 0:t.accessToken;if(o.orders){if(console.log("GOT REQUEST..."),!i)return null;let e=(await(await fetch("https://prod.boxoffice.mlb.com/api/v2/users/ticketSummaries?ballpark_summary=true&refresh=true&includeForwards=true",{credentials:"include",headers:{accept:"application/json","Content-Type":"application/json",authorization:`Bearer ${i}`,"mlb-boxoffice-client":"kZjXdxY46+JBMm1wYk7Hw1mEsKvTdrQvDMQlH+fe"}})).json()).summaries;if(console.log("SUMMARIES: ",e),e.length)return{orders:!0,summaries:e}}else{o.awayTeamId,o.eventDateString,o.venueName;let n=o.homeTeamId,d=o.eventId,s=await(await fetch(`https://prod.boxoffice.mlb.com/api/v2/users/tickets?teamID=${n}&eventID=${d}&includeTicketBack=true&ballpark_summary=true&refresh=false`,{credentials:"include",headers:{accept:"application/json","Content-Type":"application/json",authorization:`Bearer ${i}`,"mlb-boxoffice-client":"kZjXdxY46+JBMm1wYk7Hw1mEsKvTdrQvDMQlH+fe"}})).json(),h=(s==null?void 0:s.tickets)||[],w=localStorage.getItem("okta-token-storage"),D=JSON.parse(w||"{}").access_token.claims.sub;return(h||[]).map(N=>(N.email=D,N))}}async function dt(o){let a=JSON.parse(atob(decodeURIComponent(document.cookie.split("axsid_user=")[1].split(";")[0]))).oauth.access_token;if(!a)return null;let r=await(await fetch(`https://accounts.discovery-prod.axs.com/v1/Users/profile?includeVeritixData=true&ContextId=0&access_token=${a}&clientId=11`)).json();if(o.orders){let t=`https://accounts.discovery-prod.axs.com/v1/Tickets/upcoming?contextId=0&access_token=${a}&includeExternalOrders=true&includeUpgradeOffers=true&includeFinancialData=false&ignoreCache=true&bc=`,d=await(await fetch(t,{credentials:"include",headers:{accept:"application/json","Content-Type":"application/json"}})).json(),e=d.events,s=d.tickets,h=JSON.parse(atob(decodeURIComponent(document.cookie.split("axsid_user=")[1].split(";")[0]))).email;if(s!=null&&s.length)return{orders:{events:e,tickets:s,accessToken:a},profile:r,email:h}}}async function mt(o){let a=o.eventId,i=await fetch(`https://seatgeek.com/api/event_tickets/${a}?web_platform=desktop&force_view_listing=true&client_id=MTY2MnwxMzgzMzIwMTU4`,{credentials:"include",headers:{Authorization:`token ${document.cookie.split("SeatGeekAccessToken=")[1].split(";")[0]}`}}),r=await i.json(),t=JSON.parse(JSON.stringify(r));i=await fetch(`https://seatgeek.com/data/users/me?r=${Date.now()}`,{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9",priority:"u=1, i","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin"},referrer:"https://seatgeek.com/account/tickets",referrerPolicy:"strict-origin-when-cross-origin",body:null,method:"GET",mode:"cors",credentials:"include"});let d=(await i.json()).apiUser.email;return t&&(t.email=d),t}async function pt(o){console.log("DISPATCHING...");let a=await fetch(window.location.href).then(w=>w.text()),i=a.split("AF_initDataCallback(")[1].split(");`")[0].split(");<\/script>")[0];const r=new URLSearchParams(window.location.search).get("eventId"),t=new URLSearchParams(window.location.search).get("ticketType"),n=new URLSearchParams(window.location.search).get("comment"),d=new URLSearchParams(window.location.search).get("backgroundImg"),e=new URLSearchParams(window.location.search).get("email"),s=new URLSearchParams(window.location.search).get("purchaseId");return!i.includes("totp_value_0")&&!i.includes("Pass cannot be saved by this user")?{success:!1,message:"Unable to make links using the google method for this order, manual barcode extraction is required, read more about it in our telegram news channel: https://t.me/+s_CcUp293Xc2MzJh"}:(a=await(await fetch("https://securemypass.com/api/v1/stream-links/parse-google-wallet-code",{method:"POST",body:JSON.stringify({code:i,eventId:r,ticketType:t,comment:n,backgroundImg:d,email:e,purchaseId:s}),headers:{"content-type":"Application/JSON"}})).json(),a)}async function ut(o){if(console.log("DISPATCHING..."),window.location.href.includes("ticketdelivery.evenue.net")){let t=await(await fetch(`https://ticketdelivery.evenue.net/ticketsFetch/${window.location.href.split("ticketsFetch/")[1].split("?")[0]}?contentType=pb&id=${document.location.href.split("id=")[1].split("&")[0]}&fileName=pbtoc.json&isMisc=false`)).json();if(!(t!=null&&t.tickets))return;let n=0;for(let e of(t==null?void 0:t.tickets)||[]){let h=await(await fetch(`https://ticketdelivery.evenue.net/tickets/regenerate/${window.location.href.split("ticketsFetch/")[1].split("?")[0]}/${document.location.href.split("id=")[1].split("&")[0]}/google/${n++}`,{credentials:"omit",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:132.0) Gecko/20100101 Firefox/132.0",Accept:"application/json","Accept-Language":"en-US,en;q=0.5","Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"same-origin",Priority:"u=0"},referrer:"https://ticketdelivery.evenue.net",method:"GET",mode:"cors"})).json();e.appleFileName&&(e.pass_data={android:{url:h.googlePassUrl},ios:{url:`https://ticketdelivery.evenue.net/ticketsFetch/${window.location.href.split("ticketsFetch/")[1].split("?")[0]}?contentType=pb&id=${document.location.href.split("id=")[1].split("&")[0]}&isMisc=false&redirect=true&fileName=${e.appleFileName}`}})}return{ticketsData:{tickets:t.tickets.map(e=>{var s,h,w,D;return{eventId:window.location.href.split("ticketsFetch/")[1].split("?")[0],eventName:t.eventName,venueName:t.facilityName,eventDate:new Date(t.eventDate+" "+t.eventTime).toISOString(),eventDateString:t.eventDay+", "+t.eventDate+" at "+t.eventTime,barcode:e.barcode,id:e.barcode,level:((s=e.seatInfo)==null?void 0:s.level)||e.levelValue,section:((h=e.seatInfo)==null?void 0:h.section)||e.sectionValue,row:((w=e.seatInfo)==null?void 0:w.row)||e.rowValue,seat:((D=e.seatInfo)==null?void 0:D.seat)||e.seatValue,pass_data:e.pass_data,theme:"EVTD"}})}}}let a=new URL(window.location.href).hostname,i=document.cookie.split("pac-authz=")[1].split("; ")[0];if(o.events){let t=await(await fetch(`https://${a}/pac-api/orderhistory`,{headers:{accept:"application/json, text/plain, */*","content-type":"application/json","pac-authz":i,pragma:"no-cache",referer:"https://"+a},referrerPolicy:"strict-origin-when-cross-origin",body:JSON.stringify({endTime:"2030-01-01T05:00:00.000Z",sorting:"asc",signal:{}}),method:"POST",credentials:"include"})).json();return{events:((t==null?void 0:t.events)||[]).map(d=>(d.eventDate=d.eventDtFacStr,d.eventDateString=new Date(d.eventDate).toLocaleString(),d))}}else{let r=o.event,t=window.location.href.split("linkID=")[1].split("&")[0].split("?")[0];r.linkId=t;let n=await fetch(`https://${a}/pac-api/accounts`,{headers:{accept:"application/json","pac-authz":i,referer:window.location.href},method:"GET",mode:"cors",credentials:"include"}),d=await n.json(),e=d.dataAccountId,s=r.eventId.replaceAll(":",".");n=await fetch(`https://${a}/pac-api/onePassesForEvent`,{credentials:"include",headers:{Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.5","Content-Type":"application/json;charset=utf-8","pac-authz":i,"Sec-GPC":"1","Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"same-origin"},referrer:`https://${a}/myaccount/eventdetails/${r.eventId}`,body:JSON.stringify({eventId:e+"."+s,patronId:d.key.id,passType:"google"}),method:"POST",mode:"cors"});let h=await n.json();Array.isArray(h)||(h=[]);for(let w of r.seats){let D,N,v=h.find(g=>g.barcode==w.barcode),j=w.transferSeatId||"",f=j.split("^")[2]||"",p=f.split(":")[0]||"",C=(f.split(":")[1]||"").split("^")[0],b=j.split("^").at(-2),m=j.split("^").at(-1);console.log({transferSeatId:j,transferSeatIdParsed:f,transferSeatIdLevel:p,transferSeatIdSec:C,transferSeatIdRow:b,transferSeatIdSeat:m}),w.level=(v==null?void 0:v.boLevel)||p||w.level,w.section=(v==null?void 0:v.boSection)||C||w.section,w.row=(v==null?void 0:v.boRow)||b||w.row,w.seats=(v==null?void 0:v.boSeat)||m||w.seats;for(let g=0;g<2;g++){let T=await(await fetch(`https://${a}/pac-api/mobile-pass`,{method:"POST",headers:{"content-type":"application/json","pac-authz":i,referer:`https://${a}/myaccount/eventdetails/`},body:JSON.stringify({ticketInfo:{barcode:w.barcode,dataAccountId:d.dataAccountId,patronId:d.key.id,season:r.seasonCd,event:r.id,seat:{level:(v==null?void 0:v.boLevel)||w.level,section:(v==null?void 0:v.boSection)||w.section,row:(v==null?void 0:v.boRow)||w.row,seat:(v==null?void 0:v.boSeat)||w.seats},passType:g==0?"apple":"google"}}),credentials:"include"})).json();console.log("PASS RESPONSE: ",T),D=D||T.applePassUrl,N=N||T.googlePassUrl,N&&D&&(w.pass_data={android:{url:N},ios:{url:D}})}}return{event:r}}}(async function(){window.addEventListener("message",async a=>{try{if(a.data&&a.data.source===_e){a.stopImmediatePropagation(),console.log("MessageFromContentScript:",a.data);let i=a.data,r=i.method,t=i.message,n=i.cookie,d;switch(r){case"getOrderInfo":let e;try{console.log("CURRENT HOST: ",window.location.hostname),window.location.href.includes("evenue.")?e=await ut(t):window.location.href.includes("pay.google")?e=await pt(t):window.location.href.includes("am.ticketmaster")?(console.log("DISPATCHING AM."),e=await lt(t)):(window.location.href.includes("ticketmaster.")||window.location.href.includes("livenation."))&&window.location.href.includes("/user/order/")?e=await st(t,n):window.location.href.includes("ticketmaster.")||window.location.href.includes("livenation.")?e=await rt(t,n):window.location.href.includes("mlb.")?e=await ct(t):window.location.href.includes("axs.")?e=await dt(t):window.location.href.includes("seatgeek.")&&(e=await mt(t)),K("orderInfo",{data:{order:e}})}catch(s){console.log("ERROR OCCURED: ",s),K("error",{data:{message:"Unexpected error occured, please refresh / relogin and try again."}})}break;case"getOrdersList":console.log("ORDERS LIST URL: ",window.location.href);try{window.location.href.includes("am.ticketmaster")?(console.log("DISPATCHING AM."),d=await ze.getOrdersList(t)):window.location.href.includes("ticketmaster.")||window.location.href.includes("livenation.")?d=await at.getOrdersList(t):window.location.href.includes("mlb.")?d=await ye.getOrdersList(t):window.location.href.includes("axs.")&&(d=await He.getOrdersList(t)),K("ordersList",{data:d})}catch(s){console.log("ERROR OCCURED: ",s),K("error",{data:{message:"Unexpected error occured. Please relogin and try again."}})}break;case"getSingleOrder":console.log("SingleOrder url: ",window.location.href);try{window.location.href.includes("am.ticketmaster")?console.log("DISPATCHING AM."):window.location.href.includes("ticketmaster.")||window.location.href.includes("livenation.")||(window.location.href.includes("mlb.")?d=await ye.getSingleOrder(t):window.location.href.includes("axs.")),K("singleOrder",{data:d})}catch(s){console.log("ERROR OCCURED: ",s),K("error",{data:{message:"Unexpected error occured. Please relogin and try again."}})}break}}}catch(i){console.log(i)}})})();
})()