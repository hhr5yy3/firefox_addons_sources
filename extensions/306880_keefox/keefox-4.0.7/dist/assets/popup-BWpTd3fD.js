import { a as $STR, b as $ } from "./DollarPolyfills-DiqWGOUq.js";
import { o as openBlock, c as createElementBlock, a as createBaseVNode, b as createBlock, w as withCtx, r as resolveComponent, d as createVNode, e as createTextVNode, t as toDisplayString, f as renderList, F as Fragment, u as useStore, m as mapState, g as withKeys, h as withModifiers, i as createCommentVNode, n as normalizeStyle, j as mergeProps, k as withDirectives, v as vShow, l as createSlots, p as reactive, q as normalizeClass, s as createPinia, x as createApp, y as h, z as createVuetify, A as components, B as directives, I as IPCPiniaPlugin } from "./IPCPiniaPlugin-DCrAOz1n.js";
import { c as configManager, K as KeeLog, u as utils, p as punycode } from "./ConfigManager-DadTRJhU.js";
import { P as Port } from "./mutation-types-BIvNkZ3d.js";
import { _ as _export_sfc, P as PasswordGenerator, a as __unplugin_components_1$2, b as __unplugin_components_2$2 } from "./PasswordGenerator-_hnBzWs7.js";
import { c as copyStringToClipboard } from "./copyStringToClipboard-BshAkhz6.js";
import { F as Field$1, E as EntrySummary, G as GroupSummary, T as TemporaryIDString, a as Entry$1, b as Group, L as Locator } from "./Entry-B0M4TtnG.js";
import { A as Action } from "./Action-nSgaiNub.js";
import "./index-D6ogrY8Q.js";
const _hoisted_1$h = {
  viewBox: "0 0 24 24",
  width: "1.2em",
  height: "1.2em"
};
const _hoisted_2$f = /* @__PURE__ */ createBaseVNode("path", {
  fill: "currentColor",
  d: "M7 2v11h3v9l7-12h-4l4-8z"
}, null, -1);
const _hoisted_3$d = [
  _hoisted_2$f
];
function render$d(_ctx, _cache) {
  return openBlock(), createElementBlock("svg", _hoisted_1$h, [..._hoisted_3$d]);
}
const __unplugin_components_5 = { name: "mdi-flash", render: render$d };
const _hoisted_1$g = {
  viewBox: "0 0 24 24",
  width: "1.2em",
  height: "1.2em"
};
const _hoisted_2$e = /* @__PURE__ */ createBaseVNode("path", {
  fill: "currentColor",
  d: "M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5a3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97s-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1s.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64z"
}, null, -1);
const _hoisted_3$c = [
  _hoisted_2$e
];
function render$c(_ctx, _cache) {
  return openBlock(), createElementBlock("svg", _hoisted_1$g, [..._hoisted_3$c]);
}
const __unplugin_components_4$1 = { name: "mdi-cog", render: render$c };
const _hoisted_1$f = {
  viewBox: "0 0 24 24",
  width: "1.2em",
  height: "1.2em"
};
const _hoisted_2$d = /* @__PURE__ */ createBaseVNode("path", {
  fill: "currentColor",
  d: "M10 19h3v3h-3zm2-17c5.35.22 7.68 5.62 4.5 9.67c-.83 1-2.17 1.66-2.83 2.5C13 15 13 16 13 17h-3c0-1.67 0-3.08.67-4.08c.66-1 2-1.59 2.83-2.25C15.92 8.43 15.32 5.26 12 5a3 3 0 0 0-3 3H6a6 6 0 0 1 6-6"
}, null, -1);
const _hoisted_3$b = [
  _hoisted_2$d
];
function render$b(_ctx, _cache) {
  return openBlock(), createElementBlock("svg", _hoisted_1$f, [..._hoisted_3$b]);
}
const __unplugin_components_3$1 = { name: "mdi-help", render: render$b };
const _hoisted_1$e = {
  viewBox: "0 0 24 24",
  width: "1.2em",
  height: "1.2em"
};
const _hoisted_2$c = /* @__PURE__ */ createBaseVNode("path", {
  fill: "currentColor",
  d: "M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"
}, null, -1);
const _hoisted_3$a = [
  _hoisted_2$c
];
function render$a(_ctx, _cache) {
  return openBlock(), createElementBlock("svg", _hoisted_1$e, [..._hoisted_3$a]);
}
const __unplugin_components_2$1 = { name: "mdi-menu", render: render$a };
const _hoisted_1$d = {
  viewBox: "0 0 24 24",
  width: "1.2em",
  height: "1.2em"
};
const _hoisted_2$b = /* @__PURE__ */ createBaseVNode("path", {
  fill: "currentColor",
  d: "M12 17a2 2 0 0 0 2-2a2 2 0 0 0-2-2a2 2 0 0 0-2 2a2 2 0 0 0 2 2m6-9a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V10a2 2 0 0 1 2-2h1V6a5 5 0 0 1 5-5a5 5 0 0 1 5 5v2zm-6-5a3 3 0 0 0-3 3v2h6V6a3 3 0 0 0-3-3"
}, null, -1);
const _hoisted_3$9 = [
  _hoisted_2$b
];
function render$9(_ctx, _cache) {
  return openBlock(), createElementBlock("svg", _hoisted_1$d, [..._hoisted_3$9]);
}
const __unplugin_components_1$1 = { name: "mdi-lock", render: render$9 };
const _hoisted_1$c = {
  viewBox: "0 0 24 24",
  width: "1.2em",
  height: "1.2em"
};
const _hoisted_2$a = /* @__PURE__ */ createBaseVNode("path", {
  fill: "currentColor",
  d: "M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"
}, null, -1);
const _hoisted_3$8 = [
  _hoisted_2$a
];
function render$8(_ctx, _cache) {
  return openBlock(), createElementBlock("svg", _hoisted_1$c, [..._hoisted_3$8]);
}
const __unplugin_components_0$4 = { name: "mdi-plus", render: render$8 };
const _hoisted_1$b = {
  viewBox: "0 0 24 24",
  width: "1.2em",
  height: "1.2em"
};
const _hoisted_2$9 = /* @__PURE__ */ createBaseVNode("path", {
  fill: "currentColor",
  d: "M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12z"
}, null, -1);
const _hoisted_3$7 = [
  _hoisted_2$9
];
function render$7(_ctx, _cache) {
  return openBlock(), createElementBlock("svg", _hoisted_1$b, [..._hoisted_3$7]);
}
const __unplugin_components_0$3 = { name: "mdi-close", render: render$7 };
const autoRecoveryTimeMs = 12e4;
const manualRecoveryPromptTimeMs = 36e5;
const tooltipDelay = 750;
const _sfc_main$a = {
  props: ["notification"],
  // setup () {
  //     const { updateSaveState } = useStore();
  //     return { updateSaveState };
  // },
  data: () => ({
    tooltipDelay
  }),
  methods: {
    dispatchActionResponse(id, action, data) {
      const pm = Port.postMessage;
      switch (action) {
        case "enableHighSecurityKPRPCConnection":
          configManager.current.connSLClient = 3;
          configManager.save();
          break;
        case "loadUrlUpgradeKee":
          pm({ loadUrlUpgradeKee: true });
          break;
        case "disableNotifyWhenEntryUpdated":
          configManager.current.notifyWhenEntryUpdated = false;
          configManager.save();
          break;
        case "launchLoginEditorFromNotification":
          pm({
            loginEditor: {
              uuid: data.uuid,
              DBfilename: data.fileName
            }
          });
          break;
      }
      pm({ removeNotification: id });
    },
    closeNotification(id) {
      const pm = Port.postMessage;
      pm({ removeNotification: id });
    }
  }
};
const _hoisted_1$a = { style: { "float": "right" } };
function _sfc_render$a(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_mdi_close = __unplugin_components_0$3;
  const _component_v_btn = resolveComponent("v-btn");
  const _component_v_card_text = resolveComponent("v-card-text");
  const _component_v_tooltip = resolveComponent("v-tooltip");
  const _component_v_row = resolveComponent("v-row");
  const _component_v_col = resolveComponent("v-col");
  const _component_v_card_actions = resolveComponent("v-card-actions");
  const _component_v_card = resolveComponent("v-card");
  return openBlock(), createBlock(_component_v_card, { color: "yellow-lighten-3" }, {
    default: withCtx(() => [
      createBaseVNode("div", _hoisted_1$a, [
        createVNode(_component_v_btn, {
          variant: "text",
          class: "ml-4 mr-2 px-2 text-primary",
          onClick: _cache[0] || (_cache[0] = ($event) => $options.closeNotification($props.notification.id))
        }, {
          default: withCtx(() => [
            createTextVNode(toDisplayString(_ctx.$i18n("close")) + " ", 1),
            createVNode(_component_mdi_close)
          ]),
          _: 1
        })
      ]),
      createVNode(_component_v_card_text, { class: "text-primary" }, {
        default: withCtx(() => [
          (openBlock(true), createElementBlock(Fragment, null, renderList($props.notification.messages, (msg, index) => {
            return openBlock(), createElementBlock("p", { key: index }, toDisplayString(msg), 1);
          }), 128))
        ]),
        _: 1
      }),
      createVNode(_component_v_card_actions, null, {
        default: withCtx(() => [
          createVNode(_component_v_row, {
            justify: "center",
            align: "end",
            class: "mb-1 mt-1"
          }, {
            default: withCtx(() => [
              createVNode(_component_v_col, null, {
                default: withCtx(() => [
                  createVNode(_component_v_row, {
                    align: "end",
                    class: "ml-2 justify-left my-0"
                  }, {
                    default: withCtx(() => [
                      (openBlock(true), createElementBlock(Fragment, null, renderList($props.notification.buttons, (but, index) => {
                        return openBlock(), createBlock(_component_v_btn, {
                          id: but.id,
                          key: index,
                          class: "mr-4 my-2",
                          onClick: ($event) => $options.dispatchActionResponse(
                            $props.notification.id,
                            but.action,
                            but.values
                          )
                        }, {
                          default: withCtx(() => [
                            createVNode(_component_v_tooltip, {
                              location: "top",
                              disabled: !but.tooltip,
                              "open-delay": _ctx.tooltipDelay
                            }, {
                              default: withCtx(() => [
                                createBaseVNode("span", null, toDisplayString(but.tooltip), 1)
                              ]),
                              _: 2
                            }, 1032, ["disabled", "open-delay"]),
                            createTextVNode(" " + toDisplayString(but.label), 1)
                          ]),
                          _: 2
                        }, 1032, ["id", "onClick"]);
                      }), 128))
                    ]),
                    _: 1
                  })
                ]),
                _: 1
              })
            ]),
            _: 1
          })
        ]),
        _: 1
      })
    ]),
    _: 1
  });
}
const Notification = /* @__PURE__ */ _export_sfc(_sfc_main$a, [["render", _sfc_render$a]]);
function isEntrySummary(item) {
  return !!item.url;
}
function calculateMatchScore(item, keywords, parentGroupMatchScore, searchConfig, filter) {
  if (filter) {
    if (!filter(item))
      return 0;
    if (keywords.length < 1)
      return 1;
  } else if (keywords.length < 1) {
    return 0;
  }
  if (!isEntrySummary(item)) {
    if (parentGroupMatchScore > 0)
      return 1;
    for (const keyword of keywords) {
      if (item.title.toLowerCase().indexOf(keyword) >= 0)
        return 1;
    }
    return 0;
  }
  let matchScore = 0;
  for (const keyword of keywords) {
    let keywordScore = 0;
    if (searchConfig.searchTitles && item.title && item.title.toLowerCase().indexOf(keyword) >= 0) {
      keywordScore += searchConfig.weightTitles;
    }
    if (searchConfig.searchUsernames && item.usernameValue && item.usernameValue.toLowerCase().indexOf(keyword) >= 0) {
      keywordScore += searchConfig.weightUsernames;
    }
    if (searchConfig.searchURLs && item.uRLs && item.uRLs.filter(function(i) {
      return i.toLowerCase().indexOf(keyword) >= 0;
    }).length > 0) {
      keywordScore += searchConfig.weightURLs;
    }
    matchScore += keywordScore * (1 / keywords.length);
  }
  if (parentGroupMatchScore > 0)
    matchScore += searchConfig.weightGroups;
  return matchScore;
}
function resolveConfig(config) {
  if (!config)
    config = {};
  else {
    if (config.version != 1) {
      KeeLog.warn("Unknown search config version. Will use version 1 defaults");
    }
  }
  return {
    version: 1,
    searchAllDatabases: typeof config.searchAllDatabases !== "undefined" ? config.searchAllDatabases : true,
    searchTitles: typeof config.searchTitles !== "undefined" ? config.searchTitles : true,
    searchUsernames: typeof config.searchUsernames !== "undefined" ? config.searchUsernames : true,
    searchGroups: typeof config.searchGroups !== "undefined" ? config.searchGroups : true,
    searchURLs: typeof config.searchURLs !== "undefined" ? config.searchURLs : true,
    weightTitles: config.weightTitles || 2,
    weightUsernames: config.weightUsernames || 1,
    weightGroups: config.weightGroups || 0.25,
    weightURLs: config.weightURLs || 0.75,
    maximumResults: typeof config.maximumResults !== "undefined" ? config.maximumResults : 30,
    onComplete: config.onComplete,
    onMatch: config.onMatch
  };
}
function tokenise(text) {
  const tokens = text.match(/'[^']*'|"[^"]*"|[^\s ]+/g) || [];
  tokens.forEach(function(_value, index, array) {
    array[index] = array[index].replace(/(^['"])|(['"]$)/g, "").replace(/[\s ]+/g, " ").toLowerCase();
  });
  return tokens;
}
class KeeURL {
  constructor(_domain, _url, _isIPAddress) {
    this._domain = _domain;
    this._url = _url;
    this._isIPAddress = _isIPAddress;
  }
  get domain() {
    return this._domain;
  }
  get url() {
    return this._url;
  }
  get isIPAddress() {
    return this._isIPAddress;
  }
  get domainOrIPAddress() {
    return this._domain ?? (this._isIPAddress ? this._url.hostname : "");
  }
  get domainWithPort() {
    if (!this._domain)
      return "";
    if (this._url.port)
      return this._domain + ":" + this._url.port;
    return this._domain;
  }
  static fromString(urlStr) {
    if (!urlStr.startsWith("https://") && !urlStr.startsWith("http://") && !urlStr.startsWith("file://")) {
      urlStr = "https://" + urlStr;
    }
    try {
      const url = new URL(urlStr);
      const isIPAddress = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/.test(
        url.hostname
      );
      const domain = isIPAddress ? null : utils.psl.getDomain(url.hostname);
      return new KeeURL(domain, url, isIPAddress);
    } catch (e) {
      KeeLog.warn("Error processing URL: " + e);
    }
    return null;
  }
}
class SearcherAll {
  constructor(state, config) {
    this.state = state;
    this.searchConfig = resolveConfig(config);
    this.validateConfig();
  }
  execute(query, onComplete, filterDomains) {
    let abort = false;
    const filteringByDomain = filterDomains && filterDomains.length > 0 && Array.isArray(filterDomains) && filterDomains[0].length > 0 ? true : false;
    if (!this.configIsValid) {
      KeeLog.error("You can't execute a search while the search configuration is invalid.");
      abort = true;
    }
    if ((!query || query.length == 0) && !filteringByDomain)
      abort = true;
    if (this.state.KeePassDatabases.length == 0)
      abort = true;
    onComplete = onComplete || this.searchConfig.onComplete;
    if (abort) {
      if (onComplete) {
        onComplete([]);
        return;
      } else {
        return [];
      }
    }
    const results = [];
    const addResult = (result) => {
      if (this.searchConfig.onMatch) {
        result = this.searchConfig.onMatch(result);
        if (result)
          results.push(result);
        else
          return false;
      } else
        results.push(result);
      return true;
    };
    let keywords = [];
    if (Array.isArray(query))
      keywords = query;
    else if (query.length > 0)
      keywords = tokenise(query);
    let filter;
    if (filteringByDomain) {
      filter = (item) => {
        if (!item.uRLs || item.uRLs.length <= 0)
          return false;
        for (const filterDomain of filterDomains) {
          const filteredUrls = item.uRLs.filter((itemURL) => {
            try {
              if (itemURL.indexOf(filterDomain) < 0)
                return false;
              const url = KeeURL.fromString(itemURL);
              return url.domainOrIPAddress === filterDomain;
            } catch (e) {
              return false;
            }
          });
          if (filteredUrls.length > 0)
            return true;
        }
        return false;
      };
    }
    function actualSearch() {
      let databases;
      if (this.searchConfig.searchAllDatabases)
        databases = this.state.KeePassDatabases;
      else
        databases = [this.state.KeePassDatabases[this.state.ActiveKeePassDatabaseIndex]];
      for (let i = 0; i < databases.length; i++) {
        const root = databases[i].root;
        const dbFileName = databases[i].fileName;
        this.treeTraversal(root, keywords, 0, addResult.bind(this), 0, dbFileName, filter);
      }
      if (onComplete)
        onComplete(results);
    }
    if (onComplete) {
      this._makeAsyncTimer = window.setTimeout(actualSearch.bind(this), 1);
      return;
    } else {
      actualSearch.call(this);
      return results;
    }
  }
  validateConfig() {
    this.configIsValid = true;
    if (this.searchConfig.version != 1) {
      KeeLog.warn("Unknown config version");
      this.configIsValid = false;
    }
    if (this.searchConfig.searchAllDatabases !== true && this.searchConfig.searchAllDatabases !== false) {
      KeeLog.warn("searchAllDatabases should be a boolean");
      this.configIsValid = false;
    }
    if (this.searchConfig.searchTitles !== true && this.searchConfig.searchTitles !== false) {
      KeeLog.warn("searchTitles should be a boolean");
      this.configIsValid = false;
    }
    if (this.searchConfig.searchUsernames !== true && this.searchConfig.searchUsernames !== false) {
      KeeLog.warn("searchUsernames should be a boolean");
      this.configIsValid = false;
    }
    if (this.searchConfig.searchGroups !== true && this.searchConfig.searchGroups !== false) {
      KeeLog.warn("searchGroups should be a boolean");
      this.configIsValid = false;
    }
    if (this.searchConfig.searchURLs !== true && this.searchConfig.searchURLs !== false) {
      KeeLog.warn("searchURLs should be a boolean");
      this.configIsValid = false;
    }
    if (isNaN(this.searchConfig.weightTitles) || this.searchConfig.weightTitles <= 0) {
      KeeLog.warn("weightTitles should be a positive number");
      this.configIsValid = false;
    }
    if (isNaN(this.searchConfig.weightUsernames) || this.searchConfig.weightUsernames <= 0) {
      KeeLog.warn("weightUsernames should be a positive number");
      this.configIsValid = false;
    }
    if (isNaN(this.searchConfig.weightGroups) || this.searchConfig.weightGroups <= 0) {
      KeeLog.warn("weightGroups should be a positive number");
      this.configIsValid = false;
    }
    if (isNaN(this.searchConfig.weightURLs) || this.searchConfig.weightURLs <= 0) {
      KeeLog.warn("weightURLs should be a positive number");
      this.configIsValid = false;
    }
    if (isNaN(this.searchConfig.maximumResults) || this.searchConfig.maximumResults <= 0) {
      KeeLog.warn("maximumResults should be a positive number");
      this.configIsValid = false;
    }
    if (this.searchConfig.onComplete != null && typeof this.searchConfig.onComplete !== "function") {
      KeeLog.warn("onComplete should be a function (or ommitted)");
      this.configIsValid = false;
    }
    if (this.searchConfig.onMatch != null && typeof this.searchConfig.onMatch !== "function") {
      KeeLog.warn("onMatch should be a function (or ommitted)");
      this.configIsValid = false;
    }
    return this.configIsValid;
  }
  treeTraversal(branch, keywords, parentGroupMatchScore, addResult, currentResultCount, dbFileName, filter) {
    let totalResultCount = currentResultCount;
    for (const leaf of branch.entrySummaries) {
      const item = leaf;
      const matchResult = calculateMatchScore(
        item,
        keywords,
        parentGroupMatchScore,
        this.searchConfig,
        filter
      );
      if (matchResult > 0) {
        const accepted = addResult({
          ...item,
          ...{ relevanceScore: matchResult }
        });
        if (accepted) {
          totalResultCount++;
          if (totalResultCount >= this.searchConfig.maximumResults) {
            return totalResultCount;
          }
        }
      }
    }
    for (const subBranch of branch.groups) {
      const groupMatchScore = calculateMatchScore(
        { title: subBranch.title },
        keywords,
        parentGroupMatchScore,
        this.searchConfig,
        filter
      );
      totalResultCount = this.treeTraversal(
        subBranch,
        keywords,
        groupMatchScore,
        addResult,
        totalResultCount,
        dbFileName,
        filter
      );
      if (totalResultCount >= this.searchConfig.maximumResults)
        return totalResultCount;
    }
    return totalResultCount;
  }
}
const _sfc_main$9 = {
  setup() {
    const { updateSearchResults, updateCurrentSearchTerm } = useStore();
    return { updateSearchResults, updateCurrentSearchTerm };
  },
  data() {
    return {
      search: null
    };
  },
  computed: {
    ...mapState(useStore, ["currentSearchTerm", "KeePassDatabases", "ActiveKeePassDatabaseIndex"])
  },
  watch: {
    KeePassDatabases: function(newState, oldState) {
      this.onDBChanged();
    }
  },
  created() {
    this.onDBChanged();
  },
  methods: {
    onDBChanged() {
      this.search = new SearcherAll(
        {
          KeePassDatabases: this.KeePassDatabases,
          ActiveKeePassDatabaseIndex: this.ActiveKeePassDatabaseIndex
        },
        {
          version: 1,
          searchAllDatabases: configManager.current.searchAllOpenDBs,
          maximumResults: 50
        }
      );
    },
    onSearchComplete(entrySummaries) {
      KeeLog.debug("onSearchComplete");
      entrySummaries = entrySummaries.sort(function(a, b) {
        if (a.relevanceScore > b.relevanceScore)
          return -1;
        if (a.relevanceScore < b.relevanceScore)
          return 1;
        return 0;
      }).map((l) => Object.assign(l, { fullDetails: null }));
      this.updateSearchResults(entrySummaries);
    },
    onSearchInput(value) {
      this.updateCurrentSearchTerm(value);
      this.search.execute(value, this.onSearchComplete.bind(this), []);
    },
    focusFirstResult() {
      const firstCard = document.querySelector("#searchPanel > .v-card");
      if (firstCard) {
        firstCard.focus();
      }
    },
    handleEscape() {
      const searchBox = document.getElementById("searchBox");
      if (searchBox.value) {
        searchBox.value = "";
        searchBox.dispatchEvent(new Event("input"));
      } else {
        window.close();
      }
    }
  }
};
function _sfc_render$9(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_v_text_field = resolveComponent("v-text-field");
  return openBlock(), createBlock(_component_v_text_field, {
    id: "searchBox",
    "single-line": "",
    density: "compact",
    variant: "solo",
    placeholder: _ctx.$i18n("Search_label"),
    "hide-details": "",
    class: "search my-0 py-0 mx-2",
    style: {},
    name: "cc5704978dc0411591addc66d25c325b",
    "model-value": _ctx.currentSearchTerm,
    autofocus: "",
    "onUpdate:modelValue": $options.onSearchInput,
    onKeyup: [
      withKeys(withModifiers($options.focusFirstResult, ["stop", "prevent"]), ["arrow-down"]),
      withKeys(withModifiers($options.focusFirstResult, ["stop", "prevent"]), ["enter"]),
      withKeys(withModifiers($options.handleEscape, ["stop", "prevent"]), ["escape"])
    ]
  }, null, 8, ["placeholder", "model-value", "onUpdate:modelValue", "onKeyup"]);
}
const SearchInput = /* @__PURE__ */ _export_sfc(_sfc_main$9, [["render", _sfc_render$9]]);
const _hoisted_1$9 = {
  viewBox: "0 0 24 24",
  width: "1.2em",
  height: "1.2em"
};
const _hoisted_2$8 = /* @__PURE__ */ createBaseVNode("path", {
  fill: "currentColor",
  d: "M6.5 20q-2.28 0-3.89-1.57Q1 16.85 1 14.58q0-1.95 1.17-3.48q1.18-1.53 3.08-1.95q.63-2.3 2.5-3.72Q9.63 4 12 4q2.93 0 4.96 2.04Q19 8.07 19 11q1.73.2 2.86 1.5q1.14 1.28 1.14 3q0 1.88-1.31 3.19T18.5 20Z"
}, null, -1);
const _hoisted_3$6 = [
  _hoisted_2$8
];
function render$6(_ctx, _cache) {
  return openBlock(), createElementBlock("svg", _hoisted_1$9, [..._hoisted_3$6]);
}
const __unplugin_components_3 = { name: "mdi-cloud", render: render$6 };
const _hoisted_1$8 = {
  viewBox: "0 0 24 24",
  width: "1.2em",
  height: "1.2em"
};
const _hoisted_2$7 = /* @__PURE__ */ createBaseVNode("path", {
  fill: "currentColor",
  d: "M10 4H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-8z"
}, null, -1);
const _hoisted_3$5 = [
  _hoisted_2$7
];
function render$5(_ctx, _cache) {
  return openBlock(), createElementBlock("svg", _hoisted_1$8, [..._hoisted_3$5]);
}
const __unplugin_components_2 = { name: "mdi-folder", render: render$5 };
const _hoisted_1$7 = {
  viewBox: "0 0 24 24",
  width: "1.2em",
  height: "1.2em"
};
const _hoisted_2$6 = /* @__PURE__ */ createBaseVNode("path", {
  fill: "currentColor",
  d: "M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"
}, null, -1);
const _hoisted_3$4 = [
  _hoisted_2$6
];
function render$4(_ctx, _cache) {
  return openBlock(), createElementBlock("svg", _hoisted_1$7, [..._hoisted_3$4]);
}
const __unplugin_components_0$2 = { name: "mdi-chevron-up", render: render$4 };
const _hoisted_1$6 = {
  viewBox: "0 0 24 24",
  width: "1.2em",
  height: "1.2em"
};
const _hoisted_2$5 = /* @__PURE__ */ createBaseVNode("path", {
  fill: "currentColor",
  d: "M7.41 8.58L12 13.17l4.59-4.59L18 10l-6 6l-6-6z"
}, null, -1);
const _hoisted_3$3 = [
  _hoisted_2$5
];
function render$3(_ctx, _cache) {
  return openBlock(), createElementBlock("svg", _hoisted_1$6, [..._hoisted_3$3]);
}
const __unplugin_components_1 = { name: "mdi-chevron-down", render: render$3 };
const _hoisted_1$5 = {
  viewBox: "0 0 24 24",
  width: "1.2em",
  height: "1.2em"
};
const _hoisted_2$4 = /* @__PURE__ */ createBaseVNode("path", {
  fill: "currentColor",
  d: "M19 21H8V7h11m0-2H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2m-3-4H4a2 2 0 0 0-2 2v14h2V3h12z"
}, null, -1);
const _hoisted_3$2 = [
  _hoisted_2$4
];
function render$2(_ctx, _cache) {
  return openBlock(), createElementBlock("svg", _hoisted_1$5, [..._hoisted_3$2]);
}
const __unplugin_components_0$1 = { name: "mdi-content-copy", render: render$2 };
const _sfc_main$8 = {
  props: ["field"],
  data: () => ({
    revealed: false,
    tooltipDelay
  }),
  computed: {
    displayValue: function() {
      return Field$1.getDisplayValue(this.field, this.revealed);
    },
    tooltip: function() {
      return Field$1.getDisplayTooltip(this.field, this.revealed);
    },
    useful: function() {
      return this.field.type !== "checkbox" && this.displayValue.length > 0;
    },
    fieldStyle: function() {
      return this.field.type === "password" ? "cursor: pointer" : "cursor: default";
    }
  },
  methods: {
    toggleReveal: function() {
      this.revealed = !this.revealed;
    },
    copyValue: async function() {
      await copyStringToClipboard(Field$1.getDisplayValue(this.field, true));
    }
  }
};
function _sfc_render$8(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_v_tooltip = resolveComponent("v-tooltip");
  const _component_v_sheet = resolveComponent("v-sheet");
  const _component_mdi_content_copy = __unplugin_components_0$1;
  const _component_v_btn = resolveComponent("v-btn");
  return $options.useful ? (openBlock(), createBlock(_component_v_sheet, {
    key: 0,
    class: "my-0",
    style: { "display": "flex", "align-items": "center" }
  }, {
    default: withCtx(() => [
      createVNode(_component_v_sheet, { class: "text-truncate my-2 text-right flex-grow-1" }, {
        default: withCtx(() => [
          createBaseVNode("span", {
            style: normalizeStyle($options.fieldStyle),
            onClick: _cache[0] || (_cache[0] = (...args) => $options.toggleReveal && $options.toggleReveal(...args))
          }, [
            createVNode(_component_v_tooltip, {
              location: "bottom",
              "open-delay": _ctx.tooltipDelay,
              activator: "parent"
            }, {
              default: withCtx(() => [
                createBaseVNode("span", null, toDisplayString($options.tooltip), 1)
              ]),
              _: 1
            }, 8, ["open-delay"]),
            createTextVNode(" " + toDisplayString($options.displayValue), 1)
          ], 4)
        ]),
        _: 1
      }),
      createVNode(_component_v_sheet, { class: "my-1 mx-2 shrink" }, {
        default: withCtx(() => [
          createVNode(_component_v_btn, {
            size: "small",
            icon: "",
            class: "my-0",
            onClick: $options.copyValue
          }, {
            default: withCtx(() => [
              createVNode(_component_v_tooltip, {
                location: "start",
                "open-delay": _ctx.tooltipDelay,
                activator: "parent"
              }, {
                default: withCtx(() => [
                  createBaseVNode("span", null, toDisplayString(_ctx.$i18n("copy_value_to_clipboard")), 1)
                ]),
                _: 1
              }, 8, ["open-delay"]),
              createVNode(_component_mdi_content_copy)
            ]),
            _: 1
          }, 8, ["onClick"])
        ]),
        _: 1
      })
    ]),
    _: 1
  })) : createCommentVNode("", true);
}
const Field = /* @__PURE__ */ _export_sfc(_sfc_main$8, [["render", _sfc_render$8]]);
function locatorMatches(locator1, locator2) {
  if (locator1.type !== locator2.type)
    return false;
  if (locator1.id === locator2.id && locator1.name === locator2.name)
    return true;
  return false;
}
function fieldMatches(oldField, newField) {
  if (oldField.type !== newField.type)
    return false;
  if (oldField.value === newField.value)
    return true;
  if (oldField.locators.some(
    (locator1) => newField.locators.some((locator2) => locatorMatches(locator1, locator2))
  )) {
    return true;
  }
  return false;
}
function fieldMatchesType(oldField, newField) {
  if (oldField.type === newField.type)
    return true;
  return false;
}
function getNewLocator(oldField, newField) {
  var _a;
  if ((_a = newField.locators[0].autocompleteValues) == null ? void 0 : _a.some((v) => v === "new-password")) {
    return oldField.locators[0];
  }
  return newField.locators[0];
}
function reconcileFieldLists(oldFields, newFields) {
  const fields = [];
  const sortedFields = [];
  const matchedNewFieldIndexes = [];
  newFields.forEach((newField, newFieldIndex) => {
    if (newField.type !== "text")
      return;
    let matchingIndex = oldFields.findIndex((oldField) => fieldMatches(oldField, newField));
    if (matchingIndex === -1) {
      matchingIndex = oldFields.findIndex((oldField) => fieldMatchesType(oldField, newField));
    }
    if (matchingIndex >= 0) {
      fields.push(new Field$1({ ...newField, resetValue: oldFields[matchingIndex].value }));
      oldFields.splice(matchingIndex, 1);
      matchedNewFieldIndexes.push(newFieldIndex);
    }
  });
  newFields.forEach((newField, newFieldIndex) => {
    if (newField.type !== "password")
      return;
    let matchingIndex = oldFields.findIndex((oldField) => fieldMatches(oldField, newField));
    if (matchingIndex === -1) {
      matchingIndex = oldFields.findIndex((oldField) => fieldMatchesType(oldField, newField));
    }
    if (matchingIndex >= 0) {
      fields.push(
        new Field$1({
          ...newField,
          resetValue: oldFields[matchingIndex].value,
          locators: [getNewLocator(oldFields[matchingIndex], newField)]
        })
      );
      oldFields.splice(matchingIndex, 1);
      matchedNewFieldIndexes.push(newFieldIndex);
    }
  });
  newFields.forEach((newField, newFieldIndex) => {
    if (matchedNewFieldIndexes.indexOf(newFieldIndex) >= 0)
      return;
    const matchingIndex = oldFields.findIndex((oldField) => fieldMatches(oldField, newField));
    if (matchingIndex >= 0) {
      fields.push(new Field$1({ ...newField, resetValue: oldFields[matchingIndex].value }));
      oldFields.splice(matchingIndex, 1);
    } else {
      fields.push(newField);
    }
  });
  oldFields.forEach((f) => fields.push(f));
  const firstTextFieldIndex = fields.findIndex((f) => f.type === "text");
  if (firstTextFieldIndex >= 0) {
    sortedFields.push(fields.splice(firstTextFieldIndex, 1)[0]);
  }
  const firstPasswordFieldIndex = fields.findIndex((f) => f.type === "password");
  if (firstPasswordFieldIndex >= 0) {
    sortedFields.push(fields.splice(firstPasswordFieldIndex, 1)[0]);
  }
  return sortedFields.concat(fields);
}
function supplementEntryState(entry, saveState, urls) {
  const sd = saveState.submittedData;
  const submittedFields = sd ? sd.fields : [];
  const newFields = reconcileFieldLists(
    JSON.parse(JSON.stringify(entry.fields)),
    submittedFields
  );
  const overwriteWithSubmittedData = sd ? {
    URLs: [sd.url],
    fields: newFields,
    title: sd.title
  } : {};
  const overwriteWithURLs = urls ? {
    URLs: urls
  } : {};
  return Object.assign({}, entry, overwriteWithSubmittedData, overwriteWithURLs);
}
async function getAllFrameURLs(currentTab) {
  const frames = await chrome.webNavigation.getAllFrames({
    tabId: currentTab.id
  });
  return frames.map((f) => f.url);
}
async function reconcileURLs(oldUrls, submittedUrl) {
  var _a;
  const currentTab = !submittedUrl ? (await chrome.tabs.query({ active: true, currentWindow: true }))[0] : null;
  const compareUrl = submittedUrl ?? currentTab.url;
  if (oldUrls.some((url) => url === compareUrl)) {
    return { urls: oldUrls, showWarning: false };
  }
  const compareURLDomainOrIPAddress = (_a = KeeURL.fromString(compareUrl)) == null ? void 0 : _a.domainOrIPAddress;
  if (!compareURLDomainOrIPAddress) {
    return { urls: oldUrls, showWarning: false };
  }
  if (oldUrls.some(
    (url) => {
      var _a2;
      return ((_a2 = KeeURL.fromString(url)) == null ? void 0 : _a2.domainOrIPAddress) === compareURLDomainOrIPAddress;
    }
  )) {
    return {
      urls: [compareUrl].concat(oldUrls.slice(1)),
      showWarning: false
    };
  }
  if (!submittedUrl) {
    const allFrameUrls = await getAllFrameURLs(currentTab);
    if (oldUrls.some(
      (url) => allFrameUrls.some(
        (fu) => {
          var _a2, _b;
          return ((_a2 = KeeURL.fromString(fu)) == null ? void 0 : _a2.domainOrIPAddress) === ((_b = KeeURL.fromString(url)) == null ? void 0 : _b.domainOrIPAddress);
        }
      )
    )) {
      return { urls: oldUrls, showWarning: false };
    }
  }
  return { urls: [compareUrl].concat(oldUrls), showWarning: true };
}
const _sfc_main$7 = {
  components: { Field },
  props: ["entrySummary", "isFirstInAList", "entryIndex", "frameId", "dataIndex"],
  emits: ["move-next-in-list", "move-prev-in-list", "move-out-of-list", "pref-entry-toggle"],
  setup() {
    const { updateSaveState } = useStore();
    return { updateSaveState };
  },
  data: () => ({
    expanded: false,
    focussed: false,
    tooltipDelay
  }),
  computed: {
    ...mapState(useStore, ["saveState"]),
    titleStyle: function() {
      const e = this.entrySummary;
      return "padding: 0px; background-size:32px; background-position: 8px calc(50% + 0px); background-repeat: no-repeat; background-image:url(data:image/png;base64," + e.icon.iconImageData + ")";
    },
    usernameDisplayValue: function() {
      const e = this.entrySummary;
      return e && e.usernameValue ? e.usernameValue : "[" + $STR("noUsername_partial_tip") + "]";
    },
    tabindex: function() {
      return "0";
    },
    allFields: function() {
      const e = this.entrySummary.fullDetails;
      return e.fields;
    },
    entryDomain: function() {
      const urlStr = this.entrySummary.url;
      if (!urlStr || urlStr.length < 4)
        return "<unknown>";
      const kurl = KeeURL.fromString(urlStr);
      if (!kurl) {
        return "<error>";
      }
      return kurl.domainWithPort || kurl.url.host;
    },
    entryPath: function() {
      if (!this.entryPathIsLong) {
        return this.fullEntryPath;
      }
      const e = this.entrySummary.fullDetails;
      return "... > " + e.parentGroup.path;
    },
    entryPathIsLong: function() {
      return this.fullEntryPath.length > 35;
    },
    fullEntryPath: function() {
      const e = this.entrySummary.fullDetails;
      return e.database.name + " > " + e.parentGroup.path;
    },
    isMatchedEntry: function() {
      const e = this.entrySummary;
      return typeof e.isPreferredMatch === "boolean";
    }
  },
  methods: {
    toggleFullDetails() {
      if (!this.expanded) {
        this.showFullDetails();
      } else {
        this.hideFullDetails();
      }
    },
    showFullDetails() {
      if (!this.expanded && !this.entrySummary.fullDetails) {
        Port.postMessage({
          findMatches: {
            uuid: this.entrySummary.uuid,
            DBfilename: this.entrySummary.dbFileName
          }
        });
      }
      this.expanded = true;
    },
    hideFullDetails() {
      this.expanded = false;
    },
    async editEntry() {
      var _a;
      const ss = this.saveState;
      const entry = this.entrySummary.fullDetails;
      const updatedSaveState = Object.assign({}, ss);
      const { urls, showWarning } = await reconcileURLs(entry.URLs, (_a = ss.submittedData) == null ? void 0 : _a.url);
      updatedSaveState.newEntry = supplementEntryState(entry, ss, urls);
      updatedSaveState.titleResetValue = entry.title;
      updatedSaveState.lastActiveAt = /* @__PURE__ */ new Date();
      updatedSaveState.showURLMismatchWarning = showWarning;
      this.updateSaveState(updatedSaveState);
    },
    focusin: function(e) {
      if (!this.$refs.card.$el.contains(e.relatedTarget)) {
        this.focussed = true;
      }
    },
    focusout: function(e) {
      if (!this.$refs.card.$el.contains(e.relatedTarget)) {
        this.focussed = false;
      }
    },
    async primaryClickAction() {
      if (this.entryIndex !== void 0) {
        this.manualFill();
      } else {
        const currentTab = await chrome.tabs.query({
          currentWindow: true,
          active: true,
          url: [
            "https://keevault.pm/*",
            "https://app-beta.kee.pm/*",
            "https://app-dev.kee.pm/*"
          ]
        });
        if (currentTab && currentTab.length > 0) {
          this.loadInNewTab();
        } else {
          this.loadInSameTab();
        }
      }
    },
    loadInSameTab() {
      chrome.tabs.update({ url: this.entrySummary.url });
      window.close();
    },
    loadInNewTab() {
      chrome.tabs.create({ url: this.entrySummary.url });
      window.close();
    },
    manualFill() {
      Port.postMessage({
        action: Action.ManualFill,
        selectedEntryIndex: this.entryIndex,
        frameId: this.frameId
      });
      window.close();
    },
    nextInList() {
      this.$emit("move-next-in-list");
    },
    prevInList() {
      this.$emit("move-prev-in-list");
    },
    exitList() {
      this.$emit("move-out-of-list");
    },
    onPreferredEntryClick() {
      this.$emit("pref-entry-toggle", { uuid: JSON.parse(JSON.stringify(this.entrySummary.uuid)) });
    }
  }
};
const _hoisted_1$4 = { class: "text-truncate text-caption py-1" };
const _hoisted_2$3 = { class: "text-truncate text-caption py-1" };
function _sfc_render$7(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_v_col = resolveComponent("v-col");
  const _component_v_row = resolveComponent("v-row");
  const _component_v_container = resolveComponent("v-container");
  const _component_v_sheet = resolveComponent("v-sheet");
  const _component_mdi_chevron_down = __unplugin_components_1;
  const _component_mdi_chevron_up = __unplugin_components_0$2;
  const _component_v_btn = resolveComponent("v-btn");
  const _component_v_hover = resolveComponent("v-hover");
  const _component_Field = resolveComponent("Field");
  const _component_v_tooltip = resolveComponent("v-tooltip");
  const _component_mdi_folder = __unplugin_components_2;
  const _component_mdi_cloud = __unplugin_components_3;
  const _component_v_divider = resolveComponent("v-divider");
  const _component_v_checkbox = resolveComponent("v-checkbox");
  const _component_v_slide_y_transition = resolveComponent("v-slide-y-transition");
  const _component_v_card_text = resolveComponent("v-card-text");
  const _component_v_card = resolveComponent("v-card");
  return openBlock(), createBlock(_component_v_hover, null, {
    default: withCtx(({ isHovering, props }) => [
      createVNode(_component_v_card, mergeProps({ "data-index": $props.dataIndex }, props, {
        ref: "card",
        tabindex: `${$options.tabindex}`,
        elevation: isHovering ? 12 : 3,
        class: "my-2",
        ripple: false,
        onFocusin: $options.focusin,
        onFocusout: $options.focusout,
        onKeyup: [
          withKeys(withModifiers($options.showFullDetails, ["stop", "prevent"]), ["context-menu"]),
          withKeys(withModifiers($options.nextInList, ["stop", "prevent"]), ["arrow-down"]),
          withKeys(withModifiers($options.prevInList, ["stop", "prevent"]), ["arrow-up"]),
          withKeys(withModifiers($options.showFullDetails, ["stop", "prevent"]), ["arrow-right"]),
          withKeys(withModifiers($options.hideFullDetails, ["stop", "prevent"]), ["arrow-left"]),
          withKeys(withModifiers($options.exitList, ["stop", "prevent"]), ["escape"]),
          withKeys(withModifiers($options.primaryClickAction, ["self", "stop", "prevent"]), ["enter"]),
          withKeys(withModifiers($options.loadInNewTab, ["ctrl", "self", "stop", "prevent"]), ["enter"])
        ]
      }), {
        default: withCtx(() => [
          createVNode(_component_v_container, {
            class: "ma-0 pa-0 my-2",
            style: normalizeStyle($options.titleStyle)
          }, {
            default: withCtx(() => [
              createVNode(_component_v_hover, null, {
                default: withCtx(() => [
                  createVNode(_component_v_sheet, {
                    class: "mr-3 ml-12 my-0",
                    style: normalizeStyle(`display: flex; align-items:center; justify-content:space-between; ${isHovering ? "cursor: pointer" : ""}; column-gap:0.5rem;`),
                    onClick: [
                      withModifiers($options.primaryClickAction, ["left", "exact"]),
                      withModifiers($options.loadInNewTab, ["left", "ctrl"])
                    ],
                    onMouseup: [
                      withModifiers($options.loadInNewTab, ["middle", "exact"]),
                      withModifiers($options.primaryClickAction, ["middle", "ctrl"])
                    ],
                    onContextmenu: withModifiers($options.showFullDetails, ["right", "stop", "prevent"])
                  }, {
                    default: withCtx(() => [
                      createVNode(_component_v_sheet, { class: "text-truncate" }, {
                        default: withCtx(() => [
                          createVNode(_component_v_container, {
                            fluid: "",
                            class: "ma-0 pa-0",
                            style: { "padding": "0px" }
                          }, {
                            default: withCtx(() => [
                              createVNode(_component_v_row, {
                                "no-gutters": "",
                                class: "my-0"
                              }, {
                                default: withCtx(() => [
                                  createVNode(_component_v_col, { class: "text-truncate" }, {
                                    default: withCtx(() => [
                                      createTextVNode(toDisplayString($props.entrySummary.title), 1)
                                    ]),
                                    _: 1
                                  })
                                ]),
                                _: 1
                              }),
                              createVNode(_component_v_row, {
                                "no-gutters": "",
                                class: "my-0"
                              }, {
                                default: withCtx(() => [
                                  createVNode(_component_v_col, {
                                    style: normalizeStyle(`${_ctx.expanded ? "visibility:hidden" : ""}`),
                                    class: "text-truncate text-caption"
                                  }, {
                                    default: withCtx(() => [
                                      createTextVNode(toDisplayString($options.usernameDisplayValue), 1)
                                    ]),
                                    _: 1
                                  }, 8, ["style"])
                                ]),
                                _: 1
                              })
                            ]),
                            _: 1
                          })
                        ]),
                        _: 1
                      }),
                      isHovering || _ctx.focussed ? (openBlock(), createBlock(_component_v_sheet, {
                        key: 0,
                        class: "align-self-center"
                      }, {
                        default: withCtx(() => [
                          createVNode(_component_v_btn, {
                            variant: "elevated",
                            color: "secondary",
                            size: "x-small",
                            icon: "",
                            onClick: withModifiers($options.toggleFullDetails, ["stop", "prevent"])
                          }, {
                            default: withCtx(() => [
                              !_ctx.expanded ? (openBlock(), createBlock(_component_mdi_chevron_down, {
                                key: 0,
                                scale: "200"
                              })) : createCommentVNode("", true),
                              _ctx.expanded ? (openBlock(), createBlock(_component_mdi_chevron_up, {
                                key: 1,
                                scale: "200"
                              })) : createCommentVNode("", true)
                            ]),
                            _: 1
                          }, 8, ["onClick"])
                        ]),
                        _: 1
                      })) : createCommentVNode("", true)
                    ]),
                    _: 2
                  }, 1032, ["style", "onClick", "onMouseup", "onContextmenu"])
                ]),
                _: 2
              }, 1024)
            ]),
            _: 2
          }, 1032, ["style"]),
          createVNode(_component_v_card_text, {
            class: "text-truncate",
            style: { "cursor": "default", "padding": "0px" }
          }, {
            default: withCtx(() => [
              createVNode(_component_v_slide_y_transition, null, {
                default: withCtx(() => [
                  _ctx.expanded && !!$props.entrySummary.fullDetails ? (openBlock(), createBlock(_component_v_container, {
                    key: 0,
                    class: "my-0 pa-0 mx-2"
                  }, {
                    default: withCtx(() => [
                      (openBlock(true), createElementBlock(Fragment, null, renderList($options.allFields, (f) => {
                        return openBlock(), createBlock(_component_Field, {
                          key: f.uuid,
                          field: f
                        }, null, 8, ["field"]);
                      }), 128)),
                      createVNode(_component_v_sheet, {
                        class: "my-0",
                        style: { "display": "flex", "justify-content": "space-between" }
                      }, {
                        default: withCtx(() => [
                          createVNode(_component_v_sheet, { class: "text-truncate" }, {
                            default: withCtx(() => [
                              createVNode(_component_v_sheet, {
                                class: "text-truncate my-0",
                                style: { "flex-wrap": "nowrap", "display": "flex", "align-items": "center" }
                              }, {
                                default: withCtx(() => [
                                  createVNode(_component_v_tooltip, {
                                    location: "top",
                                    disabled: !$options.entryPathIsLong,
                                    "open-delay": _ctx.tooltipDelay,
                                    activator: "parent"
                                  }, {
                                    default: withCtx(() => [
                                      createBaseVNode("span", null, toDisplayString($options.fullEntryPath), 1)
                                    ]),
                                    _: 1
                                  }, 8, ["disabled", "open-delay"]),
                                  createVNode(_component_mdi_folder, { class: "mr-2" }),
                                  createBaseVNode("span", _hoisted_1$4, toDisplayString($options.entryPath), 1)
                                ]),
                                _: 1
                              }),
                              createVNode(_component_v_sheet, {
                                class: "text-truncate my-0",
                                style: { "flex-wrap": "nowrap", "display": "flex", "align-items": "center" }
                              }, {
                                default: withCtx(() => [
                                  createVNode(_component_v_tooltip, {
                                    location: "top",
                                    "open-delay": _ctx.tooltipDelay,
                                    activator: "parent"
                                  }, {
                                    default: withCtx(() => [
                                      createBaseVNode("span", null, toDisplayString($props.entrySummary.url), 1)
                                    ]),
                                    _: 1
                                  }, 8, ["open-delay"]),
                                  createVNode(_component_mdi_cloud, { class: "mr-2" }),
                                  createBaseVNode("span", _hoisted_2$3, toDisplayString($options.entryDomain), 1)
                                ]),
                                _: 1
                              })
                            ]),
                            _: 1
                          }),
                          createVNode(_component_v_sheet, { class: "ma-2 shrink" }, {
                            default: withCtx(() => [
                              createVNode(_component_v_btn, {
                                size: "small",
                                location: "bottom left",
                                icon: "mdi-pencil",
                                onClick: $options.editEntry
                              }, null, 8, ["onClick"])
                            ]),
                            _: 1
                          })
                        ]),
                        _: 1
                      }),
                      $options.isMatchedEntry ? (openBlock(), createBlock(_component_v_row, {
                        key: 0,
                        justify: "space-between",
                        align: "center"
                      }, {
                        default: withCtx(() => [
                          createVNode(_component_v_col, { class: "text-truncate pt-0 ma-0" }, {
                            default: withCtx(() => [
                              createVNode(_component_v_divider, { class: "mt-4 mx-5" }),
                              createVNode(_component_v_checkbox, {
                                label: _ctx.$i18n("preferred_matching_entry"),
                                "model-value": $props.entrySummary.isPreferredMatch,
                                "onUpdate:modelValue": $options.onPreferredEntryClick
                              }, null, 8, ["label", "model-value", "onUpdate:modelValue"])
                            ]),
                            _: 1
                          })
                        ]),
                        _: 1
                      })) : createCommentVNode("", true)
                    ]),
                    _: 1
                  })) : createCommentVNode("", true)
                ]),
                _: 1
              })
            ]),
            _: 1
          })
        ]),
        _: 2
      }, 1040, ["data-index", "tabindex", "elevation", "onFocusin", "onFocusout", "onKeyup"])
    ]),
    _: 1
  });
}
const Entry = /* @__PURE__ */ _export_sfc(_sfc_main$7, [["render", _sfc_render$7]]);
class SearcherMatchedOnly {
  constructor(matchedEntrySummaries) {
    this.matchedEntrySummaries = matchedEntrySummaries;
    this.searchConfig = resolveConfig({ version: 1 });
  }
  filterExistingResults(entrySummaries, keywords) {
    return entrySummaries.filter(
      (entrySummary) => calculateMatchScore(entrySummary, keywords, 0, this.searchConfig)
    );
  }
  execute(query, onComplete) {
    let abort = false;
    if (!this.matchedEntrySummaries || this.matchedEntrySummaries.length === 0)
      abort = true;
    onComplete = onComplete || this.searchConfig.onComplete;
    if (!onComplete)
      abort = true;
    if (abort) {
      if (onComplete) {
        onComplete([]);
        return;
      } else {
        return [];
      }
    }
    if (!query || query.length === 0) {
      onComplete(this.matchedEntrySummaries);
      return;
    }
    let keywords = [];
    if (Array.isArray(query))
      keywords = query;
    else if (query.length > 0)
      keywords = tokenise(query);
    window.setTimeout(() => {
      const results = this.filterExistingResults(this.matchedEntrySummaries, keywords);
      onComplete(results);
    }, 1);
  }
}
const _sfc_main$6 = {
  components: { Entry },
  props: ["matchedEntriesIn", "frameId"],
  emits: ["pref-entry-toggle"],
  data() {
    return {
      filteredMatches: null,
      uidMap: /* @__PURE__ */ new Map(),
      aNodes: [],
      bNodes: [],
      searchOnlyMatches: null,
      matchedEntries: this.$props.matchedEntriesIn
    };
  },
  computed: {
    ...mapState(useStore, ["currentSearchTerm", "searchResults"]),
    deduplicatedSearchResults: function() {
      if (this.searchResults) {
        if (this.matchedEntries) {
          return this.searchResults.filter(
            (e) => !this.matchedEntries.some((m) => m.uuid === e.uuid)
          );
        } else {
          return this.searchResults;
        }
      }
      return null;
    }
  },
  watch: {
    matchedEntries: function(newVal) {
      KeeLog.debug("about to reinit");
      this.initAndSearchMatchedEntries(newVal);
    },
    currentSearchTerm: function(newVal) {
      KeeLog.debug("about to reexecute");
      this.searchOnlyMatches.execute(
        newVal,
        this.onSearchOnlyMatchesComplete.bind(this)
      );
    }
  },
  beforeUpdate() {
    this.aNodes = [];
    this.bNodes = [];
  },
  created() {
    KeeLog.debug("created. about to init");
    this.initAndSearchMatchedEntries(this.matchedEntries);
  },
  methods: {
    setNodesA(node) {
      if (node)
        this.aNodes.push(node);
    },
    setNodesB(node) {
      if (node)
        this.bNodes.push(node);
    },
    onSearchOnlyMatchesComplete(entrySummaries) {
      KeeLog.debug("onSearchOnlyMatchesComplete");
      entrySummaries = entrySummaries.sort(function(a, b) {
        if (a.relevanceScore > b.relevanceScore)
          return -1;
        if (a.relevanceScore < b.relevanceScore)
          return 1;
        return 0;
      });
      this.filteredMatches = entrySummaries.map((m) => ({
        entry: m,
        originalIndex: this.uidMap.get(m.uuid)
      }));
    },
    nextInList(currentIndex, listName, listLength) {
      const currentVueNode = (listName === "listAarray" ? this.aNodes : this.bNodes).find(
        (e) => {
          return parseInt(e.dataIndex) === currentIndex;
        }
      );
      if (currentIndex < listLength - 1) {
        currentVueNode.$el.nextElementSibling.nextElementSibling.focus();
      } else if (listName === "listAarray" && this.deduplicatedSearchResults.length > 0) {
        const firstBListVueNode = this.bNodes.find(
          (e) => parseInt(e.dataIndex) === 0
        );
        firstBListVueNode.$el.nextElementSibling.focus();
      }
    },
    prevInList(currentIndex, listName) {
      const currentVueNode = (listName === "listAarray" ? this.aNodes : this.bNodes).find(
        (e) => parseInt(e.dataIndex) === currentIndex
      );
      if (currentIndex > 0) {
        currentVueNode.$el.previousElementSibling.focus();
      } else if (listName === "listBarray" && this.filteredMatches.length > 0) {
        const lastAListVueNode = this.aNodes.find(
          (e) => parseInt(e.dataIndex) === this.filteredMatches.length - 1
        );
        lastAListVueNode.$el.nextElementSibling.focus();
      } else {
        document.getElementById("searchBox").focus();
      }
    },
    exitList() {
      document.getElementById("searchBox").focus();
    },
    initAndSearchMatchedEntries(matchedEntries) {
      if (matchedEntries) {
        for (let i = 0; i < matchedEntries.length; i++) {
          this.uidMap.set(matchedEntries[i].uuid, matchedEntries[i].entryIndex);
        }
      }
      this.searchOnlyMatches = new SearcherMatchedOnly(
        matchedEntries == null ? void 0 : matchedEntries.map((e) => EntrySummary.fromEntry(e))
      );
      KeeLog.debug("about to execute");
      this.searchOnlyMatches.execute(
        this.currentSearchTerm,
        this.onSearchOnlyMatchesComplete.bind(this)
      );
    },
    onPreferredEntryClick(payload) {
      this.$emit("pref-entry-toggle", payload);
    }
  }
};
const _hoisted_1$3 = {
  id: "searchPanel",
  class: "pb-6 pt-0 pr-0"
};
function _sfc_render$6(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_v_divider = resolveComponent("v-divider");
  const _component_Entry = resolveComponent("Entry");
  const _component_v_list_subheader = resolveComponent("v-list-subheader");
  return openBlock(), createElementBlock("div", _hoisted_1$3, [
    withDirectives(createVNode(_component_v_divider, { class: "mt-2" }, null, 512), [
      [vShow, $data.filteredMatches && $data.filteredMatches.length > 0]
    ]),
    (openBlock(true), createElementBlock(Fragment, null, renderList($data.filteredMatches, (match, index) => {
      return openBlock(), createBlock(_component_Entry, {
        key: match.entry.uuid,
        ref_for: true,
        ref: $options.setNodesA,
        entrySummary: match.entry,
        isFirstInAList: index === 0,
        "frame-id": $props.frameId,
        "entry-index": match.originalIndex,
        dataIndex: index,
        onMoveNextInList: ($event) => $options.nextInList(index, "listAarray", $data.filteredMatches.length),
        onMovePrevInList: ($event) => $options.prevInList(index, "listAarray"),
        onMoveOutOfList: $options.exitList,
        onPrefEntryToggle: $options.onPreferredEntryClick
      }, null, 8, ["entrySummary", "isFirstInAList", "frame-id", "entry-index", "dataIndex", "onMoveNextInList", "onMovePrevInList", "onMoveOutOfList", "onPrefEntryToggle"]);
    }), 128)),
    withDirectives(createVNode(_component_v_divider, { class: "mt-2" }, null, 512), [
      [vShow, $options.deduplicatedSearchResults && $options.deduplicatedSearchResults.length > 0]
    ]),
    withDirectives(createVNode(_component_v_list_subheader, {
      class: "text-center",
      style: { "justify-content": "center" }
    }, {
      default: withCtx(() => [
        createTextVNode(toDisplayString(_ctx.$i18n("matches_from_other_sites")), 1)
      ]),
      _: 1
    }, 512), [
      [vShow, $options.deduplicatedSearchResults && $options.deduplicatedSearchResults.length > 0]
    ]),
    (openBlock(true), createElementBlock(Fragment, null, renderList($options.deduplicatedSearchResults, (entry, index) => {
      return openBlock(), createBlock(_component_Entry, {
        key: entry.uuid,
        ref_for: true,
        ref: $options.setNodesB,
        entrySummary: entry,
        isFirstInAList: index === 0,
        dataIndex: index,
        onMoveNextInList: ($event) => $options.nextInList(index, "listBarray", $options.deduplicatedSearchResults.length),
        onMovePrevInList: ($event) => $options.prevInList(index, "listBarray"),
        onMoveOutOfList: $options.exitList
      }, null, 8, ["entrySummary", "isFirstInAList", "dataIndex", "onMoveNextInList", "onMovePrevInList", "onMoveOutOfList"]);
    }), 128))
  ]);
}
const SearchResults = /* @__PURE__ */ _export_sfc(_sfc_main$6, [["render", _sfc_render$6]]);
const _hoisted_1$2 = {
  viewBox: "0 0 24 24",
  width: "1.2em",
  height: "1.2em"
};
const _hoisted_2$2 = /* @__PURE__ */ createBaseVNode("path", {
  fill: "currentColor",
  d: "M12.5 8c-2.65 0-5.05 1-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88c3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"
}, null, -1);
const _hoisted_3$1 = [
  _hoisted_2$2
];
function render$1(_ctx, _cache) {
  return openBlock(), createElementBlock("svg", _hoisted_1$2, [..._hoisted_3$1]);
}
const __unplugin_components_0 = { name: "mdi-undo", render: render$1 };
const _hoisted_1$1 = {
  viewBox: "0 0 24 24",
  width: "1.2em",
  height: "1.2em"
};
const _hoisted_2$1 = /* @__PURE__ */ createBaseVNode("path", {
  fill: "currentColor",
  d: "M19 4h-3.5l-1-1h-5l-1 1H5v2h14M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6z"
}, null, -1);
const _hoisted_3 = [
  _hoisted_2$1
];
function render(_ctx, _cache) {
  return openBlock(), createElementBlock("svg", _hoisted_1$1, [..._hoisted_3]);
}
const __unplugin_components_4 = { name: "mdi-delete", render };
const _sfc_main$5 = {
  components: {
    PasswordGenerator
  },
  props: ["field"],
  emits: ["field-value-changed", "field-deleted"],
  data: () => ({
    revealed: false,
    showPasswordGenerator: false,
    focussed: false
  }),
  computed: {
    renderType: function() {
      if (this.field.type === "password") {
        return this.revealed ? "text" : "password";
      }
      return this.field.type;
    },
    resettable: function() {
      return this.field.resetValue !== this.field.value;
    },
    label: function() {
      return Field$1.getDisplayName(this.field);
    }
  },
  methods: {
    reset: function() {
      this.valueChanged(this.field.resetValue);
    },
    valueChanged: function(value) {
      this.$emit("field-value-changed", { uuid: this.field.uuid, value });
    },
    deleteClicked: function() {
      this.$emit("field-deleted", { uuid: this.field.uuid });
    },
    passwordGeneratorClosed: function(payload) {
      if (payload == null ? void 0 : payload.value)
        this.valueChanged(payload.value);
      this.showPasswordGenerator = false;
    },
    onFocus() {
      this.focussed = true;
    },
    onBlur() {
      this.focussed = false;
    },
    copyToClipboard: async function(payload) {
      if (payload == null ? void 0 : payload.value)
        await copyStringToClipboard(payload.value);
    }
  }
};
function _sfc_render$5(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_mdi_undo = __unplugin_components_0;
  const _component_v_btn = resolveComponent("v-btn");
  const _component_v_slide_x_transition = resolveComponent("v-slide-x-transition");
  const _component_mdi_eye = __unplugin_components_1$2;
  const _component_mdi_eye_off = __unplugin_components_2$2;
  const _component_mdi_flash = __unplugin_components_5;
  const _component_mdi_delete = __unplugin_components_4;
  const _component_v_text_field = resolveComponent("v-text-field");
  const _component_PasswordGenerator = resolveComponent("PasswordGenerator");
  const _component_v_col = resolveComponent("v-col");
  const _component_v_row = resolveComponent("v-row");
  return $props.field.type === "password" || $props.field.type === "text" ? (openBlock(), createBlock(_component_v_row, { key: 0 }, {
    default: withCtx(() => [
      createVNode(_component_v_col, null, {
        default: withCtx(() => [
          createVNode(_component_v_text_field, {
            label: $options.label,
            "model-value": $props.field.value,
            color: "secondary",
            variant: "filled",
            density: "comfortable",
            "hide-details": "auto",
            type: $options.renderType,
            "onUpdate:modelValue": $options.valueChanged,
            onFocus: $options.onFocus,
            onBlur: $options.onBlur
          }, {
            append: withCtx(() => [
              createVNode(_component_v_slide_x_transition, null, {
                default: withCtx(() => [
                  _ctx.focussed && $options.resettable ? (openBlock(), createBlock(_component_v_btn, {
                    key: 0,
                    size: "x-small",
                    icon: "",
                    class: "ml-1",
                    onClick: $options.reset
                  }, {
                    default: withCtx(() => [
                      createVNode(_component_mdi_undo, { scale: "175" })
                    ]),
                    _: 1
                  }, 8, ["onClick"])) : createCommentVNode("", true)
                ]),
                _: 1
              }),
              $props.field.type === "password" ? (openBlock(), createBlock(_component_v_btn, {
                key: 0,
                size: "x-small",
                icon: "",
                class: "ml-1",
                onClick: _cache[0] || (_cache[0] = ($event) => _ctx.revealed = !_ctx.revealed)
              }, {
                default: withCtx(() => [
                  _ctx.revealed ? (openBlock(), createBlock(_component_mdi_eye, {
                    key: 0,
                    scale: "175"
                  })) : createCommentVNode("", true),
                  !_ctx.revealed ? (openBlock(), createBlock(_component_mdi_eye_off, {
                    key: 1,
                    scale: "175"
                  })) : createCommentVNode("", true)
                ]),
                _: 1
              })) : createCommentVNode("", true),
              $props.field.type === "password" ? (openBlock(), createBlock(_component_v_btn, {
                key: 1,
                size: "x-small",
                icon: "",
                class: "ml-1",
                onClick: _cache[1] || (_cache[1] = ($event) => _ctx.showPasswordGenerator = true)
              }, {
                default: withCtx(() => [
                  createVNode(_component_mdi_flash, { scale: "175" })
                ]),
                _: 1
              })) : createCommentVNode("", true),
              createVNode(_component_v_btn, {
                size: "x-small",
                icon: "",
                class: "ml-1",
                onClick: $options.deleteClicked
              }, {
                default: withCtx(() => [
                  createVNode(_component_mdi_delete, { scale: "175" })
                ]),
                _: 1
              }, 8, ["onClick"])
            ]),
            _: 1
          }, 8, ["label", "model-value", "type", "onUpdate:modelValue", "onFocus", "onBlur"]),
          _ctx.showPasswordGenerator ? (openBlock(), createBlock(_component_PasswordGenerator, {
            key: 0,
            onDialogClosed: $options.passwordGeneratorClosed,
            onCopyToClipboard: $options.copyToClipboard
          }, null, 8, ["onDialogClosed", "onCopyToClipboard"])) : createCommentVNode("", true)
        ]),
        _: 1
      })
    ]),
    _: 1
  })) : createCommentVNode("", true);
}
const FieldEditor = /* @__PURE__ */ _export_sfc(_sfc_main$5, [["render", _sfc_render$5]]);
class DatabaseSummary {
  constructor(db) {
    this.name = db.name || "";
    this.fileName = db.fileName || "";
    this.icon = db.icon || { version: 1, iconImageData: "" };
    this.root = db.root || new GroupSummary({});
    this.active = db.active || false;
  }
  static fromKPRPCDatabaseSummaryDTO(dto) {
    return new DatabaseSummary({
      name: dto.name,
      fileName: dto.fileName,
      icon: { version: 1, iconImageData: dto.iconImageData },
      root: GroupSummary.fromKPRPCGroupSummaryDTO(dto.root),
      active: dto.active
    });
  }
  static fromDatabase(db) {
    return new DatabaseSummary({
      name: db.name,
      fileName: db.fileName,
      icon: db.icon,
      root: GroupSummary.fromGroup(db.root)
    });
  }
}
const _sfc_main$4 = {
  components: {
    FieldEditor
  },
  emits: ["cancel-clicked", "save-where-clicked"],
  setup() {
    const { updateSaveState, removeFieldFromActiveEntry } = useStore();
    return { updateSaveState, removeFieldFromActiveEntry };
  },
  data: () => ({
    originalFields: [],
    differentSiteConfirmation: false,
    loading: true,
    preferToSkipWhere: false,
    skipWhere: false,
    domainMatchesExistingEntry: false,
    preferredGroupUuid: null,
    preferredDb: null,
    primaryFound: false,
    titleFocussed: true
  }),
  computed: {
    ...mapState(useStore, ["saveState", "KeePassDatabases", "ActiveKeePassDatabaseIndex"]),
    resettableTitle: function() {
      return this.saveState.titleResetValue !== this.saveState.newEntry.title;
    },
    editingExisting: function() {
      const e = this.saveState.newEntry;
      return e.database.fileName && e.database.root.uuid !== TemporaryIDString;
    },
    showURLMismatchWarning: function() {
      return this.saveState.showURLMismatchWarning;
    },
    entryDomain: function() {
      const urlStr = this.saveState.newEntry.URLs[0];
      if (!urlStr || urlStr.length < 4)
        return "<unknown>";
      const kurl = KeeURL.fromString(urlStr);
      if (!kurl) {
        return "<error>";
      }
      return kurl.domainWithPort || kurl.url.host;
    },
    displayWhereReason: function() {
      if (this.loading || !this.preferToSkipWhere)
        return null;
      return this.domainMatchesExistingEntry ? this.$i18n("skip_where_reason_domain_entry_exists") : this.primaryFound ? this.$i18n("skip_where_reason_group_not_found") : null;
    }
  },
  async mounted() {
    this.preferToSkipWhere = configManager.current.rememberMRUGroup;
    const dbs = this.KeePassDatabases;
    const { preferredGroupUuid, preferredDb, primaryFound } = this.getPreferredGroup(
      configManager.current.mruGroup,
      dbs
    );
    this.preferredGroupUuid = preferredGroupUuid;
    if (this.preferToSkipWhere) {
      this.preferredDb = preferredDb;
      this.primaryFound = primaryFound;
      this.domainMatchesExistingEntry = this.anyEntryMatchesNewDomain();
      if (this.preferredGroupUuid && this.preferredDb && !this.domainMatchesExistingEntry) {
        this.skipWhere = true;
      }
    }
    this.loading = false;
  },
  methods: {
    cancel: function() {
      this.$emit("cancel-clicked");
    },
    nextClicked: function() {
      this.$emit("save-where-clicked", this.displayWhereReason, this.preferredGroupUuid);
    },
    saveEntry: function() {
      const updatedSaveState = Object.assign({}, JSON.parse(JSON.stringify(this.saveState)));
      updatedSaveState.newEntry = new Entry$1({
        ...updatedSaveState.newEntry,
        parentGroup: new GroupSummary({ uuid: this.preferredGroupUuid }),
        database: this.preferredDb
      });
      this.updateSaveState(updatedSaveState);
      Port.postMessage({ action: Action.CreateEntry });
      window.close();
    },
    updateEntry: function() {
      Port.postMessage({ action: Action.UpdateEntry });
      window.close();
    },
    openFullEntryEditor() {
      const entry = JSON.parse(JSON.stringify(this.saveState)).newEntry;
      Port.postMessage({
        loginEditor: {
          uuid: entry.uuid,
          DBfilename: entry.database.fileName
        }
      });
      window.close();
    },
    setTitle: function(value) {
      const updatedSaveState = Object.assign({}, JSON.parse(JSON.stringify(this.saveState)));
      updatedSaveState.newEntry = new Entry$1({
        ...updatedSaveState.newEntry,
        title: value
      });
      this.updateSaveState(updatedSaveState);
    },
    resetTitle: function() {
      this.setTitle(JSON.parse(JSON.stringify(this.saveState.titleResetValue)));
    },
    fieldValueChanged: function(change) {
      const updatedSaveState = Object.assign({}, JSON.parse(JSON.stringify(this.saveState)));
      const originalFieldIndex = JSON.parse(JSON.stringify(this.saveState)).newEntry.fields.findIndex((f) => f.uuid === change.uuid);
      const originalField = JSON.parse(JSON.stringify(this.saveState)).newEntry.fields[originalFieldIndex];
      const newField = new Field$1({
        ...originalField,
        value: change.value
      });
      const newFields = JSON.parse(
        JSON.stringify(updatedSaveState.newEntry.fields)
      );
      newFields[originalFieldIndex] = newField;
      updatedSaveState.newEntry = new Entry$1({
        ...updatedSaveState.newEntry,
        fields: newFields
      });
      this.updateSaveState(updatedSaveState);
    },
    fieldDeleted: function(field) {
      this.removeFieldFromActiveEntry(field.uuid);
    },
    getPreferredGroup: function(mruGroup, dbs) {
      if (!mruGroup) {
        return { preferredGroupUuid: null, preferredDb: null, primaryFound: false };
      }
      let primaryFound = false;
      const UUIDs = [];
      const primaryUuid = mruGroup["{<{{<<kee-primary>>}}>}"];
      if (primaryUuid) {
        primaryFound = true;
        UUIDs.push(primaryUuid);
      }
      if (dbs.length === 1 && mruGroup[dbs[0].fileName]) {
        if (mruGroup[dbs[0].fileName] !== UUIDs[0]) {
          UUIDs.push(mruGroup[dbs[0].fileName]);
        }
      }
      for (const groupId of UUIDs) {
        if (!groupId)
          continue;
        const matchedDb = dbs.find((db) => Group.containsId(db.root, groupId));
        if (matchedDb) {
          return {
            preferredGroupUuid: groupId,
            preferredDb: new DatabaseSummary({
              fileName: matchedDb.fileName,
              root: new GroupSummary({ uuid: TemporaryIDString })
            }),
            primaryFound
          };
        }
      }
      return {
        preferredGroupUuid: null,
        preferredDb: null,
        primaryFound
      };
    },
    anyEntryMatchesNewDomain: function() {
      const urlStr = JSON.parse(JSON.stringify(this.saveState.newEntry.URLs[0]));
      if (!urlStr || urlStr.length < 4)
        return false;
      const kurl = KeeURL.fromString(urlStr);
      if (!kurl) {
        return false;
      }
      const search = new SearcherAll(
        {
          KeePassDatabases: this.KeePassDatabases,
          ActiveKeePassDatabaseIndex: this.ActiveKeePassDatabaseIndex
        },
        {
          version: 1,
          searchAllDatabases: configManager.current.searchAllOpenDBs,
          maximumResults: 1
        }
      );
      const results = search.execute("", void 0, [kurl.domainOrIPAddress]);
      return !!(results == null ? void 0 : results.length);
    },
    onTitleFocus() {
      this.titleFocussed = true;
    },
    onTitleBlur() {
      this.titleFocussed = false;
    }
  }
};
function _sfc_render$4(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_mdi_undo = __unplugin_components_0;
  const _component_v_btn = resolveComponent("v-btn");
  const _component_v_text_field = resolveComponent("v-text-field");
  const _component_v_col = resolveComponent("v-col");
  const _component_v_row = resolveComponent("v-row");
  const _component_FieldEditor = resolveComponent("FieldEditor");
  const _component_v_container = resolveComponent("v-container");
  const _component_v_slide_y_transition = resolveComponent("v-slide-y-transition");
  const _component_v_checkbox = resolveComponent("v-checkbox");
  const _component_v_alert = resolveComponent("v-alert");
  return openBlock(), createElementBlock("div", null, [
    createVNode(_component_v_slide_y_transition, null, {
      default: withCtx(() => [
        createVNode(_component_v_container, {
          class: "my-3 pa-0",
          style: { "padding": "0px" }
        }, {
          default: withCtx(() => [
            createVNode(_component_v_row, null, {
              default: withCtx(() => [
                createVNode(_component_v_col, null, {
                  default: withCtx(() => [
                    createVNode(_component_v_text_field, {
                      label: _ctx.$i18n("title"),
                      "model-value": _ctx.saveState.newEntry.title,
                      variant: "filled",
                      density: "comfortable",
                      "hide-details": "auto",
                      type: "text",
                      autofocus: "",
                      "onUpdate:modelValue": $options.setTitle,
                      onFocus: $options.onTitleFocus,
                      onBlur: $options.onTitleBlur
                    }, createSlots({ _: 2 }, [
                      _ctx.titleFocussed && $options.resettableTitle ? {
                        name: "append",
                        fn: withCtx(() => [
                          createVNode(_component_v_btn, {
                            size: "x-small",
                            icon: "",
                            class: "ml-1",
                            onClick: $options.resetTitle
                          }, {
                            default: withCtx(() => [
                              createVNode(_component_mdi_undo, { scale: "175" })
                            ]),
                            _: 1
                          }, 8, ["onClick"])
                        ]),
                        key: "0"
                      } : void 0
                    ]), 1032, ["label", "model-value", "onUpdate:modelValue", "onFocus", "onBlur"])
                  ]),
                  _: 1
                })
              ]),
              _: 1
            }),
            (openBlock(true), createElementBlock(Fragment, null, renderList(_ctx.saveState.newEntry.fields, (f) => {
              return openBlock(), createBlock(_component_FieldEditor, {
                key: f.uuid,
                field: f,
                onFieldValueChanged: $options.fieldValueChanged,
                onFieldDeleted: $options.fieldDeleted
              }, null, 8, ["field", "onFieldValueChanged", "onFieldDeleted"]);
            }), 128))
          ]),
          _: 1
        })
      ]),
      _: 1
    }),
    $options.showURLMismatchWarning ? (openBlock(), createBlock(_component_v_alert, {
      key: 0,
      border: "top",
      "border-color": "primary",
      type: "warning",
      icon: false,
      elevation: "1",
      class: "my-3"
    }, {
      default: withCtx(() => [
        createVNode(_component_v_row, { dense: "" }, {
          default: withCtx(() => [
            createVNode(_component_v_col, null, {
              default: withCtx(() => [
                createBaseVNode("p", null, toDisplayString(_ctx.$i18n("url_mismatch_1")), 1),
                createBaseVNode("p", null, toDisplayString(_ctx.$i18n("url_mismatch_2")), 1),
                createBaseVNode("p", null, toDisplayString(_ctx.$i18n("url_mismatch_3")), 1)
              ]),
              _: 1
            })
          ]),
          _: 1
        }),
        createVNode(_component_v_row, { dense: "" }, {
          default: withCtx(() => [
            createVNode(_component_v_col, { class: "my-0 py-0" }, {
              default: withCtx(() => [
                createBaseVNode("div", null, [
                  createVNode(_component_v_checkbox, {
                    modelValue: _ctx.differentSiteConfirmation,
                    "onUpdate:modelValue": _cache[0] || (_cache[0] = ($event) => _ctx.differentSiteConfirmation = $event),
                    class: "my-0 py-0",
                    "hide-details": "",
                    label: _ctx.$i18n("url_mismatch_confirm", $options.entryDomain)
                  }, null, 8, ["modelValue", "label"])
                ])
              ]),
              _: 1
            })
          ]),
          _: 1
        })
      ]),
      _: 1
    })) : createCommentVNode("", true),
    createVNode(_component_v_container, { style: { "display": "flex", "width": "100%", "justify-content": "space-between" } }, {
      default: withCtx(() => [
        createVNode(_component_v_btn, {
          color: "tertiary",
          onClick: $options.cancel
        }, {
          default: withCtx(() => [
            createTextVNode(toDisplayString(_ctx.$i18n("cancel")), 1)
          ]),
          _: 1
        }, 8, ["onClick"]),
        !_ctx.loading && !$options.editingExisting && !_ctx.skipWhere ? (openBlock(), createBlock(_component_v_btn, {
          key: 0,
          color: "primary",
          onClick: $options.nextClicked
        }, {
          default: withCtx(() => [
            createTextVNode(toDisplayString(_ctx.$i18n("next")), 1)
          ]),
          _: 1
        }, 8, ["onClick"])) : createCommentVNode("", true),
        !_ctx.loading && !$options.editingExisting && _ctx.skipWhere ? (openBlock(), createBlock(_component_v_btn, {
          key: 1,
          color: "primary",
          onClick: $options.saveEntry
        }, {
          default: withCtx(() => [
            createTextVNode(toDisplayString(_ctx.$i18n("save")), 1)
          ]),
          _: 1
        }, 8, ["onClick"])) : createCommentVNode("", true),
        _ctx.loading ? (openBlock(), createBlock(_component_v_btn, {
          key: 2,
          loading: "",
          disabledcolor: "primary"
        }, {
          default: withCtx(() => [
            createTextVNode(" ......... ")
          ]),
          _: 1
        })) : createCommentVNode("", true),
        $options.editingExisting ? (openBlock(), createBlock(_component_v_btn, {
          key: 3,
          disabled: $options.showURLMismatchWarning && !_ctx.differentSiteConfirmation,
          color: "primary",
          onClick: $options.updateEntry
        }, {
          default: withCtx(() => [
            createTextVNode(toDisplayString(_ctx.$i18n("update")), 1)
          ]),
          _: 1
        }, 8, ["disabled", "onClick"])) : createCommentVNode("", true)
      ]),
      _: 1
    }),
    $options.editingExisting ? (openBlock(), createBlock(_component_v_alert, {
      key: 1,
      border: "top",
      "border-color": "primary",
      type: "info",
      icon: false,
      elevation: "1",
      class: "my-4"
    }, {
      default: withCtx(() => [
        createVNode(_component_v_row, { align: "center" }, {
          default: withCtx(() => [
            createVNode(_component_v_col, { class: "grow" }, {
              default: withCtx(() => [
                createTextVNode(toDisplayString(_ctx.$i18n("make_additional_changes_using_full_editor")), 1)
              ]),
              _: 1
            })
          ]),
          _: 1
        }),
        createVNode(_component_v_row, { align: "center" }, {
          default: withCtx(() => [
            createVNode(_component_v_col, { class: "grow" }, {
              default: withCtx(() => [
                createVNode(_component_v_btn, {
                  size: "small",
                  onClick: $options.openFullEntryEditor
                }, {
                  default: withCtx(() => [
                    createTextVNode(toDisplayString(_ctx.$i18n("open_full_editor")), 1)
                  ]),
                  _: 1
                }, 8, ["onClick"])
              ]),
              _: 1
            })
          ]),
          _: 1
        })
      ]),
      _: 1
    })) : createCommentVNode("", true)
  ]);
}
const Save1stParty = /* @__PURE__ */ _export_sfc(_sfc_main$4, [["render", _sfc_render$4]]);
class GroupListItem {
  constructor(id, text, children, selected, visibleChildIds = []) {
    this.id = id;
    this.text = text;
    this.children = children;
    this.selected = selected;
    this.visibleChildIds = visibleChildIds;
  }
}
const _sfc_main$3 = {
  name: "TreeItem",
  props: {
    item: {
      type: GroupListItem,
      required: true
    },
    indentLevel: {
      type: Number,
      default: 0
    }
  },
  emits: ["select"],
  data() {
    return {
      isExpanded: true
    };
  },
  computed: {
    hasVisibleChildren() {
      return this.item.visibleChildIds.length > 0;
    },
    indentStyle() {
      return {
        // expand/contract icon is 2rem wide
        paddingLeft: this.hasVisibleChildren ? `${this.indentLevel + 0.25}rem` : `${this.indentLevel + 2.25}rem`
      };
    },
    filteredChildren() {
      return this.item.children.filter((child) => this.isChildVisible(child));
    }
  },
  methods: {
    toggleExpand() {
      this.isExpanded = !this.isExpanded;
    },
    handleSelect(item) {
      this.$emit("select", item);
    },
    isChildVisible(item) {
      return this.item.visibleChildIds.includes(item.id);
    }
  }
};
function _sfc_render$3(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_mdi_chevron_up = __unplugin_components_0$2;
  const _component_mdi_chevron_down = __unplugin_components_1;
  const _component_v_btn = resolveComponent("v-btn");
  const _component_v_list_item = resolveComponent("v-list-item");
  const _component_TreeItem = resolveComponent("TreeItem", true);
  const _component_v_item_group = resolveComponent("v-item-group");
  return openBlock(), createElementBlock("li", null, [
    createBaseVNode("div", null, [
      createVNode(_component_v_list_item, {
        style: normalizeStyle($options.indentStyle),
        active: $props.item.selected,
        density: "comfortable",
        onClick: _cache[0] || (_cache[0] = ($event) => _ctx.$emit("select", $props.item))
      }, {
        default: withCtx(() => [
          $options.hasVisibleChildren ? (openBlock(), createBlock(_component_v_btn, {
            key: 0,
            icon: "",
            size: "1.5rem",
            color: "secondary",
            style: { "margin-left": "0rem", "margin-right": "0.5rem" },
            onClick: withModifiers($options.toggleExpand, ["stop"])
          }, {
            default: withCtx(() => [
              $data.isExpanded ? (openBlock(), createBlock(_component_mdi_chevron_up, {
                key: 0,
                scale: "150"
              })) : createCommentVNode("", true),
              !$data.isExpanded ? (openBlock(), createBlock(_component_mdi_chevron_down, {
                key: 1,
                scale: "150"
              })) : createCommentVNode("", true)
            ]),
            _: 1
          }, 8, ["onClick"])) : createCommentVNode("", true),
          createBaseVNode("span", null, toDisplayString($props.item.text), 1)
        ]),
        _: 1
      }, 8, ["style", "active"]),
      $options.hasVisibleChildren ? (openBlock(), createBlock(_component_v_item_group, {
        key: 0,
        modelValue: $data.isExpanded,
        "onUpdate:modelValue": _cache[2] || (_cache[2] = ($event) => $data.isExpanded = $event)
      }, {
        default: withCtx(() => [
          withDirectives(createBaseVNode("ul", null, [
            (openBlock(true), createElementBlock(Fragment, null, renderList($options.filteredChildren, (child) => {
              return openBlock(), createBlock(_component_TreeItem, {
                key: child.id,
                item: child,
                "indent-level": $props.indentLevel + 1,
                onSelect: _cache[1] || (_cache[1] = (item) => $options.handleSelect(item))
              }, null, 8, ["item", "indent-level"]);
            }), 128))
          ], 512), [
            [vShow, $data.isExpanded]
          ])
        ]),
        _: 1
      }, 8, ["modelValue"])) : createCommentVNode("", true)
    ])
  ]);
}
const TreeItem = /* @__PURE__ */ _export_sfc(_sfc_main$3, [["render", _sfc_render$3]]);
const _sfc_main$2 = {
  name: "GroupSelectorTree",
  components: {
    TreeItem
  },
  props: {
    items: {
      type: Array,
      required: true
    },
    filterText: {
      type: String,
      required: true
    }
  },
  emits: ["setGroup"],
  computed: {
    filteredItems() {
      const lowercaseFilterText = this.filterText ? this.filterText.toLowerCase() : "";
      const traverseTree = (node) => {
        var _a;
        const filteredChildren = ((_a = node.children) == null ? void 0 : _a.filter((child) => traverseTree(child))) ?? Array();
        node.visibleChildIds = filteredChildren.map((child) => child.id);
        return node.text.toLowerCase().includes(lowercaseFilterText) || filteredChildren.length > 0;
      };
      this.items.map((item) => traverseTree(item));
      return this.items;
    }
  },
  methods: {
    handleSelect(item) {
      this.$emit("setGroup", item);
    }
  }
};
function _sfc_render$2(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_TreeItem = resolveComponent("TreeItem");
  return openBlock(), createElementBlock("div", null, [
    createBaseVNode("ul", null, [
      (openBlock(true), createElementBlock(Fragment, null, renderList($options.filteredItems, (item) => {
        return openBlock(), createBlock(_component_TreeItem, {
          key: item.id,
          item,
          "indent-level": 0,
          onSelect: (item2) => $options.handleSelect(item2)
        }, null, 8, ["item", "onSelect"]);
      }), 128))
    ])
  ]);
}
const GroupSelectorTree = /* @__PURE__ */ _export_sfc(_sfc_main$2, [["render", _sfc_render$2]]);
const recursiveFilterMap = (group, filter, map) => {
  const chosenChildGroups = [];
  for (const childGroup of group.groups) {
    const chosenChildGroup = recursiveFilterMap(childGroup, filter, map);
    if (chosenChildGroup)
      chosenChildGroups.push(chosenChildGroup);
  }
  if (filter(group) || chosenChildGroups.length > 0) {
    const old = JSON.parse(JSON.stringify(group));
    old.groups = chosenChildGroups;
    const g = new Group(old);
    return map(g);
  }
  return null;
};
function findDatabaseAndGroupByGroupId(databases, uuid) {
  for (const database of databases) {
    const group = Group.matchingId(database.root, uuid);
    if (group) {
      return { database, group };
    }
  }
  return null;
}
let selectedItem = {};
const _sfc_main$1 = {
  components: {
    Tree: GroupSelectorTree
  },
  props: ["preferredGroupUuid", "displayReason"],
  setup() {
    const { updateSaveState } = useStore();
    return { updateSaveState };
  },
  data: function() {
    return {
      search: "",
      debounceTimeout: null,
      updatingConfig: false,
      skipInFuture: configManager.current.rememberMRUGroup,
      lastSelectedGroupUuid: this.$props.preferredGroupUuid,
      // caller has already checked that this uuid is present in list of DBs and groups
      initialSelectedGroupId: JSON.parse(JSON.stringify(this.$props.preferredGroupUuid))
      // really do not want this to be reactive!
    };
  },
  computed: {
    ...mapState(useStore, ["saveState", "KeePassDatabases", "ActiveKeePassDatabaseIndex"]),
    rootGroup: function() {
      return this.KeePassDatabases[this.ActiveKeePassDatabaseIndex].root;
    },
    saveEnabled: function() {
      var _a;
      return !this.updatingConfig && ((_a = this.lastSelectedGroupUuid) == null ? void 0 : _a.length) > 0;
    },
    debouncedSearchValue: {
      get() {
        return this.search;
      },
      set(value) {
        clearTimeout(this.debounceTimeout);
        this.debounceTimeout = setTimeout(() => {
          this.search = value;
        }, 50);
      }
    },
    items: function() {
      const groups = this.KeePassDatabases.map((db) => recursiveFilterMap(db.root, (g) => true, (g) => {
        const grp = new Group(
          {
            entrySummaries: [],
            groups: g.groups,
            icon: null,
            path: g.path,
            title: g.title,
            uuid: g.uuid
          }
        );
        return grp;
      }));
      const mapItem = (item) => {
        const selected = item.uuid === this.initialSelectedGroupId;
        const gli = new GroupListItem(
          item.uuid,
          item.title,
          item.groups.map(mapItem),
          selected,
          []
        );
        const result = selected ? reactive(gli) : gli;
        if (selected) {
          selectedItem = result;
        }
        return result;
      };
      return reactive(groups.map(mapItem));
    }
  },
  watch: {
    skipInFuture: async function(newValue, oldValue) {
      if (newValue !== oldValue) {
        this.updatingConfig = true;
        configManager.current.rememberMRUGroup = newValue;
        await configManager.save();
        this.updatingConfig = false;
      }
    }
  },
  mounted() {
    var _a;
    if (((_a = this.initialSelectedGroupId) == null ? void 0 : _a.length) > 0) {
      this.setGroupById(this.initialSelectedGroupId);
    }
  },
  methods: {
    saveEntry: function() {
      Port.postMessage({ action: Action.CreateEntry });
      window.close();
    },
    setGroupById: function(uuid) {
      if (!uuid)
        return;
      const { database, group: selectedGroup } = findDatabaseAndGroupByGroupId(this.KeePassDatabases, uuid);
      const updatedSaveState = Object.assign({}, this.saveState);
      updatedSaveState.newEntry = new Entry$1({
        ...updatedSaveState.newEntry,
        parentGroup: selectedGroup,
        database: new DatabaseSummary({
          fileName: JSON.parse(JSON.stringify(database.fileName)),
          root: new GroupSummary({ uuid: TemporaryIDString })
        })
      });
      this.updateSaveState(updatedSaveState);
      this.lastSelectedGroupUuid = uuid;
    },
    handleSelect(item) {
      KeeLog.debug("Setting selected group to " + item.id);
      selectedItem.selected = false;
      item.selected = true;
      selectedItem = item;
      this.setGroupById(item.id);
    }
  }
};
function _sfc_render$1(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_v_col = resolveComponent("v-col");
  const _component_v_row = resolveComponent("v-row");
  const _component_v_text_field = resolveComponent("v-text-field");
  const _component_v_sheet = resolveComponent("v-sheet");
  const _component_Tree = resolveComponent("Tree");
  const _component_v_card_text = resolveComponent("v-card-text");
  const _component_v_card = resolveComponent("v-card");
  const _component_v_checkbox = resolveComponent("v-checkbox");
  const _component_v_container = resolveComponent("v-container");
  const _component_v_slide_y_transition = resolveComponent("v-slide-y-transition");
  const _component_v_btn = resolveComponent("v-btn");
  return openBlock(), createElementBlock("div", null, [
    createVNode(_component_v_slide_y_transition, null, {
      default: withCtx(() => [
        createVNode(_component_v_container, {
          class: "ma-0 pa-0",
          style: { "cursor": "default", "padding": "0", "margin": "0" }
        }, {
          default: withCtx(() => [
            createVNode(_component_v_row, {
              justify: "center",
              style: { "cursor": "default", "padding": "0", "margin": "0" }
            }, {
              default: withCtx(() => [
                createVNode(_component_v_col, {
                  style: { "cursor": "default", "padding": "0", "margin": "0" },
                  class: "text-6 text-center"
                }, {
                  default: withCtx(() => [
                    createTextVNode(toDisplayString(_ctx.$i18n("where")), 1)
                  ]),
                  _: 1
                })
              ]),
              _: 1
            }),
            createVNode(_component_v_row, { style: { "margin-top": "0px" } }, {
              default: withCtx(() => [
                createVNode(_component_v_col, null, {
                  default: withCtx(() => [
                    createVNode(_component_v_card, {
                      class: "mx-auto",
                      "max-width": "500"
                    }, {
                      default: withCtx(() => [
                        createVNode(_component_v_sheet, { class: "pa-4 pb-1" }, {
                          default: withCtx(() => [
                            createVNode(_component_v_text_field, {
                              modelValue: $options.debouncedSearchValue,
                              "onUpdate:modelValue": _cache[0] || (_cache[0] = ($event) => $options.debouncedSearchValue = $event),
                              label: _ctx.$i18n("Search_label"),
                              color: "secondary",
                              variant: "outlined",
                              "hide-details": "auto",
                              clearable: "",
                              density: "compact",
                              "clear-icon": "mdi-close-circle-outline"
                            }, null, 8, ["modelValue", "label"])
                          ]),
                          _: 1
                        }),
                        createVNode(_component_v_card_text, null, {
                          default: withCtx(() => [
                            createVNode(_component_Tree, {
                              items: $options.items,
                              "filter-text": _ctx.search ?? "",
                              style: { "max-height": "220px", "min-height": "220px", "overflow-y": "auto" },
                              onSetGroup: _cache[1] || (_cache[1] = (item) => $options.handleSelect(item))
                            }, null, 8, ["items", "filter-text"])
                          ]),
                          _: 1
                        })
                      ]),
                      _: 1
                    })
                  ]),
                  _: 1
                })
              ]),
              _: 1
            }),
            createVNode(_component_v_row, null, {
              default: withCtx(() => [
                createVNode(_component_v_col, { class: "py-0" }, {
                  default: withCtx(() => [
                    createVNode(_component_v_checkbox, {
                      modelValue: _ctx.skipInFuture,
                      "onUpdate:modelValue": _cache[2] || (_cache[2] = ($event) => _ctx.skipInFuture = $event),
                      label: _ctx.$i18n("skip_where_enable_context")
                    }, null, 8, ["modelValue", "label"])
                  ]),
                  _: 1
                })
              ]),
              _: 1
            })
          ]),
          _: 1
        })
      ]),
      _: 1
    }),
    createVNode(_component_v_btn, {
      disabled: !$options.saveEnabled,
      location: "right",
      color: "primary",
      onClick: $options.saveEntry
    }, {
      default: withCtx(() => [
        createTextVNode(toDisplayString(_ctx.$i18n("save")), 1)
      ]),
      _: 1
    }, 8, ["disabled", "onClick"]),
    $props.displayReason ? (openBlock(), createBlock(_component_v_container, { key: 0 }, {
      default: withCtx(() => [
        createTextVNode(toDisplayString($props.displayReason), 1)
      ]),
      _: 1
    })) : createCommentVNode("", true)
  ]);
}
const SaveWhere = /* @__PURE__ */ _export_sfc(_sfc_main$1, [["render", _sfc_render$1]]);
async function sleep(milliseconds) {
  return new Promise((resolve) => window.setTimeout(resolve, milliseconds));
}
function fetchFavicon(url) {
  return new Promise(function(resolve) {
    if (!url) {
      resolve(void 0);
      return;
    }
    const img = new Image();
    img.onload = function() {
      const canvas = document.createElement("canvas");
      canvas.width = this.width;
      canvas.height = this.height;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(this, 0, 0);
      const dataURL = canvas.toDataURL("image/png");
      resolve(dataURL.substr(22));
    };
    img.src = url;
  });
}
async function getFaviconUrl() {
  for (let i = 0; i < 45; i++) {
    const tab = (await chrome.tabs.query({ active: true, currentWindow: true }))[0];
    if (tab) {
      return tab.favIconUrl;
    }
    sleep(1e3);
  }
}
const _sfc_main = {
  components: {
    Notification,
    SearchResults,
    SearchInput,
    Save1stParty,
    SaveWhere,
    PasswordGenerator
  },
  props: ["matchedEntries", "frameId"],
  setup() {
    const { updateSaveState, updateSaveEntryResult } = useStore();
    return { updateSaveState, updateSaveEntryResult };
  },
  data: function() {
    return {
      // We can't use the Vuex property directly because when it changes it causes
      // the app to re-render from scratch, destroying the user input that triggered
      // the datestamp change. Instead we can watch for changes and only modify this
      // value in a set of circumstances that meet our requirements.
      // Also note that Chromium and Firefox extensions behave differently - Chrome
      // persists strings to represent the Date whereas Firefox persists a valid
      // Date object. Hence every place where this is used, you must wrap the
      // variable in a new Date(...) call before comparing against other Dates
      saveLastActiveAt: null,
      showSaveWhere: false,
      displayWhereReason: null,
      preferredGroupUuid: "",
      cachedMatchedEntries: this.matchedEntries,
      // imported constants are only available in Vue if we assign them to data
      tooltipDelay,
      manualRecoveryPromptTimeMs,
      autoRecoveryTimeMs,
      showPasswordGenerator: false,
      lastSaveEntryResult: null
    };
  },
  computed: {
    ...mapState(useStore, [
      "showGeneratePasswordLink",
      "saveState",
      "showMatchedLogins",
      "showOpenKeePassButton",
      "connectionStatus",
      "connectionStatusDetail",
      "connected",
      "databaseIsOpen",
      "notifications",
      "showNotifications",
      "connectedWebsocket",
      "saveEntryResult"
    ]),
    statusIconColour: function() {
      if (this.connected && this.databaseIsOpen) {
        return "green";
      } else if (this.connected) {
        return "orange";
      }
      return "red";
    },
    showSaveStart: function() {
      return new Date(this.saveLastActiveAt) > new Date(Date.now() - this.autoRecoveryTimeMs);
    },
    showSaveRecovery: function() {
      KeeLog.debug(`showSaveRecovery ${this.showSaveStart} : ${new Date(this.saveLastActiveAt)} ${new Date(
        Date.now() - this.manualRecoveryPromptTimeMs
      )} : ${new Date(this.saveLastActiveAt) > new Date(Date.now() - this.manualRecoveryPromptTimeMs)}`);
      return !this.showSaveStart && new Date(this.saveLastActiveAt) > new Date(Date.now() - this.manualRecoveryPromptTimeMs);
    },
    showSearchPanel: function() {
      return this.databaseIsOpen && !this.showSaveStart;
    },
    hasSubmittedData: function() {
      var _a, _b, _c;
      return ((_c = (_b = (_a = this.saveState) == null ? void 0 : _a.submittedData) == null ? void 0 : _b.fields) == null ? void 0 : _c.length) > 0;
    },
    showSaveResult: function() {
      return this.lastSaveEntryResult && !this.showSaveStart;
    }
  },
  watch: {
    saveState: {
      handler: function(newState, oldState) {
        var _a, _b;
        if (((_a = newState == null ? void 0 : newState.newEntry) == null ? void 0 : _a.uuid) !== ((_b = oldState == null ? void 0 : oldState.newEntry) == null ? void 0 : _b.uuid)) {
          KeeLog.debug("savestate watch modified");
        } else {
          KeeLog.debug("savestate watch not modified");
        }
        this.saveLastActiveAt = newState.lastActiveAt;
      },
      deep: true
    }
  },
  mounted: async function() {
    var _a, _b;
    this.saveLastActiveAt = (_a = this.saveState) == null ? void 0 : _a.lastActiveAt;
    const discardRequired = this.handleLastSaveResult();
    if (discardRequired || ((_b = this.saveState) == null ? void 0 : _b.lastActiveAt) <= new Date(Date.now() - this.manualRecoveryPromptTimeMs)) {
      KeeLog.debug("discarding upon mount");
      this.saveDiscard();
    }
    const favIconUrl = await getFaviconUrl();
    if (!favIconUrl)
      return;
    const favicon = await fetchFavicon(favIconUrl);
    if (!favicon)
      return;
    const updatedSaveState = Object.assign({}, JSON.parse(JSON.stringify(this.saveState)));
    updatedSaveState.favicon = favicon;
    this.updateSaveState(updatedSaveState);
  },
  methods: {
    showOptions: () => {
      chrome.runtime.openOptionsPage();
      window.close();
    },
    saveStart: async function() {
      const currentTab = (await chrome.tabs.query({ active: true, currentWindow: true }))[0];
      if (!currentTab)
        return;
      const entryTemplate = {
        URLs: [currentTab.url],
        title: currentTab.title,
        fields: [
          new Field$1({
            name: "KeePass username",
            type: "text",
            locators: [
              new Locator({
                type: "text"
              })
            ]
          }),
          new Field$1({
            name: "KeePass password",
            type: "password",
            locators: [
              new Locator({
                type: "password"
              })
            ]
          })
        ]
      };
      const ss = JSON.parse(JSON.stringify(this.saveState));
      const updatedSaveState = Object.assign({}, ss);
      updatedSaveState.newEntry = supplementEntryState(new Entry$1(entryTemplate), ss);
      updatedSaveState.titleResetValue = updatedSaveState.newEntry.title;
      updatedSaveState.lastActiveAt = /* @__PURE__ */ new Date();
      updatedSaveState.showURLMismatchWarning = false;
      KeeLog.debug("updating saveState");
      this.updateSaveState(updatedSaveState);
    },
    saveRecover: function() {
      const ss = JSON.parse(JSON.stringify(this.saveState));
      const updatedSaveState = Object.assign({}, ss);
      updatedSaveState.lastActiveAt = /* @__PURE__ */ new Date();
      this.updateSaveState(updatedSaveState);
      this.saveLastActiveAt = updatedSaveState.lastActiveAt;
    },
    saveDiscard: function() {
      const ss = JSON.parse(JSON.stringify(this.saveState));
      const updatedSaveState = Object.assign({}, ss);
      updatedSaveState.newEntry = new Entry$1({});
      updatedSaveState.titleResetValue = null;
      updatedSaveState.lastActiveAt = null;
      updatedSaveState.showURLMismatchWarning = false;
      updatedSaveState.favicon = null;
      this.updateSaveState(updatedSaveState);
    },
    saveWhere: function(displayWhereReason, preferredGroupUuid) {
      this.displayWhereReason = displayWhereReason;
      this.preferredGroupUuid = preferredGroupUuid;
      this.showSaveWhere = true;
    },
    showHelp: () => {
      chrome.tabs.create({ url: "https://www.kee.pm/help" });
      window.close();
    },
    openKeeVault: async function() {
      KeeLog.debug("open Kee Vault requested");
      const vaultTabs = await chrome.tabs.query({
        url: [
          "https://keevault.pm/*",
          "https://app-beta.kee.pm/*",
          "https://app-dev.kee.pm/*"
        ]
      });
      if (vaultTabs && vaultTabs[0]) {
        chrome.tabs.update(vaultTabs[0].id, { active: true });
        chrome.windows.update(vaultTabs[0].windowId, { focused: true });
      } else {
        chrome.tabs.create({
          url: "https://keevault.pm/",
          active: true
        });
      }
      window.close();
    },
    openKeePass: function() {
      KeeLog.debug("open KeePass requested");
      if (this.connectedWebsocket) {
        Port.postMessage({ action: Action.OpenKeePass });
      } else {
        KeeLog.info("KeePass no longer connected so taking no action");
      }
      window.close();
    },
    handleLastSaveResult: function() {
      const lastResult = this.saveEntryResult;
      if (!(lastResult == null ? void 0 : lastResult.result))
        return false;
      if (lastResult.result === "created" || lastResult.result === "updated") {
        if (!configManager.current.hideConfirmationAfterSave) {
          this.lastSaveEntryResult = lastResult;
        }
        this.updateSaveEntryResult({
          result: null,
          receivedAt: /* @__PURE__ */ new Date()
        });
        return true;
      } else {
        this.updateSaveEntryResult({
          result: null,
          receivedAt: /* @__PURE__ */ new Date()
        });
        return false;
      }
    },
    passwordGeneratorClosed: function() {
      this.showPasswordGenerator = false;
    },
    copyToClipboard: async function(payload) {
      if (payload == null ? void 0 : payload.value)
        await copyStringToClipboard(payload.value);
    },
    prefEntryToggle: async function(payload) {
      if (payload == null ? void 0 : payload.uuid) {
        const currentTab = (await chrome.tabs.query({
          active: true,
          currentWindow: true
        }))[0];
        if (!currentTab)
          return;
        const url = new URL(currentTab.url);
        url.hostname = punycode.toUnicode(url.hostname);
        configManager.togglePreferredEntryUuid(payload.uuid, url.href);
        const conf = configManager.siteConfigFor(url.href);
        this.cachedMatchedEntries = this.cachedMatchedEntries.map((me) => {
          me.isPreferredMatch = conf.preferredEntryUuid === me.uuid ? true : false;
          return me;
        });
        Port.postMessage({ action: Action.DetectForms });
        window.close();
      }
    },
    openFullEntryEditor: function() {
      Port.postMessage({
        loginEditor: {
          uuid: this.lastSaveEntryResult.uuid,
          DBfilename: this.lastSaveEntryResult.fileName
        }
      });
      this.lastSaveEntryResult = null;
      window.close();
    }
  }
};
const _hoisted_1 = {
  key: 0,
  id: "notifications",
  class: "pt-4 mt-2"
};
const _hoisted_2 = {
  class: "text-caption py-1 shrink",
  style: { "word-break": "break-word", "overflow-wrap": "break-word", "max-width": "210px", "font-size": "0.8rem" }
};
function _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_SearchInput = resolveComponent("SearchInput");
  const _component_v_app_bar = resolveComponent("v-app-bar");
  const _component_v_col = resolveComponent("v-col");
  const _component_v_row = resolveComponent("v-row");
  const _component_v_btn = resolveComponent("v-btn");
  const _component_v_alert = resolveComponent("v-alert");
  const _component_v_spacer = resolveComponent("v-spacer");
  const _component_Notification = resolveComponent("Notification");
  const _component_SearchResults = resolveComponent("SearchResults");
  const _component_Save1stParty = resolveComponent("Save1stParty");
  const _component_SaveWhere = resolveComponent("SaveWhere");
  const _component_v_container = resolveComponent("v-container");
  const _component_v_main = resolveComponent("v-main");
  const _component_mdi_plus = __unplugin_components_0$4;
  const _component_v_tooltip = resolveComponent("v-tooltip");
  const _component_v_img = resolveComponent("v-img");
  const _component_v_divider = resolveComponent("v-divider");
  const _component_mdi_lock = __unplugin_components_1$1;
  const _component_mdi_menu = __unplugin_components_2$1;
  const _component_v_list_item_title = resolveComponent("v-list-item-title");
  const _component_mdi_help = __unplugin_components_3$1;
  const _component_v_list_item = resolveComponent("v-list-item");
  const _component_mdi_cog = __unplugin_components_4$1;
  const _component_mdi_flash = __unplugin_components_5;
  const _component_v_list = resolveComponent("v-list");
  const _component_v_menu = resolveComponent("v-menu");
  const _component_v_footer = resolveComponent("v-footer");
  const _component_PasswordGenerator = resolveComponent("PasswordGenerator");
  const _component_v_app = resolveComponent("v-app");
  return openBlock(), createBlock(_component_v_app, { class: "" }, {
    default: withCtx(() => [
      createVNode(_component_v_app_bar, {
        modelValue: $options.showSearchPanel,
        "onUpdate:modelValue": _cache[0] || (_cache[0] = ($event) => $options.showSearchPanel = $event),
        class: "py-1",
        density: "compact",
        style: { "max-width": "400px" }
      }, {
        default: withCtx(() => [
          createVNode(_component_SearchInput)
        ]),
        _: 1
      }, 8, ["modelValue"]),
      createVNode(_component_v_main, null, {
        default: withCtx(() => [
          createVNode(_component_v_container, {
            fluid: "",
            class: "overflow-auto app_height",
            style: { "padding": "8px 12px" }
          }, {
            default: withCtx(() => [
              createBaseVNode("div", null, [
                withDirectives(createVNode(_component_v_alert, {
                  color: "secondary",
                  border: "top",
                  "border-color": "primary",
                  elevation: "1",
                  class: "mt-2"
                }, {
                  default: withCtx(() => [
                    createVNode(_component_v_row, { dense: "" }, {
                      default: withCtx(() => [
                        createVNode(_component_v_col, null, {
                          default: withCtx(() => [
                            createTextVNode(toDisplayString(_ctx.$i18n("unsaved_changes")), 1)
                          ]),
                          _: 1
                        })
                      ]),
                      _: 1
                    }),
                    createVNode(_component_v_row, {
                      dense: "",
                      class: "py-1",
                      align: "start"
                    }, {
                      default: withCtx(() => [
                        createVNode(_component_v_col, null, {
                          default: withCtx(() => [
                            createVNode(_component_v_btn, {
                              color: "primary",
                              size: "small",
                              onClick: $options.saveRecover
                            }, {
                              default: withCtx(() => [
                                createTextVNode(toDisplayString(_ctx.$i18n("continue_saving")), 1)
                              ]),
                              _: 1
                            }, 8, ["onClick"])
                          ]),
                          _: 1
                        }),
                        createVNode(_component_v_col, null, {
                          default: withCtx(() => [
                            createVNode(_component_v_btn, {
                              color: "tertiary",
                              size: "small",
                              onClick: $options.saveDiscard
                            }, {
                              default: withCtx(() => [
                                createTextVNode(toDisplayString(_ctx.$i18n("discard_changes")), 1)
                              ]),
                              _: 1
                            }, 8, ["onClick"])
                          ]),
                          _: 1
                        })
                      ]),
                      _: 1
                    })
                  ]),
                  _: 1
                }, 512), [
                  [vShow, $options.showSaveRecovery]
                ]),
                withDirectives(createVNode(_component_v_alert, {
                  color: "secondary",
                  border: "top",
                  "border-color": "primary",
                  elevation: "1",
                  class: "mt-2"
                }, {
                  default: withCtx(() => [
                    createVNode(_component_v_row, { dense: "" }, {
                      default: withCtx(() => [
                        createVNode(_component_v_col, null, {
                          default: withCtx(() => [
                            createTextVNode(toDisplayString(_ctx.$i18n("you_recently_saved")), 1)
                          ]),
                          _: 1
                        })
                      ]),
                      _: 1
                    }),
                    createVNode(_component_v_row, {
                      dense: "",
                      class: "py-1",
                      align: "start"
                    }, {
                      default: withCtx(() => [
                        createVNode(_component_v_col, null, {
                          default: withCtx(() => [
                            createVNode(_component_v_btn, {
                              size: "small",
                              onClick: $options.openFullEntryEditor
                            }, {
                              default: withCtx(() => [
                                createTextVNode(toDisplayString(_ctx.$i18n("open_full_editor")), 1)
                              ]),
                              _: 1
                            }, 8, ["onClick"])
                          ]),
                          _: 1
                        }),
                        createVNode(_component_v_spacer)
                      ]),
                      _: 1
                    })
                  ]),
                  _: 1
                }, 512), [
                  [vShow, $options.showSaveResult]
                ]),
                _ctx.showNotifications ? (openBlock(), createElementBlock("div", _hoisted_1, [
                  (openBlock(true), createElementBlock(Fragment, null, renderList(_ctx.notifications, (n) => {
                    return openBlock(), createBlock(_component_Notification, {
                      key: n.id,
                      notification: n
                    }, null, 8, ["notification"]);
                  }), 128))
                ])) : createCommentVNode("", true),
                withDirectives(createVNode(_component_SearchResults, {
                  "matched-entries-in": _ctx.cachedMatchedEntries,
                  "frame-id": $props.frameId,
                  onPrefEntryToggle: $options.prefEntryToggle
                }, null, 8, ["matched-entries-in", "frame-id", "onPrefEntryToggle"]), [
                  [vShow, $options.showSearchPanel]
                ]),
                $options.showSaveStart && !_ctx.showSaveWhere ? (openBlock(), createBlock(_component_Save1stParty, {
                  key: 1,
                  onSaveWhereClicked: $options.saveWhere,
                  onCancelClicked: $options.saveDiscard
                }, null, 8, ["onSaveWhereClicked", "onCancelClicked"])) : createCommentVNode("", true),
                _ctx.showSaveWhere ? (openBlock(), createBlock(_component_SaveWhere, {
                  key: 2,
                  "display-reason": _ctx.displayWhereReason,
                  "preferred-group-uuid": _ctx.preferredGroupUuid
                }, null, 8, ["display-reason", "preferred-group-uuid"])) : createCommentVNode("", true)
              ])
            ]),
            _: 1
          })
        ]),
        _: 1
      }),
      withDirectives(createVNode(_component_v_btn, {
        position: "fixed",
        location: "bottom right",
        color: "primary",
        style: { "bottom": "70px", "right": "16px" },
        class: normalizeClass($options.hasSubmittedData ? "pulse-button" : ""),
        icon: "",
        onClick: $options.saveStart
      }, {
        default: withCtx(() => [
          createVNode(_component_mdi_plus, { scale: "150" }),
          createVNode(_component_v_tooltip, {
            location: "left",
            "open-delay": _ctx.tooltipDelay,
            activator: "parent"
          }, {
            default: withCtx(() => [
              createBaseVNode("span", null, toDisplayString(_ctx.$i18n("create_new_entry")), 1)
            ]),
            _: 1
          }, 8, ["open-delay"])
        ]),
        _: 1
      }, 8, ["class", "onClick"]), [
        [vShow, $options.showSearchPanel && !$options.showSaveRecovery]
      ]),
      createVNode(_component_v_footer, {
        app: "",
        height: "auto",
        style: { "padding": "8px" }
      }, {
        default: withCtx(() => [
          createVNode(_component_v_btn, {
            id: "password-open-kee-vault",
            "aria-label": _ctx.$i18n("Menu_Button_open_kee_vault_label"),
            class: "ml-0 mr-1",
            size: "small",
            icon: "",
            onClick: $options.openKeeVault
          }, {
            default: withCtx(() => [
              createVNode(_component_v_img, {
                width: "24px",
                height: "24px",
                src: "/assets/images/48-kee-vault.png"
              }),
              createVNode(_component_v_tooltip, {
                location: "top",
                "open-delay": _ctx.tooltipDelay,
                activator: "parent"
              }, {
                default: withCtx(() => [
                  createBaseVNode("span", null, toDisplayString(_ctx.$i18n("Menu_Button_open_kee_vault_label")), 1)
                ]),
                _: 1
              }, 8, ["open-delay"])
            ]),
            _: 1
          }, 8, ["aria-label", "onClick"]),
          withDirectives(createVNode(_component_v_btn, {
            id: "password-open-keepass",
            "aria-label": _ctx.$i18n("Menu_Button_open_keepass_label"),
            class: "mr-1 ml-n1",
            size: "small",
            icon: "",
            onClick: $options.openKeePass
          }, {
            default: withCtx(() => [
              createVNode(_component_v_img, {
                width: "24px",
                height: "24px",
                src: "/assets/images/48-keepass.png"
              }),
              createVNode(_component_v_tooltip, {
                location: "top",
                "open-delay": _ctx.tooltipDelay,
                activator: "parent"
              }, {
                default: withCtx(() => [
                  createBaseVNode("span", null, toDisplayString(_ctx.$i18n("Menu_Button_open_keepass_label")), 1)
                ]),
                _: 1
              }, 8, ["open-delay"])
            ]),
            _: 1
          }, 8, ["aria-label", "onClick"]), [
            [vShow, _ctx.showOpenKeePassButton]
          ]),
          createVNode(_component_v_divider, { vertical: "" }),
          createVNode(_component_mdi_lock, {
            color: $options.statusIconColour,
            class: "mx-1"
          }, null, 8, ["color"]),
          createBaseVNode("div", _hoisted_2, [
            createTextVNode(toDisplayString(_ctx.connectionStatus) + " ", 1),
            createVNode(_component_v_tooltip, {
              location: "top",
              "open-delay": _ctx.tooltipDelay,
              activator: "parent"
            }, {
              default: withCtx(() => [
                createBaseVNode("span", null, toDisplayString(_ctx.connectionStatusDetail), 1)
              ]),
              _: 1
            }, 8, ["open-delay"])
          ]),
          createVNode(_component_v_btn, {
            icon: "",
            size: "small",
            class: "ms-auto"
          }, {
            default: withCtx(() => [
              createVNode(_component_mdi_menu, { scale: "150" }),
              createVNode(_component_v_menu, {
                location: "top",
                activator: "parent"
              }, {
                default: withCtx(() => [
                  createVNode(_component_v_list, null, {
                    default: withCtx(() => [
                      createVNode(_component_v_list_item, { onClick: $options.showHelp }, {
                        append: withCtx(() => [
                          createVNode(_component_mdi_help, { class: "ml-2" })
                        ]),
                        default: withCtx(() => [
                          createVNode(_component_v_list_item_title, { class: "text-right text-body-2" }, {
                            default: withCtx(() => [
                              createTextVNode(toDisplayString(_ctx.$i18n("Help_Centre_Button_label")), 1)
                            ]),
                            _: 1
                          })
                        ]),
                        _: 1
                      }, 8, ["onClick"]),
                      createVNode(_component_v_list_item, { onClick: $options.showOptions }, {
                        append: withCtx(() => [
                          createVNode(_component_mdi_cog, { class: "ml-2" })
                        ]),
                        default: withCtx(() => [
                          createVNode(_component_v_list_item_title, { class: "text-right text-body-2" }, {
                            default: withCtx(() => [
                              createTextVNode(toDisplayString(_ctx.$i18n("Menu_Button_options_label")), 1)
                            ]),
                            _: 1
                          })
                        ]),
                        _: 1
                      }, 8, ["onClick"]),
                      withDirectives(createVNode(_component_v_list_item, {
                        onClick: _cache[1] || (_cache[1] = ($event) => _ctx.showPasswordGenerator = true)
                      }, {
                        append: withCtx(() => [
                          createVNode(_component_mdi_flash, { class: "ml-2" })
                        ]),
                        default: withCtx(() => [
                          createVNode(_component_v_list_item_title, { class: "text-right text-body-2" }, {
                            default: withCtx(() => [
                              createTextVNode(toDisplayString(_ctx.$i18n("Menu_Button_copyNewPasswordToClipboard_label")), 1)
                            ]),
                            _: 1
                          })
                        ]),
                        _: 1
                      }, 512), [
                        [vShow, $options.showSearchPanel]
                      ])
                    ]),
                    _: 1
                  })
                ]),
                _: 1
              })
            ]),
            _: 1
          })
        ]),
        _: 1
      }),
      _ctx.showPasswordGenerator ? (openBlock(), createBlock(_component_PasswordGenerator, {
        key: 0,
        standalone: true,
        onDialogClosed: $options.passwordGeneratorClosed,
        onCopyToClipboard: $options.copyToClipboard
      }, null, 8, ["onDialogClosed", "onCopyToClipboard"])) : createCommentVNode("", true)
    ]),
    _: 1
  });
}
const App = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render]]);
const piniaInstance = createPinia();
let vueApp;
let store;
async function start() {
  await configManager.load();
  KeeLog.debug("popup starting");
  KeeLog.attachConfig(configManager.current);
  Port.startup("browserPopup");
  Port.raw.onMessage.addListener(function(m) {
    KeeLog.debug("In browser popup script, received message from background script.");
    if (m.initialState) {
      try {
        vueApp = createApp({
          mounted: function() {
            Port.postMessage({
              action: Action.GetPasswordProfiles
            });
          },
          render: () => h(App, {
            matchedEntries: !m.entries ? null : m.entries,
            frameId: m.frameId
          })
        });
        const vuetify = createVuetify({
          components,
          directives,
          theme: {
            defaultTheme: configManager.activeTheme,
            themes: {
              dark: {
                dark: true,
                colors: {
                  primary: "#1a466b",
                  secondary: "#ABB2BF",
                  tertiary: "#e66a2b",
                  error: "#C34034",
                  info: "#2196F3",
                  success: "#4CAF50",
                  warning: "#FFC107"
                }
              },
              light: {
                dark: false,
                colors: {
                  primary: "#1a466b",
                  secondary: "#13334e",
                  tertiary: "#e66a2b",
                  error: "#C34034",
                  info: "#2196F3",
                  success: "#4CAF50",
                  warning: "#FFC107"
                }
              }
            }
          }
        });
        piniaInstance.use(IPCPiniaPlugin);
        vueApp.use(vuetify);
        vueApp.use(piniaInstance);
        vueApp.config.globalProperties.$chrome = chrome;
        vueApp.config.globalProperties.$i18n = chrome.i18n.getMessage;
        store = useStore();
        store.$patch(m.initialState);
        vueApp.mount("#main");
        window.setTimeout(() => {
          window.focus();
          const sb = $("#searchBox");
          if (sb)
            sb.focus();
          window.scrollTo(0, 0);
        }, 50);
      } catch (e) {
        KeeLog.error("Failed to create user interface.", e);
      }
    }
    if (m.mutation) {
      store.onRemoteMessage(Port.raw, m.mutation);
      return;
    }
    if ((store == null ? void 0 : store.connected) && m.findMatchesResult) {
      store.updateSearchResultWithFullDetails(
        JSON.parse(JSON.stringify(m.findMatchesResult[0]))
      );
    }
  });
  KeeLog.info("popup ready");
}
(async () => {
  await start();
})();
//# sourceMappingURL=popup-BWpTd3fD.js.map
