"use strict";(self.webpackChunk_dashlane_leeloo=self.webpackChunk_dashlane_leeloo||[]).push([[5559],{5559:(e,t,a)=>{a.r(t),a.d(t,{SecretAddPanelComponent:()=>Z});var n=a(96832),c=a(40577),s=a(8180),i=a(51031),l=a(25792),r=a(39431),o=a(14900),d=a(86498),p=a(88203),u=a(14943),_=a(63520),h=a(15940),b=a(19122),S=a(66098),m=a(78047),g=a(92077),C=a(45272),I=a(48062),w=a(5465),f=a(99193),y=a(73157),T=a(77063),v=a(68593);const{CONTENT:E,DOCUMENT_STORAGE:D}=h.SecretsTabs,Z=()=>{const{routes:e}=(0,g.Xo)(),t=(0,u.Y)(),[a,h]=(0,n.useState)(E),[Z,O]=(0,n.useState)(!1),[R,A]=(0,n.useState)(!1),[N,U]=(0,n.useState)(!1),{currentSpaceId:x,teamId:F}=(0,b.fV)(),k=(0,c.o)("ace_secrets_vault_attachment"),[P,B]=(0,n.useState)({id:"",title:"",content:"",spaceId:null!=x?x:F?String(F):"",secured:!1,attachments:[]}),{shouldShowFrozenStateDialog:V}=(0,T.Ub)(),{createVaultItem:z}=(0,s.u)(l.L),L=(0,d.V)(),{translate:M}=(0,p.Z)();if((0,n.useEffect)((()=>{(0,C.Nc)(I.PageView.ItemSecretCreate)}),[]),t.status!==i.rq.Success||!t?.data)return null;const H=()=>(0,g.uX)(e.userSecrets),X=k?[{id:"tab-secret-detail",contentId:"content-secret-detail",title:M("webapp_secrets_edition_field_tab_title_details"),onSelect:()=>h(E)},{id:"tab-secret-attachments",contentId:"content-secret-attachments",title:M("webapp_secrets_edition_field_tab_title_attachments"),onSelect:()=>h(D)}]:void 0;return(0,v.tZ)(_.zI,{isUsingNewDesign:!0,isViewingExistingItem:!1,itemHasBeenEdited:Z,submitPending:R,onSubmit:async()=>{R||(A(!0),await(async()=>{try{var e;await z({vaultItemType:r.U.Secret,content:{title:P.title,content:P.content,spaceId:null!=(e=P.spaceId)?e:"",isSecured:P.secured,attachments:P.attachments}})}catch(e){A(!1),L.showAlert(M("_common_generic_error"),o.BLW.ERROR)}})(),H())},onNavigateOut:()=>{H()},formId:"add_secret_panel",header:(0,v.tZ)(S.h,{title:P.title?P.title:M("webapp_secrets_title_field"),tabs:X}),secondaryActions:a===D?[(0,v.tZ)(y.d,{isQuotaReached:!1,onFileUploadStarted:()=>{U(!0)},onFileUploadDone:async e=>{U(!1),e.success&&(await w.C.commitSecureFile({secureFileInfo:e.secureFileInfo}),B((t=>({...t,attachments:[...t.attachments,(0,f.w)(e.secureFileInfo)]}))),O(!0))},isShared:!1,dataType:"KWSecret",disabled:!!V},"uploadAction")]:[],children:(0,v.tZ)(m.e,{activeTab:a,isSecured:P.secured,secretValues:P,handleChange:(e,t)=>{if("spaceId"===e&&t===P.spaceId)return;const a={...P,[e]:t},n=!!(a.title||a.content||a.spaceId||a.secured);n!==Z&&O(n),B(a)},handleFileInfoDetached:e=>{B((t=>({...t,attachments:t.attachments.filter((t=>t.id!==e))})))},isAttachmentUploading:N,isNewItem:!0,sharingCapabilities:{canChangeRoles:!1,canShare:!1,canEdit:!0,canCopy:!0,canView:!0}})})}},15940:(e,t,a)=>{a.d(t,{SecretsTabs:()=>n});let n=function(e){return e[e.CONTENT=0]="CONTENT",e[e.SHARED_ACCESS=1]="SHARED_ACCESS",e[e.DOCUMENT_STORAGE=2]="DOCUMENT_STORAGE",e}({})},66098:(e,t,a)=>{a.d(t,{h:()=>l});var n,c=a(61468),s=a(63520),i=a(68593);const l=({title:e,tabs:t})=>(0,i.tZ)(s.V9,{icon:n||(n=(0,i.tZ)(c.AK,{type:"secret",size:"xlarge"})),title:e,tabs:t})},78047:(e,t,a)=>{a.d(t,{e:()=>R});var n=a(96832),c=a(61468),s=a(51031),i=a(80936),l=a(88203),r=a(22061),o=a(33988),d=a(54350),p=a(68037),u=a(67406),_=a(15940),h=a(77063),b=a(53294),S=a(48062),m=a(30894),g=a(68819),C=a(82207),I=a(45272),w=a(79432),f=a(68593);const{CONTENT:y,SHARED_ACCESS:T,DOCUMENT_STORAGE:v}=_.SecretsTabs,E="webapp_secure_notes_edition_field_text_max_size_reached",D="webapp_secret_edition_action_show_secret_content",Z="webapp_secret_edition_action_hide_secret_content",O=1e4,R=({activeTab:e,sharingCapabilities:t,isSecured:a,isAttachmentUploading:_,isNewItem:R,secretValues:A,handleChange:N,handleFileInfoDetached:U,onModalDisplayStateChange:x})=>{const{translate:F}=(0,l.Z)(),[k,P]=(0,n.useState)(""),{shouldShowFrozenStateDialog:B}=(0,h.Ub)(),V=(0,o.F)(),{isMPLessUser:z}=(0,d.Z)(),L=!V&&!z,{areProtectedItemsUnlocked:M,openProtectedItemsUnlocker:H}=(0,m.tY)(),{logRevealSecretContent:X,logCopiedSecretContent:G}=(0,w.D)(),K=(0,i.I)(),q=K.status===s.rq.Success&&!K.isDisabled,{id:Y,title:W,content:j,spaceId:Q,secured:J}=A,[$,ee]=(0,n.useState)(""===j),te=a&&!M,ae=Boolean(j.length),ne=Boolean(Q),ce=(0,n.useCallback)(((e,t)=>new Promise(((a,n)=>{if(e||!te||!L)return t(),a();H({action:g.P.Show,itemType:g.R.Secret,successCallback:()=>(t(),a()),cancelCallback:n})}))),[te,H]),se=()=>{ee((e=>!e)),!$&&ne&&X(W)};return null===B?null:(0,f.BX)(f.HY,{children:[e===y&&(0,f.BX)("div",{"aria-labelledby":"tab-secret-detail",id:"content-secret-detail",children:[(0,f.BX)(p.u,{title:F("webapp_secrets_box_title_details"),children:[(0,f.tZ)(c.qo,{"data-name":"title",label:F("webapp_secrets_title_field"),value:W,onChange:e=>N("title",e.target.value),disabled:!t.canEdit,readOnly:B,sx:{marginBottom:"8px"}}),(0,f.tZ)(c.Kx,{"data-name":"content",label:F("webapp_secrets_content_field"),placeholder:F("webapp_secrets_content_field_placeholder"),value:$||!ae?j:"••••••••",onBeforeInput:e=>{const t=e.currentTarget.value;t.length>O&&(P(F(E,{charLeft:O-(t.length-1)})),e.preventDefault())},onPaste:e=>{const t=e.clipboardData.getData("text/plain");e.currentTarget.value.length+t.length>O&&(P(F(E,{charLeft:O-e.currentTarget.value.length})),e.preventDefault())},onChange:e=>{k&&P(""),N("content",e.target.value)},readOnly:!$&&ae||B||!t.canEdit,feedback:k?{text:k}:void 0,error:!!k,actions:[(0,f.tZ)(c.zx,{layout:"iconOnly",icon:$?"ActionHideOutlined":"ActionRevealOutlined",mood:"brand",intensity:"supershy",sx:{marginRight:"16px"},onClick:()=>{ce($,se).catch((()=>{ee(!1)}))},"aria-label":F($?Z:D),tooltip:F($?Z:D)},"secret-content-visibility"),...ae?[(0,f.tZ)(C.m,{data:j,checkProtected:()=>te,copyLabel:F("webapp_secret_edition_action_copy_secret_content"),onCopy:()=>{(0,I.Kz)(new S.UserCopyVaultItemFieldEvent({itemId:Y,itemType:S.ItemType.Secret,field:S.Field.Secret,isProtected:a})),ne&&G(W)},itemType:g.R.Secret,tooltipLocation:"right"},"copy-secret-content")]:[]]})]}),q?(0,f.tZ)(u.M,{disabled:B,contentCardLabel:F("webapp_secrets_box_title_organization"),wrapInContentCard:!0,isUsingNewDesign:!0,defaultSpaceId:null!=Q?Q:"",spaceId:null!=Q?Q:"",onChange:e=>N("spaceId",e)}):null,L?(0,f.tZ)(p.u,{title:F("webapp_secrets_box_title_preferences"),additionalSx:{marginTop:"16px"},children:(0,f.tZ)(c.XZ,{readOnly:B,label:F("webapp_secrets_preferences_mp_title"),description:F("webapp_secrets_preferences_mp_description"),checked:Boolean(J),onChange:()=>{M||R?N("secured",Boolean(!J)):((0,m.jF)(),H({action:g.P.Show,itemType:g.R.Secret,successCallback:()=>N("secured",Boolean(!J))}))}})}):null]}),e===v&&(0,f.tZ)("div",{"aria-labelledby":"tab-secret-attachments",id:"content-secret-attachments",children:(0,f.tZ)(b.P,{attachments:A.attachments,additionalProps:{itemId:Y,itemType:S.ItemType.Secret,handleFileInfoDetached:e=>{U(e)},onModalDisplayStateChange:x,isUploading:_}})}),e===T&&(0,f.tZ)("div",{"aria-labelledby":"tab-secret-shared-access",id:"content-secret-shared-access",children:(0,f.tZ)(r.u,{canChangeRoles:t.canChangeRoles,id:Y})})]})}}}]);