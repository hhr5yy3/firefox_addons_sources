import{M as g,w as M}from"../chunks/chunk-Z2ZWTSDM.js";import"../chunks/chunk-5SH53EW4.js";import"../chunks/chunk-FQ7KGWHN.js";import"../chunks/chunk-4DY7Q7SZ.js";import"../chunks/chunk-WDPQNPC7.js";import"../chunks/chunk-HMFVUZXK.js";import{a as R}from"../chunks/chunk-3REBBJSH.js";import"../chunks/chunk-543EMZFQ.js";import{c as O}from"../chunks/chunk-L4RDDWJP.js";import"../chunks/chunk-6BB4SG5R.js";import"../chunks/chunk-6V4PETGI.js";import"../chunks/chunk-IJLSJJ7U.js";import"../chunks/chunk-LG525BKV.js";import"../chunks/chunk-WOENBU2A.js";import{a as P}from"../chunks/chunk-W32UHEZE.js";import"../chunks/chunk-3DLX7NOK.js";import"../chunks/chunk-4GJAJKDK.js";import"../chunks/chunk-HGJD3ZUF.js";import"../chunks/chunk-JDV5FZKX.js";import"../chunks/chunk-BCG2KUGW.js";import"../chunks/chunk-QCT7FZJD.js";import{a as D}from"../chunks/chunk-FVPQGETT.js";import{a as h}from"../chunks/chunk-Z64FBUPL.js";import{a as S}from"../chunks/chunk-KWDMUJJA.js";import"../chunks/chunk-MT4LVDUX.js";import{a as H}from"../chunks/chunk-WN4MFSKN.js";import{a as q}from"../chunks/chunk-7S3YJSN5.js";import"../chunks/chunk-QUFHRGH2.js";import"../chunks/chunk-BODFWMPN.js";import{M as L,a as _,d as v,e as C,f as m}from"../chunks/chunk-LADTODTA.js";import{a as V}from"../chunks/chunk-O4TFJKJQ.js";import{B as u,c as x,m as N,r as p,x as l}from"../chunks/chunk-WRHUMLYF.js";import"../chunks/chunk-AC7VHEB5.js";import"../chunks/chunk-HY2GWXPO.js";import"../chunks/chunk-XSKOAVIS.js";import{q as k}from"../chunks/chunk-OEPSEZ5A.js";import"../chunks/chunk-XERCZVWP.js";import"../chunks/chunk-AT6M4CEW.js";import{e as a}from"../chunks/chunk-3GYLW4KZ.js";var St=a(_());var I=a(V()),c=a(k());var U=()=>l("getCustomNotification");var st=a(_()),z=a(_()),f=a(H()),r=a(k());var T=i=>l("engageCustomNotification",i);function d(){T()}var e=a(m()),w=class extends z.Component{constructor(...o){super(...o);let t,n=r.default.get(r.default.find(this.props.customNotificationData,"displaySequence"),"displaySequence",[]);n.length?t=n[0]:t=this.props.customNotificationData[0].display,this.state={rightOffset:p("coup_shift_left")?310:0,notification:0,hideNotification:!0,dismiss:!1,progress:!1,displaySequence:n,...t}}componentDidMount(){u("page","customNotification",{view:"customNotification",type:"notification",offerSignUp:r.default.get(this.props.view,"offerSignUp"),qualified:r.default.get(this.props.view,"qualified",!1),balance:r.default.get(this.props.view,"balance",0)}),setTimeout(()=>{document.querySelector("#honeyContainer")&&this.setState({compNotifLoaded:!0,rightOffset:"300px"}),(document.querySelector(".ebates-notification")||document.querySelector(".ebates-hover.ebates-hover-top"))&&this.setState({compNotifLoaded:!0,rightOffset:"410px"}),this.setState({hideNotification:!1})},500)}render(){let{hideNotification:o,rightOffset:t}=this.state,n=!0,s=!0,W=p("n_or_1")&&this.state.compNotifLoaded||p("coup_shift_left"),y;return this.state.cta&&(y=(0,e.jsx)("div",{className:"button-wrapper",children:(0,e.jsx)("button",{className:"primary-btn-large",onClick:this.onClick.bind(this),children:this.state.cta})})),(0,e.jsx)(D,{className:o?"disabled follow-page":"follow-page",style:{top:n?"0":"auto",bottom:n?"auto":"0",left:s?"auto":"0",right:W?t:s?"0":"auto"},dragSelector:"header",isDraggable:p("ext_notif_drag"),onDragEnd:this.trackFirstDragEnd,children:(0,e.jsx)(f.Motion,{style:{opacity:(0,f.spring)(o?0:1,{stiffness:180,damping:20}),y:(0,f.spring)(o?n?-100:100:0,{stiffness:180,damping:20})},children:({opacity:$,y:B})=>(0,e.jsxs)("div",{className:"custom-notification",style:{transform:`translate3d(0,${B}%,0)`,opacity:`${$}`},children:[(0,e.jsxs)("header",{children:[(0,e.jsx)(q,{width:120}),(0,e.jsx)(O,{}),(0,e.jsx)(S,{onClick:this.onClosePopup.bind(this,"x")})]}),(0,e.jsxs)("section",{children:[(0,e.jsx)("h2",{children:this.state.title}),this.state.progress?(0,e.jsx)(g,{estimatedDuration:5e3}):null,this.state.subtitle?(0,e.jsx)("h4",{className:"bold",children:this.state.subtitle}):null,y]})]})})})}trackFirstDragEnd=r.default.once((o,t)=>{R("customNotification",o,t)});onClick(){let{clickId:o}=h();if(this.state.dropCookie&&M(o),this.state.sendMetric&&u("track","noCouponsNotify",{clickId:o,currentLocation:r.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])}),this.state.notification<this.state.displaySequence.length-1){let t=this.state.notification+1,n=this.state.displaySequence[t],s=()=>{this.setState({notification:t,...n}),this.state.timeout&&n.timeout===void 0&&this.setState({timeout:void 0}),t===this.state.displaySequence.length-1&&n.timeout&&setTimeout(()=>{this.onClosePopup()},this.state.timeout)};this.setState({progress:!!this.state.timeout}),setTimeout(()=>{s(),this.setState({progress:!1})},this.state.timeout*2||0)}else if(this.props.customNotificationData.url){d();let{clickId:t}=h(),n={destUrl:this.props.customNotificationData.url,redirectId:t},s=N({params:n});window.open(s,"_blank"),u("trackClick","customNotificationClick","",{view:"customNotification",pageLocation:"notification",clickId:t})}else setTimeout(()=>{this.onClosePopup()},this.state.timeout||0)}onClosePopup(o){d(),this.setState({hideNotification:!0}),u("trackClick","dismissCustomNotification",o)}},b=C({view:["customView"],customNotificationData:["customNotificationData"],events:["events"],session:["session"]},w);var F=a(m());function A(i){if(i.type==="url")return!!document.URL.match(i.value);if(i.type==="title")return document.title.match(i.value);if(i.type==="selector")return!!(0,I.default)(i.value).length}function j(i){if(i.and)return(0,c.default)(i.and).map(t=>A(t)).filter().value().length===i.and.length;if(i.or)return!!(0,c.default)(i.or).map(t=>A(t)).filter().value().length}function X(i){return c.default.find(i,o=>j(o.identifiers))}function G(i,o){if(c.default.has(o,"runWithCoupons")){let t=!c.default.get(i,"coupons.ignoreSite");return!!(t&&o.runWithCoupons!==!1||!t)}return!0}async function E(){try{let i=await U();if(i&&i.engaged)return!1;let{siteData:o}=await P(),t=c.default.filter(o.notifications,s=>s.enabled!==!1&&G(o,s));X(t)&&t.length&&(x.set("customNotificationData",t),L({initialRoute:"/customNotification",cssUrl:"customNotification.css",route:(0,F.jsx)(v,{path:"customNotification",component:b})}))}catch{}}document.readyState!=="loading"?E():document.addEventListener("DOMContentLoaded",E);
