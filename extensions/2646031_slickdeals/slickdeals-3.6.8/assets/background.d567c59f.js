var X=Object.defineProperty;var Z=(t,e,i)=>e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var o=(t,e,i)=>(Z(t,typeof e!="symbol"?e+"":e,i),i),K=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)};var l=(t,e,i)=>(K(t,e,"read from private field"),i?i.call(t):e.get(t)),S=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},k=(t,e,i,a)=>(K(t,e,"write to private field"),a?a.call(t,i):e.set(t,i),i);import{ay as RequestService,aK as FRONTPAGE_DEALS_URL,aL as ATTACHMENT_PATTERN,aM as ATTACHMENT_URL,aN as EARLY_ACCESS_DEALS_URL,aO as EARLY_ACCESS_DEALS_STATIC_URL,aP as DOMAIN,y as MerchantId,aQ as TRENDING_STORES_URL,D as browser,aE as Authorization,aB as Analytics,aR as ClientService,aS as AbTestService,aC as API,S as SentryIO,aT as SURVEY_MONKEY_POST_URL,aU as MerchantLookupService,aH as TabService,aV as MerchantCouponManager,M as MerchantCouponType,aW as AttributionService,aX as ConfigServiceManager,aY as ActiveSession,aZ as SessionDataKey,ax as LocalStorageService,a_ as RequestWatcher,a$ as MerchantFetching,b0 as LocalStorageCache,b1 as SuppressionService,b2 as LoyaltyActivationLastSeenService,P as PAGE_DEAL_DETAILS_SIDEBAR,b3 as AutoOpenTabs,b4 as MerchantTracking,az as UserOptionsService,b5 as AllowTrackingService,b6 as AttributionTabService,aF as LoyaltyRepository,b7 as MANIFEST_VERSION,H as HOME_URL,b8 as UAParser,b9 as OnInstallService,ba as NavigationService,bb as LANDING_PAGE,bc as ExtensionConfigService,bd as STORE_URL,aq as ExtensionConfigKey,be as DeepLinkService,bf as Heartbeat,aA as IconService,bg as MerchantStates,bh as OutclickService,bi as DealDetailsService,bj as PopupInitializer,bk as MerchantService}from"./popupInitializer.bb4281b7.js";import{i as initializable,s as sendMessage,o as onMessage}from"./pageInteraction.2f84ddce.js";import{d as devLog}from"./devLog.fc48ebad.js";import{a as DirectToMerchantOnboardingService}from"./directToMerchantOnboardingService.4ab50cf4.js";import{i as isGoogleUrl,I as InlineNotification,b as LoyaltyOfferService,H as HeaderBanner,c as LoyaltyOfferFlag,d as SlickdealsButtonManager,e as UserActionsService,f as SearchRcmService}from"./loyaltyOfferService.5af7130a.js";import"./index.0a1d9bc1.js";const M=class{constructor(){o(this,"sessionData",{})}static create(){return M.instance=M.instance||new this,M.instance}get(e){try{return JSON.parse(this.sessionData[e])}catch(i){return{}}}set(e,i){this.sessionData[e]=JSON.stringify(i)}};let SessionStorage=M;o(SessionStorage,"instance");const T=class{constructor(e){this.requestService=e}static create(){var e;return T.instance=(e=T.instance)!=null?e:new this(RequestService.create()),T.instance}async update(){try{return(await this.requestService.fetch(FRONTPAGE_DEALS_URL).json()).map(i=>({...i,image:(i.image||"").replace(ATTACHMENT_PATTERN,ATTACHMENT_URL)}))}catch(e){return[]}}};let FrontpageDeals=T;o(FrontpageDeals,"instance");var W,_;const O=class{constructor(e){S(this,W,EARLY_ACCESS_DEALS_URL);S(this,_,EARLY_ACCESS_DEALS_STATIC_URL);this.requestService=e}static create(){var e;return O.instance=(e=O.instance)!=null?e:new this(RequestService.create()),O.instance}async update(e){try{const s=(await(await this.requestService.fetch(l(this,_))).json()).deals.map(r=>{let{url:c}=r;return{...r,url:c}});return(e==null?void 0:e.id)&&e.id!==MerchantId.Slickdeals?s.filter(r=>r.store.storeId===e.id):s}catch(i){return[]}}};let EarlyAccessDeals=O;W=new WeakMap,_=new WeakMap,o(EarlyAccessDeals,"instance");const L=class{constructor(e){this.requestService=e}static create(){var e;return L.instance=(e=L.instance)!=null?e:new this(RequestService.create()),L.instance}async update(){try{const i=await(await this.requestService.fetch(TRENDING_STORES_URL)).json(),a=i==null?void 0:i.stores;return a||[]}catch(e){return[]}}};let TrendingCouponStores=L;o(TrendingCouponStores,"instance");async function closeActivePopupWindow(){const t=await browser.windows.getLastFocused();(t==null?void 0:t.id)&&t.type==="popup"&&browser.windows.remove(t.id)}const g=class{constructor(e,i,a,n){this.authorization=e,this.analytics=i,this.extensionClientService=a,this.abTestService=n}static create(){var e;return(e=g.instance)!=null||(g.instance=new g(Authorization.create(),Analytics.create(),ClientService.create(),AbTestService.create())),g.instance}async handleMessageFromSite(e){switch(e.action){case"abTestPlacement":await this.abTestService.processTestPlacement(e.data);break;case"closeActivePopupWindow":await closeActivePopupWindow();break;case"closeRegisterSuccessWindow":await this.authorization.closeRegisterSuccessWindow();break;case"ping":await this.extensionClientService.setClientOnPing();break;case"syncAuth":{const i=Number(e.data.userId);await this.authorization.getUserId()!==i&&(await this.authorization.syncUser(),this.analytics.trackEvent({category:"Auth",action:i>0?"Login":"Logout"}));break}default:devLog(`Received unknown message from site: ${JSON.stringify(e)}`)}}};let SiteToExtensionController=g;o(SiteToExtensionController,"instance");var E;const y=class{constructor(e,i){S(this,E,`${API}/browser-extension/1/survey/feedback`);this.requestService=e,this.authorization=i}static create(){return y.instance=y.instance||new y(RequestService.create(),Authorization.create()),y.instance}async sendFeedbackForm(e){try{const i=await this.authorization.getClientId();await this.requestService.post(l(this,E),{json:{...e,clientId:i,runtimeId:browser.runtime.id,distribution:"firefox-v2"}})}catch(i){throw SentryIO.captureException(i),i}}};let FeedbackForm=y;E=new WeakMap,o(FeedbackForm,"instance");var U;const d=class{constructor(e){S(this,U,`${SURVEY_MONKEY_POST_URL}`);this.requestService=e}static create(){var e;return(e=d.instance)!=null||(d.instance=new d(RequestService.create())),d.instance}async sendFeedbackForm(e){try{const{surveyType:i,...a}=e;return await this.requestService.post(`${l(this,U)}/${i}`,{json:{...a}}),await Promise.resolve()}catch(i){throw SentryIO.captureException(i),i}}};let SurveyService=d;U=new WeakMap,o(SurveyService,"instance");const f=class{constructor(e,i,a){this.merchantLookupService=e,this.tabService=i,this.analytics=a}static create(){var e;return(e=f.instance)!=null||(f.instance=new f(MerchantLookupService.create(),TabService.create(),Analytics.create())),f.instance}async injectGlobalScriptIntoTab({frameId:e,tabId:i,tabUrl:a,isPrerendered:n=!1}){try{await this.injectScriptIntoTab({scriptFile:"src/contentScript/global/index.js",tabId:i,tabUrl:a,frameId:e,isPrerendered:n})}catch(s){SentryIO.captureException(s)}}async injectGlobalScriptIntoActiveTab(){try{await this.injectScriptIntoActiveTab("src/contentScript/global/index.js")}catch(e){SentryIO.captureException(e)}}async injectScriptIntoActiveTab(e){const[i]=await browser.tabs.query({active:!0,currentWindow:!0});!i||!i.id||!i.url||await this.injectScriptIntoTab({scriptFile:e,tabId:i.id,tabUrl:i.url})}async injectScriptIntoTab({scriptFile:e,tabId:i,tabUrl:a,frameId:n,isPrerendered:s=!1}){if(!!await this.isInjectableUrl(a,i))if(s&&this.analytics.trackEvent({category:"Extension",action:"prerenderedPage",label:new URL(a).hostname}),browser.scripting){const r={tabId:i};n&&(r.frameIds=[n]),await browser.scripting.executeScript({target:r,files:[e]})}else await browser.tabs.executeScript(i,{file:e,frameId:n})}async isInjectableUrl(e,i){return isGoogleUrl(new URL(e))||Boolean(await this.merchantLookupService.getMerchantByUrl(e)&&await this.tabService.get(i))}};let ContentScriptInjection=f;o(ContentScriptInjection,"instance");const b=class{constructor(e){this.contentScriptInjection=e}static create(){var e;return(e=b.instance)!=null||(b.instance=new this(ContentScriptInjection.create())),b.instance}init(){browser.tabs.onActivated.addListener(({tabId:e})=>{this.updateBrowserPopup(e)}),browser.tabs.onUpdated.addListener((e,i)=>{i.status==="complete"&&this.updateBrowserPopup(e)}),browser.windows.onFocusChanged.addListener(async()=>{const e=await this.getActiveTab();!(e!=null&&e.id)||this.updateBrowserPopup(e.id)})}async updateBrowserPopup(e){this.setPopup("src/popup/index.html");const i=await this.getActiveTab();!(i!=null&&i.id)||!(i!=null&&i.url)||i.id===e&&await this.contentScriptInjection.isInjectableUrl(i.url,e)&&this.unsetPopup()}unsetPopup(){this.setPopup("")}setPopup(e){var i;((i=browser.action)!=null?i:browser.browserAction).setPopup({popup:e})}async getActiveTab(){try{const[e]=await browser.tabs.query({active:!0,currentWindow:!0});return e}catch(e){return}}};let BrowserPopupManager=b;o(BrowserPopupManager,"instance");const w=class{constructor(e,i,a){this.merchantLookupService=e,this.merchantCouponManager=i,this.analytics=a}static create(){var e;return(e=w.instance)!=null||(w.instance=new this(MerchantLookupService.create(),MerchantCouponManager.create(),Analytics.create())),w.instance}async forwardCouponsToMerchant({coupons:e=[],couponType:i,merchantUrl:a}){var c;if(!e.length)return;const n=await this.merchantLookupService.getMerchantByUrlAndUpdate(a);if(!n)return;i===MerchantCouponType.DealDetailsSidebar?this.merchantCouponManager.addCouponsToMerchant(n,e,MerchantCouponType.DealDetailsSidebar):i===MerchantCouponType.DealDetails?this.merchantCouponManager.addCouponsToMerchant(n,e,MerchantCouponType.DealDetails):i===MerchantCouponType.MerchantForwarded&&this.merchantCouponManager.addCouponsToMerchant(n,e,MerchantCouponType.MerchantForwarded);const r=(c={[MerchantCouponType.DealDetailsSidebar]:"DDSB",[MerchantCouponType.DealDetails]:"Deal Details",[MerchantCouponType.MerchantForwarded]:"Merchant"}[i])!=null?c:"Unknown";this.analytics.trackEvent({category:"CAA Site Coupons",action:"Added",label:`${r} forwarding`})}};let CouponForwarder=w;o(CouponForwarder,"instance");var __defProp$9=Object.defineProperty,__getOwnPropDesc$9=Object.getOwnPropertyDescriptor,__decorateClass$9=(t,e,i,a)=>{for(var n=a>1?void 0:a?__getOwnPropDesc$9(e,i):e,s=t.length-1,r;s>=0;s--)(r=t[s])&&(n=(a?r(e,i,n):r(n))||n);return a&&n&&__defProp$9(e,i,n),n},B;let ContentInitAttribution=(B=class{constructor(t){this.attributionService=t}static create(){var t;return(t=ContentInitAttribution.instance)!=null||(ContentInitAttribution.instance=new this(AttributionService.create())),ContentInitAttribution.instance}async getData({merchant:t}){const e={status:null};return t&&(e.status=this.attributionService.getAttributionStatus(t)),e}},o(B,"instance"),B);ContentInitAttribution=__decorateClass$9([initializable],ContentInitAttribution);class CouponAutoApplyConfigService{constructor(e){this.configService=e}static create(){return new this(ConfigServiceManager.create())}getCaaConfig(e,i){var s;let a=this.configService.getCaaConfigByMerchantId(i.id);a||(a=this.configService.getPlatformCaaConfigByUrl(e));let n=null;return a&&(n=new RegExp(a.url,"ig").test(e),(s=a.gift)!=null&&s.url&&(n=new RegExp(a.gift.url,"ig").test(e))),n||(a=this.configService.getCaaConfigByUrl(e)),this.storeHasCaaConfig(a,i)?a!=null?a:null:this.caaConfigMatchedWithExisting(a,i)?{...a,storeID:null}:null}storeHasCaaConfig(e,i){return Boolean(e==null?void 0:e.storeID)&&Boolean(i==null?void 0:i.id)&&(e==null?void 0:e.storeID)===(i==null?void 0:i.id)}caaConfigMatchedWithExisting(e,i){return Boolean(e==null?void 0:e.id)&&Boolean(i==null?void 0:i.id)&&(e==null?void 0:e.storeID)===null}}class CouponAutoApplyContentDataFetcherManualApply{constructor(e){this.activeSession=e}static create(){return new this(ActiveSession.create())}updateData(e,i){var a;return!e.caaEnabled||!((a=e.caaConfig)!=null&&a.manual)?e:this.activeSession.hasDisplayedNotification(SessionDataKey.NotificationCouponAutoApplyManualDisplayed,i.id)?(e.caaConfig=null,e):(e.caaEnabled=!1,e.inlineNotification={type:InlineNotification.CouponAutoApplyManual},e.inlineNotification.type===InlineNotification.CouponAutoApplyManual&&this.activeSession.setDisplayedNotification(SessionDataKey.NotificationCouponAutoApplyManualDisplayed,i.id),e)}}class CouponAutoApplyDataFetcher{constructor(e){this.couponAutoApplyDataFetcherManualApply=e}static create(){return new this(CouponAutoApplyContentDataFetcherManualApply.create())}getDefault(){return{caaAutoDisplay:!0,caaConfig:null,caaEnabled:!1,inlineNotification:null}}updateData(e,{merchant:i}){let a={...e,caaEnabled:Boolean(e.caaConfig)};return a=this.couponAutoApplyDataFetcherManualApply.updateData(a,i),a}}const P=class{constructor(e){this.localStorageService=e}static create(){var e;return P.instance=(e=P.instance)!=null?e:new this(LocalStorageService.create("dismissalServiceCaa")),P.instance}setDismissedMerchant(e){this.localStorageService.setValue(String(e),Date.now())}isDismissedMerchant(e){return this.updateDismissalStatus(e),!!this.localStorageService.getValue(String(e))}async updateDismissalStatus(e){const i=Number({}.VITE_DISMISSAL_CAA_DELAY_MILLISECONDS),a=this.localStorageService.getValue(String(e));Date.now()-a>i&&await this.localStorageService.remove(String(e))}};let DismissalServiceCaa=P;o(DismissalServiceCaa,"instance");var __defProp$8=Object.defineProperty,__getOwnPropDesc$8=Object.getOwnPropertyDescriptor,__decorateClass$8=(t,e,i,a)=>{for(var n=a>1?void 0:a?__getOwnPropDesc$8(e,i):e,s=t.length-1,r;s>=0;s--)(r=t[s])&&(n=(a?r(e,i,n):r(n))||n);return a&&n&&__defProp$8(e,i,n),n};const DISABLE_CAA_AUTO_POPUP_PATTERNS=["gclid"];var $;let SuppressionServiceCaa=($=class{constructor(t,e,i,a,n){o(this,"currentSuppressions",{});o(this,"flushTimer",0);o(this,"useTimeout",!browser.webNavigation.onCreatedNavigationTarget);o(this,"timeout",{});this.requestWatcher=t,this.merchantFetching=e,this.merchantLookupService=i,this.tabService=a,this.cache=n}static create(){var t;return(t=SuppressionServiceCaa.instance)!=null||(SuppressionServiceCaa.instance=new this(RequestWatcher.create(),MerchantFetching.create(),MerchantLookupService.create(),TabService.create(),LocalStorageCache.create("suppressionServiceCaa"))),SuppressionServiceCaa.instance}async init(){this.currentSuppressions=await this.cache.get("currentSuppressions")||{},this.requestWatcher.onRequest(({tabId:t,url:e})=>{this.checkSuppression(t,e)}),this.tabService.onRemoved(({tabId:t})=>{this.removeSuppression(t)}),browser.webNavigation.onCreatedNavigationTarget&&browser.webNavigation.onCreatedNavigationTarget.addListener(({tabId:t,sourceTabId:e})=>{const i="ebay";this.getSuppressedSlugsByTabId(e).includes(i)&&this.setCaaSuppression({tabId:t,slug:i})})}async checkSuppression(t,e){const i=await this.merchantLookupService.getMerchantByUrl(e);!i||i.slug==="slickdeals"||(await this.merchantFetching.updateConfig(i),!(i.config&&!i.config.disableCaaAutoPopupGoogleSem)&&(this.getSuppressedSlugsByTabId(t).includes(i.slug)||this.isSuppressionUrl(e)&&this.setCaaSuppression({tabId:t,slug:i.slug})))}isSuppressionUrl(t){return DISABLE_CAA_AUTO_POPUP_PATTERNS.find(e=>{try{return t.search(e)>-1}catch(i){return t.indexOf(e)>0}})!==void 0}getSuppressedSlugsByTabId(t){return t?this.currentSuppressions[t]||[]:[]}setCaaSuppression({tabId:t,slug:e}){!t||!e||(this.currentSuppressions[t]&&!this.currentSuppressions[t].includes(e)?this.currentSuppressions[t].push(e):this.currentSuppressions[t]=[e],this.useTimeout&&e==="ebay"&&(this.timeout[e]=Date.now()+LocalStorageCache.TTL.ONE_HOUR),this.flush())}removeSuppression(t){!t||(delete this.currentSuppressions[t],this.flush())}flush(){this.flushTimer||(this.flushTimer=setTimeout(()=>{this.flushTimer=0,this.cache.set("currentSuppressions",this.currentSuppressions,LocalStorageCache.TTL.ONE_HOUR*4).then()},5e3))}shouldAutoDisplayCaa({tabId:t,slug:e}){if(!t||!e||this.getSuppressedSlugsByTabId(t).includes(e))return!1;if(this.useTimeout&&this.timeout[e]){if(Date.now()<this.timeout[e])return!1;delete this.timeout[e]}return!0}},o($,"instance"),$);SuppressionServiceCaa=__decorateClass$8([initializable],SuppressionServiceCaa);const m=class{constructor(e,i,a,n,s){this.couponAutoApplyConfigService=e,this.couponAutoApplyContentDataFetcher=i,this.dismissalService=a,this.suppressionService=n,this.suppressionServiceCaa=s}static create(){var e;return m.instance=(e=m.instance)!=null?e:new this(CouponAutoApplyConfigService.create(),CouponAutoApplyDataFetcher.create(),DismissalServiceCaa.create(),SuppressionService.create(),SuppressionServiceCaa.create()),m.instance}getData({url:e,merchant:i,tabId:a}){var r;let n=this.couponAutoApplyContentDataFetcher.getDefault();if(!(i&&a)||(n.caaConfig=this.couponAutoApplyConfigService.getCaaConfig(e,i),!n.caaConfig))return n;n=this.couponAutoApplyContentDataFetcher.updateData(n,{merchant:i});const s={tabId:a,slug:i.slug};if(n.caaAutoDisplay=!this.suppressionService.isMerchantTabSuppressed(s)&&this.suppressionServiceCaa.shouldAutoDisplayCaa(s),n.caaConfig&&((r=i.coupons)==null?void 0:r.length)===0&&i.vanityCoupons&&i.vanityCoupons.length>0){const c=i.vanityCoupons.sort(()=>.5-Math.random())[0];c&&(n.caaEnabled=!0,i.coupons=[c],i.couponsCount=1)}return this.dismissalService.isDismissedMerchant(i.id)&&(n.caaEnabled=!1),n}};let ContentInitCouponAutoApply=m;o(ContentInitCouponAutoApply,"instance");var __defProp$7=Object.defineProperty,__getOwnPropDesc$7=Object.getOwnPropertyDescriptor,__decorateClass$7=(t,e,i,a)=>{for(var n=a>1?void 0:a?__getOwnPropDesc$7(e,i):e,s=t.length-1,r;s>=0;s--)(r=t[s])&&(n=(a?r(e,i,n):r(n))||n);return a&&n&&__defProp$7(e,i,n),n},j;let ContentInitLoyalty=(j=class{constructor(t){this.loyaltyOfferService=t}static create(){var t;return(t=ContentInitLoyalty.instance)!=null||(ContentInitLoyalty.instance=new this(LoyaltyOfferService.create())),ContentInitLoyalty.instance}async getData({merchant:t,url:e}){const i={offers:[]};if(!t)return i;const a=this.loyaltyOfferService.getProductSkuFromUrl(e);return i.offers=a?await this.loyaltyOfferService.getActiveProductOffers(t.id,a):await this.loyaltyOfferService.getActiveMerchantOffers(t.id),i}},o(j,"instance"),j);ContentInitLoyalty=__decorateClass$7([initializable],ContentInitLoyalty);var __defProp$6=Object.defineProperty,__getOwnPropDesc$6=Object.getOwnPropertyDescriptor,__decorateClass$6=(t,e,i,a)=>{for(var n=a>1?void 0:a?__getOwnPropDesc$6(e,i):e,s=t.length-1,r;s>=0;s--)(r=t[s])&&(n=(a?r(e,i,n):r(n))||n);return a&&n&&__defProp$6(e,i,n),n},F;let ContentInitMerchant=(F=class{constructor(t,e,i,a){this.attributionService=t,this.merchantLookupService=e,this.suppressionService=i,this.tabService=a}static create(){var t;return ContentInitMerchant.instance=(t=ContentInitMerchant.instance)!=null?t:new this(AttributionService.create(),MerchantLookupService.create(),SuppressionService.create(),TabService.create()),ContentInitMerchant.instance}init(){AttributionService.create().init(),TabService.create().init()}async getData(t,e){var a;const i=await this.merchantLookupService.getMerchantByUrlAndUpdate(t);return i&&(this.tabService.setContentTab(e,i.slug),((a=i.config)==null?void 0:a.noAttributionStandDown)&&!this.attributionService.hasAttribution(i)&&(i.suppressed=!0,this.suppressionService.setMerchantSuppression({slug:i.slug,activation:!1,tabId:e}))),i}},o(F,"instance"),F);ContentInitMerchant=__decorateClass$6([initializable],ContentInitMerchant);const A=class{constructor(e,i){this.authorization=e,this.attributionService=i}static create(){var e;return(e=A.instance)!=null||(A.instance=new this(Authorization.create(),AttributionService.create())),A.instance}async getHeaderBanner({merchant:e,loyalty:i}){const[a]=i.offers;if(!e||!a)return null;const n=[this.getActivateOffer,this.getReactivateOffer];for(const s of n){const r=s.call(this,{merchant:e,loyaltyOffer:a});if(r)return r}return null}getActivateOffer({merchant:e,loyaltyOffer:i}){var a;return!((a=i==null?void 0:i.store)!=null&&a.storeRate)||this.attributionService.hasBeenLost(e)?null:{type:HeaderBanner.LoyaltyActivateOffer,routeNames:["deals"]}}getReactivateOffer({merchant:e}){return!this.attributionService.isReactivatable(e)||!this.authorization.getIsInLoyalty()?null:{type:HeaderBanner.LoyaltyReactivateOffer,routeNames:["deals"]}}};let LoyaltyHeaderBannerService=A;o(LoyaltyHeaderBannerService,"instance");const I=class{constructor(e){this.loyaltyHeaderBannerService=e}static create(){var e;return(e=I.instance)!=null||(I.instance=new this(LoyaltyHeaderBannerService.create())),I.instance}async getHeaderBanner({couponAutoApply:e,loyalty:i,merchant:a}){const n=i?await this.loyaltyHeaderBannerService.getHeaderBanner({merchant:a,loyalty:i}):null;return e.caaEnabled?{type:n?HeaderBanner.CouponAutoApplyLoyalty:HeaderBanner.CouponAutoApply,routeNames:["deals","coupons"]}:n||null}};let HeaderBannerManager=I;o(HeaderBannerManager,"instance");var __defProp$5=Object.defineProperty,__getOwnPropDesc$5=Object.getOwnPropertyDescriptor,__decorateClass$5=(t,e,i,a)=>{for(var n=a>1?void 0:a?__getOwnPropDesc$5(e,i):e,s=t.length-1,r;s>=0;s--)(r=t[s])&&(n=(a?r(e,i,n):r(n))||n);return a&&n&&__defProp$5(e,i,n),n},z;let LoyaltyNotificationService=(z=class{constructor(t,e,i,a){this.authorization=t,this.attributionService=e,this.loyaltyActivationLastSeenService=i,this.activeSessionService=a}static create(){var t;return(t=LoyaltyNotificationService.instance)!=null||(LoyaltyNotificationService.instance=new this(Authorization.create(),AttributionService.create(),LoyaltyActivationLastSeenService.create(),ActiveSession.create())),LoyaltyNotificationService.instance}async getInlineNotification({merchant:t,loyalty:e,couponAutoApply:i}){var s;if(!t||((s=t.config)==null?void 0:s.disableCashbackNotification)||i.caaEnabled&&t.couponsCount)return null;const[a]=e.offers;if(!a)return null;const n=[this.getProductOffer,this.getActivateOffer,this.getReactivateOffer,this.getActivated,this.getStillActive];for(const r of n){const c=await r.call(this,{merchant:t,couponAutoApply:i,loyaltyOffer:a});if(c)return c}return null}async getProductOffer({merchant:t,couponAutoApply:e,loyaltyOffer:i}){var n;if(!await this.authorization.getIsInLoyalty()||!((n=i==null?void 0:i.product)!=null&&n.productRate)||e.caaEnabled||this.attributionService.hasAttribution(t)||this.attributionService.hasBeenLost(t)||this.loyaltyActivationLastSeenService.getActivationLastSeen(t.id))return null;const a=`${t.id}--${i.product.productSku}`;return this.activeSessionService.hasDisplayedNotification(SessionDataKey.LoyaltyProductOfferNotificationDisplayed,a)?null:(this.activeSessionService.setDisplayedNotification(SessionDataKey.LoyaltyProductOfferNotificationDisplayed,a),{type:InlineNotification.LoyaltyProductOffer})}async getActivateOffer({merchant:t,couponAutoApply:e,loyaltyOffer:i}){var a;return!((a=i==null?void 0:i.store)!=null&&a.storeRate)||this.activeSessionService.hasDisplayedNotification(SessionDataKey.LoyaltyActivateOfferNotificationDisplayed,t.id)||this.attributionService.hasAttribution(t)&&await this.authorization.getIsInLoyalty()||this.attributionService.hasBeenLost(t)||this.loyaltyActivationLastSeenService.getActivationLastSeen(t.id)?null:(this.activeSessionService.setDisplayedNotification(SessionDataKey.LoyaltyActivateOfferNotificationDisplayed,t.id),i.flags.includes(LoyaltyOfferFlag.SegmentedOffer)&&await this.authorization.getIsInLoyalty()?{type:InlineNotification.LoyaltySegmentedOffer}:{type:InlineNotification.LoyaltyActivateOffer,props:{isOnCheckout:e.caaEnabled}})}async getReactivateOffer({merchant:t}){if(!await this.authorization.getIsInLoyalty()||this.activeSessionService.hasDisplayedNotification(SessionDataKey.LoyaltyReactivationNotificationDisplayed,t.id)||!this.attributionService.isReactivatable(t))return null;const e=this.loyaltyActivationLastSeenService.getActivationLastSeen(t.id);return e&&!this.attributionService.wasLostAfter(t,e)?null:(this.activeSessionService.setDisplayedNotification(SessionDataKey.LoyaltyReactivationNotificationDisplayed,t.id),{type:InlineNotification.LoyaltyReactivateOffer})}async getActivated({merchant:t}){return!await this.authorization.getIsInLoyalty()||this.activeSessionService.hasDisplayedNotification(SessionDataKey.LoyaltyActivateOfferNotificationDisplayed,t.id)||!this.attributionService.hasAttribution(t)||this.loyaltyActivationLastSeenService.getActivationLastSeen(t.id)?null:{type:InlineNotification.LoyaltyActivated}}async getStillActive({merchant:t,couponAutoApply:e}){return!await this.authorization.getIsInLoyalty()||!e.caaEnabled||!this.attributionService.hasAttribution(t)||this.activeSessionService.hasDisplayedNotification(SessionDataKey.LoyaltyStillActiveNotificationDisplayed,t.id)?null:(this.activeSessionService.setDisplayedNotification(SessionDataKey.LoyaltyStillActiveNotificationDisplayed,t.id),{type:InlineNotification.LoyaltyStillActive})}},o(z,"instance"),z);LoyaltyNotificationService=__decorateClass$5([initializable],LoyaltyNotificationService);var __defProp$4=Object.defineProperty,__getOwnPropDesc$4=Object.getOwnPropertyDescriptor,__decorateClass$4=(t,e,i,a)=>{for(var n=a>1?void 0:a?__getOwnPropDesc$4(e,i):e,s=t.length-1,r;s>=0;s--)(r=t[s])&&(n=(a?r(e,i,n):r(n))||n);return a&&n&&__defProp$4(e,i,n),n},x;let InlineNotificationManager=(x=class{constructor(t){this.loyaltyNotificationService=t}static create(){var t;return(t=InlineNotificationManager.instance)!=null||(InlineNotificationManager.instance=new this(LoyaltyNotificationService.create())),InlineNotificationManager.instance}async getInlineNotification(t){const{couponAutoApply:e,windowRoute:i}=t;if(e.inlineNotification)return e.inlineNotification;if(i){const[a]=i.split("?");if(a===PAGE_DEAL_DETAILS_SIDEBAR.path)return null;if(a==="/notification/onboarding")return{type:InlineNotification.Onboarding,props:{nextNotification:await this.getNotification(t)}}}return this.getNotification(t)}async getNotification({merchant:t,couponAutoApply:e,loyalty:i}){const a=await this.loyaltyNotificationService.getInlineNotification({merchant:t,loyalty:i,couponAutoApply:e});return a||null}},o(x,"instance"),x);InlineNotificationManager=__decorateClass$4([initializable],InlineNotificationManager);var __defProp$3=Object.defineProperty,__getOwnPropDesc$3=Object.getOwnPropertyDescriptor,__decorateClass$3=(t,e,i,a)=>{for(var n=a>1?void 0:a?__getOwnPropDesc$3(e,i):e,s=t.length-1,r;s>=0;s--)(r=t[s])&&(n=(a?r(e,i,n):r(n))||n);return a&&n&&__defProp$3(e,i,n),n},q;let GlobalContentScriptDataFetcher=(q=class{constructor(t,e,i,a,n,s,r,c,u,N,R,J,Q){this.contentInitCouponAutoApply=t,this.contentInitMerchant=e,this.autoOpenTabs=i,this.merchantTracking=a,this.slickdealsButtonManager=n,this.userActionsService=s,this.authorization=r,this.userOptionsService=c,this.inlineNotificationManager=u,this.contentInitLoyalty=N,this.contentInitAttribution=R,this.headerBannerManager=J,this.configServiceManager=Q}static create(){var t;return(t=GlobalContentScriptDataFetcher.instance)!=null||(GlobalContentScriptDataFetcher.instance=new this(ContentInitCouponAutoApply.create(),ContentInitMerchant.create(),AutoOpenTabs.create(),MerchantTracking.create(),SlickdealsButtonManager.create(),UserActionsService.create(),Authorization.create(),UserOptionsService.create(),InlineNotificationManager.create(),ContentInitLoyalty.create(),ContentInitAttribution.create(),HeaderBannerManager.create(),ConfigServiceManager.create())),GlobalContentScriptDataFetcher.instance}async getData({url:t,title:e,navigationType:i,tabId:a}){this.contentInitMerchant.init(),await this.slickdealsButtonManager.init(),await this.userOptionsService.init();const n=await this.contentInitMerchant.getData(t,a),s=this.contentInitCouponAutoApply.getData({url:t,merchant:n,tabId:a}),r=await this.contentInitLoyalty.getData({merchant:n,url:t});n!=null&&n.config&&this.merchantTracking.track({urlObj:new URL(t),title:e,config:n.config,caaConfig:s.caaConfig});let c=await this.autoOpenTabs.getAutoOpenTabRoute({tabId:a,merchant:n,navigationType:i}),u=await this.slickdealsButtonManager.getSlickdealsButton({merchant:n,windowRoute:c,couponAutoApply:s});u&&(c=null);const N=await this.inlineNotificationManager.getInlineNotification({merchant:n,couponAutoApply:s,loyalty:r,windowRoute:c});N&&(u=null,c=null);const R=await this.headerBannerManager.getHeaderBanner({couponAutoApply:s,loyalty:r,merchant:n});return{authInfo:await this.authorization.getAuthInfo(),attribution:await this.contentInitAttribution.getData({merchant:n}),capturerConfigs:this.configServiceManager.getCapturerConfigsByUrl(t),couponAutoApply:s,headerBanner:R,inlineNotification:N,loyalty:r,merchant:n,slickdealsButton:u,windowRoute:c,userActions:await this.userActionsService.getAll(),userOptions:this.userOptionsService.getAllOptions()}}},o(q,"instance"),q);GlobalContentScriptDataFetcher=__decorateClass$3([initializable],GlobalContentScriptDataFetcher);function isSdUrl(t){return/^(?:https?:\/\/)?(clicks\.)?slickdeals\.net|\w+\.dev\.sdhq\.local\/|\w+\.slickdeals\.dev\//.test(t)}var __defProp$2=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__decorateClass$2=(t,e,i,a)=>{for(var n=a>1?void 0:a?__getOwnPropDesc$2(e,i):e,s=t.length-1,r;s>=0;s--)(r=t[s])&&(n=(a?r(e,i,n):r(n))||n);return a&&n&&__defProp$2(e,i,n),n},G;let GlobalContentScriptInitializer=(G=class{constructor(t,e){this.allowTrackingService=t,this.attributionTabService=e}static create(){var t;return(t=GlobalContentScriptInitializer.instance)!=null||(GlobalContentScriptInitializer.instance=new this(AllowTrackingService.create(),AttributionTabService.create())),GlobalContentScriptInitializer.instance}isTabInitializable({url:t,tabId:e}){return{inlineNotification:this.getInitializeNotification(t),isInitializable:!this.isAttributionTab(e)}}isAttributionTab(t){return Boolean(this.attributionTabService.getAttributionTab(t))}getInitializeNotification(t){return this.shouldShowAllowTrackingInlineNotification(t)?{type:InlineNotification.AllowTrackingNotification}:null}shouldShowAllowTrackingInlineNotification(t){return!this.allowTrackingService.hasBeenSet()&&t?!(isSdUrl(t)&&/\/corp\//.test(t)):!1}},o(G,"instance"),G);GlobalContentScriptInitializer=__decorateClass$2([initializable],GlobalContentScriptInitializer);const C=class{constructor(e,i){this.auth=e,this.loyaltyRepository=i}static create(){var e;return(e=C.instance)!=null||(C.instance=new this(Authorization.create(),LoyaltyRepository.create())),C.instance}async getUserInfo(){return!await this.auth.getUserId()||!await this.auth.getIsInLoyalty()?null:this.loyaltyRepository.getUserInfo(await this.auth.getUserId())}async getPointsHistory(){return!await this.auth.getUserId()||!await this.auth.getIsInLoyalty()?null:this.loyaltyRepository.getPointsHistory(await this.auth.getUserId())}};let LoyaltyUserService=C;o(LoyaltyUserService,"instance");class PageScriptInjector{static async registerSlickdealsWorldContentScripts(){const e=`https://*.${"slickdeals.net".split(".").slice(-2).join(".")}/*`;try{await browser.scripting.registerContentScripts([{id:"slickdealsWorldStart",matches:[e],js:["src/contentScript/slickdealsWorldStart/index.js"],runAt:"document_start",allFrames:!0,world:"MAIN"}])}catch(i){}}static create(){var e;return(e=this.instance)!=null||(this.instance=new this),this.instance}injectExtensionWindowVariables(e,i){!e||browser.scripting.executeScript({target:{tabId:e,frameIds:i?[i]:void 0},world:"MAIN",injectImmediately:!0,args:[{manifestVersion:MANIFEST_VERSION,runtimeId:browser.runtime.id}],func:({manifestVersion:a,runtimeId:n})=>{window.sdExtensionDistribution="firefox-v2",window.sdExtensionId=`${n}`,window.sdExtensionPresent="Yes",window.sdExtensionVersion=`${a}`}})}}o(PageScriptInjector,"instance");const __ScriptRunner=class{static create(){var t;return(t=__ScriptRunner.instance)!=null||(__ScriptRunner.instance=new this),__ScriptRunner.instance}async execCustomScript(t,e,{endTimeout:i,intervalTimeout:a}={},n){if(this.isScriptingEnable()){if(!n)return null;const r=this.getScriptAsFunction(),c=await browser.scripting.executeScript({target:{tabId:n,allFrames:!0},func:r,args:[t,e,{endTimeout:i,intervalTimeout:a}],world:"MAIN"});return{executed:!0,result:c}}const s=this.getScriptAsString();return{executed:!1,code:s}}isScriptingEnable(){return!!(browser.scripting&&typeof browser.scripting.executeScript=="function")}getScriptAsString(){return`(code, responseType, endTimeout, intervalTimeout) => { 
      const script = document.createElement('script');
      const key = 'pageData_'+Number(Math.random().toFixed(2)) * 1000;
      code = code.replace(/%key/gim, key);
      script.textContent = code;
      document.head.appendChild(script);
      return new Promise((resolve) => {
        let timeout = 0;
        const interval = setInterval(() => {
          if (sessionStorage[key]) {
            const storageValue =
              responseType === 'json'
                ? JSON.stringify(sessionStorage[key] || {})
                : sessionStorage[key];
            if (timeout) clearTimeout(timeout);
            clearInterval(interval);
            delete sessionStorage[key];
            document.head.removeChild(script);
            resolve(storageValue);
          }
        }, intervalTimeout || 500);

        timeout = setTimeout(() => {
          if (interval) clearInterval(interval);
          delete sessionStorage[key];
          document.head.removeChild(script);
          resolve('');
        }, endTimeout || 5000);
      });
    }`}getScriptAsFunction(){return(code,responseType,{endTimeout,intervalTimeout}={})=>{const key=`pageData_${Number(Math.random().toFixed(2))*1e3}`;return code=code.replace(/%key/gim,key),eval(code),new Promise(t=>{let e=0;const i=setInterval(()=>{if(sessionStorage[key]){const a=responseType==="json"?JSON.stringify(sessionStorage[key]||{}):sessionStorage[key];e&&clearTimeout(e),clearInterval(i),delete sessionStorage[key],t(a)}},intervalTimeout||500);e=setTimeout(()=>{i&&clearInterval(i),delete sessionStorage[key],t("")},endTimeout||5e3)})}}};let _ScriptRunner=__ScriptRunner;o(_ScriptRunner,"instance");const D=class{constructor(e){this.authorization=e}static create(){return D.instance=D.instance||new D(Authorization.create()),D.instance}async updateUninstallUrl(e){const i=await this.addClientInfoToUninstallUrl(`${HOME_URL}${e!=null?e:"/extension/uninstall.php"}`);browser.runtime.setUninstallURL(i)}async addClientInfoToUninstallUrl(e){var c,u;const i=await this.authorization.getClientId(),a=this.authorization.getInstallEventId(),n=new URL(e);n.searchParams.set("cid",i),a&&n.searchParams.set("iei",a);const s=browser.runtime.getManifest();n.searchParams.set("v",s.version),n.searchParams.set("rid",browser.runtime.id);const r=new UAParser(navigator.userAgent);return n.searchParams.set("br",(c=r.getBrowser().name)!=null?c:"Unknown"),n.searchParams.set("brv",(u=r.getBrowser().version)!=null?u:"Unknown"),`${n}`}};let UninstallService=D;o(UninstallService,"instance");function deepEqual(t,e){const i=Object.keys,a=typeof t;return t&&e&&a==="object"&&a===typeof e?i(t).length===i(e).length&&i(t).every(s=>deepEqual(t[s],e[s])):t===e}var __defProp$1=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__decorateClass$1=(t,e,i,a)=>{for(var n=a>1?void 0:a?__getOwnPropDesc$1(e,i):e,s=t.length-1,r;s>=0;s--)(r=t[s])&&(n=(a?r(e,i,n):r(n))||n);return a&&n&&__defProp$1(e,i,n),n},H,p,h;let SyncInstallService=(H=class{constructor(t,e){S(this,p,{});S(this,h,{id:null,time:0});this.authorization=t,this.uninstallService=e}static create(){var t;return(t=SyncInstallService.instance)!=null||(SyncInstallService.instance=new SyncInstallService(Authorization.create(),UninstallService.create())),SyncInstallService.instance}async init(){const t=await this.getInstallKey(),e=await this.getSyncData();if(k(this,p,Object.keys(e).filter(a=>String(a).startsWith("install-")).reduce((a,n)=>(a[n]=e[n],a),{})),!l(this,p)[t]){const a=await this.authorization.getTime();this.setSyncData({[t]:a}),l(this,p)[t]=a}this.setFirstStamp(),this.monitorStorageChanges()}getInstallId(){return l(this,h).id}getInstallTime(){return l(this,h).time}async getInstallKey(){return`install-${await this.authorization.getClientId()}`}monitorStorageChanges(){browser.storage.onChanged.addListener((t,e)=>{e==="sync"&&this.onStorageChanged(t)})}setFirstStamp(){let t=null,e=0;Object.entries(l(this,p)).forEach(([a,n])=>{if(!e||n<e){const[,s]=a.split("-");e=n,t=s}});const i=l(this,h);k(this,h,{id:t,time:e}),deepEqual(i,l(this,h))||this.useNewInstallEventId()}onStorageChanged(t){let e=!1;Object.entries(t).forEach(([i,a])=>{i.startsWith("install-")&&(a==null?void 0:a.newValue)&&(l(this,p)[i]=a.newValue,e=!0)}),e&&this.setFirstStamp()}useNewInstallEventId(){this.authorization.setInstallEventId(this.getInstallId()),this.authorization.syncUser(),this.uninstallService.updateUninstallUrl()}getSyncData(){return browser.storage.sync.get(null)}setSyncData(t){return browser.storage.sync.set(t)}},p=new WeakMap,h=new WeakMap,o(H,"instance"),H);SyncInstallService=__decorateClass$1([initializable],SyncInstallService);const v=class{constructor(e,i,a,n,s){this.onInstallService=e,this.navigation=i,this.extensionClientService=a,this.syncInstallService=n,this.contentScriptInjection=s}static create(){var e;return(e=v.instance)!=null||(v.instance=new v(OnInstallService.create(),NavigationService.create(),ClientService.create(),SyncInstallService.create(),ContentScriptInjection.create())),v.instance}async onInstalled({reason:e}){switch(e){case"install":await this.onInstall();break;case"update":await this.onUpdate();break}}async onInstall(){await this.syncInstallService.init(),await this.onInstallService.trackInstall(!0,this.syncInstallService.getInstallId()),await this.extensionClientService.setClient(),(await browser.tabs.query({})).forEach(i=>{i.id&&i.url&&this.contentScriptInjection.injectGlobalScriptIntoTab({tabId:i.id,tabUrl:i.url})}),{}.VITE_SKIP_INSTALL_TABS!=="1"&&this.navigation.openPage({url:`${LANDING_PAGE}`,focused:!0,newTab:!0})}async onUpdate(){await this.extensionClientService.setClient()}};let OnInstalledHandler=v;o(OnInstalledHandler,"instance");var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(t,e,i,a)=>{for(var n=a>1?void 0:a?__getOwnPropDesc(e,i):e,s=t.length-1,r;s>=0;s--)(r=t[s])&&(n=(a?r(e,i,n):r(n))||n);return a&&n&&__defProp(e,i,n),n},V;let ConfigCreationService=(V=class{constructor(t,e,i){this.requestService=t,this.configServiceManager=e,this.extensionConfigService=i}static create(){var t;return(t=this.instance)!=null||(this.instance=new this(RequestService.create(),ConfigServiceManager.create(),ExtensionConfigService.create())),this.instance}async init(){await this.configServiceManager.init()}async check({host:t,config:e,merchantId:i}){if(await this.isDisabled())return;let a=await browser.storage.session.get("createdConfigs");if(Object.keys(a).length===0&&a.constructor===Object&&(a=[]),a!=null&&a.includes(i)||this.configServiceManager.getCaaConfigByStoreId(i))return;const s=e.url.replace(new RegExp("\\\\\\/\\\\\\/(\\(\\.\\*\\)|\\(\\[\\^\\\\\\/\\]\\*\\))","gim"),`\\/\\/(${t})`);try{await this.requestService.post(`${STORE_URL}/config`,{json:{storeId:i,refId:e.id,type:"caa",host:t,url:s}})}catch(r){}a!=null&&a.length?a.push(i):a=[i],browser.storage.session.set({createdConfigs:a})}async isDisabled(){const{[ExtensionConfigKey.CaaConfigCheckEnabled]:t}=await this.extensionConfigService.getExtensionConfigValues([ExtensionConfigKey.CaaConfigCheckEnabled]);return!t}},o(V,"instance"),V);ConfigCreationService=__decorateClass([initializable],ConfigCreationService);ActiveSession.create().init();Analytics.create().init();BrowserPopupManager.create().init();DeepLinkService.create().init();Heartbeat.create().init();IconService.create().init();SentryIO.initBrowserIntegration();SuppressionService.create().init();UserOptionsService.create().init();UninstallService.create().updateUninstallUrl();AbTestService.create().init();PageScriptInjector.registerSlickdealsWorldContentScripts();MerchantStates.create().init();SuppressionServiceCaa.create().init();browser.runtime.onInstalled.addListener(t=>OnInstalledHandler.create().onInstalled(t));var Y;((Y=browser.action)!=null?Y:browser.browserAction).onClicked.addListener(async t=>{try{await sendMessage("toggleExtensionWindow",null,`content-script@${t.id}`)}catch(e){}});onMessage("attribution",({data:t,sender:e})=>OutclickService.create().attribution({...t,tabId:e.tabId}));onMessage("couponOutclick",({data:t,sender:e})=>{OutclickService.create().couponOutclick({...t,tabId:e.tabId})});onMessage("dealOutclick",({data:t,sender:e})=>{OutclickService.create().dealOutclick({...t,tabId:e.tabId})});onMessage("shopStoreOutclick",({data:t})=>OutclickService.create().shopStoreOutclick({...t}));onMessage("getSessionStorageItem",({data:t})=>SessionStorage.create().get(t.item));onMessage("getGlobalContentScriptData",({data:t,sender:e})=>GlobalContentScriptDataFetcher.create().getData({...t,tabId:e.tabId}));onMessage("openPage",({data:t})=>{NavigationService.create().openPage(t)});onMessage("setSessionStorageItem",({data:t})=>SessionStorage.create().set(t.item,t.value));onMessage("trackEvent",({data:t,sender:e})=>{const{event:i,options:a}=t;Analytics.create().trackEvent(i,a,e.tabId)});onMessage("trackVirtualPageView",({data:t,sender:e})=>{Analytics.create().trackVirtualPageView(t.page,e.tabId)});onMessage("trackAnalytics",({data:t})=>{const{actionType:e,data:i}=t;Analytics.create().track(e,i)});onMessage("injectGlobalContentScript",async({data:t,sender:e})=>ContentScriptInjection.create().injectGlobalScriptIntoTab({frameId:e.frameId,tabId:e.tabId,tabUrl:t.url,isPrerendered:t.isPrerendered}));onMessage("refreshFrontpageDeals",()=>FrontpageDeals.create().update());onMessage("getEarlyAccessDeals",({data:t})=>{const{merchant:e}=t||{};return EarlyAccessDeals.create().update(e)});onMessage("fetchDealDetails",({data:t})=>DealDetailsService.create().fetchDealDetails(t));onMessage("setSlickdealsButtonDismissed",()=>SlickdealsButtonManager.create().setButtonDismissed());onMessage("getTrendingCouponStores",()=>TrendingCouponStores.create().update());onMessage("userInteractedWithPage",({sender:t})=>{SuppressionService.create().clearActivationForTab(t.tabId),AutoOpenTabs.create().updateAutoOpenTabInteractedWithPage(t.tabId)});onMessage("setUserAction",({data:t})=>{UserActionsService.create().set(t)});onMessage("getUserOptionValue",({data:t})=>UserOptionsService.create().getOptionKeyValue(t.key));onMessage("updateUserOption",({data:t})=>{UserOptionsService.create().updateOptionByKey(t.key,t.value)});onMessage("getExtensionConfigValue",({data:t})=>ExtensionConfigService.create().getExtensionConfigValues(t.keys));onMessage("turnOffDirectToMerchantOnboarding",({data:t,sender:e})=>{DirectToMerchantOnboardingService.create().turnOffDirectToMerchantOnboarding(t.threadUrl,e.tabId)});onMessage("getTabUrl",async({sender:t})=>{const e=TabService.create();return e.init(),e.getTabUrl(t.tabId)});onMessage("logout",()=>{Authorization.create().logout()});onMessage("initPopup",()=>PopupInitializer.create().getData());browser.runtime.onMessage.addListener(({action:t,data:e},{tab:i,frameId:a})=>{switch(t){case"siteToExtension":SiteToExtensionController.create().handleMessageFromSite(e);break;case"injectExtensionWindowVariables":PageScriptInjector.create().injectExtensionWindowVariables(i==null?void 0:i.id,a);break}});onMessage("fetchAuthInfo",()=>Authorization.create().getAuthInfo());onMessage("fetchAllUserOptions",()=>UserOptionsService.create().getAllOptions());onMessage("fetchLoyaltyUserInfo",()=>LoyaltyUserService.create().getUserInfo());onMessage("fetchLoyaltyPointsHistory",()=>LoyaltyUserService.create().getPointsHistory());onMessage("fetchMerchantById",({data:t})=>MerchantService.create().getById(t.storeId));onMessage("setLoyaltyActivationSeen",({data:t})=>LoyaltyActivationLastSeenService.create().setActivationLastSeen(t.merchantId));onMessage("shouldShowDefaultButton",({data:t})=>SlickdealsButtonManager.create().shouldShowDefaultButton(t));onMessage("sendFeedbackForm",({data:t})=>FeedbackForm.create().sendFeedbackForm(t));onMessage("setButtonCoordinates",({data:t})=>SlickdealsButtonManager.create().setButtonCoordinates(t));onMessage("getButtonCoordinates",()=>SlickdealsButtonManager.create().getButtonCoordinates());onMessage("submitSurvey",({data:t})=>SurveyService.create().sendFeedbackForm(t));onMessage("getSearchRcm",({data:t,sender:e})=>SearchRcmService.create().getSearchRcm({...t,tabId:e.tabId}));onMessage("dismissedSearchRcm",({data:t})=>{const{query:e}=t;SearchRcmService.create().hide(e)});onMessage("forwardCouponsToMerchant",({data:t})=>CouponForwarder.create().forwardCouponsToMerchant(t));onMessage("fetchUrl",({data:t})=>RequestService.create().fetchUrlMessage(t));onMessage("execCustomScript",({sender:t,data:e})=>_ScriptRunner.create().execCustomScript(e.code,e.responseType,e.timing,t.tabId));onMessage("setTrackingAllowed",({data:t})=>{AllowTrackingService.create().setTrackingAllowed(t.value),t.value&&OnInstallService.create().trackDeferredInstall()});onMessage("isGlobalContentScriptInitializable",({data:t,sender:e})=>GlobalContentScriptInitializer.create().isTabInitializable({url:t.url,tabId:e.tabId}));onMessage("checkConfigCreation",({data:t})=>{ConfigCreationService.create().check(t)});onMessage("getMerchantByUrlForSerpInjection",({data:t})=>MerchantLookupService.create().getMerchantByUrlForSerpInjection(t.url));
