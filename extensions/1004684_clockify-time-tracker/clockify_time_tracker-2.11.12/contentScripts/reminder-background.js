let reminderTimer;async function addReminderTimer(){const e=await localStorage.getItem("userId"),t=await localStorage.getItem("permanent_reminders"),r=t?JSON.parse(t).filter((t=>t.userId===e))[0]:null;if(!r||!r.enabled)return;const i=await localStorage.getItem("permanent_reminderDatesAndTimes"),a=JSON.parse(i).filter((t=>t.userId===e))[0],n=new Date,s=this.parseTimesToDates(a.timeFrom),o=this.parseTimesToDates(a.timeTo);s<n.getTime()&&n.getTime()<o&&a.dates.includes(n.getDay())&&aBrowser.alarms.create("createReminderNotification",{delayInMinutes:a.minutesSinceLastEntry})}function removeReminderTimer(){reminderTimer&&aBrowser.alarms.clear("createReminderNotification"),this.clearNotification("reminder")}function parseTimesToDates(e){const t=parseInt(e.split(":")[0]),r=parseInt(e.split(":")[1]);return new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),t,r,0)}function createReminderNotification(e,t){const r=(new Date).getTime();aBrowser.storage.local.get(["timeEntryInProgress"],(i=>{if(r>e||i.timeEntryInProgress)this.removeReminderTimer();else{const e=[{title:clockifyLocales.START_TIMER},{title:clockifyLocales.ADD_MISSING_TIME}],r={type:"basic",iconUrl:"./assets/icons/64x64.png",title:clockifyLocales.REMINDER,message:clockifyLocales.REMINDER_MESSAGE(t)};this.isChrome()&&(r.buttons=e,r.requireInteraction=!0),this.createNotification("reminder",r)}}))}function addReminderTimerOnStartingBrowser(){this.removeReminderTimer(),this.addReminderTimer()}aBrowser.alarms.onAlarm.addListener((async e=>{if("createReminderNotification"===e.name){const e=await localStorage.getItem("userId"),t=await localStorage.getItem("permanent_reminderDatesAndTimes"),r=JSON.parse(t).filter((t=>t.userId===e))[0];createReminderNotification(this.parseTimesToDates(r.timeTo),r.minutesSinceLastEntry)}})),aBrowser.runtime.onMessage.addListener(((e,t,r)=>{aBrowser.storage.local.get(["timeEntryInProgress"],(t=>{"reminder"!==e.eventName||t.timeEntryInProgress||addReminderTimer()})),"removeReminderTimer"===e.eventName&&removeReminderTimer()}));