"use strict";(self.webpackChunkchrome_extension=self.webpackChunkchrome_extension||[]).push([[53],{12354:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.displayBingOrganicSearchResultEmbeddedInfo=t.displayBingPromotedSearchResultEmbeddedInfo=void 0;var l=c(n(96540)),u=c(n(40961)),f=n(47248),d=n(32668),p=n(31229),g=n(42934),h=c(n(40549)),v=c(n(85315)),b="b_algoheader";function y(e){var t=e.getElementsByTagName("a");if((null==t?void 0:t.length)&&t[0].href)return t[0].href}t.displayBingPromotedSearchResultEmbeddedInfo=function(){return o(this,void 0,void 0,(function(){var e,t,n,o,c,d,b,m,S,k,T,I,E,C,w,O,P,B,A,D,M,_,W,x,L;return a(this,(function(a){switch(a.label){case 0:e=Array.from(document.getElementsByClassName("b_ad")),a.label=1;case 1:a.trys.push([1,13,14,15]),t=i(Array.from(e.entries())),n=t.next(),a.label=2;case 2:if(n.done)return[3,12];o=s(n.value,2),c=o[0],d=o[1],b=Array.from(d.getElementsByTagName("li")),a.label=3;case 3:a.trys.push([3,9,10,11]),x=void 0,m=i(Array.from(b.entries())),S=m.next(),a.label=4;case 4:return S.done?[3,8]:(k=s(S.value,2),T=k[0],I=k[1],(E=I.querySelector("cite"))?(C=E.innerText,[4,(0,g.getMatchingOfferForSearchResult)(C)]):[3,7]);case 5:return w=a.sent(),[4,(0,p.checkIsTemporaryUser)()];case 6:if(O=a.sent(),w&&(0,g.checkIsOfferEligibleForSearchEmbeddedInfo)(w)){if(P=(0,g.generateSearchRootElementId)("promoted",w.offerId,c+T),document.getElementById(P))return[3,7];if(B=I.querySelector("h2"),!(A=null==B?void 0:B.parentElement))return[3,7];!function(e){var t=e.rootElementId,n=e.embeddedInfoParentElement,o=e.offer,a=e.titleElement,i=e.isTemporaryUser,s=document.createElement("div");if(s.id=t,!(null==a?void 0:a.nextSibling))return;var c=y(a);if(!c)return;n.insertBefore(s,a.nextSibling),u.default.render(l.default.createElement(h.default,null,l.default.createElement(v.default,r({},{searchEngine:f.SearchEngine.bing,offer:o,redirectionLink:c,isTemporaryUser:i}))),s)}({rootElementId:P,embeddedInfoParentElement:A,offer:w,titleElement:B,isTemporaryUser:O})}a.label=7;case 7:return S=m.next(),[3,4];case 8:return[3,11];case 9:return D=a.sent(),x={error:D},[3,11];case 10:try{S&&!S.done&&(L=m.return)&&L.call(m)}finally{if(x)throw x.error}return[7];case 11:return n=t.next(),[3,2];case 12:return[3,15];case 13:return M=a.sent(),_={error:M},[3,15];case 14:try{n&&!n.done&&(W=t.return)&&W.call(t)}finally{if(_)throw _.error}return[7];case 15:return[2]}}))}))},t.displayBingOrganicSearchResultEmbeddedInfo=function(){return o(this,void 0,void 0,(function(){var e,t,n,o,c,m,S,k,T,I,E,C,w,O,P,B;return a(this,(function(a){switch(a.label){case 0:e=Array.from(document.getElementsByClassName("b_tpcn")),t=(0,d.checkIsOnMobileScreen)(),a.label=1;case 1:a.trys.push([1,7,8,9]),n=i(Array.from(e.entries())),o=n.next(),a.label=2;case 2:return o.done?[3,6]:(c=s(o.value,2),m=c[0],S=c[1],(k=S.querySelector("cite"))?(T=k.innerText,[4,(0,g.getMatchingOfferForSearchResult)(T)]):[3,5]);case 3:return I=a.sent(),[4,(0,p.checkIsTemporaryUser)()];case 4:if(E=a.sent(),I&&(0,g.checkIsOfferEligibleForSearchEmbeddedInfo)(I)){if(C=(0,g.generateSearchRootElementId)("organic",I.offerId,m),document.getElementById(C))return[3,5];if(!(w=S.parentElement))return[3,5];!function(e){var t,n=e.rootElementId,o=e.organicSearchResultElement,a=e.embeddedInfoParentElement,i=e.offer,c=e.isTemporaryUser,d=e.isOnMobileScreen,p=document.createElement("div");if(p.id=n,d){var m=a.getElementsByClassName(b);if(0===m.length)return;var S=s(m,1)[0];if(!S.nextSibling)return;if(!(t=y(S)))return;a.insertBefore(p,S.nextSibling)}else{var k=(0,g.findNextH2Element)(o);if(null==k?void 0:k.nextSibling)t=y(k),a.insertBefore(p,k.nextSibling);else{if(!(null==(k=a.querySelector("h2"))?void 0:k.nextSibling))return;if(!(t=y(k)))return;var T=k.parentElement;null==T||T.insertBefore(p,k.nextSibling)}}if(!t)return;u.default.render(l.default.createElement(h.default,null,l.default.createElement(v.default,r({},{searchEngine:f.SearchEngine.bing,offer:i,redirectionLink:t,isTemporaryUser:c}))),p)}({rootElementId:C,organicSearchResultElement:S,embeddedInfoParentElement:w,offer:I,isTemporaryUser:E,isOnMobileScreen:t})}a.label=5;case 5:return o=n.next(),[3,2];case 6:return[3,9];case 7:return O=a.sent(),P={error:O},[3,9];case 8:try{o&&!o.done&&(B=n.return)&&B.call(n)}finally{if(P)throw P.error}return[7];case 9:return[2]}}))}))}},42934:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMatchingOfferForSearchResult=t.checkIsOfferEligibleForSearchEmbeddedInfo=t.generateSearchRootElementId=t.findNextH2Element=t.getNthParentElement=t.getSearchEngineMatchingUrl=void 0;var r=n(55015),o=n(47248),a=n(17621),i=n(77653),s=n(32668);t.getSearchEngineMatchingUrl=function(e){try{var t=new URL(e),n=t.hostname,r=t.pathname,a=n.split(".");if(a.length<2||"/search"!==r)return;var i=a[a.length-2];return i in o.SearchEngine?i:void 0}catch(e){return}},t.getNthParentElement=function(e,t){for(var n=e,r=0;r<t;r++){if(!n.parentElement)return;n=n.parentElement}return n},t.findNextH2Element=function(e){for(var t=e.nextSibling;t;){if("h2"===t.tagName.toLowerCase())return t;t=t.nextSibling}return null},t.generateSearchRootElementId=function(e,t,n){var r="".concat(e,"-").concat(t,"-").concat(n);return(0,a.getHashedElementId)(a.JokoExtensionRootElement.embeddedSearchResultsInfo,r)},t.checkIsOfferEligibleForSearchEmbeddedInfo=function(e){var t,n,o,a,i,c,l,u,f=!!(null===(n=null===(t=e.browserExtension)||void 0===t?void 0:t.mobileVersion)||void 0===n?void 0:n.displayGoogleSearchResultEmbeddedInfo),d=!!(null===(a=null===(o=e.browserExtension)||void 0===o?void 0:o.desktopVersion)||void 0===a?void 0:a.displayGoogleSearchResultEmbeddedInfo),p=(0,s.checkIsOnMobileScreen)()?f:d,g=e.type===r.OfferType.Online,h=null===(c=null===(i=e.browserExtension)||void 0===i?void 0:i.bnpl)||void 0===c?void 0:c.active,v=(null===(u=null===(l=e.browserExtension)||void 0===l?void 0:l.coupons)||void 0===u?void 0:u.itemList)&&e.browserExtension.coupons.itemList.length>0;return!(!p||!(g||h||v))},t.getMatchingOfferForSearchResult=function(e){return(0,r.checkIsValidUrl)(e)?(0,i.getMerchantOfferMatchingUrlWithConditionsAndCoupons)(e):Promise.resolve(void 0)}},643:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handleEmbeddedAmazonBnplButtonsDisplay=t.AMAZON_MERCHANT_ID=void 0;var l,u=c(n(96540)),f=c(n(40961)),d=n(55015),p=c(n(40549)),g=n(46239),h=n(17621),v=n(87867),b=n(2321),y=n(77653),m=n(7444),S=c(n(61840));t.AMAZON_MERCHANT_ID="amazon",function(e){e.topButton="placeYourOrder",e.bottomButton="placeYourOrderSecondary"}(l||(l={}));function k(e,t,n){return o(this,void 0,void 0,(function(){var r,o;return a(this,(function(a){switch(a.label){case 0:return(r=document.getElementById(t))&&r.parentElement?[4,T(r,e,n)]:[2];case 1:return(o=a.sent())?[2,E(o,r.parentElement,t)]:[2]}}))}))}function T(e,t,n){return o(this,void 0,void 0,(function(){var r;return a(this,(function(i){switch(i.label){case 0:return(r=e.cloneNode(!0))instanceof HTMLElement?((0,v.traverseChildrenAndApplyHtmlElementTransformers)(r,[v.removeAllAttributesExceptClassAndUseSafeIdAndName,v.removeInputElement]),r.addEventListener("click",(function(e){return function(e,t,n){return o(this,void 0,void 0,(function(){var r;return a(this,(function(o){switch(o.label){case 0:return e.preventDefault(),e.stopImmediatePropagation(),r={fromScreen:"embeddedBnplButton",embeddedAmazonBnplButtonPosition:"topButton"===t?"top":"bottom",offerId:n},(0,g.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedPayWithJoko",payload:r}}}),(0,g.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"BNPL - Clicked Pay with Joko",properties:r}}}),[4,(0,b.checkCanDisplayCardReadyWidget)()];case 1:return o.sent()||(0,g.sendMessageToBackgroundScript)({message:"displayBnplSubscriptionWidget"}),[2]}}))}))}(e,t,n)})),r.style.marginTop="10px",[4,(0,b.checkCanDisplayCardReadyWidget)()]):[2];case 1:return i.sent()?I(r,d.colors.frenchGray):I(r,d.colors.black),[2,r]}}))}))}function I(e,t){e.style.backgroundColor=t,e.style.borderColor=t}function E(e,t,n){var o=e.querySelector("#".concat(n,"-announce-joko"));if(o){var a=document.createElement("div"),i=(0,h.getHashedElementId)(h.JokoExtensionRootElement.embeddedAmazonBnplButton,n);if(!document.getElementById(i)){a.id=i;var s=function(e){var t=document.querySelector("#payment-info"),n=function(){I(e,d.colors.frenchGray),t&&t.scrollIntoView({behavior:"smooth",block:"center"})};return n}(e);return f.default.render(u.default.createElement(p.default,null,u.default.createElement(S.default,r({},{onJokoCardReady:s}))),a),o.replaceChildren.apply(o,[a]),t.appendChild(e),!0}}}t.handleEmbeddedAmazonBnplButtonsDisplay=function(e){return o(this,void 0,void 0,(function(){var n,r,o,c,u,f,p,h,v,b,S;return a(this,(function(a){switch(a.label){case 0:return d.browserKind===d.Browser.mobileAppWebView?[2]:[4,(0,m.checkHasFeatureByPlatform)({mobileFeature:d.Feature.bnplEmbeddedAmazonBnplButtonMobileBrowserExtension})];case 1:return a.sent()?[4,(0,y.getMerchantOfferMatchingUrlWithConditionsAndCoupons)(window.location.href)]:[2];case 2:if(!(n=a.sent())||n.merchantId!==t.AMAZON_MERCHANT_ID||"/gp/buy/spc/handlers/display.html"!==e.pathname)return[2];r=new Map,a.label=3;case 3:a.trys.push([3,8,9,10]),o=i(Object.entries(l)),c=o.next(),a.label=4;case 4:return c.done?[3,7]:(u=s(c.value,2),f=u[0],p=u[1],[4,k(f,p,n.offerId)]);case 5:a.sent()&&r.set(p,!0),a.label=6;case 6:return c=o.next(),[3,4];case 7:return[3,10];case 8:return h=a.sent(),b={error:h},[3,10];case 9:try{c&&!c.done&&(S=o.return)&&S.call(o)}finally{if(b)throw b.error}return[7];case 10:return r.get(l.topButton)||r.get(l.bottomButton)?(v={offerId:n.offerId,merchantId:n.merchantId,embeddedAmazonBnplTopButtonDisplayed:!!r.get(l.topButton),embeddedAmazonBnplBottomButtonDisplayed:!!r.get(l.bottomButton)},(0,g.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionEmbeddedBnplButtonDisplayed",payload:v}}}),(0,g.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Embedded BNPL Button Displayed",properties:v}}}),[2]):[2]}}))}))}},17633:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.displayGoogleOrganicSearchResultEmbeddedInfo=t.displayGooglePromotedSearchResultEmbeddedInfo=void 0;var l=c(n(96540)),u=c(n(40961)),f=n(47248),d=n(32668),p=n(31229),g=n(42934),h=c(n(40549)),v=c(n(85315)),b=["annonce·","ad·"],y=["sponsorisé","sponsored"];function m(e){var t=e.rootElementId,n=e.embeddedInfoParentElement,o=e.offer,a=e.redirectionLink,i=e.isTemporaryUser,s=document.createElement("div");s.id=t,n.appendChild(s),u.default.render(l.default.createElement(h.default,null,l.default.createElement(v.default,r({},{searchEngine:f.SearchEngine.google,offer:o,redirectionLink:a,isTemporaryUser:i}))),s)}t.displayGooglePromotedSearchResultEmbeddedInfo=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,o,c,l,u,f,h,v,S,k,T,I,E;return a(this,(function(a){switch(a.label){case 0:e=(0,d.checkIsOnMobileScreen)()?y:b,t=Array.from(document.getElementsByTagName("span")).filter((function(t){return e.some((function(e){return e===t.innerText.toLowerCase()}))})),a.label=1;case 1:a.trys.push([1,7,8,9]),n=i(Array.from(t.entries())),r=n.next(),a.label=2;case 2:return r.done?[3,6]:(o=s(r.value,2),c=o[0],l=o[1],(u=(0,g.getNthParentElement)(l,(0,d.checkIsOnMobileScreen)()?4:3))&&(f=u.querySelector("a"))?(h=f.href,[4,(0,g.getMatchingOfferForSearchResult)(h)]):[3,5]);case 3:return v=a.sent(),[4,(0,p.checkIsTemporaryUser)()];case 4:if(S=a.sent(),v&&(0,g.checkIsOfferEligibleForSearchEmbeddedInfo)(v)){if(k=(0,g.generateSearchRootElementId)("promoted",v.offerId,c),document.getElementById(k))return[3,5];m({rootElementId:k,embeddedInfoParentElement:u,offer:v,redirectionLink:h,isTemporaryUser:S})}a.label=5;case 5:return r=n.next(),[3,2];case 6:return[3,9];case 7:return T=a.sent(),I={error:T},[3,9];case 8:try{r&&!r.done&&(E=n.return)&&E.call(n)}finally{if(I)throw I.error}return[7];case 9:return[2]}}))}))},t.displayGoogleOrganicSearchResultEmbeddedInfo=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,o,c,l,u,f,d,h,v,b,y,S;return a(this,(function(a){switch(a.label){case 0:e=Array.from(document.querySelectorAll("#rso > div").values()).map((function(e){return e.querySelector("div")})),a.label=1;case 1:a.trys.push([1,7,8,9]),t=i(Array.from(e.entries())),n=t.next(),a.label=2;case 2:return n.done?[3,6]:(r=s(n.value,2),o=r[0],(c=r[1])&&(null==(l=c.querySelector("a"))?void 0:l.parentElement)&&l.childElementCount?(u=l.href,[4,(0,g.getMatchingOfferForSearchResult)(u)]):[3,5]);case 3:return f=a.sent(),[4,(0,p.checkIsTemporaryUser)()];case 4:if(d=a.sent(),f&&(0,g.checkIsOfferEligibleForSearchEmbeddedInfo)(f)){if(h=(0,g.generateSearchRootElementId)("organic",f.offerId,o),document.getElementById(h))return[3,5];v=l.parentElement,m({rootElementId:h,embeddedInfoParentElement:v,offer:f,redirectionLink:u,isTemporaryUser:d})}a.label=5;case 5:return n=t.next(),[3,2];case 6:return[3,9];case 7:return b=a.sent(),y={error:b},[3,9];case 8:try{n&&!n.done&&(S=t.return)&&S.call(t)}finally{if(y)throw y.error}return[7];case 9:return[2]}}))}))}},86286:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.renderEmbeddedProductDiscovery=void 0;var a=o(n(96540)),i=o(n(40961)),s=n(17621),c=o(n(40549)),l=o(n(65187));t.renderEmbeddedProductDiscovery=function(e,t){var n=document.createElement("div");n.id=(0,s.getHashedElementId)(s.JokoExtensionRootElement.embeddedProductDiscoveryExperience),e.appendChild(n),i.default.render(a.default.createElement(c.default,null,a.default.createElement(l.default,r({},{userGoogleSearchQuery:t}))),n)}},17504:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.initializeEmbeddedProductDiscoveryExperience=void 0;var i=n(55015),s=n(47248),c=n(32668),l=n(74137),u=n(86286),f=n(70556),d=n(46239);t.initializeEmbeddedProductDiscoveryExperience=function(e){return r(this,void 0,void 0,(function(){var t,n,r,p,h,v,b;return o(this,(function(o){switch(o.label){case 0:return[4,g()];case 1:return t=o.sent(),function(e,t){return!(e!==s.SearchEngine.google||!(0,f.checkGoogleSearchResultsPageContainsShoppingItems)(t))}(e,t)?((0,d.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browsedToSearchResultsPageContainingShoppingItems",active:!1}}}),[4,Promise.all([(0,i.checkHasFeature)((0,c.checkIsOnMobileScreen)()?i.Feature.productDiscoveryMobileBrowserExtension:i.Feature.productDiscoveryDesktopBrowserExtension),(0,i.checkHasFeature)((0,c.checkIsOnMobileScreen)()?i.Feature.logShoppingSearchQueriesMobileBrowserExtension:i.Feature.logShoppingSearchQueriesDesktopBrowserExtension)])]):[2];case 2:return n=a.apply(void 0,[o.sent(),2]),r=n[0],p=n[1],h=(0,f.extractUserGoogleSearchQuery)(t),p&&(0,d.sendMessageToBackgroundScript)({message:"logAnonymousEvent",data:{event:{type:"searchResultsPageWithShoppingItemsDetected",payload:{userSearchQuery:h,searchEngine:"google",isProductDiscoveryEnabledForUser:r}}}}),r?h?(v=(0,f.insertRootElementForEmbeddedProductDiscoveryExperience)(t))?((0,u.renderEmbeddedProductDiscovery)(v,h),[2]):(b="Failed to insert host root element for embedded product discovery experience",console.error(b),(0,l.captureSentryException)(b),[2]):(b="Failed to extract user Google search query",console.error(b),(0,l.captureSentryException)(b),[2]):[2]}}))}))};var p={googleButtonsWithVerticalDividersSelector:'a[class="jRKCUd"]',googleProductCardsSelector:"div.njFjte, div.pla-unit-container",googleSearchQueryTextAreaSelector:"textarea",hostElementSelector:"#appbar",googleProductWebsitesResultsHeadings:["Sites de produits","Product sites"],googleResultsViewMoreButtonTexts:["View more products","Afficher plus de produits"]};function g(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,(0,i.getSetting)(i.SettingKey.productDiscoveryEmbeddedExperienceSettings)];case 1:return[2,null!=(e=t.sent())?e:p]}}))}))}},70556:function(e,t){var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.checkGoogleSearchResultsPageContainsShoppingItems=t.extractUserGoogleSearchQuery=t.insertRootElementForEmbeddedProductDiscoveryExperience=void 0,t.insertRootElementForEmbeddedProductDiscoveryExperience=function(e){var t=e.hostElementSelector;if(!t)return null;var n=document.querySelector(t);if(!n)return null;var r=document.createElement("div");return n.prepend(r),r},t.extractUserGoogleSearchQuery=function(e){var t,n;if(e.googleSearchQueryTextAreaSelector)return null!==(n=null===(t=document.querySelector(e.googleSearchQueryTextAreaSelector))||void 0===t?void 0:t.textContent)&&void 0!==n?n:void 0};t.checkGoogleSearchResultsPageContainsShoppingItems=function(e){var t,r,o,a,i,s=function(e){return(null==e?void 0:e.googleButtonsWithVerticalDividersSelector)?Array.from(document.querySelectorAll(e.googleButtonsWithVerticalDividersSelector)):[]}(e);if(s.length&&s.some((function(t){var n,r,o=null===(n=t.textContent)||void 0===n?void 0:n.trim();return o&&(null===(r=null==e?void 0:e.googleResultsViewMoreButtonTexts)||void 0===r?void 0:r.includes(o))})))return!0;try{for(var c=n(s),l=c.next();!l.done;l=c.next()){var u=l.value,f=((null===(a=null===(o=null==u?void 0:u.parentElement)||void 0===o?void 0:o.parentElement)||void 0===a?void 0:a.querySelector('div[role="heading"][aria-level="2"]'))||{}).textContent;if(f&&(null===(i=null==e?void 0:e.googleProductWebsitesResultsHeadings)||void 0===i?void 0:i.includes(f)))return!0}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}return!!function(e){return(null==e?void 0:e.googleProductCardsSelector)?document.querySelector(e.googleProductCardsSelector):null}(e)}},76372:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.handleSearchResultEmbeddedInfoDisplay=void 0;var i=n(55015),s=n(47248),c=n(7444),l=n(12354),u=n(17633);function f(){return r(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:return[4,Promise.all([(0,c.checkHasFeatureByPlatform)({mobileFeature:i.Feature.promotedSearchResultEmbeddedInfoEnabledMobileBrowserExtension,desktopFeature:i.Feature.promotedSearchResultEmbeddedInfoEnabledDesktopBrowserExtension}),(0,c.checkHasFeatureByPlatform)({mobileFeature:i.Feature.organicSearchResultEmbeddedInfoEnabledMobileBrowserExtension,desktopFeature:i.Feature.organicSearchResultEmbeddedInfoEnabledDesktopBrowserExtension})])];case 1:return e=a.apply(void 0,[r.sent(),2]),t=e[0],n=e[1],[2,{isEmbeddedInfoEnabledForPromotedResults:t,isEmbeddedInfoEnabledForOrganicResults:n}]}}))}))}t.handleSearchResultEmbeddedInfoDisplay=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(o){switch(o.label){case 0:return[4,f()];case 1:switch(t=o.sent()||{},n=t.isEmbeddedInfoEnabledForPromotedResults,r=t.isEmbeddedInfoEnabledForOrganicResults,e){case s.SearchEngine.google:return[3,2];case s.SearchEngine.bing:return[3,7]}return[3,12];case 2:return n?[4,(0,u.displayGooglePromotedSearchResultEmbeddedInfo)()]:[3,4];case 3:o.sent(),o.label=4;case 4:return r?[4,(0,u.displayGoogleOrganicSearchResultEmbeddedInfo)()]:[3,6];case 5:o.sent(),o.label=6;case 6:return[3,13];case 7:return n?[4,(0,l.displayBingPromotedSearchResultEmbeddedInfo)()]:[3,9];case 8:o.sent(),o.label=9;case 9:return r?[4,(0,l.displayBingOrganicSearchResultEmbeddedInfo)()]:[3,11];case 10:o.sent(),o.label=11;case 11:case 12:return[3,13];case 13:return[2]}}))}))}},50671:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.cancelMerchantWebsiteTrackingConsentBannerTriggeringRequestAndDisplayOfferWidget=t.handleMerchantWebsiteTrackingConsentBannerTriggeringRequest=t.checkIsMerchantWebsiteTrackingConsentBannerTriggerBeingRequested=t.disableMerchantWebsiteTrackingConsentBannerTriggerRequestMode=t.triggerMerchantWebsiteTrackingConsentBanner=t.checkHasUserGivenFullTrackingConsentOnCurrentWebsite=t.checkShouldPromptUserToRetriggerMerchantWebsiteTrackingConsentBanner=t.useMerchantWebsiteTrackingConsentBannerTriggeringInformation=void 0;var c=s(n(96540)),l=n(55015),u=n(7444),f=n(62166),d=n(67456),p=n(76688),g=n(46239),h=n(16868),v=n(72886);function b(e){var t;return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return(null===(t=null==e?void 0:e.browserExtension)||void 0===t?void 0:t.trackingConsent)?e.type!==l.OfferType.Online||!1!==e.browserExtension.trackingConsent.disableTrackingConsentBannerFlow?[2,!1]:[4,(0,u.checkHasFeatureByPlatform)({desktopFeature:l.Feature.enableTrackingConsentBannerFlowInDesktopBrowserExtension,mobileFeature:l.Feature.enableTrackingConsentBannerFlowInMobileBrowserExtension})]:[2,!1];case 1:return[2,n.sent()]}}))}))}function y(e){var t,n;return r(this,void 0,void 0,(function(){var r,a,i,s,c,l,u,f,d;return o(this,(function(o){switch(o.label){case 0:return(null===(t=null==e?void 0:e.browserExtension)||void 0===t?void 0:t.trackingConsent)?(r=e.browserExtension.trackingConsent,a=r.trackingConsentRelatedCookieOrLocalStorageIds,i=r.isTrackingConsentDataInLocalStorageInsteadOfCookies,e.browserExtension.trackingConsent.cmpId?[4,m(e.browserExtension.trackingConsent.cmpId)]:[3,2]):[2,void 0];case 1:return u=o.sent(),[3,3];case 2:u={},o.label=3;case 3:return c=(s=u).trackingConsentRelatedCookieOrLocalStorageIds,l=s.isTrackingConsentDataInLocalStorageInsteadOfCookies,f=null!==(n=null!=a?a:c)&&void 0!==n?n:void 0,d=!(!i&&!l),f?[2,{trackingConsentRelatedCookieOrLocalStorageIds:f,isTrackingConsentDataInLocalStorageInsteadOfCookies:d}]:[2,void 0]}}))}))}function m(e){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return[4,(0,d.getMerchantWebsiteTrackingConsentCmpDataSettings)()];case 1:return(null==(t=r.sent())?void 0:t[e])&&(n=t[e])?[2,{trackingConsentRelatedCookieOrLocalStorageIds:n.trackingConsentRelatedCookieOrLocalStorageIds,isTrackingConsentDataInLocalStorageInsteadOfCookies:n.isTrackingConsentDataInLocalStorageInsteadOfCookies}]:[2,{}]}}))}))}function S(){var e=localStorage.getItem(f.LAST_DETECTED_TRACKING_CONSENT_CHOICE_STORAGE_KEY);if(null!==e)return e===l.TrackingConsentChoice.acceptAll}function k(e,t){if((0,f.getUniqueElementFromSelector)(t))return!0;if(!e)return!1;var n=e.trackingConsentRelatedCookieOrLocalStorageIds,r=e.isTrackingConsentDataInLocalStorageInsteadOfCookies,o=T({cookieNames:n}),a=r?E({localStorageKeys:n}):[];return n.every((function(e){return o.includes(e)||a.includes(e)}))}function T(e){var t,n,r=e.cookieNames,o=e.shouldRemoveFoundEntries,a=new Set(document.cookie.split(";").map((function(e){return e.trim().split("=")[0]}))),s=[];try{for(var c=i(r),l=c.next();!l.done;l=c.next()){var u=l.value;a.has(u)&&(s.push(u),o&&I(u))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return s}function I(e){var t=document.domain,n=t.split(".").slice(1).join(".");document.cookie="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain=").concat(t,"; path=/;"),document.cookie="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain=").concat(n,"; path=/;")}function E(e){var t,n,r=e.localStorageKeys,o=e.shouldRemoveFoundEntries,a=[];try{for(var s=i(r),c=s.next();!c.done;c=s.next()){var l=c.value;localStorage.getItem(l)&&(a.push(l),o&&localStorage.removeItem(l))}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return a}t.useMerchantWebsiteTrackingConsentBannerTriggeringInformation=function(e){var t=this,n=e.offer,i=e.isDisplayedWithinOfferSearchTab,s=a(c.default.useState(),2),l=s[0],u=s[1];return c.default.useEffect((function(){r(t,void 0,void 0,(function(){var e,t,r,s,c,l,p,g;return o(this,(function(o){switch(o.label){case 0:return[4,Promise.all([b(n),y(n),(0,f.getMerchantWebsiteTrackingConsentSelectors)(n),(0,d.getPostCancellationDeactivationDelaySetting)()])];case 1:return e=a.apply(void 0,[o.sent(),4]),t=e[0],r=e[1],s=e[2],c=e[3],l=!(!t||!function(e,t){var n=e?e.trackingConsentRelatedCookieOrLocalStorageIds:void 0,r=t?t.consentBanner:void 0,o=t?t.acceptAllButton:void 0;return(null==n?void 0:n.length)&&!!r&&!!o}(r,s)||i||function(e){var t=Number(localStorage.getItem(P));if(!t)return!1;var n=e||B;return Date.now()-t<24*n*3600*1e3}(c)),p=s&&null!==(g=s.consentBanner)&&void 0!==g?g:void 0,u({shouldCheckConsentChoiceOnActivationClick:l,trackingConsentRelatedStorageInfo:r,consentBannerSelector:p}),[2]}}))}))}),[n,i]),l},t.checkShouldPromptUserToRetriggerMerchantWebsiteTrackingConsentBanner=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a;return o(this,(function(o){switch(o.label){case 0:return t?(n=t.shouldCheckConsentChoiceOnActivationClick,r=t.trackingConsentRelatedStorageInfo,a=t.consentBannerSelector,n?S()?[2,!1]:[4,(0,p.checkWasMerchantWebsiteTrackingConsentErrorWidgetDisplayedRecently)(e)]:[2,!1]):[2,!1];case 1:return o.sent()?[2,!1]:[2,k(r,a)]}}))}))},t.checkHasUserGivenFullTrackingConsentOnCurrentWebsite=S,t.triggerMerchantWebsiteTrackingConsentBanner=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,i;return o(this,(function(o){switch(o.label){case 0:return[4,y(e)];case 1:return t=o.sent(),e&&t?(n=t.trackingConsentRelatedCookieOrLocalStorageIds,r=t.isTrackingConsentDataInLocalStorageInsteadOfCookies,a=T({cookieNames:n,shouldRemoveFoundEntries:!0}),i=r?E({localStorageKeys:n,shouldRemoveFoundEntries:!0}):[],localStorage.setItem(C,Date.now().toString()),localStorage.removeItem(f.LAST_DETECTED_TRACKING_CONSENT_CHOICE_STORAGE_KEY),s={offerId:e.offerId,deletedCookieNames:a,deletedLocalStorageKeys:i},(0,g.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"merchantWebsiteTrackingConsentBannerTriggered",payload:s}}}),(0,g.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Merchant Website Tracking Consent Banner Triggered",properties:s}}}),window.location.reload(),[2]):[2]}var s}))}))};var C="jokoMerchantWebsiteTrackingConsentBannerTriggerRequestedAt";function w(){localStorage.removeItem(C)}function O(){var e=localStorage.getItem(C);return!!e&&Date.now()-parseInt(e)<1e4}t.disableMerchantWebsiteTrackingConsentBannerTriggerRequestMode=w,t.checkIsMerchantWebsiteTrackingConsentBannerTriggerBeingRequested=O,t.handleMerchantWebsiteTrackingConsentBannerTriggeringRequest=function(e){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return(t=e&&O())?[4,(0,p.checkWasMerchantWebsiteTrackingConsentErrorWidgetDisplayedRecently)(e.offerId)]:[3,2];case 1:t=!n.sent(),n.label=2;case 2:return t?(0,v.submitWidgetDisplayDecision)({widgetName:v.PriorityOrderedWidgetName.merchantWebsiteTrackingConsentErrorWidget,props:{offer:e},shouldDisplayWidget:!0}):(0,v.submitWidgetDisplayDecision)({widgetName:v.PriorityOrderedWidgetName.merchantWebsiteTrackingConsentErrorWidget,shouldDisplayWidget:!1}),[2]}}))}))};var P="jokoMerchantWebsiteTrackingConsentBannerTriggerCancelledAt";t.cancelMerchantWebsiteTrackingConsentBannerTriggeringRequestAndDisplayOfferWidget=function(e){var t;w(),(0,p.clearMerchantWebsiteTrackingConsentErrorWidgetTimeout)(),(0,h.displayOfferWidgetAndLogUserEvent)({offer:e,hasMerchantWebsiteTrackingConsentBannerRequestBeenCancelled:!0}),localStorage.setItem(P,Date.now().toString()),t={offerId:e.offerId},(0,g.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"merchantWebsiteTrackingConsentBannerTriggeringCancelled",payload:t}}}),(0,g.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Merchant Website Tracking Consent Banner Triggering Cancelled",properties:t}}})};var B=30},62166:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.getUniqueElementFromSelector=t.getMerchantWebsiteTrackingConsentSelectors=t.handleMerchantWebsiteTrackingConsentDetection=t.LAST_DETECTED_TRACKING_CONSENT_CHOICE_STORAGE_KEY=void 0;var i=n(55015),s=n(50671),c=n(67456),l=n(76688),u=n(46239),f=n(16868);t.LAST_DETECTED_TRACKING_CONSENT_CHOICE_STORAGE_KEY="jokoLastDetectedTrackingConsentChoice";function d(e){var t;return r(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return(null===(t=null==e?void 0:e.browserExtension)||void 0===t?void 0:t.trackingConsent)?[4,p((n=e.browserExtension.trackingConsent).cmpId)]:[2,void 0];case 1:return r=o.sent(),[2,g({trackingConsentSelectorsFromOffer:n.selectors||void 0,trackingConsentSelectorsFromCmp:r})]}}))}))}function p(e){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return e?[4,(0,c.getMerchantWebsiteTrackingConsentCmpDataSettings)()]:[2,void 0];case 1:return(null==(t=r.sent())?void 0:t[e])?[2,(n=t[e])?n.selectors:void 0]:[2,void 0]}}))}))}function g(e){var t=e.trackingConsentSelectorsFromOffer,n=e.trackingConsentSelectorsFromCmp;if(t||n)return n?t?{consentBanner:t.consentBanner||n.consentBanner,acceptAllButton:t.acceptAllButton||n.acceptAllButton,rejectAllButton:t.rejectAllButton||n.rejectAllButton,customChoiceButton:t.customChoiceButton||n.customChoiceButton}:n:t}function h(e,t,n){var r,o;try{var a=v(null!==(r=t.consentBanner)&&void 0!==r?r:void 0);if(!a)return;clearInterval(n);var c=function(e,t){var n,r,o,a=v(null!==(n=t.acceptAllButton)&&void 0!==n?n:void 0),i=!!a&&e.contains(a),s=v(null!==(r=t.rejectAllButton)&&void 0!==r?r:void 0),c=!!s&&e.contains(s),l=v(null!==(o=t.customChoiceButton)&&void 0!==o?o:void 0),u=!!l&&e.contains(l);return{acceptAllButtonElement:i?a:void 0,rejectAllButtonElement:c?s:void 0,customChoiceButtonElement:u?l:void 0}}(a,t),l=c.acceptAllButtonElement,f=c.rejectAllButtonElement,d=c.customChoiceButtonElement;o={offerId:e.offerId,wasAcceptAllButtonFound:!!l,wasRejectAllButtonFound:!!f,wasCustomChoiceButtonFound:!!d},(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"merchantWebsiteTrackingConsentBannerDetected",payload:o}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Merchant Website Tracking Consent Banner Detected",properties:o}}}),y(l,i.TrackingConsentChoice.acceptAll,e),y(f,i.TrackingConsentChoice.rejectAll,e),y(d,i.TrackingConsentChoice.customChoice,e),!l&&(0,s.checkIsMerchantWebsiteTrackingConsentBannerTriggerBeingRequested)()&&(0,s.cancelMerchantWebsiteTrackingConsentBannerTriggeringRequestAndDisplayOfferWidget)(e)}catch(e){console.error("Error while detecting tracking-consent banner and buttons: ".concat(e))}}function v(e){if(e){var t=document.querySelectorAll(e);if(1===t.length)return t[0]}}t.handleMerchantWebsiteTrackingConsentDetection=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,l,u,f;return o(this,(function(o){switch(o.label){case 0:return e?[4,Promise.all([d(e),(0,c.getMerchantWebsiteTrackingConsentBannerDetectionSettings)({defaultDetectionIntervalInMs:500,defaultDetectionAttemptsNumber:5})])]:[2];case 1:return t=a.apply(void 0,[o.sent(),2]),n=t[0],r=t[1],i=r.detectionIntervalInMs,l=r.detectionAttemptsNumber,n?(u=0,f=setInterval((function(){++u<=l?h(e,n,f):(clearInterval(f),(0,s.checkIsMerchantWebsiteTrackingConsentBannerTriggerBeingRequested)()&&(0,s.cancelMerchantWebsiteTrackingConsentBannerTriggeringRequestAndDisplayOfferWidget)(e))}),i),h(e,n,f),[2]):[2]}}))}))},t.getMerchantWebsiteTrackingConsentSelectors=d,t.getUniqueElementFromSelector=v;var b={};function y(e,n,r){if(e){var o=b[n];if(o)e.removeEventListener("click",o),e.addEventListener("click",o);else{var a=function(e,n){return function(){var r;if(localStorage.setItem(t.LAST_DETECTED_TRACKING_CONSENT_CHOICE_STORAGE_KEY,e),r={trackingConsentChoice:e,offerId:n.offerId},(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"merchantWebsiteTrackingConsentChoiceDetected",payload:r}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Merchant Website Tracking Consent Choice Detected",properties:r}}}),(0,s.checkIsMerchantWebsiteTrackingConsentBannerTriggerBeingRequested)()||(0,l.checkIsMerchantWebsiteTrackingConsentErrorWidgetMounted)()){if((0,s.disableMerchantWebsiteTrackingConsentBannerTriggerRequestMode)(),(0,l.clearMerchantWebsiteTrackingConsentErrorWidgetTimeout)(),e===i.TrackingConsentChoice.acceptAll)return(0,l.unmountMerchantWebsiteTrackingConsentErrorWidget)(),void(0,f.displayOfferWidgetAndLogUserEvent)({offer:n,hasUserJustCorrectedMerchantWebsiteTrackingConsentChoice:!0});(0,l.checkIsMerchantWebsiteTrackingConsentErrorWidgetMounted)()||(0,l.displayMerchantWebsiteTrackingConsentSuggestionWidget)({offer:n})}}}(n,r);b[n]=a,e.addEventListener("click",a)}}}},67456:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getPostCancellationDeactivationDelaySetting=t.getDelayBeforeMerchantWebsiteTrackingConsentErrorWidgetDisplayInSecondsSetting=t.getMerchantWebsiteTrackingConsentCmpDataSettings=t.getMerchantWebsiteTrackingConsentBannerDetectionSettings=void 0;var a=n(55015);t.getMerchantWebsiteTrackingConsentBannerDetectionSettings=function(e){var t=e.defaultDetectionIntervalInMs,n=e.defaultDetectionAttemptsNumber;return r(this,void 0,void 0,(function(){var e,r,i;return o(this,(function(o){switch(o.label){case 0:return[4,(0,a.getSetting)(a.SettingKey.trackingConsentSettings)];case 1:return(e=o.sent())?(r=e.consentBannerDetectionIntervalInMs?e.consentBannerDetectionIntervalInMs:t,i=e.consentBannerDetectionAttemptsNumber?e.consentBannerDetectionAttemptsNumber:n,[2,{detectionIntervalInMs:r,detectionAttemptsNumber:i}]):[2,{detectionIntervalInMs:t,detectionAttemptsNumber:n}]}}))}))},t.getMerchantWebsiteTrackingConsentCmpDataSettings=function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,(0,a.getSetting)(a.SettingKey.trackingConsentSettings)];case 1:return(null==(e=t.sent())?void 0:e.cmpData)?[2,e.cmpData]:[2,void 0]}}))}))},t.getDelayBeforeMerchantWebsiteTrackingConsentErrorWidgetDisplayInSecondsSetting=function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,(0,a.getSetting)(a.SettingKey.trackingConsentSettings)];case 1:return(null==(e=t.sent())?void 0:e.delayBeforeTrackingConsentErrorWidgetDisplayInSeconds)?[2,e.delayBeforeTrackingConsentErrorWidgetDisplayInSeconds]:[2,void 0]}}))}))},t.getPostCancellationDeactivationDelaySetting=function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,(0,a.getSetting)(a.SettingKey.trackingConsentSettings)];case 1:return(null==(e=t.sent())?void 0:e.postCancellationDeactivationDelayInDays)?[2,e.postCancellationDeactivationDelayInDays]:[2,void 0]}}))}))}},76688:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.logClickedMerchantWebsiteTrackingConsentWidgetCloseButtonEvents=t.logClickedMerchantWebsiteTrackingConsentWidgetButtonEvents=t.checkWasMerchantWebsiteTrackingConsentErrorWidgetDisplayedRecently=t.checkIsMerchantWebsiteTrackingConsentErrorWidgetMounted=t.unmountMerchantWebsiteTrackingConsentErrorWidget=t.clearMerchantWebsiteTrackingConsentErrorWidgetTimeout=t.displayMerchantWebsiteTrackingConsentErrorWidgetWithTimeout=t.displayMerchantWebsiteTrackingConsentSuggestionWidget=void 0;var s=i(n(96540)),c=i(n(40961)),l=i(n(95093)),u=n(55015),f=n(7444),d=n(17621),p=n(50671),g=n(67456),h=n(46239),v=i(n(96394)),b=i(n(8042));function y(e,t){var n=(0,u.getCurrentUrlHostname)(),r={widgetType:t,offerId:e,widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:n};(0,h.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:r}}}),(0,h.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Displayed",properties:r}}})}t.displayMerchantWebsiteTrackingConsentSuggestionWidget=function(e){return o(this,void 0,void 0,(function(){var t,n,o;return a(this,(function(a){switch(a.label){case 0:return t=(0,d.getHashedElementId)(d.JokoExtensionRootElement.merchantWebsiteTrackingConsentSuggestionWidget),(n=document.createElement("div")).id=t,document.documentElement.appendChild(n),[4,(0,f.getUserFeaturesMapWithTimeout)()];case 1:return o=a.sent(),c.default.render(s.default.createElement(u.FeaturesContextProvider,{initialUserFeaturesMap:o},s.default.createElement(b.default,r({},e))),n),y(e.offer.offerId,"merchantWebsiteTrackingConsentSuggestion"),[2]}}))}))};var m={timeoutId:void 0};function S(){return o(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,(0,g.getDelayBeforeMerchantWebsiteTrackingConsentErrorWidgetDisplayInSecondsSetting)()];case 1:return void 0===(e=t.sent())||"number"!=typeof e?[2,10]:[2,e]}}))}))}function k(){var e=(0,d.getHashedElementId)(d.JokoExtensionRootElement.merchantWebsiteTrackingConsentErrorWidget);return document.getElementById(e)}t.displayMerchantWebsiteTrackingConsentErrorWidgetWithTimeout=function(e){return o(this,void 0,void 0,(function(){var t,n,i;return a(this,(function(l){switch(l.label){case 0:return[4,S()];case 1:return-1!==(t=l.sent())&&(0,p.checkIsMerchantWebsiteTrackingConsentBannerTriggerBeingRequested)()?((0,u.updateLocalStorageItem)(u.LocalStorageKey.merchantWebsiteTrackingConsentErrorWidgetLastDisplayAtByOfferIdMap,((i={})[e.offer.offerId]=Date.now(),i)),n=setTimeout((function(){!function(e){o(this,void 0,void 0,(function(){var t,n,o;return a(this,(function(a){switch(a.label){case 0:return t=(0,d.getHashedElementId)(d.JokoExtensionRootElement.merchantWebsiteTrackingConsentErrorWidget),(n=document.createElement("div")).id=t,document.documentElement.appendChild(n),[4,(0,f.getUserFeaturesMapWithTimeout)()];case 1:return o=a.sent(),c.default.render(s.default.createElement(u.FeaturesContextProvider,{initialUserFeaturesMap:o},s.default.createElement(v.default,r({},e))),n),y(e.offer.offerId,"merchantWebsiteTrackingConsentError"),[2]}}))}))}(e),m.timeoutId=void 0}),1e3*t),m.timeoutId=n,[2]):[2]}}))}))},t.clearMerchantWebsiteTrackingConsentErrorWidgetTimeout=function(){if(m){var e=m.timeoutId;e&&(clearTimeout(e),m.timeoutId=void 0)}},t.unmountMerchantWebsiteTrackingConsentErrorWidget=function(){var e=k();null!==e&&(c.default.unmountComponentAtNode(e),e.remove())},t.checkIsMerchantWebsiteTrackingConsentErrorWidgetMounted=function(){return!!k()};t.checkWasMerchantWebsiteTrackingConsentErrorWidgetDisplayedRecently=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return[4,(0,u.getLocalStorageItem)(u.LocalStorageKey.merchantWebsiteTrackingConsentErrorWidgetLastDisplayAtByOfferIdMap)];case 1:return(null==(t=n.sent())?void 0:t[e])?[2,(0,l.default)().diff((0,l.default)(t[e]),"days")<7]:[2,!1]}}))}))},t.logClickedMerchantWebsiteTrackingConsentWidgetButtonEvents=function(e,t,n){var r={offerId:e,widgetType:t,buttonType:n};(0,h.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedMerchantWebsiteTrackingConsentWidgetButton",payload:r}}}),(0,h.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Clicked Merchant Website Tracking Consent Widget Button",properties:r}}})},t.logClickedMerchantWebsiteTrackingConsentWidgetCloseButtonEvents=function(e,t){var n={offerId:e,widgetType:t};(0,h.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:n}}}),(0,h.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Closed",properties:n}}})}},2746:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.handleSubmitHideOfferWidgetDecisionMessage=t.handleDisplayWidgetMessage=void 0;var s=n(55015),c=n(47248),l=n(14568),u=n(99556),f=n(31229),d=n(98668),p=n(23081),g=n(74617),h=n(95752),v=n(2321),b=n(59003),y=n(16868),m=n(72886);t.handleDisplayWidgetMessage=function(e){return o(this,void 0,void 0,(function(){var t,n,o,S,k,T,I,E,C,w,O,P,B,A,D,M,_;return a(this,(function(a){switch(a.label){case 0:if(!e.data)return[2];switch(e.data.widgetType){case"panelFromBrowserActionClick":return[3,1];case"offer":return[3,3];case"bnplSubscription":return[3,6];case"bnplCardReady":return[3,8]}return[3,9];case 1:return[4,Promise.all([(0,h.checkIsProductAndCheckoutWebpage)(window.location.href),(0,p.checkIsBnplSectionEnabledForOffer)(e.data.offer)])];case 2:return t=i.apply(void 0,[a.sent(),2]),n=t[0],o=n.isProductPage,S=n.isCheckoutPage,k=t[1],T=(0,l.getUserBnplTransactionsFromLocalStorage)(e.data.offer),(0,g.toggleDisplayPanelAndLogEvents)({offer:e.data.offer,userOfferActivationInfo:e.data.userOfferActivationInfo,isProductPage:o,isCheckoutPage:S,bnpl:{isBnplSectionEnabledForOffer:k,userBnplTransactionsFromLocalStorage:T},isTemporaryUser:e.data.isTemporaryUser},"nativeBrowserExtensionButton"),[3,10];case 3:return I=e.data,E=I.offer,C=I.userOfferActivationInfo,w=I.offerIdsMatchedButNotDisplayed,O=I.initialUrlHostname,P=I.offerWidgetDisplayBackgroundScriptDebuggingTimestamps,B=I.offerQueriesDebuggingInfo,A=Date.now(),E?(function(e){var t=e.offerId,n=e.offerWidgetDisplayBackgroundScriptDebuggingTimestamps,o=e.offerQueriesDebuggingInfo,a=e.displayOfferWidgetMessageReceivedTimestampInMs;(0,d.logUserEvent)({type:"displayOfferWidgetMessageReceived",active:!1,payload:r(r(r({offerId:t},n),o),{displayOfferWidgetMessageReceivedTimestampInMs:a})})}({offerId:E.offerId,offerWidgetDisplayBackgroundScriptDebuggingTimestamps:P,offerQueriesDebuggingInfo:B,displayOfferWidgetMessageReceivedTimestampInMs:A}),(0,u.triggerContentScriptOfferWidgetDisplayLogicHealthCheckAfterDelay)({offerId:E.offerId,displayOfferWidgetMessageReceivedTimestampInMs:A,initialUrlHostname:O}),[4,(0,f.checkIsTemporaryUser)()]):[2];case 4:return D=a.sent(),[4,(0,y.checkCanDisplayOfferWidget)(E)];case 5:return M=a.sent(),_=Date.now(),(0,m.submitWidgetDisplayDecision)({widgetName:m.PriorityOrderedWidgetName.offerWidget,shouldDisplayWidget:M,props:{offer:E,userOfferActivationInfo:C},additionalPayload:{offerIdsMatchedButNotDisplayed:w,isTemporaryUser:D,offerWidgetDisplayBackgroundScriptDebuggingTimestamps:P,offerQueriesDebuggingInfo:B,displayOfferWidgetMessageReceivedTimestampInMs:A,offerWidgetDisplayDecisionSubmittedTimestampInMs:_}}),function(e){var t=e.offerId,n=e.shouldDisplayWidget,o=e.offerWidgetDisplayBackgroundScriptDebuggingTimestamps,a=e.offerQueriesDebuggingInfo,i=e.displayOfferWidgetMessageReceivedTimestampInMs,s=e.offerWidgetDisplayDecisionSubmittedTimestampInMs;(0,d.logUserEvent)({type:"offerWidgetDisplayDecisionSubmitted",active:!1,payload:r(r(r({offerId:t,shouldDisplayWidget:n},o),a),{displayOfferWidgetMessageReceivedTimestampInMs:i,offerWidgetDisplayDecisionSubmittedTimestampInMs:s})})}({offerId:E.offerId,shouldDisplayWidget:M,offerWidgetDisplayBackgroundScriptDebuggingTimestamps:P,offerQueriesDebuggingInfo:B,displayOfferWidgetMessageReceivedTimestampInMs:A,offerWidgetDisplayDecisionSubmittedTimestampInMs:_}),[3,10];case 6:return e.data.offer?[4,(0,s.checkHasFeature)(s.Feature.shouldUseFactorizedBnplSubscriptionWidgetIntoPanelInExtensions)]:[2];case 7:return a.sent()?((0,g.displayPanelAndLogEvents)({offer:e.data.offer,userOfferActivationInfo:void 0,isProductPage:!1,isCheckoutPage:!1,isTemporaryUser:!1,defaultPanelLocationOverride:{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.bnpl},bnpl:{isBnplSectionEnabledForOffer:!0,shouldOpenBnplSubscription:!0}},"bnplButton"),[3,10]):((0,b.displayBnplSubscriptionWidget)({offer:e.data.offer}),[3,10]);case 8:return e.data.userBnplTransactionCreatedAt&&e.data.offer?((0,v.displayBnplCardReadyWidget)(e.data.offer,e.data.userBnplTransactionCreatedAt),[3,10]):[2];case 9:return console.log("Unexpected widget type:",e.data),[3,10];case 10:return[2]}}))}))},t.handleSubmitHideOfferWidgetDecisionMessage=function(){(0,m.submitWidgetDisplayDecision)({widgetName:m.PriorityOrderedWidgetName.offerWidget,shouldDisplayWidget:!1})}},81082:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sendMessageThroughPort=t.setContentScriptPortMessageListener=void 0;var r=n(22831),o=chrome.runtime.connect({name:"contentScriptPort|".concat(Date.now())});t.setContentScriptPortMessageListener=function(){var e=function(e){var t=a.get(e.messageId);null==t||t(e.response),a.delete(e.messageId)};o.onMessage.removeListener(e),o.onMessage.addListener(e)};var a=new Map;t.sendMessageThroughPort=function(e,t){var n=(0,r.v4)();t&&a.set(n,t),o.postMessage({messageId:n,message:e})}},92134:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setMessageListener=void 0;var r=n(74137),o=n(66499),a=n(2746),i=n(84009),s=n(58873);t.setMessageListener=function(){var e=(0,r.withSentry)((function(e,t,n){switch(e.message){case"urlChange":e.newUrl&&(0,i.handleUrlChangeMessage)(e.newUrl);break;case"displayWidget":(0,a.handleDisplayWidgetMessage)(e);break;case"getWebAppLoginInfo":(0,o.handleGetWebAppLoginInfoMessage)();break;case"openLinkInIframe":(0,s.handleOpenLinkInIframeMessage)(e,n);break;case"submitHideOfferWidgetDecision":(0,a.handleSubmitHideOfferWidgetDecisionMessage)();break;case"pingContentScriptFromBackgroundScript":n("pingBackgroundScriptFromContentScript")}return!0}));chrome.runtime.onMessage.removeListener(e),chrome.runtime.onMessage.addListener(e)}},46239:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sendMessageToBackgroundScript=void 0;var i=a(n(2543)),s=n(55015),c=n(25841),l=n(81082);t.sendMessageToBackgroundScript=function(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,f()];case 1:return n.sent()?(0,l.sendMessageThroughPort)(e,t):chrome.runtime.sendMessage(e,{},(function(e){return null==t?void 0:t(e)})),[2]}}))}))};var u=["17.3","17.4","17.5"],f=i.default.once((function(){return r(void 0,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return s.browserKind!==s.Browser.safari?[2,!1]:(e=(0,c.getSafariMajorAndMinorOsVersion)())&&u.some((function(t){return e.startsWith(t)}))?[4,(0,s.getLocalStorageItem)(s.LocalStorageKey.userFeaturesMap)]:[2,!1];case 1:return[2,!!(null==(t=n.sent())?void 0:t[s.Feature.sendMessagesThroughPortMobileBrowserExtension])]}}))}))}))},84009:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.handleUrlChangeMessage=void 0;var i=n(55015),s=n(14568),c=n(31814),l=n(40334),u=n(70992),f=n(99556),d=n(17621),p=n(77653),g=n(38542),h=n(74137),v=n(68134),b=n(31229),y=n(643),m=n(50671),S=n(62166),k=n(46239),T=n(18478),I=n(23081),E=n(74617),C=n(5883),w=n(8207),O=n(98444),P=n(59039),B=n(14997),A=n(20994),D=n(22794),M=n(29491),_=n(52852),W=n(10518),x=n(75614),L=n(13279),F=n(37790),R=n(18989),U=n(72886);t.handleUrlChangeMessage=function(e){return r(this,void 0,void 0,(function(){var t,n,N,H,j,G,K,J,q,z,Q,V;return o(this,(function(Y){switch(Y.label){case 0:return t=Date.now(),[4,(0,u.checkIsSignedIn)()];case 1:return Y.sent()?(function(e){var t=e.urlChangeMessageReceivedTimestampInMs;(0,k.sendMessageToBackgroundScript)({message:"handleOfferWidgetDisplay",data:{urlChangeMessageReceivedTimestampInMs:t,handleOfferWidgetDisplayMessageSentTimestampInMs:Date.now()}})}({urlChangeMessageReceivedTimestampInMs:t}),(0,f.logUrlChangeMessageHandledUserEventForSpecificHostnames)(e),(0,l.blockRedirectsToMerchantApps)(),[4,(0,p.getMerchantOfferMatchingUrlWithConditionsAndCoupons)(e)]):[2];case 2:return function(e){if(!e)return void(0,U.submitWidgetDisplayDecision)({widgetName:U.PriorityOrderedWidgetName.alternativeOffersWidget,shouldDisplayWidget:!1});(0,D.basicChecksCanDisplayAlternativeOffersWidget)(e)||(0,U.submitWidgetDisplayDecision)({widgetName:U.PriorityOrderedWidgetName.alternativeOffersWidget,shouldDisplayWidget:!1})}(n=Y.sent()),[4,(0,p.getUserOfferActivationInfo)(n)];case 3:return N=Y.sent(),(0,m.handleMerchantWebsiteTrackingConsentBannerTriggeringRequest)(n),(0,S.handleMerchantWebsiteTrackingConsentDetection)(n),function(e,t){if(!t)return;try{(0,T.logChangedUrlUserEventForNonAffiliateOnlineOffers)(t,e),(0,k.sendMessageToBackgroundScript)({message:"compareOfferActivatedUrlChangePayload",data:{offer:t,url:e}}),(0,c.handlePostLoadingAdBlockerDetection)(t),(0,w.handleThirdPartyExtensionsDetection)(e,t),(0,O.handleThirdPartyLinkLoadingDetection)(e,t)}catch(e){console.error(e),(0,h.captureSentryException)(e)}}(e,n),[4,(0,b.checkIsTemporaryUser)()];case 4:return H=Y.sent(),function(e){var t=e.url,n=e.offer,i=e.userOfferActivationInfo,s=e.isTemporaryUser,c=e.urlChangeMessageReceivedTimestampInMs;r(this,void 0,void 0,(function(){var e,r,l,u,f,d,p;return o(this,(function(o){switch(o.label){case 0:return[4,(0,U.checkShouldPrioritizeAutoCouponsWidgetOverCashbackReminderWidget)()];case 1:return o.sent(),n?[4,Promise.all([(0,P.checkIsCartWebpageAndGetMatchData)(t),(0,B.checkIsCheckoutWebpageAndGetMatchData)(t)])]:((0,U.submitWidgetDisplayDecision)({widgetName:U.PriorityOrderedWidgetName.cashbackReminderWidget,shouldDisplayWidget:!1}),(0,U.submitWidgetDisplayDecision)({widgetName:U.PriorityOrderedWidgetName.cashbackReactivationAtCheckoutWidget,shouldDisplayWidget:!1}),(0,U.submitWidgetDisplayDecision)({widgetName:U.PriorityOrderedWidgetName.bnplSuggestionAtCheckoutWidget,shouldDisplayWidget:!1}),[2]);case 2:if(e=a.apply(void 0,[o.sent(),2]),r=e[0],l=r.isCartWebpage,u=r.matchData,f=e[1],d=f.isCheckoutWebpage,p=f.matchData,l&&(0,P.logBrowsedToCartWebpageEvents)({webpageUrl:t,matchData:u,offerId:n.offerId,urlChangeMessageReceivedTimestampInMs:c}),d&&(0,B.logBrowsedToCheckoutWebpageEvents)({webpageUrl:t,matchData:p,offerId:n.offerId,urlChangeMessageReceivedTimestampInMs:c}),(0,W.handleCashbackReminderWidgetDisplayDecision)({isCartOrCheckoutWebpage:l||d,offer:n,userOfferActivationInfo:i,isTemporaryUser:s}),(0,_.handleCashbackReactivationAtCheckoutWidgetDisplayDecision)({isCartOrCheckoutWebpage:l||d,offer:n,userOfferActivationInfo:i,isTemporaryUser:s}),(0,M.handleBnplSuggestionAtCheckoutWidgetDisplayDecision)({isCheckoutWebpage:d,offer:n}),d&&!s)try{(0,y.handleEmbeddedAmazonBnplButtonsDisplay)(new URL(t))}catch(e){console.error("Failed to handle embedded Amazon BNPL buttons display:",e)}return[2]}}))}))}({url:e,offer:n,userOfferActivationInfo:N,isTemporaryUser:H,urlChangeMessageReceivedTimestampInMs:t}),(0,A.handlePaymentConfirmationWebpage)(e,n),(0,x.handleCashbackTrackingLostWidgetDisplay)(n,H,N),[4,Promise.all([(0,I.checkIsBnplSectionEnabledForOffer)(n),(0,i.checkHasFeature)(i.Feature.bnplNewCardReadyDisplayInExtensions),(0,i.getLocalStorageItem)(i.LocalStorageKey.unfinishedBnplSubscriptionStateByTabIdMap),(0,v.getTabId)(),(0,i.checkHasFeature)(i.Feature.resumeUnfinishedBnplSubscriptionOnUrlChange),(0,i.checkHasFeature)(i.Feature.shouldUseFactorizedBnplSubscriptionWidgetIntoPanelInExtensions)])];case 5:return j=a.apply(void 0,[Y.sent(),6]),G=j[0],K=j[1],J=j[2],q=j[3],z=j[4],Q=j[5],n&&G&&K&&(0,s.handleRefreshUserBnplTransactionsInLocalStorage)(n.offerId),Z=(0,d.getHashedElementId)(d.JokoExtensionRootElement.bnplSubscriptionWidget),(X=document.getElementById(Z))&&X.remove(),V=(0,s.handleUnfinishedBnplSubscription)({offer:n,unfinishedBnplSubscriptionStateByTabIdMap:J,tabId:q,isResumptionOfUnfinishedBnplSubscriptionOnUrlChangeEnabled:z,shouldUseFactorizedBnplSubscriptionWidgetIntoPanel:Q}),function(e,t,n,a,i){r(this,void 0,void 0,(function(){var r;return o(this,(function(o){switch(o.label){case 0:return i?[2]:(r=null!==(0,E.getPanelElement)(),[4,(0,R.checkShouldDisplaySideButtonOnWebpage)(e,t)]);case 1:return o.sent()&&!r&&(0,R.displaySideButton)({webpageUrl:e,offer:t,userOfferActivationInfo:n,isTemporaryUser:a}),[2]}}))}))}(e,n,N,H,V),function(e,t,n){r(this,void 0,void 0,(function(){var r;return o(this,(function(o){switch(o.label){case 0:return e?[4,(0,D.checkCanDisplayAlternativeOffersWidget)(e)]:((0,U.submitWidgetDisplayDecision)({widgetName:U.PriorityOrderedWidgetName.alternativeOffersWidget,shouldDisplayWidget:!1}),[2]);case 1:return r=o.sent(),(0,U.submitWidgetDisplayDecision)({widgetName:U.PriorityOrderedWidgetName.alternativeOffersWidget,shouldDisplayWidget:r,props:{currentWebpageOffer:e,userOfferActivationInfo:t},additionalPayload:{isTemporaryUser:n}}),[2]}}))}))}(n,N,H),i.browserKind===i.Browser.mobileAppWebView&&(0,g.listenToMobileAppBrowserDisplayPanelMessages)(n,N,G,H),function(e,t,n){r(this,void 0,void 0,(function(){var r;return o(this,(function(o){switch(o.label){case 0:return[4,(0,C.throttledHandleProductDataSynchronization)({browsedWebpageUrl:t,isTemporaryUser:n,offerId:e?e.offerId:void 0,merchantId:e?e.merchantId:void 0})];case 1:return r=o.sent(),(0,L.handlePriceComparisonFeedbackWidgetDisplayDecision)({currentWebpageOffer:e,currentWebpageUrl:t,currentWebpageProductDataSynchronizationResult:r}),(0,F.handlePriceComparisonWidgetDisplayDecision)({currentWebpageOffer:e,currentWebpageUrl:t,currentWebpageProductDataSynchronizationResult:r}),[2]}}))}))}(n,e,H),[2]}var Z,X}))}))}},22991:function(e,t,n){var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useOnClickAlternativeOffer=t.useAlternativeOffers=void 0;var a=o(n(96540)),i=n(55015),s=n(77653),c=n(46239),l=n(89710),u=n(23081);t.useAlternativeOffers=function(e){var t=r(a.default.useState(void 0),2),n=t[0],o=t[1];return a.default.useEffect((function(){e.length&&(0,s.getMerchantOffersWithConditionsAndCouponsFromOfferIds)(e).then(o)}),[]),n},t.useOnClickAlternativeOffer=function(e){var t=e.currentWebpageOfferId,n=e.userInterfaceComponentInteractionEventType;return function(e){switch(e.type){case i.OfferType.Online:(0,c.sendMessageToBackgroundScript)({message:"openUniversalOnlineOfferActivationInterstitial",data:{offerId:e.offerId,shouldOpenInCurrentTab:!1,triggeringEventType:n}});break;case i.OfferType.OneTime:if(!e.website)return;(0,l.handleUserInterfaceComponentInteractionInBackgroundOrLoadTrackingLink)({offer:e,triggeringEventType:n}),(0,u.logClickedWebsiteLinkEvents)(e.offerId),window.open(e.website,"_blank")}var r=n===i.UserInterfaceComponentInteractionEventType.alternativeOffersWidgetBrowsedAlternativeOffer?"alternativeOffersWidget":"panelAlternativeOffersSection";!function(e){var t=e.currentWebpageOfferId,n=e.alternativeOfferId,r=e.fromComponent,o={currentWebpageOfferId:t,alternativeOfferId:n,fromComponent:r};(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedAlternativeOffer",payload:o}}}),(0,c.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Offers - Clicked Alternative Offer",properties:o}}})}({currentWebpageOfferId:t,alternativeOfferId:e.offerId,fromComponent:r})}}},4135:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useOnClickSnoozeCashbackNotActivatedIndicator=t.checkWasCashbackNotActivatedIndicatorSnoozedRecentlyForOffer=t.useCashbackNotActivatedIndicator=void 0;var c=s(n(96540)),l=n(55015),u=n(46239),f=n(98444);t.useCashbackNotActivatedIndicator=function(e){var t=e.isMobileExtension,n=e.offerId,r=e.offerType,o=e.isOfferActivated,a=i(c.default.useState(!1),2),s=a[0],u=a[1],d=(0,l.useHasFeatureByPlatform)({isMobileExtension:t,desktopFeature:l.Feature.sideButtonRedBadgeForNotActivatedCashbackDesktopBrowserExtension,mobileFeature:l.Feature.sideButtonRedBadgeForNotActivatedCashbackMobileBrowserExtension}),g=i(c.default.useState(!1),2),h=g[0],v=g[1];c.default.useEffect((function(){p(n).then(v)}),[n]);var b=(0,f.useWasCashbackOfferActivationOverriddenByCompetitorRecently)(n);return c.default.useEffect((function(){u(d&&r===l.OfferType.Online&&!h&&(!1===o||b))}),[d,o,r,b]),{shouldDisplayCashbackNotActivatedIndicator:s,setShouldDisplayCashbackNotActivatedIndicator:u}};var d=24;function p(e){var t;return o(this,void 0,void 0,(function(){var n,r;return a(this,(function(o){switch(o.label){case 0:return e?[4,(0,l.getLocalStorageItem)(l.LocalStorageKey.cashbackNotActivatedIndicatorLastSnoozedAtByOfferIdMap)]:[2,!1];case 1:return n=o.sent(),[4,(0,l.getSetting)(l.SettingKey.cashbackNotActivatedIndicatorDisplayCooldownInHours)];case 2:return r=null!==(t=o.sent())&&void 0!==t?t:d,[2,!!((null==n?void 0:n[e])&&Date.now()-n[e]<36e5*r)]}}))}))}t.checkWasCashbackNotActivatedIndicatorSnoozedRecentlyForOffer=p,t.useOnClickSnoozeCashbackNotActivatedIndicator=function(e,t){var n=this;return function(){return o(n,void 0,void 0,(function(){var n,o;return a(this,(function(a){switch(a.label){case 0:return t(!1),[4,(0,l.getLocalStorageItem)(l.LocalStorageKey.cashbackNotActivatedIndicatorLastSnoozedAtByOfferIdMap)];case 1:return n=a.sent(),[4,(0,l.setLocalStorageItem)(l.LocalStorageKey.cashbackNotActivatedIndicatorLastSnoozedAtByOfferIdMap,r(r({},n),(o={},o[e]=Date.now(),o)))];case 2:return a.sent(),(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"snoozedCashbackNotActivatedIndicator",payload:{offerId:e}}}}),[2]}}))}))}}},18478:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.logChangedUrlUserEventForNonAffiliateOnlineOffers=void 0;var a=n(55015),i=n(7444),s=n(46239);t.logChangedUrlUserEventForNonAffiliateOnlineOffers=function(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,(0,i.checkHasFeatureByPlatform)({desktopFeature:a.Feature.shouldLogChangedUrlEventInTheDesktopExtension,mobileFeature:a.Feature.shouldLogChangedUrlEventInTheMobileSafariExtension})];case 1:return n.sent()&&e&&e.type===a.OfferType.Online&&!e.matchToAffiliateTransaction&&(0,s.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"changedURL",payload:{offerId:e.offerId,URL:t}}}}),[2]}}))}))}},69568:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CASHBACK_ACTIVATION_ANIMATION_DURATION_IN_MS=t.displayOfferActivationInterstitial=t.checkWasOfferActivatedRecentlyFromLocalOrSessionStorage=t.useOfferActivationState=t.useOfferActivationButtonState=t.LOADING_INDICATOR_DISPLAY_TIME_IN_MS=t.OFFER_ACTIVATION_DURATION_HOURS=void 0;var c=s(n(96540)),l=s(n(40961)),u=n(55015),f=n(37392),d=n(17621),p=n(32668),g=n(50671),h=n(76688),v=n(46239),b=n(89710),y=n(32221),m=s(n(40549)),S=s(n(97599));t.OFFER_ACTIVATION_DURATION_HOURS=1,t.LOADING_INDICATOR_DISPLAY_TIME_IN_MS=1e3;var k="jokoLastOfferActivationInCurrentSessionTimestampInMs";function T(e){var t=this,n=e.offer,r=e.shouldUpdateStateOnJokoOfferActivatedDomEvent,s=e.shouldSyncWithWebpageSessionStorage,l=i(c.default.useState(void 0),2),u=l[0],d=l[1];return c.default.useEffect((function(){if(n){o(t,void 0,void 0,s?function(){return a(this,(function(e){switch(e.label){case 0:return[4,I(n)];case 1:return e.sent()?d(!0):d(!1),[2]}}))}:function(){return a(this,(function(e){switch(e.label){case 0:return[4,E(n)];case 1:return e.sent()?d(!0):d(!1),[2]}}))})}}),[n]),c.default.useEffect((function(){if(r){var e=(0,f.setJokoDomEventListener)(f.JokoDomEvent.onOfferActivated,(function(e){var t=e.offerId;(null==n?void 0:n.offerId)===t&&d(!0)}));return function(){return(0,f.removeJokoDomEventListener)(f.JokoDomEvent.onOfferActivated,e)}}}),[]),{isOfferActivated:u,setIsOfferActivated:d}}function I(e,n){return o(this,void 0,void 0,(function(){var r;return a(this,(function(o){switch(o.label){case 0:return e?(r=function(e){var n=sessionStorage.getItem(k),r=n?Number(n):void 0,o=null!=e?e:36e5*t.OFFER_ACTIVATION_DURATION_HOURS;if(r&&Date.now()-r<o)return!0}(n),r?[3,2]:[4,E(e,n)]):[2,!1];case 1:r=o.sent(),o.label=2;case 2:return r?[2,!0]:[2,!1]}}))}))}function E(e,n){return o(this,void 0,void 0,(function(){var r,o;return a(this,(function(a){switch(a.label){case 0:return e?[4,(0,u.getLocalStorageItem)(u.LocalStorageKey.offerActivatedInSessionTimestampMsMap)]:[2,!1];case 1:return(null==(r=a.sent())?void 0:r[e.offerId])?(o=null!=n?n:36e5*t.OFFER_ACTIVATION_DURATION_HOURS,Date.now()-r[e.offerId]<o?[2,!0]:[2,!1]):[2,!1]}}))}))}function C(e){var t=e.offer,n=e.onCloseOfferActivationInterstitial,o=e.shouldAcknowledgeCookieWarning,a=document.createElement("div");a.id=(0,d.getHashedElementId)(d.JokoExtensionRootElement.offerCashbackActivationInterstitial),document.documentElement.appendChild(a),l.default.render(c.default.createElement(m.default,null,c.default.createElement(S.default,r({},{offer:t,shouldAcknowledgeCookieWarning:o},{onClose:function(){null==n||n(),a.remove()}}))),a)}t.useOfferActivationButtonState=function(e){var n=this,r=e.offer,s=e.userInterfaceComponentInteractionEventType,l=e.isDisplayedWithinOfferSearchTab,d=e.isBrowsingCurrentWebpageOffer,m=e.closeWidgetOrPanel,S=e.wasCashbackActivationOverriddenByThirdParty,I=e.isWidgetOpenedAfterMerchantWebsiteTrackingConsentFlow,E=(0,p.checkIsOnMobileScreen)(),O=(0,u.useHasFeatureByPlatform)({isMobileExtension:E,mobileFeature:u.Feature.cashbackActivationAnimation1BDesktopBrowserExtension,desktopFeature:u.Feature.cashbackActivationAnimation1BDesktopBrowserExtension}),P=function(e){var n=e.offer,r=e.userInterfaceComponentInteractionEventType,o=e.isDisplayedWithinOfferSearchTab,a=e.closeWidgetOrPanel,s=e.wasCashbackActivationOverriddenByThirdParty,l=e.isWidgetOpenedAfterMerchantWebsiteTrackingConsentFlow,f=T({offer:n,shouldSyncWithWebpageSessionStorage:!0}),d=f.isOfferActivated,p=f.setIsOfferActivated,g=i(c.default.useState(!1),2),h=g[0],v=g[1],b=function(){o||(sessionStorage.setItem(k,Date.now().toString()),v(!0))},y=c.default.useMemo((function(){var e=sessionStorage.getItem(k);if(e&&!o)return Number(e)}),[h,d]);return c.default.useEffect((function(){var e;return h&&(e=setTimeout((function(){v(!1),p(!0)}),t.LOADING_INDICATOR_DISPLAY_TIME_IN_MS-(y?Date.now()-y:0))),function(){e&&clearTimeout(e)}}),[h,y]),c.default.useEffect((function(){var e;return h||!d||s||l||(e=setTimeout((function(){r!==u.UserInterfaceComponentInteractionEventType.offerWidgetActivateButton&&r!==u.UserInterfaceComponentInteractionEventType.cashbackReminderWidgetActivateButton||null==a||a()}),1e3)),function(){e&&clearTimeout(e)}}),[h,d]),c.default.useEffect((function(){h||d||!y||s||(Date.now()-y<t.LOADING_INDICATOR_DISPLAY_TIME_IN_MS?v(!0):Date.now()-y<36e5*t.OFFER_ACTIVATION_DURATION_HOURS&&p(!0))}),[y,h,h]),{isOfferActivated:d,isOfferActivationButtonLoading:h,recordOfferActivationInCurrentSession:b}}({offer:r,userInterfaceComponentInteractionEventType:s,isDisplayedWithinOfferSearchTab:l,closeWidgetOrPanel:m,wasCashbackActivationOverriddenByThirdParty:S,isWidgetOpenedAfterMerchantWebsiteTrackingConsentFlow:I}),B=P.isOfferActivated,A=P.isOfferActivationButtonLoading,D=P.recordOfferActivationInCurrentSession,M=(0,g.useMerchantWebsiteTrackingConsentBannerTriggeringInformation)({offer:r,isDisplayedWithinOfferSearchTab:l}),_=c.default.useMemo((function(){return(0,g.checkHasUserGivenFullTrackingConsentOnCurrentWebsite)()}),[]),W=(0,b.useShouldUseBackgroundAffiliateLinkLoading)({offer:r,userInterfaceComponentInteractionEventType:s}),x=W.shouldUseBackgroundAffiliateLinkLoading,L=W.shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoading;return{isOfferActivationButtonLoading:A,isOfferActivated:B,onClickActivateOffer:function(){return o(n,void 0,void 0,(function(){var e,n,o,i,c;return a(this,(function(a){switch(a.label){case 0:return r?(e=r.offerId,p={offerId:e,from:s},(0,v.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedActivateOffer",payload:p}}}),(0,v.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Clicked Activate Offer",properties:p}}}),(0,f.sendJokoDomEvent)(f.JokoDomEvent.onOfferActivated,{offerId:e}),u.browserKind!==u.Browser.mobileAppWebView?[3,1]:(null===(c=null===(i=window.ReactNativeWebView)||void 0===i?void 0:i.postMessage)||void 0===c||c.call(i,JSON.stringify({messageId:"activateOffer"})),[3,8])):[2];case 1:return[4,(0,g.checkShouldPromptUserToRetriggerMerchantWebsiteTrackingConsentBanner)(e,M)];case 2:return a.sent()?(null==m||m(),(0,h.displayMerchantWebsiteTrackingConsentSuggestionWidget)({offer:r}),(0,b.activateOfferInBackground)({offerId:e,userInterfaceComponentInteractionEventType:s,shouldNotRememberOfferActivation:!0,shouldForceAffiliateLinkLoading:S}),[3,8]):[3,3];case 3:return!l&&A?[3,8]:(D(),!x||l&&!d?[3,7]:((0,b.activateOfferInBackground)({offerId:e,userInterfaceComponentInteractionEventType:s,shouldNotRememberOfferActivation:!1,shouldForceAffiliateLinkLoading:S}),L?(n=C,o={offer:r},[4,(0,u.getLocalStorageUserState)(u.UserStateKey.hasAcknowledgedWarningForCookieTracking)]):[3,5]));case 4:return n.apply(void 0,[(o.shouldAcknowledgeCookieWarning=!a.sent()&&!_,o)]),[3,6];case 5:O&&function(e){var n=e.offerId,r=e.closeWidgetOrPanel;null==r||r(),setTimeout((function(){return(0,f.sendJokoDomEvent)(f.JokoDomEvent.startSideButtonCashbackActivationAnimation,{})}),w),setTimeout((function(){return(0,y.displayCashbackActivationConfirmationWidget)(n)}),w+t.CASHBACK_ACTIVATION_ANIMATION_DURATION_IN_MS)}({closeWidgetOrPanel:m,offerId:e}),a.label=6;case 6:return[3,8];case 7:(0,b.activateOfferWithOnlineOfferActivationPage)({offerId:e,isDisplayedWithinOfferSearchTab:l,isBrowsingCurrentWebpageOffer:d,userInterfaceComponentInteractionEventType:s,hasUserGivenFullTrackingConsentOnCurrentWebsite:!!_}),a.label=8;case 8:return[2]}var p}))}))},merchantWebsiteTrackingConsentBannerTriggeringInformation:M,hasUserGivenFullTrackingConsentOnCurrentWebsite:_}},t.useOfferActivationState=T,t.checkWasOfferActivatedRecentlyFromLocalOrSessionStorage=I,t.displayOfferActivationInterstitial=C;var w=100;t.CASHBACK_ACTIVATION_ANIMATION_DURATION_IN_MS=3e3},89710:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handleUserInterfaceComponentInteractionInBackground=t.requestCardLinkedOfferNonAffiliateTrackingLinkLoading=t.handleUserInterfaceComponentInteractionInBackgroundOrLoadTrackingLink=t.activateOfferInBackground=t.activateOfferWithOnlineOfferActivationPage=t.useShouldUseBackgroundAffiliateLinkLoading=void 0;var s=i(n(96540)),c=n(55015),l=n(7444),u=n(46239);function f(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:switch(e){case c.UserInterfaceComponentInteractionEventType.offerWidgetActivateButton:return[3,1];case c.UserInterfaceComponentInteractionEventType.panelOfferDetailsTabCashbackSectionActivateButton:return[3,3]}return[3,5];case 1:return[4,d()];case 2:case 4:return[2,t.sent()];case 3:return[4,p()];case 5:return[2,{shouldUseBackgroundAffiliateLinkLoadingAppFeatureOverride:!1,shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingAppFeatureOverride:void 0}]}}))}))}function d(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,s;return o(this,(function(o){switch(o.label){case 0:return i=(r=Promise).all,s=[(0,l.checkHasFeatureByPlatform)({desktopFeature:c.Feature.offerWidgetBackgroundCashbackActivationWithInterstitialDesktopBrowserExtension,mobileFeature:c.Feature.offerWidgetBackgroundCashbackActivationWithInterstitialMobileBrowserExtension})],[4,(0,l.checkHasFeatureByPlatform)({desktopFeature:c.Feature.offerWidgetBackgroundCashbackActivationWithoutInterstitialDesktopBrowserExtension,mobileFeature:c.Feature.offerWidgetBackgroundCashbackActivationWithoutInterstitialMobileBrowserExtension})];case 1:return[4,i.apply(r,[s.concat([o.sent()])])];case 2:return e=a.apply(void 0,[o.sent(),2]),t=e[0],n=e[1],[2,{shouldUseBackgroundAffiliateLinkLoadingAppFeatureOverride:t||n,shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingAppFeatureOverride:!!t||!n&&void 0}]}}))}))}function p(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,s;return o(this,(function(o){switch(o.label){case 0:return i=(r=Promise).all,s=[(0,l.checkHasFeatureByPlatform)({desktopFeature:c.Feature.panelBackgroundCashbackActivationWithInterstitialDesktopBrowserExtension,mobileFeature:c.Feature.panelBackgroundCashbackActivationWithInterstitialMobileBrowserExtension})],[4,(0,l.checkHasFeatureByPlatform)({desktopFeature:c.Feature.panelBackgroundCashbackActivationWithoutInterstitialDesktopBrowserExtension,mobileFeature:c.Feature.panelBackgroundCashbackActivationWithoutInterstitialMobileBrowserExtension})];case 1:return[4,i.apply(r,[s.concat([o.sent()])])];case 2:return e=a.apply(void 0,[o.sent(),2]),t=e[0],n=e[1],[2,{shouldUseBackgroundAffiliateLinkLoadingAppFeatureOverride:t||n,shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingAppFeatureOverride:!!t||!n&&void 0}]}}))}))}function g(e){var t=e.offer,n=e.triggeringEventType;t&&(0,u.sendMessageToBackgroundScript)({message:"requestCardLinkedOfferNonAffiliateTrackingLinkLoading",data:{offer:t,triggeringEventType:n}})}function h(e){var t=e.offerId,n=e.triggeringEventType,r=e.shouldOpenAffiliateLinkInNewActiveTab;t&&(0,u.sendMessageToBackgroundScript)({message:"handleUserInterfaceComponentInteractionInBackground",data:{offerId:t,triggeringEventType:n,shouldOpenAffiliateLinkInNewActiveTab:r}})}t.useShouldUseBackgroundAffiliateLinkLoading=function(e){var t=this,n=e.offer,i=e.userInterfaceComponentInteractionEventType,l=a(s.default.useState(!1),2),u=l[0],d=l[1],p=a(s.default.useState(!1),2),g=p[0],h=p[1],v=function(e){var t=(0,c.useSetting)({settingKey:c.SettingKey.affiliateLinkLoadingInExtensionsSettings}),n=s.default.useMemo((function(){var n;if(e)return e.affiliatePlatformId&&(null===(n=null==t?void 0:t.perAffiliatePlatform)||void 0===n?void 0:n[e.affiliatePlatformId])?t.perAffiliatePlatform[e.affiliatePlatformId]:(null==t?void 0:t.defaultConfiguration)?t.defaultConfiguration:void 0}),[t]);return n}(n);return s.default.useEffect((function(){r(t,void 0,void 0,(function(){var e,t,r,a,s,c,l;return o(this,(function(o){switch(o.label){case 0:return n?[4,f(i)]:[2];case 1:return e=o.sent(),t=e.shouldUseBackgroundAffiliateLinkLoadingAppFeatureOverride,r=e.shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingAppFeatureOverride,a=function(e,t){var n,r,o,a;if(!e)return{};var i="boolean"==typeof(null===(r=null===(n=e.browserExtension)||void 0===n?void 0:n.affiliateLinkLoading)||void 0===r?void 0:r.shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingOverride)?e.browserExtension.affiliateLinkLoading.shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingOverride:void 0;return"object"==typeof(null===(a=null===(o=e.browserExtension)||void 0===o?void 0:o.affiliateLinkLoading)||void 0===a?void 0:a.offerActivationInteractionsWithBackgroundAffiliateLinkLoadingOverride)&&Array.isArray(e.browserExtension.affiliateLinkLoading.offerActivationInteractionsWithBackgroundAffiliateLinkLoadingOverride)?{shouldUseBackgroundAffiliateLinkLoadingOfferOverride:e.browserExtension.affiliateLinkLoading.offerActivationInteractionsWithBackgroundAffiliateLinkLoadingOverride.includes(t),shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingOfferOverride:i}:{shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingOfferOverride:i}}(n,i),s=a.shouldUseBackgroundAffiliateLinkLoadingOfferOverride,c=a.shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingOfferOverride,(t||(void 0!==s?s:null===(l=null==v?void 0:v.offerActivationInteractionsWithBackgroundAffiliateLinkLoading)||void 0===l?void 0:l.includes(i)))&&(d(!0),h(void 0!==r?r:void 0!==c?c:!!(null==v?void 0:v.shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoading))),[2]}}))}))}),[v]),{shouldUseBackgroundAffiliateLinkLoading:u,shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoading:g}},t.activateOfferWithOnlineOfferActivationPage=function(e){var t=e.offerId,n=e.isDisplayedWithinOfferSearchTab,r=e.isBrowsingCurrentWebpageOffer,o=e.userInterfaceComponentInteractionEventType,a=e.hasUserGivenFullTrackingConsentOnCurrentWebsite;(0,u.sendMessageToBackgroundScript)({message:"openUniversalOnlineOfferActivationInterstitial",data:{offerId:t,shouldOpenInCurrentTab:!n||!!r,triggeringEventType:o,shouldDisableAffiliateRedirectionMechanism:n,hasAcceptedMerchantCookies:a}})},t.activateOfferInBackground=function(e){var t=e.offerId,n=e.userInterfaceComponentInteractionEventType,r=e.shouldNotRememberOfferActivation,o=e.shouldForceAffiliateLinkLoading;t&&(0,u.sendMessageToBackgroundScript)({message:"handleUserInterfaceComponentInteractionInBackground",data:{offerId:t,triggeringEventType:n,shouldNotRememberOfferActivation:r,shouldForceAffiliateLinkLoading:o}})},t.handleUserInterfaceComponentInteractionInBackgroundOrLoadTrackingLink=function(e){var t=e.offer,n=e.triggeringEventType,r=e.shouldOpenAffiliateLinkInNewActiveTab;t&&(t.type===c.OfferType.OneTime?t.oneTimeOfferTrackingLink&&g({offer:t,triggeringEventType:n}):h({offerId:t?t.offerId:void 0,triggeringEventType:n,shouldOpenAffiliateLinkInNewActiveTab:r}))},t.requestCardLinkedOfferNonAffiliateTrackingLinkLoading=g,t.handleUserInterfaceComponentInteractionInBackground=h},67441:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkCanDisplayAlternativeOffersInPanel=void 0;var r=n(55015),o=n(32668);t.checkCanDisplayAlternativeOffersInPanel=function(e){var t,n,a,i,s;if(e.type!==r.OfferType.NoCashback||!(null===(t=e.alternativeOffersIds)||void 0===t?void 0:t.length))return!1;var c=(0,o.checkIsOnMobileScreen)();return!(c&&!(null===(a=null===(n=e.browserExtension)||void 0===n?void 0:n.mobileVersion)||void 0===a?void 0:a.displayAlternativeOffersInPanel)||!c&&!(null===(s=null===(i=e.browserExtension)||void 0===i?void 0:i.desktopVersion)||void 0===s?void 0:s.displayAlternativeOffersInPanel))}},23081:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkIsEnrichedMerchantOffer=t.logClickedWebsiteLinkEvents=t.usePriceTrackingUnavailableText=t.checkShouldDisplayPriceComparisonAlternatives=t.checkIsPriceTrackingDisabled=t.getCleanProductName=t.useCopyCoupon=t.useOfferDetailsSections=t.checkIsBnplSectionEnabledForOffer=t.useIsBnplSectionEnabledForOffer=t.useProductSaving=t.checkDidCouponsSectionFinishLoading=t.PanelCouponStartButtonStatus=t.useOfferDetailsTabContentSpecificProps=void 0;var l,u=c(n(96540)),f=n(55015),d=n(47248),p=n(14568),g=n(32668),h=n(74137),v=n(21427),b=n(46239),y=n(89710),m=n(33931),S=n(82198),k=n(86245);function T(e){var t=e.webpageUrl,n=e.productData,c=e.offer,l=e.userSavedWebpages,d=e.setUserSavedWebpages,p=e.fromComponent,g=e.isFromBrowsedProductsSection,h=(0,k.useSaveProduct)({webpageUrl:t,productData:n,offer:c,fromComponent:p,userSavedWebpages:l,setUserSavedWebpages:d}),v=h.isProductSaved,b=h.toggleIsProductSaved;return function(e,t,n,c,l,d){u.default.useEffect((function(){if(t&&c&&!d){var u=c.name,p=c.imageUrl,g=c.priceAmount,h=c.priceCurrency,v={__typename:"UserSavedWebpage",webpageUrl:l,webpageTitle:u||document.title,webpageImageUrl:p,productPriceAmount:g,productPriceCurrency:h};if(e)!function(e){var t=e.webpageUrl,n=e.currentProductSavedWebpage,c=e.userSavedWebpages,l=e.setUserSavedWebpages;o(this,void 0,void 0,(function(){var e,o;return a(this,(function(a){switch(a.label){case 0:return[4,(0,f.removeNonEssentialUrlComponents)(t)];case 1:return e=a.sent(),o=s([r(r({},n),{webpageUrl:e})],i(c.filter((function(e){return e.webpageTitle!==n.webpageTitle}))),!1),l(o),[2]}}))}))}({webpageUrl:l,currentProductSavedWebpage:v,userSavedWebpages:t,setUserSavedWebpages:n});else{var b=t.filter((function(e){return e.webpageTitle!==v.webpageTitle}));n(b)}}}),[e])}(v,l,d,n,t,g),{isProductSaved:v,toggleIsProductSaved:b}}function I(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return[4,Promise.all([(0,p.checkIsBnplEnabled)(),(0,f.checkHasFeature)(f.Feature.bnplSideButtonTabMobileBrowserExtension)])];case 1:return t=i.apply(void 0,[r.sent(),2]),n=t[0],[2,!!(t[1]&&n&&e&&e.browserExtension&&e.browserExtension.bnpl&&e.browserExtension.bnpl.active)]}}))}))}t.useOfferDetailsTabContentSpecificProps=function(e,t,n,o,a,s,c,d,p,g){var y=(0,f.useHasFeatureByPlatform)({isMobileExtension:c,desktopFeature:f.Feature.cardLinkedOfferCashbackWidgetDesktopBrowserExtension,mobileFeature:f.Feature.cardLinkedOfferCashbackWidgetMobileBrowserExtension}),k=function(e,t){var n=(0,v.useShouldSkipUnsuccessfulCouponsEnabled)(),r=(0,v.useEnrichedMerchantCoupons)(e,n),o=(0,v.useSkippedCouponsSplit)(r,n),a=o.skippedCoupons,s=o.selectedCoupons,c=(0,f.useHasFeature)(f.Feature.couponsSideButtonTabMobileBrowserExtension),d=(0,f.useHasFeatureByPlatform)({isMobileExtension:t,desktopFeature:f.Feature.showPanelStartCouponApplicationButtonInDesktopBrowserExtension,mobileFeature:f.Feature.showPanelStartCouponApplicationButtonInMobileBrowserExtension}),p=function(){var e=i(u.default.useState(void 0),2),t=e[0],n=e[1];return u.default.useEffect((function(){var e=function(e,t){return function(e,t,n){if("local"!==n)return;var r=new URL(window.location.href).hostname,o="".concat(f.LocalStorageKey.couponAutomationStateKeyPrefix).concat(r);if(!t[o])return;e(t[o].newValue.state)}(n,e,t)},t=(0,h.withSentry)(e);return chrome.storage.onChanged.addListener(t),(0,b.sendMessageToBackgroundScript)({message:"getCouponAutomationState",data:{url:window.location.href}},(function(e){n(void 0===e?{}:e)})),function(){return chrome.storage.onChanged.removeListener(t)}}),[]),t}(),g=function(e){return u.default.useMemo((function(){return e?e.passive?e.passive.stateType===f.CouponAutomationPassiveStateType.propose?l.enabled:e.passive.stateType===f.CouponAutomationPassiveStateType.init?l.inProgress:l.disabled:e.active?l.inProgress:l.done:l.disabled}),[e])}(p),y=function(e,t,n,r){return!!r&&(void 0===n?void 0:!(t&&e&&e.mobileApp&&e.mobileApp.coupons&&!1===e.mobileApp.coupons.automationActive)&&!(!t&&e&&e.browserExtension&&e.browserExtension.coupons&&!1===e.browserExtension.coupons.automationActive))}(e,t,p,d);return{offer:e,shouldSkipUnsuccessfulCouponsEnabled:n,coupons:r,skippedCoupons:a,selectedCoupons:s,isCouponsSectionEnabled:c,shouldShowStartCouponApplicationButton:y,couponAutomationState:p,panelCouponStartButtonStatus:g}}(e,c),I=function(e,t,n,o,a){var i=window.location.href,s=t?t.offerId:void 0,c=(0,S.useProductData)(i),l=c.productData,u=c.isProductDataLoaded,d=(0,f.usePriceHistory)({webpage:{webpageUrl:i,webpageTitle:document.title},offerId:s,isCurrentWebpage:!0,productDataFromCurrentWebpage:l,shouldAutomaticallyCheckAvailability:!!t,shouldFetchBlacklistedPriceTrackingDomainsFromBackend:!0}),p=d.priceHistory,g=d.isPriceHistoryAvailable,h=d.isPriceHistoryLoading,v=d.lastPrice,b=d.loadPriceHistoryAndLogEvents,y=d.isWebsiteBlacklistedForPriceTracking,k=T({webpageUrl:i,productData:l,offer:t,userSavedWebpages:o,setUserSavedWebpages:a,fromComponent:"panelOfferDetailsTabProductSection"}),I=k.isProductSaved,E=k.toggleIsProductSaved,C=function(e,t,n,r,o,a){var i=(0,m.useIsPriceComparisonEnabled)(e,o),s=(0,m.useLoadPriceComparison)({currentWebpageUrl:t,productData:n,merchantId:r,isPriceHistoryAvailable:a}).priceComparisonData,c=(0,m.useHasPriceComparisonLoadingTimedOut)(null==s?void 0:s.productAlternativesWithAssociatedOffers),l=(0,m.useShouldDisplayBestPriceTag)(n,s),u=l.wasCheaperAlternativeDetected,f=l.shouldDisplayBestPriceTagOnBrowsedProduct,d=l.shouldDisplayBestPriceTagOnCheapestAlternative;return{priceComparisonData:s,hasPriceComparisonLoadingTimedOut:c,wasCheaperAlternativeDetected:u,shouldDisplayBestPriceTagOnBrowsedProduct:f,shouldDisplayBestPriceTagOnCheapestAlternative:d,isPriceComparisonEnabled:i}}(e,i,l,null==t?void 0:t.merchantId,n,g);return r({productData:l,isProductDataLoaded:u,loadPriceHistoryAndLogEvents:b,priceHistory:p,lastPriceData:v,isWebsiteBlacklistedForPriceTracking:y,isPriceHistoryAvailable:g,isPriceHistoryLoading:h,isProductSaved:I,toggleIsProductSaved:E},C)}(s,e,c,d,p);return r(r({selectedOfferDetailsSection:o,setSelectedOfferDetailsSection:a,userOfferActivationInfo:t,shouldDisplayOnetimeOfferCashbackActivatedInfo:y,isBnplSectionEnabledForOffer:n,lastUserBnplTransactionFromBnplSubscriptionWidget:g},k),I)},function(e){e.disabled="disabled",e.enabled="enabled",e.inProgress="inProgress",e.done="done"}(l=t.PanelCouponStartButtonStatus||(t.PanelCouponStartButtonStatus={})),t.checkDidCouponsSectionFinishLoading=function(e){var t=e.shouldSkipUnsuccessfulCouponsEnabled,n=e.coupons,r=e.skippedCoupons,o=e.selectedCoupons,a=e.shouldShowStartCouponApplicationButton,i=e.couponAutomationState;return void 0!==t&&void 0!==n&&void 0!==r&&void 0!==o&&void 0!==a&&void 0!==i},t.useProductSaving=T,t.useIsBnplSectionEnabledForOffer=function(e){var t=i(u.default.useState(void 0),2),n=t[0],r=t[1];return u.default.useEffect((function(){I(e).then((function(e){return r(e)}))}),[e]),n},t.checkIsBnplSectionEnabledForOffer=I,t.useOfferDetailsSections=function(e,t){var n=(0,f.useLocalizedTexts)().contentscript.redesign.panel.offerDetails.selectorBar,r=(0,f.useUserRegion)();return[{id:f.OfferDetailsSection.cashback,displayedText:n.cashback},{id:f.OfferDetailsSection.coupons,displayedText:n.coupons},{id:f.OfferDetailsSection.product,displayedText:n.product,isHidden:t},{id:f.OfferDetailsSection.bnpl,displayedText:n.bnpl,isHidden:r!==f.Region.FR||(0,g.checkIsOnMobileScreen)()&&e}].filter((function(e){return!e.isHidden}))},t.useCopyCoupon=function(e){var t=e.coupon,n=e.currentWebpageOffer,r=i(u.default.useState(!1),2),o=r[0],a=r[1];return u.default.useEffect((function(){var e;return o&&(e=setTimeout((function(){return a(!1)}),5e3)),function(){e&&clearTimeout(e)}}),[o]),{hasBeenCopiedRecently:o,onClickCopy:function(){navigator.clipboard.writeText(t.code),o||function(e){var t=e.merchantCouponId,n={merchantCouponId:t};(0,b.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"copiedMerchantCouponCode",payload:n}}}),(0,b.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Coupons - Copied Merchant Coupon Code",properties:n}}})}(t),a(!0),(0,y.handleUserInterfaceComponentInteractionInBackgroundOrLoadTrackingLink)({offer:n,triggeringEventType:d.UserInterfaceComponentInteractionEventType.copyCouponCodeButton})}}};t.getCleanProductName=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=55),e?(e=(0,f.decodeUnicodeCharacters)(e),t&&(e=(0,f.truncateText)(e,n)),e):""},t.checkIsPriceTrackingDisabled=function(e,t){return e!==f.Region.FR||!!t||f.browserKind===f.Browser.firefox},t.checkShouldDisplayPriceComparisonAlternatives=function(e,t){return!!e&&e.length>0&&!t},t.usePriceTrackingUnavailableText=function(e){var t=e.isProductSaved,n=e.isWebsiteBlacklistedForPriceTracking,r=e.isTemporaryUser,o=(0,f.useLocalizedTexts)().contentscript.redesign.panel.offerDetails.productSection.productAvailableForWebpage.priceTracking.unavailableGraphMessage;return n?o.productFromBlacklistedDomain:t?o.productSaved:r?o.saveProduct.temporaryAccount:o.saveProduct.regularAccount},t.logClickedWebsiteLinkEvents=function(e){var t={offerId:e};(0,b.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedWebsiteLink",payload:t}}}),(0,b.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Offers - Clicked Website Link",properties:t}}})},t.checkIsEnrichedMerchantOffer=function(e){return!(!("personalizedAffiliateLink"in e)||!e.personalizedAffiliateLink)}},86263:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useSetHeaderStateInSelectedSearchResultScreen=t.useSetHeaderStateBasedOnSearchState=t.useDesignSystemOfferSearchBarFocusState=t.useIsSearchBarFocused=t.useFilteredUserOffers=t.logClickedOfferEvents=t.useOnClickSearchResult=t.useDisplayedSearchResults=t.useSelectedOfferSearchResult=t.useOfferSearchTabContentInnerState=t.useOfferSearchTabContentSpecificProps=void 0;var i=a(n(96540)),s=n(55015),c=n(19972),l=n(32668),u=n(46239),f=n(67441),d=n(23081);function p(e,t){var n={offerId:e,type:t};(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Offers - Clicked Offer",properties:n}}}),(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedOffer",payload:n}}})}function g(e){return!!e.browserExtension&&!!e.browserExtension.displayInExtensionSearch&&e.type!==s.OfferType.Ongoing}t.useOfferSearchTabContentSpecificProps=function(){var e=function(){var e=o(i.default.useState([]),2),t=e[0],n=e[1],r=function(){(0,u.sendMessageToBackgroundScript)({message:"getOffersByTags",data:{}},(function(e){n(e.offers)}))};return i.default.useEffect(r,[]),t}(),t=o(i.default.useState(void 0),2),n=t[0],r=t[1];return i.default.useEffect((function(){(0,s.getLocalStorageItem)(s.LocalStorageKey.offerBrowsingTags).then(r)}),[]),{emptyQuerySearchResults:e,offerBrowsingTags:n}},t.useOfferSearchTabContentInnerState=function(){var e=o(i.default.useState(""),2),t=e[0],n=e[1],r=o(i.default.useState(!1),2),a=r[0],s=r[1],c=o(i.default.useState(void 0),2),l=c[0],u=c[1],f=o(i.default.useState(void 0),2),d=f[0],p=f[1],g=i.default.useRef(null),h=o(i.default.useState(!1),2),v=h[0],b=h[1],y=i.default.useCallback((function(){b(!v)}),[v]);return{searchText:t,setSearchText:n,isOfferSearchActive:a,setIsOfferSearchActive:s,selectedParentBrowsingTag:l,setSelectedParentBrowsingTag:u,selectedChildBrowsingTag:d,setSelectedChildBrowsingTag:p,scrollableContentRef:g,shouldResetScrollableContentEventListener:v,resetScrollableContentEventListener:y}},t.useSelectedOfferSearchResult=function(e,t,n,a){var c=o(i.default.useState(void 0),2),l=c[0],u=c[1],f=o(i.default.useState(s.OfferDetailsSection.cashback),2),p=f[0],g=f[1],h=(0,d.useOfferDetailsTabContentSpecificProps)(l,a,!1,p,g,e,t,void 0,(function(e){}));return r({selectedOfferSearchResult:l,setSelectedOfferSearchResult:u,userRegion:e,isMobileExtension:t,closePanelAndLogEvents:n},h)},t.useDisplayedSearchResults=function(e){var t=(0,s.useProgressiveDisplay)(e),n=t.displayedItems,r=t.showMoreResults;return{displayedSearchResults:n,handleScroll:function(e){var t=e.currentTarget;t.scrollHeight-t.scrollTop-t.clientHeight<1&&r()}}},t.useOnClickSearchResult=function(e,t,n){var r=e.offerId,o=e.type,a=(0,l.checkIsOnMobileScreen)(),c=(0,s.useHasFeatureByPlatform)({isMobileExtension:a,desktopFeature:s.Feature.alternativeOffersInPanelDesktopBrowserExtension,mobileFeature:s.Feature.alternativeOffersInPanelMobileBrowserExtension});return i.default.useCallback((function(){e.enrichedConditions&&(e.enrichedConditions.conditions=e.enrichedConditions.conditions.filter((function(e){return!e.summary.includes("via le bouton ci-dessous")}))),t(e),(0,u.sendMessageToBackgroundScript)({message:"getEnrichedMerchantOfferFromAppSync",data:{offerId:r}},(function(e){e.offer&&t(e.offer)})),e.type===s.OfferType.NoCashback?c&&(0,f.checkCanDisplayAlternativeOffersInPanel)(e)?n(s.OfferDetailsSection.cashback):n(s.OfferDetailsSection.bnpl):n(s.OfferDetailsSection.cashback),p(r,o)}),[e])},t.logClickedOfferEvents=p,t.useFilteredUserOffers=function(e,t,n,r,a,s){var c=o(i.default.useState([]),2),l=c[0],f=c[1],d=o(i.default.useState(!0),2),p=d[0],h=d[1],v=i.default.useRef(void 0);i.default.useEffect((function(){!function(e){var t=e.lastQueryLaunchTimestampMsRef,n=e.searchText,r=e.parentTagId,o=e.internalTagIdsToQuery,a=e.browsingTagIdsToQuery,i=e.emptyQuerySearchResults,s=e.setIsLoading,c=e.setUserOffersResult,l=(new Date).valueOf();t.current=l,n.length>0?(0,u.sendMessageToBackgroundScript)({message:"searchOffers",data:{searchQuery:n}},(function(e){l===t.current&&(s(!1),c(e.offers))})):a||o?(s(!0),(0,u.sendMessageToBackgroundScript)({message:"getOffersByTags",data:{parentTagId:r,browsingTagIds:a,internalTagIds:o}},(function(e){l===t.current&&(s(!1),c(e.offers))}))):0===i.length?s(!0):(s(!1),c(i))}({lastQueryLaunchTimestampMsRef:v,searchText:t,parentTagId:n?n.tagId:void 0,internalTagIdsToQuery:r,browsingTagIdsToQuery:a,emptyQuerySearchResults:e,setIsLoading:h,setUserOffersResult:f})}),[t,n,r,a,e]);var b=i.default.useMemo((function(){return l.filter(g)}),[l]);return i.default.useEffect((function(){p||s()}),[p]),{filteredUserOffers:b,isLoading:p}},t.useIsSearchBarFocused=function(e){var t=e.isSearchBarFocused,n=e.setIsSearchBarFocused,r=e.setSearchText,o=e.setIsOfferSearchActive,a=e.isMobileExtension,s=e.scrollableContentRef,c=e.shouldResetScrollableContentEventListener,l=i.default.useRef(null),u=i.default.useCallback((function(){n(!0),o(!0),a&&l.current&&l.current.scrollIntoView({behavior:"smooth",block:"center"})}),[]),f=i.default.useCallback((function(){return n(!1)}),[]),d=i.default.useCallback((function(){r("")}),[]),p=i.default.useCallback((function(e){var t=a?e.target.value.replace(/[\u2019]/g,"'"):e.target.value;r(t)}),[]),g=i.default.useCallback((function(e){"Escape"===e.key&&(o(!1),r(""),l.current&&l.current.blur()),"Enter"===e.key&&l.current&&l.current.blur()}),[]);return i.default.useEffect((function(){s.current&&s.current.addEventListener("scroll",(function(){l.current&&l.current.blur()}))}),[c]),{isSearchBarFocused:t,searchBarInputRef:l,onFocusSearchBarInput:u,onBlurSearchBarInput:f,onChangeSearchBarInput:p,onKeyDownSearchBarInput:g,onClickCancelCross:d}},t.useDesignSystemOfferSearchBarFocusState=function(e){var t=e.searchText,n=e.setSearchText,r=e.setIsOfferSearchActive,o=e.isMobileExtension,a=e.scrollableContentRef,s=e.shouldResetScrollableContentEventListener,c=e.selectedParentBrowsingTag,l=e.setSelectedParentBrowsingTag,u=e.selectedChildBrowsingTag,f=e.setSelectedChildBrowsingTag,d=i.default.useRef(null),p=i.default.useRef(""),g=i.default.useCallback((function(){t?n(""):!o&&u?f(void 0):c?(l(void 0),f(void 0)):r(!1),d.current&&d.current.blur()}),[t,c,u,o]),h=i.default.useCallback((function(){r(!0),o&&d.current&&d.current.scrollIntoView({behavior:"smooth",block:"center"})}),[g]),v=i.default.useCallback((function(){n("")}),[]),b=i.default.useCallback((function(e){"Escape"===e.key&&(r(!1),n(""),d.current&&d.current.blur()),"Enter"===e.key&&d.current&&d.current.blur()}),[]);return i.default.useEffect((function(){a.current&&a.current.addEventListener("scroll",(function(){d.current&&d.current.blur()}))}),[s]),{searchBarInputRef:d,onFocusSearchBarInput:h,onKeyDownSearchBarInput:b,onClickCancelCross:v,onGoBack:g,searchBarTextRef:p}},t.useSetHeaderStateBasedOnSearchState=function(e){var t=e.isOfferSearchActive,n=e.onGoBack,r=e.setPanelHeaderType,o=e.setOnClickPanelGoBackButton;i.default.useEffect((function(){return t?(r(c.PanelHeaderType.backArrowAndCloseButton),o((function(){return n}))):(r(c.PanelHeaderType.jokoLogoAndCloseButton),o((function(){return null}))),function(){r(c.PanelHeaderType.jokoLogoAndCloseButton),o((function(){return null}))}}),[t,n,r,o])},t.useSetHeaderStateInSelectedSearchResultScreen=function(e){var t=e.onGoBack,n=e.setPanelHeaderType,r=e.setOnClickPanelGoBackButton;i.default.useEffect((function(){return n(c.PanelHeaderType.backArrowAndCloseButton),r((function(){return t})),function(){n(c.PanelHeaderType.jokoLogoAndCloseButton),r((function(){return null}))}}),[n,r,t])}},74617:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useOnClickInsidePanel=t.usePanelTabSvgIcon=t.useTabIconUrl=t.getCssFilterPropertyForTabIconUrl=t.enableWebpageBodyScrolling=t.disableWebpageBodyScrolling=t.usePanelWrapperInnerState=t.usePanelInnerState=t.getPanelElement=t.displayPanelAndLogEvents=t.toggleDisplayPanelAndLogEvents=void 0;var l=c(n(96540)),u=c(n(40961)),f=n(55015),d=c(n(84781)),p=c(n(20171)),g=c(n(49357)),h=c(n(76375)),v=n(47175),b=n(52879),y=n(37392),m=n(17621),S=n(32668),k=n(24366),T=n(26368),I=n(68134),E=n(46239),C=n(23081),w=n(86263),O=n(95752),P=n(87105),B=n(78148),A=n(18989),D=n(13897),M=c(n(40549)),_=c(n(91506)),W="jokoLastPanelOpenedOrClosedAt";function x(e){return document.getElementById(e||(0,m.getHashedElementId)(m.JokoExtensionRootElement.panel))}function L(e){var t=x(e);null!==t&&(u.default.unmountComponentAtNode(t),t.remove())}function F(e,t){return o(this,void 0,void 0,(function(){var n,o,i,c;return a(this,(function(a){switch(a.label){case 0:return[4,Promise.all([R(),(0,f.getUserFeaturesMap)()])];case 1:return n=s.apply(void 0,[a.sent(),2]),o=n[0],i=n[1],e.excludedPanelTabs=o,(c=document.createElement("div")).id=t,document.documentElement.appendChild(c),u.default.render(l.default.createElement(M.default,null,l.default.createElement(f.LocalesContextProvider,null,l.default.createElement(f.FeaturesContextProvider,{initialUserFeaturesMap:i},l.default.createElement(_.default,r({},e))))),c),[2]}}))}))}function R(){return o(this,void 0,void 0,(function(){var e,t,n,r;return a(this,(function(o){switch(o.label){case 0:return f.browserKind!==f.Browser.mobileAppWebView?[2,[]]:[4,Promise.all([(0,f.checkHasFeature)(f.Feature.extensionPanelSearchTabInMobileAppBrowser),(0,f.checkHasFeature)(f.Feature.extensionPanelProfileTabInMobileAppBrowser)])];case 1:return e=s.apply(void 0,[o.sent(),2]),t=e[0],n=e[1],r=[],t||r.push(f.PanelTab.offerSearch),n||r.push(f.PanelTab.profile),[2,r]}}))}))}function U(e,t){var n=t.offer,r=t.isProductPage,i=t.isCheckoutPage,s=t.bnpl,c=t.defaultPanelLocationOverride,l=t.isTemporaryUser,u=t.excludedPanelTabs;return o(this,void 0,void 0,(function(){var t,o,d,p,g,h,v,b;return a(this,(function(a){switch(a.label){case 0:return[4,(0,f.checkHasFeature)(f.Feature.bnplNewCardReadyDisplayInExtensions)];case 1:return t=a.sent(),d=(o=s||{isBnplSectionEnabledForOffer:!1}).isBnplSectionEnabledForOffer,p=o.userBnplTransactionsFromLocalStorage,g=(0,O.getInitialPanelLocation)({offer:n,isProductPage:r,isCheckoutPage:i,isBnplSectionEnabledForOffer:d,userBnplTransactionsFromLocalStorage:p,shouldMakeBnplTabAsDefaultIfUnusedCardExists:t,defaultPanelLocationOverride:c,excludedPanelTabs:u}),h=g.initiallySelectedPanelTab,v=g.initiallySelectedOfferDetailsSection,b={fromComponent:e,initiallySelectedPanelTab:h,initiallySelectedOfferDetailsSection:v,isTemporaryUser:l},(0,E.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"openedPanelOnBrowserExtension",payload:b}}}),(0,E.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Opened Panel",properties:b}}}),[2]}}))}))}function N(){document.body.style.overflow="hidden"}function H(){document.body.style.overflow="auto"}t.toggleDisplayPanelAndLogEvents=function(e,t){if(n=Number(localStorage.getItem(W)),!(Date.now()-n<1e3*T.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS+50)){var n,r=(0,m.getHashedElementId)(m.JokoExtensionRootElement.panel);null===x(r)?(F(e,r),localStorage.setItem(W,Date.now().toString()),U(t,e)):((0,y.sendJokoDomEvent)(y.JokoDomEvent.onJokoPanelCloseRequest,{closingSource:"clickBrowserAction"}),localStorage.setItem(W,Date.now().toString()))}},t.displayPanelAndLogEvents=function(e,t,n){var r=(0,m.getHashedElementId)(m.JokoExtensionRootElement.panel),o=x(r),a=null!==o,i=function(e){var t=!1,n=(null==e?void 0:e.children[0])?e.children[0].style.transform:null;if(n){var r=/translate3d\((.+)%, (.+)(px)?, (.+)px\)/.exec(n);(null==r?void 0:r[2])&&(t=0!==parseInt(r[2],10))}return t}(o);!i&&a?n&&(0,y.sendJokoDomEvent)(y.JokoDomEvent.onJokoPanelLocationChangeRequest,{panelLocation:n}):(i&&L(r),F(e,r),localStorage.setItem(W,Date.now().toString()),U(t,e))},t.getPanelElement=x,t.usePanelInnerState=function(e){var t=function(e){var t=this,n=e.offer,c=e.userOfferActivationInfo,u=e.isProductPage,d=e.isTemporaryUser,p=e.excludedPanelTabs,g=i(e,["offer","userOfferActivationInfo","isProductPage","isTemporaryUser","excludedPanelTabs"]),h=s(l.default.useState(void 0),2),v=h[0],b=h[1],k=l.default.useMemo(S.checkIsOnMobileScreen,[]),T=l.default.useMemo((function(){return!!document.getElementById((0,m.getHashedElementId)(m.JokoExtensionRootElement.offerWidget))}),[]),C=(0,O.usePanelLocation)(r({offer:n,userOfferActivationInfo:c,isProductPage:u,isTemporaryUser:d,excludedPanelTabs:p},g)),w=C.selectedPanelTab,P=C.setSelectedPanelTab,B=C.selectedOfferDetailsSection,M=C.setSelectedOfferDetailsSection,_=C.selectedProductsSection,W=C.setSelectedProductsSection,x=(0,I.useGetTabId)(),F=l.default.useCallback((function(e,i){return o(t,void 0,void 0,(function(){var t,o;return a(this,(function(a){switch(a.label){case 0:return t=window.location.href,b(!1),(0,D.removeUnfinishedBnplSubscriptionStateInLocalStorage)(x),function(e,t,n){var o=r(r({},e===f.PanelTab.offerDetails?{tab:e,section:t}:{tab:e}),{closingSource:n});(0,E.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedPanelOnBrowserExtension",payload:o}}}),(0,E.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Closed Panel",properties:o}}})}(w,B,e),(o=!i)?[4,(0,A.checkShouldDisplaySideButtonOnWebpage)(t,n)]:[3,2];case 1:o=a.sent(),a.label=2;case 2:return o&&(0,A.displaySideButton)({offer:n,userOfferActivationInfo:c,webpageUrl:t,isTemporaryUser:d}),[2]}}))}))}),[w,x]),R=l.default.useCallback((function(e){var t=e.propertyName;!1===v&&["opacity","right","transform"].includes(t)&&L()}),[v]);l.default.useEffect((function(){setTimeout((function(){return b(!0)}),50),(0,y.sendJokoDomEvent)(y.JokoDomEvent.onJokoPanelDisplayed,{});var e=(0,y.setJokoDomEventListener)(y.JokoDomEvent.onJokoPanelCloseRequest,(function(e){var t=e.closingSource;return F(t)}));return function(){return(0,y.removeJokoDomEventListener)(y.JokoDomEvent.onJokoPanelCloseRequest,e)}}),[]);var U=l.default.useRef(null);return{tabId:x,isPanelDisplayed:v,isMobileExtension:k,selectedPanelTab:w,setSelectedPanelTab:P,closePanelAndLogEvents:F,offer:n,isProductPage:u,selectedOfferDetailsSection:B,setSelectedOfferDetailsSection:M,selectedProductsSection:_,setSelectedProductsSection:W,onPanelTransitionEnd:R,isOfferWidgetMounted:T,panelInnerContainerRef:U,isTemporaryUser:d,excludedPanelTabs:p,unfinishedBnplSubscriptionState:g.bnpl.unfinishedBnplSubscriptionState}}(e),n=t.isMobileExtension,c=t.selectedOfferDetailsSection,u=t.setSelectedOfferDetailsSection,d=t.selectedProductsSection,p=t.setSelectedProductsSection,g=i(t,["isMobileExtension","selectedOfferDetailsSection","setSelectedOfferDetailsSection","selectedProductsSection","setSelectedProductsSection"]),h=function(e){var t=e.offer,n=e.userOfferActivationInfo,o=e.selectedOfferDetailsSection,a=e.setSelectedOfferDetailsSection,i=e.selectedProductsSection,c=e.setSelectedProductsSection,u=e.selectedPanelTab,d=e.closePanelAndLogEvents,p=e.panelInnerContainerRef,g=e.isMobileExtension,h=e.isTemporaryUser,v=e.bnpl,y=function(e,t,n,r,o){var a=(0,f.useUserRegion)(),i=s(l.default.useState(void 0),2),c=i[0],u=i[1];l.default.useEffect((function(){(0,E.sendMessageToBackgroundScript)({message:"getUserSavedWebpages"},(function(e){return u(e.userSavedWebpages)}))}),[]);var d=(0,b.useShouldDisplayBankReconnectionBanner)()&&r;return{offer:e,isMobileExtension:r,userRegion:a,closePanelAndLogEvents:t,panelInnerContainerRef:n,isTemporaryUser:o,shouldDisplayBankReconnectionBanner:d,userSavedWebpages:c,setUserSavedWebpages:u}}(t,d,p,g,h),m=(0,w.useOfferSearchTabContentSpecificProps)(),S=(0,C.useOfferDetailsTabContentSpecificProps)(t,n,v.isBnplSectionEnabledForOffer,o,a,y.userRegion,y.isMobileExtension,y.userSavedWebpages,y.setUserSavedWebpages,v.lastUserBnplTransactionFromBnplSubscriptionWidget),k=(0,P.useProductsTabContentSpecificProps)({isMobileExtension:g,selectedPanelTab:u,selectedProductsSection:i,setSelectedProductsSection:c}),T=(0,B.useProfileTabContentSpecificProps)(u,g);return r(r(r(r(r({},m),S),k),T),y)}(r(r({isMobileExtension:n,selectedOfferDetailsSection:c,setSelectedOfferDetailsSection:u,selectedProductsSection:d,setSelectedProductsSection:p},e),g));return{selectedPanelTab:g.selectedPanelTab,panelWrapperProps:g,panelTabsProps:h}},t.usePanelWrapperInnerState=function(e,t){var n,r,o,a=(0,m.useHashedElementId)(m.JokoExtensionElement.panel),i=l.default.useMemo(S.checkIsOnMobileScreen,[]);return(0,k.useSetMomentLocale)(),function(e){l.default.useEffect((function(){return e&&N(),function(){e&&H()}}),[e])}(i),r=(n={onClick:function(){return e("clickOutside")},shouldSkip:!i||t}).onClick,o=n.shouldSkip,l.default.useEffect((function(){if(!o)return window.addEventListener("click",r),function(){window.removeEventListener("click",r)}}),[o]),{elementId:a,isMobileExtension:i}},t.disableWebpageBodyScrolling=N,t.enableWebpageBodyScrolling=H,t.getCssFilterPropertyForTabIconUrl=function(e,t){return t?e?"":(0,f.getCssFilterFromBlackToTargetColor)(f.ColorName.frenchGray):e?(0,f.getCssFilterFromBlackToTargetColor)(f.ColorName.emerald):(0,f.getCssFilterFromBlackToTargetColor)(f.ColorName.frenchGray)},t.useTabIconUrl=function(e,t,n){return l.default.useMemo((function(){var r=t&&n;switch(e){case f.PanelTab.offerSearch:return r?v.MAGNIFYING_GLASS_WITH_SQUARE_GREEN_ICON_URL:v.MAGNIFYING_GLASS_WITH_SQUARE_ICON_URL;case f.PanelTab.offerDetails:return r?v.LIGHTNING_BOLT_FILLED_CIRCLE_GREEN_ICON_URL:v.LIGHTNING_BOLT_FILLED_CIRCLE_BLACK_ICON_URL;case f.PanelTab.products:return r?v.SHOPPING_BAG_GREEN_ICON_URL:v.SHOPPING_BAG_ICON_URL;case f.PanelTab.profile:return r?v.USER_SILHOUETTE_GREEN_ICON_URL:v.USER_SILHOUETTE_ICON_URL}}),[e,t,n])},t.usePanelTabSvgIcon=function(e){return l.default.useMemo((function(){switch(e){case f.PanelTab.offerSearch:return p.default;case f.PanelTab.offerDetails:return d.default;case f.PanelTab.products:return h.default;case f.PanelTab.profile:return g.default}}),[e])},t.useOnClickInsidePanel=function(e){var t=e.panelInnerContainerRef,n=e.onClick,r=e.excludedElementRefs,o=e.shouldAlsoDetectClickOutsidePanel,a=e.dependencyArray,i=l.default.useCallback((function(e){if(e.target){var t=r.some((function(t){var n;return null===(n=null==t?void 0:t.current)||void 0===n?void 0:n.contains(e.target)}));t||n()}}),null!=a?a:[]);l.default.useEffect((function(){return(null==t?void 0:t.current)&&t.current.addEventListener("pointerdown",i),o&&window.addEventListener("click",i),function(){(null==t?void 0:t.current)&&t.current.removeEventListener("pointerdown",i),o&&window.removeEventListener("click",i)}}),[i])}},95752:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkIsProductAndCheckoutWebpage=t.getInitialPanelLocation=t.usePanelLocation=t.checkIsPanelLocation=void 0;var s=i(n(96540)),c=n(55015),l=n(37392),u=n(46239),f=n(82198),d=n(14997);function p(e){var t=e.offer,n=e.isProductPage,r=e.isCheckoutPage,o=e.isBnplSectionEnabledForOffer,a=e.userBnplTransactionsFromLocalStorage,i=e.shouldMakeBnplTabAsDefaultIfUnusedCardExists,s=e.defaultPanelLocationOverride,l=e.excludedPanelTabs,u=function(e){var t=e.offer,n=e.isProductPage,r=e.isCheckoutPage,o=e.isBnplSectionEnabledForOffer,a=e.userBnplTransactionsFromLocalStorage,i=e.shouldMakeBnplTabAsDefaultIfUnusedCardExists,s=e.excludedPanelTabs;if(i&&a&&a.length)return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.bnpl};if(n)return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.product};if(r){if(g(t))return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.coupons};if(o)return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.bnpl};if(v(t))return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.cashback}}else{if(v(t))return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.cashback};if(g(t))return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.coupons};if(o)return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.bnpl}}var l=null==s?void 0:s.includes(c.PanelTab.offerSearch);return l?t?{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.cashback}:{panelTab:c.PanelTab.products,offerDetailsSection:c.OfferDetailsSection.cashback}:{panelTab:c.PanelTab.offerSearch,offerDetailsSection:c.OfferDetailsSection.cashback}}({offer:t,isProductPage:n,isCheckoutPage:r,isBnplSectionEnabledForOffer:o,userBnplTransactionsFromLocalStorage:a,shouldMakeBnplTabAsDefaultIfUnusedCardExists:i,excludedPanelTabs:l});(function(e,t){return!!(e&&e.panelTab&&t&&t.includes(e.panelTab))})(s,l)&&(s=void 0);var f=s?s.panelTab:void 0,d=f||u.panelTab,p=s?s.offerDetailsSection:void 0;return{initiallySelectedPanelTab:d,initiallySelectedOfferDetailsSection:p||u.offerDetailsSection,initiallySelectedProductsSection:c.ProductsSection.savedProducts}}function g(e){return h(e)>0}function h(e){var t,n;return(null===(n=null===(t=null==e?void 0:e.browserExtension)||void 0===t?void 0:t.coupons)||void 0===n?void 0:n.itemList)?e.browserExtension.coupons.itemList.length:0}function v(e){return!!e&&e.type!==c.OfferType.NoCashback}t.checkIsPanelLocation=function(e){return"object"==typeof e&&!!e&&(0,c.hasOwnProperty)(e,"panelTab")&&"string"==typeof e.panelTab&&Object.values(c.PanelTab).includes(e.panelTab)&&(0,c.hasOwnProperty)(e,"offerDetailsSection")&&"string"==typeof e.offerDetailsSection&&Object.values(c.OfferDetailsSection).includes(e.offerDetailsSection)},t.usePanelLocation=function(e){var t=e.offer,n=e.defaultPanelLocationOverride,r=e.isProductPage,o=e.isCheckoutPage,i=e.excludedPanelTabs,f=e.isTemporaryUser,d=e.bnpl,g=d.isBnplSectionEnabledForOffer,b=d.userBnplTransactionsFromLocalStorage,y=(0,c.useHasFeature)(c.Feature.bnplNewCardReadyDisplayInExtensions),m=s.default.useMemo((function(){return p({offer:t,isProductPage:r,isCheckoutPage:o,isBnplSectionEnabledForOffer:g,userBnplTransactionsFromLocalStorage:b,shouldMakeBnplTabAsDefaultIfUnusedCardExists:y,defaultPanelLocationOverride:n,excludedPanelTabs:i})}),[t,r,o,g,y,n,i]),S=m.initiallySelectedPanelTab,k=m.initiallySelectedOfferDetailsSection,T=m.initiallySelectedProductsSection,I=a(s.default.useState(S),2),E=I[0],C=I[1],w=a(s.default.useState(k),2),O=w[0],P=w[1],B=a(s.default.useState(T),2),A=B[0],D=B[1];return function(e,t,n){s.default.useEffect((function(){var r=(0,l.setJokoDomEventListener)(l.JokoDomEvent.onJokoPanelLocationChangeRequest,(function(r){var o=r.panelLocation,a=o.panelTab,i=o.offerDetailsSection;(null==n?void 0:n.includes(a))||e(a),t(i)}));return function(){return(0,l.removeJokoDomEventListener)(l.JokoDomEvent.onJokoPanelLocationChangeRequest,r)}}),[])}(C,P,i),function(e,t,n,r,o,a,i){s.default.useEffect((function(){return function(e,t){var n={tab:e,isDefaultTab:e===t};(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"navigatedPanelTabOnBrowserExtension",payload:n}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Navigated Panel Tab",properties:n}}})}(e,n)}),[e]),s.default.useEffect((function(){return function(e,t,n,r,o){var a={section:e,isDefaultSection:e===t,offerId:n?n.offerId:void 0,offerType:n?n.type:void 0,isTemporaryUser:r,numberOfCouponsAvailable:h(n),isCashbackAvailable:v(n),isBnplAvailable:o};(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"navigatedOfferSectionOnBrowserExtension",payload:a}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Navigated Offer Section",properties:a}}})}(t,r,o,a,i)}),[t])}(E,O,S,k,t,f,g),{selectedPanelTab:E,setSelectedPanelTab:C,selectedOfferDetailsSection:O,setSelectedOfferDetailsSection:P,selectedProductsSection:A,setSelectedProductsSection:D}},t.getInitialPanelLocation=p,t.checkIsProductAndCheckoutWebpage=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(o){switch(o.label){case 0:return[4,Promise.all([(0,f.getProductData)(e),(0,d.checkIsCheckoutWebpageAndGetMatchData)(e)])];case 1:return t=a.apply(void 0,[o.sent(),2]),n=t[0].productData,r=t[1].isCheckoutWebpage,[2,{isProductPage:(0,f.checkIsProductWebpageFromProductData)(n),isCheckoutPage:r}]}}))}))}},38543:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useProductAlternativeInnerState=void 0;var s=i(n(96540)),c=n(55015),l=n(77653),u=n(89710),f=n(33931);t.useProductAlternativeInnerState=function(e,t,n,i,d){var p=this,g=e.webpageUrl,h=e.productData,v=h.priceAmount,b=h.priceCurrency,y=(0,c.useLocalizedFormat)();return{priceToDisplay:s.default.useMemo((function(){return v?(0,c.formatProductPrice)(y,v,b):" — "}),[]),onClickAlternative:s.default.useCallback((function(){return o(p,void 0,void 0,(function(){var o,s;return a(this,(function(a){switch(a.label){case 0:return(0,f.logClickedPriceComparisonWebpageEvents)(e,n,i,t,d),(0,c.setLocalStorageItem)(c.LocalStorageKey.lastOpenedProductAlternative,{lastOpenedTimestamp:Date.now(),webpageUrl:g}),[4,(0,l.getMerchantOfferMatchingUrlWithConditionsAndCoupons)(g)];case 1:return(o=a.sent())?((0,u.handleUserInterfaceComponentInteractionInBackground)(r(r({},o),{triggeringEventType:c.UserInterfaceComponentInteractionEventType.priceComparisonAlternativeButton})),[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.offerActivatedInSessionTimestampMsMap,(s={},s[o.offerId]=Date.now(),s))]):[3,3];case 2:a.sent(),a.label=3;case 3:return window.open(g),[2]}}))}))}),[])}}},87105:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PRODUCT_INFO_BUTTON_SIZE=t.useFormattedPriceAndSeparator=t.useOnClickPriceTrackingButton=t.useCurrentWebpageFromLastCapturedData=t.useProductsTabContentSpecificProps=t.useProductsSections=void 0;var s=i(n(96540)),c=n(55015),l=n(47248),u=n(68134),f=n(46239);t.useProductsSections=function(e){var t=(0,c.useLocalizedTexts)().contentscript.redesign.panel.products.selectorBar;return(0,c.useHasFeatureByPlatform)({isMobileExtension:e,desktopFeature:c.Feature.historyOfBrowsedProductsDesktopBrowserExtension,mobileFeature:c.Feature.historyOfBrowsedProductsMobileBrowserExtension})?[{id:l.ProductsSection.savedProducts,displayedText:t.savedProducts},{id:l.ProductsSection.browsedProducts,displayedText:t.browsedProducts}]:[{id:l.ProductsSection.savedProducts,displayedText:t.savedProducts}]},t.useProductsTabContentSpecificProps=function(e){var t=e.isMobileExtension,n=e.selectedPanelTab,r=e.selectedProductsSection,o=e.setSelectedProductsSection,i=(0,c.useSetting)({settingKey:c.SettingKey.blacklistedPriceTrackingDomains}),u=a(s.default.useState(void 0),2),d=u[0],p=u[1],g=(0,c.useHasFeatureByPlatform)({isMobileExtension:t,desktopFeature:c.Feature.historyOfBrowsedProductsDesktopBrowserExtension,mobileFeature:c.Feature.historyOfBrowsedProductsMobileBrowserExtension});return s.default.useEffect((function(){g&&n===l.PanelTab.products&&(0,f.sendMessageToBackgroundScript)({message:"getUserBrowsedProductWebpages"},(function(e){p(e.userBrowsedProductWebpages)}))}),[n]),{userBrowsedProductWebpages:d,setUserBrowsedProductWebpages:p,blacklistedPriceTrackingDomains:i,selectedProductsSection:r,setSelectedProductsSection:o}},t.useCurrentWebpageFromLastCapturedData=function(){var e=a(s.default.useState(void 0),2),t=e[0],n=e[1],i=s.default.useMemo((function(){return(e=t)?{name:e.webpageTitle,imageUrl:e.webpageImageUrl,priceAmount:e.productPriceAmount,priceCurrency:e.productPriceCurrency}:void 0;var e}),[t]);return s.default.useEffect((function(){!function(){r(this,void 0,void 0,(function(){var e,t;return o(this,(function(r){switch(r.label){case 0:return[4,(0,u.getTabId)()];case 1:return(e=r.sent())?[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.capturedWebpageDataByTabIdMap)]:[2];case 2:return(t=r.sent()||{})[e]&&n(t[e]),[2]}}))}))}()}),[]),{currentWebpage:t,productDataFromCurrentWebpage:i}},t.useOnClickPriceTrackingButton=function(e){var t=e.webpageUrl,n=e.loadPriceHistoryAndLogEvents,r=e.currentlyOpenPriceTrackingGraphWebpageUrl,o=e.setCurrentlyOpenPriceTrackingGraphWebpageUrl,i=e.fromComponent,c=a(s.default.useState(!1),2),l=c[0],u=c[1],d=s.default.useCallback((function(e){e.stopPropagation();var n=!l;u(n),n?(!function(e,t){var n={url:e,fromComponent:t};(0,f.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedProductWebpagePriceTrackingButton",payload:n}}}),(0,f.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Webpages - Clicked Product Webpage Price Tracking Button",properties:n}}})}(t,i),o(t)):o(void 0)}),[l,t]);return s.default.useEffect((function(){l&&n(i).then((function(e){e.length||u(!1)}))}),[l]),s.default.useEffect((function(){r!==t&&u(!1)}),[r]),{onClickPriceTrackingButton:d,isPriceTrackingGraphOpen:l}};t.useFormattedPriceAndSeparator=function(e){var t=e.lastPriceData,n=e.productPriceAmount,r=e.productPriceCurrency,o=(0,c.useLocalizedFormat)();return s.default.useMemo((function(){if(n)return(0,c.formatProductPrice)(o,t?t.amount:n,t?t.currency:r)+" — "}),[o,t,n,r])},t.PRODUCT_INFO_BUTTON_SIZE=30},78148:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useLineWithSeparatorProps=t.redirectToJokoAppHistoryScreen=t.redirectToJokoApp=t.useOnClickTemporaryUserLoginButton=t.useProfileTabContentSpecificProps=void 0;var s=i(n(96540)),c=n(55015),l=i(n(4279)),u=i(n(56906)),f=i(n(40944)),d=n(62849),p=n(32668),g=n(74137),h=n(66499),v=n(46239);function b(e){var t=e.collectedBalanceInPoints,n=e.pendingBalanceInPoints,r=(0,c.useLocalizedFormat)();return s.default.useMemo((function(){return{collected:y(t,r),pending:y(n,r)}}),[t,n,r])}function y(e,t){if(void 0!==e){var n=e/1e3,r=n>Math.pow(10,3)?Math.floor(n):n;return(0,c.formatCurrencyAmount)({number:r,localizedFormat:t})}}function m(){var e=window.open("joko://","_blank");e&&e.focus()}t.useProfileTabContentSpecificProps=function(e,t){var n=function(e){var t=a(s.default.useState(void 0),2),n=t[0],r=t[1];return function(e,t){s.default.useEffect((function(){if(t){var n=Date.now(),r=void 0;return(0,c.getLocalStorageItem)(c.LocalStorageKey.userDataLastFetchedTimestampMs).then((function(t){r=window.setInterval((0,g.withSentry)((function(){return function(e){var t=e.userDataLastFetchedTimestampMs,n=e.componentMountingTimestampMs,r=e.intervalId,o=e.setUserCollectedPointsBalance;(0,v.sendMessageToBackgroundScript)({message:"getSharedBalanceStatus"},(function(e){var a=e.sharedBalanceStatus;(function(e,t){return!(!(null==e?void 0:e.balancePoints)||!e.lastRefreshTimestampInMs)&&(!t||t<e.lastRefreshTimestampInMs)})(a,t)&&(n<a.lastRefreshTimestampInMs&&clearInterval(r),o(a.balancePoints),(0,c.setLocalStorageItem)(c.LocalStorageKey.userPoints,a.balancePoints))}))}({userDataLastFetchedTimestampMs:t,componentMountingTimestampMs:n,intervalId:r,setUserCollectedPointsBalance:e})})),S)})),function(){r&&clearInterval(r)}}}),[])}(r,e),s.default.useEffect((function(){(0,c.getLocalStorageItem)(c.LocalStorageKey.userPoints).then((function(e){null!==e&&r(e)}))}),[]),n}(t),i=function(e){var t=a(s.default.useState(void 0),2),n=t[0],i=t[1];return s.default.useEffect((function(){!function(e,t){r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.userPendingPoints)];case 1:return null!==(n=r.sent())&&e(n),t!==c.PanelTab.profile?[2]:((0,v.sendMessageToBackgroundScript)({message:"getUserPendingPoints"},(function(t){var n=t.userPendingPoints;return e(n||0)})),[2])}}))}))}(i,e)}),[e]),n}(e);return{formattedUserBalance:b({collectedBalanceInPoints:n,pendingBalanceInPoints:i}),collectedBalanceInPoints:n}},t.useOnClickTemporaryUserLoginButton=function(e){return s.default.useCallback((function(){(0,v.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedLoginInExtensionProfileTab"}}}),(0,v.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Registration - Clicked Login In Extension Profile Tab"}}}),e?m():(0,h.openWebAppSignInPage)()}),[e])},t.redirectToJokoApp=m,t.redirectToJokoAppHistoryScreen=function(e){if((0,p.checkIsOnMobileScreen)()){var t=document.createElement("a"),n="https://www.joko.com/link/History/"+encodeURIComponent(JSON.stringify({tabId:e?"pending":"all"}));t.href=n,t.click()}};var S=2e3;t.useLineWithSeparatorProps=function(e){var t=e.isDevStack,n=e.isMobileExtension,r=(0,c.useLocalizedTexts)().contentscript.redesign.panel.profile,o=(0,c.useLocalizedHelpCenterAndTosUrls)(),a=o.helpCenterUrl,i=o.tosUrl,p=(0,d.useExtensionType)(),g=s.default.useCallback((function(e,t){(0,v.sendMessageToBackgroundScript)({message:"openTab",data:{url:e}}),(0,v.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:t}})}),[]),h=[{title:r.helpCenter,description:"",iconComponent:f.default,shouldShowIcon:!0,shouldShowSeparator:!0,isMobileExtension:n,onClick:function(){return g(a,{type:"Profile - Clicked FAQ"})}},{title:r.termsOfService,description:"",iconComponent:l.default,shouldShowIcon:!0,shouldShowSeparator:!1,isMobileExtension:n,onClick:function(){return g(i,{type:"Profile - Clicked Terms Of Service"})}}];return p===c.ExtensionType.desktopSafariExtension&&h.push({title:r.manageMyAccount,iconComponent:u.default,shouldShowIcon:!0,shouldShowSeparator:!1,isMobileExtension:n,onClick:function(){return g(t?"https://dev.app.joko.com/home/profile/user-info":"https://app.joko.com/home/profile/user-info",{type:"Profile - Clicked Manage My Account"})}}),h}}}]);