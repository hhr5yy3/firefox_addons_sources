(()=>{var e={167:(e,t,n)=>{"use strict";n.d(t,{B:()=>o,V:()=>i});var r=n(822),s={};function i(){return(0,r.wD)()?n.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:s}function o(e,t,n){var r=n||i(),s=r.__SENTRY__=r.__SENTRY__||{};return s[e]||(s[e]=t())}},822:(e,t,n)=>{"use strict";function r(){return!("undefined"!=typeof __SENTRY_BROWSER_BUNDLE__&&__SENTRY_BROWSER_BUNDLE__)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)}function s(e,t){return e.require(t)}n.d(t,{fj:()=>s,wD:()=>r}),e=n.hmd(e)},461:(e,t,n)=>{"use strict";n.d(t,{lu:()=>c,zf:()=>u});var r=n(167),s=n(822);e=n.hmd(e);var i={nowSeconds:function(){return Date.now()/1e3}},o=(0,s.wD)()?function(){try{return(0,s.fj)(e,"perf_hooks").performance}catch(e){return}}():function(){var e=(0,r.V)().performance;if(e&&e.now)return{now:function(){return e.now()},timeOrigin:Date.now()-e.now()}}(),a=void 0===o?i:{nowSeconds:function(){return(o.timeOrigin+o.now())/1e3}},c=i.nowSeconds.bind(i),u=a.nowSeconds.bind(a);!function(){var e=(0,r.V)().performance;if(e&&e.now){var t=36e5,n=e.now(),s=Date.now(),i=e.timeOrigin?Math.abs(e.timeOrigin+n-s):t,o=i<t,a=e.timing&&e.timing.navigationStart,c="number"==typeof a?Math.abs(a+n-s):t;(o||c<t)&&(i<=c&&e.timeOrigin)}}()},131:function(e,t){var n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=function(e){"use strict";if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)e.exports=globalThis.browser;else{const t="The message port closed before a response was received.",n=e=>{const n={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(n).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class r extends WeakMap{constructor(e,t=void 0){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const s=(t,n)=>(...r)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):n.singleCallbackArg||r.length<=1&&!1!==n.singleCallbackArg?t.resolve(r[0]):t.resolve(r)},i=e=>1==e?"argument":"arguments",o=(e,t,n)=>new Proxy(t,{apply:(t,r,s)=>n.call(r,e,...s)});let a=Function.call.bind(Object.prototype.hasOwnProperty);const c=(e,t={},n={})=>{let r=Object.create(null),u={has:(t,n)=>n in e||n in r,get(u,l,g){if(l in r)return r[l];if(!(l in e))return;let d=e[l];if("function"==typeof d)if("function"==typeof t[l])d=o(e,e[l],t[l]);else if(a(n,l)){let t=((e,t)=>function(n,...r){if(r.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${i(t.minArgs)} for ${e}(), got ${r.length}`);if(r.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${i(t.maxArgs)} for ${e}(), got ${r.length}`);return new Promise(((i,o)=>{if(t.fallbackToNoCallback)try{n[e](...r,s({resolve:i,reject:o},t))}catch(s){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,s),n[e](...r),t.fallbackToNoCallback=!1,t.noCallback=!0,i()}else t.noCallback?(n[e](...r),i()):n[e](...r,s({resolve:i,reject:o},t))}))})(l,n[l]);d=o(e,e[l],t)}else d=d.bind(e);else if("object"==typeof d&&null!==d&&(a(t,l)||a(n,l)))d=c(d,t[l],n[l]);else{if(!a(n,"*"))return Object.defineProperty(r,l,{configurable:!0,enumerable:!0,get:()=>e[l],set(t){e[l]=t}}),d;d=c(d,t[l],n["*"])}return r[l]=d,d},set:(t,n,s,i)=>(n in r?r[n]=s:e[n]=s,!0),defineProperty:(e,t,n)=>Reflect.defineProperty(r,t,n),deleteProperty:(e,t)=>Reflect.deleteProperty(r,t)},l=Object.create(e);return new Proxy(l,u)},u=e=>({addListener(t,n,...r){t.addListener(e.get(n),...r)},hasListener:(t,n)=>t.hasListener(e.get(n)),removeListener(t,n){t.removeListener(e.get(n))}}),l=new r((e=>"function"!=typeof e?e:function(t){const n=c(t,{},{getContent:{minArgs:0,maxArgs:0}});e(n)})),g=new r((e=>"function"!=typeof e?e:function(t,n,r){let s,i,o=!1,a=new Promise((e=>{s=function(t){o=!0,e(t)}}));try{i=e(t,n,s)}catch(e){i=Promise.reject(e)}const c=!0!==i&&((u=i)&&"object"==typeof u&&"function"==typeof u.then);var u;if(!0!==i&&!c&&!o)return!1;return(c?i:a).then((e=>{r(e)}),(e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",r({__mozWebExtensionPolyfillReject__:!0,message:t})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)})),!0})),d=({reject:n,resolve:r},s)=>{e.runtime.lastError?e.runtime.lastError.message===t?r():n(new Error(e.runtime.lastError.message)):s&&s.__mozWebExtensionPolyfillReject__?n(new Error(s.message)):r(s)},m=(e,t,n,...r)=>{if(r.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${i(t.minArgs)} for ${e}(), got ${r.length}`);if(r.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${i(t.maxArgs)} for ${e}(), got ${r.length}`);return new Promise(((e,t)=>{const s=d.bind(null,{resolve:e,reject:t});r.push(s),n.sendMessage(...r)}))},h={devtools:{network:{onRequestFinished:u(l)}},runtime:{onMessage:u(g),onMessageExternal:u(g),sendMessage:m.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:m.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},p={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return n.privacy={network:{"*":p},services:{"*":p},websites:{"*":p}},c(e,h,n)};e.exports=n(chrome)}},void 0===(r=n.apply(t,[e]))||(e.exports=r)}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(131),t=n.n(e),r=function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},r.apply(this,arguments)};function s(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return o}function i(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e}var o=n(167);function a(){var e=(0,o.V)(),t=e.crypto||e.msCrypto;if(void 0!==t&&t.getRandomValues){var n=new Uint16Array(8);t.getRandomValues(n),n[3]=4095&n[3]|16384,n[4]=16383&n[4]|32768;var r=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return r(n[0])+r(n[1])+r(n[2])+r(n[3])+r(n[4])+r(n[5])+r(n[6])+r(n[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}var c,u=n(461),l="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,g=(0,o.V)(),d=["debug","info","warn","error","log","assert"];function m(e){var t=(0,o.V)();if(!("console"in t))return e();var n=t.console,r={};d.forEach((function(e){var s=n[e]&&n[e].__sentry_original__;e in t.console&&s&&(r[e]=n[e],n[e]=s)}));try{return e()}finally{Object.keys(r).forEach((function(e){n[e]=r[e]}))}}function h(){var e=!1,t={enable:function(){e=!0},disable:function(){e=!1}};return l?d.forEach((function(n){t[n]=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e&&m((function(){var e;(e=g.console)[n].apply(e,i(["Sentry Logger ["+n+"]:"],t))}))}})):d.forEach((function(e){t[e]=function(){}})),t}c=l?(0,o.B)("logger",h):h();var p=n(822),f="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,A=Object.prototype.toString;function _(e){return function(e,t){return A.call(e)==="[object "+t+"]"}(e,"Object")}function v(e){return Boolean(e&&e.then&&"function"==typeof e.then)}var x=function(){function e(e){var t=this;this._state=0,this._handlers=[],this._resolve=function(e){t._setResult(1,e)},this._reject=function(e){t._setResult(2,e)},this._setResult=function(e,n){0===t._state&&(v(n)?n.then(t._resolve,t._reject):(t._state=e,t._value=n,t._executeHandlers()))},this._executeHandlers=function(){if(0!==t._state){var e=t._handlers.slice();t._handlers=[],e.forEach((function(e){e[0]||(1===t._state&&e[1](t._value),2===t._state&&e[2](t._value),e[0]=!0)}))}};try{e(this._resolve,this._reject)}catch(e){this._reject(e)}}return e.prototype.then=function(t,n){var r=this;return new e((function(e,s){r._handlers.push([!1,function(n){if(t)try{e(t(n))}catch(e){s(e)}else e(n)},function(t){if(n)try{e(n(t))}catch(e){s(e)}else s(t)}]),r._executeHandlers()}))},e.prototype.catch=function(e){return this.then((function(e){return e}),e)},e.prototype.finally=function(t){var n=this;return new e((function(e,r){var s,i;return n.then((function(e){i=!1,s=e,t&&t()}),(function(e){i=!0,s=e,t&&t()})).then((function(){i?r(s):e(s)}))}))},e}(),b=function(){function e(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={}}return e.clone=function(t){var n=new e;return t&&(n._breadcrumbs=i(t._breadcrumbs),n._tags=r({},t._tags),n._extra=r({},t._extra),n._contexts=r({},t._contexts),n._user=t._user,n._level=t._level,n._span=t._span,n._session=t._session,n._transactionName=t._transactionName,n._fingerprint=t._fingerprint,n._eventProcessors=i(t._eventProcessors),n._requestSession=t._requestSession),n},e.prototype.addScopeListener=function(e){this._scopeListeners.push(e)},e.prototype.addEventProcessor=function(e){return this._eventProcessors.push(e),this},e.prototype.setUser=function(e){return this._user=e||{},this._session&&this._session.update({user:e}),this._notifyScopeListeners(),this},e.prototype.getUser=function(){return this._user},e.prototype.getRequestSession=function(){return this._requestSession},e.prototype.setRequestSession=function(e){return this._requestSession=e,this},e.prototype.setTags=function(e){return this._tags=r(r({},this._tags),e),this._notifyScopeListeners(),this},e.prototype.setTag=function(e,t){var n;return this._tags=r(r({},this._tags),((n={})[e]=t,n)),this._notifyScopeListeners(),this},e.prototype.setExtras=function(e){return this._extra=r(r({},this._extra),e),this._notifyScopeListeners(),this},e.prototype.setExtra=function(e,t){var n;return this._extra=r(r({},this._extra),((n={})[e]=t,n)),this._notifyScopeListeners(),this},e.prototype.setFingerprint=function(e){return this._fingerprint=e,this._notifyScopeListeners(),this},e.prototype.setLevel=function(e){return this._level=e,this._notifyScopeListeners(),this},e.prototype.setTransactionName=function(e){return this._transactionName=e,this._notifyScopeListeners(),this},e.prototype.setTransaction=function(e){return this.setTransactionName(e)},e.prototype.setContext=function(e,t){var n;return null===t?delete this._contexts[e]:this._contexts=r(r({},this._contexts),((n={})[e]=t,n)),this._notifyScopeListeners(),this},e.prototype.setSpan=function(e){return this._span=e,this._notifyScopeListeners(),this},e.prototype.getSpan=function(){return this._span},e.prototype.getTransaction=function(){var e=this.getSpan();return e&&e.transaction},e.prototype.setSession=function(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this},e.prototype.getSession=function(){return this._session},e.prototype.update=function(t){if(!t)return this;if("function"==typeof t){var n=t(this);return n instanceof e?n:this}return t instanceof e?(this._tags=r(r({},this._tags),t._tags),this._extra=r(r({},this._extra),t._extra),this._contexts=r(r({},this._contexts),t._contexts),t._user&&Object.keys(t._user).length&&(this._user=t._user),t._level&&(this._level=t._level),t._fingerprint&&(this._fingerprint=t._fingerprint),t._requestSession&&(this._requestSession=t._requestSession)):_(t)&&(this._tags=r(r({},this._tags),t.tags),this._extra=r(r({},this._extra),t.extra),this._contexts=r(r({},this._contexts),t.contexts),t.user&&(this._user=t.user),t.level&&(this._level=t.level),t.fingerprint&&(this._fingerprint=t.fingerprint),t.requestSession&&(this._requestSession=t.requestSession)),this},e.prototype.clear=function(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this},e.prototype.addBreadcrumb=function(e,t){var n="number"==typeof t?Math.min(t,100):100;if(n<=0)return this;var s=r({timestamp:(0,u.lu)()},e);return this._breadcrumbs=i(this._breadcrumbs,[s]).slice(-n),this._notifyScopeListeners(),this},e.prototype.clearBreadcrumbs=function(){return this._breadcrumbs=[],this._notifyScopeListeners(),this},e.prototype.applyToEvent=function(e,t){if(this._extra&&Object.keys(this._extra).length&&(e.extra=r(r({},this._extra),e.extra)),this._tags&&Object.keys(this._tags).length&&(e.tags=r(r({},this._tags),e.tags)),this._user&&Object.keys(this._user).length&&(e.user=r(r({},this._user),e.user)),this._contexts&&Object.keys(this._contexts).length&&(e.contexts=r(r({},this._contexts),e.contexts)),this._level&&(e.level=this._level),this._transactionName&&(e.transaction=this._transactionName),this._span){e.contexts=r({trace:this._span.getTraceContext()},e.contexts);var n=this._span.transaction&&this._span.transaction.name;n&&(e.tags=r({transaction:n},e.tags))}return this._applyFingerprint(e),e.breadcrumbs=i(e.breadcrumbs||[],this._breadcrumbs),e.breadcrumbs=e.breadcrumbs.length>0?e.breadcrumbs:void 0,e.sdkProcessingMetadata=this._sdkProcessingMetadata,this._notifyEventProcessors(i((0,o.B)("globalEventProcessors",(function(){return[]})),this._eventProcessors),e,t)},e.prototype.setSDKProcessingMetadata=function(e){return this._sdkProcessingMetadata=r(r({},this._sdkProcessingMetadata),e),this},e.prototype._notifyEventProcessors=function(e,t,n,s){var i=this;return void 0===s&&(s=0),new x((function(o,a){var c=e[s];if(null===t||"function"!=typeof c)o(t);else{var u=c(r({},t),n);v(u)?u.then((function(t){return i._notifyEventProcessors(e,t,n,s+1).then(o)})).then(null,a):i._notifyEventProcessors(e,u,n,s+1).then(o).then(null,a)}}))},e.prototype._notifyScopeListeners=function(){var e=this;this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((function(t){t(e)})),this._notifyingListeners=!1)},e.prototype._applyFingerprint=function(e){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],this._fingerprint&&(e.fingerprint=e.fingerprint.concat(this._fingerprint)),e.fingerprint&&!e.fingerprint.length&&delete e.fingerprint},e}();function y(e){var t,n;if(_(e)){var r={};try{for(var s=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(Object.keys(e)),i=s.next();!i.done;i=s.next()){var o=i.value;void 0!==e[o]&&(r[o]=y(e[o]))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return r}return Array.isArray(e)?e.map(y):e}var w=function(){function e(e){this.errors=0,this.sid=a(),this.duration=0,this.status="ok",this.init=!0,this.ignoreDuration=!1;var t=(0,u.zf)();this.timestamp=t,this.started=t,e&&this.update(e)}return e.prototype.update=function(e){if(void 0===e&&(e={}),e.user&&(!this.ipAddress&&e.user.ip_address&&(this.ipAddress=e.user.ip_address),this.did||e.did||(this.did=e.user.id||e.user.email||e.user.username)),this.timestamp=e.timestamp||(0,u.zf)(),e.ignoreDuration&&(this.ignoreDuration=e.ignoreDuration),e.sid&&(this.sid=32===e.sid.length?e.sid:a()),void 0!==e.init&&(this.init=e.init),!this.did&&e.did&&(this.did=""+e.did),"number"==typeof e.started&&(this.started=e.started),this.ignoreDuration)this.duration=void 0;else if("number"==typeof e.duration)this.duration=e.duration;else{var t=this.timestamp-this.started;this.duration=t>=0?t:0}e.release&&(this.release=e.release),e.environment&&(this.environment=e.environment),!this.ipAddress&&e.ipAddress&&(this.ipAddress=e.ipAddress),!this.userAgent&&e.userAgent&&(this.userAgent=e.userAgent),"number"==typeof e.errors&&(this.errors=e.errors),e.status&&(this.status=e.status)},e.prototype.close=function(e){e?this.update({status:e}):"ok"===this.status?this.update({status:"exited"}):this.update()},e.prototype.toJSON=function(){return y({sid:""+this.sid,init:this.init,started:new Date(1e3*this.started).toISOString(),timestamp:new Date(1e3*this.timestamp).toISOString(),status:this.status,errors:this.errors,did:"number"==typeof this.did||"string"==typeof this.did?""+this.did:void 0,duration:this.duration,attrs:{release:this.release,environment:this.environment,ip_address:this.ipAddress,user_agent:this.userAgent}})},e}(),S=4,k=function(){function e(e,t,n){void 0===t&&(t=new b),void 0===n&&(n=S),this._version=n,this._stack=[{}],this.getStackTop().scope=t,e&&this.bindClient(e)}return e.prototype.isOlderThan=function(e){return this._version<e},e.prototype.bindClient=function(e){this.getStackTop().client=e,e&&e.setupIntegrations&&e.setupIntegrations()},e.prototype.pushScope=function(){var e=b.clone(this.getScope());return this.getStack().push({client:this.getClient(),scope:e}),e},e.prototype.popScope=function(){return!(this.getStack().length<=1||!this.getStack().pop())},e.prototype.withScope=function(e){var t=this.pushScope();try{e(t)}finally{this.popScope()}},e.prototype.getClient=function(){return this.getStackTop().client},e.prototype.getScope=function(){return this.getStackTop().scope},e.prototype.getStack=function(){return this._stack},e.prototype.getStackTop=function(){return this._stack[this._stack.length-1]},e.prototype.captureException=function(e,t){var n=this._lastEventId=t&&t.event_id?t.event_id:a(),s=t;if(!t){var i=void 0;try{throw new Error("Sentry syntheticException")}catch(e){i=e}s={originalException:e,syntheticException:i}}return this._invokeClient("captureException",e,r(r({},s),{event_id:n})),n},e.prototype.captureMessage=function(e,t,n){var s=this._lastEventId=n&&n.event_id?n.event_id:a(),i=n;if(!n){var o=void 0;try{throw new Error(e)}catch(e){o=e}i={originalException:e,syntheticException:o}}return this._invokeClient("captureMessage",e,t,r(r({},i),{event_id:s})),s},e.prototype.captureEvent=function(e,t){var n=t&&t.event_id?t.event_id:a();return"transaction"!==e.type&&(this._lastEventId=n),this._invokeClient("captureEvent",e,r(r({},t),{event_id:n})),n},e.prototype.lastEventId=function(){return this._lastEventId},e.prototype.addBreadcrumb=function(e,t){var n=this.getStackTop(),s=n.scope,i=n.client;if(s&&i){var o=i.getOptions&&i.getOptions()||{},a=o.beforeBreadcrumb,c=void 0===a?null:a,l=o.maxBreadcrumbs,g=void 0===l?100:l;if(!(g<=0)){var d=(0,u.lu)(),h=r({timestamp:d},e),p=c?m((function(){return c(h,t)})):h;null!==p&&s.addBreadcrumb(p,g)}}},e.prototype.setUser=function(e){var t=this.getScope();t&&t.setUser(e)},e.prototype.setTags=function(e){var t=this.getScope();t&&t.setTags(e)},e.prototype.setExtras=function(e){var t=this.getScope();t&&t.setExtras(e)},e.prototype.setTag=function(e,t){var n=this.getScope();n&&n.setTag(e,t)},e.prototype.setExtra=function(e,t){var n=this.getScope();n&&n.setExtra(e,t)},e.prototype.setContext=function(e,t){var n=this.getScope();n&&n.setContext(e,t)},e.prototype.configureScope=function(e){var t=this.getStackTop(),n=t.scope,r=t.client;n&&r&&e(n)},e.prototype.run=function(e){var t=E(this);try{e(this)}finally{E(t)}},e.prototype.getIntegration=function(e){var t=this.getClient();if(!t)return null;try{return t.getIntegration(e)}catch(t){return f&&c.warn("Cannot retrieve integration "+e.id+" from the current Hub"),null}},e.prototype.startSpan=function(e){return this._callExtensionMethod("startSpan",e)},e.prototype.startTransaction=function(e,t){return this._callExtensionMethod("startTransaction",e,t)},e.prototype.traceHeaders=function(){return this._callExtensionMethod("traceHeaders")},e.prototype.captureSession=function(e){if(void 0===e&&(e=!1),e)return this.endSession();this._sendSessionUpdate()},e.prototype.endSession=function(){var e=this.getStackTop(),t=e&&e.scope,n=t&&t.getSession();n&&n.close(),this._sendSessionUpdate(),t&&t.setSession()},e.prototype.startSession=function(e){var t=this.getStackTop(),n=t.scope,s=t.client,i=s&&s.getOptions()||{},a=i.release,c=i.environment,u=((0,o.V)().navigator||{}).userAgent,l=new w(r(r(r({release:a,environment:c},n&&{user:n.getUser()}),u&&{userAgent:u}),e));if(n){var g=n.getSession&&n.getSession();g&&"ok"===g.status&&g.update({status:"exited"}),this.endSession(),n.setSession(l)}return l},e.prototype._sendSessionUpdate=function(){var e=this.getStackTop(),t=e.scope,n=e.client;if(t){var r=t.getSession&&t.getSession();r&&n&&n.captureSession&&n.captureSession(r)}},e.prototype._invokeClient=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var s=this.getStackTop(),o=s.scope,a=s.client;a&&a[e]&&(t=a)[e].apply(t,i(n,[o]))},e.prototype._callExtensionMethod=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=T().__SENTRY__;if(r&&r.extensions&&"function"==typeof r.extensions[e])return r.extensions[e].apply(this,t);f&&c.warn("Extension method "+e+" couldn't be found, doing nothing.")},e}();function T(){var e=(0,o.V)();return e.__SENTRY__=e.__SENTRY__||{extensions:{},hub:void 0},e}function E(e){var t=T(),n=P(t);return O(t,e),n}function I(e){return!!(e&&e.__SENTRY__&&e.__SENTRY__.hub)}function P(e){return(0,o.B)("hub",(function(){return new k}),e)}function O(e,t){return!!e&&((e.__SENTRY__=e.__SENTRY__||{}).hub=t,!0)}function C(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,s=(I(r=T())&&!P(r).isOlderThan(S)||O(r,new k),(0,p.wD)()?function(e){try{var t=T().__SENTRY__,n=t&&t.extensions&&t.extensions.domain&&t.extensions.domain.active;if(!n)return P(e);if(!I(n)||P(n).isOlderThan(S)){var r=P(e).getStackTop();O(n,new k(r.client,b.clone(r.scope)))}return P(n)}catch(t){return P(e)}}(r):P(r));if(s&&s[e])return s[e].apply(s,i(t));throw new Error("No hub defined or "+e+" was not found on the hub, please open a bug report.")}const R=function(e,t={},n={}){L.init().then((()=>{var r;L.get("bugReport")&&C("captureException",r=e,{captureContext:{extra:t,tags:n},originalException:r,syntheticException:new Error("Sentry syntheticException")})}))},N=function(e,t={},n={}){L.init().then((()=>{L.get("bugReport")&&function(e,t){var n=new Error(e);C("captureMessage",e,"string"==typeof t?t:void 0,r({originalException:e,syntheticException:n},"string"!=typeof t?{captureContext:t}:void 0))}(e,{extra:t,tags:n})}))},$={debounce:(e,t)=>{let n;return function(){const r=this,s=arguments;n&&clearTimeout(n),n=setTimeout((function(){e.apply(r,s),n=null}),t||1e3)}},parseJson:e=>{let t;try{t=JSON.parse(e)}catch(t){R(t,{jsonWasAnEmptyString:""===e,jsonWasUndefined:void 0===e,jsonWasNull:null===e}),B.warn("Invalid JSON: could not parse "+e)}return t},getParent:function(e,t){for(;e&&!e.matches(t);)e=e.parentElement;return e},hasParent:function(e,t){return!!$.getParent(e,t)},matchesOrHasParent:function(e,t){return e.matches(t)||$.hasParent(e,t)},getPossibleUrls:function({id:e,url:t}){return[t,`about:reader?url=${encodeURIComponent(t)}`,`https://app.getpocket.com/read/${t}`,`https://app.getpocket.com/read/${e}`,`https://getpocket.com/read/${e}`,new RegExp(`https://getpocket.com/[a-z]+/read/${e}`,"gi")]},hashCode:function(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t>>>0},domain:function(e){const t=document.createElement("a");return t.setAttribute("href",e),t.hostname},getType:function(e){return null===e?"null":Array.isArray(e)?`Array(${e.length})`:typeof e}},M=$;const j=function(){let e={};const n={debugMode:!1,bugReport:!1,openInNewTab:!0,perPage:"50",showBadge:!0,showPageAction:!0,zoomLevel:"12px",archiveWhenOpened:!1,closeTabWhenAdded:!1,closeTabWhenRead:!1};return{init:function(){return function(){return r=this,s=void 0,o=function*(){const r=yield t().storage.local.get("settings");e=Object.assign(e,n),r&&r.settings&&(e=Object.assign(e,M.parseJson(r.settings)||{}))},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(o.next(e))}catch(e){t(e)}}function a(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(n,a)}c((o=o.apply(r,s||[])).next())}));var r,s,i,o}()},get:function(t){return t?e[t]:e},set:function(t,n){return e[t]=n,!0},save:function(){return t().storage.local.set({settings:JSON.stringify(e)}),!0}}}(),L=j,B=function(){const e="IMP | ";function t(){return L.init().then((function(){const e=L.get("debugMode");return!0===e?e:Promise.reject()}))}return{log:function(n){t().then((()=>{console.log(e+n)})).catch((function(){}))},warn:function(n){t().then((()=>{console.warn(e+n)})).catch((function(){}))},error:function(t){console.error(e+t)}}}(),U=function(){function e(e){B.log(`(ContextMenu.enable) enable ${e} context menu`);const n=t().contextMenus.update(e,{enabled:!0}),r=t().contextMenus.update(e,{visible:!0});return Promise.all([n,r])}function n(e){B.log(`(ContextMenu.enable) disable ${e} context menu`);const n=t().contextMenus.update(e,{enabled:!1}),r=t().contextMenus.update(e,{visible:!1});return Promise.all([n,r])}function r(){const e=t().contextMenus.ContextType,n=[e.PAGE,e.LINK];return e.TAB&&t().contextMenus.onShown&&n.push(e.TAB),n}return{addId:"inmypocket-add-item",archiveId:"inmypocket-archive-item",deleteId:"inmypocket-delete-item",pageAlreadyInPocket:"PAGE_ALREADY_IN_POCKET",pageNotInPocket:"PAGE_NOT_IN_POCKET",multipleTabSelection:"MULTIPLE_TABS_SELECTION",createEntries:function(){B.log("(ContextMenu.createEntries) create all right-click entries"),t().contextMenus.create({contexts:r(),id:U.addId,title:"Add to Pocket",icons:{16:"assets/icons/ionicons-android-add-circle.svg"}}),t().contextMenus.create({contexts:r(),id:U.archiveId,title:"Mark as read",icons:{16:"assets/icons/ionicons-checkmark.svg"}}),t().contextMenus.create({contexts:r(),id:U.deleteId,title:"Delete",icons:{16:"assets/icons/ionicons-trash-b.svg"}})},destroyEntries:function(){B.log("(ContextMenu.destroyEntries) destroy all right-click entries"),t().contextMenus.removeAll()},setState:function(t){switch(t){case U.pageAlreadyInPocket:return Promise.all([n(U.addId),e(U.archiveId),e(U.deleteId)]);case U.pageNotInPocket:case U.multipleTabSelection:return Promise.all([e(U.addId),n(U.archiveId),n(U.deleteId)])}}}}(),q=U,D=function(){const e="⌟⌞⌜⌝";let n,r;function s(e){return e&&Object.keys(e).length>0?Object.keys(e).length.toString():""}function i(){B.log("(stopLoadingSpinner)"),r&&(clearInterval(r),r=null)}return{hide:function(){t().browserAction.setBadgeText({text:""})},updateCount:function(e){return new Promise((n=>{i(),L.init().then((function(){if(!0===L.get("showBadge"))if(t().browserAction.setBadgeBackgroundColor({color:"#333"}),e){const r=s(e);t().browserAction.setBadgeText({text:r.toString()}),n()}else t().storage.local.get("items").then((({items:e})=>{const r=s(M.parseJson(e)||[]);t().browserAction.setBadgeText({text:r.toString()}),n()}));else D.hide(),n()}))}))},startLoadingSpinner:function(){r||(B.log("(startLoadingSpinner) will start the spinner now"),r=setInterval((()=>{n=function(){const t=(e.indexOf(n)+1)%4;return e[t]}(),t().browserAction.setBadgeText({text:n})}),150))},flashSuccess:function(){return new Promise((e=>{setTimeout((()=>{i(),t().browserAction.setBadgeText({text:"✓"}),t().browserAction.setBadgeBackgroundColor({color:"#12bc00"}),setTimeout(D.updateCount,1500),e()}),1e3)}))},flashError:function(){return new Promise((e=>{setTimeout((()=>{i(),t().browserAction.setBadgeText({text:"!"}),t().browserAction.setBadgeBackgroundColor({color:"#ff0039"}),setTimeout(D.updateCount,1500),e()}),1e3)}))}}}(),W=D,F=function(){function e(){return new Promise(((e,t)=>{L.init().then((()=>{const n=L.get("showPageAction");B.log(`page action enabled ? ${n}`),n?e():t()}))}))}return{redraw:function(n,r){e().then((()=>{t().storage.local.get("items").then((({items:e})=>{ee.contains(e,r)?F.drawEnabled(n):F.drawDisabled(n),F.show(n)}))}))},redrawAllTabs:function(){e().then((()=>{t().tabs.query({}).then((function(e){for(const t of e)t.url&&F.redraw(t.id,t.url)}))}))},drawEnabled:function(...n){e().then((()=>{n.forEach((e=>{t().pageAction.setIcon({tabId:e,path:{19:"assets/icons/page-action-enabled.svg",38:"assets/icons/page-action-enabled.svg"}}),t().pageAction.setTitle({tabId:e,title:"Mark as read"})}))}))},drawDisabled:function(...n){e().then((()=>{n.forEach((e=>{t().pageAction.setIcon({tabId:e,path:{19:"assets/icons/page-action-disabled.svg",38:"assets/icons/page-action-disabled.svg"}}),t().pageAction.setTitle({tabId:e,title:"Add to pocket"})}))}))},show:function(n){e().then((()=>{t().pageAction.show(n)}))},hideAllTabs:function(){t().tabs.query({}).then((e=>{for(const n of e)n.id&&t().pageAction.hide(n.id)}))},toggle:function(n){e().then((()=>{t().storage.local.get("items").then((({items:e})=>{const r=ee.findByUrl(e,n.url);r?t().tabs.query({active:!0,currentWindow:!0}).then((([e])=>{ee.markAsRead(r.id,e.id)})):ee.addItem([{url:n.url,title:n.title,tabId:n.id}])}))}))}}}(),J=F,Y="58817-addc87503598b7ed29e5bf72",H="already_in_list",V=["http","https","ftp","ftps"],z=class{constructor(e,t,n){this.action=e,this.url=t,this.params=n,this.defaultHeaders={"Content-type":"application/json; charset=UTF-8","X-Accept":"application/json"}}hasErrorHeaders(e){return!!e.headers.get("X-Error")||!!e.headers.get("X-Error-Code")}buildErrorObject(e){const t={url:this.url,httpCode:e.status,xErrorHeader:e.headers.get("X-Error"),xErrorCodeHeader:e.headers.get("X-Error-Code")};switch(e.status){case 200:B.log("200: request was succesful but contains errors");break;case 401:B.error("401: unauthorized"),t.error="unauthorized";break;case 403:{const n=e.headers.get("X-Limit-User-Remaining");if(n&&0===n){const n=e.headers.get("X-Limit-User-Reset");B.error(`403: access_denied (rate limit), reset in ${n} seconds`),t.error="user_rate_limit_reached",t.resetDelay=n}else B.error("403: access_denied (missing permissions)"),t.error="missing_permissions";break}case 404:B.error("404: trying to reach a non-existing URL"),t.error="not_found";break;case 504:B.error("504: timeout"),t.error="timeout";break;default:B.error(`${e.status} http error`),t.error="unknown"}return t}handleSuccesfulResponse(e){const t=e.json();return B.log(`(Request.fetch) Response OK, received data : ${JSON.stringify(t)}`),t}handleFailedResponse(e,t){const n=this.buildErrorObject(e);return B.error(`${t}: ${JSON.stringify(n)}`),N(t,null,n),browser.runtime.sendMessage(n),n}fetch(){return new Promise(((e,t)=>{fetch(this.url,{method:this.action,headers:this.defaultHeaders,body:JSON.stringify(this.params)}).then((n=>{if(B.log(`(Request.fetch) response for ${this.url} - ${n.status}`),n.ok)if(this.hasErrorHeaders(n)){const e=this.handleFailedResponse(n,"(Request.fetch) HTTP response OK but with error headers");t(e)}else{const t=this.handleSuccesfulResponse(n);e(t)}else{const e=this.handleFailedResponse(n,"(Request.fetch) HTTP response not OK");t(e)}})).catch((e=>{R(new Error("(Request.fetch): promise rejected"),e),B.error("(Request.fetch) error while reaching the server or processing the response");const n={error:"generic"};browser.runtime.sendMessage(n),t(n)}))}))}},G=class{constructor(e){this.accessToken=e}add(e){B.log("(PocketApiRequester.add)");const t={consumer_key:Y,access_token:this.accessToken,url:e.url,title:e.title};return new z("POST","https://getpocket.com/v3/add",t).fetch()}addBatch(e){B.log("(PocketApiRequester.addBatch)");const t={consumer_key:Y,access_token:this.accessToken,actions:e.map((e=>({action:"add",url:e.url,title:e.title})))};return new z("POST","https://getpocket.com/v3/send",t).fetch()}archive(e){B.log("(PocketApiRequester.archive)");const t={consumer_key:Y,access_token:this.accessToken,actions:[{action:"archive",item_id:e}]};return new z("POST","https://getpocket.com/v3/send",t).fetch()}delete(e){B.log("(PocketApiRequester.delete)");const t={consumer_key:Y,access_token:this.accessToken,actions:[{action:"delete",item_id:e}]};return new z("POST","https://getpocket.com/v3/send",t).fetch()}favorite(e){B.log("(PocketApiRequester.favorite)");const t={consumer_key:Y,access_token:this.accessToken,actions:[{action:"favorite",item_id:e}]};return new z("POST","https://getpocket.com/v3/send",t).fetch()}unfavorite(e){B.log("(PocketApiRequester.unfavorite)");const t={consumer_key:Y,access_token:this.accessToken,actions:[{action:"unfavorite",item_id:e}]};return new z("POST","https://getpocket.com/v3/send",t).fetch()}update(e,{title:t,tags:n=[],previousTags:r=[],url:s,created_at:i}){B.log(`(PocketApiRequester.update) ${e} - ${t} - ${n} - ${s}`);const o=[{action:"add",item_id:e,title:t,url:s,time:i}],a=n.filter((e=>!r.includes(e))),c=r.filter((e=>!n.includes(e)));a.length>0&&o.push({action:"tags_add",item_id:e,tags:a}),c.length>0&&o.push({action:"tags_remove",item_id:e,tags:c});const u={consumer_key:Y,access_token:this.accessToken,actions:o};return new z("POST","https://getpocket.com/v3/send",u).fetch()}};var K,X,Z;!function(e){e[e.closeWhenAdded=0]="closeWhenAdded",e[e.closeWhenRead=1]="closeWhenRead"}(K||(K={})),function(e){e[e.archive=0]="archive",e[e.delete=1]="delete"}(X||(X={})),function(e){e.toggle="toggle-page-status",e.openPopup="_execute_browser_action",e.openFirstItem="open-first-item",e.openRandomItem="open-random-item"}(Z||(Z={}));const Q=function(){let e=null,n=null;function r(t){const r=t?M.hashCode(t):0;return B.log(`(Items.parseItems) checksum: "${e}"; new: "${r}"`),r!=e&&(B.log("(Items.parsedItems) checksum changed, parse the items"),e=r,n=M.parseJson(t)),n||[]}function s(e,n,r){B.log("(Items.removeItem) id to remove: "+e),W.startLoadingSpinner(),t().storage.local.get(["access_token","items"]).then((({access_token:s,items:i})=>{const a=new G(s);(n==X.archive?a.archive(e):a.delete(e)).then((s=>{const a=M.parseJson(i)||[],c=a.findIndex((t=>t.id===e)),u=a[c];if(c>=0){B.log(`(Items.removeItem) item ${e} has been found and removed`),a.splice(c,1),t().storage.local.set({items:JSON.stringify(a)});const s=n==X.archive?"marked-as-read":"deleted";t().runtime.sendMessage({action:s,id:e}).catch((e=>B.warn(`'action: ${s}' message could not be delivered: ${e}`))),W.flashSuccess().then((()=>{r&&t().tabs.get(r).then((e=>{const t=M.getPossibleUrls(u).filter((e=>"string"==typeof e));e.url&&t.includes(e.url)&&o(e.id,K.closeWhenRead)})),B.log("(Items.removeItem) item removed, update matching pageActions");const e=M.getPossibleUrls(u).filter((e=>"string"==typeof e));t().tabs.query({url:e}).then((e=>{const t=e.map((e=>e.id));J.drawDisabled(...t)}))}))}else B.warn(`(Items.removeItem) item ${e} could not be found!`),W.updateCount()})).catch((e=>{R(e),B.error(`(Items.removeItem) Error while removing item: ${e}`),W.flashError()}))}))}function i(e,n){B.log(`(Items.setFavorite) action='${n}'`),t().storage.local.get(["access_token","items"]).then((({access_token:r,items:s})=>{W.startLoadingSpinner();const i=new G(r);("favorite"===n?i.favorite(e):i.unfavorite(e)).then((r=>{const i=M.parseJson(s)||[];i.find((t=>t.id==e)).fav="favorite"===n?"1":"0",t().storage.local.set({items:JSON.stringify(i)});const o=`${n}d`;t().runtime.sendMessage({action:o,id:e}).catch((e=>B.warn(`'action: ${o}' message could not be delivered: ${e}`))),W.flashSuccess()})).catch((e=>{R(e),B.error(`(Items.setFavorite) Error for action ${n} : ${e}`),W.flashError()}))}))}function o(e,n){L.init().then((()=>{let r;switch(n){case K.closeWhenAdded:r=L.get("closeTabWhenAdded");break;case K.closeWhenRead:r=L.get("closeTabWhenRead");break;default:return void R(new Error(`closeTabsIfNeeded called with unknown event ${n}`))}r&&setTimeout((()=>{t().tabs.remove(e).then((()=>{B.log(`(Items.closeTabsIfNeeded) succesfully closed the tabs ${e}`)})).catch((t=>{B.warn(`(Items.closeTabsIfNeeded) could not close all the tabs ${e}`),B.warn(`(Items.closeTabsIfNeeded) Error: ${t}`),R(t)}))}),100)}))}return{formatFetchedPocketItemForStorage:function(e){return{id:e.item_id,title:e.given_title||e.resolved_title,url:e.given_url||e.resolved_url,fav:e.favorite,created_at:e.time_added,updated_at:e.time_updated,tags:Object.keys(e.tags||{})}},formatPocketItemForDebug:function(e){return{id:e.item_id,status:e.status,favorite:e.favorite,timeAdded:e.time_added,timeUpdated:e.time_updated,hasGivenTitle:!!e.given_title,hasResolvedTitle:!!e.resolved_title,hasGivenUrl:!!e.given_url,hasResolvedUrl:!!e.resolved_url,hasTags:Object.keys(e.tags||{}).length>0}},filter:function(e,t,n){return B.log(`(Items.filter) query=${t}, currentUrl=${n}`),r(e).filter((e=>{let r=!0;return n&&(r=r&&!Q.matches(e,n)),t&&(r=r&&function(e,t){const n=t.toLowerCase(),r=n.includes("is:faved"),s=n.includes("is:unfaved"),i=n.includes("is:tagged"),o=n.includes("is:untagged"),a=n.replace(/is:(faved|unfaved|tagged|untagged)/g,"").trim();return function(e,t,n){return t?"1"===e.fav:!n||"0"===e.fav||!e.fav}(e,r,s)&&function(e,t,n){return t?e.tags&&e.tags.length>0:!n||!e.tags||0===e.tags.length}(e,i,o)&&function(e,t){if(""===t)return!0;const n=V.join("|"),r=new RegExp(`^(${n})://(www.)?`,"gi"),s=(e.url.replace(r,"")||"").toLowerCase(),i=(e.title||"").toLowerCase(),o=e.tags?e.tags.map((e=>e.toLowerCase())):[];return i.includes(t)||s.includes(t)||o.some((e=>e.includes(t)))}(e,a)}(e,t)),r}))},contains:function(e,t){return r(e).some((e=>Q.matches(e,t)))},findByUrl:function(e,t){return r(e||"").find((e=>Q.matches(e,t)))},findById:function(e,t){return r(e||"").find((e=>e.id===t))},paginate:function(e,t,n){const r=e.length,s=e.sort(((e,t)=>t.created_at-e.created_at));if(!n||0===r)return s;const i=Math.ceil(r/n);if(!(t<=0||t>i)){const e=(t-1)*n,r=t*n-1;return s.slice(e,r+1)}B.warn(`Could not get page ${t} (${r} items, asked ${n} per page)`)},favoriteItem:function(e){i(e,"favorite")},unfavoriteItem:function(e){i(e,"unfavorite")},updateItem:function(e,n){B.log(`(Items.updateItem) Item '${e}'`),t().storage.local.get(["access_token","items"]).then((({access_token:r,items:s})=>{W.startLoadingSpinner(),new G(r).update(e,n).then((r=>{const i=M.parseJson(s)||[],o=i.find((t=>t.id==e));o.title=n.title,o.tags=n.tags,t().storage.local.set({items:JSON.stringify(i)}),t().runtime.sendMessage({action:"updated",id:e}).catch((e=>B.warn(`'action: updated' message could not be delivered: ${e}`))),W.flashSuccess()})).catch((e=>{R(e),B.error(`(Items.updateItem) Error for update : ${e}`),W.flashError()}))}))},addItem:function(e){B.log(`(Items.addItem) Trying to add ${e.length} items to Pocket`),t().storage.local.get(["access_token","items"]).then((({access_token:n,items:r})=>{const s=e.filter((e=>!Q.contains(r,e.url)));if(0===s.length)return void t().runtime.sendMessage({notice:H}).catch((e=>B.warn(`'notice: ${H}' message could not be delivered: ${e}`)));W.startLoadingSpinner();const i=new G(n);(1===s.length?i.add(s[0]):i.addBatch(s)).then((e=>{const n=M.parseJson(r)||[],i=(a=e,1===s.length?a.item?[a.item]:[a]:a.action_results);var a;const c=function(e,t){return e.map((e=>{if(!e.title){const n=t.find((t=>e.given_url==t.url));e.title=n&&n.title||"—"}return e}))}(i,s);!function(e,t,n){if(e!=n.length){const r=Object.keys(t).map((e=>{const n=t[e];return`${e}: ${M.getType(n)}`})),s={action:1===e?"add":"addBatch",itemsToAdd:e,addedItems:n.length,nonNullAddedItems:n.filter(Boolean).length,responseStatus:t.status,responseKeys:r};R(new Error("addItem: 200 response but unexpected number of items"),s)}}(s.length,e,i),c.forEach((e=>{var t;n.push({id:(t=e).item_id,title:t.title,url:t.given_url,tags:[],fav:"0",created_at:Date.now()/1e3|0,updated_at:Date.now()/1e3|0})})),t().storage.local.set({items:JSON.stringify(n)});const u=i.map((e=>e.item_id));t().runtime.sendMessage({action:"added-item",id:u}).catch((e=>B.warn(`'action: added-item, id: ${u}' message could not be delivered: ${e}`))),W.flashSuccess().then((()=>{o(s.map((e=>e.tabId)).filter(Boolean),K.closeWhenAdded),B.log("(Items.addItem) new items added, update matching pageActions");const e=c.flatMap((e=>M.getPossibleUrls({id:e.id,url:e.given_url}).filter((e=>"string"==typeof e))));t().tabs.query({url:e}).then((e=>{const t=e.map((e=>e.id));J.drawEnabled(...t)}))}))})).catch((e=>{R(e),B.error(`(Items.addItem) Error while adding item: ${e}`),W.flashError()}))}))},markAsRead:function(e,t){s(e,X.archive,t)},deleteItem:function(e,t){s(e,X.delete,t)},openItem:(e,...n)=>{return r=this,s=[e,...n],o=function*(e,n=!1,r){yield L.init();const s=L.get("openInNewTab")||n,i=L.get("archiveWhenOpened"),o={url:e.url};if(s)t().tabs.create(o);else{const e=r&&(yield r());e?t().tabs.update(e.id,o):t().tabs.update(o)}i&&Q.markAsRead(e.id)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(o.next(e))}catch(e){t(e)}}function a(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(n,a)}c((o=o.apply(r,s||[])).next())}));var r,s,i,o},openRandom:function(e=""){const n=t().tabs.query({active:!0,currentWindow:!0}).then((([e])=>e));t().storage.local.get("items").then((({items:t})=>{const r=Q.filter(t,e);if(r.length>0){const e=r[Math.floor(Math.random()*r.length)];Q.openItem(e,void 0,(()=>n))}}))},openFirst:function(e=""){t().storage.local.get("items").then((({items:t})=>{const n=Q.filter(t,e);if(n.length>0){const e=n.sort(((e,t)=>t.created_at-e.created_at))[0];Q.openItem(e)}}))},areSame:function(e,t){const n=e.title===t.title,r=(e.tags||[]).sort(),s=(t.tags||[]).sort(),i=JSON.stringify(r)===JSON.stringify(s);return n&&i},matches:function(e,t){return M.getPossibleUrls(e).some((e=>"string"==typeof e?e===t:e instanceof RegExp?e.test(t):(N("possibleUrl is neither a string nor a regexp",{typeofUrl:typeof e,urlWasAnArray:Array.isArray(e),urlWasAnObject:"object"==typeof e&&!Array.isArray(e),urlWasUndefined:void 0===e,urlWasNull:null===e}),!1)))}}}(),ee=Q;browser.contextMenus.onClicked.addListener(((e,t)=>{switch(e.menuItemId){case q.addId:e.linkUrl?ee.addItem([{url:e.linkUrl}]):browser.tabs.query({currentWindow:!0,highlighted:!0}).then((e=>{const n=e.length>1,r=e.some((e=>e.url==t.url));if(n&&r){const t=e.map((e=>({tabId:e.id,url:e.url,title:e.title})));ee.addItem(t)}else ee.addItem([{tabId:t.id,url:t.url,title:t.title}])}));break;case q.archiveId:browser.storage.local.get("items").then((({items:n})=>{const r=ee.findByUrl(n,e.linkUrl||t.url);r&&browser.tabs.query({active:!0,currentWindow:!0}).then((([e])=>{ee.markAsRead(r.id,e.id)}))}));break;case q.deleteId:browser.storage.local.get("items").then((({items:t})=>{const n=ee.findByUrl(t,e.linkUrl||e.pageUrl);n&&browser.tabs.query({active:!0,currentWindow:!0}).then((([e])=>{ee.deleteItem(n.id,e.id)}))}))}})),browser.contextMenus.onShown?browser.contextMenus.onShown.addListener(((e,t)=>{const n=e.linkUrl?e.linkUrl:t.url;browser.tabs.query({currentWindow:!0,highlighted:!0}).then((e=>{const r=e.length>1,s=e.some((e=>e.url==t.url));r&&s?(B.log("(background.onShown) multiple tabs selected, right-clicked one of them"),q.setState(q.multipleTabSelection).then((()=>{browser.contextMenus.refresh()}))):browser.storage.local.get("items").then((({items:e})=>{ee.contains(e,n)?(B.log(`(background.onShown) update contextMenu for ${n} that IS in my list`),q.setState(q.pageAlreadyInPocket).then((()=>{browser.contextMenus.refresh()}))):(B.log(`(background.onShown) update contextMenu for ${n} that ISN'T in my list`),q.setState(q.pageNotInPocket).then((()=>{browser.contextMenus.refresh()})))}))}))})):(browser.tabs.onUpdated.addListener(((e,t)=>{t.hasOwnProperty("url")&&browser.tabs.get(e).then((e=>{e.active&&browser.storage.local.get("items").then((({items:n})=>{ee.contains(n,e.url)?(B.log(`(background.tabsOnUpdated) current tab loading ${t.url} that IS in my list`),q.setState(q.pageAlreadyInPocket)):(B.log(`(background.tabsOnUpdated) current tab loading ${t.url} that ISN'T in my list`),q.setState(q.pageNotInPocket))}))}))})),browser.tabs.onActivated.addListener((({tabId:e})=>{browser.tabs.get(e).then((e=>e.url)).then((e=>{browser.storage.local.get("items").then((({items:t})=>{ee.contains(t,e)?(B.log(`(background.tabsOnActivated) switch to a tab ${e} that IS in my list`),q.setState(q.pageAlreadyInPocket)):(B.log(`(background.tabsOnActivated) switch to a tab ${e} that ISN'T in my list`),q.setState(q.pageNotInPocket))}))}))})))})()})();
//# sourceMappingURL=context_menus.js.map