!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="./",n(n.s=49)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},t.exports.default=t.exports,t.exports.__esModule=!0,n(e)}t.exports=n,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){"use strict";var r={getBrowser:function(){return window.chrome||chrome||browser}};e.a=r},function(t,e,n){var r=n(22);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){var r=n(30).default,o=n(31);t.exports=function(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?o(t):e},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){"use strict";var r=n(0),o=n.n(r),s=n(1),i=n.n(s),a=function(){function t(e){o()(this,t),this.target=e,this.events={}}return i()(t,[{key:"addListener",value:function(t,e,n){void 0===this.events[t]&&(this.events[t]=[]),this.events[t].push({caller:e,thisArg:n||this.target})}},{key:"addExclusiveListener",value:function(t,e,n){this.events[t]=[],this.events[t].push({caller:e,thisArg:n||this.target})}},{key:"dispatch",value:function(t,e){var n="[object Array]"===Object.prototype.toString.call(e)?e:[];this.events[t]&&this.events[t].forEach((function(t){t.caller.apply(t.thisArg,n)}))}},{key:"removeEventListener",value:function(t,e){var n=this;this.events[t]&&this.events[t].forEach((function(r,o){r.caller===e&&delete n.events[t][o]}))}},{key:"removeListener",value:function(t,e){this.removeEventListener(t,e)}},{key:"removeEventListeners",value:function(t){this.events[t]=[]}}]),t}();e.a=a},function(t,e,n){"use strict";var r=n(18);e.a=function(t,e,n){var o={win:{illegals:["<",">",":",'"',"/","\\","|","?","*"],max:200},linux:{illegals:["/","@","#","$","&","'"],max:256},unix:{illegals:["/"],max:256}},s="";if(n+="",t){var i=t.match(/\{[a-z]+\}/gi),a=t;i&&i.length>0&&i.forEach((function(t){var n=t.slice(1,-1),o=function(t,e){var n=r.a.getI18n(),o={id:{content:n.getMessage("id"),key:"illustId",possibleKeys:["illustId","novelId","postId"]},title:{content:n.getMessage("title"),key:"illustTitle",possibleKeys:["illustTitle","novelTitle","postTitle"]},author:{content:n.getMessage("author"),key:"userName",possibleKeys:["userName","illustAuthor"]},authorId:{content:n.getMessage("author_id"),key:"userId",possibleKeys:["userId","illustAuthorId"]},pageNum:{content:n.getMessage("page_num"),key:"pageNum",possibleKeys:["pageNum"]},year:{content:n.getMessage("year"),key:"year",possibleKeys:["year"]},month:{content:n.getMessage("month"),key:"month",possibleKeys:["month"]},day:{content:n.getMessage("day"),key:"day",possibleKeys:["day"]}}[e];if(o)for(var s=o.possibleKeys,i=0,a=s.length;i<a;i++)if(void 0!==t[s[i]])return t[s[i]]}(e,n);void 0!==o&&(a=a.replace(t,o))})),s=a||n}else s=n;return o.win.illegals.concat(o.linux.illegals,o.unix.illegals,"~").forEach((function(t){for(;s.indexOf(t)>-1;)s=s.replace(t,"_")})),0===(s=(s=s.replace(/\.*$/,"")).substr(0,o.win.max)).length?"file_".concat(Date.now()):s}},function(t,e,n){"use strict";function r(t,e,n,r,o,s,i,a){var u,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=n,c._compiled=!0),r&&(c.functional=!0),s&&(c._scopeId="data-v-"+s),i?(u=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(i)},c._ssrRegister=u):o&&(u=a?function(){o.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:o),u)if(c.functional){c._injectStyles=u;var l=c.render;c.render=function(t,e){return u.call(e),l(t,e)}}else{var f=c.beforeCreate;c.beforeCreate=f?[].concat(f,u):[u]}return{exports:t,options:c}}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";var r=n(0),o=n.n(r),s=n(1),i=n.n(s),a=n(5),u=n.n(a),c=n(6),l=n.n(c),f=n(2),d=n.n(f),p=n(3),h=n.n(p);function g(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var o=d()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return l()(this,n)}}var v=function(t){u()(n,t);var e=g(n);function n(t){var r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o()(this,n),(r=e.call(this)).url=t,r.fetchInit=Object.assign({readAsStream:!0},s),r.fetchAbortController=null,r.fetchFallbackAbortSignal=!1,r.response=null,r.responseContentLength=null,r.responseLoadedLength=0,r.responseData=null,r.responseType="arrayBuffer",window.AbortController&&(r.fetchAbortController=new AbortController,r.fetchInit.signal=r.fetchAbortController.signal),r}return i()(n,[{key:"abort",value:function(){this.fetchAbortController&&this.fetchAbortController.abort(),this.fetchFallbackAbortSignal=!0}},{key:"readData",value:function(t){var e=this;this.fetchFallbackAbortSignal?this.dispatch("onerror",[new Error("Request aborted")]):setTimeout((function(){t.read().then((function(n){var r=n.done,o=n.value;if(r)e.dispatch("onload",["arrayBuffer"===e.responseType?new Uint8Array(e.responseData):e.responseData]);else{if("plain"===e.responseType)for(var s=0;;){var i=o.slice(s,s+1e4);if(s+=1e4,!(i.length>0))break;e.responseData+=String.fromCharCode.apply(null,i)}else"arrayBuffer"===e.responseType&&o.forEach((function(t){e.responseData.push(t)}));e.responseLoadedLength+=o.length,e.dispatch("ondata",[o]),e.dispatch("onprogress",[{totalLength:e.responseContentLength,loadedLength:e.responseLoadedLength}]),e.readData(t)}})).catch((function(t){e.dispatch("onerror",[t])}))}))}},{key:"send",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=this.fetchInit.method.toUpperCase();"HEAD"!==r&&"GET"!==r&&e&&(this.fetchInit.body=e),n.globalOptions.headers&&(this.fetchInit.headers?Object.assign(this.fetchInit.headers,n.globalOptions.headers):this.fetchInit.headers=n.globalOptions.headers),fetch(this.url,this.fetchInit).then((function(e){t.response=e;var n=t.getResponseHeader("Content-Length");switch(n&&(t.responseContentLength=parseInt(n)),t.responseType){case"plain":t.responseData="";break;case"arrayBuffer":default:t.responseData=[]}t.readData(t.response.body.getReader())})).catch((function(e){t.dispatch("onerror",[e])}))}},{key:"getResponseHeader",value:function(t){return this.response&&this.response.headers.has(t)?this.response.headers.get(t):null}}],[{key:"setGlobalOptions",value:function(t){n.globalOptions=t}}]),n}(n(7).a);h()(v,"globalOptions",{}),e.a=v},function(t,e,n){"use strict";var r={props:{text:[String,Number],href:String,download:String,title:String,type:{required:!1,type:String}},computed:{buttonColor:function(){return this.type?"button--".concat(this.type):null}}},o=(n(36),n(9)),s=Object(o.a)(r,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("a",{staticClass:"button",class:t.buttonColor,attrs:{href:t.href,download:t.download,title:t.title},on:{click:function(e){return t.$emit("click")}}},[t._t("default",(function(){return[t._v(t._s(t.text))]}))],2)}),[],!1,null,"f63c183a",null);e.a=s.exports},function(t,e){t.exports=Vue},function(t,e,n){"use strict";var r=n(0),o=n.n(r),s=n(1),i=n.n(s),a=n(16),u=n.n(a),c=n(5),l=n.n(c),f=n(6),d=n.n(f),p=n(2),h=n.n(p);function g(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=h()(t);if(e){var o=h()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d()(this,n)}}var v=function(t){l()(n,t);var e=g(n);function n(t){var r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o()(this,n),(r=e.call(this,t,s)).asBlob=!0,r}return i()(n,[{key:"addListener",value:function(t,e,r){u()(h()(n.prototype),"addListener",this).call(this,t,e,r)}},{key:"download",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this;this.addListener("onload",(function(t){e.dispatch("onfinish",[e.asBlob?new Blob([t.buffer],{type:e.getResponseHeader("Content-Type")}):t.buffer])})),this.send(t)}}]),n}(n(10).a);e.a=v},function(t,e,n){"use strict";var r=n(0),o=n.n(r),s=n(1),i=n.n(s),a=function(){function t(e){o()(this,t),this.date=new Date(e)}return i()(t,[{key:"paddingZero",value:function(t){return(t<10?"0":"")+t}},{key:"getYear",value:function(){return this.date.getFullYear()+""}},{key:"getMonth",value:function(){return this.paddingZero(this.date.getMonth()+1)}},{key:"getDay",value:function(){return this.paddingZero(this.date.getDate())}}],[{key:"getDefault",value:function(e){if(NaN===Date.parse(e))throw Error("Invalid date time");return new t(e)}}]),t}();e.a=a},function(t,e,n){"use strict";var r=n(21),o=chrome||browser,s=n(8);e.a={methods:{downloadFile:function(t,e,n){var s=this,i=n.folder,a=void 0===i?null:i,u=n.statType,c=void 0===u?null:u,l=this,f=null;if(t instanceof Blob&&(f=t,t=URL.createObjectURL(t)),this.browserItems.enableExtTakeOverDownloads)r.b.contains({permissions:["downloads"]}).then((function(n){if(n){var i="";if(a?i+=a:l.browserItems.downloadRelativeLocation&&(i+=l.browserItems.downloadRelativeLocation),i+=e,s.isFirefox&&f){var u=new FileReader;u.readAsArrayBuffer(f),u.onload=function(t){o.runtime.sendMessage({action:"download",options:{arrayBuffer:u.result,filename:i,saveAs:l.browserItems.downloadSaveAs}})}}else r.a.download({url:t,filename:i,saveAs:l.browserItems.downloadSaveAs})}else alert("You need grant download permission for downloading using downlads setting in extension")}));else{var d=document.createElement("a");d.setAttribute("href",t),d.setAttribute("download",e),document.body.appendChild(d),d.click(),d.remove()}c&&o.runtime.sendMessage({action:"updateDownloadedStat",args:c})},getSubfolder:function(t,e){var n="";if(t){var r=t.split("/");n=(r=r.map((function(t){return""===t?"":Object(s.a)(t,e,t)}))).join("/")}return n}}}},function(t,e,n){var r=n(32);function o(e,n,s){return"undefined"!=typeof Reflect&&Reflect.get?(t.exports=o=Reflect.get,t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=o=function(t,e,n){var o=r(t,e);if(o){var s=Object.getOwnPropertyDescriptor(o,e);return s.get?s.get.call(n):s.value}},t.exports.default=t.exports,t.exports.__esModule=!0),o(e,n,s||e)}t.exports=o,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){"use strict";var r=n(0),o=n.n(r),s=n(1),i=n.n(s),a=n(3),u=n.n(a),c=function(){function t(){o()(this,t)}return i()(t,null,[{key:"getExtenstion",value:function(e){for(var n=[],r=0,o=(n=(e=e.toLowerCase()).indexOf("; ")>-1?e.split("; "):[e]).length;r<o;r++)if(t.types[n[r]])return t.types[n[r]];return null}}]),t}();u()(c,"types",{"image/png":"png","image/gif":"gif","image/jpeg":"jpg","image/jpg":"jpg","text/plain":"txt","text/html":"html","application/json":"json"}),e.a=c},function(t,e,n){"use strict";var r=n(0),o=n.n(r),s=n(1),i=n.n(s),a=n(3),u=n.n(a),c=n(4),l=function(){function t(){o()(this,t),this.i18n=c.a.getBrowser().i18n}return i()(t,null,[{key:"getInstance",value:function(){return t.instance?t.instance:t.instance=new t}},{key:"getI18n",value:function(){return t.getInstance().i18n}}]),t}();u()(l,"instance",void 0),e.a=l},function(t,e,n){"use strict";var r=n(0),o=n.n(r),s=n(1),i=n.n(s),a=n(5),u=n.n(a),c=n(6),l=n.n(c),f=n(2),d=n.n(f),p=n(7);function h(t){this.maxTry=t,this.tryTimes=0}h.prototype={reset:function(){this.retryTimes=0},reachLimit:function(){return!(this.tryTimes<this.maxTry)||(this.tryTimes++,!1)}};var g=h;function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var o=d()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return l()(this,n)}}var m=function(t){u()(n,t);var e=v(n);function n(t){var r,s=t.maxTime,i=void 0===s?3:s;return o()(this,n),(r=e.call(this)).retryTicker=new g(i),r.process=null,r}return i()(n,[{key:"getRetryTime",value:function(){return this.retryTicker.tryTimes}},{key:"runProcess",value:function(){var t=this,e=this.process(this);if(e instanceof Promise)return new Promise((function(n,r){e.then((function(t){return n(t)})).catch((function(e){return t.retryTicker.reachLimit()?r(e):(t.dispatch("onretry",[e]),n(t.retry()))}))}))}},{key:"retry",value:function(){return this.runProcess()}},{key:"start",value:function(t){return this.process=t,this.runProcess()}}]),n}(p.a);e.a=m},function(t,e,n){"use strict";var r=n(0),o=n.n(r),s=n(1),i=n.n(s),a=n(16),u=n.n(a),c=n(5),l=n.n(c),f=n(6),d=n.n(f),p=n(2),h=n.n(p),g=n(13),v=n(7),m=n(23);function y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=h()(t);if(e){var o=h()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d()(this,n)}}var b=function(t){l()(n,t);var e=y(n);function n(t){var r,s=t.processors,i=void 0===s?1:s,a=t.requestOptions,u=void 0===a?{}:a;return o()(this,n),(r=e.call(this)).processors=i,r.requestOptions=u,r.files=[],r.successIndexes=[],r.failIndexes=[],r.progresses=[],r.queue=null,r.asBlob=!0,r}return i()(n,[{key:"dispatch",value:function(t,e){u()(h()(n.prototype),"dispatch",this).call(this,t,e)}},{key:"addListener",value:function(t,e,r){u()(h()(n.prototype),"addListener",this).call(this,t,e,r)}},{key:"abort",value:function(){this.queue.abort()}},{key:"download",value:function(){var t=this;this.queue=new m.a,this.queue.setProcessors(this.processors),this.queue.onDone=function(){t.dispatch("finish")},this.files.forEach((function(e,n){t.queue.add({file:e,index:n})})),this.queue.start((function(e){var n=e.file,r=e.index;return new Promise((function(e,o){var s=new g.a(n,Object.assign({method:"GET"},t.requestOptions));s.asBlob=t.asBlob,s.addListener("onprogress",(function(e){var n=e.totalLength,o=e.loadedLength;t.progresses[r]=o/n,t.dispatch("progress",[{progress:t.progresses.reduce((function(t,e){return t+e}))/t.files.length,successCount:t.successIndexes.length,failCount:t.failIndexes.length}])})),s.addListener("onfinish",(function(n){t.successIndexes.push(r),t.dispatch("item-finish",[{blob:t.asBlob?n:null,data:t.asBlob?null:n,index:r,download:s}]),e()})),s.addListener("onerror",(function(e){t.failIndexes.push(r),t.progresses[r]=0,t.dispatch("item-error",[e]),t.dispatch("progress",[{progress:t.progresses.reduce((function(t,e){return t+e}))/t.files.length,successCount:t.successIndexes.length,failCount:t.failIndexes.length}]),o()})),s.download()}))}))}},{key:"appendFile",value:function(t){this.files.push(t)}}]),n}(v.a);e.a=b},function(t,e,n){"use strict";n.d(e,"b",(function(){return m})),n.d(e,"a",(function(){return y}));var r=n(0),o=n.n(r),s=n(1),i=n.n(s),a=n(3),u=n.n(a),c=n(4),l=function(){function t(){o()(this,t),this.runtime=c.a.getBrowser().runtime}return i()(t,null,[{key:"getInstance",value:function(){return void 0!==t.instance?t.instance:t.instance=new t}},{key:"getRuntime",value:function(){return t.getInstance().runtime}}]),t}();u()(l,"instance",void 0);var f=l,d=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"local";o()(this,t),this.storage=c.a.getBrowser().storage,this.storageArea=this.storage[e]}return i()(t,[{key:"get",value:function(t){var e=this;return new Promise((function(n){e.storageArea.get(t,(function(t){n(t)}))}))}},{key:"set",value:function(t){var e=this;return new Promise((function(n){e.storageArea.set(t,(function(){n()}))}))}},{key:"remove",value:function(t){var e=this;return new Promise((function(n){e.storageArea.remove(t,(function(){n()}))}))}},{key:"onChanged",value:function(){return this.storage.onChanged}}],[{key:"getInstance",value:function(e){return void 0!==t.instance?t.instance:t.instance=new t(e)}},{key:"getStorage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"local",n=t.getInstance(e);return n.storageArea}}]),t}();u()(d,"instance",void 0);var p=d,h=function(){function t(){o()(this,t),this.tabs=c.a.getBrowser().tabs}return i()(t,null,[{key:"getInstance",value:function(){return void 0!==t.instance?t.instance:t.instance=new t}},{key:"getTabs",value:function(){return t.getInstance().tabs}}]),t}();u()(h,"instance",void 0);function g(){this.browser=c.a.getBrowser(),this.autoRender=!1,this.tabId,this.backgroundColor,this.text}g.prototype={setAutoRender:function(t){this.autoRender=t},setTabId:function(t){return this.tabId=t,this.conditionRender(),this},setBackgroundColor:function(t){return this.backgroundColor=t,this.conditionRender(),this},setText:function(t){return this.text=t,this.conditionRender(),this},conditionRender:function(){this.autoRender&&this.render()},render:function(){browser.browserAction.setBadgeText({text:this.text,tabId:this.tabId}),browser.browserAction.setBadgeBackgroundColor({color:this.bgColor,tabId:this.tabId})}};var v=n(18),m=(p.getStorage(),{contains:function(t){return new Promise((function(e){c.a.getBrowser().runtime.sendMessage({action:"containsPermissions",permissions:t},(function(t){e(t)}))}))},request:function(t){return new Promise((function(e){c.a.getBrowser().runtime.sendMessage({action:"requestPermissions",permissions:t},(function(t){e(t)}))}))},remove:function(t){return new Promise((function(e){c.a.getBrowser().runtime.sendMessage({action:"removePermissions",permissions:t},(function(t){e(t)}))}))}}),y={download:function(t){return new Promise((function(e,n){var r=c.a.getBrowser();r.runtime.sendMessage({action:"download",options:t},(function(t){void 0!==t?e(t):n(r.runtime.lastError)}))}))}};f.getRuntime(),v.a.getI18n()},function(t,e){function n(e,r){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},t.exports.default=t.exports,t.exports.__esModule=!0,n(e,r)}t.exports=n,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){"use strict";function r(){this.stack=[],this.index=0,this.complete=0,this.fail=0,this.total=0,this.onItemComplete,this.onItemFail,this.onDone,this.stopQueue=!1,this.processors=1,this.active=0}r.prototype={setProcessors:function(t){this.processors=parseInt(t)},add:function(t){this.stack.push(t),this.total=this.stack.length},next:function(){return this.index<this.stack.length&&(this.index++,this.current())},current:function(){return this.stack[this.index]},start:function(t){var e=this;if(!(this.active>=this.processors)){var n,r=this.index;(n=this.current())&&(this.active++,t(n).then((function(){e.complete++,e.onItemComplete&&e.onItemComplete.call(e)})).catch((function(){e.fail++,e.onItemFail&&e.onItemFail.call(e,r)})).finally((function(){e.active--,e.stopQueue||(e.total===e.complete+e.fail?"function"==typeof e.onDone&&e.onDone.call(e):e.next()&&e.start(t))})),this.active<this.processors&&this.next()&&this.start(t))}},abort:function(){this.stopQueue=!0}},e.a=r},function(t,e,n){var r=n(2),o=n(22),s=n(33),i=n(34);function a(e){var n="function"==typeof Map?new Map:void 0;return t.exports=a=function(t){if(null===t||!s(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return i(t,arguments,r(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),o(e,t)},t.exports.default=t.exports,t.exports.__esModule=!0,a(e)}t.exports=a,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=VueI18n},function(t,e){t.exports=locales},function(t,e,n){},function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var r=n(0),o=n.n(r),s=n(1),i=n.n(s),a=n(12),u=n.n(a),c=n(25),l=n.n(c),f=n(26),d=n.n(f);u.a.use(l.a);var p=function(){function t(){o()(this,t)}return i()(t,null,[{key:"i18n",value:function(t){var e=new l.a({locale:t&&"default"!==t?t:"en",messages:{en:d.a.localeEn,zh_CN:d.a.localeZhCN}});return e}}]),t}()},function(t,e,n){"use strict";e.a={computed:{browserItems:function(){return this.$root.globalBrowserItems||this.$root.browserItems},isFirefox:function(){return this.$root.isFirefox_}},methods:{tl:function(t){return this.$t("".concat(t,".message"))},stripTags:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ";return"string"!=typeof t?t:t.replace(/<\/?[^>]+(>|$)/g,e.repeat(2)).trim()},routeTo:function(t){this.pushRoute({name:t})},pushRoute:function(t){return this.$router.push(t).then((function(){return Promise.resolve()})).catch((function(t){if("NavigationDuplicated"!==t.name)return Promise.reject(t)}))}}}},function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(t.exports=n=function(t){return typeof t},t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.default=t.exports,t.exports.__esModule=!0),n(e)}t.exports=n,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){var r=n(2);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){var r=n(22),o=n(35);function s(e,n,i){return o()?(t.exports=s=Reflect.construct,t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=s=function(t,e,n){var o=[null];o.push.apply(o,e);var s=new(Function.bind.apply(t,o));return n&&r(s,n.prototype),s},t.exports.default=t.exports,t.exports.__esModule=!0),s.apply(null,arguments)}t.exports=s,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){"use strict";n(27)},,,,,function(t,e,n){},,,,,,function(t,e,n){"use strict";n(41)},,function(t,e,n){"use strict";n.r(e);var r=n(0),o=n.n(r),s=n(1),i=n.n(s),a=n(3),u=n.n(a),c=n(5),l=n.n(c),f=n(6),d=n.n(f),p=n(2),h=n.n(p),g=n(24),v=n.n(g);function m(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=h()(t);if(e){var o=h()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d()(this,n)}}var y=function(t){l()(n,t);var e=m(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"invalid_page";return o()(this,n),(t=e.call(this,r)).name="InvalidPageError",t}return n}(v()(Error)),b=n(14),x=n(10);function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=h()(t);if(e){var o=h()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d()(this,n)}}var _=function(t){l()(n,t);var e=w(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unsupported post type";return o()(this,n),(t=e.call(this,r)).name="UnsupportedPostType",t}return n}(v()(Error)),I={post_url:"https://api.fanbox.cc/post.info?postId={post_id}",post_url_pattern:/^https:\/\/(?:www\.)?fanbox\.cc\/@([a-z\d_-]+)\/posts\/([\d]+)/i,post_url_pattern2:/^https:\/\/([a-z\d_-]+\.)?fanbox\.cc\/posts\/([\d]+)/i,image_url:"https://downloads.fanbox.cc/images/post/{post_id}/{image_id}.{image_ext}"},k=function(){function t(){o()(this,t),this.init(),this.request=null}return i()(t,[{key:"init",value:function(){this.url=null,this.creatorId=null,this.postId=null,this.context={creatorId:null,userId:null,userName:null,postId:null,postTitle:null,images:[],year:null,month:null,day:null}}},{key:"setUrl",value:function(t){this.request&&this.request.abort(),this.init(),this.url=t;var e=t.match(I.post_url_pattern)||t.match(I.post_url_pattern2);this.creatorId=this.context.creatorId=e[1],this.postId=this.context.postId=e[2]}},{key:"getUrl",value:function(){return I.post_url.replace("{post_id}",this.postId)}},{key:"getContext",value:function(){var t=this;return new Promise((function(e,n){t.request=new x.a(t.getUrl(),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),t.request.addListener("onload",(function(n){var r=JSON.parse(String.fromCharCode.apply(null,n)),o=new b.a(r.body.publishedDatetime);t.context.userId=r.body.user.userId,t.context.userName=r.body.user.name,t.context.postTitle=r.body.title,t.context.year=o.getYear(),t.context.month=o.getMonth(),t.context.day=o.getDay(),t.context.images=t.findImages(r),e(t.context)})),t.request.addListener("onerror",(function(t){n(t)})),t.request.send()}))}},{key:"findImages",value:function(e){var n=e.body.type;if(n===t.ARTICLE_TYPE)return this.filterImagesFromArticlePost(e);if(n===t.IMAGE_TYPE)return this.filterImagesFromImagePost(e);throw new _}},{key:"filterImagesFromArticlePost",value:function(t){var e=[];return t.body.body.blocks.forEach((function(n){"image"===n.type&&t.body.body.imageMap[n.imageId]&&e.push(t.body.body.imageMap[n.imageId].originalUrl)})),e}},{key:"filterImagesFromImagePost",value:function(t){var e=[];return t.body.body.images.forEach((function(t){e.push(t.originalUrl)})),e}}],[{key:"getDefault",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}();u()(k,"instance",void 0),u()(k,"ARTICLE_TYPE","article"),u()(k,"IMAGE_TYPE","image");var R=function(){function t(){o()(this,t)}return i()(t,[{key:"isValidPage",value:function(t){return I.post_url_pattern.test(t)||I.post_url_pattern2.test(t)}},{key:"getPostAdapter",value:function(t){if(this.isValidPage(t)){var e=k.getDefault();return e.setUrl(t),browser.runtime.sendMessage({action:"activeIcon"}),e}throw browser.runtime.sendMessage({action:"deactiveIcon"}),new y(t)}}],[{key:"getDefault",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}();u()(R,"instance",void 0);var C=n(13),O=n(20),P=n(7),T=n(17),L=n(19),M=n(8);function B(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=h()(t);if(e){var o=h()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d()(this,n)}}var S=function(t){l()(n,t);var e=B(n);function n(t){var r;return o()(this,n),(r=e.call(this)).context=t,r.chunks=[],r.filename,r.zips,r}return i()(n,[{key:"initOptions",value:function(t){var e=t.splitSize,n=t.illustrationRenameFormat,r=t.illustrationImageRenameFormat,o=t.pageNumberStartWithOne,s=void 0!==o&&o,i=t.processors,a=void 0===i?2:i;return this.splitSize=e,this.illustrationRenameFormat=n,this.illustrationImageRenameFormat=r,this.pageNumberStartWithOne=s,this.processors=a,this}},{key:"init",value:function(){this.chunks=[],this.filename=null,this.zips=null;for(var t=0;t<=this.pagesNumber()-1;){var e={},n=t+this.splitSize-1;e.start=t,n>=this.pagesNumber()&&(n=this.pagesNumber()-1),e.end=n,this.chunks.push(e),t=e.end+1}(!this.illustrationImageRenameFormat||this.illustrationImageRenameFormat.indexOf("{pageNum}")<0)&&(this.illustrationImageRenameFormat+="{pageNum}")}},{key:"getUserId",value:function(){return this.context.userId}},{key:"getUserName",value:function(){return this.context.userName}},{key:"getId",value:function(){return this.context.postId}},{key:"getImages",value:function(){return this.context.images}},{key:"getTitle",value:function(){return this.context.illustTitle}},{key:"isR",value:function(){return!!this.context.r}},{key:"getPageRange",value:function(t){return t.start==t.end?parseInt(t.start):parseInt(t.start+1)+"-"+parseInt(t.end+1)}},{key:"getFilename",value:function(t){return Object(M.a)(this.illustrationRenameFormat,this.context,this.getId())+".zip"}},{key:"isSingle",value:function(){return 1===this.pagesNumber()}},{key:"pagesNumber",value:function(){return this.context.images.length}},{key:"downloadFile",value:function(t,e,n){var r=this;new L.a({maxTime:3}).start((function(){return new Promise((function(o,s){var i=new C.a(t,{method:"GET"});i.addListener("onprogress",(function(t){var n=t.totalLength,o=t.loadedLength;r.dispatch("progress",[{progress:o/n},e])})),i.addListener("onerror",(function(t){console.log(t),s()})),i.addListener("onfinish",(function(t){var s=n.pageNum||0;r.context.pageNum=s;var a;a=r.illustrationImageRenameFormat.replace(/#.*#/g,"");var u=Object(M.a)(a,r.context,s)+"."+T.a.getExtenstion(i.getResponseHeader("Content-Type"));r.dispatch("download-finish",[{blob:t,filename:u},e]),o()})),i.download()}))}))}},{key:"downloadChunk",value:function(t){var e=this,n=new O.a({processors:this.processors,requestOptions:{credentials:"include"}}),r=new JSZip;n.asBlob=!1,this.context.images.forEach((function(t){n.appendFile(t)})),n.addListener("progress",(function(n){e.dispatch("download-progress",[n,t])})),n.addListener("item-error",(function(t){e.dispatch("download-error",t)})),n.addListener("item-finish",(function(t){var n=t.data,o=t.index,s=t.download,i=o+(e.pageNumberStartWithOne?1:0),a=null;e.context.pageNum=i,a=Object(M.a)(e.illustrationImageRenameFormat.replace(/#/g,""),e.context,i),a+="."+T.a.getExtenstion(s.getResponseHeader("Content-Type"));var u=new Date;u.setMinutes(u.getMinutes()-u.getTimezoneOffset()),r.file(a,n,{date:u})})),n.addListener("finish",(function(){r.generateAsync({type:"blob"}).then((function(n){e.dispatch("download-finish",[{blob:n,filename:e.getFilename()},t])}))})),n.download()}}]),n}(P.a),E=n(15),F=n(11),A={mixins:[E.a],components:{"ptk-button":F.a},data:function(){return{ready:!1,lastBlob:null,lastFilename:null,lastError:null,totalCount:0,successCount:0,failCount:0,downloading:!1,unsupportedPostType:!1}},computed:{downloadText:function(){return this.downloading?"T: ".concat(this.totalCount," / S: ").concat(this.successCount," / F: ").concat(this.failCount):this.isUnsupportedPostType?"Unsupported":"Download"}},created:function(){this.detector=R.getDefault(),this.context=null},mounted:function(){var t=this;new MutationObserver((function(e,n){window.location.href!==t.currentUrl&&(t.currentUrl=window.location.href,t.ready=!1,t.lastError=null,t.lastBlob=null,t.lastFilename=null,t.downloading=!1,t.totalCount=0,t.successCount=0,t.failCount=0,t.injectPage())})).observe(document.querySelector("body"),{attributes:!0,childList:!0,subtree:!0})},methods:{injectPage:function(){var t=this;try{this.detector.getPostAdapter(window.location.href).getContext().then((function(e){e.images.length>0&&(t.ready=!0,t.isUnsupportedPostType=!1,t.context=e)}))}catch(t){"UnsupportedPostType"===t.name?this.isUnsupportedPostType=!0:(this.ready=!1,console.error(t))}},downloadImages:function(){var t=this,e=this;if(this.lastBlob)this.downloadFile(this.lastBlob,this.lastFilename,{folder:this.getSubfolder(e.getItem("illustrationRelativeLocation"),post.context)});else if(!this.downloading){this.downloading=!0;var n=new S(this.context);this.totalCount=n.pagesNumber(),n.initOptions({splitSize:99,illustrationRenameFormat:e.getItem("illustrationRenameFormat"),illustrationImageRenameFormat:e.getItem("illustrationImageRenameFormat"),pageNumberStartWithOne:e.getItem("illustrationPageNumberStartWithOne")}).init(),n.addListener("download-progress",(function(e){t.successCount=e.successCount,t.failCount=e.failCount})),n.addListener("download-finish",(function(r){var o=r.blob,s=r.filename;t.lastBlob=o,t.lastFilename=s,t.downloading=!1,t.downloadFile(o,s,{folder:t.getSubfolder(e.getItem("illustrationRelativeLocation"),n.context)})})),n.downloadChunk()}console.log("download")},getItem:function(t){return this.browserItems[t]}}},j=(n(47),n(9)),N=Object(j.a)(A,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{directives:[{name:"show",rawName:"v-show",value:this.ready,expression:"ready"}],attrs:{id:"__ptk-fanbox-app"}},[e("ptk-button",{staticClass:"download-btn",on:{click:this.downloadImages}},[this._v(this._s(this.downloadText))])],1)}),[],!1,null,null,null).exports,D=n(4),U=n(28),q=n(29),$=n(12),z=n.n($);z.a.prototype.$browser=window.browser=D.a.getBrowser(),z.a.mixin(q.a);var K=U.a.i18n();browser.storage.local.get(["language","illustrationRelativeLocation","illustrationRenameFormat","illustrationImageRenameFormat","illustrationPageNumberStartWithOne","illustrationKeepPageNumber"],(function(t){K.locale=t.language||"default";var e=document.createElement("div");e.id="__ptk-fanbox-app",e.style.position="fixed",e.style.left="0",e.style.bottom="0",e.style.width="100%",e.style.height="0",e.style.overflow="visible",e.style.display="none",document.body.appendChild(e),window.$extension=new z.a({el:"#"+e.id,i18n:K,data:function(){return{globalBrowserItems:t,isFirefox_:navigator.userAgent.toLowerCase().indexOf("firefox")>-1}},beforeMount:function(){var t=this;this.$browser.storage.onChanged.addListener((function(e){for(var n in e)t.globalBrowserItems[n]=e[n].newValue,"language"===n&&("default"===e[n].newValue?K.locale=chrome.i18n.getUILanguage().replace("-","_"):K.locale=e[n].newValue)}))},render:function(t){return t(N)},methods:{getItem:function(t){return this.globalBrowserItems[t]}}})}))}]);