const e=async e=>new Promise(t=>chrome.storage.local.get(e,a=>{Object.prototype.hasOwnProperty.call(a,e)?t(a[e]):t(null)})),t=async()=>new Promise(e=>chrome.storage.local.get(null,t=>{Object.keys(t)?.length>0?e(t):e(null)})),a=async e=>new Promise(t=>chrome.storage.local.set(e,()=>t())),n=async e=>new Promise(t=>chrome.storage.local.remove(e,()=>t())),o=async(t,o)=>{if("copyMethod"===t.target.id&&"url"!==t.target.value&&"tableForm"!==t.target.value&&"kodiUrl"!==t.target.value&&!t.target.value.startsWith("user")){let a="customCommand"+t.target.value;await e(a)&&(document.getElementById("customCommand").value=await e(a)||"")}if("regexCommand"===t.target.id)await a({[t.target.id]:t.target.value});else if("customCommand"===t.target.id)await a({[t.target.id+document.getElementById("copyMethod").value]:t.target.value?.trim()});else if("textarea"===t.target.tagName.toLowerCase())await a({[t.target.id]:t.target.value?.split("\n").filter(e=>e)});else if("checkbox"===t.target.type)await a({[t.target.id]:t.target.checked});else if("text"===t.target.type&&t.target.value?.trim().length===0)await n(t.target.id);else if("radio"===t.target.type&&o.length>0)for(let e of o)e.name===t.target.name&&await a({[e.id]:document.getElementById(e.id).checked});else await a({[t.target.id]:t.target.value?.trim()});chrome.runtime.sendMessage({options:!0})},l=chrome.i18n.getMessage,r=async()=>{let t=document.getElementsByClassName("option");for(let a of t)if("customCommand"===a.id){let t=a.id+document.getElementById("copyMethod").value;document.getElementById(a.id).value=await e(t)||""}else if("regexCommand"===a.id)document.getElementById("regexCommand").value=await e("regexCommand"),i();else if("textarea"===a.tagName.toLowerCase()){if(await e(a.id)){let t=await e(a.id);null!==t&&(document.getElementById(a.id).value=t.join("\n"))}}else await e(a.id)!==null&&("checkbox"===document.getElementById(a.id).type||"radio"===document.getElementById(a.id).type?document.getElementById(a.id).checked=await e(a.id):document.getElementById(a.id).value=await e(a.id))},i=()=>{try{new RegExp(document.getElementById("regexCommand").value),document.getElementById("regexWarning").style.display="none"}catch{document.getElementById("regexWarning").style.display="unset"}};document.addEventListener("DOMContentLoaded",async()=>{let n=document.getElementsByClassName("option");for(let e of n)"regexCommand"===e.id&&(e.oninput=()=>i()),"button"!==e.type&&(e.onchange=e=>o(e));document.getElementById("exportButton").onclick=async()=>{let e=await t();delete e.urlStorage,delete e.urlStorageRestore,delete e.version,delete e.newline;let a=new Blob([JSON.stringify(e)],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(a),n.download=`stream-detector-settings-${Date.now()}.json`,n.click(),URL.revokeObjectURL(a),n.remove()},document.getElementById("importButton").onclick=()=>{let e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=()=>{let t=new FileReader,[n]=e.files;t.onload=()=>{try{JSON.parse(t.result)}catch{window.alert(l("importButtonFailure"))}a(JSON.parse(t.result)),r(),chrome.runtime.sendMessage({options:!0}),e.remove()},n&&t.readAsText(n)},e.click()},document.getElementById("resetButton").onclick=()=>window.confirm(l("resetButtonConfirm"))&&chrome.runtime.sendMessage({reset:!0}),r();let m=document.getElementsByTagName("label");for(let t of m)"versionTag"===t.htmlFor?t.textContent=`v${await e("version")}. ${l("tipHint")}`:t.textContent=l(t.htmlFor)+":";let d=document.getElementsByTagName("option");for(let e of d)e.textContent||(e.textContent=l(e.value));let c=document.getElementsByTagName("span");for(let e of c)e.parentElement.title=l(e.id);let s=document.getElementsByTagName("button");for(let e of s)e.textContent=l(e.id);chrome.runtime.onMessage.addListener(e=>{e.options&&r()})});