/*! For license information please see kinopub-subtitle-sniffer.js.LICENSE.txt */
(()=>{var t={908:(t,e,r)=>{var i;i="undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{},t.exports=i},941:function(t,e,r){var i;i=()=>(()=>{var t={"./original-repo/interpreter.js":function(t,e,r){"use strict";var i=function(t,e){"string"==typeof t&&(t=this.parse_(t,"code"));var r=t.constructor;this.newNode=function(){return new r({options:{}})};var n=this.newNode();for(var o in t)n[o]="body"===o?t[o].slice():t[o];this.ast=n,this.tasks=[],this.initFunc_=e,this.paused_=!1,this.polyfills_=[],this.functionCounter_=0,this.stepFunctions_=Object.create(null);var a,s=/^step([A-Z]\w*)$/;for(var c in this)"function"==typeof this[c]&&(a=c.match(s))&&(this.stepFunctions_[a[1]]=this[c].bind(this));this.globalScope=this.createScope(this.ast,null),this.globalObject=this.globalScope.object,this.ast=this.parse_(this.polyfills_.join("\n"),"polyfills"),this.polyfills_=void 0,i.stripLocations_(this.ast,void 0,void 0);var u=new i.State(this.ast,this.globalScope);u.done=!1,this.stateStack=[u],this.run(),this.value=void 0,this.ast=n,(u=new i.State(this.ast,this.globalScope)).done=!1,this.stateStack.length=0,this.stateStack[0]=u};i.Completion={NORMAL:0,BREAK:1,CONTINUE:2,RETURN:3,THROW:4},i.Status={DONE:0,STEP:1,TASK:2,ASYNC:3},i.PARSE_OPTIONS={locations:!0,ecmaVersion:5},i.READONLY_DESCRIPTOR={configurable:!0,enumerable:!0,writable:!1},i.NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!0},i.READONLY_NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!1},i.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR={configurable:!1,enumerable:!1,writable:!1},i.VARIABLE_DESCRIPTOR={configurable:!1,enumerable:!0,writable:!0},i.STEP_ERROR={STEP_ERROR:!0},i.SCOPE_REFERENCE={SCOPE_REFERENCE:!0},i.VALUE_IN_DESCRIPTOR={VALUE_IN_DESCRIPTOR:!0},i.REGEXP_TIMEOUT={REGEXP_TIMEOUT:!0},i.toStringCycles_=[],i.vm=null,i.currentInterpreter_=null,i.nativeGlobal="undefined"==typeof globalThis?this:globalThis,i.WORKER_CODE=["onmessage = function(e) {","var result;","var data = e.data;","switch (data[0]) {","case 'split':","result = data[1].split(data[2], data[3]);","break;","case 'match':","result = data[1].match(data[2]);","break;","case 'search':","result = data[1].search(data[2]);","break;","case 'replace':","result = data[1].replace(data[2], data[3]);","break;","case 'exec':","var regexp = data[1];","regexp.lastIndex = data[2];","result = [regexp.exec(data[3]), data[1].lastIndex];","break;","default:","throw Error('Unknown RegExp operation: ' + data[0]);","}","postMessage(result);","close();","};"],i.legalArrayLength=function(t){var e=t>>>0;return e===Number(t)?e:NaN},i.legalArrayIndex=function(t){var e=t>>>0;return String(e)===String(t)&&4294967295!==e?e:NaN},i.stripLocations_=function(t,e,r){for(var n in e?t.start=e:delete t.start,r?t.end=r:delete t.end,t)if("loc"!==n&&t.hasOwnProperty(n)){var o=t[n];o&&"object"==typeof o&&i.stripLocations_(o,e,r)}},i.prototype.REGEXP_MODE=2,i.prototype.REGEXP_THREAD_TIMEOUT=1e3,i.prototype.POLYFILL_TIMEOUT=1e3,i.prototype.getterStep_=!1,i.prototype.setterStep_=!1,i.prototype.appendCodeNumber_=0,i.prototype.taskCodeNumber_=0,i.prototype.parse_=function(t,e){var r={};for(var n in i.PARSE_OPTIONS)r[n]=i.PARSE_OPTIONS[n];return r.sourceFile=e,i.nativeGlobal.acorn.parse(t,r)},i.prototype.appendCode=function(t){var e=this.stateStack[0];if(!e||"Program"!==e.node.type)throw Error("Expecting original AST to start with a Program node");if("string"==typeof t&&(t=this.parse_(t,"appendCode"+this.appendCodeNumber_++)),!t||"Program"!==t.type)throw Error("Expecting new AST to start with a Program node");this.populateScope_(t,e.scope),Array.prototype.push.apply(e.node.body,t.body),e.node.body.variableCache_=null,e.done=!1},i.prototype.step=function(){var t,e=this.stateStack;do{var r=e[e.length-1];if(this.paused_)return!0;if(!r||"Program"===r.node.type&&r.done){if(!this.tasks.length)return!1;if(!(r=this.nextTask_()))return!0}var n=r.node,o=i.currentInterpreter_;i.currentInterpreter_=this;try{var a=this.stepFunctions_[n.type](e,r,n)}catch(t){if(t!==i.STEP_ERROR)throw this.value!==t&&(this.value=void 0),t}finally{i.currentInterpreter_=o}if(a&&e.push(a),this.getterStep_)throw this.value=void 0,Error("Getter not supported in this context");if(this.setterStep_)throw this.value=void 0,Error("Setter not supported in this context");t||n.end||(t=Date.now()+this.POLYFILL_TIMEOUT)}while(!n.end&&t>Date.now());return!0},i.prototype.run=function(){for(;!this.paused_&&this.step(););return this.paused_},i.prototype.getStatus=function(){if(this.paused_)return i.Status.ASYNC;var t=this.stateStack,e=t[t.length-1];if(e&&("Program"!==e.node.type||!e.done))return i.Status.STEP;var r=this.tasks[0];return r?r.time>Date.now()?i.Status.TASK:i.Status.STEP:i.Status.DONE},i.prototype.initGlobal=function(t){this.setProperty(t,"NaN",NaN,i.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(t,"Infinity",1/0,i.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(t,"undefined",void 0,i.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(t,"window",t,i.READONLY_DESCRIPTOR),this.setProperty(t,"this",t,i.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(t,"self",t),this.OBJECT_PROTO=new i.Object(null),this.FUNCTION_PROTO=new i.Object(this.OBJECT_PROTO),this.initFunction(t),this.initObject(t),t.proto=this.OBJECT_PROTO,this.setProperty(t,"constructor",this.OBJECT,i.NONENUMERABLE_DESCRIPTOR),this.initArray(t),this.initString(t),this.initBoolean(t),this.initNumber(t),this.initDate(t),this.initRegExp(t),this.initError(t),this.initMath(t),this.initJSON(t);var e,r=this,n=this.createNativeFunction((function(t){throw EvalError("Can't happen")}),!1);n.eval=!0,this.setProperty(t,"eval",n,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(t,"parseInt",this.createNativeFunction(parseInt,!1),i.NONENUMERABLE_DESCRIPTOR),this.setProperty(t,"parseFloat",this.createNativeFunction(parseFloat,!1),i.NONENUMERABLE_DESCRIPTOR),this.setProperty(t,"isNaN",this.createNativeFunction(isNaN,!1),i.NONENUMERABLE_DESCRIPTOR),this.setProperty(t,"isFinite",this.createNativeFunction(isFinite,!1),i.NONENUMERABLE_DESCRIPTOR);for(var o=[[escape,"escape"],[unescape,"unescape"],[decodeURI,"decodeURI"],[decodeURIComponent,"decodeURIComponent"],[encodeURI,"encodeURI"],[encodeURIComponent,"encodeURIComponent"]],a=0;a<o.length;a++)e=function(t){return function(e){try{return t(e)}catch(t){r.throwException(r.URI_ERROR,t.message)}}}(o[a][0]),this.setProperty(t,o[a][1],this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR);e=function(t){return r.createTask_(!1,arguments)},this.setProperty(t,"setTimeout",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR),e=function(t){return r.createTask_(!0,arguments)},this.setProperty(t,"setInterval",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR),e=function(t){r.deleteTask_(t)},this.setProperty(t,"clearTimeout",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR),e=function(t){r.deleteTask_(t)},this.setProperty(t,"clearInterval",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR),this.OBJECT=this.OBJECT,this.OBJECT_PROTO=this.OBJECT_PROTO,this.FUNCTION=this.FUNCTION,this.FUNCTION_PROTO=this.FUNCTION_PROTO,this.ARRAY=this.ARRAY,this.ARRAY_PROTO=this.ARRAY_PROTO,this.REGEXP=this.REGEXP,this.REGEXP_PROTO=this.REGEXP_PROTO,this.DATE=this.DATE,this.DATE_PROTO=this.DATE_PROTO,this.initFunc_&&this.initFunc_(this,t)},i.prototype.functionCodeNumber_=0,i.prototype.initFunction=function(t){var e,r=this,n=/^[A-Za-z_$][\w$]*$/;e=function(t){if(arguments.length)var e=String(arguments[arguments.length-1]);else e="";var i=Array.prototype.slice.call(arguments,0,-1).join(",").trim();if(i){for(var o=i.split(/\s*,\s*/),a=0;a<o.length;a++){var s=o[a];n.test(s)||r.throwException(r.SYNTAX_ERROR,"Invalid function argument: "+s)}i=o.join(", ")}try{var c=r.parse_("(function("+i+") {"+e+"})","function"+r.functionCodeNumber_++)}catch(t){r.throwException(r.SYNTAX_ERROR,"Invalid code: "+t.message)}1!==c.body.length&&r.throwException(r.SYNTAX_ERROR,"Invalid code in function body");var u=c.body[0].expression;return r.createFunction(u,r.globalScope,"anonymous")},this.FUNCTION=this.createNativeFunction(e,!0),this.setProperty(t,"Function",this.FUNCTION,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.FUNCTION,"prototype",this.FUNCTION_PROTO,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.FUNCTION_PROTO,"constructor",this.FUNCTION,i.NONENUMERABLE_DESCRIPTOR),this.FUNCTION_PROTO.nativeFunc=function(){},this.FUNCTION_PROTO.nativeFunc.id=this.functionCounter_++,this.FUNCTION_PROTO.illegalConstructor=!0,this.setProperty(this.FUNCTION_PROTO,"length",0,i.READONLY_NONENUMERABLE_DESCRIPTOR),this.FUNCTION_PROTO.class="Function",e=function(t,e){var n=r.stateStack[r.stateStack.length-1];n.func_=this,n.funcThis_=t,n.arguments_=[],null!=e&&(e instanceof i.Object?n.arguments_=r.arrayPseudoToNative(e):r.throwException(r.TYPE_ERROR,"CreateListFromArrayLike called on non-object")),n.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"apply",e),e=function(t){var e=r.stateStack[r.stateStack.length-1];e.func_=this,e.funcThis_=t,e.arguments_=[];for(var i=1;i<arguments.length;i++)e.arguments_.push(arguments[i]);e.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"call",e),this.polyfills_.push("Object.defineProperty(Function.prototype, 'bind',","{configurable: true, writable: true, value:","function bind(oThis) {","if (typeof this !== 'function') {","throw TypeError('What is trying to be bound is not callable');","}","var aArgs   = Array.prototype.slice.call(arguments, 1),","fToBind = this,","fNOP    = function() {},","fBound  = function() {","return fToBind.apply(this instanceof fNOP","? this",": oThis,","aArgs.concat(Array.prototype.slice.call(arguments)));","};","if (this.prototype) {","fNOP.prototype = this.prototype;","}","fBound.prototype = new fNOP();","return fBound;","}","});",""),e=function(){return String(this)},this.setNativeFunctionPrototype(this.FUNCTION,"toString",e),this.setProperty(this.FUNCTION,"toString",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR),e=function(){return this.valueOf()},this.setNativeFunctionPrototype(this.FUNCTION,"valueOf",e),this.setProperty(this.FUNCTION,"valueOf",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR)},i.prototype.initObject=function(t){var e,r=this;e=function(t){if(null==t)return r.calledWithNew()?this:r.createObjectProto(r.OBJECT_PROTO);if(!(t instanceof i.Object)){var e=r.createObjectProto(r.getPrototype(t));return e.data=t,e}return t},this.OBJECT=this.createNativeFunction(e,!0),this.setProperty(this.OBJECT,"prototype",this.OBJECT_PROTO,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.OBJECT_PROTO,"constructor",this.OBJECT,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(t,"Object",this.OBJECT,i.NONENUMERABLE_DESCRIPTOR);var n=function(t){null==t&&r.throwException(r.TYPE_ERROR,"Cannot convert '"+t+"' to object")};e=function(t){n(t);var e=t instanceof i.Object?t.properties:t;return r.arrayNativeToPseudo(Object.getOwnPropertyNames(e))},this.setProperty(this.OBJECT,"getOwnPropertyNames",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR),e=function(t){return n(t),t instanceof i.Object&&(t=t.properties),r.arrayNativeToPseudo(Object.keys(t))},this.setProperty(this.OBJECT,"keys",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR),e=function(t){return null===t?r.createObjectProto(null):(t instanceof i.Object||r.throwException(r.TYPE_ERROR,"Object prototype may only be an Object or null, not "+t),r.createObjectProto(t))},this.setProperty(this.OBJECT,"create",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var create_ = Object.create;","Object.create = function create(proto, props) {","var obj = create_(proto);","props && Object.defineProperties(obj, props);","return obj;","};","})();",""),e=function(t,e,n){return e=String(e),t instanceof i.Object||r.throwException(r.TYPE_ERROR,"Object.defineProperty called on non-object: "+t),n instanceof i.Object||r.throwException(r.TYPE_ERROR,"Property description must be an object"),t.preventExtensions&&!(e in t.properties)&&r.throwException(r.TYPE_ERROR,"Can't define property '"+e+"', object is not extensible"),r.setProperty(t,e,i.VALUE_IN_DESCRIPTOR,n.properties),t},this.setProperty(this.OBJECT,"defineProperty",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var defineProperty_ = Object.defineProperty;","Object.defineProperty = function defineProperty(obj, prop, d1) {","var d2 = {};","if ('configurable' in d1) d2.configurable = d1.configurable;","if ('enumerable' in d1) d2.enumerable = d1.enumerable;","if ('writable' in d1) d2.writable = d1.writable;","if ('value' in d1) d2.value = d1.value;","if ('get' in d1) d2.get = d1.get;","if ('set' in d1) d2.set = d1.set;","return defineProperty_(obj, prop, d2);","};","})();","Object.defineProperty(Object, 'defineProperties',","{configurable: true, writable: true, value:","function defineProperties(obj, props) {","var keys = Object.keys(props);","for (var i = 0; i < keys.length; i++) {","Object.defineProperty(obj, keys[i], props[keys[i]]);","}","return obj;","}","});",""),e=function(t,e){if(t instanceof i.Object||r.throwException(r.TYPE_ERROR,"Object.getOwnPropertyDescriptor called on non-object: "+t),(e=String(e))in t.properties){var n=Object.getOwnPropertyDescriptor(t.properties,e),o=t.getter[e],a=t.setter[e],s=r.createObjectProto(r.OBJECT_PROTO);return o||a?(r.setProperty(s,"get",o),r.setProperty(s,"set",a)):(r.setProperty(s,"value",n.value),r.setProperty(s,"writable",n.writable)),r.setProperty(s,"configurable",n.configurable),r.setProperty(s,"enumerable",n.enumerable),s}},this.setProperty(this.OBJECT,"getOwnPropertyDescriptor",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR),e=function(t){return n(t),r.getPrototype(t)},this.setProperty(this.OBJECT,"getPrototypeOf",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR),e=function(t){return Boolean(t)&&!t.preventExtensions},this.setProperty(this.OBJECT,"isExtensible",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR),e=function(t){return t instanceof i.Object&&(t.preventExtensions=!0),t},this.setProperty(this.OBJECT,"preventExtensions",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR),this.setNativeFunctionPrototype(this.OBJECT,"toString",i.Object.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"toLocaleString",i.Object.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"valueOf",i.Object.prototype.valueOf),e=function(t){return n(this),this instanceof i.Object?String(t)in this.properties:this.hasOwnProperty(t)},this.setNativeFunctionPrototype(this.OBJECT,"hasOwnProperty",e),e=function(t){return n(this),this instanceof i.Object?Object.prototype.propertyIsEnumerable.call(this.properties,t):this.propertyIsEnumerable(t)},this.setNativeFunctionPrototype(this.OBJECT,"propertyIsEnumerable",e),e=function(t){for(;;){if(!(t=r.getPrototype(t)))return!1;if(t===this)return!0}},this.setNativeFunctionPrototype(this.OBJECT,"isPrototypeOf",e)},i.prototype.initArray=function(t){var e,r=this;e=function(t){if(r.calledWithNew())var e=this;else e=r.createArray();var n=arguments[0];if(1===arguments.length&&"number"==typeof n)isNaN(i.legalArrayLength(n))&&r.throwException(r.RANGE_ERROR,"Invalid array length: "+n),e.properties.length=n;else{for(var o=0;o<arguments.length;o++)e.properties[o]=arguments[o];e.properties.length=o}return e},this.ARRAY=this.createNativeFunction(e,!0),this.ARRAY_PROTO=this.ARRAY.properties.prototype,this.setProperty(t,"Array",this.ARRAY,i.NONENUMERABLE_DESCRIPTOR),e=function(t){return t&&"Array"===t.class},this.setProperty(this.ARRAY,"isArray",this.createNativeFunction(e,!1),i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ARRAY_PROTO,"length",0,{configurable:!1,enumerable:!1,writable:!0}),this.ARRAY_PROTO.class="Array",this.polyfills_.push("(function() {","function createArrayMethod_(f) {","Object.defineProperty(Array.prototype, f.name,","{configurable: true, writable: true, value: f});","}","createArrayMethod_(","function pop() {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","if (!len || len < 0) {","o.length = 0;","return undefined;","}","len--;","var x = o[len];","delete o[len];","o.length = len;","return x;","}",");","createArrayMethod_(","function push(var_args) {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","for (var i = 0; i < arguments.length; i++) {","o[len] = arguments[i];","len++;","}","o.length = len;","return len;","}",");","createArrayMethod_(","function shift() {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","if (!len || len < 0) {","o.length = 0;","return undefined;","}","var value = o[0];","for (var i = 0; i < len - 1; i++) {","if ((i + 1) in o) {","o[i] = o[i + 1];","} else {","delete o[i];","}","}","delete o[i];","o.length = len - 1;","return value;","}",");","createArrayMethod_(","function unshift(var_args) {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","if (!len || len < 0) {","len = 0;","}","for (var i = len - 1; i >= 0; i--) {","if (i in o) {","o[i + arguments.length] = o[i];","} else {","delete o[i + arguments.length];","}","}","for (var i = 0; i < arguments.length; i++) {","o[i] = arguments[i];","}","return (o.length = len + arguments.length);","}",");","createArrayMethod_(","function reverse() {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","if (!len || len < 2) {","return o;","}","for (var i = 0; i < len / 2 - 0.5; i++) {","var x = o[i];","var hasX = i in o;","if ((len - i - 1) in o) {","o[i] = o[len - i - 1];","} else {","delete o[i];","}","if (hasX) {","o[len - i - 1] = x;","} else {","delete o[len - i - 1];","}","}","return o;","}",");","createArrayMethod_(","function indexOf(searchElement, fromIndex) {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","var n = fromIndex | 0;","if (!len || n >= len) {","return -1;","}","var i = Math.max(n >= 0 ? n : len - Math.abs(n), 0);","while (i < len) {","if (i in o && o[i] === searchElement) {","return i;","}","i++;","}","return -1;","}",");","createArrayMethod_(","function lastIndexOf(searchElement, fromIndex) {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","if (!len) {","return -1;","}","var n = len - 1;","if (arguments.length > 1) {","n = fromIndex | 0;","if (n) {","n = (n > 0 || -1) * Math.floor(Math.abs(n));","}","}","var i = n >= 0 ? Math.min(n, len - 1) : len - Math.abs(n);","while (i >= 0) {","if (i in o && o[i] === searchElement) {","return i;","}","i--;","}","return -1;","}",");","createArrayMethod_(","function slice(start, end) {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","start |= 0;","start = (start >= 0) ? start : Math.max(0, len + start);","if (typeof end !== 'undefined') {","if (end !== Infinity) {","end |= 0;","}","if (end < 0) {","end = len + end;","} else {","end = Math.min(end, len);","}","} else {","end = len;","}","var size = end - start;","var cloned = new Array(size);","for (var i = 0; i < size; i++) {","if ((start + i) in o) {","cloned[i] = o[start + i];","}","}","return cloned;","}",");","createArrayMethod_(","function splice(start, deleteCount, var_args) {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","start |= 0;","if (start < 0) {","start = Math.max(len + start, 0);","} else {","start = Math.min(start, len);","}","if (arguments.length < 1) {","deleteCount = len - start;","} else {","deleteCount |= 0;","deleteCount = Math.max(0, Math.min(deleteCount, len - start));","}","var removed = [];","for (var i = start; i < start + deleteCount; i++) {","if (i in o) {","removed.push(o[i]);","} else {","removed.length++;","}","if ((i + deleteCount) in o) {","o[i] = o[i + deleteCount];","} else {","delete o[i];","}","}","for (var i = start + deleteCount; i < len - deleteCount; i++) {","if ((i + deleteCount) in o) {","o[i] = o[i + deleteCount];","} else {","delete o[i];","}","}","for (var i = len - deleteCount; i < len; i++) {","delete o[i];","}","len -= deleteCount;","var arl = arguments.length - 2;","for (var i = len - 1; i >= start; i--) {","if (i in o) {","o[i + arl] = o[i];","} else {","delete o[i + arl];","}","}","len += arl;","for (var i = 2; i < arguments.length; i++) {","o[start + i - 2] = arguments[i];","}","o.length = len;","return removed;","}",");","createArrayMethod_(","function concat(var_args) {","if (!this) throw TypeError();","var o = Object(this);","var cloned = [];","for (var i = -1; i < arguments.length; i++) {","var value = (i === -1) ? o : arguments[i];","if (Array.isArray(value)) {","for (var j = 0, l = value.length; j < l; j++) {","if (j in value) {","cloned.push(value[j]);","} else {","cloned.length++;","}","}","} else {","cloned.push(value);","}","}","return cloned;","}",");","createArrayMethod_(","function join(opt_separator) {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","var sep = typeof opt_separator === 'undefined' ?","',' : ('' + opt_separator);","var str = '';","for (var i = 0; i < len; i++) {","if (i && sep) str += sep;","str += (o[i] === null || o[i] === undefined) ? '' : o[i];","}","return str;","}",");","createArrayMethod_(","function every(callbackfn, thisArg) {","if (!this || typeof callbackfn !== 'function') throw TypeError();","var t, k = 0;","var o = Object(this), len = o.length >>> 0;","if (arguments.length > 1) t = thisArg;","while (k < len) {","if (k in o && !callbackfn.call(t, o[k], k, o)) return false;","k++;","}","return true;","}",");","createArrayMethod_(","function filter(fun, var_args) {","if (this === void 0 || this === null || typeof fun !== 'function') throw TypeError();","var o = Object(this), len = o.length >>> 0;","var res = [];","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in o) {","var val = o[i];","if (fun.call(thisArg, val, i, o)) res.push(val);","}","}","return res;","}",");","createArrayMethod_(","function forEach(callback, thisArg) {","if (!this || typeof callback !== 'function') throw TypeError();","var t, k = 0;","var o = Object(this), len = o.length >>> 0;","if (arguments.length > 1) t = thisArg;","while (k < len) {","if (k in o) callback.call(t, o[k], k, o);","k++;","}","}",");","createArrayMethod_(","function map(callback, thisArg) {","if (!this || typeof callback !== 'function') throw TypeError();","var t, k = 0;","var o = Object(this), len = o.length >>> 0;","if (arguments.length > 1) t = thisArg;","var a = new Array(len);","while (k < len) {","if (k in o) a[k] = callback.call(t, o[k], k, o);","k++;","}","return a;","}",");","createArrayMethod_(","function reduce(callback /*, initialValue*/) {","if (!this || typeof callback !== 'function') throw TypeError();","var o = Object(this), len = o.length >>> 0;","var k = 0, value;","if (arguments.length === 2) {","value = arguments[1];","} else {","while (k < len && !(k in o)) k++;","if (k >= len) {","throw TypeError('Reduce of empty array with no initial value');","}","value = o[k++];","}","for (; k < len; k++) {","if (k in o) value = callback(value, o[k], k, o);","}","return value;","}",");","createArrayMethod_(","function reduceRight(callback /*, initialValue*/) {","if (null === this || 'undefined' === typeof this || 'function' !== typeof callback) throw TypeError();","var o = Object(this), len = o.length >>> 0;","var k = len - 1, value;","if (arguments.length >= 2) {","value = arguments[1];","} else {","while (k >= 0 && !(k in o)) k--;","if (k < 0) {","throw TypeError('Reduce of empty array with no initial value');","}","value = o[k--];","}","for (; k >= 0; k--) {","if (k in o) value = callback(value, o[k], k, o);","}","return value;","}",");","createArrayMethod_(","function some(fun/*, thisArg*/) {","if (!this || typeof fun !== 'function') throw TypeError();","var o = Object(this), len = o.length >>> 0;","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in o && fun.call(thisArg, o[i], i, o)) return true;","}","return false;","}",");","createArrayMethod_(","function sort(opt_comp) {","if (!this) throw TypeError();","if (typeof opt_comp !== 'function') {","opt_comp = undefined;","}","for (var i = 0; i < this.length; i++) {","var changes = 0;","for (var j = 0; j < this.length - i - 1; j++) {","if (opt_comp ? (opt_comp(this[j], this[j + 1]) > 0) :","(String(this[j]) > String(this[j + 1]))) {","var swap = this[j];","var hasSwap = j in this;","if ((j + 1) in this) {","this[j] = this[j + 1];","} else {","delete this[j];","}","if (hasSwap) {","this[j + 1] = swap;","} else {","delete this[j + 1];","}","changes++;","}","}","if (!changes) break;","}","return this;","}",");","createArrayMethod_(","function toLocaleString() {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","var out = [];","for (var i = 0; i < len; i++) {","out[i] = (o[i] === null || o[i] === undefined) ? '' : o[i].toLocaleString();","}","return out.join(',');","}",");","})();","")},i.prototype.initString=function(t){var e,r=this;e=function(t){return t=arguments.length?i.nativeGlobal.String(t):"",r.calledWithNew()?(this.data=t,this):t},this.STRING=this.createNativeFunction(e,!0),this.setProperty(t,"String",this.STRING,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.STRING,"fromCharCode",this.createNativeFunction(String.fromCharCode,!1),i.NONENUMERABLE_DESCRIPTOR);for(var n=["charAt","charCodeAt","concat","indexOf","lastIndexOf","slice","substr","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim"],o=0;o<n.length;o++)this.setNativeFunctionPrototype(this.STRING,n[o],String.prototype[n[o]]);e=function(t,e,i){e=r.pseudoToNative(e),i=r.pseudoToNative(i);try{return String(this).localeCompare(t,e,i)}catch(t){r.throwException(r.ERROR,"localeCompare: "+t.message)}},this.setNativeFunctionPrototype(this.STRING,"localeCompare",e),e=function(t,e,n){var o=String(this);if(e=e?Number(e):void 0,r.isa(t,r.REGEXP)&&(t=t.data,r.maybeThrowRegExp(t,n),2===r.REGEXP_MODE))if(i.vm){var a={string:o,separator:t,limit:e};(u=r.vmCall("string.split(separator, limit)",a,t,n))!==i.REGEXP_TIMEOUT&&n(r.arrayNativeToPseudo(u))}else{var s=r.createWorker(),c=r.regExpTimeout(t,s,n);s.onmessage=function(t){clearTimeout(c),n(r.arrayNativeToPseudo(t.data))},s.postMessage(["split",o,t,e])}else{var u=o.split(t,e);n(r.arrayNativeToPseudo(u))}},this.setAsyncFunctionPrototype(this.STRING,"split",e),e=function(t,e){var n=String(this);if(t=r.isa(t,r.REGEXP)?t.data:new RegExp(t),r.maybeThrowRegExp(t,e),2!==r.REGEXP_MODE)o=n.match(t),e(o&&r.arrayNativeToPseudo(o));else if(i.vm){var o,a={string:n,regexp:t};(o=r.vmCall("string.match(regexp)",a,t,e))!==i.REGEXP_TIMEOUT&&e(o&&r.arrayNativeToPseudo(o))}else{var s=r.createWorker(),c=r.regExpTimeout(t,s,e);s.onmessage=function(t){clearTimeout(c),e(t.data&&r.arrayNativeToPseudo(t.data))},s.postMessage(["match",n,t])}},this.setAsyncFunctionPrototype(this.STRING,"match",e),e=function(t,e){var n=String(this);if(t=r.isa(t,r.REGEXP)?t.data:new RegExp(t),r.maybeThrowRegExp(t,e),2!==r.REGEXP_MODE)e(n.search(t));else if(i.vm){var o={string:n,regexp:t},a=r.vmCall("string.search(regexp)",o,t,e);a!==i.REGEXP_TIMEOUT&&e(a)}else{var s=r.createWorker(),c=r.regExpTimeout(t,s,e);s.onmessage=function(t){clearTimeout(c),e(t.data)},s.postMessage(["search",n,t])}},this.setAsyncFunctionPrototype(this.STRING,"search",e),e=function(t,e,n){var o=String(this);if(e=String(e),r.isa(t,r.REGEXP)&&(t=t.data,r.maybeThrowRegExp(t,n),2===r.REGEXP_MODE))if(i.vm){var a={string:o,substr:t,newSubstr:e},s=r.vmCall("string.replace(substr, newSubstr)",a,t,n);s!==i.REGEXP_TIMEOUT&&n(s)}else{var c=r.createWorker(),u=r.regExpTimeout(t,c,n);c.onmessage=function(t){clearTimeout(u),n(t.data)},c.postMessage(["replace",o,t,e])}else n(o.replace(t,e))},this.setAsyncFunctionPrototype(this.STRING,"replace",e),this.polyfills_.push("(function() {","var replace_ = String.prototype.replace;","String.prototype.replace = function replace(substr, newSubstr) {","if (typeof newSubstr !== 'function') {","return replace_.call(this, substr, newSubstr);","}","var str = this;","if (substr instanceof RegExp) {","var subs = [];","var m = substr.exec(str);","while (m) {","m.push(m.index, str);","var inject = newSubstr.apply(null, m);","subs.push([m.index, m[0].length, inject]);","m = substr.global ? substr.exec(str) : null;","}","for (var i = subs.length - 1; i >= 0; i--) {","str = str.substring(0, subs[i][0]) + subs[i][2] + str.substring(subs[i][0] + subs[i][1]);","}","} else {","var i = str.indexOf(substr);","if (i !== -1) {","var inject = newSubstr(str.substr(i, substr.length), i, str);","str = str.substring(0, i) + inject + str.substring(i + substr.length);","}","}","return str;","};","})();","")},i.prototype.initBoolean=function(t){var e,r=this;e=function(t){return t=i.nativeGlobal.Boolean(t),r.calledWithNew()?(this.data=t,this):t},this.BOOLEAN=this.createNativeFunction(e,!0),this.setProperty(t,"Boolean",this.BOOLEAN,i.NONENUMERABLE_DESCRIPTOR)},i.prototype.initNumber=function(t){var e,r=this;e=function(t){return t=arguments.length?i.nativeGlobal.Number(t):0,r.calledWithNew()?(this.data=t,this):t},this.NUMBER=this.createNativeFunction(e,!0),this.setProperty(t,"Number",this.NUMBER,i.NONENUMERABLE_DESCRIPTOR);for(var n=["MAX_VALUE","MIN_VALUE","NaN","NEGATIVE_INFINITY","POSITIVE_INFINITY"],o=0;o<n.length;o++)this.setProperty(this.NUMBER,n[o],Number[n[o]],i.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR);e=function(t){try{return Number(this).toExponential(t)}catch(t){r.throwException(r.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toExponential",e),e=function(t){try{return Number(this).toFixed(t)}catch(t){r.throwException(r.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toFixed",e),e=function(t){try{return Number(this).toPrecision(t)}catch(t){r.throwException(r.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toPrecision",e),e=function(t){try{return Number(this).toString(t)}catch(t){r.throwException(r.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toString",e),e=function(t,e){t=t?r.pseudoToNative(t):void 0,e=e?r.pseudoToNative(e):void 0;try{return Number(this).toLocaleString(t,e)}catch(t){r.throwException(r.ERROR,"toLocaleString: "+t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toLocaleString",e)},i.prototype.initDate=function(t){var e,r=this;e=function(t,e){if(!r.calledWithNew())return i.nativeGlobal.Date();var n=[null].concat(Array.from(arguments));return this.data=new(Function.prototype.bind.apply(i.nativeGlobal.Date,n)),this},this.DATE=this.createNativeFunction(e,!0),this.DATE_PROTO=this.DATE.properties.prototype,this.setProperty(t,"Date",this.DATE,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"now",this.createNativeFunction(Date.now,!1),i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"parse",this.createNativeFunction(Date.parse,!1),i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"UTC",this.createNativeFunction(Date.UTC,!1),i.NONENUMERABLE_DESCRIPTOR);for(var n=["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","getYear","setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear","toDateString","toISOString","toJSON","toGMTString","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString"],o=0;o<n.length;o++)e=function(t){return function(e){var i=this.data;i instanceof Date||r.throwException(r.TYPE_ERROR,t+" not called on a Date");for(var n=[],o=0;o<arguments.length;o++)n[o]=r.pseudoToNative(arguments[o]);return i[t].apply(i,n)}}(n[o]),this.setNativeFunctionPrototype(this.DATE,n[o],e)},i.prototype.initRegExp=function(t){var e,r=this;e=function(t,e){if(r.calledWithNew())var n=this;else{if(void 0===e&&r.isa(t,r.REGEXP))return t;n=r.createObjectProto(r.REGEXP_PROTO)}t=void 0===t?"":String(t),e=e?String(e):"",/^[gmi]*$/.test(e)||r.throwException(r.SYNTAX_ERROR,"Invalid regexp flag: "+e);try{var o=new i.nativeGlobal.RegExp(t,e)}catch(t){r.throwException(r.SYNTAX_ERROR,t.message)}return r.populateRegExp(n,o),n},this.REGEXP=this.createNativeFunction(e,!0),this.REGEXP_PROTO=this.REGEXP.properties.prototype,this.setProperty(t,"RegExp",this.REGEXP,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"global",void 0,i.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"ignoreCase",void 0,i.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"multiline",void 0,i.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"source","(?:)",i.READONLY_NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("Object.defineProperty(RegExp.prototype, 'test',","{configurable: true, writable: true, value:","function test(str) {","return !!this.exec(str);","}","});"),e=function(t,e){var n=this.data;if(t=String(t),n.lastIndex=Number(r.getProperty(this,"lastIndex")),r.maybeThrowRegExp(n,e),2!==r.REGEXP_MODE)o=n.exec(t),r.setProperty(this,"lastIndex",n.lastIndex),e(p(o));else if(i.vm){var o,a={string:t,regexp:n};(o=r.vmCall("regexp.exec(string)",a,n,e))!==i.REGEXP_TIMEOUT&&(r.setProperty(this,"lastIndex",n.lastIndex),e(p(o)))}else{var s=r.createWorker(),c=r.regExpTimeout(n,s,e),u=this;s.onmessage=function(t){clearTimeout(c),r.setProperty(u,"lastIndex",t.data[1]),e(p(t.data[0]))},s.postMessage(["exec",n,n.lastIndex,t])}function p(t){if(t){var e=r.arrayNativeToPseudo(t);return r.setProperty(e,"index",t.index),r.setProperty(e,"input",t.input),e}return null}},this.setAsyncFunctionPrototype(this.REGEXP,"exec",e)},i.prototype.initError=function(t){var e=this;this.ERROR=this.createNativeFunction((function(t){if(e.calledWithNew())var r=this;else r=e.createObject(e.ERROR);return e.populateError(r,t),r}),!0),this.setProperty(t,"Error",this.ERROR,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ERROR.properties.prototype,"message","",i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ERROR.properties.prototype,"name","Error",i.NONENUMERABLE_DESCRIPTOR);var r=function(r){var n=e.createNativeFunction((function(t){if(e.calledWithNew())var r=this;else r=e.createObject(n);return e.populateError(r,t),r}),!0);return e.setProperty(n,"prototype",e.createObject(e.ERROR),i.NONENUMERABLE_DESCRIPTOR),e.setProperty(n.properties.prototype,"name",r,i.NONENUMERABLE_DESCRIPTOR),e.setProperty(t,r,n,i.NONENUMERABLE_DESCRIPTOR),n};this.EVAL_ERROR=r("EvalError"),this.RANGE_ERROR=r("RangeError"),this.REFERENCE_ERROR=r("ReferenceError"),this.SYNTAX_ERROR=r("SyntaxError"),this.TYPE_ERROR=r("TypeError"),this.URI_ERROR=r("URIError")},i.prototype.initMath=function(t){var e=this.createObjectProto(this.OBJECT_PROTO);this.setProperty(t,"Math",e,i.NONENUMERABLE_DESCRIPTOR);for(var r=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2"],n=0;n<r.length;n++)this.setProperty(e,r[n],Math[r[n]],i.READONLY_NONENUMERABLE_DESCRIPTOR);var o=["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan"];for(n=0;n<o.length;n++)this.setProperty(e,o[n],this.createNativeFunction(Math[o[n]],!1),i.NONENUMERABLE_DESCRIPTOR)},i.prototype.initJSON=function(t){var e,r=this,n=r.createObjectProto(this.OBJECT_PROTO);this.setProperty(t,"JSON",n,i.NONENUMERABLE_DESCRIPTOR),e=function(t){try{var e=JSON.parse(String(t))}catch(t){r.throwException(r.SYNTAX_ERROR,t.message)}return r.nativeToPseudo(e)},this.setProperty(n,"parse",this.createNativeFunction(e,!1)),e=function(t,e,i){e&&"Function"===e.class?r.throwException(r.TYPE_ERROR,"Function replacer on JSON.stringify not supported"):e=e&&"Array"===e.class?(e=r.arrayPseudoToNative(e)).filter((function(t){return"string"==typeof t||"number"==typeof t})):null,"string"!=typeof i&&"number"!=typeof i&&(i=void 0);var n=r.pseudoToNative(t);try{var o=JSON.stringify(n,e,i)}catch(t){r.throwException(r.TYPE_ERROR,t.message)}return o},this.setProperty(n,"stringify",this.createNativeFunction(e,!1))},i.prototype.isa=function(t,e){if(null==t||!e)return!1;var r=e.properties.prototype;if(t===r)return!0;for(t=this.getPrototype(t);t;){if(t===r)return!0;t=t.proto}return!1},i.prototype.populateRegExp=function(t,e){t.data=new RegExp(e.source,e.flags),this.setProperty(t,"lastIndex",e.lastIndex,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(t,"source",e.source,i.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(t,"global",e.global,i.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(t,"ignoreCase",e.ignoreCase,i.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(t,"multiline",e.multiline,i.READONLY_NONENUMERABLE_DESCRIPTOR)},i.prototype.populateError=function(t,e){e&&this.setProperty(t,"message",String(e),i.NONENUMERABLE_DESCRIPTOR);for(var r=[],n=this.stateStack.length-1;n>=0;n--){var o=this.stateStack[n],a=o.node;if("CallExpression"===a.type){var s=o.func_;s&&r.length&&(r[r.length-1].datumName=this.getProperty(s,"name"))}!a.loc||r.length&&"CallExpression"!==a.type||r.push({datumLoc:a.loc})}var c=String(this.getProperty(t,"name"))+": "+String(this.getProperty(t,"message"))+"\n";for(n=0;n<r.length;n++){var u=r[n].datumLoc,p=r[n].datumName,l=u.source+":"+u.start.line+":"+u.start.column;c+=p?"  at "+p+" ("+l+")\n":"  at "+l+"\n"}this.setProperty(t,"stack",c.trim(),i.NONENUMERABLE_DESCRIPTOR)},i.prototype.createWorker=function(){var t=this.createWorker.blob_;return t||(t=new Blob([i.WORKER_CODE.join("\n")],{type:"application/javascript"}),this.createWorker.blob_=t),new Worker(URL.createObjectURL(t))},i.prototype.vmCall=function(t,e,r,n){var o={timeout:this.REGEXP_THREAD_TIMEOUT};try{return i.vm.runInNewContext(t,e,o)}catch(t){n(null),this.throwException(this.ERROR,"RegExp Timeout: "+r)}return i.REGEXP_TIMEOUT},i.prototype.maybeThrowRegExp=function(t,e){var n;if(0===this.REGEXP_MODE)n=!1;else if(1===this.REGEXP_MODE)n=!0;else if(i.vm)n=!0;else if("function"==typeof Worker&&"function"==typeof URL)n=!0;else{try{i.vm=r("vm")}catch(t){}n=!!i.vm}n||(e(null),this.throwException(this.ERROR,"Regular expressions not supported: "+t))},i.prototype.regExpTimeout=function(t,e,r){var i=this;return setTimeout((function(){e.terminate(),r(null);try{i.throwException(i.ERROR,"RegExp Timeout: "+t)}catch(t){}}),this.REGEXP_THREAD_TIMEOUT)},i.prototype.createObject=function(t){return this.createObjectProto(t&&t.properties.prototype)},i.prototype.createObjectProto=function(t){if("object"!=typeof t)throw Error("Non object prototype");var e=new i.Object(t);return this.isa(e,this.ERROR)&&(e.class="Error"),e},i.prototype.createArray=function(){var t=this.createObjectProto(this.ARRAY_PROTO);return this.setProperty(t,"length",0,{configurable:!1,enumerable:!1,writable:!0}),t.class="Array",t},i.prototype.createFunctionBase_=function(t,e){var r=this.createObjectProto(this.FUNCTION_PROTO);if(e){var n=this.createObjectProto(this.OBJECT_PROTO);this.setProperty(r,"prototype",n,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(n,"constructor",r,i.NONENUMERABLE_DESCRIPTOR)}else r.illegalConstructor=!0;return this.setProperty(r,"length",t,i.READONLY_NONENUMERABLE_DESCRIPTOR),r.class="Function",r},i.prototype.createFunction=function(t,e,r){var n=this.createFunctionBase_(t.params.length,!0);n.parentScope=e,n.node=t;var o=t.id?String(t.id.name):r||"";return this.setProperty(n,"name",o,i.READONLY_NONENUMERABLE_DESCRIPTOR),n},i.prototype.createNativeFunction=function(t,e){var r=this.createFunctionBase_(t.length,e);return r.nativeFunc=t,t.id=this.functionCounter_++,this.setProperty(r,"name",t.name,i.READONLY_NONENUMERABLE_DESCRIPTOR),r},i.prototype.createAsyncFunction=function(t){var e=this.createFunctionBase_(t.length,!0);return e.asyncFunc=t,t.id=this.functionCounter_++,this.setProperty(e,"name",t.name,i.READONLY_NONENUMERABLE_DESCRIPTOR),e},i.prototype.nativeToPseudo=function(t){if(t instanceof i.Object)throw Error("Object is already pseudo");if(null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t)return t;if(t instanceof RegExp){var e=this.createObjectProto(this.REGEXP_PROTO);return this.populateRegExp(e,t),e}if(t instanceof Date){var r=this.createObjectProto(this.DATE_PROTO);return r.data=new Date(t.valueOf()),r}if("function"==typeof t){var n=this,o=Object.getOwnPropertyDescriptor(t,"prototype");return this.createNativeFunction((function(){var e=Array.prototype.slice.call(arguments).map((function(t){return n.pseudoToNative(t)})),r=t.apply(n,e);return n.nativeToPseudo(r)}),!!o)}if(Array.isArray(t)){for(var a=this.createArray(),s=0;s<t.length;s++)s in t&&this.setProperty(a,s,this.nativeToPseudo(t[s]));return a}var c=this.createObjectProto(this.OBJECT_PROTO);for(var u in t)this.setProperty(c,u,this.nativeToPseudo(t[u]));return c},i.prototype.pseudoToNative=function(t,e){if("object"!=typeof t&&"function"!=typeof t||null===t)return t;if(!(t instanceof i.Object))throw Error("Object is not pseudo");if(this.isa(t,this.REGEXP)){var r=new RegExp(t.data.source,t.data.flags);return r.lastIndex=t.data.lastIndex,r}if(this.isa(t,this.DATE))return new Date(t.data.valueOf());var n,o=e||{pseudo:[],native:[]},a=o.pseudo.indexOf(t);if(-1!==a)return o.native[a];if(o.pseudo.push(t),this.isa(t,this.ARRAY)){n=[],o.native.push(n);for(var s=this.getProperty(t,"length"),c=0;c<s;c++)this.hasProperty(t,c)&&(n[c]=this.pseudoToNative(this.getProperty(t,c),o))}else{var u;for(var p in n={},o.native.push(n),t.properties)u=this.pseudoToNative(t.properties[p],o),Object.defineProperty(n,p,{value:u,writable:!0,enumerable:!0,configurable:!0})}return o.pseudo.pop(),o.native.pop(),n},i.prototype.arrayNativeToPseudo=function(t){for(var e=this.createArray(),r=Object.getOwnPropertyNames(t),i=0;i<r.length;i++)this.setProperty(e,r[i],t[r[i]]);return e},i.prototype.arrayPseudoToNative=function(t){var e=[];for(var r in t.properties)e[r]=this.getProperty(t,r);return e.length=i.legalArrayLength(this.getProperty(t,"length"))||0,e},i.prototype.getPrototype=function(t){switch(typeof t){case"number":return this.NUMBER.properties.prototype;case"boolean":return this.BOOLEAN.properties.prototype;case"string":return this.STRING.properties.prototype}return t?t.proto:null},i.prototype.getProperty=function(t,e){if(this.getterStep_)throw Error("Getter not supported in that context");if(e=String(e),null==t&&this.throwException(this.TYPE_ERROR,"Cannot read property '"+e+"' of "+t),"object"==typeof t&&!(t instanceof i.Object))throw TypeError("Expecting native value or pseudo object");if("length"===e){if(this.isa(t,this.STRING))return String(t).length}else if(e.charCodeAt(0)<64&&this.isa(t,this.STRING)){var r=i.legalArrayIndex(e);if(!isNaN(r)&&r<String(t).length)return String(t)[r]}do{if(t.properties&&e in t.properties){var n=t.getter[e];return n?(this.getterStep_=!0,n):t.properties[e]}}while(t=this.getPrototype(t))},i.prototype.hasProperty=function(t,e){if(!(t instanceof i.Object))throw TypeError("Primitive data type has no properties");if("length"===(e=String(e))&&this.isa(t,this.STRING))return!0;if(this.isa(t,this.STRING)){var r=i.legalArrayIndex(e);if(!isNaN(r)&&r<String(t).length)return!0}do{if(t.properties&&e in t.properties)return!0}while(t=this.getPrototype(t));return!1},i.prototype.setProperty=function(t,e,r,n){if(this.setterStep_)throw Error("Setter not supported in that context");if(e=String(e),null==t&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+e+"' of "+t),"object"==typeof t&&!(t instanceof i.Object))throw TypeError("Expecting native value or pseudo object");n&&("get"in n||"set"in n)&&("value"in n||"writable"in n)&&this.throwException(this.TYPE_ERROR,"Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");var o=!this.stateStack||this.getScope().strict;if(t instanceof i.Object){if(this.isa(t,this.STRING)){var a=i.legalArrayIndex(e);if("length"===e||!isNaN(a)&&a<String(t).length)return void(o&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+e+"' of String '"+t.data+"'"))}if("Array"===t.class){var s,c=t.properties.length;if("length"===e){if(n){if(!("value"in n))return;r=n.value}if(r=i.legalArrayLength(r),isNaN(r)&&this.throwException(this.RANGE_ERROR,"Invalid array length"),r<c)for(s in t.properties)s=i.legalArrayIndex(s),!isNaN(s)&&r<=s&&delete t.properties[s]}else isNaN(s=i.legalArrayIndex(e))||(t.properties.length=Math.max(c,s+1))}if(!t.preventExtensions||e in t.properties)if(n){var u={};"get"in n&&n.get&&(t.getter[e]=n.get,u.get=this.setProperty.placeholderGet_),"set"in n&&n.set&&(t.setter[e]=n.set,u.set=this.setProperty.placeholderSet_),"configurable"in n&&(u.configurable=n.configurable),"enumerable"in n&&(u.enumerable=n.enumerable),"writable"in n&&(u.writable=n.writable,delete t.getter[e],delete t.setter[e]),"value"in n?(u.value=n.value,delete t.getter[e],delete t.setter[e]):r!==i.VALUE_IN_DESCRIPTOR&&(u.value=r,delete t.getter[e],delete t.setter[e]);try{Object.defineProperty(t.properties,e,u)}catch(t){this.throwException(this.TYPE_ERROR,"Cannot redefine property: "+e)}"get"in n&&!n.get&&delete t.getter[e],"set"in n&&!n.set&&delete t.setter[e]}else{if(r===i.VALUE_IN_DESCRIPTOR)throw ReferenceError("Value not specified");for(var p=t;!(e in p.properties);)if(!(p=this.getPrototype(p))){p=t;break}if(p.setter&&p.setter[e])return this.setterStep_=!0,p.setter[e];if(p.getter&&p.getter[e])o&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+e+"' of object '"+t+"' which only has a getter");else try{t.properties[e]=r}catch(r){o&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+e+"' of object '"+t+"'")}}else o&&this.throwException(this.TYPE_ERROR,"Can't add property '"+e+"', object is not extensible")}else o&&this.throwException(this.TYPE_ERROR,"Can't create property '"+e+"' on '"+t+"'")},i.prototype.setProperty.placeholderGet_=function(){throw Error("Placeholder getter")},i.prototype.setProperty.placeholderSet_=function(){throw Error("Placeholder setter")},i.prototype.setNativeFunctionPrototype=function(t,e,r){this.setProperty(t.properties.prototype,e,this.createNativeFunction(r,!1),i.NONENUMERABLE_DESCRIPTOR)},i.prototype.setAsyncFunctionPrototype=function(t,e,r){this.setProperty(t.properties.prototype,e,this.createAsyncFunction(r),i.NONENUMERABLE_DESCRIPTOR)},i.prototype.getScope=function(){var t=this.stateStack[this.stateStack.length-1].scope;if(!t)throw Error("No scope found");return t},i.prototype.createScope=function(t,e){var r=!1;if(e&&e.strict)r=!0;else{var n=t.body&&t.body[0];n&&n.expression&&"Literal"===n.expression.type&&"use strict"===n.expression.value&&(r=!0)}var o=this.createObjectProto(null),a=new i.Scope(e,r,o);return e||this.initGlobal(a.object),this.populateScope_(t,a),a},i.prototype.createSpecialScope=function(t,e){if(!t)throw Error("parentScope required");var r=e||this.createObjectProto(null);return new i.Scope(t,t.strict,r)},i.prototype.getValueFromScope=function(t){for(var e=this.getScope();e&&e!==this.globalScope;){if(t in e.object.properties)return e.object.properties[t];e=e.parentScope}if(e===this.globalScope&&this.hasProperty(e.object,t))return this.getProperty(e.object,t);var r=this.stateStack[this.stateStack.length-1].node;"UnaryExpression"===r.type&&"typeof"===r.operator||this.throwException(this.REFERENCE_ERROR,t+" is not defined")},i.prototype.setValueToScope=function(t,e){for(var r=this.getScope(),i=r.strict;r&&r!==this.globalScope;){if(t in r.object.properties){try{r.object.properties[t]=e}catch(e){i&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only variable '"+t+"'")}return}r=r.parentScope}if(r===this.globalScope&&(!i||this.hasProperty(r.object,t)))return this.setProperty(r.object,t,e);this.throwException(this.REFERENCE_ERROR,t+" is not defined")},i.prototype.populateScope_=function(t,e){var r;if(t.variableCache_)r=t.variableCache_;else{switch(r=Object.create(null),t.type){case"VariableDeclaration":for(var n=0;n<t.declarations.length;n++)r[t.declarations[n].id.name]=!0;break;case"FunctionDeclaration":r[t.id.name]=t;break;case"BlockStatement":case"CatchClause":case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"Program":case"SwitchCase":case"SwitchStatement":case"TryStatement":case"WithStatement":case"WhileStatement":var o=t.constructor;for(var a in t)if("loc"!==a){var s,c=t[a];if(c&&"object"==typeof c)if(Array.isArray(c)){for(n=0;n<c.length;n++)if(c[n]&&c[n].constructor===o)for(var a in s=this.populateScope_(c[n],e))r[a]=s[a]}else if(c.constructor===o)for(var a in s=this.populateScope_(c,e))r[a]=s[a]}}t.variableCache_=r}for(var a in r)!0===r[a]?this.setProperty(e.object,a,void 0,i.VARIABLE_DESCRIPTOR):this.setProperty(e.object,a,this.createFunction(r[a],e),i.VARIABLE_DESCRIPTOR);return r},i.prototype.calledWithNew=function(){return this.stateStack[this.stateStack.length-1].isConstructor},i.prototype.getValue=function(t){return t[0]===i.SCOPE_REFERENCE?this.getValueFromScope(t[1]):this.getProperty(t[0],t[1])},i.prototype.setValue=function(t,e){return t[0]===i.SCOPE_REFERENCE?this.setValueToScope(t[1],e):this.setProperty(t[0],t[1],e)},i.prototype.throwException=function(t,e){if(!this.globalScope)throw void 0===e?t:e;if(void 0!==e&&t instanceof i.Object)r=this.createObject(t),this.populateError(r,e);else var r=t;throw this.unwind(i.Completion.THROW,r,void 0),i.STEP_ERROR},i.prototype.unwind=function(t,e,r){if(t===i.Completion.NORMAL)throw TypeError("Should not unwind for NORMAL completions");t:for(var n=this.stateStack;n.length>0;n.pop()){var o=n[n.length-1];switch(o.node.type){case"TryStatement":return void(o.cv={type:t,value:e,label:r});case"CallExpression":case"NewExpression":if(t===i.Completion.RETURN)return void(o.value=e);if(t!==i.Completion.THROW)throw Error("Unsyntactic break/continue not rejected by Acorn");break;case"Program":o.done=!0;break t}if(t===i.Completion.BREAK){if(r?o.labels&&-1!==o.labels.indexOf(r):o.isLoop||o.isSwitch)return void n.pop()}else if(t===i.Completion.CONTINUE&&(r?o.labels&&-1!==o.labels.indexOf(r):o.isLoop))return}var a;if(this.isa(e,this.ERROR)){var s={EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError},c=String(this.getProperty(e,"name")),u=this.getProperty(e,"message").valueOf();(a=(s[c]||Error)(u)).stack=String(this.getProperty(e,"stack"))}else a=String(e);throw this.value=a,a},i.prototype.nodeSummary=function(t){switch(t.type){case"ArrayExpression":return"[...]";case"BinaryExpression":case"LogicalExpression":return this.nodeSummary(t.left)+" "+t.operator+" "+this.nodeSummary(t.right);case"CallExpression":return this.nodeSummary(t.callee)+"(...)";case"ConditionalExpression":return this.nodeSummary(t.test)+" ? "+this.nodeSummary(t.consequent)+" : "+this.nodeSummary(t.alternate);case"Identifier":return t.name;case"Literal":return t.raw;case"MemberExpression":var e=this.nodeSummary(t.object),r=this.nodeSummary(t.property);return t.computed?e+"["+r+"]":e+"."+r;case"NewExpression":return"new "+this.nodeSummary(t.callee)+"(...)";case"ObjectExpression":return"{...}";case"ThisExpression":return"this";case"UnaryExpression":return t.operator+" "+this.nodeSummary(t.argument);case"UpdateExpression":var i=this.nodeSummary(t.argument);return t.prefix?t.operator+i:i+t.operator}return"???"},i.prototype.createTask_=function(t,e){var r,n,o,a=this.stateStack[this.stateStack.length-1],s=Array.from(e),c=s.shift(),u=Math.max(Number(s.shift()||0),0),p=this.newNode();if(c instanceof i.Object&&"Function"===c.class)n=c,p.type="CallExpression",r=a.scope;else{try{o=this.parse_(String(c),"taskCode"+this.taskCodeNumber_++)}catch(t){this.throwException(this.SYNTAX_ERROR,"Invalid code: "+t.message)}p.type="EvalProgram_",p.body=o.body;var l=a.node.arguments[0],h=l?l.start:void 0,f=l?l.end:void 0;i.stripLocations_(p,h,f),r=this.globalScope,s.length=0}var d=new i.Task(n,s,r,p,t?u:-1);return this.scheduleTask_(d,u),d.pid},i.prototype.scheduleTask_=function(t,e){t.time=Date.now()+e,this.tasks.push(t),this.tasks.sort((function(t,e){return t.time-e.time}))},i.prototype.deleteTask_=function(t){for(var e=0;e<this.tasks.length;e++)if(this.tasks[e].pid==t){this.tasks.splice(e,1);break}},i.prototype.nextTask_=function(){var t=this.tasks[0];if(!t||t.time>Date.now())return null;this.tasks.shift(),t.interval>=0&&this.scheduleTask_(t,t.interval);var e=new i.State(t.node,t.scope);return t.functionRef&&(e.doneCallee_=2,e.funcThis_=this.globalObject,e.func_=t.functionRef,e.doneArgs_=!0,e.arguments_=t.argsArray),e},i.prototype.createGetter_=function(t,e){if(!this.getterStep_)throw Error("Unexpected call to createGetter");this.getterStep_=!1;var r=Array.isArray(e)?e[0]:e,n=this.newNode();n.type="CallExpression";var o=new i.State(n,this.stateStack[this.stateStack.length-1].scope);return o.doneCallee_=2,o.funcThis_=r,o.func_=t,o.doneArgs_=!0,o.arguments_=[],o},i.prototype.createSetter_=function(t,e,r){if(!this.setterStep_)throw Error("Unexpected call to createSetter");this.setterStep_=!1;var n=Array.isArray(e)?e[0]:this.globalObject,o=this.newNode();o.type="CallExpression";var a=new i.State(o,this.stateStack[this.stateStack.length-1].scope);return a.doneCallee_=2,a.funcThis_=n,a.func_=t,a.doneArgs_=!0,a.arguments_=[r],a},i.prototype.boxThis_=function(t){if(null==t)return this.globalObject;if(!(t instanceof i.Object)){var e=this.createObjectProto(this.getPrototype(t));return e.data=t,e}return t},i.prototype.getGlobalScope=function(){return this.globalScope},i.prototype.getStateStack=function(){return this.stateStack},i.prototype.setStateStack=function(t){this.stateStack=t},i.Value,i.State=function(t,e){this.node=t,this.scope=e},i.Scope=function(t,e,r){this.parentScope=t,this.strict=e,this.object=r},i.Object=function(t){this.getter=Object.create(null),this.setter=Object.create(null),this.properties=Object.create(null),this.proto=t},i.Object.prototype.proto=null,i.Object.prototype.class="Object",i.Object.prototype.data=null,i.Object.prototype.toString=function(){if(!i.currentInterpreter_)return"[object Interpreter.Object]";if(!(this instanceof i.Object))return String(this);if("Array"===this.class){(a=i.toStringCycles_).push(this);try{var t=[],e=this.properties.length,r=!1;e>1024&&(e=1e3,r=!0);for(var n=0;n<e;n++){var o=this.properties[n];t[n]=o instanceof i.Object&&-1!==a.indexOf(o)?"...":o}r&&t.push("...")}finally{a.pop()}return t.join(",")}if("Error"===this.class){var a,s,c;if(-1!==(a=i.toStringCycles_).indexOf(this))return"[object Error]";var u=this;do{if("name"in u.properties){s=u.properties.name;break}}while(u=u.proto);u=this;do{if("message"in u.properties){c=u.properties.message;break}}while(u=u.proto);a.push(this);try{s=s&&String(s),c=c&&String(c)}finally{a.pop()}return c?s+": "+c:String(s)}return null!==this.data?String(this.data):"[object "+this.class+"]"},i.Object.prototype.valueOf=function(){return i.currentInterpreter_?void 0===this.data||null===this.data||this.data instanceof RegExp?this:this.data instanceof Date?this.data.valueOf():this.data:this},i.Task=function(t,e,r,n,o){this.functionRef=t,this.argsArray=e,this.scope=r,this.node=n,this.interval=o,this.pid=++i.Task.pid,this.time=0},i.Task.pid=0,i.prototype.stepArrayExpression=function(t,e,r){var n=r.elements,o=e.n_||0;for(e.array_?(this.setProperty(e.array_,o,e.value),o++):(e.array_=this.createArray(),e.array_.properties.length=n.length);o<n.length;){if(n[o])return e.n_=o,new i.State(n[o],e.scope);o++}t.pop(),t[t.length-1].value=e.array_},i.prototype.stepAssignmentExpression=function(t,e,r){if(!e.doneLeft_){e.doneLeft_=!0;var n=new i.State(r.left,e.scope);return n.components=!0,n}if(!e.doneRight_){if(e.leftReference_||(e.leftReference_=e.value),e.doneGetter_&&(e.leftValue_=e.value),!e.doneGetter_&&"="!==r.operator){var o=this.getValue(e.leftReference_);if(e.leftValue_=o,this.getterStep_){e.doneGetter_=!0;var a=o;return this.createGetter_(a,e.leftReference_)}}return e.doneRight_=!0,"="===r.operator&&"Identifier"===r.left.type&&(e.destinationName=r.left.name),new i.State(r.right,e.scope)}if(e.doneSetter_)return t.pop(),void(t[t.length-1].value=e.setterValue_);var s=e.leftValue_,c=e.value;switch(r.operator){case"=":s=c;break;case"+=":s+=c;break;case"-=":s-=c;break;case"*=":s*=c;break;case"/=":s/=c;break;case"%=":s%=c;break;case"<<=":s<<=c;break;case">>=":s>>=c;break;case">>>=":s>>>=c;break;case"&=":s&=c;break;case"^=":s^=c;break;case"|=":s|=c;break;default:throw SyntaxError("Unknown assignment expression: "+r.operator)}var u=this.setValue(e.leftReference_,s);if(u)return e.doneSetter_=!0,e.setterValue_=s,this.createSetter_(u,e.leftReference_,s);t.pop(),t[t.length-1].value=s},i.prototype.stepBinaryExpression=function(t,e,r){if(!e.doneLeft_)return e.doneLeft_=!0,new i.State(r.left,e.scope);if(!e.doneRight_)return e.doneRight_=!0,e.leftValue_=e.value,new i.State(r.right,e.scope);t.pop();var n,o=e.leftValue_,a=e.value;switch(r.operator){case"==":n=o==a;break;case"!=":n=o!=a;break;case"===":n=o===a;break;case"!==":n=o!==a;break;case">":n=o>a;break;case">=":n=o>=a;break;case"<":n=o<a;break;case"<=":n=o<=a;break;case"+":n=o+a;break;case"-":n=o-a;break;case"*":n=o*a;break;case"/":n=o/a;break;case"%":n=o%a;break;case"&":n=o&a;break;case"|":n=o|a;break;case"^":n=o^a;break;case"<<":n=o<<a;break;case">>":n=o>>a;break;case">>>":n=o>>>a;break;case"in":a instanceof i.Object||this.throwException(this.TYPE_ERROR,"'in' expects an object, not '"+a+"'"),n=this.hasProperty(a,o);break;case"instanceof":this.isa(a,this.FUNCTION)||this.throwException(this.TYPE_ERROR,"'instanceof' expects an object, not '"+a+"'"),n=o instanceof i.Object&&this.isa(o,a);break;default:throw SyntaxError("Unknown binary operator: "+r.operator)}t[t.length-1].value=n},i.prototype.stepBlockStatement=function(t,e,r){var n=e.n_||0,o=r.body[n];if(o)return e.n_=n+1,new i.State(o,e.scope);t.pop()},i.prototype.stepBreakStatement=function(t,e,r){var n=r.label&&r.label.name;this.unwind(i.Completion.BREAK,void 0,n)},i.prototype.evalCodeNumber_=0,i.prototype.stepCallExpression=function(t,e,r){if(!e.doneCallee_){e.doneCallee_=1;var n=new i.State(r.callee,e.scope);return n.components=!0,n}if(1===e.doneCallee_){e.doneCallee_=2;var o=e.value;if(Array.isArray(o)){if(e.func_=this.getValue(o),o[0]===i.SCOPE_REFERENCE?e.directEval_="eval"===o[1]:e.funcThis_=o[0],o=e.func_,this.getterStep_)return e.doneCallee_=1,this.createGetter_(o,e.value)}else e.func_=o;e.arguments_=[],e.n_=0}if(o=e.func_,!e.doneArgs_){if(0!==e.n_&&e.arguments_.push(e.value),r.arguments[e.n_])return new i.State(r.arguments[e.n_++],e.scope);if("NewExpression"===r.type){if(o instanceof i.Object&&!o.illegalConstructor||this.throwException(this.TYPE_ERROR,this.nodeSummary(r.callee)+" is not a constructor"),o===this.ARRAY)e.funcThis_=this.createArray();else{var a=o.properties.prototype;"object"==typeof a&&null!==a||(a=this.OBJECT_PROTO),e.funcThis_=this.createObjectProto(a)}e.isConstructor=!0}e.doneArgs_=!0}if(e.doneExec_)t.pop(),e.isConstructor&&"object"!=typeof e.value?t[t.length-1].value=e.funcThis_:t[t.length-1].value=e.value;else{e.doneExec_=!0,o instanceof i.Object||this.throwException(this.TYPE_ERROR,this.nodeSummary(r.callee)+" is not a function");var s=o.node;if(s){for(var c=this.createScope(s.body,o.parentScope),u=this.createArray(),p=0;p<e.arguments_.length;p++)this.setProperty(u,p,e.arguments_[p]);for(this.setProperty(c.object,"arguments",u),p=0;p<s.params.length;p++){var l=s.params[p].name,h=e.arguments_.length>p?e.arguments_[p]:void 0;this.setProperty(c.object,l,h)}return c.strict||(e.funcThis_=this.boxThis_(e.funcThis_)),this.setProperty(c.object,"this",e.funcThis_,i.READONLY_DESCRIPTOR),e.value=void 0,new i.State(s.body,c)}if(o.eval){var f=e.arguments_[0];if("string"==typeof f){try{var d=this.parse_(String(f),"eval"+this.evalCodeNumber_++)}catch(t){this.throwException(this.SYNTAX_ERROR,"Invalid code: "+t.message)}var E=this.newNode();return E.type="EvalProgram_",E.body=d.body,i.stripLocations_(E,r.start,r.end),(c=e.directEval_?e.scope:this.globalScope).strict?c=this.createScope(d,c):this.populateScope_(d,c),this.value=void 0,new i.State(E,c)}e.value=f}else if(o.nativeFunc)e.scope.strict||(e.funcThis_=this.boxThis_(e.funcThis_)),e.value=o.nativeFunc.apply(e.funcThis_,e.arguments_);else{if(o.asyncFunc){var g=this,y=o.asyncFunc.length-1,b=e.arguments_.concat(new Array(y)).slice(0,y);return b.push((function(t){e.value=t,g.paused_=!1})),this.paused_=!0,e.scope.strict||(e.funcThis_=this.boxThis_(e.funcThis_)),void o.asyncFunc.apply(e.funcThis_,b)}this.throwException(this.TYPE_ERROR,this.nodeSummary(r.callee)+" is not callable")}}},i.prototype.stepConditionalExpression=function(t,e,r){var n=e.mode_||0;if(0===n)return e.mode_=1,new i.State(r.test,e.scope);if(1===n){e.mode_=2;var o=Boolean(e.value);if(o&&r.consequent)return new i.State(r.consequent,e.scope);if(!o&&r.alternate)return new i.State(r.alternate,e.scope);this.value=void 0}t.pop(),"ConditionalExpression"===r.type&&(t[t.length-1].value=e.value)},i.prototype.stepContinueStatement=function(t,e,r){var n=r.label&&r.label.name;this.unwind(i.Completion.CONTINUE,void 0,n)},i.prototype.stepDebuggerStatement=function(t,e,r){t.pop()},i.prototype.stepDoWhileStatement=function(t,e,r){if("DoWhileStatement"===r.type&&void 0===e.test_&&(e.value=!0,e.test_=!0),!e.test_)return e.test_=!0,new i.State(r.test,e.scope);if(e.value){if(r.body)return e.test_=!1,e.isLoop=!0,new i.State(r.body,e.scope)}else t.pop()},i.prototype.stepEmptyStatement=function(t,e,r){t.pop()},i.prototype.stepEvalProgram_=function(t,e,r){var n=e.n_||0,o=r.body[n];if(o)return e.n_=n+1,new i.State(o,e.scope);t.pop(),t[t.length-1].value=this.value},i.prototype.stepExpressionStatement=function(t,e,r){if(!e.done_)return this.value=void 0,e.done_=!0,new i.State(r.expression,e.scope);t.pop(),this.value=e.value},i.prototype.stepForInStatement=function(t,e,r){if(!e.doneInit_&&(e.doneInit_=!0,r.left.declarations&&r.left.declarations[0].init))return e.scope.strict&&this.throwException(this.SYNTAX_ERROR,"for-in loop variable declaration may not have an initializer"),new i.State(r.left,e.scope);if(!e.doneObject_)return e.doneObject_=!0,e.variable_||(e.variable_=e.value),new i.State(r.right,e.scope);if(e.isLoop||(e.isLoop=!0,e.object_=e.value,e.visited_=Object.create(null)),void 0===e.name_)t:for(;;){if(e.object_ instanceof i.Object){for(e.props_||(e.props_=Object.getOwnPropertyNames(e.object_.properties));void 0!==(n=e.props_.shift());)if(Object.prototype.hasOwnProperty.call(e.object_.properties,n)&&!e.visited_[n]&&(e.visited_[n]=!0,Object.prototype.propertyIsEnumerable.call(e.object_.properties,n))){e.name_=n;break t}}else if(null!==e.object_&&void 0!==e.object_)for(e.props_||(e.props_=Object.getOwnPropertyNames(e.object_));;){var n;if(void 0===(n=e.props_.shift()))break;if(e.visited_[n]=!0,Object.prototype.propertyIsEnumerable.call(e.object_,n)){e.name_=n;break t}}if(e.object_=this.getPrototype(e.object_),e.props_=null,null===e.object_)return void t.pop()}if(!e.doneVariable_){e.doneVariable_=!0;var o=r.left;if("VariableDeclaration"!==o.type){e.variable_=null;var a=new i.State(o,e.scope);return a.components=!0,a}e.variable_=[i.SCOPE_REFERENCE,o.declarations[0].id.name]}if(e.variable_||(e.variable_=e.value),!e.doneSetter_){e.doneSetter_=!0;var s=e.name_,c=this.setValue(e.variable_,s);if(c)return this.createSetter_(c,e.variable_,s)}return e.name_=void 0,e.doneVariable_=!1,e.doneSetter_=!1,r.body?new i.State(r.body,e.scope):void 0},i.prototype.stepForStatement=function(t,e,r){switch(e.mode_){default:if(e.mode_=1,r.init)return new i.State(r.init,e.scope);break;case 1:if(e.mode_=2,r.test)return new i.State(r.test,e.scope);break;case 2:if(e.mode_=3,!r.test||e.value)return e.isLoop=!0,new i.State(r.body,e.scope);t.pop();break;case 3:if(e.mode_=1,r.update)return new i.State(r.update,e.scope)}},i.prototype.stepFunctionDeclaration=function(t,e,r){t.pop()},i.prototype.stepFunctionExpression=function(t,e,r){t.pop();var n=(e=t[t.length-1]).scope;r.id&&(n=this.createSpecialScope(n)),e.value=this.createFunction(r,n,e.destinationName),r.id&&this.setProperty(n.object,r.id.name,e.value,i.READONLY_DESCRIPTOR)},i.prototype.stepIdentifier=function(t,e,r){if(t.pop(),e.components)t[t.length-1].value=[i.SCOPE_REFERENCE,r.name];else{var n=this.getValueFromScope(r.name);if(this.getterStep_){var o=n;return this.createGetter_(o,this.globalObject)}t[t.length-1].value=n}},i.prototype.stepIfStatement=i.prototype.stepConditionalExpression,i.prototype.stepLabeledStatement=function(t,e,r){t.pop();var n=e.labels||[];n.push(r.label.name);var o=new i.State(r.body,e.scope);return o.labels=n,o},i.prototype.stepLiteral=function(t,e,r){t.pop();var i=r.value;if(i instanceof RegExp){var n=this.createObjectProto(this.REGEXP_PROTO);this.populateRegExp(n,i),i=n}t[t.length-1].value=i},i.prototype.stepLogicalExpression=function(t,e,r){if("&&"!==r.operator&&"||"!==r.operator)throw SyntaxError("Unknown logical operator: "+r.operator);if(!e.doneLeft_)return e.doneLeft_=!0,new i.State(r.left,e.scope);if(e.doneRight_)t.pop(),t[t.length-1].value=e.value;else{if(!("&&"===r.operator&&!e.value||"||"===r.operator&&e.value))return e.doneRight_=!0,new i.State(r.right,e.scope);t.pop(),t[t.length-1].value=e.value}},i.prototype.stepMemberExpression=function(t,e,r){if(!e.doneObject_)return e.doneObject_=!0,new i.State(r.object,e.scope);var n;if(r.computed){if(!e.doneProperty_)return e.object_=e.value,e.doneProperty_=!0,new i.State(r.property,e.scope);n=e.value}else e.object_=e.value,n=r.property.name;if(t.pop(),e.components)t[t.length-1].value=[e.object_,n];else{var o=this.getProperty(e.object_,n);if(this.getterStep_){var a=o;return this.createGetter_(a,e.object_)}t[t.length-1].value=o}},i.prototype.stepNewExpression=i.prototype.stepCallExpression,i.prototype.stepObjectExpression=function(t,e,r){var n=e.n_||0,o=r.properties[n];if(e.object_){var a=e.destinationName;e.properties_[a]||(e.properties_[a]={}),e.properties_[a][o.kind]=e.value,e.n_=++n,o=r.properties[n]}else e.object_=this.createObjectProto(this.OBJECT_PROTO),e.properties_=Object.create(null);if(o){if("Identifier"===(s=o.key).type)a=s.name;else{if("Literal"!==s.type)throw SyntaxError("Unknown object structure: "+s.type);a=s.value}return e.destinationName=a,new i.State(o.value,e.scope)}for(var s in e.properties_){var c=e.properties_[s];if("get"in c||"set"in c){var u={configurable:!0,enumerable:!0,get:c.get,set:c.set};this.setProperty(e.object_,s,i.VALUE_IN_DESCRIPTOR,u)}else this.setProperty(e.object_,s,c.init)}t.pop(),t[t.length-1].value=e.object_},i.prototype.stepProgram=function(t,e,r){var n=r.body.shift();if(n)return e.done=!1,new i.State(n,e.scope);e.done=!0},i.prototype.stepReturnStatement=function(t,e,r){if(r.argument&&!e.done_)return e.done_=!0,new i.State(r.argument,e.scope);this.unwind(i.Completion.RETURN,e.value,void 0)},i.prototype.stepSequenceExpression=function(t,e,r){var n=e.n_||0,o=r.expressions[n];if(o)return e.n_=n+1,new i.State(o,e.scope);t.pop(),t[t.length-1].value=e.value},i.prototype.stepSwitchStatement=function(t,e,r){if(!e.test_)return e.test_=1,new i.State(r.discriminant,e.scope);for(1===e.test_&&(e.test_=2,e.switchValue_=e.value,e.defaultCase_=-1);;){var n=e.index_||0,o=r.cases[n];if(e.matched_||!o||o.test)if(o||e.matched_||-1===e.defaultCase_){if(!o)return void t.pop();if(!e.matched_&&!e.tested_&&o.test)return e.tested_=!0,new i.State(o.test,e.scope);if(e.matched_||e.value===e.switchValue_){e.matched_=!0;var a=e.n_||0;if(o.consequent[a])return e.isSwitch=!0,e.n_=a+1,new i.State(o.consequent[a],e.scope)}e.tested_=!1,e.n_=0,e.index_=n+1}else e.matched_=!0,e.index_=e.defaultCase_;else e.defaultCase_=n,e.index_=n+1}},i.prototype.stepThisExpression=function(t,e,r){t.pop(),t[t.length-1].value=this.getValueFromScope("this")},i.prototype.stepThrowStatement=function(t,e,r){if(!e.done_)return e.done_=!0,new i.State(r.argument,e.scope);this.throwException(e.value)},i.prototype.stepTryStatement=function(t,e,r){if(!e.doneBlock_)return e.doneBlock_=!0,new i.State(r.block,e.scope);if(e.cv&&e.cv.type===i.Completion.THROW&&!e.doneHandler_&&r.handler){e.doneHandler_=!0;var n=this.createSpecialScope(e.scope);return this.setProperty(n.object,r.handler.param.name,e.cv.value),e.cv=void 0,new i.State(r.handler.body,n)}if(!e.doneFinalizer_&&r.finalizer)return e.doneFinalizer_=!0,new i.State(r.finalizer,e.scope);t.pop(),e.cv&&this.unwind(e.cv.type,e.cv.value,e.cv.label)},i.prototype.stepUnaryExpression=function(t,e,r){if(!e.done_){e.done_=!0;var n=new i.State(r.argument,e.scope);return n.components="delete"===r.operator,n}t.pop();var o=e.value;switch(r.operator){case"-":o=-o;break;case"+":o=+o;break;case"!":o=!o;break;case"~":o=~o;break;case"delete":var a=!0;if(Array.isArray(o)){var s=o[0];s===i.SCOPE_REFERENCE&&(s=e.scope);var c=String(o[1]);try{delete s.properties[c]}catch(t){e.scope.strict?this.throwException(this.TYPE_ERROR,"Cannot delete property '"+c+"' of '"+s+"'"):a=!1}}o=a;break;case"typeof":o=o&&"Function"===o.class?"function":typeof o;break;case"void":o=void 0;break;default:throw SyntaxError("Unknown unary operator: "+r.operator)}t[t.length-1].value=o},i.prototype.stepUpdateExpression=function(t,e,r){if(!e.doneLeft_){e.doneLeft_=!0;var n=new i.State(r.argument,e.scope);return n.components=!0,n}if(e.leftSide_||(e.leftSide_=e.value),e.doneGetter_&&(e.leftValue_=e.value),!e.doneGetter_){var o=this.getValue(e.leftSide_);if(e.leftValue_=o,this.getterStep_){e.doneGetter_=!0;var a=o;return this.createGetter_(a,e.leftSide_)}}if(e.doneSetter_)return t.pop(),void(t[t.length-1].value=e.setterValue_);var s;if(o=Number(e.leftValue_),"++"===r.operator)s=o+1;else{if("--"!==r.operator)throw SyntaxError("Unknown update expression: "+r.operator);s=o-1}var c=r.prefix?s:o,u=this.setValue(e.leftSide_,s);if(u)return e.doneSetter_=!0,e.setterValue_=c,this.createSetter_(u,e.leftSide_,s);t.pop(),t[t.length-1].value=c},i.prototype.stepVariableDeclaration=function(t,e,r){var n=r.declarations,o=e.n_||0,a=n[o];for(e.init_&&a&&(this.setValueToScope(a.id.name,e.value),e.init_=!1,a=n[++o]);a;){if(a.init)return e.n_=o,e.init_=!0,e.destinationName=a.id.name,new i.State(a.init,e.scope);a=n[++o]}t.pop()},i.prototype.stepWithStatement=function(t,e,r){if(!e.doneObject_)return e.doneObject_=!0,new i.State(r.object,e.scope);t.pop();var n=this.createSpecialScope(e.scope,e.value);return new i.State(r.body,n)},i.prototype.stepWhileStatement=i.prototype.stepDoWhileStatement,i.nativeGlobal.Interpreter=i,i.prototype.step=i.prototype.step,i.prototype.run=i.prototype.run,i.prototype.appendCode=i.prototype.appendCode,i.prototype.createObject=i.prototype.createObject,i.prototype.createObjectProto=i.prototype.createObjectProto,i.prototype.createAsyncFunction=i.prototype.createAsyncFunction,i.prototype.createNativeFunction=i.prototype.createNativeFunction,i.prototype.getProperty=i.prototype.getProperty,i.prototype.setProperty=i.prototype.setProperty,i.prototype.getStatus=i.prototype.getStatus,i.prototype.nativeToPseudo=i.prototype.nativeToPseudo,i.prototype.pseudoToNative=i.prototype.pseudoToNative,i.prototype.getGlobalScope=i.prototype.getGlobalScope,i.prototype.getStateStack=i.prototype.getStateStack,i.prototype.setStateStack=i.prototype.setStateStack,i.VALUE_IN_DESCRIPTOR=i.VALUE_IN_DESCRIPTOR,i.Status=i.Status,t.exports={Interpreter:i}},"./original-repo/acorn.js":function(t,e){var r;r=function(t){"use strict";var e;t.version="0.5.0";var r,i,n="";t.parse=function(t,o){return n=String(t),r=n.length,function(t){for(var r in e=t||{},g)Object.prototype.hasOwnProperty.call(e,r)||(e[r]=g[r]);i=e.sourceFile}(o),p=1,b=l=0,u=!0,Wt(),function(t){m=O=b,e.locations&&(h=new Xt),f=E=!1,d=[],Ht();var r=t||oe(),i=!0;for(t||(r.body=[]);s!==A;){var n=ye();r.body.push(n),i&&ce(n)&&re(!0),i=!1}return se(r,"Program")}(e.program)};var o,a,s,c,u,p,l,h,f,d,E,g={strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null},y=function(t,e){for(var r=1,i=0;;){Ft.lastIndex=i;var n=Ft.exec(t);if(!(n&&n.index<e))break;++r,i=n.index+n[0].length}return{line:r,column:e-i}},b=0,v=0,R=0,m=0,O=0;function T(t,e){var r=y(n,t);e+=" ("+r.line+":"+r.column+")";var i=new SyntaxError(e);throw i.pos=t,i.loc=r,i.raisedAt=b,i}var N=[],S={type:"num"},_={type:"regexp"},P={type:"string"},w={type:"name"},A={type:"eof"},I={keyword:"break"},C={keyword:"case",beforeExpr:!0},x={keyword:"catch"},k={keyword:"continue"},D={keyword:"debugger"},U={keyword:"default"},L={keyword:"do",isLoop:!0},j={keyword:"else",beforeExpr:!0},M={keyword:"finally"},F={keyword:"for",isLoop:!0},B={keyword:"function"},G={keyword:"if"},X={keyword:"return",beforeExpr:!0},Y={keyword:"switch"},V={keyword:"throw",beforeExpr:!0},$={keyword:"try"},W={keyword:"var"},H={keyword:"while",isLoop:!0},J={keyword:"with"},K={keyword:"new",beforeExpr:!0},z={keyword:"this"},q={keyword:"null",atomValue:null},Z={keyword:"true",atomValue:!0},Q={keyword:"false",atomValue:!1},tt={keyword:"in",binop:7,beforeExpr:!0},et={break:I,case:C,catch:x,continue:k,debugger:D,default:U,do:L,else:j,finally:M,for:F,function:B,if:G,return:X,switch:Y,throw:V,try:$,var:W,while:H,with:J,null:q,true:Z,false:Q,new:K,in:tt,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:z,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},rt={type:"[",beforeExpr:!0},it={type:"]"},nt={type:"{",beforeExpr:!0},ot={type:"}"},at={type:"(",beforeExpr:!0},st={type:")"},ct={type:",",beforeExpr:!0},ut={type:";",beforeExpr:!0},pt={type:":",beforeExpr:!0},lt={type:"."},ht={type:"?",beforeExpr:!0},ft={binop:10,beforeExpr:!0},dt={isAssign:!0,beforeExpr:!0},Et={isAssign:!0,beforeExpr:!0},gt={postfix:!0,prefix:!0,isUpdate:!0},yt={prefix:!0,beforeExpr:!0},bt={binop:1,beforeExpr:!0},vt={binop:2,beforeExpr:!0},Rt={binop:3,beforeExpr:!0},mt={binop:4,beforeExpr:!0},Ot={binop:5,beforeExpr:!0},Tt={binop:6,beforeExpr:!0},Nt={binop:7,beforeExpr:!0},St={binop:8,beforeExpr:!0},_t={binop:9,prefix:!0,beforeExpr:!0},Pt={binop:10,beforeExpr:!0};function wt(t){for(var e=t.split(" "),r=Object.create(null),i=0;i<e.length;i++)r[e[i]]=!0;return function(t){return r[t]||!1}}var At,It=wt("class enum extends super const export import"),Ct=wt("implements interface let package private protected public static yield"),xt=wt("eval arguments"),kt=wt("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Dt=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ut="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",Lt=new RegExp("["+Ut+"]"),jt=new RegExp("["+Ut+"------------------------------------------------------------------------------------------------------------------------------------------]"),Mt=/[\n\r\u2028\u2029]/,Ft=/\r\n|[\n\r\u2028\u2029]/g,Bt=function(t){return t<65?36===t:t<91||(t<97?95===t:t<123||t>=170&&Lt.test(String.fromCharCode(t)))},Gt=function(t){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||t>=170&&jt.test(String.fromCharCode(t))))};function Xt(){this.line=p,this.column=b-l}function Yt(t,r){R=b,e.locations&&(a=new Xt),s=t,Wt(),c=r,u=t.beforeExpr}function Vt(){var t,r=e.onComment&&e.locations&&new Xt,i=b,o=n.indexOf("*/",b+=2);if(-1===o&&T(b-2,"Unterminated comment"),b=o+2,e.locations)for(Ft.lastIndex=i;(t=Ft.exec(n))&&t.index<b;)++p,l=t.index+t[0].length;e.onComment&&e.onComment(!0,n.slice(i+2,o),i,b,r,e.locations&&new Xt)}function $t(){for(var t=b,i=e.onComment&&e.locations&&new Xt,o=n.charCodeAt(b+=2);b<r&&10!==o&&13!==o&&8232!==o&&8233!==o;)++b,o=n.charCodeAt(b);e.onComment&&e.onComment(!1,n.slice(t+2,b),t,b,i,e.locations&&new Xt)}function Wt(){for(;b<r;){var t=n.charCodeAt(b);if(32===t)++b;else if(13===t)++b,10===(i=n.charCodeAt(b))&&++b,e.locations&&(++p,l=b);else if(10===t||8232===t||8233===t)++b,e.locations&&(++p,l=b);else if(t>8&&t<14)++b;else if(47===t){var i;if(42===(i=n.charCodeAt(b+1)))Vt();else{if(47!==i)break;$t()}}else if(160===t)++b;else{if(!(t>=5760&&Dt.test(String.fromCharCode(t))))break;++b}}}function Ht(t){if(t?b=v+1:v=b,e.locations&&(o=new Xt),t)return Kt();if(b>=r)return Yt(A);var i=n.charCodeAt(b);if(Bt(i)||92===i)return te();if(!1===function(t){switch(t){case 46:return function(){var t=n.charCodeAt(b+1);t>=48&&t<=57?qt(!0):(++b,Yt(lt))}();case 40:return++b,Yt(at);case 41:return++b,Yt(st);case 59:return++b,Yt(ut);case 44:return++b,Yt(ct);case 91:return++b,Yt(rt);case 93:return++b,Yt(it);case 123:return++b,Yt(nt);case 125:return++b,Yt(ot);case 58:return++b,Yt(pt);case 63:return++b,Yt(ht);case 48:var i=n.charCodeAt(b+1);if(120===i||88===i)return function(){b+=2;var t=zt(16);null===t&&T(v+2,"Expected hexadecimal number"),Bt(n.charCodeAt(b))&&T(b,"Identifier directly after number"),Yt(S,t)}();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return qt(!1);case 34:case 39:return function(t){b++;for(var i="";;){b>=r&&T(v,"Unterminated string constant");var o=n.charCodeAt(b);if(o===t)return++b,void Yt(P,i);if(92===o){o=n.charCodeAt(++b);var a=/^[0-7]+/.exec(n.slice(b,b+3));for(a&&(a=a[0]);a&&parseInt(a,8)>255;)a=a.slice(0,-1);if("0"===a&&(a=null),++b,a)E&&T(b-2,"Octal literal in strict mode"),i+=String.fromCharCode(parseInt(a,8)),b+=a.length-1;else switch(o){case 110:i+="\n";break;case 114:i+="\r";break;case 120:i+=String.fromCharCode(Zt(2));break;case 117:i+=String.fromCharCode(Zt(4));break;case 85:i+=String.fromCharCode(Zt(8));break;case 116:i+="\t";break;case 98:i+="\b";break;case 118:i+="\v";break;case 102:i+="\f";break;case 48:i+="\0";break;case 13:10===n.charCodeAt(b)&&++b;case 10:e.locations&&(l=b,++p);break;default:i+=String.fromCharCode(o)}}else 13!==o&&10!==o&&8232!==o&&8233!==o||T(v,"Unterminated string constant"),i+=String.fromCharCode(o),++b}}(t);case 47:return function(){var t=n.charCodeAt(b+1);u?(++b,Kt()):61===t?Jt(Et,2):Jt(ft,1)}();case 37:case 42:return void(61===n.charCodeAt(b+1)?Jt(Et,2):Jt(Pt,1));case 124:case 38:return function(t){var e=n.charCodeAt(b+1);e===t?Jt(124===t?bt:vt,2):61===e?Jt(Et,2):Jt(124===t?Rt:Ot,1)}(t);case 94:return void(61===n.charCodeAt(b+1)?Jt(Et,2):Jt(mt,1));case 43:case 45:return function(t){var e=n.charCodeAt(b+1);if(e===t){if(45===e&&62===n.charCodeAt(b+2)&&Mt.test(n.slice(O,b)))return b+=3,$t(),Wt(),void Ht();Jt(gt,2)}else 61===e?Jt(Et,2):Jt(_t,1)}(t);case 60:case 62:return function(t){var e=n.charCodeAt(b+1),r=1;return e===t?(r=62===t&&62===n.charCodeAt(b+2)?3:2,void(61===n.charCodeAt(b+r)?Jt(Et,r+1):Jt(St,r))):33===e&&60===t&&45===n.charCodeAt(b+2)&&45===n.charCodeAt(b+3)?(b+=4,$t(),Wt(),void Ht()):(61===e&&(r=61===n.charCodeAt(b+2)?3:2),void Jt(Nt,r))}(t);case 61:case 33:return function(t){61===n.charCodeAt(b+1)?Jt(Tt,61===n.charCodeAt(b+2)?3:2):Jt(61===t?dt:yt,1)}(t);case 126:return Jt(yt,1)}return!1}(i)){var a=String.fromCharCode(i);if("\\"===a||Lt.test(a))return te();T(b,"Unexpected character '"+a+"'")}}function Jt(t,e){var r=n.slice(b,b+e);b+=e,Yt(t,r)}function Kt(){for(var t,e,i=b;;){b>=r&&T(i,"Unterminated regexp");var o=n.charAt(b);if(Mt.test(o)&&T(i,"Unterminated regexp"),t)t=!1;else{if("["===o)e=!0;else if("]"===o&&e)e=!1;else if("/"===o&&!e)break;t="\\"===o}++b}var a=n.slice(i,b);++b;var s=Qt();s&&!/^[gmi]*$/.test(s)&&T(i,"Invalid regexp flag");try{var c=new RegExp(a,s)}catch(t){throw t instanceof SyntaxError&&T(i,t.message),t}Yt(_,c)}function zt(t,e){for(var r=b,i=0,o=void 0===e?1/0:e,a=0;a<o;++a){var s,c=n.charCodeAt(b);if((s=c>=97?c-97+10:c>=65?c-65+10:c>=48&&c<=57?c-48:1/0)>=t)break;++b,i=i*t+s}return b===r||void 0!==e&&b-r!==e?null:i}function qt(t){var e=b,r=!1,i=48===n.charCodeAt(b);t||null!==zt(10)||T(e,"Invalid number"),46===n.charCodeAt(b)&&(++b,zt(10),r=!0);var o=n.charCodeAt(b);69!==o&&101!==o||(43!==(o=n.charCodeAt(++b))&&45!==o||++b,null===zt(10)&&T(e,"Invalid number"),r=!0),Bt(n.charCodeAt(b))&&T(b,"Identifier directly after number");var a,s=n.slice(e,b);r?a=parseFloat(s):i&&1!==s.length?/[89]/.test(s)||E?T(e,"Invalid number"):a=parseInt(s,8):a=parseInt(s,10),Yt(S,a)}function Zt(t){var e=zt(16,t);return null===e&&T(v,"Bad character escape sequence"),e}function Qt(){var t;At=!1;for(var e=!0,r=b;;){var i=n.charCodeAt(b);if(Gt(i))At&&(t+=n.charAt(b)),++b;else{if(92!==i)break;At||(t=n.slice(r,b)),At=!0,117!==n.charCodeAt(++b)&&T(b,"Expecting Unicode escape sequence \\uXXXX"),++b;var o=Zt(4),a=String.fromCharCode(o);a||T(b-1,"Invalid Unicode escape"),(e?Bt(o):Gt(o))||T(b-4,"Invalid Unicode escape"),t+=a}e=!1}return At?t:n.slice(r,b)}function te(){var t=Qt(),e=w;!At&&kt(t)&&(e=et[t]),Yt(e,t)}function ee(){m=v,O=R,h=a,Ht()}function re(t){if(E=t,b=v,e.locations)for(;b<l;)l=n.lastIndexOf("\n",l-2)+1,--p;Wt(),Ht()}function ie(){this.type=null,this.start=v,this.end=null}function ne(){this.start=o,this.end=null,i&&(this.source=i)}function oe(){var t=new ie;return e.locations&&(t.loc=new ne),e.directSourceFile&&(t.sourceFile=e.directSourceFile),e.ranges&&(t.range=[v,0]),t}function ae(t){var r=new ie;return r.start=t.start,e.locations&&(r.loc=new ne,r.loc.start=t.loc.start),e.ranges&&(r.range=[t.range[0],0]),r}function se(t,r){return t.type=r,t.end=O,e.locations&&(t.loc.end=h),e.ranges&&(t.range[1]=O),t}function ce(t){return"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"use strict"===t.expression.value}function ue(t){return s===t&&(ee(),!0)}function pe(){return!e.strictSemicolons&&(s===A||s===ot||Mt.test(n.slice(O,v)))}function le(){ue(ut)||pe()||fe()}function he(t){s===t?ee():fe()}function fe(){T(v,"Unexpected token")}function de(t){"Identifier"!==t.type&&"MemberExpression"!==t.type&&T(t.start,"Assigning to rvalue"),E&&"Identifier"===t.type&&xt(t.name)&&T(t.start,"Assigning to "+t.name+" in strict mode")}var Ee={kind:"loop"},ge={kind:"switch"};function ye(){(s===ft||s===Et&&"/="===c)&&Ht(!0);var t=s,r=oe();switch(t){case I:case k:ee();var i=t===I;ue(ut)||pe()?r.label=null:s!==w?fe():(r.label=xe(),le());for(var o=0;o<d.length;++o){var a=d[o];if(null===r.label||a.name===r.label.name){if(null!==a.kind&&(i||"loop"===a.kind))break;if(r.label&&i)break}}return o===d.length&&T(r.start,"Unsyntactic "+t.keyword),se(r,i?"BreakStatement":"ContinueStatement");case D:return ee(),le(),se(r,"DebuggerStatement");case L:return ee(),d.push(Ee),r.body=ye(),d.pop(),he(H),r.test=be(),le(),se(r,"DoWhileStatement");case F:if(ee(),d.push(Ee),he(at),s===ut)return Re(r,null);if(s===W){var u=oe();return ee(),Oe(u,!0),se(u,"VariableDeclaration"),1===u.declarations.length&&ue(tt)?me(r,u):Re(r,u)}return u=Te(!1,!0),ue(tt)?(de(u),me(r,u)):Re(r,u);case B:return ee(),Ie(r,!0);case G:return ee(),r.test=be(),r.consequent=ye(),r.alternate=ue(j)?ye():null,se(r,"IfStatement");case X:return f||e.allowReturnOutsideFunction||T(v,"'return' outside of function"),ee(),ue(ut)||pe()?r.argument=null:(r.argument=Te(),le()),se(r,"ReturnStatement");case Y:ee(),r.discriminant=be(),r.cases=[],he(nt),d.push(ge);for(var p,l;s!==ot;)if(s===C||s===U){var h=s===C;p&&se(p,"SwitchCase"),r.cases.push(p=oe()),p.consequent=[],ee(),h?p.test=Te():(l&&T(m,"Multiple default clauses"),l=!0,p.test=null),he(pt)}else p||fe(),p.consequent.push(ye());return p&&se(p,"SwitchCase"),ee(),d.pop(),se(r,"SwitchStatement");case V:return ee(),Mt.test(n.slice(O,v))&&T(O,"Illegal newline after throw"),r.argument=Te(),le(),se(r,"ThrowStatement");case $:if(ee(),r.block=ve(),r.handler=null,s===x){var g=oe();ee(),he(at),g.param=xe(),E&&xt(g.param.name)&&T(g.param.start,"Binding "+g.param.name+" in strict mode"),he(st),g.body=ve(),r.handler=se(g,"CatchClause")}return r.finalizer=ue(M)?ve():null,r.handler||r.finalizer||T(r.start,"Missing catch or finally clause"),se(r,"TryStatement");case W:return ee(),Oe(r),le(),se(r,"VariableDeclaration");case H:return ee(),r.test=be(),d.push(Ee),r.body=ye(),d.pop(),se(r,"WhileStatement");case J:return E&&T(v,"'with' in strict mode"),ee(),r.object=be(),r.body=ye(),se(r,"WithStatement");case nt:return ve();case ut:return ee(),se(r,"EmptyStatement");default:var y=c,b=Te();if(t===w&&"Identifier"===b.type&&ue(pt)){for(o=0;o<d.length;++o)d[o].name===y&&T(b.start,"Label '"+y+"' is already declared");var R=s.isLoop?"loop":s===Y?"switch":null;return d.push({name:y,kind:R}),r.body=ye(),d.pop(),r.label=b,se(r,"LabeledStatement")}return r.expression=b,le(),se(r,"ExpressionStatement")}}function be(){he(at);var t=Te();return he(st),t}function ve(t){var e,r=oe(),i=!0,n=!1;for(r.body=[],he(nt);!ue(ot);){var o=ye();r.body.push(o),i&&t&&ce(o)&&(e=n,re(n=!0)),i=!1}return n&&!e&&re(!1),se(r,"BlockStatement")}function Re(t,e){return t.init=e,he(ut),t.test=s===ut?null:Te(),he(ut),t.update=s===st?null:Te(),he(st),t.body=ye(),d.pop(),se(t,"ForStatement")}function me(t,e){return t.left=e,t.right=Te(),he(st),t.body=ye(),d.pop(),se(t,"ForInStatement")}function Oe(t,e){for(t.declarations=[],t.kind="var";;){var r=oe();if(r.id=xe(),E&&xt(r.id.name)&&T(r.id.start,"Binding "+r.id.name+" in strict mode"),r.init=ue(dt)?Te(!0,e):null,t.declarations.push(se(r,"VariableDeclarator")),!ue(ct))break}}function Te(t,e){var r=Ne(e);if(!t&&s===ct){var i=ae(r);for(i.expressions=[r];ue(ct);)i.expressions.push(Ne(e));return se(i,"SequenceExpression")}return r}function Ne(t){var e=function(t){var e=function(t){return Se(_e(),-1,t)}(t);if(ue(ht)){var r=ae(e);return r.test=e,r.consequent=Te(!0),he(pt),r.alternate=Te(!0,t),se(r,"ConditionalExpression")}return e}(t);if(s.isAssign){var r=ae(e);return r.operator=c,r.left=e,ee(),r.right=Ne(t),de(e),se(r,"AssignmentExpression")}return e}function Se(t,e,r){var i=s.binop;if(null!==i&&(!r||s!==tt)&&i>e){var n=ae(t);n.left=t,n.operator=c;var o=s;return ee(),n.right=Se(_e(),i,r),Se(se(n,o===bt||o===vt?"LogicalExpression":"BinaryExpression"),e,r)}return t}function _e(){if(s.prefix){var t=oe(),e=s.isUpdate;return t.operator=c,t.prefix=!0,u=!0,ee(),t.argument=_e(),e?de(t.argument):E&&"delete"===t.operator&&"Identifier"===t.argument.type&&T(t.start,"Deleting local variable in strict mode"),se(t,e?"UpdateExpression":"UnaryExpression")}for(var r=Pe(we());s.postfix&&!pe();)(t=ae(r)).operator=c,t.prefix=!1,t.argument=r,de(r),ee(),r=se(t,"UpdateExpression");return r}function Pe(t,e){var r;return ue(lt)?((r=ae(t)).object=t,r.property=xe(!0),r.computed=!1,Pe(se(r,"MemberExpression"),e)):ue(rt)?((r=ae(t)).object=t,r.property=Te(),r.computed=!0,he(it),Pe(se(r,"MemberExpression"),e)):!e&&ue(at)?((r=ae(t)).callee=t,r.arguments=Ce(st,!1),Pe(se(r,"CallExpression"),e)):t}function we(){var t;switch(s){case z:return t=oe(),ee(),se(t,"ThisExpression");case w:return xe();case S:case P:case _:return(t=oe()).value=c,t.raw=n.slice(v,R),ee(),se(t,"Literal");case q:case Z:case Q:return(t=oe()).value=s.atomValue,t.raw=s.keyword,ee(),se(t,"Literal");case at:var r=o,i=v;ee();var u=Te();return u.start=i,u.end=R,e.locations&&(u.loc.start=r,u.loc.end=a),e.ranges&&(u.range=[i,R]),he(st),u;case rt:return t=oe(),ee(),t.elements=Ce(it,!0,!0),se(t,"ArrayExpression");case nt:return function(){var t=oe(),r=!0,i=!1;for(t.properties=[],ee();!ue(ot);){if(r)r=!1;else if(he(ct),e.allowTrailingCommas&&ue(ot))break;var n,o={key:Ae()},a=!1;if(ue(pt)?(o.value=Te(!0),n=o.kind="init"):"Identifier"!==o.key.type||"get"!==o.key.name&&"set"!==o.key.name?fe():(a=i=!0,n=o.kind=o.key.name,o.key=Ae(),s!==at&&fe(),o.value=Ie(oe(),!1)),"Identifier"===o.key.type&&(E||i))for(var c=0;c<t.properties.length;++c){var u=t.properties[c];if(u.key.name===o.key.name){var p=n===u.kind||a&&"init"===u.kind||"init"===n&&("get"===u.kind||"set"===u.kind);p&&!E&&"init"===n&&"init"===u.kind&&(p=!1),p&&T(o.key.start,"Redefinition of property")}}t.properties.push(o)}return se(t,"ObjectExpression")}();case B:return t=oe(),ee(),Ie(t,!1);case K:return function(){var t=oe();return ee(),t.callee=Pe(we(),!0),t.arguments=ue(at)?Ce(st,!1):N,se(t,"NewExpression")}()}fe()}function Ae(){return s===S||s===P?we():xe(!0)}function Ie(t,e){s===w?t.id=xe():e?fe():t.id=null,t.params=[];var r=!0;for(he(at);!ue(st);)r?r=!1:he(ct),t.params.push(xe());var i=f,n=d;if(f=!0,d=[],t.body=ve(!0),f=i,d=n,E||t.body.body.length&&ce(t.body.body[0]))for(var o=t.id?-1:0;o<t.params.length;++o){var a=o<0?t.id:t.params[o];if((Ct(a.name)||xt(a.name))&&T(a.start,"Defining '"+a.name+"' in strict mode"),o>=0)for(var c=0;c<o;++c)a.name===t.params[c].name&&T(a.start,"Argument name clash in strict mode")}return se(t,e?"FunctionDeclaration":"FunctionExpression")}function Ce(t,r,i){for(var n=[],o=!0;!ue(t);){if(o)o=!1;else if(he(ct),r&&e.allowTrailingCommas&&ue(t))break;n.push(i&&s===ct?null:Te(!0))}return n}function xe(t){var r=oe();return t&&"everywhere"===e.forbidReserved&&(t=!1),s===w?(!t&&(e.forbidReserved&&It(c)||E&&Ct(c))&&-1===n.slice(v,R).indexOf("\\")&&T(v,"The keyword '"+c+"' is reserved"),r.name=c):t&&s.keyword?r.name=s.keyword:fe(),u=!1,ee(),se(r,"Identifier")}},r(e)},vm:t=>{"use strict";t.exports=r(877)}},e={};function i(r){var n=e[r];if(void 0!==n)return n.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,i),o.exports}i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return(()=>{"use strict";i.r(n),i.d(n,{default:()=>r});const t=i("./original-repo/acorn.js");globalThis.acorn=t;const{Interpreter:e}=i("./original-repo/interpreter.js"),r=e})(),n.default})(),t.exports=i()},877:()=>{}},e={};function r(i){var n=e[i];if(void 0!==n)return n.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,r),o.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";class t{constructor(){this.logDebugMessage=(...t)=>{this.logMessage(e.DEBUG,...t)},this.logInfo=(...t)=>{this.logMessage(e.INFO,...t)},this.logWarn=(...t)=>{this.logMessage(e.WARN,...t)},this.logError=(...t)=>{this.logMessage(e.ERROR,...t)}}}var e;!function(t){t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARN=2]="WARN",t[t.ERROR=3]="ERROR"}(e||(e={}));const i="x-session";function n(t,e){if(function(){const t=globalThis;if(void 0!==t.cloneInto)return t}()){const r=globalThis.content,i=r?.fetch;if("function"==typeof i)return i(t,e)}return fetch(t,e)}class o extends t{constructor(t,e,r,i,n){super(),this.logServerUrl=t,this.publicTokenProvider=e,this.urlProvider=r,this.pluginDataProvider=i,this.logLevel=n,this.batchSize=50,this.batch=[],this.maxSendTimeout=1e4,this.sendTimeoutId=0,this.messageId=1e3*globalThis.crypto.getRandomValues(new Uint8Array(1))[0],window&&window.addEventListener("beforeunload",(()=>{this.sendBatch()}))}logMessage(t,...r){if(t<this.logLevel)return;const i=e[t],n=[];for(const t of r)t instanceof Error?n.push(JSON.parse(JSON.stringify(t,Object.getOwnPropertyNames(t)))):n.push(t);this.batch.push({eventType:i,timestamp:Date.now(),url:this.urlProvider(),pluginData:this.pluginDataProvider(),messageId:++this.messageId,data:JSON.stringify(n)}),this.sendBatchIfNeeded()}clearSendBatchTimeout(){this.sendTimeoutId&&(clearTimeout(this.sendTimeoutId),this.sendTimeoutId=0)}sendBatchIfNeeded(){this.batch.length<this.batchSize?this.sendTimeoutId||(this.sendTimeoutId=Number(setTimeout((()=>{this.sendBatch()}),this.maxSendTimeout))):this.sendBatch()}sendBatch(){if(this.clearSendBatchTimeout(),!this.batch.length)return;const t=function(t,e,r,n,o,a,s="text/plain"){const c=new URL(r,t);let u=new Headers({"Content-Type":s});o?(u.set("Accept",o),e&&(u=function(t,e){if(!e)return t;const r="Accept",n=t.get(r);if(!n)throw new Error(`Invalid headers object: it doesn't have ${r} header!`);return t.set(r,`${n};${i}=${e}`)||t}(u,e))):e&&e&&u.set(i,e);const p={credentials:"omit",method:n,headers:u};return void 0!==a&&(p.body=JSON.stringify(a)),{url:c.toString(),options:p}}(this.logServerUrl,this.publicTokenProvider(),this.logServerUrl,"POST","application/vnd.intersub.log.response.v1+json",[...this.batch]);this.batch.length=0,n(t.url,t.options)}}var a,s,c;!function(t){t.ALL="ALL",t.YOUTUBE="YOUTUBE",t.COURSERA="COURSERA",t.NETFLIX="NETFLIX",t.HDREZKA="HDREZKA",t.TED="TED",t.KINOPUB="KINOPUB",t.LORD_FILM="LORD_FILM",t.OTHER="OTHER",t.INTERSUB_LANDING="INTERSUB_LANDING",t.INTERSUB_DEV="INTERSUB_DEV",t.SOAP4ME="SOAP4ME",t.TWO_SUB_MOVIE="TWO_SUB_MOVIE",t.INORIGINAL="INORIGINAL",t.AMAZON_PRIME="AMAZON_PRIME",t.LINKEDIN_LEARNING="LINKEDIN_LEARNING",t.UDEMY="UDEMY",t.CRUNCHYROLL="CRUNCHYROLL",t.ORORO="ORORO"}(a||(a={})),function(t){t.getTypeName=function(){return"ExternalVideoServiceType"},t.values=[t.ALL,t.YOUTUBE,t.COURSERA,t.NETFLIX,t.HDREZKA,t.TED,t.KINOPUB,t.LORD_FILM,t.OTHER,t.INTERSUB_LANDING,t.INTERSUB_DEV,t.SOAP4ME,t.TWO_SUB_MOVIE,t.INORIGINAL,t.AMAZON_PRIME,t.LINKEDIN_LEARNING,t.UDEMY,t.CRUNCHYROLL,t.ORORO]}(a||(a={})),function(t){t.SUBTITLES_WEBVTT="SUBTITLES_WEBVTT"}(s||(s={})),function(t){t.SEND_SUBS="SEND_SUBS",t.INIT="INIT"}(c||(c={}));const u="isKinopubNoSubtitles",p=new class extends t{logMessage(t,...r){switch(t){case e.DEBUG:console.debug("KINOPUB_SUBTITLES_LOG: debug",t,...r);break;case e.INFO:console.debug("KINOPUB_SUBTITLES_LOG: info",t,...r);break;case e.WARN:console.debug("KINOPUB_SUBTITLES_LOG: warn",t,...r);break;case e.ERROR:console.error("KINOPUB_SUBTITLES_LOG: error",t,...r)}this.sentryLogger?.logMessage(t,r)}setSentryLogger(t){this.sentryLogger=t}};async function l(t){let e,r;try{e=await n(t)}catch(e){throw new Error(`Failed to load subtitles from url ${t}`,{cause:e})}if(!e.ok){const r=`Failed to load HTML code of page ${t}. Response code: ${e.status}`;throw new Error(r)}return r=await e.text(),r}var h=function(){function t(){this.listeners={}}var e=t.prototype;return e.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},e.off=function(t,e){if(!this.listeners[t])return!1;var r=this.listeners[t].indexOf(e);return this.listeners[t]=this.listeners[t].slice(0),this.listeners[t].splice(r,1),r>-1},e.trigger=function(t){var e=this.listeners[t];if(e)if(2===arguments.length)for(var r=e.length,i=0;i<r;++i)e[i].call(this,arguments[1]);else for(var n=Array.prototype.slice.call(arguments,1),o=e.length,a=0;a<o;++a)e[a].apply(this,n)},e.dispose=function(){this.listeners={}},e.pipe=function(t){this.on("data",(function(e){t.push(e)}))},t}();function f(){return f=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},f.apply(this,arguments)}var d=r(908),E=r.n(d);function g(t){for(var e,r=(e=t,E().atob?E().atob(e):Buffer.from(e,"base64").toString("binary")),i=new Uint8Array(r.length),n=0;n<r.length;n++)i[n]=r.charCodeAt(n);return i}class y extends h{constructor(){super(),this.buffer=""}push(t){let e;for(this.buffer+=t,e=this.buffer.indexOf("\n");e>-1;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)}}const b=String.fromCharCode(9),v=function(t){const e=/([0-9.]*)?@?([0-9.]*)?/.exec(t||""),r={};return e[1]&&(r.length=parseInt(e[1],10)),e[2]&&(r.offset=parseInt(e[2],10)),r},R=function(t){const e={};if(!t)return e;const r=t.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))'));let i,n=r.length;for(;n--;)""!==r[n]&&(i=/([^=]*)=(.*)/.exec(r[n]).slice(1),i[0]=i[0].replace(/^\s+|\s+$/g,""),i[1]=i[1].replace(/^\s+|\s+$/g,""),i[1]=i[1].replace(/^['"](.*)['"]$/g,"$1"),e[i[0]]=i[1]);return e};class m extends h{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(t){let e,r;0!==(t=t.trim()).length&&("#"===t[0]?this.tagMappers.reduce(((e,r)=>{const i=r(t);return i===t?e:e.concat([i])}),[t]).forEach((t=>{for(let e=0;e<this.customParsers.length;e++)if(this.customParsers[e].call(this,t))return;if(0===t.indexOf("#EXT"))if(t=t.replace("\r",""),e=/^#EXTM3U/.exec(t),e)this.trigger("data",{type:"tag",tagType:"m3u"});else{if(e=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(t),e)return r={type:"tag",tagType:"inf"},e[1]&&(r.duration=parseFloat(e[1])),e[2]&&(r.title=e[2]),void this.trigger("data",r);if(e=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(t),e)return r={type:"tag",tagType:"targetduration"},e[1]&&(r.duration=parseInt(e[1],10)),void this.trigger("data",r);if(e=/^#EXT-X-VERSION:([0-9.]*)?/.exec(t),e)return r={type:"tag",tagType:"version"},e[1]&&(r.version=parseInt(e[1],10)),void this.trigger("data",r);if(e=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(t),e)return r={type:"tag",tagType:"media-sequence"},e[1]&&(r.number=parseInt(e[1],10)),void this.trigger("data",r);if(e=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(t),e)return r={type:"tag",tagType:"discontinuity-sequence"},e[1]&&(r.number=parseInt(e[1],10)),void this.trigger("data",r);if(e=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(t),e)return r={type:"tag",tagType:"playlist-type"},e[1]&&(r.playlistType=e[1]),void this.trigger("data",r);if(e=/^#EXT-X-BYTERANGE:(.*)?$/.exec(t),e)return r=f(v(e[1]),{type:"tag",tagType:"byterange"}),void this.trigger("data",r);if(e=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(t),e)return r={type:"tag",tagType:"allow-cache"},e[1]&&(r.allowed=!/NO/.test(e[1])),void this.trigger("data",r);if(e=/^#EXT-X-MAP:(.*)$/.exec(t),e){if(r={type:"tag",tagType:"map"},e[1]){const t=R(e[1]);t.URI&&(r.uri=t.URI),t.BYTERANGE&&(r.byterange=v(t.BYTERANGE))}this.trigger("data",r)}else if(e=/^#EXT-X-STREAM-INF:(.*)$/.exec(t),e){if(r={type:"tag",tagType:"stream-inf"},e[1]){if(r.attributes=R(e[1]),r.attributes.RESOLUTION){const t=r.attributes.RESOLUTION.split("x"),e={};t[0]&&(e.width=parseInt(t[0],10)),t[1]&&(e.height=parseInt(t[1],10)),r.attributes.RESOLUTION=e}r.attributes.BANDWIDTH&&(r.attributes.BANDWIDTH=parseInt(r.attributes.BANDWIDTH,10)),r.attributes["FRAME-RATE"]&&(r.attributes["FRAME-RATE"]=parseFloat(r.attributes["FRAME-RATE"])),r.attributes["PROGRAM-ID"]&&(r.attributes["PROGRAM-ID"]=parseInt(r.attributes["PROGRAM-ID"],10))}this.trigger("data",r)}else{if(e=/^#EXT-X-MEDIA:(.*)$/.exec(t),e)return r={type:"tag",tagType:"media"},e[1]&&(r.attributes=R(e[1])),void this.trigger("data",r);if(e=/^#EXT-X-ENDLIST/.exec(t),e)this.trigger("data",{type:"tag",tagType:"endlist"});else if(e=/^#EXT-X-DISCONTINUITY/.exec(t),e)this.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(e=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(t),e)return r={type:"tag",tagType:"program-date-time"},e[1]&&(r.dateTimeString=e[1],r.dateTimeObject=new Date(e[1])),void this.trigger("data",r);if(e=/^#EXT-X-KEY:(.*)$/.exec(t),e)return r={type:"tag",tagType:"key"},e[1]&&(r.attributes=R(e[1]),r.attributes.IV&&("0x"===r.attributes.IV.substring(0,2).toLowerCase()&&(r.attributes.IV=r.attributes.IV.substring(2)),r.attributes.IV=r.attributes.IV.match(/.{8}/g),r.attributes.IV[0]=parseInt(r.attributes.IV[0],16),r.attributes.IV[1]=parseInt(r.attributes.IV[1],16),r.attributes.IV[2]=parseInt(r.attributes.IV[2],16),r.attributes.IV[3]=parseInt(r.attributes.IV[3],16),r.attributes.IV=new Uint32Array(r.attributes.IV))),void this.trigger("data",r);if(e=/^#EXT-X-START:(.*)$/.exec(t),e)return r={type:"tag",tagType:"start"},e[1]&&(r.attributes=R(e[1]),r.attributes["TIME-OFFSET"]=parseFloat(r.attributes["TIME-OFFSET"]),r.attributes.PRECISE=/YES/.test(r.attributes.PRECISE)),void this.trigger("data",r);if(e=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(t),e)return r={type:"tag",tagType:"cue-out-cont"},e[1]?r.data=e[1]:r.data="",void this.trigger("data",r);if(e=/^#EXT-X-CUE-OUT:(.*)?$/.exec(t),e)return r={type:"tag",tagType:"cue-out"},e[1]?r.data=e[1]:r.data="",void this.trigger("data",r);if(e=/^#EXT-X-CUE-IN:(.*)?$/.exec(t),e)return r={type:"tag",tagType:"cue-in"},e[1]?r.data=e[1]:r.data="",void this.trigger("data",r);if(e=/^#EXT-X-SKIP:(.*)$/.exec(t),e&&e[1])return r={type:"tag",tagType:"skip"},r.attributes=R(e[1]),r.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(r.attributes["SKIPPED-SEGMENTS"]=parseInt(r.attributes["SKIPPED-SEGMENTS"],10)),r.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(r.attributes["RECENTLY-REMOVED-DATERANGES"]=r.attributes["RECENTLY-REMOVED-DATERANGES"].split(b)),void this.trigger("data",r);if(e=/^#EXT-X-PART:(.*)$/.exec(t),e&&e[1])return r={type:"tag",tagType:"part"},r.attributes=R(e[1]),["DURATION"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseFloat(r.attributes[t]))})),["INDEPENDENT","GAP"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=/YES/.test(r.attributes[t]))})),r.attributes.hasOwnProperty("BYTERANGE")&&(r.attributes.byterange=v(r.attributes.BYTERANGE)),void this.trigger("data",r);if(e=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(t),e&&e[1])return r={type:"tag",tagType:"server-control"},r.attributes=R(e[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseFloat(r.attributes[t]))})),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=/YES/.test(r.attributes[t]))})),void this.trigger("data",r);if(e=/^#EXT-X-PART-INF:(.*)$/.exec(t),e&&e[1])return r={type:"tag",tagType:"part-inf"},r.attributes=R(e[1]),["PART-TARGET"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseFloat(r.attributes[t]))})),void this.trigger("data",r);if(e=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(t),e&&e[1])return r={type:"tag",tagType:"preload-hint"},r.attributes=R(e[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach((function(t){if(r.attributes.hasOwnProperty(t)){r.attributes[t]=parseInt(r.attributes[t],10);const e="BYTERANGE-LENGTH"===t?"length":"offset";r.attributes.byterange=r.attributes.byterange||{},r.attributes.byterange[e]=r.attributes[t],delete r.attributes[t]}})),void this.trigger("data",r);if(e=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(t),e&&e[1])return r={type:"tag",tagType:"rendition-report"},r.attributes=R(e[1]),["LAST-MSN","LAST-PART"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseInt(r.attributes[t],10))})),void this.trigger("data",r);if(e=/^#EXT-X-DATERANGE:(.*)$/.exec(t),e&&e[1]){r={type:"tag",tagType:"daterange"},r.attributes=R(e[1]),["ID","CLASS"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=String(r.attributes[t]))})),["START-DATE","END-DATE"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=new Date(r.attributes[t]))})),["DURATION","PLANNED-DURATION"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseFloat(r.attributes[t]))})),["END-ON-NEXT"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=/YES/i.test(r.attributes[t]))})),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=r.attributes[t].toString(16))}));const t=/^X-([A-Z]+-)+[A-Z]+$/;for(const e in r.attributes){if(!t.test(e))continue;const i=/[0-9A-Fa-f]{6}/g.test(r.attributes[e]),n=/^\d+(\.\d+)?$/.test(r.attributes[e]);r.attributes[e]=i?r.attributes[e].toString(16):n?parseFloat(r.attributes[e]):String(r.attributes[e])}this.trigger("data",r)}else if(e=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(t),e)this.trigger("data",{type:"tag",tagType:"independent-segments"});else{if(e=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(t),e)return r={type:"tag",tagType:"content-steering"},r.attributes=R(e[1]),void this.trigger("data",r);this.trigger("data",{type:"tag",data:t.slice(4)})}}}}else this.trigger("data",{type:"comment",text:t.slice(1)})})):this.trigger("data",{type:"uri",uri:t}))}addParser({expression:t,customType:e,dataParser:r,segment:i}){"function"!=typeof r&&(r=t=>t),this.customParsers.push((n=>{if(t.exec(n))return this.trigger("data",{type:"custom",data:r(n),customType:e,segment:i}),!0}))}addTagMapper({expression:t,map:e}){this.tagMappers.push((r=>t.test(r)?e(r):r))}}const O=function(t){const e={};return Object.keys(t).forEach((function(r){var i;e[(i=r,i.toLowerCase().replace(/-(\w)/g,(t=>t[1].toUpperCase())))]=t[r]})),e},T=function(t){const{serverControl:e,targetDuration:r,partTargetDuration:i}=t;if(!e)return;const n="#EXT-X-SERVER-CONTROL",o="holdBack",a="partHoldBack",s=r&&3*r,c=i&&2*i;r&&!e.hasOwnProperty(o)&&(e[o]=s,this.trigger("info",{message:`${n} defaulting HOLD-BACK to targetDuration * 3 (${s}).`})),s&&e[o]<s&&(this.trigger("warn",{message:`${n} clamping HOLD-BACK (${e[o]}) to targetDuration * 3 (${s})`}),e[o]=s),i&&!e.hasOwnProperty(a)&&(e[a]=3*i,this.trigger("info",{message:`${n} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${e[a]}).`})),i&&e[a]<c&&(this.trigger("warn",{message:`${n} clamping PART-HOLD-BACK (${e[a]}) to partTargetDuration * 2 (${c}).`}),e[a]=c)};class N extends h{constructor(){super(),this.lineStream=new y,this.parseStream=new m,this.lineStream.pipe(this.parseStream),this.lastProgramDateTime=null;const t=this,e=[];let r,i,n={},o=!1;const a=function(){},s={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}};let c=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],segments:[]};let u=0,p=0;const l={};this.on("end",(()=>{n.uri||!n.parts&&!n.preloadHints||(!n.map&&r&&(n.map=r),!n.key&&i&&(n.key=i),n.timeline||"number"!=typeof c||(n.timeline=c),this.manifest.preloadSegment=n)})),this.parseStream.on("data",(function(h){let d,E;({tag(){({version(){h.version&&(this.manifest.version=h.version)},"allow-cache"(){this.manifest.allowCache=h.allowed,"allowed"in h||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const t={};"length"in h&&(n.byterange=t,t.length=h.length,"offset"in h||(h.offset=u)),"offset"in h&&(n.byterange=t,t.offset=h.offset),u=t.offset+t.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),h.title&&(n.title=h.title),h.duration>0&&(n.duration=h.duration),0===h.duration&&(n.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=e},key(){if(h.attributes)if("NONE"!==h.attributes.METHOD)if(h.attributes.URI){if("com.apple.streamingkeydelivery"===h.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:h.attributes});if("com.microsoft.playready"===h.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.microsoft.playready"]={uri:h.attributes.URI});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===h.attributes.KEYFORMAT)return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(h.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===h.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==h.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):h.attributes.KEYID&&"0x"===h.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:h.attributes.KEYFORMAT,keyId:h.attributes.KEYID.substring(2)},pssh:g(h.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}));h.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),i={method:h.attributes.METHOD||"AES-128",uri:h.attributes.URI},void 0!==h.attributes.IV&&(i.iv=h.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else i=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence"(){isFinite(h.number)?this.manifest.mediaSequence=h.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+h.number})},"discontinuity-sequence"(){isFinite(h.number)?(this.manifest.discontinuitySequence=h.number,c=h.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+h.number})},"playlist-type"(){/VOD|EVENT/.test(h.playlistType)?this.manifest.playlistType=h.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+h.playlist})},map(){r={},h.uri&&(r.uri=h.uri),h.byterange&&(r.byterange=h.byterange),i&&(r.key=i)},"stream-inf"(){this.manifest.playlists=e,this.manifest.mediaGroups=this.manifest.mediaGroups||s,h.attributes?(n.attributes||(n.attributes={}),f(n.attributes,h.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||s,!(h.attributes&&h.attributes.TYPE&&h.attributes["GROUP-ID"]&&h.attributes.NAME))return void this.trigger("warn",{message:"ignoring incomplete or missing media group"});const t=this.manifest.mediaGroups[h.attributes.TYPE];t[h.attributes["GROUP-ID"]]=t[h.attributes["GROUP-ID"]]||{},d=t[h.attributes["GROUP-ID"]],E={default:/yes/i.test(h.attributes.DEFAULT)},E.default?E.autoselect=!0:E.autoselect=/yes/i.test(h.attributes.AUTOSELECT),h.attributes.LANGUAGE&&(E.language=h.attributes.LANGUAGE),h.attributes.URI&&(E.uri=h.attributes.URI),h.attributes["INSTREAM-ID"]&&(E.instreamId=h.attributes["INSTREAM-ID"]),h.attributes.CHARACTERISTICS&&(E.characteristics=h.attributes.CHARACTERISTICS),h.attributes.FORCED&&(E.forced=/yes/i.test(h.attributes.FORCED)),d[h.attributes.NAME]=E},discontinuity(){c+=1,n.discontinuity=!0,this.manifest.discontinuityStarts.push(e.length)},"program-date-time"(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=h.dateTimeString,this.manifest.dateTimeObject=h.dateTimeObject),n.dateTimeString=h.dateTimeString,n.dateTimeObject=h.dateTimeObject;const{lastProgramDateTime:t}=this;this.lastProgramDateTime=new Date(h.dateTimeString).getTime(),null===t&&this.manifest.segments.reduceRight(((t,e)=>(e.programDateTime=t-1e3*e.duration,e.programDateTime)),this.lastProgramDateTime)},targetduration(){!isFinite(h.duration)||h.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+h.duration}):(this.manifest.targetDuration=h.duration,T.call(this,this.manifest))},start(){h.attributes&&!isNaN(h.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:h.attributes["TIME-OFFSET"],precise:h.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out"(){n.cueOut=h.data},"cue-out-cont"(){n.cueOutCont=h.data},"cue-in"(){n.cueIn=h.data},skip(){this.manifest.skip=O(h.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",h.attributes,["SKIPPED-SEGMENTS"])},part(){o=!0;const t=this.manifest.segments.length,e=O(h.attributes);n.parts=n.parts||[],n.parts.push(e),e.byterange&&(e.byterange.hasOwnProperty("offset")||(e.byterange.offset=p),p=e.byterange.offset+e.byterange.length);const r=n.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${r} for segment #${t}`,h.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach(((t,e)=>{t.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${e} lacks required attribute(s): LAST-PART`})}))},"server-control"(){const t=this.manifest.serverControl=O(h.attributes);t.hasOwnProperty("canBlockReload")||(t.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),T.call(this,this.manifest),t.canSkipDateranges&&!t.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const t=this.manifest.segments.length,e=O(h.attributes),r=e.type&&"PART"===e.type;n.preloadHints=n.preloadHints||[],n.preloadHints.push(e),e.byterange&&(e.byterange.hasOwnProperty("offset")||(e.byterange.offset=r?p:0,r&&(p=e.byterange.offset+e.byterange.length)));const i=n.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${i} for segment #${t}`,h.attributes,["TYPE","URI"]),e.type)for(let r=0;r<n.preloadHints.length-1;r++){const o=n.preloadHints[r];o.type&&o.type===e.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${i} for segment #${t} has the same TYPE ${e.type} as preload hint #${r}`})}},"rendition-report"(){const t=O(h.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(t);const e=this.manifest.renditionReports.length-1,r=["LAST-MSN","URI"];o&&r.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${e}`,h.attributes,r)},"part-inf"(){this.manifest.partInf=O(h.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",h.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),T.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(O(h.attributes));const t=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${t}`,h.attributes,["ID","START-DATE"]);const e=this.manifest.dateRanges[t];e.endDate&&e.startDate&&new Date(e.endDate)<new Date(e.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),e.duration&&e.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),e.plannedDuration&&e.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const r=!!e.endOnNext;if(r&&!e.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),r&&(e.duration||e.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),e.duration&&e.endDate){const r=e.startDate.getTime()+1e3*e.duration;this.manifest.dateRanges[t].endDate=new Date(r)}if(l[e.id]){for(const t in l[e.id])if(e[t]&&JSON.stringify(l[e.id][t])!==JSON.stringify(e[t])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}const t=this.manifest.dateRanges.findIndex((t=>t.id===e.id));this.manifest.dateRanges[t]=f(this.manifest.dateRanges[t],e),l[e.id]=f(l[e.id],e),this.manifest.dateRanges.pop()}else l[e.id]=e},"independent-segments"(){this.manifest.independentSegments=!0},"content-steering"(){this.manifest.contentSteering=O(h.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",h.attributes,["SERVER-URI"])}}[h.tagType]||a).call(t)},uri(){n.uri=h.uri,e.push(n),this.manifest.targetDuration&&!("duration"in n)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),n.duration=this.manifest.targetDuration),i&&(n.key=i),n.timeline=c,r&&(n.map=r),p=0,null!==this.lastProgramDateTime&&(n.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=1e3*n.duration),n={}},comment(){},custom(){h.segment?(n.custom=n.custom||{},n.custom[h.customType]=h.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[h.customType]=h.data)}})[h.type].call(t)}))}warnOnMissingAttributes_(t,e,r){const i=[];r.forEach((function(t){e.hasOwnProperty(t)||i.push(t)})),i.length&&this.trigger("warn",{message:`${t} lacks required attribute(s): ${i.join(", ")}`})}push(t){this.lineStream.push(t)}end(){this.lineStream.push("\n"),this.manifest.dateRanges.length&&null===this.lastProgramDateTime&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(t){this.parseStream.addParser(t)}addTagMapper(t){this.parseStream.addTagMapper(t)}}const S=new Map;async function _(t){let e=S.get(t);return e||(e=l(t).then((t=>{const e=new N;e.push(t),e.end();const r=e.manifest;if(!r?.segments?.length)throw new Error(`No segments in subtitles manifest were found. Manifest text: ${t}`);return r.segments.map((t=>t.uri))})).catch((e=>{const r=`Failed to download or parse subtitles manifest with URL ${t}. Error: ${JSON.stringify(e)}`;throw p.logError(r),S.delete(t),new Error(r)})),S.set(t,e)),e}const P=new Map;function w(t){let e=P.get(t);return e||(e=l(t),P.set(t,e)),e}var A=r(941),I=r.n(A);function C(t){const e=t.toLowerCase();switch(!0){case["zh-cn","zh-sg","yue","nan","hak","zh","zh-hans"].includes(e):case["zh-tw","zh-hk","yue-hk","nan-tw","hak-tw","zh-hant"].includes(e):return"zh";case["en-gb","en-us","en-ie","en-ca","en-in"].includes(e):return"en";case["es-419","es-us","es-mx","es-es"].includes(e):return"es";case["pt-br","pt-pt"].includes(e):return"pt";case["hi-latn"].includes(e):return"hi";case["sr-latn","sr-cyrl"].includes(e):return"sr";case["mo"].includes(e):return"ro";case["nl-be","nl-nl"].includes(e):return"nl";case["fr-be","fr-fr","fr-ca","fr-ch"].includes(e):return"fr";case["ru-latn"].includes(e):return"ru";case["de-at","de-de","de-ch"].includes(e):return"de";case["fa-af","fa-ir"].includes(e):return"fa";case["he"].includes(e):return"iw";case["nb","nn"].includes(e):return"no";default:return e.split("-").shift()||e}}const x=[t=>-1!==t.toLowerCase().indexOf("sdh"),t=>-1!==t.toLowerCase().indexOf("full"),t=>-1!==t.toLowerCase().indexOf(""),t=>-1!==t.toLowerCase().indexOf(""),t=>-1===t.toLowerCase().indexOf("forced"),t=>!0],k={abk:"ab",aar:"aa",afr:"af",aka:"ak",sqi:"sq",alb:"sq",amh:"am",ara:"ar",arg:"an",hye:"hy",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bam:"bm",bak:"ba",eus:"eu",baq:"eu",bel:"be",ben:"bn",bis:"bi",bos:"bs",bre:"br",bul:"bg",mya:"my",bur:"my",cat:"ca",cha:"ch",che:"ce",nya:"ny",zho:"zh",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",hrv:"hr",ces:"cs",cze:"cs",dan:"da",div:"dv",nld:"nl",dut:"nl",dzo:"dz",eng:"en",epo:"eo",est:"et",ewe:"ee",fao:"fo",fij:"fj",fin:"fi",fra:"fr",fre:"fr",fry:"fy",ful:"ff",gla:"gd",glg:"gl",lug:"lg",kat:"ka",geo:"ka",deu:"de",ger:"de",ell:"el",gre:"el",kal:"kl",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hun:"hu",isl:"is",ice:"is",ido:"io",ibo:"ig",ind:"id",ina:"ia",ile:"ie",iku:"iu",ipk:"ik",gle:"ga",ita:"it",jpn:"ja",jav:"jv",kan:"kn",kau:"kr",kas:"ks",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",lub:"lu",ltz:"lb",mkd:"mk",mac:"mk",mlg:"mg",msa:"ms",may:"ms",mal:"ml",mlt:"mt",glv:"gv",mri:"mi",mao:"mi",mar:"mr",mah:"mh",mon:"mn",nau:"na",nav:"nv",nde:"nd",nbl:"nr",ndo:"ng",nep:"ne",nor:"no",nob:"nb",nno:"nn",iii:"ii",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pli:"pi",pus:"ps",fas:"fa",per:"fa",pol:"pl",por:"pt",pan:"pa",que:"qu",ron:"ro",rum:"ro",roh:"rm",run:"rn",rus:"ru",sme:"se",smo:"sm",sag:"sg",san:"sa",srd:"sc",srp:"sr",sna:"sn",snd:"sd",sin:"si",slk:"sk",slo:"sk",slv:"sl",som:"so",sot:"st",spa:"es",sun:"su",swa:"sw",ssw:"ss",swe:"sv",tgl:"tl",tah:"ty",tgk:"tg",tam:"ta",tat:"tt",tel:"te",tha:"th",bod:"bo",tib:"bo",tir:"ti",ton:"to",tso:"ts",tsn:"tn",tur:"tr",tuk:"tk",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wln:"wa",cym:"cy",wel:"cy",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zul:"zu",ai:"ru"},D=new Map;function U(t){if(!D.has(t)){const e=t;D.set(t,async function(t){const e=await async function(t){const e=await l(t);let r;try{r=(new window.DOMParser).parseFromString(e,"text/html")}catch(e){throw new Error(`Failed to parse HTML code of text retrieved from url ${t}`,{cause:e})}return r}(t),r=[...e.body.querySelectorAll("script")],i="playlist =",n=r.find((t=>t.textContent?.includes(i)||!1));if(!n){const t=`Failed to find "${i}"`;throw p.logError(t),new Error(t)}const o="IS_DUMP_VALUE",a=`\n    (function (screen, document) {\n      ${n.textContent};\n      ${o}(JSON.stringify(playlist));\n    })\n      (\n        {width:1920, height: 1080},\n        {write: function () {}}\n      )\n    `,s={value:""};return new(I())(a,((t,e)=>{t.setProperty(e,o,t.createNativeFunction((t=>{s.value=t})))})).run(),async function(t){let e;try{e=JSON.parse(t)}catch(t){throw new Error(`Failed to parse playlist: ${JSON.stringify(t)}`)}const r=".jw-title-primary",i=document.querySelector(r);if(!i)throw new Error(`Failed to find element with ID ${r}`);const n=e.find((t=>(new DOMParser).parseFromString(t.title,"text/html").documentElement.textContent===i.textContent));if(void 0===n)throw new Error(`Failed to find playlist item with "title" property that HTML unescapes into "${i.textContent}"`);const o=new URL(n.file,location.href).toString(),a=await l(o),s=new N;s.push(a),s.end();const c=s.manifest;if(!c.mediaGroups.SUBTITLES)return p.logInfo("No SUBTITLES group was found in manifest.mediaGroups"),{};const u={},h=Object.keys(c.mediaGroups.SUBTITLES);for(const t of h){const e=c.mediaGroups.SUBTITLES[t];if(!e)throw new Error(`manifest.mediaGroups.SUBTITLES.${t} is null-ish`);const r=Object.keys(e);for(const i of r){const r=e[i];if(!r)throw new Error(`manifest.mediaGroups.SUBTITLES.${t}.${i} is null-ish`);const n=new URL(r.uri,o).toString(),a=u[i];a&&a!==n&&p.logError(`${i} already has value "${a}", overwriting it with "${n}"`),u[i]=n}}return u}(s.value)}(e).catch((r=>{D.delete(t);const i=`Failed to download subtitles manifest from url ${e}. Details: ${JSON.stringify(r)}`;throw p.logError(i),new Error(i,{cause:r})})))}return D.get(t)}function L(t,e){const r=Object.entries(e),i=C(t),n=new Map;for(const t of x)for(const[e,o]of r)if(t(e)){const t=e.toLowerCase().split(" ").shift();if(!t){p.logError(`Unable to extract 3-letter code from subtitles name: "${e}"`);continue}const r=k[t];if(!r){p.logError(`Unable to find 2-letter code that matches 3-letter one "${t}".\n                Original subtitles name: ${e}`);continue}if(C(r)===i){const t=new URL(o,location.href);n.set(e,t.toString())}}return n}async function j(t,e){if(!e.size)return[u];for(const[t,r]of e.entries())try{const t=await _(r),e=[];for(const r of t){const t=await w(r);if(!t.startsWith("WEBVTT")){const e=`Subtitles ${r} have uknown format. Excerpt (first 100 code units):\n        ${t.substring(0,100)}\n        `;throw new Error(e)}e.push(t)}return e}catch(e){p.logError(`Error processing subtitles "${t}"\n         with manifest URL ${r}. Details:\n         ${JSON.stringify(e)}\n         `)}return p.logError(`Failed to process all subtitles in this list:\n    ${JSON.stringify([...e.keys()])}.\n    Reporting to user that video has no subtitles in language ${t}.`),[u]}window.addEventListener("is_kinopub_command",(t=>{const e=t.detail;switch(p.logDebugMessage(`KINOPUB_SUBTITLE: Received command ${e.type}`),e.type){case c.SEND_SUBS:(async function(t){const e=new Map,r=function(){const t=new URL(location.href);return t.hash="",t.toString()}();for(const i of t){const t=j(i,L(i,await U(r)));e.set(i,t)}const i={videoId:r,langToWebVttChunks:{}};for(const[t,r]of e.entries()){const e=await r;i.langToWebVttChunks[t]=e}return i})(e.data).then((t=>{window.dispatchEvent(new CustomEvent("is_kinopub_subtitles",{detail:{type:s.SUBTITLES_WEBVTT,data:t}}))})).catch((t=>{p.logDebugMessage(`KINOPUB_SUBTITLES_LOG: Subtitle loading was interrupted ${t}`)}));break;case c.INIT:{const t=e.data;a.OTHER,window.location.href,p.setSentryLogger(new o(t.logServerUrl,(()=>t.publicToken),(()=>window.location.href),(()=>t.pluginData),t.logLevel));break}}}))})()})();