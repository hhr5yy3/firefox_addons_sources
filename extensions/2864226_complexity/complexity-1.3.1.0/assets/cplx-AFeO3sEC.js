import{j as S,q as i,E as h,h as w}from"./cplx-CVsLL7Ku.js";import{z as r,f as x,A as l,j as B}from"./cplx-Cdcyb6EG.js";import{c as O}from"./cplx-M4JPizzD.js";import{e as k}from"./cplx-2ekRUlSR.js";const Q={ui:{label:"Appearance",description:"UI related plugins"},ux:{label:"Ease of Use",description:"UX related plugins"},desktopOnly:{label:"Desktop Only",description:"Can only be used on desktop/screen width > 768px"},slashCommand:{label:"Slash Command",description:"Plugins that are enabled by typing a slash command"},privacy:{label:"Privacy",description:"Privacy related plugins"},pplxPro:{label:"Perplexity Pro",description:"Requires an active Perplexity Pro subscription"},experimental:{label:"Experimental",description:"Experimental plugins. Subject to change or removal without prior notice"},beta:{label:"Beta",description:"Official plugins but still in testing/development"},forFun:{label:"For Fun",description:"Just for fun!"},new:{label:"New",description:"Recently added plugins"}},P={"queryBox:languageModelSelector":{id:"queryBox:languageModelSelector",routeSegment:"query-box-language-model-selector",title:"Language Model Selector",description:"Enable selection of different language models",tags:["ui","ux","pplxPro"],dependentCorePlugins:["networkIntercept","spaRouter","domObserver"]},"queryBox:focusSelector":{id:"queryBox:focusSelector",routeSegment:"query-box-focus-selector",title:"Better Focus Selector",description:"Replace the default Perplexity's focus selector with a more customizable one",tags:["ui","ux"],dependentCorePlugins:["spaRouter","domObserver"]},"queryBox:focusSelector:webRecency":{id:"queryBox:focusSelector:webRecency",routeSegment:"query-box-focus-selector-web-recency",title:"Web Focus Recency Selector",description:"Select the recency of the web search from homepage and within threads",tags:["beta","ui","ux"],dependentPlugins:["queryBox:focusSelector"],dependentCorePlugins:["spaRouter","domObserver"]},"queryBox:spaceNavigator":{id:"queryBox:spaceNavigator",routeSegment:"query-box-space-navigator",title:"Space Navigator",description:"Search & navigate between spaces",tags:["ui","ux"],dependentCorePlugins:["spaRouter","domObserver"]},"queryBox:slashCommandMenu:promptHistory":{id:"queryBox:slashCommandMenu:promptHistory",routeSegment:"query-box-slash-command-menu-prompt-history",title:"Prompt History",description:"Reuse previous prompts. Usage: type /h in the query box",tags:["new","experimental","slashCommand","desktopOnly","ui","ux"],dependentCorePlugins:["spaRouter","domObserver","networkIntercept"]},"queryBox:noFileCreationOnPaste":{id:"queryBox:noFileCreationOnPaste",routeSegment:"query-box-no-file-creation-on-paste",title:"Prevent File Creation on Paste",description:"Prevent automatic file creation when pasting (very) long text into the query box",tags:["ux"],dependentCorePlugins:["spaRouter","domObserver"]},"queryBox:submitOnCtrlEnter":{id:"queryBox:submitOnCtrlEnter",routeSegment:"query-box-submit-on-ctrl-enter",title:`Query Box: Submit on ${S()==="mac"?"Cmd":"Ctrl"}+Enter`,description:`Insert new line on Enter, submit on ${S()==="mac"?"Cmd":"Ctrl"}+Enter`,tags:["new","ux"],dependentCorePlugins:["spaRouter","domObserver"]},"queryBox:fullWidthFollowUp":{id:"queryBox:fullWidthFollowUp",routeSegment:"query-box-full-width-follow-up",title:"Full Width Follow Up Query Box",description:"Make the query box in threads wider",tags:["desktopOnly","ui"],dependentCorePlugins:["spaRouter"]},commandMenu:{id:"commandMenu",routeSegment:"command-menu",title:"Command Menu",description:"Quickly navigate around and invoke actions",tags:["ui","ux","desktopOnly"],dependentCorePlugins:["spaRouter","webSocket"]},"thread:toc":{id:"thread:toc",routeSegment:"thread-toc",title:"Thread ToC",description:"Quickly navigate between messages in a thread. Only shows up when there are more than 2 messages",tags:["ui","ux"],dependentCorePlugins:["spaRouter","domObserver"]},"thread:betterMessageToolbars":{id:"thread:betterMessageToolbars",routeSegment:"thread-better-message-toolbars",title:"Better Thread Message Toolbars",description:"Enhance message toolbars (in threads)",tags:["ui","ux"],dependentCorePlugins:["spaRouter","domObserver","reactVdom"]},"thread:betterCodeBlocks":{id:"thread:betterCodeBlocks",routeSegment:"thread-better-code-blocks",title:"Better Code Blocks",description:"Enhance code blocks (in threads)",tags:["ui","ux"],dependentCorePlugins:["spaRouter","domObserver","reactVdom"]},"thread:canvas":{id:"thread:canvas",routeSegment:"thread-canvas",title:"Canvas",description:"Visualize and interact with generated content side by side. Similar to claude.ai's artifacts. Very experimental",tags:["new","experimental","desktopOnly","ui"],dependentPlugins:["thread:betterCodeBlocks"],dependentCorePlugins:["spaRouter","domObserver","mermaidRenderer","markmapRenderer"]},"thread:exportThread":{id:"thread:exportThread",routeSegment:"thread-export-thread",title:"Export Thread",description:"Export the current thread in markdown format (with optional citations). More formatting options coming soon",tags:["ui","ux"],dependentCorePlugins:["spaRouter"]},"thread:betterMessageCopyButtons":{id:"thread:betterMessageCopyButtons",routeSegment:"thread-better-message-copy-buttons",title:"Better Thread Message Copy Buttons",description:"Copy message content without citations. More formatting options coming soon",tags:["ui","ux"],dependentCorePlugins:["spaRouter","domObserver"]},"thread:dragAndDropFileToUploadInThread":{id:"thread:dragAndDropFileToUploadInThread",routeSegment:"thread-drag-and-drop-file-to-upload-in-thread",title:"Drag and Drop File(s) to Upload in a thread",description:"Treat the whole thread page as a drop zone and allow you to directly drag & drop file(s) to upload them as attachment(s)",tags:["ux","desktopOnly"],dependentCorePlugins:["spaRouter"]},"thread:collapseEmptyThreadVisualCols":{id:"thread:collapseEmptyThreadVisualCols",routeSegment:"thread-collapse-empty-thread-visual-cols",title:"Collapse Empty Thread Visual Columns",description:"Collapse empty visual columns in the thread page",tags:["ui","desktopOnly"],dependentCorePlugins:["spaRouter"]},"thread:customThreadContainerWidth":{id:"thread:customThreadContainerWidth",routeSegment:"thread-custom-thread-container-width",title:"Custom Thread Container Width",description:"Customize the maximum width of the thread container",tags:["new","ui","desktopOnly"],dependentCorePlugins:["spaRouter"]},imageGenModelSelector:{id:"imageGenModelSelector",routeSegment:"image-gen-model-selector",title:"Image Generation Model Selector",description:"Enable selection of different image generation models",tags:["ui","ux","desktopOnly","pplxPro"],dependentCorePlugins:["networkIntercept","spaRouter","domObserver"]},onCloudflareTimeoutAutoReload:{id:"onCloudflareTimeoutAutoReload",routeSegment:"on-cloudflare-timeout-auto-reload",title:"Auto Reload on Cloudflare Timeout",description:"Auto reload the page on Cloudflare timeout",tags:["ux"]},blockAnalyticEvents:{id:"blockAnalyticEvents",routeSegment:"block-analytic-events",title:"Block Analytic Events",description:"Prevent Perplexity from sending analytic/tracking events. For debugging purposes only",tags:["privacy"],dependentCorePlugins:["networkIntercept"]},"home:customSlogan":{id:"home:customSlogan",routeSegment:"home-custom-slogan",title:"Custom Home Slogan",description:"Customize the slogan on the home page",tags:["ui","forFun"]},"hide-get-mobile-app-cta-btn":{id:"hide-get-mobile-app-cta-btn",routeSegment:"hide-get-mobile-app-cta-btn",title:'Hide "Get Mobile App" Button',description:'Hide all "Get Mobile App" buttons on mobile screens',tags:["ui"]},zenMode:{id:"zenMode",routeSegment:"zen-mode",title:"Zen Mode",description:"Hide elements on the page to focus on the content (toggleable). Enable via the Command Menu plugin.",tags:["ui","desktopOnly"],dependentCorePlugins:["spaRouter","domObserver"],dependentPlugins:["commandMenu"]}},F=[{label:"Claude 3.5 Sonnet",shortLabel:"Sonnet",code:"claude2",provider:"Anthropic"},{label:"Claude 3.5 Haiku",shortLabel:"Haiku",code:"claude35haiku",provider:"Anthropic"},{label:"O1",shortLabel:"O1",code:"o1",provider:"OpenAI"},{label:"GPT-4 Omni",shortLabel:"GPT-4o",code:"gpt4o",provider:"OpenAI"},{label:"Grok-2",shortLabel:"Grok-2",code:"grok",provider:"xAI"},{label:"Sonar Huge",shortLabel:"Sonar XL",code:"llama_x_large",provider:"Perplexity"},{label:"Sonar Large",shortLabel:"Sonar",code:"experimental",provider:"Perplexity"},{label:"Default",shortLabel:"Default",code:"turbo",provider:"Perplexity"}];let y=[...F];R();function R(){return y.reduce((n,e)=>{const t=n.find(o=>o.provider===e.provider);return t?t.models.push(e):n.push({provider:e.provider,models:[e]}),n},[])}O.register({id:"cache:languageModels",loader:async()=>{const{pluginsEnableStates:n}=c.getCachedSync();if(!(n!=null&&n["queryBox:languageModelSelector"]))return;const[e,t]=await k(()=>i.fetchQuery({...d.remoteLanguageModels}))();t||!e?y=[...F]:(y=e,R())}});const D=r.object({label:r.string(),shortLabel:r.string(),code:r.string().transform(n=>n),provider:r.string().transform(n=>n),unknownLimit:r.boolean().optional()});function H(n){return y.some(e=>e.code===n)}const T=r.object({latest:r.string(),latestFirefox:r.string(),changelogEntries:r.array(r.string()),featureFlagsEntries:r.array(r.string()),canvasInstructionLastUpdated:r.number().optional()}),A=["anon","logged-in","supporter"],v=r.array(r.string()),U=r.record(r.enum(A),r.object({forceDisable:v,hide:v}));class g{static async fetchVersions(){const e=T.parse(JSON.parse(await x(`${l.CPLX_CDN_URL}/versions.json?t=${m()}`))),t=l.BROWSER==="chrome"?"latest":"latestFirefox";return{latest:e[t],changelogEntries:e.changelogEntries,featureFlagsEntries:e.featureFlagsEntries,canvasInstructionLastUpdated:e.canvasInstructionLastUpdated}}static async fetchFeatureFlags(){const e=l.VERSION,t=i.getQueryData(d.versions.queryKey)??await i.fetchQuery(d.versions),o=t!=null&&t.featureFlagsEntries.includes(e)?e:"latest";return U.parse(JSON.parse(await x(`${l.CPLX_CDN_URL}/feature-flags/${o}.json?t=${m()}`)))}static async fetchLanguageModels(){return r.array(D).parse(B.safeParse(await x(`${l.CPLX_CDN_URL}/language-models.json?t=${m()}`)))}static async fetchChangelog({version:e}={}){const t=e??l.VERSION,o=i.getQueryData(d.versions.queryKey)??await i.fetchQuery(d.versions),a=e??(o!=null&&o.changelogEntries.includes(t)?t:o==null?void 0:o.latest),s=await fetch(`${l.CPLX_CDN_URL}/changelogs/${a}.md?t=${m()}`);if(s.status===404)throw new Error(`Failed to fetch changelog for version ${a}.`);return s.text()}}function m(){const e=h.getCachedSync().cdnLastUpdated,t=Date.now(),o=1e3*60*60;return t-e>o?(h.set(a=>{a.cdnLastUpdated=t}),t):e}const d=w("cplxApi",{versions:{queryKey:null,queryFn:g.fetchVersions},featureFlags:{queryKey:null,queryFn:()=>g.fetchFeatureFlags()},remoteLanguageModels:{queryKey:null,queryFn:g.fetchLanguageModels},changelog:({version:n}={})=>({queryKey:[{version:n}],queryFn:()=>g.fetchChangelog({version:n})})}),q=w("pluginsStates",{computed:{queryKey:null,queryFn:()=>c.get({cache:!1})}});class c{static getDefaultPluginsStates(){const e=h.getCachedSync();return{pluginsEnableStates:c.checkDependencies(Object.fromEntries(Object.keys(e.plugins).map(t=>[t,e.plugins[t].enabled]))),pluginsHideFromDashboardStates:null}}static async getFeatureFlags({cache:e}){if(e){const t=i.getQueryData(d.featureFlags.queryKey);if(t)return t}return await i.fetchQuery({...d.featureFlags,gcTime:1/0})}static async get({cache:e}={cache:!0}){const t=this.getDefaultPluginsStates(),o=h.getCachedSync(),a="anon",[s,E]=await k(()=>this.getFeatureFlags({cache:e}))();if(s==null||o==null||E)return t;const L=Object.fromEntries(Object.keys(o.plugins).map(u=>{var C;const b=o.plugins[u].enabled,p=!((C=s[a])==null?void 0:C.forceDisable.includes(u))&&b;return[u,p]})),M=Object.fromEntries(Object.keys(o.plugins).map(u=>{var f,p;const b=(p=(f=s[a])==null?void 0:f.hide)==null?void 0:p.includes(u);return[u,b]}));return{pluginsEnableStates:c.checkDependencies(L),pluginsHideFromDashboardStates:M}}static getCachedSync(){return i.getQueryData(q.computed.queryKey)??this.getDefaultPluginsStates()}static areAllDependentPluginsEnabled({pluginId:e,pluginsEnableStates:t}){var o,a;return(a=(o=P[e])==null?void 0:o.dependentPlugins)==null?void 0:a.every(s=>t[s])}static checkDependencies(e){const t={...e};return Object.keys(e).forEach(o=>{var s;(s=P[o])!=null&&s.dependentPlugins&&(c.areAllDependentPluginsEnabled({pluginId:o,pluginsEnableStates:e})||(t[o]=!1))}),t}}O.register({id:"cache:pluginsStates",dependencies:["cache:extensionLocalStorage"],loader:async()=>{await i.prefetchQuery({...q.computed,gcTime:1/0})}});export{c as P,P as a,Q as b,d as c,R as g,H as i,y as l};
