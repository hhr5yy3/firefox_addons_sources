Okta.API=function(i,s){var n={};var u=Okta.Q;var e=Okta._okta;var r=e.reduce;var a=Okta.fn.url.urlPartsToDomain;var t=Okta.fn.url.hrefToUrlParts;var o=Okta.fn.cookies.checkSessionCookie;var c=Okta.fn.cookies.getCookies;var f=Okta.fn.api.setSessionData;var k=Okta.fn.api.setAuthData;var h=Okta.fn.api.getToSettings;var l=function(t){return i.getVersion().then(function(e){return h(t,{backgroundVersion:e.backgroundVersion,contentVersion:e.contentVersion})})};n.getSessionCookie=function(e,t){if(e){return i.getSessionCookie()}else{return c(t,["sid","DT","idx"]).then(function(e){return r(e,function(e,t){e[t.name]=t.value;return e},{})})}};n.makeGetRequest=function(e,t){return n.getSessionCookie(t,a(e)).then(function(t){if(!o(t)){return u.reject("can not obtain session cookies, will not make the request: "+e.href)}return l(e.href).then(function(e){f(t,e.headers);return s.ajax(e)})})};function d(e){return a(t(e.replace("-admin.",".")))}function v(e,t){var n=e[t];if(n?.access_token?.expiresAt>=Math.floor(Date.now()/1e3)){return n}}n.makeGetRequestWithOinSubmissionTesterToken=function(a){return u.all([l(a),i.getOinSubmissionTesterAuthToken()]).spread(function(e,t){var n=d(a);var r=v(t,n);if(!r){return u.reject("invalid access token on "+n)}e.type="get";k(r,e.headers);return s.ajax(e)})};n.makePostRequestWithOinSubmissionTesterToken=function(a,o){return u.all([l(a),i.getOinSubmissionTesterAuthToken()]).spread(function(e,t){var n=d(a);var r=v(t,n);if(!r){return u.reject("invalid access token on "+n)}e.type="post";e.headers["content-type"]="application/json";k(r,e.headers);e.data=o;return s.ajax(e)})};n.makeDeleteRequestWithOinSubmissionTesterToken=function(a){return u.all([l(a),i.getOinSubmissionTesterAuthToken()]).spread(function(e,t){var n=d(a);var r=v(t,n);if(!r){return u.reject("invalid access token on "+n)}e.type="delete";k(r,e.headers);return s.ajax(e)})};n.makeGetRequestWithToken=function(n){var r=a(n);return i.getAuthToken().then(function(e){var t=v(e,r);if(!t){return u.reject("invalid access token on "+r)}return l(n.href).then(function(e){k(t,e.headers);return s.ajax(e)})})};n.getOktaUnauthenticatedRequest=function(e){var t={type:"get",url:e,cache:"no-cache",headers:{Accept:"application/json"}};return s.ajax(t)};n.getManualRedirectRequest=function(e){var t={type:"get",url:e,headers:{Accept:"application/json"},redirect:"manual"};return s.ajax(t)};n.getAccessToken=function(e,t){var n={type:"post",url:e,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:t};return s.ajax(n)};return n};