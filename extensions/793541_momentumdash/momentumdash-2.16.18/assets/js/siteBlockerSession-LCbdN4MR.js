import{d as e,l as t,p as s,c as i,m as r,n as o}from"./icon-alert-mvI7iJMO.js";import{d as a,e as n,F as c}from"./index-S6WCWdQc.js";import{u as l,a as p}from"./siteBlockerGroups-DKJNTMAC.js";import{S as d,a as u,b as g}from"./constants-BT5o8PmI.js";import{useFocusModeDashViewStateStore as h}from"./focusModeViewState-CNsbBnWl.js";import{u as j}from"./pomodoroCompleted-Dzh3puzj.js";import{g as S}from"./focusModeHelpers-Dnjy08Ra.js";import{c as b}from"./reactiveCustomization-OmNBH0KE.js";import"./localStorage-C5mLf9Kt.js";import"./preload-helper-DmNsytk6.js";import"./string-VUUyAM1F.js";import"./migrateLegacyUserMessageHandler-D55cXb1Z.js";import"./main-DbylMrX8.js";import"./compareObjects-BF7sSNEf.js";import"./ViewState-BPM6-Gc_.js";import"./VueBase-DZEWjrk8.js";import"./index-CJJH83pl.js";import"./portal-vue.esm-CMantqsQ.js";import"./scenes-DlKs5kIo.js";import"./ocean-bubbles-GcKjBI5B.js";import"./PomodoroTimers-BWkB-14p.js";import"./loginHelpers-BgZoFN0w.js";import"./authService-BcSP4pRZ.js";import"./customization-DuwuTgu-.js";const f=new a(d,!1),v=new a(u,""),w=e("siteBlockerSession",{state:()=>({active:f.currentValue,hasPermissions:!1}),getters:{urls:()=>[...l().items.reduce(((e,t)=>t.enabled?(p().getWebsitesByGroup(t).filter((e=>e.enabled)).forEach((t=>e.add(t.hostWithWildcard))),e):e),new Set([]))].join(" "),settingsEnabled:()=>b.siteBlockerVisible,focusModeEnabledAndFocusModeSettingActive:()=>n.currentValue&&S().apps.siteBlocker.enabled&&h().activeViewId===c.Focusing.toString(),featureEnabled:()=>m.conditionalFeatures.featureEnabled("site-blocker")||n.currentValue,activeAndBlockingUrls:e=>e.active&&e.hasPermissions&&0!==l().items.length},actions:{toggleActive(e){const t=e??!this.active;t&&this.checkSiteBlockerFeatureDisabledAndOpenUpsell()||(t&&this.registerOrUpdateContentScript(),this.active=t)},async ensurePermissions(e=!1){return this.hasPermissions?await this.registerOrUpdateContentScript():new Promise((t=>{m.cmd("modal.open","PERMISSION_REQUEST",{source:"Site Blocker",reason:"To block sites while focusing",permissions:g,requestImmediately:e,resolve:async e=>{if(!e)return t(!1);this.hasPermissions=!0,await this.registerOrUpdateContentScript(),t(!0)},extraInstructions:o()?' Please select "Always allow on every website..."':"",watchPermissionCheck:!0})}))},async registerOrUpdateContentScript(){if(!t().scripting)return;const e=await t().scripting.getRegisteredContentScripts();return await new Promise((s=>{t().scripting[e.length?"updateContentScripts":"registerContentScripts"]([{id:"site-blocker",js:["/content-scripts/siteBlocker.js"],matches:["*://*/*"],runAt:"document_start"}],(()=>s(!0)))}))},checkSiteBlockerFeatureDisabledAndOpenUpsell(){return!this.featureEnabled&&(m.cmd("modal.open","UPSELL_SITE_BLOCKER",{eventSource:"site-blocker"}),!0)}}});(async()=>{const e=w(),o=l(),a=p(),c=j();f.switchOverToWatchedStoreItem((()=>e.active)),t().permissions&&s.permissions.contains(g).then((t=>e.hasPermissions=t)),await i((()=>c.loaded)).toBe(!0),r([()=>n.currentValue,()=>e.focusModeEnabledAndFocusModeSettingActive,()=>c.anyFocusTimerActive,()=>c.playing,()=>e.featureEnabled,()=>e.settingsEnabled],(([t,s,i,r,o,a])=>{o&&a||e.toggleActive(!1),t&&(s&&i&&r?e.toggleActive(!0):e.toggleActive(!1))})),await i((()=>o.loaded)).toBe(!0),await i((()=>a.loaded)).toBe(!0),v.switchOverToWatchedStoreItem((()=>e.urls))})();export{w as default};