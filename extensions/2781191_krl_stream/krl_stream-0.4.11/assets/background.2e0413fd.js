import{p as F,e as V,f as M,q as s,r as c,N as C,s as m,t as H,o as O,u,E as G,v as U,w as D,x as Y,y as B,l as w,z as k,A as R,M as n,B as P,D as x,Y as h,G as z,F as $,H as W,T as j}from"./date.99b6e282.js";const T=async t=>await fetch(t).then(e=>e.json()).catch(()=>{throw new Error("Unable to fetch Twitch API")}),X=async()=>T("https://api.krl.tiibz.dev/v1/twitch/status"),q=async()=>T("https://api.krl.tiibz.dev/v1/twitch/broadcasts"),p=async t=>await fetch(t).then(a=>a.json()).catch(()=>{throw new Error("Unable to fetch Genone API")}),J=()=>p("https://api.krl.tiibz.dev/v1/genone/lineup"),K=()=>p("https://api.krl.tiibz.dev/v1/genone/matches"),L=async t=>await fetch(t).then(a=>a.json()).catch(()=>{throw new Error("Unable to fetch YouTube API")}),Q=()=>L("https://api.krl.tiibz.dev/v1/youtube"),Z=()=>L("https://api.krl.tiibz.dev/v1/youtube/shorts"),f=(t,e)=>{if(t==="offline"||e===void 0||e.status==="offline")return{status:"offline",lastNotifiedLive:!1};const{userDisplayName:a,url:i,thumbnailUrl:r,title:_,startDate:l,viewerCount:g}=e;return{status:"online",userDisplayName:a,startedSince:F(l),title:_,thumbnailUrl:r.replace("{width}",V).replace("{height}",M),viewerCount:g,startDate:l,url:i,lastNotifiedLive:!1}},tt=async()=>{try{const t=await X();return t.status==="offline"?f("offline"):f("online",t)}catch(t){return{status:"offline",lastNotifiedLive:"error"}}},et=async()=>{try{return await q()}catch(t){return"error"}},st=async()=>{try{return await Z()}catch(t){return"error"}},at=async()=>{try{return await Q()}catch(t){return"error"}},nt=async()=>{try{return await J()}catch(t){return"error"}},it=async()=>{try{return await K()}catch(t){return"error"}},ot=()=>{const{manifest_version:t}=s.runtime.getManifest();return(t===3?s.action:s.browserAction).getBadgeText({})},o=t=>{const{manifest_version:e}=s.runtime.getManifest(),a=e===3?s.action:s.browserAction;a.setBadgeText({text:c[t].badgeLabel}),a.setBadgeBackgroundColor({color:c[t].badgeColor}),a.setTitle({title:c[t].iconTitle})},rt=(t,e)=>{s.notifications.create(t,{iconUrl:H,priority:2,...e})},ct=t=>{rt(m.OnLive,{type:"image",imageUrl:t.thumbnailUrl,title:C,message:t.title})},I=async()=>{const t=await O(),e=await tt();if(e.lastNotifiedLive==="error"){o(e.status),await u({...e,lastNotifiedLive:t!==void 0&&t.lastNotifiedLive?t.lastNotifiedLive:!1});return}if(t.status===e.status){const a=await ot();(a===""&&e.status==="online"||a===G&&e.status==="offline")&&o(e.status)}if(!(t.status==="offline"&&e.status==="offline"||t.status==="online"&&e.status==="online"&&t.lastNotifiedLive===e.startDate&&t.viewerCount===e.viewerCount&&t.title===e.title&&t.thumbnailUrl===e.thumbnailUrl)){if(t.status==="online"&&e.status==="offline"){o(e.status),await u({...e,lastNotifiedLive:!1});return}e.status==="online"&&(t.lastNotifiedLive===!1||U(t.lastNotifiedLive,e.startDate))&&ct(e),e.status==="online"&&(t.status==="offline"&&o(e.status),await u({...e,lastNotifiedLive:e.startDate}))}},b=async()=>{const t=await et();t!=="error"&&await D(t)},v=async()=>{const t=await at();t!=="error"&&await Y(t)},A=async()=>{const t=await st();t!=="error"&&await B(t)},E=async()=>{if(!w(5))return;const t=await nt();t!=="error"&&await k(t)},N=async()=>{if(!w(5))return;const t=await it();t!=="error"&&await R(t)},d=[{name:n.FetchTwitchStatus,periodInMinutes:P},{name:n.FetchTwitchVideos,periodInMinutes:x},{name:n.FetchYoutubeVideos,periodInMinutes:h},{name:n.FetchYoutubeShortVideos,periodInMinutes:h},{name:n.FetchGenoneLineup,periodInMinutes:z},{name:n.FetchGenoneMatches,periodInMinutes:$}],y=()=>{s.alarms.getAll().then(t=>{const e=d.map(i=>i.name.toString()),a=t.filter(i=>!e.includes(i.name));for(const i of a)s.alarms.clear(i.name);for(const i of d)t.some(r=>r.name===i.name)||s.alarms.create(i.name,{periodInMinutes:i.periodInMinutes})})},S=()=>{I(),b(),v(),A(),E(),N()},ut=()=>{S(),y()};s.runtime.onInstalled.addListener(t=>{console.log(`${t.reason==="install"?"Installation":"Mise \xE0 jour"} r\xE9ussie \u2705`),ut(),W()});s.runtime.onStartup.addListener(()=>{S(),y()});s.alarms.onAlarm.addListener(t=>{switch(t.name){case n.FetchTwitchStatus:return I();case n.FetchTwitchVideos:return b();case n.FetchYoutubeVideos:return v();case n.FetchYoutubeShortVideos:return A();case n.FetchGenoneLineup:return E();case n.FetchGenoneMatches:return N()}});s.notifications.onClicked.addListener(t=>{switch(t){case m.OnLive:s.tabs.create({url:j});break}});
