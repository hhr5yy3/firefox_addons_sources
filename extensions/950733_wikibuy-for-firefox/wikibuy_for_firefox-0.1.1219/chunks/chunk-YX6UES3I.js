import{a as H,b as pt,c as ut,d as _t,e as ct}from"./chunk-UP7HC4SX.js";import{a as lt}from"./chunk-OAYN3TMF.js";import{a as q}from"./chunk-4GQADNUW.js";import{a as U}from"./chunk-IQFNOK3G.js";import{a as ht}from"./chunk-Z64FBUPL.js";import{a as W}from"./chunk-KWDMUJJA.js";import{a as $}from"./chunk-MT4LVDUX.js";import{a as st}from"./chunk-7S3YJSN5.js";import{K as dt,M as mt,a as y,e as at,f,g as rt,n as $t}from"./chunk-LADTODTA.js";import{B as w,c as E,g as F,k as V,m as ot,r as S,t as nt,x as v}from"./chunk-WRHUMLYF.js";import{G as At,J as et,K as Et,q as M}from"./chunk-OEPSEZ5A.js";import{e as r}from"./chunk-3GYLW4KZ.js";Et();function X(a=0,t=0,o="disable_price_run"){return S(o)&&t>0&&a<=t?(et([`***price run is disabled for items <= $${Math.round(t)/100}***`]),!0):!1}var qt=a=>v("getConquestConfig",a);var ke=r(y()),tt=r(M());var Ki=r(y()),Rt=r(y()),Pt=r(At()),i=r(M());var O=r(y()),Xt=r(y()),gt=r($t());var bt=r(f()),L=a=>{let{containerNamespace:t,children:o}=a,e=E.get(["additionalContentNamespace",t])();if(!e)return null;let _=".__wikibuy",s=(0,O.useRef)();return s.current||(s.current=document.createElement("div"),e.querySelector(_).appendChild(s.current)),(0,O.useEffect)(()=>()=>e.querySelector(_).removeChild(s.current),[]),gt.default.createPortal((0,bt.jsx)(rt,{target:s.current,children:o}),s.current)};var hi=r(y()),wt=r(y()),u=r(M());function Y(a){return v("showFollow",a)}var ni=r(y()),ft=r(y());var C=r(f()),j=class extends ft.Component{render(){return(0,C.jsx)("div",{className:`annotation-tooltip-component ${this.props.classes||""}`,onClick:t=>{t.stopPropagation()},children:(0,C.jsxs)("div",{className:"annotation-tooltip-container",children:[(0,C.jsxs)("div",{className:"header",children:[(0,C.jsx)(st,{}),(0,C.jsx)(W,{onClick:this.props.onCloseTooltip.bind(this,"x")})]}),this.props.children]})})}},G=j;var n=r(f()),Bt={"amazon.com":"Amazon","homedepot.com":"Home Depot","bestbuy.com":"Best Buy","target.com":"Target"},D=class extends wt.Component{componentDidMount(){w("page",`offersListAnnotationTooltip${this.props.deweyPC?"_runv4":""}`,{view:this.props.view,type:"notificationHover",searchIndex:this.props.searchIndex})}render(){let t=u.default.get(this.props,"showViewAllOffers",!0),o=!!u.default.find(this.props.filteredResults,e=>u.default.get(e,"pricing.coupons.length")&&!u.default.get(e,"meta.paymentsSupport")||u.default.get(e,"pricing.reward"));return(0,n.jsx)(G,{classes:`result-table-tooltip ${(this.props.originVendor||"").replace(".com","")}`,onCloseTooltip:()=>this.props.hideSavingsDetails(),children:(0,n.jsxs)("div",{className:`${o?"special-offers":""} result-list`,children:[(0,n.jsxs)("div",{className:"list-header",children:[(0,n.jsx)("h3",{className:"seller",children:"Seller"}),(0,n.jsx)("h3",{className:"delivery",children:"Delivery"}),(0,n.jsx)("h3",{className:"offer",children:"Special Offer"}),(0,n.jsx)("h3",{className:"total",children:"Est. Total"})]}),u.default.map(this.props.filteredResults,e=>{let _=u.default.get(e,"pricing.afterRewardTotal")||u.default.get(e,"pricing.total"),s=u.default.get(e,"pricing.credits.qualifyToRedeemCredits",!1),g=s?u.default.get(e,"pricing.credits.creditAmount",0):0,b=u.default.get(e,"product.vendor"),l=u.default.get(e,"product.vendorName")||Bt[b]||b;u.default.get(e,"meta.paymentsSupport")&&(l="Capital One Shopping");let p=u.default.get(e,"pricing.reward");p&&(p=p.type==="percentage"?(0,n.jsxs)("span",{className:"palmetto",children:[`+${p.amount/100}% `," ",(0,n.jsx)("span",{className:"reward-break",children:"back"})]}):(0,n.jsxs)("span",{children:[`+${$(p.amount,{currency:p.currency})}`," ",(0,n.jsx)("span",{className:"reward-break",children:"in Rewards"})]}));let d,x=`Automatically redeem ${$(g)} in Capital One Shopping credits toward this purchase. A ${$(g)} ${l} gift card will be automatically issued and applied during your checkout.`;s&&(d=(0,n.jsx)("span",{className:"palmetto",title:x,children:"with rewards"}));let T=u.default.get(e,"pricing.coupons.length")?"use code":"",m=u.default.get(e,"meta.verificationClassifierOutput.verified"),A=u.default.get(e,"details.estimatedDeliveryMinDays"),R=u.default.get(e,"details.estimatedDeliveryMaxDays"),z=A===R?R?`${R} days`:"":`${A} - ${R} days`;return(0,n.jsxs)("div",{className:"result-list-item",onClick:k=>{k.stopPropagation(),this.visitMerchant(e)},children:[(0,n.jsx)("h3",{className:`seller ${m?"verified":""}`,children:l==="Amazon"&&!e.origin?"Amz. Marketplace":l}),(0,n.jsx)("h3",{className:"delivery",children:(0,n.jsx)("span",{children:z})}),(0,n.jsx)("h3",{className:"offer",children:(0,n.jsx)("span",{children:s?d:T&&!u.default.get(e,"meta.paymentsSupport")?(0,n.jsx)("span",{className:"icon-coupon coupon",children:T}):p?(0,n.jsx)("span",{children:p}):null})}),(0,n.jsx)("h3",{className:"total primary-btn-large",children:$(_)})]},e.id)}),this.props.fullRunComplete?null:(0,n.jsxs)("h5",{className:"finding-more bold",children:["Finding more offers"," ",(0,n.jsxs)("div",{className:"wave",children:[(0,n.jsx)("span",{className:"dot"}),(0,n.jsx)("span",{className:"dot"}),(0,n.jsx)("span",{className:"dot"})]})]}),t&&this.props.wbid?(0,n.jsxs)("span",{children:[(0,n.jsx)("div",{className:"rule"}),(0,n.jsx)("h5",{style:{textAlign:"center",marginTop:"10px"},children:(0,n.jsx)("span",{className:"primary-link",onClick:e=>{e.preventDefault(),this.props.viewProductPage("view")},children:"View all offers"})})]}):null]})})}visitMerchant(t){Y({details:t,run:this.props.run,productData:t.product}),this.props.visitMerchant(t,!0)}};var yt=a=>v("getCart",a);var K=a=>v("getEstimate",a);var Oi=r(y()),kt=r(y());var I=r(f()),Mt=({annotationType:a,content:t,onDismissAnnotation:o})=>((0,kt.useEffect)(()=>{w("page",`${a}Tooltip`,{type:"notificationHover",label:t.deviceType||t.label,view:t.view})},[]),(0,I.jsxs)("div",{className:"server-driven-annotation-container",onClick:e=>{e.stopPropagation()},children:[(0,I.jsx)("div",{className:"flex justify-end",children:(0,I.jsx)(W,{width:13,onClick:()=>{o&&(o(),w("page",`${a}Tooltip`,{type:"notificationDismiss",label:t.deviceType||t.label,view:t.view}))}})}),(0,I.jsx)(lt,{content:t})]})),vt=Mt;var J=r(M());function xt(a){let t=J.default.get(a,"savingsWithRewards")||J.default.get(a,"savings")||0;return Math.max(0,t)}var c=r(f()),N="product-estimate-annotation-addtl-content",Ct=a=>{let{saveButtonDomElem:t,children:o,showSavingsDetails:e,hideSavingsDetails:_}=a;if(!t)return null;let g=!!E.get(["additionalContentNamespace",N])().querySelector(`.__${N}.open-right`),{bottom:b,right:l,left:p}=t.getBoundingClientRect(),d=document.documentElement;return(0,c.jsx)("div",{className:"product-estimate-annotation",onMouseEnter:e,onMouseLeave:_,style:{position:"absolute",top:b+window.scrollY,...g?{right:d.clientWidth-l+window.scrollX,left:"auto"}:{right:"auto",left:p+window.scrollX},zIndex:2147483647,width:"min-content"},children:o})},Q=class extends Rt.Component{constructor(...t){super(...t);let o=i.default.get(this.props.input,"deweyPC",!1);this.state={runId:null,deweyPC:o,isPDPEnabled:!o||S("universal_pc_canonical")}}pollingRetriesCount=0;componentWillMount(){this.props.asin?K({asin:i.default.get(this.props,"asin"),originMerchantId:i.default.get(this.props,"originMerchantId"),discount:i.default.get(this.props,"discount"),sellerId:i.default.get(this.props,"sellerId"),product:i.default.get(this.props,"product"),price:i.default.get(this.props,"price"),runCollectionId:i.default.get(this.props,"runCollectionId")}).then(t=>{let o=i.default.get(t,"pricing.updatedPricingRunId");this.setState({runId:o});let e;o!==i.default.get(t.cart,"items[0].id")?this.pollForComplete(o):e=!0,this.setState({error:t.error,cart:t.cart,pricing:t.pricing,product:t.product,fullRunComplete:e})}):this.props.input&&K({product:i.default.get(this.props.input,"product"),gtin:i.default.get(this.props.input,"product.gtin"),unpricedResults:i.default.get(this.props.input,"unpricedResults"),meta:i.default.get(this.props.input,"meta"),deweyPC:this.state.deweyPC}).then(t=>{let o=i.default.get(t,"pricing.updatedPricingRunId");this.setState({runId:o});let e;o!==i.default.get(t.cart,"items[0].id")?this.pollForComplete(o):e=!0,this.setState({error:t.error,cart:t.cart,pricing:t.pricing,product:t.product,fullRunComplete:e})})}componentDidMount(){w("page",`productEstimateAnnotation${this.state.deweyPC?"_runv4":""}`,{view:"productEstimateNotificaton",type:"annotation",searchIndex:this.props.searchIndex}),this.pollingRetriesCount=0,this.isInteractingWithTooltip=!1,this.isInteractingWithSaveButton=!1,this.saveButton.addEventListener("mouseenter",this.onEnterSavingsButton.bind(this)),this.saveButton.addEventListener("mouseleave",this.onLeaveSavingsButton.bind(this));try{document.querySelector("#web .reg").style.setProperty("overflow","visible","important")}catch{}this.props.simulateResize&&window.dispatchEvent(new Event("resize"))}savingsButtonOnClick(t,o,e){return t&&o?this.viewWirelessDevicePage.bind(this,e):t?this.viewProductPage.bind(this,"savingsButton"):()=>{}}getPDPData(){return this.state.deweyPC?i.default.get(this.state.cart,"items[0].universalPCCanonical"):this.state.product}render(){let t=(this.props.waitForFullRun?this.state.fullRunComplete:this.state.cart)||!!this.state.error,o=i.default.get(this.state,"cart.items[0]"),e=i.default.get(this.state,"cart.items[0].results"),_=i.default.get(this.props.input,"unpricedResults[0].vendor"),s=i.default.get(o,"inputData.vendor");t&&this.props.runCompleteCb&&this.props.runCompleteCb(),nt()&&this.state.runId&&w("page","disableNotifPcTest",{quoteId:this.state.runId,view:"productEstimateAnnotation",type:"test"});let g=0,b=[],l=i.default.filter(e,h=>{let P=i.default.get(h,"product.vendorName"),Tt=i.default.get(h,"origin");if(s!=="amazon.com"&&Tt)return!1;if(P==="eBay"&&!i.default.get(h,"meta.paymentsSupport")){if(g<3)return g++,b.push(P),!0}else if(i.default.get(h,"pricing.total")&&b.indexOf(P)===-1&&(b.length<12||i.default.get(h,"product.vendor")===_))return i.default.get(h,"meta.paymentsSupport")||b.push(P),!0}),p=i.default.get(this.state,"cart.items[0].originResult")||i.default.find(e,{origin:!0});if(p){i.default.set(p,"meta.verificationClassifierOutput.verified",!0),i.default.set(p,"origin",!0);let h=i.default.findIndex(l,P=>P.id===p.id);h&&(l[h]=p)}let d=i.default.get(this.state,"cart.items[0].result")||i.default.find(e,{heroOffer:!0}),x=i.default.get(d,"pricing.afterRewardTotal")||i.default.get(d,"pricing.total")||i.default.get(l,"[0].pricing.afterRewardTotal")||i.default.get(l,"[0].pricing.total")||i.default.get(l,"[1].pricing.afterRewardTotal")||i.default.get(l,"[1].pricing.total"),T=i.default.find(l,h=>h&&h.vendor===i.default.get(this.props.input,"unpricedResults[0].vendor")),m;i.default.get(p,"pricing.total")&&(i.default.get(d,"pricing.afterRewardTotal")||i.default.get(d,"pricing.total"))?m=xt(d):T&&(m=i.default.get(T,"pricing.total")-x,m=x&&m>0?m:0);let A=i.default.get(d,"pricing.afterRewardTotal")<i.default.get(this.props,"notification.run.originResult.pricing.total")?i.default.get(d,"pricing.reward.amount"):null,R=E.get("deweyResult")||{},{pageType:z}=R,k=i.default.get(this.props,z==="productPage"?"notification.wirelessPriceComparison":`notification.wirelessPriceComparisonCart.${this.props.asin}`),B=t&&!m&&k&&!!k.ui,St=`${t?`${B||(m||A)&&(l.length>1||l.length&&i.default.get(l,"[0].product.vendor")!==_)?"savings":"no-savings"}`:"searching"}`,Dt=this.state.showSavingsDetails,It=i.default.get(d,"pricing.credits.qualifyToRedeemCredits",!1),Nt=i.default.get(this.getPDPData(),"wbid");return(0,c.jsx)("div",{className:`product-estimate-annotation ${Dt?"tooltip-open":""}`,children:(0,c.jsxs)("div",{className:`savings-button ${St}`,onClick:this.savingsButtonOnClick(t,B,k&&k.link),ref:h=>this.saveButton=h,children:[(0,c.jsx)(q,{}),t?It&&m>0?(0,c.jsx)(_t,{savings:m}):m&&x?(0,c.jsx)(ct,{savings:m,reward:A}):B?(0,c.jsx)(pt,{data:k}):(0,c.jsx)(ut,{productNotFound:!p}):(0,c.jsx)(H,{}),m&&l.length&&this.state.showSavingsDetails?(0,c.jsx)(L,{containerNamespace:N,children:(0,c.jsx)(Ct,{saveButtonDomElem:this.saveButton,showSavingsDetails:()=>this.isInteractingWithTooltip=!0,hideSavingsDetails:this.onLeaveToolTip.bind(this),children:(0,c.jsx)(D,{wbid:Nt,originVendor:this.props.originVendor,view:"productEstimateAnnotation",hideSavingsDetails:()=>{this.isInteractingWithTooltip=!1,this.hideSavingsDetails()},viewProductPage:this.viewProductPage.bind(this),visitMerchant:this.visitMerchant.bind(this),filteredResults:l,searchIndex:this.props.searchIndex,fullRunComplete:this.state.fullRunComplete,run:o,deweyPC:this.state.deweyPC,showViewAllOffers:this.state.isPDPEnabled})})}):B&&this.state.showSavingsDetails?(0,c.jsx)(L,{containerNamespace:N,children:(0,c.jsx)(Ct,{saveButtonDomElem:this.saveButton,showSavingsDetails:()=>this.isInteractingWithTooltip=!0,hideSavingsDetails:this.onLeaveToolTip.bind(this),children:(0,c.jsx)(vt,{annotationType:"wireless",content:k,onDismissAnnotation:()=>this.hideSavingsDetails(),...this.props})})}):null]})})}onEnterSavingsButton(){this.isInteractingWithSaveButton=!0,this.showSavingsDetails()}onLeaveSavingsButton(){this.isInteractingWithSaveButton=!1,this.scheduledHidingSavingsDetails()}onLeaveToolTip(){this.isInteractingWithTooltip=!1,this.scheduledHidingSavingsDetails()}showSavingsDetails(){this.setState({showSavingsDetails:!0})}hideSavingsDetails(){this.setState({showSavingsDetails:!1})}scheduledHidingSavingsDetails(){setTimeout(()=>{this.isInteractingWithTooltip||this.isInteractingWithSaveButton||this.hideSavingsDetails()},500)}viewWirelessDevicePage(t){t&&U(t)}viewProductPage(t){if(!i.default.get(this.state,"isPDPEnabled"))return;let o=this.getPDPData(),e=i.default.get(o,"wbid"),_=i.default.get(o,"url"),s=this.state.useEstimateRun?i.default.get(this.state,"pricing.estimateRunId"):i.default.get(this.state,"pricing.updatedPricingRunId");if(w("trackClick","viewProductPage","",{view:this.props.view,pageLocation:"annotation",productId:e,productUrl:_,label:String(t),searchIndex:this.props.searchIndex}),_&&s){if(!e)return;U(`${F}${_}?extReq=true${s?`&run=${s}`:""}${this.props.originVendor?`&originVendor=${this.props.originVendor}`:""}`)}}visitMerchant(t){let o=this.state.useEstimateRun?i.default.get(this.state,"pricing.estimateRunId"):i.default.get(this.state,"pricing.updatedPricingRunId"),e=i.default.get(t,"id"),_=i.default.get(t,"resultId"),s=i.default.get(t,"meta.paymentsSupport"),g=i.default.get(t,"product.url");if(s)window.open(`${F}/run/${o}/place-order/${e}`),w("trackClick","checkout","",{view:"resultListTooltip",pageLocation:"annotation",matchDomain:i.default.get(t,"product.vendor"),matchUrl:g,matchId:e,resultId:_,quoteId:o,searchIndex:this.props.searchIndex});else{let b="visitMerchant",{clickId:l,redirectId:p}=ht(),d=!!i.default.get(t,"pricing.reward.amount"),x=ot({params:{channel:d?"cashback-ims":"cart",clickEvent:b,destUrl:g,destDomain:i.default.get(t,"product.vendor"),redirectId:p,subExperience:"product_view_offer",vendorMetaId:i.default.get(t,"pricing.reward.id"),runId:o},isWbPublisher:!0});window.open(x),w("track",b,{view:"resultListTooltip",pageLocation:"annotation",matchDomain:i.default.get(t,"product.vendor"),matchUrl:g,matchId:e,resultId:_,quoteId:o,clickId:l,redirectId:p,searchIndex:this.props.searchIndex})}}async pollForComplete(t){if(t&&this.pollingRetriesCount<V){let o=await yt({runId:t});o?(!i.default.get(o,"items[0].originResult.pricing.total")&&i.default.get(o,"items[0].results.length")===1?this.setState({fullRunComplete:!0,useEstimateRun:!0}):this.setState({cart:o,fullRunComplete:!0}),this.pollingRetriesCount=0):(this.pollingRetriesCount+=1,await Pt.default.resolve().delay(2e3),this.pollForComplete(t))}else this.pollingRetriesCount>=V&&this.setState({cart:{items:[]},fullRunComplete:!0})}},Z=at({notification:["notification"]},Q);var it=r(f()),Wt="/offers";function Ot(a){return a.disablePriceRun?a.disablePriceRun():X(tt.default.get(a,"input.product.price")||tt.default.get(a,"price"),a.cutOffPriceForPriceRunsInCents)}function Lt({insertAfterElement:a,additionalClass:t,cssUrl:o,removeExistingApp:e=!1},_={}){if(Ot(_))return;function s(g){return S("show_price_comparison")?(0,it.jsx)(dt,{children:(0,it.jsx)(Z,{...g})}):null}return mt({initialRoute:Wt,cssUrl:o||"offers.css",disableDelay:!0,additionalClass:`__product-estimate-annotation ${t||""}`,app:s(_),insertAfterElement:a,removeExistingApp:e,additionalContent:{namespace:N}},()=>{})}export{X as a,qt as b,Y as c,vt as d,xt as e,G as f,Wt as g,Lt as h};
