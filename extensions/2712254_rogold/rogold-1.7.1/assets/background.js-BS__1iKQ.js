function a(e){try{const o=new URL(e);return["roblox.com","www.roblox.com","fex.to"].includes(o.hostname)}catch{return!1}}try{let e;const o={};chrome.runtime.onMessage.addListener((t,i,n)=>(setTimeout(async()=>{switch(t.greeting){case"GetURL":if(!a(t.url)){n({error:"Invalid URL"});return}fetch(t.url,{credentials:"omit"}).then(r=>{r.json().then(n)}).catch(n);break;case"GetBlob":if(!a(t.info)){n({error:"Invalid URL"});return}fetch(t.info,{headers:{Origin:new URL(t.info).origin}}).then(r=>{r.blob().then(n)}).catch(n);break;case"CreateMenu":chrome.contextMenus.removeAll(()=>{n(chrome.contextMenus.create(t.info))});break;case"EditMenu":n(chrome.contextMenus.update(t.info.id,t.info.update));break;case"GetRates":e?n(e):fetch("https://fex.to/latest.json",{mode:"cors"}).then(r=>{r.text().then(console.log),r.json().then(c=>{e=c.rates,n(c.rates)})}).catch(n);break;case"CacheValue":o[t.info.key]=t.info.value,n(!0);break;case"GetCacheValue":n(o[t.info.key]);break}}),!0)),setInterval(()=>{for(let t in o)o[t].time<Date.now()&&(console.log(`Cache expired for ${t}`),delete o[t])},1e3)}catch(e){console.warn(e)}try{chrome.contextMenus.onClicked.addListener(e=>{if(e.menuItemId=="RoGold-Context"&&e.linkUrl){const o=e.linkUrl.split("/");let t=e.linkUrl.includes("roblox.com")&&e.linkUrl.match(/(\d+)/g)[0]||o[3];chrome.tabs.query({active:!0,currentWindow:!0},i=>{chrome.tabs.sendMessage(i[0].id,{type:"copy",data:t})})}})}catch(e){console.warn(e)}try{chrome.runtime.onUpdateAvailable.addListener(()=>{chrome.runtime.reload()}),chrome.runtime.onInstalled.addListener(async e=>{if(e.reason!="install"){if(e.reason=="update"){const o=chrome.runtime.getManifest().version,t=e.previousVersion;o!=t&&chrome.notifications.create("updateNotification",{type:"basic",iconUrl:chrome.runtime.getURL("icons/grey_128x128.png"),title:"RoGold",message:"RoGold has been updated to version "+chrome.runtime.getManifest().version+"!",priority:2,requireInteraction:!1})}}})}catch(e){console.warn(e)}
