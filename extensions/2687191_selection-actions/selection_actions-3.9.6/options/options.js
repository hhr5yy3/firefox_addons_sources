let userConfigs,importedConfigs,isSafari=!1;const settingsHeaders=[],expandedSettingsSections=[];let exportFileName="selecton-settings.json";var keys=Object.keys(configs);let markersData;function loadSettings(){chrome.storage.local.get(["expandedSettingsSections"],(function(e){null!==e.expandedSettingsSections&&void 0!==e.expandedSettingsSections&&e.expandedSettingsSections.forEach((function(e){expandedSettingsSections.push(e)}))})),String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)}),isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),isSafari&&(document.querySelector("#donateButton").style.display="none",document.querySelector("#showUpdateNotification").parentNode.parentNode.style.display="none"),chrome.storage.local.get(keys,setInputs),setVersionLabel(),setImportExportButtons(),setTimeout((function(){chrome.storage.local.get(["websiteMarkers"],(function(e){setMarkerSection(e)}))}),15)}function setInputs(e){userConfigs=e,keys.forEach((function(t){let n=document.getElementById(t.toString());if(null!=n){if("checkbox"==n.type)null!==e[t]&&1==e[t]||null==e[t]&&1==configs[t]?n.setAttribute("checked",0):n.removeAttribute("checked",0);else if("SELECT"==n.tagName){let o=n.querySelectorAll("option");null!==o&&o.forEach((function(n){let o=e[t]??configs[t];n.value==o&&n.setAttribute("selected",!0);try{""!=chrome.i18n.getMessage(n.innerHTML)?n.innerHTML=chrome.i18n.getMessage(n.innerHTML):""!=chrome.i18n.getMessage(n.value)&&(n.innerHTML=chrome.i18n.getMessage(n.value))}catch(e){}}))}else n.setAttribute("value",e[t]??configs[t]);n.parentNode.innerHTML.includes(chrome.i18n.getMessage(t))||("SELECT"==n.tagName||"excludedDomains"==n.id||"wordSnappingBlacklist"==n.id?n.parentNode.innerHTML=chrome.i18n.getMessage(t)+":   "+n.parentNode.innerHTML:n.parentNode.innerHTML+=chrome.i18n.getMessage(t)),n=document.querySelector("#"+t.toString()),n.addEventListener("input",(function(e){let t=n.getAttribute("id"),o="checkbox"==n.getAttribute("type")?n.checked:n.value;userConfigs[t]=o,saveAllSettings(),updateDisabledOptions()}))}})),document.querySelectorAll("#excludedDomains, #wordSnappingBlacklist").forEach((function(e){e.setAttribute("placeholder","example.com, another.example.com"),e.style.maxWidth="200px"})),setTranslatedLabels(),updateDisabledOptions(),setCurrenciesDropdown(),setTimeout((function(){loadCustomSearchButtons(),setTimeout((function(e){setCollapsibleHeaders()}),100)}),1)}function setImportExportButtons(){const e=document.getElementById("exportName");if(isSafari){e.style.visibility="hidden",e.style.width="1px";let t=document.createElement("span");t.innerText=chrome.i18n.getMessage("fallbackExportLabel"),e.parentNode.prepend(t)}else e.onchange=function(){exportFileName=e.value};document.getElementById("exportSettings").onclick=function(){markersData&&(userConfigs.websiteMarkers=markersData);const e=exportFileName??"selecton-settings.json",t=JSON.stringify(userConfigs||{});if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent))window.open("data:text/plain;charset=utf-8,"+encodeURIComponent(t));else{let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",n.style.position="absolute",document.body.appendChild(n),n.click(),n.remove()}};const t=document.getElementById("importSettings"),n=document.getElementById("importSettingsButton");function o(){n.disabled=!0,n.title=chrome.i18n.getMessage("chooseFileFirst")}o(),importedConfigs=null,t.addEventListener("change",(e=>{const t=new FileReader;t.addEventListener("load",(e=>{const t=e.target.result;importedConfigs=JSON.parse(t),null!=importedConfigs&&void 0!==importedConfigs&&(n.disabled=!1,n.title="")})),t.readAsText(e.target.files[0])})),n.addEventListener("click",(function(){userConfigs=importedConfigs,setInputs(importedConfigs),saveAllSettings();document.getElementById("importSettings").value=null,o();let e=importedConfigs.websiteMarkers;e&&(chrome.storage.local.set({websiteMarkers:e}),setMarkerSection({websiteMarkers:e}))}))}function setTranslatedLabels(){if(document.querySelector("#importSettingsLabel").innerHTML=chrome.i18n.getMessage("importSettingsLabel"),document.querySelector("#exportSettingsLabel").innerHTML=chrome.i18n.getMessage("exportSettingsLabel"),document.querySelector("#exportSettingsNote").innerHTML=chrome.i18n.getMessage("exportSettingsNote"),document.querySelector("#dictionaryButtonRemark").innerHTML=chrome.i18n.getMessage("dictionaryButtonRemark"),document.querySelector("#quoteButtonRemark").innerHTML=chrome.i18n.getMessage("quoteButtonRemark"),document.querySelector("#appearanceHeader").innerHTML+=chrome.i18n.getMessage("appearanceHeader"),document.querySelector("#behaviorHeader").innerHTML+=chrome.i18n.getMessage("behaviorHeader"),document.querySelector("#highlightHeader").innerHTML+=chrome.i18n.getMessage("markersLabel"),document.querySelector("#textFieldsHeader").innerHTML+=chrome.i18n.getMessage("textFieldsHeader"),document.querySelector("#convertionHeader").innerHTML+=chrome.i18n.getMessage("convertionHeader"),document.querySelector("#actionButtonsHeader").innerHTML+=chrome.i18n.getMessage("contextualButtonsHeader"),document.querySelector("#selectionHeader").innerHTML+=chrome.i18n.getMessage("selectionHeader"),document.querySelector("#customSearchTooltip").innerHTML+=chrome.i18n.getMessage("customSearchTooltip"),document.querySelector("#exportImportSettings").innerHTML+=chrome.i18n.getMessage("exportImportSettings"),document.querySelector("#customSearchTooltipHint").innerHTML=chrome.i18n.getMessage("customSearchTooltipHint"),document.querySelector("#customSearchButtonsHeader").innerText=chrome.i18n.getMessage("customSearchButtonsHeader"),document.querySelector("#addActionButtonsForTextFields").parentNode.parentNode.setAttribute("title",chrome.i18n.getMessage("disableForBetterPerformance")),document.querySelector("#liveTranslation").parentNode.parentNode.setAttribute("title",chrome.i18n.getMessage("disableForBetterPerformance")),document.getElementById("recentMarkersLabel").innerText=chrome.i18n.getMessage("recentMarkersLabel"),document.getElementById("testPageButton").innerText=chrome.i18n.getMessage("testPageButton"),isSafari){let e=document.querySelector("#disableWordSnappingOnCtrlKey");e.parentNode.innerHTML=e.parentNode.innerHTML.replaceAll("CTRL","⌘cmd")}let e=document.querySelector("#allChangesSavedAutomaticallyHeader");e.innerHTML=chrome.i18n.getMessage("allChangesSavedAutomatically"),e.innerHTML+=".<br />",e.innerHTML+=chrome.i18n.getMessage("updatePageToSeeChanges"),document.querySelector("#writeAReviewButton").innerHTML=chrome.i18n.getMessage("writeAReview")+document.querySelector("#writeAReviewButton").innerHTML,document.querySelector("#githubButton").innerHTML=chrome.i18n.getMessage("visitGithub")+document.querySelector("#githubButton").innerHTML,document.querySelector("#donateButton").innerHTML=chrome.i18n.getMessage("buyMeCoffee")+document.querySelector("#donateButton").innerHTML,document.querySelector("#exportSettings").innerHTML=chrome.i18n.getMessage("export"),document.querySelector("#importSettingsButton").innerHTML=chrome.i18n.getMessage("import")}function setVersionLabel(){let e=document.getElementById("selecton-version");var t=chrome.runtime.getManifest();e.innerHTML="Selecton "+t.version+` (<a target='_blank' href='https://github.com/emvaized/selecton-extension/blob/master/CHANGELOG.md'>${chrome.i18n.getMessage("whatsNew")??"What's new"}</a>)`}function updateDisabledOptions(){document.getElementById("all-options-container").className=document.getElementById("enabled").checked?"enabled-option":"disabled-option",document.getElementById("convertToCurrencyDropdown").parentNode.className=document.getElementById("convertCurrencies").checked?"enabled-option":"disabled-option",document.getElementById("preferredMetricsSystem").parentNode.className=document.getElementById("convertMetrics").checked?"enabled-option":"disabled-option",document.getElementById("languageToTranslate").parentNode.className=document.getElementById("showTranslateButton").checked?"enabled-option":"disabled-option",document.getElementById("customStylesSection").className=document.getElementById("useCustomStyle").checked?"enabled-option":"disabled-option",document.getElementById("fullOpacityOnHover").parentNode.className=document.getElementById("tooltipOpacity").value<1?"enabled-option":"disabled-option",document.getElementById("shadowOpacity").parentNode.className=document.getElementById("addTooltipShadow").checked?"enabled-option":"disabled-option",document.getElementById("textSelectionBackground").parentNode.className=document.getElementById("changeTextSelectionColor").checked?"enabled-option":"disabled-option",document.getElementById("textSelectionColor").parentNode.className=document.getElementById("changeTextSelectionColor").checked?"enabled-option":"disabled-option",document.getElementById("textSelectionBackgroundOpacity").parentNode.className=document.getElementById("changeTextSelectionColor").checked?"enabled-option":"disabled-option",document.getElementById("shouldOverrideWebsiteSelectionColor").parentNode.className=document.getElementById("changeTextSelectionColor").checked?"enabled-option":"disabled-option",document.getElementById("preferredNewEmailMethod").parentNode.className=document.getElementById("showEmailButton").checked?"enabled-option":"disabled-option",document.getElementById("preferredMapsService").parentNode.className=document.getElementById("showOnMapButtonEnabled").checked?"enabled-option":"disabled-option",document.getElementById("secondaryTooltipIconSize").parentNode.className=document.getElementById("secondaryTooltipEnabled").checked?"enabled-option":"disabled-option",document.getElementById("showSecondaryTooltipTitleOnHover").parentNode.className=document.getElementById("secondaryTooltipEnabled").checked?"enabled-option":"disabled-option",document.getElementById("preferCurrencySymbol").parentNode.className=document.getElementById("convertCurrencies").checked?"enabled-option":"disabled-option",document.getElementById("disableWordSnappingOnCtrlKey").parentNode.className=document.getElementById("snapSelectionToWord").checked?"enabled-option":"disabled-option",document.getElementById("secondaryTooltipLayout").parentNode.className=document.getElementById("secondaryTooltipEnabled").checked?"enabled-option":"disabled-option",document.getElementById("wordSnappingBlacklist").parentNode.className=document.getElementById("snapSelectionToWord").checked?"enabled-option":"disabled-option",document.getElementById("disableWordSnapForCode").parentNode.className=document.getElementById("snapSelectionToWord").checked?"enabled-option":"disabled-option",document.getElementById("addPasteOnlyEmptyField").parentNode.className=document.getElementById("addPasteButton").checked&&document.getElementById("addActionButtonsForTextFields").checked?"enabled-option":"disabled-option",document.getElementById("addFontFormatButtons").parentNode.className=document.getElementById("addActionButtonsForTextFields").checked?"enabled-option":"disabled-option",document.getElementById("liveTranslation").parentNode.className=document.getElementById("showTranslateButton").checked?"enabled-option":"disabled-option",document.getElementById("hideTranslateButtonForUserLanguage").parentNode.className=document.getElementById("showTranslateButton").checked?"enabled-option":"disabled-option",document.getElementById("showTranslateIfLanguageUnknown").parentNode.className=document.getElementById("showTranslateButton").checked&&document.getElementById("hideTranslateButtonForUserLanguage").checked?"enabled-option":"disabled-option",document.getElementById("addPasteButton").parentNode.className=document.getElementById("addActionButtonsForTextFields").checked?"enabled-option":"disabled-option",document.getElementById("updateRatesEveryDays").parentNode.className=document.getElementById("convertCurrencies").checked?"enabled-option":"disabled-option",document.getElementById("preferredTranslateService").parentNode.className=document.getElementById("showTranslateButton").checked?"enabled-option":"disabled-option",document.getElementById("customSearchButtonsContainer").className=document.getElementById("secondaryTooltipEnabled").checked?"enabled-option":"disabled-option",document.getElementById("dictionaryButtonWordsAmount").parentNode.className=document.getElementById("showDictionaryButton").checked?"enabled-option":"disabled-option",document.getElementById("dictionaryButtonResponseCharsAmount").parentNode.className=document.getElementById("showDictionaryButton").checked?"enabled-option":"disabled-option",document.getElementById("maxTooltipButtonsToShow").parentNode.className=document.getElementById("collapseButtons").checked?"enabled-option":"disabled-option",document.getElementById("correctTooltipPositionByMoreButtonWidth").parentNode.className=document.getElementById("collapseButtons").checked?"enabled-option":"disabled-option",document.getElementById("correctTooltipPositionByMoreButtonWidth").parentNode.className=document.getElementById("collapseAsSecondPanel").checked?"disabled-option":"enabled-option",document.getElementById("collapseAsSecondPanel").parentNode.className=document.getElementById("collapseButtons").checked?"enabled-option":"disabled-option",document.getElementById("addClearButton").parentNode.className=!document.getElementById("addPasteOnlyEmptyField").checked&&document.getElementById("addPasteButton").checked&&document.getElementById("addActionButtonsForTextFields").checked?"enabled-option":"disabled-option",document.getElementById("hideTooltipWhenCursorMovesAway").parentNode.className="overCursor"==document.getElementById("tooltipPosition").value?"enabled-option":"disabled-option",document.getElementById("dragHandleStyle").parentNode.className=document.getElementById("addDragHandles").checked?"enabled-option":"disabled-option",document.getElementById("floatingOffscreenTooltip").parentNode.className=document.getElementById("recreateTooltipAfterScroll").checked?"enabled-option":"disabled-option",document.getElementById("customSearchUrl").parentNode.parentNode.className="custom"==document.getElementById("preferredSearchEngine").value?"option visible-option":"option hidden-option",document.getElementById("showButtonLabelOnHover").parentNode.parentNode.className="onlyicon"==document.getElementById("buttonsStyle").value?"option visible-option":"option hidden-option",document.getElementById("tooltipInvertedBackground").parentNode.parentNode.className=document.getElementById("invertColorOnDarkWebsite").checked?"option visible-option":"option hidden-option",document.getElementById("showSecondaryTooltipTitleOnHover").parentNode.parentNode.className="verticalLayout"==document.getElementById("secondaryTooltipLayout").value?"hidden-option":"option visible-option",document.getElementById("maxIconsInRow").parentNode.parentNode.className="verticalLayout"==document.getElementById("secondaryTooltipLayout").value?"hidden-option":"option visible-option",document.getElementById("hoverSearchPanelOptions").className="panelCustomSearchStyle"==document.getElementById("customSearchOptionsDisplay").value?"hidden-option":"visible-option",chrome.i18n.detectLanguage||(document.getElementById("hideTranslateButtonForUserLanguage").parentNode.parentNode.className="hidden-option",document.getElementById("showTranslateIfLanguageUnknown").parentNode.parentNode.className="hidden-option")}function setCollapsibleHeaders(){let e=document.getElementsByClassName("collapsible-header");for(let t=0,n=e.length;t<n;t++){const n=e[t];if(expandedSettingsSections.includes(n.id)){const n=e[t];n.classList.toggle("active");let o=n.nextElementSibling;o.style.maxHeight=o.scrollHeight+"px"}n.onclick=function(){this.classList.toggle("active");let e=this.nextElementSibling;if(e.style.maxHeight){e.style.maxHeight=null;let t=expandedSettingsSections.indexOf(this.id);t>-1&&expandedSettingsSections.splice(t,1)}else e.style.maxHeight=e.scrollHeight+"px",expandedSettingsSections.includes(this.id)||expandedSettingsSections.push(this.id);saveExpandedSections()}}}function setCurrenciesDropdown(){chrome.storage.local.get(["convertToCurrency"],(function(e){let t=e.convertToCurrency||"USD",n=document.getElementById("convertToCurrencyDropdown");Object.keys(currenciesList).forEach((function(e){let o=document.createElement("option"),i=currenciesList[e].currencySymbol;o.innerHTML=e+(null==i?"":` (${i})`)+" — "+currenciesList[e].currencyName,o.setAttribute("value",e),n.appendChild(o),o.value==t&&o.setAttribute("selected",!0)})),n.parentNode.innerHTML=chrome.i18n.getMessage("convertToCurrency")+"<br />"+n.parentNode.innerHTML,setTimeout((function(){document.getElementById("convertToCurrencyDropdown").addEventListener("input",(function(e){let t=document.getElementById("convertToCurrencyDropdown");chrome.storage.local.set({convertToCurrency:t.value.split(" — ")[0]})}))}),300)}))}var customSearchButtonsList;function loadCustomSearchButtons(){chrome.storage.local.get(["customSearchButtons"],(function(e){customSearchButtonsList=e.customSearchButtons??configs.customSearchButtons,generateCustomSearchButtonsList()}))}function generateCustomSearchButtonsList(){var e=document.getElementById("customSearchButtonsContainer");e.innerHTML="";for(var t=0;t<customSearchButtonsList.length;t++){var n=customSearchButtonsList[t];let l=document.createElement("div");l.setAttribute("class","option"),l.setAttribute("style","margin: 8px 0px;"),0==n.enabled?l.style.opacity=.7:l.style.opacity=1;let u=document.createElement("input");u.setAttribute("type","checkbox"),u.setAttribute("title","On/off"),u.setAttribute("style","pointer: cursor; vertical-align: middle !important;"),u.value=n.enabled,n.enabled?u.setAttribute("checked",0):u.removeAttribute("checked",0),u.setAttribute("id","checkbox"+t.toString()),u.addEventListener("input",(function(e){customSearchButtonsList[parseInt(this.id.replaceAll("checkbox",""))].enabled=this.checked,saveCustomSearchButtons(),this.checked?l.style.opacity=1:l.style.opacity=.7})),l.appendChild(u);let m=document.createElement("img"),p=n.icon;m.setAttribute("src",null!=p&&""!==p?p:"https://www.google.com/s2/favicons?domain="+n.url.split("/")[2]),m.setAttribute("width","18px"),m.setAttribute("height","18px"),m.setAttribute("style","margin-left: 3px; padding: 1px; vertical-align: middle !important;"),l.appendChild(m);let g=document.createElement("input");g.setAttribute("type","text"),g.setAttribute("placeholder","Title"),g.setAttribute("style","margin-left: 3px; min-width: 100px; margin-bottom: 3px; display: inline;"),g.value=n.title,g.setAttribute("id","title"+t.toString()),g.addEventListener("input",(function(e){customSearchButtonsList[parseInt(this.id.replaceAll("title",""))].title=this.value,saveCustomSearchButtons()})),l.appendChild(g);let h=document.createElement("input");h.setAttribute("type","checkbox"),h.setAttribute("id","useCustomIcon"+t.toString()),0==(null!==n.icon&&void 0!==n.icon)&&h.setAttribute("checked",0);let y=document.createElement("label");y.appendChild(h),setTimeout((function(){y.addEventListener("change",(function(e){let t=customSearchButtonsList[parseInt(this.firstChild.id.replaceAll("useCustomIcon",""))].icon;customSearchButtonsList[parseInt(this.firstChild.id.replaceAll("useCustomIcon",""))].icon=null!=t?null:"",saveCustomSearchButtons(),generateCustomSearchButtonsList()}))}),1),y.innerHTML+=chrome.i18n.getMessage("useIconFromGoogle"),y.setAttribute("style","padding-right: 3px; display: inline; float: right; max-width: 60%;"),l.appendChild(y);let b=document.createElement("div");var o=document.createElement("input");if(o.setAttribute("type","text"),o.setAttribute("placeholder","URL"),o.setAttribute("title","URL"),o.setAttribute("class","custom-search-option-url-input"),o.value=n.url,o.setAttribute("id","url"+t.toString()),o.addEventListener("input",(function(e){customSearchButtonsList[parseInt(this.id.replaceAll("url",""))].url=this.value,saveCustomSearchButtons()})),b.appendChild(o),l.appendChild(b),null!==n.icon&&void 0!==n.icon){var i=document.createElement("div"),a=document.createElement("input");a.setAttribute("type","text"),a.setAttribute("placeholder",chrome.i18n.getMessage("customIconUrl")),a.setAttribute("class","custom-search-option-icon-input"),a.setAttribute("title",chrome.i18n.getMessage("customIconUrl")),a.setAttribute("id","icon"+t.toString()),a.value=n.icon,a.addEventListener("input",(function(e){customSearchButtonsList[parseInt(this.id.replaceAll("icon",""))].icon=this.value,saveCustomSearchButtons(),generateCustomSearchButtonsList()})),i.appendChild(a),l.appendChild(i)}var s=document.createElement("div");s.setAttribute("style"," display: inline;");var d=document.createElement("button");d.textContent="ᐱ",d.setAttribute("id","moveup"+t.toString()),d.className="custom-search-option-move-button",d.setAttribute("title",chrome.i18n.getMessage("moveUpLabel")),d.onmouseup=function(){var e=parseInt(this.id.replaceAll("moveup",""),10);if(e>0){var t=customSearchButtonsList[e];customSearchButtonsList.splice(e,1),customSearchButtonsList.splice(e-1,0,t),saveCustomSearchButtons(),generateCustomSearchButtonsList()}};var r=document.createElement("button");r.textContent="ᐯ",r.setAttribute("id","movedown"+t.toString()),r.className="custom-search-option-move-button",r.setAttribute("title",chrome.i18n.getMessage("moveDownLabel")),r.onmouseup=function(){var e=parseInt(this.id.replaceAll("movedown",""),10);if(e<customSearchButtonsList.length){var t=customSearchButtonsList[e];customSearchButtonsList.splice(e,1),customSearchButtonsList.splice(e+1,0,t),saveCustomSearchButtons(),generateCustomSearchButtonsList()}},s.appendChild(d),s.appendChild(r),l.appendChild(s);var c=document.createElement("button");c.textContent=chrome.i18n.getMessage("deleteLabel"),c.setAttribute("style"," float: right;display: inline-block; max-width: 100px;"),c.setAttribute("id","delete"+t.toString()),c.onmouseup=function(){var e=parseInt(this.id.replaceAll("delete",""));null!==customSearchButtonsList[e]&&void 0!==customSearchButtonsList[e]&&(customSearchButtonsList.splice(parseInt(this.id.replaceAll("delete",""),10),1),saveCustomSearchButtons(),generateCustomSearchButtonsList())},l.appendChild(c),e.appendChild(l)}var l=document.createElement("button");l.textContent=chrome.i18n.getMessage("addNewSearchOption")+" ＋",l.setAttribute("style","max-width: 99%;"),l.onmouseup=function(){customSearchButtonsList.push({url:"",title:"",enabled:!0}),saveCustomSearchButtons(),generateCustomSearchButtonsList();let e=document.getElementById("customSearchTooltip").nextElementSibling;e.style.maxHeight=e.scrollHeight+"px"},e.appendChild(l)}function saveCustomSearchButtons(){chrome.storage.local.set({customSearchButtons:customSearchButtonsList})}function saveExpandedSections(){chrome.storage.local.set({expandedSettingsSections})}function saveAllSettings(){chrome.storage.local.set(userConfigs)}const expandedMarkerSections=[];function setMarkerSection(e){if(!e)return;let t=document.getElementById("website-markers-list");if(markersData=e.websiteMarkers,!markersData)return;let n=Object.keys(markersData);markersData&&0!=n.length?(t.innerText=null,n.sort((function(e,t){return e.timeUpdated>t.timeUpdated?1:-1})),n.forEach((function(e){let n=document.createElement("div");n.className="option marker-website-tile";let o=document.createElement("img");o.className="marker-website-favicon",o.height="15px",o.width="15px",o.src="https://www.google.com/s2/favicons?domain="+e.split("/")[2],n.appendChild(o);let i=document.createElement("span"),a=markersData[e].title;i.innerText=a??e,a&&(i.title=e),n.appendChild(i),t.appendChild(n),expandedMarkerSections.includes(e)&&setTimeout((function(){let e=n.nextElementSibling;e.style.maxHeight=e.scrollHeight+"px"}),50);let s=document.createElement("div");s.className="collapsible-content",s.style.marginLeft="20px",s.style.marginBottom="10px";let d=markersData[e].markers,r=document.createElement("div");r.className="markers-counter-circle",r.textContent=d.length,n.appendChild(r),d.sort((function(e,t){return e.dateAdded>t.dateAdded?-1:1}));for(let n=0,o=d.length;n<o;n++){const i=d[n],a=document.createElement("div");a.className="option marker-tile";const r=document.createElement("div");r.setAttribute("class","marker-color-preview"),r.style.background=i.background,a.appendChild(r),a.innerHTML+=i.text,i.timeAdded&&(a.title=new Date(i.timeAdded).toLocaleString());let c=document.createElement("div");c.className="marker-highlight-delete",c.innerText="✕",c.title=chrome.i18n.getMessage("deleteLabel"),a.appendChild(c),c.onclick=async function(n){n.stopPropagation();const o=d.indexOf(i);o>-1&&d.splice(o,1),markersData[e].markers=d,d.length<=0&&delete markersData[e];try{chrome.storage.local.set({websiteMarkers:markersData})}catch(n){alert(n)}setTimeout((function(){t.innerHTML="",setMarkerSection({websiteMarkers:markersData})}),5)},s.appendChild(a),n!==o-1&&s.appendChild(document.createElement("hr")),a.onclick=function(){chrome.tabs.create({url:e,active:!0},(async e=>{let t,n=!1;function o(a,s){"complete"===s.status&&a===e.id&&(chrome.tabs.onUpdated.removeListener(o),n=!0,clearTimeout(t),chrome.tabs.sendMessage(a,{command:"selecton-scroll-to-marker-message:"+i.hintDy.toString()}).then((e=>{})).catch((e=>{})))}chrome.tabs.onUpdated.addListener(o),t=setTimeout((function(){n||chrome.tabs.onUpdated.removeListener(o)}),5e3)}))}}t.appendChild(s),n.onclick=function(){let t=s;if(t.style.maxHeight){t.style.maxHeight=null;let n=expandedMarkerSections.indexOf(e);n>-1&&expandedMarkerSections.splice(n,1)}else expandedMarkerSections.includes(e)||expandedMarkerSections.push(e),t.style.maxHeight=t.scrollHeight+"px",setTimeout((function(){n.parentNode.parentNode.style.maxHeight=n.parentNode.parentNode.scrollHeight+"px"}),201)}}))):t.innerText="—"}document.addEventListener("DOMContentLoaded",loadSettings),document.querySelector("#donateButton").addEventListener("click",(function(e){window.open("https://github.com/emvaized/selecton-extension?tab=readme-ov-file#donate","_blank")})),document.querySelector("#githubButton").addEventListener("click",(function(e){window.open("https://github.com/emvaized/selecton-extension","_blank")})),document.querySelector("#writeAReviewButton").addEventListener("click",(function(e){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent))return void window.open("mailto:maximtsyba@gmail.com");let t=navigator.userAgent.indexOf("Firefox")>-1;window.open(t?"https://addons.mozilla.org/firefox/addon/selection-actions/":"https://chrome.google.com/webstore/detail/selecton/pemdbnndbdpbelmfcddaihdihdfmnadi/reviews","_blank")})),document.querySelector("#testPageButton").addEventListener("click",(function(e){window.open(chrome.runtime.getURL("options/test-page.html"))}));