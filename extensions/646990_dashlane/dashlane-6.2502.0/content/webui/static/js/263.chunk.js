"use strict";(this.webpackChunk_dashlane_webcards=this.webpackChunk_dashlane_webcards||[]).push([[263],{4263:(e,t,a)=>{a.r(t),a.d(t,{App:()=>w,DASHLANE_DARK_THEME_KEY:()=>p});var n=a(6832),s=a(74),r=a(7970),l=a(1432);const c=new Set(["en","fr","es","ja","de","pt","it","ko","zh","nl","sv"]);function u(e){return e.substr(0,2)}function o(e){const t=u(e);return c.has(t)}var d=a(2498),i=a(3928),g=a(1368),m=a(5698),b=a(7113),f=a(5855),E=a(2606);const p="ds.enableDarkTheme",h=({children:e})=>{const[,t]=(0,r.If)();return n.useLayoutEffect((()=>{const e=window.localStorage.getItem(p);t("true"===e?"dark":"light")}),[t]),n.createElement(n.Fragment,null,e)},w=({utils:e,MainComponent:t})=>{var a;const[c,p]=n.useState(null),[w,S]=n.useState(null),[F,k]=n.useState((()=>()=>{})),[W,v]=n.useState((()=>()=>{})),[y,A]=n.useState(null!=(a=e.getFromUrl().features)?a:{}),I=n.useMemo((()=>e.getFromUrl().langCode||function(){const e=[navigator.language].concat(navigator.languages).find(o);return e?e.includes("-")?u(e):e:"en"}()),[e]),[_,C]=(e=>{const[t,a]=n.useState(),[s]=n.useState({});return n.useEffect((()=>{a(e.connectToAutofillEngine((new d.Ps).getBrowserApi(),s,i.vq.Webcards,((t,a)=>{e.log(`[AutofillEngine] ${t}\n${JSON.stringify(a,null,2)}`)})))}),[s,e]),[t,e=>{Object.keys(e).forEach((t=>{s[t]&&delete s[t],s[t]=e[t]}))}]})(e),D=(e=>{const[t,a]=n.useState();return n.useEffect((()=>{a(e.connectToDispatcher((new d.Ps).getBrowserApi(),i.vq.Webcards))}),[e]),t})(e),M=n.useCallback((async()=>{const t=e.getFromUrl().token;if(D&&t){const e=await D.sendMessage({message:l._.GetWebcardInitialData,targetFrameId:0},t);e&&S((t=>{var a;return{...e,sandboxKey:(null!=(a=t?.sandboxKey)?a:0)+1}}))}}),[_,D,e]);return n.useEffect((()=>{const t=e.getFromUrl().token;D&&t&&(M(),k((()=>e=>D.sendMessage({message:l._.UpdateWebcardGeometry,targetFrameId:0},t,e).then((e=>{e&&(p(Number(e)),D.sendMessage({message:l._.WebcardOpened}))})))),v((()=>e=>{D.sendMessage({message:l._.WebcardClosed,targetFrameId:0},t,e),_?.webcardClosed(t)})),C({updateUserFeatureFlips:e=>{A(null!=e?e:{})}}),_?.getUserFeatureFlips())}),[_,D,e]),w&&_&&D?(C({updateWebcard:e=>{e.webcardId===w.webcardId&&S({...e,sandboxKey:w.sandboxKey})},closeWebcard:e=>{e===w.webcardId&&W()},updateDomainAnalysisStatus:e=>{e||W()}}),n.createElement(s.f6W,{theme:(0,r.It)(r.uH,s.uHP)},n.createElement(r.SG,null,n.createElement(h,null,n.createElement(b.q6,{langCode:I},n.createElement(E.f,{autofillEngineCommands:_,autofillEngineDispatcher:D,setAutofillEngineActionsHandlers:C},n.createElement(g.J,{featureFlips:y},n.createElement(f.Z9,{timeToWebcard:c},n.createElement(m.k.Provider,{value:{sendWebcardGeometry:F}},n.createElement(t,{utils:e,data:w,closeWebcard:W,getInitState:M})))))))))):null}}}]);