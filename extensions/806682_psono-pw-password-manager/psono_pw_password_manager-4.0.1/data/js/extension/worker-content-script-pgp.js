var ClassWorkerContentScriptPGP=function(e,t,n){"use strict";function o(e){return btoa(unescape(encodeURIComponent(e)))}function r(e){return decodeURIComponent(escape(atob(e)))}const i=[{name:"gmail",domain_filter:function(){return"mail.google.com"===window.location.host.toLowerCase()},getPgpContent:function(e){let t=e.parentNode;t.textContent.includes("-----END PGP MESSAGE-----")||(t=t.parentNode);let n=t.innerHTML;return n.replace(/<\/(div|p)>/g,"\n").replace(/<br>/g,"\n").replace(/<(.+?)>/g,"")},getSender:function(e){return""},getReceiver:function(e){return[]},getContentEditableFields:function(){const e=document.querySelectorAll('textarea, [contenteditable="true"]');return Array.from(e).filter((function(e){return e.offsetWidth>0&&e.offsetHeight>0}))}},{name:"livecom",domain_filter:function(){return"outlook.live.com"===window.location.host.toLowerCase()},getPgpContent:function(e){return e.parentNode.textContent},getSender:function(e){return""},getReceiver:function(e){return[]},getContentEditableFields:function(){const e=document.querySelectorAll('textarea, [contenteditable="true"]');return Array.from(e).filter((function(e){return e.offsetWidth>0&&e.offsetHeight>0}))}},{name:"outlookoffice365com",domain_filter:function(){return"outlook.office365.com"===window.location.host.toLowerCase()},getPgpContent:function(e){return e.parentNode.textContent},getSender:function(e){return""},getReceiver:function(e){return[]},getContentEditableFields:function(){const e=document.querySelectorAll('textarea, [contenteditable="true"]');return Array.from(e).filter((function(e){return e.offsetWidth>0&&e.offsetHeight>0}))}},{name:"yahoo",domain_filter:function(){return"mail.yahoo.com"===window.location.host.toLowerCase()},getPgpContent:function(e){return e.parentNode.textContent},getSender:function(e){return""},getReceiver:function(e){return[]},getContentEditableFields:function(){const e=document.querySelectorAll('textarea, [contenteditable="true"]');return Array.from(e).filter((function(e){return e.offsetWidth>0&&e.offsetHeight>0}))}}];function c(e){!function(e){const n=a("PGP MESSAGE");if(null===n)return;const i=e.createTreeWalker(e.body,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return e.textContent.includes("-----BEGIN PGP MESSAGE")&&!e.parentNode.classList.contains("psono-add_pgp_message_readers-covered")&&((t=e.parentNode).offsetWidth||t.offsetHeight||t.getClientRects().length)&&!u(e,"[contenteditable]")&&!u(e,"textarea")?(e.parentNode.classList.add("psono-add_pgp_message_readers-covered"),NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_REJECT;var t}});for(;i.nextNode();){var c=i.currentNode,s=n.getPgpContent(c),d=n.getSender(c),l=o(s),f=o(d),g="psono_pgp_reader-"+uuid.v4(),p=e.createElement("div");p.className="psono-pgp-link yui3-cssreset",p.innerHTML='<div style="max-width: 150px">    <img class="'+g+'" width="100%" data-pgp-content="'+l+'" data-pgp-sender="'+f+'" src="'+t.runtime.getURL("data/img/psono-decrypt.png")+'"></div>';var C=c.parentElement.closest("div");if(C){C.insertBefore(p,C.firstChild);var v=C.getElementsByClassName(g)[0];v&&v.addEventListener("click",(function(){m(r(this.getAttribute("data-pgp-content")),r(this.getAttribute("data-pgp-sender")))}))}}}(e),function(e){const t=a("");if(null===t)return;const n=t.getContentEditableFields();for(let e=0;e<n.length;++e)n[e].classList.contains("psono-add_pgp_message_writers-covered")||s(t,n[e])}()}function a(e){for(let e=0;e<i.length;e++)if(i[e].hasOwnProperty("domain_filter")&&i[e].domain_filter())return i[e];return null}function u(e,t){for(;e.parentElement;){if(e.parentElement.matches(t))return!0;e=e.parentElement}return!1}function s(n,o){o.classList.add("psono-add_pgp_message_writers-covered"),e.modifyInputField(o,t.runtime.getURL("data/img/psono-encrypt.png"),"top right",{node:o,getReceiver:n.getReceiver},d,f,g,p)}function d(t,n,o,r){if(l(t,n)<30&&l(t,n)>0){!function(t,n){e.emit("encrypt-gpg",{receiver:n},(function(e){t.is('[contenteditable="true"]')?t.append("<pre>"+e.message+"<pre/>"):t.val(e.message+"\n"+t.val())}))}(o.node,o.getReceiver(o.node))}}function l(e,t){const n=t.getBoundingClientRect(),o=n.left,r=n.top,i=t.offsetWidth-e.pageX+o+(document.documentElement.scrollLeft||document.body.scrollLeft);return r-e.pageY>-27&&i<51?1:0}function f(e,t){}function g(e,t){}function p(e,t){l(e,t)<30&&l(e,t)>0?e.target.style.cursor="pointer":e.target.style.cursor="auto"}function m(t,n){e.emit("decrypt-gpg",{message:t,sender:n})}e.ready((function(){!function(){if(e.inIframe())return;e.registerObserver(c)}()}))};