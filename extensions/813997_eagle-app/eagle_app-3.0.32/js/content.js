"use strict";(async()=>{function e(){$("[eagle-extension]").attr("eagle-extension-theme",eagle.preference.displayTheme),$("[eagle-extension]").attr("eagle-extension-locale",eagle.preference.getPreferredLocale()),$("[eagle-extension]").attr("eagle-extension-os",eagle.env.os.name),$("[eagle-extension]").attr("eagle-browser",eagle.env.browser.name),eagle.collectWindow.updateTheme()}await eagle.env.isDOMReady(),await eagle.preference.init(),e(),await eagle.i18n.init(),await eagle.shortcuts.init(),new DragSaver({onDrop:async e=>{var{folderID:e,extendTags:t,element:a}=e,l=await eagle.elementInspector.getMeta(a,{parseBase64:!0}),n=eagle.siteParser.getMeta();const{url:i,largeUrl:o}=await eagle.urlEnlarger.enlarge(l.src);l.src=o||i;let g={...n,...l,extendTags:t,behavior:"drag"};if(eagle.env.shouldShowNewCollectWindow(e)){n=await eagle.utils.getElementDimensions(a),eagle.collectWindow.open({type:eagle.utils.determineMediaType(a),width:n.width,height:n.height,src:l.src,title:l.title,annotation:l.annotation,tags:l.tags,onCollect:e=>{eagle.item.addFile({...g,...e})}});const o=(await eagle.urlEnlarger.enlargeWithoutCheckEagleHasAbility(l.src)).largeUrl;o?({width:t,height:a}=await eagle.utils.getURLDimensions(o),eagle.collectWindow.updateResolution(t,a)):eagle.collectWindow.updateResolution(n.width,n.height)}else e&&("choose"===e?g.forceOpenCollectModal=!0:(g.forceHideCollectModal=!0,g.folderID=e)),eagle.item.addFile(g)}}),new ContextSaver({onSave:async e=>{var t=await eagle.elementInspector.getMeta(e,{parseBase64:!0}),a=eagle.siteParser.getMeta();const{url:l,largeUrl:n}=await eagle.urlEnlarger.enlarge(t.src);t.src=n||l;let i={...a,...t,behavior:"context"};if(eagle.env.shouldShowNewCollectWindow()){a=await eagle.utils.getElementDimensions(e),eagle.collectWindow.open({type:eagle.utils.determineMediaType(e),width:a.width,height:a.height,src:t.src,title:t.title,annotation:t.annotation,tags:t.tags,onCollect:e=>{eagle.item.addFile({...i,...e})}});const n=(await eagle.urlEnlarger.enlargeWithoutCheckEagleHasAbility(t.src)).largeUrl;n?({width:e,height:t}=await eagle.utils.getURLDimensions(n),eagle.collectWindow.updateResolution(e,t)):eagle.collectWindow.updateResolution(a.width,a.height)}else eagle.item.addFile(i)}}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({})=>{e()}),eagle.preference.changed(()=>{e()}),eagle.env.isChrome&&(window.dispatchEvent(new CustomEvent("CheckEagleExtensionEvent")),window.addEventListener("CheckEagleExtensionEvent",function(e){eagle.dialog.showMultipleEagleExtensionRunningDialog()}))})();