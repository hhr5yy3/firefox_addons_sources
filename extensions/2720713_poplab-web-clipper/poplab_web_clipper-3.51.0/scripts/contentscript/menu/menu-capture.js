(()=>{"use strict";var e={4056:(e,t,i)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.maxResolution=t.handledVideosPlatform=t.url_belin_api_resources=t.url_belin_api=t.url_belin_resources=t.url_belin=t.url_labo=t.url_frigo=t.url_auth=t.url_keycloack=t.url_api=t.base_url_front=t.VERSION=void 0,i(7505),i(872),i(7466),i(3848);const n=i(7260);let s;i(3734),s=n.config,t.VERSION=null!==(r=s.VERSION)&&void 0!==r?r:"3.50.1",t.base_url_front=s.base_url_front,t.url_api=s.url_api,t.url_keycloack=s.url_keycloack,t.url_auth=t.url_keycloack+"/realms/lde-poplab/protocol/openid-connect",t.url_frigo=t.base_url_front+"/frigo",t.url_labo=t.base_url_front+"/labo/mes-documents",t.url_belin="https://manuelnumeriquemax.belin.education/",t.url_belin_resources="https://resources.manuelnumeriquemax.belin.education/",t.url_belin_api="https://api.manuelnumeriquemax.belin.education/main/v1/nodes/",t.url_belin_api_resources="https://api.manuelnumeriquemax.belin.education/main/v1/resources",t.handledVideosPlatform=["youtube.com/watch","youtube.com/embed","youtu.be/","vimeo.com/","dailymotion.com/"],t.maxResolution=49e6},7466:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.integration-its.poplab.education",url_api:"https://app.integration-its.poplab.education/api",url_keycloack:"https://id.integration-its.poplab.education"}},7505:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"http://localhost:8000",url_api:"http://localhost:8082/api",url_keycloack:"http://auth.poplab.local"}},3848:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.preprod-its.poplab.education",url_api:"https://app.preprod-its.poplab.education/api",url_keycloack:"https://id.preprod-its.poplab.education"}},7260:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.poplab.education",url_api:"https://app.poplab.education/api",url_keycloack:"https://auth.poplab.education"}},872:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.sandbox.poplab.education",url_api:"https://app.sandbox.poplab.education/api",url_keycloack:"https://id.sandbox.poplab.education"}},3734:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={VERSION:"TEST",base_url_front:"https://app.sandbox.poplab.education",url_api:"https://app.sandbox.poplab.education/api",url_keycloack:"https://id.sandbox.poplab.education"}},9040:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getBelinPageResponse=t.getBelinToken=t.TypeFichierBelin=void 0;const n=i(4056);var s;function o(){const e=window.localStorage.getItem("edulibToken-undefined");return null!=e?JSON.parse(e).tokens.access_token:null}!function(e){e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.URL="URL",e.HTML="HTML",e.PDF="PDF"}(s||(t.TypeFichierBelin=s={})),t.getBelinToken=o,t.getBelinPageResponse=function(){return r(this,void 0,void 0,(function*(){let e;e=null!=o()?{authorization:"Bearer "+o()}:{"X-Authorization-Issuer":"Edulib"};const t=yield fetch(n.url_belin_api+function(){const e=window.location.href.split("/");return e[e.length-1].split("_")[0]}(),{method:"GET",headers:e});return yield t.json()}))}},8300:function(e,t){var i=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas=void 0,t.Canvas=class{constructor(e,t){this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.ctx=this.canvas.getContext("2d"),this.verifier_taille()}get base64(){return this.canvas.toDataURL("image/png")}ajouter_image(e,t,r){return i(this,void 0,void 0,(function*(){t.x*=window.devicePixelRatio,t.y*=window.devicePixelRatio,t.largeur*=window.devicePixelRatio,t.hauteur*=window.devicePixelRatio,r.x=Math.floor(r.x),r.y=Math.floor(r.y);const i=yield new Promise(((t,i)=>{const r=new Image;r.onload=()=>t(r),r.onerror=i,r.src=e}));this.ctx.drawImage(i,t.x,t.y,t.largeur,t.hauteur,r.x,r.y,r.largeur,r.hauteur)}))}verifier_taille(){if(this.ctx.fillStyle="rgb(0, 100, 0)",this.ctx.fillRect(this.canvas.width-1,this.canvas.height-1,1,1),0==this.ctx.getImageData(this.canvas.width-1,this.canvas.height-1,1,1).data[1])throw new Error(chrome.i18n.getMessage("erreur_taille_element"));this.ctx.clearRect(this.canvas.width-1,this.canvas.height-1,1,1)}}},9270:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureApiCall=void 0;const r=i(1241);class n extends r.Capture{}t.CaptureApiCall=n},8628:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureAvecOverlay=void 0;const r=i(1241);class n extends r.Capture{constructor(e){super(e)}startCapture(){super.startCapture();const e=document.querySelectorAll(this.selector);if(1==e.length)return this.capturer(e[0]);this.afficher_overlay(0,0,0,0)}reinitializeCapture(){super.reinitializeCapture(),this.supprimer_overlay()}afficher_overlay(e,t,i,r){e=Math.round(e),t=Math.round(t),i=Math.round(i),r=Math.round(r);const n=(e,t,i,r,n)=>{let s=document.querySelector("#poplab-overlay-"+e);s||(s=document.createElement("div"),s.id="poplab-overlay-"+e,s.className="poplab-overlay",document.documentElement.appendChild(s)),s.style.top=`${i}px`,s.style.left=`${t}px`,s.style.width=`${r}px`,s.style.height=`${n}px`};document.documentElement.classList.add("poplab-capture-en-cours"),document.onselectstart=()=>!1,document.onmouseover=()=>!1;const s=e+i,o=t+r;n("haut",0,0,Math.max(document.documentElement.scrollWidth,window.innerWidth),t),n("gauche",0,t,e,r),n("droite",s,t,Math.max(document.documentElement.scrollWidth-s,window.innerWidth-s),r),n("bas",0,o,Math.max(document.documentElement.scrollWidth,window.innerWidth),Math.max(document.documentElement.scrollHeight-o,window.innerHeight-o));let a=document.querySelector(".poplab-auto-overlay");a||(a=document.createElement("div"),a.className="poplab-auto-overlay",document.documentElement.appendChild(a)),a.style.top=`${Math.round(t)}px`,a.style.left=`${Math.round(e)}px`,a.style.width=`${Math.round(i)}px`,a.style.height=`${Math.round(r)}px`}supprimer_overlay(){const e=document.querySelectorAll(".poplab-overlay");for(const t of e)document.documentElement.removeChild(t);const t=document.querySelector(".poplab-auto-overlay");t&&document.documentElement.removeChild(t),document.documentElement.classList.remove("poplab-capture-en-cours"),document.onselectstart=()=>!0,document.onmouseover=()=>!0}trouver_element(e,t){const i=document.querySelectorAll(this.selector);for(const r of i){const i=r.getBoundingClientRect();if(!(e<i.left||e>i.right||t<i.top||t>i.bottom))return r}return null}mousemove(e){super.mousemove(e),this.afficher_overlay(0,0,0,0);const t=this.trouver_element(e.clientX,e.clientY);if(!t)return;const i=t.getBoundingClientRect();return this.afficher_overlay(i.left+window.scrollX,i.top+window.scrollY,i.width,i.height),!0}mouseup(e){if(super.mouseup(e),0!=e.button)return this.afficher_overlay(0,0,0,0),!0;const t=this.trouver_element(e.clientX,e.clientY);return t?(this.capturer(t),!0):(this.afficher_overlay(0,0,0,0),!0)}}t.CaptureAvecOverlay=n},1241:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Capture=void 0;const r=i(8033),n=i(2688),s=i(853),o=i(4911);t.Capture=class{constructor(e){this.mediaPreviews=[],this.elementsLength=void 0,this.elementNumber=void 0,this.description="",this.titre="",this.type=n.CaptureType.BASIQUE,this.callback=void 0,this.capture_en_cours=!1,this.listeners=new Map,this.selector=void 0,this.recapturable=!0,this.editable=!0,this.menu=e}startCapture(){this.reinitializeCapture(),this.mediaPreviews=[],this.listeners.set("keydown",this.keydown.bind(this)),this.listeners.set("mousedown",this.mousedown.bind(this)),this.listeners.set("mousemove",this.mousemove.bind(this)),this.listeners.set("mouseup",this.mouseup.bind(this)),this.listeners.forEach(((e,t)=>{document.addEventListener(t,e)})),this.menu.div.style.top="-9999px",this.menu.div.style.right="-9999px",this.capture_en_cours=!0}reinitializeCapture(){this.listeners.forEach(((e,t)=>{document.removeEventListener(t,e)})),this.listeners.clear(),this.menu.div.style.top="10px",this.menu.div.style.right="10px",this.capture_en_cours=!1}capturer(e){this.startCapture(),this.sendCaptureToMenu(new n.ElementCaptureData)}sendCaptureToMenu(e){this.reinitializeCapture(),this.data=e,this.menu.displayCaptureInfos()}sendCaptureToPoplab(e,t){var i,a,l,c,u;if((0,o.clearHighlight)(),this.data instanceof n.ElementCaptureData&&t){this.data.titre=t.titre,this.data.description=t.description,this.data.credit||(this.data.credit=document.URL);const e=[],r=[],n=[],s=[],o=[];null===(i=this.data.images)||void 0===i||i.forEach((i=>{-1!==t.mediasIds.indexOf(i.id)&&e.push(i)})),null===(a=this.data.videos)||void 0===a||a.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&r.push(e)})),null===(l=this.data.audios)||void 0===l||l.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&n.push(e)})),null===(c=this.data.urls)||void 0===c||c.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&s.push(e)})),null===(u=this.data.fichiers)||void 0===u||u.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&o.push(e)})),this.data.images=e,this.data.audios=n,this.data.videos=r,this.data.urls=s,this.data.fichiers=o,this.titre=t.titre,this.description=t.description}this.menu.old_capture=this,browser.runtime.sendMessage(new r.BrowserRuntimeMessageForPoplab(this.data instanceof n.ElementCaptureData?s.PoplabObjectType.ELEMENT:s.PoplabObjectType.DOCUMENT,this.type,this.data,e))}mousedown(e){return!0}mousemove(e){return!0}mouseup(e){return!0}keydown(e){return!0}isEmpty(){var e,t;return!(this.titre||this.description||(null===(e=this.data)||void 0===e?void 0:e.titre)||(null===(t=this.data)||void 0===t?void 0:t.description)||0!==this.mediaPreviews.length)}}},3892:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinCommon=void 0;const r=i(2688),n=i(4056),s=i(4911),o=i(4393),a=i(8286);t.CaptureBelinCommon=class{constructor(e){this.captureBelin=e}transformHandableUrls(e,t){var i,r;const s=t.find((t=>t.content.url===e.url));return e.url.includes("json://")?`${n.url_belin_resources}${null===(i=s.content.downloadPath)||void 0===i?void 0:i.split(".zip")[0]}/index.html`:e.url.includes("astra://")?`${n.url_belin_resources}${null===(r=s.content.downloadPath)||void 0===r?void 0:r.split("/Astra/")[0]}/Astra/pack/${s.id}.html`:e.url.includes("word://")||e.url.includes("pptx://")?`${n.url_belin_resources}${s.content.downloadPath}`:e.url}removeTags(e,t){let i=e;for(const e of t)i=this.removeTag(i,e);return i}removeTag(e,t){const i=`<${t}`;let r=e.indexOf(i);for(;-1!==r;){const n=e.indexOf(">",r),s=e.slice(r,n+1),o=e.slice(0,r),a=e.slice(n+1);if(s.includes("/>"))e=o+a;else{const i=`</${t}>`,r=e.indexOf(i,n);e=-1!==r?o+e.slice(r+i.length):o+a}r=e.indexOf(i)}return e}isGrainComplexe(e,t){if((0,s.hasSameFileTypeMoreThanOnce)(t))return!0;const i=this.getGrainContentSections(e);for(const e of i)if(e.outerHTML.includes("<table"))return!0;return 1!==i.length&&this.hasMoreThanOneText(i)}removeEmptyTags(e){const t=new RegExp(/<(\w+)(\s*[^>]*)> *<\/\1>/g);let i=e.replace(t,"");for(;t.test(i);)i=i.replace(t,"");return i}hasMoreThanOneText(e){let t=0;for(const i of e)if("RESOURCE"!==i.tagName){let e=this.removeTags(i.innerHTML,["media","img","audio","video","resource"]).replace(new RegExp(/\n/g),"").trim();if(e=this.removeEmptyTags(e),e.length>0&&(t++,t>1))break}return t>1}getGrainContentSections(e){const t=(0,a.createElementFromDomParser)(e).querySelector("topic"),i=[];if(t){const e=t.children;for(const t of e){const e=t;"METADATA"!==e.tagName&&"BELIN-TITLE"!==e.tagName&&"SURTITLE"!==e.tagName&&(e.innerHTML=this.removeTag(e.innerHTML,"metadata"),i.push(e))}}return i}createCredit(e,t,i){let r="";e.images[0]&&(r=r.concat(e.images[0].copyright?e.images[0].copyright:"")),e.videos[0]&&(r=r.concat(e.videos[0].copyright?e.videos[0].copyright:"")),e.audios[0]&&(r=r.concat(e.audios[0].copyright?e.audios[0].copyright:""));const n=`<a href="${window.location.href}">${chrome.i18n.getMessage("voir_manuel_max")}</a> (${t} ${i})`;return r=r?`${r} - ${n}`:n,r}putManuelPageLinkInElement(e){var t,i;if(e.type===o.ElementType.ELEMENT){if(1===e.urls.length){const i=e.urls[0];e.description=null===(t=e.description)||void 0===t?void 0:t.concat(`\n<a href="${i.url}">${i.label}</a>`)}e.type===o.ElementType.ELEMENT&&(e.urls=[new r.UrlMediaObject(window.location.href,window.location.href,"",chrome.i18n.getMessage("voir_manuel_max"))])}else if(e.type===o.ElementType.SECTION&&e.description){const t=`<a href="${window.location.href}">${chrome.i18n.getMessage("voir_manuel_max")}</a>`;e.description.endsWith(t)||(e.description=null===(i=e.description)||void 0===i?void 0:i.concat(`\n${t}`))}}createMetaElement(e){const t={manualId:e.manualId,discipline:e.discipline,niveau:e.level,grainId:e.grainId,pageId:e.pageId};return{editeur:o.Editeur.BELIN,origine:window.location.href,additionalInfo:t}}createMetaDocument(e){const t={manualId:e.manualId,discipline:e.discipline,niveau:e.level,grainId:e.grainId,pageId:e.pageId};return{editeur:o.Editeur.BELIN,origine:window.location.href,additionalInfo:t}}setEditeurForMedias(e){e.getMedias().forEach((e=>e.editeur=o.Editeur.BELIN))}handleMathFormulas(e){let t=e;if(null==t?void 0:t.includes("<latex>")){let e;for(;e=t.match(/<latex>(.*?)<\/latex>/);)t=t.replace("<latex>",`<span data-latex='${e[1]}' data-evaluate='no' data-display='no' data-type='inlineMath'>`),t=t.replace("</latex>","</span>")}return t}}},1956:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinGrainComplexeLinkHandler=void 0;const r=i(2688),n=i(1845),s=i(4393),o=i(3892);class a extends o.CaptureBelinCommon{handleLink(e,t,i,s,o){const a=this.getMediaObject(e,t);a.type_fichier===r.TypeFichier.VIDEO?i.videos.push(a):(0,n.parseLinkAsPoplabMediaObject)(i,a,o,e),i.urls.length>0?this.putUrlInNearestExistingElement(i,s):s.push(i),i.description=this.removeTag(i.description||"","a")}getMediaObject(e,t){let i=e.getAttribute("uri");i||(i=e.children[0].getAttribute("uri"));const r=i.split("//")[1],n=t.medias.find((e=>e.id===i||e.url===i||e.id===r));return n.url=this.transformHandableUrls(n,t.grainResources),n}putUrlInNearestExistingElement(e,t){if(e.titre||e.description)t.push(e);else{const i=t.slice().reverse().find((e=>e.type===s.ElementType.ELEMENT&&0===e.urls.length));i?i.urls.push(e.urls[0]):t.push(e)}}}t.CaptureBelinGrainComplexeLinkHandler=a},1454:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinGrainComplexeMediaHandler=void 0;const r=i(2688),n=i(4393);t.CaptureBelinGrainComplexeMediaHandler=class{handleMedia(e,t,i){let s="";const o=e.children;for(const e of o){const t=e;"BELIN-TITLE"!==t.tagName&&(t.id||t.getAttribute("url"))&&(s=t.id||t.getAttribute("url"))}const a=new r.ElementCaptureData;a.type=n.ElementType.ELEMENT,a.description=e.outerHTML;const l=i.find((e=>e.id===s||e.url===s));if(l)switch(l.type_fichier){case r.TypeFichier.IMAGE:a.images.push(l);break;case r.TypeFichier.VIDEO:a.videos.push(l);break;case r.TypeFichier.AUDIO:a.audios.push(l);break;case r.TypeFichier.LIEN:a.urls.push(l)}t.push(a)}}},7956:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinGrainComplexe=void 0;const r=i(2688),n=i(4393),s=i(3892),o=i(4911),a=i(1956),l=i(1454),c=i(1142),u=i(8286);class d extends s.CaptureBelinCommon{constructor(e){super(e),this.linkHandler=new a.CaptureBelinGrainComplexeLinkHandler(e),this.mediaHandler=new l.CaptureBelinGrainComplexeMediaHandler}accept(e){return this.isGrainComplexe(e.grainContent,e.medias)}startCaptureType(e){const t=(new r.DocumentCaptureData).setTitre((0,u.createElementFromDomParser)(e.grainTitle).textContent||this.createDefaultDocumentTitle(e));t.auteurInitial=new c.Auteur(c.AuteurInitial.BELIN),t.elements=[],this.getGrainContentSections(e.grainContent).forEach((i=>{var s;const o=new r.ElementCaptureData;if(o.description=this.removeTags(i.innerHTML,["note","copyright"]).replace(new RegExp(/\n/g),"").replace(new RegExp(/ {2}/g),"").trim(),i.outerHTML.startsWith("<resource")){const r=null===(s=i.querySelector("belin-title"))||void 0===s?void 0:s.innerHTML;i.querySelector("a")?this.linkHandler.handleLink(i.querySelector("a"),e,o,t.elements,r):i.querySelector("media")&&(this.mediaHandler.handleMedia(i.querySelector("media"),t.elements,e.medias),t.elements[t.elements.length-1].titre=r)}else{const i=this.splitSectionCaptureData(o,e);t.elements=t.elements.concat(i),o.type=n.ElementType.SECTION}}));for(let i=1;i<=t.elements.length;i++){const r=t.elements[i],s=t.elements[i-1];s.auteurInitial=new c.Auteur(c.AuteurInitial.BELIN),s.credit=this.createCredit(s,e.discipline,e.level),s.meta=this.createMetaElement(e),s.description&&(s.description=this.removeEmptyTags(s.description),s.description=this.handleMathFormulas(s.description)),this.isElementSectionWithOnlyDescription(r)?s.type===n.ElementType.SECTION&&(s.description+=`<p>${r.description}</p>`,t.elements.splice(i,1),i--):this.isElementSectionAndEmpty(r)&&t.elements.splice(i,1),this.putManuelPageLinkInElement(s),this.setEditeurForMedias(s)}return t.meta=this.createMetaDocument(e),t}removeLastUnclosedTag(e){return e.replace(/<(\w+)(\s*[^>]*)>$/,"")}removeFirstOnlyClosingTag(e){return e.replace(/^<\/(\w+)(\s*[^>]*)>/,"")}isElementSectionWithOnlyDescription(e){return!(!e||e.type!==n.ElementType.SECTION||e.titre||!e.description)}isElementSectionAndEmpty(e){return!(!e||e.type!==n.ElementType.SECTION||e.titre||e.description)}splitSectionCaptureData(e,t){const i=[e];let r=e.description,n=e;const s=[{startTag:"<media",endTag:"</media>"},{startTag:"<img",endTag:""},{startTag:"<audio",endTag:""},{startTag:"<video",endTag:""},{startTag:"<belin-title",endTag:"</belin-title>"}];for(;s.some((e=>-1!==r.indexOf(e.startTag)));){const a=s.map((e=>r.indexOf(e.startTag))),l=a.filter((e=>-1!==e));if(0===l.length)break;const c=Math.min(...l),d=s[a.indexOf(c)],p=r.indexOf(d.startTag);let h;if(h=d.endTag?r.indexOf(d.endTag,p)+d.endTag.length:r.indexOf(">",p)+1,-1===p||-1===h)break;const m=r.substring(p,h),g=(0,o.fromHTML)(m);switch(d.startTag){case"<media":this.mediaHandler.handleMedia(g,i,t.medias);break;case"<img":case"<audio":case"<video":{const e=document.createElement("media");e.append(g),this.mediaHandler.handleMedia(e,i,t.medias);break}case"<belin-title":e.titre=(0,u.createElementFromDomParser)(g.textContent).textContent}r=this.removeTagFromSectionContent(n,r,i,p,h,s.map((e=>e.startTag))),n=i[i.length-1]}return i}removeTagFromSectionContent(e,t,i,s,o,a){e.description=this.removeLastUnclosedTag(t.substring(0,s));const l=t.indexOf(">")+1;let c=t.substring(0,l);a.some((e=>c.startsWith(e)))&&(c="");const u=this.removeFirstOnlyClosingTag(t.substring(o)).trim();t=u&&!u.startsWith(c)?c+this.removeFirstOnlyClosingTag(t.substring(o)):u;const d=(new r.ElementCaptureData).setDescription(t).setType(n.ElementType.SECTION);return i.push(d),t}createDefaultDocumentTitle(e){return`${(0,u.createElementFromDomParser)(e.pageTitle).textContent} (${e.discipline} ${e.level} p.${e.startPage}-${e.endPage})`}}t.CaptureBelinGrainComplexe=d},315:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinGrainSimple=void 0;const r=i(2688),n=i(3892),s=i(1142);class o extends n.CaptureBelinCommon{constructor(e){super(e)}accept(e){return!0}startCaptureType(e){this.captureBelin.titre=e.grainTitle.trim();const t=new r.ElementCaptureData;t.titre=this.captureBelin.titre;const i=this.getGrainContentSections(e.grainContent);return t.description="",i.forEach((i=>{"RESOURCE"===i.tagName&&i.innerHTML.includes("<a")?this.handleGrainSimpleLink(e,i):t.description+=i.innerHTML})),t.description=this.handleMathFormulas(t.description),t.description=this.cleanupContent(t.description),t.images=e.medias.filter((e=>e.type_fichier===r.TypeFichier.IMAGE)),t.videos=e.medias.filter((e=>e.type_fichier===r.TypeFichier.VIDEO)),t.audios=e.medias.filter((e=>e.type_fichier===r.TypeFichier.AUDIO)),t.urls=e.medias.filter((e=>e.type_fichier===r.TypeFichier.LIEN)),t.exerciseurs=e.medias.filter((e=>e.type_fichier===r.TypeFichier.EXERCISEUR)),t.fichiers=e.medias.filter((e=>e.type_fichier===r.TypeFichier.FICHIER)),this.setEditeurForMedias(t),t.auteurInitial=new s.Auteur(s.AuteurInitial.BELIN),this.putManuelPageLinkInElement(t),this.captureBelin.mediaPreviews=t.getAllEmbeds(),this.captureBelin.description=t.description,t.credit=this.createCredit(t,e.discipline,e.level),t.meta=this.createMetaElement(e),t}handleGrainSimpleLink(e,t){var i;const n=e.medias.find((e=>e.type_fichier===r.TypeFichier.LIEN));if(n){for(const e of t.children)"BELIN-TITLE"===e.tagName&&(n.label=e.textContent);n.label||(n.label=null===(i=t.textContent)||void 0===i?void 0:i.trim()),n.url=this.transformHandableUrls(n,e.grainResources),n.url.includes("https://")||n.url.includes("http://")||(e.medias=e.medias.filter((e=>e.type_fichier!==r.TypeFichier.LIEN)))}}cleanupContent(e){return e=this.removeTag(e,"image"),e=this.removeTag(e,"note"),e=this.removeTag(e,"copyright"),e=this.removeTag(e,"video"),e=this.removeTag(e,"metadata"),(e=(e=this.removeTag(e,"resource")).replace(new RegExp(/belin-title/g),"p")).replace(new RegExp(/\n/g),"")}}t.CaptureBelinGrainSimple=o},1845:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseLinkAsPoplabMediaObject=void 0,t.parseLinkAsPoplabMediaObject=function(e,t,s,o){const a=[new i,new n,new r];for(const i of a)if(i.accept(t.url)){i.processLink(e,t,s,o);break}};class i{accept(e){return e.startsWith("html://")}processLink(e,t){e.exerciseurs.push(t)}}class r{accept(e){return e.startsWith("pdf://")}processLink(e,t,i,r){t.label=i,e.fichiers.push(t)}}class n{accept(e){return e.startsWith("https://")||e.startsWith("http://")}processLink(e,t,i,r){r.textContent?t.label=r.textContent.trim():t.label=i,e.urls.push(t)}}},8286:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createElementFromDomParser=t.sanitize=void 0;const r=i(4056);function n(e,t){for(let i=e.length-1;i>=0;i--){const r=e[i],n=document.createElement(t);n.innerHTML=r.innerHTML,Array.from(r.attributes).forEach((e=>{n.setAttribute(e.name,e.value)})),r.replaceWith(n)}}function s(e){return e=e.replace(/<title>/g,"<belin-title>").replace(/<\/title>/g,"</belin-title>"),(new DOMParser).parseFromString(`<body>${e}</body>`,"text/html").body}t.sanitize=function(e,t){return function(e){const t=s(e);return n(t.querySelectorAll('[style="ordered"]'),"ol"),t.querySelectorAll("ol").forEach((e=>{const t=e.getAttribute("start");if(t){const i=parseInt(t,10)-1;e.style.counterReset="item "+i}})),n(t.querySelectorAll("list"),"ul"),n(t.querySelectorAll("item"),"li"),n(t.querySelectorAll("emphasis"),"i"),t.innerHTML}(e=function(e){const t=s(e);return t.querySelectorAll('[for="teacher"]').forEach((e=>{e.remove()})),t.innerHTML}(e=function(e,t,i){return e=(e=(e=e.replace(new RegExp(/<link/g),"<a")).replace(new RegExp(/<\/link>/g),"</a>")).replace(new RegExp(/uri="topic:\/\//g),`href="${r.url_belin}${t.toLowerCase()}-${i.toLowerCase()}/topics/`)}(e,t.discipline,t.level)))},t.createElementFromDomParser=s},4143:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinAPI=void 0;const n=i(4056),s=i(9040),o=i(2688),a=i(4393),l=i(4911),c=i(9270),u=i(315),d=i(7956),p=i(8286);class h extends c.CaptureApiCall{constructor(e,t){super(e),this.type=o.CaptureType.UPLOAD,this.elementNumber=t,this.recapturable=!1,this.editable=!1,this.captureTypes=[new d.CaptureBelinGrainComplexe(this),new u.CaptureBelinGrainSimple(this)]}startCapture(){return r(this,void 0,void 0,(function*(){this.mediaPreviews=[];const e=yield this.getWantedGrain();if(null!=e)for(const t of this.captureTypes){const i=t;if(i.accept(e)){const t=i.startCaptureType(e);this.sendCaptureToMenu(t);break}}else this.reinitializeCapture()}))}getWantedGrain(){return r(this,void 0,void 0,(function*(){this.apiResponse||(this.apiResponse=yield(0,s.getBelinPageResponse)());const e=this.apiResponse.children;this.elementsLength=e.length;const t=e[this.elementNumber];(0,l.smoothScrollToTargetedHtmlElement)(t.id,118);const i=(0,p.sanitize)(t.content,this.apiResponse),r=[];let a=[];t.resources.length>0&&(a=yield this.processMedias(t,r));for(const e of this.processLinks(i))n.handledVideosPlatform.some((t=>e.includes(t)))?r.push(new o.VideoMediaObject(e,e)):r.push(new o.UrlMediaObject(e,e));return{grainContent:i,grainTitle:t.title,grainResources:a,medias:r,pageTitle:this.apiResponse.title,startPage:this.apiResponse.startPage,endPage:this.apiResponse.endPage,discipline:this.apiResponse.discipline,level:this.apiResponse.level,manualId:this.apiResponse.manualId,grainId:t.id,pageId:this.apiResponse.id}}))}getUrlOfResource(e){var t,i;return e.type===s.TypeFichierBelin.HTML?n.url_belin_resources+(null===(t=e.content.downloadPath)||void 0===t?void 0:t.split(".")[0])+"/index.html":null!==(i=e.content.url)&&void 0!==i?i:n.url_belin_resources+e.content.downloadPath}processMedias(e,t){return r(this,void 0,void 0,(function*(){const i=e.resources,r=[];for(const e of i){const t=e;t.type===s.TypeFichierBelin.IMAGE&&2===t.id.split("_").length||r.push({id:t.id,type:t.type,forTeacher:t.forTeacher,content:{url:this.getUrlOfResource(t),downloadPath:t.content.downloadPath,copyright:t.content.copyright,parentCopyright:t.content.parentCopyright}})}for(const e of r)e.type===s.TypeFichierBelin.HTML?t.push(new o.ExerciseurMediaObject(e.id,e.content.url,a.ExerciseurType.BELIN)):e.type===s.TypeFichierBelin.PDF?t.push(new o.FichierMediaObject(e.id,e.content.url,yield this.transformMediaIntoBase64(e.content.url,e.type,e.content.downloadPath),e.type)):t.push(new o.MediaObject(e.id,e.content.url,this.buildTypeFichier(e.type),this.buildCopyright(e.content.copyright,e.content.parentCopyright),yield this.transformMediaIntoBase64(e.content.url,e.type,e.content.downloadPath)));return r}))}processLinks(e){const t=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("resource"),i=[];return t.forEach((e=>{const t=e.querySelector("a");if(t){const e=t.getAttribute("uri");e.startsWith("http")&&i.push(e)}})),i}buildCopyright(e,t){return`${null!=e?e:""}${t?" - "+t:""}`}transformMediaIntoBase64(e,t,i){return r(this,void 0,void 0,(function*(){let r;if(e.includes(n.url_belin_resources))r=e;else{if(!i)return;{const e=yield fetch(`${n.url_belin_api_resources}?key=${i}`,{});r=(yield e.json()).location}}const o=yield fetch(r,{method:"GET",headers:{"Cache-Control":"no-cache","Access-Control-Allow-Origin":"*"}}),a=yield o.blob();if(t===s.TypeFichierBelin.IMAGE){const e=yield this.blobToImage(a);if(e.width*e.height>n.maxResolution)return}return yield this.blobToBase64(a)}))}blobToImage(e){return new Promise(((t,i)=>{const r=URL.createObjectURL(e),n=new Image;n.onload=()=>{URL.revokeObjectURL(r),t(n)},n.onerror=i,n.src=r}))}blobToBase64(e){return r(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{const r=new FileReader;r.onload=()=>{const e=r.result;t(e)},r.onerror=i,r.readAsDataURL(e)}))}))}buildTypeFichier(e){switch(e){case s.TypeFichierBelin.IMAGE:return o.TypeFichier.IMAGE;case s.TypeFichierBelin.AUDIO:return o.TypeFichier.AUDIO;case s.TypeFichierBelin.VIDEO:return o.TypeFichier.VIDEO;case s.TypeFichierBelin.PDF:return o.TypeFichier.FICHIER;case s.TypeFichierBelin.HTML:return o.TypeFichier.EXERCISEUR;case s.TypeFichierBelin.URL:default:return o.TypeFichier.LIEN}}}t.CaptureBelinAPI=h},3719:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureImage=void 0;const r=i(8628),n=i(2688);class s extends r.CaptureAvecOverlay{constructor(e){super(e),this.type=n.CaptureType.BASIQUE,this.selector="img"}capturer(e){let t=e.src;0==t.indexOf("/")&&(t=document.location.origin+t),this.titre=e.title||e.alt||document.title,this.mediaPreviews.push(new n.ImageMediaObject("image",t)),this.sendCaptureToMenu((new n.ElementCaptureData).setImages([new n.ImageMediaObject("image",t)]))}}t.CaptureImage=s},7610:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureLien=void 0;const r=i(2688),n=i(1241);class s extends n.Capture{constructor(e){super(e),this.type=r.CaptureType.BASIQUE,this.selector="a",this.recapturable=!1}capturer(e){this.titre=e.title||document.title;const t=document.querySelector('meta[name="description"]');t&&(this.description=t.content),this.mediaPreviews=[new r.UrlMediaObject(e.href,e.href)],this.sendCaptureToMenu((new r.ElementCaptureData).setUrls([new r.UrlMediaObject(e.href,e.href)]))}startCapture(){this.titre=document.title;const e=document.querySelector('meta[name="description"]');e&&(this.description=e.content),this.mediaPreviews=[new r.UrlMediaObject(document.URL,document.URL)],this.sendCaptureToMenu((new r.ElementCaptureData).setUrls([new r.UrlMediaObject(document.URL,document.URL)]))}}t.CaptureLien=s},2143:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureTexte=void 0;const r=i(8628);class n extends r.CaptureAvecOverlay{constructor(e,t){super(e),this.captureCallback=()=>{},this.selector="*",this.captureCallback=t}startCapture(){super.startCapture()}reinitializeCapture(){super.reinitializeCapture(),this.captureCallback&&this.captureCallback(null)}mousemove(e){this.afficher_overlay(0,0,0,0);const t=document.elementFromPoint(e.clientX,e.clientY);if(!t)return!0;if(""==t.innerText||void 0===t.innerText)return!0;const i=t.getBoundingClientRect();return this.afficher_overlay(i.left+window.scrollX,i.top+window.scrollY,i.width,i.height),!0}mouseup(e){if(0!=e.button)return this.afficher_overlay(0,0,0,0),!0;this.supprimer_overlay();const t=document.elementFromPoint(e.clientX,e.clientY);return t&&""!=t.innerText?(this.reinitializeCapture(),this.captureCallback(t.innerText),!0):(this.afficher_overlay(0,0,0,0),!0)}}t.CaptureTexte=n},2181:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureVideo=void 0;const r=i(8628),n=i(2688);class s extends r.CaptureAvecOverlay{constructor(e){super(e),this.type=n.CaptureType.BASIQUE,this.selector="video"}capturer(e){this.titre=e.title,""==this.titre&&(this.titre=document.title),this.mediaPreviews.push(new n.VideoMediaObject("video",e.currentSrc)),this.sendCaptureToMenu((new n.ElementCaptureData).setVideos([new n.VideoMediaObject("video",e.currentSrc)]))}}t.CaptureVideo=s},1443:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureYoutube=void 0;const r=i(2688),n=i(1241);class s extends n.Capture{constructor(e){super(e),this.type=r.CaptureType.BASIQUE,this.recapturable=!1}startCapture(){super.startCapture(),this.titre=document.title.substring(0,document.title.length-10),this.mediaPreviews=[new r.VideoMediaObject(document.URL,this.getYoutubeVideoEmbedUrl(document.URL))],this.sendCaptureToMenu((new r.ElementCaptureData).setVideos([new r.VideoMediaObject(document.URL,document.URL)]))}getYoutubeVideoEmbedUrl(e){let t=e.split("v=")[1];const i=e.indexOf("&");return-1!==i&&(t=t.substring(0,i)),"https://www.youtube.com/embed/"+t}}t.CaptureYoutube=s},7200:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureZone=void 0;const n=i(8033),s=i(2688),o=i(8628),a=i(8300),l=i(4056);class c extends o.CaptureAvecOverlay{constructor(e){super(e),this.init_taille_scrollbar(),this.type=s.CaptureType.UPLOAD,this.selector="*",this.isCapturingZone=!1}startCapture(){super.startCapture(),this.position_initiale=void 0}init_taille_scrollbar(){const e=document.createElement("div");e.id="poplab-scroll-test";const t=document.createElement("div");t.style.height="100px",e.appendChild(t),document.body.appendChild(e),this.hauteur_scrollbar=Math.round(e.offsetHeight-t.offsetHeight),this.largeur_scrollbar=Math.round(e.offsetWidth-t.offsetWidth),document.body.removeChild(e)}get largeur_fenetre(){return document.documentElement.clientHeight==document.documentElement.scrollHeight?window.innerWidth:window.innerWidth-this.largeur_scrollbar}get hauteur_fenetre(){return document.documentElement.clientWidth==document.documentElement.scrollWidth?window.innerHeight:window.innerHeight-this.hauteur_scrollbar}smart_scroll(e,t){e=Math.min(e,document.documentElement.scrollWidth-this.largeur_fenetre),t=Math.min(t,document.documentElement.scrollHeight-this.hauteur_fenetre),e=Math.max(e,0),t=Math.max(t,0);const i=document.createElement("div");return i.id="poplab-fakescreen",i.style.top=`${t}px`,i.style.left=`${e}px`,i.style.width=`${this.largeur_fenetre}px`,i.style.height=`${this.hauteur_fenetre}px`,document.documentElement.appendChild(i),new Promise(((r,n)=>{const s=setInterval((()=>window.scrollTo(e,t)),100);new IntersectionObserver((([e])=>{e.isIntersecting&&(clearInterval(s),document.documentElement.removeChild(i),r())})).observe(i),window.scrollTo(e,t)}))}capturer_zone(e,t,i,o){return r(this,void 0,void 0,(function*(){this.isCapturingZone=!0,e=Math.round(e),t=Math.round(t),i=Math.min(document.documentElement.scrollWidth-e,Math.round(i)),o=Math.min(document.documentElement.scrollHeight-t,Math.round(o));const r=window.scrollX,c=window.scrollY;if(window.innerHeight<=500)return void window.alert(chrome.i18n.getMessage("fenetre_trop_petite"));if(i*o>l.maxResolution)return window.alert(chrome.i18n.getMessage("image_trop_grande")),void this.reinitializeCapture();const u=new a.Canvas(i,o);let d=0;this.supprimer_overlay(),yield new Promise(((e,t)=>window.requestAnimationFrame(e))),yield new Promise(((e,t)=>window.requestAnimationFrame(e)));e:for(;d<o;){const r=Math.min(250,t+d);let s=0;for(let a=0;a<i;a+=this.largeur_fenetre){yield this.smart_scroll(e+a,t+d-r);const l=e+a-window.scrollX,c=t+d-window.scrollY,p=Math.min(this.largeur_fenetre-l,i-a);if(0==a&&(s=Math.min(this.hauteur_fenetre-c,o-d),t+d+s+250<document.documentElement.scrollHeight&&(s-=250),s<=0&&(s=o-d)),s<=0||p<=0){console.error("Houlà ! On ne peut pas prendre de screenshot avec hauteur",s,"et largeur",p,": on suppose que la capture est terminée."),console.info({x:e,y:t,scrollX:window.scrollX,scrollY:window.scrollY,largeur:i,largeur_capturee:a,hauteur:o,hauteur_capturee:d});break e}window.chrome&&(yield new Promise(((e,t)=>setTimeout(e,500))));const h=yield browser.runtime.sendMessage(new n.BrowserRuntimeMessage(n.BrowserRuntimeMessageEventType.CAPTURE_TAB));yield u.ajouter_image(h,{x:l,y:c,largeur:p,hauteur:s},{x:a,y:d,largeur:p,hauteur:s})}d+=s}window.scrollTo(r,c),this.titre=document.title,this.fichier=u.base64;const p="webclipper-zone-"+self.crypto.randomUUID();return this.mediaPreviews.push(new s.ImageMediaObject(p,u.base64)),this.isCapturingZone=!1,this.sendCaptureToMenu((new s.ElementCaptureData).setImages([new s.ImageMediaObject(p,"",void 0,u.base64)]))}))}mousedown(e){if(this.isCapturingZone)return!0;if(0==e.button){const t=e.clientX+window.scrollX,i=e.clientY+window.scrollY;this.position_initiale={x:t,y:i},this.afficher_overlay(t,i,0,0)}return!0}mousemove(e){if(this.isCapturingZone)return!0;if(null==this.position_initiale){this.afficher_overlay(0,0,0,0);const t=document.elementFromPoint(e.clientX,e.clientY);if(t){const e=t.getBoundingClientRect();this.afficher_overlay(e.left+window.scrollX,e.top+window.scrollY,e.width,e.height)}}else{const t=Math.min(e.clientX+window.scrollX,this.position_initiale.x),i=Math.min(e.clientY+window.scrollY,this.position_initiale.y);this.afficher_overlay(t,i,Math.max(e.clientX+window.scrollX,this.position_initiale.x)-t,Math.max(e.clientY+window.scrollY,this.position_initiale.y)-i)}}mouseup(e){if(this.isCapturingZone)return!0;if(0!=e.button)return this.reinitializeCapture(),this.startCapture(),!0;if(Math.abs(e.clientX+window.scrollX-this.position_initiale.x)<5||Math.abs(e.clientY+window.scrollY-this.position_initiale.y)<5){this.position_initiale=void 0,this.afficher_overlay(0,0,0,0);const t=document.elementFromPoint(e.clientX,e.clientY);if(t){const e=t.getBoundingClientRect();this.capturer_zone(e.x+window.scrollX,e.y+window.scrollY,e.width,e.height)}}else{const t=Math.min(e.clientX+window.scrollX,this.position_initiale.x),i=Math.min(e.clientY+window.scrollY,this.position_initiale.y),r=Math.max(e.clientX+window.scrollX,this.position_initiale.x)-t,n=Math.max(e.clientY+window.scrollY,this.position_initiale.y)-i;this.capturer_zone(t,i,r,n)}}}t.CaptureZone=c},1218:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectableOptionClass=void 0,t.SelectableOptionClass=function(e,t){return function(i){return"id"!==e&&"text"!==t?class extends i{get id(){return this[e]}get text(){return this[t]}}:"id"!==e&&"text"===t?class extends i{get id(){return this[e]}}:"id"===e&&"text"!==t?class extends i{get text(){return this[t]}}:class extends i{}}}},1741:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaPreviewView=void 0;const r=i(2688),n=i(4911);t.MediaPreviewView=class{constructor(e){this.controller=e}createSingleMediaPreview(e){return`\n    <div class="poplab-capture-form-block">\n      <label class="form-block-label-title">\n        <div class="form-block-label-title">\n          <img src="${e.images.mediaIcon}" alt="" class="label-icon" />\n          <p>${chrome.i18n.getMessage("medias_capture")}</p>\n        </div>\n      </label>\n      <div class="poplab-preview">\n        ${this.buildPreview(e.capture.mediaPreviews[0])}\n        ${e.capture.recapturable?`\n          <div class="recapturer">\n            <div class="btn-recapturer vertically-center">\n              <img src="${e.images.selector}" />\n              <div>${chrome.i18n.getMessage("recapture_element")}</div>\n            </div>\n          </div>`:""}\n      </div>\n    </div>`}createManyMediaPreview(e,t){let i=(0,n.getCountPerFileType)(e.capture.mediaPreviews);const s=document.createElement("div");return 2===i.filter((e=>e.typeFichier===r.TypeFichier.IMAGE||e.typeFichier===r.TypeFichier.VIDEO)).length&&(i=i.filter((e=>e.typeFichier!==r.TypeFichier.VIDEO&&e.typeFichier!==r.TypeFichier.IMAGE)),s.innerHTML+=this.buildImagesVideosPreview(e.capture.mediaPreviews)),i.forEach((i=>{if(i.count>1)s.innerHTML+=this.buildMediasToChoosePreview(e.capture.mediaPreviews,i);else{const r=e.capture.mediaPreviews.find((e=>e.type_fichier===i.typeFichier));s.innerHTML+=this.buildSingleMediaForTypePreview(r,i),null==t||t.push(r.id)}})),s.outerHTML}buildImagesVideosPreview(e){let t=`\n            <p class="select-file-type">\n              ${chrome.i18n.getMessage("selectionnez")}\n              ${chrome.i18n.getMessage("image_ou_video_avec_determinant")}\n              ${chrome.i18n.getMessage("a_recuperer")}</p>\n            `;return e.filter((e=>e.type_fichier===r.TypeFichier.IMAGE||e.type_fichier===r.TypeFichier.VIDEO)).map(((e,i)=>{const r=document.createElement("div");r.className="poplab-preview";const n=document.createElement("button");n.className="radio-wrap",n.type="button",n.innerHTML+=`\n                <label class="radio">\n                  <input type="radio" name="IMAGE_VIDEO" id="preview-radio-${i}" value="${e.id}" ${0===i?"checked":""}/>\n                  <div class="contour-radio">\n                    <div class="bg-radio"></div>\n                  </div>\n                  ${this.buildPreview(e)}\n                </label>`,r.appendChild(n),t+=r.outerHTML})),t}buildMediasToChoosePreview(e,t){let i=`\n            <p class="select-file-type">\n              ${chrome.i18n.getMessage("selectionnez")}\n              ${chrome.i18n.getMessage(`${t.typeFichier.toLowerCase()}_avec_determinant`)}\n              ${chrome.i18n.getMessage("a_recuperer")}</p>\n            `;return e.filter((e=>e.type_fichier===t.typeFichier)).map(((e,t)=>{const r=document.createElement("div");r.className="poplab-preview";const n=document.createElement("button");n.className="radio-wrap",n.type="button",n.innerHTML+=`\n                  <label class="radio">\n                    <input type="radio" name="${e.type_fichier}" id="preview-radio-${t}" value="${e.id}" ${0===t?"checked":""}/>\n                    <div class="contour-radio">\n                      <div class="bg-radio"></div>\n                    </div>\n                    ${this.buildPreview(e)}\n                  </label>`,r.appendChild(n),i+=r.outerHTML})),i}buildSingleMediaForTypePreview(e,t){return`<p class="select-file-type">${chrome.i18n.getMessage(`${t.typeFichier}_capture`)}</p>\n            <div class="poplab-preview">\n              ${this.buildPreview(e)}\n            </div>`}buildPreview(e){var t;return e.type_fichier===r.TypeFichier.IMAGE?`<img src="${e.url}" title="${chrome.i18n.getMessage("medias_capture")}"/>`:e.type_fichier===r.TypeFichier.LIEN?`<p class="poplab-capture-lien" title="${e.url}">${e.url}</p>`:e.type_fichier===r.TypeFichier.AUDIO?`<audio class="media-preview" src=${e.url} controls></audio>`:e.type_fichier===r.TypeFichier.VIDEO||e.type_fichier===r.TypeFichier.EXERCISEUR?`<iframe id="preview-iframe" src="${e.url}" title="${chrome.i18n.getMessage("medias_capture")}" style="max-width: 344px"></iframe>`:e.type_fichier===r.TypeFichier.FICHIER?`<p>Fichier : ${null!==(t=e.label)&&void 0!==t?t:e.subTypeFichier}</p>`:""}}},2438:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaPreview=void 0;const r=i(2688),n=i(1741);t.MediaPreview=class{constructor(e){this.idsMedias=[],this.menu=e,this.view=new n.MediaPreviewView(this)}createMediaPreview(){let e="";return this.menu.capture.mediaPreviews.length>0&&(1===this.menu.capture.mediaPreviews.length?this.isPreviewSupported(this.menu.capture.mediaPreviews[0].type_fichier)&&(e=this.view.createSingleMediaPreview(this.menu),this.idsMedias.push(this.menu.capture.mediaPreviews[0].id)):e=this.view.createManyMediaPreview(this.menu,this.idsMedias)),e}isPreviewSupported(e){return[r.TypeFichier.IMAGE,r.TypeFichier.AUDIO,r.TypeFichier.VIDEO,r.TypeFichier.LIEN,r.TypeFichier.EXERCISEUR,r.TypeFichier.FICHIER].includes(e)}getSelectedMediasIds(){return document.querySelectorAll('#poplab-popup input[type="radio"]:checked').forEach((e=>this.idsMedias.push(e.value))),this.idsMedias}listenToRadioButtons(){document.querySelectorAll(".radio-wrap").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),e.querySelector('input[type="radio"]').checked=!0}))}))}}},2638:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MenuCaptureView=void 0;const r=i(4056),n=i(4393),s=i(4911),o=i(4143);t.MenuCaptureView=class{constructor(e){this.controller=e}initializeDivCommonHtml(){this.controller.div.innerHTML="";const e=(0,s.fromHTML)(`\n      <div class="poplab-popup-body" id="poplab-popup-body">\n        <header>\n          <img src="${this.controller.images.logo}" class="poplab-logo-webclipper" />\n          <div class="close" id="poplab-popup-close"></div>\n        </header>\n      </div>`);this.controller.div.appendChild(e);const t=document.createElement("style");t.textContent=`\n    @font-face { \n      font-family: 'prompt';\n      src: url('${browser.runtime.getURL("styles/fonts/prompt-bold-webfont.woff2")}') format('woff2'),\n      url('${browser.runtime.getURL("styles/fonts/prompt-bold-webfont.woff")}') format('woff');\n      font-weight: 700;\n      font-style: normal;\n    }\n    \n    @font-face {\n      font-family: 'prompt';\n      src: url('${browser.runtime.getURL("styles/fonts/prompt-extralight-webfont.woff2")}') format('woff2'),\n      url('${browser.runtime.getURL("styles/fonts/prompt-extralight-webfont.woff")}') format('woff');\n      font-weight: 200;\n      font-style: normal;\n    }\n    \n    @font-face {\n      font-family: 'prompt';\n      src: url('${browser.runtime.getURL("styles/fonts/prompt-regular-webfont.woff2")}') format('woff2'),\n      url('${browser.runtime.getURL("styles/fonts/prompt-regular-webfont.woff")}') format('woff');\n      font-weight: normal;\n      font-style: normal;\n    }\n    \n    @font-face {\n      font-family: 'prompt';\n      src: url('${browser.runtime.getURL("styles/fonts/prompt-mediumitalic-webfont.woff2")}') format('woff2');\n      font-weight: 500;\n      font-style: italic;\n    }`,document.head.appendChild(t)}initializeRadioCapturesHtml(){return`\n    <form class="main" id="main-form">\n      <div class="form-context">\n        <div>\n          <h1 class="poplab-welcome">${chrome.i18n.getMessage("bonjour",this.controller.first_name)}</h1>\n          ${"POPLAB"!==this.controller.provenance?`<p class="poplab-provenance">${chrome.i18n.getMessage("provenance")}: ${this.controller.provenance}</p>`:""}\n        </div>\n        <h2 class="cible-capture">${chrome.i18n.getMessage("cible_capture")}</h2>\n      </div>\n    </form>`}createCapturePrevisualization(e,t){var i,r;let n="";return this.controller.capture instanceof o.CaptureBelinAPI&&(n=`${chrome.i18n.getMessage("non_selectionnables_partage_tout_le_web")}`),`\n      <form id="poplab-capture-form">\n        <div class="poplab-retour">\n          <img src="${this.controller.images.backArrow}" alt=""/>\n          <div>${chrome.i18n.getMessage("changer_option_capture")}</div>\n        </div>\n        <h1 class="description">${this.controller.desc_capture}</h1>\n        <div class="poplab-capture-body" id="poplab-capture-body">\n          <paginator-component id="poplab-paginator" elementsLength=${this.controller.capture.elementsLength} currentPage="${this.controller.capture.elementNumber}"></paginator-component>\n          ${e}\n        </div>\n        <div class="envoyer-capture-block">\n          <autocomplete-component id="poplab-autocomplete-destination" placeholder="${t}" nonSelectionnableReason="${n}"></autocomplete-component>\n          ${n?`<p class="non-selectionnable-text">${n}</p>`:""}\n          <button class="envoyer-capture" id="submit-button" type="submit" ${(null===(i=this.controller.capture)||void 0===i?void 0:i.isEmpty())?"disabled":""}>\n            <div class="button-texte ${(null===(r=this.controller.capture)||void 0===r?void 0:r.isEmpty())?"text-disabled":""}">${chrome.i18n.getMessage("bouton_capturer")}</div>\n            <img src="${this.controller.images.captureIcon}" alt=""/>\n          </button>\n        </div>\n      </form>`}renderAutocompleteDestinationItem(e){return`<div class="autocomplete-item ${!1===e.selectionnable?"not-selectionnable":""}" id="${e.id}">\n              <img src="${e.imageSrc?e.imageSrc:"document"===e.type?browser.runtime.getURL("images/file-logo.svg"):browser.runtime.getURL("images/folder-logo.svg")}"> \n              ${e.titre}\n            </div>`}createLoadingBar(){return'\n      <div class="timeout">\n        <div class="done"></div>\n      </div>'}createDoneHtml(e){return`\n      <div class="done-main">\n        <h1 class="confirmation-frigo">${chrome.i18n.getMessage("confirmation_frigo1")}</h1>\n        <img class="done-img" src="${this.controller.images.done}" />\n        <div class="done-buttons">\n          <button class="nouvelle-capture">\n            ${chrome.i18n.getMessage("nouvelle_capture")}\n            <img src="${this.controller.images.plusIcon}" alt="" />\n          </button>\n          ${"frigo"===e?`\n          <a href="${r.url_frigo}" id="go-destination" target="_blank">\n            ${chrome.i18n.getMessage("aller_frigo")}\n            <img src="${this.controller.images.frigoIcon}" alt="" />\n          </a>\n          `:"labo"===e?`\n          <a href="${r.url_labo}" id="go-destination" target="_blank">\n            ${chrome.i18n.getMessage("aller_labo")}\n            <img src="${this.controller.images.forwardArrow}" alt="" />\n          </a>\n          `:`\n          <a href="${this.controller.getUrlDocument(e)}" id="go-destination" target="_blank">\n            ${chrome.i18n.getMessage("aller_document")}\n            <img src="${this.controller.images.forwardArrow}" alt="" />\n          </a>\n          `}\n        </div>\n      </div>`}displayDocumentCapture(e){var t;if(null===(t=this.controller.capture)||void 0===t?void 0:t.isEmpty())return this.displayEmptyCapture();const i=this.controller.capture.data;return`\n    <div class="poplab-capture-output-type">${chrome.i18n.getMessage("document")}</div>\n    <div class="poplab-capture-form-block">\n      <label>\n        <div class="form-block-label-title">\n          <img src="${this.controller.images.titreLogo}" alt="" class="label-icon">\n          ${chrome.i18n.getMessage("titre_futur_element")}\n        </div>\n      </label>\n      <div id="poplab-titre-element" class="editable${this.controller.capture.editable?"":" disabled"}" contenteditable="${this.controller.capture.editable}">\n        ${this.controller.capture.data.titre}\n      </div>\n\n      <p class="poplab-capture-contains">${chrome.i18n.getMessage("recapitulatif_capture")}:</p>\n      <ul class="poplab-capture-contains-list">\n        ${i.elements.filter((e=>e.type===n.ElementType.SECTION)).length>0?`\n        <li>${i.elements.filter((e=>e.type===n.ElementType.SECTION)).length} ${chrome.i18n.getMessage("sections_capture")}</li>`:""}\n        ${i.elements.filter((e=>e.type===n.ElementType.ELEMENT)).length>0?`\n        <li>${i.elements.filter((e=>e.type===n.ElementType.ELEMENT)).length} ${chrome.i18n.getMessage("elements_capture")}</li>`:""}\n        ${e.map((e=>`<li>${e.count} ${chrome.i18n.getMessage(`${e.typeFichier.toLowerCase()}s_capture`)}</li>`)).join("")}\n      </ul>\n    </div>`}displayElementCapture(){var e;return(null===(e=this.controller.capture)||void 0===e?void 0:e.isEmpty())?this.displayEmptyCapture():`\n    <div class="poplab-capture-output-type">${chrome.i18n.getMessage("element")}</div>\n    <div class="poplab-capture-form-block">\n      <label>\n        <div class="form-block-label-title">\n          <img src="${this.controller.images.titreLogo}" alt="" class="label-icon">\n          ${chrome.i18n.getMessage("titre_futur_element")}\n        </div>\n        ${this.controller.capture.editable?`<a href="#" data-input="poplab-titre-element" class="poplab-selector">\n          <div>${chrome.i18n.getMessage("selectionner")}</div>\n          <img src="${this.controller.images.selector}" />\n        </a>`:""} \n      </label>\n      <div id="poplab-titre-element" class="editable${this.controller.capture.editable?"":" disabled"}" contenteditable="${this.controller.capture.editable}">\n        ${this.controller.capture.titre}\n      </div>\n    </div>\n\n    <div class="poplab-capture-form-block">\n      <label>\n        <div class="form-block-label-title">\n          <img src="${this.controller.images.descriptionLogo}" alt="" class="label-icon" />\n          ${chrome.i18n.getMessage("desc_futur_element")}\n        </div>\n        ${this.controller.capture.editable?`<a href="#" data-input="poplab-description-element" class="poplab-selector">\n          <div>${chrome.i18n.getMessage("selectionner")}</div>\n          <img src="${this.controller.images.selector}" />\n        </a>`:""}\n      </label>\n      <div id="poplab-description-element" class="editable${this.controller.capture.editable?"":" disabled"}" contenteditable="${this.controller.capture.editable}">\n        ${this.controller.capture.description}\n      </div>\n    </div>`}displayEmptyCapture(){return`<div>${browser.i18n.getMessage("rien_a_capturer")}</div>`}}},2483:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MenuCapture=void 0;const n=i(2143),s=i(6076),o=i(1443),a=i(2438),l=i(2638),c=i(4911),u=i(4056),d=i(2688),p=i(308),h=i(8033),m=i(9270),g=i(4143);class v{constructor(){this.done=browser.runtime.getURL("images/done.svg"),this.logo=browser.runtime.getURL("images/logo.svg"),this.selector=browser.runtime.getURL("images/selector.png"),this.belinLogo=browser.runtime.getURL("images/belin-logo.svg"),this.titreLogo=browser.runtime.getURL("images/titre-logo.svg"),this.descriptionLogo=browser.runtime.getURL("images/description-logo.svg"),this.backArrow=browser.runtime.getURL("images/back-arrow.svg"),this.forwardArrow=browser.runtime.getURL("images/forward-arrow.svg"),this.plusIcon=browser.runtime.getURL("images/plus-icon.svg"),this.frigoIcon=browser.runtime.getURL("images/frigo-icon.svg"),this.captureIcon=browser.runtime.getURL("images/capture-icon.svg"),this.mediaIcon=browser.runtime.getURL("images/media-icon.svg"),this.informationIcon=browser.runtime.getURL("images/information-icon.svg")}}t.MenuCapture=class{constructor(){this.images=new v,this.div=document.createElement("div"),this.view=new l.MenuCaptureView(this),this.div.id="poplab-popup",this.first_name="utilisateur mystérieux",this.provenance="",this.desc_capture="",this.busy=!1}show(){this.busy=!0,document.body.appendChild(this.div),this.displayCaptureTypesToUser(),window.requestAnimationFrame((()=>{window.requestAnimationFrame((()=>{const e=()=>{this.div.removeEventListener("transitionend",e),this.busy=!1};this.div.style.opacity="1",this.div.addEventListener("transitionend",e)}))})),document.body.addEventListener("click",(e=>{e.target.matches("#poplab-popup-close")&&this.hide()}))}hide(){this.visible&&!this.busy&&((0,c.clearHighlight)(),this.busy=!0,this.capture=void 0,this.mediaPreview=void 0,window.requestAnimationFrame((()=>{window.requestAnimationFrame((()=>{const e=()=>{this.div.removeEventListener("transitionend",e),this.div.className="",this.div.innerHTML="",document.body.removeChild(document.body.querySelector("#poplab-popup")),this.busy=!1};this.div.style.opacity="0",this.div.addEventListener("transitionend",e)}))})))}refreshCapture(){var e,t;this.mediaPreview=void 0,this.div.className="",(null===(e=this.capture)||void 0===e?void 0:e.elementNumber)&&(this.capture.elementNumber=0),this.capture instanceof m.CaptureApiCall&&(this.capture.apiResponse=void 0),null===(t=this.capture)||void 0===t||t.startCapture()}displayCaptureTypesToUser(e=!0){if(this.view.initializeDivCommonHtml(),!this.capture&&e&&0===document.URL.indexOf("https://www.youtube.com/watch?v="))return this.capture=new o.CaptureYoutube(this),void this.capture.startCapture();this.capture=void 0,this.mediaPreview=void 0,this.div.querySelector("#poplab-popup-body").appendChild((0,c.fromHTML)(this.view.initializeRadioCapturesHtml())),(0,s.createRadioButtons)(this)}displayCaptureInfos(){var e,t,i,r,s;this.view.initializeDivCommonHtml(),this.mediaPreview=new a.MediaPreview(this);const o=this.div.querySelector("#poplab-popup-body"),l=this.capture.data instanceof d.ElementCaptureData?browser.i18n.getMessage("dossier_par_defaut_element"):browser.i18n.getMessage("dossier_par_defaut_document");o.appendChild((0,c.fromHTML)(this.view.createCapturePrevisualization(this.mediaPreview.createMediaPreview(),l))),document.getElementById("poplab-popup").appendChild((0,c.fromHTML)(this.view.createLoadingBar()));const u=this.div.querySelector("#poplab-capture-body");if(this.capture.data instanceof d.ElementCaptureData){const e=(0,c.fromHTML)(this.view.displayElementCapture());e instanceof HTMLCollection?Array.from(e).forEach((e=>{u.appendChild(e)})):u.appendChild(e),this.div.querySelector("#submit-button").addEventListener("click",(e=>{var t;null==this.destination&&(this.destination=new p.ArborescenceFrigo),this.commonCaptureSubmitProcess(e);const i=this.div.querySelector("#poplab-titre-element").innerText,r=this.div.querySelector("#poplab-description-element").innerHTML;this.capture.sendCaptureToPoplab(this.destination,{titre:i,description:r,mediasIds:(null===(t=this.mediaPreview)||void 0===t?void 0:t.getSelectedMediasIds())||[]})}))}else if(this.capture.data instanceof d.DocumentCaptureData){let e=[];this.capture.data.elements.forEach((t=>{e=e.concat(t.getAllEmbeds())}));const t=(0,c.getCountPerFileType)(e),i=(0,c.fromHTML)(this.view.displayDocumentCapture(t));i instanceof HTMLCollection?Array.from(i).forEach((e=>{u.appendChild(e)})):u.appendChild(i),this.div.querySelector("#submit-button").addEventListener("click",(e=>{null==this.destination&&(this.destination=new p.ArborescenceLabo),this.commonCaptureSubmitProcess(e),this.capture.sendCaptureToPoplab(this.destination)}))}null!=this.mediaPreview&&this.mediaPreview.listenToRadioButtons(),null===(e=this.div.querySelector("#poplab-paginator"))||void 0===e||e.addEventListener("page-changed",(e=>{const t=e;this.capture.elementNumber=t.detail.currentPage,this.div.querySelector(".timeout").classList.add("chargement"),this.capture.startCapture()}));const h=this.div.querySelector("#poplab-autocomplete-destination");h&&(this.capture.data instanceof d.ElementCaptureData&&"labo"===(null===(t=this.destination)||void 0===t?void 0:t.id)?this.destination=new p.ArborescenceFrigo:this.capture.data instanceof d.DocumentCaptureData&&"frigo"===(null===(i=this.destination)||void 0===i?void 0:i.id)&&(this.destination=new p.ArborescenceLabo),h.setSelectedOption(this.destination),h.setRenderItemFunction(this.view.renderAutocompleteDestinationItem),h.setFetchFilteredOptions(this.fetchFilteredArborescence.bind(this)),h.setFetchDefaultOptions(this.fetchDefaultArborescence.bind(this)),null===(r=this.div.querySelector("#poplab-autocomplete-destination"))||void 0===r||r.addEventListener("selection-changed",(e=>{const t=e;this.destination=t.detail.selection}))),this.div.querySelector(".poplab-retour").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.busy||this.displayCaptureTypesToUser(!1)})),this.capture.mediaPreviews&&this.capture.recapturable&&(null===(s=this.div.querySelector(".recapturer"))||void 0===s||s.addEventListener("click",(()=>{this.busy||this.capture.startCapture()})));const m=this.div.querySelectorAll(".poplab-selector");for(const e of m)e.addEventListener("click",(e=>{e.preventDefault(),this.busy||new n.CaptureTexte(this,(t=>{null!=t&&(this.div.querySelector("#"+e.target.closest(".poplab-selector").dataset.input).innerText=t)})).startCapture()}))}commonCaptureSubmitProcess(e){e.preventDefault(),this.disableInputsAndButtons()}disableInputsAndButtons(){this.div.querySelector(".envoyer-capture").disabled=!0,this.div.querySelector(".timeout").classList.add("chargement"),this.div.classList.add("disabled");for(const e of this.div.querySelectorAll("div.editable"))e.classList.add("disabled"),e.contentEditable="false"}displaySuccessPage(e){this.destination=void 0,this.old_capture=void 0,this.div.className="poplab-done",this.view.initializeDivCommonHtml(),this.div.querySelector("#poplab-popup-body").appendChild((0,c.fromHTML)(this.view.createDoneHtml(e))),this.busy=!1,this.div.querySelector(".nouvelle-capture").addEventListener("click",(()=>{this.div.className="",this.displayCaptureTypesToUser()}))}get visible(){return null!=document.querySelector("#poplab-popup")}getUrlDocument(e){return`${u.base_url_front}/labo/mes-documents/${e}/edition`}fetchFilteredArborescence(e){return r(this,void 0,void 0,(function*(){let t;return t=this.capture instanceof g.CaptureBelinAPI?yield browser.runtime.sendMessage(new h.BrowserRuntimeMessageSearchArborescenceWithSelectionnable(e)):yield browser.runtime.sendMessage(new h.BrowserRuntimeMessageSearchArborescence(e)),t=t.map((e=>new p.Arborescence(e))),t}))}fetchDefaultArborescence(){return r(this,void 0,void 0,(function*(){let e;return e=this.capture instanceof g.CaptureBelinAPI?yield browser.runtime.sendMessage(new h.BrowserRuntimeMessageGetRecentArborescenceWithSelectionnable):yield browser.runtime.sendMessage(new h.BrowserRuntimeMessageGetRecentArborescence),e=e.map((e=>new p.Arborescence(e))),this.capture.data instanceof d.ElementCaptureData?e.unshift(new p.ArborescenceFrigo):e.unshift(new p.ArborescenceLabo),e}))}}},6076:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRadioButtons=void 0;const r=i(7610),n=i(7200),s=i(3719),o=i(1443),a=i(2181),l=i(4143),c=i(4056),u=i(4911);t.createRadioButtons=function(e){const t=function(e){const t=[],i=[{affichageMenu:chrome.i18n.getMessage("choix_capture_page"),id:"capture-page",setupCapture:()=>{e.desc_capture=chrome.i18n.getMessage("choix_capture_page"),e.capture=new r.CaptureLien(e);const t=document.querySelector('meta[name="description"]');t&&(e.capture.description=t.content),e.capture.startCapture()}},{affichageMenu:chrome.i18n.getMessage("choix_capture_zone"),id:"capture-zone",setupCapture:()=>{e.desc_capture=chrome.i18n.getMessage("choix_capture_zone"),e.capture=new n.CaptureZone(e),e.capture.startCapture()}}];if(t.push(i),document.getElementsByTagName("img").length>0&&i.push({affichageMenu:chrome.i18n.getMessage("choix_capture_image"),id:"capture-image",setupCapture:()=>{e.desc_capture=chrome.i18n.getMessage("choix_capture_image"),e.capture=new s.CaptureImage(e),e.capture.startCapture()}}),document.getElementsByTagName("video").length>0&&i.push({affichageMenu:chrome.i18n.getMessage("choix_capture_video"),id:"capture-video",setupCapture:()=>{e.desc_capture=chrome.i18n.getMessage("choix_capture_video"),0===document.URL.indexOf("https://www.youtube.com/watch?v=")?e.capture=new o.CaptureYoutube(e):e.capture=new a.CaptureVideo(e),e.capture.startCapture()}}),document.URL.startsWith(c.url_belin)){const i=[];i.push({affichageMenu:`<div class="capture-belin">\n                        <span>${chrome.i18n.getMessage("importer_contenu")} <span class="font-weight-700">${chrome.i18n.getMessage("manuel_max")}</span></div> \n                        <img src="${e.images.belinLogo}" class="partner-logo" alt=""/>\n                      </div>`,detail:`<p class="cgu-belin detail-menu">\n                 ${chrome.i18n.getMessage("vaut_acceptation_des")} \n                 <a href="https://manuelnumeriquemax.belin.education/cgu" target="_blank" id="cgu-belin">${chrome.i18n.getMessage("CGU_Belin")}</a>\n               </p>`,radioBlockClass:"radios-block-belin",ownBlock:!0,id:"capture-belin",setupCapture:()=>{e.desc_capture=`<img src="${e.images.belinLogo}" style="width: 24px; height: 24px; vertical-align: middle" alt=""/> ${chrome.i18n.getMessage("choix_capture_belin")}`,e.capture=new l.CaptureBelinAPI(e,0),e.capture.startCapture()}}),t.unshift(i)}return t}(e),i=document.createElement("div");i.className="form-buttons",e.div.querySelector("#main-form").appendChild(i),t.forEach((e=>{var t;const r=document.createElement("div");r.className="radios-block",(null===(t=e[0])||void 0===t?void 0:t.radioBlockClass)&&(r.className+=` ${e[0].radioBlockClass}`),i.appendChild(r),e.forEach((e=>function(e,t){const i=document.createElement("button");i.className="radio-wrap",i.id=`button-${e.id}`,i.appendChild((0,u.fromHTML)(`\n      <label class="radio">\n        <input type="radio" name="type-capture-poplab" id="radio-${e.id}"/>\n        <div class="contour-radio">\n          <div class="bg-radio"></div>\n        </div>\n        <p>${e.affichageMenu}</p>\n      </label>`)),e.detail&&i.appendChild((0,u.fromHTML)(e.detail)),i.addEventListener("click",(e=>{const t=e.target;if("A"===t.tagName){const e=t;"_blank"===e.target?window.open(e.href,"_blank"):window.location.href=e.href}e.preventDefault(),i.querySelector('input[type="radio"]').checked=!0})),t.appendChild(i)}(e,r)))})),e.div.querySelector('input[type="radio"]').checked=!0,function(e,t){const i=document.createElement("button");i.className="demarrer-capture",i.innerHTML=`<div class="button-texte">${chrome.i18n.getMessage("demarrer_capture")}</div><img class="demarrer-capture-img" src="${t.images.plusIcon}" alt=""/>`,i.addEventListener("click",(i=>{i.preventDefault();const r=t.div.querySelector('input[type="radio"]:checked').id.replace("radio-","");e.filter((e=>e.id===r))[0].setupCapture()})),t.div.getElementsByClassName("poplab-popup-body")[0].appendChild(i)}(t.flat(),e)}},4911:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fromHTML=t.clearHighlight=t.smoothScrollToTargetedHtmlElement=t.hasSameFileTypeMoreThanOnce=t.getCountPerFileType=void 0;const r=i(2688);function n(e){return Object.entries(e.reduce(((e,t)=>{const i=t.type_fichier;return e[i]=(e[i]||0)+1,e}),{})).map((([e,t])=>({typeFichier:e,count:t})))}t.getCountPerFileType=n,t.hasSameFileTypeMoreThanOnce=function(e){const t=n(e);return t.filter((e=>e.count>1)).length>0||2===t.filter((e=>e.typeFichier===r.TypeFichier.IMAGE||e.typeFichier===r.TypeFichier.VIDEO)).length};t.smoothScrollToTargetedHtmlElement=function(e,t=0){const i=document.querySelector(`#${e}`);if(i){const e=function(e){let t=e.parentElement;for(;t;){const e=window.getComputedStyle(t);if("auto"===e.overflowY||"scroll"===e.overflowY)return t;t=t.parentElement}return null}(i);if(e){let r=i.getBoundingClientRect().top+e.scrollTop-t;r>e.scrollHeight-e.getBoundingClientRect().height&&(r=e.scrollHeight-e.getBoundingClientRect().height),a(Math.floor(r),e).then((()=>o(i)))}else{let e=i.getBoundingClientRect().top+window.scrollY-t;const r=function(){const e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)-window.innerHeight-40}();e>r&&(e=r),a(Math.floor(e)).then((()=>o(i)))}}};let s=null;function o(e){s&&s.classList.remove("poplab-highlighted"),s=e;let t=document.getElementById("poplab-highlight-stylesheet");t||(t=document.createElement("style"),t.id="poplab-highlight-stylesheet",t.textContent="\n        .poplab-highlighted {\n            border: solid 8px rgb(75, 198, 185);\n        }",document.head.appendChild(t)),setTimeout((()=>{e.classList.add("poplab-highlighted")}),100)}function a(e,t){return t?t.scrollTo({top:e,behavior:"smooth"}):window.scrollTo({top:e,behavior:"smooth"}),new Promise((i=>{const r=()=>{t?Math.floor(t.scrollTop)!==e&&Math.ceil(t.scrollTop)!==e||(t.removeEventListener("scroll",r),i()):Math.floor(window.scrollY)!==e&&Math.ceil(window.scrollY)!==e||(window.removeEventListener("scroll",r),i())};t?(t.removeEventListener("scroll",r),Math.floor(t.scrollTop)===e||Math.ceil(t.scrollTop)===e?i():t.addEventListener("scroll",r)):(window.removeEventListener("scroll",r),Math.floor(window.scrollY)===e||Math.ceil(window.scrollY)===e?i():window.addEventListener("scroll",r))}))}t.clearHighlight=function(){var e;const t=document.getElementById("poplab-highlight-stylesheet");t&&(null===(e=t.parentNode)||void 0===e||e.removeChild(t))},t.fromHTML=function(e){if(!e)return null;const t=document.createElement("template");t.innerHTML=e;const i=t.content.children;return 1===i.length?i[0]:i}},2688:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentCaptureData=t.ElementCaptureData=t.CaptureData=t.FichierMediaObject=t.ExerciseurMediaObject=t.UrlMediaObject=t.AudioMediaObject=t.VideoMediaObject=t.ImageMediaObject=t.MediaObject=t.TypeFichier=t.CaptureType=void 0;const r=i(4393);var n,s;!function(e){e.BASIQUE="BASIQUE",e.UPLOAD="UPLOAD"}(n||(t.CaptureType=n={})),function(e){e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.FICHIER="FICHIER",e.LIEN="LIEN",e.EXERCISEUR="EXERCISEUR"}(s||(t.TypeFichier=s={}));class o{constructor(e,t,i,r,n,s,o){this.id=e,this.url=t,this.type_fichier=i,this.copyright=r,this.file=n,this.editeur=s,this.subTypeFichier=o}}t.MediaObject=o,t.ImageMediaObject=class extends o{constructor(e,t,i,r,n){super(e,t,s.IMAGE,i,r,n)}},t.VideoMediaObject=class extends o{constructor(e,t,i,r,n){super(e,t,s.VIDEO,i,r,n)}},t.AudioMediaObject=class extends o{constructor(e,t,i,r,n){super(e,t,s.AUDIO,i,r,n)}},t.UrlMediaObject=class extends o{constructor(e,t,i,r){super(e,t,s.LIEN,i),this.displayPreview=!1,this.bigPreview=!1,this.label=r}},t.ExerciseurMediaObject=class extends o{constructor(e,t,i){super(e,t,s.EXERCISEUR),this.typeExerciseur=i}},t.FichierMediaObject=class extends o{constructor(e,t,i,r,n){super(e,t,s.FICHIER,void 0,i,void 0,r),this.label=n}};class a{constructor(e,t,i){this.titre=e,this.description=t,this.auteurInitial=i}}t.CaptureData=a;class l extends a{constructor(e){var t,i,n,s,o,a,l;super(null==e?void 0:e.titre,null==e?void 0:e.description,null==e?void 0:e.auteurInitial),this.type=r.ElementType.ELEMENT,this.images=[],this.videos=[],this.audios=[],this.urls=[],this.exerciseurs=[],this.fichiers=[],this.credit=null==e?void 0:e.credit,this.images=null!==(t=null==e?void 0:e.images)&&void 0!==t?t:[],this.videos=null!==(i=null==e?void 0:e.videos)&&void 0!==i?i:[],this.audios=null!==(n=null==e?void 0:e.audios)&&void 0!==n?n:[],this.urls=null!==(s=null==e?void 0:e.urls)&&void 0!==s?s:[],this.exerciseurs=null!==(o=null==e?void 0:e.exerciseurs)&&void 0!==o?o:[],this.fichiers=null!==(a=null==e?void 0:e.fichiers)&&void 0!==a?a:[],this.type=null!==(l=null==e?void 0:e.type)&&void 0!==l?l:r.ElementType.ELEMENT,this.options=null==e?void 0:e.options,this.meta=null==e?void 0:e.meta}setTitre(e){return this.titre=e,this}setDescription(e){return this.description=e,this}setCredit(e){return this.credit=e,this}setImages(e){return this.images=e,this}setVideos(e){return this.videos=e,this}setAudios(e){return this.audios=e,this}setUrls(e){return this.urls=e,this}setExerciseurs(e){return this.exerciseurs=e,this}setType(e){return this.type=e,this}getMedias(){return this.images.concat(this.videos.concat(this.audios.concat(this.fichiers)))}getAllEmbeds(){return this.getMedias().concat(this.urls).concat(this.exerciseurs)}}t.ElementCaptureData=l,t.DocumentCaptureData=class extends a{constructor(e){super(null==e?void 0:e.titre,null==e?void 0:e.description,null==e?void 0:e.auteurInitial),this.elements=[],null==e||e.elements.forEach((e=>this.elements.push(new l(e)))),this.meta=null==e?void 0:e.meta}setTitre(e){return this.titre=e,this}setDescription(e){return this.description=e,this}setElements(e){return this.elements=e,this}}},8033:(e,t)=>{var i,r,n,s,o;Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserContextMenusId=t.MessageOngletDone=t.MessageOnglet=t.MessageOngletType=t.BrowserRuntimeResponse=t.BrowserRuntimeMessageSearchArborescenceWithSelectionnable=t.BrowserRuntimeMessageSearchArborescence=t.BrowserRuntimeMessageGetRecentArborescenceWithSelectionnable=t.BrowserRuntimeMessageGetRecentArborescence=t.BrowserRuntimeMessageForPoplab=t.BrowserRuntimeMessage=t.BrowserRuntimeMessageEventSubType=t.BrowserRuntimeMessageEventType=void 0,function(e){e.STATUS="status",e.CONNECT="connect",e.ENVOYER_SUR_POPLAB="envoyer_sur_poplab",e.CAPTURE_TAB="captureTab",e.GET_RECENT_ARBORESCENCE="getRecentHierarchies",e.SEARCH_ARBORESCENCE="searchArborescence"}(i||(t.BrowserRuntimeMessageEventType=i={})),function(e){e.WITH_SELECTIONNABLE="WithSelectionnable"}(r||(t.BrowserRuntimeMessageEventSubType=r={}));class a{constructor(e,t,i){this.type=e,this.subType=t,this.idp=i}}t.BrowserRuntimeMessage=a,t.BrowserRuntimeMessageForPoplab=class extends a{constructor(e,t,r,n){super(i.ENVOYER_SUR_POPLAB),this.type_item_poplab=e,this.type_capture=t,this.data=r,this.destination=n}},t.BrowserRuntimeMessageGetRecentArborescence=class extends a{constructor(){super(i.GET_RECENT_ARBORESCENCE)}},t.BrowserRuntimeMessageGetRecentArborescenceWithSelectionnable=class extends a{constructor(){super(i.GET_RECENT_ARBORESCENCE,r.WITH_SELECTIONNABLE)}};class l extends a{constructor(e,t,i){super(t,i),this.value=e}}t.BrowserRuntimeMessageSearchArborescence=class extends l{constructor(e){super(e,i.SEARCH_ARBORESCENCE)}},t.BrowserRuntimeMessageSearchArborescenceWithSelectionnable=class extends l{constructor(e){super(e,i.SEARCH_ARBORESCENCE,r.WITH_SELECTIONNABLE)}},function(e){e.INTERDIT="interdit",e.DECONNECTE="déconnecté",e.CONNECTE="connecté",e.ENVOYE="envoyé"}(n||(t.BrowserRuntimeResponse=n={})),function(e){e.STOP_CAPTURE="stopCapture",e.CAPTURER_LIEN="capturerLien",e.CAPTURER_IMAGE="capturerImage",e.CAPTURER_VIDEO="capturerVideo",e.TOGGLE_CAPTURE="toggleCapture",e.START_CAPTURE="startCapture",e.UPLOAD_FRIGO_DONE="uploadFrigoDone",e.CANCEL_UPLOAD="cancelUpload",e.REFRESH_CAPTURE="refreshCapture"}(s||(t.MessageOngletType=s={}));class c{constructor(e,t,i){this.first_name=void 0,this.provenance=void 0,this.type=e,this.first_name=t,this.provenance=i}}t.MessageOnglet=c,t.MessageOngletDone=class extends c{constructor(e,t){super(e),this.documentId=t}},function(e){e.SE_DECONNECTER="se-deconnecter",e.VOIR_FRIGO="voir-frigo",e.ENVOYER_LIEN="envoyer-lien",e.ENVOYER_IMAGE="envoyer-image",e.ENVOYER_VIDEO="envoyer-video"}(o||(t.BrowserContextMenusId=o={}))},308:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.ArborescenceLabo=t.ArborescenceFrigo=t.Arborescence=t.ArborescenceType=void 0;const n=i(1218);var s;!function(e){e.DOCUMENT="document",e.DOSSIER="dossier"}(s||(t.ArborescenceType=s={}));let o=class{constructor(e){this.id=e.id,this.titre=e.titre,this.type=e.type,this.selectionnable=e.selectionnable}};t.Arborescence=o,t.Arborescence=o=r([(0,n.SelectableOptionClass)("id","titre")],o);let a=class extends o{constructor(){super({id:"frigo",titre:chrome.i18n.getMessage("frigo"),type:s.DOSSIER}),this.imageSrc=browser.runtime.getURL("images/fridge.svg")}};t.ArborescenceFrigo=a,t.ArborescenceFrigo=a=r([(0,n.SelectableOptionClass)("id","titre")],a);let l=class extends o{constructor(){super({id:"labo",titre:chrome.i18n.getMessage("labo"),type:s.DOSSIER}),this.imageSrc=browser.runtime.getURL("images/labo.svg")}};t.ArborescenceLabo=l,t.ArborescenceLabo=l=r([(0,n.SelectableOptionClass)("id","titre")],l)},1142:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.AuteurInitial=t.Auteur=void 0,t.Auteur=class{constructor(e,t){this.username=e,this.userId=t}},function(e){e.BELIN="© Belin Éducation / Humensis"}(i||(t.AuteurInitial=i={}))},4393:(e,t)=>{var i,r,n,s;Object.defineProperty(t,"__esModule",{value:!0}),t.Editeur=t.ElementType=t.ExerciseurType=t.PoplabElementCreationRequest=void 0,t.PoplabElementCreationRequest=class{constructor(e,t){var r,s,o;this.titre=null!==(r=e.titre)&&void 0!==r?r:"",this.description=null!==(s=e.description)&&void 0!==s?s:"",this.type=e.type,this.options={isnew:!0,separator:!1},this.type!==n.SECTION||this.titre||(this.options.separator=!0),this.credits=null!==(o=e.credit)&&void 0!==o?o:"",this.webAuteurInitial=e.auteurInitial,this.imageEmbed=e.images[0]?{url:e.images[0].url,type:i.IMAGE}:void 0,this.videoEmbed=e.videos[0]?{url:e.videos[0].url,type:i.VIDEO}:void 0,this.audioEmbed=e.audios[0]?{url:e.audios[0].url,type:i.AUDIO}:void 0,this.lienEmbed=e.urls[0]?{url:e.urls[0].url,label:e.urls[0].label,displayPreview:e.urls[0].displayPreview,bigPreview:e.urls[0].bigPreview,type:i.LIEN}:void 0,this.exerciseur=e.exerciseurs[0]?{url:e.exerciseurs[0].url,exerciseurType:e.exerciseurs[0].typeExerciseur,type:i.EXERCISEUR}:void 0,t&&(this.document=t),this.meta=e.meta}},function(e){e.LIEN="LIEN",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.FICHIER="FICHIER",e.EXERCISEUR="EXERCISEUR"}(i||(i={})),function(e){e.QUIZLET="QUIZLET",e.LEARNINGAPPS="LEARNINGAPPS",e.GENIALLY="GENIALLY",e.BOOKWIDGETS="BOOKWIDGETS",e.EDUPOOL="EDUPOOL",e.BELIN="BELIN"}(r||(t.ExerciseurType=r={})),function(e){e.ELEMENT="element",e.SECTION="section"}(n||(t.ElementType=n={})),function(e){e.BELIN="https://www.belin-education.com/"}(s||(t.Editeur=s={}))},853:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.PoplabObjectType=void 0,function(e){e.ELEMENT="ELEMENT",e.DOCUMENT="DOCUMENT"}(i||(t.PoplabObjectType=i={}))}},t={};!function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}(2483)})();