{"version":3,"file":"background.js","sources":["../../node_modules/.pnpm/wxt@0.19.13_@types+node@22.8.1_rollup@4.24.1_terser@5.31.1_webpack-sources@3.2.3/node_modules/wxt/dist/sandbox/define-background.mjs","../../node_modules/.pnpm/webextension-polyfill@0.12.0/node_modules/webextension-polyfill/dist/browser-polyfill.js","../../src/types/message.ts","../../src/utils/tab.ts","../../src/highlighter/util/color.ts","../../src/types/userSettings.ts","../../src/store/userSettings.ts","../../node_modules/.pnpm/idb@8.0.0/node_modules/idb/build/index.js","../../src/store/errorLogs.ts","../../src/utils/log.ts","../../src/store/highlights.ts","../../src/api/api.ts","../../src/api/obsidian.ts","../../src/utils/message.ts","../../src/entrypoints/background.ts"],"sourcesContent":["export function defineBackground(arg) {\n  if (arg == null || typeof arg === \"function\") return { main: arg };\n  return arg;\n}\n","(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define(\"webextension-polyfill\", [\"module\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(module);\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(mod);\n    global.browser = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (module) {\n  /* webextension-polyfill - v0.12.0 - Tue May 14 2024 18:01:29 */\n  /* -*- Mode: indent-tabs-mode: nil; js-indent-level: 2 -*- */\n  /* vim: set sts=2 sw=2 et tw=80: */\n  /* This Source Code Form is subject to the terms of the Mozilla Public\n   * License, v. 2.0. If a copy of the MPL was not distributed with this\n   * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n  \"use strict\";\n\n  if (!(globalThis.chrome && globalThis.chrome.runtime && globalThis.chrome.runtime.id)) {\n    throw new Error(\"This script should only be loaded in a browser extension.\");\n  }\n  if (!(globalThis.browser && globalThis.browser.runtime && globalThis.browser.runtime.id)) {\n    const CHROME_SEND_MESSAGE_CALLBACK_NO_RESPONSE_MESSAGE = \"The message port closed before a response was received.\";\n\n    // Wrapping the bulk of this polyfill in a one-time-use function is a minor\n    // optimization for Firefox. Since Spidermonkey does not fully parse the\n    // contents of a function until the first time it's called, and since it will\n    // never actually need to be called, this allows the polyfill to be included\n    // in Firefox nearly for free.\n    const wrapAPIs = extensionAPIs => {\n      // NOTE: apiMetadata is associated to the content of the api-metadata.json file\n      // at build time by replacing the following \"include\" with the content of the\n      // JSON file.\n      const apiMetadata = {\n        \"alarms\": {\n          \"clear\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"clearAll\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"get\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"getAll\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          }\n        },\n        \"bookmarks\": {\n          \"create\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"get\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getChildren\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getRecent\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getSubTree\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getTree\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"move\": {\n            \"minArgs\": 2,\n            \"maxArgs\": 2\n          },\n          \"remove\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"removeTree\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"search\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"update\": {\n            \"minArgs\": 2,\n            \"maxArgs\": 2\n          }\n        },\n        \"browserAction\": {\n          \"disable\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1,\n            \"fallbackToNoCallback\": true\n          },\n          \"enable\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1,\n            \"fallbackToNoCallback\": true\n          },\n          \"getBadgeBackgroundColor\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getBadgeText\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getPopup\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getTitle\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"openPopup\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"setBadgeBackgroundColor\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1,\n            \"fallbackToNoCallback\": true\n          },\n          \"setBadgeText\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1,\n            \"fallbackToNoCallback\": true\n          },\n          \"setIcon\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"setPopup\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1,\n            \"fallbackToNoCallback\": true\n          },\n          \"setTitle\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1,\n            \"fallbackToNoCallback\": true\n          }\n        },\n        \"browsingData\": {\n          \"remove\": {\n            \"minArgs\": 2,\n            \"maxArgs\": 2\n          },\n          \"removeCache\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"removeCookies\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"removeDownloads\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"removeFormData\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"removeHistory\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"removeLocalStorage\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"removePasswords\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"removePluginData\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"settings\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          }\n        },\n        \"commands\": {\n          \"getAll\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          }\n        },\n        \"contextMenus\": {\n          \"remove\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"removeAll\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"update\": {\n            \"minArgs\": 2,\n            \"maxArgs\": 2\n          }\n        },\n        \"cookies\": {\n          \"get\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getAll\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getAllCookieStores\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"remove\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"set\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          }\n        },\n        \"devtools\": {\n          \"inspectedWindow\": {\n            \"eval\": {\n              \"minArgs\": 1,\n              \"maxArgs\": 2,\n              \"singleCallbackArg\": false\n            }\n          },\n          \"panels\": {\n            \"create\": {\n              \"minArgs\": 3,\n              \"maxArgs\": 3,\n              \"singleCallbackArg\": true\n            },\n            \"elements\": {\n              \"createSidebarPane\": {\n                \"minArgs\": 1,\n                \"maxArgs\": 1\n              }\n            }\n          }\n        },\n        \"downloads\": {\n          \"cancel\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"download\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"erase\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getFileIcon\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 2\n          },\n          \"open\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1,\n            \"fallbackToNoCallback\": true\n          },\n          \"pause\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"removeFile\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"resume\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"search\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"show\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1,\n            \"fallbackToNoCallback\": true\n          }\n        },\n        \"extension\": {\n          \"isAllowedFileSchemeAccess\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"isAllowedIncognitoAccess\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          }\n        },\n        \"history\": {\n          \"addUrl\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"deleteAll\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"deleteRange\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"deleteUrl\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getVisits\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"search\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          }\n        },\n        \"i18n\": {\n          \"detectLanguage\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getAcceptLanguages\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          }\n        },\n        \"identity\": {\n          \"launchWebAuthFlow\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          }\n        },\n        \"idle\": {\n          \"queryState\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          }\n        },\n        \"management\": {\n          \"get\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getAll\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"getSelf\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"setEnabled\": {\n            \"minArgs\": 2,\n            \"maxArgs\": 2\n          },\n          \"uninstallSelf\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          }\n        },\n        \"notifications\": {\n          \"clear\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"create\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 2\n          },\n          \"getAll\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"getPermissionLevel\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"update\": {\n            \"minArgs\": 2,\n            \"maxArgs\": 2\n          }\n        },\n        \"pageAction\": {\n          \"getPopup\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getTitle\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"hide\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1,\n            \"fallbackToNoCallback\": true\n          },\n          \"setIcon\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"setPopup\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1,\n            \"fallbackToNoCallback\": true\n          },\n          \"setTitle\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1,\n            \"fallbackToNoCallback\": true\n          },\n          \"show\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1,\n            \"fallbackToNoCallback\": true\n          }\n        },\n        \"permissions\": {\n          \"contains\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getAll\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"remove\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"request\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          }\n        },\n        \"runtime\": {\n          \"getBackgroundPage\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"getPlatformInfo\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"openOptionsPage\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"requestUpdateCheck\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"sendMessage\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 3\n          },\n          \"sendNativeMessage\": {\n            \"minArgs\": 2,\n            \"maxArgs\": 2\n          },\n          \"setUninstallURL\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          }\n        },\n        \"sessions\": {\n          \"getDevices\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"getRecentlyClosed\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"restore\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          }\n        },\n        \"storage\": {\n          \"local\": {\n            \"clear\": {\n              \"minArgs\": 0,\n              \"maxArgs\": 0\n            },\n            \"get\": {\n              \"minArgs\": 0,\n              \"maxArgs\": 1\n            },\n            \"getBytesInUse\": {\n              \"minArgs\": 0,\n              \"maxArgs\": 1\n            },\n            \"remove\": {\n              \"minArgs\": 1,\n              \"maxArgs\": 1\n            },\n            \"set\": {\n              \"minArgs\": 1,\n              \"maxArgs\": 1\n            }\n          },\n          \"managed\": {\n            \"get\": {\n              \"minArgs\": 0,\n              \"maxArgs\": 1\n            },\n            \"getBytesInUse\": {\n              \"minArgs\": 0,\n              \"maxArgs\": 1\n            }\n          },\n          \"sync\": {\n            \"clear\": {\n              \"minArgs\": 0,\n              \"maxArgs\": 0\n            },\n            \"get\": {\n              \"minArgs\": 0,\n              \"maxArgs\": 1\n            },\n            \"getBytesInUse\": {\n              \"minArgs\": 0,\n              \"maxArgs\": 1\n            },\n            \"remove\": {\n              \"minArgs\": 1,\n              \"maxArgs\": 1\n            },\n            \"set\": {\n              \"minArgs\": 1,\n              \"maxArgs\": 1\n            }\n          }\n        },\n        \"tabs\": {\n          \"captureVisibleTab\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 2\n          },\n          \"create\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"detectLanguage\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"discard\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"duplicate\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"executeScript\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 2\n          },\n          \"get\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getCurrent\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"getZoom\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"getZoomSettings\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"goBack\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"goForward\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"highlight\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"insertCSS\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 2\n          },\n          \"move\": {\n            \"minArgs\": 2,\n            \"maxArgs\": 2\n          },\n          \"query\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"reload\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 2\n          },\n          \"remove\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"removeCSS\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 2\n          },\n          \"sendMessage\": {\n            \"minArgs\": 2,\n            \"maxArgs\": 3\n          },\n          \"setZoom\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 2\n          },\n          \"setZoomSettings\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 2\n          },\n          \"update\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 2\n          }\n        },\n        \"topSites\": {\n          \"get\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          }\n        },\n        \"webNavigation\": {\n          \"getAllFrames\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"getFrame\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          }\n        },\n        \"webRequest\": {\n          \"handlerBehaviorChanged\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          }\n        },\n        \"windows\": {\n          \"create\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"get\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 2\n          },\n          \"getAll\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"getCurrent\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"getLastFocused\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"remove\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"update\": {\n            \"minArgs\": 2,\n            \"maxArgs\": 2\n          }\n        }\n      };\n      if (Object.keys(apiMetadata).length === 0) {\n        throw new Error(\"api-metadata.json has not been included in browser-polyfill\");\n      }\n\n      /**\n       * A WeakMap subclass which creates and stores a value for any key which does\n       * not exist when accessed, but behaves exactly as an ordinary WeakMap\n       * otherwise.\n       *\n       * @param {function} createItem\n       *        A function which will be called in order to create the value for any\n       *        key which does not exist, the first time it is accessed. The\n       *        function receives, as its only argument, the key being created.\n       */\n      class DefaultWeakMap extends WeakMap {\n        constructor(createItem, items = undefined) {\n          super(items);\n          this.createItem = createItem;\n        }\n        get(key) {\n          if (!this.has(key)) {\n            this.set(key, this.createItem(key));\n          }\n          return super.get(key);\n        }\n      }\n\n      /**\n       * Returns true if the given object is an object with a `then` method, and can\n       * therefore be assumed to behave as a Promise.\n       *\n       * @param {*} value The value to test.\n       * @returns {boolean} True if the value is thenable.\n       */\n      const isThenable = value => {\n        return value && typeof value === \"object\" && typeof value.then === \"function\";\n      };\n\n      /**\n       * Creates and returns a function which, when called, will resolve or reject\n       * the given promise based on how it is called:\n       *\n       * - If, when called, `chrome.runtime.lastError` contains a non-null object,\n       *   the promise is rejected with that value.\n       * - If the function is called with exactly one argument, the promise is\n       *   resolved to that value.\n       * - Otherwise, the promise is resolved to an array containing all of the\n       *   function's arguments.\n       *\n       * @param {object} promise\n       *        An object containing the resolution and rejection functions of a\n       *        promise.\n       * @param {function} promise.resolve\n       *        The promise's resolution function.\n       * @param {function} promise.reject\n       *        The promise's rejection function.\n       * @param {object} metadata\n       *        Metadata about the wrapped method which has created the callback.\n       * @param {boolean} metadata.singleCallbackArg\n       *        Whether or not the promise is resolved with only the first\n       *        argument of the callback, alternatively an array of all the\n       *        callback arguments is resolved. By default, if the callback\n       *        function is invoked with only a single argument, that will be\n       *        resolved to the promise, while all arguments will be resolved as\n       *        an array if multiple are given.\n       *\n       * @returns {function}\n       *        The generated callback function.\n       */\n      const makeCallback = (promise, metadata) => {\n        return (...callbackArgs) => {\n          if (extensionAPIs.runtime.lastError) {\n            promise.reject(new Error(extensionAPIs.runtime.lastError.message));\n          } else if (metadata.singleCallbackArg || callbackArgs.length <= 1 && metadata.singleCallbackArg !== false) {\n            promise.resolve(callbackArgs[0]);\n          } else {\n            promise.resolve(callbackArgs);\n          }\n        };\n      };\n      const pluralizeArguments = numArgs => numArgs == 1 ? \"argument\" : \"arguments\";\n\n      /**\n       * Creates a wrapper function for a method with the given name and metadata.\n       *\n       * @param {string} name\n       *        The name of the method which is being wrapped.\n       * @param {object} metadata\n       *        Metadata about the method being wrapped.\n       * @param {integer} metadata.minArgs\n       *        The minimum number of arguments which must be passed to the\n       *        function. If called with fewer than this number of arguments, the\n       *        wrapper will raise an exception.\n       * @param {integer} metadata.maxArgs\n       *        The maximum number of arguments which may be passed to the\n       *        function. If called with more than this number of arguments, the\n       *        wrapper will raise an exception.\n       * @param {boolean} metadata.singleCallbackArg\n       *        Whether or not the promise is resolved with only the first\n       *        argument of the callback, alternatively an array of all the\n       *        callback arguments is resolved. By default, if the callback\n       *        function is invoked with only a single argument, that will be\n       *        resolved to the promise, while all arguments will be resolved as\n       *        an array if multiple are given.\n       *\n       * @returns {function(object, ...*)}\n       *       The generated wrapper function.\n       */\n      const wrapAsyncFunction = (name, metadata) => {\n        return function asyncFunctionWrapper(target, ...args) {\n          if (args.length < metadata.minArgs) {\n            throw new Error(`Expected at least ${metadata.minArgs} ${pluralizeArguments(metadata.minArgs)} for ${name}(), got ${args.length}`);\n          }\n          if (args.length > metadata.maxArgs) {\n            throw new Error(`Expected at most ${metadata.maxArgs} ${pluralizeArguments(metadata.maxArgs)} for ${name}(), got ${args.length}`);\n          }\n          return new Promise((resolve, reject) => {\n            if (metadata.fallbackToNoCallback) {\n              // This API method has currently no callback on Chrome, but it return a promise on Firefox,\n              // and so the polyfill will try to call it with a callback first, and it will fallback\n              // to not passing the callback if the first call fails.\n              try {\n                target[name](...args, makeCallback({\n                  resolve,\n                  reject\n                }, metadata));\n              } catch (cbError) {\n                console.warn(`${name} API method doesn't seem to support the callback parameter, ` + \"falling back to call it without a callback: \", cbError);\n                target[name](...args);\n\n                // Update the API method metadata, so that the next API calls will not try to\n                // use the unsupported callback anymore.\n                metadata.fallbackToNoCallback = false;\n                metadata.noCallback = true;\n                resolve();\n              }\n            } else if (metadata.noCallback) {\n              target[name](...args);\n              resolve();\n            } else {\n              target[name](...args, makeCallback({\n                resolve,\n                reject\n              }, metadata));\n            }\n          });\n        };\n      };\n\n      /**\n       * Wraps an existing method of the target object, so that calls to it are\n       * intercepted by the given wrapper function. The wrapper function receives,\n       * as its first argument, the original `target` object, followed by each of\n       * the arguments passed to the original method.\n       *\n       * @param {object} target\n       *        The original target object that the wrapped method belongs to.\n       * @param {function} method\n       *        The method being wrapped. This is used as the target of the Proxy\n       *        object which is created to wrap the method.\n       * @param {function} wrapper\n       *        The wrapper function which is called in place of a direct invocation\n       *        of the wrapped method.\n       *\n       * @returns {Proxy<function>}\n       *        A Proxy object for the given method, which invokes the given wrapper\n       *        method in its place.\n       */\n      const wrapMethod = (target, method, wrapper) => {\n        return new Proxy(method, {\n          apply(targetMethod, thisObj, args) {\n            return wrapper.call(thisObj, target, ...args);\n          }\n        });\n      };\n      let hasOwnProperty = Function.call.bind(Object.prototype.hasOwnProperty);\n\n      /**\n       * Wraps an object in a Proxy which intercepts and wraps certain methods\n       * based on the given `wrappers` and `metadata` objects.\n       *\n       * @param {object} target\n       *        The target object to wrap.\n       *\n       * @param {object} [wrappers = {}]\n       *        An object tree containing wrapper functions for special cases. Any\n       *        function present in this object tree is called in place of the\n       *        method in the same location in the `target` object tree. These\n       *        wrapper methods are invoked as described in {@see wrapMethod}.\n       *\n       * @param {object} [metadata = {}]\n       *        An object tree containing metadata used to automatically generate\n       *        Promise-based wrapper functions for asynchronous. Any function in\n       *        the `target` object tree which has a corresponding metadata object\n       *        in the same location in the `metadata` tree is replaced with an\n       *        automatically-generated wrapper function, as described in\n       *        {@see wrapAsyncFunction}\n       *\n       * @returns {Proxy<object>}\n       */\n      const wrapObject = (target, wrappers = {}, metadata = {}) => {\n        let cache = Object.create(null);\n        let handlers = {\n          has(proxyTarget, prop) {\n            return prop in target || prop in cache;\n          },\n          get(proxyTarget, prop, receiver) {\n            if (prop in cache) {\n              return cache[prop];\n            }\n            if (!(prop in target)) {\n              return undefined;\n            }\n            let value = target[prop];\n            if (typeof value === \"function\") {\n              // This is a method on the underlying object. Check if we need to do\n              // any wrapping.\n\n              if (typeof wrappers[prop] === \"function\") {\n                // We have a special-case wrapper for this method.\n                value = wrapMethod(target, target[prop], wrappers[prop]);\n              } else if (hasOwnProperty(metadata, prop)) {\n                // This is an async method that we have metadata for. Create a\n                // Promise wrapper for it.\n                let wrapper = wrapAsyncFunction(prop, metadata[prop]);\n                value = wrapMethod(target, target[prop], wrapper);\n              } else {\n                // This is a method that we don't know or care about. Return the\n                // original method, bound to the underlying object.\n                value = value.bind(target);\n              }\n            } else if (typeof value === \"object\" && value !== null && (hasOwnProperty(wrappers, prop) || hasOwnProperty(metadata, prop))) {\n              // This is an object that we need to do some wrapping for the children\n              // of. Create a sub-object wrapper for it with the appropriate child\n              // metadata.\n              value = wrapObject(value, wrappers[prop], metadata[prop]);\n            } else if (hasOwnProperty(metadata, \"*\")) {\n              // Wrap all properties in * namespace.\n              value = wrapObject(value, wrappers[prop], metadata[\"*\"]);\n            } else {\n              // We don't need to do any wrapping for this property,\n              // so just forward all access to the underlying object.\n              Object.defineProperty(cache, prop, {\n                configurable: true,\n                enumerable: true,\n                get() {\n                  return target[prop];\n                },\n                set(value) {\n                  target[prop] = value;\n                }\n              });\n              return value;\n            }\n            cache[prop] = value;\n            return value;\n          },\n          set(proxyTarget, prop, value, receiver) {\n            if (prop in cache) {\n              cache[prop] = value;\n            } else {\n              target[prop] = value;\n            }\n            return true;\n          },\n          defineProperty(proxyTarget, prop, desc) {\n            return Reflect.defineProperty(cache, prop, desc);\n          },\n          deleteProperty(proxyTarget, prop) {\n            return Reflect.deleteProperty(cache, prop);\n          }\n        };\n\n        // Per contract of the Proxy API, the \"get\" proxy handler must return the\n        // original value of the target if that value is declared read-only and\n        // non-configurable. For this reason, we create an object with the\n        // prototype set to `target` instead of using `target` directly.\n        // Otherwise we cannot return a custom object for APIs that\n        // are declared read-only and non-configurable, such as `chrome.devtools`.\n        //\n        // The proxy handlers themselves will still use the original `target`\n        // instead of the `proxyTarget`, so that the methods and properties are\n        // dereferenced via the original targets.\n        let proxyTarget = Object.create(target);\n        return new Proxy(proxyTarget, handlers);\n      };\n\n      /**\n       * Creates a set of wrapper functions for an event object, which handles\n       * wrapping of listener functions that those messages are passed.\n       *\n       * A single wrapper is created for each listener function, and stored in a\n       * map. Subsequent calls to `addListener`, `hasListener`, or `removeListener`\n       * retrieve the original wrapper, so that  attempts to remove a\n       * previously-added listener work as expected.\n       *\n       * @param {DefaultWeakMap<function, function>} wrapperMap\n       *        A DefaultWeakMap object which will create the appropriate wrapper\n       *        for a given listener function when one does not exist, and retrieve\n       *        an existing one when it does.\n       *\n       * @returns {object}\n       */\n      const wrapEvent = wrapperMap => ({\n        addListener(target, listener, ...args) {\n          target.addListener(wrapperMap.get(listener), ...args);\n        },\n        hasListener(target, listener) {\n          return target.hasListener(wrapperMap.get(listener));\n        },\n        removeListener(target, listener) {\n          target.removeListener(wrapperMap.get(listener));\n        }\n      });\n      const onRequestFinishedWrappers = new DefaultWeakMap(listener => {\n        if (typeof listener !== \"function\") {\n          return listener;\n        }\n\n        /**\n         * Wraps an onRequestFinished listener function so that it will return a\n         * `getContent()` property which returns a `Promise` rather than using a\n         * callback API.\n         *\n         * @param {object} req\n         *        The HAR entry object representing the network request.\n         */\n        return function onRequestFinished(req) {\n          const wrappedReq = wrapObject(req, {} /* wrappers */, {\n            getContent: {\n              minArgs: 0,\n              maxArgs: 0\n            }\n          });\n          listener(wrappedReq);\n        };\n      });\n      const onMessageWrappers = new DefaultWeakMap(listener => {\n        if (typeof listener !== \"function\") {\n          return listener;\n        }\n\n        /**\n         * Wraps a message listener function so that it may send responses based on\n         * its return value, rather than by returning a sentinel value and calling a\n         * callback. If the listener function returns a Promise, the response is\n         * sent when the promise either resolves or rejects.\n         *\n         * @param {*} message\n         *        The message sent by the other end of the channel.\n         * @param {object} sender\n         *        Details about the sender of the message.\n         * @param {function(*)} sendResponse\n         *        A callback which, when called with an arbitrary argument, sends\n         *        that value as a response.\n         * @returns {boolean}\n         *        True if the wrapped listener returned a Promise, which will later\n         *        yield a response. False otherwise.\n         */\n        return function onMessage(message, sender, sendResponse) {\n          let didCallSendResponse = false;\n          let wrappedSendResponse;\n          let sendResponsePromise = new Promise(resolve => {\n            wrappedSendResponse = function (response) {\n              didCallSendResponse = true;\n              resolve(response);\n            };\n          });\n          let result;\n          try {\n            result = listener(message, sender, wrappedSendResponse);\n          } catch (err) {\n            result = Promise.reject(err);\n          }\n          const isResultThenable = result !== true && isThenable(result);\n\n          // If the listener didn't returned true or a Promise, or called\n          // wrappedSendResponse synchronously, we can exit earlier\n          // because there will be no response sent from this listener.\n          if (result !== true && !isResultThenable && !didCallSendResponse) {\n            return false;\n          }\n\n          // A small helper to send the message if the promise resolves\n          // and an error if the promise rejects (a wrapped sendMessage has\n          // to translate the message into a resolved promise or a rejected\n          // promise).\n          const sendPromisedResult = promise => {\n            promise.then(msg => {\n              // send the message value.\n              sendResponse(msg);\n            }, error => {\n              // Send a JSON representation of the error if the rejected value\n              // is an instance of error, or the object itself otherwise.\n              let message;\n              if (error && (error instanceof Error || typeof error.message === \"string\")) {\n                message = error.message;\n              } else {\n                message = \"An unexpected error occurred\";\n              }\n              sendResponse({\n                __mozWebExtensionPolyfillReject__: true,\n                message\n              });\n            }).catch(err => {\n              // Print an error on the console if unable to send the response.\n              console.error(\"Failed to send onMessage rejected reply\", err);\n            });\n          };\n\n          // If the listener returned a Promise, send the resolved value as a\n          // result, otherwise wait the promise related to the wrappedSendResponse\n          // callback to resolve and send it as a response.\n          if (isResultThenable) {\n            sendPromisedResult(result);\n          } else {\n            sendPromisedResult(sendResponsePromise);\n          }\n\n          // Let Chrome know that the listener is replying.\n          return true;\n        };\n      });\n      const wrappedSendMessageCallback = ({\n        reject,\n        resolve\n      }, reply) => {\n        if (extensionAPIs.runtime.lastError) {\n          // Detect when none of the listeners replied to the sendMessage call and resolve\n          // the promise to undefined as in Firefox.\n          // See https://github.com/mozilla/webextension-polyfill/issues/130\n          if (extensionAPIs.runtime.lastError.message === CHROME_SEND_MESSAGE_CALLBACK_NO_RESPONSE_MESSAGE) {\n            resolve();\n          } else {\n            reject(new Error(extensionAPIs.runtime.lastError.message));\n          }\n        } else if (reply && reply.__mozWebExtensionPolyfillReject__) {\n          // Convert back the JSON representation of the error into\n          // an Error instance.\n          reject(new Error(reply.message));\n        } else {\n          resolve(reply);\n        }\n      };\n      const wrappedSendMessage = (name, metadata, apiNamespaceObj, ...args) => {\n        if (args.length < metadata.minArgs) {\n          throw new Error(`Expected at least ${metadata.minArgs} ${pluralizeArguments(metadata.minArgs)} for ${name}(), got ${args.length}`);\n        }\n        if (args.length > metadata.maxArgs) {\n          throw new Error(`Expected at most ${metadata.maxArgs} ${pluralizeArguments(metadata.maxArgs)} for ${name}(), got ${args.length}`);\n        }\n        return new Promise((resolve, reject) => {\n          const wrappedCb = wrappedSendMessageCallback.bind(null, {\n            resolve,\n            reject\n          });\n          args.push(wrappedCb);\n          apiNamespaceObj.sendMessage(...args);\n        });\n      };\n      const staticWrappers = {\n        devtools: {\n          network: {\n            onRequestFinished: wrapEvent(onRequestFinishedWrappers)\n          }\n        },\n        runtime: {\n          onMessage: wrapEvent(onMessageWrappers),\n          onMessageExternal: wrapEvent(onMessageWrappers),\n          sendMessage: wrappedSendMessage.bind(null, \"sendMessage\", {\n            minArgs: 1,\n            maxArgs: 3\n          })\n        },\n        tabs: {\n          sendMessage: wrappedSendMessage.bind(null, \"sendMessage\", {\n            minArgs: 2,\n            maxArgs: 3\n          })\n        }\n      };\n      const settingMetadata = {\n        clear: {\n          minArgs: 1,\n          maxArgs: 1\n        },\n        get: {\n          minArgs: 1,\n          maxArgs: 1\n        },\n        set: {\n          minArgs: 1,\n          maxArgs: 1\n        }\n      };\n      apiMetadata.privacy = {\n        network: {\n          \"*\": settingMetadata\n        },\n        services: {\n          \"*\": settingMetadata\n        },\n        websites: {\n          \"*\": settingMetadata\n        }\n      };\n      return wrapObject(extensionAPIs, staticWrappers, apiMetadata);\n    };\n\n    // The build process adds a UMD wrapper around this file, which makes the\n    // `module` variable available.\n    module.exports = wrapAPIs(chrome);\n  } else {\n    module.exports = globalThis.browser;\n  }\n});\n//# sourceMappingURL=browser-polyfill.js.map\n","import { Highlight } from '@custom-types/highlight';\nimport { UserSettings } from '@custom-types/userSettings';\n\n/**\n * A message sent between the background script and the content script.\n */\nexport type Message = {\n  type: MessageType;\n  payload: Highlight | Highlight[] | UserSettings | string | ErrorLogPayload;\n};\n\n/**\n * The type of available messages.\n */\nexport enum MessageType {\n  /** Inform the background script to create a new highlight. */\n  StoreHighlightInDB = 'store-highlight',\n  /** Inform the sidebar that the highlights should be refetched. */\n  RefetchHighlights = 'refetch-highlights',\n  GetHighlights = 'get-highlights',\n  GetHighlight = 'get-highlight',\n  UpdateHighlight = 'update-highlight',\n  DeleteFromStore = 'delete-highlight-from-store',\n  DeleteFromHighlighter = 'delete-highlight-from-highlighter',\n  TabUpdate = 'tab-update',\n  GetUserSettings = 'get-user-settings',\n  /** Info that the user settings have been updated. */\n  UserSettingsUpdate = 'user-settings-update',\n  /** Request to update the user settings. */\n  UpdateUserSettings = 'update-user-settings',\n  Error = 'error',\n}\n\n/** Payload for an error log entry send to the content script. */\nexport type ErrorLogPayload = { title: string; description: string };\n","import Browser from 'webextension-polyfill';\nimport { TabInfo } from '@custom-types/tabInfo';\n\n/**\n * Returns the currently active tab or null if no there is no active tab.\n */\nexport async function getActiveTab(): Promise<Browser.Tabs.Tab | null> {\n  const tabs = await Browser.tabs.query({ active: true, currentWindow: true });\n  if (tabs[0]?.id != null) {\n    return tabs[0];\n  }\n\n  return null;\n}\n\n/**\n * Set the tab info of the currently active tab.\n */\nexport async function setTabInfoForActiveTab(\n  setTabInfo: (tabInfo: TabInfo) => void\n): Promise<void> {\n  const tabInfoFromActiveTab = await getTabInfoFromActiveTab();\n  if (tabInfoFromActiveTab !== null) {\n    setTabInfo(tabInfoFromActiveTab);\n  }\n}\n\n/**\n * Returns the title and favicon of the currently active tab or null if there is no active tab.\n */\nasync function getTabInfoFromActiveTab(): Promise<TabInfo | null> {\n  const tab = await getActiveTab();\n  if (tab === null) {\n    return null;\n  }\n\n  return {\n    title: tab.title,\n    favIconUrl: tab.favIconUrl,\n    url: tab.url,\n  };\n}\n","/** Keys of the color enum. */\nexport type ColorKey = keyof typeof Color;\n\n/** Selectable colors to highlight text. */\nexport enum Color {\n  Yellow = '#FFFF00',\n  Green = '#00FF00',\n  Blue = '#0000FF',\n  Orange = '#FFA94D',\n  Grape = '#da77f2',\n}\n","import { Color } from '@highlighter/util/color';\n\n/** Settings for the plugin defined by the user.  */\nexport type UserSettings = {\n  autoHighlighting: boolean;\n  extendedHighlighting: boolean;\n  displayHighlightsAsText: boolean;\n\n  exportFilteredOnly: boolean;\n  exportHighlightsFromText: boolean;\n  exportForUrl: boolean;\n  exportNewHighlightsOnly: boolean;\n\n  obsidianSync: boolean;\n  obsidianSyncUrl: string;\n\n  highlightColorSelection: Color;\n  highlightingDisabled: boolean;\n};\n\n/** The default settings. */\nexport const DEFAULT_USER_SETTINGS: UserSettings = {\n  autoHighlighting: false,\n  extendedHighlighting: true,\n  displayHighlightsAsText: false,\n\n  exportFilteredOnly: true,\n  exportHighlightsFromText: false,\n  exportForUrl: true,\n  exportNewHighlightsOnly: false,\n\n  obsidianSync: false,\n  obsidianSyncUrl: 'http://localhost:9090',\n\n  highlightColorSelection: Color.Green,\n  highlightingDisabled: false,\n};\n","import Browser from 'webextension-polyfill';\nimport {\n  DEFAULT_USER_SETTINGS,\n  UserSettings,\n} from '@custom-types/userSettings';\n\n/** Store user settings in local storage. */\nexport async function storeUserSettings(\n  userSettings: UserSettings\n): Promise<void> {\n  await Browser.storage.local.set({ userSettings: userSettings });\n}\n\n/** Retrieve user settings from local storage. */\nexport async function getUserSettings(): Promise<UserSettings> {\n  const userSettingsStore: { userSettings?: UserSettings } =\n    await Browser.storage.local.get('userSettings');\n  if (userSettingsStore.userSettings === undefined) {\n    return DEFAULT_USER_SETTINGS;\n  }\n\n  // We merge the user settings with the default settings to ensure that all settings are present.\n  // This is necessary when introducing new settings that might not yet be stored in the user's browser.\n  return { ...DEFAULT_USER_SETTINGS, ...userSettingsStore.userSettings };\n}\n","const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst transactionDoneMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(this.request);\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nconst advanceMethodProps = ['continue', 'continuePrimaryKey', 'advance'];\nconst methodMap = {};\nconst advanceResults = new WeakMap();\nconst ittrProxiedCursorToOriginalProxy = new WeakMap();\nconst cursorIteratorTraps = {\n    get(target, prop) {\n        if (!advanceMethodProps.includes(prop))\n            return target[prop];\n        let cachedFunc = methodMap[prop];\n        if (!cachedFunc) {\n            cachedFunc = methodMap[prop] = function (...args) {\n                advanceResults.set(this, ittrProxiedCursorToOriginalProxy.get(this)[prop](...args));\n            };\n        }\n        return cachedFunc;\n    },\n};\nasync function* iterate(...args) {\n    // tslint:disable-next-line:no-this-assignment\n    let cursor = this;\n    if (!(cursor instanceof IDBCursor)) {\n        cursor = await cursor.openCursor(...args);\n    }\n    if (!cursor)\n        return;\n    cursor = cursor;\n    const proxiedCursor = new Proxy(cursor, cursorIteratorTraps);\n    ittrProxiedCursorToOriginalProxy.set(proxiedCursor, cursor);\n    // Map this double-proxy back to the original, so other cursor methods work.\n    reverseTransformCache.set(proxiedCursor, unwrap(cursor));\n    while (cursor) {\n        yield proxiedCursor;\n        // If one of the advancing methods was not called, call continue().\n        cursor = await (advanceResults.get(proxiedCursor) || cursor.continue());\n        advanceResults.delete(proxiedCursor);\n    }\n}\nfunction isIteratorProp(target, prop) {\n    return ((prop === Symbol.asyncIterator &&\n        instanceOfAny(target, [IDBIndex, IDBObjectStore, IDBCursor])) ||\n        (prop === 'iterate' && instanceOfAny(target, [IDBIndex, IDBObjectStore])));\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get(target, prop, receiver) {\n        if (isIteratorProp(target, prop))\n            return iterate;\n        return oldTraps.get(target, prop, receiver);\n    },\n    has(target, prop) {\n        return isIteratorProp(target, prop) || oldTraps.has(target, prop);\n    },\n}));\n\nexport { deleteDB, openDB, unwrap, wrap };\n","import { ErrorLogEntry } from '@custom-types/errorLog';\nimport Browser from 'webextension-polyfill';\nimport {\n  useMutation,\n  UseMutationResult,\n  useQuery,\n  useQueryClient,\n  UseQueryResult,\n} from '@tanstack/react-query';\n\nconst QUERY_KEY = 'errorLogEntries';\n\n/** Query hook to retrieve error logs. */\nexport function useErrorLog(\n  refetchInterval?: number\n): UseQueryResult<ErrorLogEntry[], Error> {\n  return useQuery({\n    queryKey: [QUERY_KEY],\n    queryFn: () => getErrorLogEntries(),\n    refetchInterval,\n  });\n}\n\n/** Mutation hook to delete an error log entry. */\nexport function useDeleteErrorLogEntry(): UseMutationResult<\n  void,\n  Error,\n  string\n> {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: (id: string) => deleteErrorLogEntry(id),\n    onSuccess: () => queryClient.invalidateQueries({ queryKey: [QUERY_KEY] }),\n  });\n}\n\n/**\n * Store a log entry in local storage.\n * If there already exists a log entry with the same ID, it will be overwritten.\n */\nexport async function storeErrorLogEntry(\n  errorLogEntry: ErrorLogEntry\n): Promise<void> {\n  const errorLogEntries = await getErrorLogEntries();\n  if (errorLogEntries.some((entry) => entry.id === errorLogEntry.id)) {\n    await updateErrorLogEntry(errorLogEntries, errorLogEntry);\n    return;\n  }\n\n  const updatedErrorLogEntries = [errorLogEntry, ...errorLogEntries];\n  await Browser.storage.local.set({\n    errorLogEntries: updatedErrorLogEntries,\n  });\n}\n\n/** Update a log entry in local storage. */\nasync function updateErrorLogEntry(\n  errorLogEntries: ErrorLogEntry[],\n  updatedLogEntry: ErrorLogEntry\n): Promise<void> {\n  const updatedErrorLogEntries = errorLogEntries.map((entry) =>\n    entry.id === updatedLogEntry.id ? updatedLogEntry : entry\n  );\n\n  await Browser.storage.local.set({\n    errorLogEntries: updatedErrorLogEntries,\n  });\n}\n\n/** Delete a log entry from local storage. */\nexport async function deleteErrorLogEntry(id: string): Promise<void> {\n  const errorLogEntries = await getErrorLogEntries();\n  const updatedErrorLogEntries = errorLogEntries.filter(\n    (errorLogEntry) => errorLogEntry.id !== id\n  );\n\n  await Browser.storage.local.set({\n    errorLogEntries: updatedErrorLogEntries,\n  });\n}\n\n/** Retrieve the error logs from local storage. */\nexport async function getErrorLogEntries(): Promise<ErrorLogEntry[]> {\n  const errorLogEntryStore: { errorLogEntries?: ErrorLogEntry[] } =\n    await Browser.storage.local.get('errorLogEntries');\n  if (errorLogEntryStore.errorLogEntries === undefined) {\n    return [];\n  }\n\n  return errorLogEntryStore.errorLogEntries;\n}\n","import { storeErrorLogEntry } from '@store/errorLogs';\nimport { getActiveTab } from '@utils/tab';\nimport Browser from 'webextension-polyfill';\nimport { MessageType } from '@custom-types/message';\n\n/**\n * Write an error to the client-side log and push the error message\n * to the content script.\n */\nexport async function logAndPushError(title: string, description: string) {\n  logError(title, description);\n  pushErrorToContentScript(title, description);\n}\n\n/**\n * Push an error via message to the content script.\n */\nasync function pushErrorToContentScript(title: string, description: string) {\n  const activeTab = await getActiveTab();\n  if (activeTab?.id != null) {\n    Browser.tabs.sendMessage(activeTab.id, {\n      type: MessageType.Error,\n      payload: {\n        title,\n        description,\n      },\n    });\n  }\n}\n\n/**\n * Write an error log to the client-side log.\n * Errors are stored in local storage.\n *\n * IDs are hashes of title and description so that we can check if an error with\n * the same title and description already exists.\n */\nasync function logError(title: string, description: string) {\n  const id = await getHash(title + description);\n  const errorLog = {\n    id,\n    title,\n    description,\n    createdAt: new Date(),\n  };\n\n  return storeErrorLogEntry(errorLog);\n}\n\nexport async function getHash(message: string): Promise<string> {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(message);\n  const hashBuffer = await crypto.subtle.digest('SHA-1', data);\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  return hashArray.map((b) => b.toString(16).padStart(2, '0')).join('');\n}\n","import {\n  openDB,\n  deleteDB,\n  DBSchema,\n  IDBPDatabase,\n  IDBPTransaction,\n  StoreNames,\n} from 'idb';\nimport { Highlight } from '@custom-types/highlight';\nimport { logAndPushError } from '@utils/log';\n\n/**\n * The current version of the highlight database.\n */\nexport const HIGHLIGHT_DB_VERSION = 4;\n\ninterface HighlightDB extends DBSchema {\n  highlights: {\n    key: string;\n    value: Highlight;\n    indexes: { 'url-index': string };\n  };\n}\n\n/**\n * IndexedDB database to store and retrieve highlights.\n */\nexport class HighlightDatabase {\n  private static readonly STORE_NAME = 'highlights';\n\n  private static readonly DATABASE_NAME = HighlightDatabase.STORE_NAME + '-db';\n\n  private db?: IDBPDatabase<HighlightDB>;\n\n  public readonly databaseInitialized: Promise<void>;\n\n  constructor(version: number) {\n    this.databaseInitialized = this.initDatabase(version);\n  }\n\n  private async initDatabase(version: number): Promise<void> {\n    try {\n      this.db = await openDB<HighlightDB>(\n        HighlightDatabase.DATABASE_NAME,\n        version,\n        {\n          upgrade: (db, oldVersion, _, transaction) =>\n            this.migrateDatabase(db, oldVersion, transaction),\n        }\n      );\n    } catch (error) {\n      HighlightDatabase.assertIsError(error);\n      logAndPushError(\n        'Error initializing database',\n        `If highlights are not stored, please try to reload the page or restart the browser to reload the extension. ${error ? 'Error: ' + error.message : ''}`\n      );\n      console.error('Error initializing database', error);\n    }\n  }\n\n  /**\n   * Applies all the necessary migrations from the first to the latest version.\n   */\n  public async migrateDatabase(\n    db: IDBPDatabase<HighlightDB>,\n    oldVersion: number,\n    transaction: IDBPTransaction<\n      HighlightDB,\n      StoreNames<HighlightDB>[],\n      'versionchange'\n    >\n  ): Promise<void> {\n    switch (oldVersion) {\n      // v0 -> v1\n      case 0: {\n        const objectStore = db.createObjectStore(HighlightDatabase.STORE_NAME, {\n          keyPath: 'id',\n        });\n        objectStore.createIndex('url-index', 'url', {\n          unique: false,\n        });\n      }\n      // v1 -> v2\n      // intentional fallthrough\n      case 1: {\n        // Add a markdown property to each highlight.\n        const store = transaction.objectStore(HighlightDatabase.STORE_NAME);\n        let cursor = await store.openCursor();\n        while (cursor) {\n          const highlight: Highlight = cursor.value;\n          if (highlight.markdown === undefined) {\n            highlight.markdown = highlight.text;\n            await cursor.update(highlight);\n          }\n          cursor = await cursor.continue();\n        }\n      }\n      // v2 -> v3\n      // intentional fallthrough\n      case 2: {\n        // Convert Date objects for the created date to ISO strings.\n        const store = transaction.objectStore(HighlightDatabase.STORE_NAME);\n        let cursor = await store.openCursor();\n        while (cursor) {\n          const highlight: Highlight = cursor.value;\n          // @ts-expect-error createdAt is a Date object in version 2\n          if (highlight.createdAt instanceof Date) {\n            highlight.createdAt = (\n              highlight.createdAt as unknown as Date\n            ).toISOString();\n            await cursor.update(highlight);\n          }\n          cursor = await cursor.continue();\n        }\n      }\n      // v3 -> v4\n      // intentional fallthrough\n      case 3: {\n        // Set the newly introduced updatedAt date of highlights to the creation date.\n        // Set the hidden field to false.\n        const store = transaction.objectStore(HighlightDatabase.STORE_NAME);\n        let cursor = await store.openCursor();\n        while (cursor) {\n          const highlight: Highlight = cursor.value;\n          if (highlight.updatedAt === undefined) {\n            highlight.updatedAt = highlight.createdAt;\n          }\n\n          if (highlight.hidden === undefined) {\n            highlight.hidden = false;\n          }\n\n          await cursor.update(highlight);\n          cursor = await cursor.continue();\n        }\n      }\n    }\n  }\n\n  /** Store a highlight in the database. */\n  public async storeHighlight(highlight: Highlight) {\n    HighlightDatabase.assertDatabaseInitialized(this.db);\n\n    await this.db.add(HighlightDatabase.STORE_NAME, highlight);\n  }\n\n  /** Remove a highlight from the database. */\n  public async removeHighlight(id: string) {\n    HighlightDatabase.assertDatabaseInitialized(this.db);\n\n    await this.db.delete(HighlightDatabase.STORE_NAME, id);\n  }\n\n  /** Update a highlight in the database. Updates the updatedAt date.  */\n  public async updateHighlight(highlight: Highlight) {\n    HighlightDatabase.assertDatabaseInitialized(this.db);\n\n    highlight.updatedAt = new Date().toISOString();\n    await this.db.put(HighlightDatabase.STORE_NAME, highlight);\n  }\n\n  /** Get all highlights from the database. */\n  public async getHighlights(): Promise<Highlight[]> {\n    HighlightDatabase.assertDatabaseInitialized(this.db);\n\n    return await this.db.getAll(HighlightDatabase.STORE_NAME);\n  }\n\n  /** Get a single highlight by its ID. */\n  public async getHighlight(id: string): Promise<Highlight> {\n    HighlightDatabase.assertDatabaseInitialized(this.db);\n\n    const highlight = await this.db.get(HighlightDatabase.STORE_NAME, id);\n    if (highlight === undefined) {\n      throw new Error(`No highlight with ID '${id}' found.`);\n    }\n\n    return highlight;\n  }\n\n  /** Get highlights for a given URL from the database. */\n  public async getHighlightsForUrl(url: string): Promise<Highlight[]> {\n    HighlightDatabase.assertDatabaseInitialized(this.db);\n\n    return await this.db.getAllFromIndex(\n      HighlightDatabase.STORE_NAME,\n      'url-index',\n      url\n    );\n  }\n\n  /** Get all highlights from the database that have not previously been exported. */\n  public async getNonExportedHighlights(): Promise<Highlight[]> {\n    const highlights = await this.getHighlights();\n    return highlights.filter((highlight) => !highlight.exported);\n  }\n\n  /** Get highlights for a given URL from the database that have not previously been exported. */\n  public async getNonExportedHighlightsForUrl(\n    url: string\n  ): Promise<Highlight[]> {\n    const highlights = await this.getHighlightsForUrl(url);\n    return highlights.filter((highlight) => !highlight.exported);\n  }\n\n  /**\n   * Marks the given highlights as exported.\n   */\n  public async markHighlightsAsExported(\n    highlights: Highlight[]\n  ): Promise<void> {\n    return this.setHighlightExportStatus(highlights, true);\n  }\n\n  /**\n   * Set the export status of the given highlights.\n   */\n  public async setHighlightExportStatus(\n    highlights: Highlight[],\n    exported: boolean\n  ): Promise<void> {\n    HighlightDatabase.assertDatabaseInitialized(this.db);\n\n    const tx = this.db.transaction(HighlightDatabase.STORE_NAME, 'readwrite');\n    const store = tx.objectStore(HighlightDatabase.STORE_NAME);\n\n    const updatePromises = highlights.map((highlight) => {\n      highlight.exported = exported;\n      return store.put(highlight);\n    });\n\n    await Promise.all(updatePromises);\n    await tx.done;\n  }\n\n  /**\n   * Close the connection to the database.\n   */\n  public close(): void {\n    this.db?.close();\n  }\n\n  /**\n   * Only use this method for testing. Irreversibly deletes the whole database.\n   */\n  public unsafeDelete(): Promise<void> {\n    this.close();\n    return deleteDB(HighlightDatabase.DATABASE_NAME);\n  }\n\n  private static assertIsError(error: unknown): asserts error is Error {\n    if (!(error instanceof Error)) {\n      throw error;\n    }\n  }\n\n  private static assertDatabaseInitialized(\n    db: IDBPDatabase<HighlightDB> | undefined\n  ): asserts db is IDBPDatabase<HighlightDB> {\n    if (db == null) {\n      throw new Error('Database not initialized');\n    }\n  }\n}\n","/**\n * Make a GET request to the provided URL.\n */\nexport async function get<R>(url: URL): Promise<R | void> {\n  return request<void, R>(url, HttpMethod.GET);\n}\n\n/**\n * Make a PUT request to the provided URL.\n */\nexport async function put<B, R>(url: URL, body: B): Promise<R | void> {\n  return request<B, R>(url, HttpMethod.PUT, body);\n}\n\nasync function request<B, R>(\n  url: URL,\n  method: HttpMethod,\n  body?: B\n): Promise<R | void> {\n  const headers = new Headers();\n  if (body != null) {\n    headers.set(HeaderType.CONTENT_TYPE, ContentType.JSON);\n  }\n\n  const response = await fetch(url, {\n    method,\n    headers,\n    body: JSON.stringify(body),\n  });\n\n  if (!response.ok) {\n    const message = await response.text();\n    throw new HttpError(message, response.status);\n  }\n\n  const contentType = response.headers.get(HeaderType.CONTENT_TYPE);\n  if (contentType === ContentType.JSON) {\n    return response.json();\n  }\n}\n\n/**\n * A custom error returned from HTTP API requests that contains the\n * request status alongside the error message.\n */\nexport class HttpError extends Error {\n  constructor(\n    message: string,\n    private status: number\n  ) {\n    super(message);\n    this.name = 'HttpError';\n  }\n\n  public getStatus(): number {\n    return this.status;\n  }\n}\n\nenum ContentType {\n  JSON = 'application/json',\n}\n\nenum HeaderType {\n  CONTENT_TYPE = 'Content-Type',\n}\n\nenum HttpMethod {\n  GET = 'GET',\n  PUT = 'PUT',\n}\n","import { get, HttpError, put } from '@api/api';\nimport { useMutation, UseMutationResult } from '@tanstack/react-query';\nimport { CreateHighlightRequest, Highlight } from '@custom-types/highlight';\n\n/** Mutation to verify the connection to the Obsidian plugin. */\nexport function useVerifyObsidian(): UseMutationResult<\n  boolean,\n  HttpError | TypeError,\n  string\n> {\n  return useMutation({\n    mutationFn: (baseUrl: string) => verifyObsidianConnection(baseUrl),\n  });\n}\n\n/**\n * Check if the Obsidian plugin is reachable at the URL specified in the user settings.\n */\nasync function verifyObsidianConnection(baseUrl: string): Promise<boolean> {\n  const endpoint = createUrl(baseUrl, 'health');\n\n  try {\n    await get<void>(endpoint);\n    return true;\n  } catch (e) {\n    throw new Error(\n      'Could not connect to Obsidian. Make sure Obsidian is running, the Mark my Word extension is enabled, and the URL is correct.'\n    );\n  }\n}\n\n/**\n * Store a highlight in Obsidian.\n */\nexport async function storeInObsidian(\n  baseUrl: string,\n  highlight: Highlight\n): Promise<void> {\n  const endpoint = createUrl(baseUrl, 'highlight');\n  return put<CreateHighlightRequest, void>(endpoint, {\n    url: baseUrl,\n    content: highlight.markdown,\n    title: highlight.title ?? highlight.url,\n  });\n}\n\nfunction createUrl(baseUrl: string, path: string): URL {\n  let url: URL;\n  try {\n    url = new URL(path, baseUrl);\n  } catch (e) {\n    if (e instanceof TypeError) {\n      if (baseUrl === '') {\n        throw new Error(\n          'Please enter the URL configured in the Mark my Word Obsidian extension.'\n        );\n      }\n\n      throw new TypeError(\n        `Invalid URL format for URL ${baseUrl + '/' + path}: ${e.message}`\n      );\n    }\n    throw e;\n  }\n\n  return url;\n}\n","import Browser from 'webextension-polyfill';\nimport { Message } from '@custom-types/message';\n\n/**\n * Send a message to all tabs.\n */\nexport async function sendToTabs(message: Message): Promise<void> {\n  const tabs = await Browser.tabs.query({});\n  tabs.forEach((tab) => {\n    if (tab.id != null) {\n      Browser.tabs.sendMessage(tab.id, message);\n    }\n  });\n}\n","import Browser from 'webextension-polyfill';\nimport { Message, MessageType } from '@custom-types/message';\nimport { getActiveTab } from '@utils/tab';\nimport { Highlight } from '@custom-types/highlight';\nimport { UserSettings } from '@custom-types/userSettings';\nimport { getUserSettings, storeUserSettings } from '@store/userSettings';\nimport { HIGHLIGHT_DB_VERSION, HighlightDatabase } from '@store/highlights';\nimport { storeInObsidian } from '@api/obsidian';\nimport { logAndPushError } from '@utils/log';\nimport { sendToTabs } from '@utils/message';\n\n// @ts-expect-error - no import expected by wxt\nexport default defineBackground({\n  persistent: false,\n  main,\n});\n\nfunction main(): void {\n  const db = new HighlightDatabase(HIGHLIGHT_DB_VERSION);\n\n  /**\n   * Listen to tab updates and send highlights to the active tab.\n   * We keep this outside of the sidebar as this event should also be acted upon if the sidebar is not rendered.\n   */\n  Browser.tabs.onUpdated.addListener(async (tabId, _tabChange, tab) => {\n    if (tab.status === 'complete') {\n      const activeTab = await getActiveTab();\n      if (activeTab !== null && tabId === activeTab.id) {\n        const highlights = await db.getHighlightsForUrl(tab.url ?? '');\n        await Browser.tabs.sendMessage(tabId, {\n          type: MessageType.TabUpdate,\n          payload: highlights,\n        });\n      }\n    }\n  });\n\n  /**\n   * We only want to include the popup on Firefox for Android.\n   * On Desktop, the sidebar should be toggled when clicking the extension icon.\n   * The sidebar which is hard-coded in the manifest is ignored automatically by Firefox for Android.\n   */\n  Browser.runtime.getPlatformInfo().then((platformInfo) => {\n    if (platformInfo.os === 'android') {\n      Browser.browserAction.setPopup({ popup: 'custom-popup.html' });\n    } else if (Browser.browserAction != null) {\n      // browserAction is not available on Chrome\n      Browser.browserAction.onClicked.addListener(() => {\n        Browser.sidebarAction.toggle();\n      });\n    }\n  });\n\n  /**\n   * We have to handle the messages in the background script and not the\n   * sidebar to make sure that the messages are handled even if the sidebar\n   * is not open.\n   */\n  Browser.runtime.onMessage.addListener((message: unknown) =>\n    messageHandler(message as Message, db)\n  );\n}\n\nasync function messageHandler(\n  message: Message,\n  db: HighlightDatabase\n): Promise<void | Highlight[] | Highlight | UserSettings> {\n  switch (message.type) {\n    case MessageType.StoreHighlightInDB:\n      return onStoreHighlight(message.payload as Highlight, db);\n    case MessageType.GetHighlights:\n      return db.getHighlightsForUrl(message.payload as string);\n    case MessageType.GetHighlight:\n      return db.getHighlight(message.payload as string);\n    case MessageType.UpdateHighlight:\n      return db.updateHighlight(message.payload as Highlight);\n    case MessageType.GetUserSettings:\n      return getUserSettings();\n    case MessageType.UpdateUserSettings:\n      const userSettings = message.payload as UserSettings;\n      await storeUserSettings(userSettings);\n      return sendToTabs({\n        type: MessageType.UserSettingsUpdate,\n        payload: userSettings,\n      });\n    case MessageType.DeleteFromStore:\n      const highlightId = message.payload as string;\n      return db.removeHighlight(highlightId);\n  }\n}\n\nasync function onStoreHighlight(highlight: Highlight, db: HighlightDatabase) {\n  const userSettings = await getUserSettings();\n  if (userSettings.obsidianSync) {\n    highlight.exported = true;\n  }\n\n  try {\n    await db.storeHighlight(highlight);\n  } catch (e) {\n    logAndPushError(\n      'Failed to store highlight in the database',\n      (e as Error).message\n    );\n    console.error('error: ', e);\n    console.error('highlight: ', highlight);\n  }\n\n  if (userSettings.obsidianSync) {\n    try {\n      await storeInObsidian(userSettings.obsidianSyncUrl, highlight);\n    } catch (e) {\n      logAndPushError(\n        'Failed to sync highlight to Obsidian',\n        `Make sure Obsidian is running, the Mark my Word extension is enabled, and the URL is correct.\n                  Error message: ${(e as Error).message}\n                `\n      );\n      // We reset the exported state in the error case as we optimistically update when storing the highlight initially.\n      db.setHighlightExportStatus([highlight], false);\n    }\n  }\n}\n"],"names":["defineBackground","arg","global","factory","module","this","CHROME_SEND_MESSAGE_CALLBACK_NO_RESPONSE_MESSAGE","wrapAPIs","extensionAPIs","apiMetadata","DefaultWeakMap","createItem","items","key","isThenable","value","makeCallback","promise","metadata","callbackArgs","pluralizeArguments","numArgs","wrapAsyncFunction","name","target","args","resolve","reject","cbError","wrapMethod","method","wrapper","targetMethod","thisObj","hasOwnProperty","wrapObject","wrappers","cache","handlers","proxyTarget","prop","receiver","desc","wrapEvent","wrapperMap","listener","onRequestFinishedWrappers","req","wrappedReq","onMessageWrappers","message","sender","sendResponse","didCallSendResponse","wrappedSendResponse","sendResponsePromise","response","result","err","isResultThenable","sendPromisedResult","msg","error","wrappedSendMessageCallback","reply","wrappedSendMessage","apiNamespaceObj","wrappedCb","staticWrappers","settingMetadata","MessageType","getActiveTab","tabs","Browser","_a","Color","DEFAULT_USER_SETTINGS","storeUserSettings","userSettings","getUserSettings","userSettingsStore","instanceOfAny","object","constructors","c","idbProxyableTypes","cursorAdvanceMethods","getIdbProxyableTypes","getCursorAdvanceMethods","transactionDoneMap","transformCache","reverseTransformCache","promisifyRequest","request","unlisten","success","wrap","cacheDonePromiseForTransaction","tx","done","complete","idbProxyTraps","replaceTraps","callback","wrapFunction","func","unwrap","transformCachableValue","newValue","openDB","version","blocked","upgrade","blocking","terminated","openPromise","event","db","deleteDB","readMethods","writeMethods","cachedMethods","getMethod","targetFuncName","useIndex","isWrite","storeName","oldTraps","advanceMethodProps","methodMap","advanceResults","ittrProxiedCursorToOriginalProxy","cursorIteratorTraps","cachedFunc","iterate","cursor","proxiedCursor","isIteratorProp","storeErrorLogEntry","errorLogEntry","errorLogEntries","getErrorLogEntries","entry","updateErrorLogEntry","updatedErrorLogEntries","updatedLogEntry","errorLogEntryStore","logAndPushError","title","description","logError","pushErrorToContentScript","activeTab","errorLog","getHash","data","hashBuffer","b","HIGHLIGHT_DB_VERSION","_HighlightDatabase","__publicField","oldVersion","_","transaction","highlight","id","url","highlights","exported","store","updatePromises","HighlightDatabase","put","body","headers","HttpError","status","storeInObsidian","baseUrl","endpoint","createUrl","path","e","sendToTabs","tab","definition","main","tabId","_tabChange","platformInfo","messageHandler","onStoreHighlight","highlightId"],"mappings":"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","x_google_ignoreList":[0,1,7]}