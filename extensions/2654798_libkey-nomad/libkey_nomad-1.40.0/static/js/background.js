(()=>{var t={946:function(t,e,i){var n;!function(a,r){"use strict";var o="function",s="undefined",c="object",u="string",l="major",d="model",g="name",f="type",h="vendor",p="version",v="architecture",w="console",m="mobile",b="tablet",y="smarttv",S="wearable",D="embedded",x="Amazon",I="Apple",C="ASUS",k="BlackBerry",T="Browser",L="Chrome",A="Firefox",P="Google",_="Huawei",N="LG",E="Microsoft",O="Motorola",R="Opera",M="Samsung",U="Sharp",j="Sony",B="Xiaomi",F="Zebra",G="Facebook",q="Chromium OS",V="Mac OS",z=" Browser",W=function(t){for(var e={},i=0;i<t.length;i++)e[t[i].toUpperCase()]=t[i];return e},H=function(t,e){return typeof t===u&&-1!==Q(e).indexOf(Q(t))},Q=function(t){return t.toLowerCase()},$=function(t,e){if(typeof t===u)return t=t.replace(/^\s\s*/,""),typeof e===s?t:t.substring(0,500)},Z=function(t,e){for(var i,n,a,s,u,l,d=0;d<e.length&&!u;){var g=e[d],f=e[d+1];for(i=n=0;i<g.length&&!u&&g[i];)if(u=g[i++].exec(t))for(a=0;a<f.length;a++)l=u[++n],typeof(s=f[a])===c&&s.length>0?2===s.length?typeof s[1]==o?this[s[0]]=s[1].call(this,l):this[s[0]]=s[1]:3===s.length?typeof s[1]!==o||s[1].exec&&s[1].test?this[s[0]]=l?l.replace(s[1],s[2]):r:this[s[0]]=l?s[1].call(this,l,s[2]):r:4===s.length&&(this[s[0]]=l?s[3].call(this,l.replace(s[1],s[2])):r):this[s]=l||r;d+=2}},K=function(t,e){for(var i in e)if(typeof e[i]===c&&e[i].length>0){for(var n=0;n<e[i].length;n++)if(H(e[i][n],t))return"?"===i?r:i}else if(H(e[i],t))return"?"===i?r:i;return e.hasOwnProperty("*")?e["*"]:t},J={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Y={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[g,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[g,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[g,p],[/opios[\/ ]+([\w\.]+)/i],[p,[g,R+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[p,[g,R+" GX"]],[/\bopr\/([\w\.]+)/i],[p,[g,R]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[p,[g,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[g,p],[/quark(?:pc)?\/([-\w\.]+)/i],[p,[g,"Quark"]],[/\bddg\/([\w\.]+)/i],[p,[g,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[g,"UC"+T]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[p,[g,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[g,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[g,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[p,[g,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[p,[g,"Smart Lenovo "+T]],[/(avast|avg)\/([\w\.]+)/i],[[g,/(.+)/,"$1 Secure "+T],p],[/\bfocus\/([\w\.]+)/i],[p,[g,A+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[g,R+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[g,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[g,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[g,R+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[g,"MIUI "+T]],[/fxios\/([-\w\.]+)/i],[p,[g,A]],[/\bqihu|(qi?ho?o?|360)browser/i],[[g,"360"+z]],[/\b(qq)\/([\w\.]+)/i],[[g,/(.+)/,"$1Browser"],p],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[g,/(.+)/,"$1"+z],p],[/samsungbrowser\/([\w\.]+)/i],[p,[g,M+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[g,/_/g," "],p],[/metasr[\/ ]?([\d\.]+)/i],[p,[g,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[g,"Sogou Mobile"],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[g,p],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[g],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[g,G],p],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[g,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[g,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[p,[g,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[g,L+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[g,L+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[g,"Android "+T]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[g,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[g,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,g],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[g,[p,K,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[g,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[g,"Netscape"],p],[/(wolvic)\/([\w\.]+)/i],[g,p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[g,A+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[g,[p,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[g,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[v,"amd64"]],[/(ia32(?=;))/i],[[v,Q]],[/((?:i[346]|x)86)[;\)]/i],[[v,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[v,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[v,"armhf"]],[/windows (ce|mobile); ppc;/i],[[v,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[v,/ower/,"",Q]],[/(sun4\w)[;\)]/i],[[v,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[v,Q]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[h,M],[f,b]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[d,[h,M],[f,m]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[h,I],[f,m]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[h,I],[f,b]],[/(macintosh);/i],[d,[h,I]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[h,U],[f,m]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[h,_],[f,b]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[h,_],[f,m]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[d,/_/g," "],[h,B],[f,m]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[h,B],[f,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[h,"OPPO"],[f,m]],[/\b(opd2\d{3}a?) bui/i],[d,[h,"OPPO"],[f,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[h,"Vivo"],[f,m]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[h,"Realme"],[f,m]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[h,O],[f,m]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[h,O],[f,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[h,N],[f,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[h,N],[f,m]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[h,"Lenovo"],[f,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[h,"Nokia"],[f,m]],[/(pixel c)\b/i],[d,[h,P],[f,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[h,P],[f,m]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[h,j],[f,m]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[h,j],[f,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[h,"OnePlus"],[f,m]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[h,x],[f,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[h,x],[f,m]],[/(playbook);[-\w\),; ]+(rim)/i],[d,h,[f,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[h,k],[f,m]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[h,C],[f,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[h,C],[f,m]],[/(nexus 9)/i],[d,[h,"HTC"],[f,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[d,/_/g," "],[f,m]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[d,[h,"TCL"],[f,b]],[/(itel) ((\w+))/i],[[h,Q],d,[f,K,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[h,"Acer"],[f,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[h,"Meizu"],[f,m]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[h,"Ulefone"],[f,m]],[/droid.+; (a(?:015|06[35]|142p?))/i],[d,[h,"Nothing"],[f,m]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,d,[f,m]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,d,[f,b]],[/(surface duo)/i],[d,[h,E],[f,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[h,"Fairphone"],[f,m]],[/(u304aa)/i],[d,[h,"AT&T"],[f,m]],[/\bsie-(\w*)/i],[d,[h,"Siemens"],[f,m]],[/\b(rct\w+) b/i],[d,[h,"RCA"],[f,b]],[/\b(venue[\d ]{2,7}) b/i],[d,[h,"Dell"],[f,b]],[/\b(q(?:mv|ta)\w+) b/i],[d,[h,"Verizon"],[f,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[h,"Barnes & Noble"],[f,b]],[/\b(tm\d{3}\w+) b/i],[d,[h,"NuVision"],[f,b]],[/\b(k88) b/i],[d,[h,"ZTE"],[f,b]],[/\b(nx\d{3}j) b/i],[d,[h,"ZTE"],[f,m]],[/\b(gen\d{3}) b.+49h/i],[d,[h,"Swiss"],[f,m]],[/\b(zur\d{3}) b/i],[d,[h,"Swiss"],[f,b]],[/\b((zeki)?tb.*\b) b/i],[d,[h,"Zeki"],[f,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],d,[f,b]],[/\b(ns-?\w{0,9}) b/i],[d,[h,"Insignia"],[f,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[h,"NextBook"],[f,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],d,[f,m]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],d,[f,m]],[/\b(ph-1) /i],[d,[h,"Essential"],[f,m]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[h,"Envizen"],[f,b]],[/\b(trio[-\w\. ]+) b/i],[d,[h,"MachSpeed"],[f,b]],[/\btu_(1491) b/i],[d,[h,"Rotor"],[f,b]],[/(shield[\w ]+) b/i],[d,[h,"Nvidia"],[f,b]],[/(sprint) (\w+)/i],[h,d,[f,m]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[h,E],[f,m]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[h,F],[f,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[h,F],[f,m]],[/smart-tv.+(samsung)/i],[h,[f,y]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[h,M],[f,y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,N],[f,y]],[/(apple) ?tv/i],[h,[d,I+" TV"],[f,y]],[/crkey/i],[[d,L+"cast"],[h,P],[f,y]],[/droid.+aft(\w+)( bui|\))/i],[d,[h,x],[f,y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[h,U],[f,y]],[/(bravia[\w ]+)( bui|\))/i],[d,[h,j],[f,y]],[/(mitv-\w{5}) bui/i],[d,[h,B],[f,y]],[/Hbbtv.*(technisat) (.*);/i],[h,d,[f,y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,$],[d,$],[f,y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[f,y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,d,[f,w]],[/droid.+; (shield) bui/i],[d,[h,"Nvidia"],[f,w]],[/(playstation [345portablevi]+)/i],[d,[h,j],[f,w]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[h,E],[f,w]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[d,[h,M],[f,S]],[/((pebble))app/i],[h,d,[f,S]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[h,I],[f,S]],[/droid.+; (glass) \d/i],[d,[h,P],[f,S]],[/droid.+; (wt63?0{2,3})\)/i],[d,[h,F],[f,S]],[/(quest( \d| pro)?)/i],[d,[h,G],[f,S]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[f,D]],[/(aeobc)\b/i],[d,[h,x],[f,D]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[d,[f,m]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[f,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[f,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[f,m]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[g,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[g,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[g,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,g]],os:[[/microsoft (windows) (vista|xp)/i],[g,p],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[g,[p,K,J]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,K,J],[g,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[g,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[g,V],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,g],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[g,p],[/\(bb(10);/i],[p,[g,k]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[g,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[g,A+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[g,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[g,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[g,L+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[g,q],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[g,p],[/(sunos) ?([\w\.\d]*)/i],[[g,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[g,p]]},X=function(t,e){if(typeof t===c&&(e=t,t=r),!(this instanceof X))return new X(t,e).getResult();var i=typeof a!==s&&a.navigator?a.navigator:r,n=t||(i&&i.userAgent?i.userAgent:""),w=i&&i.userAgentData?i.userAgentData:r,y=e?function(t,e){var i={};for(var n in t)e[n]&&e[n].length%2===0?i[n]=e[n].concat(t[n]):i[n]=t[n];return i}(Y,e):Y,S=i&&i.userAgent==n;return this.getBrowser=function(){var t,e={};return e[g]=r,e[p]=r,Z.call(e,n,y.browser),e[l]=typeof(t=e[p])===u?t.replace(/[^\d\.]/g,"").split(".")[0]:r,S&&i&&i.brave&&typeof i.brave.isBrave==o&&(e[g]="Brave"),e},this.getCPU=function(){var t={};return t[v]=r,Z.call(t,n,y.cpu),t},this.getDevice=function(){var t={};return t[h]=r,t[d]=r,t[f]=r,Z.call(t,n,y.device),S&&!t[f]&&w&&w.mobile&&(t[f]=m),S&&"Macintosh"==t[d]&&i&&typeof i.standalone!==s&&i.maxTouchPoints&&i.maxTouchPoints>2&&(t[d]="iPad",t[f]=b),t},this.getEngine=function(){var t={};return t[g]=r,t[p]=r,Z.call(t,n,y.engine),t},this.getOS=function(){var t={};return t[g]=r,t[p]=r,Z.call(t,n,y.os),S&&!t[g]&&w&&w.platform&&"Unknown"!=w.platform&&(t[g]=w.platform.replace(/chrome os/i,q).replace(/macos/i,V)),t},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(t){return n=typeof t===u&&t.length>500?$(t,500):t,this},this.setUA(n),this};X.VERSION="1.0.39",X.BROWSER=W([g,p,l]),X.CPU=W([v]),X.DEVICE=W([d,h,f,w,m,y,b,S,D]),X.ENGINE=X.OS=W([g,p]),typeof e!==s?(t.exports&&(e=t.exports=X),e.UAParser=X):i.amdO?(n=function(){return X}.call(e,i,e,t))===r||(t.exports=n):typeof a!==s&&(a.UAParser=X);var tt=typeof a!==s&&(a.jQuery||a.Zepto);if(tt&&!tt.ua){var et=new X;tt.ua=et.getResult(),tt.ua.get=function(){return et.getUA()},tt.ua.set=function(t){et.setUA(t);var e=et.getResult();for(var i in e)tt.ua[i]=e[i]}}}("object"===typeof window?window:this)}},e={};function i(n){var a=e[n];if(void 0!==a)return a.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,i),r.exports}i.amdO={},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};i.r(t),i.d(t,{VERSION:()=>P,after:()=>oi,all:()=>ki,allKeys:()=>qt,any:()=>Ti,assign:()=>oe,before:()=>si,bind:()=>$e,bindAll:()=>Je,chain:()=>ze,chunk:()=>ln,clone:()=>le,collect:()=>yi,compact:()=>Yi,compose:()=>ri,constant:()=>It,contains:()=>Li,countBy:()=>qi,create:()=>ue,debounce:()=>ii,default:()=>fn,defaults:()=>se,defer:()=>ti,delay:()=>Xe,detect:()=>wi,difference:()=>tn,drop:()=>Ki,each:()=>bi,escape:()=>Ne,every:()=>ki,extend:()=>re,extendOwn:()=>oe,filter:()=>Ii,find:()=>wi,findIndex:()=>di,findKey:()=>ui,findLastIndex:()=>gi,findWhere:()=>mi,first:()=>Zi,flatten:()=>Xi,foldl:()=>Di,foldr:()=>xi,forEach:()=>bi,functions:()=>ne,get:()=>pe,groupBy:()=>Fi,has:()=>ve,head:()=>Zi,identity:()=>we,include:()=>Li,includes:()=>Li,indexBy:()=>Gi,indexOf:()=>pi,initial:()=>$i,inject:()=>Di,intersection:()=>rn,invert:()=>ie,invoke:()=>Ai,isArguments:()=>St,isArray:()=>mt,isArrayBuffer:()=>ut,isBoolean:()=>tt,isDataView:()=>wt,isDate:()=>rt,isElement:()=>et,isEmpty:()=>Ot,isEqual:()=>Gt,isError:()=>st,isFinite:()=>Dt,isFunction:()=>gt,isMap:()=>Kt,isMatch:()=>Rt,isNaN:()=>xt,isNull:()=>Y,isNumber:()=>at,isObject:()=>J,isRegExp:()=>ot,isSet:()=>Yt,isString:()=>nt,isSymbol:()=>ct,isTypedArray:()=>Pt,isUndefined:()=>X,isWeakMap:()=>Jt,isWeakSet:()=>Xt,iteratee:()=>De,keys:()=>Et,last:()=>Ji,lastIndexOf:()=>vi,map:()=>yi,mapObject:()=>Ie,matcher:()=>me,matches:()=>me,max:()=>Ni,memoize:()=>Ye,methods:()=>ne,min:()=>Ei,mixin:()=>gn,negate:()=>ai,noop:()=>Ce,now:()=>Ae,object:()=>cn,omit:()=>Qi,once:()=>ci,pairs:()=>ee,partial:()=>Qe,partition:()=>Vi,pick:()=>Hi,pluck:()=>Pi,property:()=>be,propertyOf:()=>ke,random:()=>Le,range:()=>un,reduce:()=>Di,reduceRight:()=>xi,reject:()=>Ci,rest:()=>Ki,restArguments:()=>K,result:()=>Ge,sample:()=>Mi,select:()=>Ii,shuffle:()=>Ui,size:()=>zi,some:()=>Ti,sortBy:()=>ji,sortedIndex:()=>fi,tail:()=>Ki,take:()=>Zi,tap:()=>de,template:()=>Fe,templateSettings:()=>Oe,throttle:()=>ei,times:()=>Te,toArray:()=>Ri,toPath:()=>ge,transpose:()=>on,unescape:()=>Ee,union:()=>an,uniq:()=>nn,unique:()=>nn,uniqueId:()=>Ve,unzip:()=>on,values:()=>te,where:()=>_i,without:()=>en,wrap:()=>ni,zip:()=>sn});const e={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var n,a=new Uint8Array(16);function r(){if(!n&&!(n="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(a)}for(var o=[],s=0;s<256;++s)o.push((s+256).toString(16).slice(1));function c(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]).toLowerCase()}const u=function(t,i,n){if(e.randomUUID&&!i&&!t)return e.randomUUID();var a=(t=t||{}).random||(t.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,i){n=n||0;for(var o=0;o<16;++o)i[n+o]=a[o];return i}return c(a)};var l,d=i(946),g=new Uint8Array(16);function f(){if(!l&&!(l="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return l(g)}const h=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const p=function(t){return"string"===typeof t&&h.test(t)};for(var v=[],w=0;w<256;++w)v.push((w+256).toString(16).substr(1));const m=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(v[t[e+0]]+v[t[e+1]]+v[t[e+2]]+v[t[e+3]]+"-"+v[t[e+4]]+v[t[e+5]]+"-"+v[t[e+6]]+v[t[e+7]]+"-"+v[t[e+8]]+v[t[e+9]]+"-"+v[t[e+10]]+v[t[e+11]]+v[t[e+12]]+v[t[e+13]]+v[t[e+14]]+v[t[e+15]]).toLowerCase();if(!p(i))throw TypeError("Stringified UUID is invalid");return i};const b=function(t,e,i){var n=(t=t||{}).random||(t.rng||f)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){i=i||0;for(var a=0;a<16;++a)e[i+a]=n[a];return e}return m(n)};var y,S=function(t,e,i){if(i||2===arguments.length)for(var n,a=0,r=e.length;a<r;a++)!n&&a in e||(n||(n=Array.prototype.slice.call(e,0,a)),n[a]=e[a]);return t.concat(n||Array.prototype.slice.call(e))},D=function(){function t(){}return t.isHttpError=function(t){return void 0!==t.httpStatusCode&&null!==t.httpStatusCode&&Number.isInteger(t.httpStatusCode)},t.newEventOutput=function(t,e){var i,n,a,r,o,s,c,u,l,d,g,f,h,p,v,w,m,b,y,D,x,I,C,k,T,L,A,P,_,N,E,O=t.getBackgroundDimensions(e.eventCategory,e.eventType),R={eventId:t.newEventUuid(),timestampOfEvent:t.getCurrentIsoTimestamp(),eventCategory:e.eventCategory,eventType:e.eventType,gaEventLabel:null!==(i=e.gaEventLabel)&&void 0!==i?i:void 0,gaEventValue:null!==(n=e.gaEventValue)&&void 0!==n?n:void 0,referringProduct:null!==(a=e.referringProduct)&&void 0!==a?a:void 0,os:null!==(r=O.os)&&void 0!==r?r:void 0,osVersion:null!==(o=O.osVersion)&&void 0!==o?o:void 0,deviceMake:null!==(s=O.deviceMake)&&void 0!==s?s:void 0,deviceModel:null!==(c=O.deviceModel)&&void 0!==c?c:void 0,appVersion:null!==(u=O.appVersion)&&void 0!==u?u:void 0,appName:O.appName,property:O.property,uniqueDeviceId:O.uniqueDeviceId,browser:null!==(l=O.browser)&&void 0!==l?l:void 0,browserVersion:null!==(d=O.browserVersion)&&void 0!==d?d:void 0,userAgent:null!==(g=O.userAgent)&&void 0!==g?g:void 0,libraryId:null!==(f=O.libraryId)&&void 0!==f?f:void 0,userId:null!==(h=O.userId)&&void 0!==h?h:void 0,utmSource:null!==(p=O.utmSource)&&void 0!==p?p:void 0,utmMedium:null!==(v=O.utmMedium)&&void 0!==v?v:void 0,utmCampaign:null!==(w=O.utmCampaign)&&void 0!==w?w:void 0,utmTerm:null!==(m=O.utmTerm)&&void 0!==m?m:void 0,utmContent:null!==(b=O.utmContent)&&void 0!==b?b:void 0,product:null!==(y=O.product)&&void 0!==y?y:void 0,url:null!==(D=O.url)&&void 0!==D?D:void 0,journalId:null!==(x=O.journalId)&&void 0!==x?x:void 0,issueId:null!==(I=O.issueId)&&void 0!==I?I:void 0,articleId:null!==(C=O.articleId)&&void 0!==C?C:void 0,doi:null!==(k=O.doi)&&void 0!==k?k:void 0,pmid:null!==(T=O.pmid)&&void 0!==T?T:void 0,lendingLibraryId:null!==(L=O.lendingLibraryId)&&void 0!==L?L:void 0,requestingLibraryId:null!==(A=O.requestingLibraryId)&&void 0!==A?A:void 0,libraryGroupId:null!==(P=O.libraryGroupId)&&void 0!==P?P:void 0,openAccess:null!==(_=O.openAccess)&&void 0!==_?_:void 0,withinLibraryHoldings:null!==(N=O.withinLibraryHoldings)&&void 0!==N?N:void 0};if(e.conversions&&(R.conversions=S([],e.conversions,!0)),void 0!==e.extras)for(var M=0,U=Object.keys(e.extras);M<U.length;M++){var j=U[M];R[j]=null!==(E=e.extras[j])&&void 0!==E?E:void 0}return R.journalId=e.journalId||R.journalId,R.issueId=e.issueId||R.issueId,R.articleId=e.articleId||R.articleId,R.doi=e.doi||R.doi,e.hasOwnProperty("openAccess")&&(R.openAccess=e.openAccess),e.hasOwnProperty("withinLibraryHoldings")&&(R.withinLibraryHoldings=e.withinLibraryHoldings),R.pmid=e.pmid||R.pmid,R.libraryId=e.libraryId||R.libraryId,R.userId=e.userId||R.userId,R.url=e.url||R.url,R},t.newRandomUuid=function(){return b()},t.newCurrentTimeIsoTimestamp=function(){return(new Date).toISOString()},t}(),x=function(){function t(t){this.mDelegate=t,this.mFailedEvents=[],this.initOrClearFailedEvents()}return t.prototype.checkOutFailedEventsQueue=function(){var t=this.mFailedEvents;return this.initOrClearFailedEvents(),t},t.prototype.getFailedEventCount=function(){return this.mFailedEvents.length},t.prototype.onEventSendFailed=function(t,e){var i,n=t[t.length-1],a=e.actualError.name;i=D.isHttpError(e)?"".concat(a,"(").concat(e.httpStatusCode,")"):a,n.initialPostError=i,this.addAllEventsFromFailedPost(t)},t.prototype.addAllEventsFromFailedPost=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];this.mFailedEvents.push(n)}for(var a=this.mDelegate.maxFailedEventsInQueue();this.mFailedEvents.length>0&&this.mFailedEvents.length>a;)this.mFailedEvents.shift()},t.prototype.initOrClearFailedEvents=function(){this.mFailedEvents=[]},t}(),I=function(){function t(t){this.mDelegate=t,this.mFailedEventQueue=new x(t)}return t.prototype.getFailedEventCount=function(){return this.mFailedEventQueue.getFailedEventCount()},t.prototype.sendEvent=function(t){var e=D.newEventOutput(this.mDelegate,t);return this.sendEventOutput(e,e.property)},t.prototype.sendEventOutput=function(t,e){var i=this.mFailedEventQueue.checkOutFailedEventsQueue();i.push(t);var n=this.createFinalPayload(i);return this.sendFinalPayload(n,e)},t.prototype.sendFinalPayload=function(t,e){var i=this;return new Promise((function(e,n){var a=JSON.stringify(t);i.mDelegate.postEvent(a,{onSuccess:function(){return e()},onFailure:function(e){return i.onEventSendFailed(e,t),n(e)}})}))},t.prototype.onEventSendFailed=function(t,e){this.mDelegate.logError(t.actualError),this.mFailedEventQueue.onEventSendFailed(e.events,t)},t.prototype.createFinalPayload=function(t){return{events:t,token:this.mDelegate.getClientToken()}},t}();!function(t){t.PRODUCTION_FOREGROUND="production_foreground",t.NON_PRODUCTION_FOREGROUND="non_production_foreground"}(y||(y={}));var C=function(){function t(){}return t.getServerUrl=function(e){switch(e){case y.PRODUCTION_FOREGROUND:return t.PRODUCTION_SERVER_URL;case y.NON_PRODUCTION_FOREGROUND:default:return t.STAGING_SERVER_URL}},t.PRODUCTION_SERVER_URL="https://analytics.thirdiron.com/events",t.STAGING_SERVER_URL="https://staging-analytics.thirdiron.com/events",t.CLIENT_TOKEN="QnVvJNPw2LNnqx8b3AF5ecm0ULInX2",t.MAX_OFFLINE_QUEUED_EVENTS=256,t}(),k=function(){function t(t){this._serviceAddress=t}return t.prototype.getCurrentIsoTimestamp=function(){return D.newCurrentTimeIsoTimestamp()},t.prototype.newEventUuid=function(){return D.newRandomUuid()},t.prototype.getClientToken=function(){return C.CLIENT_TOKEN},t.prototype.maxFailedEventsInQueue=function(){return C.MAX_OFFLINE_QUEUED_EVENTS},t.prototype.postEvent=function(t,e){if(!this._serviceAddress)throw new Error("No service address configured! Cannot make call");fetch(this._serviceAddress,{method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8"},signal:AbortSignal.timeout(3e4),body:t}).then((function(t){200===t.status?e.onSuccess():e.onFailure({actualError:new Error("Non 200 status code: ".concat(t.status)),httpStatusCode:t.status})}),(function(t){e.onFailure({actualError:t})}))},t}();const T=class{async getStorageData(t){const e=await browser.storage.sync.get(t);return e?e[t]:void 0}async setStorageData(t){await browser.storage.sync.set(t)}async removeStorageData(t){await browser.storage.sync.remove(t)}async clearStorageData(){await browser.storage.sync.clear()}async getLocalStorageData(t){const e=await browser.storage.local.get(t);return e?e[t]:void 0}async setLocalStorageData(t){await browser.storage.local.set(t)}async removeLocalStorageData(t){await browser.storage.local.remove(t)}async getStoredLibrary(){return this.getStorageData("library")}async setStoredLibrary(t){void 0!==t?await this.setStorageData({library:t}):await this.removeStorageData("library")}async getProblematicDomains(){const t=await this.getLocalStorageData("problematicDomains");if(t)return{domainsMap:new Map(JSON.parse(null===t||void 0===t?void 0:t.domainsMap)),libraryId:null===t||void 0===t?void 0:t.libraryId,updatedDate:null===t||void 0===t?void 0:t.updatedDate}}async setProblematicDomains(t){if(void 0!==t){const e={domainsMap:JSON.stringify(Array.from(t.domainsMap.entries())),libraryId:t.libraryId,updatedDate:t.updatedDate};await this.setLocalStorageData({problematicDomains:e})}else await this.removeLocalStorageData("problematicDomains")}async getStoredCitationExportConfig(){return this.getLocalStorageData("citationExportConfig")}async setStoredCitationExportConfig(t){void 0!==t?await this.setLocalStorageData({citationExportConfig:t}):await this.removeLocalStorageData("citationExportConfig")}async getStoredDesignStudioConfig(){return this.getLocalStorageData("designStudioConfig")}async setStoredDesignStudioConfig(t){void 0!==t?await this.setLocalStorageData({designStudioConfig:t}):await this.removeLocalStorageData("designStudioConfig")}async getStoredDomainMessagingConfig(){return this.getLocalStorageData("domainMessagingConfig")}async setStoredDomainMessagingConfig(t){void 0!==t?await this.setLocalStorageData({domainMessagingConfig:t}):await this.removeLocalStorageData("domainMessagingConfig")}async getStoredNomadChatConfig(){return this.getLocalStorageData("nomadChatConfig")}async setStoredNomadChatConfig(t){void 0!==t?await this.setLocalStorageData({nomadChatConfig:t}):await this.removeLocalStorageData("nomadChatConfig")}async getStoredLastCheckedLibraryConfigStatus(){return this.getLocalStorageData("lastCheckedLibraryConfigStatus")}async setStoredLastCheckedLibraryConfigStatus(t){void 0!==t?await this.setLocalStorageData({lastCheckedLibraryConfigStatus:t}):await this.removeLocalStorageData("lastCheckedLibraryConfigStatus")}async getStoredLastDisplayedMessageRuleIdConfig(){return this.getLocalStorageData("lastDisplayedMessageRuleIdConfig")}async setStoredLastDisplayedMessageRuleIdConfig(t){void 0!==t?await this.setLocalStorageData({lastDisplayedMessageRuleIdConfig:t}):await this.removeLocalStorageData("lastDisplayedMessageRuleIdConfig")}async getStoredDomainMessagingStatusList(){return this.getLocalStorageData("domainMessagingStatusList")}async setStoredDomainMessagingStatusList(t){void 0!==t?await this.setLocalStorageData({domainMessagingStatusList:t}):await this.removeLocalStorageData("domainMessagingStatusList")}async getStoredMendeleyConfig(){return await this.getLocalStorageData("mendeleyConfig")}async setStoredMendeleyConfig(t){void 0!==t?await this.setLocalStorageData({mendeleyConfig:t}):await this.removeLocalStorageData("mendeleyConfig")}async getStoredZoteroSaveSecrets(){return this.getLocalStorageData("zoteroSaveSecrets")}async setStoredZoteroSaveSecrets(t){void 0!==t?await this.setLocalStorageData({zoteroSaveSecrets:t}):await this.removeLocalStorageData("zoteroSaveSecrets")}async getStoredZoteroTempTokens(){return this.getLocalStorageData("zoteroTempTokens")}async setStoredZoteroTempTokens(t){void 0!==t?await this.setLocalStorageData({zoteroTempTokens:t}):await this.removeLocalStorageData("zoteroTempTokens")}async getStoredCitationArticleId(){return this.getLocalStorageData("citationArticleId")}async setStoredCitationArticleId(t){void 0!==t?await this.setLocalStorageData({citationArticleId:t}):await this.removeLocalStorageData("citationArticleId")}async getStoredProxyDomainMatches(){return this.getLocalStorageData("proxyDomainMatches")}async setStoredProxyDomainMatches(t){void 0!==t?await this.setLocalStorageData({proxyDomainMatches:t}):await this.removeLocalStorageData("proxyDomainMatches")}async getStoredUniqueDeviceId(){return this.getLocalStorageData("uniqueDeviceId")}async setStoredUniqueDeviceId(t){void 0!==t?await this.setLocalStorageData({uniqueDeviceId:t}):await this.removeLocalStorageData("uniqueDeviceId")}async getStoredSelectedNomadStatus(){return this.getStorageData("selectedNomadStatus")}async setStoredSelectedNomadStatus(t){void 0!==t?await this.setStorageData({selectedNomadStatus:t}):await this.removeStorageData("selectedNomadStatus")}async getStoredDomainMessagingRecentlyAccessedAuthInProgressEntryList(){return this.getLocalStorageData("domainMessagingRecentlyAccessedAuthInProgressList")}async setStoredDomainMessagingRecentlyAccessedAuthInProgressEntryList(t){void 0!==t?await this.setLocalStorageData({domainMessagingRecentlyAccessedAuthInProgressList:t}):await this.removeLocalStorageData("domainMessagingRecentlyAccessedAuthInProgressList")}async getStoredDomainMessagingRecentlyAccessedAuthEntryList(){return this.getLocalStorageData("domainMessagingRecentlyAccessedAuthList")}async setStoredDomainMessagingRecentlyAccessedAuthEntryList(t){void 0!==t?await this.setLocalStorageData({domainMessagingRecentlyAccessedAuthList:t}):await this.removeLocalStorageData("domainMessagingRecentlyAccessedAuthList")}async getStoredLastButtonClickedUrl(){return this.getLocalStorageData("lastButtonClickedUrl")}async setStoredLastButtonClickedUrl(t){void 0!==t?await this.setLocalStorageData({lastButtonClickedUrl:t}):await this.removeLocalStorageData("lastButtonClickedUrl")}async getPolicyData(t){var e,i;if(this.testing=!(null===(e=navigator)||void 0===e||!e.userAgent)&&navigator.userAgent.includes("PuppeteerAgent"),this.managedLibrary=!(null===(i=navigator)||void 0===i||!i.userAgent)&&navigator.userAgent.includes("ManagedLibrary"),this.testing&&this.managedLibrary)switch(t){case"libraryId":return String(248);case"buttonPlacement":return"bottomRight";default:return""}try{const e=await browser.storage.managed.get(t);return e?e[t]:void 0}catch(n){return}}async getIsRepeatUrl(){const t=await this.getStoredLastButtonClickedUrl();return!!t&&window.location.pathname.toLowerCase()===t.toLowerCase()}async shouldResetLastButtonClickedUrl(){return!window.location.hostname.endsWith("libkey.io")&&!await this.getIsRepeatUrl()}setActiveIcon(){browser.action.setIcon({path:{16:"icons/libkey-nomad-flame-16.png",32:"icons/libkey-nomad-flame-32.png",48:"icons/libkey-nomad-flame-48.png",128:"icons/libkey-nomad-flame-128.png"}})}setInactiveIcon(){browser.action.setIcon({path:{16:"icons/libkey-nomad-flame-inactive-16.png",32:"icons/libkey-nomad-flame-inactive-32.png",48:"icons/libkey-nomad-flame-inactive-48.png",128:"icons/libkey-nomad-flame-inactive-128.png"}})}setPausedIcon(){browser.action.setIcon({path:{16:"icons/libkey-nomad-flame-pause-16.png",32:"icons/libkey-nomad-flame-pause-32.png",48:"icons/libkey-nomad-flame-pause-48.png",128:"icons/libkey-nomad-flame-pause-128.png"}})}setEnvironmentIndicators(t,e){t&&e?browser.action.setBadgeText({text:"Stg"}):t&&!e?browser.action.setBadgeText({text:"api"}):!t&&e?browser.action.setBadgeText({text:"log"}):browser.action.setBadgeText({text:""})}async createTab(t){return browser.tabs.create(t)}async getTabs(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return await browser.tabs.query(t)}sleep(t){return new Promise((e=>setTimeout(e,t)))}getBrowserName(){return new d.UAParser(navigator.userAgent).getResult().browser.name}async getBackgroundDimensions(){const t=new d.UAParser(navigator.userAgent).getResult();let e=await this.getStoredUniqueDeviceId();return e||(e=u(),await this.setStoredUniqueDeviceId(e)),{appName:"Nomad",appVersion:browser.runtime.getManifest().version,property:y.PRODUCTION_FOREGROUND,os:t.os.name,osVersion:t.os.version,uniqueDeviceId:e,deviceMake:t.device.vendor,deviceModel:t.device.model,browser:t.browser.name,browserVersion:t.browser.version,userAgent:t.ua,url:"not captured"}}async getAnalyticsDimensions(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return{messageType:"analytics",eventCategory:t,eventType:e,extras:{installType:await this.getStorageData("installType"),...await this.getBackgroundDimensions(),...i}}}async sendAnalyticsEvent(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=await this.getAnalyticsDimensions(t,e,i);await browser.runtime.sendMessage(n)}fetch(t,e){return new Promise(((i,n)=>{browser.runtime.sendMessage({resource:t,options:e}).then((t=>{if(t){const[e,a]=t;if(null===e)n(a);else{const t=e.body?new Blob([e.body]):void 0;i(new Response(t,{status:e.status,statusText:e.statusText,headers:e.headers}))}}else n(new Error("No message response"))}))}))}},L={PROD_ANALYTICS_ORIGIN:"https://a.thirdiron.com/events",PROD_API_ORIGIN:"https://api.thirdiron.com",PROD_NOMAD_ORIGIN:"https://nomad-api.thirdiron.com",PROD_CDN_ORIGIN:"https://nomad-api-cdn.thirdiron.com",STAGING_ANALYTICS_ORIGIN:"https://staging-a.thirdiron.com/events",STAGING_ORIGIN:"https://staging-api.thirdiron.com",STAGING_CDN_ORIGIN:"https://staging-nomad-api-cdn.thirdiron.com",TESTING_ORIGIN:"http://localhost:3001",USE_STAGING:"useStaging"};const A=class{constructor(){this.testing=!1,this.extension=new T}async useStaging(){return await this.extension.getStorageData(L.USE_STAGING)||!1}async useStagingAnalyticsServer(){return await this.extension.getStorageData("useStagingAnalyticsServer")||!1}async origin(){const t=await this.useStaging()?L.STAGING_ORIGIN:L.PROD_NOMAD_ORIGIN;return this.testing?L.TESTING_ORIGIN:t}async cdnOrigin(){const t=await this.useStaging()?L.STAGING_CDN_ORIGIN:L.PROD_CDN_ORIGIN;return this.testing?L.TESTING_ORIGIN:t}async tokenOrigin(){const t=await this.useStaging()?L.STAGING_ORIGIN:L.PROD_API_ORIGIN;return this.testing?L.TESTING_ORIGIN:t}async analyticsOrigin(){return await this.useStagingAnalyticsServer()?L.PROD_ANALYTICS_ORIGIN:L.STAGING_ANALYTICS_ORIGIN}async getToken(t){const e=await this.extension.fetch("".concat(await this.tokenOrigin(),"/v2/api-tokens"),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({libraryId:t.id})});return(await e.json())["api-tokens"][0]}async refreshLibraryToken(){const t=await this.extension.getStoredLibrary();return t.apiToken=await this.getToken(t),await this.extension.setStoredLibrary(t),t.apiToken.id}async fetchWithApiTokenRefresh(t,e){let i;const n={headers:{Authorization:"Bearer ".concat(e)}};let a=await this.extension.fetch(t,n);return 401===a.status&&(i=await this.refreshLibraryToken(),n.headers.Authorization="Bearer ".concat(i),a=await this.extension.fetch(t,n)),a}async getBook(t,e){const i="".concat(t,"?access_token=").concat(e);let n=await this.extension.fetch(i);if(401===n.status){const e=await this.refreshLibraryToken();n=await this.extension.fetch("".concat(t,"?access_token=").concat(e))}return n}async getArticle(t,e){const i="".concat(t,"&access_token=").concat(e);let n=await this.extension.fetch(i);if(401===n.status){const e=await this.refreshLibraryToken();n=await this.extension.fetch("".concat(t,"&access_token=").concat(e))}return n}async getArticleByDoi(t,e){const i="".concat(await this.origin(),"/v2/articles/doi:").concat(encodeURIComponent(t),"?include=issue,journal");return this.getArticle(i,e)}async getArticleByPmid(t,e){const i="".concat(await this.origin(),"/v2/articles/pmid:").concat(encodeURIComponent(t),"?include=journal");return this.getArticle(i,e)}async getIsIpValidated(t,e){const i="".concat(await this.origin(),"/v2/libraries/").concat(t,"/check-ip?access_token=").concat(e);try{const t=await this.extension.fetch(i,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"});return(await t.json()).ipWithinRanges}catch(n){return console.error("Third Iron API response error: ",n),!1}}};var P="1.13.7",_="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},N=Array.prototype,E=Object.prototype,O="undefined"!==typeof Symbol?Symbol.prototype:null,R=N.push,M=N.slice,U=E.toString,j=E.hasOwnProperty,B="undefined"!==typeof ArrayBuffer,F="undefined"!==typeof DataView,G=Array.isArray,q=Object.keys,V=Object.create,z=B&&ArrayBuffer.isView,W=isNaN,H=isFinite,Q=!{toString:null}.propertyIsEnumerable("toString"),$=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Z=Math.pow(2,53)-1;function K(t,e){return e=null==e?t.length-1:+e,function(){for(var i=Math.max(arguments.length-e,0),n=Array(i),a=0;a<i;a++)n[a]=arguments[a+e];switch(e){case 0:return t.call(this,n);case 1:return t.call(this,arguments[0],n);case 2:return t.call(this,arguments[0],arguments[1],n)}var r=Array(e+1);for(a=0;a<e;a++)r[a]=arguments[a];return r[e]=n,t.apply(this,r)}}function J(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function Y(t){return null===t}function X(t){return void 0===t}function tt(t){return!0===t||!1===t||"[object Boolean]"===U.call(t)}function et(t){return!(!t||1!==t.nodeType)}function it(t){var e="[object "+t+"]";return function(t){return U.call(t)===e}}const nt=it("String"),at=it("Number"),rt=it("Date"),ot=it("RegExp"),st=it("Error"),ct=it("Symbol"),ut=it("ArrayBuffer");var lt=it("Function"),dt=_.document&&_.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof dt&&(lt=function(t){return"function"==typeof t||!1});const gt=lt,ft=it("Object");var ht=F&&(!/\[native code\]/.test(String(DataView))||ft(new DataView(new ArrayBuffer(8)))),pt="undefined"!==typeof Map&&ft(new Map),vt=it("DataView");const wt=ht?function(t){return null!=t&&gt(t.getInt8)&&ut(t.buffer)}:vt,mt=G||it("Array");function bt(t,e){return null!=t&&j.call(t,e)}var yt=it("Arguments");!function(){yt(arguments)||(yt=function(t){return bt(t,"callee")})}();const St=yt;function Dt(t){return!ct(t)&&H(t)&&!isNaN(parseFloat(t))}function xt(t){return at(t)&&W(t)}function It(t){return function(){return t}}function Ct(t){return function(e){var i=t(e);return"number"==typeof i&&i>=0&&i<=Z}}function kt(t){return function(e){return null==e?void 0:e[t]}}const Tt=kt("byteLength"),Lt=Ct(Tt);var At=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;const Pt=B?function(t){return z?z(t)&&!wt(t):Lt(t)&&At.test(U.call(t))}:It(!1),_t=kt("length");function Nt(t,e){e=function(t){for(var e={},i=t.length,n=0;n<i;++n)e[t[n]]=!0;return{contains:function(t){return!0===e[t]},push:function(i){return e[i]=!0,t.push(i)}}}(e);var i=$.length,n=t.constructor,a=gt(n)&&n.prototype||E,r="constructor";for(bt(t,r)&&!e.contains(r)&&e.push(r);i--;)(r=$[i])in t&&t[r]!==a[r]&&!e.contains(r)&&e.push(r)}function Et(t){if(!J(t))return[];if(q)return q(t);var e=[];for(var i in t)bt(t,i)&&e.push(i);return Q&&Nt(t,e),e}function Ot(t){if(null==t)return!0;var e=_t(t);return"number"==typeof e&&(mt(t)||nt(t)||St(t))?0===e:0===_t(Et(t))}function Rt(t,e){var i=Et(e),n=i.length;if(null==t)return!n;for(var a=Object(t),r=0;r<n;r++){var o=i[r];if(e[o]!==a[o]||!(o in a))return!1}return!0}function Mt(t){return t instanceof Mt?t:this instanceof Mt?void(this._wrapped=t):new Mt(t)}function Ut(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,Tt(t))}Mt.VERSION=P,Mt.prototype.value=function(){return this._wrapped},Mt.prototype.valueOf=Mt.prototype.toJSON=Mt.prototype.value,Mt.prototype.toString=function(){return String(this._wrapped)};var jt="[object DataView]";function Bt(t,e,i,n){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return!1;if(t!==t)return e!==e;var a=typeof t;return("function"===a||"object"===a||"object"==typeof e)&&Ft(t,e,i,n)}function Ft(t,e,i,n){t instanceof Mt&&(t=t._wrapped),e instanceof Mt&&(e=e._wrapped);var a=U.call(t);if(a!==U.call(e))return!1;if(ht&&"[object Object]"==a&&wt(t)){if(!wt(e))return!1;a=jt}switch(a){case"[object RegExp]":case"[object String]":return""+t===""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e;case"[object Symbol]":return O.valueOf.call(t)===O.valueOf.call(e);case"[object ArrayBuffer]":case jt:return Ft(Ut(t),Ut(e),i,n)}var r="[object Array]"===a;if(!r&&Pt(t)){if(Tt(t)!==Tt(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;r=!0}if(!r){if("object"!=typeof t||"object"!=typeof e)return!1;var o=t.constructor,s=e.constructor;if(o!==s&&!(gt(o)&&o instanceof o&&gt(s)&&s instanceof s)&&"constructor"in t&&"constructor"in e)return!1}n=n||[];for(var c=(i=i||[]).length;c--;)if(i[c]===t)return n[c]===e;if(i.push(t),n.push(e),r){if((c=t.length)!==e.length)return!1;for(;c--;)if(!Bt(t[c],e[c],i,n))return!1}else{var u,l=Et(t);if(c=l.length,Et(e).length!==c)return!1;for(;c--;)if(!bt(e,u=l[c])||!Bt(t[u],e[u],i,n))return!1}return i.pop(),n.pop(),!0}function Gt(t,e){return Bt(t,e)}function qt(t){if(!J(t))return[];var e=[];for(var i in t)e.push(i);return Q&&Nt(t,e),e}function Vt(t){var e=_t(t);return function(i){if(null==i)return!1;var n=qt(i);if(_t(n))return!1;for(var a=0;a<e;a++)if(!gt(i[t[a]]))return!1;return t!==$t||!gt(i[zt])}}var zt="forEach",Wt=["clear","delete"],Ht=["get","has","set"],Qt=Wt.concat(zt,Ht),$t=Wt.concat(Ht),Zt=["add"].concat(Wt,zt,"has");const Kt=pt?Vt(Qt):it("Map"),Jt=pt?Vt($t):it("WeakMap"),Yt=pt?Vt(Zt):it("Set"),Xt=it("WeakSet");function te(t){for(var e=Et(t),i=e.length,n=Array(i),a=0;a<i;a++)n[a]=t[e[a]];return n}function ee(t){for(var e=Et(t),i=e.length,n=Array(i),a=0;a<i;a++)n[a]=[e[a],t[e[a]]];return n}function ie(t){for(var e={},i=Et(t),n=0,a=i.length;n<a;n++)e[t[i[n]]]=i[n];return e}function ne(t){var e=[];for(var i in t)gt(t[i])&&e.push(i);return e.sort()}function ae(t,e){return function(i){var n=arguments.length;if(e&&(i=Object(i)),n<2||null==i)return i;for(var a=1;a<n;a++)for(var r=arguments[a],o=t(r),s=o.length,c=0;c<s;c++){var u=o[c];e&&void 0!==i[u]||(i[u]=r[u])}return i}}const re=ae(qt),oe=ae(Et),se=ae(qt,!0);function ce(t){if(!J(t))return{};if(V)return V(t);var e=function(){};e.prototype=t;var i=new e;return e.prototype=null,i}function ue(t,e){var i=ce(t);return e&&oe(i,e),i}function le(t){return J(t)?mt(t)?t.slice():re({},t):t}function de(t,e){return e(t),t}function ge(t){return mt(t)?t:[t]}function fe(t){return Mt.toPath(t)}function he(t,e){for(var i=e.length,n=0;n<i;n++){if(null==t)return;t=t[e[n]]}return i?t:void 0}function pe(t,e,i){var n=he(t,fe(e));return X(n)?i:n}function ve(t,e){for(var i=(e=fe(e)).length,n=0;n<i;n++){var a=e[n];if(!bt(t,a))return!1;t=t[a]}return!!i}function we(t){return t}function me(t){return t=oe({},t),function(e){return Rt(e,t)}}function be(t){return t=fe(t),function(e){return he(e,t)}}function ye(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 3:return function(i,n,a){return t.call(e,i,n,a)};case 4:return function(i,n,a,r){return t.call(e,i,n,a,r)}}return function(){return t.apply(e,arguments)}}function Se(t,e,i){return null==t?we:gt(t)?ye(t,e,i):J(t)&&!mt(t)?me(t):be(t)}function De(t,e){return Se(t,e,1/0)}function xe(t,e,i){return Mt.iteratee!==De?Mt.iteratee(t,e):Se(t,e,i)}function Ie(t,e,i){e=xe(e,i);for(var n=Et(t),a=n.length,r={},o=0;o<a;o++){var s=n[o];r[s]=e(t[s],s,t)}return r}function Ce(){}function ke(t){return null==t?Ce:function(e){return pe(t,e)}}function Te(t,e,i){var n=Array(Math.max(0,t));e=ye(e,i,1);for(var a=0;a<t;a++)n[a]=e(a);return n}function Le(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}Mt.toPath=ge,Mt.iteratee=De;const Ae=Date.now||function(){return(new Date).getTime()};function Pe(t){var e=function(e){return t[e]},i="(?:"+Et(t).join("|")+")",n=RegExp(i),a=RegExp(i,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(a,e):t}}const _e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Ne=Pe(_e),Ee=Pe(ie(_e)),Oe=Mt.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var Re=/(.)^/,Me={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Ue=/\\|'|\r|\n|\u2028|\u2029/g;function je(t){return"\\"+Me[t]}var Be=/^\s*(\w|\$)+\s*$/;function Fe(t,e,i){!e&&i&&(e=i),e=se({},e,Mt.templateSettings);var n=RegExp([(e.escape||Re).source,(e.interpolate||Re).source,(e.evaluate||Re).source].join("|")+"|$","g"),a=0,r="__p+='";t.replace(n,(function(e,i,n,o,s){return r+=t.slice(a,s).replace(Ue,je),a=s+e.length,i?r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?r+="'+\n((__t=("+n+"))==null?'':__t)+\n'":o&&(r+="';\n"+o+"\n__p+='"),e})),r+="';\n";var o,s=e.variable;if(s){if(!Be.test(s))throw new Error("variable is not a bare identifier: "+s)}else r="with(obj||{}){\n"+r+"}\n",s="obj";r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{o=new Function(s,"_",r)}catch(u){throw u.source=r,u}var c=function(t){return o.call(this,t,Mt)};return c.source="function("+s+"){\n"+r+"}",c}function Ge(t,e,i){var n=(e=fe(e)).length;if(!n)return gt(i)?i.call(t):i;for(var a=0;a<n;a++){var r=null==t?void 0:t[e[a]];void 0===r&&(r=i,a=n),t=gt(r)?r.call(t):r}return t}var qe=0;function Ve(t){var e=++qe+"";return t?t+e:e}function ze(t){var e=Mt(t);return e._chain=!0,e}function We(t,e,i,n,a){if(!(n instanceof e))return t.apply(i,a);var r=ce(t.prototype),o=t.apply(r,a);return J(o)?o:r}var He=K((function(t,e){var i=He.placeholder,n=function(){for(var a=0,r=e.length,o=Array(r),s=0;s<r;s++)o[s]=e[s]===i?arguments[a++]:e[s];for(;a<arguments.length;)o.push(arguments[a++]);return We(t,n,this,this,o)};return n}));He.placeholder=Mt;const Qe=He,$e=K((function(t,e,i){if(!gt(t))throw new TypeError("Bind must be called on a function");var n=K((function(a){return We(t,n,e,this,i.concat(a))}));return n})),Ze=Ct(_t);function Ke(t,e,i,n){if(n=n||[],e||0===e){if(e<=0)return n.concat(t)}else e=1/0;for(var a=n.length,r=0,o=_t(t);r<o;r++){var s=t[r];if(Ze(s)&&(mt(s)||St(s)))if(e>1)Ke(s,e-1,i,n),a=n.length;else for(var c=0,u=s.length;c<u;)n[a++]=s[c++];else i||(n[a++]=s)}return n}const Je=K((function(t,e){var i=(e=Ke(e,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var n=e[i];t[n]=$e(t[n],t)}return t}));function Ye(t,e){var i=function(n){var a=i.cache,r=""+(e?e.apply(this,arguments):n);return bt(a,r)||(a[r]=t.apply(this,arguments)),a[r]};return i.cache={},i}const Xe=K((function(t,e,i){return setTimeout((function(){return t.apply(null,i)}),e)})),ti=Qe(Xe,Mt,1);function ei(t,e,i){var n,a,r,o,s=0;i||(i={});var c=function(){s=!1===i.leading?0:Ae(),n=null,o=t.apply(a,r),n||(a=r=null)},u=function(){var u=Ae();s||!1!==i.leading||(s=u);var l=e-(u-s);return a=this,r=arguments,l<=0||l>e?(n&&(clearTimeout(n),n=null),s=u,o=t.apply(a,r),n||(a=r=null)):n||!1===i.trailing||(n=setTimeout(c,l)),o};return u.cancel=function(){clearTimeout(n),s=0,n=a=r=null},u}function ii(t,e,i){var n,a,r,o,s,c=function(){var u=Ae()-a;e>u?n=setTimeout(c,e-u):(n=null,i||(o=t.apply(s,r)),n||(r=s=null))},u=K((function(u){return s=this,r=u,a=Ae(),n||(n=setTimeout(c,e),i&&(o=t.apply(s,r))),o}));return u.cancel=function(){clearTimeout(n),n=r=s=null},u}function ni(t,e){return Qe(e,t)}function ai(t){return function(){return!t.apply(this,arguments)}}function ri(){var t=arguments,e=t.length-1;return function(){for(var i=e,n=t[e].apply(this,arguments);i--;)n=t[i].call(this,n);return n}}function oi(t,e){return function(){if(--t<1)return e.apply(this,arguments)}}function si(t,e){var i;return function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=null),i}}const ci=Qe(si,2);function ui(t,e,i){e=xe(e,i);for(var n,a=Et(t),r=0,o=a.length;r<o;r++)if(e(t[n=a[r]],n,t))return n}function li(t){return function(e,i,n){i=xe(i,n);for(var a=_t(e),r=t>0?0:a-1;r>=0&&r<a;r+=t)if(i(e[r],r,e))return r;return-1}}const di=li(1),gi=li(-1);function fi(t,e,i,n){for(var a=(i=xe(i,n,1))(e),r=0,o=_t(t);r<o;){var s=Math.floor((r+o)/2);i(t[s])<a?r=s+1:o=s}return r}function hi(t,e,i){return function(n,a,r){var o=0,s=_t(n);if("number"==typeof r)t>0?o=r>=0?r:Math.max(r+s,o):s=r>=0?Math.min(r+1,s):r+s+1;else if(i&&r&&s)return n[r=i(n,a)]===a?r:-1;if(a!==a)return(r=e(M.call(n,o,s),xt))>=0?r+o:-1;for(r=t>0?o:s-1;r>=0&&r<s;r+=t)if(n[r]===a)return r;return-1}}const pi=hi(1,di,fi),vi=hi(-1,gi);function wi(t,e,i){var n=(Ze(t)?di:ui)(t,e,i);if(void 0!==n&&-1!==n)return t[n]}function mi(t,e){return wi(t,me(e))}function bi(t,e,i){var n,a;if(e=ye(e,i),Ze(t))for(n=0,a=t.length;n<a;n++)e(t[n],n,t);else{var r=Et(t);for(n=0,a=r.length;n<a;n++)e(t[r[n]],r[n],t)}return t}function yi(t,e,i){e=xe(e,i);for(var n=!Ze(t)&&Et(t),a=(n||t).length,r=Array(a),o=0;o<a;o++){var s=n?n[o]:o;r[o]=e(t[s],s,t)}return r}function Si(t){return function(e,i,n,a){var r=arguments.length>=3;return function(e,i,n,a){var r=!Ze(e)&&Et(e),o=(r||e).length,s=t>0?0:o-1;for(a||(n=e[r?r[s]:s],s+=t);s>=0&&s<o;s+=t){var c=r?r[s]:s;n=i(n,e[c],c,e)}return n}(e,ye(i,a,4),n,r)}}const Di=Si(1),xi=Si(-1);function Ii(t,e,i){var n=[];return e=xe(e,i),bi(t,(function(t,i,a){e(t,i,a)&&n.push(t)})),n}function Ci(t,e,i){return Ii(t,ai(xe(e)),i)}function ki(t,e,i){e=xe(e,i);for(var n=!Ze(t)&&Et(t),a=(n||t).length,r=0;r<a;r++){var o=n?n[r]:r;if(!e(t[o],o,t))return!1}return!0}function Ti(t,e,i){e=xe(e,i);for(var n=!Ze(t)&&Et(t),a=(n||t).length,r=0;r<a;r++){var o=n?n[r]:r;if(e(t[o],o,t))return!0}return!1}function Li(t,e,i,n){return Ze(t)||(t=te(t)),("number"!=typeof i||n)&&(i=0),pi(t,e,i)>=0}const Ai=K((function(t,e,i){var n,a;return gt(e)?a=e:(e=fe(e),n=e.slice(0,-1),e=e[e.length-1]),yi(t,(function(t){var r=a;if(!r){if(n&&n.length&&(t=he(t,n)),null==t)return;r=t[e]}return null==r?r:r.apply(t,i)}))}));function Pi(t,e){return yi(t,be(e))}function _i(t,e){return Ii(t,me(e))}function Ni(t,e,i){var n,a,r=-1/0,o=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var s=0,c=(t=Ze(t)?t:te(t)).length;s<c;s++)null!=(n=t[s])&&n>r&&(r=n);else e=xe(e,i),bi(t,(function(t,i,n){((a=e(t,i,n))>o||a===-1/0&&r===-1/0)&&(r=t,o=a)}));return r}function Ei(t,e,i){var n,a,r=1/0,o=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var s=0,c=(t=Ze(t)?t:te(t)).length;s<c;s++)null!=(n=t[s])&&n<r&&(r=n);else e=xe(e,i),bi(t,(function(t,i,n){((a=e(t,i,n))<o||a===1/0&&r===1/0)&&(r=t,o=a)}));return r}var Oi=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Ri(t){return t?mt(t)?M.call(t):nt(t)?t.match(Oi):Ze(t)?yi(t,we):te(t):[]}function Mi(t,e,i){if(null==e||i)return Ze(t)||(t=te(t)),t[Le(t.length-1)];var n=Ri(t),a=_t(n);e=Math.max(Math.min(e,a),0);for(var r=a-1,o=0;o<e;o++){var s=Le(o,r),c=n[o];n[o]=n[s],n[s]=c}return n.slice(0,e)}function Ui(t){return Mi(t,1/0)}function ji(t,e,i){var n=0;return e=xe(e,i),Pi(yi(t,(function(t,i,a){return{value:t,index:n++,criteria:e(t,i,a)}})).sort((function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return t.index-e.index})),"value")}function Bi(t,e){return function(i,n,a){var r=e?[[],[]]:{};return n=xe(n,a),bi(i,(function(e,a){var o=n(e,a,i);t(r,e,o)})),r}}const Fi=Bi((function(t,e,i){bt(t,i)?t[i].push(e):t[i]=[e]})),Gi=Bi((function(t,e,i){t[i]=e})),qi=Bi((function(t,e,i){bt(t,i)?t[i]++:t[i]=1})),Vi=Bi((function(t,e,i){t[i?0:1].push(e)}),!0);function zi(t){return null==t?0:Ze(t)?t.length:Et(t).length}function Wi(t,e,i){return e in i}const Hi=K((function(t,e){var i={},n=e[0];if(null==t)return i;gt(n)?(e.length>1&&(n=ye(n,e[1])),e=qt(t)):(n=Wi,e=Ke(e,!1,!1),t=Object(t));for(var a=0,r=e.length;a<r;a++){var o=e[a],s=t[o];n(s,o,t)&&(i[o]=s)}return i})),Qi=K((function(t,e){var i,n=e[0];return gt(n)?(n=ai(n),e.length>1&&(i=e[1])):(e=yi(Ke(e,!1,!1),String),n=function(t,i){return!Li(e,i)}),Hi(t,n,i)}));function $i(t,e,i){return M.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))}function Zi(t,e,i){return null==t||t.length<1?null==e||i?void 0:[]:null==e||i?t[0]:$i(t,t.length-e)}function Ki(t,e,i){return M.call(t,null==e||i?1:e)}function Ji(t,e,i){return null==t||t.length<1?null==e||i?void 0:[]:null==e||i?t[t.length-1]:Ki(t,Math.max(0,t.length-e))}function Yi(t){return Ii(t,Boolean)}function Xi(t,e){return Ke(t,e,!1)}const tn=K((function(t,e){return e=Ke(e,!0,!0),Ii(t,(function(t){return!Li(e,t)}))})),en=K((function(t,e){return tn(t,e)}));function nn(t,e,i,n){tt(e)||(n=i,i=e,e=!1),null!=i&&(i=xe(i,n));for(var a=[],r=[],o=0,s=_t(t);o<s;o++){var c=t[o],u=i?i(c,o,t):c;e&&!i?(o&&r===u||a.push(c),r=u):i?Li(r,u)||(r.push(u),a.push(c)):Li(a,c)||a.push(c)}return a}const an=K((function(t){return nn(Ke(t,!0,!0))}));function rn(t){for(var e=[],i=arguments.length,n=0,a=_t(t);n<a;n++){var r=t[n];if(!Li(e,r)){var o;for(o=1;o<i&&Li(arguments[o],r);o++);o===i&&e.push(r)}}return e}function on(t){for(var e=t&&Ni(t,_t).length||0,i=Array(e),n=0;n<e;n++)i[n]=Pi(t,n);return i}const sn=K(on);function cn(t,e){for(var i={},n=0,a=_t(t);n<a;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i}function un(t,e,i){null==e&&(e=t||0,t=0),i||(i=e<t?-1:1);for(var n=Math.max(Math.ceil((e-t)/i),0),a=Array(n),r=0;r<n;r++,t+=i)a[r]=t;return a}function ln(t,e){if(null==e||e<1)return[];for(var i=[],n=0,a=t.length;n<a;)i.push(M.call(t,n,n+=e));return i}function dn(t,e){return t._chain?Mt(e).chain():e}function gn(t){return bi(ne(t),(function(e){var i=Mt[e]=t[e];Mt.prototype[e]=function(){var t=[this._wrapped];return R.apply(t,arguments),dn(this,i.apply(Mt,t))}})),Mt}bi(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=N[t];Mt.prototype[t]=function(){var i=this._wrapped;return null!=i&&(e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0]),dn(this,i)}})),bi(["concat","join","slice"],(function(t){var e=N[t];Mt.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=e.apply(t,arguments)),dn(this,t)}}));const fn=Mt;var hn=gn(t);hn._=hn;const pn=hn;function vn(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var wn=0;function mn(t){return"__private_"+wn+++"_"+t}var bn=mn("setZoteroConfigInLocalStorage"),yn=mn("setMendeleyConfigInLocalStorage"),Sn=mn("setDismissedMessagesInLocalStorage");async function Dn(){await this.extension.setStoredZoteroSaveSecrets({oauthToken:"testToken",oauthTokenSecret:"testTokenSecret",userID:"123",username:"testUser"})}async function xn(){const t={accessToken:"testingToken",expiration:new Date((new Date).getTime()+6e4)};await this.extension.setStoredMendeleyConfig(t)}async function In(){const t={id:"aTestId",lastDismissed:(new Date).toISOString()};await this.extension.setStoredDomainMessagingStatusList(t)}const Cn=class{constructor(){Object.defineProperty(this,Sn,{value:In}),Object.defineProperty(this,yn,{value:xn}),Object.defineProperty(this,bn,{value:Dn}),this.extension=new T,this.testing=!1,this.subscription=window.navigator.userAgent.includes("SubscriptionTest"),this.managedLibrary=window.navigator.userAgent.includes("ManagedLibrary"),this.localStorageTest=window.navigator.userAgent.includes("LocalStorageTest"),this.urlParams=new URLSearchParams(window.location.search)}async setTestLibrary(){let t;if(this.testing&&this.urlParams.get("expiredToken")){t=new Date((new Date).setDate((new Date).getDate()-10)).toISOString();const e=document.createElement("div");e.id="test-library-token-base",e.innerHTML=t,document.body.insertBefore(e,document.body.childNodes[0])}else t=new Date((new Date).setDate((new Date).getDate()+10)).toISOString();if(this.testing&&!this.managedLibrary&&await this.extension.setStoredLibrary({id:"222",attributes:{name:"Test Library C",logo:"https://assets.thirdiron.com/images/librarylogos/Iron_logo2.png",googleScholarLibraryId:"1960582506653781529",googleScholarLibraryName:"Get It! @ Test Library C",useLiveUnpaywallCalls:"true",languagesSupported:"de-de,en-us,fr-fr,ja"},apiToken:{id:"352f2463-0720-4052-8582-98fea05d560c",expires_at:t}}),this.testing&&this.localStorageTest&&(await vn(this,yn)[yn](),await vn(this,bn)[bn](),await vn(this,Sn)[Sn]()),this.testing&&this.urlParams.get("language")){const t=this.urlParams.get("language");await this.extension.setStorageData({language:t})}if(this.testing&&this.urlParams.get("button_location")){const t=this.urlParams.get("button_location");await this.extension.setStorageData({selectedBubbleLocation:t})}}getHostname(){if(this.testing&&this.urlParams.get("custom_hostname")){return this.urlParams.get("custom_hostname")}return""}getPath(){if(this.testing&&this.urlParams.get("custom_path")){return this.urlParams.get("custom_path")}return"/"}getSearchParams(){if(this.testing&&this.urlParams.get("custom_search_params")){return this.urlParams.get("custom_search_params")}return""}};var kn=mn("updateStoredDesignStudioConfig"),Tn=mn("updateStoredDomainMessagingConfig"),Ln=mn("updateStoredCitationExportConfig"),An=mn("updateStoredNomadChatConfig");async function Pn(t,e,i){let n;n=i?"".concat(await this.api.cdnOrigin(),"/v2/libraries/").concat(t,"/design-studio-config?cacheKey=").concat(i):"".concat(await this.api.cdnOrigin(),"/v2/libraries/").concat(t,"/design-studio-config");const a=await this.api.fetchWithApiTokenRefresh(n,e);401===a.status&&console.error("Unauthorized request for design studio config: libraryId: ".concat(t));const r=await a.json();if(r.errors){var o,s,c;if(404===(null===(o=r.errors[0])||void 0===o?void 0:o.status));else console.error(null===(s=r.errors[0])||void 0===s?void 0:s.status,null===(c=r.errors[0])||void 0===c?void 0:c.title)}else{const e={libraryId:t,...r.data.attributes};await this.extension.setStoredDesignStudioConfig(e)}}async function _n(t,e,i,n,a){let r;r=i?"".concat(await this.api.cdnOrigin(),"/v2/libraries/").concat(t,"/nomad-domain-rules?omitRelationships=true&cacheKey=").concat(i):"".concat(await this.api.cdnOrigin(),"/v2/libraries/").concat(t,"/nomad-domain-rules?omitRelationships=true");const o=await this.api.fetchWithApiTokenRefresh(r,e);401===o.status&&console.error("Unauthorized request for domain messaging config: libraryId: ".concat(t));const s=await o.json();if(s.errors){var c,u;console.error(null===(c=s.errors[0])||void 0===c?void 0:c.status,null===(u=s.errors[0])||void 0===u?void 0:u.title)}else{const e=s.data.map((t=>({id:t.id,...t.attributes}))),r={updatedDate:i,libraryId:t,authSystem:n,contentProxy:a,rules:null===e||void 0===e?void 0:e.sort(((t,e)=>{let i=0;return t.domainUrl.length<e.domainUrl.length&&(i=1),t.domainUrl.length>e.domainUrl.length&&(i=-1),i}))};await this.extension.setStoredDomainMessagingConfig(r)}}async function Nn(t,e,i){let n;n=i?"".concat(await this.api.cdnOrigin(),"/v2/libraries/").concat(t,"/citation-export-config?cacheKey=").concat(i):"".concat(await this.api.cdnOrigin(),"/v2/libraries/").concat(t,"/citation-export-config");const a=await this.api.fetchWithApiTokenRefresh(n,e);401===a.status&&console.error("Unauthorized request for citation export config: libraryId: ".concat(t));const r=await a.json();if(r.errors){var o,s;console.error(null===(o=r.errors[0])||void 0===o?void 0:o.status,null===(s=r.errors[0])||void 0===s?void 0:s.title)}else{const e={libraryId:t,...r.data.attributes};await this.extension.setStoredCitationExportConfig(e)}}async function En(t,e,i){let n;n=i?"".concat(await this.api.cdnOrigin(),"/v2/libraries/").concat(t,"/nomad-chat-config?cacheKey=").concat(i):"".concat(await this.api.cdnOrigin(),"/v2/libraries/").concat(t,"/nomad-chat-config");const a=await this.api.fetchWithApiTokenRefresh(n,e);401===a.status&&console.error("Unauthorized request for nomad chat config: libraryId: ".concat(t));const r=await a.json();if(r.errors){var o,s;console.error(null===(o=r.errors[0])||void 0===o?void 0:o.status,null===(s=r.errors[0])||void 0===s?void 0:s.title)}else{const e={libraryId:t,...r.data.attributes};await this.extension.setStoredNomadChatConfig(e)}}const On=class{constructor(){Object.defineProperty(this,An,{value:En}),Object.defineProperty(this,Ln,{value:Nn}),Object.defineProperty(this,Tn,{value:_n}),Object.defineProperty(this,kn,{value:Pn}),this.api=new A,this.extension=new T}async loadDesignStudioConfig(t,e){var i,n;const a=await this.extension.getStoredDesignStudioConfig();if((null===a||void 0===a||null===(i=a.libraryId)||void 0===i?void 0:i.toString())===(null===(n=t.id)||void 0===n?void 0:n.toString())){const i=new Date(a.updatedDate).getTime(),n=new Date(null===e||void 0===e?void 0:e.updatedDate).getTime();(!i||i<n)&&await vn(this,kn)[kn](t.id,t.apiToken.id,null===e||void 0===e?void 0:e.updatedDate)}else await vn(this,kn)[kn](t.id,t.apiToken.id,null===e||void 0===e?void 0:e.updatedDate)}async loadDomainMessagingConfig(t,e){var i;const n=await this.extension.getStoredDomainMessagingConfig();if(n&&(null===(i=n.rules)||void 0===i?void 0:i.length)>0&&n.libraryId.toString()===t.id.toString()){const i=new Date(n.updatedDate).getTime(),a=new Date(null===e||void 0===e?void 0:e.updatedDate).getTime();(!i||i<a)&&await vn(this,Tn)[Tn](t.id,t.apiToken.id,e.updatedDate,e.authSystem,e.contentProxy)}else await vn(this,Tn)[Tn](t.id,t.apiToken.id,e.updatedDate,e.authSystem,e.contentProxy)}async loadCitationExportConfig(t,e){var i,n;const a=await this.extension.getStoredCitationExportConfig();if(a&&(null===(i=a.libraryId)||void 0===i?void 0:i.toString())===(null===(n=t.id)||void 0===n?void 0:n.toString())){const i=new Date(a.updatedDate).getTime(),n=new Date(null===e||void 0===e?void 0:e.updatedDate).getTime();(!i||i<n)&&await vn(this,Ln)[Ln](t.id,t.apiToken.id,null===e||void 0===e?void 0:e.updatedDate)}else await vn(this,Ln)[Ln](t.id,t.apiToken.id,null===e||void 0===e?void 0:e.updatedDate)}async loadNomadChatConfig(t,e){var i,n;const a=await this.extension.getStoredNomadChatConfig();if(a&&(null===(i=a.libraryId)||void 0===i?void 0:i.toString())===(null===(n=t.id)||void 0===n?void 0:n.toString())){const i=new Date(a.updatedDate).getTime(),n=new Date(null===e||void 0===e?void 0:e.updatedDate).getTime();(!i||i<n)&&await vn(this,An)[An](t.id,t.apiToken.id,null===e||void 0===e?void 0:e.updatedDate)}else await vn(this,An)[An](t.id,t.apiToken.id,null===e||void 0===e?void 0:e.updatedDate)}async clearStoredNomadPlusPlusConfig(){await Promise.allSettled([this.clearCitationExportConfig(),this.clearDesignStudioConfig(),this.clearDomainMessagingConfig(),this.clearNomadChatConfig()])}async clearDesignStudioConfig(){await this.extension.setStoredDesignStudioConfig(void 0)}async clearDomainMessagingConfig(){await this.extension.setStoredDomainMessagingConfig(void 0)}async clearCitationExportConfig(){await this.extension.setStoredCitationExportConfig(void 0)}async clearNomadChatConfig(){await this.extension.setStoredNomadChatConfig(void 0)}};var Rn=mn("fetchProblematicDomainsList");async function Mn(t,e,i){const n="".concat(await this.api.origin(),"/v2/problematic-domains"),a=await this.api.fetchWithApiTokenRefresh(n,e);401===a.status?console.error("Unauthorized request, library token expired: libraryId: ".concat(t,", apiToken: ").concat(e)):403===a.status&&console.error("Problematic Journal Reports are not enabled for this library: libraryId: ".concat(t));const r=await a.json();if(r.errors){var o,s,c;if("403"===(null===(o=r.errors[0])||void 0===o?void 0:o.status))await this.clearProblematicDomainsList();else console.error(null===(s=r.errors[0])||void 0===s?void 0:s.status,null===(c=r.errors[0])||void 0===c?void 0:c.title)}else{const e=new Map;for(const t of r.data){const i={id:t.id,...t.attributes};e.set(t.attributes.problematicDomainName,i)}const n={domainsMap:e,libraryId:t,updatedDate:i};await this.extension.setProblematicDomains(n)}}const Un=class{constructor(){Object.defineProperty(this,Rn,{value:Mn}),this.api=new A,this.extension=new T}async loadProblematicDomainsConfig(t,e){var i,n;const a=await this.extension.getProblematicDomains();if(a&&(null===a||void 0===a||null===(i=a.libraryId)||void 0===i?void 0:i.toString())===(null===(n=t.id)||void 0===n?void 0:n.toString())){const i=new Date(a.updatedDate).getTime(),n=new Date(null===e||void 0===e?void 0:e.updatedDate).getTime();(!i||i<n)&&await vn(this,Rn)[Rn](t.id,t.apiToken.id,null===e||void 0===e?void 0:e.updatedDate)}else await vn(this,Rn)[Rn](t.id,t.apiToken.id,null===e||void 0===e?void 0:e.updatedDate)}async clearProblematicDomainsList(){await this.extension.setProblematicDomains(void 0)}},jn={LIBRARY_ID:"libraryId",BUTTON_PLACEMENT:"buttonPlacement"},Bn={ACTIVE:"active",PAUSED:"paused"};const Fn=class{constructor(){this.api=new A,this.extension=new T,this.nomadPlusPlus=new On,this.problematicDomains=new Un}async getLibraries(){const t="".concat(await this.api.origin(),"/v2/libraries?fields[libraries]=name,logo,googleScholarLibraryId,googleScholarLibraryName,languagesSupported,useLiveUnpaywallCalls,aliases,logoHasLibraryName&filter[nomad_subscription_status]=active,trial"),e={headers:{"Accept-Language":await this.extension.getStorageData("language")}},i=await this.extension.fetch(t,e);return(await i.json()).data}async isSubscribed(t,e){const i="".concat(await this.api.origin(),"/v2/libraries/").concat(t.id,"?fields[libraries]=subscriptions"),n=await(e?fetch(i):this.extension.fetch(i)),a=await n.json();return!(!a.data.attributes.subscriptions.libkey||!a.data.attributes.subscriptions.nomad)&&(a.data.attributes.subscriptions.libkey.active&&a.data.attributes.subscriptions.nomad.active)}async getLibrary(){const t=await this.extension.getStoredLibrary();return t&&new Date(t.apiToken.expires_at)-Date.now()<0&&(t.apiToken=await this.api.getToken(t),await this.extension.setStoredLibrary(t)),t}async getLibraryConfigStatus(t,e){const i="".concat(await this.api.origin(),"/v2/libraries/").concat(t,"/config/status"),n={headers:{Authorization:"Bearer ".concat(e)}};try{let t=await this.extension.fetch(i,n);if(401===t.status){const e=await this.api.refreshLibraryToken();n.headers.Authorization="Bearer ".concat(e),t=await this.extension.fetch(i,n)}const e=await t.json();return await this.extension.setStoredProxyDomainMatches(e.data.attributes.proxyDomainMatches),e.data.attributes}catch(a){console.error("Could not fetch library config status",a)}}async getLibraryById(t){let e;if(t){const i="".concat(await this.api.origin(),"/v2/libraries/").concat(t,"?fields[libraries]=name,logo,googleScholarLibraryId,googleScholarLibraryName,languagesSupported,useLiveUnpaywallCalls,contentProxy,aliases"),n=await this.extension.fetch(i);e=(await n.json()).data}return e}async updateLibrary(t,e){let i;if(i=e?e.find((e=>Number(e.id)===Number(t.id))):await this.getLibraryById(t.id),i){const e=structuredClone(i);e.apiToken=t.apiToken,i=e,await this.extension.setStoredLibrary(e)}return i||t}async getManagedLibrary(){let t;const e=await this.extension.getPolicyData(jn.LIBRARY_ID),i=await this.extension.getStoredLibrary();return e&&!i?(t=await this.getLibraryById(e),t&&(t.apiToken=await this.api.getToken(t))):e===(null===i||void 0===i?void 0:i.id)&&(t=i),t}async clearCurrentLibrary(){const t=await this.extension.getStoredSelectedNomadStatus();await this.extension.removeStorageData("library"),t&&t===Bn.PAUSED?this.extension.setPausedIcon():this.extension.setInactiveIcon()}async clearCollectDataAnswered(){await this.extension.removeStorageData("collectDataAnswered")}async getIsIpWithinRanges(){let t;const e=await this.getLibrary();return e&&e.id&&(t=await this.api.getIsIpValidated(e.id,e.apiToken.id)),t}async getProxyDomainMatches(){return await this.extension.getStoredProxyDomainMatches()||[]}getParsedUrl(t){const e=new URL(t);for(const n in e)null===e[n]&&(e[n]="");const i={baseDomain:"".concat(e.protocol,"//").concat(e.host,"/"),protocolPrefix:"".concat(e.protocol,"//"),noProtocolBaseDomainPrefix:e.host,afterBaseDomain:("/"===e.pathname?"":e.pathname)+e.search+e.hash,path:e.pathname.replace(/^\//,""),query:e.search.replace(/^\?/,""),fragment:e.hash.replace(/^#/,"")};return i.completeURL="".concat(e.protocol,"//").concat(e.host).concat(i.afterBaseDomain),i.pathAndAfter=i.path+e.search+e.hash,i}getProxiedUrl(t,e){if(!t||/^proxy:\/\//.test(t))return e;if(t.indexOf("$")>-1){let i=t;const n=this.getParsedUrl(e),a=pn.assign({},n);for(const t in a)Object.hasOwn(a,t)&&(i=i.replace("$$".concat(t),encodeURIComponent(a[t])),i=i.replace("$".concat(t),a[t]));return i}return t+e}async applyLibraryConfigStatus(t){try{const e=await this.getLibraryConfigStatus(t.id,t.apiToken.id);await this.handleNomadPlusPlusConfig(t,e),await this.handleProblematicDomainsConfig(t,e),await this.saveLibraryConfigStatusCheck(t)}catch(e){console.error("Could not fetch library config",e)}}async saveLibraryConfigStatusCheck(t){const e=(new Cn).testing&&window.location.href.includes("test-back-in-time");let i=Date();e&&(i=new Date(1700538373798).toString()),await this.extension.setStoredLastCheckedLibraryConfigStatus({dateAndTime:i,libraryId:t.id})}async handleNomadPlusPlusConfig(t,e){var i,n;if(!e.hasNomadPlusPlus)return void await this.nomadPlusPlus.clearStoredNomadPlusPlusConfig();const a={...await this.extension.getStoredDomainMessagingConfig(),authSystem:null===e||void 0===e||null===(i=e.domainMessagingConfig)||void 0===i?void 0:i.authSystem,contentProxy:null===e||void 0===e||null===(n=e.domainMessagingConfig)||void 0===n?void 0:n.contentProxy};await this.extension.setStoredDomainMessagingConfig(a),void 0!==e.designStudioConfig?await this.nomadPlusPlus.loadDesignStudioConfig(t,e.designStudioConfig):await this.nomadPlusPlus.clearDesignStudioConfig(),void 0!==e.domainMessagingConfig?await this.nomadPlusPlus.loadDomainMessagingConfig(t,e.domainMessagingConfig):await this.nomadPlusPlus.clearDomainMessagingConfig(),void 0!==e.citationExportConfig?await this.nomadPlusPlus.loadCitationExportConfig(t,e.citationExportConfig):await this.nomadPlusPlus.clearCitationExportConfig(),void 0!==e.nomadChatConfig?await this.nomadPlusPlus.loadNomadChatConfig(t,e.nomadChatConfig):await this.nomadPlusPlus.clearNomadChatConfig()}async handleProblematicDomainsConfig(t,e){void 0!==e.problematicDomainsConfig?await this.problematicDomains.loadProblematicDomainsConfig(t,e.problematicDomainsConfig):await this.problematicDomains.clearProblematicDomainsList()}};const Gn=class extends k{getBackgroundDimensions(){return{}}logError(t){console.error(t)}};const qn=class{async sendEvent(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;const i=new Fn,n=new T;let a;if(await n.getStorageData("useStagingAnalyticsServer").then((t=>{let e;e=t?"https://staging-a.thirdiron.com/events":"https://a.thirdiron.com/events";const i=new Gn(e);a=new I(i)})),e)t.libraryId=e;else{const e=await i.getLibrary();t.libraryId=e.id}t.product="LibkeyNomad",await a.sendEvent(t)}};"undefined"==typeof browser&&(globalThis.browser=chrome),browser.alarms.onAlarm.addListener((async t=>{if("validate-subscription-alarm"===t.name)try{const t=new T,e=await t.getStoredLibrary(),i=new Fn;if(e){await i.isSubscribed(e,!0)||await i.clearCurrentLibrary()}else t.setInactiveIcon()}catch(e){}})),async function(){const t=new T,e=new A;t.setEnvironmentIndicators(await e.useStaging(),await e.useStagingAnalyticsServer())}(),browser.runtime.onInstalled.addListener((async function(t){const e=new T;let i=1440+Math.floor(15*Math.random());await browser.alarms.create("validate-subscription-alarm",{periodInMinutes:i});try{const t=await async function(){if("function"===typeof browser.runtime.getManifest)return browser.runtime.getManifest().version;return}(),i="nomadVersion";t!==await e.getStorageData(i)&&await e.setStorageData({[i]:t})}catch(o){console.error("Unable to set Nomad version, error = ".concat(JSON.stringify(o)))}const n=await async function(){const t=new T;let e="unknown";try{const t=await browser.management.getSelf();e=null===t||void 0===t?void 0:t.installType,console.warn("Nomad Debug: Got installType: ".concat(e))}catch(n){console.error("Error getting install type, error = ".concat(JSON.stringify(n)))}const i=await t.getStorageData("installType");return i&&i===e||await t.setStorageData({installType:e}),e}();if("install"===t.reason){var a,r;let t=await e.getPolicyData(jn.LIBRARY_ID);if(console.warn("Nomad Debug: details.reason === 'install'. Policy libraryId: ".concat(t)),!t){const i=await e.getStoredLibrary();t=null!=i?i.id:void 0}let i=!1;const o=!(null===(a=navigator)||void 0===a||!a.userAgent)&&navigator.userAgent.includes("PuppeteerAgent"),s=!(null===(r=navigator)||void 0===r||!r.userAgent)&&navigator.userAgent.includes("ManagedLibrary");(n&&"normal"!==n&&"development"!==n||o&&s)&&(console.warn("Nomad Debug: Setting isManaged to true."),i=!0);let c=await e.getStoredUniqueDeviceId();if(c||(c=u(),await e.setStoredUniqueDeviceId(c)),isNaN(t)&&!i&&await e.createTab({url:"./index.html#/select-library"}),i){const i=await e.getAnalyticsDimensions("LibrarySelected","ManagedLibrary");console.warn("Nomad Debug: Sending site install event.");(new qn).sendEvent(i,t)}}else{const t=["http://*/*","https://*/*"],i=await browser.permissions.getAll();!t.every((t=>i.origins.includes(t)))&&"Safari"!==e.getBrowserName()&&await e.createTab({url:"./index.html#/select-library"})}})),browser.runtime.onMessage.addListener((function(t,e,i){if("analytics"===t.messageType){if(i(),"MessageDisplayed"===t.eventCategory){const e=new T;return e.getStoredLastDisplayedMessageRuleIdConfig().then((i=>(i!==t.extras.nomadMessageRuleId&&e.setStoredLastDisplayedMessageRuleIdConfig(t.extras.nomadMessageRuleId).then((()=>{(new qn).sendEvent(t)})),[{},null])))}return(new qn).sendEvent(t),[{},null]}return fetch(t.resource,t.options).then((function(t){return t.text().then((function(e){let n=e;""===e&&(n="Not Found"),i([{body:n,bodyUsed:t.bodyUsed,headers:{},ok:t.ok,redirected:t.redirected,status:t.status,statusText:t.statusText,type:t.type,url:t.url},null])})),!0}),(function(t){return i([null,t]),!0})),!0}))})()})();