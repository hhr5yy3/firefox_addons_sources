var background=function(){"use strict";var Qb=Object.defineProperty;var e_=(tt,D,me)=>D in tt?Qb(tt,D,{enumerable:!0,configurable:!0,writable:!0,value:me}):tt[D]=me;var p=(tt,D,me)=>e_(tt,typeof D!="symbol"?D+"":D,me);function tt(r){return r==null||typeof r=="function"?{main:r}:r}const D=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,me="8.40.0",$=globalThis;function kr(r,e,t){const n=t||$,i=n.__SENTRY__=n.__SENTRY__||{},a=i[me]=i[me]||{};return a[r]||(a[r]=e())}const rt=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,cc="Sentry Logger ",Er=["debug","info","warn","error","log","assert","trace"],xr={};function Ar(r){if(!("console"in $))return r();const e=$.console,t={},n=Object.keys(xr);n.forEach(i=>{const a=xr[i];t[i]=e[i],e[i]=a});try{return r()}finally{n.forEach(i=>{e[i]=t[i]})}}function lc(){let r=!1;const e={enable:()=>{r=!0},disable:()=>{r=!1},isEnabled:()=>r};return rt?Er.forEach(t=>{e[t]=(...n)=>{r&&Ar(()=>{$.console[t](`${cc}[${t}]:`,...n)})}}):Er.forEach(t=>{e[t]=()=>{}}),e}const T=kr("logger",lc),Ji=50,nt="?",Yi=/\(error: (.*)\)/,Xi=/captureMessage|captureException/;function uc(...r){const e=r.sort((t,n)=>t[0]-n[0]).map(t=>t[1]);return(t,n=0,i=0)=>{const a=[],s=t.split(`
`);for(let o=n;o<s.length;o++){const c=s[o];if(c.length>1024)continue;const l=Yi.test(c)?c.replace(Yi,"$1"):c;if(!l.match(/\S*Error: /)){for(const u of e){const d=u(l);if(d){a.push(d);break}}if(a.length>=Ji+i)break}}return dc(a.slice(i))}}function dc(r){if(!r.length)return[];const e=Array.from(r);return/sentryWrapped/.test(Cr(e).function||"")&&e.pop(),e.reverse(),Xi.test(Cr(e).function||"")&&(e.pop(),Xi.test(Cr(e).function||"")&&e.pop()),e.slice(0,Ji).map(t=>({...t,filename:t.filename||Cr(e).filename,function:t.function||nt}))}function Cr(r){return r[r.length-1]||{}}const bn="<anonymous>";function Le(r){try{return!r||typeof r!="function"?bn:r.name||bn}catch{return bn}}function Qi(r){const e=r.exception;if(e){const t=[];try{return e.values.forEach(n=>{n.stacktrace.frames&&t.push(...n.stacktrace.frames)}),t}catch{return}}}const Tr={},ea={};function it(r,e){Tr[r]=Tr[r]||[],Tr[r].push(e)}function at(r,e){if(!ea[r]){ea[r]=!0;try{e()}catch(t){rt&&T.error(`Error while instrumenting ${r}`,t)}}}function _e(r,e){const t=r&&Tr[r];if(t)for(const n of t)try{n(e)}catch(i){rt&&T.error(`Error while triggering instrumentation handler.
Type: ${r}
Name: ${Le(n)}
Error:`,i)}}let Ir=null;function fc(r){const e="error";it(e,r),at(e,pc)}function pc(){Ir=$.onerror,$.onerror=function(r,e,t,n,i){return _e("error",{column:n,error:i,line:t,msg:r,url:e}),Ir&&!Ir.__SENTRY_LOADER__?Ir.apply(this,arguments):!1},$.onerror.__SENTRY_INSTRUMENTED__=!0}let Rr=null;function hc(r){const e="unhandledrejection";it(e,r),at(e,mc)}function mc(){Rr=$.onunhandledrejection,$.onunhandledrejection=function(r){return _e("unhandledrejection",r),Rr&&!Rr.__SENTRY_LOADER__?Rr.apply(this,arguments):!0},$.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function Pr(){return _n($),$}function _n(r){const e=r.__SENTRY__=r.__SENTRY__||{};return e.version=e.version||me,e[me]=e[me]||{}}const ta=Object.prototype.toString;function st(r){switch(ta.call(r)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return ct(r,Error)}}function St(r,e){return ta.call(r)===`[object ${e}]`}function ra(r){return St(r,"ErrorEvent")}function na(r){return St(r,"DOMError")}function gc(r){return St(r,"DOMException")}function Me(r){return St(r,"String")}function vn(r){return typeof r=="object"&&r!==null&&"__sentry_template_string__"in r&&"__sentry_template_values__"in r}function wn(r){return r===null||vn(r)||typeof r!="object"&&typeof r!="function"}function ot(r){return St(r,"Object")}function Or(r){return typeof Event<"u"&&ct(r,Event)}function yc(r){return typeof Element<"u"&&ct(r,Element)}function bc(r){return St(r,"RegExp")}function Nr(r){return!!(r&&r.then&&typeof r.then=="function")}function _c(r){return ot(r)&&"nativeEvent"in r&&"preventDefault"in r&&"stopPropagation"in r}function ct(r,e){try{return r instanceof e}catch{return!1}}function ia(r){return!!(typeof r=="object"&&r!==null&&(r.__isVue||r._isVue))}const Sn=$,vc=80;function aa(r,e={}){if(!r)return"<unknown>";try{let t=r;const n=5,i=[];let a=0,s=0;const o=" > ",c=o.length;let l;const u=Array.isArray(e)?e:e.keyAttrs,d=!Array.isArray(e)&&e.maxStringLength||vc;for(;t&&a++<n&&(l=wc(t,u),!(l==="html"||a>1&&s+i.length*c+l.length>=d));)i.push(l),s+=l.length,t=t.parentNode;return i.reverse().join(o)}catch{return"<unknown>"}}function wc(r,e){const t=r,n=[];if(!t||!t.tagName)return"";if(Sn.HTMLElement&&t instanceof HTMLElement&&t.dataset){if(t.dataset.sentryComponent)return t.dataset.sentryComponent;if(t.dataset.sentryElement)return t.dataset.sentryElement}n.push(t.tagName.toLowerCase());const i=e&&e.length?e.filter(s=>t.getAttribute(s)).map(s=>[s,t.getAttribute(s)]):null;if(i&&i.length)i.forEach(s=>{n.push(`[${s[0]}="${s[1]}"]`)});else{t.id&&n.push(`#${t.id}`);const s=t.className;if(s&&Me(s)){const o=s.split(/\s+/);for(const c of o)n.push(`.${c}`)}}const a=["aria-label","type","name","title","alt"];for(const s of a){const o=t.getAttribute(s);o&&n.push(`[${s}="${o}"]`)}return n.join("")}function Sc(){try{return Sn.document.location.href}catch{return""}}function kc(r){if(!Sn.HTMLElement)return null;let e=r;const t=5;for(let n=0;n<t;n++){if(!e)return null;if(e instanceof HTMLElement){if(e.dataset.sentryComponent)return e.dataset.sentryComponent;if(e.dataset.sentryElement)return e.dataset.sentryElement}e=e.parentNode}return null}function lt(r,e=0){return typeof r!="string"||e===0||r.length<=e?r:`${r.slice(0,e)}...`}function Mr(r,e){if(!Array.isArray(r))return"";const t=[];for(let n=0;n<r.length;n++){const i=r[n];try{ia(i)?t.push("[VueViewModel]"):t.push(String(i))}catch{t.push("[value cannot be serialized]")}}return t.join(e)}function Ec(r,e,t=!1){return Me(r)?bc(e)?e.test(r):Me(e)?t?r===e:r.includes(e):!1:!1}function Dr(r,e=[],t=!1){return e.some(n=>Ec(r,n,t))}function de(r,e,t){if(!(e in r))return;const n=r[e],i=t(n);typeof i=="function"&&sa(i,n);try{r[e]=i}catch{rt&&T.log(`Failed to replace method "${e}" in object`,r)}}function Fe(r,e,t){try{Object.defineProperty(r,e,{value:t,writable:!0,configurable:!0})}catch{rt&&T.log(`Failed to add non-enumerable property "${e}" to object`,r)}}function sa(r,e){try{const t=e.prototype||{};r.prototype=e.prototype=t,Fe(r,"__sentry_original__",e)}catch{}}function kn(r){return r.__sentry_original__}function xc(r){return Object.keys(r).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(r[e])}`).join("&")}function oa(r){if(st(r))return{message:r.message,name:r.name,stack:r.stack,...la(r)};if(Or(r)){const e={type:r.type,target:ca(r.target),currentTarget:ca(r.currentTarget),...la(r)};return typeof CustomEvent<"u"&&ct(r,CustomEvent)&&(e.detail=r.detail),e}else return r}function ca(r){try{return yc(r)?aa(r):Object.prototype.toString.call(r)}catch{return"<unknown>"}}function la(r){if(typeof r=="object"&&r!==null){const e={};for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e}else return{}}function Ac(r,e=40){const t=Object.keys(oa(r));t.sort();const n=t[0];if(!n)return"[object has no keys]";if(n.length>=e)return lt(n,e);for(let i=t.length;i>0;i--){const a=t.slice(0,i).join(", ");if(!(a.length>e))return i===t.length?a:lt(a,e)}return""}function ve(r){return En(r,new Map)}function En(r,e){if(Cc(r)){const t=e.get(r);if(t!==void 0)return t;const n={};e.set(r,n);for(const i of Object.getOwnPropertyNames(r))typeof r[i]<"u"&&(n[i]=En(r[i],e));return n}if(Array.isArray(r)){const t=e.get(r);if(t!==void 0)return t;const n=[];return e.set(r,n),r.forEach(i=>{n.push(En(i,e))}),n}return r}function Cc(r){if(!ot(r))return!1;try{const e=Object.getPrototypeOf(r).constructor.name;return!e||e==="Object"}catch{return!0}}const ua=1e3;function Kt(){return Date.now()/ua}function Tc(){const{performance:r}=$;if(!r||!r.now)return Kt;const e=Date.now()-r.now(),t=r.timeOrigin==null?e:r.timeOrigin;return()=>(t+r.now())/ua}const Ve=Tc();(()=>{const{performance:r}=$;if(!r||!r.now)return;const e=3600*1e3,t=r.now(),n=Date.now(),i=r.timeOrigin?Math.abs(r.timeOrigin+t-n):e,a=i<e,s=r.timing&&r.timing.navigationStart,c=typeof s=="number"?Math.abs(s+t-n):e,l=c<e;return a||l?i<=c?r.timeOrigin:s:n})();function we(){const r=$,e=r.crypto||r.msCrypto;let t=()=>Math.random()*16;try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(t=()=>{const n=new Uint8Array(1);return e.getRandomValues(n),n[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,n=>(n^(t()&15)>>n/4).toString(16))}function da(r){return r.exception&&r.exception.values?r.exception.values[0]:void 0}function qe(r){const{message:e,event_id:t}=r;if(e)return e;const n=da(r);return n?n.type&&n.value?`${n.type}: ${n.value}`:n.type||n.value||t||"<unknown>":t||"<unknown>"}function xn(r,e,t){const n=r.exception=r.exception||{},i=n.values=n.values||[],a=i[0]=i[0]||{};a.value||(a.value=e||""),a.type||(a.type="Error")}function kt(r,e){const t=da(r);if(!t)return;const n={type:"generic",handled:!0},i=t.mechanism;if(t.mechanism={...n,...i,...e},e&&"data"in e){const a={...i&&i.data,...e.data};t.mechanism.data=a}}function fa(r){if(r&&r.__sentry_captured__)return!0;try{Fe(r,"__sentry_captured__",!0)}catch{}return!1}var De;(function(r){r[r.PENDING=0]="PENDING";const t=1;r[r.RESOLVED=t]="RESOLVED";const n=2;r[r.REJECTED=n]="REJECTED"})(De||(De={}));function ut(r){return new ge(e=>{e(r)})}function Ur(r){return new ge((e,t)=>{t(r)})}class ge{constructor(e){ge.prototype.__init.call(this),ge.prototype.__init2.call(this),ge.prototype.__init3.call(this),ge.prototype.__init4.call(this),this._state=De.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(t){this._reject(t)}}then(e,t){return new ge((n,i)=>{this._handlers.push([!1,a=>{if(!e)n(a);else try{n(e(a))}catch(s){i(s)}},a=>{if(!t)i(a);else try{n(t(a))}catch(s){i(s)}}]),this._executeHandlers()})}catch(e){return this.then(t=>t,e)}finally(e){return new ge((t,n)=>{let i,a;return this.then(s=>{a=!1,i=s,e&&e()},s=>{a=!0,i=s,e&&e()}).then(()=>{if(a){n(i);return}t(i)})})}__init(){this._resolve=e=>{this._setResult(De.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(De.REJECTED,e)}}__init3(){this._setResult=(e,t)=>{if(this._state===De.PENDING){if(Nr(t)){t.then(this._resolve,this._reject);return}this._state=e,this._value=t,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===De.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach(t=>{t[0]||(this._state===De.RESOLVED&&t[1](this._value),this._state===De.REJECTED&&t[2](this._value),t[0]=!0)})}}}function jr(r,e={}){if(e.user&&(!r.ipAddress&&e.user.ip_address&&(r.ipAddress=e.user.ip_address),!r.did&&!e.did&&(r.did=e.user.id||e.user.email||e.user.username)),r.timestamp=e.timestamp||Ve(),e.abnormal_mechanism&&(r.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(r.ignoreDuration=e.ignoreDuration),e.sid&&(r.sid=e.sid.length===32?e.sid:we()),e.init!==void 0&&(r.init=e.init),!r.did&&e.did&&(r.did=`${e.did}`),typeof e.started=="number"&&(r.started=e.started),r.ignoreDuration)r.duration=void 0;else if(typeof e.duration=="number")r.duration=e.duration;else{const t=r.timestamp-r.started;r.duration=t>=0?t:0}e.release&&(r.release=e.release),e.environment&&(r.environment=e.environment),!r.ipAddress&&e.ipAddress&&(r.ipAddress=e.ipAddress),!r.userAgent&&e.userAgent&&(r.userAgent=e.userAgent),typeof e.errors=="number"&&(r.errors=e.errors),e.status&&(r.status=e.status)}function Ic(r,e){let t={};r.status==="ok"&&(t={status:"exited"}),jr(r,t)}function pa(){return{traceId:we(),spanId:we().substring(16)}}function $r(r,e,t=2){if(!e||typeof e!="object"||t<=0)return e;if(r&&e&&Object.keys(e).length===0)return r;const n={...r};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=$r(n[i],e[i],t-1));return n}const An="_sentrySpan";function ha(r,e){e?Fe(r,An,e):delete r[An]}function ma(r){return r[An]}const Rc=100;class Cn{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext=pa()}clone(){const e=new Cn;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,ha(e,ma(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&jr(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this._tags={...this._tags,[e]:t},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return t===null?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t=typeof e=="function"?e(this):e,[n,i]=t instanceof We?[t.getScopeData(),t.getRequestSession()]:ot(t)?[e,e.requestSession]:[],{tags:a,extra:s,user:o,contexts:c,level:l,fingerprint:u=[],propagationContext:d}=n||{};return this._tags={...this._tags,...a},this._extra={...this._extra,...s},this._contexts={...this._contexts,...c},o&&Object.keys(o).length&&(this._user=o),l&&(this._level=l),u.length&&(this._fingerprint=u),d&&(this._propagationContext=d),i&&(this._requestSession=i),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,ha(this,void 0),this._attachments=[],this._propagationContext=pa(),this._notifyScopeListeners(),this}addBreadcrumb(e,t){const n=typeof t=="number"?t:Rc;if(n<=0)return this;const i={timestamp:Kt(),...e},a=this._breadcrumbs;return a.push(i),this._breadcrumbs=a.length>n?a.slice(-n):a,this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:ma(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=$r(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,t){const n=t&&t.event_id?t.event_id:we();if(!this._client)return T.warn("No client configured on scope - will not capture exception!"),n;const i=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:i,...t,event_id:n},this),n}captureMessage(e,t,n){const i=n&&n.event_id?n.event_id:we();if(!this._client)return T.warn("No client configured on scope - will not capture message!"),i;const a=new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:a,...n,event_id:i},this),i}captureEvent(e,t){const n=t&&t.event_id?t.event_id:we();return this._client?(this._client.captureEvent(e,{...t,event_id:n},this),n):(T.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}const We=Cn;function Pc(){return kr("defaultCurrentScope",()=>new We)}function Oc(){return kr("defaultIsolationScope",()=>new We)}class Nc{constructor(e,t){let n;e?n=e:n=new We;let i;t?i=t:i=new We,this._stack=[{scope:n}],this._isolationScope=i}withScope(e){const t=this._pushScope();let n;try{n=e(t)}catch(i){throw this._popScope(),i}return Nr(n)?n.then(i=>(this._popScope(),i),i=>{throw this._popScope(),i}):(this._popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function Et(){const r=Pr(),e=_n(r);return e.stack=e.stack||new Nc(Pc(),Oc())}function Mc(r){return Et().withScope(r)}function Dc(r,e){const t=Et();return t.withScope(()=>(t.getStackTop().scope=r,e(r)))}function ga(r){return Et().withScope(()=>r(Et().getIsolationScope()))}function Uc(){return{withIsolationScope:ga,withScope:Mc,withSetScope:Dc,withSetIsolationScope:(r,e)=>ga(e),getCurrentScope:()=>Et().getScope(),getIsolationScope:()=>Et().getIsolationScope()}}function Tn(r){const e=_n(r);return e.acs?e.acs:Uc()}function He(){const r=Pr();return Tn(r).getCurrentScope()}function Lr(){const r=Pr();return Tn(r).getIsolationScope()}function jc(){return kr("globalScope",()=>new We)}function ya(...r){const e=Pr(),t=Tn(e);if(r.length===2){const[n,i]=r;return n?t.withSetScope(n,i):t.withScope(i)}return t.withScope(r[0])}function te(){return He().getClient()}const $c="_sentryMetrics";function Lc(r){const e=r[$c];if(!e)return;const t={};for(const[,[n,i]]of e)(t[n]||(t[n]=[])).push(ve(i));return t}const Fc="sentry.source",Vc="sentry.sample_rate",qc="sentry.op",Wc="sentry.origin",Hc=0,Zc=1,Kc="sentry-",Gc=/^sentry-/;function zc(r){const e=Bc(r);if(!e)return;const t=Object.entries(e).reduce((n,[i,a])=>{if(i.match(Gc)){const s=i.slice(Kc.length);n[s]=a}return n},{});if(Object.keys(t).length>0)return t}function Bc(r){if(!(!r||!Me(r)&&!Array.isArray(r)))return Array.isArray(r)?r.reduce((e,t)=>{const n=ba(t);return Object.entries(n).forEach(([i,a])=>{e[i]=a}),e},{}):ba(r)}function ba(r){return r.split(",").map(e=>e.split("=").map(t=>decodeURIComponent(t.trim()))).reduce((e,[t,n])=>(t&&n&&(e[t]=n),e),{})}const Jc=1;function Yc(r){const{spanId:e,traceId:t}=r.spanContext(),{parent_span_id:n}=Fr(r);return ve({parent_span_id:n,span_id:e,trace_id:t})}function _a(r){return typeof r=="number"?va(r):Array.isArray(r)?r[0]+r[1]/1e9:r instanceof Date?va(r.getTime()):Ve()}function va(r){return r>9999999999?r/1e3:r}function Fr(r){if(Qc(r))return r.getSpanJSON();try{const{spanId:e,traceId:t}=r.spanContext();if(Xc(r)){const{attributes:n,startTime:i,name:a,endTime:s,parentSpanId:o,status:c}=r;return ve({span_id:e,trace_id:t,data:n,description:a,parent_span_id:o,start_timestamp:_a(i),timestamp:_a(s)||void 0,status:tl(c),op:n[qc],origin:n[Wc],_metrics_summary:Lc(r)})}return{span_id:e,trace_id:t}}catch{return{}}}function Xc(r){const e=r;return!!e.attributes&&!!e.startTime&&!!e.name&&!!e.endTime&&!!e.status}function Qc(r){return typeof r.getSpanJSON=="function"}function el(r){const{traceFlags:e}=r.spanContext();return e===Jc}function tl(r){if(!(!r||r.code===Hc))return r.code===Zc?"ok":r.message||"unknown_error"}const rl="_sentryRootSpan";function wa(r){return r[rl]||r}function nl(r){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const e=te(),t=e&&e.getOptions();return!!t&&(t.enableTracing||"tracesSampleRate"in t||"tracesSampler"in t)}const Sa="production",il="_frozenDsc";function ka(r,e){const t=e.getOptions(),{publicKey:n}=e.getDsn()||{},i=ve({environment:t.environment||Sa,release:t.release,public_key:n,trace_id:r});return e.emit("createDsc",i),i}function al(r){const e=te();if(!e)return{};const t=ka(Fr(r).trace_id||"",e),n=wa(r),i=n[il];if(i)return i;const a=n.spanContext().traceState,s=a&&a.get("sentry.dsc"),o=s&&zc(s);if(o)return o;const c=Fr(n),l=c.data||{},u=l[Vc];u!=null&&(t.sample_rate=`${u}`);const d=l[Fc],f=c.description;return d!=="url"&&f&&(t.transaction=f),nl()&&(t.sampled=String(el(n))),e.emit("createDsc",t,n),t}function sl(r){if(typeof r=="boolean")return Number(r);const e=typeof r=="string"?parseFloat(r):r;if(typeof e!="number"||isNaN(e)||e<0||e>1){D&&T.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(r)} of type ${JSON.stringify(typeof r)}.`);return}return e}const ol=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function cl(r){return r==="http"||r==="https"}function Vr(r,e=!1){const{host:t,path:n,pass:i,port:a,projectId:s,protocol:o,publicKey:c}=r;return`${o}://${c}${e&&i?`:${i}`:""}@${t}${a?`:${a}`:""}/${n&&`${n}/`}${s}`}function ll(r){const e=ol.exec(r);if(!e){Ar(()=>{console.error(`Invalid Sentry Dsn: ${r}`)});return}const[t,n,i="",a="",s="",o=""]=e.slice(1);let c="",l=o;const u=l.split("/");if(u.length>1&&(c=u.slice(0,-1).join("/"),l=u.pop()),l){const d=l.match(/^\d+/);d&&(l=d[0])}return Ea({host:a,pass:i,path:c,projectId:l,port:s,protocol:t,publicKey:n})}function Ea(r){return{protocol:r.protocol,publicKey:r.publicKey||"",pass:r.pass||"",host:r.host,port:r.port||"",path:r.path||"",projectId:r.projectId}}function ul(r){if(!rt)return!0;const{port:e,projectId:t,protocol:n}=r;return["protocol","publicKey","host","projectId"].find(s=>r[s]?!1:(T.error(`Invalid Sentry Dsn: ${s} missing`),!0))?!1:t.match(/^\d+$/)?cl(n)?e&&isNaN(parseInt(e,10))?(T.error(`Invalid Sentry Dsn: Invalid port ${e}`),!1):!0:(T.error(`Invalid Sentry Dsn: Invalid protocol ${n}`),!1):(T.error(`Invalid Sentry Dsn: Invalid projectId ${t}`),!1)}function dl(r){const e=typeof r=="string"?ll(r):Ea(r);if(!(!e||!ul(e)))return e}function fl(){const r=typeof WeakSet=="function",e=r?new WeakSet:[];function t(i){if(r)return e.has(i)?!0:(e.add(i),!1);for(let a=0;a<e.length;a++)if(e[a]===i)return!0;return e.push(i),!1}function n(i){if(r)e.delete(i);else for(let a=0;a<e.length;a++)if(e[a]===i){e.splice(a,1);break}}return[t,n]}function Ue(r,e=100,t=1/0){try{return In("",r,e,t)}catch(n){return{ERROR:`**non-serializable** (${n})`}}}function xa(r,e=3,t=102400){const n=Ue(r,e);return gl(n)>t?xa(r,e-1,t):n}function In(r,e,t=1/0,n=1/0,i=fl()){const[a,s]=i;if(e==null||["boolean","string"].includes(typeof e)||typeof e=="number"&&Number.isFinite(e))return e;const o=pl(r,e);if(!o.startsWith("[object "))return o;if(e.__sentry_skip_normalization__)return e;const c=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:t;if(c===0)return o.replace("object ","");if(a(e))return"[Circular ~]";const l=e;if(l&&typeof l.toJSON=="function")try{const h=l.toJSON();return In("",h,c-1,n,i)}catch{}const u=Array.isArray(e)?[]:{};let d=0;const f=oa(e);for(const h in f){if(!Object.prototype.hasOwnProperty.call(f,h))continue;if(d>=n){u[h]="[MaxProperties ~]";break}const y=f[h];u[h]=In(h,y,c-1,n,i),d++}return s(e),u}function pl(r,e){try{if(r==="domain"&&e&&typeof e=="object"&&e._events)return"[Domain]";if(r==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&e===global)return"[Global]";if(typeof window<"u"&&e===window)return"[Window]";if(typeof document<"u"&&e===document)return"[Document]";if(ia(e))return"[VueViewModel]";if(_c(e))return"[SyntheticEvent]";if(typeof e=="number"&&!Number.isFinite(e))return`[${e}]`;if(typeof e=="function")return`[Function: ${Le(e)}]`;if(typeof e=="symbol")return`[${String(e)}]`;if(typeof e=="bigint")return`[BigInt: ${String(e)}]`;const t=hl(e);return/^HTML(\w*)Element$/.test(t)?`[HTMLElement: ${t}]`:`[object ${t}]`}catch(t){return`**non-serializable** (${t})`}}function hl(r){const e=Object.getPrototypeOf(r);return e?e.constructor.name:"null prototype"}function ml(r){return~-encodeURI(r).split(/%..|./).length}function gl(r){return ml(JSON.stringify(r))}function Gt(r,e=[]){return[r,e]}function yl(r,e){const[t,n]=r;return[t,[...n,e]]}function Aa(r,e){const t=r[1];for(const n of t){const i=n[0].type;if(e(n,i))return!0}return!1}function Rn(r){return $.__SENTRY__&&$.__SENTRY__.encodePolyfill?$.__SENTRY__.encodePolyfill(r):new TextEncoder().encode(r)}function bl(r){const[e,t]=r;let n=JSON.stringify(e);function i(a){typeof n=="string"?n=typeof a=="string"?n+a:[Rn(n),a]:n.push(typeof a=="string"?Rn(a):a)}for(const a of t){const[s,o]=a;if(i(`
${JSON.stringify(s)}
`),typeof o=="string"||o instanceof Uint8Array)i(o);else{let c;try{c=JSON.stringify(o)}catch{c=JSON.stringify(Ue(o))}i(c)}}return typeof n=="string"?n:_l(n)}function _l(r){const e=r.reduce((i,a)=>i+a.length,0),t=new Uint8Array(e);let n=0;for(const i of r)t.set(i,n),n+=i.length;return t}function vl(r){const e=typeof r.data=="string"?Rn(r.data):r.data;return[ve({type:"attachment",length:e.length,filename:r.filename,content_type:r.contentType,attachment_type:r.attachmentType}),e]}const wl={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket"};function Ca(r){return wl[r]}function Ta(r){if(!r||!r.sdk)return;const{name:e,version:t}=r.sdk;return{name:e,version:t}}function Sl(r,e,t,n){const i=r.sdkProcessingMetadata&&r.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:r.event_id,sent_at:new Date().toISOString(),...e&&{sdk:e},...!!t&&n&&{dsn:Vr(n)},...i&&{trace:ve({...i})}}}function kl(r,e){return e&&(r.sdk=r.sdk||{},r.sdk.name=r.sdk.name||e.name,r.sdk.version=r.sdk.version||e.version,r.sdk.integrations=[...r.sdk.integrations||[],...e.integrations||[]],r.sdk.packages=[...r.sdk.packages||[],...e.packages||[]]),r}function El(r,e,t,n){const i=Ta(t),a={sent_at:new Date().toISOString(),...i&&{sdk:i},...!!n&&e&&{dsn:Vr(e)}},s="aggregates"in r?[{type:"sessions"},r]:[{type:"session"},r.toJSON()];return Gt(a,[s])}function xl(r,e,t,n){const i=Ta(t),a=r.type&&r.type!=="replay_event"?r.type:"event";kl(r,t&&t.sdk);const s=Sl(r,i,n,e);return delete r.sdkProcessingMetadata,Gt(s,[[{type:a},r]])}function Pn(r,e,t,n=0){return new ge((i,a)=>{const s=r[n];if(e===null||typeof s!="function")i(e);else{const o=s({...e},t);D&&s.id&&o===null&&T.log(`Event processor "${s.id}" dropped event`),Nr(o)?o.then(c=>Pn(r,c,t,n+1).then(i)).then(null,a):Pn(r,o,t,n+1).then(i).then(null,a)}})}const Ia=new WeakMap;function Al(r){const e=$._sentryDebugIds;if(!e)return{};let t;const n=Ia.get(r);return n?t=n:(t=new Map,Ia.set(r,t)),Object.keys(e).reduce((i,a)=>{let s;const o=t.get(a);o?s=o:(s=r(a),t.set(a,s));for(let c=s.length-1;c>=0;c--){const l=s[c],u=l&&l.filename;if(l&&u){i[u]=e[a];break}}return i},{})}function Cl(r,e){const{fingerprint:t,span:n,breadcrumbs:i,sdkProcessingMetadata:a}=e;Tl(r,e),n&&Pl(r,n),Ol(r,t),Il(r,i),Rl(r,a)}function Ra(r,e){const{extra:t,tags:n,user:i,contexts:a,level:s,sdkProcessingMetadata:o,breadcrumbs:c,fingerprint:l,eventProcessors:u,attachments:d,propagationContext:f,transactionName:h,span:y}=e;qr(r,"extra",t),qr(r,"tags",n),qr(r,"user",i),qr(r,"contexts",a),r.sdkProcessingMetadata=$r(r.sdkProcessingMetadata,o,2),s&&(r.level=s),h&&(r.transactionName=h),y&&(r.span=y),c.length&&(r.breadcrumbs=[...r.breadcrumbs,...c]),l.length&&(r.fingerprint=[...r.fingerprint,...l]),u.length&&(r.eventProcessors=[...r.eventProcessors,...u]),d.length&&(r.attachments=[...r.attachments,...d]),r.propagationContext={...r.propagationContext,...f}}function qr(r,e,t){r[e]=$r(r[e],t,1)}function Tl(r,e){const{extra:t,tags:n,user:i,contexts:a,level:s,transactionName:o}=e,c=ve(t);c&&Object.keys(c).length&&(r.extra={...c,...r.extra});const l=ve(n);l&&Object.keys(l).length&&(r.tags={...l,...r.tags});const u=ve(i);u&&Object.keys(u).length&&(r.user={...u,...r.user});const d=ve(a);d&&Object.keys(d).length&&(r.contexts={...d,...r.contexts}),s&&(r.level=s),o&&r.type!=="transaction"&&(r.transaction=o)}function Il(r,e){const t=[...r.breadcrumbs||[],...e];r.breadcrumbs=t.length?t:void 0}function Rl(r,e){r.sdkProcessingMetadata={...r.sdkProcessingMetadata,...e}}function Pl(r,e){r.contexts={trace:Yc(e),...r.contexts},r.sdkProcessingMetadata={dynamicSamplingContext:al(e),...r.sdkProcessingMetadata};const t=wa(e),n=Fr(t).description;n&&!r.transaction&&r.type==="transaction"&&(r.transaction=n)}function Ol(r,e){r.fingerprint=r.fingerprint?Array.isArray(r.fingerprint)?r.fingerprint:[r.fingerprint]:[],e&&(r.fingerprint=r.fingerprint.concat(e)),r.fingerprint&&!r.fingerprint.length&&delete r.fingerprint}function Nl(r,e,t,n,i,a){const{normalizeDepth:s=3,normalizeMaxBreadth:o=1e3}=r,c={...e,event_id:e.event_id||t.event_id||we(),timestamp:e.timestamp||Kt()},l=t.integrations||r.integrations.map(C=>C.name);Ml(c,r),jl(c,l),i&&i.emit("applyFrameMetadata",e),e.type===void 0&&Dl(c,r.stackParser);const u=Ll(n,t.captureContext);t.mechanism&&kt(c,t.mechanism);const d=i?i.getEventProcessors():[],f=jc().getScopeData();if(a){const C=a.getScopeData();Ra(f,C)}if(u){const C=u.getScopeData();Ra(f,C)}const h=[...t.attachments||[],...f.attachments];h.length&&(t.attachments=h),Cl(c,f);const y=[...d,...f.eventProcessors];return Pn(y,c,t).then(C=>(C&&Ul(C),typeof s=="number"&&s>0?$l(C,s,o):C))}function Ml(r,e){const{environment:t,release:n,dist:i,maxValueLength:a=250}=e;"environment"in r||(r.environment="environment"in e?t:Sa),r.release===void 0&&n!==void 0&&(r.release=n),r.dist===void 0&&i!==void 0&&(r.dist=i),r.message&&(r.message=lt(r.message,a));const s=r.exception&&r.exception.values&&r.exception.values[0];s&&s.value&&(s.value=lt(s.value,a));const o=r.request;o&&o.url&&(o.url=lt(o.url,a))}function Dl(r,e){const t=Al(e);try{r.exception.values.forEach(n=>{n.stacktrace.frames.forEach(i=>{i.filename&&(i.debug_id=t[i.filename])})})}catch{}}function Ul(r){const e={};try{r.exception.values.forEach(n=>{n.stacktrace.frames.forEach(i=>{i.debug_id&&(i.abs_path?e[i.abs_path]=i.debug_id:i.filename&&(e[i.filename]=i.debug_id),delete i.debug_id)})})}catch{}if(Object.keys(e).length===0)return;r.debug_meta=r.debug_meta||{},r.debug_meta.images=r.debug_meta.images||[];const t=r.debug_meta.images;Object.entries(e).forEach(([n,i])=>{t.push({type:"sourcemap",code_file:n,debug_id:i})})}function jl(r,e){e.length>0&&(r.sdk=r.sdk||{},r.sdk.integrations=[...r.sdk.integrations||[],...e])}function $l(r,e,t){if(!r)return null;const n={...r,...r.breadcrumbs&&{breadcrumbs:r.breadcrumbs.map(i=>({...i,...i.data&&{data:Ue(i.data,e,t)}}))},...r.user&&{user:Ue(r.user,e,t)},...r.contexts&&{contexts:Ue(r.contexts,e,t)},...r.extra&&{extra:Ue(r.extra,e,t)}};return r.contexts&&r.contexts.trace&&n.contexts&&(n.contexts.trace=r.contexts.trace,r.contexts.trace.data&&(n.contexts.trace.data=Ue(r.contexts.trace.data,e,t))),r.spans&&(n.spans=r.spans.map(i=>({...i,...i.data&&{data:Ue(i.data,e,t)}}))),n}function Ll(r,e){if(!e)return r;const t=r?r.clone():new We;return t.update(e),t}function Fl(r){if(r)return Vl(r)?{captureContext:r}:Wl(r)?{captureContext:r}:r}function Vl(r){return r instanceof We||typeof r=="function"}const ql=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function Wl(r){return Object.keys(r).some(e=>ql.includes(e))}function Pa(r,e){return He().captureException(r,Fl(e))}function Oa(r,e){const t=typeof e=="string"?e:void 0,n=typeof e!="string"?{captureContext:e}:void 0;return He().captureMessage(r,t,n)}function Na(r,e){return He().captureEvent(r,e)}function Hl(){const r=Lr(),e=He(),t=e.getSession()||r.getSession();t&&Ic(t),Ma(),r.setSession(),e.setSession()}function Ma(){const r=Lr(),e=He(),t=te(),n=e.getSession()||r.getSession();n&&t&&t.captureSession(n)}function Zl(r=!1){if(r){Hl();return}Ma()}const Kl="7";function Gl(r){const e=r.protocol?`${r.protocol}:`:"",t=r.port?`:${r.port}`:"";return`${e}//${r.host}${t}${r.path?`/${r.path}`:""}/api/`}function zl(r){return`${Gl(r)}${r.projectId}/envelope/`}function Bl(r,e){return xc({sentry_key:r.publicKey,sentry_version:Kl,...e&&{sentry_client:`${e.name}/${e.version}`}})}function Jl(r,e,t){return e||`${zl(r)}?${Bl(r,t)}`}const Da=[];function Yl(r,e){const t={};return e.forEach(n=>{n&&ja(r,n,t)}),t}function Ua(r,e){for(const t of e)t&&t.afterAllSetup&&t.afterAllSetup(r)}function ja(r,e,t){if(t[e.name]){D&&T.log(`Integration skipped because it was already installed: ${e.name}`);return}if(t[e.name]=e,Da.indexOf(e.name)===-1&&typeof e.setupOnce=="function"&&(e.setupOnce(),Da.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(r),typeof e.preprocessEvent=="function"){const n=e.preprocessEvent.bind(e);r.on("preprocessEvent",(i,a)=>n(i,a,r))}if(typeof e.processEvent=="function"){const n=e.processEvent.bind(e),i=Object.assign((a,s)=>n(a,s,r),{id:e.name});r.addEventProcessor(i)}D&&T.log(`Integration installed: ${e.name}`)}function t_(r){return r}function Xl(r,e,t){const n=[{type:"client_report"},{timestamp:Kt(),discarded_events:r}];return Gt(e?{dsn:e}:{},[n])}class xe extends Error{constructor(e,t="warn"){super(e),this.message=e,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=t}}const $a="Not capturing exception because it's already been captured.";class Ql{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=dl(e.dsn):D&&T.warn("No DSN provided, client will not send events."),this._dsn){const t=Jl(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:t})}}captureException(e,t,n){const i=we();if(fa(e))return D&&T.log($a),i;const a={event_id:i,...t};return this._process(this.eventFromException(e,a).then(s=>this._captureEvent(s,a,n))),a.event_id}captureMessage(e,t,n,i){const a={event_id:we(),...n},s=vn(e)?e:String(e),o=wn(e)?this.eventFromMessage(s,t,a):this.eventFromException(e,a);return this._process(o.then(c=>this._captureEvent(c,a,i))),a.event_id}captureEvent(e,t,n){const i=we();if(t&&t.originalException&&fa(t.originalException))return D&&T.log($a),i;const a={event_id:i,...t},o=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,a,o||n)),a.event_id}captureSession(e){typeof e.release!="string"?D&&T.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),jr(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const t=this._transport;return t?(this.emit("flush"),this._isClientDoneProcessing(e).then(n=>t.flush(e).then(i=>n&&i))):ut(!0)}close(e){return this.flush(e).then(t=>(this.getOptions().enabled=!1,this.emit("close"),t))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const t=this._integrations[e.name];ja(this,e,this._integrations),t||Ua(this,[e])}sendEvent(e,t={}){this.emit("beforeSendEvent",e,t);let n=xl(e,this._dsn,this._options._metadata,this._options.tunnel);for(const a of t.attachments||[])n=yl(n,vl(a));const i=this.sendEnvelope(n);i&&i.then(a=>this.emit("afterSendEvent",e,a),null)}sendSession(e){const t=El(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(t)}recordDroppedEvent(e,t,n){if(this._options.sendClientReports){const i=typeof n=="number"?n:1,a=`${e}:${t}`;D&&T.log(`Recording outcome: "${a}"${i>1?` (${i} times)`:""}`),this._outcomes[a]=(this._outcomes[a]||0)+i}}on(e,t){const n=this._hooks[e]=this._hooks[e]||[];return n.push(t),()=>{const i=n.indexOf(t);i>-1&&n.splice(i,1)}}emit(e,...t){const n=this._hooks[e];n&&n.forEach(i=>i(...t))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,t=>(D&&T.error("Error while sending envelope:",t),t)):(D&&T.error("Transport disabled"),ut({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=Yl(this,e),Ua(this,e)}_updateSessionFromEvent(e,t){let n=!1,i=!1;const a=t.exception&&t.exception.values;if(a){i=!0;for(const c of a){const l=c.mechanism;if(l&&l.handled===!1){n=!0;break}}}const s=e.status==="ok";(s&&e.errors===0||s&&n)&&(jr(e,{...n&&{status:"crashed"},errors:e.errors||Number(i||n)}),this.captureSession(e))}_isClientDoneProcessing(e){return new ge(t=>{let n=0;const i=1,a=setInterval(()=>{this._numProcessing==0?(clearInterval(a),t(!0)):(n+=i,e&&n>=e&&(clearInterval(a),t(!1)))},i)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,t,n,i=Lr()){const a=this.getOptions(),s=Object.keys(this._integrations);return!t.integrations&&s.length>0&&(t.integrations=s),this.emit("preprocessEvent",e,t),e.type||i.setLastEventId(e.event_id||t.event_id),Nl(a,e,t,n,this,i).then(o=>{if(o===null)return o;const c={...i.getPropagationContext(),...n?n.getPropagationContext():void 0};if(!(o.contexts&&o.contexts.trace)&&c){const{traceId:u,spanId:d,parentSpanId:f,dsc:h}=c;o.contexts={trace:ve({trace_id:u,span_id:d,parent_span_id:f}),...o.contexts};const y=h||ka(u,this);o.sdkProcessingMetadata={dynamicSamplingContext:y,...o.sdkProcessingMetadata}}return o})}_captureEvent(e,t={},n){return this._processEvent(e,t,n).then(i=>i.event_id,i=>{if(D){const a=i;a.logLevel==="log"?T.log(a.message):T.warn(a)}})}_processEvent(e,t,n){const i=this.getOptions(),{sampleRate:a}=i,s=Fa(e),o=La(e),c=e.type||"error",l=`before send for type \`${c}\``,u=typeof a>"u"?void 0:sl(a);if(o&&typeof u=="number"&&Math.random()>u)return this.recordDroppedEvent("sample_rate","error",e),Ur(new xe(`Discarding event because it's not included in the random sample (sampling rate = ${a})`,"log"));const d=c==="replay_event"?"replay":c,h=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,t,n,h).then(y=>{if(y===null)throw this.recordDroppedEvent("event_processor",d,e),new xe("An event processor returned `null`, will not send event.","log");if(t.data&&t.data.__sentry__===!0)return y;const C=tu(this,i,y,t);return eu(C,l)}).then(y=>{if(y===null){if(this.recordDroppedEvent("before_send",d,e),s){const G=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",G)}throw new xe(`${l} returned \`null\`, will not send event.`,"log")}const N=n&&n.getSession();if(!s&&N&&this._updateSessionFromEvent(N,y),s){const F=y.sdkProcessingMetadata&&y.sdkProcessingMetadata.spanCountBeforeProcessing||0,G=y.spans?y.spans.length:0,R=F-G;R>0&&this.recordDroppedEvent("before_send","span",R)}const C=y.transaction_info;if(s&&C&&y.transaction!==e.transaction){const F="custom";y.transaction_info={...C,source:F}}return this.sendEvent(y,t),y}).then(null,y=>{throw y instanceof xe?y:(this.captureException(y,{data:{__sentry__:!0},originalException:y}),new xe(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${y}`))})}_process(e){this._numProcessing++,e.then(t=>(this._numProcessing--,t),t=>(this._numProcessing--,t))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([t,n])=>{const[i,a]=t.split(":");return{reason:i,category:a,quantity:n}})}_flushOutcomes(){D&&T.log("Flushing outcomes...");const e=this._clearOutcomes();if(e.length===0){D&&T.log("No outcomes to send");return}if(!this._dsn){D&&T.log("No dsn provided, will not send outcomes");return}D&&T.log("Sending outcomes:",e);const t=Xl(e,this._options.tunnel&&Vr(this._dsn));this.sendEnvelope(t)}}function eu(r,e){const t=`${e} must return \`null\` or a valid event.`;if(Nr(r))return r.then(n=>{if(!ot(n)&&n!==null)throw new xe(t);return n},n=>{throw new xe(`${e} rejected with ${n}`)});if(!ot(r)&&r!==null)throw new xe(t);return r}function tu(r,e,t,n){const{beforeSend:i,beforeSendTransaction:a,beforeSendSpan:s}=e;if(La(t)&&i)return i(t,n);if(Fa(t)){if(t.spans&&s){const o=[];for(const c of t.spans){const l=s(c);l?o.push(l):r.recordDroppedEvent("before_send","span")}t.spans=o}if(a){if(t.spans){const o=t.spans.length;t.sdkProcessingMetadata={...t.sdkProcessingMetadata,spanCountBeforeProcessing:o}}return a(t,n)}}return t}function La(r){return r.type===void 0}function Fa(r){return r.type==="transaction"}function ru(r,e){e.debug===!0&&(D?T.enable():Ar(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),He().update(e.initialScope);const n=new r(e);return nu(n),n.init(),n}function nu(r){He().setClient(r)}function iu(r){const e=[];function t(){return r===void 0||e.length<r}function n(s){return e.splice(e.indexOf(s),1)[0]||Promise.resolve(void 0)}function i(s){if(!t())return Ur(new xe("Not adding Promise because buffer limit was reached."));const o=s();return e.indexOf(o)===-1&&e.push(o),o.then(()=>n(o)).then(null,()=>n(o).then(null,()=>{})),o}function a(s){return new ge((o,c)=>{let l=e.length;if(!l)return o(!0);const u=setTimeout(()=>{s&&s>0&&o(!1)},s);e.forEach(d=>{ut(d).then(()=>{--l||(clearTimeout(u),o(!0))},c)})})}return{$:e,add:i,drain:a}}const au=60*1e3;function su(r,e=Date.now()){const t=parseInt(`${r}`,10);if(!isNaN(t))return t*1e3;const n=Date.parse(`${r}`);return isNaN(n)?au:n-e}function ou(r,e){return r[e]||r.all||0}function cu(r,e,t=Date.now()){return ou(r,e)>t}function lu(r,{statusCode:e,headers:t},n=Date.now()){const i={...r},a=t&&t["x-sentry-rate-limits"],s=t&&t["retry-after"];if(a)for(const o of a.trim().split(",")){const[c,l,,,u]=o.split(":",5),d=parseInt(c,10),f=(isNaN(d)?60:d)*1e3;if(!l)i.all=n+f;else for(const h of l.split(";"))h==="metric_bucket"?(!u||u.split(";").includes("custom"))&&(i[h]=n+f):i[h]=n+f}else s?i.all=n+su(s,n):e===429&&(i.all=n+6e4);return i}const uu=64;function du(r,e,t=iu(r.bufferSize||uu)){let n={};const i=s=>t.drain(s);function a(s){const o=[];if(Aa(s,(d,f)=>{const h=Ca(f);if(cu(n,h)){const y=Va(d,f);r.recordDroppedEvent("ratelimit_backoff",h,y)}else o.push(d)}),o.length===0)return ut({});const c=Gt(s[0],o),l=d=>{Aa(c,(f,h)=>{const y=Va(f,h);r.recordDroppedEvent(d,Ca(h),y)})},u=()=>e({body:bl(c)}).then(d=>(d.statusCode!==void 0&&(d.statusCode<200||d.statusCode>=300)&&D&&T.warn(`Sentry responded with status code ${d.statusCode} to sent event.`),n=lu(n,d),d),d=>{throw l("network_error"),d});return t.add(u).then(d=>d,d=>{if(d instanceof xe)return D&&T.error("Skipped sending event because buffer is full."),l("queue_overflow"),ut({});throw d})}return{send:a,flush:i}}function Va(r,e){if(!(e!=="event"&&e!=="transaction"))return Array.isArray(r)?r[1]:void 0}function fu(r,e,t=[e],n="npm"){const i=r._metadata||{};i.sdk||(i.sdk={name:`sentry.javascript.${e}`,packages:t.map(a=>({name:`${n}:@sentry/${a}`,version:me})),version:me}),r._metadata=i}const pu=100;function dt(r,e){const t=te(),n=Lr();if(!t)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:a=pu}=t.getOptions();if(a<=0)return;const o={timestamp:Kt(),...r},c=i?Ar(()=>i(o,e)):o;c!==null&&(t.emit&&t.emit("beforeAddBreadcrumb",c,e),n.addBreadcrumb(c,a))}let qa;const hu="FunctionToString",Wa=new WeakMap,mu=()=>({name:hu,setupOnce(){qa=Function.prototype.toString;try{Function.prototype.toString=function(...r){const e=kn(this),t=Wa.has(te())&&e!==void 0?e:this;return qa.apply(t,r)}}catch{}},setup(r){Wa.set(r,!0)}}),gu=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler"],yu="InboundFilters",bu=(r={})=>({name:yu,processEvent(e,t,n){const i=n.getOptions(),a=_u(r,i);return vu(e,a)?null:e}});function _u(r={},e={}){return{allowUrls:[...r.allowUrls||[],...e.allowUrls||[]],denyUrls:[...r.denyUrls||[],...e.denyUrls||[]],ignoreErrors:[...r.ignoreErrors||[],...e.ignoreErrors||[],...r.disableErrorDefaults?[]:gu],ignoreTransactions:[...r.ignoreTransactions||[],...e.ignoreTransactions||[]],ignoreInternal:r.ignoreInternal!==void 0?r.ignoreInternal:!0}}function vu(r,e){return e.ignoreInternal&&Au(r)?(D&&T.warn(`Event dropped due to being internal Sentry Error.
Event: ${qe(r)}`),!0):wu(r,e.ignoreErrors)?(D&&T.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${qe(r)}`),!0):Tu(r)?(D&&T.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${qe(r)}`),!0):Su(r,e.ignoreTransactions)?(D&&T.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${qe(r)}`),!0):ku(r,e.denyUrls)?(D&&T.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${qe(r)}.
Url: ${Wr(r)}`),!0):Eu(r,e.allowUrls)?!1:(D&&T.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${qe(r)}.
Url: ${Wr(r)}`),!0)}function wu(r,e){return r.type||!e||!e.length?!1:xu(r).some(t=>Dr(t,e))}function Su(r,e){if(r.type!=="transaction"||!e||!e.length)return!1;const t=r.transaction;return t?Dr(t,e):!1}function ku(r,e){if(!e||!e.length)return!1;const t=Wr(r);return t?Dr(t,e):!1}function Eu(r,e){if(!e||!e.length)return!0;const t=Wr(r);return t?Dr(t,e):!0}function xu(r){const e=[];r.message&&e.push(r.message);let t;try{t=r.exception.values[r.exception.values.length-1]}catch{}return t&&t.value&&(e.push(t.value),t.type&&e.push(`${t.type}: ${t.value}`)),e}function Au(r){try{return r.exception.values[0].type==="SentryError"}catch{}return!1}function Cu(r=[]){for(let e=r.length-1;e>=0;e--){const t=r[e];if(t&&t.filename!=="<anonymous>"&&t.filename!=="[native code]")return t.filename||null}return null}function Wr(r){try{let e;try{e=r.exception.values[0].stacktrace.frames}catch{}return e?Cu(e):null}catch{return D&&T.error(`Cannot extract url for event ${qe(r)}`),null}}function Tu(r){return r.type||!r.exception||!r.exception.values||r.exception.values.length===0?!1:!r.message&&!r.exception.values.some(e=>e.stacktrace||e.type&&e.type!=="Error"||e.value)}function Iu(r,e,t=250,n,i,a,s){if(!a.exception||!a.exception.values||!s||!ct(s.originalException,Error))return;const o=a.exception.values.length>0?a.exception.values[a.exception.values.length-1]:void 0;o&&(a.exception.values=Ru(On(r,e,i,s.originalException,n,a.exception.values,o,0),t))}function On(r,e,t,n,i,a,s,o){if(a.length>=t+1)return a;let c=[...a];if(ct(n[i],Error)){Ha(s,o);const l=r(e,n[i]),u=c.length;Za(l,i,u,o),c=On(r,e,t,n[i],i,[l,...c],l,u)}return Array.isArray(n.errors)&&n.errors.forEach((l,u)=>{if(ct(l,Error)){Ha(s,o);const d=r(e,l),f=c.length;Za(d,`errors[${u}]`,f,o),c=On(r,e,t,l,i,[d,...c],d,f)}}),c}function Ha(r,e){r.mechanism=r.mechanism||{type:"generic",handled:!0},r.mechanism={...r.mechanism,...r.type==="AggregateError"&&{is_exception_group:!0},exception_id:e}}function Za(r,e,t,n){r.mechanism=r.mechanism||{type:"generic",handled:!0},r.mechanism={...r.mechanism,type:"chained",source:e,exception_id:t,parent_id:n}}function Ru(r,e){return r.map(t=>(t.value&&(t.value=lt(t.value,e)),t))}function Nn(r){if(!r)return{};const e=r.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const t=e[6]||"",n=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:t,hash:n,relative:e[5]+t+n}}function Ka(r){const e="console";it(e,r),at(e,Pu)}function Pu(){"console"in $&&Er.forEach(function(r){r in $.console&&de($.console,r,function(e){return xr[r]=e,function(...t){_e("console",{args:t,level:r});const i=xr[r];i&&i.apply($.console,t)}})})}const Ou=["fatal","error","warning","log","info","debug"];function Ga(r){return r==="warn"?"warning":Ou.includes(r)?r:"log"}const Nu="CaptureConsole",Mu=(r={})=>{const e=r.levels||Er;return{name:Nu,setup(t){"console"in $&&Ka(({args:n,level:i})=>{te()!==t||!e.includes(i)||Du(n,i)})}}};function Du(r,e){const t={level:Ga(e),extra:{arguments:r}};ya(n=>{if(n.addEventProcessor(s=>(s.logger="console",kt(s,{handled:!1,type:"console"}),s)),e==="assert"){if(!r[0]){const s=`Assertion failed: ${Mr(r.slice(1)," ")||"console.assert"}`;n.setExtra("arguments",r.slice(1)),Oa(s,t)}return}const i=r.find(s=>s instanceof Error);if(i){Pa(i,t);return}const a=Mr(r," ");Oa(a,t)})}const Uu="Dedupe",ju=()=>{let r;return{name:Uu,processEvent(e){if(e.type)return e;try{if($u(e,r))return D&&T.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return r=e}}};function $u(r,e){return e?!!(Lu(r,e)||Fu(r,e)):!1}function Lu(r,e){const t=r.message,n=e.message;return!(!t&&!n||t&&!n||!t&&n||t!==n||!Ba(r,e)||!za(r,e))}function Fu(r,e){const t=Ja(e),n=Ja(r);return!(!t||!n||t.type!==n.type||t.value!==n.value||!Ba(r,e)||!za(r,e))}function za(r,e){let t=Qi(r),n=Qi(e);if(!t&&!n)return!0;if(t&&!n||!t&&n||(t=t,n=n,n.length!==t.length))return!1;for(let i=0;i<n.length;i++){const a=n[i],s=t[i];if(a.filename!==s.filename||a.lineno!==s.lineno||a.colno!==s.colno||a.function!==s.function)return!1}return!0}function Ba(r,e){let t=r.fingerprint,n=e.fingerprint;if(!t&&!n)return!0;if(t&&!n||!t&&n)return!1;t=t,n=n;try{return t.join("")===n.join("")}catch{return!1}}function Ja(r){return r.exception&&r.exception.values&&r.exception.values[0]}const Vu="ExtraErrorData",qu=(r={})=>{const{depth:e=3,captureErrorCause:t=!0}=r;return{name:Vu,processEvent(n,i,a){const{maxValueLength:s=250}=a.getOptions();return Wu(n,i,e,t,s)}}};function Wu(r,e={},t,n,i){if(!e.originalException||!st(e.originalException))return r;const a=e.originalException.name||e.originalException.constructor.name,s=Hu(e.originalException,n,i);if(s){const o={...r.contexts},c=Ue(s,t);return ot(c)&&(Fe(c,"__sentry_skip_normalization__",!0),o[a]=c),{...r,contexts:o}}return r}function Hu(r,e,t){try{const n=["name","message","stack","line","column","fileName","lineNumber","columnNumber","toJSON"],i={};for(const a of Object.keys(r)){if(n.indexOf(a)!==-1)continue;const s=r[a];i[a]=st(s)||typeof s=="string"?lt(`${s}`,t):s}if(e&&r.cause!==void 0&&(i.cause=st(r.cause)?r.cause.toString():r.cause),typeof r.toJSON=="function"){const a=r.toJSON();for(const s of Object.keys(a)){const o=a[s];i[s]=st(o)?o.toString():o}}return i}catch(n){D&&T.error("Unable to extract extra data from the Error object:",n)}return null}function Zu(r,e){let t=0;for(let n=r.length-1;n>=0;n--){const i=r[n];i==="."?r.splice(n,1):i===".."?(r.splice(n,1),t++):t&&(r.splice(n,1),t--)}if(e)for(;t--;t)r.unshift("..");return r}const Ku=/^(\S+:\\|\/?)([\s\S]*?)((?:\.{1,2}|[^/\\]+?|)(\.[^./\\]*|))(?:[/\\]*)$/;function Gu(r){const e=r.length>1024?`<truncated>${r.slice(-1024)}`:r,t=Ku.exec(e);return t?t.slice(1):[]}function Ya(...r){let e="",t=!1;for(let n=r.length-1;n>=-1&&!t;n--){const i=n>=0?r[n]:"/";i&&(e=`${i}/${e}`,t=i.charAt(0)==="/")}return e=Zu(e.split("/").filter(n=>!!n),!t).join("/"),(t?"/":"")+e||"."}function Xa(r){let e=0;for(;e<r.length&&r[e]==="";e++);let t=r.length-1;for(;t>=0&&r[t]==="";t--);return e>t?[]:r.slice(e,t-e+1)}function zu(r,e){r=Ya(r).slice(1),e=Ya(e).slice(1);const t=Xa(r.split("/")),n=Xa(e.split("/")),i=Math.min(t.length,n.length);let a=i;for(let o=0;o<i;o++)if(t[o]!==n[o]){a=o;break}let s=[];for(let o=a;o<t.length;o++)s.push("..");return s=s.concat(n.slice(a)),s.join("/")}function Bu(r,e){return Gu(r)[2]||""}const Ju="RewriteFrames",Yu=(r={})=>{const e=r.root,t=r.prefix||"app:///",n="window"in $&&$.window!==void 0,i=r.iteratee||Xu({isBrowser:n,root:e,prefix:t});function a(o){try{return{...o,exception:{...o.exception,values:o.exception.values.map(c=>({...c,...c.stacktrace&&{stacktrace:s(c.stacktrace)}}))}}}catch{return o}}function s(o){return{...o,frames:o&&o.frames&&o.frames.map(c=>i(c))}}return{name:Ju,processEvent(o){let c=o;return o.exception&&Array.isArray(o.exception.values)&&(c=a(c)),c}}};function Xu({isBrowser:r,root:e,prefix:t}){return n=>{if(!n.filename)return n;const i=/^[a-zA-Z]:\\/.test(n.filename)||n.filename.includes("\\")&&!n.filename.includes("/"),a=/^\//.test(n.filename);if(r){if(e){const s=n.filename;s.indexOf(e)===0&&(n.filename=s.replace(e,t))}}else if(i||a){const s=i?n.filename.replace(/^[a-zA-Z]:/,"").replace(/\\/g,"/"):n.filename,o=e?zu(e,s):Bu(s);n.filename=`${t}${o}`}return n}}function Qa(r){if(r!==void 0)return r>=400&&r<500?"warning":r>=500?"error":void 0}const Mn=$;function Qu(){if(!("fetch"in Mn))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function Dn(r){return r&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(r.toString())}function ed(){if(typeof EdgeRuntime=="string")return!0;if(!Qu())return!1;if(Dn(Mn.fetch))return!0;let r=!1;const e=Mn.document;if(e&&typeof e.createElement=="function")try{const t=e.createElement("iframe");t.hidden=!0,e.head.appendChild(t),t.contentWindow&&t.contentWindow.fetch&&(r=Dn(t.contentWindow.fetch)),e.head.removeChild(t)}catch(t){rt&&T.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",t)}return r}function td(r,e){const t="fetch";it(t,r),at(t,()=>rd(void 0,e))}function rd(r,e=!1){e&&!ed()||de($,"fetch",function(t){return function(...n){const{method:i,url:a}=nd(n),s={args:n,fetchData:{method:i,url:a},startTimestamp:Ve()*1e3};_e("fetch",{...s});const o=new Error().stack;return t.apply($,n).then(async c=>(_e("fetch",{...s,endTimestamp:Ve()*1e3,response:c}),c),c=>{throw _e("fetch",{...s,endTimestamp:Ve()*1e3,error:c}),st(c)&&c.stack===void 0&&(c.stack=o,Fe(c,"framesToPop",1)),c})}})}function Un(r,e){return!!r&&typeof r=="object"&&!!r[e]}function es(r){return typeof r=="string"?r:r?Un(r,"url")?r.url:r.toString?r.toString():"":""}function nd(r){if(r.length===0)return{method:"GET",url:""};if(r.length===2){const[t,n]=r;return{url:es(t),method:Un(n,"method")?String(n.method).toUpperCase():"GET"}}const e=r[0];return{url:es(e),method:Un(e,"method")?String(e.method).toUpperCase():"GET"}}function id(){return"npm"}const Hr=$;function ad(){const r=Hr.chrome,e=r&&r.app&&r.app.runtime,t="history"in Hr&&!!Hr.history.pushState&&!!Hr.history.replaceState;return!e&&t}const Ae=$;let jn=0;function ts(){return jn>0}function sd(){jn++,setTimeout(()=>{jn--})}function xt(r,e={},t){if(typeof r!="function")return r;try{const i=r.__sentry_wrapped__;if(i)return typeof i=="function"?i:r;if(kn(r))return r}catch{return r}const n=function(){const i=Array.prototype.slice.call(arguments);try{const a=i.map(s=>xt(s,e));return r.apply(this,a)}catch(a){throw sd(),ya(s=>{s.addEventProcessor(o=>(e.mechanism&&(xn(o,void 0),kt(o,e.mechanism)),o.extra={...o.extra,arguments:i},o)),Pa(a)}),a}};try{for(const i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])}catch{}sa(n,r),Fe(r,"__sentry_wrapped__",n);try{Object.getOwnPropertyDescriptor(n,"name").configurable&&Object.defineProperty(n,"name",{get(){return r.name}})}catch{}return n}const $n=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function Ln(r,e){const t=Vn(r,e),n={type:dd(e),value:fd(e)};return t.length&&(n.stacktrace={frames:t}),n.type===void 0&&n.value===""&&(n.value="Unrecoverable error caught"),n}function od(r,e,t,n){const i=te(),a=i&&i.getOptions().normalizeDepth,s=yd(e),o={__serialized__:xa(e,a)};if(s)return{exception:{values:[Ln(r,s)]},extra:o};const c={exception:{values:[{type:Or(e)?e.constructor.name:n?"UnhandledRejection":"Error",value:md(e,{isUnhandledRejection:n})}]},extra:o};if(t){const l=Vn(r,t);l.length&&(c.exception.values[0].stacktrace={frames:l})}return c}function Fn(r,e){return{exception:{values:[Ln(r,e)]}}}function Vn(r,e){const t=e.stacktrace||e.stack||"",n=ld(e),i=ud(e);try{return r(t,n,i)}catch{}return[]}const cd=/Minified React error #\d+;/i;function ld(r){return r&&cd.test(r.message)?1:0}function ud(r){return typeof r.framesToPop=="number"?r.framesToPop:0}function rs(r){return typeof WebAssembly<"u"&&typeof WebAssembly.Exception<"u"?r instanceof WebAssembly.Exception:!1}function dd(r){const e=r&&r.name;return!e&&rs(r)?r.message&&Array.isArray(r.message)&&r.message.length==2?r.message[0]:"WebAssembly.Exception":e}function fd(r){const e=r&&r.message;return e?e.error&&typeof e.error.message=="string"?e.error.message:rs(r)&&Array.isArray(r.message)&&r.message.length==2?r.message[1]:e:"No error message"}function pd(r,e,t,n){const i=t&&t.syntheticException||void 0,a=qn(r,e,i,n);return kt(a),a.level="error",t&&t.event_id&&(a.event_id=t.event_id),ut(a)}function hd(r,e,t="info",n,i){const a=n&&n.syntheticException||void 0,s=Wn(r,e,a,i);return s.level=t,n&&n.event_id&&(s.event_id=n.event_id),ut(s)}function qn(r,e,t,n,i){let a;if(ra(e)&&e.error)return Fn(r,e.error);if(na(e)||gc(e)){const s=e;if("stack"in e)a=Fn(r,e);else{const o=s.name||(na(s)?"DOMError":"DOMException"),c=s.message?`${o}: ${s.message}`:o;a=Wn(r,c,t,n),xn(a,c)}return"code"in s&&(a.tags={...a.tags,"DOMException.code":`${s.code}`}),a}return st(e)?Fn(r,e):ot(e)||Or(e)?(a=od(r,e,t,i),kt(a,{synthetic:!0}),a):(a=Wn(r,e,t,n),xn(a,`${e}`),kt(a,{synthetic:!0}),a)}function Wn(r,e,t,n){const i={};if(n&&t){const a=Vn(r,t);a.length&&(i.exception={values:[{value:e,stacktrace:{frames:a}}]})}if(vn(e)){const{__sentry_template_string__:a,__sentry_template_values__:s}=e;return i.logentry={message:a,params:s},i}return i.message=e,i}function md(r,{isUnhandledRejection:e}){const t=Ac(r),n=e?"promise rejection":"exception";return ra(r)?`Event \`ErrorEvent\` captured as ${n} with message \`${r.message}\``:Or(r)?`Event \`${gd(r)}\` (type=${r.type}) captured as ${n}`:`Object captured as ${n} with keys: ${t}`}function gd(r){try{const e=Object.getPrototypeOf(r);return e?e.constructor.name:void 0}catch{}}function yd(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e)){const t=r[e];if(t instanceof Error)return t}}function bd(r,{metadata:e,tunnel:t,dsn:n}){const i={event_id:r.event_id,sent_at:new Date().toISOString(),...e&&e.sdk&&{sdk:{name:e.sdk.name,version:e.sdk.version}},...!!t&&!!n&&{dsn:Vr(n)}},a=_d(r);return Gt(i,[a])}function _d(r){return[{type:"user_report"},r]}class vd extends Ql{constructor(e){const t={parentSpanIsAlwaysRootSpan:!0,...e},n=Ae.SENTRY_SDK_SOURCE||id();fu(t,"browser",["browser"],n),super(t),t.sendClientReports&&Ae.document&&Ae.document.addEventListener("visibilitychange",()=>{Ae.document.visibilityState==="hidden"&&this._flushOutcomes()})}eventFromException(e,t){return pd(this._options.stackParser,e,t,this._options.attachStacktrace)}eventFromMessage(e,t="info",n){return hd(this._options.stackParser,e,t,n,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled()){$n&&T.warn("SDK not enabled, will not capture user feedback.");return}const t=bd(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(t)}_prepareEvent(e,t,n){return e.platform=e.platform||"javascript",super._prepareEvent(e,t,n)}}const wd=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,re=$,Sd=1e3;let ns,Hn,Zn;function kd(r){const e="dom";it(e,r),at(e,Ed)}function Ed(){if(!re.document)return;const r=_e.bind(null,"dom"),e=is(r,!0);re.document.addEventListener("click",e,!1),re.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(t=>{const n=re[t]&&re[t].prototype;!n||!n.hasOwnProperty||!n.hasOwnProperty("addEventListener")||(de(n,"addEventListener",function(i){return function(a,s,o){if(a==="click"||a=="keypress")try{const c=this,l=c.__sentry_instrumentation_handlers__=c.__sentry_instrumentation_handlers__||{},u=l[a]=l[a]||{refCount:0};if(!u.handler){const d=is(r);u.handler=d,i.call(this,a,d,o)}u.refCount++}catch{}return i.call(this,a,s,o)}}),de(n,"removeEventListener",function(i){return function(a,s,o){if(a==="click"||a=="keypress")try{const c=this,l=c.__sentry_instrumentation_handlers__||{},u=l[a];u&&(u.refCount--,u.refCount<=0&&(i.call(this,a,u.handler,o),u.handler=void 0,delete l[a]),Object.keys(l).length===0&&delete c.__sentry_instrumentation_handlers__)}catch{}return i.call(this,a,s,o)}}))})}function xd(r){if(r.type!==Hn)return!1;try{if(!r.target||r.target._sentryId!==Zn)return!1}catch{}return!0}function Ad(r,e){return r!=="keypress"?!1:!e||!e.tagName?!0:!(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable)}function is(r,e=!1){return t=>{if(!t||t._sentryCaptured)return;const n=Cd(t);if(Ad(t.type,n))return;Fe(t,"_sentryCaptured",!0),n&&!n._sentryId&&Fe(n,"_sentryId",we());const i=t.type==="keypress"?"input":t.type;xd(t)||(r({event:t,name:i,global:e}),Hn=t.type,Zn=n?n._sentryId:void 0),clearTimeout(ns),ns=re.setTimeout(()=>{Zn=void 0,Hn=void 0},Sd)}}function Cd(r){try{return r.target}catch{return null}}let Zr;function Td(r){const e="history";it(e,r),at(e,Id)}function Id(){if(!ad())return;const r=re.onpopstate;re.onpopstate=function(...t){const n=re.location.href,i=Zr;if(Zr=n,_e("history",{from:i,to:n}),r)try{return r.apply(this,t)}catch{}};function e(t){return function(...n){const i=n.length>2?n[2]:void 0;if(i){const a=Zr,s=String(i);Zr=s,_e("history",{from:a,to:s})}return t.apply(this,n)}}de(re.history,"pushState",e),de(re.history,"replaceState",e)}const Kr={};function Rd(r){const e=Kr[r];if(e)return e;let t=re[r];if(Dn(t))return Kr[r]=t.bind(re);const n=re.document;if(n&&typeof n.createElement=="function")try{const i=n.createElement("iframe");i.hidden=!0,n.head.appendChild(i);const a=i.contentWindow;a&&a[r]&&(t=a[r]),n.head.removeChild(i)}catch(i){wd&&T.warn(`Could not create sandbox iframe for ${r} check, bailing to window.${r}: `,i)}return t&&(Kr[r]=t.bind(re))}function as(r){Kr[r]=void 0}const zt="__sentry_xhr_v3__";function Pd(r){const e="xhr";it(e,r),at(e,Od)}function Od(){if(!re.XMLHttpRequest)return;const r=XMLHttpRequest.prototype;r.open=new Proxy(r.open,{apply(e,t,n){const i=Ve()*1e3,a=Me(n[0])?n[0].toUpperCase():void 0,s=Nd(n[1]);if(!a||!s)return e.apply(t,n);t[zt]={method:a,url:s,request_headers:{}},a==="POST"&&s.match(/sentry_key/)&&(t.__sentry_own_request__=!0);const o=()=>{const c=t[zt];if(c&&t.readyState===4){try{c.status_code=t.status}catch{}const l={endTimestamp:Ve()*1e3,startTimestamp:i,xhr:t};_e("xhr",l)}};return"onreadystatechange"in t&&typeof t.onreadystatechange=="function"?t.onreadystatechange=new Proxy(t.onreadystatechange,{apply(c,l,u){return o(),c.apply(l,u)}}):t.addEventListener("readystatechange",o),t.setRequestHeader=new Proxy(t.setRequestHeader,{apply(c,l,u){const[d,f]=u,h=l[zt];return h&&Me(d)&&Me(f)&&(h.request_headers[d.toLowerCase()]=f),c.apply(l,u)}}),e.apply(t,n)}}),r.send=new Proxy(r.send,{apply(e,t,n){const i=t[zt];if(!i)return e.apply(t,n);n[0]!==void 0&&(i.body=n[0]);const a={startTimestamp:Ve()*1e3,xhr:t};return _e("xhr",a),e.apply(t,n)}})}function Nd(r){if(Me(r))return r;try{return r.toString()}catch{}}function Md(r,e=Rd("fetch")){let t=0,n=0;function i(a){const s=a.body.length;t+=s,n++;const o={body:a.body,method:"POST",referrerPolicy:"origin",headers:r.headers,keepalive:t<=6e4&&n<15,...r.fetchOptions};if(!e)return as("fetch"),Ur("No fetch implementation available");try{return e(r.url,o).then(c=>(t-=s,n--,{statusCode:c.status,headers:{"x-sentry-rate-limits":c.headers.get("X-Sentry-Rate-Limits"),"retry-after":c.headers.get("Retry-After")}}))}catch(c){return as("fetch"),t-=s,n--,Ur(c)}}return du(r,i)}const Dd=30,Ud=50;function Kn(r,e,t,n){const i={filename:r,function:e==="<anonymous>"?nt:e,in_app:!0};return t!==void 0&&(i.lineno=t),n!==void 0&&(i.colno=n),i}const jd=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,$d=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Ld=/\((\S*)(?::(\d+))(?::(\d+))\)/,Fd=[Dd,r=>{const e=jd.exec(r);if(e){const[,n,i,a]=e;return Kn(n,nt,+i,+a)}const t=$d.exec(r);if(t){if(t[2]&&t[2].indexOf("eval")===0){const s=Ld.exec(t[2]);s&&(t[2]=s[1],t[3]=s[2],t[4]=s[3])}const[i,a]=ss(t[1]||nt,t[2]);return Kn(a,i,t[3]?+t[3]:void 0,t[4]?+t[4]:void 0)}}],Vd=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,qd=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,Wd=uc(...[Fd,[Ud,r=>{const e=Vd.exec(r);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const a=qd.exec(e[3]);a&&(e[1]=e[1]||"eval",e[3]=a[1],e[4]=a[2],e[5]="")}let n=e[3],i=e[1]||nt;return[i,n]=ss(i,n),Kn(n,i,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}}]]),ss=(r,e)=>{const t=r.indexOf("safari-extension")!==-1,n=r.indexOf("safari-web-extension")!==-1;return t||n?[r.indexOf("@")!==-1?r.split("@")[0]:nt,t?`safari-extension:${e}`:`safari-web-extension:${e}`]:[r,e]},Gr=1024,Hd="Breadcrumbs",Zd=(r={})=>{const e={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...r};return{name:Hd,setup(t){e.console&&Ka(zd(t)),e.dom&&kd(Gd(t,e.dom)),e.xhr&&Pd(Bd(t)),e.fetch&&td(Jd(t)),e.history&&Td(Yd(t)),e.sentry&&t.on("beforeSendEvent",Kd(t))}}};function Kd(r){return function(t){te()===r&&dt({category:`sentry.${t.type==="transaction"?"transaction":"event"}`,event_id:t.event_id,level:t.level,message:qe(t)},{event:t})}}function Gd(r,e){return function(n){if(te()!==r)return;let i,a,s=typeof e=="object"?e.serializeAttribute:void 0,o=typeof e=="object"&&typeof e.maxStringLength=="number"?e.maxStringLength:void 0;o&&o>Gr&&($n&&T.warn(`\`dom.maxStringLength\` cannot exceed ${Gr}, but a value of ${o} was configured. Sentry will use ${Gr} instead.`),o=Gr),typeof s=="string"&&(s=[s]);try{const l=n.event,u=Xd(l)?l.target:l;i=aa(u,{keyAttrs:s,maxStringLength:o}),a=kc(u)}catch{i="<unknown>"}if(i.length===0)return;const c={category:`ui.${n.name}`,message:i};a&&(c.data={"ui.component_name":a}),dt(c,{event:n.event,name:n.name,global:n.global})}}function zd(r){return function(t){if(te()!==r)return;const n={category:"console",data:{arguments:t.args,logger:"console"},level:Ga(t.level),message:Mr(t.args," ")};if(t.level==="assert")if(t.args[0]===!1)n.message=`Assertion failed: ${Mr(t.args.slice(1)," ")||"console.assert"}`,n.data.arguments=t.args.slice(1);else return;dt(n,{input:t.args,level:t.level})}}function Bd(r){return function(t){if(te()!==r)return;const{startTimestamp:n,endTimestamp:i}=t,a=t.xhr[zt];if(!n||!i||!a)return;const{method:s,url:o,status_code:c,body:l}=a,u={method:s,url:o,status_code:c},d={xhr:t.xhr,input:l,startTimestamp:n,endTimestamp:i},f=Qa(c);dt({category:"xhr",data:u,type:"http",level:f},d)}}function Jd(r){return function(t){if(te()!==r)return;const{startTimestamp:n,endTimestamp:i}=t;if(i&&!(t.fetchData.url.match(/sentry_key/)&&t.fetchData.method==="POST"))if(t.error){const a=t.fetchData,s={data:t.error,input:t.args,startTimestamp:n,endTimestamp:i};dt({category:"fetch",data:a,level:"error",type:"http"},s)}else{const a=t.response,s={...t.fetchData,status_code:a&&a.status},o={input:t.args,response:a,startTimestamp:n,endTimestamp:i},c=Qa(s.status_code);dt({category:"fetch",data:s,type:"http",level:c},o)}}}function Yd(r){return function(t){if(te()!==r)return;let n=t.from,i=t.to;const a=Nn(Ae.location.href);let s=n?Nn(n):void 0;const o=Nn(i);(!s||!s.path)&&(s=a),a.protocol===o.protocol&&a.host===o.host&&(i=o.relative),a.protocol===s.protocol&&a.host===s.host&&(n=s.relative),dt({category:"navigation",data:{from:n,to:i}})}}function Xd(r){return!!r&&!!r.target}const Qd=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],ef="BrowserApiErrors",tf=(r={})=>{const e={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...r};return{name:ef,setupOnce(){e.setTimeout&&de(Ae,"setTimeout",os),e.setInterval&&de(Ae,"setInterval",os),e.requestAnimationFrame&&de(Ae,"requestAnimationFrame",rf),e.XMLHttpRequest&&"XMLHttpRequest"in Ae&&de(XMLHttpRequest.prototype,"send",nf);const t=e.eventTarget;t&&(Array.isArray(t)?t:Qd).forEach(af)}}};function os(r){return function(...e){const t=e[0];return e[0]=xt(t,{mechanism:{data:{function:Le(r)},handled:!1,type:"instrument"}}),r.apply(this,e)}}function rf(r){return function(e){return r.apply(this,[xt(e,{mechanism:{data:{function:"requestAnimationFrame",handler:Le(r)},handled:!1,type:"instrument"}})])}}function nf(r){return function(...e){const t=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(i=>{i in t&&typeof t[i]=="function"&&de(t,i,function(a){const s={mechanism:{data:{function:i,handler:Le(a)},handled:!1,type:"instrument"}},o=kn(a);return o&&(s.mechanism.data.handler=Le(o)),xt(a,s)})}),r.apply(this,e)}}function af(r){const e=Ae,t=e[r]&&e[r].prototype;!t||!t.hasOwnProperty||!t.hasOwnProperty("addEventListener")||(de(t,"addEventListener",function(n){return function(i,a,s){try{typeof a.handleEvent=="function"&&(a.handleEvent=xt(a.handleEvent,{mechanism:{data:{function:"handleEvent",handler:Le(a),target:r},handled:!1,type:"instrument"}}))}catch{}return n.apply(this,[i,xt(a,{mechanism:{data:{function:"addEventListener",handler:Le(a),target:r},handled:!1,type:"instrument"}}),s])}}),de(t,"removeEventListener",function(n){return function(i,a,s){const o=a;try{const c=o&&o.__sentry_wrapped__;c&&n.call(this,i,c,s)}catch{}return n.call(this,i,o,s)}}))}const sf="GlobalHandlers",of=(r={})=>{const e={onerror:!0,onunhandledrejection:!0,...r};return{name:sf,setupOnce(){Error.stackTraceLimit=50},setup(t){e.onerror&&(cf(t),cs("onerror")),e.onunhandledrejection&&(lf(t),cs("onunhandledrejection"))}}};function cf(r){fc(e=>{const{stackParser:t,attachStacktrace:n}=ls();if(te()!==r||ts())return;const{msg:i,url:a,line:s,column:o,error:c}=e,l=ff(qn(t,c||i,void 0,n,!1),a,s,o);l.level="error",Na(l,{originalException:c,mechanism:{handled:!1,type:"onerror"}})})}function lf(r){hc(e=>{const{stackParser:t,attachStacktrace:n}=ls();if(te()!==r||ts())return;const i=uf(e),a=wn(i)?df(i):qn(t,i,void 0,n,!0);a.level="error",Na(a,{originalException:i,mechanism:{handled:!1,type:"onunhandledrejection"}})})}function uf(r){if(wn(r))return r;try{if("reason"in r)return r.reason;if("detail"in r&&"reason"in r.detail)return r.detail.reason}catch{}return r}function df(r){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(r)}`}]}}}function ff(r,e,t,n){const i=r.exception=r.exception||{},a=i.values=i.values||[],s=a[0]=a[0]||{},o=s.stacktrace=s.stacktrace||{},c=o.frames=o.frames||[],l=isNaN(parseInt(n,10))?void 0:n,u=isNaN(parseInt(t,10))?void 0:t,d=Me(e)&&e.length>0?e:Sc();return c.length===0&&c.push({colno:l,filename:d,function:nt,in_app:!0,lineno:u}),r}function cs(r){$n&&T.log(`Global Handler attached: ${r}`)}function ls(){const r=te();return r&&r.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const pf="cause",hf=5,mf="LinkedErrors",gf=(r={})=>{const e=r.limit||hf,t=r.key||pf;return{name:mf,preprocessEvent(n,i,a){const s=a.getOptions();Iu(Ln,s.stackParser,s.maxValueLength,t,e,n,i)}}},Bt=new Map;function yf({url:r="",method:e="",responseType:t="",body:n=""}){return[r,e.toUpperCase(),t,n].join("||")}function us({requestKey:r,res:e,err:t}){const n=Bt.get(r)??[];for(const i of n)e!=null?i.resolve(e):i.reject(t);Bt.delete(r)}async function ds(r,e={},t){var n,i;let a,s;e.responseType!==void 0?(a=e,s={}):(a={},s=e);const{requestKey:o,responseType:c="",dedupe:l=!0}=a,u=o??yf({url:r instanceof Request?r.url:r.toString(),method:s.method??(r instanceof Request?r.method:""),body:((n=s.body)==null?void 0:n.toString())??(r instanceof Request?(i=r.body)==null?void 0:i.toString():"")});let d;if(l){const h=Bt.get(u)??[];Bt.has(u)||Bt.set(u,h);const y=!!h.length,N={resolve:()=>{},reject:()=>{}};if(d=new Promise((C,F)=>{N.resolve=C,N.reject=F}),h.push(N),y)return d}const f=fetch(r,s).then(async h=>{let y="json";c instanceof Function?y=c(h):c?y=c:h.status===204?y="text":y="json";try{switch(h.data=await h[y](),y){case"blob":h.blob=async()=>Promise.resolve(h.data);break;case"formData":h.formData=async()=>Promise.resolve(h.data);break;case"json":h.json=async()=>Promise.resolve(h.data);break;case"text":h.text=async()=>Promise.resolve(h.data);break}}catch(N){switch(h.data=null,y){case"blob":h.blob=async()=>Promise.reject(N);break;case"formData":h.formData=async()=>Promise.reject(N);break;case"json":h.json=async()=>Promise.reject(N);break;case"text":h.text=async()=>Promise.reject(N);break}}if(l){us({requestKey:u,res:h});return}return h},async h=>{if(l){us({requestKey:u,err:h});return}return Promise.reject(h)});return l&&d!==void 0?d:f}const At=(r,e,t)=>typeof r=="object"&&r!==null&&"type"in r&&r.type===e&&"id"in r&&(t===void 0||r.id===t);var bf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _f(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var vf=Error,wf=EvalError,Sf=RangeError,kf=ReferenceError,fs=SyntaxError,Jt=TypeError,Ef=URIError,xf=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var r={},e=Symbol("test"),t=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(t)!=="[object Symbol]")return!1;var n=42;r[e]=n;for(e in r)return!1;if(typeof Object.keys=="function"&&Object.keys(r).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(r).length!==0)return!1;var i=Object.getOwnPropertySymbols(r);if(i.length!==1||i[0]!==e||!Object.prototype.propertyIsEnumerable.call(r,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(r,e);if(a.value!==n||a.enumerable!==!0)return!1}return!0},ps=typeof Symbol<"u"&&Symbol,Af=xf,Cf=function(){return typeof ps!="function"||typeof Symbol!="function"||typeof ps("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:Af()},Gn={__proto__:null,foo:{}},Tf=Object,If=function(){return{__proto__:Gn}.foo===Gn.foo&&!(Gn instanceof Tf)},Rf="Function.prototype.bind called on incompatible ",Pf=Object.prototype.toString,Of=Math.max,Nf="[object Function]",hs=function(r,e){for(var t=[],n=0;n<r.length;n+=1)t[n]=r[n];for(var i=0;i<e.length;i+=1)t[i+r.length]=e[i];return t},Mf=function(r,e){for(var t=[],n=e,i=0;n<r.length;n+=1,i+=1)t[i]=r[n];return t},Df=function(r,e){for(var t="",n=0;n<r.length;n+=1)t+=r[n],n+1<r.length&&(t+=e);return t},Uf=function(r){var e=this;if(typeof e!="function"||Pf.apply(e)!==Nf)throw new TypeError(Rf+e);for(var t=Mf(arguments,1),n,i=function(){if(this instanceof n){var l=e.apply(this,hs(t,arguments));return Object(l)===l?l:this}return e.apply(r,hs(t,arguments))},a=Of(0,e.length-t.length),s=[],o=0;o<a;o++)s[o]="$"+o;if(n=Function("binder","return function ("+Df(s,",")+"){ return binder.apply(this,arguments); }")(i),e.prototype){var c=function(){};c.prototype=e.prototype,n.prototype=new c,c.prototype=null}return n},jf=Uf,zn=Function.prototype.bind||jf,$f=Function.prototype.call,Lf=Object.prototype.hasOwnProperty,Ff=zn,Vf=Ff.call($f,Lf),U,qf=vf,Wf=wf,Hf=Sf,Zf=kf,Ct=fs,Tt=Jt,Kf=Ef,ms=Function,Bn=function(r){try{return ms('"use strict"; return ('+r+").constructor;")()}catch{}},ft=Object.getOwnPropertyDescriptor;if(ft)try{ft({},"")}catch{ft=null}var Jn=function(){throw new Tt},Gf=ft?function(){try{return arguments.callee,Jn}catch{try{return ft(arguments,"callee").get}catch{return Jn}}}():Jn,It=Cf(),zf=If(),Q=Object.getPrototypeOf||(zf?function(r){return r.__proto__}:null),Rt={},Bf=typeof Uint8Array>"u"||!Q?U:Q(Uint8Array),pt={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?U:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?U:ArrayBuffer,"%ArrayIteratorPrototype%":It&&Q?Q([][Symbol.iterator]()):U,"%AsyncFromSyncIteratorPrototype%":U,"%AsyncFunction%":Rt,"%AsyncGenerator%":Rt,"%AsyncGeneratorFunction%":Rt,"%AsyncIteratorPrototype%":Rt,"%Atomics%":typeof Atomics>"u"?U:Atomics,"%BigInt%":typeof BigInt>"u"?U:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?U:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?U:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?U:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":qf,"%eval%":eval,"%EvalError%":Wf,"%Float32Array%":typeof Float32Array>"u"?U:Float32Array,"%Float64Array%":typeof Float64Array>"u"?U:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?U:FinalizationRegistry,"%Function%":ms,"%GeneratorFunction%":Rt,"%Int8Array%":typeof Int8Array>"u"?U:Int8Array,"%Int16Array%":typeof Int16Array>"u"?U:Int16Array,"%Int32Array%":typeof Int32Array>"u"?U:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":It&&Q?Q(Q([][Symbol.iterator]())):U,"%JSON%":typeof JSON=="object"?JSON:U,"%Map%":typeof Map>"u"?U:Map,"%MapIteratorPrototype%":typeof Map>"u"||!It||!Q?U:Q(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?U:Promise,"%Proxy%":typeof Proxy>"u"?U:Proxy,"%RangeError%":Hf,"%ReferenceError%":Zf,"%Reflect%":typeof Reflect>"u"?U:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?U:Set,"%SetIteratorPrototype%":typeof Set>"u"||!It||!Q?U:Q(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?U:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":It&&Q?Q(""[Symbol.iterator]()):U,"%Symbol%":It?Symbol:U,"%SyntaxError%":Ct,"%ThrowTypeError%":Gf,"%TypedArray%":Bf,"%TypeError%":Tt,"%Uint8Array%":typeof Uint8Array>"u"?U:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?U:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?U:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?U:Uint32Array,"%URIError%":Kf,"%WeakMap%":typeof WeakMap>"u"?U:WeakMap,"%WeakRef%":typeof WeakRef>"u"?U:WeakRef,"%WeakSet%":typeof WeakSet>"u"?U:WeakSet};if(Q)try{null.error}catch(r){var Jf=Q(Q(r));pt["%Error.prototype%"]=Jf}var Yf=function r(e){var t;if(e==="%AsyncFunction%")t=Bn("async function () {}");else if(e==="%GeneratorFunction%")t=Bn("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Bn("async function* () {}");else if(e==="%AsyncGenerator%"){var n=r("%AsyncGeneratorFunction%");n&&(t=n.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=r("%AsyncGenerator%");i&&Q&&(t=Q(i.prototype))}return pt[e]=t,t},gs={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Yt=zn,zr=Vf,Xf=Yt.call(Function.call,Array.prototype.concat),Qf=Yt.call(Function.apply,Array.prototype.splice),ys=Yt.call(Function.call,String.prototype.replace),Br=Yt.call(Function.call,String.prototype.slice),ep=Yt.call(Function.call,RegExp.prototype.exec),tp=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,rp=/\\(\\)?/g,np=function(r){var e=Br(r,0,1),t=Br(r,-1);if(e==="%"&&t!=="%")throw new Ct("invalid intrinsic syntax, expected closing `%`");if(t==="%"&&e!=="%")throw new Ct("invalid intrinsic syntax, expected opening `%`");var n=[];return ys(r,tp,function(i,a,s,o){n[n.length]=s?ys(o,rp,"$1"):a||i}),n},ip=function(r,e){var t=r,n;if(zr(gs,t)&&(n=gs[t],t="%"+n[0]+"%"),zr(pt,t)){var i=pt[t];if(i===Rt&&(i=Yf(t)),typeof i>"u"&&!e)throw new Tt("intrinsic "+r+" exists, but is not available. Please file an issue!");return{alias:n,name:t,value:i}}throw new Ct("intrinsic "+r+" does not exist!")},Pt=function(r,e){if(typeof r!="string"||r.length===0)throw new Tt("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new Tt('"allowMissing" argument must be a boolean');if(ep(/^%?[^%]*%?$/,r)===null)throw new Ct("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var t=np(r),n=t.length>0?t[0]:"",i=ip("%"+n+"%",e),a=i.name,s=i.value,o=!1,c=i.alias;c&&(n=c[0],Qf(t,Xf([0,1],c)));for(var l=1,u=!0;l<t.length;l+=1){var d=t[l],f=Br(d,0,1),h=Br(d,-1);if((f==='"'||f==="'"||f==="`"||h==='"'||h==="'"||h==="`")&&f!==h)throw new Ct("property names with quotes must have matching quotes");if((d==="constructor"||!u)&&(o=!0),n+="."+d,a="%"+n+"%",zr(pt,a))s=pt[a];else if(s!=null){if(!(d in s)){if(!e)throw new Tt("base intrinsic for "+r+" exists, but the property is not available.");return}if(ft&&l+1>=t.length){var y=ft(s,d);u=!!y,u&&"get"in y&&!("originalValue"in y.get)?s=y.get:s=s[d]}else u=zr(s,d),s=s[d];u&&!o&&(pt[a]=s)}}return s},bs={exports:{}},Yn,_s;function Xn(){if(_s)return Yn;_s=1;var r=Pt,e=r("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return Yn=e,Yn}var ap=Pt,Jr=ap("%Object.getOwnPropertyDescriptor%",!0);if(Jr)try{Jr([],"length")}catch{Jr=null}var vs=Jr,ws=Xn(),sp=fs,Ot=Jt,Ss=vs,op=function(r,e,t){if(!r||typeof r!="object"&&typeof r!="function")throw new Ot("`obj` must be an object or a function`");if(typeof e!="string"&&typeof e!="symbol")throw new Ot("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Ot("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Ot("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Ot("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Ot("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,i=arguments.length>4?arguments[4]:null,a=arguments.length>5?arguments[5]:null,s=arguments.length>6?arguments[6]:!1,o=!!Ss&&Ss(r,e);if(ws)ws(r,e,{configurable:a===null&&o?o.configurable:!a,enumerable:n===null&&o?o.enumerable:!n,value:t,writable:i===null&&o?o.writable:!i});else if(s||!n&&!i&&!a)r[e]=t;else throw new sp("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Qn=Xn(),ks=function(){return!!Qn};ks.hasArrayLengthDefineBug=function(){if(!Qn)return null;try{return Qn([],"length",{value:1}).length!==1}catch{return!0}};var cp=ks,lp=Pt,Es=op,up=cp(),xs=vs,As=Jt,dp=lp("%Math.floor%"),fp=function(r,e){if(typeof r!="function")throw new As("`fn` is not a function");if(typeof e!="number"||e<0||e>4294967295||dp(e)!==e)throw new As("`length` must be a positive 32-bit integer");var t=arguments.length>2&&!!arguments[2],n=!0,i=!0;if("length"in r&&xs){var a=xs(r,"length");a&&!a.configurable&&(n=!1),a&&!a.writable&&(i=!1)}return(n||i||!t)&&(up?Es(r,"length",e,!0,!0):Es(r,"length",e)),r};(function(r){var e=zn,t=Pt,n=fp,i=Jt,a=t("%Function.prototype.apply%"),s=t("%Function.prototype.call%"),o=t("%Reflect.apply%",!0)||e.call(s,a),c=Xn(),l=t("%Math.max%");r.exports=function(d){if(typeof d!="function")throw new i("a function is required");var f=o(e,s,arguments);return n(f,1+l(0,d.length-(arguments.length-1)),!0)};var u=function(){return o(e,a,arguments)};c?c(r.exports,"apply",{value:u}):r.exports.apply=u})(bs);var pp=bs.exports,Cs=Pt,Ts=pp,hp=Ts(Cs("String.prototype.indexOf")),mp=function(r,e){var t=Cs(r,!!e);return typeof t=="function"&&hp(r,".prototype.")>-1?Ts(t):t};const gp={},yp=Object.freeze(Object.defineProperty({__proto__:null,default:gp},Symbol.toStringTag,{value:"Module"})),bp=_f(yp);var ei=typeof Map=="function"&&Map.prototype,ti=Object.getOwnPropertyDescriptor&&ei?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Yr=ei&&ti&&typeof ti.get=="function"?ti.get:null,Is=ei&&Map.prototype.forEach,ri=typeof Set=="function"&&Set.prototype,ni=Object.getOwnPropertyDescriptor&&ri?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Xr=ri&&ni&&typeof ni.get=="function"?ni.get:null,Rs=ri&&Set.prototype.forEach,_p=typeof WeakMap=="function"&&WeakMap.prototype,Xt=_p?WeakMap.prototype.has:null,vp=typeof WeakSet=="function"&&WeakSet.prototype,Qt=vp?WeakSet.prototype.has:null,wp=typeof WeakRef=="function"&&WeakRef.prototype,Ps=wp?WeakRef.prototype.deref:null,Sp=Boolean.prototype.valueOf,kp=Object.prototype.toString,Ep=Function.prototype.toString,xp=String.prototype.match,ii=String.prototype.slice,Ze=String.prototype.replace,Ap=String.prototype.toUpperCase,Os=String.prototype.toLowerCase,Ns=RegExp.prototype.test,Ms=Array.prototype.concat,Ce=Array.prototype.join,Cp=Array.prototype.slice,Ds=Math.floor,ai=typeof BigInt=="function"?BigInt.prototype.valueOf:null,si=Object.getOwnPropertySymbols,oi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Nt=typeof Symbol=="function"&&typeof Symbol.iterator=="object",ne=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Nt||!0)?Symbol.toStringTag:null,Us=Object.prototype.propertyIsEnumerable,js=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function $s(r,e){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||Ns.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var n=r<0?-Ds(-r):Ds(r);if(n!==r){var i=String(n),a=ii.call(e,i.length+1);return Ze.call(i,t,"$&_")+"."+Ze.call(Ze.call(a,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Ze.call(e,t,"$&_")}var ci=bp,Ls=ci.custom,Fs=Ws(Ls)?Ls:null,Tp=function r(e,t,n,i){var a=t||{};if(Ke(a,"quoteStyle")&&a.quoteStyle!=="single"&&a.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Ke(a,"maxStringLength")&&(typeof a.maxStringLength=="number"?a.maxStringLength<0&&a.maxStringLength!==1/0:a.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var s=Ke(a,"customInspect")?a.customInspect:!0;if(typeof s!="boolean"&&s!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Ke(a,"indent")&&a.indent!==null&&a.indent!=="	"&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Ke(a,"numericSeparator")&&typeof a.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var o=a.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return Zs(e,a);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var c=String(e);return o?$s(e,c):c}if(typeof e=="bigint"){var l=String(e)+"n";return o?$s(e,l):l}var u=typeof a.depth>"u"?5:a.depth;if(typeof n>"u"&&(n=0),n>=u&&u>0&&typeof e=="object")return li(e)?"[Array]":"[Object]";var d=Kp(a,n);if(typeof i>"u")i=[];else if(Hs(i,e)>=0)return"[Circular]";function f(E,W,L){if(W&&(i=Cp.call(i),i.push(W)),L){var le={depth:a.depth};return Ke(a,"quoteStyle")&&(le.quoteStyle=a.quoteStyle),r(E,le,n+1,i)}return r(E,a,n+1,i)}if(typeof e=="function"&&!qs(e)){var h=jp(e),y=Qr(e,f);return"[Function"+(h?": "+h:" (anonymous)")+"]"+(y.length>0?" { "+Ce.call(y,", ")+" }":"")}if(Ws(e)){var N=Nt?Ze.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):oi.call(e);return typeof e=="object"&&!Nt?er(N):N}if(Wp(e)){for(var C="<"+Os.call(String(e.nodeName)),F=e.attributes||[],G=0;G<F.length;G++)C+=" "+F[G].name+"="+Vs(Ip(F[G].value),"double",a);return C+=">",e.childNodes&&e.childNodes.length&&(C+="..."),C+="</"+Os.call(String(e.nodeName))+">",C}if(li(e)){if(e.length===0)return"[]";var R=Qr(e,f);return d&&!Zp(R)?"["+di(R,d)+"]":"[ "+Ce.call(R,", ")+" ]"}if(Pp(e)){var z=Qr(e,f);return!("cause"in Error.prototype)&&"cause"in e&&!Us.call(e,"cause")?"{ ["+String(e)+"] "+Ce.call(Ms.call("[cause]: "+f(e.cause),z),", ")+" }":z.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+Ce.call(z,", ")+" }"}if(typeof e=="object"&&s){if(Fs&&typeof e[Fs]=="function"&&ci)return ci(e,{depth:u-n});if(s!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if($p(e)){var Y=[];return Is&&Is.call(e,function(E,W){Y.push(f(W,e,!0)+" => "+f(E,e))}),Ks("Map",Yr.call(e),Y,d)}if(Vp(e)){var b=[];return Rs&&Rs.call(e,function(E){b.push(f(E,e))}),Ks("Set",Xr.call(e),b,d)}if(Lp(e))return ui("WeakMap");if(qp(e))return ui("WeakSet");if(Fp(e))return ui("WeakRef");if(Np(e))return er(f(Number(e)));if(Dp(e))return er(f(ai.call(e)));if(Mp(e))return er(Sp.call(e));if(Op(e))return er(f(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(e===bf)return"{ [object globalThis] }";if(!Rp(e)&&!qs(e)){var _=Qr(e,f),I=js?js(e)===Object.prototype:e instanceof Object||e.constructor===Object,P=e instanceof Object?"":"null prototype",V=!I&&ne&&Object(e)===e&&ne in e?ii.call(Ge(e),8,-1):P?"Object":"",Z=I||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",B=Z+(V||P?"["+Ce.call(Ms.call([],V||[],P||[]),": ")+"] ":"");return _.length===0?B+"{}":d?B+"{"+di(_,d)+"}":B+"{ "+Ce.call(_,", ")+" }"}return String(e)};function Vs(r,e,t){var n=(t.quoteStyle||e)==="double"?'"':"'";return n+r+n}function Ip(r){return Ze.call(String(r),/"/g,"&quot;")}function li(r){return Ge(r)==="[object Array]"&&(!ne||!(typeof r=="object"&&ne in r))}function Rp(r){return Ge(r)==="[object Date]"&&(!ne||!(typeof r=="object"&&ne in r))}function qs(r){return Ge(r)==="[object RegExp]"&&(!ne||!(typeof r=="object"&&ne in r))}function Pp(r){return Ge(r)==="[object Error]"&&(!ne||!(typeof r=="object"&&ne in r))}function Op(r){return Ge(r)==="[object String]"&&(!ne||!(typeof r=="object"&&ne in r))}function Np(r){return Ge(r)==="[object Number]"&&(!ne||!(typeof r=="object"&&ne in r))}function Mp(r){return Ge(r)==="[object Boolean]"&&(!ne||!(typeof r=="object"&&ne in r))}function Ws(r){if(Nt)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!oi)return!1;try{return oi.call(r),!0}catch{}return!1}function Dp(r){if(!r||typeof r!="object"||!ai)return!1;try{return ai.call(r),!0}catch{}return!1}var Up=Object.prototype.hasOwnProperty||function(r){return r in this};function Ke(r,e){return Up.call(r,e)}function Ge(r){return kp.call(r)}function jp(r){if(r.name)return r.name;var e=xp.call(Ep.call(r),/^function\s*([\w$]+)/);return e?e[1]:null}function Hs(r,e){if(r.indexOf)return r.indexOf(e);for(var t=0,n=r.length;t<n;t++)if(r[t]===e)return t;return-1}function $p(r){if(!Yr||!r||typeof r!="object")return!1;try{Yr.call(r);try{Xr.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function Lp(r){if(!Xt||!r||typeof r!="object")return!1;try{Xt.call(r,Xt);try{Qt.call(r,Qt)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function Fp(r){if(!Ps||!r||typeof r!="object")return!1;try{return Ps.call(r),!0}catch{}return!1}function Vp(r){if(!Xr||!r||typeof r!="object")return!1;try{Xr.call(r);try{Yr.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function qp(r){if(!Qt||!r||typeof r!="object")return!1;try{Qt.call(r,Qt);try{Xt.call(r,Xt)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function Wp(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function Zs(r,e){if(r.length>e.maxStringLength){var t=r.length-e.maxStringLength,n="... "+t+" more character"+(t>1?"s":"");return Zs(ii.call(r,0,e.maxStringLength),e)+n}var i=Ze.call(Ze.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Hp);return Vs(i,"single",e)}function Hp(r){var e=r.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+Ap.call(e.toString(16))}function er(r){return"Object("+r+")"}function ui(r){return r+" { ? }"}function Ks(r,e,t,n){var i=n?di(t,n):Ce.call(t,", ");return r+" ("+e+") {"+i+"}"}function Zp(r){for(var e=0;e<r.length;e++)if(Hs(r[e],`
`)>=0)return!1;return!0}function Kp(r,e){var t;if(r.indent==="	")t="	";else if(typeof r.indent=="number"&&r.indent>0)t=Ce.call(Array(r.indent+1)," ");else return null;return{base:t,prev:Ce.call(Array(e+1),t)}}function di(r,e){if(r.length===0)return"";var t=`
`+e.prev+e.base;return t+Ce.call(r,","+t)+`
`+e.prev}function Qr(r,e){var t=li(r),n=[];if(t){n.length=r.length;for(var i=0;i<r.length;i++)n[i]=Ke(r,i)?e(r[i],r):""}var a=typeof si=="function"?si(r):[],s;if(Nt){s={};for(var o=0;o<a.length;o++)s["$"+a[o]]=a[o]}for(var c in r)Ke(r,c)&&(t&&String(Number(c))===c&&c<r.length||Nt&&s["$"+c]instanceof Symbol||(Ns.call(/[^\w$]/,c)?n.push(e(c,r)+": "+e(r[c],r)):n.push(c+": "+e(r[c],r))));if(typeof si=="function")for(var l=0;l<a.length;l++)Us.call(r,a[l])&&n.push("["+e(a[l])+"]: "+e(r[a[l]],r));return n}var Gs=Pt,Mt=mp,Gp=Tp,zp=Jt,en=Gs("%WeakMap%",!0),tn=Gs("%Map%",!0),Bp=Mt("WeakMap.prototype.get",!0),Jp=Mt("WeakMap.prototype.set",!0),Yp=Mt("WeakMap.prototype.has",!0),Xp=Mt("Map.prototype.get",!0),Qp=Mt("Map.prototype.set",!0),eh=Mt("Map.prototype.has",!0),fi=function(r,e){for(var t=r,n;(n=t.next)!==null;t=n)if(n.key===e)return t.next=n.next,n.next=r.next,r.next=n,n},th=function(r,e){var t=fi(r,e);return t&&t.value},rh=function(r,e,t){var n=fi(r,e);n?n.value=t:r.next={key:e,next:r.next,value:t}},nh=function(r,e){return!!fi(r,e)},ih=function(){var r,e,t,n={assert:function(i){if(!n.has(i))throw new zp("Side channel does not contain "+Gp(i))},get:function(i){if(en&&i&&(typeof i=="object"||typeof i=="function")){if(r)return Bp(r,i)}else if(tn){if(e)return Xp(e,i)}else if(t)return th(t,i)},has:function(i){if(en&&i&&(typeof i=="object"||typeof i=="function")){if(r)return Yp(r,i)}else if(tn){if(e)return eh(e,i)}else if(t)return nh(t,i);return!1},set:function(i,a){en&&i&&(typeof i=="object"||typeof i=="function")?(r||(r=new en),Jp(r,i,a)):tn?(e||(e=new tn),Qp(e,i,a)):(t||(t={key:{},next:null}),rh(t,i,a))}};return n},ah=String.prototype.replace,sh=/%20/g,pi={RFC1738:"RFC1738",RFC3986:"RFC3986"},hi={default:pi.RFC3986,formatters:{RFC1738:function(r){return ah.call(r,sh,"+")},RFC3986:function(r){return String(r)}},RFC1738:pi.RFC1738,RFC3986:pi.RFC3986},oh=hi,mi=Object.prototype.hasOwnProperty,ht=Array.isArray,Te=function(){for(var r=[],e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r}(),ch=function(r){for(;r.length>1;){var e=r.pop(),t=e.obj[e.prop];if(ht(t)){for(var n=[],i=0;i<t.length;++i)typeof t[i]<"u"&&n.push(t[i]);e.obj[e.prop]=n}}},zs=function(r,e){for(var t=e&&e.plainObjects?Object.create(null):{},n=0;n<r.length;++n)typeof r[n]<"u"&&(t[n]=r[n]);return t},lh=function r(e,t,n){if(!t)return e;if(typeof t!="object"){if(ht(e))e.push(t);else if(e&&typeof e=="object")(n&&(n.plainObjects||n.allowPrototypes)||!mi.call(Object.prototype,t))&&(e[t]=!0);else return[e,t];return e}if(!e||typeof e!="object")return[e].concat(t);var i=e;return ht(e)&&!ht(t)&&(i=zs(e,n)),ht(e)&&ht(t)?(t.forEach(function(a,s){if(mi.call(e,s)){var o=e[s];o&&typeof o=="object"&&a&&typeof a=="object"?e[s]=r(o,a,n):e.push(a)}else e[s]=a}),e):Object.keys(t).reduce(function(a,s){var o=t[s];return mi.call(a,s)?a[s]=r(a[s],o,n):a[s]=o,a},i)},uh=function(r,e){return Object.keys(e).reduce(function(t,n){return t[n]=e[n],t},r)},dh=function(r,e,t){var n=r.replace(/\+/g," ");if(t==="iso-8859-1")return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch{return n}},fh=function(r,e,t,n,i){if(r.length===0)return r;var a=r;if(typeof r=="symbol"?a=Symbol.prototype.toString.call(r):typeof r!="string"&&(a=String(r)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(l){return"%26%23"+parseInt(l.slice(2),16)+"%3B"});for(var s="",o=0;o<a.length;++o){var c=a.charCodeAt(o);if(c===45||c===46||c===95||c===126||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||i===oh.RFC1738&&(c===40||c===41)){s+=a.charAt(o);continue}if(c<128){s=s+Te[c];continue}if(c<2048){s=s+(Te[192|c>>6]+Te[128|c&63]);continue}if(c<55296||c>=57344){s=s+(Te[224|c>>12]+Te[128|c>>6&63]+Te[128|c&63]);continue}o+=1,c=65536+((c&1023)<<10|a.charCodeAt(o)&1023),s+=Te[240|c>>18]+Te[128|c>>12&63]+Te[128|c>>6&63]+Te[128|c&63]}return s},ph=function(r){for(var e=[{obj:{o:r},prop:"o"}],t=[],n=0;n<e.length;++n)for(var i=e[n],a=i.obj[i.prop],s=Object.keys(a),o=0;o<s.length;++o){var c=s[o],l=a[c];typeof l=="object"&&l!==null&&t.indexOf(l)===-1&&(e.push({obj:a,prop:c}),t.push(l))}return ch(e),r},hh=function(r){return Object.prototype.toString.call(r)==="[object RegExp]"},mh=function(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))},gh=function(r,e){return[].concat(r,e)},yh=function(r,e){if(ht(r)){for(var t=[],n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)},Bs={arrayToObject:zs,assign:uh,combine:gh,compact:ph,decode:dh,encode:fh,isBuffer:mh,isRegExp:hh,maybeMap:yh,merge:lh},Js=ih,rn=Bs,tr=hi,bh=Object.prototype.hasOwnProperty,Ys={brackets:function(r){return r+"[]"},comma:"comma",indices:function(r,e){return r+"["+e+"]"},repeat:function(r){return r}},Ie=Array.isArray,_h=Array.prototype.push,Xs=function(r,e){_h.apply(r,Ie(e)?e:[e])},vh=Date.prototype.toISOString,Qs=tr.default,X={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:rn.encode,encodeValuesOnly:!1,format:Qs,formatter:tr.formatters[Qs],indices:!1,serializeDate:function(r){return vh.call(r)},skipNulls:!1,strictNullHandling:!1},wh=function(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"},gi={},Sh=function r(e,t,n,i,a,s,o,c,l,u,d,f,h,y,N,C,F,G){for(var R=e,z=G,Y=0,b=!1;(z=z.get(gi))!==void 0&&!b;){var _=z.get(e);if(Y+=1,typeof _<"u"){if(_===Y)throw new RangeError("Cyclic object value");b=!0}typeof z.get(gi)>"u"&&(Y=0)}if(typeof u=="function"?R=u(t,R):R instanceof Date?R=h(R):n==="comma"&&Ie(R)&&(R=rn.maybeMap(R,function(Qe){return Qe instanceof Date?h(Qe):Qe})),R===null){if(s)return l&&!C?l(t,X.encoder,F,"key",y):t;R=""}if(wh(R)||rn.isBuffer(R)){if(l){var I=C?t:l(t,X.encoder,F,"key",y);return[N(I)+"="+N(l(R,X.encoder,F,"value",y))]}return[N(t)+"="+N(String(R))]}var P=[];if(typeof R>"u")return P;var V;if(n==="comma"&&Ie(R))C&&l&&(R=rn.maybeMap(R,l)),V=[{value:R.length>0?R.join(",")||null:void 0}];else if(Ie(u))V=u;else{var Z=Object.keys(R);V=d?Z.sort(d):Z}var B=c?t.replace(/\./g,"%2E"):t,E=i&&Ie(R)&&R.length===1?B+"[]":B;if(a&&Ie(R)&&R.length===0)return E+"[]";for(var W=0;W<V.length;++W){var L=V[W],le=typeof L=="object"&&typeof L.value<"u"?L.value:R[L];if(!(o&&le===null)){var be=f&&c?L.replace(/\./g,"%2E"):L,ee=Ie(R)?typeof n=="function"?n(E,be):E:E+(f?"."+be:"["+be+"]");G.set(e,Y);var ue=Js();ue.set(gi,G),Xs(P,r(le,ee,n,i,a,s,o,c,n==="comma"&&C&&Ie(R)?null:l,u,d,f,h,y,N,C,F,ue))}}return P},kh=function(r){if(!r)return X;if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=r.charset||X.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=tr.default;if(typeof r.format<"u"){if(!bh.call(tr.formatters,r.format))throw new TypeError("Unknown format option provided.");t=r.format}var n=tr.formatters[t],i=X.filter;(typeof r.filter=="function"||Ie(r.filter))&&(i=r.filter);var a;if(r.arrayFormat in Ys?a=r.arrayFormat:"indices"in r?a=r.indices?"indices":"repeat":a=X.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var s=typeof r.allowDots>"u"?r.encodeDotInKeys===!0?!0:X.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:X.addQueryPrefix,allowDots:s,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:X.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:X.charsetSentinel,commaRoundTrip:r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?X.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:X.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:X.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:X.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:X.encodeValuesOnly,filter:i,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:X.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:X.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:X.strictNullHandling}},Eh=function(r,e){var t=r,n=kh(e),i,a;typeof n.filter=="function"?(a=n.filter,t=a("",t)):Ie(n.filter)&&(a=n.filter,i=a);var s=[];if(typeof t!="object"||t===null)return"";var o=Ys[n.arrayFormat],c=o==="comma"&&n.commaRoundTrip;i||(i=Object.keys(t)),n.sort&&i.sort(n.sort);for(var l=Js(),u=0;u<i.length;++u){var d=i[u];n.skipNulls&&t[d]===null||Xs(s,Sh(t[d],d,o,c,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}var f=s.join(n.delimiter),h=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),f.length>0?h+f:""},Dt=Bs,yi=Object.prototype.hasOwnProperty,xh=Array.isArray,J={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!0,decoder:Dt.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},Ah=function(r){return r.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},eo=function(r,e){return r&&typeof r=="string"&&e.comma&&r.indexOf(",")>-1?r.split(","):r},Ch="utf8=%26%2310003%3B",Th="utf8=%E2%9C%93",Ih=function(r,e){var t={__proto__:null},n=e.ignoreQueryPrefix?r.replace(/^\?/,""):r,i=e.parameterLimit===1/0?void 0:e.parameterLimit,a=n.split(e.delimiter,i),s=-1,o,c=e.charset;if(e.charsetSentinel)for(o=0;o<a.length;++o)a[o].indexOf("utf8=")===0&&(a[o]===Th?c="utf-8":a[o]===Ch&&(c="iso-8859-1"),s=o,o=a.length);for(o=0;o<a.length;++o)if(o!==s){var l=a[o],u=l.indexOf("]="),d=u===-1?l.indexOf("="):u+1,f,h;d===-1?(f=e.decoder(l,J.decoder,c,"key"),h=e.strictNullHandling?null:""):(f=e.decoder(l.slice(0,d),J.decoder,c,"key"),h=Dt.maybeMap(eo(l.slice(d+1),e),function(N){return e.decoder(N,J.decoder,c,"value")})),h&&e.interpretNumericEntities&&c==="iso-8859-1"&&(h=Ah(h)),l.indexOf("[]=")>-1&&(h=xh(h)?[h]:h);var y=yi.call(t,f);y&&e.duplicates==="combine"?t[f]=Dt.combine(t[f],h):(!y||e.duplicates==="last")&&(t[f]=h)}return t},Rh=function(r,e,t,n){for(var i=n?e:eo(e,t),a=r.length-1;a>=0;--a){var s,o=r[a];if(o==="[]"&&t.parseArrays)s=t.allowEmptyArrays&&i===""?[]:[].concat(i);else{s=t.plainObjects?Object.create(null):{};var c=o.charAt(0)==="["&&o.charAt(o.length-1)==="]"?o.slice(1,-1):o,l=t.decodeDotInKeys?c.replace(/%2E/g,"."):c,u=parseInt(l,10);!t.parseArrays&&l===""?s={0:i}:!isNaN(u)&&o!==l&&String(u)===l&&u>=0&&t.parseArrays&&u<=t.arrayLimit?(s=[],s[u]=i):l!=="__proto__"&&(s[l]=i)}i=s}return i},Ph=function(r,e,t,n){if(r){var i=t.allowDots?r.replace(/\.([^.[]+)/g,"[$1]"):r,a=/(\[[^[\]]*])/,s=/(\[[^[\]]*])/g,o=t.depth>0&&a.exec(i),c=o?i.slice(0,o.index):i,l=[];if(c){if(!t.plainObjects&&yi.call(Object.prototype,c)&&!t.allowPrototypes)return;l.push(c)}for(var u=0;t.depth>0&&(o=s.exec(i))!==null&&u<t.depth;){if(u+=1,!t.plainObjects&&yi.call(Object.prototype,o[1].slice(1,-1))&&!t.allowPrototypes)return;l.push(o[1])}return o&&l.push("["+i.slice(o.index)+"]"),Rh(l,e,t,n)}},Oh=function(r){if(!r)return J;if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.decodeDotInKeys<"u"&&typeof r.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(r.decoder!==null&&typeof r.decoder<"u"&&typeof r.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof r.charset>"u"?J.charset:r.charset,t=typeof r.duplicates>"u"?J.duplicates:r.duplicates;if(t!=="combine"&&t!=="first"&&t!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var n=typeof r.allowDots>"u"?r.decodeDotInKeys===!0?!0:J.allowDots:!!r.allowDots;return{allowDots:n,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:J.allowEmptyArrays,allowPrototypes:typeof r.allowPrototypes=="boolean"?r.allowPrototypes:J.allowPrototypes,allowSparse:typeof r.allowSparse=="boolean"?r.allowSparse:J.allowSparse,arrayLimit:typeof r.arrayLimit=="number"?r.arrayLimit:J.arrayLimit,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:J.charsetSentinel,comma:typeof r.comma=="boolean"?r.comma:J.comma,decodeDotInKeys:typeof r.decodeDotInKeys=="boolean"?r.decodeDotInKeys:J.decodeDotInKeys,decoder:typeof r.decoder=="function"?r.decoder:J.decoder,delimiter:typeof r.delimiter=="string"||Dt.isRegExp(r.delimiter)?r.delimiter:J.delimiter,depth:typeof r.depth=="number"||r.depth===!1?+r.depth:J.depth,duplicates:t,ignoreQueryPrefix:r.ignoreQueryPrefix===!0,interpretNumericEntities:typeof r.interpretNumericEntities=="boolean"?r.interpretNumericEntities:J.interpretNumericEntities,parameterLimit:typeof r.parameterLimit=="number"?r.parameterLimit:J.parameterLimit,parseArrays:r.parseArrays!==!1,plainObjects:typeof r.plainObjects=="boolean"?r.plainObjects:J.plainObjects,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:J.strictNullHandling}},Nh=function(r,e){var t=Oh(e);if(r===""||r===null||typeof r>"u")return t.plainObjects?Object.create(null):{};for(var n=typeof r=="string"?Ih(r,t):r,i=t.plainObjects?Object.create(null):{},a=Object.keys(n),s=0;s<a.length;++s){var o=a[s],c=Ph(o,n[o],t,typeof r=="string");i=Dt.merge(i,c,t)}return t.allowSparse===!0?i:Dt.compact(i)},Mh=Eh,Dh=Nh,Uh=hi,to={formats:Uh,parse:Dh,stringify:Mh},jh=globalThis.fetch,$h=globalThis.FormData;function Lh(r){return(r==null?void 0:r.then)!=null}function bi(r,e){const t=r[Symbol.iterator]();let n=!1;function i(){n=!0}function a(){const{done:s,value:o}=t.next();if(s)return;const c=e(o,i);if(Lh(c))return c.then(()=>{if(!n)return a()});if(!n)return a()}return a()}const ro={};function Fh(r){return r.arrayBuffer!==void 0}function Vh(r){return new Proxy(r,{get(e,t,n){if(t==="json")return()=>e.then(a=>a.json());const i=Reflect.get(e,t,n);return typeof i=="function"?i.bind(e):i},has(e,t){return t==="json"?!0:Reflect.has(e,t)}})}const no={indices:!1,arrayFormat:"repeat"};class qh extends Error{constructor(e,t,n,i){super(`Validation failed for ${t} ${e}`),this.path=e,this.method=t,this.errors=n,this.response=i}[Symbol.iterator](){return this.errors[Symbol.iterator]()}}function Wh(){return{onResponse({path:r,method:e,response:t}){if(t.status===400&&t.headers.get("x-error-type")==="validation")return t.json().then(n=>{if(n.errors)throw new qh(r,e,n.errors,t)})}}}function Hh({endpoint:r,fetchFn:e=jh,plugins:t=[],globalParams:n}){t.unshift(Wh());const i=[],a=[],s=[];for(const o of t)o.onRequestInit&&i.push(o.onRequestInit),o.onFetch&&a.push(o.onFetch),o.onResponse&&s.push(o.onResponse);return new Proxy(ro,{get(o,c){return new Proxy(ro,{get(l,u){async function d(f={}){n!=null&&n.headers&&(f.headers={...n.headers,...f.headers}),n!=null&&n.query&&(f.query={...n.query,...f.query}),n!=null&&n.params&&(f.params={...n.params,...f.params}),n!=null&&n.json&&(f.json={...n.json,...f.json}),n!=null&&n.formData&&(f.formData={...n.formData,...f.formData}),n!=null&&n.formUrlEncoded&&(f.formUrlEncoded={...n.formUrlEncoded,...f.formUrlEncoded});const{headers:h={},params:y,json:N,formData:C,formUrlEncoded:F,query:G,...R}=f;if(y)for(const b in y){const _=y[b];_&&(c=c.replace(`{${b}}`,_).replace(`:${b}`,_))}!c.startsWith("/")&&!c.startsWith("http")&&(c=`/${c}`);const z={...R,method:u,headers:h};if(N&&(z.body=JSON.stringify(N),h["Content-Type"]="application/json"),C){z.body=new $h;for(const b in C){const _=C[b];_!=null&&z.body.append(b,Fh(_)?_:_.toString())}}F&&(z.body=to.stringify(F,no),z.headers["Content-Type"]="application/x-www-form-urlencoded");let Y;if(i.length){const b={path:c,method:u,requestParams:f,requestInit:z,endResponse(_){Y=_}};await bi(i,_=>_(b))}if(Y==null){let b=c;if(r&&!c.startsWith("http")&&(b=`${r}${c}`),G){const I=to.stringify(G,no);b.includes("?")?b+="&"+I:b+="?"+I}let _=e;if(a.length>0){const I={url:b,init:z,fetchFn:_,setFetchFn(P){_=P}};await bi(a,P=>P(I))}Y=await _(b,z)}if(s.length>0){const b={path:c,method:u,requestParams:f,requestInit:z,response:Y};await bi(s,_=>_(b))}return Y}return function(f={}){return Vh(d(f))}}})}})}function Zh(r){return Hh({endpoint:`https://${r.domain}/${r.version}/${r.platform}`,plugins:[{onRequestInit:({requestInit:e})=>{e.headers={...e.headers,"X-CLIENT-ID":r.clientId,"X-EXEC-ENV":r.execEnv}},onFetch({setFetchFn:e}){e(async(t,n)=>ds(t,n))}}]})}async function Kh(r,e,t,n){const i=new Error("Unable to fetch single use offer code"),a=new Error("Unable to fetch single use offer code: no more code available"),s=await r["/offers/{id_for_single_use_offer}/fetchCode"].post({params:{id_for_single_use_offer:e},formUrlEncoded:{fingerprint:t,source:navigator.userAgent,testMode:n}});if(!s.ok)throw s.status===404?a:i;const o=(await s.json()).meta.code??"";if(o==="")throw i;return o}const io=r=>{if((r==null?void 0:r.attributes)==null)return;const{dateEnd:e,dateStart:t,specificationCashbackVariableStatus:n=!1,specificationCommissionType:i,specificationUsersSpecificationStandardCashbackRate:a=0,specificationUsersSpecificationStandardConditionGenerated:s="",specificationUsersSpecificationStandardPreviousCashbackRate:o=0,specificationUsersSpecificationStandardSuperCashback:c=!1,specificationUsersSpecificationStandardScaleCashbackGenerated:l="",specificationUsersSpecificationStandardConditionCashbackGenerated:u="",specificationUsersSpecificationStandardUsefulInformationGenerated:d="",registrationInfo:f="",validationInfo:h=""}=r.attributes,y=i===2,N=new Intl.NumberFormat("fr-FR"),C=F=>F>0?`${N.format(F)}${y?"%":""}`:"";return{dateEnd:e,dateStart:t,hasIncrease:o>0&&o<a,htmlConditions:s,id:r.id,isSuperCashback:c,isVariable:n,shortCashbackText:C(a),shortPreviousCashbackText:C(o),scaleCashbackGenerated:l,conditionCashbackGenerated:u,usefulInformationGenerated:d,registrationInfo:f,validationInfo:h}},Gh=r=>{if((r==null?void 0:r.attributes)!=null)return{nbOffers:r.attributes.nbOffers??0}},ao=r=>r.trim()!==""?`https://cloud.poulpeo.io${r}`:void 0,zh=[54918,55264,1105,10575,54172,1829,1058,1948,2103,3136,55374,3823,3214,4164,64,354,1e3,2479,3306,10315,253,238,38628,46578,29980,51158,10949,54054,54224,54250,54284,54340,8538,54406,345,315,8919,32770,36574,38796,3135,3557,3745,46708,54104,4163,54392,4600,4899,5015,8660,50270,9435,8629,49210,10371,10348,174,198,67,15050,713,26093,22543,2106,3167,8768,8476,9251,2805,1649,1609,65474,66432,66434,66546,66616,66686,39208,65398,11477,2380,8661,65578,65978,65984,66150,66158,66184,66264,54416,66450,66470,66476,14631,66494,66496,66518,66568,66584,18774,65720,66482,65478,27060,24928,10830,8701,4251,2257,1168,10975,54230,48558,17699,55294,664,52026,29266,66578,67297,67307,67125,67488,67549,67736,67853,67874,68118,68295,68297,68342,68418,68474,68765,68795,68905,68908,68925,68979,69131,69012,69136,68957,68960,68963,69171,69139,69203,69208,69209],Ut=(r,e)=>{var t,n,i,a,s,o;if((r==null?void 0:r.attributes)==null)return;const c=(i=(n=(t=r.relationships)==null?void 0:t.merchantInfo)==null?void 0:n.data)==null?void 0:i.id,l=e==null?void 0:e.find(h=>At(h,"merchantInfo",c??"")),u=(o=(s=(a=r.relationships)==null?void 0:a.currentCashbackObject)==null?void 0:s.data)==null?void 0:o.id,d=e==null?void 0:e.find(h=>At(h,"cashback",u??"")),f=r.attributes;return{autocheckTips:f.autocheckTips??"",cartDomains:[...f.cartDomains??[]],cashback:io(d),extensionAutocheckStatus:f.extensionAutocheckStatus??!0,extensionDetectionAndDisplayStatus:f.extensionDetectionAndDisplayStatus??r.id!=="4123",extensionIconBlinkStatus:f.extensionIconBlinkStatus??!0,extensionNotificationsStatus:f.extensionNotificationsStatus??f.extensionIconBlinkStatus??!0,extensionOffersStatus:f.extensionOffersStatus??f.extensionFlagStatus??!0,extensionSerpStatus:f.extensionSerpStatus??!0,grade:f.grade??"U",id:+r.id,illustrationTopMobileUrl:ao(f.illustrationTopMobile??""),isAffiliated:f.isAffiliated??(d==null?void 0:d.attributes)!==void 0,isAffiliatedWithNetworkDisallowingUserSolicitation:f.isAffiliatedWithNetworkDisallowingUserSolicitation??zh.includes(+r.id),inactiveCashbackMessage:f.inactiveCashbackMessage??"",logoUrl:ao((f.logoPath??"")||(f.logoRetinaPath??"")),merchantInfo:Gh(l),merchantNote:f.merchantNote??"",name:f.name??"",nextCashback:io(f.nextCashback),rewrite:f.rewrite??void 0,scoreReview:f.scoreReview??3,support:f.support??!1,url:f.url??void 0}},so={0:void 0,1:"CODE",2:"SALES",3:"DESTOCKING",4:"DEAL",5:"PRIVATE_SALE",6:"FLASH_SALE",8:"CONTEST",9:"GIFT_CARD",10:"INFO"},oo=(r,e)=>{var t,n;const i=r.id,a=r.attributes,s=r.relationships,o=new Intl.NumberFormat("fr-FR",{style:"percent",maximumFractionDigits:2}),c=f=>f>0?o.format(f/100).replace(/\u00a0/g,""):"",l=+(((n=(t=s==null?void 0:s.merchant)==null?void 0:t.data)==null?void 0:n.id)??0),u=e==null?void 0:e.find(f=>At(f,"merchant",`${l}`));u&&s!=null&&s.currentCashbackObject&&(u.relationships={...u.relationships??{},currentCashbackObject:s.currentCashbackObject});const d={acquisitionBonusAmount:+(a.acquisitionBonusAmount??0),canCombineCashbackAndOffersCodes:a.canCombineCashbackAndOffersCodes??!1,code:a.code??"",codeType:a.codeType==="unique"||a.codeType==="multiple"?a.codeType:void 0,dateEnd:Number(a.dateEnd??0),deepUrl:a.deepUrl??void 0,descriptionHtml:a.descriptionHtml??"",discount:a.discount!=null&&typeof a.discount=="object"?{amount:a.discount.amount??0,type:a.discount.type}:void 0,giftCardCashback:a.giftCardCashbackData!=null&&typeof a.giftCardCashbackData=="object"?{cashbackRate:a.giftCardCashbackData.cashback_rate??0,cashbackRateText:c(a.giftCardCashbackData.cashback_rate??0),commissionValue:a.giftCardCashbackData.commission_value??0,externalId:a.giftCardCashbackData.external_id??"",validity:a.giftCardCashbackData.validity??"web",connectionUrl:a.giftCardCashbackData.connection_url??"",interstitialUrl:a.giftCardCashbackData.interstitial_url??""}:void 0,icon:typeof a.icon=="object"&&a.icon!==null?{imgPath:a.icon.imgPath!=null?`https://cloud.poulpeo.io${a.icon.imgPath}`:void 0,altText:a.icon.altText,iconName:a.icon.iconName,iconStyle:a.icon.iconStyle,secondaryIconName:a.icon.secondaryIconName,secondaryIconStyle:a.icon.secondaryIconStyle,secondaryIconSize:a.icon.secondaryIconSize,caption:a.icon.caption}:void 0,id:+i,merchantId:l,merchant:Ut(u,e),offerType:a.offerTypeId in so?so[a.offerTypeId]:void 0,shortTitle:a.shortTitle??"",title:a.title??"",family:a.family??void 0,subFamilies:a.subFamilies??void 0};return d.giftCardCashback!==void 0&&d.giftCardCashback.cashbackRateText!==""&&(d.icon={altText:d.giftCardCashback.cashbackRateText}),d},Bh=r=>{var e,t,n,i,a;const s=[];for(const o of r)s.push({id:o.id,message:((e=o.attributes)==null?void 0:e.text)??"",rating:Number(((t=o.attributes)==null?void 0:t.stars)??3),author:((n=o.attributes)==null?void 0:n.displayName)??"",date:((i=o.attributes)==null?void 0:i.createdAt)??"",link:((a=o.attributes)==null?void 0:a.link)??"",source:""});return s};async function co(r,e,t){const n=await r["/trustPilot/reviews"].get({query:{offset:t??0,limit:e}});if(!n.ok&&n.status===404)throw new Error(`Unable to fetch trustpilot reviews with limit=${e} and offset=${t}`);const i=await n.json();return Bh(i.data)}class Jh{constructor(){p(this,"defaultHeaders",{Accept:"application/json","X-Requested-With":"XhrPlpExtension"})}async get({endpoint:e,params:t}){const n="https://extension.poulpeo.com/extension/api/1.0",i=new URLSearchParams(t),a=i.size>0?`?${i.toString()}`:"",s=`${n}${e}${a}`,o=await ds(s,{cache:"no-cache",headers:this.defaultHeaders});if(o.status<200||o.status>=300)throw new Error(`Server responded with [${o.status}] - ${o.statusText}`);const c=o.data;if(c===null)throw new Error("Invalid server response format: response is not valid JSON");if(typeof c!="object")throw new Error(`Invalid server response format: expected an object, got a value of type ${typeof c}`);if(!("status"in c))throw new Error("Invalid server response format: object is missing status field");const l=c;if(l.status!=="ok"&&(+l.status<200||+l.status>=300))throw new Error(`Server responded with [${l.status}] - ${l.message??""}`);return l.data??void 0}}let ye;function Yh(r){ye=r}const fe=(r,e)=>e,jt=(r,e)=>{if(r===void 0)return r;try{const t=new URL(r),n=e.includes("Origin")?"redacted://redacted":t.origin,i=e.includes("Path")?"/redacted":t.pathname;return`${n}${i}?redacted`}catch{return"unknown://redacted"}};class Xh{constructor(e,t,n,i,a){p(this,"merchantRulesService");p(this,"affiliationRequestService");p(this,"affiliateNetworkService");p(this,"tabRequestsHistoryService");p(this,"userClickService");p(this,"eventBus",null);this.affiliateNetworkService=e,this.affiliationRequestService=t,this.merchantRulesService=n,this.tabRequestsHistoryService=i,this.userClickService=a}getPublishTarget(){return this.eventBus}setPublishTarget(e){this.eventBus=e}subscribeSelf(e){e==null||e.subscribe("headersReceived",this.onHeadersReceived.bind(this)),e==null||e.subscribe("tabRemoved",this.onTabRemoved.bind(this))}unsubscribeSelf(e){e==null||e.unsubscribe("headersReceived",this.onHeadersReceived.bind(this)),e==null||e.unsubscribe("tabRemoved",this.onTabRemoved.bind(this))}async onHeadersReceived(e){var l,u,d,f;const t=e.details;if(!this.isSuccessOrRedirectStatusCode(t.statusCode)||this.isKwankoTrackingScriptUrl(new URL(t.url)))return;await this.tabRequestsHistoryService.addRequestToHistory(t.tabId,t);const[n,i]=await Promise.all([this.tabRequestsHistoryService.getRequestsHistory(t.tabId),this.userClickService.getLastKnownUserClick(t.tabId)]);if(n===void 0||n.length<2||this.isRedirectStatusCode(t.statusCode))return;const a=await this.merchantRulesService.findMerchantsMatchingUrl(t.url);if(a.length===0)return;const s=await this.getTabRequestsHistoryStats(n,i);if((s.lastKnownAffiliateRedirect??s.lastKnownCashbackServiceRedirect)===void 0)return;const c={tabId:t.tabId,timestamp:t.timestamp,isFromAffiliateRefusingExtDisplay:((l=s.lastKnownAffiliateRedirect)==null?void 0:l.isAffiliateRefusingExtDisplay)===!0,isFromPoulpeoCashbackService:((u=s.lastKnownCashbackServiceRedirect)==null?void 0:u.isPoulpeoRedirect)===!0,isFromSameDomain:!s.hasHostChange,lastKnownAffiliateRedirectUrl:(d=s.lastKnownAffiliateRedirect)==null?void 0:d.url,lastKnownCashbackServiceRedirectUrl:(f=s.lastKnownCashbackServiceRedirect)==null?void 0:f.url};console.debug("AffiliationRequestDetector","onHeadersReceived",this.getCashbackServiceRedirectLabel(s.lastKnownCashbackServiceRedirect),"affiliation request detected for merchants",a,fe(JSON.stringify(c),"<redacted>"),fe(JSON.stringify(s),"<redacted>")),await Promise.all(a.map(async h=>{var N;const y={merchantId:h,...c};await this.affiliationRequestService.saveAffiliationRequest(y),(N=this.eventBus)==null||N.publish({type:"affiliationRequestDetected",details:{affiliationRequest:y}})})),await this.tabRequestsHistoryService.removeRequestsBefore(t.tabId,t)}async onTabRemoved(e){return this.tabRequestsHistoryService.deleteRequestsHistory(e.details.tabId)}async getTabRequestsHistoryStats(e,t){await Promise.all(e.map(async(d,f)=>{this.augmentRequestWithBasicRedirectInfo(d,f===0,t),this.augmentRequestWithCashbackServiceRedirectInfo(d),await this.augmentRequestWithAffiliationInfo(d)})),e=e.slice(1);const n=e.findIndex(d=>d.isRedirect===!1),i=e.findIndex(d=>d.isAffiliate),a=e.findIndex(d=>d.isPoulpeoRedirect),s=e.findIndex(d=>d.isCashbackCompetitorRedirect),o=e.findIndex((d,f)=>{var h;return f===0?!1:new URL(d.url).host!==new URL(((h=e[f-1])==null?void 0:h.url)??"").host}),c=d=>d>-1&&(n===-1||d<=n);let l;c(i)&&(l=e[i]);let u;return c(a)?u=e[a]:c(s)&&(u=e[s]),{hasHostChange:c(o),lastKnownAffiliateRedirect:l,lastKnownCashbackServiceRedirect:u}}augmentRequestWithBasicRedirectInfo(e,t,n){if(e.isRedirect!==void 0)return;const i=this.isRedirectStatusCode(e.statusCode),a=t?i||void 0:e.timestamp>((n==null?void 0:n.timestamp)??0);e.isRedirect=i||a}augmentRequestWithCashbackServiceRedirectInfo(e){if(e.isCashbackServiceRedirect!==void 0)return;const t=new URL(e.url);e.isCashbackCompetitorRedirect=this.isCashbackCompetitorRedirectUrl(t),e.isPoulpeoRedirect=this.isPoulpeoRedirectUrl(t),e.isCashbackServiceRedirect=e.isPoulpeoRedirect||e.isCashbackCompetitorRedirect}async augmentRequestWithAffiliationInfo(e){if(e.isAffiliate!==void 0)return;const t=new URL(e.url),n=await this.affiliateNetworkService.getAffiliateNetworkByDomain(t.hostname);e.isAffiliate=n!==void 0,e.isAffiliateRefusingExtDisplay=(n==null?void 0:n.allowsUserSolicitation)===!1}isKwankoTrackingScriptUrl(e){const t=/^(\/v)?\/js\/na\/na\/u\/[\w\d]{10}\.js$/,n=/^\/u\/[0-9]+\/p[0-9]+u?\.js$/;return t.test(e.pathname)||n.test(e.pathname)}isSuccessOrRedirectStatusCode(e){return this.isSuccessStatusCode(e)||this.isRedirectStatusCode(e)}isSuccessStatusCode(e){return 200<=e&&e<300}isRedirectStatusCode(e){return[301,302,307,308].includes(e)}isPoulpeoRedirectUrl(e){return e.href.startsWith("https://www.poulpeo.com")&&"/redirection.htm,/redirection/".split(",").some(t=>e.pathname.startsWith(t))}isCashbackCompetitorRedirectUrl(e){const t=["fr.igraal.com/redirect/marchand/","www.widilo.fr/out/","www.ebuyclub.com/interstitiel/cashback/","wanteeed.com/fr/redirect/","o.honey.io/store/","bankybee.fr/redirect/merchant/","fun-c.com/redirection-","www.coupert.com/api/v2/out/","outils.fr.shopping.rakuten.com/documents/lucy/crew-redirect/","www.capitalkoala.com/redirection/marchand","www.aklamio.com/en/follow/go","app.hellojoko.com/online-offer-activation"],n=e.hostname+e.pathname;return t.some(i=>n.startsWith(i))}getCashbackServiceRedirectLabel(e){return e===void 0?"unknown":e.isPoulpeoRedirect===!0?"Poulpeo":"competitor"}}class Qh{constructor(e){p(this,"userService");p(this,"eventBus",null);p(this,"estimatedServiceWorkerTerminationTimestampInMs",Number.POSITIVE_INFINITY);this.userService=e}getPublishTarget(){return this.eventBus}setPublishTarget(e){this.eventBus=e}subscribeSelf(e){e==null||e.subscribe("headersReceived",this.onHeadersReceived.bind(this)),e==null||e.subscribe("serviceWorkerTerminationWarningThresholdReached",this.onServiceWorkerTerminationWarningThresholdReached.bind(this)),e==null||e.subscribe("serviceWorkerTerminationWarningWithdrawn",this.onServiceWorkerTerminationWarningWithdrawn.bind(this))}unsubscribeSelf(e){e==null||e.unsubscribe("headersReceived",this.onHeadersReceived.bind(this)),e==null||e.unsubscribe("serviceWorkerTerminationWarningThresholdReached",this.onServiceWorkerTerminationWarningThresholdReached.bind(this)),e==null||e.unsubscribe("serviceWorkerTerminationWarningWithdrawn",this.onServiceWorkerTerminationWarningWithdrawn.bind(this))}async onHeadersReceived(e){var y,N;if(!e.details.url.startsWith("https://api.poulpeo.com"))return;const n=new URL(e.details.url).pathname,i="/1.0/web/auth/login,/1.0/web/auth/loginWithApple,/1.0/web/auth/loginWithFacebook,/1.0/web/auth/loginWithGoogle,/1.0/web/auth/register".split(","),a="/1.0/web/me/logout".split(","),s=i.some(C=>C===n),o=a.some(C=>C===n);if(!s&&!o)return;const c=await this.userService.getCurrentUser();await this.userService.clearCurrentUserCache();let l=await this.userService.getCurrentUser();const u=()=>(c==null?void 0:c.isLogged)!==(l==null?void 0:l.isLogged)||(c==null?void 0:c.id)!==(l==null?void 0:l.id),d=500,f=5;let h=1;for(;!u()&&h<f;){const C=this.estimatedServiceWorkerTerminationTimestampInMs-Date.now(),F=d*2**(h++-1);F<C&&await new Promise(G=>setTimeout(G,F)),await this.userService.clearCurrentUserCache(),l=await this.userService.getCurrentUser()}u()&&(s&&(l==null?void 0:l.isLogged)===!0?(y=this.eventBus)==null||y.publish({type:"userLoggedIn",details:{user:l}}):o&&c&&(l==null?void 0:l.isLogged)!==!0?(N=this.eventBus)==null||N.publish({type:"userLoggedOut",details:{user:c}}):console.error(new Error("Unexpected login state"),"AuthenticationDetector","onHeadersReceived",{currentPath:n,mayBeLogin:s,mayBeLogout:o}))}async onServiceWorkerTerminationWarningThresholdReached(e){return this.estimatedServiceWorkerTerminationTimestampInMs=e.details.estimatedServiceWorkerTerminationTimestampInMs,Promise.resolve()}async onServiceWorkerTerminationWarningWithdrawn(e){return this.estimatedServiceWorkerTerminationTimestampInMs=e.details.estimatedServiceWorkerTerminationTimestampInMs,Promise.resolve()}}class em{constructor(e){p(this,"trackingServices");this.trackingServices=e}subscribeSelf(e){e==null||e.subscribe("cashbackReactivationAccepted",this.onCashbackReactivationAccepted.bind(this)),e==null||e.subscribe("cashbackReactivationRefused",this.onCashbackReactivationRefused.bind(this)),e==null||e.subscribe("cashbackReactivationSuggested",this.onCashbackReactivationSuggested.bind(this)),e==null||e.subscribe("extensionInstalled",this.onExtensionInstalled.bind(this)),e==null||e.subscribe("merchantVisited",this.onMerchantVisited.bind(this)),e==null||e.subscribe("notificationClicked",this.onNotificationClicked.bind(this)),e==null||e.subscribe("notificationClosed",this.onNotificationClosed.bind(this)),e==null||e.subscribe("notificationShown",this.onNotificationShown.bind(this)),e==null||e.subscribe("parameterUpdated",this.onParameterUpdated.bind(this))}unsubscribeSelf(e){e==null||e.subscribe("cashbackReactivationAccepted",this.onCashbackReactivationAccepted.bind(this)),e==null||e.subscribe("cashbackReactivationRefused",this.onCashbackReactivationRefused.bind(this)),e==null||e.subscribe("cashbackReactivationSuggested",this.onCashbackReactivationSuggested.bind(this)),e==null||e.unsubscribe("extensionInstalled",this.onExtensionInstalled.bind(this)),e==null||e.unsubscribe("merchantVisited",this.onMerchantVisited.bind(this)),e==null||e.unsubscribe("notificationClicked",this.onNotificationClicked.bind(this)),e==null||e.unsubscribe("notificationClosed",this.onNotificationClosed.bind(this)),e==null||e.unsubscribe("notificationShown",this.onNotificationShown.bind(this)),e==null||e.unsubscribe("parameterUpdated",this.onParameterUpdated.bind(this))}async onCashbackReactivationAccepted(e){await this.trackBackgroundEvent(e)}async onCashbackReactivationRefused(e){await this.trackBackgroundEvent(e)}async onCashbackReactivationSuggested(e){await this.trackBackgroundEvent(e)}async onExtensionInstalled(e){await this.trackBackgroundEvent(e)}async onMerchantVisited(e){await this.trackBackgroundEvent(e)}async onNotificationClicked(e){await this.trackBackgroundEvent(e)}async onNotificationClosed(e){await this.trackBackgroundEvent(e)}async onNotificationShown(e){await this.trackBackgroundEvent(e)}async onParameterUpdated(e){await this.trackBackgroundEvent(e)}async trackBackgroundEvent(e){await Promise.all(this.trackingServices.map(async t=>t.trackBackgroundEvent(e)))}}function _i(r,e=Date.now()){const t=e/1e3;return r!==void 0&&(r.dateStart===void 0||r.dateStart<=t)&&(r.dateEnd===void 0||r.dateEnd>=t)}class tm{constructor(e,t,n,i){p(this,"cashbackActivationService");p(this,"merchantService");p(this,"merchantOffersService");p(this,"userService");this.cashbackActivationService=e,this.merchantService=t,this.merchantOffersService=n,this.userService=i}subscribeSelf(e){e==null||e.subscribe("affiliationRequestDetected",this.onAffiliationRequestDetected.bind(this)),e==null||e.subscribe("userLoggedOut",this.onUserLoggedOut.bind(this))}unsubscribeSelf(e){e==null||e.unsubscribe("affiliationRequestDetected",this.onAffiliationRequestDetected.bind(this)),e==null||e.subscribe("userLoggedOut",this.onUserLoggedOut.bind(this))}async onAffiliationRequestDetected(e){const t=e.details.affiliationRequest;console.debug("CashbackActivationDetector","onAffiliationRequestDetected",t.merchantId);const n=t.isFromPoulpeoCashbackService?t.lastKnownCashbackServiceRedirectUrl:void 0,i=n!==void 0&&await this.shouldCashbackBeActivatedByUrl(n,t.merchantId);if(console.debug("CashbackActivationDetector","onAffiliationRequestDetected","shouldCashbackBeActivated",i,jt(t.lastKnownAffiliateRedirectUrl,"searchAndPath"),jt(t.lastKnownCashbackServiceRedirectUrl,"search")),i){await this.cashbackActivationService.saveCashbackActivation(t.merchantId);return}const a=!t.isFromSameDomain&&await this.cashbackActivationService.getCashbackActivation(t.merchantId)!=null;console.debug("CashbackActivationDetector","onAffiliationRequestDetected","shouldCashbackBeDeactivated",a),a&&(await this.cashbackActivationService.cancelCashbackActivation(t.merchantId,"affiliationRequestDetected"),this.shouldCashbackReactivationPromptBeTriggeredByRequest(t)&&await this.cashbackActivationService.promptForCashbackReactivation(t.merchantId,t.tabId))}async onUserLoggedOut(){await this.cashbackActivationService.cancelCashbackActivations("userLoggedOut")}async shouldCashbackBeActivatedByUrl(e,t){console.debug("CashbackActivationDetector","shouldCashbackBeActivatedByUrl",jt(e,"search"));let n;try{n=new URL(e)}catch{return!1}if(!this.isPoulpeoRedirectionUrl(n)||this.isKrakenToMiwimPoulpeoRedirectionUrl(n)||this.isGiftCardPoulpeoRedirectionUrl(n))return!1;console.debug("CashbackActivationDetector","shouldCashbackBeActivatedByUrl","url check ok");const i=await this.getMerchantIdFromPoulpeoRedirectionUrl(n);if(i===void 0||i!==t)return!1;let a;try{if(a=await this.merchantService.getMerchantById(i),!a.extensionDetectionAndDisplayStatus)return!1}catch{return!1}if(!a.extensionOffersStatus||!_i(a.cashback))return!1;console.debug("CashbackActivationDetector","shouldCashbackBeActivatedByUrl","merchant check ok");const s=this.getOfferIdFromPoulpeoRedirectionUrl(n);if(s!==void 0){const l=(await this.merchantOffersService.getOffersByMerchantId(i)).find(u=>u.id===s);if((l==null?void 0:l.canCombineCashbackAndOffersCodes)===!1)return!1}console.debug("CashbackActivationDetector","shouldCashbackBeActivatedByUrl","offer check ok"),await this.userService.clearCurrentUserCache();const o=await this.userService.getCurrentUser();return(o==null?void 0:o.isLogged)!==!0?!1:(console.debug("CashbackActivationDetector","shouldCashbackBeActivatedByUrl","user check ok"),!0)}shouldCashbackReactivationPromptBeTriggeredByRequest(e){if(!e.isFromPoulpeoCashbackService)return!e.isFromAffiliateRefusingExtDisplay;try{const t=new URL(e.lastKnownCashbackServiceRedirectUrl??"");return!this.isPoulpeoRedirectionUrl(t)}catch{return!0}}isPoulpeoRedirectionUrl(e){return e.href.startsWith("https://www.poulpeo.com")&&"/redirection.htm,/redirection/".split(",").some(t=>e.pathname.startsWith(t))}isKrakenToMiwimPoulpeoRedirectionUrl(e){return e.href.startsWith("https://www.poulpeo.com")&&e.pathname.startsWith("/redirection/mwm/")}isGiftCardPoulpeoRedirectionUrl(e){return e.href.startsWith("https://www.poulpeo.com")&&e.pathname.startsWith("/redirection/ifg/")}async getMerchantIdFromPoulpeoRedirectionUrl(e){const t=e.searchParams.get("mid");if(t!==null&&Number.isInteger(+t))return+t;const i=/^\/redirection\/merchant\/(\d+)/.exec(e.pathname);if((i==null?void 0:i[1])!==void 0)return+i[1]}getOfferIdFromPoulpeoRedirectionUrl(e){const t=e.searchParams.get("c");return t!==null?+t:void 0}}class rm{constructor(e,t,n){p(this,"messagingService");p(this,"scriptingService");p(this,"tabsService");this.messagingService=e,this.scriptingService=t,this.tabsService=n}subscribeSelf(e){e==null||e.subscribe("navigationCommitted",this.onNavigationCommitted.bind(this)),e==null||e.subscribe("tabActivated",this.onTabActivated.bind(this))}unsubscribeSelf(e){e==null||e.unsubscribe("navigationCommitted",this.onNavigationCommitted.bind(this)),e==null||e.subscribe("tabActivated",this.onTabActivated.bind(this))}async onNavigationCommitted(e){await this.injectContentScripts(e.details.tabId,e.details.url,"onNavigationCommitted")}async onTabActivated(e){try{await this.messagingService.sendMessageWithReply({type:"ping",payload:{}})}catch{const t=await this.tabsService.getCurrentTab();t.id===e.details.tabId&&t.status==="complete"&&await this.injectContentScripts(t.id,t.url,"onTabActivated")}}async injectContentScripts(e,t,n){try{const i=new URL(t??"");if(i.protocol!=="http:"&&i.protocol!=="https:")return}catch{return}await this.scriptingService.injectContentScripts(e,n)}}class nm{constructor(e){p(this,"cookieDropService");p(this,"eventBus",null);this.cookieDropService=e}getPublishTarget(){return this.eventBus}setPublishTarget(e){this.eventBus=e}subscribeSelf(e){e==null||e.subscribe("affiliationRequestDetected",this.onAffiliationRequestDetected.bind(this)),e==null||e.subscribe("tabRemoved",this.onTabRemoved.bind(this)),e==null||e.subscribe("userLoggedIn",this.onUserLoggedIn.bind(this))}unsubscribeSelf(e){e==null||e.unsubscribe("affiliationRequestDetected",this.onAffiliationRequestDetected.bind(this)),e==null||e.unsubscribe("tabRemoved",this.onTabRemoved.bind(this)),e==null||e.subscribe("userLoggedIn",this.onUserLoggedIn.bind(this))}async onAffiliationRequestDetected(e){await this.cookieDropService.closeCookieDropTab(e.details.affiliationRequest.tabId)}async onTabRemoved(e){await this.cookieDropService.closeCookieDropTab(e.details.tabId)}async onUserLoggedIn(){await this.cookieDropService.resumeAuthenticationPendingCookieDrop()}}class im{constructor(e,t,n,i,a,s,o){p(this,"affiliationRequestService");p(this,"badgeService");p(this,"cashbackActivationService");p(this,"healthCheckService");p(this,"merchantService");p(this,"selectedMerchantService");p(this,"tabsService");p(this,"iconBadgeUpdateTimeout");this.affiliationRequestService=e,this.badgeService=t,this.cashbackActivationService=n,this.healthCheckService=i,this.merchantService=a,this.selectedMerchantService=s,this.tabsService=o}subscribeSelf(e){e==null||e.subscribe("cashbackActivated",this.onCashbackActivated.bind(this)),e==null||e.subscribe("cashbackDeactivated",this.onCashbackDeactivated.bind(this)),e==null||e.subscribe("merchantSelected",this.onMerchantSelected.bind(this)),e==null||e.subscribe("navigationCommitted",this.onNavigationCommitted.bind(this)),e==null||e.subscribe("tabUpdated",this.onTabUpdated.bind(this)),e==null||e.subscribe("userLoggedIn",this.onUserLoggedIn.bind(this)),e==null||e.subscribe("userLoggedOut",this.onUserLoggedOut.bind(this))}unsubscribeSelf(e){e==null||e.unsubscribe("cashbackActivated",this.onCashbackActivated.bind(this)),e==null||e.unsubscribe("cashbackDeactivated",this.onCashbackDeactivated.bind(this)),e==null||e.unsubscribe("merchantSelected",this.onMerchantSelected.bind(this)),e==null||e.unsubscribe("navigationCommitted",this.onNavigationCommitted.bind(this)),e==null||e.unsubscribe("tabUpdated",this.onTabUpdated.bind(this)),e==null||e.unsubscribe("userLoggedIn",this.onUserLoggedIn.bind(this)),e==null||e.unsubscribe("userLoggedOut",this.onUserLoggedOut.bind(this))}async onCashbackActivated(){await this.updateCurrentTabBadge()}async onCashbackDeactivated(){await this.updateCurrentTabBadge()}async onMerchantSelected(){await this.updateCurrentTabBadge()}async onNavigationCommitted(){await this.updateCurrentTabBadge()}async onTabUpdated(e){e.details.tab.active&&e.details.tab.status==="complete"&&await this.updateTabBadge(e.details.tab)}async onUserLoggedIn(){await this.updateCurrentTabBadge()}async onUserLoggedOut(){await this.updateCurrentTabBadge()}async updateCurrentTabBadge(){let e;try{e=await this.tabsService.getCurrentTab()}catch(t){if(t instanceof Error&&t.message==="Unable to read current tab ID")return;throw t}return this.updateTabBadge(e)}async updateTabBadge(e){clearTimeout(this.iconBadgeUpdateTimeout);let t=0;const n=async()=>{try{await this.healthCheckService.checkStorageHealth()}catch(s){await this.badgeService.setBadge({tabId:e.id,text:"ERR",backgroundColor:"#ff1616"}),console.error(s);return}const i=await this.getTabMetadata(e.id,e.url),a=await this.getBadgeDetails(i,++t);await this.badgeService.setBadge({tabId:e.id,...a}),!(!i.isUserSolicitationAllowed||i.selectedMerchant===void 0||t>10)&&(this.iconBadgeUpdateTimeout=setTimeout(()=>{n().catch(console.error)},1e3))};await n()}async getTabMetadata(e,t){let n=!0,i=[],a;try{const s=new URL(t??"");if(s.protocol!=="http:"&&s.protocol!=="https:")throw new Error;if(i=await this.merchantService.getMerchantsByUrl(s.href),n=await this.affiliationRequestService.isUserSolicitationAllowed(i.map(o=>o.id),e),i.length>1){const o=await this.selectedMerchantService.getSelectedMerchantId(e,s)??-1;a=i.find(c=>c.id===o)}else i.length===1&&(a=i[0])}catch{}return{tabId:e,isUserSolicitationAllowed:n,availableMerchants:i,selectedMerchant:a}}async getBadgeDetails(e,t){var c;const{isUserSolicitationAllowed:n,availableMerchants:i,selectedMerchant:a}=e;let s="",o="#fff";if(n){if(a===void 0&&i.length)s="?";else if(a!==void 0){const l=a;l.extensionDetectionAndDisplayStatus&&l.extensionOffersStatus&&(s=`${((c=l.merchantInfo)==null?void 0:c.nbOffers)??"0"}`,_i(l.cashback)&&(await this.cashbackActivationService.getCashbackActivation(a.id)!=null?o="#04f39d":l.extensionIconBlinkStatus&&t%2===0?o="#000000":o="#ffce4a"))}}return{text:s,backgroundColor:o}}}class am{constructor(){p(this,"serviceWorkerTtlInMs",3e4);p(this,"serviceWorkerTerminationWarningThresholdInMs",5e3);p(this,"eventBus",null);p(this,"hasWarningBeenSentSinceLastEventReception");p(this,"lastEventReceptionTimestamp");this.hasWarningBeenSentSinceLastEventReception=!1,this.lastEventReceptionTimestamp=Date.now(),setInterval(()=>{var n;if(this.hasWarningBeenSentSinceLastEventReception)return;const e=this.lastEventReceptionTimestamp+this.serviceWorkerTtlInMs;e-this.serviceWorkerTerminationWarningThresholdInMs-Date.now()>0||((n=this.eventBus)==null||n.publish({type:"serviceWorkerTerminationWarningThresholdReached",details:{estimatedServiceWorkerTerminationTimestampInMs:e}}),this.hasWarningBeenSentSinceLastEventReception=!0)},1e3)}getPublishTarget(){return this.eventBus}setPublishTarget(e){this.eventBus=e}subscribeSelf(e){e==null||e.subscribe("browserActionClicked",this.onBrowserActionClicked.bind(this)),e==null||e.subscribe("extensionInstalled",this.onExtensionInstalled.bind(this)),e==null||e.subscribe("headersReceived",this.onHeadersReceived.bind(this)),e==null||e.subscribe("navigationCommitted",this.onNavigationCommitted.bind(this)),e==null||e.subscribe("navigationHistoryStateUpdated",this.onNavigationHistoryStateUpdated.bind(this)),e==null||e.subscribe("tabCreated",this.onTabCreated.bind(this)),e==null||e.subscribe("tabUpdated",this.onTabUpdated.bind(this)),e==null||e.subscribe("tabRemoved",this.onTabRemoved.bind(this))}unsubscribeSelf(e){e==null||e.unsubscribe("browserActionClicked",this.onBrowserActionClicked.bind(this)),e==null||e.unsubscribe("extensionInstalled",this.onExtensionInstalled.bind(this)),e==null||e.unsubscribe("headersReceived",this.onHeadersReceived.bind(this)),e==null||e.unsubscribe("navigationCommitted",this.onNavigationCommitted.bind(this)),e==null||e.unsubscribe("navigationHistoryStateUpdated",this.onNavigationHistoryStateUpdated.bind(this)),e==null||e.unsubscribe("tabCreated",this.onTabCreated.bind(this)),e==null||e.unsubscribe("tabUpdated",this.onTabUpdated.bind(this)),e==null||e.unsubscribe("tabRemoved",this.onTabRemoved.bind(this))}async onBrowserActionClicked(){return this.resetIdleTimer()}async onExtensionInstalled(){return this.resetIdleTimer()}async onHeadersReceived(){return this.resetIdleTimer()}async onMessageReceived(){return this.resetIdleTimer()}async onNavigationCommitted(){return this.resetIdleTimer()}async onNavigationHistoryStateUpdated(){return this.resetIdleTimer()}async onTabCreated(){return this.resetIdleTimer()}async onTabUpdated(){return this.resetIdleTimer()}async onTabRemoved(){return this.resetIdleTimer()}async resetIdleTimer(){var e;return this.lastEventReceptionTimestamp=Date.now(),this.hasWarningBeenSentSinceLastEventReception&&((e=this.eventBus)==null||e.publish({type:"serviceWorkerTerminationWarningWithdrawn",details:{estimatedServiceWorkerTerminationTimestampInMs:this.lastEventReceptionTimestamp+this.serviceWorkerTtlInMs}}),this.hasWarningBeenSentSinceLastEventReception=!1),Promise.resolve()}}class sm{constructor(e){p(this,"merchantService");p(this,"eventBus",null);this.merchantService=e}getPublishTarget(){return this.eventBus}setPublishTarget(e){this.eventBus=e}subscribeSelf(e){e==null||e.subscribe("navigationCommitted",this.onNavigationCommitted.bind(this))}unsubscribeSelf(e){e==null||e.unsubscribe("navigationCommitted",this.onNavigationCommitted.bind(this))}async onNavigationCommitted(e){await this.detectMerchants(e.details.url)}async detectMerchants(e){var n;const t=await this.merchantService.getMerchantsByUrl(e);for(const i of t)(n=this.eventBus)==null||n.publish({type:"merchantVisited",details:{merchant:i}})}}class om{constructor(){p(this,"eventBus",null)}getPublishTarget(){return this.eventBus}setPublishTarget(e){this.eventBus=e}subscribeSelf(e){e==null||e.subscribe("serviceWorkerTerminationWarningThresholdReached",this.onServiceWorkerTerminationWarningThresholdReached.bind(this))}unsubscribeSelf(e){e==null||e.unsubscribe("serviceWorkerTerminationWarningThresholdReached",this.onServiceWorkerTerminationWarningThresholdReached.bind(this))}async onServiceWorkerTerminationWarningThresholdReached(){return Zl(!0),Promise.resolve()}}class cm{constructor(e,t){p(this,"messagingService");p(this,"tabsService");this.messagingService=e,this.tabsService=t}subscribeSelf(e){e==null||e.subscribe("browserActionClicked",this.onBrowserActionClicked.bind(this)),e==null||e.subscribe("cashbackActivated",this.onCashbackActivated.bind(this)),e==null||e.subscribe("cashbackDeactivated",this.onCashbackDeactivated.bind(this)),e==null||e.subscribe("merchantSelected",this.onMerchantSelected.bind(this)),e==null||e.subscribe("navigationHistoryStateUpdated",this.onNavigationHistoryStateUpdated.bind(this)),e==null||e.subscribe("merchantSelected",this.onMerchantSelected.bind(this)),e==null||e.subscribe("parameterUpdated",this.onParameterUpdated.bind(this)),e==null||e.subscribe("parameterRemoved",this.onParameterRemoved.bind(this)),e==null||e.subscribe("userLoggedIn",this.onUserLoggedIn.bind(this)),e==null||e.subscribe("userLoggedOut",this.onUserLoggedOut.bind(this))}unsubscribeSelf(e){e==null||e.unsubscribe("browserActionClicked",this.onBrowserActionClicked.bind(this)),e==null||e.unsubscribe("cashbackActivated",this.onCashbackActivated.bind(this)),e==null||e.unsubscribe("cashbackDeactivated",this.onCashbackDeactivated.bind(this)),e==null||e.unsubscribe("merchantSelected",this.onMerchantSelected.bind(this)),e==null||e.unsubscribe("navigationHistoryStateUpdated",this.onNavigationHistoryStateUpdated.bind(this)),e==null||e.unsubscribe("parameterUpdated",this.onParameterUpdated.bind(this)),e==null||e.unsubscribe("parameterRemoved",this.onParameterRemoved.bind(this)),e==null||e.unsubscribe("userLoggedIn",this.onUserLoggedIn.bind(this)),e==null||e.unsubscribe("userLoggedOut",this.onUserLoggedOut.bind(this))}async onBrowserActionClicked(){try{const e=await this.tabsService.getCurrentTab();await this.messagingService.sendMessage({type:"toggleSidebarOpenStatus",payload:void 0},{tabId:e.id})}catch{}}async onCashbackActivated(){await this.askSidebarToUpdateItsStore()}async onCashbackDeactivated(){await this.askSidebarToUpdateItsStore()}async onMerchantSelected(){await this.askSidebarToUpdateItsStore()}async onNavigationHistoryStateUpdated(){await this.askSidebarToUpdateItsStore()}async onParameterUpdated(){await this.askSidebarToUpdateItsStore()}async onParameterRemoved(){await this.askSidebarToUpdateItsStore()}async onUserLoggedIn(){await this.askSidebarToUpdateItsStore()}async onUserLoggedOut(){await this.askSidebarToUpdateItsStore()}async askSidebarToUpdateItsStore(){try{const e=await this.tabsService.getCurrentTab();await this.messagingService.sendMessage({type:"updateSidebarStore",payload:void 0},{tabId:e.id})}catch{}}}const nn=r=>async()=>Promise.allSettled(r()).then(e=>{for(const t of e)t.status==="rejected"&&console.error(t.reason)}).catch(console.error);class lm{constructor(e,t){p(this,"alarmService");p(this,"tasksToSchedule");this.alarmService=e,this.tasksToSchedule=t;for(const{alarmName:n,alarmOptions:i,runTask:a}of t)console.debug("TaskScheduler","task scheduled",n,i),e.addAlarmListener(n,async()=>{console.debug("TaskScheduler","task started",n),await a(),console.debug("TaskScheduler","task ended",n)})}subscribeSelf(e){e==null||e.subscribe("extensionInstalled",this.onExtensionInstalled.bind(this))}unsubscribeSelf(e){e==null||e.unsubscribe("extensionInstalled",this.onExtensionInstalled.bind(this))}async onExtensionInstalled(e){const{reason:t,previousVersion:n}=e.details;console.debug(t==="install"?"Extension installed":`Extension updated from ${n??"???"}`);for(const{alarmName:i,alarmOptions:a}of this.tasksToSchedule)this.alarmService.createAlarm(i,a);return Promise.resolve()}}const vi=(r,e)=>{const t=a=>{if(!/^\d+\.\d+\.\d+$/.test(a))throw new Error(`Version ${a} is not in a valid version format`)};t(r),t(e);const n=r.split("."),i=e.split(".");for(let a=0;a<3;a++){const s=Number(n[a]),o=Number(i[a]);if(Number.isNaN(s)||Number.isNaN(o))throw Error(`Cannot extract version number from ${r} or ${e}`);if(s>o)return 1;if(o>s)return-1;if(!Number.isNaN(s)&&Number.isNaN(o))return 1;if(Number.isNaN(s)&&!Number.isNaN(o))return-1}return 0};class um{constructor(e,t){p(this,"localRepository");p(this,"parameterService");this.localRepository=e,this.parameterService=t}async migrateToVersion(e,t,n){console.debug("VersionMigrator","migrateToVersion",`starting migration process from ${e??"0.0.0"} to ${t}`),await this.executeMigrators(e,t,[...n].sort((i,a)=>vi(i.version,a.version)))}async executeMigrators(e,t,n){console.debug("VersionMigrator","executeMigrators",`Executing migrators from ${e??"0.0.0"} to ${t}`);for(const i of n){const a=e===void 0||vi(i.version,e)>0,s=vi(i.version,t)<=0;a&&s&&await this.executeMigrator(e,t,i)}await this.parameterService.updateParameter("extension_version",t)}async executeMigrator(e,t,n){console.debug("VersionMigrator","executeMigrator","Executing migrator",n.version),await n.migrate(e,t,this.localRepository),await this.parameterService.updateParameter("extension_version",n.version)}}const lo={extension_first_usage_tracking:{defaultValue:"pending",validate:r=>r==="pending"||r==="done"},extension_version:{defaultValue:"0.0.0",validate:r=>typeof r=="string"&&/^\d+\.\d+\.\d+$/.test(r)},extension_installation_id:{defaultValue:"aaaaaaaa-aaaa-4aaa-aaaa-aaaaaaaaaaaa",validate:r=>typeof r=="string"&&/[a-f0-9]{8}-?[a-f0-9]{4}-?4[a-f0-9]{3}-?[89ab][a-f0-9]{3}-?[a-f0-9]{12}/i.test(r)},extension_session_id:{defaultValue:"aaaaaaaa-aaaa-4aaa-aaaa-aaaaaaaaaaaa",validate:r=>typeof r=="string"&&/[a-f0-9]{8}-?[a-f0-9]{4}-?4[a-f0-9]{3}-?[89ab][a-f0-9]{3}-?[a-f0-9]{12}/i.test(r)},gift_card_cashback_tab_seen:{defaultValue:!0,validate:r=>typeof r=="boolean"},notification_show_on_merchant_visit:{defaultValue:!0,validate:r=>typeof r=="boolean"},notification_show_in_shopping_cart:{defaultValue:!0,validate:r=>typeof r=="boolean"},notifications_domain_blacklist:{defaultValue:[],validate:r=>Array.isArray(r)&&!r.some(e=>typeof e!="string")},privacy_allow_required_tracking:{defaultValue:!1,validate:r=>typeof r=="boolean"},privacy_allow_performance_tracking:{defaultValue:!1,validate:r=>typeof r=="boolean"},search_engine_show_offers:{defaultValue:!0,validate:r=>typeof r=="boolean"},search_engine_show_similar_merchants:{defaultValue:!0,validate:r=>typeof r=="boolean"},sidebar_opener_location:{defaultValue:"center",validate:r=>typeof r=="string"&&["bottom","center","top"].includes(r)},sidebar_open_method:{defaultValue:"on-click",validate:r=>typeof r=="string"&&["on-click","on-hover"].includes(r)},sidebar_hidden_on_domain_list:{defaultValue:[],validate:r=>Array.isArray(r)?r.every(e=>typeof e=="string"):!1},sidebar_show_strategy:{defaultValue:"merchants-only",validate:r=>typeof r=="string"&&["always","merchants-only","never"].includes(r)},sidebar_show_style:{defaultValue:"standard",validate:r=>typeof r=="string"&&["minimalist","standard"].includes(r)},super_cashback_tab_seen:{defaultValue:!0,validate:r=>typeof r=="boolean"}};class dm extends um{constructor(t,n,i,a,s){super(t,n);p(this,"versionMigratorsProvider");p(this,"actualVersion");p(this,"openOnboardingPage");this.versionMigratorsProvider=i,this.actualVersion=a,this.openOnboardingPage=s}subscribeSelf(t){t==null||t.subscribe("extensionInstalled",this.onExtensionInstalled.bind(this))}unsubscribeSelf(t){t==null||t.unsubscribe("extensionInstalled",this.onExtensionInstalled.bind(this))}async onExtensionInstalled(t){if(await this.initSessionParameters(),!["install","update"].includes(t.details.reason))return;const n=await this.parameterService.getParameter("extension_installation_id"),i=lo.extension_installation_id.defaultValue;n===i&&await this.parameterService.updateParameter("extension_installation_id",crypto.randomUUID());const a=t.details.previousVersion,s=this.actualVersion,o=await this.versionMigratorsProvider.getMigrators();if(await this.migrateToVersion(a,s,o),a!==void 0&&a>="20.0.0")return;const{privacy_allow_required_tracking:c,privacy_allow_performance_tracking:l}=await this.parameterService.getAllParameters();this.openOnboardingPage(c&&l?"success":"").catch(console.error)}async initSessionParameters(){await this.parameterService.updateParameter("extension_session_id",crypto.randomUUID()),await this.parameterService.updateParameter("gift_card_cashback_tab_seen",!1),await this.parameterService.updateParameter("super_cashback_tab_seen",!1)}}function wi(r){const e=r;return r!==null&&typeof r=="object"&&typeof e.type=="string"&&(typeof e.version=="string"||typeof e.version>"u")&&(typeof e.id=="string"||typeof e.id>"u")&&(typeof e.inReplyTo=="string"||typeof e.inReplyTo>"u")}function q(r,e){return wi(r)&&r.type===e}class fm{constructor(e){p(this,"healthCheckService");this.healthCheckService=e}async handleMessage(e){if(q(e,"checkStorageHealth")){if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);return await this.healthCheckService.checkStorageHealth(),{type:"checkStorageHealthReply",inReplyTo:e.id,payload:void 0}}}}class pm{constructor(e){p(this,"cookieDropService");this.cookieDropService=e}async handleMessage(e){if(q(e,"dropCookie")){if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);return await this.cookieDropService.dropCookie(e.payload),{type:"dropCookieReply",inReplyTo:e.id,payload:void 0}}}}class hm{constructor(e){p(this,"parameterService");this.parameterService=e}async handleMessage(e){if(!q(e,"getAllParameters"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const t=await this.parameterService.getAllParameters();return{type:"getAllParametersReply",inReplyTo:e.id,payload:{parameters:t}}}}class mm{constructor(e,t){p(this,"singleUseOfferCodeService");p(this,"userService");this.singleUseOfferCodeService=e,this.userService=t}async handleMessage(e){var n;if(!q(e,"getCachedSingleUseOfferCodes"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const t=await this.singleUseOfferCodeService.getCachedSingleUseCodes(((n=await this.userService.getCurrentUser())==null?void 0:n.fp)??"");return{type:"getCachedSingleUseOfferCodesReply",inReplyTo:e.id,payload:{codes:t}}}}class gm{constructor(e){p(this,"cashbackActivationService");this.cashbackActivationService=e}async handleMessage(e){if(!q(e,"getCashbackActivation"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const t=await this.cashbackActivationService.getCashbackActivation(e.payload.merchantId);return{type:"getCashbackActivationReply",inReplyTo:e.id,payload:{cashbackActivation:t}}}}class ym{constructor(e){p(this,"containerService");this.containerService=e}async handleMessage(e){if(!q(e,"getContainerContent"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const t=await this.containerService.getContainerContentByContainerTechnicalName(e.payload.technicalName,e.payload.contentLengthLimit);return{type:"getContainerContentReply",inReplyTo:e.id,payload:{content:t}}}}class bm{constructor(e){p(this,"couponApplierConfigService");this.couponApplierConfigService=e}async handleMessage(e){if(!q(e,"getCouponApplierConfig"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const t=await this.couponApplierConfigService.getConfigByMerchantId(e.payload.merchantId);return{type:"getCouponApplierConfigReply",inReplyTo:e.id,payload:{config:t}}}}class _m{constructor(e){p(this,"merchantBonusesService");this.merchantBonusesService=e}async handleMessage(e){if(!q(e,"getMerchantBonuses"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const t=await this.merchantBonusesService.getBonusesByMerchantId(e.payload.merchantId);return{type:"getMerchantBonusesReply",inReplyTo:e.id,payload:{bonuses:t}}}}class vm{constructor(e){p(this,"merchantService");this.merchantService=e}async handleMessage(e){if(!q(e,"getMerchantById"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const t=await this.merchantService.getMerchantById(e.payload.merchantId);return{type:"getMerchantByIdReply",inReplyTo:e.id,payload:{merchant:t}}}}class wm{constructor(e){p(this,"offerService");this.offerService=e}async handleMessage(e){if(!q(e,"getMerchantOffers"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const t=await this.offerService.getOffersByMerchantId(e.payload.merchantId);return{type:"getMerchantOffersReply",inReplyTo:e.id,payload:{offers:t}}}}class Sm{constructor(e){p(this,"merchantService");this.merchantService=e}async handleMessage(e){if(!q(e,"getMerchantsByUrl"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const t=await this.merchantService.getMerchantsByUrl(e.payload.url);return{type:"getMerchantsByUrlReply",inReplyTo:e.id,payload:{merchants:t}}}}class km{constructor(e,t,n,i,a,s){p(this,"affiliationRequestService");p(this,"merchantService");p(this,"selectedMerchantService");p(this,"similarMerchantsService");p(this,"userClickService");p(this,"userService");this.affiliationRequestService=e,this.merchantService=t,this.selectedMerchantService=n,this.similarMerchantsService=i,this.userClickService=a,this.userService=s}async handleMessage(e,t){var d;if(!q(e,"getSidebarInitData"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);if((t==null?void 0:t.url)==null)throw new Error("URL must be specified in message sender");const n=await this.userClickService.getLastKnownUserClick(),i=(n==null?void 0:n.isSidebarOpenIntent)===!0&&n.timestamp>Date.now()-60*1e3&&n.tabId!==t.tabId,a=await this.merchantService.getMerchantsByUrl(t.url);let s=a.length<2?(d=a[0])==null?void 0:d.id:await this.selectedMerchantService.getSelectedMerchantId(t.tabId??0,new URL(t.url));s===void 0&&(n==null?void 0:n.merchantSelectionIntent)!==void 0&&(await this.selectedMerchantService.setSelectedMerchantId(t.tabId??0,new URL(t.url),n.merchantSelectionIntent),s=n.merchantSelectionIntent);const o=a.findIndex(f=>f.id===s),c=await this.userService.getCurrentUser(),l=s!==void 0&&s!==-1?await this.similarMerchantsService.getSimilarMerchantsByMerchantId(s):[],u=await this.affiliationRequestService.isUserSolicitationAllowed(a.map(f=>f.id),t.tabId??-1);return{type:"getSidebarInitDataReply",inReplyTo:e.id,payload:{isOpen:i,isUserSolicitationAllowedByReferrer:u,availableMerchants:a,selectedMerchantIndex:o,similarMerchants:l,user:c}}}}class Em{constructor(e){p(this,"similarMerchantsService");this.similarMerchantsService=e}async handleMessage(e){if(!q(e,"getSimilarMerchants"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const t=await this.similarMerchantsService.getSimilarMerchantsByMerchantId(e.payload.merchantId);return{type:"getSimilarMerchantsReply",inReplyTo:e.id,payload:{merchants:t}}}}class xm{constructor(e,t){p(this,"singleUseOfferCodeService");p(this,"userService");this.singleUseOfferCodeService=e,this.userService=t}async handleMessage(e){var n;if(!q(e,"getSingleUseOfferCode"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const t=await this.singleUseOfferCodeService.getSingleUseCode(e.payload.offerId,((n=await this.userService.getCurrentUser())==null?void 0:n.fp)??"",!1);return{type:"getSingleUseOfferCodeReply",inReplyTo:e.id,payload:{code:t}}}}class Am{constructor(e){p(this,"trustpilotReviewsService");this.trustpilotReviewsService=e}async handleMessage(e){if(!q(e,"getTrustpilotReviews"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const t=await this.trustpilotReviewsService.getTrustpilotReviews(+e.payload.limit,+(e.payload.offset??0));return{type:"getTrustpilotReviewsReply",inReplyTo:e.id,payload:{trustpilotReviews:t}}}}class Cm{constructor(e){p(this,"openExtensionPage");this.openExtensionPage=e}async handleMessage(e){if(q(e,"openExtensionPage")){if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);return await this.openExtensionPage(e.payload.pageName,e.payload.anchor),{type:"openExtensionPageReply",inReplyTo:e.id,payload:void 0}}}}class Tm{constructor(e){p(this,"userClickService");this.userClickService=e}async handleMessage(e,t){if(q(e,"registerUserClick")){if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);return await this.userClickService.saveUserClick({tabId:(t==null?void 0:t.tabId)??0,timestamp:e.payload.timestamp,isSidebarOpenIntent:e.payload.isSidebarOpenIntent,merchantSelectionIntent:e.payload.merchantSelectionIntent}),{type:"registerUserClickReply",inReplyTo:e.id,payload:void 0}}}}class Im{constructor(e){p(this,"notificationService");this.notificationService=e}async handleMessage(e){if(!q(e,"requestNotificationLock"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const{notificationId:t,lockDurationInMs:n}=e.payload;let i=!1;return this.notificationService.isValidNotificationId(t)&&(i=await this.notificationService.requestNotificationLock(t,+n||-1)),{type:"requestNotificationLockReply",inReplyTo:e.id,payload:{requestAccepted:i}}}}class Rm{constructor(e,t,n){p(this,"runtimeId");p(this,"runtimeVersion");p(this,"parameterService");this.runtimeId=e,this.runtimeVersion=t,this.parameterService=n}async handleMessage(e,t){if(!q(e,"sendCouponApplierTrackingEvent"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const n={type:"sendCouponApplierTrackingEventReply",inReplyTo:e.id,payload:{sent:!1}};if(!await this.isCouponApplierAnalyticsDataSendingAllowed())return n;const{category:i,couponApplierVersion:a,couponApplierConfigId:s,couponApplierConfigStoreId:o,bestCouponCode:c,bestCouponDiscount:l,shoppingCartTotal:u}=e.payload;try{await fetch("https://analytics.besttoolbars.net/api/v1/activity/poulpeo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:i.toUpperCase(),type:"caa",url:t==null?void 0:t.url,caa:{version:a,coupon:i==="success"?c:void 0},price:{saved:i==="success"?Number.parseFloat((l??0).toFixed(2)):void 0,total:u},button:{id:this.runtimeId,version:this.runtimeVersion},store:{id:o,name:null},config:{id:s,type:"caa"}})})}catch(d){return console.error(new Error("Failed to send Coupon Applier tracking event"),fe(d,"<redacted>")),n}return n.payload.sent=!0,n}async isCouponApplierAnalyticsDataSendingAllowed(){return this.parameterService.getParameter("privacy_allow_performance_tracking")}}function Si({merchantId:r,offerId:e}){const t=new URL("https://www.poulpeo.com");return t.pathname="/redirection.htm",t.searchParams.append("mid",`${r}`),e!==void 0&&t.searchParams.append("c",`${e}`),t.searchParams.append("d","1"),t.searchParams.append("e","1"),t}class Pm{constructor(e,t,n){p(this,"merchantRulesService");p(this,"selectedMerchantService");p(this,"tabsService");this.merchantRulesService=e,this.selectedMerchantService=t,this.tabsService=n}async handleMessage(e,t){if(!q(e,"setSelectedMerchantId"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const n=e.payload.url??(t==null?void 0:t.url);if(n==null)throw new Error("URL must be specified in message payload or sender");const i=(t==null?void 0:t.tabId)??0,a=e.payload.merchantId;if(await this.selectedMerchantService.setSelectedMerchantId(i,new URL(n),a),a!==void 0&&a>0){const s=await this.merchantRulesService.findMerchantsMatchingUrl(n,!1),o=await this.merchantRulesService.findMerchantsMatchingUrl(n,!0);if(s.length>1&&(o.length>1||!o.includes(a))){const c=Si({merchantId:a});this.tabsService.update((t==null?void 0:t.tabId)??0,{active:i===(await this.tabsService.getCurrentTab()).id,url:c.href}).catch(console.error)}}return{type:"setSelectedMerchantIdReply",inReplyTo:e.id,payload:void 0}}}class Om{constructor(e){p(this,"notificationService");this.notificationService=e}async handleMessage(e){if(!q(e,"trackNotificationEvent"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const{eventType:t,notificationId:n}=e.payload;return this.notificationService.isValidNotificationEventType(t)&&this.notificationService.isValidNotificationId(n)&&this.notificationService.trackNotificationEvent(t,n),Promise.resolve({type:"trackNotificationEventReply",inReplyTo:e.id,payload:void 0})}}class Nm{constructor(e){p(this,"trackingServices");this.trackingServices=e}async handleMessage(e){if(!q(e,"trackShoppingCartPageDetectionSuccess"))return;if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);const{merchant:t,detectionMethod:n}=e.payload;return typeof t=="object"&&typeof n=="string"&&await Promise.all(this.trackingServices.map(async i=>i.trackBackgroundEvent({type:"shoppingCartPageDetected",details:e.payload}))),{type:"trackShoppingCartPageDetectionSuccessReply",inReplyTo:e.id,payload:void 0}}}class Mm{constructor(e){p(this,"trackingServices");this.trackingServices=e}async handleMessage(e){if(q(e,"trackUserInterfaceEvent")){if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);return await Promise.all(this.trackingServices.map(async t=>t.trackUserInterfaceEvent(e.payload.eventType,e.payload.taggingData))),{type:"trackUserInterfaceEventReply",inReplyTo:e.id,payload:void 0}}}}class Dm{constructor(e){p(this,"parameterService");this.parameterService=e}async handleMessage(e){if(q(e,"updateParameter")){if(e.id===void 0)throw new Error(`No ID set for runtime message ${e.type}`);return await this.parameterService.updateParameter(e.payload.name,e.payload.value),{type:"updateParameterReply",inReplyTo:e.id,payload:void 0}}}}class Um{constructor(){p(this,"queue");p(this,"locked");this.queue=[],this.locked=!1}isLocked(){return this.locked}lock(){this.locked=!0}unlock(){this.locked=!1}addToQueue(e){this.queue.push(e)}isEmpty(){return this.queue.length===0}shift(){return this.queue.shift()}}class jm{constructor({abortOnThrow:e=!1,timeout:t=5e3}={}){p(this,"queueList");p(this,"timeout");p(this,"abortOnThrow");this.queueList=new Map,this.abortOnThrow=e,this.timeout=t}async addToQueue(e,t,{context:n,args:i}){await this.requestLock(e);const a=this.timeout>0?setTimeout(()=>{this.removeLock(e)},this.timeout):void 0;try{const s=await t.apply(n,i??[]);return this.removeLock(e),s}catch(s){throw this.abortOnThrow?this.queueList.delete(e):this.removeLock(e),s}finally{a!==void 0&&clearTimeout(a)}}async requestLock(e){this.queueList.has(e)||this.queueList.set(e,new Um);const t=this.queueList.get(e);if(t===void 0)throw Error(`Cannot request a lock for queue with key ${e}`);return new Promise(n=>{t.isLocked()?t.addToQueue(n):(t.lock(),n())})}removeLock(e){const t=this.queueList.get(e);if(t!==void 0)if(t.unlock(),t.isEmpty())this.queueList.delete(e);else{const n=t.shift();if(n===void 0)throw Error("Can't find a resolver in queue");t.lock(),n()}}}const $m=async r=>{const e=new TextEncoder().encode(r),t=await crypto.subtle.digest("SHA-1",e);return[...new Uint8Array(t)].reduce((n,i)=>n+i.toString(16).padStart(2,"0"),"")},oe=({timeout:r=5e3,allowConcurrentCallWhenDifferentArgs:e=!1,abortOnThrow:t=!1}={})=>(n,i,a)=>{const s=a.value;if(typeof s!="function")throw new Error("Synchronize decorator must be set on a function");const o=new jm({abortOnThrow:t,timeout:r});a.value=async function(...c){const l=await(e?$m(JSON.stringify(c)):Promise.resolve("uniq"));return o.addToQueue(l,s,{context:this,args:c})}};var Lm=Object.defineProperty,Fm=Object.getOwnPropertyDescriptor,Vm=(r,e,t,n)=>{for(var i=Fm(e,t),a=r.length-1,s;a>=0;a--)(s=r[a])&&(i=s(e,t,i)||i);return i&&Lm(e,t,i),i};class uo{constructor(e){p(this,"repository");p(this,"allNetworksKey","all-networks");this.repository=e}async getAffiliateNetworks(){let e=await this.repository.get(this.allNetworksKey);return e===void 0&&(e=await this.fetchAffiliateNetworks(),await this.repository.set(this.allNetworksKey,e)),e}async getAffiliateNetworkById(e){return(await this.getAffiliateNetworks()).find(n=>n.id===e)}async getAffiliateNetworkByDomain(e){return(await this.getAffiliateNetworks()).find(n=>n.domains.some(i=>{const a=i.replace("www.","").replace("www1.","");return e===a||e.endsWith(`.${a}`)}))}async updateAffiliateNetworksCache(){const e=await this.fetchAffiliateNetworks();return this.repository.set(this.allNetworksKey,e)}async fetchAffiliateNetworks(){const e=await ye["/affiliateNetworks/all"].get({});if(!e.ok)throw new Error("Unable to fetch affiliate networks");const t=await e.json();return Array.isArray(t.data)?t.data.map(n=>{var i,a,s;return{id:n.id??"",name:((i=n.attributes)==null?void 0:i.name)??"",domains:((a=n.attributes)==null?void 0:a.domains)??[],allowsUserSolicitation:!((s=n.attributes)!=null&&s.forbiddenDomainsStatus)}}):[]}}Vm([oe({abortOnThrow:!0})],uo.prototype,"getAffiliateNetworks");class qm{constructor(e){p(this,"affiliationRequestRepository");this.affiliationRequestRepository=e}async getLastKnownAffiliationRequest(e){return this.affiliationRequestRepository.get(`${e}`)}async saveAffiliationRequest(e){return this.affiliationRequestRepository.set(`${e.merchantId}`,e)}async deleteExpiredAffiliationRequests(){const e=await this.affiliationRequestRepository.keys();return Promise.all(e.map(async t=>{const n=await this.affiliationRequestRepository.get(t);if(n!==void 0&&this.isExpired(n))return this.affiliationRequestRepository.remove(t)})).then(()=>{})}isExpired(e){return e.timestamp<Date.now()-36e5}async isUserSolicitationAllowed(e,t){return!(await Promise.all(e.map(async i=>this.getLastKnownAffiliationRequest(i)))).some(i=>i!==void 0&&i.tabId===t&&i.isFromAffiliateRefusingExtDisplay&&!i.isFromPoulpeoCashbackService)}}class Wm{constructor(e,t,n,i,a){p(this,"cashbackActivationRepository");p(this,"cookieDropService");p(this,"merchantService");p(this,"scriptingService");p(this,"tabsService");p(this,"eventBus",null);this.cashbackActivationRepository=e,this.cookieDropService=t,this.merchantService=n,this.scriptingService=i,this.tabsService=a}getPublishTarget(){return this.eventBus}setPublishTarget(e){this.eventBus=e}async activateCashback(e){console.debug("CashbackActivationService","activateCashback",e),await this.cookieDropService.dropCookie({merchantId:e,activateCashback:!0})}async saveCashbackActivation(e){var n;console.debug("CashbackActivationService","saveCashbackActivation",e);const t={merchantId:e,timestamp:Date.now()};await this.cashbackActivationRepository.set(`${e}`,t),(n=this.eventBus)==null||n.publish({type:"cashbackActivated",details:{cashbackActivation:t}})}async cancelCashbackActivation(e,t){var n;console.debug("CashbackActivationService","cancelCashbackActivation",e,t),await this.cashbackActivationRepository.remove(`${e}`),(n=this.eventBus)==null||n.publish({type:"cashbackDeactivated",details:{merchantId:e,reason:t}})}async cancelCashbackActivations(e){console.debug("CashbackActivationService","cancelCashbackActivations");const t=await this.cashbackActivationRepository.keys();await Promise.all(t.map(async n=>{const i=await this.cashbackActivationRepository.get(n);i!==void 0&&await this.cancelCashbackActivation(i.merchantId,e)}))}async promptForCashbackReactivation(e,t){var o,c,l;const n=await this.merchantService.getMerchantById(e);if(n.extensionDetectionAndDisplayStatus===!1)return;const i=await this.tabsService.getCurrentTab(),a=`L'Extension Poulpeo a perdu votre trace :(

      Il semble que votre cashback ${n.name} soit dsactiv.
      Pour continuer l'aventure ensemble, nous vous invitons  le ractiver.

      Voulez-vous ractiver votre cashback ?`.replaceAll(/\n +/g,`
`);let s=!1;try{s=await this.scriptingService.executeConfirm(i.id,a)}catch(u){if(t!==void 0)s=await this.scriptingService.executeConfirm(t,a);else throw u}if((o=this.eventBus)==null||o.publish({type:"cashbackReactivationSuggested",details:{merchant:n}}),!s){(c=this.eventBus)==null||c.publish({type:"cashbackReactivationAccepted",details:{merchant:n}});return}return(l=this.eventBus)==null||l.publish({type:"cashbackReactivationRefused",details:{merchant:n}}),this.activateCashback(e)}async getCashbackActivation(e){const t=await this.cashbackActivationRepository.get(`${e}`),n=t!==void 0&&!this.isExpired(t);return console.debug("CashbackActivationService","getCashbackActivation",e,n),t!==void 0&&!n&&await this.cancelCashbackActivation(e,"expired"),t}async deleteExpiredCashbackActivations(){const e=await this.cashbackActivationRepository.keys();return Promise.all(e.map(async t=>{const n=await this.cashbackActivationRepository.get(t);n!==void 0&&this.isExpired(n)&&await this.cancelCashbackActivation(n.merchantId,"expired")})).then(()=>{})}isExpired(e){return e.timestamp<Date.now()-36e5}}var ki=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fo(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var po={exports:{}};(function(r){function e(){}e.version="24.2.1",e.gif="https://col.poulpeo.io/__rmn.gif",e.configuration={},e.pvid=i(),e.init=function(a){typeof a>"u"&&(a={}),e.readExternalCampaign(),e.readInternalCampaign();var s=e.readCampaignCookieValues("__rmnz"),o=e.readCampaignCookieValues("__rmnc"),c=e.readFingerprint(),l=typeof a.cmpId>"u"?"":a.cmpId,u=typeof a.cmpNme>"u"?"":a.cmpNme;l===""&&(l=typeof o.cmpId>"u"?"":o.cmpId,u=typeof o.icn>"u"?"":o.icn),e.configuration={od_tmd:a.mnTmd,od_cid:a.mnClid,od_srv:a.mnSrv,od_mid:a.mId,od_mnm:a.mNme,od_catid:a.cId,od_catnm:a.cNme,od_oid:a.oId,od_onm:a.oNme,od_ctx:a.aCtx,od_scrsz:window.screen.height+"x"+window.screen.width,od_v:e.version,od_fp:c,od_vpt:a.mnPla,od_act:a.mnAct,od_uid:a.uId,od_tag:a.mnTag,od_gg_utmz:a.hZ,od_gg_utmcsr:a.hSrc,od_gg_utmccn:a.hCmp,od_gg_utmcmd:a.hMed,od_gg_utmctr:a.hKw,od_gg_utmcct:a.hCon,od_gg_utma:a.hA,od_gg_utm_visit:a.hVis,od_gg_utm_session:a.hSess,od_ip:a.uIp,od_oref:a.hRef,od_olpg:a.hOriLan,od_lpg:a.hLan,od_sref:a.hSes,od_cpgt:a.cmpTyp,od_cpgid:l,od_cpgnm:u,od_nlid:a.cmpNew,od_expid:a.tId,od_expv:a.tVer,od_ckpg:a.hCkp,od_utmcmd:s.utmcmd,od_utmcsr:s.utmcsr,od_utmccn:s.utmccn,od_utmctr:s.utmctr,od_utmcct:s.utmcct,od_icm:o.icm,od_ics:o.ics,od_icn:o.icn,od_icl:o.icl,od_ici:o.ici,od_apv:a.aPvs,od_aid:a.aAid,od_ntp:a.nTp,od_pos:a.oPsn,od_pvtyp:a.pvTyp,od_pvid:e.pvid,od_pid:a.pId,od_pcid:a.pcId,od_cbid:a.cbId,od_tcs:a.tcS,od_tkgc:a.tkgC,od_idfv:a.vndId},e.crossFingerPrintDetecting()},e.h=function(a){return typeof a=="string"&&a.length>0?window.encodeURIComponent(a):a||""},e.getParameters=function(a,s,o){var c=[];if(c.push("od_etp="+e.h(a)),c.push("od_v="+e.h(e.version)),typeof s=="object")for(var l=0;l<s.length;l++)c.push("od_eid[]="+e.h(s[l]));else c.push("od_eid="+e.h(s));c.push("od_enm="+e.h(o));var u;for(u in e.configuration)u!="od_evtd"&&u!="od_ugt"&&u!="od_v"&&c.push(u+"="+e.h(e.configuration[u]));return c},e.trackEvent=function(a,s,o){var c=e.getParameters(a,s,o);c.push("rand="+Math.random());var l=new Image;l.src=e.gif+"?"+c.join("&")},e.trackPageView=function(){var a=window.location,s=a.pathname+a.search;e.trackEvent("pageview","",s)},e.trackCouponViews=function(a){e.trackEvent("coupons_views",a,"")},e.trackProductCardViews=function(a){e.trackEvent("product_card_views",a,"")},e.trackCashbackViews=function(a){e.trackEvent("cashback_views",a,"")},e.trackClickout=function(a,s,o){(a=="coupon"||a=="merchant"||a=="product_card"||a=="cashback")&&e.trackEvent("click_"+a,s,o)},e.trackClickCopyCode=function(a,s,o){e.configuration.od_oid=a,e.configuration.od_pos=o,e.trackEvent("click_copy_code",s,"")},e.trackAlert=function(a){e.trackEvent("alert",a,"")},e.trackAlertUnsubscribe=function(a){e.trackEvent("alert_unsubscribe",a,"")},e.trackAccount=function(a){e.trackEvent("account",a,"")},e.trackDisableAccount=function(a){e.trackEvent("account_disable",a,"")},e.trackAuthentification=function(a){e.trackEvent("authentification",a,"")},e.trackSearch=function(a){e.trackEvent("search",a,"")},e.trackReviewCoupon=function(a){e.trackEvent("review_coupon",a,"")},e.trackReviewMerchant=function(a){e.trackEvent("review_merchant",a,"")},e.trackActivationGeolocation=function(){e.trackEvent("geolocation_active","","")},e.trackInactivationGeolocation=function(){e.trackEvent("geolocation_inactive","","")},e.trackCrossDevice=function(a){e.trackEvent("cross_device_detected",a,"")},e.trackInternalCampaign=function(a,s,o,c,l,u){e.configuration.od_icm=a,e.configuration.od_ics=s,e.configuration.od_icn=o,e.configuration.od_icl=c,e.configuration.od_ici=l,e.trackEvent("internal_campaign","",""),u||e.createInternalCampaignCookie(a,s,o,c,l)},e.trackCampaignSent=function(a,s){e.setCampaignParameters(a,s),e.trackEvent("campaign_sent",a,s)},e.trackCampaignView=function(a,s){e.setCampaignParameters(a,s),e.trackEvent("campaign_view",a,s)},e.trackCampaignClick=function(a,s,o,c){e.setCampaignParameters(a,s),e.trackEvent("campaign_click",a,s),e.createInternalCampaignCookie(o,c,s,"(none)","(none)",a)},e.trackPostEvent=function(a,s){e.trackEvent("trigger",s,"post_"+a)},e.setCampaignParameters=function(a,s){e.configuration.od_cpgid=a,e.configuration.od_cpgnm=s},e.readInternalCampaign=function(){var a=!1,s=document.location.search;if(s){var o=e.parameterValue(s,"utm_medium"),c=e.parameterValue(s,"utm_source"),l=e.parameterValue(s,"utm_campaign"),u=e.parameterValue(s,"campaign_id");o&&c&&l&&u&&(e.createInternalCampaignCookie(o,c,l,"(none)","(none)",u),a=!0)}return a},e.createInternalCampaignCookie=function(a,s,o,c,l,u){o=typeof o<"u"?o:"",c=typeof c<"u"?c:"",l=typeof l<"u"?l:"",u=typeof u<"u"?u:"";var d=new Date;d.setTime(d.getTime()+36e5);var f="expires="+d.toUTCString();document.cookie="__rmnc=icm="+a+"|ics="+s+"|icn="+o+"|icl="+c+"|ici="+l+"|cmpId="+u+"; "+f+"; domain="+e.domain()+"; path=/"},e.readExternalCampaign=function(){var a=!1,s=document.referrer;if(!s||s=="")s="-";else{var o=document.domain,c=s.indexOf(o);c>=0&&c<=8&&(s="0"),s.indexOf("[")==0&&s.lastIndexOf("]")==s.length-1&&(s="-")}var l=new Date(new Date().getTime()+15768e3*1e3).toUTCString()+";",u=e.campaignInfos(s);if(u!="-"&&u!="")a=!0;else{var d=e.readCookie("__rmnz"),f=d.indexOf("|utmpvid");u=f!==-1?d.substr(0,f):d}return document.cookie="__rmnz="+u+"|utmpvid="+e.pvid+"; expires="+l+"; domain ="+e.domain()+"; path=/",a},e.readCampaignCookieValues=function(a){var s={},o=e.readCookie(a);if(o)for(var c=o.split("|"),l=0;l<c.length;l++){var u=c[l].split("=");s[u[0]]=u[1]}return s},e.readCookie=function(a){for(var s=a+"=",o=document.cookie.split(";"),c=0;c<o.length;c++){for(var l=o[c];l.charAt(0)==" ";)l=l.substring(1,l.length);if(l.indexOf(s)==0)return l.substring(s.length,l.length)}};var t=[],n=[];t[0]="4daum",n[0]="q",t[1]="eniro",n[1]="search_word",t[2]="naver",n[2]="query",t[3]="pchome",n[3]="q",t[4]="images.google",n[4]="q",t[5]="google",n[5]="q",t[6]="yahoo",n[6]="p",t[7]="yahoo",n[7]="q",t[8]="msn",n[8]="q",t[9]="bing",n[9]="q",t[10]="aol",n[10]="query",t[11]="aol",n[11]="q",t[12]="lycos",n[12]="q",t[13]="lycos",n[13]="query",t[14]="ask",n[14]="q",t[15]="cnn",n[15]="query",t[16]="virgilio",n[16]="qs",t[17]="baidu",n[17]="wd",t[18]="baidu",n[18]="word",t[19]="alice",n[19]="qs",t[20]="yandex",n[20]="text",t[21]="najdi",n[21]="q",t[22]="seznam",n[22]="q",t[23]="rakuten",n[23]="qt",t[24]="biglobe",n[24]="q",t[25]="goo.ne",n[25]="MT",t[26]="search.smt.docomo",n[26]="MT",t[27]="onet",n[27]="qt",t[28]="onet",n[28]="q",t[29]="kvasir",n[29]="q",t[30]="terra",n[30]="query",t[31]="rambler",n[31]="query",t[32]="conduit",n[32]="q",t[33]="babylon",n[33]="q",t[34]="search-results",n[34]="q",t[35]="avg",n[35]="q",t[36]="comcast",n[36]="q",t[37]="incredimail",n[37]="q",t[38]="startsiden",n[38]="q",t[39]="go.mail.ru",n[39]="q",t[40]="centrum.cz",n[40]="q",t[41]="360.cn",n[41]="q",t[42]="sogou",n[42]="query",t[43]="tut.by",n[43]="query",t[44]="globo",n[44]="q",t[45]="ukr",n[45]="q",t[46]="so.com",n[46]="q",t[47]="haosou.com",n[47]="q",t[48]="auone",n[48]="q",e.campaignInfos=function(a){var s=document.location.search,o="",c=e.parameterValue(s,"utm_medium"),l=e.parameterValue(s,"utm_source");if(c!="-"&&c!=""&&l!="-"&&l!=""){o+="utmcmd="+e.h(c)+"|utmcsr="+e.h(l);var u=e.parameterValue(s,"utm_campaign");u!="-"&&u!=""?o+="|utmccn="+e.h(u):o+="|utmccn=(not+set)";var d=e.parameterValue(s,"utm_term");d!="-"&&d!=""?o+="|utmctr="+e.h(d):(d=e.organicTraffic(a,!0),d!="-"&&d!=""&&(o+="|utmctr="+e.h(d)));var f=e.parameterValue(s,"utm_content");f!="-"&&f!=""&&(o+="|utmcct="+e.h(f))}if((o=="-"||o=="")&&(o=e.organicTraffic(a,!1)),(o=="-"||o=="")&&(o=e.referral(a)),o=="-"||o==""){var h=document.cookie.indexOf("__rmnz=utm")>-1;h||(o="utmccn=(direct)|utmcsr=(direct)|utmcmd=(none)")}return o},e.parameterValue=function(a,s){if(!a||a==""||!s||s=="")return"";var o,c,l="";return o=a.indexOf(s+"="),o>-1&&(c=a.indexOf("&",o),c<0&&(c=a.length),l=a.substring(o+s.length+1,c),l=decodeURIComponent(l)),l},e.organicTraffic=function(a,s){if(a=="0"||a==""||a=="-")return"";var o,c=a.indexOf("://");if(c<0)return"";o=a.substring(c+3,a.length),o.indexOf("/")>-1&&(o=o.substring(0,o.indexOf("/")));for(var l=0;l<t.length;l++)if(o.toLowerCase().indexOf(t[l].toLowerCase())>-1){var u=n[l],d=-1,f=-1;if((d=a.indexOf("?"+u+"="))>-1||(d=a.indexOf("&"+u+"="))>-1){var h=a.substring(d+u.length+2,a.length);return(f=h.indexOf("&"))>-1&&(h=h.substring(0,f)),s?e.h(h):"utmccn=(organic)|utmcsr="+e.h(t[l])+"|utmctr="+e.h(h)+"|utmcmd=organic"}else return"utmccn=(organic)|utmcsr="+e.h(t[l])+"|utmctr=("+e.h("not provided")+")|utmcmd=organic"}return""},e.referral=function(a){if(a=="0"||a==""||a=="-")return"";var s,o,c=a.indexOf("://");return c<0?"":(s=a.substring(c+3,a.length),s.indexOf("/")>-1&&(o=s.substring(s.indexOf("/"),s.length),o.indexOf("?")>-1&&(o=o.substring(0,o.indexOf("?"))),s=s.substring(0,s.indexOf("/"))),s=s.toLowerCase(),s.indexOf("www.")==0&&(s=s.substring(4,s.length)),"utmccn=(referral)|utmcsr="+e.h(s)+"|utmcct="+e.h(o)+"|utmcmd=referral")},e.domain=function(){var a=document.domain;return a.substring(0,4)=="www."&&(a=a.substring(4,a.length)),a=a.toLowerCase(),a},e.crossFingerPrintDetecting=function(){var a=e.readCookie("fp"),s=e.parameterValue(document.location.search,"orgfp");s!=""&&s!=a&&a!=""&&e.trackCrossDevice(s)},e.readFingerprint=function(){var a=e.readCookie("fp");return a||(a=e.generateFingerprint(),e.writeFingerprint(a)),a},e.writeFingerprint=function(a){var s=new Date;s.setMonth(s.getMonth()+13);var o="expires="+s.toUTCString();document.cookie="fp="+a+"; "+o+"; domain="+e.domain()+"; path=/"},e.generateFingerprint=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var s=Math.random()*16|0,o=a=="x"?s:s&3|8;return o.toString(16)})};function i(a,s){typeof a>"u"&&(a="");var o,c=function(d,f){return d=parseInt(d,10).toString(16),f<d.length?d.slice(d.length-f):f>d.length?Array(1+(f-d.length)).join("0")+d:d},l=typeof window<"u"?window:ki;l.$locutus=l.$locutus||{};var u=l.$locutus;return u.php=u.php||{},u.php.uniqidSeed||(u.php.uniqidSeed=Math.floor(Math.random()*123456789)),u.php.uniqidSeed++,o=a,o+=c(parseInt(new Date().getTime()/1e3,10),8),o+=c(u.php.uniqidSeed,5),o}(function(a,s){r.exports?r.exports=s():a.RMNTracking=s()})(typeof self<"u"?self:ki,function(){return e})})(po);var Hm=po.exports;const $t=fo(Hm);function Zm(r){return r!==null&&typeof r=="object"&&typeof r.type=="string"}function Re(r,e){return Zm(r)&&r.type===e}function rr(r){const e=r.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g);return e!==null?e.map(t=>t.toLowerCase()).join("_"):r}const Ei=(r,e)=>{const[t,n,...i]=r.split("|"),a=rr(t),s=[{eventType:`browser_extension_${a}_notification_${e}`,eventId:i,eventName:n}];return a==="coupon_applier_available"&&(e==="click"&&(s.push({eventType:"browser_extension_prompt_basket_validated"}),s.push({eventType:"autotest_activation"})),e==="close"&&s.push({eventType:"browser_extension_prompt_basket_dismissed"}),e==="show"&&(s.push({eventType:"browser_extension_prompt_basket_show"}),s.push({eventType:"autotest_view"}))),s},xi={cashbackReactivationAccepted:r=>{if(Re(r,"cashbackReactivationAccepted"))return[{eventType:"browser_extension_cashback_reactivation_acceptation",entities:{merchant:r.details.merchant}},{eventType:"browser_extension_prompt_cashback_deactivation_reactivate_cashback",entities:{merchant:r.details.merchant}}]},cashbackReactivationRefused:r=>{if(Re(r,"cashbackReactivationRefused"))return[{eventType:"browser_extension_cashback_reactivation_refusal",entities:{merchant:r.details.merchant}}]},cashbackReactivationSuggested:r=>{if(Re(r,"cashbackReactivationSuggested"))return[{eventType:"browser_extension_cashback_reactivation_suggestion",entities:{merchant:r.details.merchant}},{eventType:"browser_extension_prompt_cashback_deactivation_show",entities:{merchant:r.details.merchant}}]},extensionInstalled:r=>{if(Re(r,"extensionInstalled"))return["install","update"].includes(r.details.reason)?[{eventType:r.details.reason==="install"?"browser_extension_install":"browser_extension_update"}]:[]},merchantVisited:r=>{if(Re(r,"merchantVisited"))return[{eventType:"browser_extension_merchant_visit",entities:{merchant:r.details.merchant}}]},notificationClicked:r=>{if(Re(r,"notificationClicked"))return Ei(r.details.notificationId,"click")},notificationClosed:r=>{if(Re(r,"notificationClosed"))return Ei(r.details.notificationId,"close")},notificationShown:r=>{if(Re(r,"notificationShown"))return Ei(r.details.notificationId,"show")},parameterUpdated:r=>{if(!Re(r,"parameterUpdated"))return;const{parameter:e,value:t}=r.details,n=[];if(!(e==="extension_installation_id"||e==="extension_session_id"||e==="extension_version"||e==="extension_first_usage_tracking"||e==="gift_card_cashback_tab_seen"||e==="super_cashback_tab_seen"))if(typeof t=="boolean"){const i=t?"true":"false";n.push(`browser_extension_${e}_parameter_value_update_to_${i}`)}else if(typeof t=="string"){const i=rr(t);n.push(`browser_extension_${e}_parameter_value_update_to_${i}`)}else n.push(`browser_extension_${e}_parameter_value_update`);return e==="notification_show_in_shopping_cart"&&(n.push(`browser_extension_autotest_available_notifications_${t===!0?"activate":"deactivate"}`),n.push(`browser_extension_cashback_deactivation_notifications_${t===!0?"activate":"deactivate"}`),n.push(`browser_extension_cashback_increase_notifications_${t===!0?"activate":"deactivate"}`)),e==="search_engine_show_offers"&&n.push(`browser_extension_serp_snippet_${t===!0?"activate":"deactivate"}`),e==="sidebar_show_style"&&n.push(`browser_extension_sb_${t!=="never"?"activate":"deactivate"}`),n.map(i=>({eventType:i}))},shoppingCartPageDetected:r=>Re(r,"shoppingCartPageDetected")?[{eventType:`browser_extension_shopping_cart_page_detection_using_${rr(r.details.detectionMethod)}`,entities:{merchant:r.details.merchant}}]:void 0},Ai={cashback_offer_impression:r=>{const{cashbackOffer:e}=r.linkedEntities;if(e!==void 0)return[{eventType:"cashback_views",eventId:e.id.toString(),eventName:"",ntpSuffix:`.co:${e.id}`}]},highlight_campaign_click:r=>{const{highlightCampaign:e,merchant:t,offer:n}=r.linkedEntities;if(e===void 0)return;let i="";return e.dataSpecificUrl?i=`.u:${e.dataSpecificUrl}`:t!==void 0?i=`.m:${t.id}`:n!==void 0&&(i=`.o:${n.id}`),[{eventType:"campaign_click",eventId:e.trackingParameters.campaignId,eventName:e.trackingParameters.campaignName,ntpSuffix:i}]},highlight_campaign_impression:r=>{const{highlightCampaign:e,merchant:t,offer:n}=r.linkedEntities;if(e===void 0)return;let i="";return e.dataSpecificUrl?i=`.u:${e.dataSpecificUrl}`:t!==void 0?i=`.m:${t.id}`:n!==void 0&&(i=`.o:${n.id}`),[{eventType:"campaign_view",eventId:e.trackingParameters.campaignId,eventName:e.trackingParameters.campaignName,ntpSuffix:i}]},offer_code_copy:r=>{const{offer:e}=r.linkedEntities;if(e!==void 0)return[{eventType:"click_copy_code",eventId:e.id.toString(),eventName:"",ntpSuffix:`.c:${e.id}`},{eventType:"browser_extension_code_copy",ntpSuffix:`.c:${e.id}`}]},offer_code_fetch:()=>[],offer_impression:r=>{const{offer:e}=r.linkedEntities;if(e!==void 0)return[{eventType:"coupons_views",eventId:e.id.toString(),eventName:"",ntpSuffix:`.c:${e.id}`}]},offer_url_open:r=>{const{offer:e}=r.linkedEntities;if(e!==void 0)return[{eventType:"click_coupon",eventId:e.id.toString(),eventName:"",ntpSuffix:`.c:${e.id}`},{eventType:"browser_extension_code_click",ntpSuffix:`.c:${e.id}`}]},product_card_impression:r=>{const{product:e,productCard:t}=r.linkedEntities;if(t!==void 0)return[{eventType:"product_card_views",eventId:t.id.toString(),eventName:"",ntpSuffix:e?`.p:${e.id}`:""}]},extension_component_click:r=>{const{label:e=""}=r;if(e==="")return;const t=[];return e==="CashbackModule"&&t.push("browser_extension_cb_activation"),e==="MerchantCashbackInformationModule"&&t.push("browser_extension_discover_incentive"),e==="RCouponApplierLauncher"&&t.push("autotest_activation"),[{eventType:"browser_extension_component_click",eventId:e,eventName:""},...t.map(n=>({eventType:n}))]},extension_component_impression:r=>{const{label:e=""}=r;if(e==="")return;const t=[];return e==="RCouponApplierLauncher"&&t.push("autotest_view"),e==="RCouponApplierModalFailedTestResultsPanel"&&(t.push("autotest_processed"),t.push("autotest_no_candidate")),e==="RCouponApplierModalSuccessfulTestResultsPanel"&&(t.push("autotest_processed"),t.push("autotest_candidate"),t.push("autotest_validation")),e==="RSidebarTabHome"&&t.push("browser_extension_sb_impression"),[{eventType:"browser_extension_component_impression",eventId:e,eventName:""},...t.map(n=>({eventType:n}))]},extension_component_scroll:r=>{const{label:e=""}=r;if(e!=="")return[{eventType:"browser_extension_component_scroll",eventId:e,eventName:""}]}};$t.h=r=>typeof r=="string"&&r.length>0?encodeURIComponent(r):r||"",$t.trackEvent=(r,e,t)=>{const n=[...$t.getParameters(r,e,t),`rand=${Math.random()}`],i=`${$t.gif}?${n.join("&")}`;fetch(i).catch(a=>{console.error(new Error("Failed to send Cloud tracking event"),fe(a,"<redacted>"))})};class Km{constructor(e,t,n){p(this,"runtimeVersion");p(this,"parameterService");p(this,"userService");this.runtimeVersion=e,this.parameterService=t,this.userService=n}async trackBackgroundEvent(e){var a;const t=(a=xi[e.type])==null?void 0:a.call(xi,e);if(t===void 0||t.length===0)return;const n=await this.createBaseCloudCollectorClientConfiguration(),i=t.map(({eventType:s,eventId:o,eventName:c,entities:l={}})=>{const u={...n};return this.addEntitiesInfoToConfig(u,l),{configuration:u,eventType:s,eventId:o,eventName:c}});return this.trackEvents(i)}async trackUserInterfaceEvent(e,t){var o,c,l,u;const n=t.at(-1);if(n===void 0)throw new Error("Invalid user interface event: no target captured");const i=(o=Ai[e])==null?void 0:o.call(Ai,n);if(i===void 0){const d=`Unable to convert event of type ${e} to Cloud event`;throw new Error(d)}if(i.length===0)return;const a=await this.createBaseCloudCollectorClientConfiguration();a.od_pvtyp=((c=t.find(d=>d.pageViewType))==null?void 0:c.pageViewType)??"",a.od_pvid=((l=t.find(d=>d.pageViewId))==null?void 0:l.pageViewId)??"",a.od_scrsz=((u=t.find(d=>d.screenSize))==null?void 0:u.screenSize)??"",a.od_ntp=`body.l:${this.extractLabel(t)}`,a.od_pos=`${t.map(d=>d.position).reduce((d,f)=>d??f,1)??1}`,this.addEntitiesInfoToConfig(a,t.reduce((d,f)=>Object.assign(d,f.linkedEntities),{}));const s=i.map(({eventType:d,eventId:f,eventName:h,ntpSuffix:y=""})=>({configuration:{...a,od_ntp:`${a.od_ntp}${y}`},eventType:d,eventId:f,eventName:h}));return this.trackEvents(s)}async createBaseCloudCollectorClientConfiguration(){const[e,t,n,i]=await Promise.all([this.parameterService.getParameter("privacy_allow_performance_tracking"),this.parameterService.getParameter("extension_installation_id"),this.parameterService.getParameter("extension_session_id"),this.userService.getCurrentUser()]),a={od_tcs:"",od_tkgc:`${e?1:0}`,od_tmd:"0",od_cid:"als61e6732c50ec95.25615046",od_srv:"",od_apv:this.runtimeVersion,od_ssid:n,od_aid:"",od_idfv:"",od_tag:"EXT",od_vpt:"desktop",od_scrsz:"",od_ip:"",od_gg_utmz:"",od_gg_utmcsr:"",od_gg_utmccn:"",od_gg_utmcmd:"extension",od_gg_utmctr:"",od_gg_utmcct:"",od_gg_utma:"",od_gg_utm_visit:"",od_gg_utm_session:"",od_utmcmd:"",od_utmcsr:"",od_utmccn:"",od_utmctr:"",od_utmcct:"",od_oref:"",od_olpg:"",od_sref:"",od_lpg:"",od_ckpg:"",od_nlid:"",od_pvtyp:"",od_pvid:"",od_act:"",od_ntp:"",od_pos:"",od_cbid:"",od_expid:"",od_expv:"",od_cpgt:"",od_cpgid:"",od_cpgnm:"",od_icm:"",od_ics:"",od_icn:"",od_icl:"",od_ici:"",od_mid:"",od_mnm:"",od_catid:"",od_catnm:"",od_oid:"",od_onm:"",od_pid:"",od_pcid:"",od_ctx:"cashback_not_logged",od_uid:"",od_fp:e?t:"aaaaaaaa-aaaa-4aaa-aaaa-aaaaaaaaaaaa"};return i&&this.addUserInfoToConfig(a,i),a}addEntitiesInfoToConfig(e,t){t.cashbackOffer&&this.addCashbackOfferInfoToConfig(e,t.cashbackOffer),t.experiment&&this.addExperimentInfoToConfig(e,t.experiment),t.highlightCampaign&&this.addHighlightCampaignInfoToConfig(e,t.highlightCampaign),t.merchant&&this.addMerchantInfoToConfig(e,t.merchant),t.offer&&this.addOfferInfoToConfig(e,t.offer),t.page&&this.addPageInfoToConfig(e,t.page),t.productCard&&this.addProductCardInfoToConfig(e,t.productCard)}addCashbackOfferInfoToConfig(e,t){e.od_cbid=t.id.toString()}addExperimentInfoToConfig(e,t){e.od_expid=t.id,e.od_expv=t.version}addHighlightCampaignInfoToConfig(e,t){e.od_cpgt="internal",e.od_cpgid=t.trackingParameters.campaignId,e.od_cpgnm=t.trackingParameters.campaignName,e.od_icn=t.trackingParameters.campaignName,e.od_icl=t.trackingParameters.location,e.od_ici=t.trackingParameters.locationId,e.od_icm=t.trackingParameters.medium,e.od_ics=t.trackingParameters.source}addMerchantInfoToConfig(e,t){e.od_mid=t.id.toString(),e.od_mnm=t.name}addOfferInfoToConfig(e,t){e.od_oid=t.id.toString(),e.od_onm=t.shortTitle}addPageInfoToConfig(e,t){e.od_pid=t.id.toString()}addProductCardInfoToConfig(e,t){e.od_pcid=t.id.toString()}addUserInfoToConfig(e,t){e.od_ctx="cashback",e.od_fp=t.fp,e.od_uid=t.id.toString()}extractLabel(e){const t=e.reduce((i,a)=>a.linkedEntities.container!==void 0?`${i}|${a.linkedEntities.container.technicalName}`:a.label!==void 0?`${i}|${a.label}`:i,"").slice(1),n=e.at(-1);return(n==null?void 0:n.label)!==void 0?t:n!=null&&n.linkedEntities.product?`product-${n.linkedEntities.product.ean}`:n!=null&&n.linkedEntities.highlightCampaign?n.linkedEntities.highlightCampaign.dataType:t}async trackEvents(e){const t=await this.parameterService.getParameter("privacy_allow_performance_tracking");if(console.debug("CloudTrackingService","trackEvents",...e.map(a=>this.redactEventTrackingOptions(a)),t),e.map(this.checkCloudCollectorEventFieldsLength.bind(this)),!t)return;const n="extension_first_usage_tracking",i=await this.parameterService.getParameter(n)==="done";try{i||(await this.parameterService.updateParameter(n,"done"),e.some(a=>a.eventName==="browser_extension_install")||e.unshift({configuration:await this.createBaseCloudCollectorClientConfiguration(),eventType:"browser_extension_first_usage",eventId:"",eventName:""}));for(const{configuration:a,eventType:s,eventId:o,eventName:c}of e)$t.configuration={...a},$t.trackEvent(rr(s),o??"",rr(c??""))}catch(a){console.error(new Error("Failed to track events"),"CloudTrackingService","trackEvents",...e.map(s=>this.redactEventTrackingOptions(s)),fe(a,"<redacted>"))}}checkCloudCollectorEventFieldsLength(e){const t=u=>{console.error(new Error("Unknown tracking event field"),"CloudTrackingService","checkCloudCollectorEventFieldsLength",this.redactEventTrackingOptions(e),u)},n=(u,d,f)=>{console.error(new Error("Invalid tracking event field value length"),"CloudTrackingService","checkCloudCollectorEventFieldsLength",this.redactEventTrackingOptions(e),u,fe(d,"<redacted>"),`${d.length}/${f}`)},{configuration:i,eventType:a,eventId:s="",eventName:o=""}=e;a.length>255&&n("od_etp",a,255);const c=Array.isArray(s)?s.join(","):s;c.length>255&&n("od_eid",c,255),o.length>1e3&&n("od_enm",o,1e3);const l={od_tmd:255,od_cid:255,od_srv:255,od_ssid:255,od_mid:20,od_mnm:255,od_catid:20,od_catnm:255,od_oid:20,od_onm:255,od_ctx:250,od_scrsz:255,od_fp:255,od_vpt:255,od_act:255,od_uid:255,od_tag:255,od_gg_utmz:255,od_gg_utmcsr:255,od_gg_utmccn:255,od_gg_utmcmd:255,od_gg_utmctr:255,od_gg_utmcct:255,od_gg_utma:255,od_gg_utm_visit:255,od_gg_utm_session:255,od_ip:255,od_oref:2e3,od_olpg:2e3,od_sref:2e3,od_lpg:2e3,od_cpgt:255,od_cpgid:255,od_cpgnm:255,od_nlid:255,od_expid:255,od_expv:255,od_ckpg:2e3,od_utmcmd:50,od_utmcsr:50,od_utmccn:50,od_utmctr:50,od_utmcct:50,od_icm:50,od_ics:50,od_icn:50,od_icl:50,od_ici:50,od_apv:50,od_aid:50,od_ntp:255,od_pos:59,od_pvtyp:250,od_pvid:250,od_pid:250,od_pcid:250,od_cbid:250,od_tcs:250,od_tkgc:1,od_idfv:1e3};for(const u in i){if(!(u in l)){t(u);continue}const d=i[u],f=l[u];d.length>f&&n(u,d,f)}}redactEventTrackingOptions(e){return fe(e,{...e,configuration:{...e.configuration,od_fp:"<redacted>",od_uid:e.configuration.od_uid===""?"":"<redacted>"}})}}var Gm=Object.defineProperty,zm=Object.getOwnPropertyDescriptor,Bm=(r,e,t,n)=>{for(var i=zm(e,t),a=r.length-1,s;a>=0;a--)(s=r[a])&&(i=s(e,t,i)||i);return i&&Gm(e,t,i),i};class ho{constructor(e){p(this,"repository");this.repository=e}async getContainerContentByContainerTechnicalName(e,t){let n=await this.getCachedContainerContentByContainerTechnicalName(e);return n===void 0&&(n=await this.fetchContainerContentByContainerTechnicalName(e,t),await this.cacheContainerContentByContainerTechnicalName(e,n)),n}async updateContainerContentByContainerTechnicalNameCache(e,t){const n=await this.fetchContainerContentByContainerTechnicalName(e,t);return this.cacheContainerContentByContainerTechnicalName(e,n)}async fetchContainerContentByContainerTechnicalName(e,t=20){var s,o,c,l;const n=await ye["/containers/{techName}/content"].get({params:{techName:e},query:{offset:0,limit:t,fields:{merchant:"*"},include:{merchant:"currentCashbackObject,merchantInfo",offer:"merchant"}}});if(!n.ok)throw new Error("Unable to fetch merchant offers");const i=await n.json(),a=[];for(const u of i.data??[]){if(At(u,"merchant")){const d=Ut(u,i.included);d!==void 0&&a.push({type:"merchant",merchant:d});continue}if(At(u,"offer")){const d=(c=(o=(s=u.relationships)==null?void 0:s.merchant)==null?void 0:o.data)==null?void 0:c.id,f=(l=i.included)==null?void 0:l.find(h=>At(h,"merchant",d??""));a.push({type:"offer",offer:oo(u,[]),merchant:f!==void 0?Ut(f,i.included):void 0})}}return a}async cacheContainerContentByContainerTechnicalName(e,t){return this.repository.set(`${e}`,t)}async getCachedContainerContentByContainerTechnicalName(e){return this.repository.get(`${e}`)}}Bm([oe({allowConcurrentCallWhenDifferentArgs:!0,abortOnThrow:!0})],ho.prototype,"getContainerContentByContainerTechnicalName");function Ci(r,e=!0){const t=new URL(r);return t.searchParams.append("clid","als61e6732c50ec95.25615046"),e&&(t.searchParams.append("utm_medium","extension"),t.searchParams.append("utm_source","extension")),t}class Jm{constructor(e,t,n,i){p(this,"allProcessingTabIdsKey","all-processing-tab-ids");p(this,"authenticationPendingCookieDropKey","authenticationPendingCookieDrop");p(this,"cookieDropRepository");p(this,"scriptingService");p(this,"tabsService");p(this,"userService");this.cookieDropRepository=e,this.scriptingService=t,this.tabsService=n,this.userService=i}async dropCookie({merchantId:e,offerId:t,activateCashback:n}){if(console.debug("CookieDropService","dropCookie",e,t,n),!(n===!0)){const c=Si({merchantId:e,offerId:t});return await this.openAffiliationUrlInNewTab(c),"processing"}await this.userService.clearCurrentUserCache();const a=await this.userService.getCurrentUser();if(!((a==null?void 0:a.isLogged)===!0)){const c=Ci("https://www.poulpeo.com/inscription");c.searchParams.append("mid",`${e}`);const l=await this.navigateToNewTab(c,{active:!0}),u=(await this.tabsService.getCurrentTab()).id;return await this.cookieDropRepository.set(this.authenticationPendingCookieDropKey,{createdAt:Date.now(),tabId:l,originTabId:u,options:{merchantId:e,offerId:t,activateCashback:n}}),"suspendedUntilAuthentication"}const o=Si({merchantId:e,offerId:t});return await this.openAffiliationUrlInNewTab(o),"processing"}async resumeAuthenticationPendingCookieDrop(){const e=await this.cookieDropRepository.get(this.authenticationPendingCookieDropKey);if(console.debug("CookieDropService","resumeAuthenticationPendingCookieDrop",e),e===void 0)return;if(e.createdAt+5*60*1e3<Date.now()){await this.cookieDropRepository.remove(this.authenticationPendingCookieDropKey);return}const i=await this.userService.getCurrentUser();if((i==null?void 0:i.isLogged)!==!0)throw new Error("Cannot resume authentication pending cookie drop: no user logged in");if(await this.cookieDropRepository.remove(this.authenticationPendingCookieDropKey),e.tabId!==void 0)try{await this.tabsService.remove(e.tabId)}catch(a){console.error("CookieDropService","resumeAuthenticationPendingCookieDrop",a)}if(await this.dropCookie(e.options),e.originTabId!==void 0)try{await this.tabsService.update(e.originTabId,{active:!0})}catch{}await this.tabsService.create({url:Ci("https://www.poulpeo.com").href,active:!1})}async closeCookieDropTab(e){const t=await this.cookieDropRepository.get(this.allProcessingTabIdsKey)??[];if(!t.includes(e))return;const n=t.filter(i=>i!==e);t.length=0,t.push(...n),await this.cookieDropRepository.set(this.allProcessingTabIdsKey,t);try{const i=[new Promise(a=>setTimeout(a,2e3)).then(async()=>this.tabsService.remove(e)),this.scriptingService.executeClose(e,2e3)];await Promise.race(i);for(const a of i)a.catch(()=>{})}catch(i){console.warn("CookieDropService","closeCookieDropTab",i)}}async openAffiliationUrlInNewTab(e){const t=await this.navigateToNewTab(e,{active:!1,pinned:!0}),n=await this.cookieDropRepository.get(this.allProcessingTabIdsKey)??[];n.push(t),await this.cookieDropRepository.set(this.allProcessingTabIdsKey,n)}async navigateToNewTab(e,t){const n=Ci(e);return(await this.tabsService.create({url:n.href,...t})).id}}var j;(function(r){r.assertEqual=i=>i;function e(i){}r.assertIs=e;function t(i){throw new Error}r.assertNever=t,r.arrayToEnum=i=>{const a={};for(const s of i)a[s]=s;return a},r.getValidEnumValues=i=>{const a=r.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(const o of a)s[o]=i[o];return r.objectValues(s)},r.objectValues=i=>r.objectKeys(i).map(function(a){return i[a]}),r.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const a=[];for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},r.find=(i,a)=>{for(const s of i)if(a(s))return s},r.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}r.joinValues=n,r.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(j||(j={}));var Ti;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Ti||(Ti={}));const w=j.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ze=r=>{switch(typeof r){case"undefined":return w.undefined;case"string":return w.string;case"number":return isNaN(r)?w.nan:w.number;case"boolean":return w.boolean;case"function":return w.function;case"bigint":return w.bigint;case"symbol":return w.symbol;case"object":return Array.isArray(r)?w.array:r===null?w.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?w.promise:typeof Map<"u"&&r instanceof Map?w.map:typeof Set<"u"&&r instanceof Set?w.set:typeof Date<"u"&&r instanceof Date?w.date:w.object;default:return w.unknown}},m=j.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Ym=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class pe extends Error{constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(a){return a.message},n={_errors:[]},i=a=>{for(const s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)n._errors.push(t(s));else{let o=n,c=0;for(;c<s.path.length;){const l=s.path[c];c===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(s))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return i(this),n}static assert(e){if(!(e instanceof pe))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,j.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}pe.create=r=>new pe(r);const Lt=(r,e)=>{let t;switch(r.code){case m.invalid_type:r.received===w.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case m.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,j.jsonStringifyReplacer)}`;break;case m.unrecognized_keys:t=`Unrecognized key(s) in object: ${j.joinValues(r.keys,", ")}`;break;case m.invalid_union:t="Invalid input";break;case m.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${j.joinValues(r.options)}`;break;case m.invalid_enum_value:t=`Invalid enum value. Expected ${j.joinValues(r.options)}, received '${r.received}'`;break;case m.invalid_arguments:t="Invalid function arguments";break;case m.invalid_return_type:t="Invalid function return type";break;case m.invalid_date:t="Invalid date";break;case m.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:j.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case m.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case m.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case m.custom:t="Invalid input";break;case m.invalid_intersection_types:t="Intersection results could not be merged";break;case m.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case m.not_finite:t="Number must be finite";break;default:t=e.defaultError,j.assertNever(r)}return{message:t}};let mo=Lt;function Xm(r){mo=r}function an(){return mo}const sn=r=>{const{data:e,path:t,errorMaps:n,issueData:i}=r,a=[...t,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="";const c=n.filter(l=>!!l).slice().reverse();for(const l of c)o=l(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}},Qm=[];function v(r,e){const t=an(),n=sn({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===Lt?void 0:Lt].filter(i=>!!i)});r.common.issues.push(n)}class ie{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const i of t){if(i.status==="aborted")return x;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const i of t){const a=await i.key,s=await i.value;n.push({key:a,value:s})}return ie.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const i of t){const{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return x;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(n[a.value]=s.value)}return{status:e.value,value:n}}}const x=Object.freeze({status:"aborted"}),Ft=r=>({status:"dirty",value:r}),ae=r=>({status:"valid",value:r}),Ii=r=>r.status==="aborted",Ri=r=>r.status==="dirty",nr=r=>r.status==="valid",ir=r=>typeof Promise<"u"&&r instanceof Promise;function on(r,e,t,n){if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function go(r,e,t,n,i){if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}typeof SuppressedError=="function"&&SuppressedError;var S;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(S||(S={}));var ar,sr;class Pe{constructor(e,t,n,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const yo=(r,e)=>{if(nr(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new pe(r.common.issues);return this._error=t,this._error}}};function O(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:i}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{var c,l;const{message:u}=r;return s.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:(c=u??n)!==null&&c!==void 0?c:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(l=u??t)!==null&&l!==void 0?l:o.defaultError}},description:i}}class M{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return ze(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ze(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ie,ctx:{common:e.parent.common,data:e.data,parsedType:ze(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ir(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const i={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ze(e)},a=this._parseSync({data:e,path:i.path,parent:i});return yo(i,a)}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ze(e)},i=this._parse({data:e,path:n.path,parent:n}),a=await(ir(i)?i:Promise.resolve(i));return yo(n,a)}refine(e,t){const n=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,a)=>{const s=e(i),o=()=>a.addIssue({code:m.custom,...n(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof t=="function"?t(n,i):t),!1))}_refinement(e){return new Ee({schema:this,typeName:k.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Ne.create(this,this._def)}nullable(){return Xe.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ke.create(this,this._def)}promise(){return Ht.create(this,this._def)}or(e){return ur.create([this,e],this._def)}and(e){return dr.create(this,e,this._def)}transform(e){return new Ee({...O(this._def),schema:this,typeName:k.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new gr({...O(this._def),innerType:this,defaultValue:t,typeName:k.ZodDefault})}brand(){return new Ni({typeName:k.ZodBranded,type:this,...O(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new yr({...O(this._def),innerType:this,catchValue:t,typeName:k.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return br.create(this,e)}readonly(){return _r.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const eg=/^c[^\s-]{8,}$/i,tg=/^[0-9a-z]+$/,rg=/^[0-9A-HJKMNP-TV-Z]{26}$/,ng=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ig=/^[a-z0-9_-]{21}$/i,ag=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,sg=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,og="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Pi;const cg=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,lg=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ug=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,bo="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",dg=new RegExp(`^${bo}$`);function _o(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function fg(r){return new RegExp(`^${_o(r)}$`)}function vo(r){let e=`${bo}T${_o(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function pg(r,e){return!!((e==="v4"||!e)&&cg.test(r)||(e==="v6"||!e)&&lg.test(r))}class Se extends M{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==w.string){const a=this._getOrReturnCtx(e);return v(a,{code:m.invalid_type,expected:w.string,received:a.parsedType}),x}const n=new ie;let i;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),v(i,{code:m.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),v(i,{code:m.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){const s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?v(i,{code:m.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&v(i,{code:m.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")sg.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"email",code:m.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")Pi||(Pi=new RegExp(og,"u")),Pi.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"emoji",code:m.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")ng.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"uuid",code:m.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")ig.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"nanoid",code:m.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")eg.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"cuid",code:m.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")tg.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"cuid2",code:m.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")rg.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"ulid",code:m.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),v(i,{validation:"url",code:m.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"regex",code:m.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),v(i,{code:m.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),v(i,{code:m.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),v(i,{code:m.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?vo(a).test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{code:m.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?dg.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{code:m.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?fg(a).test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{code:m.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?ag.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"duration",code:m.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?pg(e.data,a.version)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"ip",code:m.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?ug.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"base64",code:m.invalid_string,message:a.message}),n.dirty()):j.assertNever(a);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(i=>e.test(i),{validation:t,code:m.invalid_string,...S.errToObj(n)})}_addCheck(e){return new Se({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...S.errToObj(e)})}url(e){return this._addCheck({kind:"url",...S.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...S.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...S.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...S.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...S.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...S.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...S.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...S.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...S.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(n=e==null?void 0:e.local)!==null&&n!==void 0?n:!1,...S.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...S.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...S.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...S.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...S.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...S.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...S.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...S.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...S.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...S.errToObj(t)})}nonempty(e){return this.min(1,S.errToObj(e))}trim(){return new Se({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Se({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Se({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Se.create=r=>{var e;return new Se({checks:[],typeName:k.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...O(r)})};function hg(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=t>n?t:n,a=parseInt(r.toFixed(i).replace(".","")),s=parseInt(e.toFixed(i).replace(".",""));return a%s/Math.pow(10,i)}class Be extends M{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==w.number){const a=this._getOrReturnCtx(e);return v(a,{code:m.invalid_type,expected:w.number,received:a.parsedType}),x}let n;const i=new ie;for(const a of this._def.checks)a.kind==="int"?j.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),v(n,{code:m.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),v(n,{code:m.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),v(n,{code:m.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?hg(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),v(n,{code:m.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),v(n,{code:m.not_finite,message:a.message}),i.dirty()):j.assertNever(a);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,S.toString(t))}gt(e,t){return this.setLimit("min",e,!1,S.toString(t))}lte(e,t){return this.setLimit("max",e,!0,S.toString(t))}lt(e,t){return this.setLimit("max",e,!1,S.toString(t))}setLimit(e,t,n,i){return new Be({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:S.toString(i)}]})}_addCheck(e){return new Be({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:S.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:S.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:S.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:S.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:S.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:S.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:S.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:S.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:S.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&j.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Be.create=r=>new Be({checks:[],typeName:k.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...O(r)});class Je extends M{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==w.bigint){const a=this._getOrReturnCtx(e);return v(a,{code:m.invalid_type,expected:w.bigint,received:a.parsedType}),x}let n;const i=new ie;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),v(n,{code:m.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),v(n,{code:m.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),v(n,{code:m.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):j.assertNever(a);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,S.toString(t))}gt(e,t){return this.setLimit("min",e,!1,S.toString(t))}lte(e,t){return this.setLimit("max",e,!0,S.toString(t))}lt(e,t){return this.setLimit("max",e,!1,S.toString(t))}setLimit(e,t,n,i){return new Je({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:S.toString(i)}]})}_addCheck(e){return new Je({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:S.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:S.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:S.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:S.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:S.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Je.create=r=>{var e;return new Je({checks:[],typeName:k.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...O(r)})};class or extends M{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==w.boolean){const n=this._getOrReturnCtx(e);return v(n,{code:m.invalid_type,expected:w.boolean,received:n.parsedType}),x}return ae(e.data)}}or.create=r=>new or({typeName:k.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...O(r)});class mt extends M{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==w.date){const a=this._getOrReturnCtx(e);return v(a,{code:m.invalid_type,expected:w.date,received:a.parsedType}),x}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return v(a,{code:m.invalid_date}),x}const n=new ie;let i;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(i=this._getOrReturnCtx(e,i),v(i,{code:m.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(i=this._getOrReturnCtx(e,i),v(i,{code:m.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):j.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new mt({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:S.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:S.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}mt.create=r=>new mt({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:k.ZodDate,...O(r)});class cn extends M{_parse(e){if(this._getType(e)!==w.symbol){const n=this._getOrReturnCtx(e);return v(n,{code:m.invalid_type,expected:w.symbol,received:n.parsedType}),x}return ae(e.data)}}cn.create=r=>new cn({typeName:k.ZodSymbol,...O(r)});class cr extends M{_parse(e){if(this._getType(e)!==w.undefined){const n=this._getOrReturnCtx(e);return v(n,{code:m.invalid_type,expected:w.undefined,received:n.parsedType}),x}return ae(e.data)}}cr.create=r=>new cr({typeName:k.ZodUndefined,...O(r)});class lr extends M{_parse(e){if(this._getType(e)!==w.null){const n=this._getOrReturnCtx(e);return v(n,{code:m.invalid_type,expected:w.null,received:n.parsedType}),x}return ae(e.data)}}lr.create=r=>new lr({typeName:k.ZodNull,...O(r)});class Vt extends M{constructor(){super(...arguments),this._any=!0}_parse(e){return ae(e.data)}}Vt.create=r=>new Vt({typeName:k.ZodAny,...O(r)});class gt extends M{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ae(e.data)}}gt.create=r=>new gt({typeName:k.ZodUnknown,...O(r)});class je extends M{_parse(e){const t=this._getOrReturnCtx(e);return v(t,{code:m.invalid_type,expected:w.never,received:t.parsedType}),x}}je.create=r=>new je({typeName:k.ZodNever,...O(r)});class ln extends M{_parse(e){if(this._getType(e)!==w.undefined){const n=this._getOrReturnCtx(e);return v(n,{code:m.invalid_type,expected:w.void,received:n.parsedType}),x}return ae(e.data)}}ln.create=r=>new ln({typeName:k.ZodVoid,...O(r)});class ke extends M{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),i=this._def;if(t.parsedType!==w.array)return v(t,{code:m.invalid_type,expected:w.array,received:t.parsedType}),x;if(i.exactLength!==null){const s=t.data.length>i.exactLength.value,o=t.data.length<i.exactLength.value;(s||o)&&(v(t,{code:s?m.too_big:m.too_small,minimum:o?i.exactLength.value:void 0,maximum:s?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(v(t,{code:m.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(v(t,{code:m.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((s,o)=>i.type._parseAsync(new Pe(t,s,t.path,o)))).then(s=>ie.mergeArray(n,s));const a=[...t.data].map((s,o)=>i.type._parseSync(new Pe(t,s,t.path,o)));return ie.mergeArray(n,a)}get element(){return this._def.type}min(e,t){return new ke({...this._def,minLength:{value:e,message:S.toString(t)}})}max(e,t){return new ke({...this._def,maxLength:{value:e,message:S.toString(t)}})}length(e,t){return new ke({...this._def,exactLength:{value:e,message:S.toString(t)}})}nonempty(e){return this.min(1,e)}}ke.create=(r,e)=>new ke({type:r,minLength:null,maxLength:null,exactLength:null,typeName:k.ZodArray,...O(e)});function qt(r){if(r instanceof H){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=Ne.create(qt(n))}return new H({...r._def,shape:()=>e})}else return r instanceof ke?new ke({...r._def,type:qt(r.element)}):r instanceof Ne?Ne.create(qt(r.unwrap())):r instanceof Xe?Xe.create(qt(r.unwrap())):r instanceof Oe?Oe.create(r.items.map(e=>qt(e))):r}class H extends M{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=j.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==w.object){const l=this._getOrReturnCtx(e);return v(l,{code:m.invalid_type,expected:w.object,received:l.parsedType}),x}const{status:n,ctx:i}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof je&&this._def.unknownKeys==="strip"))for(const l in i.data)s.includes(l)||o.push(l);const c=[];for(const l of s){const u=a[l],d=i.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Pe(i,d,i.path,l)),alwaysSet:l in i.data})}if(this._def.catchall instanceof je){const l=this._def.unknownKeys;if(l==="passthrough")for(const u of o)c.push({key:{status:"valid",value:u},value:{status:"valid",value:i.data[u]}});else if(l==="strict")o.length>0&&(v(i,{code:m.unrecognized_keys,keys:o}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const u of o){const d=i.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Pe(i,d,i.path,u)),alwaysSet:u in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const l=[];for(const u of c){const d=await u.key,f=await u.value;l.push({key:d,value:f,alwaysSet:u.alwaysSet})}return l}).then(l=>ie.mergeObjectSync(n,l)):ie.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return S.errToObj,new H({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var i,a,s,o;const c=(s=(a=(i=this._def).errorMap)===null||a===void 0?void 0:a.call(i,t,n).message)!==null&&s!==void 0?s:n.defaultError;return t.code==="unrecognized_keys"?{message:(o=S.errToObj(e).message)!==null&&o!==void 0?o:c}:{message:c}}}:{}})}strip(){return new H({...this._def,unknownKeys:"strip"})}passthrough(){return new H({...this._def,unknownKeys:"passthrough"})}extend(e){return new H({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new H({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:k.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new H({...this._def,catchall:e})}pick(e){const t={};return j.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new H({...this._def,shape:()=>t})}omit(e){const t={};return j.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new H({...this._def,shape:()=>t})}deepPartial(){return qt(this)}partial(e){const t={};return j.objectKeys(this.shape).forEach(n=>{const i=this.shape[n];e&&!e[n]?t[n]=i:t[n]=i.optional()}),new H({...this._def,shape:()=>t})}required(e){const t={};return j.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof Ne;)a=a._def.innerType;t[n]=a}}),new H({...this._def,shape:()=>t})}keyof(){return wo(j.objectKeys(this.shape))}}H.create=(r,e)=>new H({shape:()=>r,unknownKeys:"strip",catchall:je.create(),typeName:k.ZodObject,...O(e)}),H.strictCreate=(r,e)=>new H({shape:()=>r,unknownKeys:"strict",catchall:je.create(),typeName:k.ZodObject,...O(e)}),H.lazycreate=(r,e)=>new H({shape:r,unknownKeys:"strip",catchall:je.create(),typeName:k.ZodObject,...O(e)});class ur extends M{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function i(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const s=a.map(o=>new pe(o.ctx.common.issues));return v(t,{code:m.invalid_union,unionErrors:s}),x}if(t.common.async)return Promise.all(n.map(async a=>{const s={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}})).then(i);{let a;const s=[];for(const c of n){const l={...t,common:{...t.common,issues:[]},parent:null},u=c._parseSync({data:t.data,path:t.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!a&&(a={result:u,ctx:l}),l.common.issues.length&&s.push(l.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=s.map(c=>new pe(c));return v(t,{code:m.invalid_union,unionErrors:o}),x}}get options(){return this._def.options}}ur.create=(r,e)=>new ur({options:r,typeName:k.ZodUnion,...O(e)});const $e=r=>r instanceof pr?$e(r.schema):r instanceof Ee?$e(r.innerType()):r instanceof hr?[r.value]:r instanceof Ye?r.options:r instanceof mr?j.objectValues(r.enum):r instanceof gr?$e(r._def.innerType):r instanceof cr?[void 0]:r instanceof lr?[null]:r instanceof Ne?[void 0,...$e(r.unwrap())]:r instanceof Xe?[null,...$e(r.unwrap())]:r instanceof Ni||r instanceof _r?$e(r.unwrap()):r instanceof yr?$e(r._def.innerType):[];class un extends M{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==w.object)return v(t,{code:m.invalid_type,expected:w.object,received:t.parsedType}),x;const n=this.discriminator,i=t.data[n],a=this.optionsMap.get(i);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(v(t,{code:m.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),x)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const i=new Map;for(const a of t){const s=$e(a.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of s){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,a)}}return new un({typeName:k.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...O(n)})}}function Oi(r,e){const t=ze(r),n=ze(e);if(r===e)return{valid:!0,data:r};if(t===w.object&&n===w.object){const i=j.objectKeys(e),a=j.objectKeys(r).filter(o=>i.indexOf(o)!==-1),s={...r,...e};for(const o of a){const c=Oi(r[o],e[o]);if(!c.valid)return{valid:!1};s[o]=c.data}return{valid:!0,data:s}}else if(t===w.array&&n===w.array){if(r.length!==e.length)return{valid:!1};const i=[];for(let a=0;a<r.length;a++){const s=r[a],o=e[a],c=Oi(s,o);if(!c.valid)return{valid:!1};i.push(c.data)}return{valid:!0,data:i}}else return t===w.date&&n===w.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class dr extends M{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),i=(a,s)=>{if(Ii(a)||Ii(s))return x;const o=Oi(a.value,s.value);return o.valid?((Ri(a)||Ri(s))&&t.dirty(),{status:t.value,value:o.data}):(v(n,{code:m.invalid_intersection_types}),x)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,s])=>i(a,s)):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}dr.create=(r,e,t)=>new dr({left:r,right:e,typeName:k.ZodIntersection,...O(t)});class Oe extends M{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==w.array)return v(n,{code:m.invalid_type,expected:w.array,received:n.parsedType}),x;if(n.data.length<this._def.items.length)return v(n,{code:m.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),x;!this._def.rest&&n.data.length>this._def.items.length&&(v(n,{code:m.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...n.data].map((s,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new Pe(n,s,n.path,o)):null}).filter(s=>!!s);return n.common.async?Promise.all(a).then(s=>ie.mergeArray(t,s)):ie.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new Oe({...this._def,rest:e})}}Oe.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Oe({items:r,typeName:k.ZodTuple,rest:null,...O(e)})};class fr extends M{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==w.object)return v(n,{code:m.invalid_type,expected:w.object,received:n.parsedType}),x;const i=[],a=this._def.keyType,s=this._def.valueType;for(const o in n.data)i.push({key:a._parse(new Pe(n,o,n.path,o)),value:s._parse(new Pe(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?ie.mergeObjectAsync(t,i):ie.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof M?new fr({keyType:e,valueType:t,typeName:k.ZodRecord,...O(n)}):new fr({keyType:Se.create(),valueType:e,typeName:k.ZodRecord,...O(t)})}}class dn extends M{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==w.map)return v(n,{code:m.invalid_type,expected:w.map,received:n.parsedType}),x;const i=this._def.keyType,a=this._def.valueType,s=[...n.data.entries()].map(([o,c],l)=>({key:i._parse(new Pe(n,o,n.path,[l,"key"])),value:a._parse(new Pe(n,c,n.path,[l,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of s){const l=await c.key,u=await c.value;if(l.status==="aborted"||u.status==="aborted")return x;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(l.value,u.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const c of s){const l=c.key,u=c.value;if(l.status==="aborted"||u.status==="aborted")return x;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(l.value,u.value)}return{status:t.value,value:o}}}}dn.create=(r,e,t)=>new dn({valueType:e,keyType:r,typeName:k.ZodMap,...O(t)});class yt extends M{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==w.set)return v(n,{code:m.invalid_type,expected:w.set,received:n.parsedType}),x;const i=this._def;i.minSize!==null&&n.data.size<i.minSize.value&&(v(n,{code:m.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&n.data.size>i.maxSize.value&&(v(n,{code:m.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());const a=this._def.valueType;function s(c){const l=new Set;for(const u of c){if(u.status==="aborted")return x;u.status==="dirty"&&t.dirty(),l.add(u.value)}return{status:t.value,value:l}}const o=[...n.data.values()].map((c,l)=>a._parse(new Pe(n,c,n.path,l)));return n.common.async?Promise.all(o).then(c=>s(c)):s(o)}min(e,t){return new yt({...this._def,minSize:{value:e,message:S.toString(t)}})}max(e,t){return new yt({...this._def,maxSize:{value:e,message:S.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}yt.create=(r,e)=>new yt({valueType:r,minSize:null,maxSize:null,typeName:k.ZodSet,...O(e)});class Wt extends M{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==w.function)return v(t,{code:m.invalid_type,expected:w.function,received:t.parsedType}),x;function n(o,c){return sn({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,an(),Lt].filter(l=>!!l),issueData:{code:m.invalid_arguments,argumentsError:c}})}function i(o,c){return sn({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,an(),Lt].filter(l=>!!l),issueData:{code:m.invalid_return_type,returnTypeError:c}})}const a={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof Ht){const o=this;return ae(async function(...c){const l=new pe([]),u=await o._def.args.parseAsync(c,a).catch(h=>{throw l.addIssue(n(c,h)),l}),d=await Reflect.apply(s,this,u);return await o._def.returns._def.type.parseAsync(d,a).catch(h=>{throw l.addIssue(i(d,h)),l})})}else{const o=this;return ae(function(...c){const l=o._def.args.safeParse(c,a);if(!l.success)throw new pe([n(c,l.error)]);const u=Reflect.apply(s,this,l.data),d=o._def.returns.safeParse(u,a);if(!d.success)throw new pe([i(u,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Wt({...this._def,args:Oe.create(e).rest(gt.create())})}returns(e){return new Wt({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new Wt({args:e||Oe.create([]).rest(gt.create()),returns:t||gt.create(),typeName:k.ZodFunction,...O(n)})}}class pr extends M{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}pr.create=(r,e)=>new pr({getter:r,typeName:k.ZodLazy,...O(e)});class hr extends M{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return v(t,{received:t.data,code:m.invalid_literal,expected:this._def.value}),x}return{status:"valid",value:e.data}}get value(){return this._def.value}}hr.create=(r,e)=>new hr({value:r,typeName:k.ZodLiteral,...O(e)});function wo(r,e){return new Ye({values:r,typeName:k.ZodEnum,...O(e)})}class Ye extends M{constructor(){super(...arguments),ar.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return v(t,{expected:j.joinValues(n),received:t.parsedType,code:m.invalid_type}),x}if(on(this,ar)||go(this,ar,new Set(this._def.values)),!on(this,ar).has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return v(t,{received:t.data,code:m.invalid_enum_value,options:n}),x}return ae(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Ye.create(e,{...this._def,...t})}exclude(e,t=this._def){return Ye.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}ar=new WeakMap,Ye.create=wo;class mr extends M{constructor(){super(...arguments),sr.set(this,void 0)}_parse(e){const t=j.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==w.string&&n.parsedType!==w.number){const i=j.objectValues(t);return v(n,{expected:j.joinValues(i),received:n.parsedType,code:m.invalid_type}),x}if(on(this,sr)||go(this,sr,new Set(j.getValidEnumValues(this._def.values))),!on(this,sr).has(e.data)){const i=j.objectValues(t);return v(n,{received:n.data,code:m.invalid_enum_value,options:i}),x}return ae(e.data)}get enum(){return this._def.values}}sr=new WeakMap,mr.create=(r,e)=>new mr({values:r,typeName:k.ZodNativeEnum,...O(e)});class Ht extends M{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==w.promise&&t.common.async===!1)return v(t,{code:m.invalid_type,expected:w.promise,received:t.parsedType}),x;const n=t.parsedType===w.promise?t.data:Promise.resolve(t.data);return ae(n.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Ht.create=(r,e)=>new Ht({type:r,typeName:k.ZodPromise,...O(e)});class Ee extends M{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===k.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),i=this._def.effect||null,a={addIssue:s=>{v(n,s),s.fatal?t.abort():t.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),i.type==="preprocess"){const s=i.transform(n.data,a);if(n.common.async)return Promise.resolve(s).then(async o=>{if(t.value==="aborted")return x;const c=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return c.status==="aborted"?x:c.status==="dirty"||t.value==="dirty"?Ft(c.value):c});{if(t.value==="aborted")return x;const o=this._def.schema._parseSync({data:s,path:n.path,parent:n});return o.status==="aborted"?x:o.status==="dirty"||t.value==="dirty"?Ft(o.value):o}}if(i.type==="refinement"){const s=o=>{const c=i.refinement(o,a);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?x:(o.status==="dirty"&&t.dirty(),s(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?x:(o.status==="dirty"&&t.dirty(),s(o.value).then(()=>({status:t.value,value:o.value}))))}if(i.type==="transform")if(n.common.async===!1){const s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!nr(s))return s;const o=i.transform(s.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>nr(s)?Promise.resolve(i.transform(s.value,a)).then(o=>({status:t.value,value:o})):s);j.assertNever(i)}}Ee.create=(r,e,t)=>new Ee({schema:r,typeName:k.ZodEffects,effect:e,...O(t)}),Ee.createWithPreprocess=(r,e,t)=>new Ee({schema:e,effect:{type:"preprocess",transform:r},typeName:k.ZodEffects,...O(t)});class Ne extends M{_parse(e){return this._getType(e)===w.undefined?ae(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ne.create=(r,e)=>new Ne({innerType:r,typeName:k.ZodOptional,...O(e)});class Xe extends M{_parse(e){return this._getType(e)===w.null?ae(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Xe.create=(r,e)=>new Xe({innerType:r,typeName:k.ZodNullable,...O(e)});class gr extends M{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===w.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}gr.create=(r,e)=>new gr({innerType:r,typeName:k.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...O(e)});class yr extends M{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ir(i)?i.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new pe(n.common.issues)},input:n.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new pe(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}yr.create=(r,e)=>new yr({innerType:r,typeName:k.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...O(e)});class fn extends M{_parse(e){if(this._getType(e)!==w.nan){const n=this._getOrReturnCtx(e);return v(n,{code:m.invalid_type,expected:w.nan,received:n.parsedType}),x}return{status:"valid",value:e.data}}}fn.create=r=>new fn({typeName:k.ZodNaN,...O(r)});const mg=Symbol("zod_brand");class Ni extends M{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class br extends M{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?x:a.status==="dirty"?(t.dirty(),Ft(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?x:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(e,t){return new br({in:e,out:t,typeName:k.ZodPipeline})}}class _r extends M{_parse(e){const t=this._def.innerType._parse(e),n=i=>(nr(i)&&(i.value=Object.freeze(i.value)),i);return ir(t)?t.then(i=>n(i)):n(t)}unwrap(){return this._def.innerType}}_r.create=(r,e)=>new _r({innerType:r,typeName:k.ZodReadonly,...O(e)});function So(r,e={},t){return r?Vt.create().superRefine((n,i)=>{var a,s;if(!r(n)){const o=typeof e=="function"?e(n):typeof e=="string"?{message:e}:e,c=(s=(a=o.fatal)!==null&&a!==void 0?a:t)!==null&&s!==void 0?s:!0,l=typeof o=="string"?{message:o}:o;i.addIssue({code:"custom",...l,fatal:c})}}):Vt.create()}const gg={object:H.lazycreate};var k;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(k||(k={}));const yg=(r,e={message:`Input not instance of ${r.name}`})=>So(t=>t instanceof r,e),ko=Se.create,Eo=Be.create,bg=fn.create,_g=Je.create,xo=or.create,vg=mt.create,wg=cn.create,Sg=cr.create,kg=lr.create,Eg=Vt.create,xg=gt.create,Ag=je.create,Cg=ln.create,Tg=ke.create,Ig=H.create,Rg=H.strictCreate,Pg=ur.create,Og=un.create,Ng=dr.create,Mg=Oe.create,Dg=fr.create,Ug=dn.create,jg=yt.create,$g=Wt.create,Lg=pr.create,Fg=hr.create,Vg=Ye.create,qg=mr.create,Wg=Ht.create,Ao=Ee.create,Hg=Ne.create,Zg=Xe.create,Kg=Ee.createWithPreprocess,Gg=br.create;var g=Object.freeze({__proto__:null,defaultErrorMap:Lt,setErrorMap:Xm,getErrorMap:an,makeIssue:sn,EMPTY_PATH:Qm,addIssueToContext:v,ParseStatus:ie,INVALID:x,DIRTY:Ft,OK:ae,isAborted:Ii,isDirty:Ri,isValid:nr,isAsync:ir,get util(){return j},get objectUtil(){return Ti},ZodParsedType:w,getParsedType:ze,ZodType:M,datetimeRegex:vo,ZodString:Se,ZodNumber:Be,ZodBigInt:Je,ZodBoolean:or,ZodDate:mt,ZodSymbol:cn,ZodUndefined:cr,ZodNull:lr,ZodAny:Vt,ZodUnknown:gt,ZodNever:je,ZodVoid:ln,ZodArray:ke,ZodObject:H,ZodUnion:ur,ZodDiscriminatedUnion:un,ZodIntersection:dr,ZodTuple:Oe,ZodRecord:fr,ZodMap:dn,ZodSet:yt,ZodFunction:Wt,ZodLazy:pr,ZodLiteral:hr,ZodEnum:Ye,ZodNativeEnum:mr,ZodPromise:Ht,ZodEffects:Ee,ZodTransformer:Ee,ZodOptional:Ne,ZodNullable:Xe,ZodDefault:gr,ZodCatch:yr,ZodNaN:fn,BRAND:mg,ZodBranded:Ni,ZodPipeline:br,ZodReadonly:_r,custom:So,Schema:M,ZodSchema:M,late:gg,get ZodFirstPartyTypeKind(){return k},coerce:{string:r=>Se.create({...r,coerce:!0}),number:r=>Be.create({...r,coerce:!0}),boolean:r=>or.create({...r,coerce:!0}),bigint:r=>Je.create({...r,coerce:!0}),date:r=>mt.create({...r,coerce:!0})},any:Eg,array:Tg,bigint:_g,boolean:xo,date:vg,discriminatedUnion:Og,effect:Ao,enum:Vg,function:$g,instanceof:yg,intersection:Ng,lazy:Lg,literal:Fg,map:Ug,nan:bg,nativeEnum:qg,never:Ag,null:kg,nullable:Zg,number:Eo,object:Ig,oboolean:()=>xo().optional(),onumber:()=>Eo().optional(),optional:Hg,ostring:()=>ko().optional(),pipeline:Gg,preprocess:Kg,promise:Wg,record:Dg,set:jg,strictObject:Rg,string:ko,symbol:wg,transformer:Ao,tuple:Mg,undefined:Sg,union:Pg,unknown:xg,void:Cg,NEVER:x,ZodIssueCode:m,quotelessJson:Ym,ZodError:pe});const Mi=g.string(),bt=g.object({from:Mi,to:g.string()}),_t=g.object({match:Mi,matchIndex:g.string().optional().default("0"),flags:g.enum(["g","i","m","s","u","y"]).optional().default("i")}),he=g.string(),ce=g.object({selector:he}),vr=g.string(),zg=g.object({type:g.literal("html"),url:g.string().optional(),discount:g.union([he,g.object({}).merge(ce.partial()).merge(bt),g.object({}).merge(ce.partial()).merge(_t)]).optional(),total:g.union([he,g.object({}).merge(ce.partial()).merge(bt),g.object({}).merge(ce.partial()).merge(_t)]).optional()}),Bg=g.object({type:g.literal("json"),path:vr.optional(),url:g.string().optional(),discount:g.union([vr,g.object({type:g.literal("number"),path:vr})]).optional(),total:g.union([vr,g.object({type:g.literal("number"),path:vr})]).optional()}).merge(bt.partial()).merge(_t.partial()),Jg=g.object({type:g.literal("string").optional().default("string")}).merge(ce).merge(bt),Yg=g.object({type:g.literal("string").optional().default("string")}).merge(ce).merge(_t),Xg=g.union([zg,Bg,Jg,Yg]),Qg=g.enum(["click","request","submit","delete","get","head","options","patch","post","put","trace"]),Co=g.object({type:Qg,form:g.union([g.literal(!0),he,g.object({data:g.array(g.object({key:g.string(),value:g.string()}))}).merge(ce)]).optional(),submit:he.optional(),headers:g.record(g.string(),g.string()).optional(),data:g.union([g.literal(null),g.string(),g.record(g.string(),g.string())]).optional(),waitFor:he.optional(),waitUntil:he.optional(),timeout:g.number().optional(),url:g.string().optional(),response:Xg.optional()}),ey=g.object({key:g.string(),variable:g.string().optional(),attribute:g.string().optional()}).merge(ce.partial()).merge(bt.partial()).merge(_t.partial()),wr=r=>g.union([r,g.array(r)]),ty=g.object({id:g.string(),storeID:g.string().optional(),platforms:g.array(g.string()),url:wr(Mi),refresh:g.boolean().optional(),controls:g.object({promo:g.string(),total:g.union([he,g.object({}).merge(ce).merge(bt),g.object({}).merge(ce).merge(_t)]),discount:g.union([he,g.object({}).merge(ce).merge(bt),g.object({}).merge(ce).merge(_t)]).optional(),coupon:g.union([he,g.object({extractable:g.literal(!0)}).merge(ce)]).optional(),coupons:g.union([he,g.object({extractable:g.literal(!0)}).merge(ce)]).optional()}),apply:wr(Co),remove:wr(g.object({pseudoData:wr(g.string()).optional()}).merge(Co)).optional(),unlock:wr(g.object({type:g.literal("click"),submit:he,timeout:g.number()})).optional(),requiredContentData:g.array(ey).optional(),requiredFields:g.array(he).optional()}),Di=new Error("input is invalid type"),ry=[128,32768,8388608,-2147483648];class ny{constructor(){p(this,"buffer8");p(this,"blocks");p(this,"h0");p(this,"h1");p(this,"h2");p(this,"h3");p(this,"start");p(this,"bytes");p(this,"hBytes");p(this,"finalized");p(this,"hashed");p(this,"first");p(this,"lastByteIndex",-1);const e=new ArrayBuffer(68);this.buffer8=new Uint8Array(e),this.blocks=new Uint32Array(e),this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}update(e){if(this.finalized)return this;let t=e;if(t===null)throw Di;t instanceof ArrayBuffer&&(t=new Uint8Array(t));let n=!1;if(typeof t!="string"){if(typeof t!="object"||!Array.isArray(t)&&!ArrayBuffer.isView(t))throw Di;n=!0}let i,a=0,s;const o=t.length,c=this.blocks,l=this.buffer8;for(;a<o;){if(this.hashed&&(this.hashed=!1,c[0]=c[16]??0,c[16]=c[1]=c[2]=c[3]=c[4]=c[5]=c[6]=c[7]=c[8]=c[9]=c[10]=c[11]=c[12]=c[13]=c[14]=c[15]=0),n)for(s=this.start;a<o&&s<64;++a)l[s++]=t[a]??0;else for(s=this.start;a<o&&s<64;++a)i=t.charCodeAt(a),i<128?l[s++]=i:i<2048?(l[s++]=192|i>>6,l[s++]=128|i&63):i<55296||i>=57344?(l[s++]=224|i>>12,l[s++]=128|i>>6&63,l[s++]=128|i&63):(i=65536+((i&1023)<<10|t.charCodeAt(++a)&1023),l[s++]=240|i>>18,l[s++]=128|i>>12&63,l[s++]=128|i>>6&63,l[s++]=128|i&63);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}arrayBuffer(){this.finalize();const e=new ArrayBuffer(16),t=new Uint32Array(e);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,e}finalize(){if(this.finalized)return;this.finalized=!0;const e=this.blocks,t=this.lastByteIndex;e[t>>2]=(e[t>>2]??0)|(ry[t&3]??0),t>=56&&(this.hashed||this.hash(),e[0]=e[16]??0,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,e[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}hash(){let e,t,n,i,a,s;const o=this.blocks;this.first?(e=(o[0]??0)-680876937,e=(e<<7|e>>>25)-271733879<<0,i=(-1732584194^e&2004318071)+(o[1]??0)-117830708,i=(i<<12|i>>>20)+e<<0,n=(-271733879^i&(e^-271733879))+(o[2]??0)-1126478375,n=(n<<17|n>>>15)+i<<0,t=(e^n&(i^e))+(o[3]??0)-1316259209,t=(t<<22|t>>>10)+n<<0):(e=this.h0,t=this.h1,n=this.h2,i=this.h3,e+=(i^t&(n^i))+(o[0]??0)-680876936,e=(e<<7|e>>>25)+t<<0,i+=(n^e&(t^n))+(o[1]??0)-389564586,i=(i<<12|i>>>20)+e<<0,n+=(t^i&(e^t))+(o[2]??0)+606105819,n=(n<<17|n>>>15)+i<<0,t+=(e^n&(i^e))+(o[3]??0)-1044525330,t=(t<<22|t>>>10)+n<<0),e+=(i^t&(n^i))+(o[4]??0)-176418897,e=(e<<7|e>>>25)+t<<0,i+=(n^e&(t^n))+(o[5]??0)+1200080426,i=(i<<12|i>>>20)+e<<0,n+=(t^i&(e^t))+(o[6]??0)-1473231341,n=(n<<17|n>>>15)+i<<0,t+=(e^n&(i^e))+(o[7]??0)-45705983,t=(t<<22|t>>>10)+n<<0,e+=(i^t&(n^i))+(o[8]??0)+1770035416,e=(e<<7|e>>>25)+t<<0,i+=(n^e&(t^n))+(o[9]??0)-1958414417,i=(i<<12|i>>>20)+e<<0,n+=(t^i&(e^t))+(o[10]??0)-42063,n=(n<<17|n>>>15)+i<<0,t+=(e^n&(i^e))+(o[11]??0)-1990404162,t=(t<<22|t>>>10)+n<<0,e+=(i^t&(n^i))+(o[12]??0)+1804603682,e=(e<<7|e>>>25)+t<<0,i+=(n^e&(t^n))+(o[13]??0)-40341101,i=(i<<12|i>>>20)+e<<0,n+=(t^i&(e^t))+(o[14]??0)-1502002290,n=(n<<17|n>>>15)+i<<0,t+=(e^n&(i^e))+(o[15]??0)+1236535329,t=(t<<22|t>>>10)+n<<0,e+=(n^i&(t^n))+(o[1]??0)-165796510,e=(e<<5|e>>>27)+t<<0,i+=(t^n&(e^t))+(o[6]??0)-1069501632,i=(i<<9|i>>>23)+e<<0,n+=(e^t&(i^e))+(o[11]??0)+643717713,n=(n<<14|n>>>18)+i<<0,t+=(i^e&(n^i))+(o[0]??0)-373897302,t=(t<<20|t>>>12)+n<<0,e+=(n^i&(t^n))+(o[5]??0)-701558691,e=(e<<5|e>>>27)+t<<0,i+=(t^n&(e^t))+(o[10]??0)+38016083,i=(i<<9|i>>>23)+e<<0,n+=(e^t&(i^e))+(o[15]??0)-660478335,n=(n<<14|n>>>18)+i<<0,t+=(i^e&(n^i))+(o[4]??0)-405537848,t=(t<<20|t>>>12)+n<<0,e+=(n^i&(t^n))+(o[9]??0)+568446438,e=(e<<5|e>>>27)+t<<0,i+=(t^n&(e^t))+(o[14]??0)-1019803690,i=(i<<9|i>>>23)+e<<0,n+=(e^t&(i^e))+(o[3]??0)-187363961,n=(n<<14|n>>>18)+i<<0,t+=(i^e&(n^i))+(o[8]??0)+1163531501,t=(t<<20|t>>>12)+n<<0,e+=(n^i&(t^n))+(o[13]??0)-1444681467,e=(e<<5|e>>>27)+t<<0,i+=(t^n&(e^t))+(o[2]??0)-51403784,i=(i<<9|i>>>23)+e<<0,n+=(e^t&(i^e))+(o[7]??0)+1735328473,n=(n<<14|n>>>18)+i<<0,t+=(i^e&(n^i))+(o[12]??0)-1926607734,t=(t<<20|t>>>12)+n<<0,a=t^n,e+=(a^i)+(o[5]??0)-378558,e=(e<<4|e>>>28)+t<<0,i+=(a^e)+(o[8]??0)-2022574463,i=(i<<11|i>>>21)+e<<0,s=i^e,n+=(s^t)+(o[11]??0)+1839030562,n=(n<<16|n>>>16)+i<<0,t+=(s^n)+(o[14]??0)-35309556,t=(t<<23|t>>>9)+n<<0,a=t^n,e+=(a^i)+(o[1]??0)-1530992060,e=(e<<4|e>>>28)+t<<0,i+=(a^e)+(o[4]??0)+1272893353,i=(i<<11|i>>>21)+e<<0,s=i^e,n+=(s^t)+(o[7]??0)-155497632,n=(n<<16|n>>>16)+i<<0,t+=(s^n)+(o[10]??0)-1094730640,t=(t<<23|t>>>9)+n<<0,a=t^n,e+=(a^i)+(o[13]??0)+681279174,e=(e<<4|e>>>28)+t<<0,i+=(a^e)+(o[0]??0)-358537222,i=(i<<11|i>>>21)+e<<0,s=i^e,n+=(s^t)+(o[3]??0)-722521979,n=(n<<16|n>>>16)+i<<0,t+=(s^n)+(o[6]??0)+76029189,t=(t<<23|t>>>9)+n<<0,a=t^n,e+=(a^i)+(o[9]??0)-640364487,e=(e<<4|e>>>28)+t<<0,i+=(a^e)+(o[12]??0)-421815835,i=(i<<11|i>>>21)+e<<0,s=i^e,n+=(s^t)+(o[15]??0)+530742520,n=(n<<16|n>>>16)+i<<0,t+=(s^n)+(o[2]??0)-995338651,t=(t<<23|t>>>9)+n<<0,e+=(n^(t|~i))+(o[0]??0)-198630844,e=(e<<6|e>>>26)+t<<0,i+=(t^(e|~n))+(o[7]??0)+1126891415,i=(i<<10|i>>>22)+e<<0,n+=(e^(i|~t))+(o[14]??0)-1416354905,n=(n<<15|n>>>17)+i<<0,t+=(i^(n|~e))+(o[5]??0)-57434055,t=(t<<21|t>>>11)+n<<0,e+=(n^(t|~i))+(o[12]??0)+1700485571,e=(e<<6|e>>>26)+t<<0,i+=(t^(e|~n))+(o[3]??0)-1894986606,i=(i<<10|i>>>22)+e<<0,n+=(e^(i|~t))+(o[10]??0)-1051523,n=(n<<15|n>>>17)+i<<0,t+=(i^(n|~e))+(o[1]??0)-2054922799,t=(t<<21|t>>>11)+n<<0,e+=(n^(t|~i))+(o[8]??0)+1873313359,e=(e<<6|e>>>26)+t<<0,i+=(t^(e|~n))+(o[15]??0)-30611744,i=(i<<10|i>>>22)+e<<0,n+=(e^(i|~t))+(o[6]??0)-1560198380,n=(n<<15|n>>>17)+i<<0,t+=(i^(n|~e))+(o[13]??0)+1309151649,t=(t<<21|t>>>11)+n<<0,e+=(n^(t|~i))+(o[4]??0)-145523070,e=(e<<6|e>>>26)+t<<0,i+=(t^(e|~n))+(o[11]??0)-1120210379,i=(i<<10|i>>>22)+e<<0,n+=(e^(i|~t))+(o[2]??0)+718787259,n=(n<<15|n>>>17)+i<<0,t+=(i^(n|~e))+(o[9]??0)-343485551,t=(t<<21|t>>>11)+n<<0,this.first?(this.h0=e+1732584193<<0,this.h1=t-271733879<<0,this.h2=n-1732584194<<0,this.h3=i+271733878<<0,this.first=!1):(this.h0=this.h0+e<<0,this.h1=this.h1+t<<0,this.h2=this.h2+n<<0,this.h3=this.h3+i<<0)}}const To=r=>new ny().update(r).arrayBuffer();function Io(...r){const e=r.reduce((i,a)=>i+a.length,0),t=new Uint8Array(e);let n=0;for(const i of r)t.set(i,n),n+=i.length;return t}function Ui(r,e){return[r.subarray(0,e),r.subarray(e,r.length)]}function iy(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}const ay=2,sy=2;function oy(r){let e=new Uint8Array,t=iy(r);const[n,i]=Ui(t,ay*4),a=new DataView(n.buffer);return a.getInt32(0)===1398893684&&a.getInt32(4)===1701076831&&([e,t]=Ui(i,sy*4)),{ciphertext:t,salt:e}}function cy(r,e,t,n){let i=new Uint8Array,a=new Uint8Array;for(;i.byteLength<t*4;){a=To(Io(a,r,e));for(let s=1;s<n;s++)a=To(a);a=new Uint8Array(a),i=Io(i,a)}return i}async function ly(r,e,t,n,i){const a=new TextEncoder().encode(r),s=cy(a,e,t+n,i),[o,c]=Ui(s,t*4);return{key:await crypto.subtle.importKey("raw",o,"AES-CBC",!1,["decrypt"]),iv:c}}async function uy(r,e,{keySizeInt32:t=8,ivSizeInt32:n=4,iterations:i=1}={}){const{salt:a,ciphertext:s}=oy(r),{key:o,iv:c}=await ly(e,a,t,n,i),l=await crypto.subtle.decrypt({name:"AES-CBC",iv:c},o,s);return new TextDecoder().decode(l)}var dy=Object.defineProperty,fy=Object.getOwnPropertyDescriptor,py=(r,e,t,n)=>{for(var i=fy(e,t),a=r.length-1,s;a>=0;a--)(s=r[a])&&(i=s(e,t,i)||i);return i&&dy(e,t,i),i};const hy=r=>{if(!r.ok)throw new Error(`Server responded with a ${r.status} status code`);return r},my=r=>{if(!Array.isArray(r)||r.length===0)throw new Error("Invalid coupon applier config list structure");const e=[];for(const n of r)try{e.push(ty.parse(n))}catch{console.warn("Invalid coupon applier config",JSON.stringify(n))}const t=e.length/r.length;return t<1&&console.warn("Valid coupon applier config ratio is under 100%",t),e};class Ro{constructor(e){p(this,"configsRepository");this.configsRepository=e}async getConfigByMerchantId(e){return this.configsRepository.get(`${e}`)}async updateCouponApplierConfigCache(){const e=await this.fetchConfigs();await this.configsRepository.clear(),await Promise.all(e.map(async t=>{t.storeID===void 0||t.storeID===""||await this.configsRepository.set(t.storeID,t)}))}async fetchConfigs(){return fetch("https://drivers-extension.poulpeo.io/latest/a4c-drivers.json").then(hy).then(async e=>e.text()).then(async e=>uy(e,"N1gE77itqfhygc8vGGWwA4FK6583nxUGx06iAlF2")).then(e=>JSON.parse(e)).then(my)}}py([oe({abortOnThrow:!0})],Ro.prototype,"fetchConfigs");var gy=Object.defineProperty,yy=Object.getOwnPropertyDescriptor,by=(r,e,t,n)=>{for(var i=yy(e,t),a=r.length-1,s;a>=0;a--)(s=r[a])&&(i=s(e,t,i)||i);return i&&gy(e,t,i),i};class Po{constructor(e,t,n){p(this,"indexedDbBasedRepository");p(this,"localStorageBasedRepository");p(this,"sessionStorageBasedRepository");this.indexedDbBasedRepository=e,this.localStorageBasedRepository=t,this.sessionStorageBasedRepository=n}async checkStorageHealth(){}async checkRepositoryAccess(e){let t=!1;try{const n=`${"x".repeat(1e3)}.${Math.random()}`;await e.set("randomValue",n);const i=await e.get("randomValue");await e.remove("randomValue"),t=i===n}catch{}if(!t)throw new Error("Stockage corrompu ou satur")}}by([oe({abortOnThrow:!0})],Po.prototype,"checkRepositoryAccess");var _y=Object.defineProperty,vy=Object.getOwnPropertyDescriptor,wy=(r,e,t,n)=>{for(var i=vy(e,t),a=r.length-1,s;a>=0;a--)(s=r[a])&&(i=s(e,t,i)||i);return i&&_y(e,t,i),i};class Oo{constructor(e){p(this,"repository");this.repository=e}async getBonusesByMerchantId(e){let t=await this.getCachedMerchantBonusesByMerchantId(e);return t===void 0&&(t=await this.fetchMerchantBonusesByMerchantId(e),await this.cacheMerchantBonusesByMerchantId(e,t)),t}async updateBonusesByMerchantIdCache(e){const t=await this.fetchMerchantBonusesByMerchantId(e);return this.cacheMerchantBonusesByMerchantId(e,t)}async fetchMerchantBonusesByMerchantId(e){const t=await ye["/merchants/{id}/merchantBonuses"].get({params:{id:e}});if(!t.ok)throw new Error("Unable to fetch merchant bonuses");const n=await t.json(),i=new Intl.NumberFormat("fr-FR");return Array.isArray(n.data)?n.data.map(a=>{var s,o,c,l,u,d,f;return{grade:{value:((s=a.attributes)==null?void 0:s.gradeId)??-1,slug:((o=a.attributes)==null?void 0:o.gradeId)===3?"plp+":""},dateStart:(c=a.attributes)==null?void 0:c.dateStart,dateEnd:(l=a.attributes)==null?void 0:l.dateEnd,text:(((u=a.attributes)==null?void 0:u.amount)??0)>0?`${i.format(((d=a.attributes)==null?void 0:d.amount)??0)}${((f=a.attributes)==null?void 0:f.type)==="percent"?"%":""}`:""}}):[]}async cacheMerchantBonusesByMerchantId(e,t){return this.repository.set(`${e}`,t)}async getCachedMerchantBonusesByMerchantId(e){return this.repository.get(`${e}`)}}wy([oe({allowConcurrentCallWhenDifferentArgs:!0,abortOnThrow:!0})],Oo.prototype,"getBonusesByMerchantId");var Sy=Object.defineProperty,ky=Object.getOwnPropertyDescriptor,Ey=(r,e,t,n)=>{for(var i=ky(e,t),a=r.length-1,s;a>=0;a--)(s=r[a])&&(i=s(e,t,i)||i);return i&&Sy(e,t,i),i};class No{constructor(e){p(this,"repository");this.repository=e}async getOffersByMerchantId(e){let t=await this.getCachedOffersByMerchantId(e);return t===void 0&&(t=await this.fetchOffersByMerchantId(e),await this.cacheOffersByMerchantId(e,t)),t}async updateOffersByMerchantIdCache(e){const t=await this.fetchOffersByMerchantId(e);return this.cacheOffersByMerchantId(e,t)}async fetchOffersByMerchantId(e){if(!Number.isInteger(e))throw new Error("Invalid merchant ID");const t=await ye["/merchants/{id}/offers"].get({params:{id:e},query:{include:{offer:"merchant"}}});if(!t.ok)throw new Error("Unable to fetch merchant offers");return(await t.json()).data.map(i=>oo(i,[]))}async cacheOffersByMerchantId(e,t){return this.repository.set(`${e}`,t)}async getCachedOffersByMerchantId(e){return this.repository.get(`${e}`)}}Ey([oe({allowConcurrentCallWhenDifferentArgs:!0,abortOnThrow:!0})],No.prototype,"getOffersByMerchantId");function xy(r){return{domainByLevel:r.split(".").reverse(),wildcardCount:r.split(".").filter(e=>e==="*").length}}function Ay(r,e){if(r.domainByLevel.length>e.domainByLevel.length)return 1;if(r.domainByLevel.length<e.domainByLevel.length)return-1;if(r.wildcardCount!==e.wildcardCount)return r.wildcardCount>e.wildcardCount?-1:1;for(let t=0;t<r.domainByLevel.length;t++)if(r.domainByLevel[t]!==e.domainByLevel[t])return r.domainByLevel[t]<e.domainByLevel[t]?-1:1;return 0}function Cy(r,e){const t=r.split(".").reverse();if(t.length<e.domainByLevel.length||t.length>e.domainByLevel.length&&e.domainByLevel[e.domainByLevel.length-1]!=="*")return!1;for(let n=0;n<e.domainByLevel.length;n++)if(e.domainByLevel[n]!=="*"&&e.domainByLevel[n]!==t[n])return!1;return!0}function Ty(r,e){const t=r.split(".").reverse();return(t[0]===e.domainByLevel[0]||e.domainByLevel[0]==="*")&&(t[1]===e.domainByLevel[1]||e.domainByLevel[1]==="*"||e.domainByLevel[1]===void 0)}function Iy(r){return{prefix:r.replace(/\*$/,""),prefixDepth:Math.max(1,r.split("/").length-1),isWildcard:r.endsWith("*")}}function Ry(r,e){return r.prefixDepth>e.prefixDepth?1:r.prefixDepth<e.prefixDepth?-1:r.isWildcard!==e.isWildcard?r.isWildcard?-1:1:r.prefix.length!==e.prefix.length?r.prefix.length<e.prefix.length?-1:1:0}function Py(r,e){if(r===e.prefix)return!0;if(!e.isWildcard)return!1;if(e.prefix==="")return!0;const t=e.prefix,n=t.endsWith("/")?t:`${t}/`;return r.startsWith(n)}function Oy(r){const[e,t]=r.split("=");return{name:e,value:t,isWildcard:t==="*"||t===void 0}}function Ny(r){return{parameterRuleList:r.replace(/^\?/,"").split("&").filter(e=>e!=="").map(Oy)}}function My(r,e){return r.parameterRuleList.length>e.parameterRuleList.length?1:r.parameterRuleList.length<e.parameterRuleList.length?-1:0}function Dy(r,e){const[t,n]=r.split("=");return e.name===t&&(e.isWildcard||e.value===n)}function Uy(r,e){const t=r.replace(/^\?/,"").split("&");return e.parameterRuleList.filter(i=>!t.some(a=>Dy(a,i))).length===0}function Mo(r,e){let t,n;const i=r.startsWith("!");if(r.includes("*")){const s=r.split("/");s[1]===""&&s.length>2&&(s[2]=s[2].replace(/\*/g,"wildcardchar"));const o=s.join("/");t=new URL(i?o.substring(1):o),n=t.host.replace(/wildcardchar/g,"*"),n=n.replace(/\*$/,"")}else t=new URL(i?r.substring(1):r),n=t.host;const a=/(\*|\.[a-z]+)$/i.test(t.pathname)?"":"*";return{rule:r,domain:xy(n),path:Iy(t.pathname+a),query:Ny(t.search),isException:i,merchantId:e}}function jy(r,e){const t=Ay(r.domain,e.domain);return t!==0?t:r.isException!==e.isException?r.isException?1:-1:Ry(r.path,e.path)||My(r.query,e.query)}function $y(r,e){return Cy(r.host,e.domain)&&Py(r.pathname,e.path)&&Uy(r.search,e.query)}function Ly(r){const e=new Map,t=[];return Array.isArray(r)?(r.forEach(n=>{var i;try{const a=Mo(`${n.attributes.url}`,+n.id),s=a.domain.domainByLevel.slice(0,2).reverse().join("."),o=(i=e.get(s))!==null&&i!==void 0?i:[];o.push(a),Array.isArray(n.attributes.additionalDomains)&&n.attributes.additionalDomains.forEach(c=>{o.push(Mo(`${c}`,+n.id))}),o.sort(jy),e.set(s,o)}catch{t.push(new Error(`Invalid item: ${JSON.stringify(n)}`))}}),[e,t]):(t.push(new Error(`Invalid data: ${JSON.stringify(r)}`)),[e,t])}function Fy(r,e,t=!0){return qy(Vy(r,e,n=>n.isException||t?$y(r,n):Ty(r.hostname,n.domain)))}function Vy(r,e,t){var n;return e instanceof Map&&(e=(n=e.get(ji(r.hostname)))!==null&&n!==void 0?n:[]),e.filter(i=>t(i,r))}function ji(r){return r.split(".").slice(-2).join(".")}function qy(r){const e=new Map,t=[];return r.forEach(n=>{e.set(n.merchantId,n)}),e.forEach((n,i)=>{n.isException||t.push(i)}),t}var Wy=Object.defineProperty,Hy=Object.getOwnPropertyDescriptor,Zy=(r,e,t,n)=>{for(var i=Hy(e,t),a=r.length-1,s;a>=0;a--)(s=r[a])&&(i=s(e,t,i)||i);return i&&Wy(e,t,i),i};class Do{constructor(e){p(this,"allMerchantRulesKey","all-merchant-rules");p(this,"repository");p(this,"rulesPrimaryCache");p(this,"findMerchantsMatchingUrlCache");this.repository=e}async findMerchantsMatchingUrl(e,t=!1){const n=this.findMerchantsMatchingUrlCache;if((n==null?void 0:n.url)===e&&n.strict===t)return n.merchantIds;let i;try{i=new URL(e)}catch{return[]}if(i.protocol!=="http:"&&i.protocol!=="https:")return[];const s=t||[".google.com",".co.uk"].some(l=>i==null?void 0:i.hostname.endsWith(l)),o=await this.getMerchantRules(),c=Fy(i,o,s);return this.findMerchantsMatchingUrlCache={url:e,strict:s,merchantIds:c},c}async getMerchantRules(){let e=await this.getCachedMerchantRules();return e===void 0&&(e=await this.fetchMerchantRules(),await this.cacheMerchantRules(e)),e}async updateMerchantRulesCache(){const e=await this.fetchMerchantRules();return this.cacheMerchantRules(e)}async fetchMerchantRules(){const e=await ye["/merchants/all"].get({query:{fields:{merchant:"url,additionalDomains"}}});if(!e.ok)throw new Error("Unable to fetch merchant rules");const t=await e.json(),[n,i]=Ly(t.data);return i.forEach(console.warn),n}async cacheMerchantRules(e){return this.rulesPrimaryCache=e,this.findMerchantsMatchingUrlCache=void 0,this.repository.set(this.allMerchantRulesKey,Array.from(e))}async getCachedMerchantRules(){if(this.rulesPrimaryCache!==void 0)return this.rulesPrimaryCache;const e=await this.repository.get(this.allMerchantRulesKey);if(Array.isArray(e))return new Map(e)}}Zy([oe()],Do.prototype,"getMerchantRules");var Ky=Object.defineProperty,Gy=Object.getOwnPropertyDescriptor,$i=(r,e,t,n)=>{for(var i=Gy(e,t),a=r.length-1,s;a>=0;a--)(s=r[a])&&(i=s(e,t,i)||i);return i&&Ky(e,t,i),i};class pn{constructor(e,t){p(this,"repository");p(this,"merchantRulesService");this.repository=e,this.merchantRulesService=t}async getMerchantById(e){let t=await this.getCachedMerchantById(e);return t===void 0&&(t=await this.fetchMerchantById(e),await this.cacheMerchantById(e,t)),t}async getMerchantsByIds(e){if(e.length===0)return[];let t=(await Promise.all(e.map(n=>this.getCachedMerchantById(n)))).filter(n=>n!==void 0);if(t.length<e.length){t=await this.fetchMerchantsByIds(e);for(const n of t)await this.cacheMerchantById(n.id,n)}return t}async getMerchantsByUrl(e){const t=await this.merchantRulesService.findMerchantsMatchingUrl(e);return(await this.getMerchantsByIds(t)).filter(i=>i.extensionDetectionAndDisplayStatus)}async updateMerchantByIdCache(e){const t=await this.fetchMerchantById(e);return this.cacheMerchantById(e,t)}async fetchMerchantById(e){if(!Number.isInteger(e))throw new Error("Invalid merchant ID");const t=await ye["/merchants/{id}"].get({params:{id:e},query:{fields:{merchant:"*"},include:{merchant:"currentCashbackObject,merchantInfo"}}});if(!t.ok)throw new Error("Unable to fetch merchant");const n=await t.json(),i=Ut(n.data,n.included);if(i===void 0)throw new Error("Unable to fetch merchant");return i}async fetchMerchantsByIds(e){if(!e.every(i=>Number.isInteger(i)))throw new Error("Invalid merchant ID list");const t=await ye["/merchants/find"].get({query:{fields:{merchant:"*"},filter:{merchantIdList:e.join(",")},include:{merchant:"currentCashbackObject,merchantInfo"},offset:0,limit:e.length}});if(!t.ok)throw new Error("Unable to fetch merchant list");const n=await t.json();if(!Array.isArray(n.data))throw new Error("Unable to parse merchant list");return n.data.map(i=>{const a=Ut(i,n.included);if(a===void 0)throw new Error("Unable to parse merchant list");return a})}async cacheMerchantById(e,t){return this.repository.set(`${e}`,t)}async getCachedMerchantById(e){return this.repository.get(`${e}`)}}$i([oe({allowConcurrentCallWhenDifferentArgs:!0,abortOnThrow:!0})],pn.prototype,"getMerchantById"),$i([oe({allowConcurrentCallWhenDifferentArgs:!0,abortOnThrow:!0})],pn.prototype,"getMerchantsByIds"),$i([oe({allowConcurrentCallWhenDifferentArgs:!0,abortOnThrow:!0})],pn.prototype,"getMerchantsByUrl");const zy=60*60*1e3;class By{constructor(e,t,n){p(this,"notificationIdValidationRegex",/^[^|]+\|[^|]*\|[^|]*$/);p(this,"repository");p(this,"messagingService");p(this,"tabsService");p(this,"eventBus",null);this.repository=e,this.messagingService=t,this.tabsService=n}getPublishTarget(){return this.eventBus}setPublishTarget(e){this.eventBus=e}async deleteExpiredNotificationLocks(){const e=await this.repository.keys();await Promise.all(e.map(async t=>{const n=await this.repository.get(t);if(n!==void 0&&n<Date.now())return this.repository.remove(t)}))}isValidNotificationEventType(e){return typeof e=="string"&&["click","close","show"].includes(e)}isValidNotificationId(e){return typeof e=="string"&&this.notificationIdValidationRegex.test(e)}async releaseNotificationLock(e){return await this.repository.get(e)===void 0?!1:(await this.repository.remove(e),!0)}async requestNotificationLock(e,t){return(await this.repository.get(e)??-1)>Date.now()?!1:(await this.repository.set(e,Date.now()+t),!0)}async showNotification(e,t=zy){try{return await this.messagingService.sendMessageWithReply({type:"showNotification",payload:{notification:e,delayBeforeNextNotificationWithSameIdInMs:t}},{tabId:(await this.tabsService.getCurrentTab()).id}),!0}catch{return!1}}trackNotificationEvent(e,t){var n,i,a;switch(e){case"click":(n=this.eventBus)==null||n.publish({type:"notificationClicked",details:{notificationId:t}});break;case"close":(i=this.eventBus)==null||i.publish({type:"notificationClosed",details:{notificationId:t}});break;case"show":(a=this.eventBus)==null||a.publish({type:"notificationShown",details:{notificationId:t}});break}}}class Jy{constructor(e,t){p(this,"repository");p(this,"parametersConfig");p(this,"eventBus",null);this.repository=e,this.parametersConfig=t}getPublishTarget(){return this.eventBus}setPublishTarget(e){this.eventBus=e}async getAllParameters(){const e={};let t;for(t in this.parametersConfig)e[t]=await this.getParameter(t);return e}async getParameter(e,t){const n=this.parametersConfig[e],i=await this.repository.get(e),a=t??n.defaultValue;return i==null?a:n.validate(i)?i:(console.error(new Error(`${e} value ${String(i)} is not a valid value. Returning default value ${a.toString()}`)),a)}async updateParameter(e,t){var n;if(t===this.parametersConfig[e].defaultValue)await this.repository.remove(e);else{if(!this.parametersConfig[e].validate(t))throw Error(`Value ${String(t)} is not valid for parameter ${e}`);await this.repository.set(e,t)}(n=this.getPublishTarget())==null||n.publish({type:"parameterUpdated",details:{parameter:e,value:t}})}async removeParameter(e){var t;await this.repository.remove(e),(t=this.getPublishTarget())==null||t.publish({type:"parameterRemoved",details:{parameter:e}})}}class Yy{constructor(e){p(this,"repository");p(this,"eventBus",null);this.repository=e}getPublishTarget(){return this.eventBus}setPublishTarget(e){this.eventBus=e}async getSelectedMerchantId(e,t){const n=await this.repository.get(`${e}`);if(n!==void 0){if(n.domain!==ji(t.hostname)){await this.clearSelectedMerchantId(e);return}return n.merchantId}}async setSelectedMerchantId(e,t,n){var s;const i={tabId:e,domain:ji(t.hostname),merchantId:n},a=await this.repository.get(`${e}`);(a==null?void 0:a.domain)===i.domain&&a.merchantId===i.merchantId||(await this.repository.set(`${e}`,i),(s=this.eventBus)==null||s.publish({type:"merchantSelected",details:i}))}async clearSelectedMerchantId(e){return this.repository.remove(`${e}`)}}var Xy=Object.defineProperty,Qy=Object.getOwnPropertyDescriptor,eb=(r,e,t,n)=>{for(var i=Qy(e,t),a=r.length-1,s;a>=0;a--)(s=r[a])&&(i=s(e,t,i)||i);return i&&Xy(e,t,i),i};class Uo{constructor(e){p(this,"repository");this.repository=e}async getSimilarMerchantsByMerchantId(e){let t=await this.getCachedSimilarMerchantsByMerchantId(e);return t===void 0&&(t=await this.fetchSimilarMerchantByMerchantId(e),await this.cacheSimilarMerchantsByMerchantId(e,t)),t}async updateSimilarMerchantsByMerchantIdCache(e){const t=await this.fetchSimilarMerchantByMerchantId(e);return this.cacheSimilarMerchantsByMerchantId(e,t)}async fetchSimilarMerchantByMerchantId(e){const t=await ye["/merchants/{id}/similarMerchants"].get({params:{id:e},query:{fields:{merchant:"*"},include:{merchant:"currentCashbackObject,merchantInfo"},offset:0,limit:20}});if(!t.ok)throw new Error("Unable to fetch similar merchants");const n=await t.json();return n.data.map(i=>Ut(i,n.included)).filter(i=>_i(i==null?void 0:i.cashback)).slice(0,6)}async cacheSimilarMerchantsByMerchantId(e,t){return this.repository.set(`${e}`,t)}async getCachedSimilarMerchantsByMerchantId(e){return this.repository.get(`${e}`)}}eb([oe({allowConcurrentCallWhenDifferentArgs:!0,abortOnThrow:!0})],Uo.prototype,"getSimilarMerchantsByMerchantId");var tb=Object.defineProperty,rb=Object.getOwnPropertyDescriptor,nb=(r,e,t,n)=>{for(var i=rb(e,t),a=r.length-1,s;a>=0;a--)(s=r[a])&&(i=s(e,t,i)||i);return i&&tb(e,t,i),i};class jo{constructor(e){p(this,"repository");this.repository=e}async getSingleUseCode(e,t,n){let i=await this.getCachedSingleUseCode(e,t);return i===void 0&&(i=await Kh(ye,e,t,n),await this.cacheSingleUseCode(e,t,i)),i}async getCachedSingleUseCodes(e){const t=await this.repository.keys();return Promise.all(t.map(async n=>this.repository.get(n).then(i=>({offerId:+n.substring(0,n.lastIndexOf(`-${e}`)),code:i??""}))))}async cacheSingleUseCode(e,t,n){return this.repository.set(`${e}-${t}`,n)}async getCachedSingleUseCode(e,t){return this.repository.get(`${e}-${t}`)}}nb([oe({allowConcurrentCallWhenDifferentArgs:!0,abortOnThrow:!0})],jo.prototype,"getSingleUseCode");class ib{constructor(e){p(this,"repository");this.repository=e}async getRequestsHistory(e){return this.repository.get(`${e}`)}async addRequestToHistory(e,t){const n=await this.repository.get(`${e}`)??[];n.unshift(t),n.sort((s,o)=>s.timestamp>o.timestamp?-1:1);const i=Date.now()-60*1e3,a=n.findIndex(s=>s.timestamp<i);return a>-1&&(n.length=a),n.length>20&&(n.length=20),this.repository.set(`${e}`,n)}async removeRequestsBefore(e,t){const n=await this.repository.get(`${e}`)??[],i=n.findIndex(a=>a.timestamp===t.timestamp&&a.url===t.url);if(i>-1)n.length=i+1;else{const a=n.findIndex(s=>s.timestamp<t.timestamp);a>-1&&(n.length=a)}return this.repository.set(`${e}`,n)}async deleteRequestsHistory(e){return this.repository.remove(`${e}`)}}var ab=Object.defineProperty,sb=Object.getOwnPropertyDescriptor,ob=(r,e,t,n)=>{for(var i=sb(e,t),a=r.length-1,s;a>=0;a--)(s=r[a])&&(i=s(e,t,i)||i);return i&&ab(e,t,i),i};class $o{constructor(e){p(this,"repository");this.repository=e}async getTrustpilotReviews(e,t){let n=await this.getCachedTrustpilotReviews(e,t);return n===void 0&&(n=await co(ye,e,t),await this.cacheTrustpilotReviews(e,t??0,n)),n}async updateTrustpilotReviewsCache(e,t){const n=await co(ye,e,t);return this.cacheTrustpilotReviews(e,t??0,n)}async cacheTrustpilotReviews(e,t,n){return this.repository.set(`${e}-${t}`,n)}async getCachedTrustpilotReviews(e,t){return this.repository.get(`${e}-${t??0}`)}}ob([oe({allowConcurrentCallWhenDifferentArgs:!0,abortOnThrow:!0})],$o.prototype,"getTrustpilotReviews");class cb{constructor(e){p(this,"allUserClicksKey","all-user-clicks");p(this,"repository");this.repository=e}async getLastKnownUserClick(e){const t=await this.repository.get(this.allUserClicksKey)??[];return e===void 0?t[0]:t.find(n=>n.tabId===e)}async saveUserClick(e){const t=await this.repository.get(this.allUserClicksKey)??[];t.unshift(e),t.sort((a,s)=>a.timestamp>s.timestamp?-1:1);const n=Date.now()-60*1e3,i=t.findIndex(a=>a.timestamp<n);i>-1&&(t.length=i),await this.repository.set(this.allUserClicksKey,t)}}var lb=Object.defineProperty,ub=Object.getOwnPropertyDescriptor,db=(r,e,t,n)=>{for(var i=ub(e,t),a=r.length-1,s;a>=0;a--)(s=r[a])&&(i=s(e,t,i)||i);return i&&lb(e,t,i),i};class Lo{constructor(e,t){p(this,"currentUserKey","current-user");p(this,"repository");p(this,"apiClient");this.repository=e,this.apiClient=t}async getCurrentUser(){let e=await this.repository.get(this.currentUserKey);return e===void 0&&(e=await this.fetchCurrentUser(),await this.repository.set(this.currentUserKey,e)),e}async clearCurrentUserCache(){await this.repository.remove(this.currentUserKey)}async fetchCurrentUser(){const e=await this.apiClient.get({endpoint:"/user/get.json"});if(typeof e.id_user!="number"||typeof e.fp!="string")throw new Error("User document from Poulpeo API is missing required fields");const t=e.earning_amount!==null&&typeof e.earning_amount=="object"?e.earning_amount:null,n=e.grade!==null&&typeof e.grade=="object"?e.grade:{},i=e.id_user>0,a=(s,o)=>Number.parseFloat(String(t==null?void 0:t[s]))||o;return{id:e.id_user,fp:e.fp,dateAdd:Number.parseInt(String(e.date_add))||void 0,email:String(e.email??""),login:String(e.login??""),sponsorKey:String(e.sponsor_code??""),isLogged:i,isPoulpeoPlus:n.id_grade===3,earningsAmount:{accepted:a("accepted",0),acceptedPlusPaid:a("accepted_plus_paid",0),acceptedPlusPaidPlusPending:a("accepted_plus_paid_plus_pending",i?0:3),acceptedPlusPending:a("accepted_plus_pending",i?0:3),paid:a("paid",0),paymentThreshold:a("payment_threshold",0),pending:a("pending",i?0:3)}}}}db([oe({abortOnThrow:!0})],Lo.prototype,"getCurrentUser");class fb{constructor(e){p(this,"localRepository");this.localRepository=e}async clearLegacyData(){await Promise.all([this.localRepository.remove("cld-tracking"),this.localRepository.remove("param"),this.localRepository.remove("poulpeo")])}async getLegacyInstallationDetails(){let e;try{const t=await this.localRepository.get("poulpeo"),n=JSON.parse(t??"");n!==null&&typeof n=="object"&&(e=n)}catch{return}if(e!==void 0&&this.isUUIDv4(e.uuid))return{uuid:e.uuid}}async getLegacyParameters(){let e;try{const a=await this.localRepository.get("param"),s=JSON.parse(a??"");s!==null&&typeof s=="object"&&(e=s)}catch{return}if(e===void 0)return;const n={...{SHOW_ONBOARDING_NOTIFICATION_ON_MERCHANT:!0,ENABLE_SERP_SNIPPET:!0,ENABLE_SHOPPING_BAR_ON_ALL_MERCHANTS:!0,SHOPPING_BAR_EXPANDED:!0,ALLOW_ANALYTICS:!1,ALLOW_INTERNAL_TRACKING:!1,ALLOW_ISSUE_TRACKING:!1,EXTENSION_VERSION:"0.0.0",SHOPPING_BAR_MERCHANT_BLACKLIST:[],ENABLE_AUTOTEST_AVAILABLE_NOTIFICATIONS:{value:!0},AUTOTEST_AVAILABLE_NOTIFICATIONS_MERCHANT_BLACKLIST:[],ENABLE_CASHBACK_DEACTIVATION_NOTIFICATIONS:{value:!0},CASHBACK_DEACTIVATION_NOTIFICATIONS_MERCHANT_BLACKLIST:[],ENABLE_CASHBACK_INCREASE_NOTIFICATIONS:{value:!0},CASHBACK_INCREASE_NOTIFICATIONS_MERCHANT_BLACKLIST:[],FIRST_USAGE_EVENT_SENT:!1}};let i;for(i in n)typeof e[i]==typeof n[i]&&(n[i]=e[i]);return n}isUUIDv4(e){return typeof e=="string"&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}}class Zt{constructor(e,t){p(this,"namespace");p(this,"repository");this.namespace=e,this.repository=t}async keys(){return Promise.resolve((await this.repository.keys()).filter(e=>e.startsWith(`${this.namespace}|`)).map(e=>e.substring(`${this.namespace}|`.length)))}async get(e){return this.repository.get(`${this.namespace}|${e}`)}async set(e,t){return this.repository.set(`${this.namespace}|${e}`,t)}async remove(e){return this.repository.remove(`${this.namespace}|${e}`)}async clear(e=""){return this.repository.clear(`${this.namespace}|${e}`)}}const pb={version:"20.0.0",async migrate(r,e,t){const n=new Zt("parameter",t);await n.set("extension_installation_id",crypto.randomUUID());const i=new fb(t),a=await i.getLegacyInstallationDetails();a!==void 0&&await n.set("extension_installation_id",a.uuid);const s=await i.getLegacyParameters();if(s!==void 0){const o=s.ALLOW_ANALYTICS&&s.ALLOW_INTERNAL_TRACKING&&s.ALLOW_ISSUE_TRACKING;await n.set("privacy_allow_required_tracking",o),await n.set("privacy_allow_performance_tracking",o),await n.set("extension_first_usage_tracking",s.FIRST_USAGE_EVENT_SENT?"done":"pending")}await i.clearLegacyData()}},hb={version:"20.2.0",async migrate(r,e,t){const n=(r??"0.0.0")==="0.0.0",i=new Zt("parameter",t);await i.get("sidebar_show_strategy")===void 0&&await i.set("sidebar_show_strategy",n?"merchants-only":"always")}},Li=(r,e)=>e.some(t=>r instanceof t);let Fo,Vo;function mb(){return Fo||(Fo=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function gb(){return Vo||(Vo=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Fi=new WeakMap,Vi=new WeakMap,hn=new WeakMap;function yb(r){const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("success",a),r.removeEventListener("error",s)},a=()=>{t(vt(r.result)),i()},s=()=>{n(r.error),i()};r.addEventListener("success",a),r.addEventListener("error",s)});return hn.set(e,r),e}function bb(r){if(Fi.has(r))return;const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("complete",a),r.removeEventListener("error",s),r.removeEventListener("abort",s)},a=()=>{t(),i()},s=()=>{n(r.error||new DOMException("AbortError","AbortError")),i()};r.addEventListener("complete",a),r.addEventListener("error",s),r.addEventListener("abort",s)});Fi.set(r,e)}let qi={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return Fi.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return vt(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function qo(r){qi=r(qi)}function _b(r){return gb().includes(r)?function(...e){return r.apply(Wi(this),e),vt(this.request)}:function(...e){return vt(r.apply(Wi(this),e))}}function vb(r){return typeof r=="function"?_b(r):(r instanceof IDBTransaction&&bb(r),Li(r,mb())?new Proxy(r,qi):r)}function vt(r){if(r instanceof IDBRequest)return yb(r);if(Vi.has(r))return Vi.get(r);const e=vb(r);return e!==r&&(Vi.set(r,e),hn.set(e,r)),e}const Wi=r=>hn.get(r);function wb(r,e,{blocked:t,upgrade:n,blocking:i,terminated:a}={}){const s=indexedDB.open(r,e),o=vt(s);return n&&s.addEventListener("upgradeneeded",c=>{n(vt(s.result),c.oldVersion,c.newVersion,vt(s.transaction),c)}),t&&s.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),o.then(c=>{a&&c.addEventListener("close",()=>a()),i&&c.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),o}const Sb=["get","getKey","getAll","getAllKeys","count"],kb=["put","add","delete","clear"],Hi=new Map;function Wo(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(Hi.get(e))return Hi.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,i=kb.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||Sb.includes(t)))return;const a=async function(s,...o){const c=this.transaction(s,i?"readwrite":"readonly");let l=c.store;return n&&(l=l.index(o.shift())),(await Promise.all([l[t](...o),i&&c.done]))[0]};return Hi.set(e,a),a}qo(r=>({...r,get:(e,t,n)=>Wo(e,t)||r.get(e,t,n),has:(e,t)=>!!Wo(e,t)||r.has(e,t)}));const Eb=["continue","continuePrimaryKey","advance"],Ho={},Zi=new WeakMap,Zo=new WeakMap,xb={get(r,e){if(!Eb.includes(e))return r[e];let t=Ho[e];return t||(t=Ho[e]=function(...n){Zi.set(this,Zo.get(this)[e](...n))}),t}};async function*Ab(...r){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...r)),!e)return;e=e;const t=new Proxy(e,xb);for(Zo.set(t,e),hn.set(t,Wi(e));e;)yield t,e=await(Zi.get(t)||e.continue()),Zi.delete(t)}function Ko(r,e){return e===Symbol.asyncIterator&&Li(r,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&Li(r,[IDBIndex,IDBObjectStore])}qo(r=>({...r,get(e,t,n){return Ko(e,t)?Ab:r.get(e,t,n)},has(e,t){return Ko(e,t)||r.has(e,t)}}));const Cb="indexeddb-based-repositories",Go=new Map([[1,{added:["affiliate-domains","container","coupon-applier-config","merchant-bonuses","merchant-offers","merchant","merchant-rules","parameter","poulpeo-to-cloud-merchant-id-map","selected-merchant","similar-merchants","single-use-offer-code","user"],removed:[]}],[2,{added:["affiliate-network","health-check","trustpilot-reviews"],removed:["affiliate-domains","poulpeo-to-cloud-merchant-id-map"]}]]);class mn{constructor(e,t){p(this,"storeName");p(this,"canStoreBeClearedOnWriteFailure");p(this,"dbPromise");this.storeName=e,this.canStoreBeClearedOnWriteFailure=t;const n=Math.max(...Go.keys());this.dbPromise=wb(Cb,n,{upgrade:(i,a)=>{for(const[s,{added:o,removed:c}]of Go)if(s>a){for(const l of o)i.objectStoreNames.contains(l)||i.createObjectStore(l);for(const l of c)i.objectStoreNames.contains(l)&&i.deleteObjectStore(l)}i.objectStoreNames.contains(this.storeName)||(console.error(new Error(`'${this.storeName}' is missing from IDB schema`),"IndexedDbBasedRepository","constructor"),i.createObjectStore(this.storeName))}})}async keys(){return(await this.dbPromise).getAllKeys(this.storeName)}async get(e){return(await this.dbPromise).get(this.storeName,e).catch(async t=>{if(console.warn("IndexedDbBasedRepository","get",e,"failure"),String(t).includes("Failed to read large IndexedDB value"))return this.remove(e).then(()=>{console.error(t)});if(["connection is closing","transaction timed out due to inactivity"].some(i=>String(t).toLowerCase().includes(i))){console.error(t);return}throw t})}async set(e,t){return(await this.dbPromise).put(this.storeName,t,e).catch(async n=>{if(console.warn("IndexedDbBasedRepository","set",e,"failure"),String(n).includes("Failed to write")&&this.canStoreBeClearedOnWriteFailure)return this.clear().then(()=>{console.error(n)});throw n}).then()}async remove(e){return(await this.dbPromise).delete(this.storeName,e)}async clear(e=""){const t=await this.dbPromise;if(!await t.objectStoreNames.contains(this.storeName))return;if(e==="")return t.clear(this.storeName);const n=await t.getAllKeys(this.storeName);await Promise.all(n.map(async i=>typeof i=="string"&&i.startsWith(e)?t.delete(this.storeName,i):Promise.resolve()))}}const Tb={version:"20.3.0",async migrate(r,e,t){const n=new Zt("parameters",t),i=new mn("parameter",!1),a={extension_first_usage_tracking:{defaultValue:"pending",validate:s=>s==="pending"||s==="done"},extension_version:{defaultValue:"0.0.0",validate:s=>typeof s=="string"&&/^\d+\.\d+\.\d+$/.test(s)},extension_installation_id:{defaultValue:"aaaaaaaa-aaaa-4aaa-aaaa-aaaaaaaaaaaa",validate:s=>typeof s=="string"&&/[a-f0-9]{8}-?[a-f0-9]{4}-?4[a-f0-9]{3}-?[89ab][a-f0-9]{3}-?[a-f0-9]{12}/i.test(s)},extension_session_id:{defaultValue:"aaaaaaaa-aaaa-4aaa-aaaa-aaaaaaaaaaaa",validate:s=>typeof s=="string"&&/[a-f0-9]{8}-?[a-f0-9]{4}-?4[a-f0-9]{3}-?[89ab][a-f0-9]{3}-?[a-f0-9]{12}/i.test(s)},gift_card_cashback_tab_seen:{defaultValue:!0,validate:s=>typeof s=="boolean"},notification_show_on_merchant_visit:{defaultValue:!0,validate:s=>typeof s=="boolean"},notification_show_in_shopping_cart:{defaultValue:!0,validate:s=>typeof s=="boolean"},notifications_domain_blacklist:{defaultValue:[],validate:s=>Array.isArray(s)&&!s.some(o=>typeof o!="string")},privacy_allow_required_tracking:{defaultValue:!1,validate:s=>typeof s=="boolean"},privacy_allow_performance_tracking:{defaultValue:!1,validate:s=>typeof s=="boolean"},search_engine_show_offers:{defaultValue:!0,validate:s=>typeof s=="boolean"},search_engine_show_similar_merchants:{defaultValue:!0,validate:s=>typeof s=="boolean"},sidebar_opener_location:{defaultValue:"center",validate:s=>typeof s=="string"&&["bottom","center","top"].includes(s)},sidebar_open_method:{defaultValue:"on-click",validate:s=>typeof s=="string"&&["on-click","on-hover"].includes(s)},sidebar_hidden_on_domain_list:{defaultValue:[],validate:s=>Array.isArray(s)?s.every(o=>typeof o=="string"):!1},sidebar_show_strategy:{defaultValue:"merchants-only",validate:s=>typeof s=="string"&&["always","merchants-only","never"].includes(s)},sidebar_show_style:{defaultValue:"standard",validate:s=>typeof s=="string"&&["minimalist","standard"].includes(s)},super_cashback_tab_seen:{defaultValue:!0,validate:s=>typeof s=="boolean"}};await Promise.all(Object.entries(a).map(async([s,o])=>{const c=await n.get(s);o.validate(c)&&(await i.set(s,c),await n.remove(s))})),await t.clear()}};class Ib{async getMigrators(){return Promise.resolve([pb,hb,Tb])}}class zo{constructor(){p(this,"repository",new Map)}async keys(){return Promise.resolve(Array.from(this.repository.keys()))}async get(e){return Promise.resolve(this.repository.get(e))}async set(e,t){return this.repository.set(e,t),Promise.resolve()}async remove(e){return this.repository.delete(e),Promise.resolve()}async clear(e=""){if(e==="")this.repository.clear();else for(const t of this.repository.keys())t.startsWith(e)&&this.repository.delete(t);return Promise.resolve()}}class Bo{constructor(e){p(this,"accessedKeys",new Map);p(this,"repository",new Map);p(this,"persistentRepository");this.persistentRepository=e}async keys(){return this.persistentRepository.keys()}async get(e){if(this.accessedKeys.has(e))return this.repository.get(e);const t=await this.persistentRepository.get(e);return this.accessedKeys.set(e,!0),this.repository.set(e,t),t}async set(e,t){return this.accessedKeys.set(e,!0),this.repository.set(e,t),this.persistentRepository.set(e,t)}async remove(e){return this.accessedKeys.set(e,!0),this.repository.delete(e),this.persistentRepository.remove(e)}async clear(e=""){if(e==="")this.accessedKeys.clear(),this.repository.clear();else for(const t of this.repository.keys())t.startsWith(e)&&(this.accessedKeys.delete(t),this.repository.delete(t));return this.persistentRepository.clear(e)}}function Rb(r,e){var ic,ac,sc,oc;console.debug(`Starting ${r.isPersistent()?"persistent":"ephemeral"} background`);const t=new Bo(new mn("parameter",!1)),n=new Jy(t,lo),i=((ic=navigator.userAgentData)==null?void 0:ic.brands)??[];ru(vd,{dsn:"https://f3fc01481b564848a9468792f943f99b@sentry.io/1800537",debug:!1,release:`poulpeo-browser-extension@${r.getVersionName()}`,environment:"production",initialScope:{tags:{"browser.brand.0":((ac=i[0])==null?void 0:ac.brand)??"","browser.brand.1":((sc=i[1])==null?void 0:sc.brand)??"","browser.brand.2":((oc=i[2])==null?void 0:oc.brand)??""}},sendDefaultPii:!1,transport:Md,stackParser:Wd,integrations:[Yu({iteratee:K=>{var et;return K.filename=(et=K.filename)==null?void 0:et.replace(r.getFileUrl(""),"app:///"),K}}),Zd({dom:!1,history:!1,xhr:!1}),Mu({levels:["error"]}),ju(),qu(),mu(),of(),bu({ignoreErrors:["API call error","An unexpected error occurred","Failed to fetch","Failed to send","ChromeMethodBFE","Invalid server response format","Invalid tab ID","No tab with id","NetworkError when attempting to fetch resource","Server responded with","The browser is shutting down.","The database connection is closing.","Transaction timed out due to inactivity.","Unable to display confirm dialog","Unable to execute delayed tab close","Unable to fetch","Unable to read current tab ID","No current window","Connection is closing."]}),gf(),tf()],beforeBreadcrumb:K=>{var et;return K.category==="fetch"&&typeof((et=K.data)==null?void 0:et.url)=="string"&&(K.data.url=K.data.url.split("?")[0]),K},beforeSend:async K=>(K.request={...K.request,headers:{"User-Agent":navigator.userAgent}},await n.getParameter("privacy_allow_performance_tracking")?K:null)}),Yh(Zh({domain:"api.poulpeo.com",version:"1.0",platform:"ext",clientId:"als61e6732c50ec95.25615046",execEnv:`Poulpeo Extension / ${r.getVersionName()}`}));const a=r.supportsSessionStorage()?r.getSessionRepository():r.getLocalRepository();r.supportsSessionStorage()||console.warn("Session storage unavailable, falling back to local storage");const s=K=>r.isPersistent()?new zo:new Zt(K,a),o=s("affiliation-request"),c=s("cashback-activation"),l=s("cookie-drop"),u=s("tab-requests-history"),d=s("notification"),f=s("user-click"),h=K=>r.isPersistent()?new zo:new Bo(new mn(K,!0)),y=h("affiliate-network"),N=h("container"),C=h("coupon-applier-config"),F=h("merchant-bonuses"),G=h("merchant-offers"),R=h("merchant"),z=h("merchant-rules"),Y=h("selected-merchant"),b=h("similar-merchants"),_=h("single-use-offer-code"),I=h("trustpilot-reviews"),P=h("user"),V=new Jh,Z=new qm(o),B=new uo(y),E=new ho(N),W=new Ro(C),L=new Po(new mn("health-check",!0),new Zt("health-check",r.getLocalRepository()),new Zt("health-check",r.getSessionRepository())),le=new Oo(F),be=new No(G),ee=new Do(z),ue=new pn(R,ee),Qe=new By(d,r.getMessagingService(),r.getTabsService()),yn=new Yy(Y),Yo=new Uo(b),Xo=new jo(_),qb=new ib(u),Qo=new $o(I),Gi=new cb(f),wt=new Lo(P,V),zi=new Km(r.getVersion(),n,wt),Bi=new Jm(l,r.getScriptingService(),r.getTabsService(),wt),Sr=new Wm(c,Bi,ue,r.getScriptingService(),r.getTabsService()),ec=new Xh(B,Z,ee,qb,Gi),tc=new Qh(wt),Wb=new em([zi]),Hb=new tm(Sr,ue,be,wt),Zb=new rm(r.getMessagingService(),r.getScriptingService(),r.getTabsService()),Kb=new nm(Bi),Gb=new im(Z,r.getBadgeService(),Sr,L,ue,yn,r.getTabsService()),rc=new sm(ue),nc=new am,zb=new om,Bb=new cm(r.getMessagingService(),r.getTabsService()),Jb=new dm(r.getLocalRepository(),n,new Ib,r.getVersion(),async(K="privacy")=>r.openExtensionPage("onboarding",K)),Yb=new lm(r.getAlarmService(),[{alarmName:"update-long-lived-cache",alarmOptions:{delayInMinutes:0,periodInMinutes:1440},runTask:nn(()=>{const K=L.checkStorageHealth();return[()=>B.updateAffiliateNetworksCache(),()=>Qo.updateTrustpilotReviewsCache(5),()=>W.updateCouponApplierConfigCache(),()=>ee.updateMerchantRulesCache()].map(et=>K.then(et))})},{alarmName:"clear-short-lived-cache",alarmOptions:{delayInMinutes:0,periodInMinutes:30},runTask:nn(()=>[N.clear(),F.clear(),G.clear(),R.clear(),b.clear()])},{alarmName:"clear-previous-session-cache",alarmOptions:{delayInMinutes:0},runTask:nn(()=>[o.clear(),c.clear(),l.clear(),d.clear(),Y.clear(),_.clear(),f.clear(),P.clear(),u.clear()])},{alarmName:"clear-expired-data",alarmOptions:{delayInMinutes:1,periodInMinutes:1},runTask:nn(()=>[Z.deleteExpiredAffiliationRequests(),Sr.deleteExpiredCashbackActivations(),Qe.deleteExpiredNotificationLocks()])}]);ec.subscribeSelf(e),tc.subscribeSelf(e),Wb.subscribeSelf(e),Hb.subscribeSelf(e),Kb.subscribeSelf(e),Zb.subscribeSelf(e),Gb.subscribeSelf(e),nc.subscribeSelf(e),rc.subscribeSelf(e),zb.subscribeSelf(e),Bb.subscribeSelf(e),Yb.subscribeSelf(e),Jb.subscribeSelf(e),ec.setPublishTarget(e),tc.setPublishTarget(e),Sr.setPublishTarget(e),nc.setPublishTarget(e),rc.setPublishTarget(e),Qe.setPublishTarget(e),n.setPublishTarget(e),yn.setPublishTarget(e),r.getMessagingService().setPublishTarget(e),r.getScriptingService().setPublishTarget(e),r.getTabsService().setPublishTarget(e),r.setPublishTarget(e);const Xb=[new fm(L),new pm(Bi),new gm(Sr),new mm(Xo,wt),new ym(E),new bm(W),new _m(le),new vm(ue),new wm(be),new Sm(ue),new hm(n),new km(Z,ue,yn,Yo,Gi,wt),new Em(Yo),new xm(Xo,wt),new Cm(r.openExtensionPage.bind(r)),new Tm(Gi),new Im(Qe),new Rm(r.getFileUrl("/").split("/")[2]??"",r.getVersion(),n),new Pm(ee,yn,r.getTabsService()),new Om(Qe),new Nm([zi]),new Mm([zi]),new Am(Qo),new Dm(n)];for(const K of Xb)r.getMessagingService().addMessageHandler(K);r.getMessagingService().listen(),r.setUninstallUrl("https://www.poulpeo.com/extension.htm?s=uninstall").catch(console.error)}class Pb{constructor(){p(this,"eventHandlers",[])}subscribe(e,t){this.eventHandlers.push([e,t])}publish(e){console.debug("EventBus","publish",e.type,fe(e.details,"<redacted>"));for(const[t,n]of this.eventHandlers)t===e.type&&n(e).catch(console.error)}unsubscribe(e,t){var i,a;let n=this.eventHandlers.length;for(;n--;)((i=this.eventHandlers[n])==null?void 0:i[0])===e&&((a=this.eventHandlers[n])==null?void 0:a[1])===t&&this.eventHandlers.splice(n,1)}}var Jo={exports:{}};(function(r,e){(function(t,n){n(r)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ki,function(t){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const n="The message port closed before a response was received.",i=a=>{const s={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(s).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(_,I=void 0){super(I),this.createItem=_}get(_){return this.has(_)||this.set(_,this.createItem(_)),super.get(_)}}const c=b=>b&&typeof b=="object"&&typeof b.then=="function",l=(b,_)=>(...I)=>{a.runtime.lastError?b.reject(new Error(a.runtime.lastError.message)):_.singleCallbackArg||I.length<=1&&_.singleCallbackArg!==!1?b.resolve(I[0]):b.resolve(I)},u=b=>b==1?"argument":"arguments",d=(b,_)=>function(P,...V){if(V.length<_.minArgs)throw new Error(`Expected at least ${_.minArgs} ${u(_.minArgs)} for ${b}(), got ${V.length}`);if(V.length>_.maxArgs)throw new Error(`Expected at most ${_.maxArgs} ${u(_.maxArgs)} for ${b}(), got ${V.length}`);return new Promise((Z,B)=>{if(_.fallbackToNoCallback)try{P[b](...V,l({resolve:Z,reject:B},_))}catch(E){console.warn(`${b} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,E),P[b](...V),_.fallbackToNoCallback=!1,_.noCallback=!0,Z()}else _.noCallback?(P[b](...V),Z()):P[b](...V,l({resolve:Z,reject:B},_))})},f=(b,_,I)=>new Proxy(_,{apply(P,V,Z){return I.call(V,b,...Z)}});let h=Function.call.bind(Object.prototype.hasOwnProperty);const y=(b,_={},I={})=>{let P=Object.create(null),V={has(B,E){return E in b||E in P},get(B,E,W){if(E in P)return P[E];if(!(E in b))return;let L=b[E];if(typeof L=="function")if(typeof _[E]=="function")L=f(b,b[E],_[E]);else if(h(I,E)){let le=d(E,I[E]);L=f(b,b[E],le)}else L=L.bind(b);else if(typeof L=="object"&&L!==null&&(h(_,E)||h(I,E)))L=y(L,_[E],I[E]);else if(h(I,"*"))L=y(L,_[E],I["*"]);else return Object.defineProperty(P,E,{configurable:!0,enumerable:!0,get(){return b[E]},set(le){b[E]=le}}),L;return P[E]=L,L},set(B,E,W,L){return E in P?P[E]=W:b[E]=W,!0},defineProperty(B,E,W){return Reflect.defineProperty(P,E,W)},deleteProperty(B,E){return Reflect.deleteProperty(P,E)}},Z=Object.create(b);return new Proxy(Z,V)},N=b=>({addListener(_,I,...P){_.addListener(b.get(I),...P)},hasListener(_,I){return _.hasListener(b.get(I))},removeListener(_,I){_.removeListener(b.get(I))}}),C=new o(b=>typeof b!="function"?b:function(I){const P=y(I,{},{getContent:{minArgs:0,maxArgs:0}});b(P)}),F=new o(b=>typeof b!="function"?b:function(I,P,V){let Z=!1,B,E=new Promise(be=>{B=function(ee){Z=!0,be(ee)}}),W;try{W=b(I,P,B)}catch(be){W=Promise.reject(be)}const L=W!==!0&&c(W);if(W!==!0&&!L&&!Z)return!1;const le=be=>{be.then(ee=>{V(ee)},ee=>{let ue;ee&&(ee instanceof Error||typeof ee.message=="string")?ue=ee.message:ue="An unexpected error occurred",V({__mozWebExtensionPolyfillReject__:!0,message:ue})}).catch(ee=>{console.error("Failed to send onMessage rejected reply",ee)})};return le(L?W:E),!0}),G=({reject:b,resolve:_},I)=>{a.runtime.lastError?a.runtime.lastError.message===n?_():b(new Error(a.runtime.lastError.message)):I&&I.__mozWebExtensionPolyfillReject__?b(new Error(I.message)):_(I)},R=(b,_,I,...P)=>{if(P.length<_.minArgs)throw new Error(`Expected at least ${_.minArgs} ${u(_.minArgs)} for ${b}(), got ${P.length}`);if(P.length>_.maxArgs)throw new Error(`Expected at most ${_.maxArgs} ${u(_.maxArgs)} for ${b}(), got ${P.length}`);return new Promise((V,Z)=>{const B=G.bind(null,{resolve:V,reject:Z});P.push(B),I.sendMessage(...P)})},z={devtools:{network:{onRequestFinished:N(C)}},runtime:{onMessage:N(F),onMessageExternal:N(F),sendMessage:R.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:R.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},Y={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return s.privacy={network:{"*":Y},services:{"*":Y},websites:{"*":Y}},y(a,z,s)};t.exports=i(chrome)}})})(Jo);var se=Jo.exports;const A=fo(se);class Ob{createAlarm(e,t){A.alarms.create(e,{when:Date.now()+t.delayInMinutes*60*1e3,periodInMinutes:t.periodInMinutes})}addAlarmListener(e,t){A.alarms.onAlarm.addListener(n=>{n.name===e&&t().then().catch(console.error)})}}class Nb{async setBadge(e){const t=typeof A.action<"u";if(e.text!==void 0){const n={tabId:e.tabId,text:e.text};await(t?A.action.setBadgeText(n):A.browserAction.setBadgeText(n))}if(e.backgroundColor!==void 0){const n={tabId:e.tabId,color:e.backgroundColor};await(t?A.action.setBadgeBackgroundColor(n):A.browserAction.setBadgeBackgroundColor(n))}}}class Mb{async keys(){return Object.keys(await se.storage.local.get())}async get(e){const t=await se.storage.local.get(e);if(t[e]!==void 0)return t[e]}async set(e,t){await se.storage.local.set({[e]:t})}async remove(e){await se.storage.local.remove(e)}async clear(e=""){if(e===""){await se.storage.local.clear();return}const t=Object.keys(await se.storage.local.get());await Promise.all(t.map(async n=>n.startsWith(e)?se.storage.local.remove(n):Promise.resolve()))}}class Db{constructor(){p(this,"version");p(this,"messageHandlers",[]);p(this,"eventBus",null);this.version=A.runtime.getManifest().version}getPublishTarget(){return this.eventBus}setPublishTarget(e){this.eventBus=e}addMessageHandler(e){this.messageHandlers.push(e)}listen(){A.runtime.onMessage.addListener(async(e,t)=>{var i;if(!wi(e)){e!=="reload"&&console.error("Unknown runtime message format",e,t);return}if(e.version!==this.version){console.warn("Unknown messaging runtime version, skipping message handling",e.type,fe({message:e},"<redacted>"));return}(i=this.eventBus)==null||i.publish({type:"messageReceived",details:{message:e}});let n;try{const a=await Promise.all(this.messageHandlers.map(async o=>{var c,l;return o.handleMessage(e,{frameId:t.frameId,tabId:(c=t.tab)==null?void 0:c.id,id:t.id,url:t.url??((l=t.tab)==null?void 0:l.url)})})),s=a.filter(o=>o!==void 0);s.length>1&&console.error(new Error("More than one message handler returned a reply"),e.type,fe({results:a},"<redacted>")),n=s.pop()}catch(a){let s;console.debug("Message handler error",e.type,fe({message:e,sender:t},"<redacted>")),console.error(a),typeof a=="object"&&a!==null&&a instanceof Error?s={name:a.name,message:a.message,stack:a.stack}:s={name:"Error",message:typeof a=="string"?a:"Unserializable message handler error",stack:new Error().stack},n={type:"error",inReplyTo:e.id??"",payload:s}}return n!==void 0&&(n.version=this.version,n.id=Math.random().toString()),n})}async sendMessage(e,t){var i;if(e.version=this.version,e.id=Math.random().toString(),(t==null?void 0:t.tabId)===0){const a=await A.tabs.query({currentWindow:!0,active:!0});t.tabId=((i=a[0])==null?void 0:i.id)??0}const n=Promise.race([new Promise((a,s)=>{setTimeout(()=>{s(new Error(`Runtime message response timeout exceeded (${e.type} #${e.id??""})`))},(t==null?void 0:t.responseWaitDurationInMs)??8e3)}),(t==null?void 0:t.tabId)===void 0?A.runtime.sendMessage(e):A.tabs.sendMessage(t.tabId,e,{frameId:t.frameId})]);return console.debug("Sent runtime message of type",e.type,fe({message:e,options:t},"<redacted>")),await n}async sendMessageWithReply(e,t){const n=await this.sendMessage(e,t);if(!wi(n)||n.inReplyTo!==e.id||n.version!==e.version)throw console.debug("Invalid runtime message reply",e.type,fe({message:e,reply:n},"<redacted>")),new Error(`Invalid runtime message reply (${e.type} #${e.id??""})`);if(q(n,"error"))throw n.payload;return n}}class Ub{constructor(){p(this,"useScriptingApi");p(this,"eventBus",null);this.useScriptingApi=A.runtime.getManifest().manifest_version>2}getPublishTarget(){return this.eventBus}setPublishTarget(e){this.eventBus=e}async injectContentScripts(e,t){var n;try{await(this.useScriptingApi?A.scripting.executeScript({files:["/injector.js"],target:{tabId:e}}):A.tabs.executeScript(e,{file:"/injector.js"})),(n=this.eventBus)==null||n.publish({type:"contentScriptInjected",details:{tabId:e,debugLabel:t}})}catch(i){console.warn("Unable to inject content-script",t,i.message)}}async executeConfirm(e,t){try{return(this.useScriptingApi?(await A.scripting.executeScript({func:i=>window.confirm(i),args:[t],target:{tabId:e}})).map(i=>i.result):await A.tabs.executeScript(e,{code:`confirm("${t.replaceAll(`
`,"\\n")}")`,runAt:"document_start"}))[0]??!1}catch(n){return console.error("Unable to display confirm dialog",n.message,t),!1}}async executeClose(e,t){try{await(this.useScriptingApi?A.scripting.executeScript({func:n=>{setTimeout(window.close,n)},args:[t],target:{tabId:e}}):A.tabs.executeScript(e,{code:`setTimeout(close, ${t})`,runAt:"document_start"}))}catch(n){const i=n instanceof Error?n.message:"";if(i==="Frame with ID 0 was removed."||i===`Frame with ID ${e} was removed.`||i===`Invalid tab ID: ${e}.`||i===`No tab with id: ${e}`||i===`No tab with id: ${e}.`||i==="This is not supported on tabs in Internet Explorer Mode"||i.startsWith("Missing host permission for the tab"))return;console.error("Unable to execute delayed tab close",i,t)}}}class jb{async keys(){return Object.keys(await se.storage.session.get())}async get(e){const t=await se.storage.session.get(e);if(t[e]!==void 0)return t[e]}async set(e,t){await se.storage.session.set({[e]:t})}async remove(e){await se.storage.session.remove(e)}async clear(e=""){if(e===""){await se.storage.session.clear();return}const t=Object.keys(await se.storage.session.get());await Promise.all(t.map(async n=>n.startsWith(e)?se.storage.session.remove(n):Promise.resolve()))}}class $b{constructor(){p(this,"eventBus",null);A.tabs.onActivated.addListener(this.onTabActivated.bind(this)),A.tabs.onCreated.addListener(this.onTabCreated.bind(this)),A.tabs.onUpdated.addListener(this.onTabUpdated.bind(this)),A.tabs.onRemoved.addListener(this.onTabRemoved.bind(this))}getPublishTarget(){return this.eventBus}setPublishTarget(e){this.eventBus=e}async getTab(e){console.debug("ExtensionRuntimeTabsService","getTab");const t=await A.tabs.get(e);if(t.id===void 0||t.id===A.tabs.TAB_ID_NONE)throw new Error("Unable to read current tab ID");return{id:t.id,active:t.active,status:t.status,url:t.url}}async getCurrentTab(){console.debug("ExtensionRuntimeTabsService","getCurrentTab");const e=(await A.tabs.query({currentWindow:!0,active:!0}))[0];if((e==null?void 0:e.id)===void 0||e.id===A.tabs.TAB_ID_NONE)throw new Error("Unable to read current tab ID");return{id:e.id,active:e.active,status:e.status,url:e.url}}async getAllTabs(){return(await A.tabs.query({})).flatMap(t=>t.id===void 0||t.id===A.tabs.TAB_ID_NONE?[]:[{id:t.id,active:t.active,status:t.status,url:t.url}])}async create(e){console.debug("ExtensionRuntimeTabsService","create",{...e,url:jt(e.url,"searchAndPath"),openerTabUrl:jt(e.openerTabUrl,"searchAndPath")});const t=await A.tabs.create(e);if(t.id===void 0||t.id===A.tabs.TAB_ID_NONE)throw new Error("Unable to read created tab ID");return{id:t.id,active:t.active,status:t.status,url:t.url}}async update(e,t){console.debug("ExtensionRuntimeTabsService","update",e,{...t,url:jt(t.url,"searchAndPath")}),await A.tabs.update(t)}async remove(e){console.debug("ExtensionRuntimeTabsService","remove",e),await A.tabs.remove(e)}onTabCreated(e){var a;const t=[void 0,A.tabs.TAB_ID_NONE],n=!t.includes(e.id),i=!t.includes(e.openerTabId);n&&i?A.tabs.get(e.openerTabId??0).then(s=>{var o;(o=this.eventBus)==null||o.publish({type:"tabCreated",details:{tabId:e.id??0,openerTabId:s.id,openerTabUrl:s.url}})}).catch(console.error):n&&((a=this.eventBus)==null||a.publish({type:"tabCreated",details:{tabId:e.id??0,openerTabId:void 0,openerTabUrl:void 0}}))}onTabActivated(e){var t;(t=this.eventBus)==null||t.publish({type:"tabActivated",details:{tabId:e.tabId}})}onTabUpdated(e,t,n){var i;(i=this.eventBus)==null||i.publish({type:"tabUpdated",details:{tabId:e,changeInfo:{status:t.status},tab:{id:e,active:n.active,status:n.status,url:n.url}}})}onTabRemoved(e){var t;(t=this.eventBus)==null||t.publish({type:"tabRemoved",details:{tabId:e}})}}class Lb{constructor(){p(this,"alarmService");p(this,"badgeService");p(this,"messagingService");p(this,"localRepository");p(this,"scriptingService");p(this,"sessionRepository");p(this,"tabsService");p(this,"eventBus",null);this.alarmService=new Ob,this.badgeService=new Nb,this.messagingService=new Db,this.localRepository=new Mb,this.scriptingService=new Ub,this.sessionRepository=new jb,this.tabsService=new $b,this.initEventHandlers()}getAlarmService(){return this.alarmService}getBadgeService(){return this.badgeService}getFileUrl(e){return A.runtime.getURL(`/${e.replace(/^\//,"")}`)}getLocalRepository(){return this.localRepository}getMessagingService(){return this.messagingService}getPublishTarget(){return this.eventBus}getScriptingService(){return this.scriptingService}getSessionRepository(){return this.sessionRepository}getTabsService(){return this.tabsService}getVersion(){return A.runtime.getManifest().version}getVersionName(){return`${A.runtime.getManifest().version}+production-firefox`}isPersistent(){var e;return((e=A.runtime.getManifest().background)==null?void 0:e.persistent)===!0}setPublishTarget(e){this.eventBus=e}async setUninstallUrl(e){await A.runtime.setUninstallURL(e)}supportsSessionStorage(){if(typeof A.storage.session>"u")return!1;const e=A.storage.session.QUOTA_BYTES;return e===void 0||e>=10485760}async openExtensionPage(e,t=""){const n={changelog:this.getFileUrl("changelog.html"),onboarding:this.getFileUrl("onboarding.html"),options:this.getFileUrl("options.html"),"privacy-policy":this.getFileUrl("privacy-policy.html")};await this.getTabsService().create({active:!0,url:`${n[e]}${t?`#${t}`:""}`})}initEventHandlers(){var e,t,n,i;A.runtime.onInstalled.addListener(a=>{var s;(s=this.eventBus)==null||s.publish({type:"extensionInstalled",details:{reason:a.reason,previousVersion:a.previousVersion}})}),(e=A.browserAction)==null||e.onClicked.addListener(()=>{var a;(a=this.eventBus)==null||a.publish({type:"browserActionClicked",details:{}})}),(t=A.action)==null||t.onClicked.addListener(()=>{var a;(a=this.eventBus)==null||a.publish({type:"browserActionClicked",details:{}})}),A.webNavigation.onCommitted.addListener(a=>{var s;a.frameId===0&&((s=this.eventBus)==null||s.publish({type:"navigationCommitted",details:{tabId:a.tabId,url:a.url}}))}),(n=A.webNavigation.onHistoryStateUpdated)==null||n.addListener(a=>{var s;a.frameId===0&&((s=this.eventBus)==null||s.publish({type:"navigationHistoryStateUpdated",details:{tabId:a.tabId,url:a.url}}))}),(i=A.webRequest)==null||i.onHeadersReceived.addListener(a=>{var c,l,u;if(!a.url.startsWith("http:")&&!a.url.startsWith("https:"))return;const s=["application/","image/","audio/","video/","font/","text/css"],o=(l=(c=a.responseHeaders)==null?void 0:c.find(d=>d.name==="content-type"))==null?void 0:l.value;o!==void 0&&s.some(d=>d==="application/"?o.startsWith(d)&&!o.includes("json")&&!o.includes("javascript")&&!o.includes("ecmascript"):o.startsWith(d))||(u=this.eventBus)==null||u.publish({type:"headersReceived",details:{url:a.url,originUrl:a.originUrl??a.initiator,statusCode:a.statusCode,tabId:a.tabId,timestamp:a.timeStamp}})},{urls:["<all_urls>"],types:["main_frame","xmlhttprequest"]},["responseHeaders"])}}const Fb=tt({persistent:!0,main:()=>{Rb(new Lb,new Pb)}});function v_(){}function gn(r,...e){}const Vb={debug:(...r)=>gn(console.debug,...r),log:(...r)=>gn(console.log,...r),warn:(...r)=>gn(console.warn,...r),error:(...r)=>gn(console.error,...r)};let Ki;try{Ki=Fb.main(),Ki instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(r){throw Vb.error("The background crashed on startup!"),r}return Ki}();
background;
