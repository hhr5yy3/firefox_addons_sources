!function(){const e=["en","fr","es","pt","de"];self.aBrowser=chrome||browser,self.aBrowser.storage.local.get("workspaceSettings",(({workspaceSettings:e})=>{e&&(self.wsSettings=JSON.parse(e))})),self.aBrowser.storage.onChanged.addListener((e=>{e.workspaceSettings&&e.workspaceSettings.newValue&&(self.wsSettings=JSON.parse(e.workspaceSettings.newValue))}));const s={browserLanguage:function(){let s=self.aBrowser.i18n.getUILanguage();return s||(s="en"),-1!==s.indexOf("-")&&(s=s.split("-")[0]),-1!==s.indexOf("_")&&(s=s.split("_")[0]),e.includes(s)?s:"en"}(),lang:"en",messages:null,async loadLocaleMessagesFromJson(e="en"){const s=await fetch(self.aBrowser.runtime.getURL(`/_locales/${e}/messages.json`)),t=await s.json();return this.lang=e,this.messages=t,self.aBrowser.storage.local.set({locale_messages:t},(()=>{self.aBrowser.runtime.sendMessage({eventName:"updateContexMenu"})})),s},onProfileLangChange(s){return s||(s=this.browserLanguage),e.includes(s)||(s="en"),self.aBrowser.storage.local.set({lang:s}),this.loadLocaleMessagesFromJson(s)},getMsg(e){let s=this.messages[e];return s?s.message:e},getMessage(e,s){const t=()=>{if(!s)return this.getMsg(e);let t=this.messages[e];if(!t||!t.message)return t;let a=t.message;for(let e=0;e<s.length;e++)a=a.replace(/\{ .+?}/,s[e]);return a};if(this.messages)return t();this.loadLocaleMessagesFromJson(this.lang).then((()=>t()))},replaceLabels(e){if(!(self.wsSettings&&self.wsSettings.projectLabel&&self.wsSettings.taskLabel&&self.wsSettings.projectGroupingLabel))return e;const{projectLabel:s,taskLabel:t,projectGroupingLabel:a}=self.wsSettings,g=new RegExp(`(${this.getMessage("PROJECTS")}|${this.getMessage("PROJECT")}|${this.getMessage("TASKS")}|${this.getMessage("TASK")}|${this.getMessage("CLIENTS")}|${this.getMessage("CLIENT")})`,"gi"),r=new RegExp(`(${this.getMessage("PROJECTS")}|${this.getMessage("TASKS")}|${this.getMessage("CLIENTS")})`,"i");return e.replaceAll(g,(e=>{const g=r.test(e);let n=s;e.toLowerCase()===this.getMessage("TASK").toLowerCase()||e.toLowerCase()===this.getMessage("TASKS").toLowerCase()?n=t:e.toLowerCase()!==this.getMessage("CLIENT").toLowerCase()&&e.toLowerCase()!==this.getMessage("CLIENTS").toLowerCase()||(n=a);let l="uppercase";return e[0]===e[0].toUpperCase()&&e[1]&&e[1]===e[1].toLowerCase()?l="capital":e[0]===e[0].toLowerCase()&&(l="lowercase"),this.CUSTOM_LABEL(n,g,l)}))},CUSTOM_LABEL(e,s=!1,t="lowercase"){if(!e)return;let a=e;return e=e.toUpperCase().replaceAll(" ","_"),["CLIENT","DEPARTMENT","CATEGORY","PROJECT","LOCATION","JOB","TASK","ACTIVITY","JOB_AREA"].includes(e)&&(s&&("Y"===e[e.length-1]&&(e=e.slice(0,e.length-1)+"IE"),e+="S"),a=this.getMessage(e)),a="lowercase"===t||"capital"===t?a.toLowerCase():a.toUpperCase(),"capital"===t&&(a=a[0].toUpperCase()+a.slice(1)),a}};self.aBrowser.storage.local.get(["lang","locale_messages"],(({lang:e,locale_messages:t})=>{s.lang=e,s.messages=t,self.aBrowser.runtime.sendMessage({eventName:"updateContexMenu"})})),self.aBrowser.storage.onChanged.addListener((e=>{e.lang&&(s.lang=e.lang.newValue),e.locale_messages&&(s.messages=e.locale_messages.newValue,self.aBrowser.runtime.sendMessage({eventName:"updateContexMenu"}))}));const t=new RegExp("{ .+ }");self.clockifyLocales=new Proxy(s,{get(e,a){const g=new RegExp(`(${s.getMessage("PROJECTS")}|${s.getMessage("PROJECT")}|${s.getMessage("TASKS")}|${s.getMessage("TASK")}|${s.getMessage("CLIENTS")}|${s.getMessage("CLIENT")})`,"gi");let r=null;return a in e?function(...s){return e[a](...s)}:(r=e.getMessage(a),t.test(r)?function(...s){return r=e.getMessage(a,s),g.test(r)&&(r=e.replaceLabels(r)),r}:(g.test(r)&&(r=e.replaceLabels(r)),r))}})}();