import{a as Z}from"../chunks/chunk-QN7PJSSJ.js";import{a as F}from"../chunks/chunk-TH3N6NCF.js";import{a as Q}from"../chunks/chunk-5VY5EMKN.js";import{a as K}from"../chunks/chunk-543EMZFQ.js";import{c as X}from"../chunks/chunk-L4RDDWJP.js";import{a as H}from"../chunks/chunk-ZN5XPMIY.js";import{a as Y}from"../chunks/chunk-RIL6IOBV.js";import{a as J}from"../chunks/chunk-W32UHEZE.js";import{a as T}from"../chunks/chunk-KWDMUJJA.js";import{a as W}from"../chunks/chunk-MT4LVDUX.js";import{a as E}from"../chunks/chunk-WN4MFSKN.js";import{a as M}from"../chunks/chunk-7S3YJSN5.js";import{K as j,M as L,a as y,e as P,f as h}from"../chunks/chunk-LADTODTA.js";import"../chunks/chunk-O4TFJKJQ.js";import{B as u,c as r,x as g}from"../chunks/chunk-WRHUMLYF.js";import{a as B,d as lt}from"../chunks/chunk-RXMLGJMT.js";import"../chunks/chunk-XSKOAVIS.js";import{G as ct,q as D}from"../chunks/chunk-OEPSEZ5A.js";import"../chunks/chunk-XERCZVWP.js";import"../chunks/chunk-AT6M4CEW.js";import{e as c}from"../chunks/chunk-3GYLW4KZ.js";var ce=c(y()),st=c(ct()),C=c(D());var Pt=c(y()),ot=c(y()),k=c(E()),s=c(D());var _=c(D());var tt=i=>g("addVote",i);var et=i=>g("getFeedbackData",i);function w(i){return i=i==="video"?"review":i,i==="advice"?i:`${i}s`}async function dt(){let i=r.get(["ProductPage","inputData","product"]),t=r.get(["ProductPage","inputData","asin"]),e=r.get(["ProductPage","inputData","feedback"]),n=r.get(["session","id"]),p=i&&i.wbpid?i.wbpid:`amazon.com_${t}`,o=await et({wbpid:p,userId:n,product:i,meta:e});r.set(["ProductPage","feedbackData"],o)}function ft(i,t){let e=(t||i).split(".")[0];e==="video"&&(e="review");let n=r.get(["ProductPage","feedbackData"]),p;if(t){let o=_.default.find(n[w(e)],{id:t});p=_.default.find(_.default.get(o,"comments"),{id:i})}else n&&(p=_.default.find(n[w(e)],{id:i}));return{feedback:p,type:e}}function ut({feedback:i,updatedFeedback:t,type:e,data:n}){n.parent_id?(r.select(["ProductPage","feedbackData",w(e),{id:n.parent_id}]).set(["comments",{id:n.id}],t),n.parent_id===r.get(["selectedFeedback","id"])&&r.set(["selectedFeedback","comments",{id:n.id}],t)):(r.merge(["ProductPage","feedbackData",w(e),{id:n.id}],t),i.id===r.get(["selectedFeedback","id"])&&r.set(["selectedFeedback"],t))}function mt({feedback:i,type:t}){let e=r.get(["ProductPage","feedbackData",w(t)]);e&&(e.push(i),r.set(["ProductPage","feedbackData",w(t)],e),r.commit())}async function A(i){let t=r.get(["session","id"]),{feedback:e,type:n}=ft(i.id,i.parent_id);function p(o){return o=_.default.clone(o),o.up_votes=o.up_votes||0,o.down_votes=o.down_votes||0,o.up_votes=i.upVote?o.up_votes+1:o.up_votes,o.down_votes=i.upVote?o.down_votes:o.down_votes+1,o.vote_selection==="up_vote"&&(o.up_votes-=1),o.vote_selection==="down_vote"&&(o.down_votes-=1),o.vote_selection=i.upVote?"up_vote":"down_vote",o}if(e){let o=p(e);ut({feedback:e,updatedFeedback:o,type:n,data:i})}else{let o=p(i);mt({feedback:o,type:n})}await tt(_.default.assign({userId:t},i)),await dt()}var it=i=>g("toggleMatchSurvey",i);var a=c(h()),V=class extends ot.Component{constructor(...t){super(...t),this.state={title:"Was this a good result?",subtitle:"Your feedback helps other Capital One Shoppers.",hideNotification:!0,showReasons:!1,showComment:!1,selectedReasons:[],reasonText:"",dismiss:!1}}componentDidMount(){u("page","matchSurvey",{view:"matchSurvey",type:"notification",offerSignUp:s.default.get(this.props.view,"offerSignUp"),qualified:s.default.get(this.props.view,"qualified",!1),balance:s.default.get(this.props.view,"balance",0)}),setTimeout(()=>{this.setState({hideNotification:!1})},1e3)}componentWillReceiveProps(t){s.default.get(t,"view.hiddenFromWebApp")&&!s.default.get(this.props,"view.hiddenFromWebApp")&&this.setState({hideNotification:!0})}onChange(t,e){if(e.type==="input")return;let n=this.state.selectedReasons,p=n.indexOf(t);p===-1?n.push(t):n.splice(p,1),this.setState({selectedReasons:n})}onTextUpdate(t){let e=t.target.value;this.setState({reasonText:e})}renderReasons(){let t=["Not the same product","Price is incorrect","Out of stock","Item condition","Bad seller","Other"],e;return this.state.showReasons&&(e=s.default.map(t,(n,p)=>{let o=this.state.selectedReasons.indexOf(n)!==-1;return(0,a.jsxs)("div",{className:"reason",children:[(0,a.jsx)("input",{type:"checkbox",checked:o,onChange:this.onChange.bind(this,n),id:s.default.kebabCase(n)}),(0,a.jsx)("label",{htmlFor:s.default.kebabCase(n),children:(0,a.jsx)("h5",{className:"text",children:n})})]},s.default.kebabCase(n))})),(0,a.jsxs)("div",{className:"reasons-wrapper",children:[e,(0,a.jsx)("textarea",{placeholder:"tell us more",value:this.state.reasonText,onChange:this.onTextUpdate.bind(this)}),(0,a.jsx)("button",{className:"primary-btn-small",onClick:this.onSubmit.bind(this),children:"Submit"})]})}render(){let{hideNotification:t}=this.state,e=this.state.title,n=this.state.subtitle,p=!1,o=!1,f;return this.state.showReasons||this.state.showComment?f=this.renderReasons():this.state.dismiss||this.state.buttonsHidden?f=(0,a.jsx)("div",{className:"thanks-wrapper"}):f=(0,a.jsxs)("div",{className:"button-wrapper",children:[(0,a.jsx)("button",{className:"secondary-btn-small",onClick:this.onYes.bind(this),children:"Yes"}),(0,a.jsx)("button",{className:"secondary-btn-small",onClick:this.onNo.bind(this),children:"No"})]}),(0,a.jsx)("div",{className:t?"disabled follow-page":"follow-page",style:{top:p?"0":"auto",bottom:p?"auto":"0",left:o?"auto":"0",right:o?"0":"auto"},children:(0,a.jsx)(k.Motion,{style:{opacity:(0,k.spring)(t?0:1,{stiffness:180,damping:20}),y:(0,k.spring)(t?p?-100:100:0,{stiffness:180,damping:20})},children:({opacity:R,y:b})=>(0,a.jsxs)("div",{className:"follow-notification",style:{transform:`translate3d(0,${b}%,0)`,opacity:`${R}`},children:[(0,a.jsxs)("header",{style:{display:"flex",justifyContent:"space-between"},children:[(0,a.jsx)(M,{}),(0,a.jsx)(T,{onClick:this.onClosePopup.bind(this,"x")})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{children:e}),n?(0,a.jsx)("h4",{children:n}):null,f]})]})})})}onYes(){let t=s.default.get(this.props,"view.resultData");A({up_votes:0,down_votes:0,id:`product.${s.default.get(t,"details.product.wbpid")}`,wbpid:s.default.get(t,"run.originResult.product.wbpid"),match_wbpid:s.default.get(t,"details.product.wbpid"),upVote:!0}),this.onNotificationInteraction(),this.setState({match:!0,title:"Thanks!",subtitle:"Your vote helps improve results for everyone on Capital One Shopping.",buttonsHidden:!0}),this.timeout=setTimeout(()=>{this.setState({hideNotification:!0})},2500);let e={match:!0,quoteId:s.default.get(t,"run.id"),matchId:s.default.get(t,"details.id"),notification:!0,mpnBrandMatch:s.default.get(t,"details.meta.imsMpnBrandMatch",!1),certifiedRefurbished:s.default.get(t,"details.certifiedRefurbished",!1)};u("track","matchSurvey",e)}onNo(){let t=s.default.get(this.props,"view.resultData");A({up_votes:0,down_votes:0,id:`product.${s.default.get(t,"details.product.wbpid")}`,wbpid:s.default.get(t,"run.originResult.product.wbpid"),match_wbpid:s.default.get(t,"details.product.wbpid"),upVote:!1}),this.onNotificationInteraction(),this.setState({match:!1,showReasons:!0,showComment:!0,title:"Uh oh!",subtitle:"What was wrong with this result?"});let e={match:!1,quoteId:s.default.get(t,"run.id"),matchId:s.default.get(t,"details.id"),notification:!0,mpnBrandMatch:s.default.get(t,"details.meta.imsMpnBrandMatch",!1),certifiedRefurbished:s.default.get(t,"details.certifiedRefurbished",!1)};u("track","matchSurvey",e)}onSubmit(){this.onNotificationInteraction();let t=s.default.get(this.props,"view.resultData"),e={match:this.state.match,quoteId:t.run.id,matchId:t.details.id,notification:!0};this.state.reasonText&&(e.text=this.state.reasonText),this.state.selectedReasons&&this.state.selectedReasons.length&&(e.reason=s.default.get(this.state.selectedReasons,"[0]"),e.reasons=this.state.selectedReasons),u("track","matchSurveyReason",e),this.setState({dismiss:!0,showReasons:!1,showComment:!1,title:"Thanks for helping!",subtitle:"The next Capital One Shopper will benefit from your contribution."}),setTimeout(()=>this.onClosePopup("submit"),3200)}onClosePopup(t){this.onNotificationInteraction(),this.setState({hideNotification:!0}),u("trackClick","dismissMatchSurvey",t)}onNotificationInteraction(){it(s.default.get(this.props,"view.resultData"))}componentWillUnmount(){clearTimeout(this.timeout)}},U=P({view:["followView"],events:["events"],session:["session"]},V);var Ht=c(y()),v=c(y()),x=c(E()),$=c(D());lt();var l=c(h()),_t=i=>{let{autoGC:t,hasCredits:e,hasCoupons:n}=i,o=$.default.get(t,"redemptionEnabled")?$.default.get(t,"redemptionAmount",0):0,f=!0,R=!0,[b,O]=(0,v.useState)(!0),[q,at]=(0,v.useState)(0);(0,v.useEffect)(()=>{u("page",e?"autoGCReminder":"couponReminder",{view:"savingsReminder",type:"notification",hasCredits:e}),rt(),setTimeout(()=>{O(!1)},1e3)},[]);async function rt(){O(!1);let d=200,m=1;for(;d<7e3;){let N=Z();N.updated&&at(N.offset),await B(d),m>25&&(d*=1.5),m+=1}}function pt(){let d='Add to cart, continue to checkout, and click "Redeem my Rewards" when prompted.',m=`${d} We'll try available coupons to increase your dicsount.`,N="Add to cart, continue to checkout, and click try codes to see your discount.",S="";return e&&n?S=m:e?S=d:S=N,(0,l.jsx)("h5",{className:"description",children:S})}return(0,l.jsx)("div",{className:b?"disabled savings-reminder-page":"savings-reminder-page",style:{top:f?"0":"auto",bottom:f?"auto":"0",left:R?"auto":"0",right:q||(R?"15px":"auto")},children:(0,l.jsx)(x.Motion,{style:{opacity:(0,x.spring)(b?0:1,{stiffness:180,damping:20}),y:(0,x.spring)(b?f?-100:100:0,{stiffness:180,damping:20})},children:({opacity:d,y:m})=>(0,l.jsxs)("div",{className:"savings-reminder-notification",style:{transform:`translate3d(0,${m}%,0)`,opacity:`${d}`},children:[(0,l.jsxs)("header",{children:[(0,l.jsx)(M,{}),(0,l.jsx)(X,{}),(0,l.jsx)(T,{onClick:z.bind(void 0,"x")})]}),(0,l.jsxs)("section",{children:[(0,l.jsx)("h2",{className:"align-center",children:e?`${W(o,{removeCents:!0})} Rewards redemption applied at checkout`:"Savings applied at checkout"}),(0,l.jsx)(F,{}),pt(),(0,l.jsx)("div",{className:"button-wrapper",children:(0,l.jsx)("button",{className:"primary-btn-large",onClick:()=>z("Got it"),children:"Got it!"})})]})]})})});function z(d){O(!0),u("trackClick",e?"dismissAutoGCReminderNotification":"dismissCouponReminderNotification",d,{hasCredits:e})}},G=P({},_t);var I=c(h());window.__wb_timing.followRequireAt=performance.now();function gt(){return st.default.all([Y(),J(),H()]).spread((i,t,e)=>{Q(i),r.merge({siteAPIData:t}),r.set("lifetimeSavings",e)})}async function nt(){await gt();let i=r.get(["followView","resultData"]),t=C.default.get(i,"details.pricing.coupons.length"),e=C.default.get(i,"details.pricing.autoGC",{}),n=C.default.get(e,"redemptionEnabled",!1),p=C.default.get(i,"details.pricing.credits.qualifyToRedeemCredits",!1),o=n&&p;o&&K(i),L({initialRoute:"/follow",cssUrl:"follow.css",app:(f=>(0,I.jsx)(j,{children:t||o?(0,I.jsx)(G,{autoGC:e,hasCredits:o,hasCoupons:t}):(0,I.jsx)(U,{})}))()})}document.readyState!=="loading"?nt():document.addEventListener("DOMContentLoaded",nt);
