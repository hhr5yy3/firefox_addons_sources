(function(){"use strict";const c={fontFamilyPref:!1,fontFamily:"",fontSizePref:!1,fontSize:"100",fontWeightPref:!1,fontWeight:"400",fontColorPref:!1,fontColor:"#ffffff",fontOpacityPref:!1,fontOpacity:"100",effectLineHeightPref:!1,effectLineHeight:"100",effectTextVertMarginPref:!1,effectTextVertMargin:"0",effectTextHorMarginPref:!1,effectTextHorMargin:"0",effectTextVertPosition:"default",effectTextHorPosition:"default",effectLetterSpacingPref:!1,effectLetterSpacing:"0",effectWordSpacingPref:!1,effectWordSpacing:"0",effectTextTransform:"none",effectStrokePref:!1,effectStrokeWidth:"0",effectStrokeColor:"#000000",effectShadowPref:!1,effectShadowOffsetX:"0",effectShadowOffsetY:"0",effectShadowColor:"#000000",effectShadowBlur:"0",effectShadowOpacity:"50",effectTextBlurPref:!1,effectTextBlur:"0",backgroundType:"window",backgroundColorOpacityPref:!1,backgroundColor:"#000000",backgroundOpacity:"50",backgroundPaddingPref:!1,backgroundPadding:"0",backgroundRadiusPref:!1,backgroundRadius:"0",captionSegmentStyles:"",captionWindowContainerStyles:"",captionWindowStyles:""},a=async()=>new Promise(t=>chrome.storage.local.get(null,f=>{var n;(n=Object.keys(f))!=null&&n.length?t(f):t(null)})),i=async t=>new Promise(f=>chrome.storage.local.set(t,()=>f(null))),g=()=>{chrome.tabs.query({discarded:!1,status:"complete",url:"https://*.youtube.com/*"},t=>{if(t.length)for(const f of t)chrome.tabs.sendMessage(f.id,{action:"updateSubtitles"})})},s=(t,f)=>{const n=parseInt(t.slice(1,3),16),e=parseInt(t.slice(3,5),16),r=parseInt(t.slice(5,7),16);return typeof f<"u"&&f<1?`rgba(${n}, ${e}, ${r}, ${f})`:`rgb(${n}, ${e}, ${r})`},o=(t,f,n)=>t.push(`${f}: ${n} !important;`),d=async()=>{const t=[],f=[],n=[],e=await a();e.fontFamilyPref&&e.fontFamily&&o(t,"font-family",`${e.fontFamily}, sans-serif`),e.fontSizePref&&o(t,"font-size",`${100+parseInt(e.fontSize)*2}%`),e.fontWeightPref&&o(t,"font-weight",e.fontWeight),e.fontColorPref&&o(t,"color",e.fontColor),e.fontOpacityPref&&parseInt(e.fontOpacity)<100&&o(t,"opacity",(parseInt(e.fontOpacity)/100).toString()),e.effectLetterSpacingPref&&parseFloat(e.effectLetterSpacing)>0&&o(t,"letter-spacing",`${e.effectLetterSpacing}em`),e.effectWordSpacingPref&&parseFloat(e.effectWordSpacing)>0&&o(t,"word-spacing",`${e.effectWordSpacing}em`),e.effectLineHeightPref&&parseFloat(e.effectLineHeight)>0&&o(t,"line-height",`${e.effectLineHeight}%`),e.effectTextVertMarginPref&&(o(n,"margin-bottom",`${e.effectTextVertMargin}em`),o(n,"margin-top",`${e.effectTextVertMargin}em`)),e.effectTextHorMarginPref&&(o(n,"margin-left",`${e.effectTextHorMargin}em`),o(n,"margin-right",`${e.effectTextHorMargin}em`)),(e.effectTextVertPosition!=="default"||e.effectTextHorPosition!=="default")&&o(f,"display","flex"),e.effectTextVertPosition!=="default"&&(o(n,"bottom","unset"),e.effectTextVertMarginPref||o(n,"margin-bottom","0")),e.effectTextVertPosition==="top"?o(f,"align-items","start"):e.effectTextVertPosition==="center"?o(f,"align-items","center"):e.effectTextVertPosition==="bottom"&&o(f,"align-items","end"),e.effectTextHorPosition!=="default"&&(o(n,"left","unset"),e.effectTextHorMarginPref||o(n,"margin-left","0")),e.effectTextHorPosition==="left"?o(f,"justify-content","start"):e.effectTextHorPosition==="center"?o(f,"justify-content","center"):e.effectTextHorPosition==="right"&&o(f,"justify-content","end"),e.effectTextTransform!=="none"&&o(t,"text-transform",e.effectTextTransform),(e.effectStrokePref||e.effectShadowPref||e.effectTextBlurPref)&&o(t,"text-shadow","none"),e.effectStrokePref&&(o(t,"-webkit-text-stroke",`${e.effectStrokeWidth}em ${e.effectStrokeColor}`),o(t,"paint-order","stroke")),e.effectShadowPref&&o(t,"text-shadow",`${e.effectShadowOffsetX}em ${e.effectShadowOffsetY}em ${e.effectShadowBlur}em ${s(e.effectShadowColor,parseInt(e.effectShadowOpacity)/100)}`),e.effectTextBlurPref&&parseFloat(e.effectTextBlur)>0&&o(t,"filter",`blur(${e.effectTextBlur}em)`);const r=e.backgroundType==="window"?n:t,l=e.backgroundType==="window"?t:n;e.backgroundColorOpacityPref&&(o(r,"background-color",s(e.backgroundColor,parseInt(e.backgroundOpacity)/100)),o(l,"background-color","transparent")),e.backgroundPaddingPref&&parseFloat(e.backgroundPadding)>0&&(o(r,"padding",`${e.backgroundPadding}em`),o(l,"padding","0"),o(n,"width","unset")),e.backgroundRadiusPref&&parseFloat(e.backgroundRadius)>0&&o(r,"border-radius",`${e.backgroundRadius}em`),await i({captionSegmentStyles:t.length>0?t.join(" "):""}),await i({captionWindowContainerStyles:f.length>0?f.join(" "):""}),await i({captionWindowStyles:n.length>0?n.join(" "):""})};(async()=>{const t=await a();Object.keys(c).forEach(f=>{(t===null||t[f]===void 0)&&i({[f]:c[f]})})})(),chrome.runtime.onMessage.addListener(t=>{t.action==="openOptions"&&chrome.runtime.openOptionsPage()}),chrome.commands.onCommand.addListener(async t=>{if(t==="optionsOpen"){chrome.runtime.openOptionsPage();return}const f=await a();if(t==="fontSizeToggle")await i({fontSizePref:!f.fontSizePref});else if(t==="fontSizeUp"){if(f.fontSize==="200")return;await i({fontSize:parseInt(f.fontSize)+25>200?"200":(parseInt(f.fontSize)+25).toString()})}else if(t==="fontSizeDown"){if(f.fontSize==="50")return;await i({fontSize:parseInt(f.fontSize)-50<50?"50":(parseInt(f.fontSize)-25).toString()})}else if(t==="fontOpacityToggle")await i({fontOpacityPref:!f.fontOpacityPref});else if(t==="fontOpacityUp"){if(f.fontOpacity==="100")return;await i({fontOpacity:parseInt(f.fontOpacity)+10>100?"100":(parseInt(f.fontOpacity)+10).toString()})}else if(t==="fontOpacityDown"){if(f.fontOpacity==="0")return;await i({fontOpacity:parseInt(f.fontOpacity)-10<0?"0":(parseInt(f.fontOpacity)-10).toString()})}else t==="backgroundColorOpacityToggle"&&await i({backgroundColorOpacityPref:!f.backgroundColorOpacityPref});await d(),g(),chrome.runtime.sendMessage({action:"updateOptions"})})})();
