var ClassWorkerContentScriptElster=function(e,t,n){"use strict";let i=0,o="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMTVweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTUgMTUiIHZlcnNpb249IjEuMSI+CiAgICA8ZyBpZD0ic3VyZmFjZTEiPgogICAgICAgIDxwYXRoIHN0eWxlPSIgc3Ryb2tlOm5vbmU7ZmlsbC1ydWxlOmV2ZW5vZGQ7ZmlsbDpyZ2IoMCwxOTAsMjU1KTsiIGQ9Ik0gMC42OTUzMTIgMy43ODkwNjIgTCAzLjE3NTc4MSA1LjE3OTY4OCBMIDcuNTY2NDA2IDIuNzM0Mzc1IEwgMTEuOTE0MDYyIDUuMTYwMTU2IEwgMTQuMzc4OTA2IDMuODA4NTk0IEwgNy41ODU5MzggMC4wNDY4NzUgWiBNIDAuNjk1MzEyIDMuNzg5MDYyICIvPgogICAgICAgIDxwYXRoIHN0eWxlPSIgc3Ryb2tlOm5vbmU7ZmlsbC1ydWxlOmV2ZW5vZGQ7ZmlsbDpyZ2IoMCwxOTAsMjU1KTsiIGQ9Ik0gNS4xNjAxNTYgNS44NjcxODggTCA3LjU3MDMxMiA3LjIxODc1IEwgOS45MjE4NzUgNS45NTMxMjUgTCA3LjU2NjQwNiA0LjY1MjM0NCBaIE0gNS4xNjAxNTYgNS44NjcxODggIi8+CiAgICAgICAgPHBhdGggc3R5bGU9IiBzdHJva2U6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtmaWxsOnJnYigwLDE5MCwyNTUpOyIgZD0iTSAwLjY5NTMxMiAzLjc3MzQzOCBMIDAuNjk1MzEyIDExLjIxMDkzOCBMIDMuMTc1NzgxIDEyLjUzMTI1IEwgMy4xOTUzMTIgNS4xNzk2ODggWiBNIDAuNjk1MzEyIDMuNzczNDM4ICIvPgogICAgICAgIDxwYXRoIHN0eWxlPSIgc3Ryb2tlOm5vbmU7ZmlsbC1ydWxlOmV2ZW5vZGQ7ZmlsbDpyZ2IoMCwxOTAsMjU1KTsiIGQ9Ik0gNS4xNzU3ODEgNS44NjcxODggTCA1LjE1NjI1IDguMzA4NTk0IEwgNy41NjY0MDYgOS41OTM3NSBMIDkuOTM3NSA4LjI3NzM0NCBMIDkuOTM3NSA1Ljk5MjE4OCBMIDcuNTg1OTM4IDcuMjM4MjgxIFogTSA1LjE3NTc4MSA1Ljg2NzE4OCAiLz4KICAgICAgICA8cGF0aCBzdHlsZT0iIHN0cm9rZTpub25lO2ZpbGwtcnVsZTpldmVub2RkO2ZpbGw6cmdiKDAsMTkwLDI1NSk7IiBkPSJNIDExLjg5ODQzOCA1LjE3OTY4OCBMIDExLjkxNDA2MiA5LjExNzE4OCBMIDcuNTY2NDA2IDExLjQ4ODI4MSBMIDUuMTc1NzgxIDEwLjI0MjE4OCBMIDUuMTc1NzgxIDEzLjYzMjgxMiBMIDcuNTQ2ODc1IDE0Ljk1MzEyNSBMIDE0LjQxNzk2OSAxMS4yMDcwMzEgTCAxNC4zNzg5MDYgMy44Mzk4NDQgWiBNIDExLjg5ODQzOCA1LjE3OTY4OCAiLz4KICAgIDwvZz4KPC9zdmc+Cg==";function s(t){!function(t){const s=t.getElementById("bestaetigenButton"),l=t.getElementById("psonoDropdownMenuElster");if(!s||l)return;const c=s.parentElement.parentElement,u=t.createElement("li");u.className="alignment__item",u.style.marginLeft="5px";const d=t.createElement("button");d.className="interactive interactive-icon--invert",d.id="psonoDropdownMenuElster",d.style.paddingBottom="4px";const p=new Image;p.src=o,p.width=20,p.height=20,d.appendChild(p),u.appendChild(d),c.appendChild(u),d.addEventListener("click",(function(o){!function(t,o,s){e.emit("elster-certificate-refresh",s.location.toString(),(async o=>{let l="psono_open-datastore-"+uuid.v4(),c=[],u="";if(u+='<div class="psono-drop-content-inner">',u+='<ul class="navigations">',await new Promise((function(t){e.emit("is-logged-in",void 0,(e=>{t(e)}))}))){u+='<li><div class="'+l+'" style="cursor: pointer !important;">Open Datastore</div></li>',o.data.length<1&&(u+="<li>No certificates found</li>"),o.data.length>5&&(u+='<li><input type="text" class="psono-search-input" placeholder="Search..." /></li>');for(let e=0;e<o.data.length;e++){let t=a(o.data[e].name),n="psono_request-secret-"+uuid.v4(),i="";e>=5&&(i="display:none !important"),u+='<li class="psono_request-secret" style="'+i+'"><div class="'+n+'" style="cursor: pointer !important;"">'+t+"</div></li>",c.push({class:n,secret_id:o.data[e].secret_id})}}else u+='<li><div class="'+l+'" style="cursor: pointer !important;">Login</div></li>';u+="</ul>",u+="</div>";let d=function(e,t,n){let o=function(e){if(e.getClientRects().length<1)return{top:0,left:0};let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}}(e.target),s=e.target.offsetHeight,l="psono_drop-"+uuid.v4(),a=n.createElement("div");function c(){n.body.appendChild(a)}function r(){a.remove(),i=(new Date).getTime()}function g(){return n.getElementById(l)}return a.id=l,a.className="psono-drop yui3-cssreset",a.setAttribute("style",`transform: translateX(${o.left}px) translateY(${o.top+s}px) translateZ(0px) !important`),a.innerHTML='<div class="psono-drop-content">'+t+"</div>",n.onclick=function(t){if(t.target!==e.target){let e=n.getElementsByClassName("psono-drop");for(let t=e.length-1;t>=0;t--)e[t].remove();i=(new Date).getTime()}},{open:c,close:r,getElement:g}}(t,u,s);d.open(),n((function(){let e=d.getElement(),t=e.getElementsByClassName(l);for(let e of t)e.addEventListener("click",(function(){g()}));for(let t=0;t<c.length;t++){let n=c[t].class,i=c[t].secret_id,o=e.getElementsByClassName(n);for(let e of o)e.addEventListener("click",(function(){r(i)}))}if(o.data.length>5){let e=s.querySelector(".psono-search-input"),t=s.querySelectorAll(".psono_request-secret");e.addEventListener("click",(function(e){e.stopPropagation()})),e.addEventListener("keyup",(function(){const n=e.value.toLowerCase().split(" ");function i(e){let t=0;e=e.toLowerCase();for(let i=n.length-1;i>=0;i--)e.indexOf(n[i])>-1&&t++;return t===n.length}let o=0;t.forEach((function(e){!i(e.textContent.toLowerCase())||o>=5?e.setAttribute("style","display:none !important"):(o+=1,e.setAttribute("style",""))}))}))}}),0)}))}(o,0,t)}))}(t)}function l(e,t,n){c(e)}function a(e){const t=document.createElement("div");return t.innerText=e,t.innerHTML}function c(e){let t=e.elster_certificate_title.replace(/\s/g,"");t.toLowerCase().endsWith(".pfx")||(t+=".pfx");const i=function(e){const t=new Uint8Array(e.length/2);for(let n=0;n<e.length/2;n++)t[n]=parseInt(e.substr(2*n,2),16);return t}(e.elster_certificate_file_content),o=new Blob([i],{type:"application/x-pkcs12"}),s=new File([o],t,{type:"application/x-pkcs12"}),l=new DataTransfer;l.items.add(s);const a=document.getElementById("loginBox.file_cert");a.files=l.files,a.dispatchEvent(new Event("change")),a.classList.contains("psono-autofill-style")||(a.classList.add("psono-autofill-style"),n((function(){a&&a.classList.remove("psono-autofill-style")}),100));const c=document.getElementById("password");c.focus(),c.value=e.elster_certificate_password,["keydown","keypress","keyup","change","blur","input"].forEach((e=>{c.dispatchEvent(new Event(e,{bubbles:!0,cancelable:!0}))})),c.classList.contains("psono-autofill-style")||(c.classList.add("psono-autofill-style"),n((function(){c&&c.classList.remove("psono-autofill-style")}),100))}function r(t){e.emit("request-secret",{url:document.location.toString(),secret_id:t},(async e=>{c(e.data)}))}function g(){e.emit("open-tab",{url:"/data/index.html"})}e.ready((function(){document.defaultView.location.origin+document.defaultView.location.pathname!=="https://www.elster.de/eportal/login/softpse"&&document.defaultView.location.origin+document.defaultView.location.pathname!=="https://www.elster.de/ekona/login/softpse"||(e.on("fillelstercertificate",l),e.registerObserver(s))}))};