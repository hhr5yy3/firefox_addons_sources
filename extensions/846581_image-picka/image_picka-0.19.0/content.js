!function(){"use strict";const e=/\s*([^,]\S*[^,](?:\s+[^,]+)?)\s*(?:,|$)/,t=(e,t,n)=>{if(e[n]=e[n]||{},e[n][t])throw new Error(`No more than one image candidate is allowed for a given descriptor: ${t}${n}`);e[n][t]=!0},n=(e,t)=>{if(0===t.length)(e=>{if(e.fallback)throw new Error("Only one fallback image candidate is allowed");if(e.x&&e.x[1])throw new Error("A fallback image is equivalent to a 1x descriptor, providing both is invalid.");e.fallback=!0})(e);else if(t.length>1)throw new Error(`Image candidate may have no more than one descriptor, found ${t.length}: ${t.join(" ")}`)},r=(e,t,n)=>{if(Number.isNaN(e))throw new TypeError(`${n||e} is not a valid number`);switch(t){case"w":if(e<=0)throw new Error("Width descriptor must be greater than zero");if(!Number.isInteger(e))throw new TypeError("Width descriptor must be an integer");break;case"x":if(e<=0)throw new Error("Pixel density descriptor must be greater than zero");break;case"h":throw new Error("Height descriptor is no longer allowed");default:throw new Error(`Invalid srcset descriptor: ${n}`)}};let o=[],i=1;function a(){o=pref002.p.get("srcAlternative").split(",").map((e=>e.trim())).filter(Boolean)}function c(o){const i=function(o,{strict:i=!1}={}){const a=i?{}:void 0;return o.replace(/\r?\n/,"").replace(/,\s+/,", ").split(e).filter(((e,t)=>t%2==1)).map((e=>{const[o,...c]=e.trim().split(/\s+/),l={url:o};i&&n(a,c);for(const e of c){const n=e[e.length-1],o=Number.parseFloat(e.slice(0,-1));switch(i&&(r(o,n,e),t(a,o,n)),n){case"w":l.width=o;break;case"h":l.height=o;break;case"x":l.density=o}}return l}))}(o);if(!i.length)throw new Error(`No rules in srcset: ${o}`);let a;for(const e of i)(!a||(e.density||e.width||0)>(a.density||a.width||0))&&(a=e);return f(a.url)}function l(e){for(const t of o){const n=e.getAttribute(t);if(n)return f(n)}if(e.srcset)try{return c(e.srcset)}catch(e){console.warn(e)}if(e.src)return e.src}function u(e){const t=e.closest("picture");return t?function(e){const t=e.querySelectorAll("source");let n;for(const e of t)if(!e.media||!/max-width/.test(e.media)){if(e.media&&/min-width/.test(e.media)){n=e;break}n=e;break}if(n&&n.srcset)try{return c(n.srcset)}catch(e){console.warn(e)}const r=e.querySelector("img");if(r)return l(r);if(t.length){const e=t[t.length-1].srcset;if(e)try{return c(e)}catch(e){console.warn(e)}}}(t):"a"===e.localName?function(e){const t=e.href;return pref002.p.get("detectLink")&&/^[^?#]+\.(?:jpg|png|gif|jpeg|svg|webp)(?:$|[?#])/i.test(t)&&t}(e):l(e)}function s(e){return"img"===e.localName||"input"===e.localName&&"image"===e.type}function f(e){return new URL(e,location.href).href}a(),pref002.p.on("change",(e=>{null!=e.srcAlternative&&a()}));let d,p=[];function g(){p=[...readline004.p(pref002.p.get("urlMap"),2)].map((e=>function(e,t){if(/\$\{[^}]+\}/.test(t)){const n=new RegExp(e,"i"),r=Function(...function*(){for(let e=0;e<10;e++)yield`$${e}=""`}(),`return \`${t}\``);return e=>{const t=e.match(n);return t?r(...t):e}}const n=new RegExp(e,"ig");return e=>e.replace(n,t)}(...e)))}function m(e){return p.reduce(((e,t)=>t(e)),e)}function h(e,t){return function(e,t){if(e===t)return 0;if(e===location.href)return-1;if(t===location.href)return 1;return n(e,t)}(e.referrer,t.referrer)||n(e.alt,t.alt);function n(e,t){return e===t?0:null==e?-1:null==t?1:e<t?-1:e>t?1:0}}function w(){return{pageTitle:document.title,pageUrl:location.href,pageContentType:document.contentType}}function v(){return void 0===d&&(d=document.querySelector('meta[name="referrer"]')||null),d&&d.content||""}function y(e,t,n){return"no-referrer"===n||"no-referrer-when-downgrade"===n&&e.startsWith("https:")&&t.startsWith("http:")?"":e}pref002.p.ready().then((()=>{g(),pref002.p.on("change",(e=>{null!=e.urlMap&&g()}))})),pref002.b.runtime.onMessage.addListener((e=>{switch(e.method){case"getEnv":return Promise.resolve(w());case"getImages":return Promise.resolve(function(){const e=new Map;for(const{src:t,referrerPolicy:n,alt:r,pickaId:o}of function*(){for(const e of document.querySelectorAll('img, input[type="image"], a, picture')){const t=u(e);!t||/^[\w]+-extension/.test(t)||/^about/.test(t)||(e.dataset.pickaId||(e.dataset.pickaId=i++),yield{src:t,referrerPolicy:e.referrerPolicy,alt:e.alt,pickaId:e.dataset.pickaId})}}()){const i=m(t),a={url:i,referrer:y(location.href,i,n||v()),alt:r,pickaId:o},c=e.get(a.url);c&&h(c,a)>=0||e.set(i,a)}return[...e.values()]}());case"fetchImage":return readline004.f(e.url,e.referrer).then((e=>(env005.I&&(e.blobUrl=URL.createObjectURL(e.blob),delete e.blob),e)));case"revokeURL":return URL.revokeObjectURL(e.url);case"viewSourceElement":return function(e){const t=document.querySelector(`[data-picka-id="${e}"]`);if(!t)return void console.error(`Element with pickaId ${e} not found`);t.scrollIntoView({behavior:"smooth"})}(e.pickaId)}})),function({downloadImage:e}){const t={passive:!0};let n=!1;function r(e,t,n){let r=!1;return{update:function(){const o=e();o!==r&&(o?t():n(),r=o)},current:function(){return r}}}function o(e,n,r=document){r.addEventListener(e,n,t)}function i(e,n,r=document){r.removeEventListener(e,n,t)}pref002.p.ready().then((()=>{!function(){function e(){n=pref002.p.get("blacklist").split("\n").some((e=>!!e&&(e.startsWith("*.")?location.hostname.endsWith(e.slice(1)):e===location.hostname)))}e(),pref002.p.on("change",(t=>{null!=t.blacklist&&e()}))}(),function(){const t=r((()=>pref002.p.get("dragndrop")&&!n&&pref002.p.get("enabled")),o,i);function o(){document.addEventListener("dragstart",a)}function i(){document.removeEventListener("dragstart",a)}function a(t){var n=t.target;if("A"==n.nodeName&&(n=[...n.querySelectorAll("img")].find((e=>e.offsetParent))),!n||!s(n))return;const r=[["dragover",o,pref002.p.get("dragndropHard")],["drop",i,pref002.p.get("dragndropHard")],["dragend",a]];for(const e of r)document.addEventListener(...e);function o(e){e.dataTransfer.dropEffect="copy",e.preventDefault(),pref002.p.get("dragndropHard")&&e.stopPropagation()}function i(t){env005.I||!t.buttons?(e({url:u(n),referrerPolicy:n.referrerPolicy||void 0,alt:n.alt}),t.preventDefault()):t.preventDefault()}function a(){for(const e of r)document.removeEventListener(...e)}}t.update(),pref002.p.on("change",t.update)}(),function(){var t,a,c,l,f;let d;const p=r((()=>pref002.p.get("downloadButton")&&!n&&!c&&pref002.p.get("enabled")),g,m);function g(){o("mouseover",w)}function m(){i("mouseover",w)}function h(e){if(!s(e))return!1;var t=e.getBoundingClientRect();return!(t.width<pref002.p.get("downloadButtonMinWidth"))&&!(t.height<pref002.p.get("downloadButtonMinHeight"))}function w(e){var n=e.target;if(a&&a!=n&&(clearTimeout(t),t=a=null),h(n))return null==t?(t=setTimeout((()=>{t=null,E()}),pref002.p.get("downloadButtonDelay")),void(a=n)):void 0}function v(e){f||(f=setTimeout((()=>{f=null,y(e)}),0))}function y(e){var t="mouseover"==e.type?e.target:e.relatedTarget,n=t&&h(t);if(n||t&&t.closest(".image-picka-download-button"))return null!=l&&(clearTimeout(l),l=null),void(n&&t!=a&&(a=t,I()));null==l&&(l=setTimeout((()=>{l=null,b()}),pref002.p.get("downloadButtonDelayHide")))}function b(){i("mouseout",v),i("mouseover",v),c.remove(),a=c=null,p.update()}function E(){o("mouseout",v),o("mouseover",v),k(),document.body.appendChild(c),p.update()}function k(){(c=document.createElement("div")).className="image-picka-download-button";const t=pref002.b.runtime.getURL("/images/download-button.svg");c.style=`\n\t\t\t\twidth: ${pref002.p.get("downloadButtonSize")}px;\n\t\t\t\theight: ${pref002.p.get("downloadButtonSize")}px;\n\t\t\t\tcursor: pointer;\n\t\t\t\tposition: fixed;\n\t\t\t\tz-index: 2147483647;\n\t\t\t\tbackground-image: url(${t});\n\t\t\t\tbackground-size: cover;\n\t\t\t\topacity: 0.85;\n\t\t\t`,I(),c.onclick=()=>{d=function(e){try{return e.animate([{opacity:1,transform:"scale(1.1)"},{opacity:0,transform:"none"}],{duration:600,fill:"forwards"})}catch{return e.style.opacity=0,{cancel:()=>{e.style.opacity=1}}}}(c),e({url:u(a),referrerPolicy:a.referrerPolicy||void 0,alt:a.alt})}}function x(e,t,n,r,o){return n.startsWith(r)?n.endsWith("OUTSIDE")?e-pref002.p.get("downloadButtonSize"):e:n.startsWith(o)?n.endsWith("INSIDE")?e+t-pref002.p.get("downloadButtonSize"):e+t:e+(t-pref002.p.get("downloadButtonSize"))/2}function I(){const e=a.getBoundingClientRect(),t=x(e.left,e.width,pref002.p.get("downloadButtonPositionHorizontal"),"LEFT","RIGHT"),n=x(e.top,e.height,pref002.p.get("downloadButtonPositionVertical"),"TOP","BOTTOM"),r=document.documentElement.clientWidth-pref002.p.get("downloadButtonSize"),o=(document.documentElement.clientHeight||document.body.clientHeight)-pref002.p.get("downloadButtonSize");c.style.left=Math.max(Math.min(t,r),0)+"px",c.style.top=Math.max(Math.min(n,o),0)+"px",d&&d.cancel()}p.update(),pref002.p.on("change",p.update)}(),function(){const t=[{prefix:"single",eventName:"click"},{prefix:"dbl",eventName:"dblclick"}];for(const e of t)e.state=r((()=>pref002.p.get(`${e.prefix}Click`)&&!n&&pref002.p.get("enabled")),(()=>o(e)),(()=>i(e))),e.handleEvent=t=>a(t,e);function o(e){document.addEventListener(e.eventName,e.handleEvent)}function i(e){document.removeEventListener(e.eventName,e.handleEvent)}function a(t,n){if(!s(t.target)||!c(t,n))return;const r=u(t.target);r&&(e({url:r,referrerPolicy:t.target.referrerPolicy||void 0,alt:t.target.alt}),t.preventDefault())}function c(e,t){return e.ctrlKey===pref002.p.get(`${t.prefix}ClickCtrl`)&&e.altKey===pref002.p.get(`${t.prefix}ClickAlt`)&&e.shiftKey===pref002.p.get(`${t.prefix}ClickShift`)}t.forEach((e=>e.state.update())),pref002.p.on("change",(()=>{t.forEach((e=>e.state.update()))}))}()}))}({downloadImage:function({url:e,referrerPolicy:t=v(),alt:n}){e=m(e),pref002.b.runtime.sendMessage({method:"singleDownload",env:window.top===window?w():null,url:e,referrer:y(location.href,e,t),alt:n}).catch(console.error)}})}();
//# sourceMappingURL=content.js.map
