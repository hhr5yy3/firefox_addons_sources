/*! For license information please see decorate.js.LICENSE.txt */
(()=>{var e={7856:function(e,r){var t,n;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,t=function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(void 0===globalThis.browser||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const r="The message port closed before a response was received.",t=e=>{const t={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(t).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class n extends WeakMap{constructor(e,r=void 0){super(r),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const s=(r,t)=>(...n)=>{e.runtime.lastError?r.reject(new Error(e.runtime.lastError.message)):t.singleCallbackArg||n.length<=1&&!1!==t.singleCallbackArg?r.resolve(n[0]):r.resolve(n)},a=e=>1==e?"argument":"arguments",i=(e,r,t)=>new Proxy(r,{apply:(r,n,s)=>t.call(n,e,...s)});let o=Function.call.bind(Object.prototype.hasOwnProperty);const g=(e,r={},t={})=>{let n=Object.create(null),l={has:(r,t)=>t in e||t in n,get(l,c,m){if(c in n)return n[c];if(!(c in e))return;let A=e[c];if("function"==typeof A)if("function"==typeof r[c])A=i(e,e[c],r[c]);else if(o(t,c)){let r=((e,r)=>function(t,...n){if(n.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${a(r.minArgs)} for ${e}(), got ${n.length}`);if(n.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${a(r.maxArgs)} for ${e}(), got ${n.length}`);return new Promise(((a,i)=>{if(r.fallbackToNoCallback)try{t[e](...n,s({resolve:a,reject:i},r))}catch(s){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,s),t[e](...n),r.fallbackToNoCallback=!1,r.noCallback=!0,a()}else r.noCallback?(t[e](...n),a()):t[e](...n,s({resolve:a,reject:i},r))}))})(c,t[c]);A=i(e,e[c],r)}else A=A.bind(e);else if("object"==typeof A&&null!==A&&(o(r,c)||o(t,c)))A=g(A,r[c],t[c]);else{if(!o(t,"*"))return Object.defineProperty(n,c,{configurable:!0,enumerable:!0,get:()=>e[c],set(r){e[c]=r}}),A;A=g(A,r[c],t["*"])}return n[c]=A,A},set:(r,t,s,a)=>(t in n?n[t]=s:e[t]=s,!0),defineProperty:(e,r,t)=>Reflect.defineProperty(n,r,t),deleteProperty:(e,r)=>Reflect.deleteProperty(n,r)},c=Object.create(e);return new Proxy(c,l)},l=e=>({addListener(r,t,...n){r.addListener(e.get(t),...n)},hasListener:(r,t)=>r.hasListener(e.get(t)),removeListener(r,t){r.removeListener(e.get(t))}}),c=new n((e=>"function"!=typeof e?e:function(r){const t=g(r,{},{getContent:{minArgs:0,maxArgs:0}});e(t)})),m=new n((e=>"function"!=typeof e?e:function(r,t,n){let s,a,i=!1,o=new Promise((e=>{s=function(r){i=!0,e(r)}}));try{a=e(r,t,s)}catch(e){a=Promise.reject(e)}const g=!0!==a&&((l=a)&&"object"==typeof l&&"function"==typeof l.then);var l;if(!0!==a&&!g&&!i)return!1;return(g?a:o).then((e=>{n(e)}),(e=>{let r;r=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",n({__mozWebExtensionPolyfillReject__:!0,message:r})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)})),!0})),A=({reject:t,resolve:n},s)=>{e.runtime.lastError?e.runtime.lastError.message===r?n():t(new Error(e.runtime.lastError.message)):s&&s.__mozWebExtensionPolyfillReject__?t(new Error(s.message)):n(s)},u=(e,r,t,...n)=>{if(n.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${a(r.minArgs)} for ${e}(), got ${n.length}`);if(n.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${a(r.maxArgs)} for ${e}(), got ${n.length}`);return new Promise(((e,r)=>{const s=A.bind(null,{resolve:e,reject:r});n.push(s),t.sendMessage(...n)}))},d={devtools:{network:{onRequestFinished:l(c)}},runtime:{onMessage:l(m),onMessageExternal:l(m),sendMessage:u.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:u.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},p={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return t.privacy={network:{"*":p},services:{"*":p},websites:{"*":p}},g(e,d,t)};e.exports=t(chrome)}else e.exports=globalThis.browser},void 0===(n=t.apply(r,[e]))||(e.exports=n)}},r={};function t(n){var s=r[n];if(void 0!==s)return s.exports;var a=r[n]={exports:{}};return e[n].call(a.exports,a,a.exports,t),a.exports}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";const e={async getDecorations(){const e=await browser.storage.local.get("decorations");return e&&e.decorations?e.decorations:[]},async getCampaigns(){const e=await browser.storage.local.get("campaigns");return e&&e.campaigns?e.campaigns:[]},async getUpdateTime(){const e=await browser.storage.local.get("decorationsUpdateTime");return e&&e.decorationsUpdateTime?e.decorationsUpdateTime:null},async setDecorations(e){let r=1;for(const t of e)if(t.decorations&&Array.isArray(t.decorations))for(const e of t.decorations)e._id=r,r+=1;await browser.storage.local.set({decorations:e})},async setCampaigns(e){await browser.storage.local.set({campaigns:e})},async setUpdateTime(e){await browser.storage.local.set({decorationsUpdateTime:e})},findDefaultCampaign:e=>e.find((e=>!0===e.isDefault))||null,findCampaign:(e,r)=>e.find((e=>e.id===r))||null,findBanner(e,r,t){if(!Array.isArray(e.banners))return null;return e.banners.find((e=>t?e.type===r&&e.format===t:e.type===r))||null},findBannerUrl(e,r,t){const n=this.findBanner(e,r,t);return n&&n.url?n.url:null}},r=Object.freeze({TYPE_HTML:"html",TYPE_STYLE:"style",TYPE_CLASS:"classes",TYPE_ATTRS:"attrs",TYPE_CSS:"css",TYPE_BACKGROUND_ALL:"bg_all",TYPE_BACKGROUND_COLUMNS_MULTI:"bg_cols_multi",TYPE_BACKGROUND_COLUMNS_FLEX:"bg_cols_flex",TYPE_BACKGROUND_COLUMNS_ABSOLUTE:"bg_cols_abs",TYPE_BANNER_IFRAME:"bn_iframe",TYPE_BANNER_IMAGE:"bn_image"});class n{async applyDecoration(){throw new Error("Interface declaration")}async isApplied(){throw new Error("Interface declaration")}}class s extends n{constructor(e){super(),this._decorators=e}async applyDecoration(){for(const e of this._decorators)if(!await e.isApplied()&&!await e.applyDecoration())return!1;return!0}async isApplied(){for(const e of this._decorators)if(!await e.isApplied())return!1;return!0}}const a=Object.freeze({TYPE_CSS:"css",TYPE_XPATH:"xpath"}),i=Object.freeze({TYPE_FIRST_CHILD:"first_child",TYPE_LAST_CHILD:"last_child",TYPE_BEFORE:"before",TYPE_AFTER:"after",TYPE_REPLACE:"replace"}),o={getTargetElementByCss(e){try{return document.querySelector(e)}catch(e){return null}},getTargetElementByXpath(e){try{const r=document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return r&&r.singleNodeValue&&r.singleNodeValue.firstChild?r.singleNodeValue.firstChild.parentElement:null}catch(e){return null}},getTargetElement(e,r=a.TYPE_CSS){return e?r===a.TYPE_XPATH?this.getTargetElementByXpath(e):r===a.TYPE_CSS?this.getTargetElementByCss(e):null:null},insertHtml(e,r,t=i.TYPE_FIRST_CHILD){if(!r)return null;switch(t){case i.TYPE_BEFORE:return r.insertAdjacentHTML("beforebegin",e),r.previousElementSibling;case i.TYPE_FIRST_CHILD:return r.insertAdjacentHTML("afterbegin",e),r.firstElementChild;case i.TYPE_LAST_CHILD:return r.insertAdjacentHTML("beforeend",e),r.lastElementChild;case i.TYPE_AFTER:return r.insertAdjacentHTML("afterend",e),r.nextElementSibling;case i.TYPE_REPLACE:return r.replaceWith(e),r;default:return null}}};class g extends n{constructor(e){super(),this._decoration=e}get decoration(){return this._decoration}set decoration(e){this._decoration=e}getTarget(){return this._decoration.target?o.getTargetElement(this._decoration.target,this._decoration.selector):null}insertHtml(e,r){return o.insertHtml(e,r,this._decoration.position)}async isApplied(){const e=this._decoration._id;return!!document&&null!==document.querySelector(`[data-id="${e}"]`)}}class l extends g{constructor(e,r){super(e),this._campaign=r}get campaign(){return this._campaign}set campaign(e){this._campaign=e}}const c=Object.freeze({TYPE_BACKGROUND:"bg",TYPE_BACKGROUND_BILLBOARD:"bg_bb",TYPE_BACKGROUND_LEFT:"bg_left",TYPE_BACKGROUND_RIGHT:"bg_right",TYPE_IFRAME:"iframe",TYPE_IMAGE:"image"});var m=Object.prototype.toString,A=Array.isArray||function(e){return"[object Array]"===m.call(e)};function u(e){return"function"==typeof e}function d(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function p(e,r){return null!=e&&"object"==typeof e&&r in e}var h=RegExp.prototype.test,f=/\S/;var x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},b=/\s*/,y=/\s+/,w=/\s*=/,T=/\s*\}/,E=/#|\^|\/|>|\{|&|=|!/;function _(e){this.string=e,this.tail=e,this.pos=0}function v(e,r){this.view=e,this.cache={".":this.view},this.parent=r}function C(){this.templateCache={_cache:{},set:function(e,r){this._cache[e]=r},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}_.prototype.eos=function(){return""===this.tail},_.prototype.scan=function(e){var r=this.tail.match(e);if(!r||0!==r.index)return"";var t=r[0];return this.tail=this.tail.substring(t.length),this.pos+=t.length,t},_.prototype.scanUntil=function(e){var r,t=this.tail.search(e);switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r},v.prototype.push=function(e){return new v(e,this)},v.prototype.lookup=function(e){var r,t,n,s=this.cache;if(s.hasOwnProperty(e))r=s[e];else{for(var a,i,o,g=this,l=!1;g;){if(e.indexOf(".")>0)for(a=g.view,i=e.split("."),o=0;null!=a&&o<i.length;)o===i.length-1&&(l=p(a,i[o])||(t=a,n=i[o],null!=t&&"object"!=typeof t&&t.hasOwnProperty&&t.hasOwnProperty(n))),a=a[i[o++]];else a=g.view[e],l=p(g.view,e);if(l){r=a;break}g=g.parent}s[e]=r}return u(r)&&(r=r.call(this.view)),r},C.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},C.prototype.parse=function(e,r){var t=this.templateCache,n=e+":"+(r||k.tags).join(":"),s=void 0!==t,a=s?t.get(n):void 0;return null==a&&(a=function(e,r){if(!e)return[];var t,n,s,a,i=!1,o=[],g=[],l=[],c=!1,m=!1,u="",p=0;function x(){if(c&&!m)for(;l.length;)delete g[l.pop()];else l=[];c=!1,m=!1}function v(e){if("string"==typeof e&&(e=e.split(y,2)),!A(e)||2!==e.length)throw new Error("Invalid tags: "+e);t=new RegExp(d(e[0])+"\\s*"),n=new RegExp("\\s*"+d(e[1])),s=new RegExp("\\s*"+d("}"+e[1]))}v(r||k.tags);for(var C,P,R,U,L,N,B=new _(e);!B.eos();){if(C=B.pos,R=B.scanUntil(t))for(var O=0,S=R.length;O<S;++O)a=U=R.charAt(O),function(e,r){return h.call(e,r)}(f,a)?(m=!0,i=!0,u+=" "):(l.push(g.length),u+=U),g.push(["text",U,C,C+1]),C+=1,"\n"===U&&(x(),u="",p=0,i=!1);if(!B.scan(t))break;if(c=!0,P=B.scan(E)||"name",B.scan(b),"="===P?(R=B.scanUntil(w),B.scan(w),B.scanUntil(n)):"{"===P?(R=B.scanUntil(s),B.scan(T),B.scanUntil(n),P="&"):R=B.scanUntil(n),!B.scan(n))throw new Error("Unclosed tag at "+B.pos);if(L=">"==P?[P,R,C,B.pos,u,p,i]:[P,R,C,B.pos],p++,g.push(L),"#"===P||"^"===P)o.push(L);else if("/"===P){if(!(N=o.pop()))throw new Error('Unopened section "'+R+'" at '+C);if(N[1]!==R)throw new Error('Unclosed section "'+N[1]+'" at '+C)}else"name"===P||"{"===P||"&"===P?m=!0:"="===P&&v(R)}if(x(),N=o.pop())throw new Error('Unclosed section "'+N[1]+'" at '+B.pos);return function(e){for(var r,t=[],n=t,s=[],a=0,i=e.length;a<i;++a)switch((r=e[a])[0]){case"#":case"^":n.push(r),s.push(r),n=r[4]=[];break;case"/":s.pop()[5]=r[2],n=s.length>0?s[s.length-1][4]:t;break;default:n.push(r)}return t}(function(e){for(var r,t,n=[],s=0,a=e.length;s<a;++s)(r=e[s])&&("text"===r[0]&&t&&"text"===t[0]?(t[1]+=r[1],t[3]=r[3]):(n.push(r),t=r));return n}(g))}(e,r),s&&t.set(n,a)),a},C.prototype.render=function(e,r,t,n){var s=this.getConfigTags(n),a=this.parse(e,s),i=r instanceof v?r:new v(r,void 0);return this.renderTokens(a,i,t,e,n)},C.prototype.renderTokens=function(e,r,t,n,s){for(var a,i,o,g="",l=0,c=e.length;l<c;++l)o=void 0,"#"===(i=(a=e[l])[0])?o=this.renderSection(a,r,t,n,s):"^"===i?o=this.renderInverted(a,r,t,n,s):">"===i?o=this.renderPartial(a,r,t,s):"&"===i?o=this.unescapedValue(a,r):"name"===i?o=this.escapedValue(a,r,s):"text"===i&&(o=this.rawValue(a)),void 0!==o&&(g+=o);return g},C.prototype.renderSection=function(e,r,t,n,s){var a=this,i="",o=r.lookup(e[1]);if(o){if(A(o))for(var g=0,l=o.length;g<l;++g)i+=this.renderTokens(e[4],r.push(o[g]),t,n,s);else if("object"==typeof o||"string"==typeof o||"number"==typeof o)i+=this.renderTokens(e[4],r.push(o),t,n,s);else if(u(o)){if("string"!=typeof n)throw new Error("Cannot use higher-order sections without the original template");null!=(o=o.call(r.view,n.slice(e[3],e[5]),(function(e){return a.render(e,r,t,s)})))&&(i+=o)}else i+=this.renderTokens(e[4],r,t,n,s);return i}},C.prototype.renderInverted=function(e,r,t,n,s){var a=r.lookup(e[1]);if(!a||A(a)&&0===a.length)return this.renderTokens(e[4],r,t,n,s)},C.prototype.indentPartial=function(e,r,t){for(var n=r.replace(/[^ \t]/g,""),s=e.split("\n"),a=0;a<s.length;a++)s[a].length&&(a>0||!t)&&(s[a]=n+s[a]);return s.join("\n")},C.prototype.renderPartial=function(e,r,t,n){if(t){var s=this.getConfigTags(n),a=u(t)?t(e[1]):t[e[1]];if(null!=a){var i=e[6],o=e[5],g=e[4],l=a;0==o&&g&&(l=this.indentPartial(a,g,i));var c=this.parse(l,s);return this.renderTokens(c,r,t,l,n)}}},C.prototype.unescapedValue=function(e,r){var t=r.lookup(e[1]);if(null!=t)return t},C.prototype.escapedValue=function(e,r,t){var n=this.getConfigEscape(t)||k.escape,s=r.lookup(e[1]);if(null!=s)return"number"==typeof s&&n===k.escape?String(s):n(s)},C.prototype.rawValue=function(e){return e[1]},C.prototype.getConfigTags=function(e){return A(e)?e:e&&"object"==typeof e?e.tags:void 0},C.prototype.getConfigEscape=function(e){return e&&"object"==typeof e&&!A(e)?e.escape:void 0};var k={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){P.templateCache=e},get templateCache(){return P.templateCache}},P=new C;k.clearCache=function(){return P.clearCache()},k.parse=function(e,r){return P.parse(e,r)},k.render=function(e,r,t,n){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(A(s=e)?"array":typeof s)+'" was given as the first argument for mustache#render(template, view, partials)');var s;return P.render(e,r,t,n)},k.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return x[e]}))},k.Scanner=_,k.Context=v,k.Writer=C;const R=k;class U extends l{async applyDecoration(){if(void 0===document.createElement("div").style.flex)return!1;const r=this.decoration,t=r._id,n=this.campaign;if(!r||!n)return!1;const s=this.getTarget();if(!s)return!1;const a=n.url,i=e.findBannerUrl(n,c.TYPE_BACKGROUND_LEFT),o=e.findBannerUrl(n,c.TYPE_BACKGROUND_RIGHT);if(!(a&&i&&o))return!1;const g=R.render('<div class="p2w-wrapper" style="position: fixed; width: 100%; height: 100%; display: flex;" data-id="{{decorationId}}">\n  <div class="p2w-col p2w-col-left" style="flex-grow: 1; position: relative; max-width: 300px;\n      background-size: cover; background-repeat: no-repeat; background-image: url({{leftImageUrl}});">\n    <a href={{linkUrl}} target="_blank" rel="noopener noreferrer">\n      <span style="position: absolute; top: 0; right: 0; bottom: 0; left: 0;"></span>\n    </a>\n  </div>\n  <div class="p2w-overlap" style="height: 100%; flex-grow: 1;"></div>\n  <div class="p2w-col p2w-col-right" style="flex-grow: 1; position: relative; max-width: 300px;\n      background-size: cover; background-repeat: no-repeat; background-image: url({{rightImageUrl}});">\n    <a href={{linkUrl}} target="_blank" rel="noopener noreferrer">\n      <span style="position: absolute; top: 0; right: 0; bottom: 0; left: 0;"></span>\n    </a>\n  </div>\n</div>\n',{linkUrl:a,leftImageUrl:i,rightImageUrl:o,decorationId:t});return this.insertHtml(g,s),!0}}class L extends l{async applyDecoration(){const r=this.decoration,t=this.campaign;if(!r||!t)return!1;const n=this.getTarget();if(!n)return!1;const s=e.findBannerUrl(t,c.TYPE_BACKGROUND_LEFT),a=e.findBannerUrl(t,c.TYPE_BACKGROUND_RIGHT);return!(!s||!a||(n.style.backgroundRepeat="no-repeat",n.style.backgroundAttachment="fixed",n.style.backgroundPosition="top left, top right",n.style.backgroundImage=`url(${s}), url(${a})`,0))}}class N extends l{async applyDecoration(){const r=this.decoration,t=this.campaign;if(!r||!t)return!1;const n=this.getTarget();if(!n)return!1;const s=e.findBannerUrl(t,c.TYPE_BACKGROUND_BILLBOARD);return!!s&&(n.style.backgroundRepeat="no-repeat",n.style.backgroundAttachment="fixed",n.style.backgroundPosition="top",n.style.backgroundImage=`url(${s})`,!0)}}class B extends l{async applyDecoration(){const e=this.decoration,r=e._id,t=this.campaign;if(!e||!t)return!1;const n=this.getTarget();if(!n)return!1;const s=t.url;if(!s)return!1;const a=`\n      <a href=${s} target="_blank" rel="noopener" data-id="${r}">\n        <span style="cursor: pointer; position: fixed; top: 0; left: 0; height: 100%; width: 100%;"></span>\n      </a>\n    `;return this.insertHtml(a,n),!0}}class O extends g{async applyDecoration(){const e=this.decoration;if(!e||!e.style)return!1;const r=this.getTarget();return this.applyToNode(r,e.style)}applyToNode(e,r){if(!e)return!1;for(const[t,n]of Object.entries(r))e.style[t]=n;return!0}}class S extends g{async applyDecoration(){const e=this.decoration;if(!e||!e.classList)return!1;const r=this.getTarget();return this.applyToNode(r,e.classList)}applyToNode(e,r){return!!e&&(e.classList.add(...r),!0)}}class D extends g{async applyDecoration(){const e=this.decoration;if(!e||!e.css)return!1;const r=document.createElement("style");if(!document.head)return!1;document.head.appendChild(r);const t=r.sheet;for(const r of e.css)t.insertRule(r,t.cssRules.length);return!0}}class I extends l{async applyDecoration(){const r=this.decoration,t=r._id,n=this.campaign;if(!r||!n)return!1;const s=this.getTarget();if(!s)return!1;const a=n.url,i=e.findBannerUrl(n,c.TYPE_BACKGROUND_LEFT),o=e.findBannerUrl(n,c.TYPE_BACKGROUND_RIGHT);if(!(a&&i&&o))return!1;const g=R.render('<a href={{linkUrl}} target="_blank" rel="noopener noreferrer" data-id="{{decorationId}}">\n  <span class="p2w-col p2w-col-left" style="\n      position: absolute;\n      left: 0;\n      top: 0;\n      bottom: 0;\n      background-repeat: repeat-y;\n      background-image: url({{ leftImageUrl }});\n      max-width: 300px;\n      "></span>\n</a>\n<a href={{linkUrl}} target="_blank" rel="noopener noreferrer" data-id="{{decorationId}}">\n  <span class="p2w-col p2w-col-right" style="\n      position: absolute;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      background-repeat: repeat-y;\n      background-image: url({{ rightImageUrl }});\n      max-width: 300px;\n      "></span>\n</a>\n',{linkUrl:a,leftImageUrl:i,rightImageUrl:o,decorationId:t}),l=this.insertHtml(g,s);return l&&(l.parentElement.style.position="relative"),!0}}class Y extends g{async applyDecoration(){const e=this.decoration;if(!e)return!1;const r=this.getTarget();return!!r&&!!e.html&&(this.insertHtml(e.html,r),!0)}async isApplied(){const e=this.decoration;return!!e.html&&!(!document.documentElement||!document.documentElement.outerHTML)&&document.documentElement.outerHTML.includes(e.html)}}const j=Object.freeze({SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE",SYNCHRONIZE:"SYNCHRONIZE",CLOSE_INSTALLED:"CLOSE_INSTALLED",DOWNLOAD_BLOB:"DOWNLOAD_BLOB",OPEN_TAB:"OPEN_TAB",TRACK_EVENT:"TRACK_EVENT",NOTIFY:"NOTIFY",ERROR:"ERROR"});class M extends l{getDimensions(e){const[r,t]=e.split("x");return{width:r,height:t}}addCampaignClickListener(e){const r=this._campaign;e&&r.url&&e.addEventListener("click",(async function(e){e.preventDefault(),e.stopPropagation(),await browser.runtime.sendMessage({channel:j.OPEN_TAB,url:r.url})}),!1)}}class F extends M{async applyDecoration(){const r=this.decoration,t=r._id,n=this.campaign;if(!r||!n)return!1;const s=this.getTarget();if(!s)return!1;const a=e.findBanner(n,c.TYPE_IFRAME,r.format);if(!a)return!1;const{width:i,height:o}=this.getDimensions(a.size);if(!i||!o)return!1;const g=R.render('<iframe class="p2w-bnr {{#format}}p2w-bnr-{{format}}{{/format}}" data-id="{{decorationId}}"\n        style="border: none; overflow: hidden;"\n        scrolling="no"\n        frameborder="0"\n        marginwidth="0"\n        width="{{width}}"\n        height="{{height}}"\n        src="{{iframeUrl}}">\n</iframe>\n',{iframeUrl:a.url,width:i,height:o,format:r.format,decorationId:t}),l=this.insertHtml(g,s);return!!l&&(this.addCampaignClickListener(l),!0)}}class H extends M{async applyDecoration(){const r=this.decoration,t=r._id,n=this.campaign;if(!r||!n)return!1;const s=this.getTarget();if(!s)return!1;const a=e.findBanner(n,c.TYPE_IMAGE,r.format);if(!a)return!1;const{width:i,height:o}=this.getDimensions(a.size);if(!i||!o)return!1;let g;if(r.dl)try{const e={channel:j.DOWNLOAD_BLOB,url:a.url};if(a.referer&&(e.referer=a.referer),g=await browser.runtime.sendMessage(e),!g)return!1}catch(e){return!1}else g=a.url;const l=R.render('<div class="p2w-bnr {{#format}}p2w-bnr-{{format}}{{/format}}" data-id="{{decorationId}}">\n  <a href="{{url}}">\n    <img src="{{imageData}}" style="max-width: {{width}}px; max-height: {{height}}px"/>\n  </a>\n</div>\n',{url:n.url,imageData:g,width:i,height:o,format:r.format,decorationId:t}),m=this.insertHtml(l,s);return!!m&&(this.addCampaignClickListener(m),!0)}}class G extends g{async applyDecoration(){const e=this.decoration;if(!e||!e.attrs)return!1;const r=this.getTarget();return this.applyToNode(r,e.attrs)}applyToNode(e,r){if(!e)return!1;for(const[t,n]of Object.entries(r))e.setAttribute(t,n);return!0}}const $={createDecorator(e,t){if(!e.type)return null;switch(e.type){case r.TYPE_HTML:return new Y(e);case r.TYPE_STYLE:return new O(e);case r.TYPE_CLASS:return new S(e);case r.TYPE_ATTRS:return new G(e);case r.TYPE_CSS:return new D(e);case r.TYPE_BANNER_IFRAME:return new F(e,t);case r.TYPE_BANNER_IMAGE:return new H(e,t);case r.TYPE_BACKGROUND_COLUMNS_FLEX:return new U(e,t);case r.TYPE_BACKGROUND_COLUMNS_ABSOLUTE:return new I(e,t);case r.TYPE_BACKGROUND_ALL:return new s([new N(e,t),new B(e,t)]);case r.TYPE_BACKGROUND_COLUMNS_MULTI:return new s([new L(e,t),new B(e,t)]);default:return null}}},K={async decorate(){const r=await e.getDecorations(),t=await e.getCampaigns();if(!Array.isArray(r)||r.length<1)return;if(!Array.isArray(t)||t.length<1)return;const n=this.findDecorationSet(r,window.location.href);if(!n)return;let s=e.findDefaultCampaign(t);n.campaignId&&(s=e.findCampaign(t,n.campaignId));for(const r of n.decorations){const n=e.findCampaign(t,r.campaignId)||s;if(!n)continue;const a=$.createDecorator(r,n);a&&(await a.isApplied()||await a.applyDecoration())}},findDecorationSet:(e,r)=>e.find((e=>!!Array.isArray(e.patterns)&&e.patterns.some((e=>new RegExp(e).test(r)))))};t.g.browser=t(7856),K.decorate().catch((e=>{browser.runtime.sendMessage({channel:j.ERROR,error:e.message}).then()}))})()})();