import{E as gt,F as ht,G as U,H as oe,I as wt,J as l,K as ne,Q as vt,U as ie,V as xt,ca as It,h as ee,j as te,p as pt,q as h,r as re}from"./chunk-OEPSEZ5A.js";import{e as ae,s as kt}from"./chunk-AT6M4CEW.js";import{c as R,d as mt,e as f}from"./chunk-3GYLW4KZ.js";var $=R((Qt,B)=>{var ue=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);ue?(H=new Uint8Array(16),B.exports=function(){return ue(H),H}):(E=new Array(16),B.exports=function(){for(var t=0,r;t<16;t++)t&3||(r=Math.random()*4294967296),E[t]=r>>>((t&3)<<3)&255;return E});var H,E});var G=R((Zt,fe)=>{var de=[];for(_=0;_<256;++_)de[_]=(_+256).toString(16).substr(1);var _;function Rt(e,t){var r=t||0,o=de;return[o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]]].join("")}fe.exports=Rt});var pe=R((Kt,me)=>{var _t=$(),bt=G(),le,W,j=0,Y=0;function Pt(e,t,r){var o=t&&r||0,i=t||[];e=e||{};var a=e.node||le,p=e.clockseq!==void 0?e.clockseq:W;if(a==null||p==null){var m=_t();a==null&&(a=le=[m[0]|1,m[1],m[2],m[3],m[4],m[5]]),p==null&&(p=W=(m[6]<<8|m[7])&16383)}var g=e.msecs!==void 0?e.msecs:new Date().getTime(),k=e.nsecs!==void 0?e.nsecs:Y+1,J=g-j+(k-Y)/1e4;if(J<0&&e.clockseq===void 0&&(p=p+1&16383),(J<0||g>j)&&e.nsecs===void 0&&(k=0),k>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");j=g,Y=k,W=p,g+=122192928e5;var S=((g&268435455)*1e4+k)%4294967296;i[o++]=S>>>24&255,i[o++]=S>>>16&255,i[o++]=S>>>8&255,i[o++]=S&255;var D=g/4294967296*1e4&268435455;i[o++]=D>>>8&255,i[o++]=D&255,i[o++]=D>>>24&15|16,i[o++]=D>>>16&255,i[o++]=p>>>8|128,i[o++]=p&255;for(var A=0;A<6;++A)i[o+A]=a[A];return t||bt(i)}me.exports=Pt});var he=R((Xt,ge)=>{var yt=$(),St=G();function Dt(e,t,r){var o=t&&r||0;typeof e=="string"&&(t=e==="binary"?new Array(16):null,e=null),e=e||{};var i=e.random||(e.rng||yt)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t)for(var a=0;a<16;++a)t[o+a]=i[a];return t||St(i)}ge.exports=Dt});var xe=R((Jt,ve)=>{var At=pe(),we=he(),Q=we;Q.v1=At;Q.v4=we;ve.exports=Q});var q=f(h());var V=f(ht()),se=V.default;window.Baobab?se=window.Baobab:window.Baobab=V.default;var ce=se;var L=[],z=window.tree||new ce({notification:{run:null,relatedRuns:null,lastSavings:0,currentSavings:0,updating:!1,showModal:!1,details:null,activeRunId:!1},messages:[],shadowRootsByRoute:{}},{immutable:!1});window.tree||(window.tree=z);z.on("get",e=>{let t=e.data.solvedPath,r=t?t.join("."):!1,o=e.data.data,i=q.default.find(L,{path:r});i&&i.loader&&i.loader(o,e.data.solvedPath)});function jt(e,t){if(q.default.find(L,{path:e}))throw new Error("Only one loader per path");L.push({path:e,loader:t})}var n=z;var ft=f(xe()),lt=f(vt());var X={};mt(X,{abortRun:()=>C,addPriceRun:()=>be,amazonResultsReceived:()=>Pe,communityDealReceived:()=>Be,feedbackDataReceived:()=>$e,getCookie:()=>We,hideFollow:()=>je,modalDetailsReceived:()=>Ye,notifyXHRIsQuiet:()=>Je,platformSelectors:()=>tt,setupPriceRunPusherBindings:()=>_e,showFollow:()=>ot,showSiteHub:()=>st,terminatePriceRun:()=>ct,updatePriceRun:()=>ut,warnAboutStandDown:()=>dt});var C=e=>{v("abortRun",e)};var Z=f(U()),Ie=f(It());ne();var b=e=>c("pusherEvents",e);var x={},u={};function ke(e,t){u[e]&&(u[e]={...u[e],...t})}function Ct(e,t){return setTimeout(()=>{T(e,t)},3e4)}function Tt(e,t){if(e)return setTimeout(()=>{C({run:{runId:t}}),b({eventType:"run-aborted",response:{runId:t}})},3e4)}function Re(e,t){let r=Ct(t.userId,e),o=Tt(t.meta.isAmzProductPage,e);u[e]={input:t,inTabTimeoutIds:{abortAmzProductPageRunId:o,terminateRunId:r}},l(["**** added price run ****",e,u[e]])}function T(e,t){u[t]&&(delete u[t],l(["**** terminated price run ****",t])),Mt(e)}async function Mt(e){if(Object.keys(u).length>0)return;let t=await x[e];t&&(t.disconnect(),delete x[e],l(["**** disconnected pusher ****",e]))}var _e=e=>{let{userId:t}=e;return x[t]?x[t].then(()=>Z.default.resolve()):(x[t]=(0,Ie.setupPriceRunPusherBindings)(e,Nt(t),Ft,Ot),x[t].then(()=>Z.default.resolve()))};function Nt(e){return async t=>{let r="run-finished-v2",{runId:o}=t;try{if(l([`**** handling event ${r} ****`,o,u[o]]),!u[o]){l([`*** Terminating ${r} handler. Price run is not available.`]);return}clearTimeout(u[o].inTabTimeoutIds.terminateRunId),clearTimeout(u[o].inTabTimeoutIds.abortAmzProductPageRunId),b({eventType:r,response:t,additionalData:u[o]})}catch(i){l(["**** run-finished-v2 error ****",i.message,i.stack,{runId:o}])}finally{T(e,o)}}}function Ft(e){let t="run-instantOffers",{runId:r}=e;try{if(l([`**** handling event ${t} ****`,r,u[r]]),!u[r]){l([`*** Terminating ${t} handler. Price run is not available.`]);return}b({eventType:t,response:e,additionalData:u[r]})}catch(o){l(["**** run-instantOffers error ****",o.message,o.stack,{runId:r}])}}function Ot(e){try{let t="run-priceRequest-v2",r=e.inputData?.meta?.tab?.id,o=n.get("tabId"),i=u[e.runId]||r===o&&{input:e.inputData};if(l([`**** handling event ${t} ****`,e.runId,e.result?.id,i]),!u[e.runId]&&(!r||r!==o)){l([`*** Terminating ${t} handler. No price run or tab data available.`]);return}b({eventType:t,response:e,additionalData:i})}catch(t){l(["**** run price request error ****",t.message,t.stack,{runId:e.runId,priceId:e.result?.id}])}}var be=(e,t)=>Re(e,t);var Pe=e=>{v("amazonResultsReceived",e)};var N=f(h());function ye(e,t){let r=e.exec(t);return r&&r.length?r[1]:null}var Oe=f(U());pt();var s=f(h()),Ue=f(re());var Se=e=>c("addToAmazonCart",e);var Ut=e=>c("completeTooltipSteps",{step:e});var De=e=>c("loadProduct",e);xt();wt();var{WIKIBUY_URL:Ar,WIKIBUY_API:Ae,SITE_API_V3:Cr,ASYNC_TIGGER_IFRAME_URL:Tr}=oe();var Nr=30,Fr="https://cdn.capitaloneshopping.com/wikibuy-assets";function Ce(e){let t=n.get("platformDomain");if(n.get("platform")==="Shopify"&&t)return t}function Te({params:e={},isWbPublisher:t=!1}={}){if(e.destUrl?.includes("shop.app")||e.destUrl?.includes("rechargeapps.com")){let r=Ce(e.destUrl);e.destUrl=r}return ie({params:e,isWbPublisher:t,sessionId:n.get(["session","id"]),WIKIBUY_API:Ae})}var K=f(h()),Ne=f(re());ne();var Me=f(gt()),M;window.__wbCurrentDomain&&(M=window.__wbCurrentDomain);var w=()=>M||Me.default.getDomain(location.href);function $r(e){M=e,window.__wbCurrentDomain=M}var Fe=e=>({domain:w(),pagePath:location.pathname,pageViewId:n.get("pageViewId"),docStartAt:window.__wb_timing.docStartAt,DOMContentLoadedAt:window.__wb_timing.DOMContentLoadedAt,sendMetricAt:performance.now(),...e});function Zr(e,t={}){if(!e){l("pageName parameter is required");return}let r=Fe(t);c("wbAnalytics",{method:"page",priceCheckId:window.priceCheckId,args:[e,r]})}function Kr(e,t={}){if(!e){l("eventName parameter is required");return}let r=Fe(t);c("wbAnalytics",{method:"track",priceCheckId:window.priceCheckId,args:[e,r]})}function I(e,...t){let r=K.default.find(t,i=>!K.default.isString(i));r?(r.domain=r.domain||w(),r.pagePath=r.pagePath||location.pathname,r.pageViewId=n.get("pageViewId"),r.docStartAt=window.__wb_timing.docStartAt,r.DOMContentLoadedAt=window.__wb_timing.DOMContentLoadedAt,r.sendMetricAt=performance.now(),e==="page"&&r.source&&((!window.__wb_contentId||window.__wb_contentId.constructor!==Object)&&(window.__wb_contentId={}),r.contentId=(0,Ne.v4)(),window.__wb_contentId[r.source]=r.contentId)):t.push({domain:w(),pagePath:location.pathname});let o={page:{path:window.location.pathname,referrer:document.referrer,search:window.location.search,title:document.title,url:window.location.href}};t.push(o),c("wbAnalytics",{method:e,priceCheckId:window.priceCheckId,args:t})}var d=n.select("notification");function Vt(e){if((e.asin||s.default.get(e,"gtins[0]"))!==n.get("currentASIN")&&!n.get("ignoreCurrentASIN")&&!e.instantOffers)return;e.instantOffers&&I("track","instantOffersReceived",{parentQuoteId:e.instantOffers.runId,quoteId:e.instantOffers.instantOffersRunId,trigger:n.get("trigger"),currentLocation:s.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])});let r=s.default.clone(d.get("run")||{});s.default.get(e,"run.runId")===s.default.get(r,"runId")&&e.modal&&(r.betterResults=s.default.map(s.default.get(r,"betterResults"),o=>(o.id===e.modal.id&&(o=e.modal),o))),d.merge({details:e.modal,run:s.default.isEmpty(r)?e.run:r,lastChance:!1,cartPricing:e.cartPricing}),Ve(e)}function Ve(e,t){let r=s.default.get(e,"cartPricing.savings")||e.run.savings;if((s.default.get(e,"run.inputData.asin")||s.default.get(e,"run.inputData.gtins[0]"))!==n.get("currentASIN")&&!t||d.get("activeRunId")===s.default.get(e.run,"runId"))return;e.run.status==="complete"&&(I("page","quoteCompleteNotification",{view:"quoteCompleteNotification",type:"notification",matchDomain:s.default.get(e.run,"betterResults[0].vendor",null),matchUrl:s.default.get(e.run,"betterResults[0].product.url",null),savings:r>0?r:null,paymentsSupport:!!s.default.get(e,"cartPricing.paymentsSupport")}),qe(e.run),d.merge({activeRunId:s.default.get(e.run,"runId")}));let a=r>0;d.merge({run:e.run,currentSavings:r,updating:!0,lastSavings:d.get("currentSavings"),showPopup:a,resetting:!1,ignoreRun:!1})}function Le(e){window.priceCheckId=Ue.default.v4(),d.set(["priceCheckStarted"],!0),I("track","priceCheckStart",{quoteId:e,priceCheckId:window.priceCheckId,trigger:n.get("trigger"),currentLocation:s.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])})}function qe(e){d.get("priceCheckStarted")||(Le(e.runId),d.set(["endFiredFirst"],e.runId)),d.set(["priceCheckStarted"],!1),I("track","priceCheckEnd",{quoteId:e.runId,category:s.default.get(e,"originResult.product.vendorCategory"),priceCheckId:window.priceCheckId,matchId:s.default.get(e,"betterResults[0].id")})}function Lt(){d.merge({run:{},details:null,cartPricing:null,currentSavings:0,updating:!0,lastSavings:d.get("currentSavings"),showPopup:!1,resetting:!0,ignoreRun:!1,communityDeal:null}),n.set("bestAmazonResult",null)}function mo(){d.merge({ignoreRun:!0})}async function po(){n.set("appReady",!0);let e=n.get("messages");await Oe.default.delay(1e3),s.default.forEach(e,t=>{t.type!=="resetNotification"&&ze(t)}),n.set("messages",[])}function qt(e,t){let r=s.default.find(e,a=>!!s.default.get(a,"meta.isOrigin")),o=s.default.get(r,"pricing.total");if(!r||!o)return!1;let i=(0,s.default)(e).map(a=>{let p=s.default.get(a,"pricing.total")?o-s.default.get(a,"pricing.total"):0;if(a.savings=p>0?p:0,!a.product.wbpid)try{let m=a.product.url.match(/gp\/product\/(.*)\/|dp\/(.*)\?/),g=m[2]||m[1];g&&(a.product.wbpid=`amazon.com_${g}`)}catch{}return a}).filter(a=>!!a.savings).sortBy(["savings",a=>te(ee(a?.details?.arrival_date,"ccc. MMM. d"))],["desc","asc"]).reverse().value();i&&i.length&&n.set("bestAmazonResult",i[0])}function ze(e){if(!n.get("appReady")){n.push(["messages"],e);return}let{type:t,...r}=e;if(r)switch(t){case"setInputData":d.merge({inputData:r.inputData});break;case"modalDetailsReceived":Vt(r);break;case"runUpdated":Ve(r);break;case"abortRun":d.merge({run:{status:"complete",runId:s.default.get(r,"run.runId"),aborted:!0},currentSavings:0,updating:!1,lastSavings:d.get("currentSavings"),showPopup:!1,resetting:!1}),r.run&&qe(r.run);break;case"resetNotification":Lt();break;case"setRunId":{d.get("endFiredFirst")!==r.runId&&(Le(r.runId),d.set(["endFiredFirst"],null));break}case"amazonResultsReceived":qt(e.amazonResults,e.runId);break;default:console.log("unknown message",e)}}window.handleMessage=ze;async function He(e){if(n.get(["ProductPage","lastRunId"])===e.runId)return;n.get(["ProductPage"])?n.merge("ProductPage",{isFetching:!0,lastRunId:e.runId}):n.set("ProductPage",{isFetching:!0,lastRunId:e.runId});let r=await De(e);r?(r.isFetching=!1,n.merge("ProductPage",r)):n.merge("ProductPage",{isFetching:!1})}function go(e){return Se(e)}var y;async function Ee(e){y=e,n.set(["siteHubView","primaryDeal"],e),zt([]);let t=e.id,r=e.runId,o=e.asin;He({id:t,asin:o,runId:r})}function zt(e){e=N.default.filter(e,r=>r.savings);let t=n.get(["siteHubView","deals"]);if(t?t=(0,N.default)(t.concat(e)).uniq("asin").filter(r=>r.asin!==N.default.get(y,"asin")).value():t=e,n.set(["siteHubView","deals"],t),y)y.savings>0?P({active:!0,text:"1"}):P({active:!0,text:""});else if(t.length){let r=t.length+(y?1:0);P({active:!0,text:r.toString()})}else P({active:!1,text:""})}var Be=e=>{if(e&&!e.error&&e.deal.asin===n.get("currentASIN")){n.set(["notification","communityDeal"],e);let t=e.deal;Ee(t)}else e&&e.error&&n.set(["notification","communityDeal"],e)};var $e=e=>{n.set(["notification","feedbackData"],e)};var Ge=e=>{let t=`${e}=`,o=decodeURIComponent(document.cookie).split(";");for(let i=0;i<o.length;i++){let a=o[i].trim();if(a.indexOf(t)===0)return a.substring(t.length,a.length)}return""};var We=({cookieKey:e}={})=>{if(e)return Ge(e)};var je=async e=>{n.merge("followView",{hiddenFromWebApp:!0})};var Ye=e=>{v("modalDetailsReceived",e)};kt();var Qe=f(h());function F(e){return Ze().indexOf(e)>-1}function Ze(){return n.get(["session","features"])||[]}function Ke(e,t){return!!Ze().find(o=>o.startsWith(e)&&o.endsWith("_"+Qe.default.snakeCase(t)))}var Vo=()=>F("is_pc_notif_off");var Xe=new ae,Ho=Xe.asObservable(),Je=()=>{F("ext_fast_roo_totals")&&Xe.next()};var et=f(h()),tt=e=>et.default.map(e,t=>({selector:t,present:!!document.querySelector(t)}));var rt=e=>c("initNotificationApp",e);var ot=async e=>{n.set("followView",{resultData:e}),rt({name:"follow"})};var it=f(U()),at=f(h());function nt(e){let t=n.get(["siteHubView","deals"]),r=n.get(["siteHubView","primaryDeal"]);return at.default.get(e,"site.siteData.flags.siteHubStandDown")||n.set(["couponsDisabledSites",`${w()}_${n.get("tabId")}`],0),n.get(["siteHubView","shown"])?(n.set(["siteHubView","visible"],!0),n.set(["siteHubView","site"],e.site)):n.set("siteHubView",{shown:!0,visible:!0,site:e.site,deals:t,primaryDeal:r}),Ke("mit_isqualified",w())?!1:!n.get(["siteHubScriptLoaded"])}var st=async e=>document.readyState==="interactive"||document.readyState==="complete"||document.readyState==="loaded"?nt(e):new it.default(t=>{document.addEventListener("DOMContentLoaded",()=>{t(nt(e))})});var ct=(e,t)=>T(e,t);var ut=(e,t)=>ke(e,t);var dt=async()=>n.set(["warnAboutStandDown"],!0);var Ht="__wikibuy_instant_content",Et="__wikibuy_instant_bg",Bt="__wikibuy_instant_external_messages";function $t(e){return X[e]}var O=window.wb_messenger;if(!O){let e=chrome.runtime.connect(chrome.runtime.id,{name:Bt});O=window.wb_messenger=(0,lt.default)($t,t=>{chrome.runtime.sendMessage({src:Ht,data:t})},{getId:()=>(0,ft.v4)({rng:()=>{for(var t=new Array(16),r=0,o;r<16;r++)r&3||(o=Math.random()*4294967296),t[r]=o>>>((r&3)<<3)&255;return t}})}),chrome.runtime.onMessage.addListener(t=>{t.src===Et&&O.handleMessage(t.data)})}function c(e,t={}){return O.invoke(e,[t])}function v(e,t={}){window.handleMessage&&window.handleMessage({type:e,...t})}var P=e=>c("setBrowserAction",e);export{xe as a,jt as b,n as c,P as d,ye as e,Ut as f,Ar as g,Ae as h,Cr as i,Tr as j,Nr as k,Fr as l,Te as m,Lt as n,mo as o,po as p,go as q,F as r,Ze as s,Vo as t,Ho as u,w as v,$r as w,c as x,v as y,Zr as z,Kr as A,I as B};
