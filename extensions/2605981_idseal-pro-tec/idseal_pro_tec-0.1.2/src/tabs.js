function getTimestamp(){return Math.floor(Date.now()/1e3)}function onMessage(e){if(e.method)return;var data=JSON.parse(e);if(void 0===data.message)return;let t=Preventer[data.WindowId].CurrentDomain;switch(data.message){case"GetData":UpdatePopupData();break;case"SCRAMBLE":GenerateFingerprint();break;case"TrackingON":TrackingBlocker=!0,GenerateFingerprint(),browser.storage.sync.set({TrackingEnabled:TrackingBlocker},function(){}),UpdatePopupData(),SendToDesktop("TRACKINGONOFF","ON");break;case"TrackingOFF":TrackingBlocker=!1,GenerateFingerprint(),browser.storage.sync.set({TrackingEnabled:TrackingBlocker},function(){}),UpdatePopupData(),SendToDesktop("TRACKINGONOFF","OFF");break;case"AdBlockON":EnableAdBlocker(),AdBlock=!0,UpdatePopupData(),SendToDesktop("ADBLOCKONOFF","ON");break;case"AdBlockOFF":DisableAdBlocker(),AdBlock=!0,UpdatePopupData(),SendToDesktop("ADBLOCKONOFF","OFF");break;case"WLREMOVE":if(void 0==t||""==t)return;RemoveDomainFromWhitelist(t,2),UpdatePopupData(),SendToDesktop("WHITELIST",Whitelist);break;case"WLADD":if(void 0==t||""==t)return;AddNewDomain(t,2),UpdatePopupData(),SendToDesktop("WHITELIST",Whitelist);break;case"ADWLREMOVE":if(void 0==t||""==t)return;RemoveDomainFromWhitelist(t,3),UpdatePopupData(),SendToDesktop("WHITELIST",Whitelist);break;case"ADWLADD":if(void 0==t||""==t)return;AddNewDomain(t,3),UpdatePopupData(),SendToDesktop("WHITELIST",Whitelist)}}function UpdatePopupData(){var data={};data.this_day=this_day,data.all_time=all_time,data.this_year=this_year,data.this_month=this_month,data.this_week=this_week,data.Preventer=Preventer,data.TrackingBlocker=TrackingBlocker,data.AdBlocker=AdBlocker,data.AdBlockToday=AdBlockToday,data.AdsCounters=AdsCounters,data.domain1=domain1,data.domain2=domain2,data.domain3=domain3,data.domain4=domain4,data.counter1=counter1,data.counter2=counter2,data.counter3=counter3,data.counter4=counter4,data.progress1=progress1,data.progress2=progress2,data.progress3=progress3,data.progress4=progress4;var e=JSON.stringify(data);SendToDesktop("DATA",e),data.Whitelist=Whitelist;let t={Browser:"FIREFOX",Command:"DATA"};e=JSON.stringify(data);t.Value=e,browser.runtime.sendMessage(t)}function InjectScript(e,t){-1!==e&&(t.includes("moz")||(browser.tabs.executeScript(e,{file:"src/fingerprint.js",runAt:"document_start",allFrames:!0},function(e){browser.runtime.lastError}),browser.tabs.executeScript(e,{allFrames:!0,file:"src/navigator.js",runAt:"document_start"},function(e){browser.runtime.lastError}),browser.tabs.executeScript(e,{allFrames:!0,file:"src/document.js",runAt:"document_start"},function(e){browser.runtime.lastError})))}function onWindowCreated(e){if(void 0!==e.tabs){var t=e.tabs[0];ActiveTab[e.id]=t.id;var n=new URL("https://"+eRoot(t.url));(o=new windowItem(n.hostname,0)).CurrentDomain=n.hostname,Preventer[e.id]=o}else{var o=new windowItem("",0);Preventer[e.id]=o}}function onWindowRemoved(e){delete Preventer[e]}function onTabsCreated(e){if(void 0!==e.url&&""!=e.url){var t=new URL("https://"+eRoot(e.url));urlOpened.includes(t.hostname)||urlOpened.push(t.hostname)}}function onTabsActivated(e){ActiveTab[e.windowId]=e.tabId,Preventer[e.windowId].CurrentSession=tabSessions[ActiveTab[e.windowId]],void 0===Preventer[e.windowId].CurrentSession&&(Preventer[e.windowId].CurrentSession=0),browser.tabs.query({active:!0,windowId:e.windowId},function(t){for(var n=0;n<t.length;n++){try{var o=new URL("https://"+eRoot(t[n].url))}catch(e){continue}if(void 0!==t[n]){o=new URL("https://"+eRoot(t[n].url));Preventer[e.windowId].CurrentDomain=o.hostname}urlOpened.includes(o.hostname)||urlOpened.push(o.hostname)}}),-1!==ActiveTab[e.windowId]&&ActiveTab[e.windowId]==e.tabId&&0!==Preventer[e.windowId].CurrentSession&&(browser.browserAction.setBadgeText({tabId:ActiveTab[e.windowId],text:Preventer[e.windowId].CurrentSession.toString()}),UpdatePopupData())}function onTabsUpdated(e,t,n){var o={tabId:e,details:t,tabInfo:n},s=new URL("https://"+eRoot(o.tabInfo.url));urlOpened.includes(s.hostname)||urlOpened.push(s.hostname),o.tabId===ActiveTab[n.windowId]&&(Preventer[n.windowId].CurrentDomain=s.hostname),void 0!==o.details.status&&"loading"===o.details.status&&(Preventer[n.windowId].CurrentSession=tabSessions[ActiveTab[n.windowId]]=0),__PRIMARY_DOMAIN_STORAGE[e]=n.url}function onTabsRemoved(e,t){t.isWindowClosing||browser.tabs.query({},function(e){urlOpened=[];for(var t=0;t<e.length;t++){var n=new URL("https://"+eRoot(e[t].url));urlOpened.push(n.hostname)}}),delete tabSessions[e],delete blockedTabData[e],delete __PRIMARY_DOMAIN_STORAGE[e]}browser.runtime.onMessage.addListener(onMessage);var Installed=!1;browser.runtime.onInstalled.addListener(function(e){"install"==e.reason&&setTimeout(function(){Installed=!0},3e3)});