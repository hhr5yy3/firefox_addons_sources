import{s as r}from"./content-script-D7YBjZpd.js";import{s as A,P as h,c as k,p as g}from"./shared-functions-50IQFOKT.js";import{u as z,r as w,d as q}from"./storeTypes-CGrbvTi_.js";import"./chunk-QIZ4XBKF-C_NfkaUr.js";import"./_commonjsHelpers-CqkleIqs.js";const{data:s,promise:x}=z("settings",q),C=navigator.userAgent,I=/mobile|streamingEnhanced/i.test(C);let d=0;const T=w(1),u=window.location.href,V=window.location.hostname,_=document.title,F=/amazon|primevideo/i.test(V)&&(/video/i.test(_)||/video/i.test(u)),B={attributes:!0,childList:!0,subtree:!0};async function M(){console.log("%cStreaming enhanced","color: #00aeef;font-size: 2em;"),console.log("Settings",s.value)}async function L(t,e,n){typeof t=="number"&&typeof e=="number"&&e>t&&(console.log(n,e-t),s.value.Statistics[n]+=e-t,r("increaseBadge",{},"background"))}F&&(A(h.Amazon),P());async function P(){var t,e,n,o,i,a;await x,M(),y.observe(document,S),(e=(t=s.value)==null?void 0:t.Video)!=null&&e.doubleClick&&te(),O.observe(document,B),(n=s.value.Amazon)!=null&&n.selfAd&&U(),(o=s.value.Amazon)!=null&&o.skipAd&&setTimeout(function(){J()},1e3),(i=s.value.Amazon)!=null&&i.continuePosition&&setTimeout(()=>D(),500),(a=s.value.Video)!=null&&a.userAgent&&I&&$()}const m=".dv-player-fullscreen video",O=new MutationObserver(E);function E(){var e,n,o,i,a,c;(e=s.value.Amazon)!=null&&e.filterPaid&&G();const t=document.querySelector(m);(n=s.value.Amazon)!=null&&n.skipCredits&&X(),(o=s.value.Amazon)!=null&&o.watchCredits&&Z(),(i=s.value.Amazon)!=null&&i.speedSlider&&H(t),(a=s.value.Amazon)!=null&&a.xray&&ee(),(c=s.value.Video)!=null&&c.scrollVolume&&N()}const S={attributes:!0,attributeFilter:[".skipelement"],subtree:!0,childList:!0,attributeOldValue:!1},y=new MutationObserver(W);async function N(){const t=document.querySelector('[aria-label="Volume"]:not(.enhanced)');t&&(t.classList.add("enhanced"),t==null||t.addEventListener("wheel",e=>{const n=document.querySelector(m);if(!n)return;let o=n.volume;e.deltaY<0?o=Math.min(1,o+.1):o=Math.max(0,o-.1),n.volume=o}))}let v=-1;function R(){setTimeout(()=>{v=-1},5e3)}function W(){var t;if((t=s.value.Amazon)!=null&&t.skipIntro){const e=document.querySelector("[class*=skipelement]");if(e!=null&&e.checkVisibility()){const n=document.querySelector(m),o=Math.floor((n==null?void 0:n.currentTime)??0);typeof o=="number"&&v!=o&&(v=o,R(),e.click(),console.log("Intro skipped",e),setTimeout(function(){Q(n,o,n.currentTime),L(o,n.currentTime,"IntroTimeSkipped")},50))}}}let p=!1;async function Q(t,e,n){var o;if(!p){p=!0;const i=document.createElement("button");i.style.cssText="padding: 0px 22px; line-height: normal; min-width: 0px; z-index: 999; pointer-events: all;",i.setAttribute("class","fqye4e3 f1ly7q5u fk9c3ap fz9ydgy f1xrlb00 f1hy0e6n fgbpje3 f1uteees f1h2a8xb  f1cg7427 fiqc9rt fg426ew f1ekwadg"),i.setAttribute("data-uia","reverse-button"),i.textContent="Rewind?",(o=document.querySelector(".atvwebplayersdk-action-buttons"))==null||o.appendChild(i);const a=document.querySelector('[data-uia="reverse-button"]');if(a){let c=function(){t.currentTime=e,a&&a.remove(),console.log("stopped observing| Intro"),y.disconnect();const l=n-e+2;setTimeout(function(){console.log("restarted observing| Intro"),y.observe(document,S)},l*1e3)};a.addEventListener("click",c),setTimeout(()=>{a.remove(),p=!1},5e3)}}}async function X(){const t=document.querySelector("[class*=nextupcard-button]");if(t){const e=document.querySelector("[class*=nextupcard-episode]");e!=null&&e.textContent&&!new RegExp("(?<!\\S)1(?!\\S)").exec(e.textContent)&&d!=e.textContent&&(d=e.textContent??"",b(),t.click(),s.value.Statistics.SegmentsSkipped++,r("increaseBadge",{},"background"),console.log("skipped Credits",t))}}async function Z(){const t=document.querySelector("[class*=nextupcardhide-button]");t&&(t.click(),s.value.Statistics.SegmentsSkipped++,r("increaseBadge",{},"background"),console.log("Watched Credits",t))}const j="height: 1em;background: rgb(221, 221, 221);display: none;width:200px;";async function H(t){var e,n;if(t){const o=document.querySelector(".dv-player-fullscreen #videoSpeedSlider");if(o){const i=document.querySelector(".dv-player-fullscreen #videoSpeed");t.playbackRate!=parseFloat(o.value)/10&&(t.playbackRate=parseFloat(o.value)/10),o.oninput=function(){i&&(i.textContent=(parseFloat(o.value)/10).toFixed(1)+"x"),t.playbackRate=parseFloat(o.value)/10}}else{const i=(n=(e=document.querySelector(".dv-player-fullscreen [class*=infobar-container]"))==null?void 0:e.firstChild)==null?void 0:n.lastChild;i&&k(t,T,i,j,"")}}}async function D(){var n,o,i;const t=(n=document.querySelector('.j5ZgN-._0rmWBt[data-testid="card-overlay"]'))==null?void 0:n.closest('[class="+OSZzQ"]'),e=(i=(o=t==null?void 0:t.parentNode)==null?void 0:o.childNodes)==null?void 0:i[2];t&&e&&e.before(t)}async function G(){(u.includes("storefront")||u.includes("genre")||u.includes("movie"))&&document.querySelectorAll("section[data-testid='standard-carousel'] ul:has(svg.NbhXwl)").forEach(t=>{Y(t)})}async function Y(t){if(t.children.length-t.querySelectorAll('[data-hidden="true"]').length-2<=t.querySelectorAll("[data-testid='card-overlay'] svg.NbhXwl").length){const e=t.closest('[class="+OSZzQ"]');console.log("Filtered paid category",e),e==null||e.remove(),s.value.Statistics.SegmentsSkipped++,r("increaseBadge",{},"background")}else t.querySelectorAll("li:has(svg.NbhXwl)").forEach(e=>{console.log("Filtered paid Element",e),e.remove(),s.value.Statistics.SegmentsSkipped++,r("increaseBadge",{},"background")})}function J(){const t=setInterval(function(){if(!s.value.Amazon.skipAd){console.log("stopped observing| FreeVee Ad"),clearInterval(t);return}const e=document.querySelector(m);e&&!e.paused&&e.currentTime>0&&K(e)},100)}async function K(t){var n,o,i,a;const e=document.querySelector(".dv-player-fullscreen .atvwebplayersdk-ad-timer-text");if(e!=null&&e.checkVisibility()){let c;if(c=g((o=(n=e==null?void 0:e.childNodes)==null?void 0:n[0])==null?void 0:o.textContent),c||(c=g((a=(i=e==null?void 0:e.childNodes)==null?void 0:i[1])==null?void 0:a.textContent)),!document.querySelector(".fu4rd6c.f1cw2swo")&&typeof c=="number"&&c>1&&!d){d=c;const l=90;b(c>l?3e3:1e3);const f=c>l?l:c-1;t.currentTime+=f,console.log("FreeVee Ad skipped, length:",f,"s"),s.value.Statistics.AmazonAdTimeSkipped+=f,s.value.Statistics.SegmentsSkipped++,r("increaseBadge",{},"background")}}}async function b(t=1e3){setTimeout(()=>{d=0},t)}async function U(){const t=setInterval(function(){if(!s.value.Amazon.selfAd){console.log("stopped observing| Self Ad"),clearInterval(t);return}const e=document.querySelector(m);e&&(e.onplay=function(){var o,i,a;const n=document.querySelector("#dv-web-player");if(n&&getComputedStyle(n).display!="none"){const c=document.querySelector(".fu4rd6c.f1cw2swo");if(c){const l=parseInt(((a=(i=/:\d+/.exec(((o=document.querySelector(".atvwebplayersdk-adtimeindicator-text"))==null?void 0:o.innerHTML)??""))==null?void 0:i[0])==null?void 0:a.substring(1))??"");setTimeout(()=>{c.click(),typeof l=="number"&&(s.value.Statistics.AmazonAdTimeSkipped+=l),s.value.Statistics.SegmentsSkipped++,r("increaseBadge",{},"background"),console.log("Self Ad skipped, length:",l,c)},150)}}})},100)}async function $(){if(console.log("customizeMobileView"),!u.includes("/gp/video/detail/")){const t=document.createElement("meta");t.name="viewport",t.content="width=device-width, initial-scale=1",document.head.appendChild(t);const e=document.querySelector("#nav-belt");e&&(e.style.width="100vw",e.style.display="flex",e.style.flexDirection="column",e.style.height="fit-content");const n=document.querySelector("#nav-main");n&&(n.style.display="none")}}async function ee(){var e;(e=document.querySelector(".xrayQuickViewList"))==null||e.remove();const t=document.querySelector(".fkpovp9.f8hspre:not(.enhanced)");t&&(t.classList.add("enhanced"),t.style.backgroundColor="transparent",t.style.background="transparent")}async function te(){var t;(t=s.value.Video)!=null&&t.doubleClick?document.ondblclick=function(){const e=document.querySelector(".dv-player-fullscreen button[class*=fullscreen-button]");e==null||e.click()}:document.ondblclick=null}
