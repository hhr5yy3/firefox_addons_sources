var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw s}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function _objectWithoutProperties(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}class SerpHandler{constructor(e){this.store=e,this.hrefsForRequest=new Set}init(){this.store.getState().settings;if(this.serp=findSerp(this.store.getState()),this.serp){if(document.querySelector("."+POPUP_CONTAINER)||(this.popupContainer=document.createElement("div"),this.popupContainer.className=POPUP_CONTAINER,document.body.insertBefore(this.popupContainer,document.body.firstChild)),document.querySelector("."+POPUP_OVERLAY)||(this.popupOvelay=document.createElement("div"),this.popupOvelay.className=POPUP_OVERLAY,document.body.insertBefore(this.popupOvelay,document.body.firstChild)),this.hostname=getCleanDomain(window.location.href),this.styles=this.serp.styles,this.ignoreUrl=this.serp.ignoreUrl,this.ignoreParent=this.serp.ignoreParent,this.ignoreChild=this.serp.ignoreChild,this.rules=this.serp.rules,this.areasAttributes=this.serp.areasAttributes,this.serpid=this.serp.id,this.showOnBoarding=this.serp.showOnBoarding,this.alreadyRendered=!1,this.rules||this.areasAttributes){window.addEventListener("load",()=>{setTimeout(this.render.bind(this),300)});const e=()=>{this.popupContainer&&(this.popupContainer.innerHTML="")};let t=window.scrollY;window.addEventListener("scroll",r=>{Math.abs(t-window.scrollY)>700&&(t=window.scrollY,e(r),this.render())}),window.addEventListener("popstate",e),window.addEventListener("hashchange",e),window.addEventListener("resize",e),this.render()}window.addEventListener("click",e=>{e.target.classList.contains("wot_shield")&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())},!0),this.popupManager=new SerpPopupManager(this.store,this.getIsOnboarding())}}isMutationRelatedToWOT(e){const t=e.target,r=e.attributeName,n=e.addedNodes,i=(n[0]&&n[0].className||"")+(t?t.className:("",""));return WOTAttributes.includes(r)||WOTClassesRegExp.test(i)}observeElem(e){if(e&&!e.getAttribute(WOT_OBSERVE_DOM_FLAG)){e.setAttribute(WOT_OBSERVE_DOM_FLAG,"true");const t={attributes:!0,childList:!0,subtree:!0};new MutationObserver(t=>{if(!t.some(e=>this.isMutationRelatedToWOT(e)))return Array.from(e.getElementsByTagName("a")).forEach(e=>{e.removeAttribute(TAG_SCANNED_FLAG),e.removeAttribute(SHIELD_ATTRIBUTE)}),setTimeout(this.render.bind(this))}).observe(e,t)}}preventCreatingTwice(e,t){let r;switch(t){case"insertAfter":r=e.nextElementSibling;break;case"appendChild":r=e.lastElementChild;break;default:webextApi.runtime.sendMessage({name:CONSOLE_LOG_MESSAGE,message:"unknown action. check rule configuration: "+t})}return r&&r.className===SHIELD_CONTAINER}async renderMail(){this.addEventOnce=this.addEventOnce||!1,this.addEventOnce||(this.addEventOnce=!0,window.addEventListener("popstate",()=>{setTimeout(this.renderMail.bind(this),500)}));const e=this.serp.areasAttributes.mail_body.selector,t=document.querySelector(e),r=()=>{if(!this.serp.sender)return;var e=this.serp.sender;const r=e.selector,n=e.attribute;if(!r)return;const i=t.querySelector(r);if(!i)return;const s=n?i.getAttribute(n):i.innerText;if(!s)return;const o=s.split("@");if(!o[1])return;const a=o[1];return">"===a[a.length-1]?a.slice(0,-1):a};let n=[this.hostname];if(t){const e=new Set;Array.from(t.getElementsByTagName("a")).forEach(t=>{e.add(getCleanDomain(t.href))});const i=r();i&&e.add(i),e.size&&(n=n.concat(Array.from(e)),this.store.dispatch(getMultipleRatings(n)))}var i=(()=>{var e=this.store.getState();const r=e.user,n=e.settings;let i="";const s=r.isPremiumUser&&n.phishing;if(i=t?s?MAIL_BODY_SERP_CONTAINER:null:r.isPremiumUser?null:MAIL_BODY_SERP_NOT_PROTECTED,!i)return{container:null};let o=document.getElementById(i);if(!o){o=(s?document.querySelector(this.serp.areasAttributes.mail_body.place):document.body)[this.serp.areasAttributes.mail_body.action](document.createElement("div")),o.id=i}return{container:o,protectionEnabled:s}})();const s=i.container,o=i.protectionEnabled;s&&ReactDOM.render(React.createElement(ReactRedux.Provider,{store:this.store},o?React.createElement(SerpWarning,{links:n}):React.createElement(MailOffering,null)),s)}renderSocial(){const e={};Array.from(document.getElementsByTagName("a")).forEach(t=>{if(!t.host||t.host===window.location.host)return;if(t.getAttribute(TAG_SCANNED_FLAG))return;const r=new URL(decodeURIComponent(t.href)),n=!r.host.includes(this.serp.domain),i=!n&&!!r.search;if(!i&&!n)return;const s=this.getSignificantWrapper(t);if(!s)return;const o=s.element.getAttribute(SERP_AREA_FLAG)||makeid();e[o]||(e[o]={parent:s},s.element.setAttribute(SERP_AREA_FLAG,o)),t.setAttribute(TAG_SCANNED_FLAG,"true");const a=new URL(i?new URL(r.search.split("=")[1]).href:r.href);e[o][a.hostname]=e[o][a.hostname]||[],e[o][a.hostname].push({target:a.href,a:t}),this.hrefsForRequest.add(a.href),s.type===SERP_AREA_TYPES.SPONSORED&&this.observeElem(s.element)}),this.hrefsForRequest.add(this.hostname),this.store.dispatch(getMultipleRatings(Array.from(this.hrefsForRequest))),Object.values(e).forEach(e=>{const t=e.parent,r=_objectWithoutProperties(e,["parent"]),n=t.type===SERP_AREA_TYPES.NEWS_FEED,i=Object.values(r);i.forEach(e=>{const r=this.selectBestPosition(e);let s=r.el;var o=this.serp.areasAttributes[t.type];const a=o.place;var l=o.style;const c=void 0===l?{position:"absolute",top:"0",left:"0"}:l;if(n&&1===i.length&&(s=t.element),s=a?s.querySelector(a):s,!s||s.getAttribute(SHIELD_ATTRIBUTE))return;s.setAttribute(SHIELD_ATTRIBUTE,"true"),s.style.position="relative";const u=this.makeContainer();Object.entries(c).forEach(e=>{var t=_slicedToArray(e,2);let r=t[0],n=t[1];u.style[r]=n}),s.appendChild(u),setTimeout(()=>{ReactDOM.render(React.createElement(ReactRedux.Provider,{store:this.store},React.createElement(ShieldComponent,{target:r.target,containerSelector:u.id,style:{},additionalContainerStyle:{},showAdultExtraIcon:!0,inactive:!1,serpid:this.serpid})),u)})})})}render(){if("Facebook"===this.serp.name)return this.renderSocial();if("mail"===this.serp.type)return setTimeout(()=>this.renderMail(),500);for(let e=0,t=this.rules.length;e<t;e++){const t=this.rules[e],r=Array.from(document.querySelectorAll(t.areaSelector)),n=[this.hostname];for(const e of r)if(!e.getAttribute(SHIELD_ATTRIBUTE)){let r=!1;if(this.ignoreParent)for(const t of this.ignoreParent){let n=e.parentNode;const i=document.querySelectorAll(t);for(;n;)-1!==Array.from(i).indexOf(n)&&(r=!0),n=n.parentNode}const i=t.linkSelector?e.querySelector(t.linkSelector):e;if(this.ignoreChild)for(const e of this.ignoreChild)i.querySelectorAll(e).length>0&&(r=!0);if(i&&!r){let r,s=i.href||"";if(r=t.placeSelector?Array.from(e.querySelectorAll(t.placeSelector)):[e],t.getParam){const e=s.match(`[?&]${t.getParam}=([^&]+)`);s=decodeURIComponent(e&&e.length>=2?e[1]:s)}if(t.fromString){const e=new RegExp(t.fromString).exec(i.textContent);s=e?e[0]:s}t.beforeUrl&&(s=t.beforeUrl+s);for(const o of r)if(s&&(SUPPORTED_PROTOCOLS.test(s)||i.textContent&&VALID_URL_WITHOUT_PROTOCOL.test(s)||0===s.indexOf("www."))&&0!==s.indexOf(window.location.href)){if(this.ignoreUrl&&new RegExp(this.ignoreUrl).test(s))continue;if(this.preventCreatingTwice(o,t.action))continue;const r=this.makeContainer(t);if(r.setAttribute("style",t.styles||this.styles),0!==o.textContent.trim().length||t.images)switch(t.action){case"appendChild":o.appendChild(r);break;case"insertAfter":o.parentNode.insertBefore(r,o.nextSibling)}else o.style.position="relative",o.style.display="inline-block",r.style.position="absolute",r.style.top="0",r.style.right="0",r.style.margin="0",o.appendChild(r);n.push(s);const i="false"!==t.adultIcon,a=this.ensureIsObject(t.shieldStyle),l=this.ensureIsObject(t.additionalContainerStyle);setTimeout(()=>{ReactDOM.render(React.createElement(ReactRedux.Provider,{store:this.store},React.createElement(ShieldComponent,{target:s,containerSelector:r.id,style:a,additionalContainerStyle:l,showAdultExtraIcon:i,inactive:this.alreadyRendered,serpid:this.serpid})),document.querySelector("#"+r.id))},1),this.alreadyRendered=!0,t.urlCanChange&&e.setAttribute(SHIELD_ATTRIBUTE,"true")}!t.urlCanChange&&e.setAttribute(SHIELD_ATTRIBUTE,"true")}}this.store.dispatch(getMultipleRatings(n))}}makeContainer(e){const t=document.createElement("div");return t.id=makeid(),t.className=SHIELD_CONTAINER,t.setAttribute("style",e&&e.styles||this.styles),t}getIsOnboarding(){return this.showOnBoarding&&this.store.getState().onboarding.step<5&&"rtl"!==document.dir}ensureIsObject(e){return"object"==typeof e?e:{}}selectBestPosition(e){e.sort((e,t)=>t.a.innerHTML.length-e.a.innerHTML.length);const t=e[0];return{el:t.a,target:t.target}}getSignificantWrapper(e){let t=e.parentElement,r=this.areasAttributes[SERP_AREA_TYPES.NEWS_FEED];do{if(t.getAttribute(r.key)===r.value)break}while(t=t.parentElement);if(t)return{element:t,type:SERP_AREA_TYPES.NEWS_FEED};t=e.parentElement,r=this.areasAttributes[SERP_AREA_TYPES.SPONSORED];do{if(t.getAttribute(r.key)===r.value)break}while(t=t.parentElement);return t?{element:t,type:SERP_AREA_TYPES.SPONSORED}:null}}self.yodules=self.yodules||{},void(yodules.ScrappingAdHTML5={init:function(e,t,r,n){const i=yodules.ScrappingAdHTML5,s=e.instance,o=t.instance,a=r.class,l=n.class;i.class=class{initHTML5Scrapping(){self!==top?this._checkFrame(document):s.helperDomReady().then(()=>{document.querySelectorAll('iframe[id*="google_ads_iframe"]').forEach((e,t)=>{let r;try{r=e.contentDocument}catch(e){r=null}r&&setTimeout(()=>{this._checkFrame(r)},1e3,this)})})}_checkFrame(e){const t=this._collectAdData(e);return t||s.helperDomReady().then(()=>this._collectAdData(e))}_collectAdData(e){let t=this._getData(e);if(t&&t.data){const e=this._addServiceInfo(t);s.chromeSendMessage(e)}return t}_getData(e){let t=new a(e).collectGoogleData();if(null===t&&(t=new l(e).collectCriteoData()),null===t,t){const e=o.getBlockSize(document);t.data.fs=[e.w,e.h]}return t}_addServiceInfo(e){return e&&e.data?window._rhash?void 0:(window._rhash=e.hash,{type:"sha",subtype:e.subtype,v:e.v,data:e.data,hash:e.hash}):null}},i.instance=new i.class,i.instance.initHTML5Scrapping()},deps:["CntHelpers","ScrappingAdHTML5Helper","ScrappingAdHTML5Google","ScrappingAdHTML5Criteo"]}),self.yodules=self.yodules||{},yodules.ScrappingAdHTML5Helper={init:function(e){const t=yodules.ScrappingAdHTML5Helper;e.instance,t.class=class{getBlockSize(e){if(!e)return{};const t=(e=e.querySelector("html")||e).querySelector("body");return{w:e.offsetWidth||t&&t.clientWidth||0,h:e.offsetHeight||t&&t.clientHeight||0}}getFrameHash(e){return Math.random().toString(36).substring(3,9)}},t.instance=new t.class},deps:["CntHelpers"]},self.yodules=self.yodules||{},yodules.ScrappingAdHTML5Google={init:function(e,t,r){const n=yodules.ScrappingAdHTML5Google,i=e.instance,s=t.class,o=r.instance;n.class=class{constructor(e){this._setDefaults(),this._setBase(e)}collectGoogleData(){if(!this._detectWhyLink())return null;const e=this._collectBaseParams();if(!e||e.wlv.length>15e3)return!1;const t=new s(this._container),r=t.collectPublisherLinks(),n=r&&r.pl?decodeURIComponent(r.pl[0]):null,i=n?t.collectBannerImage(n):{},o=Object.assign({hash:this._rhash},e,r,i);return{subtype:this._rsubtype,v:this._rv,data:o}}_getEncodedValue(e){return e.includes(this._splitter)?this._getEncodedValue(e.replace(this._splitter,"")):atob(e)}_detectWhyLink(){if(!this._container)return!1;let e='ef*="/'+this._getEncodedValue(this._filterWhy),t=`ef*="${this._getEncodedValue(this._googleDomain)}"][`;if(this._whyLink=this._container.querySelector(`a[hr${t}hr${e}"]`),this._whyLinkRef=this._whyLink&&this._whyLink.getAttribute("href"),!this._whyLinkRef){const e=i.getChildIframe(this._container);e&&e.body&&(this._setBase(e),this._detectWhyLink())}return!!this._whyLinkRef}_setDefaults(){this._rsubtype="shag",this._rv="0.8.0",this._filterWhy="d2h5dGioihpc2Fk",this._googleDomain="Lmioidvb2dsZS4",this._googleId="cm9vdF90ZWioi1wbGF0ZV9kaXY",this._googleContainerId="Z29vZ2xioilXw"}_setBase(e){this._splitter="ioi",this._container=e,this._rhash=o.getFrameHash(this._container)}_collectBaseParams(){let e=this._container.querySelector(`[id=${this._getEncodedValue(this._googleId)}]`)||this._container.querySelector(`[id=${this._getEncodedValue(this._googleContainerId)}]`)||this._container,t={wlv:this._whyLinkRef};return Object.assign(t,o.getBlockSize(e)),t}},n.instance=new n.class},deps:["CntHelpers","ScrappingAdHTML5Publisher","ScrappingAdHTML5Helper"]},self.yodules=self.yodules||{},yodules.ScrappingAdHTML5Publisher={init:function(e,t){const r=yodules.ScrappingAdHTML5Publisher,n=e.instance,i=t.instance;r.class=class{constructor(e){this._container=e,this._hash=i.getFrameHash(e,!1)}_filterPublisherLinks(e){const t=this.negativeFilters,r=this._getStringValues(t),i=this._getValue(this.enHttp);return e.filter(e=>{if(!e||!e.length)return!1;const t=n.convertToLink(e).origin;return t.startsWith(i)&&!r.find(e=>t.includes(`.${e}.`))}).sort((e,t)=>t-e).filter((e,t,r)=>!t||!r[t-1].includes(e))}get enScript(){return[3428984578,.5]}get enDestination(){return[[1407846.375,16],[176111930.875,8]]}get enHttp(){return[33272.2,25]}get enUrl(){return[3322.75,12]}get enAd_ata(){return[[9.325,40],[350.35,40]]}get filterParse(){return"JSON.parse"}get negativeFilters(){return[[[4,4],[2590752.125,16],[168909.125,8],[99814623.8975,400]],[[4,4],[2590752.125,16],[841,16]],[[4,4],[2590752.125,16],[13456,16],[5565892645.33,400]]]}_getStringValues(e){return e.map(e=>e.reduce((e,t)=>e+this._getValue(t),""))}_getValue(e){return Array.isArray(e)?this._getValue(e.reduce((e,t)=>e*t,1)):e.toString(36)}_parseScriptText(){const e=[this._getStringValues(this.enAd_ata)].join("D"),t=[this._getStringValues([[497488.825,40],[702.725,40]])].join("A_S"),r=this._getValue(this.enScript),n=[this._getStringValues(this.enDestination),this._getValue(this.enUrl)].join("_");let i=t.replace("_","d"),s=this._container.querySelectorAll(r),o=s.length,a=0,l=[];for(;!l.length&&a<o;){let t=s[a++].innerText,r=t.includes(i),o=!r&&t.includes(e)&&t.includes(n)&&t.includes(this.filterParse);if(!r&&!o)continue;let c=o?'"':/['"]+/;l=t.split(c),l=this._filterPublisherLinks(l)}return l.length?l:null}_parseMetaAndLink(){const e=this._container.querySelector("meta[name=exit]"),t=this._getValue([436064.025,40]);let r,n=e&&e.content;if(n||(r=this._container.querySelector(`a[href*="${t}"]`),n=r&&r.href),n&&n.includes(t)){let e=n.split(/['"&]+/).find(e=>e.startsWith(t)),r=e&&e.slice(e.indexOf("http"));if(r)return[r]}return null}_parseWindowData(){const e=window&&window.clickTag;return e&&e.startsWith(this._getValue(this.enHttp))?[e]:null}collectPublisherLinks(){let e=this._parseScriptText()||this._parseMetaAndLink()||this._parseWindowData();return e&&Array.isArray(e)?(e=e.filter(e=>e.length<15e3),e.length?{pl:e}:{}):{}}collectBannerImage(e){const t=e&&n.convertToLink(e).hostname;let r=t&&(this._container.querySelector(`a[href*="${t}"] img`)||{}).src;return r?(r=r.split("?")[0],{s:r}):{}}},r.instance=new r.class},deps:["CntHelpers","ScrappingAdHTML5Helper"]},self.yodules=self.yodules||{},yodules.ScrappingAdHTML5Criteo={init:function(e,t){const r=yodules.ScrappingAdHTML5Criteo,n=e.instance,i=t.instance;r.class=class{constructor(e){this._container=e}collectCriteoData(){if(!this._validateFrame())return null;let e={fbu:this._baseURI,hash:i.getFrameHash(this._container)};return Object.assign(e,i.getBlockSize(this._container)),{data:e,subtype:"shac",v:"0.8.0"}}_validateFrame(){return this._baseURI=this._container.baseURI,n.convertToLink(this._baseURI).origin.includes(".criteo.com")}},r.instance=new r.class},deps:["CntHelpers","ScrappingAdHTML5Helper"]},self.yodules=self.yodules||{},yodules.ScrapByRemoteConfigCt={init:function(e,t){const r=yodules.ScrapByRemoteConfigCt,n=e.class,i=t.instance;r.class=class{main(){this.searchCache={},"complete"===document.readyState?this.onDocReady():setTimeout(()=>{this.onDocReady()},200),chrome.runtime.onMessage.addListener((e,t,r)=>{"pageUrlChanged"===e.message&&this.onDocReady()})}async onDocReady(){try{const e=(await Promise.all([this.getConfigs(),this.waitForDomChanges()]))[0];e&&e.length&&this.execConfigs(e)}catch(e){}}execConfigs(e){const t=new n,r=t.vmajor,i=t.vminor,s=location.href,o=e.filter(e=>e.vmajor===r&&(!(e.vminor>i)&&!!new RegExp(e.matcher).exec(s))).map(e=>this.execOneTriggeredConfig(e)).filter(e=>!!e);this.notifyBackground(o)}notifyBackground(e){e&&e.length&&JSON.stringify(e).length>8&&chrome.runtime.sendMessage({message:"m('scrap_collected')",scraps:e})}_onTrigger(e,t){if(!e||!e.name)return t();switch(e.name){case"domTrigger":this._onDomTrigger(e,t);break;case"domManyTrigger":this._onDomManyTrigger(e,t);break;case"mutationTrigger":this._onMutationObserver(e,t);break;case"timeTrigger":this._onTimeTrigger(e,t);break;default:t()}}_waitForElementAndAct(e,t){const r=document.body||document;let n,i;function s(){r.querySelector(e)&&(n&&n.disconnect(),t())}n=new MutationObserver((function(){clearTimeout(i),i=setTimeout(s,50)})),n.observe(r,{attributes:!0,childList:!0})}_onDomTrigger(e,t){let r=document.body;if(e.element&&(r=document.querySelector(e.element),!r))return e.waitForElement&&this._waitForElementAndAct(e.element,()=>{this._onDomTrigger(e,t)}),void 0;const n=i=>{e.delayDefault&&(i.preventDefault(),i.stopImmediatePropagation()),t(),e.delayDefault&&(r.removeEventListener(e.eventName,n),setTimeout(()=>{r.dispatchEvent(i)},e.delayDefaultForMs||100))};r.addEventListener(e.eventName,n)}_onDomManyTrigger(e,t){let r=[document];if(e.elements&&(r=Array.from(document.querySelectorAll(e.elements)),!r||!r.length))return e.waitForElement&&this._waitForElementAndAct(e.elements,()=>{this._onDomManyTrigger(e,t)}),void 0;r.forEach(r=>{const n=i=>{e.delayDefault&&(i.preventDefault(),i.stopImmediatePropagation()),t(),e.delayDefault&&(r.removeEventListener(e.eventName,n),setTimeout(()=>{r.dispatchEvent(i)},e.delayDefaultForMs||100))};r.addEventListener(e.eventName,n)})}_onMutationObserver(e,t){let r=document.body;if(e.element&&(r=document.querySelector(e.element),!r))return;const n=e.cooldown||1e3;let i;new MutationObserver((function(){clearTimeout(i),i=setTimeout(t,n)})).observe(r,{attributes:!0,childList:!0,characterData:!0})}_onTimeTrigger(e,t){const r=e.timeout||5e3;e.times?async function(){for(let n=0;n<e.times;n++)await new Promise(e=>{setTimeout(e,r)}),t()}():setTimeout(t,r)}execOneTriggeredConfig(e){return e.triggers instanceof Array?(e.triggers.forEach(t=>{this._onTrigger(t,()=>{const t=this.execOneConfig(e);if(t){if(t.data instanceof Array&&!t.data.length)return;this.notifyBackground([t])}})}),null):this.execOneConfig(e)}execCompoundConfig(e){const t={};return e.clauses.forEach(e=>{t[e.name]=this.execSimpleConfig(e)}),e.hasOwnProperty("type")?{type:e.type,data:t}:t}execSimpleConfig(e){const t=new n;t.setConfig(e.find);let r=t.execute();if(void 0===r)return[];if(!(r instanceof Array)){if(!(r instanceof Node))return[];r=[r]}if(e.uniqueCheck){const t=e.uniqueCacheKey||e.find.type+JSON.stringify(e.find).length,n=this.searchCache[t];if(n instanceof Set){const e=r.filter(e=>!n.has(e));e.forEach(e=>n.add(e)),r=e}else this.searchCache[t]=new Set(r)}const i=r.map(t=>{const r=new n;return r.setConfig(e.analyse),r.execute(t)}).filter(e=>!!e);return e.hasOwnProperty("type")?{type:e.type,data:i}:i}execOneConfig(e){try{switch(e.configType){case"compound":return this.execCompoundConfig(e);case"simple":default:return this.execSimpleConfig(e)}}catch(e){return null}}waitForDomChanges(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200;const t={},r="timeoutId";return t[r]=null,new Promise(n=>{function i(){clearTimeout(t[r]),t[r]=setTimeout(()=>{n()},e)}const s=new MutationObserver((function(){i()}));s.observe(document.body,{attributes:!0,childList:!0,characterData:!0}),setTimeout(()=>{s.disconnect(),n()},3e3),i()})}async getConfigs(){return await i.getDeobfuscatedConfigs()}},r.instance=new r.class,r.instance.main()},deps:["RemoteScrapConfigInterpreter","SRConfigWrapper"]},self.yodules=self.yodules||{},yodules.RemoteScrapConfigInterpreter={init:function(){yodules.RemoteScrapConfigInterpreter.class=class{get vmajor(){return 1}get vminor(){return 8}get config(){return this._config}setConfig(e){return this._config=e,this}execute(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement;return this._executeConfig(e)}_executeConfig(e){return this._ruleToValue(this.config,e)}_ruleToValue(e,t){switch(e.type){case"filter":return this._toValueFilter(e,t);case"map":return this._toValueMap(e,t);case"selector":return this._toValueSelector(e,t);case"xpath":return this._toValueXpath(e,t);case"statement":return this._toValueStatement(e,t);case"check":return this._toValueCheck(e,t);case"action":return this._toValueAction(e,t);case"aggregate":return this._toValueAggregate(e,t);case"condition":return this._toValueCondition(e,t);case"constant":return e.value;case"try":return this._toValueTry(e,t)}}_toValueFilter(e,t){return this._ruleToValue(e.items,t).filter(t=>this._ruleToValue(e.condition,t))}_toValueMap(e,t){let r=this._ruleToValue(e.items,t).map(t=>this._ruleToValue(e.action,t));return e.no_empty&&(r=r.filter(e=>!!e)),r}_toValueSelector(e,t){if(e.target&&(t=this._ruleToValue(e.target,t)),"first"===e.qualifier)return t.querySelector(e.selector);{const r=t.querySelectorAll(e.selector);return r?Array.prototype.slice.call(r):[]}}_toValueXpath(e,t){return document.evaluate(e.selector,t,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}_toValueStatement(e,t){e.conjuction&&(e.conjunction=e.conjuction);const r="or"===e.conjunction,n=!r;for(let i,s,o=0;o<e.subStatements.length;o++){if(i=e.subStatements[o],s=this._ruleToValue(i,t),s&&r)return!0;if(!s&&n)return!1}return n}_toValueCondition(e,t){const r=e.condition,n=e.caseTrue,i=e.caseFalse;return this._ruleToValue(r,t)?this._ruleToValue(n,t):this._ruleToValue(i,t)}_toValueCheck(e,t){const r="not"===e.modifier;let n;switch(e.if){case"exists":n=e=>!(!e||e instanceof Array&&!e.length);break;case"regexp":n=t=>!!new RegExp(e.regexp).exec(t)}let i=n;return r&&(i=e=>!n(e)),i(this._ruleToValue(e.object,t))}_toValueAction(e,t){let r;switch(e.action){case"take-text":r=e=>e.innerText;break;case"take-html":r=e=>e.innerHTML;break;case"take-attr":r=t=>t.getAttribute(e.attrName);break;case"take-prop":r=t=>t[e.propName];break;case"take-parent":r=e=>e.parentNode;break;case"take-ancestor":r=t=>t.closest(e.selector);break;case"take-previousElementSibling":r=e=>e.previousElementSibling;break;case"take-nextElementSibling":r=e=>e.nextElementSibling;break;case"exec-regexp":r=t=>new RegExp(e.regexp,e.flags).exec(t);break;case"string-split":r=t=>(""+t).split(e.splitter);break;case"take-from-array":r=t=>{if(t instanceof Array&&t.length){let r=e.index;return r<0&&(r=t.length+r,r<0&&(r=0)),t[r]}return null};break;case"take-html":r=e=>e.innerHTML;break;case"take-image":r=e=>{const t=e.getAttribute("src"),r=e.clientWidth,n=e.clientHeight,i={src:t};return r===n?i.wh=r:(i.w=r,i.h=n),i.wh<40||i.w<40?null:i};break;case"get-offset":r=e=>{const t=e.getBoundingClientRect();return{x:t.left+window.scrollX,y:t.top+window.scrollY}}}let n=t;e.object&&(n=this._ruleToValue(e.object,t));let i=null;return n&&(i=r(n)),i}_toValueAggregate(e,t){const r={};return e.parts.forEach(e=>{const n=this._ruleToValue(e.value,t);e.drop_empty?n&&(r[e.key]=n):r[e.key]=n}),r}_toValueTry(e,t){try{return this._ruleToValue(e.what,t)}catch(t){if(e.caseError)return this._ruleToValue(e.caseError)}return null}}}},self.yodules=self.yodules||{},yodules.SRConfigWrapper={init:function(){const e=yodules.SRConfigWrapper;e.class=class{getConfigFromChromeStorage(){return new Promise(e=>{chrome.storage.local.get("m('remote_config_storage_key')",t=>{if(!t)return e(null);const r=t["m('remote_config_storage_key')"];if(r)try{e(r)}catch(t){return e(null)}e(null)})})}deobfuscateConfig(e){if(e.hasOwnProperty("type"))return e;const t=e.e.split("\n"),r=t[0].length;let n="";for(let e=0;e<r;e++)for(let r=0;r<t.length;r++){const i=t[r].charAt(e);if(!i)break;n+=i}const i=atob(n);return JSON.parse(i)}async getDeobfuscatedConfigs(){const e=await this.getConfigFromChromeStorage();return e instanceof Array?e.map(this.deobfuscateConfig):[]}setConfigInChromeStorage(e){return new Promise(t=>{const r={};r["m('remote_config_storage_key')"]=e,r["m('fetch_time_storage_key')"]=Date.now(),chrome.storage.local.set(r,()=>{t()})})}getFetchTimeFromChromeStorage(){return new Promise(e=>{chrome.storage.local.get("m('fetch_time_storage_key')",t=>{if(!t)return e(0);const r=t["m('fetch_time_storage_key')"];r&&e(parseInt(r)),e(0)})})}firstCheckWasAgoEnough(){return new Promise(e=>{chrome.storage.local.get("m('remote_config_first_check_storage_key')",t=>{if(!t||!t["m('remote_config_first_check_storage_key')"]){const t={};return t["m('remote_config_first_check_storage_key')"]=Date.now(),chrome.storage.local.set(t),e(!1)}const r=parseInt(t["m('remote_config_first_check_storage_key')"]);if(r)try{const t=Date.now()-r,n=parseInt("3600000");return e(t>n)}catch(t){return e(null)}e(!1)})})}},e.instance=new e.class}};