(()=>{function e(e,t,o,n){chrome.notifications.create({type:"basic",iconUrl:n??"./assets/icons/logo-new.png",title:e,message:t},(function(e){o&&chrome.notifications.onClicked.addListener((function t(n){n===e&&(chrome.tabs.create({url:o,active:!0}),chrome.notifications.onClicked.removeListener(t))}))}))}chrome.runtime.onMessage.addListener((function(c,r,s){if("selecton-open-new-tab"==c.type)return chrome.tabs.create({url:c.url,active:c.focused,index:r.tab.index+1}),!0;if("selecton-no-clipboard-permission-message"==c.type)return e("Clipboard access was not granted","Could not paste to this field without clipboard access"),!0;if("check_currencies"==c.type)!async function(e,c){if(!c)return;if(n)return;e&&console.log("Selecton needs to update currency rates...");e&&console.log(c);n=!0;let r=t,s=new Date;const i=s.getTimezoneOffset();s=new Date(s.getTime()-60*i*1e3),s=s.toISOString().split("T")[0];const a={};try{const t=await fetch(r,{method:"GET"});if(!t.ok)throw new Error(`An error has occured: ${t.status}`);const n=await t.json(),i=n.date;if(!i)return void(e&&console.log("Error while fetching currency rates from network"));const l=n.usd,u=[];let f=Object.keys(c);for(let t=0,o=f.length;t<o;t++){let o=f[t],n=f[t].toLowerCase();1==c[o].crypto&&u.push(o);try{if(null==l[n]||null==l[n])continue;c[o].rate=l[n],a[o]=l[n]}catch(t){e&&console.log(t)}}e&&console.log("Fetched regular currencies successfully"),r=o;const d=u.join(",");if(r+="&tsyms="+d,d.length>0)try{const t=await fetch(r);if(!t.ok)throw new Error(`An error has occured: ${t.status}`);const o=await t.json();for(let e=0,t=u.length;e<t;e++)try{let t=u[e];if(null==o[t]||null==o[t])continue;c[t].rate=o[t],a[t]=o[t]}catch(e){console.log(e)}e&&console.log("Fetched crypto currencies successfully")}catch(t){e&&console.log("Failed to fetch crypto currencies: "+t.toString())}Object.keys(a).length>0&&chrome.storage.local.set({ratesLastFetchedDate:s,rates:a}),e&&(console.log("Updated currency rates from network:"),console.log(a),console.log("Saved date of last rates fetch:"),console.log(i))}catch(t){e&&(console.log("Error while loading currencies from network:"),console.log(t))}n=!1}(c.debugMode,c.currenciesList);else if("background_fetch"==c.type)return async function(e,t){try{const o=await fetch(e);if(!o.ok)throw new Error(`HTTP error! Status: ${o.status}`);t(await o.json())}catch(e){console.error("Fetch error:",e)}}(c.url,(function(e){s(e)})),!0})),chrome.runtime.onInstalled.addListener((function(t){if("update"==t.reason&&!t.temporary){let t=!0;const o="showUpdateNotification";chrome.storage.local.get([o],(function(n){if(null!==n[o]&&void 0!==n[o]&&(t=n[o]),t){const t=chrome.runtime.getManifest();e(chrome.i18n.getMessage("updateNotificationTitle",t.version),chrome.i18n.getMessage("updateNotificationMessage"),"https://github.com/emvaized/selecton-extension/blob/master/CHANGELOG.md")}}))}}));const t="https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/usd.json",o="https://min-api.cryptocompare.com/data/price?fsym=USD";let n=!1})();