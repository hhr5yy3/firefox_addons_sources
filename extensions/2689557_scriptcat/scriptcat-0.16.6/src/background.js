(()=>{var e,t={18578:(e,t,r)=>{"use strict";var s=r(64572);class n{constructor(){(0,s.Z)(this,"hookMap",{})}trigger(e){if(!this.hookMap[e])return;const t=[];for(var r=arguments.length,s=new Array(r>1?r-1:0),n=1;n<r;n++)s[n-1]=arguments[n];s.forEach((e=>{"object"==typeof e?t.push({...e}):t.push(e)})),this.hookMap[e].forEach((e=>{e(...t)}))}addListener(e,t){this.hookMap[e]||(this.hookMap[e]=[]),this.hookMap[e].push(t)}removeListener(e,t){if(!this.hookMap[e])return;const r=this.hookMap[e].indexOf(t);r>-1&&this.hookMap[e].splice(r,1)}}var i=r(27484),a=r.n(i);const o={debug:10,info:100,warn:1e3,error:1e4};function c(){const e={};for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return r.forEach((t=>{t.forEach((t=>{Object.keys(t).forEach((r=>{e[r]=t[r]}))}))})),e}class l{constructor(e){this.core=e;for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];this.label=r}log(e,t){for(var r=arguments.length,s=new Array(r>2?r-2:0),n=2;n<r;n++)s[n-2]=arguments[n];if(o[e]>=o[this.core.level]&&this.core.writer.write(e,t,c(this.label,s)),this.core.debug){"object"==typeof t&&(t=JSON.stringify(t));const r="".concat(a()(new Date).format("YYYY-MM-DD HH:mm:ss")," [").concat(e,"] msg=").concat(t," label=").concat(JSON.stringify(c(this.label,s)));switch(e){case"error":console.error(r);break;case"warn":console.warn(r);break;default:console.info(r)}}d.hook.trigger("log",{level:e,message:t,label:s})}with(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new l(this.core,...this.label,...t)}debug(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];this.log("debug",e,...r)}info(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];this.log("info",e,...r)}warn(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];this.log("warn",e,...r)}error(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];this.log("error",e,...r)}static E(e){return"string"==typeof e?{error:e}:e instanceof Error?{error:e.message}:"object"==typeof e?e:{}}}class d{static getInstance(){return d.instance}static getLogger(){return d.getInstance().logger(...arguments)}constructor(e){(0,s.Z)(this,"level","info"),(0,s.Z)(this,"debug",!1),this.writer=e.writer,this.level=e.level||this.level,this.debug=e.debug||this.debug,this.labels=e.labels||{},d.instance||(d.instance=this)}logger(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new l(this,this.labels,...t)}}(0,s.Z)(d,"hook",new n);var p=r(43528);class u{constructor(e,t){(0,s.Z)(this,"disChannelHandlerArray",[]),"function"==typeof e?(this.setHandler(e),this.setCatch(t)):(this.manager=e,this.flag=t,this.setCatch((e=>{d.getInstance().logger(l.E(e)).error("channel error",{flag:this.flag})})),this.setHandler((()=>{d.getInstance().logger().warn("channel handler is null")})))}channel(e,t){this.manager.nativeSend({action:e,data:t,stream:this.flag,channel:!0})}send(e){this.manager.nativeSend({data:e,stream:this.flag,channel:!0})}throw(e){this.manager.nativeSend({stream:this.flag,error:e,channel:!0}),this.manager.disChannel(this)}syncSend(e,t){return this.manager.nativeSend({action:e,data:t,stream:this.flag,channel:!1}),new Promise(((e,t)=>{this.handler=t=>{e(t)},this.catch=e=>{t(e)}}))}setHandler(e){this.handler=function(t){if("dischannel"===t)return this.manager.disChannel(this),void this.disChannelHandlerArray.forEach((e=>{e("dischannel")}));e(t)}}setCatch(e){this.catch=function(t){e(t),this.manager.disChannel(this),this.disChannelHandlerArray.forEach((e=>{e("dischannel")}))}}setDisChannelHandler(e){this.disChannelHandlerArray.push(e)}disChannel(){this.send("dischannel"),this.manager.disChannel(this)}}const h=Symbol("MessageBroadcast");class _{constructor(e){(0,s.Z)(this,"channelMap",new Map),this.nativeSend=e}channel(e){e||(e=(0,p.Z)());const t=new u(this,e);return this.channelMap.set(e,t),t}getChannel(e){return this.channelMap.get(e)}disChannel(e){this.channelMap.delete(e.flag)}free(){this.channelMap.forEach((e=>{e.disChannelHandlerArray.forEach((e=>{e("free")}))})),this.channelMap.clear()}}class m{constructor(){(0,s.Z)(this,"handlerMap",new Map),(0,s.Z)(this,"channelHandlerMap",new Map)}async handler(e,t,r){if(e.channel){let s=t.getChannel(e.stream);if(s)e.error?s.catch(e.error):s.handler(e.data);else{const n=this.channelHandlerMap.get(e.action);n&&(s=t.channel(e.stream),n(s,e.action,e.data,r))}return}if(e.stream){if(e.action){const s=this.handlerMap.get(e.action);if(s){const n=s(e.action,e.data,r);n?n instanceof Promise?n.then((r=>{t.nativeSend({stream:e.stream,data:r})})).catch((r=>{t.nativeSend({error:r.message,stream:e.stream})})):t.nativeSend({stream:e.stream,data:n}):d.getLogger({component:"message"}).warn("handler return is null")}}else{const r=t.getChannel(e.stream);r&&(e.error?r.catch(e.error):r.handler(e.data))}return}const s=this.handlerMap.get(e.action);s&&s(e.action,e.data,r)}setHandler(e,t){this.handlerMap.set(e,t)}setHandlerWithChannel(e,t){this.channelHandlerMap.set(e,t)}}class g extends m{constructor(){super(),(0,s.Z)(this,"connectMap",new Map),(0,s.Z)(this,"streamMap",new Map),this.logger=d.getInstance().logger({component:"messageCenter"})}setSandbox(e){this.sandbox=e}start(){chrome.runtime.onConnect.addListener((e=>{let t=this.connectMap.get(e.name);t||(t=new Map,this.connectMap.set(e.name,t));const r={targetTag:e.name};let s=0;var n;e.sender&&e.sender.tab&&(e.sender.frameId?(s=e.sender.tab.id+e.sender.frameId,r.frameId=e.sender.frameId):s=e.sender.tab.id,r.tabId=null===(n=e.sender.tab)||void 0===n?void 0:n.id,r.url=e.sender.url);t.set(s,e);const i=new _((t=>{e.postMessage(t)}));e.onDisconnect.addListener((()=>{t.delete(s),i.free()})),e.onMessage.addListener((e=>{if(!0!==e.broadcast)this.handler(e,i,r);else{const t=e.target;e.action?this.send(t,e.action,e.data):this.sendNative(t,e.data)}}))}));const e=new _((e=>{var t;null===(t=this.sandbox)||void 0===t||t.postMessage(e,"*")}));window.addEventListener("message",(t=>{const r=t.data;if(!0===r.broadcast){const e=r.target;r.action?this.send(e,r.action,r.data):this.sendNative(e,r.data)}this.handler(r,e,{targetTag:"sandbox"})}))}broadcast(e,t,r){return this.send(e,t,r)}send(e,t,r){this.sendNative(e,{action:t,data:r})}sendNative(e,t){if("all"===e.tag)return this.connectMap.forEach(((e,r)=>{this.sendNative({tag:r},t)})),void this.sendNative({tag:"sandbox"},t);var r;if("sandbox"===e.tag)return void(null===(r=this.sandbox)||void 0===r||r.postMessage(t,"*"));const s=this.connectMap.get(e.tag);s&&(e.id?e.id.forEach((e=>{var r;null===(r=s.get(e))||void 0===r||r.postMessage(t)})):s.forEach((e=>{e.postMessage(t)})))}}class w extends m{constructor(e){super(),(0,s.Z)(this,"stream",new Map),this.window=e,this.channelManager=new _((e=>{this.nativeSend(e)})),window.addEventListener("message",(e=>{this.handler(e.data,this.channelManager,{targetTag:"sandbox"})}))}nativeSend(e){this.window.postMessage(e,"*")}getChannel(e){return this.channelManager.getChannel(e)}channel(e){return this.channelManager.channel(e)}disChannel(e){return this.channelManager.disChannel(e)}free(){return this.channelManager.free()}syncSend(e,t){return this.channelManager.channel().syncSend(e,t)}send(e,t){this.nativeSend({action:e,data:t})}}const f=new(r(49520).ZP)("ScriptCat"),y=new Error("数据保存失败");class b{constructor(){(0,s.Z)(this,"tableName","")}list(e,t){if(!t)return this.table.where(e).toArray();let r=this.table.where(e).offset((t.page()-1)*t.count()).limit(t.count());return"id"!==t.order()&&r.sortBy(t.order()),"desc"===t.sort()&&(r=r.reverse()),r.toArray()}find(){return this.table}findOne(e){return this.table.where(e).first()}async save(e){const t=e.id;if(!t)return delete e.id,this.table.add(e);return await this.table.update(t,e)?Promise.resolve(t):Promise.reject(y)}findById(e){return this.table.get(e)}clear(){return this.table.clear()}async delete(e){return"number"==typeof e?this.table.where({id:e}).delete():this.table.where(e).delete()}update(e,t){return this.table.update(e,t)}count(){return this.table.count()}}class v extends b{constructor(){super(),(0,s.Z)(this,"tableName","logger"),this.table=f.table(this.tableName)}async queryLogs(e,t){return(await this.table.where("createtime").between(e,t).toArray()).sort(((e,t)=>t.createtime-e.createtime))}deleteBefore(e){return this.table.where("createtime").below(e).delete()}}class k{static Options(e){const t=e||{};return{Singleton(){return t.isSingleton=!0,this.Register()},Depend(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];return t.depend=r,this},Nolazy(){return t.nolazy=!0,this},Alias(e){return t.alias=e,this},Register:()=>e=>{const r={...t};var s;(r.object=e,k.objectParams.set(e,r),t.nolazy&&k.instance(e),t.isSingleton)||(null===(s=t.alias)||void 0===s||s.forEach((e=>{k.objectParams.set(e,r)})))}}}static Register(){return k.Options().Depend(...arguments).Register()}static Singleton(){return k.Options().Depend(...arguments).Singleton()}static registerInstance(e,t){if(k.instances.has(e))throw new Error("".concat(e.name," has been registered"));return k.instances.set(e,t),{alias(t){return t?(t instanceof Array?t.forEach((t=>{k.registerInstanceAlias(e,t)})):k.registerInstanceAlias(e,t),this):this}}}static registerInstanceAlias(e,t){if(!k.instances.has(e))throw new Error("".concat(e.name," not registered"));return k.instances.set(t,k.instances.get(e)),k}static instance(e){var t;if(k.instances.has(e))return k.instances.get(e);if(!k.objectParams.has(e))throw new Error("".concat(e.name," not registered"));const r=k.objectParams.get(e),s=[];null===(t=r.depend)||void 0===t||t.forEach((e=>{switch(typeof e){case"function":case"object":case"symbol":s.push(k.instance(e));break;default:s.push(e)}}));const n=new r.object(...s);return r.isSingleton&&k.registerInstance(r.object,n).alias(r.alias),n}}(0,s.Z)(k,"instances",new Map),(0,s.Z)(k,"objectParams",new Map);var C=r(81354),T=r.n(C);class S extends b{constructor(){super(),(0,s.Z)(this,"tableName","resource"),this.table=f.table(this.tableName)}}class M extends b{constructor(){super(),(0,s.Z)(this,"tableName","resourceLink"),this.table=f.table(this.tableName)}}var P=r(51120);class L{static getInstance(){return L.instance}constructor(){this.map=new Map}get(e){return this.map.get(e)}async getOrSet(e,t){let r=this.get(e);return r||(r=await t(),this.set(e,r)),Promise.resolve(r)}set(e,t){this.map.set(e,t)}has(e){return this.map.has(e)}del(e){this.map.delete(e)}list(){return Array.from(this.map.keys())}}(0,s.Z)(L,"instance",new L);const x=1,I=1;class O extends b{constructor(){super(),(0,s.Z)(this,"tableName","scripts"),this.table=f.table(this.tableName)}findByName(e){return this.findOne({name:e})}findByNameAndNamespace(e,t){return t?this.findOne({name:e,namespace:t}):this.findOne({name:e})}findByUUID(e){return this.findOne({uuid:e})}findByUUIDAndSubscribeUrl(e,t){return this.findOne({subscribeUrl:t,uuid:e})}findByOriginAndSubscribeUrl(e,t){return this.findOne({subscribeUrl:t,origin:e})}}var D=r(38152);class E extends b{constructor(){super(),(0,s.Z)(this,"tableName","subscribe"),this.table=f.table(this.tableName)}findByUrl(e){return this.findOne({url:e})}}var N,A=r(41976),U=r(81249),B=r.n(U);function R(){return navigator.userAgent.indexOf("Firefox")>=0}function G(e,t){chrome.notifications.create({type:"basic",title:e,message:t,iconUrl:chrome.runtime.getURL("assets/logo.png")})}function H(e,t,r){try{return B().lte(e,t)}catch(e){null==r||r.warn("does not conform to the Semantic Versioning specification",l.E(e))}const s=e.split("."),n=t.split(".");for(let e=0;e<s.length;e+=1){if(Number(s[e])>Number(n[e]))return!1;if(Number(s[e])<Number(n[e]))return!0}return!0}function j(e,t){const r={},s={};e.connect&&e.connect.forEach((e=>{r[e]=!0})),t.connect&&t.connect.forEach((e=>{s[e]=!0}));const n=Object.keys(s);for(let e=0;e<n.length;e+=1){const t=n[e];if(!r[t])return!1}return!0}function q(e){const t=new FileReader;return t.readAsBinaryString(e),new Promise((e=>{t.onloadend=()=>{const r=(0,C.MD5)(C.enc.Latin1.parse(t.result)).toString();e(r)}}))}function V(e){let t=!1,r=/\/\/\s*==UserScript==([\s\S]+?)\/\/\s*==\/UserScript==/m,s=r.exec(e);if(!s){if(r=/\/\/\s*==UserSubscribe==([\s\S]+?)\/\/\s*==\/UserSubscribe==/m,s=r.exec(e),!s)return null;t=!0}r=/\/\/\s*@([\S]+)((.+?)$|$)/gm;const n={};let i=r.exec(s[1]);for(;null!==i;){const[e,t]=[i[1].toLowerCase().trim(),i[2].trim()];let a=n[e];null==a&&(a=[]),a.push(t),n[e]=a,i=r.exec(s[1])}return void 0===n.name||Object.keys(n).length<3?null:(n.namespace||(n.namespace=[""]),t&&(n.usersubscribe=[]),n)}function Z(e){const t=/\/\*\s*==UserConfig==([\s\S]+?)\s*==\/UserConfig==\s*\*\//m.exec(e);if(!t)return;const r=t[1].trim().split(/[-]{3,}/),s={};return r.forEach((e=>{const t=D.ZP.parse(e);Object.keys(t).forEach((e=>{s[e]=t[e]}))})),s}async function K(e,t,r,s){var n;const i=await fetch(e,{headers:{"Cache-Control":"no-cache"}});if(200!==i.status)throw new Error("fetch script info failed");if(-1!==(null===(n=i.headers.get("content-type"))||void 0===n?void 0:n.indexOf("text/html")))throw new Error("url is html");const a=await i.text(),o=V(a);if(!o)throw new Error("parse script info failed");const c={url:e,code:a,uuid:s,isSubscribe:!1,isUpdate:r,metadata:o,source:t};return o.usersubscribe&&(c.isSubscribe=!0),c}function F(e){return new Promise((t=>{const r=new FileReader;r.onloadend=()=>t(r.result),r.readAsDataURL(e)}))}function X(e){const t=e.split(",")[0].split(":")[1].split(";")[0],r=atob(e.split(",")[1]),s=new ArrayBuffer(r.length),n=new Uint8Array(s);for(let e=0;e<r.length;e+=1)n[e]=r.charCodeAt(e);return new Blob([n],{type:t})}function z(e,t,r,s){const n=new O;return new Promise(((i,a)=>{const o=V(e);if(null==o)throw new Error("MetaData信息错误");if(void 0===o.name)throw new Error("脚本名不能为空");if(void 0===o.version)throw new Error("脚本@version版本不能为空");if(void 0===o.namespace)throw new Error("脚本@namespace命名空间不能为空");let c,l=x;if(void 0!==o.crontab){l=2;try{!function(e){let t,r=0;if(-1!==e.indexOf("once")){const t=e.split(" ");t.forEach(((e,t)=>{"once"===e&&(r=t)})),5===t.length&&(r+=1)}try{t=new A.CronTime(e.replace(/once/g,"*"))}catch(e){throw new Error("错误的定时表达式")}if(r){switch(r){case 1:return t.sendAt().toFormat("yyyy-MM-dd HH:mm 每分钟运行一次");case 2:return t.sendAt().plus({hour:1}).toFormat("yyyy-MM-dd HH 每小时运行一次");case 3:return t.sendAt().plus({day:1}).toFormat("yyyy-MM-dd 每天运行一次");case 4:return t.sendAt().plus({month:1}).toFormat("yyyy-MM 每月运行一次");case 5:return t.sendAt().plus({week:1}).toFormat("yyyy-MM-dd 每星期运行一次")}throw new Error("错误表达式")}t.sendAt().toFormat("yyyy-MM-dd HH:mm:ss")}(o.crontab[0])}catch(e){throw new Error("错误的定时表达式,请检查: ".concat(o.crontab[0]))}}else void 0!==o.background&&(l=3);let d="",u="",h=t;o.updateurl&&o.downloadurl?([u]=o.updateurl,[h]=o.downloadurl):u=t.replace("user.js","meta.js"),-1!==t.indexOf("/")&&(c=t.split("/"),c[2]&&([,d]=c));let _="";_=r||(0,p.Z)();let m={id:0,uuid:_,name:o.name[0],code:e,author:o.author&&o.author[0],namespace:o.namespace&&o.namespace[0],originDomain:d,origin:t,checkUpdateUrl:u,downloadUrl:h,config:Z(e),metadata:o,selfMetadata:{},sort:-1,type:l,status:2,runStatus:"complete",createtime:Date.now(),updatetime:Date.now(),checktime:Date.now()};(async()=>{let e;if(r?(e=await n.findByUUID(r),!e&&s&&(e=await n.findByNameAndNamespace(m.name,m.namespace))):e=await n.findByNameAndNamespace(m.name,m.namespace),e){if(e.type===x&&m.type!==x||m.type===x&&e.type!==x)return void a(new Error("脚本类型不匹配,普通脚本与后台脚本不能互相转变"));m=function(e,t){const r=e;return r.id=t.id,r.uuid=t.uuid,r.createtime=t.createtime,r.lastruntime=t.lastruntime,r.error=t.error,r.sort=t.sort,r.selfMetadata||(r.selfMetadata=t.selfMetadata||{}),r.subscribeUrl=t.subscribeUrl,r.status=t.status,r}(m,e)}else m.type===x&&(m.status=I),m.checktime=(new Date).getTime();i({script:m,oldScript:e})})()}))}class W{static Trigger(){return(e,t,r)=>{r.value()}}static script(e){return"script:".concat(e.toString())}static scriptInfo(e){return"scriptInfo:".concat(e)}static resourceByUrl(e){return"resource:".concat(e)}static scriptValue(e,t){return t?"value:storagename:".concat(t[0]):"value:id:".concat(e.toString())}static permissionConfirm(e,t){return"permission:".concat(e.toString(),":").concat(t.permissionValue||"",":").concat(t.permission||"")}static importInfo(e){return"import:".concat(e)}}function J(e){return"utf8"===Q(e)}function Q(e,t){var r,s;if(!e)return null;const n="utf8",i="binary",a=null!==(r=null==t?void 0:t.chunkLength)&&void 0!==r?r:24;let o=null!==(s=null==t?void 0:t.chunkBegin)&&void 0!==s?s:0;if(null==(null==t?void 0:t.chunkBegin)){let t=Q(e,{chunkLength:a,chunkBegin:o});return t===n&&(o=Math.max(0,Math.floor(e.length/2)-a),t=Q(e,{chunkLength:a,chunkBegin:o}),t===n&&(o=Math.max(0,e.length-a),t=Q(e,{chunkLength:a,chunkBegin:o}))),t}{if(o=function(e,t){if(0===t)return 0;if(r=e[t],r>>6!=2)return t;var r;let s=t-3;if(s>=0&&Y(e[s]))return s;if(s=t-2,s>=0&&(Y(e[s])||$(e[s])))return s;if(s=t-1,s>=0&&(Y(e[s])||$(e[s])||ee(e[s])))return s;return-1}(e,o),-1===o)return i;const t=function(e,t){if(t===e.length)return t;let r=t-3;if(r>=0&&Y(e[r]))return t+1;if(r=t-2,r>=0){if(Y(e[r]))return t+2;if($(e[r]))return t+1}if(r=t-1,r>=0){if(Y(e[r]))return t+3;if($(e[r]))return t+2;if(ee(e[r]))return t+1}return t}(e,Math.min(e.length,o+a));if(t>e.length)return i;const r=e.slice(o,t);for(let e=0;e<r.length;++e){const t=r[e];if(65533===t||t<=8)return i}return n}}function Y(e){return e>>3==30}function $(e){return e>>4==14}function ee(e){return e>>5==6}class te{constructor(e,t){this.message=e,this.name=t,this.logger=d.getLogger({component:this.name,manager:!0})}listenEvent(e,t){this.message.setHandler("".concat(this.name,"-").concat(e),((e,r,s)=>new Promise((e=>{e(t(r,s))}))))}}new Error("资源未找到"),new Error("资源加载失败");let re=k.Singleton(m)(N=class extends te{constructor(e){super(e,"resource"),this.resourceDAO=new S,this.resourceLinkDAO=new M,this.logger=d.getInstance().logger({component:"resource"})}start(){this.listenEvent("getScriptResources",(e=>this.getScriptResources(e))),this.listenEvent("deleteResource",(e=>this.resourceDAO.delete(e)))}async getResource(e,t,r){let s=await this.getResourceModel(t);if(s)return Promise.resolve(s);try{if(s=await this.addResource(t,e,r),s)return Promise.resolve(s)}catch(e){}return Promise.resolve(void 0)}async getScriptResources(e){return Promise.resolve({...await this.getRequireResource(e)||{},...await this.getRequireCssResource(e)||{},...await this.getResourceResource(e)||{}})}async getRequireResource(e){if(!e.metadata.require)return Promise.resolve({});const t={};return await Promise.allSettled(e.metadata.require.map((async r=>{const s=await this.getResource(e.id,r,"require");s&&(t[r]=s)}))),Promise.resolve(t)}async getRequireCssResource(e){if(!e.metadata["require-css"])return Promise.resolve({});const t={};return await Promise.allSettled(e.metadata.require.map((async r=>{const s=await this.getResource(e.id,r,"require-css");s&&(t[r]=s)}))),Promise.resolve(t)}async getResourceResource(e){if(!e.metadata.resource)return Promise.resolve({});const t={};return await Promise.allSettled(e.metadata.resource.map((async r=>{const s=r.split(/\s+/);if(2===s.length){const r=await this.getResource(e.id,s[1],"resource");r&&(t[s[0]]=r)}}))),Promise.resolve(t)}async checkScriptResource(e){return Promise.resolve({...await this.checkRequireResource(e)||{},...await this.checkRequireCssResource(e)||{},...await this.checkResourceResource(e)||{}})}async checkRequireResource(e){if(!e.metadata.require)return Promise.resolve({});const t={};return await Promise.allSettled(e.metadata.require.map((async r=>{const s=await this.checkResource(e.id,r,"require");s&&(t[r]=s)}))),Promise.resolve(t)}async checkRequireCssResource(e){if(!e.metadata["require-css"])return Promise.resolve({});const t={};return await Promise.allSettled(e.metadata.require.map((async r=>{const s=await this.checkResource(e.id,r,"require-css");s&&(t[r]=s)}))),Promise.resolve(t)}async checkResourceResource(e){if(!e.metadata.resource)return Promise.resolve({});const t={};return await Promise.allSettled(e.metadata.resource.map((async r=>{const s=r.split(/\s+/);if(2===s.length){const r=await this.checkResource(e.id,s[1],"resource");r&&(t[s[0]]=r)}}))),Promise.resolve(t)}async checkResource(e,t,r){let s=await this.getResourceModel(t);if(s&&(s.updatetime||0)>(new Date).getTime()-6e4)return Promise.resolve(s);try{if(s=await this.updateResource(t,e,r),s)return Promise.resolve(s)}catch(e){}return Promise.resolve(void 0)}async updateResource(e,t,r){const s=this.parseUrl(e);let n=await this.getResourceModel(s.url);try{const e=await this.loadByUrl(s.url,r);if(e.updatetime=(new Date).getTime(),L.getInstance().set(W.resourceByUrl(s.url),e),n)n.base64=e.base64,n.content=e.content,n.contentType=e.contentType,n.hash=e.hash,n.updatetime=e.updatetime,await this.resourceDAO.update(n.id,n),this.logger.info("reload resource success",{url:s.url,id:n.id});else{e.createtime=(new Date).getTime();const t=await this.resourceDAO.save(e);n=e,this.logger.info("reload new resource success",{url:s.url,id:t})}}catch(e){throw this.logger.error("load resource error",{url:s.url},l.E(e)),e}if(await this.resourceLinkDAO.findOne({url:s.url,scriptId:t}))return Promise.resolve(n);const i=await this.resourceLinkDAO.save({id:0,url:s.url,scriptId:t,createtime:(new Date).getTime()});return this.logger.debug("resource link",{url:s.url,resourceID:n.id,id:i}),Promise.resolve(n)}async addResource(e,t,r){const s=this.parseUrl(e);let n=await this.getResourceModel(s.url);if(!n)try{const e=await this.loadByUrl(s.url,r);e.createtime=(new Date).getTime(),e.updatetime=(new Date).getTime(),L.getInstance().set(W.resourceByUrl(s.url),e);const t=await this.resourceDAO.save(e);n=e,this.logger.info("load resource success",{url:s.url,id:t})}catch(e){throw this.logger.error("load resource error",{url:s.url},l.E(e)),e}if(await this.resourceLinkDAO.findOne({url:s.url,scriptId:t}))return Promise.resolve(n);const i=await this.resourceLinkDAO.save({id:0,url:s.url,scriptId:t,createtime:(new Date).getTime()});return this.logger.debug("resource link",{url:s.url,resourceID:n.id,id:i}),Promise.resolve(n)}async getResourceModel(e){const t=this.parseUrl(e),r=await this.resourceDAO.findOne({url:t.url});return r?(t.hash&&(t.hash.md5&&t.hash.md5!==r.hash.md5||t.hash.sha1&&t.hash.sha1!==r.hash.sha1||t.hash.sha256&&t.hash.sha256!==r.hash.sha256||t.hash.sha384&&t.hash.sha384!==r.hash.sha384||t.hash.sha512&&t.hash.sha512!==r.hash.sha512)&&(r.content="console.warn(\"ScriptCat: couldn't load resource from URL ".concat(e,' due to a SRI error ");')),Promise.resolve(r)):Promise.resolve(void 0)}loadByUrl(e,t){return new Promise(((r,s)=>{const n=this.parseUrl(e);P.Z.get(n.url,{responseType:"blob"}).then((async e=>{if(200!==e.status)return s(new Error("resource response status not 200:".concat(e.status)));const i={id:0,url:n.url,content:"",contentType:(e.headers["content-type"]||"application/octet-stream").split(";")[0],hash:await(a=e.data,new Promise((e=>{const t=new FileReader;t.readAsBinaryString(a),t.onloadend=()=>{t.result?e({md5:T().MD5(t.result).toString(),sha1:T().SHA1(t.result).toString(),sha256:T().SHA256(t.result).toString(),sha384:T().SHA384(t.result).toString(),sha512:T().SHA512(t.result).toString()}):e({md5:"",sha1:"",sha256:"",sha384:"",sha512:""})}}))),base64:"",type:t,createtime:(new Date).getTime()};var a;const o=await e.data.arrayBuffer();return J(new Uint8Array(o))&&(i.content=await e.data.text()),i.base64=await F(e.data)||"",r(i)})).catch((e=>s(e)))}))}parseUrl(e){const t=e.split("#");if(t.length<2)return{url:t[0],hash:void 0};const r=t[1].split(/[,;]/),s={};return r.forEach((e=>{const t=e.split("=");t.length<2||(s[t[0]]=t[1].toLocaleLowerCase())})),{url:t[0],hash:s}}})||N;const se=re;var ne=r(53229);class ie extends m{constructor(e){super(),this.tag=e,this.reconnect()}reconnect(){this.port=chrome.runtime.connect({name:this.tag}),this.channelManager=new _((e=>{this.nativeSend(e)})),this.port.onMessage.addListener((e=>{this.handler(e,this.channelManager,{targetTag:"content"})})),this.port.onDisconnect.addListener((()=>{var e;this.channelManager.free(),null===(e=this.onDisconnect)||void 0===e||e.call(this)}))}getChannel(e){return this.channelManager.getChannel(e)}channel(e){return this.channelManager.channel(e)}disChannel(e){this.channelManager.disChannel(e)}free(){this.channelManager.free()}nativeSend(e){this.port.postMessage(e)}send(e,t){this.port.postMessage({action:e,data:t})}syncSend(e,t){return this.channelManager.channel().syncSend(e,t)}broadcast(e,t,r){this.nativeSend({target:e,action:t,data:r,broadcast:!0})}broadcastChannel(e,t,r){this.nativeSend({target:e,data:{stream:t,channel:!0,data:r},broadcast:!0})}}var ae=r(3067);class oe{constructor(e,t){this.prefix="".concat(e,"_"),this.storage=t?chrome.storage.sync:chrome.storage.local}buildKey(e){return this.prefix+e}get(e){return new Promise((t=>{e=this.buildKey(e),this.storage.get(e,(r=>{t(r[e])}))}))}set(e,t){return new Promise((r=>{const s={};s[this.buildKey(e)]=t,this.storage.set(s,(()=>r()))}))}remove(e){return new Promise((t=>{this.storage.remove(this.buildKey(e),(()=>t()))}))}removeAll(){return new Promise((e=>{this.storage.clear((()=>e()))}))}keys(){return new Promise((e=>{const t={},r=this.buildKey("");this.storage.get((s=>{Object.keys(s).forEach((e=>{e.startsWith(r)&&(t[e.substring(r.length)]=s[e])})),e(t)}))}))}}const ce={"userscripts/filename-user":["error","always"],"userscripts/no-invalid-metadata":["error",{top:"required"}],"userscripts/require-name":["error","required"],"userscripts/require-description":["error","required"],"userscripts/require-version":["error","required"],"userscripts/require-attribute-space-prefix":"error","userscripts/use-homepage-and-url":"error","userscripts/use-download-and-update-url":"error","userscripts/align-attributes":["error",2],"userscripts/metadata-spacing":["error","always"],"userscripts/no-invalid-headers":"error","userscripts/no-invalid-grant":"error","userscripts/compat-grant":"off","userscripts/compat-headers":"off","userscripts/better-use-match":"warn"},le=(Object.fromEntries(Object.keys(ce).map((e=>{const t=e.split("/")[1],s=r(43914)("./".concat(t,".js"));return[e,{...s,meta:{...s.meta,docs:{...s.meta.docs,url:"https://yash-singh1.github.io/eslint-plugin-userscripts/#/rules/".concat(t)}}}]}))),{parserOptions:{ecmaVersion:"latest",sourceType:"script",ecmaFeatures:{globalReturn:!0}},globals:{CATRetryError:"readonly",CAT_fileStorage:"readonly",CAT_userConfig:"readonly"},rules:{"constructor-super":["error"],"for-direction":["error"],"getter-return":["error"],"no-async-promise-executor":["error"],"no-case-declarations":["error"],"no-class-assign":["error"],"no-compare-neg-zero":["error"],"no-cond-assign":["error"],"no-const-assign":["error"],"no-constant-condition":["error"],"no-control-regex":["error"],"no-debugger":["error"],"no-delete-var":["error"],"no-dupe-args":["error"],"no-dupe-class-members":["error"],"no-dupe-else-if":["error"],"no-dupe-keys":["error"],"no-duplicate-case":["error"],"no-empty":["error"],"no-empty-character-class":["error"],"no-empty-pattern":["error"],"no-ex-assign":["error"],"no-extra-boolean-cast":["error"],"no-extra-semi":["error"],"no-fallthrough":["error"],"no-func-assign":["error"],"no-global-assign":["error"],"no-import-assign":["error"],"no-inner-declarations":["error"],"no-invalid-regexp":["error"],"no-irregular-whitespace":["error"],"no-loss-of-precision":["error"],"no-misleading-character-class":["error"],"no-mixed-spaces-and-tabs":["error"],"no-new-symbol":["error"],"no-nonoctal-decimal-escape":["error"],"no-obj-calls":["error"],"no-octal":["error"],"no-prototype-builtins":["error"],"no-redeclare":["error"],"no-regex-spaces":["error"],"no-self-assign":["error"],"no-setter-return":["error"],"no-shadow-restricted-names":["error"],"no-sparse-arrays":["error"],"no-this-before-super":["error"],"no-undef":["warn"],"no-unexpected-multiline":["error"],"no-unreachable":["error"],"no-unsafe-finally":["error"],"no-unsafe-negation":["error"],"no-unsafe-optional-chaining":["error"],"no-unused-labels":["error"],"no-unused-vars":["error"],"no-useless-backreference":["error"],"no-useless-catch":["error"],"no-useless-escape":["error"],"no-with":["error"],"require-yield":["error"],"use-isnan":["error"],"valid-typeof":["error"],...ce},env:{es6:!0,browser:!0,greasemonkey:!0}}),de=JSON.stringify(le);var pe,ue;const he="systemConfigChange";let _e=k.Singleton(m)((ue=class e{constructor(e){(0,s.Z)(this,"cache",new Map),(0,s.Z)(this,"storage",new oe("system",!0)),(0,s.Z)(this,"loadOk",!1),e instanceof g&&(this.message=e),e instanceof ie&&(this.internal=e),this.syncConfig()}async syncConfig(){const e=await this.storage.keys();Object.keys(e).forEach((t=>{this.cache.has(t)||this.cache.set(t,e[t])})),this.loadOk=!0}awaitLoad(){return new Promise((e=>{if(this.loadOk)return void e(this);const t=setInterval((()=>{this.loadOk&&(clearInterval(t),e(this))}),100)}))}async init(){var t;null===(t=this.message)||void 0===t||t.setHandler(he,((t,r)=>{this.storage.set(r.key,r.val),this.cache.set(r.key,r.val),e.hook.trigger("update",r.key,r.val)}))}set(e,t){this.cache.set(e,t),this.internal?this.internal.send(he,{key:e,val:t}):this.storage.set(e,t)}list(){const e={};return this.cache.forEach(((t,r)=>{e[r]=t})),e}get changetime(){return this.cache.get("changetime")||0}set changetime(e){this.set("changetime",0)}get checkScriptUpdateCycle(){return void 0===this.cache.get("check_script_update_cycle")?86400:this.cache.get("check_script_update_cycle")}set checkScriptUpdateCycle(e){this.set("check_script_update_cycle",e)}get silenceUpdateScript(){return this.cache.get("silence_update_script")||!1}set silenceUpdateScript(e){this.set("silence_update_script",e)}get enableAutoSync(){return!this.cache.has("enable_auto_sync")||this.cache.get("enable_auto_sync")}set enableAutoSync(e){this.set("enable_auto_sync",e)}get updateDisableScript(){const e=this.cache.get("update_disable_script");return void 0===e||e}set updateDisableScript(e){this.set("update_disable_script",e)}get vscodeUrl(){return this.cache.get("vscode_url")||"ws://localhost:8642"}set vscodeUrl(e){this.set("vscode_url",e)}get vscodeReconnect(){return this.cache.get("vscode_reconnect")||!1}set vscodeReconnect(e){this.set("vscode_reconnect",e)}get backup(){return this.cache.get("backup")||{filesystem:"webdav",params:{}}}set backup(e){this.set("backup",e)}get cloudSync(){return this.cache.get("cloud_sync")||{enable:!1,syncDelete:!0,filesystem:"webdav",params:{}}}set cloudSync(e){this.set("cloud_sync",e)}get catFileStorage(){return this.cache.get("cat_file_storage")||{status:"unset",filesystem:"webdav",params:{}}}set catFileStorage(e){this.set("cat_file_storage",e)}get scriptCatFlag(){return this.cache.get("script_cat_flag")}set scriptCatFlag(e){this.set("script_cat_flag",e)}get enableEslint(){return this.cache.get("enable_eslint")}set enableEslint(e){this.set("enable_eslint",e)}get eslintConfig(){return this.cache.get("eslint_config")||de}set eslintConfig(e){if(""===e)return this.set("eslint_config",e),void ae.Z.success("ESLint规则已重置");try{JSON.parse(e),this.set("eslint_config",e),ae.Z.success("ESLint规则已保存")}catch(e){ae.Z.error(e.toString())}}get logCleanCycle(){return this.cache.get("log_clean_cycle")||7}set logCleanCycle(e){this.set("log_clean_cycle",e)}get scriptListColumnWidth(){return this.cache.get("script_list_column_width")||{}}set scriptListColumnWidth(e){this.set("script_list_column_width",e)}get menuExpandNum(){return this.cache.get("menu_expand_num")||5}set menuExpandNum(e){this.set("menu_expand_num",e)}},(0,s.Z)(ue,"hook",new n),pe=ue))||pe;var me,ge,we,fe,ye,be,ve,ke,Ce,Te,Se,Me;const Pe={};function Le(e){return(t,r)=>{Pe[e]=t[r]}}let xe=(me=Le("upsert"),ge=Le("fetch"),we=Le("enable"),fe=Le("disable"),ye=Le("delete"),be=Le("checkUpdate"),ve=Le("importByUrl"),ke=Le("exclude"),Ce=Le("resetExclude"),Te=Le("resetMatch"),Se=Le("updateCheckUpdateUrl"),Me=class{constructor(e,t){this.manager=e,this.dao=t,this.cache=L.getInstance(),this.logger=d.getInstance().logger({component:"script"}),Object.keys(Pe).forEach((e=>{this.manager.listenEvent(e,Pe[e].bind(this))}))}async upsertHandler(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user";const r=this.logger.with({scriptId:e.id,name:e.name,uuid:e.uuid,version:e.metadata.version[0],upsertBy:t});if(e.id){const t=await this.dao.findById(e.id);t&&(e.selfMetadata=t.selfMetadata)}return e.config||(e.config=void 0),new Promise(((s,n)=>{this.dao.save(e).then((()=>{r.info("script upsert success"),Ue.hook.trigger("upsert",e,t),s({id:e.id})}),(e=>{r.error("script upsert failed",l.E(e)),n(e)}))}))}fetchInfoHandler(e){return new Promise((t=>{t(this.cache.get(W.scriptInfo(e)))}))}enableHandler(e){const t=this.logger.with({scriptId:e});return new Promise(((r,s)=>{this.dao.findById(e).then((e=>e?(e.status!==I&&(e.status=I,e.updatetime=(new Date).getTime(),this.dao.save(e),t.info("enable script"),Ue.hook.trigger("enable",e)),r(1)):s(new Error("脚本不存在")))).catch((e=>{t.error("enable error",l.E(e)),s(e)}))}))}disableHandler(e){const t=this.logger.with({scriptId:e});return new Promise(((r,s)=>{this.dao.findById(e).then((e=>e?(e.status===I&&(e.status=2,e.updatetime=(new Date).getTime(),this.dao.save(e),t.info("disable script"),Ue.hook.trigger("disable",e)),r(1)):s(new Error("脚本不存在")))).catch((e=>{t.error("disable error",l.E(e)),s(e)}))}))}deleteHandler(e){let t=this.logger.with({scriptId:e});return new Promise(((r,s)=>{this.dao.findById(e).then((e=>e?(t=t.with({name:e.name,uuid:e.uuid,version:e.metadata.version[0]}),this.dao.delete(e.id).then((()=>(t.info("script delete success"),Ue.hook.trigger("delete",e),r(1)))).catch((e=>(t.error("script delete failed",l.E(e)),s(e))))):Promise.reject(new Error("脚本不存在"))))}))}checkUpdateHandler(e){return this.manager.checkUpdate(e,"user")}importByUrlHandler(e){return this.manager.openInstallPageByUrl(e)}excludeHandler(e){let{id:t,exclude:r,remove:s}=e;const n=this.logger.with({scriptId:t});return new Promise(((e,i)=>{this.dao.findById(t).then((t=>{if(!t)return i(new Error("脚本不存在"));t.selfMetadata=t.selfMetadata||{};const a=t.selfMetadata.exclude||t.metadata.exclude||[];if(s)for(let e=0;e<a.length;e+=1)a[e]===r&&a.splice(e,1);else a.push(r);return t.selfMetadata.exclude=a,this.dao.save(t).then((()=>{n.info("script exclude success"),Ue.hook.trigger("upsert",t,"system"),e({id:t.id})}),(e=>{n.error("script exclude failed",l.E(e)),i(e)})),e(1)})).catch((e=>{n.error("exclude error",l.E(e)),i(e)}))}))}resetExcludeHandler(e){let{id:t,exclude:r}=e;const s=this.logger.with({scriptId:t});return new Promise(((e,n)=>{this.dao.findById(t).then((t=>t?(t.selfMetadata=t.selfMetadata||{},r?t.selfMetadata.exclude=r:delete t.selfMetadata.exclude,this.dao.save(t).then((()=>{s.info("script resetExclude success"),Ue.hook.trigger("upsert",t,"system"),e({id:t.id})}),(e=>{s.error("script resetExclude failed",l.E(e)),n(e)})),e(1)):n(new Error("脚本不存在")))).catch((e=>{s.error("resetMatch error",l.E(e)),n(e)}))}))}resetMatchHandler(e){let{id:t,match:r}=e;const s=this.logger.with({scriptId:t});return new Promise(((e,n)=>{this.dao.findById(t).then((t=>t?(t.selfMetadata=t.selfMetadata||{},r?t.selfMetadata.match=r:delete t.selfMetadata.match,this.dao.save(t).then((()=>{s.info("script resetMatch success"),Ue.hook.trigger("upsert",t,"system"),e({id:t.id})}),(e=>{s.error("script resetMatch failed",l.E(e)),n(e)})),e(1)):n(new Error("脚本不存在")))).catch((e=>{s.error("resetMatch error",l.E(e)),n(e)}))}))}updateCheckUpdateUrlHandler(e){let{id:t,url:r}=e;const s=this.logger.with({scriptId:t});return new Promise(((e,n)=>{this.dao.findById(t).then((t=>t?(t.checkUpdateUrl=r,t.downloadUrl=r,this.dao.save(t).then((()=>{s.info("script updateCheckUpdateUrl success"),e({id:t.id})}),(e=>{s.error("script updateCheckUpdateUrl failed",l.E(e)),n(e)})),e(1)):n(new Error("脚本不存在")))).catch((e=>{s.error("updateCheckUpdateUrl error",l.E(e)),n(e)}))}))}},(0,ne.Z)(Me.prototype,"upsertHandler",[me],Object.getOwnPropertyDescriptor(Me.prototype,"upsertHandler"),Me.prototype),(0,ne.Z)(Me.prototype,"fetchInfoHandler",[ge],Object.getOwnPropertyDescriptor(Me.prototype,"fetchInfoHandler"),Me.prototype),(0,ne.Z)(Me.prototype,"enableHandler",[we],Object.getOwnPropertyDescriptor(Me.prototype,"enableHandler"),Me.prototype),(0,ne.Z)(Me.prototype,"disableHandler",[fe],Object.getOwnPropertyDescriptor(Me.prototype,"disableHandler"),Me.prototype),(0,ne.Z)(Me.prototype,"deleteHandler",[ye],Object.getOwnPropertyDescriptor(Me.prototype,"deleteHandler"),Me.prototype),(0,ne.Z)(Me.prototype,"checkUpdateHandler",[be],Object.getOwnPropertyDescriptor(Me.prototype,"checkUpdateHandler"),Me.prototype),(0,ne.Z)(Me.prototype,"importByUrlHandler",[ve],Object.getOwnPropertyDescriptor(Me.prototype,"importByUrlHandler"),Me.prototype),(0,ne.Z)(Me.prototype,"excludeHandler",[ke],Object.getOwnPropertyDescriptor(Me.prototype,"excludeHandler"),Me.prototype),(0,ne.Z)(Me.prototype,"resetExcludeHandler",[Ce],Object.getOwnPropertyDescriptor(Me.prototype,"resetExcludeHandler"),Me.prototype),(0,ne.Z)(Me.prototype,"resetMatchHandler",[Te],Object.getOwnPropertyDescriptor(Me.prototype,"resetMatchHandler"),Me.prototype),(0,ne.Z)(Me.prototype,"updateCheckUpdateUrlHandler",[Se],Object.getOwnPropertyDescriptor(Me.prototype,"updateCheckUpdateUrlHandler"),Me.prototype),Me);var Ie,Oe,De,Ee,Ne;let Ae=(Ie=k.Singleton(m,_e),Oe=W.Trigger(),Ie((Ne=class e extends te{constructor(e,t){super(e,"script"),this.event=new xe(this,new O),this.scriptDAO=new O,this.systemConfig=t,this.logger=d.getLogger({component:"scriptManager"})}static CacheManager(){e.hook.addListener("upsert",(e=>(L.getInstance().del(W.script(e.id)),Promise.resolve(!0)))),e.hook.addListener("delete",(e=>(L.getInstance().del(W.script(e.id)),Promise.resolve(!0))))}start(){this.listenInstallRequest(),setInterval((()=>{this.systemConfig.checkScriptUpdateCycle&&(this.logger.debug("start check update"),this.scriptDAO.table.where("checktime").belowOrEqual((new Date).getTime()-1e3*this.systemConfig.checkScriptUpdateCycle).toArray().then((e=>{e.forEach((e=>{(this.systemConfig.updateDisableScript||2!==e.status)&&this.checkUpdate(e.id,"system")}))})))}),6e5)}listenInstallRequest(){chrome.webRequest.onBeforeRequest.addListener((e=>{if("GET"!==e.method)return{};return-1!==e.url.split("#").splice(1).join("#").indexOf("bypass=true")?{}:(this.openInstallPage(e),{redirectUrl:"javascript:void 0"})}),{urls:["*://*/*.user.js","*://*/*.user.js?*","https://*/*.user.sub.js","https://*/*.user.sub.js?*","https://*/*.user.bg.js","https://*/*.user.bg.js?*","file:///*/*.user.js"],types:["main_frame"]},["blocking"])}openInstallPage(e){this.openInstallPageByUrl(e.url).catch((()=>{chrome.tabs.update(e.tabId,{url:"".concat(e.url,"#bypass=true")})}))}openInstallPageByUrl(e){return K(e,"user",!1,(0,p.Z)()).then((e=>{L.getInstance().set(W.scriptInfo(e.uuid),e),setTimeout((()=>{L.getInstance().del(W.scriptInfo(e.uuid))}),6e4),function(e){chrome.tabs.query({active:!0},(t=>{t.length?chrome.tabs.create({url:e,index:t[0].index+1}):chrome.tabs.create({url:e})}))}("/src/install.html?uuid=".concat(e.uuid))}))}async checkUpdate(e,t){const r=await this.scriptDAO.findById(e);if(!r)return Promise.resolve(!1);if(this.scriptDAO.update(e,{checktime:(new Date).getTime()}),!r.checkUpdateUrl)return Promise.resolve(!1);const s=d.getLogger({scriptId:e,name:r.name});try{const e=await K(r.checkUpdateUrl,t,!1,r.uuid),{metadata:n}=e;if(!n)return s.error("parse metadata failed"),Promise.resolve(!1);const i=n.version&&n.version[0];if(!i)return s.error("parse version failed",{version:n.version[0]}),Promise.resolve(!1);let a=r.metadata.version&&r.metadata.version[0];if(a||(a="0.0.0"),H(i,a,s))return Promise.resolve(!1);this.openUpdatePage(r,t)}catch(e){return s.error("check update failed",l.E(e)),Promise.resolve(!1)}return Promise.resolve(!0)}openUpdatePage(e,t){const r=this.logger.with({scriptId:e.id,name:e.name,downloadUrl:e.downloadUrl,checkUpdateUrl:e.checkUpdateUrl});K(e.downloadUrl||e.checkUpdateUrl,t,!0,e.uuid).then((async t=>{if(this.systemConfig.silenceUpdateScript)try{const s=await z(t.code,e.downloadUrl||e.checkUpdateUrl,e.uuid);if(j(s.oldScript.metadata,s.script.metadata))return r.info("silence update script"),void this.event.upsertHandler(s.script)}catch(e){r.error("prepare script failed",l.E(e))}L.getInstance().set(W.scriptInfo(t.uuid),t),chrome.tabs.create({url:"/src/install.html?uuid=".concat(t.uuid)})})).catch((e=>{r.error("fetch script info failed",l.E(e))}))}async installByUrl(e,t,r){const s=await K(e,t,!1,(0,p.Z)()),n=await z(s.code,e,s.uuid);return n.script.subscribeUrl=r,await this.event.upsertHandler(n.script,t),Promise.resolve(n.script)}},(0,s.Z)(Ne,"hook",new n),Ee=Ne,(0,ne.Z)(Ee,"CacheManager",[Oe],Object.getOwnPropertyDescriptor(Ee,"CacheManager"),Ee),De=Ee))||De);const Ue=Ae;class Be extends b{constructor(e){super(),(0,s.Z)(this,"tableName","value"),this.table=e||f.table(this.tableName)}}var Re,Ge,He=r(96486);let je=k.Singleton(m,h)((Ge=class e extends te{constructor(e,t){super(e,"value"),this.broadcast=t,this.scriptDAO=new O,this.valueDAO=new Be}start(){this.listenEvent("upsert",(async(e,t)=>{const{scriptId:r,key:s,value:n}=e,i=await this.scriptDAO.findById(r);return i?this.setValue(i,s,n,t):Promise.reject(new Error("script not found"))})),this.message.setHandlerWithChannel("watchValue",(async(t,r,s)=>{const n=e=>{if(s.metadata.storagename){if(e.storageName!==s.metadata.storagename[0])return}else if(e.scriptId!==s.id)return;t.send(e)};e.hook.addListener("upsert",n),t.setDisChannelHandler((()=>{e.hook.removeListener("upsert",n)}))})),Ue.hook.addListener("delete",(()=>{}))}async getScriptValues(e){return L.getInstance().getOrSet(W.scriptValue(e.id,e.metadata.storagename),(()=>this.getValues(e)))}async getValues(e){const t={};e.metadata.storagename?[t.storageName]=e.metadata.storagename:t.scriptId=e.id;const r=await this.valueDAO.list(t),s={};return r.forEach((e=>{s[e.key]=e})),Promise.resolve(s)}async setValue(t,r,s,n){let i,a;const o=f.table("value");return f.transaction("rw",o,(async o=>{const c=new Be(o.table("value"));if(i=t.metadata.storagename?await c.findOne({storageName:t.metadata.storagename[0],key:r}):await c.findOne({scriptId:t.id,key:r}),i){if((0,He.isEqual)(i.value,s))return Promise.resolve(!0);a=i.value,i.value=s,i.updatetime=(new Date).getTime()}else i={id:0,scriptId:(null==t?void 0:t.id)||0,storageName:(null==t?void 0:t.metadata.storagename)&&(null==t?void 0:t.metadata.storagename[0])||"",key:r,value:s,createtime:(new Date).getTime(),updatetime:0};let l=0;const d=L.getInstance().get(W.scriptValue(t.id,t.metadata.storagename));if(null==s?(i.value=void 0,l=await c.delete(i.id),d&&delete d[r]):(l=await c.save(i),d&&(d[r]=i)),l<=0)return Promise.reject(new Error("value no change"));const p={oldValue:a,sender:n,value:i};return this.broadcast.broadcast({tag:"all"},"valueUpdate",p),e.hook.trigger("upsert",i),Promise.resolve(!0)}))}},(0,s.Z)(Ge,"hook",new n),Re=Ge))||Re;const qe=je;class Ve{constructor(){(0,s.Z)(this,"cache",new Map),(0,s.Z)(this,"rule",new Map)}parseURL(e){0===e.indexOf("*http")&&(e=e.substring(1));const t=/^(.+?):\/\/(.*?)((\/.*?)(\?.*?|)|)$/.exec(e);return t?{scheme:t[1],host:t[2],path:t[4]||("*"===e[e.length-1]?"*":"/"),search:t[5]}:"*"===e?{scheme:"*",host:"*",path:"*",search:"*"}:void 0}compileRe(e){const t=this.parseURL(e);if(!t)return"";switch(t.scheme){case"*":t.scheme=".+?";break;case"http*":t.scheme="http[s]?"}let r=t.host.indexOf("*");if("*"===t.host||"**"===t.host)r=-1;else if(t.host.endsWith("*"))t.host.endsWith(":*")||(t.host=t.host.substring(0,t.host.length-1));else if(-1!==r&&0!==r)return"";if(t.host=t.host.replace(/\*/g,"[^/]*?"),t.host.startsWith("[^/]*?."))t.host="([^/]*?\\.?)".concat(t.host.substring(7));else if(-1!==r&&-1===t.host.indexOf("."))return"";t.host.endsWith("tld")&&(t.host="".concat(t.host.substr(0,t.host.length-3),".*?"));const s=t.host.indexOf(":");if(-1===s)t.host="".concat(t.host,"(:\\d+)?");else{const e=t.host.substring(s+1);t.host="*"===e?"".concat(t.host.substring(0,s),"(:\\d+)?"):"".concat(t.host.substring(0,s),"(:").concat(e,")?")}let n="^".concat(t.scheme,"://").concat(t.host);return"/"===t.path?n+="[/]?":n+=t.path.replace(/\*/g,".*?"),t.search&&(n+=t.search.replace(/([\\?])/g,"\\$1").replace(/\*/g,".*?")),"".concat(n.replace(/\//g,"/"),"$")}add(e,t){const r=this.compileRe(e);if(!r)throw new Error("invalid url: ".concat(e));let s=this.rule.get(r);s||(s=[],this.rule.set(r,s)),s.push(t),this.delCache()}match(e){let t=this.cache.get(e);if(t)return t;t=[];try{this.rule.forEach(((r,s)=>{new RegExp(s).test(e)&&t&&t.push(...r)}))}catch(e){console.warn("bad match rule",l.E(e))}return this.cache.set(e,t),t}static getId(e){return"object"==typeof e?e.id:e}del(e){const t=Ve.getId(e);this.rule.forEach(((e,r)=>{const s=[];e.forEach((e=>{Ve.getId(e)!==t&&s.push(e)})),s?this.rule.set(r,s):this.rule.delete(r)})),this.delCache()}delCache(){this.cache.clear()}}class Ze extends Ve{constructor(){super(...arguments),(0,s.Z)(this,"excludeMatch",new Ve)}exclude(e,t){this.excludeMatch.add(e,t)}del(e){super.del(e),this.excludeMatch.del(e),this.cache.clear()}match(e){const t=this.cache.get(e);if(t)return t;let r=super.match(e);const s=new Map;r.forEach((e=>{s.set(Ve.getId(e),e)}));const n=this.excludeMatch.match(e),i=new Map;return n.forEach((e=>{i.set(Ve.getId(e),1)})),r=[],s.forEach(((e,t)=>{i.has(t)||r.push(e)})),this.cache.set(e,r),r}}class Ke extends Ze{parseURL(e){const t=super.parseURL(e);if(t)return t;if("http*"===e)return{scheme:"*",host:"*",path:"*",search:"*"};const r=/^(.*?)((\/.*?)(\?.*?|)|)$/.exec(e);return r?{scheme:"*",host:r[1],path:r[3]||("*"===e[e.length-1]?"*":"/"),search:r[4]}:void 0}compileRe(e){const t=this.parseURL(e);if(!t)return"";switch(t.scheme){case"*":t.scheme=".+?";break;case"http*":t.scheme="http[s]?"}t.host=t.host.replace(/\*/g,"[^/]*?"),t.host.startsWith("[^/]*?.")&&(t.host="([^/]*?.?)".concat(t.host.substring(7))),t.host.endsWith("tld")&&(t.host="".concat(t.host.substring(0,t.host.length-3),".*?"));let r="^".concat(t.scheme,"://").concat(t.host);return"/"===t.path?r+="[/]?":r+=t.path.replace(/\*/g,".*?"),t.search&&(r+=t.search.replace(/([\\?])/g,"\\$1").replace(/\*/g,".*?")),"".concat(r.replace(/\//g,"/"),"$")}}var Fe=r(36609),Xe=r(29288),ze=r(84110),We=r.n(ze);const Je=JSON.parse('{"import_link":"Import Link","import_link_failure":"Import Link Failed","create_user_script":"Create User Script","create_background_script":"Create Background Script","create_scheduled_script":"Create Scheduled Script","import_by_local":"Local Imported","import_local_failure":"Local import failed","import_local_success":"Local import success","create_script":"Create Script","user_guide":"User Guide","api_docs":"API Docs","development_guide":"Development Guide","script_gallery":"Script Gallery","community_forum":"Community Forum","external_links":"External Links","system_follow":"Follow System","no_data":"No Data","installed_scripts":"Install Script","subscribe":"Subscribe","logs":"Logs","tools":"Tools","settings":"Settings","collapsible":"Collapsible","guide":"Guide","helpcenter":"Help Center","general":"General","language":"Language","help_translate":"Help us translate","script_sync":"Script Sync","sync_delete":"Sync Delete","enable_script_sync_to":"Enable Script Sync to","save":"Save","cloud_sync_account_verification":"Cloud Sync Account Verification in Progress...","cloud_sync_verification_failed":"Cloud Sync Account Verification Failed","save_success":"Save Successful","update":"Update","check_update":"Check Update","script_subscription_check_interval":"Script/Subscription Update Check Interval","never":"Never","6_hours":"6 hours","12_hours":"12 hours","every_day":"Every Day","every_week":"Every Week","update_disabled_scripts":"Update Disabled Scripts","silent_update_non_critical_changes":"Silent Update Non-critical Script Changes","enable_eslint":"Enable ESLint","eslint_rules":"ESLint Rules","enter_eslint_rules":"Please Enter ESLint Rules, Configurations Can Be Downloaded from https://eslint.org/play/","language_change_tip":"Language Change Successful","backup":"Backup","local":"Local","export_file":"Export File","import_file":"Import File","cloud":"Cloud","backup_to":"Backup To","preparing_backup":"Preparing Backup to Cloud","backup_success":"Backup Successful","backup_failed":"Backup Failed","no_backup_files":"No Backup Files","backup_list":"Backup List","open_backup_dir":"Open Backup Directory","confirm_delete":"Confirm Deletion","confirm_delete_backup_file":"Confirm Delete Backup File","confirm_update":"Confirm update","delete_success":"Delete Successful","backup_strategy":"Backup Strategy","under_construction":"Under Construction","development_debugging":"Development Debugging","vscode_url":"VSCode URL","auto_connect_vscode_service":"Auto Connect VSCode Service","connect":"Connect","connection_success":"Connection Successful","connection_failed":"Connection Failed","select_import_script":"Please Select the Script to Import in the New Page","import_error":"Import Error","pulling_data_from_cloud":"Pulling Data from Cloud","pull_failed":"Pull Failed","restore":"Restore","log_title":"Runtime Logs","last_5_minutes":"Last 5 Minutes","last_15_minutes":"Last 15 Minutes","last_30_minutes":"Last 30 Minutes","last_1_hour":"Last 1 Hour","last_3_hours":"Last 3 Hours","last_6_hours":"Last 6 Hours","last_12_hours":"Last 12 Hours","last_24_hours":"Last 24 Hours","last_7_days":"Last 7 Days","query":"Query","labels":"Labels","search_regex":"Search (Supports Regex)","clean_schedule":"Schedule Cleanup","days_ago_logs":"Logs of Days Ago","delete_completed":"Deletion Completed","delete_current_logs":"Delete Current Logs","clear_completed":"Clearing Completed","clear_logs":"Clear Logs","total_logs":"A total of {{length}} logs were queried","filtered_logs":"{{length}} logs after filtering","enter_filter_conditions":"Please Enter Filter Conditions for Query","permission":"Permission","enter_subscribe_name":"Please Enter Subscription Name","subscribe_url":"Subscription URL","confirm_delete_subscription":"Are You Sure You Want to Delete This Subscription? Related Scripts Will Also Be Deleted","list":{"confirm_delete":"Are You Sure You Want to Delete? Please Note That This and pasted the remaining text.","confirm_update":"Are You Sure You Want to Update? Please Note That This is an irreversible operation."},"enable":"Enable","script_list_enable_width":120,"script_list_last_updated_width":140,"script_list_apply_to_run_status_width":160,"subscribe_list_enable_width":120,"disable":"Disable","name":"Name","version":"Version","apply_to_run_status":"Apply to/Run Status","source":"Source","home":"Home","sorting":"Sorting","last_updated":"Last Updated","action":"Action","foreground_page_script_tooltip":"Foreground page script, runs on the specified page","background_script_tooltip":"Background script, runs on the specified page","scheduled_script_tooltip":"Scheduled script, next run time:","running":"Running","completed":"Completed","subscription_link":"Subscription Link","subscription_installation":"Subscription Installation","manually_created":"Local","script_link":"Script Link","user_installation":"Installation","confirm_delete_script":"Are you sure you want to delete this script?","delete_failed":"Deletion Failed","enter_script_name":"Please enter script name","update_not_supported":"This script does not support update checks","checking_for_updates":"Checking for updates...","new_version_available":"New version available","latest_version":"Latest Version","checked_for_all_selected":"Checked updates for all selected","update_check_failed":"Update Check Failed","stopping_script":"Stopping script","script_stopped":"Script Stopped","starting_script":"Starting script...","starting_updates":"Starting Batch Updates...","script_started":"Script Started","batch_operations":"Batch Operations","export":"Export","delete":"Delete","unknown_operation":"Unknown Operation","confirm":"Confirm","close":"Close","page_script":"Page Script","homepage":"Homepage","script_website":"Script Website","script_source":"Script Source Code","bug_feedback_script_support":"Bug Feedback/Script Support","config":"Config","key":"Key","value":"Value","add":"Add","type":"Type","edit_value":"Edit Value","add_value":"Add Value","update_success":"Update Successful","add_success":"Add Successful","script_storage":"Script Storage","enter_key":"Please enter key","key_placeholder":"Key","value_placeholder":"When the type is object, please enter data that can be JSON parsed","clear":"Clear","clear_success":"Clear Successful","confirm_clear":"Are you sure you want to clear this storage space?","type_string":"String","type_number":"Number","type_boolean":"Boolean","type_object":"Object","confirm_delete_resource":"Are you sure you want to delete this resource? This resource will reload on the next startup","confirm_clear_resource":"Are you sure you want to clear these resources? Resources will reload on the next startup","script_resource":"Script Resource","permission_value":"Authorization Value","allow":"Allow","yes":"Yes","no":"No","confirm_delete_permission":"Confirm deletion of this authorization?","script_setting":"Script Setting","basic_info":"Basic Information","update_url":"Update URL","permission_management":"Permission Management","add_permission":"Add Permission","permission_cors":"Cross-domain (cors)","permission_cookie":"Manage cookies","match":"Match","user_setting":"User Setting","confirm_delete_exclude":"Confirm deletion of this exclusion?","after_deleting_match_item":"After the script\'s match items are deleted, they will be automatically added to the match items","confirm_delete_match":"Confirm deletion of this match?","after_deleting_exclude_item":"After deleting the script\'s match item, it will be automatically added to the exclusion items","add_match":"Add Match","add_exclude":"Add Exclude","website_match":"Website Match (@match)","reset":"Reset","website_exclude":"Website Exclude (@exclude)","confirm_reset":"Confirm reset?","script_total_runs":"The script has run {{runNum}} times, {{runNumByIframe}} times in iframes","script_total_runs_single":"The script has run {{runNum}} times","script_disabled":"The script is not enabled","run_once":"Run Once","stop":"Stop","edit":"Edit","exclude_on":"Exclude On","exclude_off":"Exclude Off","exclude_execution":"Exclude Execution","user_config":"User Config","gm_api":"GM Api","storage_api":"Storage API","use_file_system":"File System in Use","open_directory":"Open Directory","account_validation_failed":"Account Validation Failed","not_set":"Not Set","in_use":"In Use","storage_error":"Storage Error","upload_to_cloud":"Upload to Cloud","save_failed":"Save Failed","exporting":"Exporting...","upload_to":"Upload To","value_export_expression":"Value Export Expression","overwrite_original_value_on_import":"Overwrite Original Value on Import","cookie_export_expression":"Cookie Export Expression","overwrite_original_cookie_on_import":"Overwrite Original Cookie on Import","restore_default_values":"Restore Default Values","get_confirm_error":"Get Confirmation Information Failed","confirm_error":"Confirmation Failed","ignore":"Ignore","allow_once":"Allow Once","temporary_allow":"Temporarily Allow This {{permissionContent}}","temporary_allow_all":"Temporarily Allow All {{permissionContent}}","permanent_allow":"Permanently Allow This {{permissionContent}}","permanent_allow_all":"Permanently Allow All {{permissionContent}}","deny_once":"Deny Once","temporary_deny":"Temporarily Deny This {{permissionContent}}","temporary_deny_all":"Temporarily Deny All {{permissionContent}}","permanent_deny":"Permanently Deny This {{permissionContent}}","permanent_deny_all":"Permanently Deny All {{permissionContent}}","data_import":"Data Import","import":"Import","select_scripts_to_import":"Please select the scripts you want to import","select_all":"Select All","script_import_progress":"Script Import Progress","select_subscribes_to_import":"Please select the subscriptions you want to import","subscribe_import_progress":"Subscribe Import Progress","author":"Author","description":"Description","operation":"Operation","error":"Error","unknown":"Unknown","add_new":"Add New","no_operation":"No Operation","enable_script":"Enable Script","local_creation":"Local Creation","import_success":"Import Successful","install_script":"Install Script","update_script":"Update Script","install_subscribe":"Install Subscription","update_subscribe":"Update Subscription","invalid_link":"Invalid Link","subscribe_install_label":"This subscription will install the following scripts","script_runs_in":"Script will run on the following websites","script_has_full_access_to":"Script will have full access to the following URLs","script_requires":"Script requires the following external resources","cookie_warning":"Please note, this script requests access to Cookie permissions, which is a dangerous permission. Please verify the security of the script.","scheduled_script_description_1":"This is a scheduled script, which will automatically run at a specific time once enabled and can be manually controlled in the panel.","scheduled_script_description_2":"Scheduled task expression: {{expression}}, most recent run time: {{time}}","background_script_description":"This is a background script, which will automatically run once when the browser opens once enabled, and can be manually controlled in the panel.","install_success":"Install Successful","install":{"update_success":"Update Successful"},"install_failed":"Install Failed","subscribe_success":"Subscription Successful","subscribe_failed":"Subscription Failed","current_version":"Current Version","update_version":"Update Version","background_script_tag":"This is a Background Script","scheduled_script_tag":"This is a Scheduled Script","background_script":"Background Script","scheduled_script":"Scheduled Script","install_from_legitimate_sources_warning":"Please install scripts from legitimate sources! Unknown scripts may invade your privacy or conduct malicious operations.","antifeature_referral_link_title":"Referral Link","antifeature_referral_link_description":"This script modifies or redirects to the author\'s referral link","antifeature_ads_title":"Ads","antifeature_ads_description":"This script inserts ads on the pages you visit","antifeature_payment_title":"Payment","antifeature_payment_description":"This script requires payment to be used properly","antifeature_miner_title":"Mining","antifeature_miner_description":"This script engages in mining activities","antifeature_membership_title":"Membership Features","antifeature_membership_description":"This script requires registration as a member to be used properly","antifeature_tracking_title":"Tracking","antifeature_tracking_description":"This script tracks your user information","script_info_load_failed":"Failed to load script information","script_status_tooltip":"You can control the opening status of scripts. Ordinary oil monkey scripts are enabled by default, and background scripts and timing scripts are disabled by default.","get_script":"Get Script","report_issue":"Report Issue","project_docs":"Project Documentation","community":"Community","popup":{"new_version_available":"New Version Available"},"current_page_scripts":"Current Page Running Scripts","enabled_background_scripts":"Enabled and Running Background Scripts","script_accessing_cross_origin_resource":"Script is attempting to access a cross-origin resource","confirm_operation_description":"Please confirm if you allow the script to perform this operation. The script can also add the @connect tag to bypass this option.","domain":"Domain","script_name":"Script Name","request_domain":"Request Domain","request_url":"Request URL","access_cookie_content":"The script is attempting to access website cookie content","confirm_script_operation":"Please confirm if you allow the script to perform this operation. Cookies contain important user data, so only grant access to trusted scripts.","cookie_domain":"Cookie Domain","script_operation_title":"Script is attempting to access script synchronization storage","script_operation_description":"Please confirm whether you allow the script to perform this operation. If allowed, the script will be able to access the storage space you have set up and create a directory app/${dir} within it.","script_permission_content":"Script","sync_system_connect_failed":"Sync system connection failed","sync_system_closed":"Sync turned off","sync_system_closed_description":"Sync is disabled, please configure again","auth_type":"Authentication Type","url":"URL","username":"Username","password":"Password","skip":"Skip","next":"Next","back":"Back","last":"Finish","start_guide_title":"Welcome to ScriptCat Extension","start_guide_content":"Next, we will introduce the basic usage of ScriptCat to you.","guide_installed_scripts":"The scripts you have installed will be displayed here.","guide_script_list_title":"Script Market","guide_script_list_content":"You can install scripts from the <Link href=\\"https://scriptcat.org/search\\">Script Market</Link>. In addition to supporting user scripts, ScriptCat also supports <Link href=\\"https://docs.scriptcat.org/docs/dev/backgroud/\\">background scripts</Link>.","guide_script_list_enable_title":"Enable Scripts","guide_script_list_enable_content":"Scripts need to be enabled to be used. Page scripts are enabled by default upon installation, while background scripts are disabled by default.","guide_script_list_apply_to_run_status_title":"Apply to and Run Status","guide_script_list_apply_to_run_status_content":"The running status of scripts is displayed here. Hover over the tags to view the script type.","guide_script_list_sort_title":"Sort/Last Update/Actions","guide_script_list_sort_content":"You can drag the tags of scripts to sort them. Clicking on the \\"Last Update\\" column label will check for updates once. The \\"Actions\\" column allows you to enter script editing, control script running/stopping (for background scripts), and configure <Link href=\\"https://docs.scriptcat.org/docs/dev/config/\\">UserConfig</Link>.","guide_tools_title":"Common Tools","guide_tools_content":"The tools provide backup and development features.","guide_tools_backup_title":"Backup","guide_tools_backup_content":"Backup allows you to save scripts to avoid loss. You can export script files to your local machine or load script files from your local machine. You can also back up to the cloud for added convenience.","guide_setting_title":"Settings","guide_setting_content":"The settings mainly include language, script synchronization, update frequency, and other common options.","guide_setting_sync_title":"Update and Sync","guide_setting_sync_content":"The script synchronization feature allows you to easily sync the script content of this device to the cloud. If you select the option to sync deletions, when a script is deleted on this device, it will also be deleted from the cloud. You can also update the script version here to get more powerful features.","auto":"Auto","hide":"Hide","resize_column_width":"Resize Column","collapse":"Collapse","expand":"Expand","menu_expand_num_before":"Menu item more than","menu_expand_num_after":"Auto-hide."}'),Qe=JSON.parse('{"import_link":"Nhập Liên Kết","import_link_failure":"Nhập Link Thất Bại","create_user_script":"Tạo Script Người Dùng","create_background_script":"Tạo Script Nền","create_scheduled_script":"Tạo Script Theo Lịch","import_by_local":"Nhập Từ Local","import_local_failure":"Nhập Local Thất Bại","import_local_success":"Nhập Local Thành Công","create_script":"Tạo Script","user_guide":"Hướng Dẫn Sử Dụng","api_docs":"Tài Liệu Api","development_guide":"Hướng Dẫn Phát Triển","script_gallery":"Thư Viện Script","community_forum":"Diễn Đàn Cộng Đồng","external_links":"Liên Kết Bên Ngoài","system_follow":"Theo Dõi Hệ Thống","no_data":"Không Có Dữ Liệu","installed_scripts":"Script Đã Cài Đặt","subscribe":"Đăng Ký","logs":"Logs","tools":"Công Cụ","settings":"Cài Đặt","collapsible":"Thu Gọn Được","guide":"Hướng Dẫn","helpcenter":"Trung Tâm Trợ Giúp","general":"Chung","language":"Ngôn Ngữ","help_translate":"Giúp Chúng Tôi Dịch","script_sync":"Đồng Bộ Script","sync_delete":"Đồng Bộ Xóa","enable_script_sync_to":"Bật Đồng Bộ Script Đến","save":"Lưu","cloud_sync_account_verification":"Đang Xác Minh Tài Khoản Đồng Bộ Cloud...","cloud_sync_verification_failed":"Xác Minh Tài Khoản Đồng Bộ Cloud Thất Bại","save_success":"Lưu Thành Công","update":"Cập Nhật","check_update":"Kiểm Tra Cập Nhật","script_subscription_check_interval":"Khoảng Thời Gian Kiểm Tra Cập Nhật Script/Đăng Ký","never":"Không Bao Giờ","6_hours":"6 Giờ","12_hours":"12 Giờ","every_day":"Mỗi Ngày","every_week":"Mỗi Tuần","update_disabled_scripts":"Cập Nhật Script Bị Vô Hiệu Hóa","silent_update_non_critical_changes":"Tự Động Cập Nhật Thay Đổi Không Quan Trọng","enable_eslint":"Bật Eslint","eslint_rules":"Quy Tắc Eslint","enter_eslint_rules":"Vui Lòng Nhập Quy Tắc Eslint, Cấu Hình Có Thể Được Tải Xuống Từ https://eslint.org/play/","language_change_tip":"Thay Đổi Ngôn Ngữ Thành Công","backup":"Sao Lưu","local":"Local","export_file":"Xuất File","import_file":"Nhập File","cloud":"Cloud","backup_to":"Sao Lưu Đến","preparing_backup":"Đang Chuẩn Bị Sao Lưu Lên Cloud","backup_success":"Sao Lưu Thành Công","backup_failed":"Sao Lưu Thất Bại","no_backup_files":"Không Có File Sao Lưu","backup_list":"Danh Sách Sao Lưu","open_backup_dir":"Mở Thư Mục Sao Lưu","confirm_delete":"Xác Nhận Xóa","confirm_delete_backup_file":"Xác Nhận Xóa File Sao Lưu","confirm_update":"Xác Nhận Cập Nhật","delete_success":"Xóa Thành Công","backup_strategy":"Chiến Lược Sao Lưu","under_construction":"Đang Xây Dựng","development_debugging":"Gỡ Bỏ Sự Cố Trong Quá Trình Phát Triển","vscode_url":"Url Vscoode","auto_connect_vscode_service":"Tự Động Kết Nối Dịch Vụ Vscoode","connect":"Kết Nối","connection_success":"Kết Nối Thành Công","connection_failed":"Kết Nối Thất Bại","select_import_script":"Vui Lòng Chọn Script Cần Nhập Trong Trang Mới","import_error":"Lỗi Nhập","pulling_data_from_cloud":"Đang Lấy Dữ Liệu Từ Cloud","pull_failed":"Lấy Dữ Liệu Thất Bại","restore":"Khôi Phục","log_title":"Logs Thời Gian Chạy","last_5_minutes":"5 Phút Gần Nhất","last_15_minutes":"15 Phút Gần Nhất","last_30_minutes":"30 Phút Gần Nhất","last_1_hour":"1 Giờ Gần Nhất","last_3_hours":"3 Giờ Gần Nhất","last_6_hours":"6 Giờ Gần Nhất","last_12_hours":"12 Giờ Gần Nhất","last_24_hours":"24 Giờ Gần Nhất","last_7_days":"7 Ngày Gần Nhất","query":"Truy Vấn","labels":"Nhãn","search_regex":"Tìm Kiếm (Hỗ Trợ Regex)","clean_schedule":"Dọn Dẹp Lịch Trình","days_ago_logs":"Logs Của {{days}} Ngày Trước","delete_completed":"Xóa Hoàn Thành","delete_current_logs":"Xóa Logs Hiện Tại","clear_completed":"Đang Xóa Hoàn Thành","clear_logs":"Xóa Logs","total_logs":"Tổng Cộng {{length}} Logs Đã Được Truy Vấn","filtered_logs":"{{length}} Logs Sau Khi Lọc","enter_filter_conditions":"Vui Lòng Nhập Điều Kiện Lọc Để Truy Vấn","permission":"Quyền","enter_subscribe_name":"Vui Lòng Nhập Tên Đăng Ký","subscribe_url":"Url Đăng Ký","confirm_delete_subscription":"Bạn Có Chắc Chắn Muốn Xóa Đăng Ký Này Không? Các Script Liên Quan Cũng Sẽ Bị Xóa","list":{"confirm_delete":"Bạn Có Chắc Chắn Muốn Xóa Không? Xin Lưu Ý Rằng Điều Này Và Dán Vào Phần Văn Bản Còn Lại.","confirm_update":"Bạn Có Chắc Chắn Muốn Cập Nhật Không? Xin Lưu Ý Rằng Đây Là Một Thao Tác Không Thể Hoàn Tác."},"enable":"Bật","script_list_enable_width":120,"script_list_last_updated_width":140,"script_list_apply_to_run_status_width":160,"subscribe_list_enable_width":120,"disable":"Tắt","name":"Tên","version":"Phiên Bản","apply_to_run_status":"Áp Dụng Cho/Trạng Thái Chạy","source":"Nguồn","home":"Trang Chủ","sorting":"Sắp Xếp","last_updated":"Cập Nhật Cuối Cùng","action":"Hành Động","foreground_page_script_tooltip":"Script Trang Tiền Cảnh, Chạy Trên Trang Được Chỉ Định","background_script_tooltip":"Script Nền, Chạy Trên Trang Được Chỉ Định","scheduled_script_tooltip":"Script Theo Lịch, Thời Gian Chạy Tiếp Theo:","running":"Đang Chạy","completed":"Hoàn Thành","subscription_link":"Liên Kết Đăng Ký","subscription_installation":"Cài Đặt Đăng Ký","manually_created":"Local","script_link":"Liên Kết Script","user_installation":"Cài Đặt","confirm_delete_script":"Bạn Có Chắc Chắn Muốn Xóa Script Này Không?","delete_failed":"Xóa Thất Bại","enter_script_name":"Vui Lòng Nhập Tên Script","update_not_supported":"Script Này Không Hỗ Trợ Kiểm Tra Cập Nhật","checking_for_updates":"Đang Kiểm Tra Cập Nhật...","new_version_available":"Có Phiên Bản Mới","latest_version":"Phiên Bản Mới Nhất","checked_for_all_selected":"Đã Kiểm Tra Cập Nhật Cho Tất Cả Các Mục Đã Chọn","update_check_failed":"Kiểm Tra Cập Nhật Thất Bại","stopping_script":"Đang Dừng Script","script_stopped":"Script Đã Dừng","starting_script":"Đang Khởi Động Script...","starting_updates":"Đang Bắt Đầu Cập Nhật Hàng Loạt...","script_started":"Script Đã Khởi Động","batch_operations":"Thao Tác Hàng Loạt","export":"Xuất","delete":"Xóa","unknown_operation":"Thao Tác Không Xác Định","confirm":"Xác Nhận","close":"Đóng","page_script":"Script Trang","homepage":"Trang Chủ","script_website":"Website Script","script_source":"Mã Nguồn Script","bug_feedback_script_support":"Phản Hồi Lỗi/Hỗ Trợ Script","config":"Cấu Hình","key":"Khóa","value":"Giá Trị","add":"Thêm","type":"Kiểu","edit_value":"Chỉnh Sửa Giá Trị","add_value":"Thêm Giá Trị","update_success":"Cập Nhật Thành Công","add_success":"Thêm Thành Công","script_storage":"Bộ Nhớ Script","enter_key":"Vui Lòng Nhập Khóa","key_placeholder":"Khóa","value_placeholder":"Khi Kiểu Là Object, Vui Lòng Nhập Dữ Liệu Có Thể Được Giải Mã JSON","clear":"Xóa","clear_success":"Xóa Thành Công","confirm_clear":"Bạn Có Chắc Chắn Muốn Xóa Không Gian Lưu Trữ Này Không?","type_string":"Chuỗi","type_number":"Số","type_boolean":"Boolean","type_object":"Đối Tượng","confirm_delete_resource":"Bạn Có Chắc Chắn Muốn Xóa Tài Nguyên Này Không? Tài Nguyên Này Sẽ Được Tải Lại Ở Lần Khởi Động Tiếp Theo","confirm_clear_resource":"Bạn Có Chắc Chắn Muốn Xóa Các Tài Nguyên Này Không? Tài Nguyên Sẽ Được Tải Lại Ở Lần Khởi Động Tiếp Theo","script_resource":"Tài Nguyên Script","permission_value":"Giá Trị Ủy Quyền","allow":"Cho Phép","yes":"Có","no":"Không","confirm_delete_permission":"Xác Nhận Xóa Ủy Quyền Này?","script_setting":"Cài Đặt Script","basic_info":"Thông Tin Cơ Bản","update_url":"Url Cập Nhật","permission_management":"Quản Lý Quyền","add_permission":"Thêm Quyền","permission_cors":"Chống Giả Mạo Nguồn Gốc (cors)","permission_cookie":"Quản Lý Cookie","match":"Phù Hợp","user_setting":"Cài Đặt Người Dùng","confirm_delete_exclude":"Xác Nhận Xóa Loại Trừ Này?","after_deleting_match_item":"Sau Khi Các Mục Phù Hợp Của Script Được Xóa, Chúng Sẽ Được Tự Động Thêm Vào Các Mục Phù Hợp","confirm_delete_match":"Xác Nhận Xóa Phù Hợp Này?","after_deleting_exclude_item":"Sau Khi Xóa Mục Phù Hợp Của Script, Nó Sẽ Được Tự Động Thêm Vào Các Mục Loại Trừ","add_match":"Thêm Phù Hợp","add_exclude":"Thêm Loại Trừ","website_match":"Phù Hợp Website (@match)","reset":"Đặt Lại","website_exclude":"Loại Trừ Website (@exclude)","confirm_reset":"Xác Nhận Đặt Lại?","script_total_runs":"Script Đã Chạy {{runNum}} Lần, {{runNumByIframe}} Lần Trong Iframe","script_total_runs_single":"Script Đã Chạy {{runNum}} Lần","script_disabled":"Script Đang Bị Vô Hiệu Hóa","run_once":"Chạy Một Lần","stop":"Dừng","edit":"Chỉnh Sửa","exclude_on":"Loại Trừ Bật","exclude_off":"Loại Trừ Tắt","exclude_execution":"Loại Trừ Thực Thi","user_config":"Cấu Hình Người Dùng","gm_api":"Gm Api","storage_api":"Storage Api","use_file_system":"Hệ Thống File Đang Sử Dụng","open_directory":"Mở Thư Mục","account_validation_failed":"Xác Thực Tài Khoản Thất Bại","not_set":"Chưa Thiết Lập","in_use":"Đang Sử Dụng","storage_error":"Lỗi Bộ Nhớ","upload_to_cloud":"Tải Lên Cloud","save_failed":"Lưu Thất Bại","exporting":"Đang Xuất...","upload_to":"Tải Lên","value_export_expression":"Biểu Thức Xuất Giá Trị","overwrite_original_value_on_import":"Ghi Đè Giá Trị Gốc Khi Nhập","cookie_export_expression":"Biểu Thức Xuất Cookie","overwrite_original_cookie_on_import":"Ghi Đè Cookie Gốc Khi Nhập","restore_default_values":"Khôi Phục Giá Trị Mặc Định","get_confirm_error":"Lấy Thông Tin Xác Nhận Thất Bại","confirm_error":"Xác Nhận Thất Bại","ignore":"Bỏ Qua","allow_once":"Cho Phép Một Lần","temporary_allow":"Cho Phép Tạm Thời {{permissionContent}} Này","temporary_allow_all":"Cho Phép Tạm Thời Tất Cả {{permissionContent}}","permanent_allow":"Cho Phép Vĩnh Viễn {{permissionContent}} Này","permanent_allow_all":"Cho Phép Vĩnh Viễn Tất Cả {{permissionContent}}","deny_once":"Từ Chối Một Lần","temporary_deny":"Từ Chối Tạm Thời {{permissionContent}} Này","temporary_deny_all":"Từ Chối Tạm Thời Tất Cả {{permissionContent}}","permanent_deny":"Từ Chối Vĩnh Viễn {{permissionContent}} Này","permanent_deny_all":"Từ Chối Vĩnh Viễn Tất Cả {{permissionContent}}","data_import":"Nhập Dữ Liệu","import":"Nhập","select_scripts_to_import":"Vui Lòng Chọn Script Bạn Muốn Nhập","select_all":"Chọn Tất Cả","script_import_progress":"Tiến Trình Nhập Script","select_subscribes_to_import":"Vui Lòng Chọn Các Đăng Ký Bạn Muốn Nhập","subscribe_import_progress":"Tiến Trình Nhập Đăng Ký","author":"Tác Giả","description":"Mô Tả","operation":"Thao Tác","error":"Lỗi","unknown":"Không Xác Định","add_new":"Thêm Mới","no_operation":"Không Có Thao Tác","enable_script":"Bật Script","local_creation":"Tạo Local","import_success":"Nhập Thành Công","install_script":"Cài Đặt Script","update_script":"Cập Nhật Script","install_subscribe":"Cài Đặt Đăng Ký","update_subscribe":"Cập Nhật Đăng Ký","invalid_link":"Liên Kết Không Hợp Lệ","subscribe_install_label":"Đăng Ký Này Sẽ Cài Đặt Các Script Sau","script_runs_in":"Script Sẽ Chạy Trên Các Website Sau","script_has_full_access_to":"Script Sẽ Có Quyền Truy Cập Đầy Đủ Vào Các Url Sau","script_requires":"Script Cần Các Tài Nguyên Bên Ngoài Sau","cookie_warning":"Xin Lưu Ý, Script Này Yêu Cầu Truy Cập Vào Quyền Cookie, Đây Là Một Quyền Nguy Hiểm. Vui Lòng Xác Minh Sự An Toàn Của Script.","scheduled_script_description_1":"Đây Là Một Script Theo Lịch Trình, Sẽ Tự Động Chạy Vào Một Thời Gian Cụ Thể Sau Khi Được Bật Và Có Thể Được Điều Khiển Thủ Công Trong Bảng Điều Khiển.","scheduled_script_description_2":"Biểu Thức Nhiệm Vụ Theo Lịch Trình: {{expression}}, Thời Gian Chạy Gần Nhất: {{time}}","background_script_description":"Đây Là Một Script Nền, Sẽ Tự Động Chạy Một Lần Khi Trình Duyệt Mở Sau Khi Được Bật, Và Có Thể Được Điều Khiển Thủ Công Trong Bảng Điều Khiển.","install_success":"Cài Đặt Thành Công","install":{"update_success":"Cập Nhật Thành Công"},"install_failed":"Cài Đặt Thất Bại","subscribe_success":"Đăng Ký Thành Công","subscribe_failed":"Đăng Ký Thất Bại","current_version":"Phiên Bản Hiện Tại","update_version":"Phiên Bản Cập Nhật","background_script_tag":"Đây Là Một Script Nền","scheduled_script_tag":"Đây Là Một Script Theo Lịch Trình","background_script":"Script Nền","scheduled_script":"Script Theo Lịch Trình","install_from_legitimate_sources_warning":"Vui Lòng Cài Đặt Script Từ Nguồn Uy Tín! Script Không Rõ Nguồn Gốc Có Thể Xâm Phạm Quyền Riêng Tư Của Bạn Hoặc Thực Hiện Các Thao Tác Có Hại.","antifeature_referral_link_title":"Liên Kết Giới Thiệu","antifeature_referral_link_description":"Script Này Sửa Đổi Hoặc Chuyển Hướng Đến Liên Kết Giới Thiệu Của Tác Giả","antifeature_ads_title":"Quảng Cáo","antifeature_ads_description":"Script Này Chèn Quảng Cáo Vào Các Trang Bạn Truy Cập","antifeature_payment_title":"Thanh Toán","antifeature_payment_description":"Script Này Yêu Cầu Thanh Toán Để Sử Dụng Đúng Cách","antifeature_miner_title":"Đào Tiền Ảo","antifeature_miner_description":"Script Này Tham Gia Hoạt Động Đào Tiền Ảo","antifeature_membership_title":"Tính Năng Thành Viên","antifeature_membership_description":"Script Này Yêu Cầu Đăng Ký Làm Thành Viên Để Sử Dụng Đúng Cách","antifeature_tracking_title":"Theo Dõi","antifeature_tracking_description":"Script Này Theo Dõi Thông Tin Người Dùng Của Bạn","script_info_load_failed":"Thất Bại Khi Tải Thông Tin Script","script_status_tooltip":"Bạn Có Thể Điều Khiển Trạng Thái Mở Của Script. Các Script Oil Monkey Thông Thường Được Bật Mặc Định, Và Script Nền Và Script Theo Lịch Trình Được Tắt Mặc Định.","get_script":"Lấy Script","report_issue":"Báo Cáo Sự Cố","project_docs":"Tài Liệu Dự Án","community":"Cộng Đồng","popup":{"new_version_available":"Có Phiên Bản Mới"},"current_page_scripts":"Script Đang Chạy Trên Trang Hiện Tại","enabled_background_scripts":"Script Nền Đã Bật Và Đang Chạy","script_accessing_cross_origin_resource":"Script Đang Thử Truy Cập Tài Nguyên Từ Nguồn Gốc Khác","confirm_operation_description":"Vui Lòng Xác Nhận Nếu Bạn Cho Phép Script Thực Hiện Thao Tác Này. Script Cũng Có Thể Thêm Thẻ @connect Để Bỏ Qua Tùy Chọn Này.","domain":"Tên Miền","script_name":"Tên Script","request_domain":"Tên Miền Yêu Cầu","request_url":"Url Yêu Cầu","access_cookie_content":"Script Đang Thử Truy Cập Nội Dung Cookie Của Website","confirm_script_operation":"Vui Lòng Xác Nhận Nếu Bạn Cho Phép Script Thực Hiện Thao Tác Này. Cookie Chứa Dữ Liệu Quan Trọng Của Người Dùng, Vì Vậy Chỉ Cấp Quyền Truy Cập Cho Các Script Uy Tín.","cookie_domain":"Tên Miền Cookie","script_operation_title":"Script Đang Thử Truy Cập Bộ Nhớ Đồng Bộ Script","script_operation_description":"Vui Lòng Xác Nhận Nếu Bạn Cho Phép Script Thực Hiện Thao Tác Này. Nếu Được Cho Phép, Script Sẽ Có Thể Truy Cập Vào Không Gian Lưu Trữ Mà Bạn Đã Thiết Lập Và Tạo Một Thư Mục app/${dir} Bên Trong Nó.","script_permission_content":"Script","sync_system_connect_failed":"Kết Nối Hệ Thống Đồng Bộ Thất Bại","sync_system_closed":"Đồng Bộ Tắt","sync_system_closed_description":"Đồng Bộ Đã Bị Vô Hiệu Hóa, Vui Lòng Cấu Hình Lại","auth_type":"Kiểu Xác Thực","url":"Url","username":"Tên Người Dùng","password":"Mật Khẩu","skip":"Bỏ Qua","next":"Tiếp Theo","back":"Quay Lại","last":"Hoàn Tất","start_guide_title":"Chào Mừng Đến Với Phần Mở Rộng Scriptcat","start_guide_content":"Tiếp Theo, Chúng Tôi Sẽ Giới Thiệu Cách Sử Dụng Cơ Bản Của Scriptcat Cho Bạn.","guide_installed_scripts":"Các Script Bạn Đã Cài Đặt Sẽ Được Hiển Thị Ở Đây.","guide_script_list_title":"Chợ Script","guide_script_list_content":"Bạn Có Thể Cài Đặt Script Từ <Link href=\\"https://scriptcat.org/search\\">Chợ Script</Link>. Ngoài Việc Hỗ Trợ Script Người Dùng, Scriptcat Còn Hỗ Trợ <Link href=\\"https://docs.scriptcat.org/docs/dev/backgroud/\\">Script Nền</Link>.","guide_script_list_enable_title":"Bật Script","guide_script_list_enable_content":"Script Cần Được Bật Để Sử Dụng. Script Trang Được Bật Mặc Định Khi Cài Đặt, Trong Khi Script Nền Được Tắt Mặc Định.","guide_script_list_apply_to_run_status_title":"Áp Dụng Cho Và Trạng Thái Chạy","guide_script_list_apply_to_run_status_content":"Trạng Thái Chạy Của Script Được Hiển Thị Ở Đây. Di Chuột Lên Trên Thẻ Để Xem Kiểu Script.","guide_script_list_sort_title":"Sắp Xếp/Cập Nhật Cuối Cùng/Hành Động","guide_script_list_sort_content":"Bạn Có Thể Kéo Thẻ Của Script Để Sắp Xếp Chúng. Nhấp Vào Nhãn Cột \\"Cập Nhật Cuối Cùng\\" Sẽ Kiểm Tra Cập Nhật Một Lần. Cột \\"Hành Động\\" Cho Phép Bạn Vào Chỉnh Sửa Script, Điều Khiển Script Chạy/Dừng (Đối Với Script Nền), Và Cấu Hình <Link href=\\"https://docs.scriptcat.org/docs/dev/config/\\">Userconfig</Link>.","guide_tools_title":"Công Cụ Thông Dụng","guide_tools_content":"Các Công Cụ Cung Cấp Các Tính Năng Sao Lưu Và Phát Triển.","guide_tools_backup_title":"Sao Lưu","guide_tools_backup_content":"Sao Lưu Cho Phép Bạn Lưu Script Để Tránh Mất Mát. Bạn Có Thể Xuất File Script Vào Máy Tính Của Bạn Hoặc Tải File Script Từ Máy Tính Của Bạn. Bạn Cũng Có Thể Sao Lưu Lên Cloud Để Tiện Lợi Hơn.","guide_setting_title":"Cài Đặt","guide_setting_content":"Cài Đặt Chủ Yếu Bao Gồm Ngôn Ngữ, Đồng Bộ Script, Tần Suất Cập Nhật Và Các Tùy Chọn Thông Dụng Khác.","guide_setting_sync_title":"Cập Nhật Và Đồng Bộ","guide_setting_sync_content":"Tính Năng Đồng Bộ Script Cho Phép Bạn Dễ Dàng Đồng Bộ Nội Dung Script Của Thiết Bị Này Lên Cloud. Nếu Bạn Chọn Tùy Chọn Đồng Bộ Xóa, Khi Một Script Được Xóa Trên Thiết Bị Này, Nó Cũng Sẽ Được Xóa Khỏi Cloud. Bạn Cũng Có Thể Cập Nhật Phiên Bản Script Ở Đây Để Có Được Các Tính Năng Mạnh Mẽ Hơn.","auto":"Tự Động","hide":"Ẩn","resize_column_width":"Điều Chỉnh Kích Thước Cột","collapse":"Thu Gọn","expand":"Mở Rộng","menu_expand_num_before":"Mục Menu Hơn","menu_expand_num_after":"Tự Ẩn."}'),Ye=JSON.parse('{"import_link":"链接导入","import_link_failure":"链接导入失败","create_user_script":"新建普通脚本","create_background_script":"新建后台脚本","create_scheduled_script":"新建定时脚本","import_by_local":"本地导入","import_local_failure":"本地导入失败","import_local_success":"本地导入成功","create_script":"新建脚本","user_guide":"使用指南","api_docs":"API文档","development_guide":"开发指南","script_gallery":"脚本站","community_forum":"社区论坛","external_links":"外部链接","system_follow":"跟随系统","no_data":"暂无数据","installed_scripts":"已安装脚本","subscribe":"订阅","logs":"日志","tools":"工具","settings":"设置","collapsible":"收起侧边栏","guide":"新手指引","helpcenter":"帮助中心","general":"通用","language":"语言","help_translate":"协助翻译","script_sync":"脚本同步","sync_delete":"同步删除","enable_script_sync_to":"启用脚本同步至","save":"保存","cloud_sync_account_verification":"云同步账号信息验证中...","cloud_sync_verification_failed":"云同步账号信息验证失败","save_success":"保存成功","update":"更新","check_update":"检查更新","script_subscription_check_interval":"脚本/订阅检查更新间隔","never":"从不","6_hours":"6小时","12_hours":"12小时","every_day":"每天","every_week":"每周","update_disabled_scripts":"更新已禁用脚本","silent_update_non_critical_changes":"非重要变更静默更新脚本","enable_eslint":"开启 ESLint","eslint_rules":"ESLint规则","enter_eslint_rules":"请输入 ESLint 规则，可以从 https://eslint.org/play/ 下载配置","language_change_tip":"语言切换成功","backup":"备份","local":"本地","export_file":"导出文件","import_file":"导入文件","cloud":"云端","backup_to":"备份至","preparing_backup":"正在准备备份到云端","backup_success":"备份成功","backup_failed":"备份失败","no_backup_files":"没有备份文件","backup_list":"备份列表","open_backup_dir":"打开备份目录","confirm_delete":"确认删除","confirm_delete_backup_file":"确认删除备份文件","confirm_update":"确认更新","delete_success":"删除成功","backup_strategy":"备份策略","under_construction":"建设中","development_debugging":"开发调试","vscode_url":"VSCode地址","auto_connect_vscode_service":"自动连接vscode服务","connect":"连接","connection_success":"连接成功","connection_failed":"连接失败","select_import_script":"请在新页面中选择要导入的脚本","import_error":"导入错误","pulling_data_from_cloud":"正在从云端拉取数据","pull_failed":"拉取失败","restore":"恢复","log_title":"运行日志","last_5_minutes":"最近5分钟","last_15_minutes":"最近15分钟","last_30_minutes":"最近30分钟","last_1_hour":"最近1小时","last_3_hours":"最近3小时","last_6_hours":"最近6小时","last_12_hours":"最近12小时","last_24_hours":"最近24小时","last_7_days":"最近7天","query":"查询","labels":"labels","search_regex":"搜索(支持正则)","clean_schedule":"定时清理","days_ago_logs":"天前的日志","delete_completed":"删除完成","delete_current_logs":"删除当前日志","clear_completed":"清空完成","clear_logs":"清空日志","total_logs":"共查询到 {{length}} 条日志","filtered_logs":"筛选后 {{length}} 条日志","enter_filter_conditions":"请输入筛选条件进行查询","permission":"权限","enter_subscribe_name":"请输入订阅名称","subscribe_url":"订阅地址","confirm_delete_subscription":"确定要删除此订阅吗? 相关的脚本也会被删除","list":{"confirm_delete":"确定要删除吗？请注意这个操作无法恢复！","confirm_update":"确认要更新吗？请注意此操作不可逆！"},"enable":"开启","script_list_enable_width":100,"script_list_last_updated_width":120,"script_list_apply_to_run_status_width":140,"subscribe_list_enable_width":100,"disable":"关闭","name":"名称","version":"版本","apply_to_run_status":"应用至/运行状态","source":"来源","home":"主页","sorting":"排序","last_updated":"最后更新","action":"操作","foreground_page_script_tooltip":"前台页面脚本，会在指定的页面上运行","background_script_tooltip":"后台脚本，会在指定的页面上运行","scheduled_script_tooltip":"定时脚本，下一次运行时间：","running":"运行中","completed":"运行完毕","subscription_link":"订阅链接","subscription_installation":"订阅安装","manually_created":"手动新建","script_link":"脚本链接","user_installation":"用户安装","confirm_delete_script":"确定要删除此脚本吗？","delete_failed":"删除失败","enter_script_name":"请输入脚本名","update_not_supported":"该脚本不支持检查更新","checking_for_updates":"检查更新中...","new_version_available":"存在新版本","latest_version":"已是最新版本","checked_for_all_selected":"所选脚本皆已检查更新","update_check_failed":"检查更新失败","stopping_script":"正在停止脚本","script_stopped":"脚本已停止","starting_script":"正在启动脚本...","starting_updates":"正在批量更新...","script_started":"脚本已启动","batch_operations":"批量操作","export":"导出","delete":"删除","unknown_operation":"未知操作","confirm":"确定","close":"关闭","page_script":"页面脚本","homepage":"脚本主页","script_website":"脚本站点","script_source":"脚本源码","bug_feedback_script_support":"BUG反馈/脚本支持站点","config":"配置","key":"key","value":"value","add":"新增","type":"类型","edit_value":"编辑值","add_value":"新增值","update_success":"修改成功","add_success":"添加成功","script_storage":"脚本储存","enter_key":"请输入key","key_placeholder":"key","value_placeholder":"当类型为object时，请输入可以JSON解析的数据","clear":"清空","clear_success":"清空成功","confirm_clear":"你真的要清空这个储存空间吗?","type_string":"string","type_number":"number","type_boolean":"boolean","type_object":"object","confirm_delete_resource":"你确定删除此资源吗？在下次开启时将会重新加载此资源","confirm_clear_resource":"你真的要清空这些资源吗？在下次开启时将会重新加载资源","script_resource":"脚本资源","permission_value":"授权值","allow":"是否允许","yes":"是","no":"否","confirm_delete_permission":"确认删除该授权？","script_setting":"脚本设置","basic_info":"基本信息","update_url":"更新URL","permission_management":"授权管理","add_permission":"添加授权","permission_cors":"跨域(cors)","permission_cookie":"管理cookie","match":"匹配","user_setting":"用户设定","confirm_delete_exclude":"确认删除该排除？","after_deleting_match_item":"脚本设定的匹配项删除后会自动添加到匹配项中","confirm_delete_match":"确认删除该匹配？","after_deleting_exclude_item":"脚本设定的匹配项删除后会自动添加到排除项中","add_match":"添加匹配","add_exclude":"添加排除","website_match":"网站匹配(@match)","reset":"重置","website_exclude":"网站排除(@exclude)","confirm_reset":"确定重置？","script_total_runs":"该脚本总共运行了{{runNum}}次，在iframe上运行了{{runNumByIframe}}次","script_total_runs_single":"该脚本运行了{{runNum}}次","script_disabled":"该脚本未开启","run_once":"运行一次","stop":"停止","edit":"编辑","exclude_on":"恢复在","exclude_off":"排除在","exclude_execution":"上执行","user_config":"用户配置","gm_api":"GM Api","storage_api":"Storage API","use_file_system":"使用的文件系统","open_directory":"打开目录","account_validation_failed":"账号信息验证失败","not_set":"未设置","in_use":"使用中","storage_error":"储存错误","upload_to_cloud":"上传至云","save_failed":"保存失败","exporting":"导出中...","upload_to":"上传至","value_export_expression":"值导出表达式","overwrite_original_value_on_import":"导入时覆盖原值","cookie_export_expression":"cookie导出表达式","overwrite_original_cookie_on_import":"导入时覆盖原值","restore_default_values":"恢复默认值","get_confirm_error":"获取确认信息失败","confirm_error":"确认失败","ignore":"忽略","allow_once":"允许一次","temporary_allow":"临时允许此{{permissionContent}}","temporary_allow_all":"临时允许全部{{permissionContent}}","permanent_allow":"永久允许此{{permissionContent}}","permanent_allow_all":"永久允许全部{{permissionContent}}","deny_once":"拒绝一次","temporary_deny":"临时拒绝此{{permissionContent}}","temporary_deny_all":"临时拒绝全部{{permissionContent}}","permanent_deny":"永久拒绝此{{permissionContent}}","permanent_deny_all":"永久拒绝全部{{permissionContent}}","data_import":"数据导入","import":"导入","select_scripts_to_import":"请选择你要导入的脚本","select_all":"全选","script_import_progress":"脚本导入进度","select_subscribes_to_import":"请选择你要导入的订阅","subscribe_import_progress":"订阅导入进度","author":"作者","description":"描述","operation":"操作","error":"错误","unknown":"未知","add_new":"新增","no_operation":"不做操作","enable_script":"开启脚本","local_creation":"本地创建","import_success":"导入成功","install_script":"安装","update_script":"更新","install_subscribe":"安装订阅","update_subscribe":"更新订阅","invalid_link":"错误的链接","subscribe_install_label":"该订阅将会安装下面的脚本","script_runs_in":"脚本将在下面的网站中运行","script_has_full_access_to":"脚本将获得以下地址的完整访问权限","script_requires":"脚本引用了下列外部资源","cookie_warning":"请注意，本脚本会申请 Cookie 的操作权限，这是一个危险的权限，请确认脚本的安全性。","scheduled_script_description_1":"这是一个定时脚本，启用后将在特定时间自动运行，并可在面板中手动控制。","scheduled_script_description_2":"定时任务表达式：{{expression}}，最近一次运行时间：{{time}}","background_script_description":"这是一个后台脚本，启用后将在浏览器打开时自动运行一次，并可在面板中手动控制。","install_success":"安装成功","install":{"update_success":"更新成功"},"install_failed":"安装失败","subscribe_success":"订阅成功","subscribe_failed":"订阅失败","current_version":"当前版本","update_version":"更新版本","background_script_tag":"这是一个后台脚本","scheduled_script_tag":"这是一个定时脚本","background_script":"后台脚本","scheduled_script":"定时脚本","install_from_legitimate_sources_warning":"请从合法来源安装脚本！未知的脚本可能会侵犯您的隐私或者做出恶意的操作！","antifeature_referral_link_title":"推荐链接","antifeature_referral_link_description":"该脚本会修改或重定向到作者的返佣链接","antifeature_ads_title":"附带广告","antifeature_ads_description":"该脚本会在你访问的页面上插入广告","antifeature_payment_title":"付费脚本","antifeature_payment_description":"该脚本需要你付费才能够正常使用","antifeature_miner_title":"挖矿","antifeature_miner_description":"该脚本存在挖矿行为","antifeature_membership_title":"会员功能","antifeature_membership_description":"该脚本需要注册会员才能正常使用","antifeature_tracking_title":"信息追踪","antifeature_tracking_description":"该脚本会追踪你的用户信息","script_info_load_failed":"脚本信息加载失败！","script_status_tooltip":"可以控制脚本开启状态，普通油猴脚本默认开启，后台脚本、定时脚本默认关闭","get_script":"获取脚本","report_issue":"BUG/问题反馈","project_docs":"项目文档","community":"交流社区","popup":{"new_version_available":"有新版本可用"},"current_page_scripts":"当前页运行脚本","enabled_background_scripts":"开启和运行的后台脚本","script_accessing_cross_origin_resource":"脚本正在试图访问跨域资源","confirm_operation_description":"请您确认是否允许脚本进行此操作,脚本也可增加@connect标签跳过此选项","domain":"域名","script_name":"脚本名称","request_domain":"请求域名","request_url":"请求地址","access_cookie_content":"脚本正在试图访问网站cookie内容","confirm_script_operation":"请您确认是否允许脚本进行此操作，cookie是一项重要的用户数据，请务必只给信任的脚本授权.","cookie_domain":"Cookie域","script_operation_title":"脚本正在试图操作脚本同步储存空间","script_operation_description":"请您确认是否允许脚本进行此操作，允许后将允许脚本操作你设定的储存空间，脚本会在储存空间下创建一个app/${dir}的目录进行使用","script_permission_content":"脚本","sync_system_connect_failed":"同步系统连接失败","sync_system_closed":"已关闭同步","sync_system_closed_description":"同步功能已关闭，请重新配置","auth_type":"鉴权类型","url":"URL","username":"用户名","password":"密码","skip":"跳过","next":"下一步","back":"上一步","last":"完成","start_guide_title":"欢迎使用脚本猫扩展","start_guide_content":"接下来我们将为您介绍脚本猫的基本使用方法","guide_installed_scripts":"你所安装的脚本将会在这里显示","guide_script_list_title":"脚本市场","guide_script_list_content":"可以从<Link href=\\"https://scriptcat.org/search\\">脚本市场</Link>中安装脚本，脚本猫除了支持用户脚本以外，还支持<Link href=\\"https://docs.scriptcat.org/docs/dev/backgroud/\\">后台脚本</Link>","guide_script_list_enable_title":"脚本开启","guide_script_list_enable_content":"脚本需要开启才能使用，页面脚本安装默认开启，后台脚本安装默认关闭","guide_script_list_apply_to_run_status_title":"应用至、与运行状态","guide_script_list_apply_to_run_status_content":"脚本运行状态展示，鼠标悬浮至标签可以查看脚本类型","guide_script_list_sort_title":"排序/最后更新/操作","guide_script_list_sort_content":"你可以拖动脚本的标签进行排序，点击最后更新列标签可以对脚本进行一次检查更新，操作列可以进入脚本编辑、控制脚本的运行停止（后台脚本）、设置<Link href=\\"https://docs.scriptcat.org/docs/dev/config/\\">UserConfig</Link>","guide_tools_title":"常用工具","guide_tools_content":"工具中提供了备份和开发的工具","guide_tools_backup_title":"备份","guide_tools_backup_content":"备份可以保存脚本，避免丢失。可以导出脚本文件到本地，也可以加载本地的脚本文件。也可以备份到云端，更加方便。","guide_setting_title":"设置","guide_setting_content":"设置中主要包含了语言、脚本同步、更新频率等常用设置项","guide_setting_sync_title":"更新与同步","guide_setting_sync_content":"脚本同步功能可以方便的将本设备的脚本内容同步至云端，如果有多台设备请勾选同步删除选项，当本设备脚本删除时，会从云端删除对应的脚本，也会将其它设备的脚本删除。","auto":"自动","hide":"隐藏","resize_column_width":"调整列宽","collapse":"收起","expand":"展开","menu_expand_num_before":"菜单项超过","menu_expand_num_after":"个时，自动隐藏"}'),$e=JSON.parse('{"import_link":"鏈接導入","import_link_failure":"鏈接導入失敗","create_user_script":"新建普通腳本","create_background_script":"新建後台腳本","create_scheduled_script":"新建定時腳本","import_by_local":"本地导入","import_local_failure":"本地导入失败","import_local_success":"本地导入成功","create_script":"新建腳本","user_guide":"使用指南","api_docs":"API文檔","development_guide":"開發指南","script_gallery":"腳本站","community_forum":"社區論壇","external_links":"外部鏈接","system_follow":"跟隨系統","no_data":"暫無數據","installed_scripts":"已安裝腳本","subscribe":"訂閱","logs":"日誌","tools":"工具","settings":"設置","collapsible":"收起側邊欄","guide":"新手指引","helpcenter":"幫助中心","general":"通用","language":"語言","help_translate":"協助翻譯","script_sync":"腳本同步","sync_delete":"同步刪除","enable_script_sync_to":"啟用腳本同步至","save":"保存","cloud_sync_account_verification":"雲同步帳號信息驗證中...","cloud_sync_verification_failed":"雲同步帳號信息驗證失敗","save_success":"保存成功","update":"更新","check_update":"檢查更新","script_subscription_check_interval":"腳本/訂閱檢查更新間隔","never":"從不","6_hours":"6小時","12_hours":"12小時","every_day":"每天","every_week":"每週","update_disabled_scripts":"更新已禁用腳本","silent_update_non_critical_changes":"非重要變更靜默更新腳本","enable_eslint":"開啟 ESLint","eslint_rules":"ESLint規則","enter_eslint_rules":"請輸入 ESLint 規則，可以從 https://eslint.org/play/ 下載配置","language_change_tip":"語言切換成功","backup":"備份","local":"本地","export_file":"導出文件","import_file":"導入文件","cloud":"雲端","backup_to":"備份至","preparing_backup":"正在準備備份到雲端","backup_success":"備份成功","backup_failed":"備份失敗","no_backup_files":"沒有備份文件","backup_list":"備份列表","open_backup_dir":"打開備份目錄","confirm_delete":"確認刪除","confirm_delete_backup_file":"確認刪除備份文件","confirm_update":"確認更新","delete_success":"刪除成功","backup_strategy":"備份策略","under_construction":"建設中","development_debugging":"開發調試","vscode_url":"VSCode地址","auto_connect_vscode_service":"自動連接vscode服務","connect":"連接","connection_success":"連接成功","connection_failed":"連接失敗","select_import_script":"請在新頁面中選擇要導入的腳本","import_error":"導入錯誤","pulling_data_from_cloud":"正在從雲端拉取數據","pull_failed":"拉取失敗","restore":"恢復","log_title":"運行日誌","last_5_minutes":"最近5分鐘","last_15_minutes":"最近15分鐘","last_30_minutes":"最近30分鐘","last_1_hour":"最近1小時","last_3_hours":"最近3小時","last_6_hours":"最近6小時","last_12_hours":"最近12小時","last_24_hours":"最近24小時","last_7_days":"最近7天","query":"查詢","labels":"Labels","search_regex":"搜索(支持正則)","clean_schedule":"定時清理","days_ago_logs":"天前的日誌","delete_completed":"刪除完成","delete_current_logs":"刪除當前日誌","clear_completed":"清空完成","clear_logs":"清空日誌","total_logs":"共查詢到 {{length}} 筆日誌","filtered_logs":"篩選後 {{length}} 條日誌","enter_filter_conditions":"請輸入篩選條件進行查詢","permission":"權限","enter_subscribe_name":"請輸入訂閱名稱","subscribe_url":"訂閱地址","confirm_delete_subscription":"確定要刪除此訂閱嗎？相關的腳本也會被刪除","list":{"confirm_delete":"確定要刪除嗎？請注意這個操作無法恢復！","confirm_update":"確認要更新嗎？請注意此操作不可逆！"},"enable":"開啟","script_list_enable_width":100,"script_list_last_updated_width":120,"script_list_apply_to_run_status_width":140,"subscribe_list_enable_width":100,"disable":"關閉","name":"名稱","version":"版本","apply_to_run_status":"應用至/運行狀態","source":"來源","home":"主頁","sorting":"排序","last_updated":"最後更新","action":"操作","foreground_page_script_tooltip":"前臺頁面腳本，會在指定的頁面上運行","background_script_tooltip":"後臺腳本，會在指定的頁面上運行","scheduled_script_tooltip":"定時腳本，下一次運行時間：","running":"運行中","completed":"運行完畢","subscription_link":"訂閱鏈接","subscription_installation":"訂閱安裝","manually_created":"手動新建","script_link":"腳本鏈接","user_installation":"用戶安裝","confirm_delete_script":"確定要刪除此腳本嗎？","delete_failed":"刪除失敗","enter_script_name":"請輸入腳本名","update_not_supported":"該腳本不支持檢查更新","checking_for_updates":"檢查更新中...","new_version_available":"存在新版本","latest_version":"已經是最新版本","checked_for_all_selected":"所選腳本皆已檢查更新","update_check_failed":"檢查更新失敗","stopping_script":"正在停止腳本","script_stopped":"腳本已停止","starting_script":"正在啟動腳本...","starting_updates":"正在批量更新...","script_started":"腳本已啟動","batch_operations":"批量操作","export":"導出","delete":"刪除","unknown_operation":"未知操作","confirm":"確定","close":"關閉","page_script":"頁面腳本","homepage":"腳本主頁","script_website":"腳本站點","script_source":"腳本源碼","bug_feedback_script_support":"BUG反饋/腳本支持站點","config":"配置","key":"key","value":"value","add":"新增","type":"類型","edit_value":"編輯值","add_value":"新增值","update_success":"修改成功","add_success":"添加成功","script_storage":"腳本儲存","enter_key":"請輸入key","key_placeholder":"key","value_placeholder":"當類型為object時，請輸入可以JSON解析的數據","clear":"清空","clear_success":"清除成功","confirm_clear":"你真的要清空這個儲存空間嗎?","type_string":"string","type_number":"number","type_boolean":"boolean","type_object":"object","confirm_delete_resource":"你確定刪除此資源嗎？在下次開啟時將會重新加載此資源","confirm_clear_resource":"你真的要清空這些資源嗎？在下次開啟時將會重新加載資源","script_resource":"腳本資源","permission_value":"授權值","allow":"是否允許","yes":"是","no":"否","confirm_delete_permission":"確認刪除該授權？","script_setting":"腳本設置","basic_info":"基本信息","update_url":"更新URL","permission_management":"授權管理","add_permission":"添加授權","permission_cors":"跨域(cors)","permission_cookie":"管理cookie","match":"匹配","user_setting":"用戶設定","confirm_delete_exclude":"確認刪除該排除？","after_deleting_match_item":"腳本設定的匹配項刪除後會自動添加到匹配項中","confirm_delete_match":"確認刪除該匹配？","after_deleting_exclude_item":"腳本設定的匹配項刪除後會自動添加到排除項中","add_match":"添加匹配","add_exclude":"添加排除","website_match":"網站匹配(@match)","reset":"重置","website_exclude":"網站排除(@exclude)","confirm_reset":"確定重置？","script_total_runs":"該腳本總共運行了{{runNum}}次，在iframe上運行了{{runNumByIframe}}次","script_total_runs_single":"該腳本運行了{{runNum}}次","script_disabled":"該腳本未開啟","run_once":"運行一次","stop":"停止","edit":"編輯","exclude_on":"恢復在","exclude_off":"排除在","exclude_execution":"上執行","user_config":"用戶配置","gm_api":"GM Api","storage_api":"Storage API","use_file_system":"使用的文件系統","open_directory":"打開目錄","account_validation_failed":"帳號信息驗證失敗","not_set":"未設置","in_use":"使用中","storage_error":"儲存錯誤","upload_to_cloud":"上傳至雲","save_failed":"保存失敗","exporting":"導出中...","upload_to":"上傳至","value_export_expression":"值導出表達式","overwrite_original_value_on_import":"導入時覆蓋原值","cookie_export_expression":"cookie導出表達式","overwrite_original_cookie_on_import":"導入時覆蓋原值","restore_default_values":"恢復默認值","get_confirm_error":"獲取確認信息失敗","confirm_error":"確認失敗","ignore":"忽略","allow_once":"允許一次","temporary_allow":"臨時允許此{{permissionContent}}","temporary_allow_all":"臨時允許全部{{permissionContent}}","permanent_allow":"永久允許此{{permissionContent}}","permanent_allow_all":"永久允許全部{{permissionContent}}","deny_once":"拒絕一次","temporary_deny":"臨時拒絕此{{permissionContent}}","temporary_deny_all":"臨時拒絕全部{{permissionContent}}","permanent_deny":"永久拒絕此{{permissionContent}}","permanent_deny_all":"永久拒絕全部{{permissionContent}}","data_import":"數據導入","import":"導入","select_scripts_to_import":"請選擇你要導入的腳本","select_all":"全選","script_import_progress":"腳本導入進度","select_subscribes_to_import":"請選擇你要導入的訂閱","subscribe_import_progress":"訂閱導入進度","author":"作者","description":"描述","operation":"操作","error":"錯誤","unknown":"未知","add_new":"新增","no_operation":"不做操作","enable_script":"開啟腳本","local_creation":"本地創建","import_success":"導入成功","install_script":"安裝","update_script":"更新","install_subscribe":"安裝訂閱","update_subscribe":"更新訂閱","invalid_link":"錯誤的鏈接","subscribe_install_label":"該訂閱將會安裝下面的腳本","script_runs_in":"腳本將在下面的網站中運行","script_has_full_access_to":"腳本將獲得以下地址的完整訪問權限","script_requires":"腳本引用了下列外部資源","cookie_warning":"請注意，本腳本會申請 Cookie 的操作權限，這是一項危險的權限，請確認腳本的安全性。","scheduled_script_description_1":"這是一個定時腳本，啟用後將在特定時間自動運行，並可在面板中手動控制。","scheduled_script_description_2":"定時任務表達式：{{expression}}，最近一次運行時間：{{time}}","background_script_description":"這是一個後臺腳本，啟用後將在瀏覽器打開時自動運行一次，並可在面板中手動控制。","install_success":"安裝成功","install":{"update_success":"更新成功"},"install_failed":"安裝失敗","subscribe_success":"訂閱成功","subscribe_failed":"訂閱失敗","current_version":"當前版本","update_version":"更新版本","background_script_tag":"這是一個後臺腳本","scheduled_script_tag":"這是一個定時腳本","background_script":"後臺腳本","scheduled_script":"定時腳本","install_from_legitimate_sources_warning":"請從合法來源安裝腳本！未知的腳本可能會侵犯您的隱私或者做出惡意的操作！","antifeature_referral_link_title":"推薦鏈接","antifeature_referral_link_description":"該腳本會修改或重定向到作者的返佣鏈接","antifeature_ads_title":"附帶廣告","antifeature_ads_description":"該腳本會在你訪問的頁面上插入廣告","antifeature_payment_title":"付費腳本","antifeature_payment_description":"該腳本需要你付費才能夠正常使用","antifeature_miner_title":"挖礦","antifeature_miner_description":"該腳本存在挖礦行為","antifeature_membership_title":"會員功能","antifeature_membership_description":"該腳本需要註冊會員才能正常使用","antifeature_tracking_title":"信息追蹤","antifeature_tracking_description":"該腳本會追蹤你的用户信息","script_info_load_failed":"腳本信息加載失敗！","script_status_tooltip":"可以控制腳本開啟狀態，普通油猴腳本默認開啟，後臺腳本、定時腳本默認關閉","get_script":"獲取腳本","report_issue":"BUG/問題反饋","project_docs":"項目文檔","community":"交流社區","popup":{"new_version_available":"有新版本可用"},"current_page_scripts":"當前頁運行腳本","enabled_background_scripts":"開啟和運行的後臺腳本","script_accessing_cross_origin_resource":"腳本正在試圖訪問跨域資源","confirm_operation_description":"請您確認是否允許腳本進行此操作，腳本也可增加@connect標籤跳過此選項","domain":"域名","script_name":"腳本名稱","request_domain":"請求域名","request_url":"請求地址","access_cookie_content":"腳本正在試圖訪問網站cookie內容","confirm_script_operation":"請您確認是否允許腳本進行此操作，cookie是一項重要的用戶數據，請務必只給信任的腳本授權.","cookie_domain":"Cookie域","script_operation_title":"腳本正在試圖操作腳本同步儲存空間","script_operation_description":"請您確認是否允許腳本進行此操作，允許後將允許腳本操作你設定的儲存空間，腳本會在儲存空間下創建一個app/${dir}的目錄進行使用","script_permission_content":"腳本","sync_system_connect_failed":"同步系統連接失敗","sync_system_closed":"已關閉同步","sync_system_closed_description":"同步功能已關閉，請重新配置","auth_type":"鑒權類型","url":"URL","username":"用戶名","password":"密碼","skip":"跳過","next":"下一步","back":"上一步","last":"完成","start_guide_title":"歡迎使用腳本貓擴展","start_guide_content":"接下來我們將為您介紹腳本貓的基本使用方法","guide_installed_scripts":"你所安裝的腳本將會在這裡顯示","guide_script_list_title":"腳本市場","guide_script_list_content":"可以從<Link href=\\"https://scriptcat.org/search\\">腳本市場</Link>中安裝腳本，腳本貓除了支持用戶腳本以外，還支持<Link href=\\"https://docs.scriptcat.org/docs/dev/backgroud/\\">後臺腳本</Link>","guide_script_list_enable_title":"腳本開啟","guide_script_list_enable_content":"腳本需要開啟才能使用，頁面腳本安裝默認開啟，後臺腳本安裝默認關閉","guide_script_list_apply_to_run_status_title":"應用至、與運行狀態","guide_script_list_apply_to_run_status_content":"腳本運行狀態展示，鼠標懸浮至標籤可以查看腳本類型","guide_script_list_sort_title":"排序/最後更新/操作","guide_script_list_sort_content":"你可以拖動腳本的標籤進行排序，點擊最後更新列標籤可以對腳本進行一次檢查更新，操作列可以進入腳本編輯、控制腳本的運行停止（後臺腳本）、設置<Link href=\\"https://docs.scriptcat.org/docs/dev/config/\\">UserConfig</Link>","guide_tools_title":"常用工具","guide_tools_content":"工具中提供了備份和開發的工具","guide_tools_backup_title":"備份","guide_tools_backup_content":"備份可以保存腳本，避免丟失。可以導出腳本文件到本地，也可以加載本地的腳本文件。也可以備份到雲端，更加方便。","guide_setting_title":"設置","guide_setting_content":"設置中主要包含了語言、腳本同步、更新頻率等常用設置項","guide_setting_sync_title":"更新與同步","guide_setting_sync_content":"脚本同步功能可以方便的将本设备的脚本内容同步至云端，如果有多台设备请勾选同步删除选项，当本设备脚本删除时，会从云端删除对应的脚本，也会将其它设备的脚本删除。","auto":"自动","hide":"隐藏","resize_column_width":"调整列宽","collapse":"收起","expand":"展开","menu_expand_num_before":"菜单项超过","menu_expand_num_after":"个时，自动隐藏"}'),et=JSON.parse('{"import_link":"crwdns5820:0crwdne5820:0","import_link_failure":"crwdns5822:0crwdne5822:0","create_user_script":"crwdns5824:0crwdne5824:0","create_background_script":"crwdns5826:0crwdne5826:0","create_scheduled_script":"crwdns5828:0crwdne5828:0","import_by_local":"crwdns6892:0crwdne6892:0","import_local_failure":"crwdns6894:0crwdne6894:0","import_local_success":"crwdns6896:0crwdne6896:0","create_script":"crwdns5830:0crwdne5830:0","user_guide":"crwdns5832:0crwdne5832:0","api_docs":"crwdns5834:0crwdne5834:0","development_guide":"crwdns5836:0crwdne5836:0","script_gallery":"crwdns5838:0crwdne5838:0","community_forum":"crwdns5840:0crwdne5840:0","external_links":"crwdns5842:0crwdne5842:0","system_follow":"crwdns5844:0crwdne5844:0","no_data":"crwdns5846:0crwdne5846:0","installed_scripts":"crwdns5848:0crwdne5848:0","subscribe":"crwdns5850:0crwdne5850:0","logs":"crwdns5852:0crwdne5852:0","tools":"crwdns5854:0crwdne5854:0","settings":"crwdns5856:0crwdne5856:0","collapsible":"crwdns5858:0crwdne5858:0","guide":"crwdns5860:0crwdne5860:0","helpcenter":"crwdns5862:0crwdne5862:0","general":"crwdns5864:0crwdne5864:0","language":"crwdns5866:0crwdne5866:0","help_translate":"crwdns6514:0crwdne6514:0","script_sync":"crwdns5868:0crwdne5868:0","sync_delete":"crwdns5870:0crwdne5870:0","enable_script_sync_to":"crwdns5872:0crwdne5872:0","save":"crwdns5874:0crwdne5874:0","cloud_sync_account_verification":"crwdns5876:0crwdne5876:0","cloud_sync_verification_failed":"crwdns5878:0crwdne5878:0","save_success":"crwdns5880:0crwdne5880:0","update":"crwdns5882:0crwdne5882:0","check_update":"crwdns5884:0crwdne5884:0","script_subscription_check_interval":"crwdns5886:0crwdne5886:0","never":"crwdns5888:0crwdne5888:0","6_hours":"crwdns5890:0crwdne5890:0","12_hours":"crwdns5892:0crwdne5892:0","every_day":"crwdns5894:0crwdne5894:0","every_week":"crwdns5896:0crwdne5896:0","update_disabled_scripts":"crwdns5898:0crwdne5898:0","silent_update_non_critical_changes":"crwdns5900:0crwdne5900:0","enable_eslint":"crwdns5902:0crwdne5902:0","eslint_rules":"crwdns5904:0crwdne5904:0","enter_eslint_rules":"crwdns5906:0crwdne5906:0","language_change_tip":"crwdns5908:0crwdne5908:0","backup":"crwdns5910:0crwdne5910:0","local":"crwdns5912:0crwdne5912:0","export_file":"crwdns5914:0crwdne5914:0","import_file":"crwdns5916:0crwdne5916:0","cloud":"crwdns5918:0crwdne5918:0","backup_to":"crwdns5920:0crwdne5920:0","preparing_backup":"crwdns5922:0crwdne5922:0","backup_success":"crwdns5924:0crwdne5924:0","backup_failed":"crwdns5926:0crwdne5926:0","no_backup_files":"crwdns5928:0crwdne5928:0","backup_list":"crwdns5930:0crwdne5930:0","open_backup_dir":"crwdns5932:0crwdne5932:0","confirm_delete":"crwdns5934:0crwdne5934:0","confirm_delete_backup_file":"crwdns5936:0crwdne5936:0","confirm_update":"crwdns5938:0crwdne5938:0","delete_success":"crwdns5940:0crwdne5940:0","backup_strategy":"crwdns5942:0crwdne5942:0","under_construction":"crwdns5944:0crwdne5944:0","development_debugging":"crwdns5946:0crwdne5946:0","vscode_url":"crwdns5948:0crwdne5948:0","auto_connect_vscode_service":"crwdns5950:0crwdne5950:0","connect":"crwdns5952:0crwdne5952:0","connection_success":"crwdns5954:0crwdne5954:0","connection_failed":"crwdns5956:0crwdne5956:0","select_import_script":"crwdns5958:0crwdne5958:0","import_error":"crwdns5960:0crwdne5960:0","pulling_data_from_cloud":"crwdns5962:0crwdne5962:0","pull_failed":"crwdns5964:0crwdne5964:0","restore":"crwdns5966:0crwdne5966:0","log_title":"crwdns5968:0crwdne5968:0","last_5_minutes":"crwdns5970:0crwdne5970:0","last_15_minutes":"crwdns5972:0crwdne5972:0","last_30_minutes":"crwdns5974:0crwdne5974:0","last_1_hour":"crwdns5976:0crwdne5976:0","last_3_hours":"crwdns5978:0crwdne5978:0","last_6_hours":"crwdns5980:0crwdne5980:0","last_12_hours":"crwdns5982:0crwdne5982:0","last_24_hours":"crwdns5984:0crwdne5984:0","last_7_days":"crwdns5986:0crwdne5986:0","query":"crwdns5988:0crwdne5988:0","labels":"crwdns5990:0crwdne5990:0","search_regex":"crwdns5992:0crwdne5992:0","clean_schedule":"crwdns5994:0crwdne5994:0","days_ago_logs":"crwdns5996:0crwdne5996:0","delete_completed":"crwdns5998:0crwdne5998:0","delete_current_logs":"crwdns6000:0crwdne6000:0","clear_completed":"crwdns6002:0crwdne6002:0","clear_logs":"crwdns6004:0crwdne6004:0","total_logs":"crwdns6508:0{{length}}crwdne6508:0","filtered_logs":"crwdns6510:0{{length}}crwdne6510:0","enter_filter_conditions":"crwdns6010:0crwdne6010:0","permission":"crwdns6012:0crwdne6012:0","enter_subscribe_name":"crwdns6014:0crwdne6014:0","subscribe_url":"crwdns6016:0crwdne6016:0","confirm_delete_subscription":"crwdns6018:0crwdne6018:0","list":{"confirm_delete":"crwdns6020:0crwdne6020:0","confirm_update":"crwdns6022:0crwdne6022:0"},"enable":"crwdns6024:0crwdne6024:0","script_list_enable_width":0,"script_list_last_updated_width":0,"script_list_apply_to_run_status_width":0,"subscribe_list_enable_width":0,"disable":"crwdns6034:0crwdne6034:0","name":"crwdns6036:0crwdne6036:0","version":"crwdns6038:0crwdne6038:0","apply_to_run_status":"crwdns6040:0crwdne6040:0","source":"crwdns6042:0crwdne6042:0","home":"crwdns6044:0crwdne6044:0","sorting":"crwdns6046:0crwdne6046:0","last_updated":"crwdns6048:0crwdne6048:0","action":"crwdns6050:0crwdne6050:0","foreground_page_script_tooltip":"crwdns6052:0crwdne6052:0","background_script_tooltip":"crwdns6054:0crwdne6054:0","scheduled_script_tooltip":"crwdns6056:0crwdne6056:0","running":"crwdns6058:0crwdne6058:0","completed":"crwdns6060:0crwdne6060:0","subscription_link":"crwdns6062:0crwdne6062:0","subscription_installation":"crwdns6064:0crwdne6064:0","manually_created":"crwdns6066:0crwdne6066:0","script_link":"crwdns6068:0crwdne6068:0","user_installation":"crwdns6070:0crwdne6070:0","confirm_delete_script":"crwdns6072:0crwdne6072:0","delete_failed":"crwdns6074:0crwdne6074:0","enter_script_name":"crwdns6076:0crwdne6076:0","update_not_supported":"crwdns6078:0crwdne6078:0","checking_for_updates":"crwdns6080:0crwdne6080:0","new_version_available":"crwdns6082:0crwdne6082:0","latest_version":"crwdns6084:0crwdne6084:0","checked_for_all_selected":"crwdns6086:0crwdne6086:0","update_check_failed":"crwdns6088:0crwdne6088:0","stopping_script":"crwdns6090:0crwdne6090:0","script_stopped":"crwdns6092:0crwdne6092:0","starting_script":"crwdns6094:0crwdne6094:0","starting_updates":"crwdns6096:0crwdne6096:0","script_started":"crwdns6098:0crwdne6098:0","batch_operations":"crwdns6100:0crwdne6100:0","export":"crwdns6102:0crwdne6102:0","delete":"crwdns6104:0crwdne6104:0","unknown_operation":"crwdns6106:0crwdne6106:0","confirm":"crwdns6108:0crwdne6108:0","close":"crwdns6110:0crwdne6110:0","page_script":"crwdns6112:0crwdne6112:0","homepage":"crwdns6114:0crwdne6114:0","script_website":"crwdns6116:0crwdne6116:0","script_source":"crwdns6118:0crwdne6118:0","bug_feedback_script_support":"crwdns6120:0crwdne6120:0","config":"crwdns6122:0crwdne6122:0","key":"crwdns6124:0crwdne6124:0","value":"crwdns6126:0crwdne6126:0","add":"crwdns6128:0crwdne6128:0","type":"crwdns6130:0crwdne6130:0","edit_value":"crwdns6132:0crwdne6132:0","add_value":"crwdns6134:0crwdne6134:0","update_success":"crwdns6136:0crwdne6136:0","add_success":"crwdns6138:0crwdne6138:0","script_storage":"crwdns6140:0crwdne6140:0","enter_key":"crwdns6142:0crwdne6142:0","key_placeholder":"crwdns6144:0crwdne6144:0","value_placeholder":"crwdns6146:0crwdne6146:0","clear":"crwdns6148:0crwdne6148:0","clear_success":"crwdns6150:0crwdne6150:0","confirm_clear":"crwdns6152:0crwdne6152:0","type_string":"crwdns6154:0crwdne6154:0","type_number":"crwdns6156:0crwdne6156:0","type_boolean":"crwdns6158:0crwdne6158:0","type_object":"crwdns6160:0crwdne6160:0","confirm_delete_resource":"crwdns6162:0crwdne6162:0","confirm_clear_resource":"crwdns6164:0crwdne6164:0","script_resource":"crwdns6166:0crwdne6166:0","permission_value":"crwdns6168:0crwdne6168:0","allow":"crwdns6170:0crwdne6170:0","yes":"crwdns6172:0crwdne6172:0","no":"crwdns6174:0crwdne6174:0","confirm_delete_permission":"crwdns6176:0crwdne6176:0","script_setting":"crwdns6178:0crwdne6178:0","basic_info":"crwdns6180:0crwdne6180:0","update_url":"crwdns6182:0crwdne6182:0","permission_management":"crwdns6184:0crwdne6184:0","add_permission":"crwdns6186:0crwdne6186:0","permission_cors":"crwdns6188:0crwdne6188:0","permission_cookie":"crwdns6190:0crwdne6190:0","match":"crwdns6192:0crwdne6192:0","user_setting":"crwdns6194:0crwdne6194:0","confirm_delete_exclude":"crwdns6196:0crwdne6196:0","after_deleting_match_item":"crwdns6198:0crwdne6198:0","confirm_delete_match":"crwdns6200:0crwdne6200:0","after_deleting_exclude_item":"crwdns6202:0crwdne6202:0","add_match":"crwdns6204:0crwdne6204:0","add_exclude":"crwdns6206:0crwdne6206:0","website_match":"crwdns6208:0crwdne6208:0","reset":"crwdns6210:0crwdne6210:0","website_exclude":"crwdns6212:0crwdne6212:0","confirm_reset":"crwdns6214:0crwdne6214:0","script_total_runs":"crwdns6216:0{{runNum}}crwdnd6216:0{{runNumByIframe}}crwdne6216:0","script_total_runs_single":"crwdns6218:0{{runNum}}crwdne6218:0","script_disabled":"crwdns6220:0crwdne6220:0","run_once":"crwdns6222:0crwdne6222:0","stop":"crwdns6224:0crwdne6224:0","edit":"crwdns6226:0crwdne6226:0","exclude_on":"crwdns6228:0crwdne6228:0","exclude_off":"crwdns6230:0crwdne6230:0","exclude_execution":"crwdns6232:0crwdne6232:0","user_config":"crwdns6234:0crwdne6234:0","gm_api":"crwdns6236:0crwdne6236:0","storage_api":"crwdns6238:0crwdne6238:0","use_file_system":"crwdns6240:0crwdne6240:0","open_directory":"crwdns6242:0crwdne6242:0","account_validation_failed":"crwdns6244:0crwdne6244:0","not_set":"crwdns6246:0crwdne6246:0","in_use":"crwdns6248:0crwdne6248:0","storage_error":"crwdns6250:0crwdne6250:0","upload_to_cloud":"crwdns6252:0crwdne6252:0","save_failed":"crwdns6254:0crwdne6254:0","exporting":"crwdns6256:0crwdne6256:0","upload_to":"crwdns6258:0crwdne6258:0","value_export_expression":"crwdns6260:0crwdne6260:0","overwrite_original_value_on_import":"crwdns6262:0crwdne6262:0","cookie_export_expression":"crwdns6264:0crwdne6264:0","overwrite_original_cookie_on_import":"crwdns6266:0crwdne6266:0","restore_default_values":"crwdns6268:0crwdne6268:0","get_confirm_error":"crwdns6270:0crwdne6270:0","confirm_error":"crwdns6272:0crwdne6272:0","ignore":"crwdns6274:0crwdne6274:0","allow_once":"crwdns6276:0crwdne6276:0","temporary_allow":"crwdns6278:0{{permissionContent}}crwdne6278:0","temporary_allow_all":"crwdns6280:0{{permissionContent}}crwdne6280:0","permanent_allow":"crwdns6282:0{{permissionContent}}crwdne6282:0","permanent_allow_all":"crwdns6284:0{{permissionContent}}crwdne6284:0","deny_once":"crwdns6286:0crwdne6286:0","temporary_deny":"crwdns6288:0{{permissionContent}}crwdne6288:0","temporary_deny_all":"crwdns6290:0{{permissionContent}}crwdne6290:0","permanent_deny":"crwdns6292:0{{permissionContent}}crwdne6292:0","permanent_deny_all":"crwdns6294:0{{permissionContent}}crwdne6294:0","data_import":"crwdns6296:0crwdne6296:0","import":"crwdns6298:0crwdne6298:0","select_scripts_to_import":"crwdns6300:0crwdne6300:0","select_all":"crwdns6302:0crwdne6302:0","script_import_progress":"crwdns6304:0crwdne6304:0","select_subscribes_to_import":"crwdns6306:0crwdne6306:0","subscribe_import_progress":"crwdns6308:0crwdne6308:0","author":"crwdns6310:0crwdne6310:0","description":"crwdns6312:0crwdne6312:0","operation":"crwdns6314:0crwdne6314:0","error":"crwdns6316:0crwdne6316:0","unknown":"crwdns6318:0crwdne6318:0","add_new":"crwdns6320:0crwdne6320:0","no_operation":"crwdns6322:0crwdne6322:0","enable_script":"crwdns6324:0crwdne6324:0","local_creation":"crwdns6326:0crwdne6326:0","import_success":"crwdns6328:0crwdne6328:0","install_script":"crwdns6330:0crwdne6330:0","update_script":"crwdns6332:0crwdne6332:0","install_subscribe":"crwdns6334:0crwdne6334:0","update_subscribe":"crwdns6336:0crwdne6336:0","invalid_link":"crwdns6338:0crwdne6338:0","subscribe_install_label":"crwdns6340:0crwdne6340:0","script_runs_in":"crwdns6342:0crwdne6342:0","script_has_full_access_to":"crwdns6344:0crwdne6344:0","script_requires":"crwdns6346:0crwdne6346:0","cookie_warning":"crwdns6348:0crwdne6348:0","scheduled_script_description_1":"crwdns6350:0crwdne6350:0","scheduled_script_description_2":"crwdns6352:0{{expression}}crwdnd6352:0{{time}}crwdne6352:0","background_script_description":"crwdns6354:0crwdne6354:0","install_success":"crwdns6356:0crwdne6356:0","install":{"update_success":"crwdns6358:0crwdne6358:0"},"install_failed":"crwdns6360:0crwdne6360:0","subscribe_success":"crwdns6362:0crwdne6362:0","subscribe_failed":"crwdns6364:0crwdne6364:0","current_version":"crwdns6366:0crwdne6366:0","update_version":"crwdns6368:0crwdne6368:0","background_script_tag":"crwdns6370:0crwdne6370:0","scheduled_script_tag":"crwdns6372:0crwdne6372:0","background_script":"crwdns6374:0crwdne6374:0","scheduled_script":"crwdns6376:0crwdne6376:0","install_from_legitimate_sources_warning":"crwdns6378:0crwdne6378:0","antifeature_referral_link_title":"crwdns6380:0crwdne6380:0","antifeature_referral_link_description":"crwdns6382:0crwdne6382:0","antifeature_ads_title":"crwdns6384:0crwdne6384:0","antifeature_ads_description":"crwdns6386:0crwdne6386:0","antifeature_payment_title":"crwdns6388:0crwdne6388:0","antifeature_payment_description":"crwdns6390:0crwdne6390:0","antifeature_miner_title":"crwdns6392:0crwdne6392:0","antifeature_miner_description":"crwdns6394:0crwdne6394:0","antifeature_membership_title":"crwdns6396:0crwdne6396:0","antifeature_membership_description":"crwdns6398:0crwdne6398:0","antifeature_tracking_title":"crwdns6400:0crwdne6400:0","antifeature_tracking_description":"crwdns6402:0crwdne6402:0","script_info_load_failed":"crwdns6404:0crwdne6404:0","script_status_tooltip":"crwdns6406:0crwdne6406:0","get_script":"crwdns6408:0crwdne6408:0","report_issue":"crwdns6410:0crwdne6410:0","project_docs":"crwdns6412:0crwdne6412:0","community":"crwdns6414:0crwdne6414:0","popup":{"new_version_available":"crwdns6416:0crwdne6416:0"},"current_page_scripts":"crwdns6418:0crwdne6418:0","enabled_background_scripts":"crwdns6420:0crwdne6420:0","script_accessing_cross_origin_resource":"crwdns6422:0crwdne6422:0","confirm_operation_description":"crwdns6512:0crwdne6512:0","domain":"crwdns6426:0crwdne6426:0","script_name":"crwdns6428:0crwdne6428:0","request_domain":"crwdns6430:0crwdne6430:0","request_url":"crwdns6432:0crwdne6432:0","access_cookie_content":"crwdns6434:0crwdne6434:0","confirm_script_operation":"crwdns6436:0crwdne6436:0","cookie_domain":"crwdns6438:0crwdne6438:0","script_operation_title":"crwdns6440:0crwdne6440:0","script_operation_description":"crwdns6442:0${dir}crwdne6442:0","script_permission_content":"crwdns6444:0crwdne6444:0","sync_system_connect_failed":"crwdns6446:0crwdne6446:0","sync_system_closed":"crwdns6448:0crwdne6448:0","sync_system_closed_description":"crwdns6450:0crwdne6450:0","auth_type":"crwdns6452:0crwdne6452:0","url":"crwdns6454:0crwdne6454:0","username":"crwdns6456:0crwdne6456:0","password":"crwdns6458:0crwdne6458:0","skip":"crwdns6460:0crwdne6460:0","next":"crwdns6462:0crwdne6462:0","back":"crwdns6464:0crwdne6464:0","last":"crwdns6466:0crwdne6466:0","start_guide_title":"crwdns6468:0crwdne6468:0","start_guide_content":"crwdns6470:0crwdne6470:0","guide_installed_scripts":"crwdns6472:0crwdne6472:0","guide_script_list_title":"crwdns6474:0crwdne6474:0","guide_script_list_content":"crwdns6476:0crwdne6476:0","guide_script_list_enable_title":"crwdns6478:0crwdne6478:0","guide_script_list_enable_content":"crwdns6480:0crwdne6480:0","guide_script_list_apply_to_run_status_title":"crwdns6482:0crwdne6482:0","guide_script_list_apply_to_run_status_content":"crwdns6484:0crwdne6484:0","guide_script_list_sort_title":"crwdns6486:0crwdne6486:0","guide_script_list_sort_content":"crwdns6488:0crwdne6488:0","guide_tools_title":"crwdns6490:0crwdne6490:0","guide_tools_content":"crwdns6492:0crwdne6492:0","guide_tools_backup_title":"crwdns6494:0crwdne6494:0","guide_tools_backup_content":"crwdns6496:0crwdne6496:0","guide_setting_title":"crwdns6498:0crwdne6498:0","guide_setting_content":"crwdns6500:0crwdne6500:0","guide_setting_sync_title":"crwdns6502:0crwdne6502:0","guide_setting_sync_content":"crwdns6900:0crwdne6900:0","auto":"crwdns6902:0crwdne6902:0","hide":"crwdns6904:0crwdne6904:0","resize_column_width":"crwdns6906:0crwdne6906:0","collapse":"crwdns6908:0crwdne6908:0","expand":"crwdns6910:0crwdne6910:0","menu_expand_num_before":"crwdns6912:0crwdne6912:0","menu_expand_num_after":"crwdns6914:0crwdne6914:0"}');r(33852),r(43901);function tt(e){return e.metadata["name:".concat(Fe.ZP.language.toLowerCase())]?e.metadata["name:".concat(Fe.ZP.language.toLowerCase())][0]:e.name}Fe.ZP.use(Xe.Db).init({fallbackLng:"zh-CN",lng:localStorage.language||chrome.i18n.getUILanguage(),interpolation:{escapeValue:!1},resources:{"en-US":{title:"English",translation:Je},"vi-VN":{title:"Tiếng Việt",translation:Qe},"zh-CN":{title:"简体中文",translation:Ye},"zh-TW":{title:"繁体中文",translation:$e},"ach-UG":{title:"伪语言",translation:et}}}),localStorage.language?a().locale(localStorage.language.toLocaleLowerCase()):chrome.i18n.getAcceptLanguages((e=>{for(let t=0;t<e.length;t+=1){const r=e[t];if(Fe.ZP.hasResourceBundle(r,"translation")){localStorage.language=r,Fe.ZP.changeLanguage(r),a().locale(r.toLocaleLowerCase());break}}})),a().extend(We());const rt="0.16.6",st="https://ext.scriptcat.org/";var nt,it,at,ot,ct,lt,dt,pt,ut,ht,_t,mt,gt,wt,ft,yt,bt,vt,kt,Ct,Tt,St,Mt,Pt,Lt,xt,It,Ot,Dt,Et,Nt,At;class Ut{static API(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t,r,s)=>{const n=r;if(e.listener&&e.listener(),"GMdotXmlHttpRequest"===n)return void Ut.apis.set("GM.xmlHttpRequest",{api:s.value,param:e});Ut.apis.set(n,{api:s.value,param:e});const i=n.replace("_",".");if(i!==n){if("GM.xmlhttpRequest"===i)return;Ut.apis.set(i,{api:s.value,param:e})}}}}(0,s.Z)(Ut,"apis",new Map);nt=Ut.API(),it=Ut.API(),at=Ut.API({depend:["GM_setValue"]}),ot=Ut.API(),ct=Ut.API(),lt=Ut.API(),dt=Ut.API(),pt=Ut.API(),ut=Ut.API(),ht=Ut.API({depend:["CAT_fetchBlob","CAT_createBlobUrl","CAT_fetchDocument","GM_xmlhttpRequest"]}),_t=Ut.API({depend:["CAT_fetchBlob","CAT_createBlobUrl","CAT_fetchDocument"]}),mt=Ut.API(),gt=Ut.API(),wt=Ut.API(),ft=Ut.API(),yt=Ut.API({depend:["GM_closeInTab"]}),bt=Ut.API(),vt=Ut.API(),kt=Ut.API(),Ct=Ut.API(),Tt=Ut.API(),St=Ut.API(),Mt=Ut.API(),Pt=Ut.API(),Lt=Ut.API(),xt=Ut.API(),It=Ut.API(),Ot=Ut.API(),Dt=Ut.API(),Et=Ut.API(),Nt=Ut.API({depend:["CAT_fetchBlob","CAT_createBlobUrl"]}),At=class{constructor(){(0,s.Z)(this,"valueChangeListener",new Map)}sendMessage(e,t){return this.message.syncSend("gmApi",{api:e,scriptId:this.scriptRes.id,params:t,runFlag:this.runFlag})}connect(e,t,r){const s=(0,p.Z)(),n=this.message.channel(s);return n.setHandler(r),n.channel("gmApiChannel",{api:e,scriptId:this.scriptRes.id,params:t,runFlag:this.runFlag}),n}valueUpdate(e){const{storagename:t}=this.scriptRes.metadata;(e.value.scriptId===this.scriptRes.id||t&&e.value.storageName&&t[0]===e.value.storageName)&&(void 0===e.value.value?delete this.scriptRes.value[e.value.key]:this.scriptRes.value[e.value.key]=e.value,this.valueChangeListener.forEach((t=>{t.name===e.value.key&&t.listener(e.value.key,e.oldValue,e.value.value,e.sender.runFlag!==this.runFlag,e.sender.tabId)})))}static GM_info(e){const t=function(e){const t=e.indexOf("==UserScript=="),r=e.indexOf("==/UserScript==");return-1===t||-1===r?null:"// ".concat(e.substring(t,r+15))}(e.sourceCode),r=function(e){const t=e.indexOf("==UserConfig=="),r=e.indexOf("==/UserConfig==");return-1===t||-1===r?null:"/* ".concat(e.substring(t,r+15)," */")}(e.sourceCode)||"",s={description:e.metadata.description&&e.metadata.description[0]||null,matches:e.metadata.match||[],includes:e.metadata.include||[],"run-at":e.metadata["run-at"]&&e.metadata["run-at"][0]||"document-idle",icon:e.metadata.icon&&e.metadata.icon[0]||null,icon64:e.metadata.icon64&&e.metadata.icon64[0]||null,header:t,grant:e.metadata.grant||[],connects:e.metadata.connect||[]};return{scriptWillUpdate:!0,scriptHandler:"ScriptCat",scriptUpdateURL:e.downloadUrl,scriptMetaStr:t,userConfig:Z(r),userConfigStr:r,version:rt,script:{name:e.name,namespace:e.namespace,version:e.metadata.version&&e.metadata.version[0],author:e.author,...s}}}GM_getValue(e,t){const r=this.scriptRes.value[e];return r?r.value:t}GM_setValue(e,t){"object"==typeof t&&(t=JSON.parse(JSON.stringify(t)));let r=this.scriptRes.value[e];return r?r.value=t:r={id:0,scriptId:this.scriptRes.id,storageName:this.scriptRes.metadata.storagename&&this.scriptRes.metadata.storagename[0]||"",key:e,value:t,createtime:(new Date).getTime(),updatetime:0},void 0===t?delete this.scriptRes.value[e]:this.scriptRes.value[e]=r,this.sendMessage("GM_setValue",[e,t])}GM_deleteValue(e){this.GM_setValue(e,void 0)}GM_listValues(){return Object.keys(this.scriptRes.value)}GM_addValueChangeListener(e,t){const r=1e7*Math.random();return this.valueChangeListener.set(r,{name:e,listener:t}),r}GM_removeValueChangeListener(e){this.valueChangeListener.delete(e)}CAT_fetchBlob(e){return this.message.syncSend("CAT_fetchBlob",e)}CAT_fetchDocument(e){return new Promise((t=>{let r;this.message.sendCallback("CAT_fetchDocument",e,(e=>{r=this.message.getAndDelRelatedTarget(e.relatedTarget),t(r)}))}))}CAT_createBlobUrl(e){return this.message.syncSend("CAT_createBlobUrl",e)}GMdotXmlHttpRequest(e){let t;const r=new Promise(((r,s)=>{const n=e.onload;e.onload=e=>{r(e),n&&n(e)};const i=e.onerror;e.onerror=e=>{s(e),i&&i(e)},t=this.GM_xmlhttpRequest(e)}));return t&&t.abort&&(r.abort=t.abort),r}GM_xmlhttpRequest(e){let t;const r=new URL(e.url,window.location.href);e.headers&&Object.keys(e.headers).forEach((t=>{"cookie"===t.toLowerCase()&&(e.cookie=e.headers[t],delete e.headers[t])}));const s={method:e.method,timeout:e.timeout,url:r.href,headers:e.headers,cookie:e.cookie,context:e.context,responseType:e.responseType,overrideMimeType:e.overrideMimeType,anonymous:e.anonymous,user:e.user,password:e.password,maxRedirects:e.maxRedirects};s.headers||(s.headers={}),e.nocache&&(s.headers["Cache-Control"]="no-cache");return(async()=>{var r;if(e.data)if(e.data instanceof FormData){s.dataType="FormData";const t=[],r={};e.data.forEach(((e,t)=>{r[t]=!0}));const n=Object.keys(r).map((r=>{const s=e.data.getAll(r).map((e=>new Promise((s=>{e instanceof File?F(e).then((n=>{t.push({key:r,type:"file",val:n||"",filename:e.name}),s()})):(t.push({key:r,type:"text",val:e}),s())}))));return Promise.all(s)}));await Promise.all(n),s.data=t}else e.data instanceof Blob?(s.dataType="Blob",s.data=await this.CAT_createBlobUrl(e.data)):s.data=e.data;let n,i;const a=null===(r=e.responseType)||void 0===r?void 0:r.toLocaleLowerCase(),o=e=>("stream"===a&&(n=new ReadableStream({start(e){i=e}})),async t=>{if(t.response)if("document"===a)t.response=await this.CAT_fetchDocument(t.response),t.responseXML=t.response,t.responseType="document";else{const e=await this.CAT_fetchBlob(t.response);t.response="arraybuffer"===a?await e.arrayBuffer():e}"stream"===a&&(t.response=n),e(t)});"arraybuffer"!==a&&"blob"!==a&&"document"!==a&&"stream"!==a||(e.onload&&(e.onload=o(e.onload)),e.onreadystatechange&&(e.onreadystatechange=o(e.onreadystatechange)),e.onloadend&&(e.onloadend=o(e.onloadend)),"document"===a&&(s.responseType="blob"),"stream"===a&&e.onloadstart&&(e.onloadstart=o(e.onloadstart))),t=this.connect("GM_xmlhttpRequest",[s],(t=>{var r;const s=t.data||{};switch(t.event){case"onload":e.onload&&e.onload(s);break;case"onloadend":var a;if(e.onloadend&&e.onloadend(s),n)null===(a=i)||void 0===a||a.close();break;case"onloadstart":e.onloadstart&&e.onloadstart(s);break;case"onprogress":e.onprogress&&e.onprogress(s);break;case"onreadystatechange":e.onreadystatechange&&e.onreadystatechange(s);break;case"ontimeout":e.ontimeout&&e.ontimeout();break;case"onerror":e.onerror&&e.onerror("");break;case"onabort":e.onabort&&e.onabort();break;case"onstream":null===(r=i)||void 0===r||r.enqueue(new Uint8Array(t.data));break;default:d.getLogger().warn("GM_xmlhttpRequest resp is error",{resp:t})}})),t.setCatch((t=>{e.onerror&&e.onerror(t)}))})(),{abort:()=>{t&&t.disChannel()}}}async GM_notification(e,t,r,s){let n,i,a,o={};if("string"==typeof e)switch(o.text=e,arguments.length){case 4:o.onclick=s;case 3:o.image=r;case 2:o.title=t}else o=e,o.ondone=o.ondone||t;o.onclick&&(n=o.onclick,delete o.onclick),o.ondone&&(i=o.ondone,delete o.ondone),o.oncreate&&(a=o.oncreate,delete o.oncreate),this.connect("GM_notification",[o],(e=>{switch(e.event){case"click":n&&n.apply({id:e.id},[e.id,e.index]);break;case"done":i&&i.apply({id:e.id},[e.user]);break;case"create":a&&a.apply({id:e.id},[e.id]);break;default:d.getLogger().warn("GM_notification resp is error",{resp:e})}}))}GM_closeNotification(e){this.sendMessage("GM_closeNotification",[e])}GM_updateNotification(e,t){this.sendMessage("GM_updateNotification",[e,t])}GM_log(e,t,r){return"string"!=typeof e&&(e=JSON.stringify(e)),this.sendMessage("GM_log",[e,t,r])}GM_openInTab(e,t){let r,s={};1===arguments.length?s.active=!0:"boolean"==typeof t?s.active=!t:s=t,void 0===s.active&&(s.active=!0);const n={close:()=>{this.GM_closeInTab(r)}},i=this.connect("GM_openInTab",[e,s],(e=>{switch(e.event){case"oncreate":r=e.tabId;break;case"onclose":n.onclose&&n.onclose(),n.closed=!0,i.disChannel()}}));return n}GM_closeInTab(e){return this.sendMessage("GM_closeInTab",[e])}GM_getResourceText(e){if(!this.scriptRes.resource)return;const t=this.scriptRes.resource[e];return t?t.content:void 0}GM_getResourceURL(e,t){if(!this.scriptRes.resource)return;const r=this.scriptRes.resource[e];return r?t?URL.createObjectURL(X(r.base64)):r.base64:void 0}GM_addStyle(e){let t;return this.message.sendCallback("GM_addElement",{param:["style",{textContent:e}]},(e=>{t=this.message.getAndDelRelatedTarget(e.relatedTarget)})),t}async GM_getTab(e){e(await this.sendMessage("GM_getTab",[]))}GM_saveTab(e){return"object"==typeof e&&(e=JSON.parse(JSON.stringify(e))),this.sendMessage("GM_saveTab",[e])}async GM_getTabs(e){e(await this.sendMessage("GM_getTabs",[]))}GM_download(e,t){let r;r="string"==typeof e?{name:t||"",url:e}:e;const s=this.connect("GM_download",[{method:r.method,url:r.url,name:r.name,headers:r.headers,saveAs:r.saveAs,timeout:r.timeout,cookie:r.cookie,anonymous:r.anonymous}],(e=>{const t=e.data||{};switch(e.event){case"onload":r.onload&&r.onload(t);break;case"onprogress":r.onprogress&&r.onprogress(t);break;case"ontimeout":r.ontimeout&&r.ontimeout();break;case"onerror":r.onerror&&r.onerror({error:"unknown"});break;default:d.getLogger().warn("GM_download resp is error",{resp:e})}}));return{abort:()=>{s.disChannel()}}}GM_setClipboard(e,t){return this.sendMessage("GM_setClipboard",[e,t])}GM_cookie(e,t,r){this.sendMessage("GM_cookie",[e,t]).then((e=>{r&&r(e,void 0)})).catch((e=>{r&&r(void 0,e)}))}GM_registerMenuCommand(e,t,r){this.menuMap||(this.menuMap=new Map);let s=0;if(this.menuMap.forEach(((t,r)=>{t===e&&(s=r)})),s)return s;this.menuId?this.menuId+=1:this.menuId=1;const n=this.menuId;return this.connect("GM_registerMenuCommand",[n,e,r],(()=>{t()})),this.menuMap.set(n,e),n}GM_unregisterMenuCommand(e){this.menuMap||(this.menuMap=new Map),this.menuMap.delete(e),this.sendMessage("GM_unregisterMenuCommand",[e])}CAT_userConfig(){return this.sendMessage("CAT_userConfig",[])}GM_addElement(e,t,r){let s;return this.message.sendCallback("GM_addElement",{param:["string"==typeof e?e:t,"string"==typeof e?t:r],relatedTarget:"string"==typeof e?null:e},(e=>{s=this.message.getAndDelRelatedTarget(e.relatedTarget)})),s}async CAT_fileStorage(e,t){if("config"===e)return void this.sendMessage("CAT_fileStorage",["config"]);const r={baseDir:t.baseDir||"",path:t.path||"",filename:t.filename,file:t.file};if("upload"===e){const e=await this.CAT_createBlobUrl(t.data);r.data=e}this.connect("CAT_fileStorage",[e,r],(async r=>{if("download"===e){const e=await this.CAT_fetchBlob(r.data);t.onload&&t.onload(e)}else t.onload&&t.onload(r.data)})).setCatch((e=>{void 0!==e.code?t.onerror&&t.onerror(e):t.onerror&&t.onerror({code:-1,message:e.message})}))}},(0,ne.Z)(At.prototype,"GM_getValue",[nt],Object.getOwnPropertyDescriptor(At.prototype,"GM_getValue"),At.prototype),(0,ne.Z)(At.prototype,"GM_setValue",[it],Object.getOwnPropertyDescriptor(At.prototype,"GM_setValue"),At.prototype),(0,ne.Z)(At.prototype,"GM_deleteValue",[at],Object.getOwnPropertyDescriptor(At.prototype,"GM_deleteValue"),At.prototype),(0,ne.Z)(At.prototype,"GM_listValues",[ot],Object.getOwnPropertyDescriptor(At.prototype,"GM_listValues"),At.prototype),(0,ne.Z)(At.prototype,"GM_addValueChangeListener",[ct],Object.getOwnPropertyDescriptor(At.prototype,"GM_addValueChangeListener"),At.prototype),(0,ne.Z)(At.prototype,"GM_removeValueChangeListener",[lt],Object.getOwnPropertyDescriptor(At.prototype,"GM_removeValueChangeListener"),At.prototype),(0,ne.Z)(At.prototype,"CAT_fetchBlob",[dt],Object.getOwnPropertyDescriptor(At.prototype,"CAT_fetchBlob"),At.prototype),(0,ne.Z)(At.prototype,"CAT_fetchDocument",[pt],Object.getOwnPropertyDescriptor(At.prototype,"CAT_fetchDocument"),At.prototype),(0,ne.Z)(At.prototype,"CAT_createBlobUrl",[ut],Object.getOwnPropertyDescriptor(At.prototype,"CAT_createBlobUrl"),At.prototype),(0,ne.Z)(At.prototype,"GMdotXmlHttpRequest",[ht],Object.getOwnPropertyDescriptor(At.prototype,"GMdotXmlHttpRequest"),At.prototype),(0,ne.Z)(At.prototype,"GM_xmlhttpRequest",[_t],Object.getOwnPropertyDescriptor(At.prototype,"GM_xmlhttpRequest"),At.prototype),(0,ne.Z)(At.prototype,"GM_notification",[mt],Object.getOwnPropertyDescriptor(At.prototype,"GM_notification"),At.prototype),(0,ne.Z)(At.prototype,"GM_closeNotification",[gt],Object.getOwnPropertyDescriptor(At.prototype,"GM_closeNotification"),At.prototype),(0,ne.Z)(At.prototype,"GM_updateNotification",[wt],Object.getOwnPropertyDescriptor(At.prototype,"GM_updateNotification"),At.prototype),(0,ne.Z)(At.prototype,"GM_log",[ft],Object.getOwnPropertyDescriptor(At.prototype,"GM_log"),At.prototype),(0,ne.Z)(At.prototype,"GM_openInTab",[yt],Object.getOwnPropertyDescriptor(At.prototype,"GM_openInTab"),At.prototype),(0,ne.Z)(At.prototype,"GM_closeInTab",[bt],Object.getOwnPropertyDescriptor(At.prototype,"GM_closeInTab"),At.prototype),(0,ne.Z)(At.prototype,"GM_getResourceText",[vt],Object.getOwnPropertyDescriptor(At.prototype,"GM_getResourceText"),At.prototype),(0,ne.Z)(At.prototype,"GM_getResourceURL",[kt],Object.getOwnPropertyDescriptor(At.prototype,"GM_getResourceURL"),At.prototype),(0,ne.Z)(At.prototype,"GM_addStyle",[Ct],Object.getOwnPropertyDescriptor(At.prototype,"GM_addStyle"),At.prototype),(0,ne.Z)(At.prototype,"GM_getTab",[Tt],Object.getOwnPropertyDescriptor(At.prototype,"GM_getTab"),At.prototype),(0,ne.Z)(At.prototype,"GM_saveTab",[St],Object.getOwnPropertyDescriptor(At.prototype,"GM_saveTab"),At.prototype),(0,ne.Z)(At.prototype,"GM_getTabs",[Mt],Object.getOwnPropertyDescriptor(At.prototype,"GM_getTabs"),At.prototype),(0,ne.Z)(At.prototype,"GM_download",[Pt],Object.getOwnPropertyDescriptor(At.prototype,"GM_download"),At.prototype),(0,ne.Z)(At.prototype,"GM_setClipboard",[Lt],Object.getOwnPropertyDescriptor(At.prototype,"GM_setClipboard"),At.prototype),(0,ne.Z)(At.prototype,"GM_cookie",[xt],Object.getOwnPropertyDescriptor(At.prototype,"GM_cookie"),At.prototype),(0,ne.Z)(At.prototype,"GM_registerMenuCommand",[It],Object.getOwnPropertyDescriptor(At.prototype,"GM_registerMenuCommand"),At.prototype),(0,ne.Z)(At.prototype,"GM_unregisterMenuCommand",[Ot],Object.getOwnPropertyDescriptor(At.prototype,"GM_unregisterMenuCommand"),At.prototype),(0,ne.Z)(At.prototype,"CAT_userConfig",[Dt],Object.getOwnPropertyDescriptor(At.prototype,"CAT_userConfig"),At.prototype),(0,ne.Z)(At.prototype,"GM_addElement",[Et],Object.getOwnPropertyDescriptor(At.prototype,"GM_addElement"),At.prototype),(0,ne.Z)(At.prototype,"CAT_fileStorage",[Nt],Object.getOwnPropertyDescriptor(At.prototype,"CAT_fileStorage"),At.prototype);const Bt={addEventListener:r.g.addEventListener.bind(r.g),removeEventListener:r.g.removeEventListener.bind(r.g),dispatchEvent:r.g.dispatchEvent.bind(r.g)},Rt=new Map,Gt=Object.getOwnPropertyDescriptors(r.g);Object.keys(Gt).forEach((e=>{const t=Gt[e];t&&t.writable&&!Bt[e]?"function"==typeof t.value?t.value.prototype?Bt[e]=t.value:Bt[e]=t.value.bind(r.g):Bt[e]=t.value:Rt.set(e,!0)}));const Ht=P.Z.create({baseURL:"".concat(st,"api/v1"),validateStatus:e=>e<500});class jt{constructor(e){this.error=e}}function qt(e){return e instanceof jt}async function Vt(e,t){let r;try{r=JSON.parse(localStorage["netdisk:token:".concat(e)])}catch(e){}if(!r||!r.accessToken){await function(e){return new Promise((t=>{const r=window.open("".concat(st,"api/v1/auth/net-disk?netDiskType=").concat(e)),s=setInterval((()=>{try{r.closed&&(clearInterval(s),t())}catch(e){clearInterval(s),t()}}),1e3)}))}(e);const s=await function(e){return Ht.get("/auth/net-disk/token?netDiskType=".concat(e)).then((e=>e.data))}(e);if(0!==s.code)return Promise.reject(new jt(new Error(s.msg)));r={accessToken:s.data.token.access_token,refreshToken:s.data.token.refresh_token,createtime:Date.now()},t=!1,localStorage["netdisk:token:".concat(e)]=JSON.stringify(r)}if(!(Date.now()>=r.createtime+36e5||t))return Promise.resolve(r.accessToken);try{const s=await function(e,t){return Ht.post("/auth/net-disk/token/refresh?netDiskType=".concat(e),{netDiskType:e,refreshToken:t}).then((e=>e.data))}(e,r.refreshToken);if(0!==s.code)return localStorage.removeItem("netdisk:token:".concat(e)),t?Vt(e):Promise.reject(new jt(new Error(s.msg)));r={accessToken:s.data.token.access_token,refreshToken:s.data.token.refresh_token,createtime:Date.now()},localStorage["netdisk:token:".concat(e)]=JSON.stringify(r)}catch(e){return Promise.resolve(r.accessToken)}return Promise.resolve(r.accessToken)}function Zt(){let e="";for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return r.forEach((t=>{t&&(t.startsWith("/")||(t="/".concat(t)),t.endsWith("/")&&(t=t.substring(0,t.length-1)),e+=t)})),e}class Kt{constructor(e,t){this.fs=e,this.file=t}async read(e){const t=await this.fs.request("https://pan.baidu.com/rest/2.0/xpan/multimedia?method=filemetas&access_token=".concat(this.fs.accessToken,"&fsids=[").concat(this.file.fsid,"]&dlink=1"));return t.list.length?"string"===e?fetch("".concat(t.list[0].dlink,"&access_token=").concat(this.fs.accessToken)).then((e=>e.text())):fetch("".concat(t.list[0].dlink,"&access_token=").concat(this.fs.accessToken)).then((e=>e.blob())):Promise.reject(new Error("file not found"))}}class Ft{constructor(e,t){this.fs=e,this.path=t}size(e){return e instanceof Blob?e.size:new Blob([e]).size}async md5(e){return e instanceof Blob?q(e):(0,C.MD5)(e).toString()}async write(e){const t=this.size(e).toString(),r=[await this.md5(e)];let s=new URLSearchParams;s.append("path",this.path),s.append("size",t),s.append("isdir","0"),s.append("autoinit","1"),s.append("rtype","3"),s.append("block_list",JSON.stringify(r));const n=new Headers;n.append("Content-Type","application/x-www-form-urlencoded");const i=await this.fs.request("http://pan.baidu.com/rest/2.0/xpan/file?method=precreate&access_token=".concat(this.fs.accessToken),{method:"POST",headers:n,body:s}).then((e=>{if(e.errno)throw new Error(JSON.stringify(e));return e.uploadid})),a=new FormData;return e instanceof Blob?a.append("file",e):a.append("file",new Blob([e])),await this.fs.request("".concat("https://d.pcs.baidu.com/rest/2.0/pcs/superfile2?method=upload&access_token=".concat(this.fs.accessToken)+"&type=tmpfile&path=").concat(encodeURIComponent(this.path),"&uploadid=").concat(i,"&partseq=0"),{method:"POST",body:a}).then((e=>{if(e.errno)throw new Error(JSON.stringify(e));return e})),s=new URLSearchParams,s.append("path",this.path),s.append("size",t),s.append("isdir","0"),s.append("block_list",JSON.stringify(r)),s.append("uploadid",i),s.append("rtype","3"),this.fs.request("https://pan.baidu.com/rest/2.0/xpan/file?method=create&access_token=".concat(this.fs.accessToken),{method:"POST",headers:n,body:s}).then((e=>{if(e.errno)throw new Error(JSON.stringify(e));return Promise.resolve()}))}}class Xt{constructor(e,t){this.path=e||"/apps",this.accessToken=t,this.systemConfig=k.instance(_e)}async verify(){const e=await Vt("baidu");return this.accessToken=e,this.list().then()}open(e){return Promise.resolve(new Kt(this,e))}openDir(e){return Promise.resolve(new Xt(Zt(this.path,e),this.accessToken))}create(e){return Promise.resolve(new Ft(this,Zt(this.path,e)))}createDir(e){e=Zt(this.path,e);const t=new URLSearchParams;t.append("path",e),t.append("size","0"),t.append("isdir","1"),t.append("rtype","3");const r=new Headers;return r.append("Content-Type","application/x-www-form-urlencoded"),this.request("https://pan.baidu.com/rest/2.0/xpan/file?method=create&access_token=".concat(this.accessToken),{method:"POST",headers:r,body:t,redirect:"follow"}).then((e=>{if(e.errno)throw new Error(JSON.stringify(e));return Promise.resolve()}))}request(e,t){const r=(t=t||{}).headers||new Headers;return r.append("".concat(this.systemConfig.scriptCatFlag,"-gm-xhr"),"true"),r.append("".concat(this.systemConfig.scriptCatFlag,"-anonymous"),"true"),t.headers=r,fetch(e,t).then((e=>e.json())).then((async r=>{if(111===r.errno||-6===r.errno){const r=await Vt("baidu",!0);return this.accessToken=r,e=e.replace(/access_token=[^&]+/,"access_token=".concat(r)),fetch(e,t).then((e=>e.json())).then((e=>{if(111===e.errno||-6===e.errno)throw new Error(JSON.stringify(e));return e}))}return r}))}delete(e){const t=[Zt(this.path,e)],r=new Headers;return r.append("Content-Type","application/x-www-form-urlencoded"),this.request("https://pan.baidu.com/rest/2.0/xpan/file?method=filemanager&access_token=".concat(this.accessToken,"&opera=delete"),{method:"POST",body:"async=0&filelist=".concat(encodeURIComponent(JSON.stringify(t))),headers:r}).then((e=>{if(e.errno)throw new Error(JSON.stringify(e));return e}))}list(){return this.request("https://pan.baidu.com/rest/2.0/xpan/file?method=list&dir=".concat(encodeURIComponent(this.path),"&order=time&access_token=").concat(this.accessToken)).then((e=>{if(e.errno){if(-9===e.errno)return[];throw new Error(JSON.stringify(e))}const t=[];return e.list.forEach((e=>{t.push({fsid:e.fs_id,name:e.server_filename,path:this.path,size:e.size,digest:e.md5,createtime:1e3*e.server_ctime,updatetime:1e3*e.server_mtime})})),t}))}getDirUrl(){return Promise.resolve("https://pan.baidu.com/disk/main#/index?category=all&path=".concat(encodeURIComponent(this.path)))}}class zt{constructor(e,t){this.fs=e,this.file=t}async read(e){const t=await this.fs.request("https://graph.microsoft.com/v1.0/me/drive/special/approot:".concat(Zt(this.file.path,this.file.name),":/content"),{},!0);return 200!==t.status?Promise.reject(await t.text()):"string"===e?t.text():t.blob()}}class Wt{constructor(e,t){this.fs=e,this.path=t}size(e){return e instanceof Blob?e.size:new Blob([e]).size}async md5(e){return e instanceof Blob?q(e):(0,C.MD5)(e).toString()}async write(e){const t=this.size(e).toString();let r=new Headers;r.append("Content-Type","application/json");const s=await this.fs.request("https://graph.microsoft.com/v1.0/me/drive/special/approot:".concat(this.path,":/createUploadSession"),{method:"POST",headers:r,body:JSON.stringify({item:{"@microsoft.graph.conflictBehavior":"replace"}})}).then((e=>{if(e.error)throw new Error(JSON.stringify(e));return e.uploadUrl}));return r=new Headers,r.append("Content-Range","bytes 0-".concat(parseInt(t,10)-1,"/").concat(t)),this.fs.request(s,{method:"PUT",body:e,headers:r})}}class Jt{constructor(e,t){this.path=e||"/",this.accessToken=t,this.systemConfig=k.instance(_e)}async verify(){const e=await Vt("onedrive");return this.accessToken=e,this.list().then()}open(e){return Promise.resolve(new zt(this,e))}openDir(e){return e.startsWith("ScriptCat")&&(e=e.substring(9)),Promise.resolve(new Jt(Zt(this.path,e),this.accessToken))}create(e){return Promise.resolve(new Wt(this,Zt(this.path,e)))}createDir(e){if(e&&e.startsWith("ScriptCat")&&(e=e.substring(9)).startsWith("/")&&(e=e.substring(1)),!e)return Promise.resolve();const t=(e=Zt(this.path,e)).split("/");let r="";t.length>2&&(r=t.slice(0,t.length-1).join("/"));const s=new Headers;return s.append("Content-Type","application/json"),""!==r&&(r=":".concat(r,":")),this.request("https://graph.microsoft.com/v1.0/me/drive/special/approot".concat(r,"/children"),{method:"POST",headers:s,body:JSON.stringify({name:t[t.length-1],folder:{},"@microsoft.graph.conflictBehavior":"replace"})}).then((e=>{if(e.errno)throw new Error(JSON.stringify(e));return Promise.resolve()}))}request(e,t,r){const s=(t=t||{}).headers||new Headers;s.append("Authorization","Bearer ".concat(this.accessToken)),t.headers=s;const n=fetch(e,t);return r?n:n.then((e=>e.json())).then((async r=>{if(r.error){if("InvalidAuthenticationToken"===r.error.code){const n=await Vt("onedrive",!0);return this.accessToken=n,s.set("Authorization","Bearer ".concat(this.accessToken)),fetch(e,t).then((e=>e.json())).then((e=>{if(e.error)throw new Error(JSON.stringify(e));return r}))}throw new Error(JSON.stringify(r))}return r}))}delete(e){return this.request("https://graph.microsoft.com/v1.0/me/drive/special/approot:".concat(Zt(this.path,e)),{method:"DELETE"},!0).then((async e=>{if(204!==e.status)throw new Error(await e.text());return e}))}list(){let{path:e}=this;return e="/"===e?"":":".concat(e,":"),this.request("https://graph.microsoft.com/v1.0/me/drive/special/approot".concat(e,"/children")).then((e=>{const t=[];return e.value.forEach((e=>{t.push({name:e.name,path:this.path,size:e.size,digest:e.eTag,createtime:new Date(e.createdDateTime).getTime(),updatetime:new Date(e.lastModifiedDateTime).getTime()})})),t}))}getDirUrl(){throw new Error("Method not implemented.")}}var Qt=r(79478);class Yt{constructor(e,t){this.client=e,this.path=t}async read(e){if("string"===e)return this.client.getFileContents(this.path,{format:"text"});{const e=await this.client.getFileContents(this.path,{format:"binary"});return Promise.resolve(new Blob([e]))}}}class $t{constructor(e,t){this.client=e,this.path=t}async write(e){let t;return t=e instanceof Blob?await this.client.putFileContents(this.path,await e.arrayBuffer()):await this.client.putFileContents(this.path,e),t?Promise.resolve():Promise.reject(new Error("write error"))}}class er{constructor(e,t,r,n){(0,s.Z)(this,"basePath","/"),"object"==typeof e?(this.client=e,this.basePath=Zt(t||""),this.url=r):(this.url=t,this.client=(0,Qt.createClient)(t,{authType:e,username:r,password:n}))}async verify(){try{await this.client.getQuota()}catch(e){if(e.response&&401===e.response.status)throw new jt(e);throw new Error("verify failed")}return Promise.resolve()}open(e){return Promise.resolve(new Yt(this.client,Zt(e.path,e.name)))}openDir(e){return Promise.resolve(new er(this.client,Zt(this.basePath,e),this.url))}create(e){return Promise.resolve(new $t(this.client,Zt(this.basePath,e)))}async createDir(e){try{return Promise.resolve(await this.client.createDirectory(Zt(this.basePath,e)))}catch(e){return e.message.includes("405")?Promise.resolve():Promise.reject(e)}}async delete(e){return this.client.deleteFile(Zt(this.basePath,e))}async list(){const e=await this.client.getDirectoryContents(this.basePath),t=[];return e.forEach((e=>{"file"===e.type&&t.push({name:e.basename,path:this.basePath,digest:e.etag||"",size:e.size,createtime:new Date(e.lastmod).getTime(),updatetime:new Date(e.lastmod).getTime()})})),Promise.resolve(t)}getDirUrl(){return Promise.resolve(this.url+this.basePath)}}var tr=r(55733),rr=r.n(tr);class sr{constructor(e){this.zipObject=e}read(e){return this.zipObject.async(e||"string")}}class nr{constructor(e,t){this.zip=e,this.path=t}write(e){return this.zip.file(this.path,e),Promise.resolve()}}class ir{constructor(e,t){this.zip=e||new(rr()),this.basePath=t||""}verify(){return Promise.resolve()}open(e){const t=e.name,r=this.zip.file(t);return r?Promise.resolve(new sr(r)):Promise.reject(new Error("File not found"))}openDir(e){return Promise.resolve(new ir(this.zip,e))}create(e){return Promise.resolve(new nr(this.zip,e))}createDir(){return Promise.resolve()}delete(e){return this.zip.remove(e),Promise.resolve()}list(){const e=[];return Object.keys(this.zip.files).forEach((t=>{e.push({name:t,path:t,size:0,digest:"",createtime:this.zip.files[t].date.getTime(),updatetime:this.zip.files[t].date.getTime()})})),Promise.resolve(e)}getDirUrl(){throw new Error("Method not implemented.")}}class ar{static create(e,t){let r;switch(e){case"zip":r=new ir(t);break;case"webdav":r=new er(t.authType,t.url,t.username,t.password);break;case"baidu-netdsik":r=new Xt;break;case"onedrive":r=new Jt;break;default:throw new Error("not found filesystem")}return r.verify().then((()=>r))}static params(){return{webdav:{authType:{title:Fe.ZP.t("auth_type"),type:"select",options:["password","digest","none","token"]},url:{title:Fe.ZP.t("url")},username:{title:Fe.ZP.t("username")},password:{title:Fe.ZP.t("password"),type:"password"}},"baidu-netdsik":{},onedrive:{}}}static async mkdirAll(e,t){return new Promise(((r,s)=>{const n=t.split("/");let i=0;const a=()=>{if(i>=n.length)return void r();const t=n.slice(0,i+1).join("/");e.createDir(t).then((()=>{i+=1,a()})).catch((()=>{s()}))};a()}))}}class or extends b{constructor(){super(),(0,s.Z)(this,"tableName","permission"),this.table=f.table(this.tableName)}}class cr{constructor(){(0,s.Z)(this,"list",[])}push(e){this.resolve?(this.resolve(e),this.resolve=void 0):this.list.push(e)}pop(){return new Promise((e=>{this.list.length>0?e(this.list.shift()):this.resolve=e}))}}class lr{static API(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t,r,s)=>{const n=r;e.listener&&e.listener(),lr.apis.set(n,{api:s.value,param:e});const i=n.replace("_",".");i!==n&&(lr.apis.set(i,{api:s.value,param:e}),e.alias?e.alias.push(i):e.alias=[i]),e.alias&&e.alias.forEach((t=>{lr.apis.set(t,{api:s.value,param:e})}))}}removePermissionCache(e){L.getInstance().list().forEach((t=>{t.startsWith("permission:".concat(e.toString(),":"))&&L.getInstance().del(t)}))}constructor(){(0,s.Z)(this,"confirmQueue",new cr),(0,s.Z)(this,"confirmMap",new Map),this.permissionDAO=new or;const e=k.instance(m);e.setHandler("permissionConfirm",((e,t)=>{const r=this.confirmMap.get(t.uuid);return r?(this.confirmMap.delete(t.uuid),r.resolve(t.userConfirm),Promise.resolve(!0)):0===t.userConfirm.type?Promise.resolve(void 0):Promise.reject(new Error("confirm not found"))})),e.setHandler("getConfirm",((e,t)=>{const r=this.confirmMap.get(t);if(!r)return Promise.reject(new Error("uuid not found"));let s=0;return r.confirm.wildcard&&this.confirmQueue.list.forEach((e=>{const t=e.confirm;t.wildcard&&e.request.scriptId===r.script.id&&t.permission===r.confirm.permission&&(s+=1)})),Promise.resolve({script:r.script,confirm:r.confirm,likeNum:s})})),e.setHandler("deletePermission",(async(e,t)=>{this.removePermissionCache(t.scriptId);const r=await this.permissionDAO.findOne({scriptId:t.scriptId,permission:t.confirm.permission,permissionValue:t.confirm.permissionValue||""});return r?(await this.permissionDAO.delete(r.id),Promise.resolve(!0)):Promise.resolve(!0)})),e.setHandler("addPermission",(async(e,t)=>{this.removePermissionCache(t.scriptId);const r=await this.permissionDAO.findOne({scriptId:t.scriptId,permission:t.permission.permission,permissionValue:t.permission.permissionValue||""});return r?(t.permission.id=r.id,t.permission.createtime=r.createtime,t.permission.updatetime=(new Date).getTime(),this.permissionDAO.update(r.id,t.permission),Promise.resolve(!0)):(await this.permissionDAO.save(t.permission),Promise.resolve(!0))})),e.setHandler("resetPermission",(async(e,t)=>(this.removePermissionCache(t.scriptId),await this.permissionDAO.delete({scriptId:t.scriptId}),Promise.resolve(!0)))),this.dealConfirmQueue()}verify(e,t){if(t.param.default)return Promise.resolve(!0);const{grant:r}=e.script.metadata;if(!r)return Promise.reject(new Error("grant is undefined"));for(let s=0;s<r.length;s+=1)if(r[s]===e.api||t.param.alias&&t.param.alias.includes(r[s])||r[s]===t.param.link)return t.param.confirm?this.pushConfirmQueue(e,t):Promise.resolve(!0);return Promise.reject(new Error("permission not requested"))}async dealConfirmQueue(){const e=await this.confirmQueue.pop();if(e){try{const t=await this.confirm(e.request,e.confirm);e.resolve(t)}catch(t){e.reject(t)}this.dealConfirmQueue()}else this.dealConfirmQueue()}async pushConfirmQueue(e,t){const r=await t.param.confirm(e);return!0===r?Promise.resolve(!0):new Promise(((t,s)=>{this.confirmQueue.push({request:e,confirm:r,resolve:t,reject:s})}))}async confirm(e,t){if("boolean"==typeof t)return t;const r=W.permissionConfirm(e.script.id,t),s=await L.getInstance().getOrSet(r,(async()=>{let r=await this.permissionDAO.findOne({scriptId:e.scriptId,permission:t.permission,permissionValue:t.permissionValue||""});return r||t.wildcard&&(r=await this.permissionDAO.findOne({scriptId:e.scriptId,permission:t.permission,permissionValue:"*"})),Promise.resolve(r)}));if(s)return s.allow?Promise.resolve(!0):Promise.reject(new Error("permission denied"));const n=await this.confirmWindow(e.script,t),i={id:0,scriptId:e.scriptId,permission:t.permission,permissionValue:"",allow:n.allow,createtime:(new Date).getTime(),updatetime:0};switch(n.type){case 4:case 2:i.permissionValue="*";break;case 5:case 3:i.permissionValue=t.permissionValue||""}if(n.type>=2&&L.getInstance().set(r,i),n.type>=4){const t=await this.permissionDAO.findOne({scriptId:e.scriptId,permission:i.permission,permissionValue:i.permissionValue});t?await this.permissionDAO.update(t.id,i):await this.permissionDAO.save(i)}return n.allow?Promise.resolve(!0):Promise.reject(new Error("permission not allowed"))}async confirmWindow(e,t){return new Promise(((r,s)=>{const n=(0,p.Z)(),i=setTimeout((()=>{this.confirmMap.delete(n),s(new Error("permission confirm timeout"))}),4e4);this.confirmMap.set(n,{confirm:t,script:e,resolve:e=>{clearTimeout(i),r(e)},reject:s}),chrome.tabs.create({url:chrome.runtime.getURL("src/confirm.html?uuid=".concat(n))})}))}}(0,s.Z)(lr,"apis",new Map),(0,s.Z)(lr,"textarea",document.createElement("textarea"));const dr={"user-agent":!0,"proxy-":!0,"sec-":!0,cookie:!0,"accept-charset":!0,"accept-encoding":!0,"access-control-request-headers":!0,"access-control-request-method":!0,connection:!0,"content-length":!0,date:!0,dnt:!0,expect:!0,"feature-policy":!0,host:!0,"keep-alive":!0,origin:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,via:!0},pr={"set-cookie":!0};function ur(e){return!!(e.initiator&&chrome.runtime.getURL("").startsWith(e.initiator)||e.originUrl&&e.originUrl.startsWith(chrome.runtime.getURL("")))}function hr(e,t,r){if(r.setRequestHeader("".concat(e,"-gm-xhr"),"true"),t.headers){let s=!1;Object.keys(t.headers).forEach((n=>{const i=n.toLowerCase();"origin"===i&&(s=!0);try{dr[i]||i.startsWith("sec-")||i.startsWith("proxy-")?r.setRequestHeader("".concat(e,"-").concat(i),t.headers[n]):r.setRequestHeader(n,t.headers[n])}catch(e){d.getLogger(l.E(e)).error("GM XHR setRequestHeader error")}})),s||r.setRequestHeader("".concat(e,"-origin"),"")}if(void 0!==t.maxRedirects&&r.setRequestHeader("".concat(e,"-max-redirects"),t.maxRedirects.toString()),t.cookie)try{r.setRequestHeader("".concat(e,"-cookie"),t.cookie)}catch(e){d.getLogger(l.E(e)).error("GM XHR setRequestHeader cookie error")}t.anonymous&&r.setRequestHeader("".concat(e,"-anonymous"),"true")}function _r(e,t){const r={};return r["".concat(e,"-gm-xhr")]="true",t.headers&&Object.keys(t.headers).forEach((s=>{const n=s.toLowerCase();dr[n]||n.startsWith("sec-")||n.startsWith("proxy-")?r["".concat(e,"-").concat(n)]=t.headers[s]:r[s]=t.headers[s]})),void 0!==t.maxRedirects&&(r["".concat(e,"-max-redirects")]=t.maxRedirects.toString()),t.cookie&&(r["".concat(e,"-cookie")]=t.cookie),t.anonymous&&(r["".concat(e,"-anonymous")]="true"),r}function mr(e,t,r,s){const n=new RegExp("".concat(e,"-"),"g");let i="";r.headers&&r.headers.forEach(((e,t)=>{i+="".concat(t.replace(n,""),": ").concat(e,"\n")}));return{finalUrl:r.url||t.url,readyState:s,status:r.status,statusText:r.statusText,responseHeaders:i,responseType:t.responseType}}function gr(e){e.forEach(((e,t)=>{chrome.contextMenus.create({id:"scriptMenu_".concat(t),title:e[0].request.script.name,contexts:["all"],parentId:"scriptMenu"}),e.forEach((e=>{chrome.contextMenus.create({id:"scriptMenu_menu_".concat(t,"_").concat(e.request.params[0]),title:e.request.params[1],contexts:["all"],parentId:"scriptMenu_".concat(t),onclick:()=>{k.instance(g).sendNative({tag:e.request.sender.targetTag,id:[e.request.sender.frameId||e.request.sender.tabId||0]},{stream:e.channel.flag,channel:!0,data:"click"})}})}))}))}function wr(e,t){chrome.contextMenus.removeAll();const r=t.get(e),s=t.get("sandbox");(r||s)&&(chrome.contextMenus.create({id:"scriptMenu",title:"ScriptCat",contexts:["all"]}),r&&gr(r),"sandbox"!==e&&s&&gr(s))}var fr,yr,br,vr,kr,Cr,Tr,Sr,Mr,Pr,Lr,xr,Ir,Or,Dr,Er,Nr,Ar,Ur,Br;let Rr=(fr=lr.API(),yr=lr.API({confirm:e=>{const t=e.params[0],r=new URL(t.url);if(e.script.metadata.connect){const{connect:t}=e.script.metadata;for(let e=0;e<t.length;e+=1)if(r.hostname.endsWith(t[e]))return Promise.resolve(!0)}const s={};return s[Fe.ZP.t("script_name")]=tt(e.script),s[Fe.ZP.t("request_domain")]=r.hostname,s[Fe.ZP.t("request_url")]=t.url,Promise.resolve({permission:"cors",permissionValue:r.hostname,title:Fe.ZP.t("script_accessing_cross_origin_resource"),metadata:s,describe:Fe.ZP.t("confirm_operation_description"),wildcard:!0,permissionContent:Fe.ZP.t("domain")})},alias:["GM.xmlHttpRequest"]}),br=lr.API({listener(){chrome.notifications.onClosed.addListener(((e,t)=>{const r=L.getInstance().get("GM_notification:".concat(e));if(r){const s=r;s.send({event:"done",id:e,user:t}),s.disChannel(),L.getInstance().del("GM_notification:".concat(e))}})),chrome.notifications.onClicked.addListener((e=>{const t=L.getInstance().get("GM_notification:".concat(e));if(t){const r=t;r.send({event:"click",id:e,index:void 0}),r.send({event:"done",id:e,user:!0}),r.disChannel(),L.getInstance().del("GM_notification:".concat(e))}})),chrome.notifications.onButtonClicked.addListener(((e,t)=>{const r=L.getInstance().get("GM_notification:".concat(e));if(r){const s=r;s.send({event:"click",id:e,index:t}),s.send({event:"done",id:e,user:!0}),s.disChannel(),L.getInstance().del("GM_notification:".concat(e))}}))}}),vr=lr.API(),kr=lr.API(),Cr=lr.API(),Tr=lr.API({listener:()=>{chrome.tabs.onRemoved.addListener((e=>{const t=L.getInstance().get("GM_openInTab:".concat(e));t&&(t.send({event:"onclose"}),t.disChannel(),L.getInstance().del("GM_openInTab:".concat(e)))}))}}),Sr=lr.API({link:"GM_openInTab"}),Mr=lr.API({listener:()=>{chrome.tabs.onRemoved.addListener((e=>{Rr.tabData.forEach((t=>{t.forEach(((r,s)=>{s===e&&t.delete(s)}))}))}))}}),Pr=lr.API(),Lr=lr.API(),xr=lr.API(),Ir=lr.API({listener(){lr.textarea.style.display="none",document.documentElement.appendChild(lr.textarea),document.addEventListener("copy",(e=>{if(!Rr.clipboardData||!e.clipboardData)return;e.preventDefault();const{type:t,data:r}=Rr.clipboardData;e.clipboardData.setData(t||"text/plain",r),Rr.clipboardData=void 0}))}}),Or=lr.API({confirm(e){if("store"===e.params[0])return Promise.resolve(!0);const t=e.params[1];if(!t.url&&!t.domain)return Promise.reject(new Error("there must be one of url or domain"));let r={};t.url?r=new URL(t.url):(r.host=t.domain||"",r.hostname=t.domain||"");let s=!1;if(e.script.metadata.connect){const{connect:t}=e.script.metadata;for(let e=0;e<t.length;e+=1)if(r.hostname.endsWith(t[e])){s=!0;break}}if(!s)return Promise.reject(new Error("hostname must be in the definition of connect"));const n={};return n[Fe.ZP.t("script_name")]=tt(e.script),n[Fe.ZP.t("request_domain")]=r.host,Promise.resolve({permission:"cookie",permissionValue:r.host,title:Fe.ZP.t("access_cookie_content"),metadata:n,describe:Fe.ZP.t("confirm_script_operation"),permissionContent:Fe.ZP.t("cookie_domain"),uuid:""})}}),Dr=lr.API(),Er=lr.API(),Nr=lr.API(),Ar=lr.API({confirm:e=>{const[t,r]=e.params;if("config"===t)return Promise.resolve(!0);const s=r.baseDir?r.baseDir:e.script.uuid,n={};return n[Fe.ZP.t("script_name")]=tt(e.script),Promise.resolve({permission:"file_storage",permissionValue:s,title:Fe.ZP.t("script_operation_title"),metadata:n,describe:Fe.ZP.t("script_operation_description",{dir:s}),wildcard:!1,permissionContent:Fe.ZP.t("script_permission_content")})},alias:["GM.xmlHttpRequest"]}),Br=class e{constructor(e,t){(0,s.Z)(this,"logger",d.getLogger({component:"GMApi"})),this.message=e,this.script=new O,this.permissionVerify=t,this.systemConfig=k.instance(_e),t instanceof lr&&(this.systemConfig.scriptCatFlag="x-cat-".concat((0,p.Z)())),this.valueManager=k.instance(qe)}start(){this.message.setHandler("gmApi",(async(e,t,r)=>{const s=lr.apis.get(t.api);if(!s)return Promise.reject(new Error("api is not found"));const n=await this.parseRequest(t,r);try{await this.permissionVerify.verify(n,s)}catch(e){return this.logger.error("verify error",{api:t.api},l.E(e)),Promise.reject(e)}return s.api.call(this,n)})),this.message.setHandlerWithChannel("gmApiChannel",(async(e,t,r,s)=>{const n=lr.apis.get(r.api);if(!n)return e.throw("api is not found");const i=await this.parseRequest(r,s);try{await this.permissionVerify.verify(i,n)}catch(t){return this.logger.error("verify error",{api:r.api},l.E(t)),e.throw(t.message)}return n.api.call(this,i,e)})),this.permissionVerify instanceof lr&&function(e){const t=["blocking","requestHeaders"],r=["blocking","responseHeaders"];R()||(t.push("extraHeaders"),r.push("extraHeaders"));const s=new Map,n=new Map;chrome.webRequest.onBeforeSendHeaders.addListener((t=>{var r;if(!ur(t))return{};let n="",i="",a=!1,o=!1;const c=[],l={};return null===(r=t.requestHeaders)||void 0===r||r.forEach((r=>{const d=r.name.toLowerCase();if(d.startsWith("".concat(e,"-"))){const n=d.substring(e.length+1);switch(n){case"cookie":i=r.value||"";break;case"max-redirects":s.set(t.requestId,[0,parseInt(r.value||"",10)]);break;case"anonymous":a=!0;break;case"gm-xhr":o=!0;break;default:l[n]=r.value||null}}else"cookie"===d?n=r.value||"":dr[d]||d.startsWith("sec-")||d.startsWith("proxy-")?null!==l[d]&&(l[d]=l[d]||r.value||""):c.push(r)})),o?(a&&(n=""),i&&(!n||n.endsWith(";")?n+=i:n+=";".concat(i)),n&&c.push({name:"Cookie",value:n}),Object.keys(l).forEach((e=>{null!==l[e]&&c.push({name:e,value:l[e]})})),{requestHeaders:c}):{}}),{urls:["<all_urls>"]},t),chrome.webRequest.onHeadersReceived.addListener((t=>{var r,i;if(!ur(t)){if("main_frame"!==t.type&&"sub_frame"!==t.type||!R())return{};if(k.instance(jr).matchUrl(t.url,(e=>"sub_frame"===t.type&&!!e.metadata.noframes||e.status!==I)).length>0&&t.responseHeaders){for(let e=0;e<t.responseHeaders.length;e+=1)"content-security-policy"===t.responseHeaders[e].name.toLowerCase()&&(t.responseHeaders[e].value="");return{responseHeaders:t.responseHeaders}}return{}}const a=[];var o;return null===(r=t.responseHeaders)||void 0===r||r.forEach((r=>{const i=r.name.toLowerCase();if(pr[i]){const t={...r};t.name="".concat(e,"-").concat(r.name),a.push(t)}if("location"===i){n.set(t.requestId,!0);const i=s.get(t.requestId);i&&(i[0]+=1,i[0]>i[1]&&(r.name="".concat(e,"-").concat(r.name)))}})),null===(i=t.responseHeaders)||void 0===i||i.push(...a),n.has(t.requestId)&&(null===(o=t.responseHeaders)||void 0===o||o.push({name:"".concat(e,"-final-url"),value:t.url})),{responseHeaders:t.responseHeaders}}),{urls:["<all_urls>"]},r),chrome.webRequest.onCompleted.addListener((e=>{ur(e)&&(s.delete(e.requestId),n.delete(e.requestId))}),{urls:["<all_urls>"]})}(this.systemConfig.scriptCatFlag),this.message.setHandler("CAT_createBlobUrl",((e,t)=>{const r=URL.createObjectURL(t);return setTimeout((()=>{URL.revokeObjectURL(r)}),6e4),Promise.resolve(r)})),this.message.setHandler("CAT_fetchBlob",((e,t)=>fetch(t).then((e=>e.blob()))))}async parseRequest(e,t){const r=await L.getInstance().getOrSet(W.script(e.scriptId),(()=>this.script.findById(e.scriptId)));if(!r)return Promise.reject(new Error("script is not found"));const s=e;return s.script=r,s.sender=t,Promise.resolve(s)}GM_setValue(e){if(!e.params||2!==e.params.length)return Promise.reject(new Error("param is failed"));const[t,r]=e.params,s=e.sender;return s.runFlag=e.runFlag,this.valueManager.setValue(e.script,t,r,s)}CAT_fetch(e,t){const r=e.params[0],{url:s}=r;return fetch(s,{method:r.method||"GET",body:r.data,headers:_r(this.systemConfig.scriptCatFlag,r)}).then((e=>{var s;const n=mr(this.systemConfig.scriptCatFlag,r,e,1),i=null===(s=e.body)||void 0===s?void 0:s.getReader();if(!i)throw new Error("read is not found");const{scriptCatFlag:a}=this.systemConfig;i.read().then((function s(n){let{done:o,value:c}=n;if(o){const s=mr(a,r,e,4);t.send({event:"onreadystatechange",data:s}),t.send({event:"onload",data:s}),t.send({event:"onloadend",data:s}),t.disChannel()}else t.send({event:"onstream",data:Array.from(c)}),i.read().then(s)})),t.send({event:"onloadstart",data:n}),n.readyState=2,t.send({event:"onreadystatechange",data:n})})).catch((e=>{t.throw(e)}))}async GM_xmlhttpRequest(e,t){const r=e.params[0];if("stream"===r.responseType)return this.CAT_fetch(e,t);const s=new XMLHttpRequest;s.open(r.method||"GET",r.url,!0,r.user||"",r.password||""),r.overrideMimeType&&s.overrideMimeType(r.overrideMimeType),"json"!==r.responseType&&(s.responseType=r.responseType||"");const n=async(e,n)=>{const i=await async function(e,t,r){let s=r.responseURL||t.url;const n=r.getResponseHeader("".concat(e,"-final-url"));n&&(s=n);const i=new RegExp("".concat(e,"-"),"g"),a={finalUrl:s,readyState:r.readyState,status:r.status,statusText:r.statusText,responseHeaders:r.getAllResponseHeaders().replace(i,""),responseType:t.responseType};var o,c;if(4===r.readyState)if("arraybuffer"===(null===(o=t.responseType)||void 0===o?void 0:o.toLowerCase())||"blob"===(null===(c=t.responseType)||void 0===c?void 0:c.toLowerCase())){let e;r.response instanceof ArrayBuffer?(e=new Blob([r.response]),a.response=URL.createObjectURL(e)):(e=r.response,a.response=URL.createObjectURL(e));try{var p;-1!==(null===(p=r.getResponseHeader("Content-Type"))||void 0===p?void 0:p.indexOf("text"))&&(a.responseText=await e.text())}catch(e){d.getLogger(l.E(e)).error("GM XHR getResponseHeader error")}setTimeout((()=>{URL.revokeObjectURL(a.response)}),6e4)}else if("json"===t.responseType){try{a.response=JSON.parse(r.responseText)}catch(e){d.getLogger(l.E(e)).error("GM XHR JSON parse error")}try{a.responseText=r.responseText}catch(e){d.getLogger(l.E(e)).error("GM XHR getResponseText error")}}else{try{a.response=r.response}catch(e){d.getLogger(l.E(e)).error("GM XHR response error")}try{a.responseText=r.responseText||void 0}catch(e){d.getLogger(l.E(e)).error("GM XHR getResponseText error")}}return Promise.resolve(a)}(this.systemConfig.scriptCatFlag,r,s);n&&Object.keys(n).forEach((e=>{i[e]=n[e]})),t.send({event:e,data:i}),"onload"===e&&t.disChannel()};if(s.onload=()=>{n("onload")},s.onloadstart=()=>{n("onloadstart")},s.onloadend=()=>{n("onloadstart")},s.onabort=()=>{n("onabort")},s.onerror=()=>{n("onerror")},s.onprogress=e=>{const t={done:s.DONE,lengthComputable:e.lengthComputable,loaded:e.loaded,total:e.total,totalSize:e.total};n("onprogress",t)},s.onreadystatechange=()=>{n("onreadystatechange")},s.ontimeout=()=>{t.send({event:"ontimeout"})},hr(this.systemConfig.scriptCatFlag,r,s),r.timeout&&(s.timeout=r.timeout),r.overrideMimeType&&s.overrideMimeType(r.overrideMimeType),"FormData"===r.dataType){const e=new FormData;r.data&&r.data instanceof Array&&(r.data.forEach((t=>{"file"===t.type?e.append(t.key,X(t.val),t.filename):e.append(t.key,t.val)})),s.send(e))}else if("Blob"===r.dataType){if(!r.data)return t.throw("data is null");const e=await(await fetch(r.data)).blob();s.send(e)}else s.send(r.data);return t.setDisChannelHandler((()=>{s.abort()})),Promise.resolve()}GM_notification(e,t){if(0===e.params.length)return t.throw("param is failed");const r=e.params[0],s={title:r.title||"ScriptCat",message:r.text||"无消息内容",iconUrl:r.image||(n=e.script,n.metadata.icon&&n.metadata.icon[0]||n.metadata.iconurl&&n.metadata.iconurl[0]||n.metadata.defaulticon&&n.metadata.defaulticon[0]||n.metadata.icon64&&n.metadata.icon64[0]||n.metadata.icon64url&&n.metadata.icon64url[0])||chrome.runtime.getURL("assets/logo.png"),type:R()||void 0===r.progress?"basic":"progress"};var n;return R()||(s.silent=r.silent,s.buttons=r.buttons),chrome.notifications.create(s,(e=>{L.getInstance().set("GM_notification:".concat(e),t),t.send({event:"create",id:e}),r.timeout&&setTimeout((()=>{chrome.notifications.clear(e),t.send({event:"done",id:e,user:!1}),t.disChannel(),L.getInstance().del("GM_notification:".concat(e))}),r.timeout)})),!0}GM_closeNotification(e){chrome.notifications.clear(e.params[0]);const t=L.getInstance().get("GM_notification:".concat(e.params[0]));if(t){t.send({event:"done",id:e.params[0],user:!1}),L.getInstance().del("GM_notification:".concat(e.params[0]))}return Promise.resolve(!0)}GM_updateNotification(e){if(R())return Promise.reject(new Error("firefox does not support this method"));const t=e.params[0],r=e.params[1],s={title:r.title,message:r.text,iconUrl:r.image,type:void 0===r.progress?"basic":"progress",silent:r.silent,progress:r.progress};return chrome.notifications.update(t,s),Promise.resolve(!0)}GM_log(e){const t=e.params[0],r=e.params[1]||"info",s=e.params[2]||{};return d.getLogger(s).log(r,t,{scriptId:e.scriptId,component:"GM_log"}),Promise.resolve(!0)}GM_openInTab(e,t){const r=e.params[0],s=e.params[1]||{};if(!0===s.useOpen){window.open(r)?chrome.tabs.query({active:!0},(e=>{let[r]=e;L.getInstance().set("GM_openInTab:".concat(r.id),t),t.send({event:"oncreate",tabId:r.id})})):(t.send({event:"onclose"}),t.disChannel())}else chrome.tabs.create({url:r,active:s.active},(e=>{L.getInstance().set("GM_openInTab:".concat(e.id),t),t.send({event:"oncreate",tabId:e.id})}))}async GM_closeInTab(e){try{await chrome.tabs.remove(e.params[0])}catch(e){this.logger.error("GM_closeInTab",l.E(e))}return Promise.resolve(!0)}GM_getTab(t){var r;return Promise.resolve(null===(r=e.tabData.get(t.scriptId))||void 0===r?void 0:r.get(t.sender.tabId||t.sender.targetTag))}GM_saveTab(t){var r;const s=t.params[0],n=t.sender.tabId||t.sender.targetTag;return e.tabData.has(t.scriptId)||e.tabData.set(t.scriptId,new Map),null===(r=e.tabData.get(t.scriptId))||void 0===r||r.set(n,s),Promise.resolve(!0)}GM_getTabs(t){var r;if(!e.tabData.has(t.scriptId))return Promise.resolve({});const s={};return null===(r=e.tabData.get(t.scriptId))||void 0===r||r.forEach(((e,t)=>{s[t]=e})),Promise.resolve(s)}GM_download(e,t){const r=e.params[0];if(r.url.startsWith("blob:"))return void chrome.downloads.download({url:r.url,saveAs:r.saveAs,filename:r.name},(()=>{t.send({event:"onload"})}));const s=new XMLHttpRequest;s.open(r.method||"GET",r.url,!0),s.responseType="blob";const n=(e,n)=>{const i=new RegExp("".concat(this.systemConfig.scriptCatFlag,"-"),"g"),a={finalUrl:s.responseURL||r.url,readyState:s.readyState,status:s.status,statusText:s.statusText,responseHeaders:s.getAllResponseHeaders().replace(i,"")};n&&Object.keys(n).forEach((e=>{a[e]=n[e]})),t.send({event:e,data:a})};s.onload=()=>{n("onload");const e=URL.createObjectURL(s.response);setTimeout((()=>{URL.revokeObjectURL(e)}),6e3),chrome.downloads.download({url:e,saveAs:r.saveAs,filename:r.name})},s.onerror=()=>{n("onerror")},s.onprogress=e=>{const t={done:s.DONE,lengthComputable:e.lengthComputable,loaded:e.loaded,total:e.total,totalSize:e.total};n("onprogress",t)},s.ontimeout=()=>{t.send({event:"ontimeout"})},hr(this.systemConfig.scriptCatFlag,r,s),r.timeout&&(s.timeout=r.timeout),s.send(),t.setDisChannelHandler((()=>{s.abort()}))}GM_setClipboard(t){return new Promise((r=>{e.clipboardData={type:t.params[1],data:t.params[0]},lr.textarea.focus(),document.execCommand("copy",!1,null),r(void 0)}))}GM_cookie(e){return new Promise(((t,r)=>{const s=e.params;if(2!==s.length)return void r(new Error("there must be two parameters"));const n=e.params[1];if("store"!==s[0])if(n.url&&(n.url=n.url.trim()),n.domain&&(n.domain=n.domain.trim()),n.url||n.domain)switch(s[0]){case"list":chrome.cookies.getAll({domain:n.domain,name:n.name,path:n.path,secure:n.secure,session:n.session,url:n.url,storeId:n.storeId},(e=>{t(e)}));break;case"delete":if(!n.url||!n.name)return void r(new Error("delete operation must have url and name"));chrome.cookies.remove({name:n.name,url:n.url,storeId:n.storeId},(()=>{t(void 0)}));break;case"set":if(!n.url||!n.name)return void r(new Error("set operation must have name and value"));chrome.cookies.set({url:n.url,name:n.name,domain:n.domain,value:n.value,expirationDate:n.expirationDate,path:n.path,httpOnly:n.httpOnly,secure:n.secure,storeId:n.storeId},(()=>{t(void 0)}));break;default:r(new Error("action can only be: get, set, delete, store"))}else r(new Error("there must be one of url or domain"));else chrome.cookies.getAllCookieStores((e=>{const r=[];e.forEach((e=>{if(n.tabId){for(let t=0;t<e.tabIds.length;t+=1)if(e.tabIds[t]===n.tabId){r.push({storeId:e.id});break}}else r.push({storeId:e.id})})),t(r)}))}))}GM_registerMenuCommand(t,r){return e.hook.trigger("registerMenu",t,r),r.setDisChannelHandler((()=>{e.hook.trigger("unregisterMenu",t.params[0],t)})),Promise.resolve()}GM_unregisterMenuCommand(t){e.hook.trigger("unregisterMenu",t.params[0],t)}CAT_userConfig(e){chrome.tabs.create({url:"/src/options.html#/?userConfig=".concat(e.scriptId),active:!0})}async CAT_fileStorage(e,t){const[r,s]=e.params;if("config"===r)return chrome.tabs.create({url:"/src/options.html#/setting",active:!0}),Promise.resolve(!0);const n=this.systemConfig.catFileStorage;if("unset"===n.status)return t.throw({code:1,error:"file storage is disable"});if("error"===n.status)return t.throw({code:2,error:"file storge is error"});let i;const a="ScriptCat/app/".concat(s.baseDir?s.baseDir:e.script.uuid);try{i=await ar.create(n.filesystem,n.params[n.filesystem]),await ar.mkdirAll(i,a),i=await i.openDir(a)}catch(e){return qt(e)?(n.status="error",this.systemConfig.catFileStorage=n,t.throw({code:2,error:e.error.message})):t.throw({code:8,error:e.message})}switch(r){case"list":i.list().then((e=>{e.forEach((e=>{e.absPath=e.path,e.path=Zt(e.path.substring(e.path.indexOf(a)+a.length))})),t.send({action:"onload",data:e}),t.disChannel()})).catch((e=>{t.throw({code:3,error:e.message})}));break;case"upload":(await i.create(s.path)).write(await(await fetch(s.data)).blob()).then((()=>{t.send({action:"onload",data:!0}),t.disChannel()})).catch((e=>{t.throw({code:4,error:e.message})}));break;case"download":const e=s.file;i=await i.openDir("".concat(e.path));(await i.open({fsid:e.fsid,name:e.name,path:e.absPath,size:e.size,digest:e.digest,createtime:e.createtime,updatetime:e.updatetime})).read("blob").then((e=>{const r=URL.createObjectURL(e);setTimeout((()=>{URL.revokeObjectURL(r)}),6e3),t.send({action:"onload",data:r}),t.disChannel()})).catch((e=>{t.throw({code:5,error:e.message})}));break;case"delete":i.delete("".concat(s.path)).then((()=>{t.send({action:"onload",data:!0}),t.disChannel()})).catch((e=>{t.throw({code:6,error:e.message})}));break;default:t.disChannel()}}},(0,s.Z)(Br,"hook",new n),(0,s.Z)(Br,"tabData",new Map),Ur=Br,(0,ne.Z)(Ur.prototype,"GM_setValue",[fr],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_setValue"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_xmlhttpRequest",[yr],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_xmlhttpRequest"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_notification",[br],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_notification"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_closeNotification",[vr],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_closeNotification"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_updateNotification",[kr],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_updateNotification"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_log",[Cr],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_log"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_openInTab",[Tr],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_openInTab"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_closeInTab",[Sr],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_closeInTab"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_getTab",[Mr],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_getTab"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_saveTab",[Pr],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_saveTab"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_getTabs",[Lr],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_getTabs"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_download",[xr],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_download"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_setClipboard",[Ir],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_setClipboard"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_cookie",[Or],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_cookie"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_registerMenuCommand",[Dr],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_registerMenuCommand"),Ur.prototype),(0,ne.Z)(Ur.prototype,"GM_unregisterMenuCommand",[Er],Object.getOwnPropertyDescriptor(Ur.prototype,"GM_unregisterMenuCommand"),Ur.prototype),(0,ne.Z)(Ur.prototype,"CAT_userConfig",[Nr],Object.getOwnPropertyDescriptor(Ur.prototype,"CAT_userConfig"),Ur.prototype),(0,ne.Z)(Ur.prototype,"CAT_fileStorage",[Ar],Object.getOwnPropertyDescriptor(Ur.prototype,"CAT_fileStorage"),Ur.prototype),Ur);var Gr,Hr;let jr=k.Singleton(m,se,qe)((Hr=class e extends te{constructor(e,t,r){super(e,"runtime"),(0,s.Z)(this,"match",new Ze),(0,s.Z)(this,"include",new Ke),(0,s.Z)(this,"customizeExclude",new Ze),(0,s.Z)(this,"runBackScript",new Map),this.scriptDAO=new O,this.resourceManager=t,this.valueManager=r,this.logger=d.getInstance().logger({component:"runtime"}),Ue.hook.addListener("upsert",this.scriptUpdate.bind(this)),Ue.hook.addListener("delete",this.scriptDelete.bind(this)),Ue.hook.addListener("enable",this.scriptUpdate.bind(this)),Ue.hook.addListener("disable",this.scriptUpdate.bind(this))}start(){this.listenEvent("start",(e=>this.scriptDAO.findById(e).then((e=>{if(!e)throw new Error("script not found");return this.startBackgroundScript(e)})).catch((e=>{throw this.logger.error("run error",l.E(e)),e})))),this.listenEvent("stop",(e=>this.scriptDAO.findById(e).then((t=>{if(!t)throw new Error("script not found");return this.stopBackgroundScript(e)})).catch((e=>{throw this.logger.error("stop error",l.E(e)),e})))),this.listenScriptRunStatus(),this.scriptDAO.table.toArray((e=>{e.forEach((e=>{e?e.type===x&&(e.status===I?this.enable(e):this.disable(e)):this.logger.error("script is null")}))}));const t=new Map;Rr.hook.addListener("registerMenu",((e,r)=>{let s;s=e.sender.tabId?e.sender.tabId:e.sender.targetTag;let n=t.get(s);n||(n=new Map,t.set(s,n));let i=n.get(e.scriptId);i||(i=[],n.set(e.scriptId,i));for(let t=0;t<i.length;t+=1)if(i[t].request.params[0]===e.params[0])return void r.disChannel();i.push({request:e,channel:r}),wr(s,t)})),Rr.hook.addListener("unregisterMenu",((e,r)=>{let s;s=r.sender.tabId?r.sender.tabId:r.sender.targetTag;const n=t.get(s);if(n){const i=n.get(r.scriptId);if(i){for(let t=0;t<i.length;t+=1)if(i[t].request.params[0]===e){i.splice(t,1);break}0===i.length&&n.delete(r.scriptId)}n.size||t.delete(s)}wr(s,t)})),chrome.tabs.onActivated.addListener((e=>{wr(e.tabId,t)})),e.hook.addListener("runStatus",(async e=>{const t=await this.scriptDAO.findById(e);t&&(t.status!==I&&"running"!==t.runStatus?this.runBackScript.delete(e):this.runBackScript.set(e,t))}));const r=new Map,s=function(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=r.get(e);i||(i=new Map,r.set(e,i));let a=i.get(t.id);a||(a={script:t,runNum:0,runNumByIframe:0},i.set(t.id,a)),t.status===I&&(a.runNum+=n,s&&(a.runNumByIframe+=n))};chrome.tabs.onRemoved.addListener((e=>{r.delete(e)})),this.message.setHandler("queryPageScript",(async(e,s)=>{let{url:n,tabId:i}=s;const a=t.get(i),o=r.get(i);let c=[];c=o?Array.from(o.values()):this.matchUrl(n).map((e=>({runNum:0,runNumByIframe:0,script:e})));const l=c.map((async e=>{const t=[];var r;a&&(null===(r=a.get(e.script.id))||void 0===r||r.forEach((e=>{t.push({name:e.request.params[1],accessKey:e.request.params[2],id:e.request.params[0],sender:e.request.sender,channelFlag:e.channel.flag})})));const s=await this.scriptDAO.findById(e.script.id);return s?{id:s.id,name:tt(s),enable:s.status===I,updatetime:s.updatetime||s.createtime,metadata:e.script.metadata,hasUserConfig:!(null==s||!s.config),runNum:e.runNum,runNumByIframe:e.runNumByIframe,customExclude:s.selfMetadata&&s.selfMetadata.exclude,menus:t}:{id:e.script.id,name:tt(e.script),enable:e.script.status===I,updatetime:e.script.updatetime||e.script.createtime,metadata:e.script.metadata,hasUserConfig:!!e.script.config,runNum:e.runNum,runNumByIframe:e.runNumByIframe,customExclude:e.script.selfMetadata&&e.script.selfMetadata.exclude,menus:t}})),d=await Promise.all(l),p=[],u=t.get("sandbox");return this.runBackScript.forEach((e=>{const t=[];var r;u&&(null==u||null===(r=u.get(e.id))||void 0===r||r.forEach((e=>{t.push({name:e.request.params[1],accessKey:e.request.params[2],id:e.request.params[0],sender:e.request.sender,channelFlag:e.channel.flag})})));p.push({id:e.id,name:e.name,enable:e.status===I,updatetime:e.updatetime||e.createtime,metadata:e.metadata,runStatus:e.runStatus,hasUserConfig:!!e.config,runNum:e.runStatus&&"running"===e.runStatus?1:0,menus:t,runNumByIframe:0})})),Promise.resolve({scriptList:d,backScriptList:p})})),this.message.setHandler("pageLoad",((e,t,n)=>new Promise((e=>{if(!n)return;if(!n.url||!n.tabId)return;if(void 0===n.frameId&&r.delete(n.tabId),"false"===localStorage.enable_script)return;this.customizeExclude.match(n.url).forEach((e=>{s(n.tabId,e,!1,0)}));const t=this.matchUrl(n.url,(e=>void 0!==n.frameId?!!e.metadata.noframes||(s(n.tabId,e,!0),e.status!==I):(s(n.tabId,e,!1),e.status!==I)));t.length?(e({scripts:t}),t.forEach((e=>{let t="document_idle";switch(e.metadata["run-at"]&&([t]=e.metadata["run-at"]),t){case"document-body":case"document-start":t="document_start";break;case"document-end":t="document_end";break;default:t="document_idle"}chrome.tabs.executeScript(n.tabId,{frameId:n.frameId,code:'(function(){\n                let temp = document.createElementNS("http://www.w3.org/1999/xhtml", "script");\n                    temp.setAttribute(\'type\', \'text/javascript\');\n                    temp.innerHTML = "'.concat(e.code,'";\n                    temp.className = "injected-js";\n                    document.documentElement.appendChild(temp);\n                    temp.remove();\n                }())'),runAt:t})})),chrome.browserAction.getBadgeText({tabId:n.tabId},(e=>{chrome.browserAction.setBadgeText({text:(t.length+(parseInt(e,10)||0)).toString(),tabId:n.tabId})})),chrome.browserAction.setBadgeBackgroundColor({color:"#4e5969",tabId:n.tabId})):e({scripts:[]})}))))}setMessageSandbox(e){this.messageSandbox=e}startSandbox(e){this.messageSandbox=e,this.scriptDAO.table.toArray((e=>{e.forEach((e=>{e?e.type!==x&&e.status===I&&(this.enable(e),this.runBackScript.set(e.id,e)):this.logger.error("script is null")}))}))}listenScriptRunStatus(){this.message.setHandler("scriptRunStatus",((t,r)=>{let[s,n,i,a]=r;this.scriptDAO.update(s,{runStatus:n,lastruntime:(new Date).getTime(),nextruntime:a,error:i}),e.hook.trigger("runStatus",s,n)})),this.message.setHandlerWithChannel("watchRunStatus",(t=>{const r=(e,r)=>{t.send([e,r])};e.hook.addListener("runStatus",r),t.setDisChannelHandler((()=>{e.hook.removeListener("runStatus",r)}))}))}async scriptUpdate(e){return await this.resourceManager.checkScriptResource(e),e.status===I?this.enable(e):this.disable(e)}matchUrl(e,t){const r=this.match.match(e);r.push(...this.include.match(e));const s={};return r.forEach((e=>{t&&t(e)||(s[e.id]=e)})),Object.keys(s).map((e=>s[e]))}async scriptDelete(e){return e.type===x?(this.match.del(e),this.include.del(e)):this.unloadBackgroundScript(e),Promise.resolve(!0)}async enable(e){const t=await this.buildScriptRunResource(e);return e.type!==x?this.loadBackgroundScript(t):this.loadPageScript(t)}disable(e){return e.type!==x?this.unloadBackgroundScript(e):this.unloadPageScript(e)}loadPageScript(e){const t=this.logger.with({scriptId:e.id,name:e.name});var r;return e.code=(r=function(e){return"window['".concat(e.flag,"']=function(context,GM_info){\n").concat(e.code,"\n}")}(e),function(e){return(e=e.replace(/("|\\)/g,"\\$1")).replace(/(\r\n|\n)/g,"\\n")}(r)),this.match.del(e),this.include.del(e),e.metadata.match&&e.metadata.match.forEach((r=>{try{this.match.add(r,e)}catch(e){t.error("url load error",l.E(e))}})),e.metadata.include&&e.metadata.include.forEach((r=>{try{this.include.add(r,e)}catch(e){t.error("url load error",l.E(e))}})),e.metadata.exclude&&e.metadata.exclude.forEach((r=>{try{this.include.exclude(r,e),this.match.exclude(r,e)}catch(e){t.error("url load error",l.E(e))}})),e.selfMetadata&&e.selfMetadata.exclude&&e.selfMetadata.exclude.forEach((r=>{try{this.customizeExclude.add(r,e)}catch(e){t.error("url load error",l.E(e))}})),Promise.resolve(!0)}unloadPageScript(e){return this.loadPageScript(e)}loadBackgroundScript(e){return this.runBackScript.set(e.id,e),new Promise(((t,r)=>{var s;e.nextruntime=0,null===(s=this.messageSandbox)||void 0===s||s.syncSend("enable",e).then((()=>{t(!0)})).catch((e=>{this.logger.error("backscript load error",l.E(e)),r(e)}))}))}unloadBackgroundScript(e){return this.runBackScript.delete(e.id),new Promise(((t,r)=>{var s;null===(s=this.messageSandbox)||void 0===s||s.syncSend("disable",e.id).then((()=>{t(!0)})).catch((e=>{this.logger.error("backscript stop error",l.E(e)),r(e)}))}))}async startBackgroundScript(e){var t;const r=await this.buildScriptRunResource(e);return null===(t=this.messageSandbox)||void 0===t||t.syncSend("start",r),Promise.resolve(!0)}stopBackgroundScript(e){return new Promise(((t,r)=>{var s;null===(s=this.messageSandbox)||void 0===s||s.syncSend("stop",e).then((e=>{t(e)})).catch((e=>{this.logger.error("backscript stop error",l.E(e)),r(e)}))}))}async buildScriptRunResource(e){var t;const r=Object.assign(e);return r.selfMetadata&&(r.metadata={...r.metadata},Object.keys(r.selfMetadata).forEach((e=>{r.metadata[e]=r.selfMetadata[e]}))),r.value=await this.valueManager.getScriptValues(r),r.resource=await this.resourceManager.getScriptResources(r),r.flag=function(e){e=e||32;const t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz";let r="";for(let s=0;s<e;s+=1)r+=t.charAt(Math.floor(41*Math.random()));return r}(16),r.sourceCode=r.code,r.code=function(e){let{code:t}=e,r="";return e.metadata.require&&e.metadata.require.forEach((t=>{const s=e.resource[t];s&&(r="".concat(r,"\n").concat(s.content))})),t=r+t,"with (context) return (async ()=>{\n".concat(t,"\n//# sourceURL=").concat(chrome.runtime.getURL("/".concat(encodeURI(e.name),".user.js")),"\n})()")}(r),r.grantMap={},null===(t=r.metadata.grant)||void 0===t||t.forEach((e=>{r.grantMap[e]="ok"})),Promise.resolve(r)}},(0,s.Z)(Hr,"hook",new n),Gr=Hr))||Gr;var qr,Vr=r(34605);const Zr=k.Singleton(m,_e)(qr=class extends te{constructor(e,t){super(e,"system"),this.scriptDAO=new O,this.systemConfig=t,this.scriptManager=k.instance(Ue),this.loggerDAO=new v}init(){const e=()=>{fetch("".concat(st,"api/v1/system/version?version=").concat(rt)).then((e=>e.json())).then((e=>{chrome.storage.local.get(["notice"],(t=>{t.notice!==e.data.notice&&chrome.storage.local.set({notice:e.data.notice,setRead:!1}),chrome.storage.local.set({version:e.data.version})}))}))};e(),setInterval((()=>{e()}),288e5),chrome.runtime.onInstalled.addListener((e=>{"install"===e.reason?chrome.tabs.create({url:"https://docs.scriptcat.org/"}):"update"===e.reason&&chrome.tabs.create({url:"https://docs.scriptcat.org/docs/change/#".concat(rt)})})),this.message.setHandler("ping",(()=>Promise.resolve("pong"))),this.message.setHandler("externalMessage",(async(e,t)=>{let{action:r,name:s,namespace:n}=t;if("isInstalled"===r){const e=await this.scriptDAO.findByNameAndNamespace(s,n);return e?Promise.resolve({installed:!0,version:e.metadata.version&&e.metadata.version[0]}):Promise.resolve({installed:!1})}return Promise.resolve(!1)})),this.listenEvent("connectVSCode",this.connectVSCode.bind(this)),this.systemConfig.awaitLoad().then((()=>{this.reconnectVSCode()})),this.clearLogger()}reconnectVSCode(){let e;const t=()=>{this.wsVscode||this.connectVSCode()};this.systemConfig.vscodeReconnect&&(t(),e=setInterval((()=>{t()}),3e4)),_e.hook.addListener("update",((r,s)=>{"vscode_reconnect"===r&&(s?e=setInterval((()=>{t()}),3e4):clearInterval(e))}))}connectVSCode(){return new Promise(((e,t)=>{this.wsVscode&&this.wsVscode.close();try{this.wsVscode=new WebSocket(this.systemConfig.vscodeUrl)}catch(e){return this.logger.debug("connect vscode faild",l.E(e)),void t(e)}let r=!1;this.wsVscode.addEventListener("open",(()=>{this.wsVscode.send('{"action":"hello"}'),r=!0,e()})),this.wsVscode.addEventListener("message",(async e=>{const t=JSON.parse(e.data);switch(t.action){case"onchange":{const e=t.data.script,r=await z(e,"",(0,Vr.Z)(t.data.uri,Vr.Z.URL),!0);this.scriptManager.event.upsertHandler(r.script,"vscode");break}}})),this.wsVscode.addEventListener("error",(e=>{this.wsVscode=void 0,this.logger.debug("connect vscode faild",l.E(e)),r||t(new Error("connect fail"))})),this.wsVscode.addEventListener("close",(()=>{this.wsVscode=void 0,this.logger.debug("vscode connection closed")}))}))}getNotice(){return new Promise((e=>{chrome.storage.local.get(["notice","isRead"],(t=>{e({notice:t.notice,isRead:t.isRead})}))}))}setRead(e){chrome.storage.local.set({isRead:e})}getVersion(){return new Promise((e=>{chrome.storage.local.get(["version"],(t=>{e(t.version)}))}))}clearLogger(){setInterval((()=>{chrome.storage.local.get(["lastClearLoggerTime"],(e=>{const t=e.lastClearLoggerTime||0,r=(new Date).getTime();r-t>36e5&&(chrome.storage.local.set({lastClearLoggerTime:r}),this.loggerDAO.deleteBefore(new Date(r-24*this.systemConfig.logCleanCycle*60*60*1e3).getTime()))}))}),6e4)}})||qr;class Kr{constructor(e){this.fs=e}export(e){const t=[];return e.script.forEach((e=>{t.push(this.writeScript(e))})),e.subscribe.forEach((e=>{t.push(this.writeSubscribe(e))})),Promise.all(t).then((()=>{}))}async writeScript(e){const{name:t}=e.options.meta;await(await this.fs.create("".concat(t,".user.js"))).write(e.code),await(await this.fs.create("".concat(t,".options.json"))).write(JSON.stringify(e.options));const r={...e.storage};return Object.keys(r.data).forEach((e=>{r.data[e]=function(e){switch(typeof e){case"string":return"s".concat(e);case"number":return"n".concat(e.toString());case"boolean":return"b".concat(e?"true":"false");default:try{return"o".concat(JSON.stringify(e))}catch(e){return""}}}(r.data[e])})),await(await this.fs.create("".concat(t,".storage.json"))).write(JSON.stringify(r)),await this.writeResource(t,e.resources,"resources"),await this.writeResource(t,e.requires,"requires"),await this.writeResource(t,e.requiresCss,"requires.css"),Promise.resolve()}async writeResource(e,t,r){const s=t.map((async t=>{const s=T().MD5("".concat(r,"{val.meta.url}")).toString();t.source?await(await this.fs.create("".concat(e,".user.js-").concat(s,"-").concat(t.meta.name))).write(t.source):await(await this.fs.create("".concat(e,".user.js-").concat(s,"-").concat(t.meta.name))).write(X(t.base64)),(await this.fs.create("".concat(e,".user.js-").concat(s,"-").concat(t.meta.name,".").concat(r,".json"))).write(JSON.stringify(t.meta))}));return Promise.all(s)}async writeSubscribe(e){const{name:t}=e.options.meta;return await(await this.fs.create("".concat(t,".user.sub.js"))).write(e.source),await(await this.fs.create("".concat(t,".user.sub.options.json"))).write(JSON.stringify(e.options)),Promise.resolve()}}class Fr{constructor(e){this.manager=e,this.logger=d.getLogger({component:"SynchronizeEventListener"}),this.init()}listenEvent(e,t){this.manager.listenEvent(e,t)}init(){this.listenEvent("openImportWindow",this.importHandler.bind(this)),this.listenEvent("fetchImportInfo",this.fetchImportInfoHandler.bind(this)),this.listenEvent("backup",this.backupHandler.bind(this)),this.listenEvent("backupToCloud",this.backupToCloudHandler.bind(this))}importHandler(e){const t=(0,p.Z)(),r=W.importInfo(t);return L.getInstance().set(r,e),setTimeout((()=>{L.getInstance().del(r)}),6e6),chrome.tabs.create({url:"/src/import.html?uuid=".concat(t)}),Promise.resolve({uuid:t})}fetchImportInfoHandler(e){return Promise.resolve(L.getInstance().get(W.importInfo(e)))}async backupHandler(e){const t=new(rr()),r=new ir(t);await this.manager.backup(r,e);const s=await t.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9},comment:"Created by Scriptcat"}),n=URL.createObjectURL(s);return setTimeout((()=>{URL.revokeObjectURL(n)}),6e4),chrome.downloads.download({url:n,saveAs:!0,filename:"scriptcat-backup-".concat(a()().format("YYYY-MM-DDTHH-mm-ss"),".zip")}),Promise.resolve()}async backupToCloudHandler(e){let{type:t,params:r}=e;const s=new(rr()),n=new ir(s);await this.manager.backup(n),this.logger.info("backup to cloud");let i=await ar.create(t,r);try{await i.createDir("ScriptCat"),i=await i.openDir("ScriptCat");const e=await i.create("scriptcat-backup-".concat(a()().format("YYYY-MM-DDTHH-mm-ss"),".zip"));await e.write(await s.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9},comment:"Created by Scriptcat"}))}catch(e){return this.logger.error("backup to cloud error",l.E(e)),Promise.reject(e)}return Promise.resolve()}}var Xr;let zr=k.Singleton(m,_e,qe,se,Ue)(Xr=class extends te{constructor(e,t,r,n,i){super(e,"sync"),(0,s.Z)(this,"scriptDAO",new O),this.systemConfig=t,this.event=new Fr(this),this.valueManager=r,this.resourceManager=n,this.scriptManager=i,this.storage=new oe("sync",!1),this.logger=d.getLogger({component:"SynchronizeManager"})}async start(){let e;this.systemConfig.awaitLoad().then((async()=>{this.systemConfig.cloudSync.enable&&(e=await this.enableCloudSync(this.systemConfig.cloudSync))})),_e.hook.addListener("update",(async(t,r)=>{var s;"cloud_sync"===t&&(null===(s=e)||void 0===s||s(),r.enable&&(await this.storage.set("file_digest",{}),e=await this.enableCloudSync(r)))}))}async enableCloudSync(e){const t=this.logger.with({syncDelete:e.syncDelete});let r;t.info("start cloud sync");try{r=await ar.create(e.filesystem,e.params[e.filesystem]),await ar.mkdirAll(r,"ScriptCat/sync"),r=await r.openDir("ScriptCat/sync")}catch(r){throw t.error("create filesystem error",l.E(r),{type:e.filesystem}),qt(r)&&(G("".concat((0,Fe.t)("sync_system_connect_failed"),", ").concat((0,Fe.t)("sync_system_closed")),"".concat((0,Fe.t)("sync_system_closed_description"),"\n").concat(function(e){return"string"==typeof e?e:e instanceof Error?e.message:"object"==typeof e?JSON.stringify(e):""}(r))),this.systemConfig.cloudSync={...this.systemConfig.cloudSync,enable:!1}),r}const s=[],n=async(e,t)=>{"sync"!==t&&(await this.pushScript(r,e),this.updateFileDigest(r))};s.push((()=>Ue.hook.removeListener("upsert",n))),Ue.hook.addListener("upsert",n);const i=t=>{this.deleteCloudScript(r,t,e.syncDelete)};Ue.hook.addListener("delete",i),s.push((()=>Ue.hook.removeListener("delete",i)));const a=setInterval((async()=>{try{await this.syncOnce(r)}catch(e){this.logger.error("sync error",l.E(e))}}),36e5);s.push((()=>{clearInterval(a)}));try{await this.syncOnce(r)}catch(e){this.logger.error("sync error",l.E(e))}return Promise.resolve((()=>{t.info("stop cloud sync"),s.forEach((e=>e()))}))}async syncOnce(e){this.logger.info("start sync once");const t=await e.list(),r=new Map,s=await this.storage.get("file_digest")||{};t.forEach((e=>{if(e.name.endsWith(".user.js")){const t=e.name.substring(0,e.name.length-8);let s=r.get(t);s||(s={},r.set(t,s)),s.script=e}else if(e.name.endsWith(".meta.json")){const t=e.name.substring(0,e.name.length-10);let s=r.get(t);s||(s={},r.set(t,s)),s.meta=e}}));const n=await this.scriptDAO.table.toArray(),i=new Map;n.forEach((e=>{i.set(e.uuid,e)}));const a=[];return r.forEach(((t,r)=>{const n=i.get(r);if(n){if(!t.script)return void a.push(new Promise((s=>{(async()=>{const a=await e.open(t.meta),o=await a.read("string");JSON.parse(o).isDeleted?(n&&(this.scriptManager.event.deleteHandler(n.id),G("脚本删除同步","脚本".concat(n.name,"已被删除"))),i.delete(r)):await e.delete(t.meta.path),s()})()})));if(s[t.script.name]===t.script.digest)return void i.delete(r);return(n.updatetime||n.createtime)>t.script.updatetime?a.push(this.pushScript(e,n)):a.push(this.pullScript(e,t,n)),void i.delete(r)}t.script&&a.push(this.pullScript(e,t))})),await Promise.allSettled(a),i.forEach((t=>{a.push(this.pushScript(e,t))})),this.logger.info("sync complete"),await this.updateFileDigest(e),Promise.resolve()}async updateFileDigest(e){const t=await e.list(),r={};return t.forEach((e=>{r[e.name]=e.digest})),await this.storage.set("file_digest",r),Promise.resolve()}async deleteCloudScript(e,t,r){const s="".concat(t.uuid,".user.js"),n=this.logger.with({scriptId:t.id,name:t.name,file:s});try{if(await e.delete(s),r){const r=await e.create("".concat(t.uuid,".meta.json"));await r.write(JSON.stringify({uuid:t.uuid,origin:t.origin,downloadUrl:t.downloadUrl,checkUpdateUrl:t.checkUpdateUrl,isDeleted:!0}))}else await e.delete(s),await e.delete("".concat(t.uuid,".meta.json"));n.info("delete success")}catch(e){n.error("delete file error",l.E(e))}return Promise.resolve()}async pushScript(e,t){const r="".concat(t.uuid,".user.js"),s=this.logger.with({scriptId:t.id,name:t.name,file:r});try{const n=await e.create(r);await n.write(t.code);const i=await e.create("".concat(t.uuid,".meta.json"));await i.write(JSON.stringify({uuid:t.uuid,origin:t.origin,downloadUrl:t.downloadUrl,checkUpdateUrl:t.checkUpdateUrl})),s.info("push script success")}catch(e){throw s.error("push script error",l.E(e)),e}return Promise.resolve()}async pullScript(e,t,r){const s=this.logger.with({scriptId:(null==r?void 0:r.id)||-1,name:(null==r?void 0:r.name)||"",file:t.script.name});try{const n=await e.open(t.script),i=await n.read("string"),a=await e.open(t.meta),o=await a.read("string"),c=JSON.parse(o),l=await z(i,(null==r?void 0:r.downloadUrl)||c.downloadUrl||"",(null==r?void 0:r.uuid)||c.uuid);l.script.origin=l.script.origin||c.origin,this.scriptManager.event.upsertHandler(l.script,"sync"),s.info("pull script success")}catch(e){s.error("pull script error",l.E(e))}return Promise.resolve()}async backup(e,t){const r={script:await this.getScriptBackupData(t),subscribe:[]};await new Kr(e).export(r)}async getScriptBackupData(e){if(!e){const e=await this.scriptDAO.table.toArray();return Promise.all(e.map((async e=>this.generateScriptBackupData(e))))}const t=[];return e.forEach((e=>{t.push(new Promise(((t,r)=>{this.scriptDAO.findById(e).then((e=>{e&&t(this.generateScriptBackupData(e))})).catch((e=>{r(e)}))})))})),Promise.all(t)}async generateScriptBackupData(e){const t={code:e.code,options:{options:this.scriptOption(e),settings:{enabled:e.status===I,position:e.sort},meta:{name:e.name,uuid:e.uuid,sc_uuid:e.uuid,modified:e.updatetime,file_url:e.downloadUrl,subscribe_url:e.subscribeUrl}},requires:[],requiresCss:[],resources:[]},r={data:{},ts:(new Date).getTime()},s=await this.valueManager.getValues(e);Object.keys(s).forEach((e=>{r.data[e]=s[e].value}));const n=await this.resourceManager.getRequireResource(e),i=await this.resourceManager.getRequireCssResource(e),a=await this.resourceManager.getResourceResource(e);return t.requires=this.resourceToBackdata(n),t.requiresCss=this.resourceToBackdata(i),t.resources=this.resourceToBackdata(a),t.storage=r,Promise.resolve(t)}resourceToBackdata(e){const t=[];return Object.keys(e).forEach((r=>{t.push({meta:{name:this.getUrlName(e[r].url),url:e[r].url,ts:e[r].updatetime||e[r].createtime,mimetype:e[r].contentType},source:e[r].content||void 0,base64:e[r].base64})})),t}getUrlName(e){let t=e.indexOf("?");return-1!==t&&(e=e.substring(0,t)),t=e.lastIndexOf("/"),-1!==t&&(e=e.substring(t+1)),e}scriptOption(e){return{check_for_updates:!1,comment:null,compat_foreach:!1,compat_metadata:!1,compat_prototypes:!1,compat_wrappedjsobject:!1,compatopts_for_requires:!0,noframes:null,override:{merge_connects:!0,merge_excludes:!0,merge_includes:!0,merge_matches:!0,orig_connects:e.metadata.connect||[],orig_excludes:e.metadata.exclude||[],orig_includes:e.metadata.include||[],orig_matches:e.metadata.match||[],orig_noframes:!!e.metadata.noframe||null,orig_run_at:e.metadata.run_at&&e.metadata.run_at[0]||"document-idle",use_blockers:[],use_connects:[],use_excludes:[],use_includes:[],use_matches:[]},run_at:null}}})||Xr;var Wr,Jr;let Qr=k.Singleton(m,Ue,_e)((Jr=class e extends te{constructor(e,t,r){super(e,"subscribe"),(0,s.Z)(this,"subscribeDAO",new E),(0,s.Z)(this,"scriptDAO",new O),this.systemConfig=r,this.scriptManager=t}start(){this.listenEvent("upsert",this.upsertHandler.bind(this)),this.listenEvent("checkUpdate",(e=>this.checkUpdate(e,"user"))),this.listenEvent("delete",this.deleteHandler.bind(this)),e.hook.addListener("upsert",this.upsertScript.bind(this)),setInterval((()=>{this.systemConfig.checkScriptUpdateCycle&&(this.logger.debug("start check update"),this.subscribeDAO.table.where("checktime").belowOrEqual((new Date).getTime()-1e3*this.systemConfig.checkScriptUpdateCycle).toArray().then((e=>{e.forEach((e=>{(this.systemConfig.updateDisableScript||1!==e.status)&&this.checkUpdate(e.id,"system")}))})))}),6e5)}async upsertHandler(t,r){const s=this.logger.with({subscribeId:t.id,name:t.name});try{return await this.subscribeDAO.save(t),s.info("upsert subscribe success"),e.hook.trigger("upsert",t,r),Promise.resolve(t.id)}catch(e){return s.error("upsert subscribe error",l.E(e)),Promise.reject(e)}}async deleteHandler(e){const t=this.logger.with({subscribeId:e}),r=await this.subscribeDAO.findById(e);if(!r)return t.warn("subscribe not found"),Promise.resolve(!1);return(await this.scriptDAO.table.where("subscribeUrl").equals(r.url).toArray()).forEach((e=>{this.scriptManager.event.deleteHandler(e.id)})),await this.subscribeDAO.delete(e),t.info("delete subscribe success"),Promise.resolve(!0)}async checkUpdate(e,t){const r=await this.subscribeDAO.findById(e);if(!r)return Promise.resolve(!1);const s=this.logger.with({subscribeId:r.id,name:r.name});await this.subscribeDAO.update(e,{checktime:(new Date).getTime()});try{const e=await K(r.url,t,!1,r.url),{metadata:n}=e;if(!n)return s.error("parse metadata failed"),Promise.resolve(!1);const i=n.version&&n.version[0];if(!i)return s.error("parse version failed",{version:n.version[0]}),Promise.resolve(!1);let a=r.metadata.version&&r.metadata.version[0];return a||(a="0.0.0"),H(i,a,s)?Promise.resolve(!1):(this.openUpdatePage(e),Promise.resolve(!0))}catch(e){return s.error("check update failed",l.E(e)),Promise.resolve(!1)}}async openUpdatePage(e){const t=this.logger.with({url:e.url});if(this.systemConfig.silenceUpdateScript)try{const r=await async function(e,t){const r=new E,s=V(e);if(null==s)throw new Error("MetaData信息错误");if(void 0===s.name)throw new Error("订阅名不能为空");let n={id:0,url:t,name:s.name[0],code:e,author:s.author&&s.author[0],scripts:{},metadata:s,status:1,createtime:Date.now(),updatetime:Date.now(),checktime:Date.now()};const i=await r.findByUrl(t);return i&&(n=function(e,t){const r=e;return r.id=t.id,r.scripts=t.scripts,r.createtime=t.createtime,r.status=t.status,r}(n,i)),Promise.resolve({subscribe:n,oldSubscribe:i})}(e.code,e.url);if(j(r.oldSubscribe.metadata,r.subscribe.metadata))return t.info("silence update subscribe"),void this.upsertHandler(r.subscribe)}catch(e){t.error("prepare script failed",l.E(e))}L.getInstance().set(W.scriptInfo(e.uuid),e),chrome.tabs.create({url:"/src/install.html?uuid=".concat(e.uuid)})}async upsertScript(e){const t=this.logger.with({subscribeId:e.id,name:e.name}),r=[],s=[],n=e.metadata.scripturl||[],i=Object.keys(e.scripts);n.forEach((e=>{i.includes(e)||r.push(e)})),i.forEach((t=>{n.includes(t)||s.push(e.scripts[t])}));const a=[[],[]],o=[];return r.forEach((t=>{o.push((async()=>{const r=await this.scriptManager.installByUrl(t,"subscribe",e.url);return e.scripts[t]={url:t,uuid:r.uuid},a[0].push(r.name),Promise.resolve(!0)})())})),s.forEach((e=>{o.push((async()=>{const t=await this.scriptDAO.findByUUID(e.uuid);return t&&(a[1].push(t.name),this.scriptManager.event.deleteHandler(t.id)),Promise.resolve(!0)})())})),await Promise.allSettled(o),await this.subscribeDAO.update(e.id,e),G("订阅更新","安装了:".concat(a[0].join(","),"\n删除了:").concat(a[1].join("\n"))),t.info("subscribe update",{install:a[0],update:a[1]}),Promise.resolve(!0)}},(0,s.Z)(Jr,"hook",new n),Wr=Jr))||Wr;f.version(1).stores({scripts:"++id,&uuid,name,namespace,author,origin_domain,type,status,createtime,updatetime,checktime"}),f.version(2).stores({logger:"++id,level,origin,createtime",permission:"++id,[scriptId+permission+permissionValue],createtime,updatetime"}),f.version(3).stores({logger:"++id,level,title,origin,createtime"}),f.version(4).stores({value:"++id,scriptId,namespace,key,createtime"}),f.version(5).stores({logger:"++id,level,origin,createtime,title,[origin+title],[level+origin+title]"}),f.version(6).stores({scripts:"++id,&uuid,name,namespace,author,origin_domain,type,status,runStatus,createtime,updatetime,checktime"}),f.version(7).stores({resource:"++id,&url,content,type,createtime,updatetime",resourceLink:"++id,url,scriptId,createtime"}),f.version(8).stores({logger:"++id,level,origin,createtime"}),f.version(9).stores({logger:"++id,level,scriptId,origin,createtime"}),f.version(10).stores({scripts:"++id,&uuid,name,namespace,author,origin_domain,type,sort,status,runStatus,createtime,updatetime,checktime"}).upgrade((e=>e.table("scripts").toCollection().modify((e=>{e.sort=0})))),f.version(11).stores({export:"++id,&uuid,scriptId"}),f.version(12).stores({value:"++id,scriptId,storageName,key,createtime"}).upgrade((e=>{e.table("value").toCollection().modify((e=>{e.namespace&&(e.storageName=e.namespace,delete e.namespace)}))})),f.version(13).stores({subscribe:"++id,&url,createtime,updatetime,checktime",scripts:"++id,&uuid,name,namespace,author,origin_domain,subscribeUrl,type,sort,status,runStatus,createtime,updatetime,checktime",sync:"++id,&key,[user+device+type],createtime"}),f.version(14).stores({value:"++id,[scriptId+key],[storageName+key]"}),f.version(15).stores({permission:"++id,scriptId,[scriptId+permission+permissionValue],createtime,updatetime"}),f.version(16).stores({scripts:"++id,&uuid,name,namespace,author,originDomain,subscribeUrl,type,sort,status,runStatus,createtime,updatetime,checktime",logger:"++id,level,createtime"}).upgrade((async e=>(await e.table("export").clear(),e.table("scripts").toCollection().modify((e=>{e.origin_domain&&(e.originDomain=e.origin_domain),e.checkupdate_url&&(e.checkUpdateUrl=e.checkupdate_url),e.download_url&&(e.downloadUrl=e.download_url)}))))),f.version(17).stores({export:"++id,&scriptId"});new d({debug:!1,writer:new class{constructor(e){this.dao=e}write(e,t,r){this.dao.save({id:0,level:e,message:t,label:r,createtime:(new Date).getTime()})}}(new v),labels:{env:"background"}}).logger().debug("background start");const Yr=new g;Yr.start(),k.registerInstance(g,Yr).alias([m,h]),function(e,t){t.setHandler("log",((t,r)=>{e.save(r)}))}(new v,Yr),k.instance(_e).init(),k.instance(Zr).init();const $r=new re(Yr),es=new je(Yr,Yr),ts=new jr(Yr,$r,es);k.registerInstance(jr,ts),ts.start(),es.start(),$r.start(),k.instance(Ue).start(),k.instance(Qr).start(),k.instance(zr).start(),window.onload=()=>{const e=new w(sandbox);ts.startSandbox(e),Yr.setSandbox(sandbox)},Yr.setHandler("sandboxOnload",(()=>Promise.resolve(!0)));new Rr(Yr,new lr).start()},43914:(e,t,r)=>{var s={"./align-attributes.js":2672,"./better-use-match.js":82162,"./compat-grant.js":45644,"./compat-headers.js":73285,"./filename-user.js":18039,"./metadata-spacing.js":39877,"./no-invalid-grant.js":20070,"./no-invalid-headers.js":18754,"./no-invalid-metadata.js":91763,"./require-attribute-space-prefix.js":14350,"./require-description.js":70230,"./require-name.js":18295,"./require-version.js":43880,"./use-download-and-update-url.js":52215,"./use-homepage-and-url.js":11933};function n(e){var t=i(e);return r(t)}function i(e){if(!r.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}n.keys=function(){return Object.keys(s)},n.resolve=i,e.exports=n,n.id=43914},42480:()=>{}},r={};function s(e){var n=r[e];if(void 0!==n)return n.exports;var i=r[e]={id:e,loaded:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.loaded=!0,i.exports}s.m=t,e=[],s.O=(t,r,n,i)=>{if(!r){var a=1/0;for(d=0;d<e.length;d++){for(var[r,n,i]=e[d],o=!0,c=0;c<r.length;c++)(!1&i||a>=i)&&Object.keys(s.O).every((e=>s.O[e](r[c])))?r.splice(c--,1):(o=!1,i<a&&(a=i));if(o){e.splice(d--,1);var l=n();void 0!==l&&(t=l)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[r,n,i]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),s.j=352,(()=>{var e={352:0};s.O.j=t=>0===e[t];var t=(t,r)=>{var n,i,[a,o,c]=r,l=0;if(a.some((t=>0!==e[t]))){for(n in o)s.o(o,n)&&(s.m[n]=o[n]);if(c)var d=c(s)}for(t&&t(r);l<a.length;l++)i=a[l],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(d)},r=self.webpackChunkscriptcat=self.webpackChunkscriptcat||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),s.nc=void 0;var n=s.O(void 0,[392,72,92,30],(()=>s(18578)));n=s.O(n)})();