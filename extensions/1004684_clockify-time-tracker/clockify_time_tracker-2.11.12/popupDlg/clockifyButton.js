var _clockifyPopupDlg,aBrowser=chrome||browser,_waitingForResponse=!1,_selectors=null,_clockifyShowPostStartPopup=!0,_timeEntryInProgressDescription=null,documents=window.getAllDocuments(),timerIds={};function triggerUrlChanged(){const t=new Event("urlChanged");window.dispatchEvent(t)}removeAllButtons(),setPostStartPopup(),setManualElementsVisibility(),function(t){const e=t.pushState,o=t.replaceState;t.pushState=function(o){e.apply(t,arguments),triggerUrlChanged()},t.replaceState=function(e){o.apply(t,arguments),triggerUrlChanged()},window.addEventListener("popstate",(()=>{triggerUrlChanged()}))}(window.history),window.addEventListener("urlChanged",(()=>{clockifyButton.onNavigationRerender&&(clockifyButton.nextIndex=0,clockifyButton.rerenderAllButtons())})),aBrowser.storage.local.get(["timeEntryInProgress"]).then((({timeEntryInProgress:t})=>{_timeEntryInProgressDescription=t?.description}));var clockifyButton={inProgressDescription:"",onNavigationRerender:!1,nextIndex:0,mutationObserver:{observer:null,allSelectors:[],callback:t=>{for(const e of clockifyButton.mutationObserver.allSelectors){const{selector:o,renderer:n,mutationSelector:i}=e;i&&!t.filter((t=>t.target.matches(i))).length||clockifyButton.renderTo(o,n)}},start:(t,e,o,n)=>{const{mutationObserver:i}=clockifyButton;e.observe&&(i.observer||(e.noDebounce?i.observer=new MutationObserver(i.callback):i.observer=new MutationObserver(clockifyDebounce(i.callback,1e3)),documents.forEach((t=>{i.observer.observe(t,{childList:!0,subtree:!0})}))),i.allSelectors.push({selector:t,renderer:o,mutationSelector:n}))}},observeDescription:t=>{t&&setInterval((()=>{const e=document.querySelector(t),o=closestClockifyButton(e);e&&o&&o.setAttribute("title",e.textContent)}),500)},render:(t,e={},o,n,i)=>{const{onNavigationRerender:r,showTimerOnhover:c,timerName:s}=e;if(r&&(clockifyButton.onNavigationRerender=!0),c&&!timerIds[t]){const t=Object.keys(timerIds).length+1;timerIds={...timerIds,selector:t},addHoverEffect(c)}clockifyButton.mutationObserver.start(t,e,o,n),clockifyButton.observeDescription(i),clockifyButton.renderTo(t,o)},rerenderAllButtons:()=>{Array.from($$$(".clockifyButton, #clockify-manual-input-form, .clockify-widget-container, .button-link:has(.clockifyButton)")).forEach((t=>t?.remove())),$$$(".clockify").forEach((t=>t.classList.remove("clockify")))},renderTo:(t,e)=>{$$$(t).forEach(((t,o)=>{t.classList.add("clockify","clockify"+o),e(t,t.ownerDocument)}))},createButton:(t,e,o)=>{const n=clockifyButton.nextIndex++;window.updateButtonProperties({newRoot:!0,buttonId:n},{isPopupOpen:!1});const i=objectFromParams(t,e,o);clockifyButton.options=i;const r=invokeIfFunction(i.small);let c=invokeIfFunction(i.description);const s=c?.includes(" | ")?" || ":" | ",a=withoutAppendedUrl(c,s)===withoutAppendedUrl(_timeEntryInProgressDescription,s),l=c&&a,u=getClockifyButtonHTML({options:i,isActive:l,isSmall:r});return r&&u.classList.add("small"),aBrowser.storage.local.get(["timeEntryInProgress","permanent_appendWebsiteURL","userId"],(({timeEntryInProgress:t,permanent_appendWebsiteURL:e,userId:o})=>{const s=t;e&&(c=withAppendedUrl(c)),o&&(clockifyButton.userId=o),s&&s.id?clockifyButton.inProgressDescription=s.description||"":clockifyButton.inProgressDescription=null,setButtonProperties(u,c,l,n),this.setClockifyButtonLinks(u),window.updateButtonProperties({options:i,title:c,active:l,small:r,buttonId:n,integrationName:clockifyButton?.injectedArguments?.integrationName},{inProgressDescription:clockifyButton.inProgressDescription})})),u},createTimer:(...t)=>clockifyButton.createButton(...t),createSmallButton:(t,e)=>{const o=objectFromParams(t,e);return o.small=!0,clockifyButton.createButton(o)},createInput:t=>{const e=document.createElement("form"),o=document.createElement("input");e.setAttribute("id","clockify-manual-input-form"),e.appendChild(o),o.classList.add("clockify-input","clockify-input-default"),o.setAttribute("placeholder",clockifyLocales.ADD_TIME_MANUAL);const n=o.parentElement;return o.addEventListener("focus",(()=>{window.updateButtonProperties(null,{timeEntry:{originalInput:o.value},isPopupOpen:!1,manualMode:!0,origin:n})}),{once:!0}),e.onsubmit=async e=>{if(e.preventDefault(),e.stopPropagation(),"Forbidden"===await aBrowser.runtime.sendMessage({eventName:"getEntryInProgress"}))return void alert(clockifyLocales.WORKSPACE_LOCKED);let n=await localStorage.getItem("workspaceSettings");if(n=JSON.parse(n),n.features&&"SELF_HOSTED"!==n.features.featureSubscriptionType&&!n.features.timeTracking){const t=await localStorage.getItem("isUserOwnerOrAdmin"),e=await localStorage.getItem("wasRegionalEverAllowed");return void alert(e?t?clockifyLocales.SUBSCRIPTION_EXPIRED:clockifyLocales.FEATURE_DISABLED_CONTACT_ADMIN:t?clockifyLocales.UPGRADE_REGIONAL_ADMIN:clockifyLocales.UPGRADE_REGIONAL)}const i=objInvokeIfFunction(t);let r=i.description;await isAppendUrlEnabled()&&(r=withAppendedUrl(r),i.description=r);try{const t=o.value,e=t.match(/(?=.{2,})^(\d+d)?\s*(\d+h)?\s*(\d+m)?$/);if(e){o.value=clockifyLocales.SUBMITTING;const c=480*parseInt(e[1]||0,10)+60*parseInt(e[2]||0,10)+parseInt(e[3]||0,10);aBrowser.storage.local.get(["wsSettings"],(async e=>{const{wsSettings:s}=e,a=Boolean(r);if(await isPopupShowable({hasDescriptionValue:a}))if(i.projectName||i.tagNames){const e=await aBrowser.runtime.sendMessage({eventName:"generateManualEntryData",options:i}),r=o.parentElement,a={...i,totalMins:c,originalInput:t,projectId:!e.task?.id&&s.forceTasks?null:e.project?.id,taskId:e.task?.id,billable:n.taskBillableEnabled&&e.task?e.task?.billable:e.project?.billable,tags:e.tags,tagIds:e.tags?.map((t=>t.id))??[],project:e.project,task:e.task};window.updateButtonProperties(null,{timeEntry:a,manualMode:!0,isPopupOpen:!0,origin:r,integrationName:clockifyButton?.injectedArguments?.integrationName}),o.value=""}else{const e=await aBrowser.runtime.sendMessage({eventName:"getDefaultProjectTask"}),n={...i,totalMins:c,originalInput:t,projectId:e.projectDB?.id,taskId:e.taskDB?.id,billable:e.projectDB?.billable,project:e.projectDB,task:e.taskDB},r=o.parentElement;window.updateButtonProperties(null,{timeEntry:n,manualMode:!0,isPopupOpen:!0,origin:r,integrationName:clockifyButton?.injectedArguments?.integrationName}),o.value=""}else inputMessage(o,clockifyLocales.SUBMITTING),aBrowser.runtime.sendMessage({eventName:"submitTime",options:{totalMins:c,timeEntryOptions:i,integrationName:clockifyButton?.injectedArguments?.integrationName}},(t=>{o.value="",t?"string"==typeof t?alert(t):201!==t.status?400===t.status&&(t.endInProgressStatus?(inputMessage(o,"Error: "+t.status,"error"),alert(`${clockifyLocales.YOU_ALREADY_HAVE_ENTRY_WITHOUT}.\n${clockifyLocales.PLEASE_EDIT_YOUR_TIME_ENTRY}.`)):alert(clockifyLocales.CANNOT_START_ENTRY_WITHOUT_PROJECT)):inputMessage(o,clockifyLocales.TIME_ADDED,"success"):inputMessage(o,"Error: "+(t??""),"error")}))}))}else inputMessage(o,"Format: 1d 2h 30m","error",!0)}catch(e){console.error(e)}return!1},e},createEvent:({description:t,start:e,end:o})=>{const n=createTag("div","clockify-copy-as-entry-container");n.innerHTML='<svg width="16" height="16" viewBox="0 0 17 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.50307 10.027H5.51427C5.76592 10.027 5.96945 9.761 5.96945 9.51C5.96945 9.259 5.76592 9.024 5.51427 9.024H3.50307C3.25142 9.024 3.04789 9.259 3.04789 9.51C3.04789 9.761 3.25142 10.027 3.50307 10.027ZM8.53309 13.041H3.50307C3.25142 13.041 3.04789 13.276 3.04789 13.527C3.04789 13.778 3.25142 14.012 3.50307 14.012H8.53309C8.78474 14.012 8.98826 13.778 8.98826 13.527C8.98826 13.276 8.78474 13.041 8.53309 13.041ZM6.52188 15.018H3.50307C3.25142 15.018 3.04789 15.253 3.04789 15.504C3.04789 15.755 3.25142 15.989 3.50307 15.989H6.52188C6.77453 15.989 6.97806 15.755 6.97806 15.504C6.97806 15.253 6.77453 15.018 6.52188 15.018ZM13.4027 0H6.81865C5.81204 0 4.99593 0.814 4.99593 1.818V3.556C4.99593 3.807 5.23154 4.011 5.48319 4.011C5.73484 4.011 5.96945 3.807 5.96945 3.556V1.818C5.96945 1.316 6.37751 0.971 6.88081 0.971H12.0362V4.042C12.0362 4.544 12.4442 5.013 12.9475 5.013H16.0265V14.135C16.0265 14.637 15.6806 15.044 15.1773 15.044H13.2152C12.9636 15.044 12.759 15.279 12.759 15.529C12.759 15.781 12.9636 16.015 13.2152 16.015H15.1773C16.1839 16.015 17 15.139 17 14.135V4.042L13.4027 0ZM13.0097 4.042V1.041L15.6686 4.042H13.0097ZM1.82272 5.013C0.816112 5.013 0 5.827 0 6.831V18.18C0 19.184 0.816112 19.998 1.82272 19.998H10.1192C11.1258 19.998 12.0051 19.184 12.0051 18.18V9.024L8.65841 5.013H1.82272ZM11.0306 18.117C11.0306 18.62 10.6225 19.026 10.1192 19.026H1.88588C1.38258 19.026 0.974522 18.62 0.974522 18.117V6.831C0.974522 6.329 1.38258 5.985 1.88588 5.985H7.00914V9.024C7.00914 9.526 7.48036 10.027 7.98366 10.027H11.0306V18.117ZM7.98366 9.024V6.055L10.6726 9.024H7.98366ZM3.04789 11.518C3.04789 11.77 3.25142 12.004 3.50307 12.004H8.53309C8.78474 12.004 8.98826 11.77 8.98826 11.518C8.98826 11.268 8.78474 11.033 8.53309 11.033H3.50307C3.25142 11.033 3.04789 11.268 3.04789 11.518Z" fill="#606266"/></svg> <div>Copy as time entry</div>';const i={description:t,start:e,end:o};return n.addEventListener("click",(()=>clockifyButton.handleEventClick(i,n))),setTimeout((()=>window.updateButtonProperties(null,{isPopupOpen:!1,copyAsEntry:!0,origin:n})),200),n},handleEventClick:async({description:t,start:e,end:o},n)=>{const i=await aBrowser.runtime.sendMessage({eventName:"getDefaultProjectTask"});t=invokeIfFunction(t),await isAppendUrlEnabled()&&(t=withAppendedUrl(t));const{projectDB:r,taskDB:c}=i,s=await localStorage.getItem("workspaceSettings"),{lockTimeEntries:a}=JSON.parse(s),l=new Date(a),u=l.getTime()>e.getTime();function p(t){const e=t.getTime(),o=l.getTime(),n=Math.abs(o-e),i=Math.ceil(n/864e5);return new Date(e+24*i*60*60*1e3)}const d=await localStorage.getItem("isUserOwnerOrAdmin");u&&!d&&(e=p(e),o=p(o));const f={description:t,projectId:r?.id,taskId:c?.id,billable:r?.billable,project:r,task:c,timeInterval:{start:e,end:o}},m=Boolean(t);if(await isPopupShowable({hasDescriptionValue:m}))window.updateButtonProperties(null,{timeEntry:f,isPopupOpen:!0,copyAsEntry:!0,origin:n});else{const t={timeEntryOptions:f};aBrowser.runtime.sendMessage({eventName:"submitTime",options:t}),alert("Time entry has been created")}},observeDarkMode:t=>{function e(){return t()?function(){if($(".clockify-custom-style-dark"))return;const t=createTag("style","clockify-custom-style-dark","\n\t\t\t\t.clockify-input {\n\t\t\t\t\tbackground: #333 !important;\n\t\t\t\t\tborder: #444 !important;\n\t\t\t\t\tcolor: #f4f4f4 !important;\n\t\t\t\t}\n\t\n\t\t\t\t.clockify-button-inactive {\n\t\t\t\t\tcolor: rgba(255, 255, 255, 0.81) !important;\n\t\t\t\t}");document.head.append(t)}():void $(".clockify-custom-style-dark")?.remove()}new MutationObserver(e).observe(document.body,{attributes:!0}),e()}};function getClockifyButtonHTML({isActive:t,isSmall:e,options:o}){const n=document.createElement("div"),i=document.createElement("span"),{START_TIMER:r,STOP_TIMER:c}=clockifyLocales||{START_TIMER:"Start timer",STOP_TIMER:"Stop timer"},s=t?"clockify-button-active clockify-button-active-span":"clockify-button-inactive clockify-button-inactive-span",a=t?c:r,l=t?'<svg width="15"height="16"viewBox="0 0 15 16"fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0065 2.04616C11.4838 1.56806 11.3811 0.764579 10.7508 0.522636C9.8712 0.185007 8.91622 0 7.91809 0C3.54505 0 0 3.5511 0 7.93162C0 12.3121 3.54505 15.8632 7.91809 15.8632C8.91006 15.8632 9.85941 15.6805 10.7345 15.3468C11.3664 15.1059 11.4702 14.3009 10.992 13.8219C10.6822 13.5115 10.2133 13.4391 9.79745 13.5775C9.20813 13.7738 8.57779 13.88 7.92268 13.88C4.6429 13.88 1.9841 11.2167 1.9841 7.93131C1.9841 4.64592 4.6429 1.98259 7.92268 1.98259C8.58253 1.98259 9.21724 2.09041 9.81022 2.28937C10.2263 2.42902 10.6962 2.35702 11.0065 2.04616Z" fill="#03A9F4"/><path d="M9.11681 8.02279C9.11681 8.57666 8.66782 9.02564 8.11396 9.02564C7.5601 9.02564 7.11111 8.57666 7.11111 8.02279C7.11111 7.46893 7.5601 7.01994 8.11396 7.01994C8.66782 7.01994 9.11681 7.46893 9.11681 8.02279Z" fill="#03A9F4"/><path d="M9.65974 5.15543C9.3005 5.5124 9.3005 6.09115 9.65974 6.44812C10.019 6.80509 10.6014 6.80509 10.9607 6.44812L13.9528 3.47494C14.312 3.11797 14.312 2.53922 13.9528 2.18225C13.5936 1.8253 13.0111 1.8253 12.6519 2.18225L9.65974 5.15543Z" fill="#03A9F4"/><path d="M9.65974 10.7078C9.3005 10.3508 9.3005 9.7721 9.65974 9.41513C10.019 9.05816 10.6014 9.05816 10.9607 9.41513L13.9528 12.3883C14.312 12.7453 14.312 13.324 13.9528 13.681C13.5936 14.0379 13.0111 14.0379 12.6519 13.681L9.65974 10.7078Z" fill="#03A9F4"/> </svg>':'<svg width="16" \theight="16" \tviewBox="0 0 16 16" \txmlns="http://www.w3.org/2000/svg" > \t<path \t\td="M11.0065 2.04616C11.4838 1.56806 11.3811 0.764579 10.7508 0.522636C9.8712 0.185007 8.91622 0 7.91809 0C3.54505 0 0 3.5511 0 7.93162C0 12.3121 3.54505 15.8632 7.91809 15.8632C8.91006 15.8632 9.85941 15.6805 10.7345 15.3468C11.3664 15.1059 11.4702 14.3009 10.992 13.8219C10.6822 13.5115 10.2133 13.4391 9.79745 13.5775C9.20813 13.7738 8.57779 13.88 7.92268 13.88C4.6429 13.88 1.9841 11.2167 1.9841 7.93131C1.9841 4.64592 4.6429 1.98259 7.92268 1.98259C8.58253 1.98259 9.21724 2.09041 9.81022 2.28937C10.2263 2.42902 10.6962 2.35702 11.0065 2.04616Z" \t\tfill="#60747D" \t/> \t<path \t\td="M9.11681 8.02279C9.11681 8.57666 8.66782 9.02564 8.11396 9.02564C7.5601 9.02564 7.11111 8.57666 7.11111 8.02279C7.11111 7.46893 7.5601 7.01994 8.11396 7.01994C8.66782 7.01994 9.11681 7.46893 9.11681 8.02279Z" \t\tfill="#60747D" \t/> \t<path \t\td="M9.65974 5.15543C9.3005 5.5124 9.3005 6.09115 9.65974 6.44812C10.019 6.80509 10.6014 6.80509 10.9607 6.44812L13.9528 3.47494C14.312 3.11797 14.312 2.53922 13.9528 2.18225C13.5936 1.8253 13.0111 1.8253 12.6519 2.18225L9.65974 5.15543Z" \t\tfill="#60747D" \t/> \t<path \t\td="M9.65974 10.7078C9.3005 10.3508 9.3005 9.7721 9.65974 9.41513C10.019 9.05816 10.6014 9.05816 10.9607 9.41513L13.9528 12.3883C14.312 12.7453 14.312 13.324 13.9528 13.681C13.5936 14.0379 13.0111 14.0379 12.6519 13.681L9.65974 10.7078Z" \t\tfill="#60747D" \t/> </svg>';i.innerHTML=`<span class="${s}">${a}</span>`;const{inactiveButtonColor:u}=o;return i.style.color=t?"#03A9F4":u??"#444444",n.innerHTML=l,e||n.append(i),n}function addHoverEffect(t){const e=createTag("style","clockify-integration",`${t} .clockifyButton:not(.active) { display: none !important; }\n${t}:hover .clockifyButton { display: flex !important; }`);e.setAttribute("data-clockify-onhover-for-timer",t),document.head.append(e)}function objectFromParams(t,e,o){return"object"==typeof t?t:{description:t||"",projectName:e||null,taskName:o||null,billable:null}}function $(t,e=document){return e.querySelector(t)}function $$(t,e=document){return e.querySelectorAll(t)}function $$$(t,e=documents){return e.map((e=>e.querySelectorAll(t))).map((t=>Array.from(t))).flat()}function text(t,e=document){return $(t,e)?.textContent?.trim()}function value(t,e=document){return $(t,e)?.value?.trim()}function textList(t,e=document,o=!0){const n=Array.from($$(t,e)||[]).map((t=>t.textContent)).filter((t=>Boolean(t))).map((t=>t.trim()));return o?[...new Set(n)]:n}function timeout({milliseconds:t}){return new Promise((e=>setTimeout(e,t)))}function waitForElement(t,e=document){return new Promise((o=>{if($(t,e))return o($(t,e));const n=new MutationObserver((function(){const i=$(t,e);i&&(n.disconnect(),o(i))})),i=document.body;n.observe(i,{childList:!0,subtree:!0})}))}function getCssValue(t,e){return t instanceof HTMLElement?getComputedStyle(t,null).getPropertyValue(e):console.error("First argument must be element.")}function applyStyles(t,e="clockify-custom-styles"){removeStyles(e);const o=createTag("style",e,t);document.head.append(o)}function removeStyles(t="clockify-custom-styles"){const e=t.split(" ").map((t=>`.${t}`)).join("");$(e)?.remove()}function createContainer(){const t=createTag("div","clockify-widget-container");return t.append(...arguments),t}async function setManualElementsVisibility(){const t="clockify-hide-manual-elements";await isManuallyDisabled()?applyStyles("#clockify-manual-input-form, .clockify-copy-as-entry-container, .input-button-link { display: none !important; }",t):removeStyles(t)}async function isManuallyDisabled(){const t=await localStorage.getItem("workspaceSettings"),{timeTrackingMode:e}=JSON.parse(t||"{}");return"STOPWATCH_ONLY"===e}async function getSelectors(t,e,o){if(!_selectors){const t=await aBrowser.storage.local.get(["integrationSelectors"]),{integrationSelectors:e}=t;_selectors=e}return o?_selectors[t][e][o]:e?_selectors[t][e]:t?_selectors[t]:_selectors}function invokeIfFunction(t){return t instanceof Function?invokeIfFunction(t()):t}function objInvokeIfFunction(t){const e={};for(const o of Object.keys(t))e[o]=invokeIfFunction(t[o]);return e}function createTag(t,e="",o=""){const n=document.createElement(t);return n.className=e,n.textContent=o,n}function isAppendUrlEnabled(){return localStorage.getItem("permanent_appendWebsiteURL")}function withAppendedUrl(t){const e=`${document.title} - ${window.location.href}`,o=t.includes(" | ")?" || ":" | ";return t.endsWith(e)?t:`${t}${o}${e}`}function withoutAppendedUrl(t,e){return t?.split(e)[0]}async function isPopupShowable({hasDescriptionValue:t}){const e=await localStorage.getItem("wsCustomFields"),o=await localStorage.getItem("workspaceSettings"),n=JSON.parse(e||"[]"),i=JSON.parse(o||"{}"),{forceDescription:r,forceProjects:c,forceTasks:s,forceTags:a}=i,l=r&&!t||c||s||a,u=n.find((({required:t})=>Boolean(t)));return l||u||_clockifyShowPostStartPopup}function closestClockifyButton(t,e=".clockifyButton"){let o=t;for(;o;){const t=o.querySelector(e);if(t)return t;o=o.parentElement}return null}function inputMessage(t,e,o,n=!1){t.readOnly=!0;const i=t.value,r=["clockify-input-default","clockify-input-error","clockify-input-success"];t.classList.remove(...r),t.classList.add("clockify-input-"+o),t.value=e,setTimeout((()=>{t.value=n?"":i,t.classList.remove(...r),t.classList.add("clockify-input-default"),t.readOnly=!1}),1500)}function setButtonProperties(t,e,o,n=0){t.title=e;const i=t.classList.contains("small"),r=i?"clockifySmallButton":"clockifyButton";t.classList.add("clockifyButton","clockifyButtonId"+n),t.setAttribute("id",r),window.updateButtonProperties({title:e,active:o,small:i,buttonId:n},{inProgressDescription:clockifyButton.inProgressDescription})}function updateButtonOnProgressChanged(t){const{newValue:e,oldValue:o}=t;clockifyButton.inProgressDescription=e&&e.id?e.description:"",$$$(".clockifyButton").forEach((t=>{const n=t.className.match(/clockifyButtonId(\d+)/)[1],i=t.title||t.dataset.title,r=i?.includes(" | ")?" || ":" | ",c=withoutAppendedUrl(i,r),s=withoutAppendedUrl(e?.description,r),a=withoutAppendedUrl(o?.description,r),l=e&&c===s;(c===s||c===a)&&(console.count("updateButtonState"),this.setButtonProperties(t,clockifyButton.inProgressDescription||i,l,n)),t.onEntryChanged&&t.onEntryChanged(e)}))}function removeAllClockifyStyles(){Array.from($$('style[class^="clockify"]')).forEach((t=>t.remove()))}async function hideClockifyButtonLinks(){const t=document.createElement("style");t.innerText="\n\t\t.clockify-widget-container,\n\t\t#clockifyButton, \n\t\t#clockify-manual-input-form,\n\t\t.clockify-copy-as-entry-container { \n\t\t\tdisplay: none !important; \n\t\t}\n\t",document.head.append(t)}function setClockifyButtonLinks(t){document.clockifyButtonLinks=document.clockifyButtonLinks||[],document.clockifyButtonLinks.push(t)}function removeAllButtons(t){const e=$$$(t||".clockifyButton, #clockify-manual-input-form"),o=$$$(".clockify");e.forEach((t=>t.parentNode.removeChild(t))),o.forEach((t=>t.classList.remove("clockify")))}async function setPostStartPopup(){const t=await localStorage.getItem("appStore"),e=JSON.parse(t).state.showPostStartPopup;_clockifyShowPostStartPopup=e}function clockifyDestroyPopupDlg(){const t=document.getElementById("divClockifyPopupDlg");t&&window.clockifyListeners&&(window.removeEventListener("click",window.clockifyListeners.clockifyClicks,!0),window.removeEventListener("change",window.clockifyListeners.clockifyChanges,!0),window.removeEventListener("resize",window.clockifyListeners.clockifyTrackResize,!0),window.removeEventListener("scroll",window.clockifyListeners.clockifyTrackScroll,!0),_clockifyPopupDlg.destroy(),document.body.removeChild(t),document.removeEventListener("click",window.clockifyListeners.clockifyRemovePopupDlg,!0),_clockifyPopupDlg=null)}function clockifyRepositionDropDown(){document.getElementById("divClockifyProjectDropDownPopup")?_clockifyProjectList.repositionDropDown():document.getElementById("divClockifyTagDropDownPopup")?_clockifyTagList.repositionDropDown():_clockifyPopupDlg.repositionDropDownCF()}function onChangedListener(t){const e=Object.keys(t);if(e.find((t=>"timeEntryInProgress"===t))){const e=t.timeEntryInProgress;_timeEntryInProgressDescription=e?.newValue?.description,this.updateButtonOnProgressChanged(e)}e.find((t=>"token"===t))&&aBrowser.storage.local.get(["token"],(t=>{t.token||(this.hideClockifyButtonLinks(),removeAllClockifyStyles())})),e.find((t=>"appStore"===t))&&setPostStartPopup(),e.find((t=>"wsSettings"===t))&&_clockifyShowPostStartPopup&&aBrowser.storage.local.get(["wsSettings"],(t=>{})),e.find((t=>"workspaceSettings"===t))&&aBrowser.storage.local.get(["workspaceSettings"],(t=>{const e=new CustomEvent("workspaceSettingsChanged");window.dispatchEvent(e),setManualElementsVisibility()})),e.find((t=>"integrationAlert"===t))&&aBrowser.storage.local.get(["integrationAlert"],(t=>{t.integrationAlert&&(alert(t.integrationAlert),aBrowser.storage.local.set({integrationAlert:""}))}))}function cleanup(){aBrowser.storage.onChanged.removeListener(onChangedListener),aBrowser.runtime.onMessage.removeListener(onMessageListener)}function onMessageListener(t,e,o){if("cleanup"===t.eventName&&cleanup(),"rerenderIntegrations"===t.eventName&&clockifyButton.rerenderAllButtons(),"urlChanged"===t.eventName){const t=new CustomEvent("urlChanged");window.dispatchEvent(t)}"passArgumentsToClockifyButton"===t.eventName&&(clockifyButton={...clockifyButton,injectedArguments:t.options})}window.clockifyListeners||(window.clockifyListeners={clockifyClicks:function(t){const e=document.getElementById("divClockifyPopupDlg");if(e)if(e.contains(t.target))_clockifyPopupDlg.onClicked(t.target),t.stopPropagation(),t.target&&("A"===t.target.tagName||t.target.id.startsWith("switchbox")||t.target.id.startsWith("txtCustomField"))||t.preventDefault();else{const e=document.getElementById("divClockifyProjectDropDownPopup");if(e&&e.contains(t.target))_clockifyPopupDlg.onClickedProjectDropDown(t.target),t.stopPropagation(),t.preventDefault();else{const e=document.getElementById("divClockifyTagDropDownPopup");if(e&&e.contains(t.target))_clockifyPopupDlg.onClickedTagDropDown(t.target),t.stopPropagation(),t.preventDefault();else{const e=document.getElementById("divClockifyLinkModal");e&&"none"!==e.style.display?(_clockifyPopupDlg.onClickedLinkModal(e,t.target),t.stopPropagation(),t.preventDefault()):_clockifyPopupDlg.onClickedCFPopup(t.target)&&(t.stopPropagation(),t.preventDefault())}}}},clockifyChanges:t=>{const e=document.getElementById("divClockifyPopupDlg");t.target&&"txtCustomFieldLinkModal"===t.target.id?($(".clockify-save").classList.remove("clockify-save--disabled"),t.stopPropagation(),t.preventDefault()):e&&e.contains(t.target)&&(_clockifyPopupDlg.onChanged(t.target),t.stopPropagation(),t.preventDefault())},clockifyRemovePopupDlg:t=>{const e=document.getElementById("divClockifyPopupDlg");if(e&&!e.contains(t.target)){const e=document.getElementById("divClockifyProjectDropDownPopup"),o=document.getElementById("divClockifyTagDropDownPopup");if(e&&e.contains(t.target)||o&&o.contains(t.target))return;clockifyDestroyPopupDlg()}},clockifyTrackResize:()=>{_clockifyPopupDlg&&clockifyRepositionDropDown()},clockifyTrackScroll:()=>{_clockifyPopupDlg&&clockifyRepositionDropDown()}}),aBrowser.storage.onChanged.addListener(onChangedListener),aBrowser.runtime.onMessage.addListener(onMessageListener);