import{a as et}from"../chunks/chunk-NTIITACF.js";import{a as O}from"../chunks/chunk-Z64FBUPL.js";import{a as I}from"../chunks/chunk-MT4LVDUX.js";import{a as it}from"../chunks/chunk-WN4MFSKN.js";import{a as V}from"../chunks/chunk-7S3YJSN5.js";import{M as E,a as w,d as L,e as A,f as _}from"../chunks/chunk-LADTODTA.js";import"../chunks/chunk-O4TFJKJQ.js";import{B as f,c as l,d as N,e as T,m as C,x as u}from"../chunks/chunk-WRHUMLYF.js";import"../chunks/chunk-AC7VHEB5.js";import"../chunks/chunk-HY2GWXPO.js";import"../chunks/chunk-XSKOAVIS.js";import{E as Z,G as tt,q as y}from"../chunks/chunk-OEPSEZ5A.js";import"../chunks/chunk-XERCZVWP.js";import"../chunks/chunk-AT6M4CEW.js";import{d as X,e as a}from"../chunks/chunk-3GYLW4KZ.js";var Ht=a(w());var F=a(Z());var k={};X(k,{google:()=>z,opentable:()=>U,tripadvisor:()=>B,yelp:()=>$});var R=a(tt()),x=a(y());var g;function ot(t){try{let e=T(/@([-0-9.]+,[-0-9.]+)/,x.default.get(t.dataset,"url")||t.href);if(e&&e.length){let i=e.split(","),n=i[0],o=i[1],s=document.querySelector('[data-local-attribute="d3bn"]').innerText,c=document.querySelector(".rhscol .ab_button").href,p=document.querySelector('.rhscol [data-md="1002"] [data-local-attribute="d3adr"] > span:nth-child(2)').innerText.trim(),b=document.querySelector('.rhscol [data-md="1006"] [data-local-attribute="d3ph"] > span:nth-child(2)').innerText.trim();return{latitude:n,longitude:o,title:s,website:c,address:p,phone:b}}}catch(e){console.log(e)}}function M(){let t=document.querySelector(".rhscol .kp-header .kno-fb-ctx div > a[tabindex]");if(t)return g&&g.disconnect(),ot(t)}var z=async()=>{if(window.location.hostname!=="www.google.com")return;let t=M();if(t)return t;let e=document.getElementById("main");if(e)return new R.default(i=>{g=new MutationObserver(x.default.debounce(n=>{let o=M();o&&i(o)},500)),g.observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0})})};var P=a(et());function m(t,e){if(e&&e.$)try{let i=e.$(t);if(i)return i.attr("content")}catch{}else try{let i=document.querySelector(t);if(i)return i.getAttribute("content")}catch{}}function G(t){try{let e=m('[property="place:location:latitude"]',{$:t});if(e){let i=m('[property="place:location:longitude"]',{$:t}),n=m('[property="og:description"]',{$:t}).split(",")[0],o=m('[property="business:contact_data:website"]',{$:t}),s=m('[property="business:contact_data:street_address"]',{$:t}),c=m('[property="business:contact_data:phone_number"]',{$:t});return{latitude:e,longitude:i,title:n,website:o,address:s,phone:c}}}catch{}}async function nt(t){let i=await(await fetch(t)).text(),n=P.default.load(i);return G(n)}var U=async()=>{let t=document.querySelector('[data-bf-acceptance="restaurantLink"]');return t?nt(t.href):G()};var H=a(y());function at(){try{let t=H.default.find(document.querySelectorAll("script"),p=>{if(p.innerText.indexOf("lat: ")>-1)return!0});if(!t)return;let[e,i,n]=t.innerText.match(/lat\:\s([0-9-,.]+),\nlng\:\s([0-9-,.]+),/),o=document.querySelector("#HEADING").innerText.trim(),s=document.querySelector(".address").innerText.trim(),c=document.querySelector(".blEntry.phone").innerText.trim();return{latitude:i,longitude:n,title:o,address:s,phone:c}}catch(t){console.log(t)}}var B=async()=>{if(location.pathname.indexOf("/Restaurant_Review")>-1)return at()};function rt(){try{let t=document.querySelector("[data-map-state]");if(t){let e=JSON.parse(t.getAttribute("data-map-state")),i=e.center.latitude,n=e.center.longitude,o=document.querySelector("h1").innerText.trim(),s=document.querySelector(".biz-website a"),c=s&&s.innerText.toLowerCase().trim(),p=document.querySelector(".street-address").innerText.trim(),b=document.querySelector(".biz-phone").innerText.trim();return{latitude:i,longitude:n,title:o,website:c,address:p,phone:b}}}catch{}}var $=async()=>rt();function v(){try{let t=F.default.getDomain(window.location.href),e=k[t.replace(".com","")];if(e)return e()}catch{return{error:"Site not supported"}}}var j=t=>u("findDeal",t);var Nt=a(w()),W=a(w()),h=a(it()),d=a(y());var S=t=>u("throttleGrouponNotification",t);var J=t=>u("visitDeal",t);var r=a(_()),D=class extends W.Component{constructor(...e){super(...e),this.state={hideNotification:!0}}componentDidMount(){f("page","dealsNotification",{view:"dealsNotification",type:"notification",offerSignUp:d.default.get(this.props.view,"offerSignUp"),qualified:d.default.get(this.props.view,"qualified",!1),balance:d.default.get(this.props.view,"balance",0),dealType:d.default.get(this.props,"view.deal.dealType","groupon")}),setTimeout(()=>{this.setState({hideNotification:!1})},1e3)}render(){let{hideNotification:e}=this.state,{title:i,discount:n}=d.default.get(this.props,"view.deal",{}),o=!0,s=!0;return(0,r.jsx)("div",{className:e?"disabled deals-page":"deals-page",style:{top:o?"0":"auto",bottom:o?"auto":"0",left:s?"auto":"0",right:s?"0":"auto"},children:(0,r.jsx)(h.Motion,{style:{opacity:(0,h.spring)(e?0:1,{stiffness:180,damping:20}),y:(0,h.spring)(e?o?-100:100:0,{stiffness:180,damping:20})},children:({opacity:c,y:p})=>(0,r.jsxs)("div",{className:"deals-notification",style:{transform:`translate3d(0,${p}%,0)`,opacity:`${c}`},children:[(0,r.jsx)("header",{children:(0,r.jsx)(V,{})}),(0,r.jsxs)("section",{children:[(0,r.jsx)("h2",{children:i}),(0,r.jsxs)("h4",{children:["save ",I(n,{removeCents:!0}),d.default.get(this.props,"view.queryData.title")?` at ${d.default.get(this.props,"view.queryData.title")}`:""]}),(0,r.jsx)("div",{className:"button-wrapper",children:(0,r.jsx)("button",{className:"primary-btn-large",onClick:this.onClickDeal.bind(this),children:"View on Groupon"})}),(0,r.jsx)("h4",{className:"bold maybe-later tertiary-link",onClick:this.onClosePopup.bind(this,"no thanks"),children:"no thanks"})]})]})})})}async onClickDeal(){let e="viewGrouponDeal",{clickId:i,redirectId:n}=O();f("trackClick",e,"view deal",{clickId:i,redirectId:n});let o=C({params:{channel:"cart",clickEvent:e,destUrl:`${d.default.get(this.props,"view.deal.url")}&wid=${location.hostname}`,redirectId:n,subExperience:"groupon_view_offer"},isWbPublisher:!0});J({redirect:o}),this.setState({hideNotification:!0}),S()}onClosePopup(e){this.setState({hideNotification:!0}),f("trackClick","dismissDealsNotification",e),S()}},q=A({view:["dealsView"],events:["events"],session:["session"]},D);var Q=a(_());function st(){return l.get("checkingHotels")!==!0&&l.get("hotelView")===void 0}async function ct(t){if(t){l.set("pageViewId",window.__wb_page_view_id),f("track","bizDealSearch",{...t,url:location.href});let e=await j(t);if(!e)return;l.set("pendingDealsView",{deal:e,queryData:t}),st()?Y():l.set("displayDealsViewIfDeal",Y)}}function Y(){let t=l.get("pendingDealsView");t&&(N({active:!0}),l.set("dealsView",t),E({initialRoute:"/deals",cssUrl:"deals.css",route:(0,Q.jsx)(L,{path:"deals",component:q})}),l.set("pendingDealsView",void 0))}async function K(){let t=await v();ct(t)}document.readyState!=="loading"?K():document.addEventListener("DOMContentLoaded",K);
