class TwitterPlugin extends SitePlugin{inject(){let i=null,t=0;function r(){function s(e,t){e.setAttribute("eagle-src",t),e.setAttribute("eagle-src-type","video")}function n(e){e.setAttribute("eagle-src-loading","true")}function u(e){e.removeAttribute("eagle-src-loading")}function d(e,t,i){u(e),u(t),null!=i&&u(i)}if(location.href.startsWith("https://twitter.com")||location.href.startsWith("https://x.com"))for(var e=["video:not([eagle-src]):not([eagle-src-loading])"],t=0;t<e.length;t++){var i=document.querySelectorAll(e[t]);0<i.length&&i.forEach((e,t)=>{if(!(-1<e.currentSrc.indexOf(".mp4"))&&(i=e.closest("article").querySelector('a[href$="/retweets"],a[href$="/analytics"],a[href*="/status/"]'))&&(i=i.getAttribute("href")).match(/\d+/)){var i=i.match(/\/(\d+)\/?/)[1],a=e;let o=a.nextElementSibling,c=a.closest("article").querySelector("video");if(n(a),null!=o&&n(o),null!=c){n(c);var i=`https://${location.hostname}/i/api/2/timeline/conversation/${i}.json?tweet_mode=extended&include_entities=false&include_user_entities=false`,e={authorization:"Bearer AAAAAAAAAAAAAAAAAAAAANRILgAAAAAAnNwIzUejRCOuH5E6I8xnZz4puTs%3D1Zv7ttfk8LF81IUq16cHjhLTvJu4FA33AGWWjCpTnA","x-twitter-active-user":"yes","x-twitter-client-language":(e=function(){let r={};return document.cookie.split(";").filter(e=>0<e.indexOf("=")).forEach(e=>{e.replace(/^([^=]+)=(.+)$/,(e,t,i)=>{r[t.trim()]=i.trim()})}),r}()).lang,"x-csrf-token":e.ct0},r=a.getAttribute("poster").split("/");let l=r[r.length-1].split(".")[0];fetch(i,{headers:e}).then(e=>e.json()).then(e=>{var t,i=e.globalObjects.tweets;let r=null;for(t in i){var n=i[t];if(n.extended_entities&&n.extended_entities.media&&"video"==(n=n.extended_entities.media[0]).type&&n.media_url.includes(l)){let e=n.video_info.variants;e=(e=e.filter(e=>e.bitrate&&"video/mp4"==e.content_type)).sort((e,t)=>e.bitrate>t.bitrate?-1:1),r=e[0].url;break}}if(!r)throw"force exit";s(a,r),s(c,r),c.setAttribute("draggable","true"),u(a),u(c),null!=o&&(s(o,r),u(o))},()=>{d(a,c,o)}).catch(e=>{d(a,c,o)})}}})}}window.addEventListener("load",()=>{r()}),setInterval(()=>{if(location.href!=i){i=location.href;{var n=()=>{r()},e=document.querySelector('div[role="dialog"]'),t=document.querySelector("body div#react-root");let i=document.querySelector("video");if(null!=i)n();else if(null!=e){let t=new MutationObserver(function(e){(i=document.querySelector("video"))&&(n(),t.disconnect())});t.observe(e,{childList:!0,subtree:!0})}else if(null!=t){let r=new MutationObserver(function(e){for(var t=0;t<e.length;t++){var i=e[t];if("attributes"==i.type&&"VIDEO"===i.target.tagName)return n(),void r.disconnect()}});r.observe(t,{childList:!0,subtree:!0,attributes:!0})}}}},500);{let e=null;window.addEventListener("scroll",()=>{clearTimeout(e),e=setTimeout(()=>{window.document.body.scrollHeight!=t&&(t=window.document.body.scrollHeight,r())},300)})}r()}getMeta(e){var t,i,r={};return(location.href.includes("twitter.com")||location.href.includes("x.com"))&&(e=e.closest("article"))&&((t=e.querySelector("a[href]"))&&(t=t.getAttribute("href").replace("/",""),i=e.querySelector('div[dir="auto"]'),r.customTitle=i?`@${t} `+i.innerText:"@"+t),i=e.querySelector('a[href*="/status/"]'))&&(r.link=i.href),r}}(()=>{var e=new TwitterPlugin;eagle.plugin.register("twitter.com",e),eagle.plugin.register("x.com",e),e.inject()})();