import{$ as l}from"./cplx-BbAh7E-i.js";import{l as p,U as h,s as g,p as y}from"./cplx-Cdcyb6EG.js";import{s as w,p as I}from"./cplx-DD6dUv5H.js";import{o as m}from"./cplx-DNOGgzzX.js";import"./cplx-wwbq-DDb.js";import"./cplx-B814hFp-.js";const u=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;const U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=Array.prototype.slice.call(U);(e=>{let t={};return e.forEach((r,n)=>t[r]=n),t})(d);const b=String.fromCharCode.bind(String);typeof Uint8Array.from=="function"&&Uint8Array.from.bind(Uint8Array);const x=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),P=e=>{let t,r,n,o,s="";const c=e.length%3;for(let a=0;a<e.length;){if((r=e.charCodeAt(a++))>255||(n=e.charCodeAt(a++))>255||(o=e.charCodeAt(a++))>255)throw new TypeError("invalid character found");t=r<<16|n<<8|o,s+=d[t>>18&63]+d[t>>12&63]+d[t>>6&63]+d[t&63]}return c?s.slice(0,c-3)+"===".substring(c):s},k=typeof btoa=="function"?e=>btoa(e):u?e=>Buffer.from(e,"binary").toString("base64"):P,f=u?e=>Buffer.from(e).toString("base64"):e=>{let r=[];for(let n=0,o=e.length;n<o;n+=4096)r.push(b.apply(null,e.subarray(n,n+4096)));return k(r.join(""))},A=(e,t=!1)=>t?x(f(e)):f(e);function v(){m("mermaidRenderer:isInitialized",()=>{var e;return((e=i.getInstance())==null?void 0:e.isInitialized())??!1}),m("mermaidRenderer:render",({data:{selector:e}})=>i.getInstance().handleRenderRequest(e)),m("mermaidRenderer:getPlaygroundUrl",({data:{code:e}})=>i.getInstance().handleGetPlaygroundUrlRequest(e))}class i{static instance=null;importPromise=null;constructor(){}static getInstance(){return i.instance||(i.instance=new i),i.instance}initialize(){v(),l(()=>this.importMermaid())}async importMermaid(){if(!this.importPromise){const t=`
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@${y.devDependencies.mermaid}/dist/mermaid.esm.min.mjs';

        window.mermaid = mermaid;
      `;this.importPromise=p({scriptContent:t,waitForExecution:!0}).catch(r=>{throw console.error("Failed to import Mermaid:",r),r})}return this.importPromise}isInitialized(){var t;return(t=this.importPromise)==null?void 0:t.then(()=>!0).catch(()=>!1)}async handleRenderRequest(t){const r=l(t);if(r.length===0)return console.warn("No elements found for rendering Mermaid"),{success:!1,error:"No elements found for rendering Mermaid"};if(r.find("svg").length>0)return{success:!0};try{await i.waitForInitialization();const s={startOnLoad:!1,theme:h.isDarkTheme()?"dark":"base",gitGraph:{useMaxWidth:!0},fontFamily:"var(--font-fk-grotesk)"};window.mermaid.initialize(s),await window.mermaid.run({nodes:[r[0]]});const c=r.find("svg");c.css({width:"100%",maxWidth:"100%",height:"100%"});const a=w(c[0],{center:!0,fit:!0,contain:!0,dblClickZoomEnabled:!0});return r.on("resetZoom",()=>{a.resetZoom()}),r.on("resetPan",()=>{a.resetPan()}),{success:!0}}catch(o){return{success:!1,error:o.str}}}async handleGetPlaygroundUrlRequest(t){try{await i.waitForInitialization();const r=JSON.stringify({code:t}),n=new TextEncoder().encode(r),o=I.deflate(n,{level:9});return`https://mermaidchart.com/play#pako:${A(o,!0)}`}catch(r){return console.error("[MermaidRenderer] Error getting playground URL:",r),""}}static async waitForInitialization(){for(;!i.getInstance().isInitialized();)await g(100)}}i.getInstance().initialize();export{i as MermaidRenderer};
