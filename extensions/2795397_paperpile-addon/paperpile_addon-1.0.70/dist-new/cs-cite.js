!function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1419)}({1:function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},112:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(7)),i=s(r(122));class a extends i.default{static generateRandomId(){const e=(Math.random()+1).toString(36).substring(2,7);return 5===e.length?e:a.generateRandomId()}getDefaultLevel(){var e;const t=null===(e=this.localStorage)||void 0===e?void 0:e.getItem(a.LOG_LEVEL_LOCAL_STORAGE_KEY);return"string"==typeof(r=t)&&["debug","info","warn","error"].includes(r)?t:"warn";var r}constructor(e,t,r){super(),this.context=e,t&&("getItem"in t?this.localStorage=t:t.addUniqueContextId&&(this.contextId=a.generateRandomId())),null!=r&&r.addUniqueContextId&&(this.contextId=a.generateRandomId());const s="object"==typeof self?self:null;s&&(s.ppLoggerSetLevel=this.setLevel.bind(this)),this.setLevel(this.getDefaultLevel())}setLevel(e){var t;super.setLevel(e),null===(t=this.localStorage)||void 0===t||t.setItem(a.LOG_LEVEL_LOCAL_STORAGE_KEY,e)}getContextId(){if(!this.contextId)throw new Error("Initialize LoggerConsole with addUniqueContextId true");return this.contextId}getFormattedContextAndLabel(e){const t=this.contextId?`[${this.contextId}]`:"";return`[${this.context}]${t}[${e}]`}log(e){let{label:t,level:r,messages:s}=e;console[r]("%c"+this.getFormattedContextAndLabel(t),"color: "+a.CONTEXT_COLORS[this.context],...s)}now(){return"undefined"==typeof performance?Date.now():performance.now()}}(0,n.default)(a,"LOG_LEVEL_LOCAL_STORAGE_KEY","ppLoggerLogLevel"),(0,n.default)(a,"CONTEXT_COLORS",{bg:"#A03133",cs:"#238F5C",webapp:"#2F69A3",worker:"#5998DA",sw:"#CEB74C",offscreen:"#7B1F2A"});var o=a;t.default=o},113:function(e,t,r){var s=r(15).default;e.exports=function(e,t){if("object"!=s(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},122:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(7)),i=r(56);class a{static isDisabledInTests(){return!1}static getTimerKey(e,t){return`${e}-${t}`}constructor(){(0,n.default)(this,"startedTimers",new Map),this.setEnabledLevels("warn")}setEnabledLevels(e){this.enabledLevels={debug:"debug"===e,info:"debug"===e||"info"===e,warn:"debug"===e||"info"===e||"warn"===e,error:!0}}setLevel(e){this.setEnabledLevels(e)}setBugsnagClient(e){this.bugsnagClient=e}logIfEnabled(e){this.enabledLevels[e.level]&&!a.isDisabledInTests()&&this.log(e)}debug(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];this.logIfEnabled({level:"debug",messages:r,label:e})}info(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];this.logIfEnabled({level:"info",messages:r,label:e})}warn(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];this.logIfEnabled({level:"warn",messages:r,label:e})}error(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];this.logIfEnabled({level:"error",messages:r,label:e});const n=r.pop();if((0,i.isObject)(n)){if(n.toString().includes("xhr poll error"))return}if("string"==typeof n){var a,o;const e=new Error(n);e.stack=null===(a=e.stack)||void 0===a?void 0:a.split("\n").filter((e,t)=>1!==t&&!e.includes("node_modules/@babel/runtime/helpers")).join("\n"),null===(o=this.bugsnagClient)||void 0===o||o.notify(e)}else{var l;null===(l=this.bugsnagClient)||void 0===l||l.notify(n)}}errorNoNotify(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];this.logIfEnabled({level:"error",messages:r,label:e})}time(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.enabledLevels.debug)return;const s=a.getTimerKey(e,t);!this.startedTimers.has(s)||r.overrideStartedTimer?this.startedTimers.set(s,this.now()):this.warn(e,`\ud83d\udd52 Timer '${t}' already started`)}timeEnd(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.enabledLevels.debug)return;const s=a.getTimerKey(e,t),n=this.startedTimers.get(s);if(void 0===n)return void(r.ignoreNotStartedWarning||this.warn(e,`\ud83d\udd52 Timer '${t}' was not started`));this.startedTimers.delete(s);const i=this.now()-n;this.timePrint(e,t,i)}timePrint(e,t,r){this.debug(e,`\ud83d\udd52 ${t}: ${parseFloat(r.toFixed(2))} ms`)}}var o=a;t.default=o},139:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.errorToPaperpileError=t.default=void 0;var n=s(r(33)),i=s(r(54));class a extends n.default{constructor(e,t){super("PaperpileError",e.key,e,t)}}t.default=a;t.errorToPaperpileError=(e,t)=>e instanceof i.default?e:new a(t,{cause:e})},1419:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(92)),i=s(r(38));self.Remote||(self.executionContext="cs",self.Remote=new n.default({origin:"cs",logger:i.default}),self.Remote.addListener()),self.Remote.addActions({"cite.checkCiteConnection":()=>"alive","cite.broadcastProgress":e=>{var t;app&&null!=e&&e.fn&&app[e.fn]&&app[e.fn](null==e||null===(t=e.args)||void 0===t?void 0:t[0])}}),self.PP.Msg.sendMessage=async e=>{if(e.sessionInfoRequest){const e=await self.Remote.bg.execute("mv3-cite.sessionInfoRequest",void 0,{});e&&(self.PP.Session.set("user_id",e.result._id),self.PP.Session.set("google_email",e.result.google_email))}else if(e.fn)if("copyUrl"===e.fn);else{if("refreshCitations"===e.fn){const t=window.location.href.match(/tab=(t\..{12})/);if(t&&t[1]&&e.args&&Array.isArray(e.args)){const[,r]=t;e.args[0].gdocsTabId=r}}const r=await self.Remote.bg.execute("mv3-cite."+e.fn,void 0,{args:e});if(e.callback&&(e.callback(null==r?void 0:r.result),"exportDocReferences"===e.fn&&null!=r&&r.result)){var t;const s=new Blob([null==r?void 0:r.result],{type:"text/plain"}),n=window.URL.createObjectURL(s),i=document.createElement("a");i.href=n,i.download="References from."+("bibtex"===(null==e||null===(t=e.args)||void 0===t?void 0:t[0].format)?"bib":"ris"),document.body.appendChild(i),i.click(),i.remove()}}};const a=setInterval(async()=>{const e=await self.Remote.bg.execute("remote.test-connection");e&&e.result||clearInterval(a)},1e4);var o=self.Remote;t.default=o},148:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(76));const i=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s={transferables:{},data:e};if(!e)return s;if(!r&&!(0,n.default)(e))return s;for(const[r,n]of Object.entries(e)){const a=`${t}.${r}`;if(n instanceof File)s.transferables[a]={type:"file",bufferOrString:await new Response(n).arrayBuffer(),fileName:n.name},delete s.data[r];else if(n instanceof Blob)s.transferables[a]={type:"blob",bufferOrString:await new Response(n).arrayBuffer()},delete s.data[r];else if(n instanceof ArrayBuffer)s.transferables[a]={type:"arrayBuffer",bufferOrString:n},delete s.data[r];else if(Array.isArray(n)){s.data[r]=[];for(const[e,t]of n.entries()){const n=await i({[e]:t},a+"[]",!0);s.transferables={...s.transferables,...n.transferables},s.data[r][e]=n.data[e]}}else if("object"==typeof e[r]){const t=await i(e[r],a,!0);s.transferables={...s.transferables,...t.transferables},s.data[r]=t.data}}return s};var a=i;t.default=a},149:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(76));const i=e=>{const t=new FileReader;return t.readAsDataURL(e),new Promise(e=>{t.addEventListener("load",()=>{e(t.result)})})},a=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s={transferables:{},data:e};if(!e)return s;if(!r&&!(0,n.default)(e))return s;s.data={...e};for(const[r,n]of Object.entries(e)){const e=`${t}.${r}`;if(n instanceof File)s.transferables[e]={type:"file",bufferOrString:await i(n),fileName:n.name},delete s.data[r];else if(n instanceof Blob)s.transferables[e]={type:"blob",bufferOrString:await i(n)},delete s.data[r];else if(n instanceof ArrayBuffer)s.transferables[e]={type:"arrayBuffer",bufferOrString:await i(new Blob([n]))},delete s.data[r];else if(Array.isArray(n)){s.data[r]=[];for(const[t,i]of n.entries()){const n=await a({[t]:i},e+"[]",!0);s.transferables={...s.transferables,...n.transferables},s.data[r][t]=n.data[t]}}else if("object"==typeof n){const t=await a(n,e,!0);s.transferables={...s.transferables,...t.transferables},s.data[r]=t.data}}return s};var o=a;t.default=o},15:function(e,t){function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},150:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const s=async e=>await fetch(e).then(e=>e.blob());var n=async e=>{if(!e||!e.data)return;const{data:t}=e;for(const n of Object.keys(e.transferables||{})){var r;const i=null===(r=e.transferables)||void 0===r?void 0:r[n];if(!i)continue;const a=n.split(".").filter(e=>""!==e);let o=t;for(const[e,t]of a.entries()){const r=t.endsWith("[]")?t.substr(0,t.length-2):t,n=Array.isArray(o)?Number.parseInt(r,10):r;if(e!==a.length-1)o[n]||(o[n]=t.endsWith("[]")?[]:{}),o=o[n];else{const e="string"==typeof i.bufferOrString?await s(i.bufferOrString):i.bufferOrString;switch(i.type){case"file":o[n]=new File([e],i.fileName);break;case"blob":o[n]=e instanceof Blob?e:new Blob([e]);break;case"arrayBuffer":o[n]=e instanceof Blob?await e.arrayBuffer():e;break;default:throw new Error(`Unexpected transferable type "${i.type}"`)}}}}return t};t.default=n},151:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=e=>Object.values(e.transferables).map(e=>e.bufferOrString);t.default=s},152:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(33));class i extends n.default{constructor(e,t,r){super("AnyExtraError",e,t,r)}}t.default=i},153:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getExtensionProtocol=t.detectBrowser=void 0;t.detectBrowser=()=>{const e=navigator.userAgent.toLowerCase();return e.indexOf("firefox")>-1?"firefox":-1!==e.indexOf("safari")?e.indexOf("chrome")>-1?"chrome":"safari":"chrome"};t.getExtensionProtocol=e=>{let t="chrome-extension";return"firefox"===e?t="moz-extension":"safari"===e&&(t="safari-web-extension"),t}},20:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPaperpileContentUrl=t.SHARING_STATUS_MAX_PROFILES=t.PP_APP_ENV=t.MIXPANEL_TOKEN=t.MIXPANEL_PROXY=t.GIT_COMMIT=t.BUILD_NUMBER=t.BUGSNAG_API_KEY=t.PP_SHARING_PAGE=t.GURU_API_URL=t.NEW_WEBAPP_URL=t.PLACK_URL=t.PAPERPILE_API_URL=t.PP_ENV=void 0;let s="http://127.0.0.1:4000",n="http://127.0.0.1:8080",i="http://127.0.0.1:6001";let a="http://127.0.0.1:4000/api/public/webview",o="59fa99ce170d752811cbdaeaec8175fc";if(!["development","test","staging","production"].includes("production"))throw new Error("PP_ENV=production, it must be set to development|test|staging|production.");t.PP_ENV="production",s="https://api.paperpile.com",n="https://paperpile.com",i="https://app.paperpile.com",o="81138760cb01e5b56e5c9d91162d40ae",a="https://paperpile.com/shared";const l=s;t.PAPERPILE_API_URL=l;const c=n;t.PLACK_URL=c;const u=i;t.NEW_WEBAPP_URL=u;t.GURU_API_URL="https://search.paperpile.com";const d=a;t.PP_SHARING_PAGE=d;const f=(e,t)=>{const r=Object({PP_ENV:"production",PP_APP_ENV:"firefox",BACKEND_URL:"https://api.paperpile.com",LIBRARY_SEARCH_URL:"https://library.paperpile.com",LIBRARY_SEARCH_SYNC_URL:"https://virginia.library.paperpile.com",BUGSNAG_API_KEY:"1d56ddd9b2081d1ae1acb38c28c2ec60",EXTENSION_BUILD_NUMBER:"70",GIT_COMMIT:"4151a9f55e9e3ca797c461b042b6431f703d5b19",MIXPANEL_PROXY:"https://e.paperpile.com"})[e];if(void 0!==r)return r;if(void 0!==t)return t;throw new Error(`getEnvVar error: ${e} not defined. Did you forget to set it in .env?`)},g=f("BUGSNAG_API_KEY");t.BUGSNAG_API_KEY=g;const h="1.5."+f("EXTENSION_BUILD_NUMBER");t.BUILD_NUMBER=h;const p=f("GIT_COMMIT");t.GIT_COMMIT=p;const v=f("MIXPANEL_PROXY","https://e.paperpile.com");t.MIXPANEL_PROXY=v;const b=o;t.MIXPANEL_TOKEN=b;const m=f("PP_APP_ENV");t.PP_APP_ENV=m;t.SHARING_STATUS_MAX_PROFILES=5;t.getPaperpileContentUrl=e=>"staging"===e?"https://stage.paperpile.com":"production"===e?"https://paperpile.com":"http://127.0.0.1:8081"},33:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(57));class i extends n.default{constructor(e,t,r,s){super(e,t,s),this.extra=r}toJSON(){return{...super.toJSON(),extra:this.extra}}}t.default=i},38:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(112)),i=r(20);const a=new n.default("cs",self.localStorage,{addUniqueContextId:!0});a.setLevel("production"===i.PP_ENV?"info":"debug");var o=a;t.default=o},48:function(e,t,r){"use strict";var s;r.r(t),r.d(t,"v1",(function(){return p})),r.d(t,"v3",(function(){return I})),r.d(t,"v4",(function(){return L})),r.d(t,"v5",(function(){return O})),r.d(t,"NIL",(function(){return C})),r.d(t,"version",(function(){return R})),r.d(t,"validate",(function(){return o})),r.d(t,"stringify",(function(){return f})),r.d(t,"parse",(function(){return v}));var n=new Uint8Array(16);function i(){if(!s&&!(s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(n)}var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var o=function(e){return"string"==typeof e&&a.test(e)},l=[],c=0;c<256;++c)l.push((c+256).toString(16).substr(1));var u,d,f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase();if(!o(r))throw TypeError("Stringified UUID is invalid");return r},g=0,h=0;var p=function(e,t,r){var s=t&&r||0,n=t||new Array(16),a=(e=e||{}).node||u,o=void 0!==e.clockseq?e.clockseq:d;if(null==a||null==o){var l=e.random||(e.rng||i)();null==a&&(a=u=[1|l[0],l[1],l[2],l[3],l[4],l[5]]),null==o&&(o=d=16383&(l[6]<<8|l[7]))}var c=void 0!==e.msecs?e.msecs:Date.now(),p=void 0!==e.nsecs?e.nsecs:h+1,v=c-g+(p-h)/1e4;if(v<0&&void 0===e.clockseq&&(o=o+1&16383),(v<0||c>g)&&void 0===e.nsecs&&(p=0),p>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");g=c,h=p,d=o;var b=(1e4*(268435455&(c+=122192928e5))+p)%4294967296;n[s++]=b>>>24&255,n[s++]=b>>>16&255,n[s++]=b>>>8&255,n[s++]=255&b;var m=c/4294967296*1e4&268435455;n[s++]=m>>>8&255,n[s++]=255&m,n[s++]=m>>>24&15|16,n[s++]=m>>>16&255,n[s++]=o>>>8|128,n[s++]=255&o;for(var w=0;w<6;++w)n[s+w]=a[w];return t||f(n)};var v=function(e){if(!o(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r};var b=function(e,t,r){function s(e,s,n,i){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof s&&(s=v(s)),16!==s.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var a=new Uint8Array(16+e.length);if(a.set(s),a.set(e,s.length),(a=r(a))[6]=15&a[6]|t,a[8]=63&a[8]|128,n){i=i||0;for(var o=0;o<16;++o)n[i+o]=a[o];return n}return f(a)}try{s.name=e}catch(e){}return s.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",s.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",s};function m(e){return 14+(e+64>>>9<<4)+1}function w(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function y(e,t,r,s,n,i){return w((a=w(w(t,e),w(s,i)))<<(o=n)|a>>>32-o,r);var a,o}function E(e,t,r,s,n,i,a){return y(t&r|~t&s,e,t,n,i,a)}function _(e,t,r,s,n,i,a){return y(t&s|r&~s,e,t,n,i,a)}function x(e,t,r,s,n,i,a){return y(t^r^s,e,t,n,i,a)}function P(e,t,r,s,n,i,a){return y(r^(t|~s),e,t,n,i,a)}var I=b("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,s=0;s<r;s+=8){var n=e[s>>5]>>>s%32&255,i=parseInt("0123456789abcdef".charAt(n>>>4&15)+"0123456789abcdef".charAt(15&n),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[m(t)-1]=t;for(var r=1732584193,s=-271733879,n=-1732584194,i=271733878,a=0;a<e.length;a+=16){var o=r,l=s,c=n,u=i;r=E(r,s,n,i,e[a],7,-680876936),i=E(i,r,s,n,e[a+1],12,-389564586),n=E(n,i,r,s,e[a+2],17,606105819),s=E(s,n,i,r,e[a+3],22,-1044525330),r=E(r,s,n,i,e[a+4],7,-176418897),i=E(i,r,s,n,e[a+5],12,1200080426),n=E(n,i,r,s,e[a+6],17,-1473231341),s=E(s,n,i,r,e[a+7],22,-45705983),r=E(r,s,n,i,e[a+8],7,1770035416),i=E(i,r,s,n,e[a+9],12,-1958414417),n=E(n,i,r,s,e[a+10],17,-42063),s=E(s,n,i,r,e[a+11],22,-1990404162),r=E(r,s,n,i,e[a+12],7,1804603682),i=E(i,r,s,n,e[a+13],12,-40341101),n=E(n,i,r,s,e[a+14],17,-1502002290),s=E(s,n,i,r,e[a+15],22,1236535329),r=_(r,s,n,i,e[a+1],5,-165796510),i=_(i,r,s,n,e[a+6],9,-1069501632),n=_(n,i,r,s,e[a+11],14,643717713),s=_(s,n,i,r,e[a],20,-373897302),r=_(r,s,n,i,e[a+5],5,-701558691),i=_(i,r,s,n,e[a+10],9,38016083),n=_(n,i,r,s,e[a+15],14,-660478335),s=_(s,n,i,r,e[a+4],20,-405537848),r=_(r,s,n,i,e[a+9],5,568446438),i=_(i,r,s,n,e[a+14],9,-1019803690),n=_(n,i,r,s,e[a+3],14,-187363961),s=_(s,n,i,r,e[a+8],20,1163531501),r=_(r,s,n,i,e[a+13],5,-1444681467),i=_(i,r,s,n,e[a+2],9,-51403784),n=_(n,i,r,s,e[a+7],14,1735328473),s=_(s,n,i,r,e[a+12],20,-1926607734),r=x(r,s,n,i,e[a+5],4,-378558),i=x(i,r,s,n,e[a+8],11,-2022574463),n=x(n,i,r,s,e[a+11],16,1839030562),s=x(s,n,i,r,e[a+14],23,-35309556),r=x(r,s,n,i,e[a+1],4,-1530992060),i=x(i,r,s,n,e[a+4],11,1272893353),n=x(n,i,r,s,e[a+7],16,-155497632),s=x(s,n,i,r,e[a+10],23,-1094730640),r=x(r,s,n,i,e[a+13],4,681279174),i=x(i,r,s,n,e[a],11,-358537222),n=x(n,i,r,s,e[a+3],16,-722521979),s=x(s,n,i,r,e[a+6],23,76029189),r=x(r,s,n,i,e[a+9],4,-640364487),i=x(i,r,s,n,e[a+12],11,-421815835),n=x(n,i,r,s,e[a+15],16,530742520),s=x(s,n,i,r,e[a+2],23,-995338651),r=P(r,s,n,i,e[a],6,-198630844),i=P(i,r,s,n,e[a+7],10,1126891415),n=P(n,i,r,s,e[a+14],15,-1416354905),s=P(s,n,i,r,e[a+5],21,-57434055),r=P(r,s,n,i,e[a+12],6,1700485571),i=P(i,r,s,n,e[a+3],10,-1894986606),n=P(n,i,r,s,e[a+10],15,-1051523),s=P(s,n,i,r,e[a+1],21,-2054922799),r=P(r,s,n,i,e[a+8],6,1873313359),i=P(i,r,s,n,e[a+15],10,-30611744),n=P(n,i,r,s,e[a+6],15,-1560198380),s=P(s,n,i,r,e[a+13],21,1309151649),r=P(r,s,n,i,e[a+4],6,-145523070),i=P(i,r,s,n,e[a+11],10,-1120210379),n=P(n,i,r,s,e[a+2],15,718787259),s=P(s,n,i,r,e[a+9],21,-343485551),r=w(r,o),s=w(s,l),n=w(n,c),i=w(i,u)}return[r,s,n,i]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(m(t)),s=0;s<t;s+=8)r[s>>5]|=(255&e[s/8])<<s%32;return r}(e),8*e.length))}));var L=function(e,t,r){var s=(e=e||{}).random||(e.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){r=r||0;for(var n=0;n<16;++n)t[r+n]=s[n];return t}return f(s)};function M(e,t,r,s){switch(e){case 0:return t&r^~t&s;case 1:return t^r^s;case 2:return t&r^t&s^r&s;case 3:return t^r^s}}function A(e,t){return e<<t|e>>>32-t}var O=b("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var s=unescape(encodeURIComponent(e));e=[];for(var n=0;n<s.length;++n)e.push(s.charCodeAt(n))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var i=e.length/4+2,a=Math.ceil(i/16),o=new Array(a),l=0;l<a;++l){for(var c=new Uint32Array(16),u=0;u<16;++u)c[u]=e[64*l+4*u]<<24|e[64*l+4*u+1]<<16|e[64*l+4*u+2]<<8|e[64*l+4*u+3];o[l]=c}o[a-1][14]=8*(e.length-1)/Math.pow(2,32),o[a-1][14]=Math.floor(o[a-1][14]),o[a-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<a;++d){for(var f=new Uint32Array(80),g=0;g<16;++g)f[g]=o[d][g];for(var h=16;h<80;++h)f[h]=A(f[h-3]^f[h-8]^f[h-14]^f[h-16],1);for(var p=r[0],v=r[1],b=r[2],m=r[3],w=r[4],y=0;y<80;++y){var E=Math.floor(y/20),_=A(p,5)+M(E,v,b,m)+w+t[E]+f[y]>>>0;w=m,m=b,b=A(v,30)>>>0,v=p,p=_}r[0]=r[0]+p>>>0,r[1]=r[1]+v>>>0,r[2]=r[2]+b>>>0,r[3]=r[3]+m>>>0,r[4]=r[4]+w>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]})),C="00000000-0000-0000-0000-000000000000";var R=function(e){if(!o(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},54:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.isOfflineError=t.default=void 0;var n=s(r(33));class i extends n.default{constructor(e,t){super("OfflineError",`${e.method} ${e.url}`,e,t)}}t.default=i;t.isOfflineError=e=>e instanceof Error&&("Failed to fetch"===e.message||"NetworkError when attempting to fetch resource."===e.message)},56:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStringOrUndefined=t.isNumber=t.isString=t.isObject=t.isUndefined=void 0;const s=e=>void 0===e;t.isUndefined=s;t.isObject=e=>"object"==typeof e&&null!==e&&!Array.isArray(e);const n=e=>"string"==typeof e;t.isString=n;t.isNumber=e=>"number"==typeof e;t.isStringOrUndefined=e=>n(e)||s(e)},57:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(68));class i extends Error{constructor(e,t,r){super(t),this.name=e,this.cause=null==r?void 0:r.cause}toJSON(){const e={name:this.name,message:this.message,stack:this.stack};return this.cause&&(e.cause=(0,n.default)(this.cause)),e}getAllErrors(){return this.cause instanceof i?[this,...this.cause.getAllErrors()]:this.cause?[this,this.cause]:[this]}}t.default=i},65:function(e,t,r){var s=r(15).default,n=r(113);e.exports=function(e){var t=n(e,"string");return"symbol"==s(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},68:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.serializeErrorMessage=void 0;var n=s(r(57));t.serializeErrorMessage=e=>{if(e instanceof Error||e instanceof n.default)return e.message;if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return String(e)}};var i=e=>{if(e instanceof n.default)return e.toJSON();if(e instanceof Error)return{name:e.name,message:e.message,stack:e.stack};if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return String(e)}};t.default=i},7:function(e,t,r){var s=r(65);e.exports=function(e,t,r){return(t=s(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},76:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const s=["insertFile","insertFileChunk","insertStyle","updateFile","updateFileChunk"];var n=e=>{var t,r;return!!s.includes(null===(t=e.data)||void 0===t?void 0:t.fn)||[e,null==e?void 0:e.result,null==e||null===(r=e.result)||void 0===r?void 0:r.file].some(e=>e&&Object.values(e).some(e=>e instanceof File||e instanceof Blob||e instanceof ArrayBuffer))};t.default=n},92:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(7)),i=r(48),a=s(r(148)),o=s(r(149)),l=s(r(150)),c=s(r(151)),u=s(r(68)),d=s(r(97)),f=r(153);const g="A listener indicated an asynchronous response by returning true, but the message channel closed before a response was received",h="Could not establish connection. Receiving end does not exist.",p=()=>"app.paperpile.com"===self.location.host,v=e=>new Promise((t,r)=>{try{chrome.runtime.sendMessage(e,e=>{chrome.runtime.lastError?r(chrome.runtime.lastError):t(e)})}catch(e){r(e)}}),b=e=>null!=e&&e.error?{result:null,error:(0,d.default)(e.error)}:e;class m{constructor(e){var t=this;(0,n.default)(this,"loggerLabel","remote"),(0,n.default)(this,"listenerAttached",!1),(0,n.default)(this,"messageCache",{}),(0,n.default)(this,"backLog",[]),(0,n.default)(this,"onMessageCallback",this.onMessage.bind(this)),(0,n.default)(this,"onEventListenerMessageCallback",this.onEventListenerMessage.bind(this)),(0,n.default)(this,"bg",{execute:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;const i=await t.sendMessage("bg",r,e,s,n);return b(i)}}),(0,n.default)(this,"offscreen",{execute:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;const i=await t.sendMessage("offscreen",r,e,s,n);return b(i)}}),(0,n.default)(this,"cs",{execute:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;const i=await t.sendMessage("cs",r,e,s,n);return b(i)}}),(0,n.default)(this,"popup",{execute:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;const i=await t.sendMessage("popup",r,e,s,n);return b(i)}}),(0,n.default)(this,"webapp",{execute:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;const i=await t.sendMessage("webapp",r,e,s,n);return b(i)}}),(0,n.default)(this,"sw",{execute:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;"webapp"===t.origin&&await navigator.serviceWorker.ready;const i=await t.sendMessage("sw",r,e,s,n);return b(i)}}),this.origin=e.origin,this.actions=e.actions||{},this.logger=e.logger,this.webappUrl=e.webappUrl||null,this.setupCompleted=void 0===e.setupCompleted||e.setupCompleted,this.actions["remote.send-broadcast"]=this.sendBroadcast.bind(this),this.actions["remote.send-broadcast-to"]=this.sendBroadcastTo.bind(this),this.actions["remote.test-connection"]=()=>this.origin+" connection alive",this.actions["remote.test-echo"]=e=>(this.logger.debug(this.loggerLabel,"ECHO: "+JSON.stringify(e)),e),this.actions["remote.test-delay"]=async e=>{const t=(null==e?void 0:e.delay)||1e4;return await new Promise(e=>setTimeout(e,t)),{delay:t}}}addListener(){if(this.logger.debug(this.loggerLabel,"addListener called"),"sw"===this.origin)throw new Error("Use serviceWorker specific class ServiceWorkerRemote.ts");self.executionContext&&self.executionContext!==this.origin||this.listenerAttached?this.logger.errorNoNotify(this.loggerLabel,`Error adding message listener to ${this.origin} context - possible duplicate`,{executionContext:self.executionContext,listenerAttached:this.listenerAttached}):(("webapp"===this.origin||"cs"===this.origin&&p())&&self.addEventListener("message",this.onEventListenerMessageCallback,!1),"webapp"===this.origin&&navigator.serviceWorker.addEventListener("message",this.onEventListenerMessageCallback),"webapp"!==this.origin&&chrome.runtime.onMessage.addListener(this.onMessageCallback),this.listenerAttached=!0)}removeListener(){this.logger.debug(this.loggerLabel,"removeListener called"),("webapp"===this.origin||"cs"===this.origin&&p())&&self.removeEventListener("message",this.onEventListenerMessageCallback,!1),"webapp"===this.origin&&navigator.serviceWorker.removeEventListener("message",this.onEventListenerMessageCallback),"webapp"!==this.origin&&chrome.runtime.onMessage.removeListener(this.onMessageCallback),this.listenerAttached=!1}addActions(e){Object.assign(this.actions,e)}getListenerAttached(){return this.listenerAttached}resolveBacklog(){for(this.setupCompleted=!0;this.backLog.length;){const e=this.backLog.shift();e&&this.processMessage(e[0],e[1],e[2])}}onMessage(e,t,r){var s,n,i,a;if(this.logger.debug(this.loggerLabel,"onMessage: ",e),"object"!=typeof e||"string"!=typeof e.origin||"string"!=typeof e.target)return!1;const l="bg"===this.origin&&"bg"!==e.origin||"cs"===this.origin&&["webapp","sw"].includes(e.target),c=(null===(s=t.origin)||void 0===s?void 0:s.match(/chrome-extension:\/\//))&&(null===(n=t.url)||void 0===n?void 0:n.match(/background.html/))||(null===(i=t.url)||void 0===i?void 0:i.match(/chrome-extension:\/\/.*bg-wrapper.js/))||(null===(a=t.url)||void 0===a?void 0:a.match(/moz-extension:\/\/.*background.html/)),u="null"===t.origin||c||"popup"!==this.origin,d=e.target===this.origin&&u,f=l||d;if(f){const s=async e=>r(await(0,o.default)(e));this.setupCompleted?this.processMessage(e,t,s):this.backLog.push([e,t,s])}return!!f}async relayMessage(e){const t=await this[e.target].execute(e.action,e.tabId,await(0,l.default)(e));return null!=(r=t)&&r.error?{result:null,error:(0,u.default)(r.error)}:r;var r}async onEventListenerMessage(e){if("webapp"!==this.origin&&"cs"!==this.origin&&"popup"!==this.origin)throw new Error("Unexpected origin");if(!e||!e.data||"object"!=typeof e.data||"string"!=typeof e.data.origin||"string"!=typeof e.data.target)return;this.logger.debug(this.loggerLabel,"onEventListenerMessage: ",e.data);const t=e.data;if(!t.origin||!t.target)return;if("webapp"===this.origin&&"popup"===t.origin)return;if(t.origin===this.origin)return;if(t.target===this.origin){var r;const s=await(0,l.default)(t);if(t.id){if(this.messageCache[t.id])return this.messageCache[t.id](s),void delete this.messageCache[t.id];if("response"===t.idType)return}const n=null===(r=t.action)||void 0===r?void 0:r.replace(new RegExp(`^${m.ACTION_PREFIX}-`,""),"");if(n&&n in this.actions){const r=await this.actions[n](s),i=await(0,a.default)({error:null,result:r},""),o={type:"remote-message",origin:this.origin,target:t.origin,action:t.action,id:t.id,idType:"response",tabId:t.tabId,...i},l=e.source;if(!l)return;if("scriptURL"in l)l.postMessage(o,(0,c.default)(i));else if(["safari","chrome"].includes((0,f.detectBrowser)()))l.postMessage(o,(0,c.default)(i));else{if(!(l instanceof Window))throw new Error("Unexpected client type (MessagePort or other) in successResponse");l.postMessage(o,"*",(0,c.default)(i))}return}const i={type:"remote-message",origin:this.origin,target:t.origin,action:t.action,id:t.id,idType:"response",tabId:t.tabId,data:{error:"action not recognized",result:null}},o=e.source;if(!o)return;if("scriptURL"in o)o.postMessage(i,[]);else if(["safari","chrome"].includes((0,f.detectBrowser)()))o.postMessage(i,[]);else{if(!(o instanceof Window))throw new Error("Unexpected client type (MessagePort or other) in actionNotRecognizedResponse");o.postMessage(i,"*")}return}if("popup"===this.origin)return;const s=await this.relayMessage(t),n=await(0,a.default)(s,""),i={type:"remote-message",origin:this.origin,target:t.origin,action:t.action,id:t.id,idType:t.idType,tabId:t.tabId,...n},o=e.source;if(o)if("scriptURL"in o)o.postMessage(i,(0,c.default)(n));else if(["safari","chrome"].includes((0,f.detectBrowser)()))o.postMessage(i,(0,c.default)(n));else{if(!(o instanceof Window))throw new Error("Unexpected client type (MessagePort or other) in relayMessage");o.postMessage(i,"*",(0,c.default)(n))}}async processMessage(e,t,r){var s;if(e.target!==this.origin){return r(await this.relayMessage(e))}if(!e.action)return r({result:null,error:"no action"});const n=null!=t&&null!==(s=t.tab)&&void 0!==s&&s.id?t.tab.id:e.tabId;if(!n)if("bg"===e.origin&&"offscreen"===e.target);else if("popup"!==e.origin||"bg"!==e.target)return r({result:null,error:"no tab id defined"});const i=e.action.replace(new RegExp(`^${m.ACTION_PREFIX}-`,""),"");if(!this.actions[i])return r({result:null,error:"action not recognized"});try{const t=await(0,l.default)(e);return r({result:await this.actions[i]({...t,tabId:n}),error:null})}catch(e){return r({result:null,error:(0,u.default)(e)})}}async sendMessage(e,t,r,s,n){if(this.logger.debug(this.loggerLabel,"sendMessage",{target:e,tabId:t,action:r,dataToSend:s}),"sw"===this.origin)throw new Error("Unexpected origin");if("offscreen"===e&&"bg"!==this.origin)throw new Error("offscreen can only be used from bg");if(this.origin===e){const e=r.replace(new RegExp(`^${m.ACTION_PREFIX}-`,""),"");if(e&&e in this.actions)try{return{result:await this.actions[e](s),error:null}}catch(e){return{result:null,error:(0,u.default)(e)}}return{result:null,error:"action not recognized"}}const d={type:"remote-message",origin:this.origin,target:e,action:r.startsWith(m.ACTION_PREFIX)?r:`${m.ACTION_PREFIX}-${r}`,tabId:t,data:s};if("webapp"===this.origin){const t=await(0,a.default)(s,"");return new Promise(r=>{d.id=(0,i.v4)(),d.idType="request";const s=Number.isInteger(n)?setTimeout(()=>r(void 0),n):null;var a;(this.messageCache[d.id]=e=>{s&&clearTimeout(s),r(e)},"sw"===e)?null===(a=navigator.serviceWorker.controller)||void 0===a||a.postMessage({...d,...t},(0,c.default)(t)):["safari"].includes((0,f.detectBrowser)())?self.postMessage({...d,...t},(0,c.default)(t)):self.postMessage({...d,...t},"*",(0,c.default)(t))})}if("cs"===this.origin){if("webapp"===e||"sw"===e){const e=await(0,a.default)(s,"");return new Promise(t=>{d.id=(0,i.v4)(),d.idType="request";const r=Number.isInteger(n)?setTimeout(()=>t(void 0),n):null;this.messageCache[d.id]=e=>{r&&clearTimeout(r),t(e)},self.postMessage({...d,...e},"*",(0,c.default)(e))})}if("popup"===e){return new Promise(async e=>{d.id=(0,i.v4)(),d.idType="request";const t=Number.isInteger(n)?setTimeout(()=>e(void 0),n):null;this.messageCache[d.id]=r=>{t&&clearTimeout(t),e(r)},chrome.runtime.sendMessage({...d,...await(0,o.default)(d.data)},async t=>{chrome.runtime.lastError?e(void 0):e(await(0,l.default)(t))})})}if("bg"===e){const e={...d,...await(0,o.default)(d.data)};let t=null;try{const t=await v(e);return(0,l.default)(t)}catch(e){const s=e;if(!s||!s.message)return void this.logger.error(this.loggerLabel,s.message||"remote error was set without message",s);if("The message port closed before a response was received."===s.message||s.message===g)t=s.message,this.logger.debug(this.loggerLabel,"bg request connection was closed, resending action "+r);else if("Extension context invalidated."===s.message)t=s.message,this.logger.debug(this.loggerLabel,"bg extension context was invalidated, resending action "+r);else{if(s.message!==h)return this.logger.error(this.loggerLabel,s.message),{result:null,error:s.message};t=s.message,this.logger.debug(this.loggerLabel,"bg extension is currently not available, resending action "+r)}}try{t===h&&await new Promise(e=>setTimeout(e,2e3));const r=await v(e);return(0,l.default)(r)}catch(e){const t=e;if(!t||!t.message)return void this.logger.error(this.loggerLabel,t.message||"remote error was set without message",t);if("The message port closed before a response was received."===t.message||t.message===g)return;if("Extension context invalidated."===t.message)return;if(t.message===h)return;return this.logger.error(this.loggerLabel,t.message),{result:null,error:t.message}}}return this.logger.error(this.loggerLabel,new Error(`Error sending message, target [${e}] not recognized`)),Promise.resolve({result:null,error:"unexpected target in cs"})}return"popup"===this.origin?"bg"===e?new Promise(async e=>{chrome.runtime.sendMessage({...d,...await(0,o.default)(d.data)},async t=>{chrome.runtime.lastError?e(void 0):e(await(0,l.default)(t))})}):t?new Promise(async e=>{chrome.tabs.sendMessage(t,{...d,...await(0,o.default)(d.data)},async t=>{chrome.runtime.lastError?e(void 0):e(await(0,l.default)(t))})}):(this.logger.error(this.loggerLabel,new Error("Error sending message, target is tab but tabId was not provided")),Promise.resolve({result:null,error:"incorrect use of sendMessage"})):"offscreen"===e?new Promise(async e=>{chrome.runtime.sendMessage({...d,...await(0,o.default)(d.data)},async t=>{chrome.runtime.lastError?e(void 0):e(await(0,l.default)(t))})}):t?new Promise(async e=>{if("popup"===d.target){if(["safari"].includes((0,f.detectBrowser)())&&0===chrome.extension.getViews({type:"popup"}).length)return void e(void 0);chrome.runtime.sendMessage({...d,...await(0,o.default)(d.data)},async t=>{chrome.runtime.lastError?e(void 0):e(await(0,l.default)(t))})}else{d.id=(0,i.v4)(),d.idType="request";let r=n;["safari"].includes((0,f.detectBrowser)())&&!Number.isInteger(n)&&(r=1e3,d.action&&d.action.endsWith("checkPopupConnection")&&(r=50));const s=Number.isInteger(r)?setTimeout(()=>e(void 0),r):null;this.messageCache[d.id]=t=>{s&&clearTimeout(s),e(t)},chrome.tabs.sendMessage(t,{...d,...await(0,o.default)(d.data)},async t=>{chrome.runtime.lastError?e(void 0):e(await(0,l.default)(t))})}}):(this.logger.error(this.loggerLabel,new Error("Error sending message, target is tab but tabId was not provided")),Promise.resolve({result:null,error:"incorrect use of sendMessage"}))}async sendBroadcast(e){if("sw"===this.origin)throw new Error("Use serviceWorker specific class ServiceWorkerRemote.ts");const t={...e,source:this.origin};if(this[this.origin].execute(e.functionName,e.tabId,e.data),"sw"!==e.source)switch(this.origin){case"bg":chrome.tabs.query({},async r=>{for(const s of r)s.id&&e.tabId!==s.id&&s.url&&this.cs.execute("remote.send-broadcast",s.id,t)});break;case"cs":"webapp"!==e.source&&this.webapp.execute("remote.send-broadcast",e.tabId,t),"bg"!==e.source&&this.bg.execute("remote.send-broadcast",e.tabId,t);break;case"popup":"bg"!==e.source&&this.bg.execute("remote.send-broadcast",e.tabId,t);break;case"webapp":"cs"!==e.source&&this.cs.execute("remote.send-broadcast",e.tabId,t)}else"webapp"===this.origin&&this.cs.execute(t.functionName,null,t.data)}broadcastAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sendBroadcast({source:this.origin,tabId:null,functionName:e,data:t})}sendBroadcastTo(e){return"webapp"===this.origin&&e.targetUrl===this.webappUrl?this.sw.execute("remote.send-broadcast",null,e):"bg"!==this.origin?this.bg.execute("remote.send-broadcast-to",null,e):(chrome.tabs.query({},t=>{for(const r of t)r.url&&r.url.startsWith(e.targetUrl)&&this.cs.execute("remote.send-broadcast",r.id,{...e,source:this.origin})}),null)}broadcastTo(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.sendBroadcastTo({targetUrl:e,functionName:t,data:r})}}t.default=m,(0,n.default)(m,"ACTION_PREFIX","new")},93:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(33));class i extends n.default{constructor(e,t){super("BackendError",JSON.stringify(e),e,t)}}t.default=i},97:function(e,t,r){"use strict";var s=r(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.isDeserializableError=void 0;var n=r(56),i=s(r(152)),a=s(r(93)),o=s(r(54)),l=s(r(139));const c=e=>"deserializeError failed to deserialize: "+JSON.stringify(e),u=e=>"string"==typeof e||(0,n.isObject)(e)&&"name"in e&&(0,n.isString)(e.name)&&"message"in e&&(0,n.isStringOrUndefined)(e.message)&&(!("stack"in e)||(0,n.isStringOrUndefined)(e.stack));t.isDeserializableError=u;const d=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}if(!u(e))throw new Error(c(e));const t=(e=>{const t=e.cause?{cause:d(e.cause)}:void 0;switch(e.name){case"AnyExtraError":if(!(0,n.isObject)(e.extra))throw new Error(c(e));return new i.default(e.message,e.extra,t);case"BackendError":if(!(0,n.isObject)(e.extra)||!(0,n.isString)(e.extra.msg)||!(0,n.isNumber)(e.extra.status)||!(0,n.isUndefined)(e.extra.details)&&!(0,n.isObject)(e.extra.details))throw new Error(c(e));return new a.default({msg:e.extra.msg,status:e.extra.status,details:e.extra.details},t);case"OfflineError":if(!(0,n.isObject)(e.extra)||!(0,n.isString)(e.extra.method)||!(0,n.isString)(e.extra.url))throw new Error(c(e));return new o.default({method:e.extra.method,url:e.extra.url},t);case"PaperpileError":if(!(0,n.isObject)(e.extra)||!(0,n.isString)(e.extra.key))throw new Error(c(e));return new l.default(e.extra,t);case"ErrorWithCause":throw new Error("deserializeError failed to deserialize, ErrorWithCause should not be used directly: "+JSON.stringify(e));default:{const t=new Error(e.message);return t.name=e.name,t}}})(e);return t.stack=e.stack,t};var f=d;t.default=f}});