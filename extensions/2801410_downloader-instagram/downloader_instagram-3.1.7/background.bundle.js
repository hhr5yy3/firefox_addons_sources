(()=>{"use strict";const e="firefox",r="https://onlinetoolset.com/browser-extensions/downloader-for-instagram",t=`${r}#contact-form`,a=["en","tr","zh-cn","hi","ru","de","fr","el","es","ja","ko","nl","da","fi","it","no","sv","cs","pl","pt","hu","ro","bg"];class s{static async send(e,r){return!0}static async error(e,r){const t=r||{};t.errorMessage=e.toString(),s.send("Error",t)}}const n=()=>(new Date).toISOString(),o=(r,t)=>{const n=chrome.runtime.getManifest();try{const s=new URL(r);if(s.origin.includes("onlinetoolset.com")){const e=chrome.i18n.getUILanguage().replace("_","_").toLowerCase();a.includes(e)&&(s.pathname=`/${e}${s.pathname}`)}return s.searchParams.append("utm_source",n.short_name.replace(" ","")),s.searchParams.append("utm_medium",t),s.searchParams.append("utm_content","extension"),s.searchParams.append("utm_campaign",`version_${n.version}`),s.searchParams.append("utm_browser",`${e}`),s.toString()}catch(e){return s.error(e,{pageURL:"callback:generateURL"}),r}};chrome.runtime.onInstalled.addListener((async function(e){const a=await chrome.storage.local.get({user:null});if(a.user){let e=n();try{e=new Date(a.user.createdAt).toISOString()}catch{}a.user={userID:e,createdAt:a.user.createdAt},chrome.storage.local.set({user:a.user})}else a.user={userID:n(),createdAt:Date.now()},chrome.storage.local.set({user:a.user});s.send(`User_${e.reason}`,{userID:a.user.userID}),chrome.runtime.setUninstallURL(o(t,"uninstall")),(await chrome.permissions.getAll()).origins.length<chrome.runtime.getManifest().host_permissions.length?chrome.tabs.create({url:chrome.runtime.getURL("popup.html")}):("install"===e.reason&&chrome.tabs.create({url:o(r,e.reason)}),e.reason)}));const c={id:"download-image",title:"Download | Downloader for Instagramâ„¢",contexts:["link","image","video","page"],documentUrlPatterns:["https://*.instagram.com/*"]};chrome.contextMenus.create(c,(()=>chrome.runtime.lastError)),chrome.contextMenus.onClicked.addListener((async(e,r)=>{if(e.menuItemId===c.id){const r=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0];s.send("MenuItemClicked",{MenuItemID:e.menuItemId}),chrome.tabs.sendMessage(r.id,{action:"DOWNLOAD_CURRENT_POST"})}})),chrome.runtime.onMessage.addListener(((e,r,t)=>{switch(e.action){case"SEND_ACTIVITY":s.send(e.params.name,e.params.data||{});break;case"SEND_ERROR":s.error(e.params.error,e.params.data||{})}}))})();