!function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function t(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){n&&(t=n);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e){var t=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===r(t)?t:String(t)}function o(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function c(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
c=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),s=new S(n||[]);return o(i,"_invoke",{value:L(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=f;var h={};function b(){}function d(){}function v(){}var y={};l(y,i,(function(){return this}));var w=Object.getPrototypeOf,g=w&&w(w(I([])));g&&g!==t&&n.call(g,i)&&(y=g);var m=v.prototype=b.prototype=Object.create(y);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function a(o,i,s,c){var u=p(e[o],e,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==r(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){a("next",e,s,c)}),(function(e){a("throw",e,s,c)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return a("throw",e,s,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){a(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function L(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return A()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=O(i,r);if(s){if(s===h)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=p(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function O(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,O(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var o=p(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,h;var a=o.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function I(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return d.prototype=v,o(m,"constructor",{value:v,configurable:!0}),o(v,"constructor",{value:d,configurable:!0}),d.displayName=l(v,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,l(e,u,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},x(k.prototype),l(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(f(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(m),l(m,u,"Generator"),l(m,i,(function(){return this})),l(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=I,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function u(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){u(a,n,o,i,s,"next",e)}function s(e){u(a,n,o,i,s,"throw",e)}i(void 0)}))}}function f(e){return p.apply(this,arguments)}function p(){return(p=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("https://api.sandvpn.com/google",{method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify(t)}).then((function(e){if(!e.ok){if(500===e.status)throw new Error("Server Error");return e.text().then((function(e){throw e}))}return e.json()})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=["timeout"],b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.timeout,n=void 0===r?2500:r,o=s(t,h);return Promise.race([fetch(e,o),new Promise((function(t,r){setTimeout((function(){r(new Error("Request for ".concat(e," timed out after ").concat(n," milliseconds")))}),n)}))])},d=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return fetch(t,r).then((function(o){if(o.ok)return o.json();if(n>0)return e(t,r,n-1);throw new Error(o.status)})).catch((function(e){return console.error(e.message)}))};function v(e){return y.apply(this,arguments)}function y(){return(y=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d("https://api.sandvpn.com/fetch-auth-proxys",{method:"GET",headers:{"Content-type":"application/json",Authorization:"Bearer ".concat(t)}},3));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return g.apply(this,arguments)}function g(){return(g=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",b("https://api.sandvpn.com/isPremium",{timeout:2e3,method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then((function(e){return e.json()})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=function(e){var t=e.path;browser.tabs.query({},function(){var e=l(c().mark((function e(r){var n,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=browser.runtime.getURL("index.html"),o=r.filter((function(e){return e.url.split("#")[0]===n})),a={active:!0,url:"".concat(browser.runtime.getURL("index.html"),"#/").concat(t)},!o.length){e.next=9;break}return e.next=6,browser.tabs.update(o[0].id,a);case 6:window.close(),e.next=12;break;case 9:return e.next=11,browser.tabs.create(a);case 11:window.close();case 12:case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())};function x(e){return k.apply(this,arguments)}function k(){return(k=l(c().mark((function e(t){var r,n,o,a,s,u,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.match(/access_token=(.*?)&/i)[1],n=browser.extension.getViews({type:"popup"}),!r){e.next=27;break}return e.prev=3,o={access_token:r},e.next=7,f(o);case 7:return a=e.sent,e.next=10,w(a.token);case 10:if(null==(s=e.sent)||!s.premium){e.next=16;break}return e.next=14,v(a.token);case 14:u=e.sent,browser.storage.sync.set({proxyInfos:u});case 16:l=i(i(i({},a),s),{},{isAuth:!0}),browser.storage.sync.set({userInfo:l}),n.length||m({path:"user"}),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),console.log(e.t0);case 26:case 27:case 28:case"end":return e.stop()}}),e,null,[[3,23]])})))).apply(this,arguments)}function L(){return(e=browser.identity.getRedirectURL(),t="https://accounts.google.com/o/oauth2/auth",t+="?client_id=".concat("368215438305-s6n3g9q6roovov01p03b5kgm8f248cpr.apps.googleusercontent.com"),t+="&prompt=select_account",t+="&response_type=token",t+="&redirect_uri=".concat(encodeURIComponent(e)),t+="&scope=".concat(encodeURIComponent(["openid","email","profile"].join(" "))),browser.identity.launchWebAuthFlow({interactive:!0,url:t})).then(x);var e,t}function O(e){return P.apply(this,arguments)}function P(){return(P=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("https://api.sandvpn.com/smartProxy",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(t)}).then((function(e){return e.json()})).catch((function(e){console.log(e)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return Math.floor(Math.random()*e)}var S,I,A,E=["username","password"],R=["username","password"],_=["username","password"],T="",U="",N="",C=[],M=[],D={enabled:!0,type:"",host:"",port:""},F=function(){var e=l(c().mark((function e(){var t,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,browser.storage.sync.get("myFilters");case 2:if(e.t1=t=e.sent,e.t0=null===e.t1,e.t0){e.next=6;break}e.t0=void 0===t;case 6:if(!e.t0){e.next=10;break}e.t2=void 0,e.next=11;break;case 10:e.t2=t.myFilters;case 11:null!=(r=e.t2)&&r.length&&(C=r.filter((function(e){return!e.blacklist})),M=r.filter((function(e){return e.blacklist})).map((function(e){return e.domain})));case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),q=function(){var e=l(c().mark((function e(){var t,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,browser.storage.sync.get("userId");case 2:if(e.t1=t=e.sent,e.t0=null===e.t1,e.t0){e.next=6;break}e.t0=void 0===t;case 6:if(!e.t0){e.next=10;break}e.t2=void 0,e.next=11;break;case 10:e.t2=t.userId;case 11:(r=e.t2)?U=r:(U=Date.now().toString(36)+Math.floor(Math.pow(10,12)+9*Math.random()*Math.pow(10,12)).toString(36),browser.storage.sync.set({userId:U}));case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function G(){return(G=l(c().mark((function e(r){var n,o,a,u,l,f,p;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=C)||void 0===n||!n.length){e.next=24;break}o=[],a=(a=new URL(r.url)).hostname.replace("www.",""),u=t(C),e.prev=5,f=c().mark((function e(){var t,n,u,f,p,h,b,d,v,y,w,g,m;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=l.value).domain!==a){e.next=57;break}return e.next=4,browser.storage.sync.get("info");case 4:if(e.t1=n=e.sent,e.t0=null===e.t1,e.t0){e.next=8;break}e.t0=void 0===n;case 8:if(!e.t0){e.next=12;break}e.t2=void 0,e.next=13;break;case 12:e.t2=n.info;case 13:if((null==(u=e.t2)?void 0:u.country)!==t.country||"boolean"!=typeof(null==u?void 0:u.isActive)||null==u||!u.isActive){e.next=16;break}return e.abrupt("return",{v:{}});case 16:if(N===a&&(null==u?void 0:u.country)===t.country){e.next=57;break}return N=a,e.next=21,browser.storage.sync.get("proxyInfos");case 21:if(e.t4=f=e.sent,e.t3=null===e.t4,e.t3){e.next=25;break}e.t3=void 0===f;case 25:if(!e.t3){e.next=29;break}e.t5=void 0,e.next=30;break;case 29:e.t5=f.proxyInfos;case 30:return h=e.t5,e.next=33,browser.storage.sync.get("userInfo");case 33:if(e.t7=p=e.sent,e.t6=null===e.t7,e.t6){e.next=37;break}e.t6=void 0===p;case 37:if(!e.t6){e.next=41;break}e.t8=void 0,e.next=42;break;case 41:e.t8=p.userInfo;case 42:return b=e.t8,d=h.filter((function(e){return e.country===t.country&&e.paid===(null==b?void 0:b.premium)})),v=j(d.length),y=d[v],w=y.username,g=y.password,s(y,R),m={username:w,password:g},browser.storage.sync.set({info:i(i({},y),{},{isActive:!0}),auth:m}),D=i(i({enabled:!0,type:"http"},y),{},{filters:{urls:["<all_urls>"]}}),e.next=52,new Promise((function(e){return setTimeout(e,1e3)}));case 52:return e.next=54,z({isActive:!0});case 54:return browser.notifications.create("timer",{type:"basic",iconUrl:browser.runtime.getURL("/logo192.png"),title:"SandVPN",message:"Connected to ".concat(y.country," (Smart Filter)")}),browser.tabs.query({active:!0,currentWindow:!0},(function(e){browser.tabs.update(e[0].id,{url:r.url})})),e.abrupt("return",{v:Promise.all(o).then((function(){return{}}))});case 57:case"end":return e.stop()}}),e)})),u.s();case 8:if((l=u.n()).done){e.next=15;break}return e.delegateYield(f(),"t0",10);case 10:if("object"!=typeof(p=e.t0)){e.next=13;break}return e.abrupt("return",p.v);case 13:e.next=8;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(5),u.e(e.t1);case 20:return e.prev=20,u.f(),e.finish(20);case 23:case 24:case 25:case"end":return e.stop()}}),e,null,[[5,17,20,23]])})))).apply(this,arguments)}function V(){return W.apply(this,arguments)}function W(){return(W=l(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=setInterval(l(c().mark((function e(){var t,r,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=(new Date).toLocaleDateString())===I){e.next=19;break}return I=t,browser.storage.sync.set({lastAccessDate:t}),e.next=6,browser.storage.sync.get("timeLimit");case 6:if(e.t1=r=e.sent,e.t0=null===e.t1,e.t0){e.next=10;break}e.t0=void 0===r;case 10:if(!e.t0){e.next=14;break}e.t2=void 0,e.next=15;break;case 14:e.t2=r.timeLimit;case 15:n=e.t2,S=n,e.next=23;break;case 19:60===--S&&browser.notifications.create("timer",{type:"basic",iconUrl:browser.runtime.getURL("/logo192.png"),title:"SandVPN",message:"You'll to be diconnected in 1 minute"}),S<=0&&(browser.notifications.create("timer",{type:"basic",iconUrl:browser.runtime.getURL("/logo192.png"),title:"SandVPN",message:"You are disconnected"}),Y(),clearInterval(A));case 23:browser.storage.sync.set({usageTimeRemaining:S});case 25:case"end":return e.stop()}}),e)}))),1e3),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(){return B.apply(this,arguments)}function B(){return(B=l(c().mark((function e(){var t,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N="",browser.storage.sync.remove("auth"),browser.proxy.onRequest.hasListener(H)&&browser.proxy.onRequest.removeListener(H),clearInterval(A),A=null,browser.browserAction.setIcon({path:"logo192.png"}),browser.privacy.websites.resistFingerprinting.set({value:!1}),browser.privacy.network.webRTCIPHandlingPolicy.set({value:"default"}),browser.privacy.websites.trackingProtectionMode.set({value:"never"}),browser.privacy.network.peerConnectionEnabled.set({value:!0}),e.next=12,browser.storage.sync.get("info");case 12:if(e.t1=t=e.sent,e.t0=null===e.t1,e.t0){e.next=16;break}e.t0=void 0===t;case 16:if(!e.t0){e.next=20;break}e.t2=void 0,e.next=21;break;case 20:e.t2=t.info;case 21:r=e.t2,browser.storage.sync.set({info:i(i({},r),{},{isActive:!1})});case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}q(),F(),browser.runtime.onInstalled.addListener((function(e){e.reason===browser.runtime.OnInstalledReason.INSTALL&&browser.tabs.create({url:"".concat(browser.runtime.getURL("index.html"),"#/streaming")})})),browser.storage.onChanged.addListener((function(e,t){for(var r=0,n=Object.keys(e);r<n.length;r++){var o=n[r];if("myFilters"===o)C=e[o].newValue.filter((function(e){return!e.blacklist})),M=e[o].newValue.filter((function(e){return e.blacklist})).map((function(e){return e.domain}))}})),browser.webRequest.onBeforeRequest.addListener((function(e){return G.apply(this,arguments)}),{urls:["<all_urls>"]},["blocking"]),browser.storage.sync.get("info",function(){var e=l(c().mark((function e(t){var r,n,o,a,u,l,f,p,h,b;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!t.info){e.next=24;break}return e.next=3,browser.storage.sync.get("vpnAtStartUp");case 3:if(e.t1=r=e.sent,e.t0=null===e.t1,e.t0){e.next=7;break}e.t0=void 0===r;case 7:if(!e.t0){e.next=11;break}e.t2=void 0,e.next=12;break;case 11:e.t2=r.vpnAtStartUp;case 12:return n=e.t2,e.next=15,browser.storage.sync.get("userInfo");case 15:if(null!=(o=e.sent.userInfo)&&o.premium){e.next=21;break}return e.next=19,browser.storage.sync.get("usageTimeRemaining");case 19:(a=e.sent.usageTimeRemaining)&&(S=a);case 21:n&&(null!=o&&o.premium||(null==o||!o.premium)&&S>0)?(u=t.info,l=u.username,f=u.password,p=s(u,E),h={username:l,password:f},D=i(i({enabled:!0,type:"http"},p),{},{filters:{urls:["<all_urls>"]}}),browser.storage.sync.set({auth:h,info:i(i({},t.info),{},{isActive:!0})}),z({isActive:!0}),browser.notifications.create("startUp",{type:"basic",iconUrl:browser.runtime.getURL("/logo192.png"),title:"SandVPN",message:"You are Connected"})):(b=i(i({},t.info),{},{isActive:"start"}),browser.storage.sync.set({info:b}));case 24:case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var H=function(e){var t=new URL(e.url);if((t=t.hostname.replace("www.",""),!(M.indexOf(t)>-1))&&(!/^https:\/\/api\.sandvpn\.com\/(?!get_my_ip\b).*$/i.test(e.url)&&!e.url.startsWith("https://flyymail.com/")&&!e.url.startsWith("https://sandvpn.com/")))return D},z=function(){var e=l(c().mark((function e(t){var r,n,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isActive){e.next=42;break}return e.next=3,browser.storage.sync.get("userInfo");case 3:if(null!=(r=e.sent.userInfo)&&r.premium){e.next=34;break}return e.next=7,browser.storage.sync.get("usageTimeRemaining");case 7:if((n=e.sent.usageTimeRemaining)&&(S=n),!(S&&S>0)){e.next=32;break}if(A){e.next=29;break}return e.next=13,browser.storage.sync.get("lastAccessDate");case 13:if(e.t1=o=e.sent,e.t0=null===e.t1,e.t0){e.next=17;break}e.t0=void 0===o;case 17:if(!e.t0){e.next=21;break}e.t2=void 0,e.next=22;break;case 21:e.t2=o.lastAccessDate;case 22:return a=e.t2,I=a||(new Date).toLocaleDateString(),browser.storage.sync.set({lastAccessDate:I}),e.next=28,V();case 28:A=e.sent;case 29:e.next=34;break;case 32:return Y(),e.abrupt("return");case 34:browser.proxy.onRequest.hasListener(H)&&browser.proxy.onRequest.removeListener(H),browser.proxy.onRequest.addListener(H,{urls:["<all_urls>"]}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?browser.browserAction.setIcon({path:"logoFlag/active-light.png"}):browser.browserAction.setIcon({path:"logoFlag/active-dark.png"}),browser.storage.sync.get(["webrtc","tracking","fingerprinting","peerConnectionEnabled"],function(){var e=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.webrtc&&browser.privacy.network.webRTCIPHandlingPolicy.set({value:"proxy_only"}),t.tracking&&browser.privacy.websites.trackingProtectionMode.set({value:"always"}),t.fingerprinting&&browser.privacy.websites.resistFingerprinting.set({value:!0}),t.peerConnectionEnabled||browser.privacy.websites.resistFingerprinting.set({value:!1});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=43;break;case 42:Y();case 43:case 44:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function J(e,t){return $.apply(this,arguments)}function $(){return $=l(c().mark((function e(t,r){var n,o,a,u,f,p,h;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,browser.storage.sync.get("management");case 2:if(e.t1=n=e.sent,e.t0=null===e.t1,e.t0){e.next=6;break}e.t0=void 0===n;case 6:if(!e.t0){e.next=10;break}e.t2=void 0,e.next=11;break;case 10:e.t2=n.management;case 11:if("boolean"!=typeof(null==(o=e.t2)?void 0:o.consentPopup)||!0!==(null==o?void 0:o.consentPopup)){e.next=38;break}return e.next=15,browser.storage.sync.get("smartProxy");case 15:if(e.t4=a=e.sent,e.t3=null===e.t4,e.t3){e.next=19;break}e.t3=void 0===a;case 19:if(!e.t3){e.next=23;break}e.t5=void 0,e.next=24;break;case 23:e.t5=a.smartProxy;case 24:return p=e.t5,e.next=27,browser.storage.sync.get("userInfo");case 27:if(e.t7=u=e.sent,e.t6=null===e.t7,e.t6){e.next=31;break}e.t6=void 0===u;case 31:if(!e.t6){e.next=35;break}e.t8=void 0,e.next=36;break;case 35:e.t8=null===(f=u.userInfo)||void 0===f?void 0:f.premium;case 36:h=e.t8,browser.tabs.executeScript(r,{code:"document.referrer;"},function(){var e=l(c().mark((function e(r){var n,o,a,u,l,f,b,d,v,y,w,g,m,x,k,L;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r[0],o=!0,a=!0,u=!0,l="",e.prev=5,e.next=8,O({url:t,referrer:n,userId:U,premium:h});case 8:if("isNotSafe"===(null==(b=e.sent)?void 0:b.website)&&(o=!1),"isNotSafe"===(null==b?void 0:b.referrer)&&(a=!1),null!=b&&null!==(f=b.reportUrlParams)&&void 0!==f&&f.malicious&&(u=!1,l=null==b||null===(d=b.reportUrlParams)||void 0===d?void 0:d.attack_types.join(", ")),o&&a&&u){e.next=40;break}if(!p){e.next=39;break}return y="\n                            Warning! We have detected an online security threat!\n".concat(o?"":"The website you are visiting is dangerous!\n").concat(a?"":"The referrer is dangerous!\n").concat(u?"":"Your URL parameters are a threat! Types of attack detected: ".concat(l),"\n                            "),browser.notifications.create("smartProxy",{type:"basic",iconUrl:browser.runtime.getURL("/logo192.png"),title:"SandVPN Smart Proxy",message:y}),e.next=21,browser.storage.sync.get("proxyInfos");case 21:if(e.t1=v=e.sent,e.t0=null===e.t1,e.t0){e.next=25;break}e.t0=void 0===v;case 25:if(!e.t0){e.next=29;break}e.t2=void 0,e.next=30;break;case 29:e.t2=v.proxyInfos;case 30:return w=e.t2,g=w.filter((function(e){return e.paid===h})),m=g[j(g.length)],x=m.username,k=m.password,s(m,_),L={username:x,password:k},browser.storage.sync.set({info:i(i({},m),{},{isActive:!0}),auth:L}),D=i(i({enabled:!0,type:"http"},m),{},{filters:{urls:["<all_urls>"]}}),e.next=39,z({isActive:!0});case 39:case 40:e.next=46;break;case 43:e.prev=43,e.t3=e.catch(5),console.error("Error in smart proxy report:",e.t3);case 46:case 47:case"end":return e.stop()}}),e,null,[[5,43]])})));return function(t){return e.apply(this,arguments)}}());case 38:return e.next=41,browser.storage.sync.get(["showInputLogo"],function(){var e=l(c().mark((function e(n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n.showInputLogo||0===Object.keys(n).length)&&browser.tabs.sendMessage(r,{action:"urlChanged",url:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 41:case"end":return e.stop()}}),e)}))),$.apply(this,arguments)}browser.webRequest.onAuthRequired.addListener(l(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,browser.storage.sync.get("auth");case 2:if(t=e.sent.auth){e.next=6;break}return Y(),e.abrupt("return");case 6:return e.abrupt("return",{authCredentials:t});case 8:case"end":return e.stop()}}),e)}))),{urls:["<all_urls>"]},["blocking"]),browser.runtime.onMessage.addListener(function(){var e=l(c().mark((function e(t){var r,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("isActive"in t)){e.next=6;break}t.isActive&&(D=t.proxy),z(t),e.next=29;break;case 6:if("ephemeralModeOn"!==t.action){e.next=10;break}browser.storage.sync.set({ephemeralMode:{enabled:!0,startTime:(new Date).getTime()}}),e.next=29;break;case 10:if("ephemeralModeOff"!==t.action){e.next=28;break}return e.next=13,browser.storage.sync.get("ephemeralMode");case 13:if(e.t1=r=e.sent,e.t0=null===e.t1,e.t0){e.next=17;break}e.t0=void 0===r;case 17:if(!e.t0){e.next=21;break}e.t2=void 0,e.next=22;break;case 21:e.t2=r.ephemeralMode;case 22:null!=(n=e.t2)&&n.enabled&&browser.browsingData.remove({since:n.startTime},{cache:!0,cookies:!0,downloads:!0,formData:!0,history:!0,indexedDB:!0,passwords:!0,serviceWorkers:!0}),browser.storage.sync.set({ephemeralMode:{enabled:!1}}),e.next=29;break;case 28:"googleOauth"===t.action&&L();case 29:case 30:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),browser.webNavigation.onHistoryStateUpdated.addListener(function(){var e=l(c().mark((function e(t){var r,n,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.tabId,n=t.url,e.next=4,browser.tabs.get(r);case 4:o=e.sent,(a=o.url)===n&&T!==a&&(T=a,J(t.url,r));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),browser.webNavigation.onCompleted.addListener(function(){var e=l(c().mark((function e(t){var r,n,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.tabId,n=t.url,e.next=4,browser.tabs.get(r);case 4:o=e.sent,(a=o.url)===n&&T!==a&&(T=a,J(t.url,r));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),browser.tabs.onUpdated.addListener(function(){var e=l(c().mark((function e(t,r,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"complete"===r.status&&n.url&&T!==n.url&&(T=n.url,J(n.url,t));case 2:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}())}();