"use strict";(self.webpackChunkchrome_extension=self.webpackChunkchrome_extension||[]).push([[37,65],{97925:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.identicalConsecutivelyBrowsedProductsTimestampsMap=t.enrichUserBrowsedProductWebpagesListWithDates=t.getBrowsedProductFormattedDate=t.deleteAllBrowsedProductWebpages=t.deleteBrowsedProductWebpages=t.formatProductDataFromBrowsedProductWebpage=t.checkIsBrowsedProductWebpageSaved=t.onClickBrowsedProductWebpageElement=t.useBrowsedProductWebpagesDeletion=t.DELETE_ALL_BROWSED_PRODUCTS_ANIMATION_DURATION_IN_SECONDS=t.useBrowsedProductsSectionContentDisplayedDate=t.useDisplayedBrowsedProductWebpages=void 0;var u=l(n(96540)),c=n(2543),d=l(n(95093)),f=n(55015),p=n(47248),g=n(17621),v=n(77653),h=n(46239),m=n(89710),y=n(57682);t.useDisplayedBrowsedProductWebpages=function(e){var t=e.userRegion,n=e.localizedDateTexts,r=e.userBrowsedProductWebpagesWithDates,o=e.scrollableContainerRef,a=e.browsedProductComponentRefsMap,i=e.displayedDate,s=e.setDisplayedDate,l=(0,f.useProgressiveDisplay)(r||[]),u=l.displayedItems,c=l.showMoreResults;return{displayedBrowsedProductWebpagesWithDates:u,onScrollBrowsedProductWebpagesListContainer:function(e){var r=e.currentTarget,l=r.scrollHeight,u=r.scrollTop,d=r.clientHeight;Math.abs(l-u-d)<1&&c(),b({userRegion:t,localizedDateTexts:n,scrollableContainerRef:o,browsedProductComponentRefsMap:a,displayedDate:i,setDisplayedDate:s})}}};var b=(0,c.throttle)((function(e){var t,n,r=e.userRegion,o=e.localizedDateTexts,s=e.scrollableContainerRef,l=e.browsedProductComponentRefsMap,u=e.displayedDate,c=e.setDisplayedDate;if(!s.current||!l.current)return;var d=void 0,f=s.current.getBoundingClientRect();try{for(var p=a(Object.entries(l.current)),g=p.next();!g.done;g=p.next()){var v=i(g.value,2),h=v[0],m=v[1];if(m){var y=m.getBoundingClientRect();if(Math.abs(y.top-f.top)<10||Math.abs(y.bottom-f.top)<20){d=S({timestamp:Number(h.split("|")[1])},r,o);break}}}}catch(e){t={error:e}}finally{try{g&&!g.done&&(n=p.return)&&n.call(p)}finally{if(t)throw t.error}}d&&d!==u&&c(d)}),50,{leading:!1,trailing:!0});function w(e){(0,h.sendMessageToBackgroundScript)({message:"deleteUserBrowsedProductWebpages",data:{timestampsToDelete:e}})}function S(e,t,n){if(!e)return"";var r=(0,f.getLocaleCodeFromRegion)(t),o=(0,d.default)().locale(r),a=d.default.unix(e.timestamp);if(a.locale(r),a.isSame(o,"day"))return a.hour()<12?n.todayMorning:a.hour()<18?n.todayAfternoon:n.todayEvening;var i=(0,d.default)().subtract(1,"days");if(a.isSame(i,"day"))return a.hour()<12?n.todayMorning:a.hour()<18?n.todayAfternoon:n.yesterdayEvening;var s=o.year();if(a.year()<s){var l=a.format("dddd D MMMM YYYY");return E(l=l.replace(/(\d+) (\S{4})\S* (\d+)/,"$1 $2. $3"))}return E(a.format("dddd D MMMM"))}function E(e){return e[0].toUpperCase()+e.slice(1)}function k(e){for(var n,r=[e[0]],o=i(e,1)[0],a=0;a<e.length;a++){var l="".concat(o.webpageUrl,"|").concat(o.timestamp);t.identicalConsecutivelyBrowsedProductsTimestampsMap.set(l,s(s([],i(null!==(n=t.identicalConsecutivelyBrowsedProductsTimestampsMap.get(l))&&void 0!==n?n:[]),!1),[e[a].timestamp],!1)),a<e.length-1&&e[a].webpageUrl!==e[a+1].webpageUrl&&(r.push(e[a+1]),o=e[a+1])}return r}t.useBrowsedProductsSectionContentDisplayedDate=function(e){var t=i(u.default.useState("string"==typeof e[0]?e[0]:""),2),n=t[0],r=t[1];return u.default.useEffect((function(){e.length>0&&"string"==typeof e[0]&&r(e[0])}),[e]),{displayedDate:n,setDisplayedDate:r}},t.DELETE_ALL_BROWSED_PRODUCTS_ANIMATION_DURATION_IN_SECONDS=.5,t.useBrowsedProductWebpagesDeletion=function(e){var t=e.userBrowsedProductWebpages,n=e.setUserBrowsedProductWebpages,r=e.isMobileExtension,o=e.panelInnerContainerRef,a=i(u.default.useState(!1),2),s=a[0],l=a[1],c=i(u.default.useState(!1),2),d=c[0],f=c[1],p=i(u.default.useState([]),2),v=p[0],m=p[1],b=i(u.default.useState(!1),2),S=b[0],E=b[1],k=i(u.default.useState(!1),2),D=k[0],W=k[1],I=i(u.default.useState(!1),2),C=I[0],T=I[1],O=function(){l(!1),E(!1),m([])};return{isDeletionEnabled:s,setIsDeletionEnabled:l,hasDeletionEverBeenEnabled:d,setHasDeletionEverBeenEnabled:f,selectedProductTimestampsForDeletion:v,setSelectedProductTimestampsForDeletion:m,onClickConfirmDeletion:function(){t&&0!==v.length&&(w(v),n(null==t?void 0:t.filter((function(e){return!v.includes(e.timestamp)}))),(0,h.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedDeleteSelectedBrowsedProducts"}}}),O())},onClickDeleteAll:function(){if((0,h.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedDeleteAllBrowsedProducts"}}}),E(!0),m((null==t?void 0:t.map((function(e){return e.timestamp})))||[]),r){var e=(0,g.getHashedElementId)(g.JokoExtensionRootElement.deleteAllBrowsedProductsBottomSheet);null===document.getElementById(e)&&(0,y.displayDeleteAllBrowsedProductsBottomSheet)({setUserBrowsedProductWebpages:n,isMobileExtension:r,panelInnerContainerRef:o,closeDeletion:O,setIsDeleteAllAnimationInProgress:W})}else T(!0)},closeDeletion:O,hasClickedDeleteAll:S,isDeleteAllAnimationInProgress:D,setIsDeleteAllAnimationInProgress:W,isDeleteAllBrowsedProductsPopupOpen:C,setIsDeleteAllBrowsedProductsPopupOpen:T}},t.onClickBrowsedProductWebpageElement=function(e){var t=e.webpageUrl,n=e.isDeletionEnabled,a=e.onClickSelectForDeletion;return r(this,void 0,void 0,(function(){var e;return o(this,(function(r){switch(r.label){case 0:return n?(a(),[3,3]):[3,1];case 1:return[4,(0,v.getMerchantOfferMatchingUrlWithConditionsAndCoupons)(t)];case 2:e=r.sent(),(0,m.handleUserInterfaceComponentInteractionInBackgroundOrLoadTrackingLink)({offer:e,triggeringEventType:p.UserInterfaceComponentInteractionEventType.browsedProduct}),(0,h.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedBrowsedProductWebpage"}}}),(0,h.sendMessageToBackgroundScript)({message:"openTab",data:{url:t}}),r.label=3;case 3:return[2]}}))}))},t.checkIsBrowsedProductWebpageSaved=function(e,t){return{isProductSaved:e.has(t.webpageUrl),userSavedWebpage:e.get(t.webpageUrl)}},t.formatProductDataFromBrowsedProductWebpage=function(e){return{name:e.webpageTitle,imageUrl:e.productImageUrl,priceAmount:e.productPriceAmount,priceCurrency:e.productPriceCurrency}},t.deleteBrowsedProductWebpages=w,t.deleteAllBrowsedProductWebpages=function(){(0,h.sendMessageToBackgroundScript)({message:"deleteUserBrowsedProductWebpages",data:{deleteAll:!0}})},t.getBrowsedProductFormattedDate=S,t.enrichUserBrowsedProductWebpagesListWithDates=function(e){var t,n,r,o,l,u,c=e.userRegion,d=e.localizedDateTexts,f=e.userBrowsedProductWebpages;if(!f)return[];var p={};try{for(var g=a(f),v=g.next();!v.done;v=g.next()){var h=v.value,m=S(h,c,d);p[m]||(p[m]=[]),p[m].push(h)}}catch(e){t={error:e}}finally{try{v&&!v.done&&(n=g.return)&&n.call(g)}finally{if(t)throw t.error}}try{for(var y=a(Object.keys(p)),b=y.next();!b.done;b=y.next()){p[W=b.value]=k(p[W])}}catch(e){r={error:e}}finally{try{b&&!b.done&&(o=y.return)&&o.call(y)}finally{if(r)throw r.error}}var w=[];try{for(var E=a(Object.keys(p)),D=E.next();!D.done;D=E.next()){var W=D.value;w.push(W),w.push.apply(w,s([],i(p[W]),!1))}}catch(e){l={error:e}}finally{try{D&&!D.done&&(u=E.return)&&u.call(E)}finally{if(l)throw l.error}}return w},t.identicalConsecutivelyBrowsedProductsTimestampsMap=new Map},57682:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useDeleteAllBrowsedProductsBottomSheetInnerState=t.displayDeleteAllBrowsedProductsBottomSheet=void 0;var a=o(n(96540)),i=o(n(40961)),s=n(55015),l=n(17621),u=n(46239),c=n(74617),d=n(97925),f=o(n(35237)),p=o(n(40549));t.displayDeleteAllBrowsedProductsBottomSheet=function(e){var t=e.setUserBrowsedProductWebpages,n=e.isMobileExtension,o=e.panelInnerContainerRef,u=e.closeDeletion,c=e.setIsDeleteAllAnimationInProgress,d=document.createElement("div");d.id=(0,l.getHashedElementId)(l.JokoExtensionRootElement.deleteAllBrowsedProductsBottomSheet),document.documentElement.appendChild(d),i.default.render(a.default.createElement(p.default,null,a.default.createElement(s.LocalesContextProvider,null,a.default.createElement(f.default,r({},{setUserBrowsedProductWebpages:t,isMobileExtension:n,panelInnerContainerRef:o,closeDeletion:u,setIsDeleteAllAnimationInProgress:c})))),d)},t.useDeleteAllBrowsedProductsBottomSheetInnerState=function(e){var t=e.setUserBrowsedProductWebpages,n=e.isMobileExtension,r=e.panelInnerContainerRef,o=e.isBottomSheetDisplayed,i=e.setIsBottomSheetDisplayed,s=e.closeBottomSheet,l=e.closeDeletion,f=e.setIsDeleteAllAnimationInProgress,p=a.default.useRef(null);return(0,c.useOnClickInsidePanel)({panelInnerContainerRef:r,excludedElementRefs:[p],onClick:function(){n&&(null==i||i(!1)),o&&l()},shouldAlsoDetectClickOutsidePanel:!0,dependencyArray:[o]}),{deleteAllBrowsedProductsBottomSheetRef:p,onClickConfirmDeleteAll:function(){(0,d.deleteAllBrowsedProductWebpages)(),f(!0),s(),setTimeout((function(){f(!1),t([]),l()}),1e3*d.DELETE_ALL_BROWSED_PRODUCTS_ANIMATION_DURATION_IN_SECONDS),(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedConfirmDeleteAllBrowsedProducts"}}})},onClickCancelDeleteAll:function(){s(),l(),(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedCancelDeleteAllBrowsedProducts"}}})}}}},56842:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useDeleteAllBrowsedProductsPopupInnerState=void 0;var o=r(n(96540)),a=n(46239),i=n(74617),s=n(97925);t.useDeleteAllBrowsedProductsPopupInnerState=function(e){var t=e.isDeleteAllBrowsedProductsPopupOpen,n=e.setIsDeleteAllBrowsedProductsPopupOpen,r=e.setUserBrowsedProductWebpages,l=e.panelInnerContainerRef,u=e.closeDeletion,c=e.setIsDeleteAllAnimationInProgress,d=o.default.useRef(null),f=o.default.useRef(null);return(0,i.useOnClickInsidePanel)({panelInnerContainerRef:l,excludedElementRefs:[f,d],onClick:function(){n(!1),t&&u()},dependencyArray:[t]}),{onClickConfirmDeleteAll:function(){(0,s.deleteAllBrowsedProductWebpages)(),n(!1),c(!0),setTimeout((function(){c(!1),r([]),u()}),1e3*s.DELETE_ALL_BROWSED_PRODUCTS_ANIMATION_DURATION_IN_SECONDS),(0,a.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedConfirmDeleteAllBrowsedProducts"}}})},onClickCancelDeleteAll:function(){n(!1),u(),(0,a.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedCancelDeleteAllBrowsedProducts"}}})},setIsDeleteAllBrowsedProductsPopupOpen:n,isDeleteAllBrowsedProductsPopupOpen:t,deleteAllBrowsedProductsButtonRef:d,deleteAllBrowsedProductsPopupRef:f}}},33931:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.logClickedPriceComparisonWebpageEvents=t.useHasPriceComparisonLoadingTimedOut=t.useShouldDisplayBestPriceTag=t.enrichProductAlternativesWithAssociatedMerchantOffers=t.filterProductAlternatives=t.getOpenSearchIndexName=t.getProductWebpageAlternatives=t.loadPriceComparisonDataAndLogEvents=t.useLoadPriceComparison=t.useIsPriceComparisonEnabled=void 0;var l=s(n(96540)),u=s(n(95093)),c=n(55015),d=n(77653),f=n(87439),p=n(46239);function g(e){var t,n=e.currentWebpageUrl,a=e.productData,i=e.merchantId,s=e.automaticallyTriggered,l=e.maximumNumberOfItems,u=e.shouldOnlyKeepCheaperAlternatives,d=e.bestPriceTagDisplayEnabled;return r(this,void 0,void 0,(function(){var e,r;return o(this,(function(o){switch(o.label){case 0:return[4,v({webpageUrl:n,productTitle:null!==(t=null==a?void 0:a.name)&&void 0!==t?t:void 0,merchantId:i,maximumNumberOfItems:l}).then((function(e){return w(n,e)}))];case 1:return e=o.sent(),function(e,t,n,r){var o=!!n.length,a=t?t.priceCurrency:null,i={webpageUrl:r?void 0:e,websiteSecondLevelDomain:(0,c.getSecondLevelDomain)(e),wasAutomaticallyTriggered:!!r,hasPriceComparison:o,numberOfDisplayedAlternatives:n.length,currency:a};if(o){var s=null==t?void 0:t.priceAmount;i.browsedProductPrice=null!=s?s:void 0;var l=n[0].productData?n[0].productData.priceAmount:null;if(s&&l){var u=s-l;i.cheaperAlternativeDetected=u>0,i.potentialSavings=u}else i.cheaperAlternativeDetected=!1}(0,p.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"priceComparisonDataLoaded",payload:i}}}),(0,p.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Products - Price Comparison Data Loaded",properties:i}}})}(n,a,e,s),u&&(e=e.filter((function(e){var t,n;return(null!==(t=e.productData.priceAmount)&&void 0!==t?t:0)<(null!==(n=null==a?void 0:a.priceAmount)&&void 0!==n?n:0)}))),[4,S(e)];case 2:return r=o.sent(),[2,{productAlternativesWithAssociatedOffers:r,bestPriceTagDisplayEnabled:null!=d&&d}]}}))}))}function v(e){var t=e.webpageUrl,n=e.productTitle,a=e.merchantId,i=e.maximumNumberOfItems;return r(this,void 0,void 0,(function(){var e;return o(this,(function(r){switch(r.label){case 0:return[4,y("priceComparison")];case 1:return e=r.sent(),[4,b({webpageUrl:t,originalTitle:n,merchantId:a,openSearchIndexName:e,maximumNumberOfItems:i})];case 2:return[2,r.sent().sort((function(e,t){return e.priceInformation.displayPriceAmount.valueInCents-t.priceInformation.displayPriceAmount.valueInCents})).map((function(e){var t;return{__typename:"ProductWebpage",webpageUrl:e.processedWebpageUrl,productData:{name:null!==(t=e.processedTitle)&&void 0!==t?t:e.originalTitle,imageUrl:e.mainImageUrls.defaultSize,priceAmount:Number((e.priceInformation.displayPriceAmount.valueInCents/100).toFixed(2)),priceCurrency:e.priceInformation.displayPriceAmount.currency},productDataLastUpdatedAt:null,searchScore:null,source:void 0}}))]}}))}))}t.useIsPriceComparisonEnabled=function(e,t){var n=(0,c.useHasFeatureByPlatform)({isMobileExtension:t,desktopFeature:c.Feature.priceComparisonAffilizzDesktopBrowserExtension,mobileFeature:c.Feature.priceComparisonAffilizzMobileBrowserExtension}),r=(0,c.useSetting)({settingKey:c.SettingKey.priceComparisonAffilizzRequiredExtensionVersion});return l.default.useMemo((function(){return!(!n||function(e){return e!==c.Region.FR}(e)||!c.versionNumber||!r||1===(0,f.compareVersions)(r,c.versionNumber))}),[n,e,r,c.versionNumber])},t.useLoadPriceComparison=function(e){var t=e.currentWebpageUrl,n=e.productData,i=e.merchantId,s=e.isPriceHistoryAvailable,u=a(l.default.useState(void 0),2),c=u[0],d=u[1];l.default.useEffect((function(){d(void 0)}),[t]);var f=function(e,t,n,a,i){var s=this;return l.default.useCallback((function(l){return r(s,void 0,void 0,(function(){var r;return o(this,(function(o){switch(o.label){case 0:return e?[2,e]:[4,g({currentWebpageUrl:t,productData:i,merchantId:n,automaticallyTriggered:l,bestPriceTagDisplayEnabled:!0})];case 1:return r=o.sent(),a(r),[2,r]}}))}))}),[t,i,e])}(c,t,i,d,n);return l.default.useEffect((function(){!function(e,t){r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return(null==e?void 0:e.priceAmount)?[4,t()]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}(n,f)}),[s,n]),{priceComparisonData:c,loadPriceComparisonAndLogEvents:f}},t.loadPriceComparisonDataAndLogEvents=g,t.getProductWebpageAlternatives=v;var h="merchant-product-offers-4",m="merchant-product-offers-3";function y(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,(0,c.checkHasFeature)("priceComparison"===e?c.Feature.priceComparisonAffilizzData:"productDiscovery"===e?c.Feature.productDiscoveryAffilizzData:c.Feature.priceComparisonQualityMetricAffilizzData)];case 1:return t.sent()?[2,h]:[2,m]}}))}))}function b(e){var t=e.webpageUrl,n=e.originalTitle,r=e.merchantId,o=e.maximumNumberOfItems,a=e.openSearchIndexName;return new Promise((function(e){return(0,p.sendMessageToBackgroundScript)({message:"getMerchantProductOfferAlternatives",data:{queryVariables:{webpageUrl:t,originalTitle:n,merchantId:r,maximumNumberOfItems:o,openSearchIndexName:a}}},(function(t){return e((null==t?void 0:t.merchantProductOfferAlternatives.items)||[])}))}))}function w(e,t){var n=a(e.split("#"),1)[0];return t.filter((function(e){return n!==e.webpageUrl}))}function S(e){return r(this,void 0,void 0,(function(){var t,n,r,s,l,u,c,f,g,v,h,m;return o(this,(function(o){switch(o.label){case 0:return[4,Promise.all(e.map((function(e){return(0,d.getMerchantOfferMatchingUrlWithConditionsAndCoupons)(e.webpageUrl)})))];case 1:t=o.sent(),n=new Set,r=[],s=[];try{for(l=i(e.entries()),u=l.next();!u.done;u=l.next())c=a(u.value,2),f=c[0],g=c[1],(v=t[f])?n.has(v.offerId)||(r.push({productWebpage:g,associatedOffer:v}),n.add(v.offerId)):s.push(g.webpageUrl)}catch(e){h={error:e}}finally{try{u&&!u.done&&(m=l.return)&&m.call(l)}finally{if(h)throw h.error}}return function(e){var t={urls:e};(0,p.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"productAlternativeWebpageUrlsWithoutAssociatedOfferDetected",payload:t}}})}(s),[2,r]}}))}))}function E(e){if(e){var t=(0,u.default)(Date.parse(e));return(0,u.default)().diff(t,"days",!0)}}t.getOpenSearchIndexName=y,t.filterProductAlternatives=w,t.enrichProductAlternativesWithAssociatedMerchantOffers=S,t.useShouldDisplayBestPriceTag=function(e,t){var n=a(l.default.useState(!1),2),r=n[0],o=n[1],i=a(l.default.useState(!1),2),s=i[0],u=i[1],c=a(l.default.useState(!1),2),d=c[0],f=c[1];return l.default.useEffect((function(){if(t){var n=t.productAlternativesWithAssociatedOffers,r=t.bestPriceTagDisplayEnabled;if(n&&0!==n.length){var a=n[0].productWebpage.productData.priceAmount;a&&e&&e.priceAmount&&a<e.priceAmount?(o(!0),r&&f(!0)):r&&u(!0)}}}),[t]),{wasCheaperAlternativeDetected:r,shouldDisplayBestPriceTagOnBrowsedProduct:s,shouldDisplayBestPriceTagOnCheapestAlternative:d}};t.useHasPriceComparisonLoadingTimedOut=function(e){var t=a(l.default.useState(!1),2),n=t[0],r=t[1];return l.default.useEffect((function(){if(!(null==e?void 0:e.length)){var t=setTimeout((function(){return r(!0)}),7e3);return function(){return clearTimeout(t)}}}),[e]),n},t.logClickedPriceComparisonWebpageEvents=function(e,t,n,r,o){var a=e.webpageUrl,i=e.productData,s=e.productDataLastUpdatedAt,l={url:a,rankInPriceComparisonList:t,hasLowestPrice:n,websiteSecondLevelDomain:(0,c.getSecondLevelDomain)(a),productName:i.name,productPriceCurrency:i.priceCurrency,productPriceAmount:i.priceAmount,productDataAgeInDays:E(s),initialProductUrl:r,fromComponent:o};(0,p.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedPriceComparisonWebpage",payload:l}}}),(0,p.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Products - Clicked Price Comparison Webpage",properties:l}}})}},82198:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.useProductData=t.checkIsProductWebpageFromProductData=t.getProductData=void 0;var i=n(96540),s=n(41522),l=n(55015),u=n(7444),c=n(32668);function d(e){return r(this,void 0,void 0,(function(){var t,n,r,a,i,d;return o(this,(function(o){switch(o.label){case 0:return t={platform:"browserExtension",isOnMobileScreen:(0,c.checkIsOnMobileScreen)()},i=s.getProductData,d={context:t,webpageUrl:e},[4,(0,u.checkHasFeatureByPlatform)({mobileFeature:l.Feature.enableProductPageCheckBeforeDataExtraction,desktopFeature:l.Feature.enableProductPageCheckBeforeDataExtraction})];case 1:return d.shouldRunEarlyIsProductPageCheck=o.sent(),[4,p()];case 2:return d.productDataExtractionBlacklist=o.sent(),[4,(0,l.getSetting)(l.SettingKey.bnplCheckoutRegexes)];case 3:return[4,i.apply(void 0,[(d.checkoutRegexes=o.sent()||{},d)])];case 4:return n=o.sent(),r=n.productData,a=n.isDetectedAsProductPage,[2,{productData:r,isDetectedAsProductPage:a}]}}))}))}t.getProductData=d;var f=18e5;function p(){return r(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return[4,(0,l.getSetting)(l.SettingKey.webpageMetaDataExtractionSettings,f)];case 1:return(e=n.sent())&&"object"==typeof e&&((null==(t=(0,c.checkIsOnMobileScreen)()?e.mobileBrowserExtension:e.desktopBrowserExtension)?void 0:t.productDataExtractionBlacklist)&&"object"==typeof t.productDataExtractionBlacklist)?[2,t.productDataExtractionBlacklist]:[2,{}]}}))}))}t.checkIsProductWebpageFromProductData=function(e){if(!e)return!1;var t=e.imageUrl,n=e.priceAmount,r=e.priceCurrency;return!!n&&!!r&&!!t},t.useProductData=function(e){var t=a((0,i.useState)(void 0),2),n=t[0],r=t[1],o=a((0,i.useState)(!1),2),s=o[0],l=o[1];return(0,i.useEffect)((function(){d(e).then((function(e){var t=e.productData;r(t),l(!0)}))}),[e]),{productData:n,isProductDataLoaded:s}}},5883:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.throttledHandleProductDataSynchronization=void 0;var s=i(n(95093)),l=n(55015),u=n(34481),c=n(7444),d=n(68134),f=n(46239),p=n(33931),g=n(82198);function v(e){var t=e.webpageUrl,n=e.productName,r=e.merchantId,o=e.priceAmount,a=e.priceCurrency,i=e.openSearchIndexName;return new Promise((function(e){return(0,f.sendMessageToBackgroundScript)({message:"getProductWebpage",data:{webpageUrl:t,productName:n,merchantId:r,priceAmount:o,priceCurrency:a,openSearchIndexName:i}},(function(t){return e(null==t?void 0:t.productWebpage)}))}))}function h(e,t){return o(this,void 0,void 0,(function(){var n,r,o,i,s,u,c;return a(this,(function(a){switch(a.label){case 0:return[4,(0,d.getTabId)()];case 1:return(n=a.sent())?(r=t.name,o=t.imageUrl,i=t.priceAmount,s=t.priceCurrency,r||o||i||s?[4,(0,l.getLocalStorageItem)(l.LocalStorageKey.capturedWebpageDataByTabIdMap)]:[2]):[2];case 2:return u=a.sent()||{},c={__typename:"UserSavedWebpage",webpageUrl:e,webpageTitle:r||"",webpageImageUrl:o,productPriceAmount:i,productPriceCurrency:s},u[n]=c,[4,(0,l.setLocalStorageItem)(l.LocalStorageKey.capturedWebpageDataByTabIdMap,u)];case 3:return a.sent(),[2]}}))}))}t.throttledHandleProductDataSynchronization=(0,u.asyncThrottle)((function(e){var t=e.browsedWebpageUrl,n=e.isTemporaryUser,i=e.offerId,u=e.merchantId;return o(this,void 0,void 0,(function(){var e,o,d,m,y,b,w,S,E,k,D,W,I,C,T,O,P,A,_,B,x,M,L;return a(this,(function(a){switch(a.label){case 0:return n?[2]:[4,(0,g.getProductData)(t)];case 1:return e=a.sent(),o=e.isDetectedAsProductPage,d=e.productData,[4,(0,l.removeNonEssentialUrlComponents)(t)];case 2:return m=a.sent(),y=d.name,b=d.imageUrl,w=d.priceAmount,S=d.priceCurrency,[4,h(m,d)];case 3:return a.sent(),w&&S&&b?(0,c.checkHasFeatureByPlatform)({mobileFeature:l.Feature.automaticMetadataExtractionOnBrowsingInExtensions,desktopFeature:l.Feature.automaticMetadataExtractionOnBrowsingInExtensions})?(E={webpageUrl:m,productName:y||"",productPriceAmount:w,productPriceCurrency:S,productImageUrl:b,webpageTitle:y||""},i&&(0,f.sendMessageToBackgroundScript)({message:"createProductWebpage",data:E}),[4,(0,p.getOpenSearchIndexName)("priceComparisonQualityMetric")]):[2]:[2];case 4:return k=a.sent(),[4,v({webpageUrl:m,productName:null!=y?y:void 0,priceAmount:w,priceCurrency:S,merchantId:u,openSearchIndexName:k})];case 5:return(D=a.sent())?(W=D.productData,I=D.productDataLastUpdatedAt,C=D.source,T=I,W.name||W.priceAmount||(T=void 0),O=function(e){var t,n,r,o=e.catalogProductData,a=e.browsedWebpageProductData,i=e.productDataLastUpdatedAt,l=e.source,u={browsedWebpageCurrentPriceAmount:{valueInCents:Math.round(100*a.priceAmount),currency:a.priceCurrency},productCatalogLastPriceAmount:(null==o?void 0:o.priceAmount)&&(null==o?void 0:o.priceCurrency)?{valueInCents:Math.round(100*o.priceAmount),currency:null==o?void 0:o.priceCurrency}:void 0,productCatalogLastPriceDataPointTimestampInSeconds:i?(0,s.default)(i).unix():void 0,productCatalogSource:l},c={browsedWebpageProductName:null!==(t=a.name)&&void 0!==t?t:void 0,productCatalogMerchantProductOfferTitle:null!==(n=null==o?void 0:o.name)&&void 0!==n?n:void 0,productCatalogSource:l},d={browsedWebpageProductImageUrl:a.imageUrl,productCatalogMerchantProductOfferMainImageUrl:null!==(r=null==o?void 0:o.imageUrl)&&void 0!==r?r:void 0,productCatalogSource:l};return{priceFreshnessInformation:u,nameFreshnessInformation:c,imageUrlFreshnessInformation:d}}({catalogProductData:W,browsedWebpageProductData:{name:y,imageUrl:b,priceAmount:w,priceCurrency:S},productDataLastUpdatedAt:T,source:C}),P=O.priceFreshnessInformation,A=O.nameFreshnessInformation,_=O.imageUrlFreshnessInformation,B=r(r({},E),{offerId:i,isDetectedAsProductPage:o,priceFreshnessInformation:P,nameFreshnessInformation:A,imageUrlFreshnessInformation:_}),x={priceFreshnessInformation:P,nameFreshnessInformation:A,imageUrlFreshnessInformation:_},M=i?B:x,(0,f.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browsedToProductWebpage",active:!1,payload:M}}}),(0,f.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Browsed To Product Webpage",properties:M}}}),(0,f.sendMessageToBackgroundScript)({message:"logAnonymousEvent",data:{event:{type:"anonymousBrowsedToProductWebpage",payload:B}}}),L=r({__typename:"BrowsedProductWebpage",timestamp:Number((Date.now()/1e3).toFixed(3))},E),(0,f.sendMessageToBackgroundScript)({message:"updateQueryCacheForDetectedProductWebpage",data:L}),[2,{productData:d,source:C}]):[2]}}))}))}),2e3,{leading:!1})},56577:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useListenToAssistantMessageOnProductDiscoveryConversation=t.usePostUserMessageToProductDiscoveryConversation=t.useOpenSearchIndexName=t.useCreateProductDiscoveryConversationId=void 0;var l=s(n(96540)),u=n(55015),c=n(46239),d=n(33931);t.useCreateProductDiscoveryConversationId=function(){var e=a(l.default.useState(),2),t=e[0],n=e[1];return l.default.useEffect((function(){if(!t){(0,c.sendMessageToBackgroundScript)({message:"createProductDiscoveryConversationId"},n)}}),[t]),t},t.useOpenSearchIndexName=function(){var e=this,t=a(l.default.useState(void 0),2),n=t[0],i=t[1];return l.default.useEffect((function(){r(e,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,(0,d.getOpenSearchIndexName)("productDiscovery")];case 1:return e=t.sent(),i(e),[2]}}))}))}),[]),n},t.usePostUserMessageToProductDiscoveryConversation=function(e){var t=e.lastUserInput,n=e.userRegion,r=e.openSearchIndexName,o=e.conversationId,i=a(l.default.useState(void 0),2),s=i[0],d=i[1],f=a(l.default.useState(!1),2),p=f[0],g=f[1];return l.default.useEffect((function(){""!==t&&n&&o&&!p&&((0,c.sendMessageToBackgroundScript)({message:"updateProductDiscoveryConversation",data:{message:t,timestamp:Date.now(),conversationId:o,localeCode:(0,u.getLocaleCodeFromRegion)(n),shouldLogAllData:!0,openSearchIndexName:r}},d),g(!0))}),[t,n,r,o]),{lastAssistantResponse:s,setLastAssistantResponse:d,isLastAssistantResponseLoading:p,setIsLastAssistantResponseLoading:g}},t.useListenToAssistantMessageOnProductDiscoveryConversation=function(e){var t=e.lastAssistantResponse,n=e.setMessages,r=e.setLastAssistantResponse,o=e.setIsLastAssistantResponseLoading,s=a(l.default.useState(void 0),2),u=s[0],c=s[1];return l.default.useEffect((function(){""!==(null==t?void 0:t.updateProductDiscoveryConversation.content)&&t&&(n((function(e){return i(i([],a(e),!1),[{text:"Assistant: ".concat(null==t?void 0:t.updateProductDiscoveryConversation.content),type:"assistant"}],!1)})),(null==t?void 0:t.updateProductDiscoveryConversation.merchantProductOffers)&&c(t.updateProductDiscoveryConversation.merchantProductOffers),r(void 0),o(!1))}),[t]),u}},86245:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useSaveProduct=void 0;var l=s(n(96540)),u=n(55015),c=n(74137),d=n(46239),f=n(89710);t.useSaveProduct=function(e){var t=this,n=e.webpageUrl,s=e.productData,p=e.offer,g=e.fromComponent,v=e.userSavedWebpages,h=e.setUserSavedWebpages,m=a(l.default.useState(void 0),2),y=m[0],b=m[1],w=!!y;l.default.useEffect((function(){if(s){var e=s.name||document.title;(0,d.sendMessageToBackgroundScript)({message:"getWebpageUrlIfSaved",data:{webpageUrl:n,webpageTitle:e}},(function(e){return b(e.savedWebpageUrl)}))}}),[n,s]),function(e,t,n,r,o){l.default.useEffect((function(){function a(a){if(o&&(0,d.sendMessageToBackgroundScript)({message:"getUserSavedWebpages"},(function(e){return o(e.userSavedWebpages)})),"webpageUnsaved"===a.message&&a.data.unsavedWebpageUrl===n)r(void 0);else if("webpageSaved"===a.message&&!n&&t){var i=t.name||document.title;(0,d.sendMessageToBackgroundScript)({message:"getWebpageUrlIfSaved",data:{webpageUrl:e,webpageTitle:i}},(function(e){return r(e.savedWebpageUrl)}))}return!0}var i=(0,c.withSentry)(a);return chrome.runtime.onMessage.removeListener(i),chrome.runtime.onMessage.addListener(i),function(){return chrome.runtime.onMessage.removeListener(i)}}),[e,t,n])}(n,s,y,b,h);var S=l.default.useCallback((function(e){return r(t,void 0,void 0,(function(){var t,r;return o(this,(function(o){switch(o.label){case 0:return s?y?[3,2]:[4,(0,u.removeNonEssentialUrlComponents)(n)]:[2];case 1:return t=o.sent(),b(t),r={__typename:"UserSavedWebpage",webpageUrl:t,webpageTitle:s.name||"",webpageImageUrl:s.imageUrl||"",productPriceAmount:s.priceAmount||0,productPriceCurrency:s.priceCurrency||""},h(i([r],a(v||[]),!1)),function(e,t,n,r){var o=t.name,a=t.imageUrl,i=t.priceAmount,s=t.priceCurrency,l={webpageUrl:e,webpageTitle:o||"",webpageImageUrl:a||void 0,productPriceAmount:i||void 0,productPriceCurrency:s||void 0};(0,d.sendMessageToBackgroundScript)({message:"saveWebpage",data:l}),(0,d.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"savedWebpage",payload:{url:e,offerId:n,fromComponent:r}}}}),(0,d.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Webpages - Saved Webpage",properties:{url:e,offerId:n,fromComponent:r}}}})}(t,s,null==p?void 0:p.offerId,g),(0,f.handleUserInterfaceComponentInteractionInBackgroundOrLoadTrackingLink)({offer:p,triggeringEventType:u.UserInterfaceComponentInteractionEventType.productSavingButton}),[3,3];case 2:b(void 0),function(e,t,n){(0,d.sendMessageToBackgroundScript)({message:"unsaveWebpage",data:{webpageUrl:e}}),(0,d.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"unsavedWebpage",payload:{url:e,offerId:t,fromComponent:n}}}}),(0,d.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Webpages - Unsaved Webpage",properties:{url:e,offerId:t,fromComponent:n}}}})}(y,null==p?void 0:p.offerId,g),o.label=3;case 3:return e&&e(!w),[2]}}))}))}),[s,y,w,null==p?void 0:p.offerId,g]);return{isProductSaved:w,toggleIsProductSaved:S}}},50934:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useUserSavedWebpagesByUrlMap=t.unsaveProductAndLogEvents=t.useUnsaveProduct=t.UNSAVE_PRODUCT_ANIMATION_DURATION_IN_MS=t.onClickSavedWebpageElement=t.useDisplayedSavedWebpages=void 0;var s=i(n(96540)),l=n(55015),u=n(77653),c=n(46239),d=n(89710);t.useDisplayedSavedWebpages=function(e){var t=(0,l.useProgressiveDisplay)(e||[]),n=t.displayedItems,r=t.showMoreResults;return{displayedUserSavedWebpages:n,onScrollWebpagesListContainer:function(e){var t=e.currentTarget,n=t.scrollHeight,o=t.scrollTop,a=t.clientHeight;Math.abs(n-o-a)<1&&r()}}},t.onClickSavedWebpageElement=function(e){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return[4,(0,u.getMerchantOfferMatchingUrlWithConditionsAndCoupons)(e)];case 1:return t=r.sent(),(0,d.handleUserInterfaceComponentInteractionInBackgroundOrLoadTrackingLink)({offer:t,triggeringEventType:l.UserInterfaceComponentInteractionEventType.savedProduct}),n={url:e},(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedSavedWebpage",payload:n}}}),(0,c.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Webpages - Clicked Saved Webpage",properties:n}}}),(0,c.sendMessageToBackgroundScript)({message:"openTab",data:{url:e}}),[2]}}))}))};function f(e,t,n){if(e){n(t.filter((function(t){return t.webpageUrl!==e.webpageUrl}))),(0,c.sendMessageToBackgroundScript)({message:"unsaveWebpage",data:{webpageUrl:e.webpageUrl}});var r={url:e.webpageUrl,fromComponent:"savedProductsSection"};(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"unsavedWebpage",payload:r}}}),(0,c.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Webpages - Unsaved Webpage",properties:r}}})}}t.UNSAVE_PRODUCT_ANIMATION_DURATION_IN_MS=500,t.useUnsaveProduct=function(e){var n=e.userSavedWebpage,r=e.userSavedWebpages,o=e.setUserSavedWebpages,i=s.default.useRef(void 0),l=a(s.default.useState(!1),2),u=l[0],c=l[1],d=a(s.default.useState(!1),2),p=d[0],g=d[1],v=s.default.useCallback((function(){return c(!0)}),[]),h=s.default.useCallback((function(){p||(i.current&&(clearTimeout(i.current),i.current=void 0),c(!1))}),[p]),m=s.default.useCallback((function(){f(n,r,o)}),[n,r,o]);return s.default.useEffect((function(){return window.removeEventListener("beforeunload",m),u&&(window.addEventListener("beforeunload",m),i.current=setTimeout((function(){i.current=void 0,g(!0),setTimeout((function(){f(n,r,o),window.removeEventListener("beforeunload",m)}),t.UNSAVE_PRODUCT_ANIMATION_DURATION_IN_MS)}),5e3)),function(){i.current&&(u&&f(n,r,o),clearTimeout(i.current),window.removeEventListener("beforeunload",m),i.current=void 0)}}),[u]),{isProductBeingUnsaved:u,hasDeletionAnimationStarted:p,requestProductUnsave:v,cancelUnsaveProduct:h}},t.unsaveProductAndLogEvents=f,t.useUserSavedWebpagesByUrlMap=function(e){return s.default.useMemo((function(){return e?e.reduce((function(e,t){return e.set(t.webpageUrl,t),e}),new Map):new Map}),[e])}},33252:function(e,t){var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.getElementsAttributesAndComputedStyleByTagName=t.getElementsAttributesAndComputedStyleBySelector=t.getElementsInnerHtmlByTagName=t.getElementsAttributesByTagName=t.getElementAttributesById=void 0,t.getElementAttributesById=function(e,t){var r,o,a=document.getElementById(e),i={};if(a)try{for(var s=n(t),l=s.next();!l.done;l=s.next()){var u=l.value;i[u]=a.getAttribute(u)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}return i},t.getElementsAttributesByTagName=function(e,t){var r,o,a,i,s=document.getElementsByTagName(e),l=[];try{for(var u=n(Array.from(s)),c=u.next();!c.done;c=u.next()){var d=c.value,f={};try{for(var p=(a=void 0,n(t)),g=p.next();!g.done;g=p.next()){var v=g.value;f[v]=d.getAttribute(v)}}catch(e){a={error:e}}finally{try{g&&!g.done&&(i=p.return)&&i.call(p)}finally{if(a)throw a.error}}l.push(f)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}return l},t.getElementsInnerHtmlByTagName=function(e,t){for(var r,o,a=document.getElementsByTagName(e),i=[],s=0;s<a.length;s++){var l=a[s],u=!0;if(t)try{for(var c=(r=void 0,n(t)),d=c.next();!d.done;d=c.next()){var f=d.value;l.getAttribute(f.attributeName)!==f.attributeValue&&(u=!1)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}u&&i.push(l.innerHTML)}return i},t.getElementsAttributesAndComputedStyleBySelector=function(e,t,r){var o,a,i,s,l,u,c=document.querySelectorAll(e),d=[];try{for(var f=n(Array.from(c)),p=f.next();!p.done;p=f.next()){var g=p.value,v={attributes:{},computedStyleProperties:{}},h=getComputedStyle(g);try{for(var m=(i=void 0,n(t)),y=m.next();!y.done;y=m.next()){var b=y.value;v.attributes[b]=g[b]}}catch(e){i={error:e}}finally{try{y&&!y.done&&(s=m.return)&&s.call(m)}finally{if(i)throw i.error}}try{for(var w=(l=void 0,n(r)),S=w.next();!S.done;S=w.next()){var E=S.value;v.computedStyleProperties[E]="boundingRect"===E?g.getBoundingClientRect():h[E]}}catch(e){l={error:e}}finally{try{S&&!S.done&&(u=w.return)&&u.call(w)}finally{if(l)throw l.error}}d.push(v)}}catch(e){o={error:e}}finally{try{p&&!p.done&&(a=f.return)&&a.call(f)}finally{if(o)throw o.error}}return d},t.getElementsAttributesAndComputedStyleByTagName=function(e,t,r){var o,a,i,s,l,u,c=document.getElementsByTagName(e),d=[];try{for(var f=n(Array.from(c)),p=f.next();!p.done;p=f.next()){var g=p.value,v={attributes:{},computedStyleProperties:{}},h=getComputedStyle(g);try{for(var m=(i=void 0,n(t)),y=m.next();!y.done;y=m.next()){var b=y.value;v.attributes[b]=g[b]}}catch(e){i={error:e}}finally{try{y&&!y.done&&(s=m.return)&&s.call(m)}finally{if(i)throw i.error}}try{for(var w=(l=void 0,n(r)),S=w.next();!S.done;S=w.next()){var E=S.value;v.computedStyleProperties[E]=h[E]}}catch(e){l={error:e}}finally{try{S&&!S.done&&(u=w.return)&&u.call(w)}finally{if(l)throw l.error}}d.push(v)}}catch(e){o={error:e}}finally{try{p&&!p.done&&(a=f.return)&&a.call(f)}finally{if(o)throw o.error}}return d}},71145:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.checkShouldStandDownOnWebpage=void 0;var l=n(55015),u=n(7444),c=n(40334),d=n(77653),f=n(46239),p={};function g(e,t){return o(this,void 0,void 0,(function(){var n,r,o,d,p,g,S,E,k,D;return a(this,(function(a){switch(a.label){case 0:return[4,Promise.all([(0,u.checkHasFeatureByPlatform)({mobileFeature:l.Feature.enableStandDownComplianceInMobileBrowserExtension,desktopFeature:l.Feature.enableStandDownComplianceInDesktopBrowserExtension}),(0,l.getSetting)(l.SettingKey.standDownComplianceSettings),(0,l.getLocalStorageItem)(l.LocalStorageKey.offerActivatedInSessionTimestampMsMap)])];case 1:return n=i.apply(void 0,[a.sent(),3]),r=n[0],o=n[1],d=n[2],!r||d&&function(e,t,n){var r;if(!(null==t?void 0:t[e]))return!1;var o=null!==(r=null==n?void 0:n.jokoOfferActivationDurationInHours)&&void 0!==r?r:v;return Date.now()-t[e]<1e3*o*60*60}(e,d,o)?[2,!1]:function(e){var t,n=Number(sessionStorage.getItem(m));if(!n)return!1;if(0===(null==e?void 0:e.maxStandDownDurationInMinutes))return!0;var r=null!==(t=null==e?void 0:e.maxStandDownDurationInMinutes)&&void 0!==t?t:y;return Date.now()-n<1e3*r*60}(o)?[2,!0]:(p=function(e){try{var t=new URL(e).searchParams;if(0===t.size)return;return t}catch(e){return void console.error(e)}}(t),[4,Promise.all([(0,c.getUserRegion)(),h(e),(0,l.getLocalStorageItem)(l.LocalStorageKey.standDownEventDetectionByAffiliatePlatformIdMap)])]);case 2:return g=i.apply(void 0,[a.sent(),3]),S=g[0],E=g[1],k=g[2],D=function(e,t,n,r){var o,a,i;if(!e||!r||!(null===(i=null==t?void 0:t.settingsByAffiliatePlatformId)||void 0===i?void 0:i[r]))return!1;var l=t.settingsByAffiliatePlatformId[r],u=l.activeRegions,c=l.standDownComplianceUrlParameters;if(!(null==u?void 0:u.includes(n))||!c)return!1;try{for(var d=s(c),f=d.next();!f.done;f=d.next()){var p=f.value,g=p.key,v=p.value;if(e.has(g)&&(void 0===v||v===e.get(g)))return!0}}catch(e){o={error:e}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}return!1}(p,o,S,E)||function(e,t,n,r){var o;if(!t||!(null==e?void 0:e[t]))return!1;var a=e[t],i=a.timestampInMs,s=a.offerId;if(!i||s&&s!==n)return!1;var l=null!==(o=null==r?void 0:r.cookieOrRedirectionDetectionDurationInMinutes)&&void 0!==o?o:b;return Date.now()-i<1e3*l*60}(k,E,e,o),D?(sessionStorage.setItem(m,Date.now().toString()),function(e){if(w.url===e.url)return;w.url=e.url,(0,f.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"standDownPolicyApplied",payload:e}}}),(0,f.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Offers - Stand Down Policy Applied",properties:e}}})}({offerId:e,url:t}),[2,!0]):[2,!1]}}))}))}t.checkShouldStandDownOnWebpage=function(e,t){var n,i;return o(this,void 0,void 0,(function(){var o,s;return a(this,(function(a){switch(a.label){case 0:return e?(t||(t=window.location.href),void 0!==(null===(n=p[e])||void 0===n?void 0:n[t])?[2,null===(i=p[e])||void 0===i?void 0:i[t]]:[4,g(e,t)]):[2,!1];case 1:return o=a.sent(),p[e]=r(r({},p[e]),((s={})[t]=o,s)),[2,o]}}))}))};var v=1;function h(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return[4,(0,d.getMerchantOfferWithConditionsAndCouponsFromS3)(e)];case 1:return(t=n.sent())?[2,t.affiliatePlatformId]:[2,void 0]}}))}))}var m="jokoStandDownPolicyAppliedInTabTimestampInMs",y=60;var b=1;var w={url:void 0}},8207:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},l=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handleThirdPartyExtensionsDetection=void 0;var c=u(n(95093)),d=n(55015),f=n(17621),p=n(46239),g=n(18989),v=n(94700);function h(e){return!(!(e&&"object"==typeof e&&"name"in e&&"string"==typeof e.name&&"selectors"in e&&Array.isArray(e.selectors)&&e.selectors.every((function(e){return"string"==typeof e})))||"minimumEventLoggingIntervalInMinutes"in e&&"number"!=typeof e.minimumEventLoggingIntervalInMinutes||"numberOfExecutions"in e&&"number"!=typeof e.numberOfExecutions||"shadowRootSelector"in e&&"string"!=typeof e.shadowRootSelector||"iframeRootSelector"in e&&"string"!=typeof e.iframeRootSelector||!(!("widgets"in e)||Array.isArray(e.widgets)&&e.widgets.every(m)))}function m(e){return!(!(e&&"object"==typeof e&&"widgetName"in e&&"string"==typeof e.widgetName&&"selector"in e&&"string"==typeof e.selector)||"shadowRootSelector"in e&&"string"!=typeof e.shadowRootSelector||"iframeSelector"in e&&"string"!=typeof e.iframeSelector)}t.handleThirdPartyExtensionsDetection=function(e,t){return o(this,void 0,void 0,(function(){var n,r,o,i,s,l;return a(this,(function(a){switch(a.label){case 0:return[4,(0,d.getSetting)(d.SettingKey.thirdPartyExtensionsDetectionSetting)];case 1:return function(e){return!!(e&&"object"==typeof e&&"enabled"in e&&"boolean"==typeof e.enabled&&"detectionExecutionIntervalInMs"in e&&"number"==typeof e.detectionExecutionIntervalInMs&&"individualThirdPartyExtensionDetectionParameters"in e&&Array.isArray(e.individualThirdPartyExtensionDetectionParameters)&&e.individualThirdPartyExtensionDetectionParameters.every(h))}(n=a.sent())&&n.enabled?[4,(0,d.checkHasFeature)(d.Feature.extendThirdPartyExtensionDetectionToAllWebsitesInExtensions)]:[2];case 2:return r=a.sent(),o=n.detectionExecutionIntervalInMs,i=n.numberOfExecutions,s=n.minimumEventLoggingIntervalInMinutes,w({thirdPartyExtensionsDetectionSetting:n,url:e,offer:t,minimumEventLoggingIntervalInMinutes:s,shouldExtendThirdPartyExtensionDetectionToAllWebsites:r}),l=setInterval((function(){return w({thirdPartyExtensionsDetectionSetting:n,url:e,offer:t,minimumEventLoggingIntervalInMinutes:s,shouldExtendThirdPartyExtensionDetectionToAllWebsites:r})}),o),setTimeout((function(){return clearInterval(l)}),o*((null!=i?i:10)-1)),[2]}}))}))};var y=new Set,b=!1;function w(e){var t=e.thirdPartyExtensionsDetectionSetting,n=e.url,r=e.offer,u=e.minimumEventLoggingIntervalInMinutes,f=e.shouldExtendThirdPartyExtensionDetectionToAllWebsites;return o(this,void 0,void 0,(function(){var e,o,p,g,v,h,m,w,I,C,T,O,P,A,_,B,x,M,L,U,R,F;return a(this,(function(a){switch(a.label){case 0:e=t.individualThirdPartyExtensionDetectionParameters,a.label=1;case 1:a.trys.push([1,14,15,16]),o=i(e),p=o.next(),a.label=2;case 2:if(p.done)return[3,13];g=p.value,v=g.name,h=g.shadowRootSelector,m=g.iframeRootSelector,w=g.selectors,I=g.widgets,C=S(h),T=E(m),O=C.length||T.length?l(l([],s(C),!1),s(T),!1):[document],a.label=3;case 3:a.trys.push([3,8,9,10]),U=void 0,P=i(O),A=P.next(),a.label=4;case 4:return A.done?[3,7]:(_=A.value,_.querySelectorAll(w.join(",")).length>0?[4,(0,d.updateLocalStorageItem)(d.LocalStorageKey.thirdPartyExtensionsLastDetectedTimestampInSecondsMap,(F={},F[v]=(0,c.default)().unix(),F))]:[3,6]);case 5:a.sent(),a.label=6;case 6:return A=P.next(),[3,4];case 7:return[3,10];case 8:return B=a.sent(),U={error:B},[3,10];case 9:try{A&&!A.done&&(R=P.return)&&R.call(P)}finally{if(U)throw U.error}return[7];case 10:return I&&(r||f)?[4,k({thirdPartyExtensionName:v,widgets:I,url:n,offer:r,minimumEventLoggingIntervalInMinutes:u})]:[3,12];case 11:a.sent(),a.label=12;case 12:return p=o.next(),[3,2];case 13:return[3,16];case 14:return x=a.sent(),M={error:x},[3,16];case 15:try{p&&!p.done&&(L=o.return)&&L.call(o)}finally{if(M)throw M.error}return[7];case 16:return!y.size||D&&!b?[3,18]:[4,W()];case 17:a.sent(),a.label=18;case 18:return b=!1,[2]}}))}))}function S(e){if(!e)return[];var t=document.querySelectorAll(e);if(!t)return[];return Array.from(t).slice(0,20).map((function(e){return(t=e)instanceof HTMLElement&&void 0!==chrome.dom&&void 0!==chrome.dom.openOrClosedShadowRoot?chrome.dom.openOrClosedShadowRoot(t):null==t?void 0:t.shadowRoot;var t})).filter((function(e){return!!e}))}function E(e){var t,n,r;if(!e)return[];var o=[],a=document.querySelectorAll(e);if(!a)return[];try{for(var s=i(a),l=s.next();!l.done;l=s.next()){var u=l.value;if(u instanceof HTMLIFrameElement){var c=u.contentDocument||(null===(r=u.contentWindow)||void 0===r?void 0:r.document);c&&o.push(c)}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return o}function k(e){var t,n,u=e.thirdPartyExtensionName,f=e.widgets,g=e.url,v=e.offer,h=e.minimumEventLoggingIntervalInMinutes;return o(this,void 0,void 0,(function(){var e,o,m,w,k,D,W,I,C,T,O,P,A,_,B,x,M,L,U,R,F,N,H,j,J,V,G,K;return a(this,(function(a){switch(a.label){case 0:return(e=(0,d.getSecondLevelDomain)(g))?[4,(0,d.getLocalStorageItem)(d.LocalStorageKey.allThirdPartyExtensionsWidgetsLastDetectedTimestampInSecondsBySecondLevelDomainMap)]:[2];case 1:return o=null!==(t=a.sent())&&void 0!==t?t:{},[4,Promise.all([(0,d.checkHasFeature)(d.Feature.logThirdPartyExtensionWidgetDetectedInAnonymousEvents),(0,d.checkHasFeature)(d.Feature.logThirdPartyExtensionWidgetDetectedInUserEvents)])];case 2:m=s.apply(void 0,[a.sent(),2]),w=m[0],k=m[1],D=o[e],W=null!==(n=null==D?void 0:D[u])&&void 0!==n?n:{},I=!1;try{for(C=i(f),T=C.next();!T.done;T=C.next()){O=T.value,P=O.widgetName,A=O.shadowRootSelector,_=O.iframeRootSelector,B=O.selector,x=S(A),M=E(_),L=x.length||M.length?l(l([],s(x),!1),s(M),!1):[document];try{for(J=void 0,U=i(L),R=U.next();!R.done;R=U.next())if(F=R.value,F.querySelector(B)){if(y.has(u)||(y.add(u),b=!0),W[P]&&(N=c.default.unix(W[P]),h&&(0,c.default)().diff(N,"minutes")<h))break;I=!0,W[P]=(0,c.default)().unix(),k&&(0,p.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"thirdPartyExtensionWidgetDetected",active:!1,payload:{secondLevelDomain:e,offerId:null==v?void 0:v.offerId,thirdPartyExtensionName:u,widgetName:P}}}}),w&&(0,p.sendMessageToBackgroundScript)({message:"logAnonymousEvent",data:{event:{type:"thirdPartyExtensionWidgetDetected",payload:{secondLevelDomain:e,offerId:null==v?void 0:v.offerId,thirdPartyExtensionName:u,widgetName:P}}}})}}catch(e){J={error:e}}finally{try{R&&!R.done&&(V=U.return)&&V.call(U)}finally{if(J)throw J.error}}}}catch(e){H={error:e}}finally{try{T&&!T.done&&(j=C.return)&&j.call(C)}finally{if(H)throw H.error}}return I?[4,(0,d.updateLocalStorageItem)(d.LocalStorageKey.allThirdPartyExtensionsWidgetsLastDetectedTimestampInSecondsBySecondLevelDomainMap,(G={},G[e]=r(r({},D),(K={},K[u]=W,K)),G))]:[3,4];case 3:a.sent(),a.label=4;case 4:return[2]}}))}))}var D=!1;function W(){return o(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:return[4,(0,d.checkHasFeature)(d.Feature.displayExtensionWidgetsAboveThirdPartyExtensions)];case 1:return n.sent()?(e=(0,v.getWidgetElement)(f.JokoExtensionRootElement.offerWidget))?((0,v.throttledRepositionWidgetAtDomBottom)(e),[4,new Promise((function(e){return setTimeout(e,50)}))]):[3,3]:[2];case 2:n.sent(),n.label=3;case 3:return(t=(0,g.getSideButtonElement)())&&(0,g.throttledRepositionSideButtonAtDomBottom)(t),D=!0,(0,p.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"widgetsAndSideButtonDomPositionsReset",active:!1,payload:{detectedThirdPartyExtensions:y}}}}),[2]}}))}))}},98444:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useWasCashbackOfferActivationOverriddenByCompetitorRecently=t.handleThirdPartyLinkLoadingDetection=void 0;var u=l(n(96540)),c=n(55015),d=n(37392),f=n(32668),p=n(74137),g=n(46239),v=n(75614);function h(e){return new Promise((function(t){return(0,g.sendMessageToBackgroundScript)({message:"getPostAffiliateLinkLoadingJokoFingerprint",data:{offerId:e}},(function(e){var n;return t(null!==(n=null==e?void 0:e.postAffiliateLinkLoadingJokoFingerprint)&&void 0!==n?n:void 0)}))}))}function m(e,t){try{return new RegExp(t).test(e)}catch(e){return console.error(e),(0,p.captureSentryException)(e),!1}}t.handleThirdPartyLinkLoadingDetection=function(e,t){return o(this,void 0,void 0,(function(){var n,l,u,d,f,p,v,y,b,w,S,E,k;return a(this,(function(D){switch(D.label){case 0:return D.trys.push([0,2,,3]),(null==t?void 0:t.offerId)?(n=t.offerId,l=function(e){try{var t=new URL(e).searchParams;if(0===t.size)return;return t}catch(e){return void console.error(e)}}(e),l?[4,Promise.all([h(n),(0,c.getSetting)(c.SettingKey.thirdPartyOriginTrackingUrlParameters)])]:[2]):[2];case 1:return u=i.apply(void 0,[D.sent(),2]),d=u[0],f=u[1],p=function(e){var t=e.detectedUrlSearchParams,n=e.postAffiliateLinkLoadingJokoFingerprint,r=e.thirdPartyOriginTrackingUrlParametersSetting,o=function(e,t){return t&&0!==t.length?t.every((function(t){return e.get(t.key)===t.value})):void 0}(t,n);if(o)return{isJokoLinkLoading:o};var a=function(e,t,n){var r=null==t?void 0:t.find((function(t){return e.has(t.key)&&e.get(t.key)!==t.value})),o=r?{key:r.key,value:e.get(r.key)||""}:void 0,a=function(e,t){var n,r,o,a,l;try{if(!t)return;try{for(var u=s(Array.from(e.entries())),c=u.next();!c.done;c=u.next()){var d=i(c.value,2),f=d[0],p=d[1];if(null===(l=t[f])||void 0===l?void 0:l.thirdPartyValueRegexes)try{for(var g=(o=void 0,s(t[f].thirdPartyValueRegexes)),v=g.next();!v.done;v=g.next()){var h=v.value;if(m(p,h.valueRegex))return{thirdPartyId:h.thirdPartyId,thirdPartyFlaggedUrlParamKey:f,thirdPartyFlaggedUrlParamValue:p}}}catch(e){o={error:e}}finally{try{v&&!v.done&&(a=g.return)&&a.call(g)}finally{if(o)throw o.error}}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}return}catch(e){return void console.error(e)}}(e,n),l=null==a?void 0:a.thirdPartyId,u=(null==a?void 0:a.thirdPartyFlaggedUrlParamKey)?{key:a.thirdPartyFlaggedUrlParamKey,value:null==a?void 0:a.thirdPartyFlaggedUrlParamValue}:void 0;return o||u?{isAffiliateThirdPartyLinkLoading:!0,affiliateThirdPartyId:l,affiliateFlaggedUrlParameterBasedOnJokoFingerprint:o,affiliateFlaggedUrlParameterBasedOnThirdPartySetting:u}:{isAffiliateThirdPartyLinkLoading:!1}}(t,n,r),l=a.isAffiliateThirdPartyLinkLoading,u=a.affiliateThirdPartyId,c=a.affiliateFlaggedUrlParameterBasedOnJokoFingerprint,d=a.affiliateFlaggedUrlParameterBasedOnThirdPartySetting;if(l)return{isAffiliateThirdPartyLinkLoading:l,thirdPartyId:u,affiliateFlaggedUrlParameterBasedOnJokoFingerprint:c,affiliateFlaggedUrlParameterBasedOnThirdPartySetting:d};var f=function(e,t){var n,r,o;if(!t)return{isNonAffiliateThirdPartyLinkLoading:void 0};try{for(var a=s(Array.from(e.entries())),l=a.next();!l.done;l=a.next()){var u=i(l.value,2),c=u[0],d=u[1];if(null===(o=t[c])||void 0===o?void 0:o.specificThirdPartyId)return{isNonAffiliateThirdPartyLinkLoading:!0,nonAffiliateThirdPartyId:t[c].specificThirdPartyId,nonAffiliateFlaggedUrlParameter:{key:c,value:d}}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return{isNonAffiliateThirdPartyLinkLoading:!1}}(t,r),p=f.isNonAffiliateThirdPartyLinkLoading,g=f.nonAffiliateThirdPartyId,v=f.nonAffiliateFlaggedUrlParameter;return p?{isNonAffiliateThirdPartyLinkLoading:p,thirdPartyId:g,nonAffiliateFlaggedUrlParameter:v}:{}}({detectedUrlSearchParams:l,postAffiliateLinkLoadingJokoFingerprint:d,thirdPartyOriginTrackingUrlParametersSetting:f}),v=p.isAffiliateThirdPartyLinkLoading,y=p.isNonAffiliateThirdPartyLinkLoading,b=p.thirdPartyId,w=p.nonAffiliateFlaggedUrlParameter,S=p.affiliateFlaggedUrlParameterBasedOnJokoFingerprint,E=p.affiliateFlaggedUrlParameterBasedOnThirdPartySetting,(v||y)&&(!function(e,t,n){o(this,void 0,void 0,(function(){var o,i;return a(this,(function(a){switch(a.label){case 0:return t&&n?[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.thirdPartyAffiliateLinkLoadingTimestampMsMap)]:[2];case 1:return o=a.sent(),[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.thirdPartyAffiliateLinkLoadingTimestampMsMap,r(r({},o),(i={},i[e]=Date.now(),i)))];case 2:return a.sent(),[2]}}))}))}(n,v,b),W={url:e,offerId:n,isAffiliateThirdPartyLinkLoading:v,isNonAffiliateThirdPartyLinkLoading:y,thirdPartyId:b,nonAffiliateFlaggedUrlParameter:w,affiliateFlaggedUrlParameterBasedOnJokoFingerprint:S,affiliateFlaggedUrlParameterBasedOnThirdPartySetting:E},(0,g.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"thirdPartyLinkLoadingDetected",payload:W}}})),[3,3];case 2:return k=D.sent(),console.error(k),[3,3];case 3:return[2]}var W}))}))},t.useWasCashbackOfferActivationOverriddenByCompetitorRecently=function(e){var t=i(u.default.useState(!1),2),n=t[0],r=t[1],o=(0,f.checkIsOnMobileScreen)(),a=(0,c.useHasFeatureByPlatform)({isMobileExtension:o,desktopFeature:c.Feature.cashbackTrackingLostWidgetDesktopBrowserExtension,mobileFeature:c.Feature.cashbackTrackingLostWidgetMobileBrowserExtension});return u.default.useEffect((function(){a&&(0,v.checkWasCashbackOfferActivationOverriddenByCompetitorRecently)(e).then(r);var t=(0,d.setJokoDomEventListener)(d.JokoDomEvent.onOfferActivated,(function(){return r(!1)}));return function(){return(0,d.removeJokoDomEventListener)(d.JokoDomEvent.onOfferActivated,t)}}),[e]),n}},59039:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.logBrowsedToCartWebpageEvents=t.checkIsCartWebpageAndGetMatchData=void 0;var i=n(2543),s=n(55015),l=n(7444),u=n(46239),c=n(1857);t.checkIsCartWebpageAndGetMatchData=function(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return[4,(0,l.checkHasFeatureByPlatform)({desktopFeature:s.Feature.cartWebpageDetectionEnabledDesktopBrowserExtension,mobileFeature:s.Feature.cartWebpageDetectionEnabledMobileBrowserExtension})];case 1:return r.sent()?[4,(0,s.getSetting)(s.SettingKey.cartWebpageDetectionSettings)]:[2,{isCartWebpage:!1}];case 2:return t=r.sent(),(n=d(e,t))?[2,{isCartWebpage:!0,matchData:n}]:[2,{isCartWebpage:!1}]}}))}))};var d=(0,i.throttle)((function(e,t){return(null==t?void 0:t.url)?(0,c.getWebpageMatchData)({currentUrl:e,detectionRegexes:{url:t.url}}):void 0}),2e3,{leading:!0,trailing:!0});t.logBrowsedToCartWebpageEvents=function(e){var t=e.webpageUrl,n=e.matchData,o=e.offerId,a=e.urlChangeMessageReceivedTimestampInMs;if(n){var i=r(r({webpageUrl:t,offerId:o},n),{urlChangeMessageReceivedTimestampInMs:a});(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browsedToCartWebpage",active:!1,payload:i}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Browsed To Cart Webpage",properties:i}}})}}},14997:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.logBrowsedToCheckoutWebpageEvents=t.checkIsCheckoutWebpageAndGetMatchData=void 0;var i=n(2543),s=n(55015),l=n(7444),u=n(46239),c=n(1857),d=["input","label","iframe"],f=["name","id","for","data-shortname","placeholder","onautocomplete","autocomplete"],p=new Set(["cc-name","cc-given-name","cc-additional-name","cc-family-name","cc-number","cc-exp","cc-exp-month","cc-exp-year","cc-csc","cc-type"]);t.checkIsCheckoutWebpageAndGetMatchData=function(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return[4,(0,l.checkHasFeatureByPlatform)({desktopFeature:s.Feature.bnplCheckoutDetectionEnabledDesktopBrowserExtension,mobileFeature:s.Feature.bnplCheckoutDetectionEnabledMobileBrowserExtension})];case 1:return r.sent()?[4,(0,s.getSetting)(s.SettingKey.bnplCheckoutRegexes)]:[2,{isCheckoutWebpage:!1}];case 2:return t=r.sent(),(n=g(e,t))?[2,{isCheckoutWebpage:!0,matchData:n}]:[2,{isCheckoutWebpage:!1}]}}))}))};var g=(0,i.throttle)((function(e,t){return function(e){return!(!(null==e?void 0:e.url)||!e.attributeValue)}(t)?(0,c.getWebpageMatchData)({currentUrl:e,detectionRegexes:t,tagNamesToCheck:d,attributesToCheck:f,standardAttributeValuesToCheck:p}):void 0}),2e3,{leading:!0,trailing:!0});t.logBrowsedToCheckoutWebpageEvents=function(e){var t=e.webpageUrl,n=e.matchData,o=e.offerId,a=e.urlChangeMessageReceivedTimestampInMs;if(n){var i=r(r({webpageUrl:t,offerId:o},n),{urlChangeMessageReceivedTimestampInMs:a});(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browsedToCheckoutWebpage",active:!1,payload:i}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Browsed To Checkout Webpage",properties:i}}})}}},20994:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.logBrowsedToPaymentConfirmationWebpageEvents=t.checkIsPaymentConfirmationWebpageAndGetMatchData=t.handlePaymentConfirmationWebpage=void 0;var i=n(2543),s=n(55015),l=n(46239),u=n(1857);t.handlePaymentConfirmationWebpage=function(e,t){return o(this,void 0,void 0,(function(){var n,r,o;return a(this,(function(a){switch(a.label){case 0:return t?[4,d(e)]:[2];case 1:return n=a.sent(),r=n.isPaymentConfirmationWebpage,o=n.matchData,r&&p(e,t.offerId,o),[2]}}))}))};var c=["title"];function d(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return[4,(0,s.getSetting)(s.SettingKey.paymentConfirmationWebpageDetectionRegexes)];case 1:return t=r.sent(),(n=f(e,t))?[2,{isPaymentConfirmationWebpage:!0,matchData:n}]:[2,{isPaymentConfirmationWebpage:!1}]}}))}))}t.checkIsPaymentConfirmationWebpageAndGetMatchData=d;var f=(0,i.throttle)((function(e,t){return function(e){return!!(e&&e.url&&e.innerHtmlValue)}(t)?(0,u.getWebpageMatchData)({currentUrl:e,detectionRegexes:t,tagNamesToCheck:c,shouldCheckInnerHtml:!0}):void 0}),2e3,{leading:!0,trailing:!0});function p(e,t,n){if(n){var o=r({webpageUrl:e,offerId:t},n);(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browsedToPaymentConfirmationWebpage",active:!1,payload:o}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browsed To Payment Confirmation Webpage",properties:o}}})}}t.logBrowsedToPaymentConfirmationWebpageEvents=p},1857:function(e,t,n){var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.getWebpageMatchData=void 0;var a=n(33252);function i(e,t,n,i){var s,u,c,d,f,p;if(n.attributeValue){var g=(0,a.getElementsAttributesByTagName)(e,t);try{for(var v=r(g),h=v.next();!h.done;h=v.next()){var m=h.value;try{for(var y=(c=void 0,r(Object.entries(m))),b=y.next();!b.done;b=y.next()){var w=o(b.value,2),S=w[0],E=w[1];if(E){if(i&&i.has(E))return{matchType:"attribute",matchingRegex:E,regexMatchResult:{tagName:e,attributeName:S,matchingTarget:E}};try{for(var k=(f=void 0,r(Object.values(n.attributeValue))),D=k.next();!D.done;D=k.next()){var W=l(E,D.value);if(W)return{matchType:"attribute",matchingRegex:W.matchingRegex,regexMatchResult:{tagName:e,attributeName:S,matchingTarget:W.matchingTarget}}}}catch(e){f={error:e}}finally{try{D&&!D.done&&(p=k.return)&&p.call(k)}finally{if(f)throw f.error}}}}}catch(e){c={error:e}}finally{try{b&&!b.done&&(d=y.return)&&d.call(y)}finally{if(c)throw c.error}}}}catch(e){s={error:e}}finally{try{h&&!h.done&&(u=v.return)&&u.call(v)}finally{if(s)throw s.error}}}}function s(e,t){var n,o;if(t.innerHtmlValue){var i=(0,a.getElementsInnerHtmlByTagName)(e);try{for(var s=r(i),u=s.next();!u.done;u=s.next()){var c=u.value;if(c){var d=l(c,t.innerHtmlValue);if(d)return{matchType:"innerHtml",matchingRegex:d.matchingRegex,regexMatchResult:{tagName:e,attributeName:"innerHtml",matchingTarget:d.matchingTarget}}}}}catch(e){n={error:e}}finally{try{u&&!u.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}}}function l(e,t){var n,o;if(t)try{for(var a=r(t),i=a.next();!i.done;i=a.next()){var s=i.value;try{var l=e.match(new RegExp(s,"i"));if(l&&l[0])return{matchingRegex:s,matchingTarget:l[0].slice(0,50)}}catch(e){}}}catch(e){n={error:e}}finally{try{i&&!i.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}}t.getWebpageMatchData=function(e){var t,n,o,a,u=e.currentUrl,c=e.detectionRegexes,d=e.tagNamesToCheck,f=e.attributesToCheck,p=e.standardAttributeValuesToCheck,g=e.shouldCheckInnerHtml,v=function(e,t){if(!t.url)return;var n=l(e,t.url);return n?{matchType:"url",matchingRegex:n.matchingRegex}:void 0}(u,c);if(v)return v;if(d&&f)try{for(var h=r(d),m=h.next();!m.done;m=h.next()){var y=i(m.value,f,c,p);if(y)return y}}catch(e){t={error:e}}finally{try{m&&!m.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}if(d&&g)try{for(var b=r(d),w=b.next();!w.done;w=b.next()){var S=s(w.value,c);if(S)return S}}catch(e){o={error:e}}finally{try{w&&!w.done&&(a=b.return)&&a.call(b)}finally{if(o)throw o.error}}}},22794:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useAlternativeOffersWidgetInnerState=t.displayAlternativeOffersWidgetAndLogUserEvent=t.basicChecksCanDisplayAlternativeOffersWidget=t.checkCanDisplayAlternativeOffersWidget=t.MAX_NUMBER_OF_ALTERNATIVE_OFFERS_DISPLAYED_IN_ALTERNATIVE_OFFERS_WIDGET=t.DEFAULT_ALTERNATIVE_OFFERS_WIDGET_DISPLAY_COOLDOWN_IN_HOURS=void 0;var l=s(n(96540)),u=s(n(40961)),c=n(55015),d=n(7444),f=n(17621),p=n(62849),g=n(77653),v=n(32668),h=n(26368),m=n(31229),y=n(46239),b=n(22991),w=n(23081),S=n(74617),E=n(71145),k=n(94700),D=s(n(40549)),W=s(n(52954));function I(e){var t,n,r,o,a;if(e.type!==c.OfferType.NoCashback||!(null===(t=e.alternativeOffersIds)||void 0===t?void 0:t.length))return!1;var i=(0,v.checkIsOnMobileScreen)();return!(i&&!(null===(r=null===(n=e.browserExtension)||void 0===n?void 0:n.mobileVersion)||void 0===r?void 0:r.displayAlternativeOffersWidget)||!i&&!(null===(a=null===(o=e.browserExtension)||void 0===o?void 0:o.desktopVersion)||void 0===a?void 0:a.displayAlternativeOffersWidget))}function C(e){return o(this,void 0,void 0,(function(){var n,r;return a(this,(function(o){switch(o.label){case 0:return[4,(0,c.getSetting)(c.SettingKey.alternativeOffersWidgetDisplayCooldownInHours)];case 1:return n=o.sent()||t.DEFAULT_ALTERNATIVE_OFFERS_WIDGET_DISPLAY_COOLDOWN_IN_HOURS,[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.alternativeOffersWidgetLastClosedInSessionTimestampMsMap)];case 2:return[2,!!((null==(r=o.sent())?void 0:r[e.offerId])&&Date.now()-r[e.offerId]<60*n*60*1e3)]}}))}))}t.DEFAULT_ALTERNATIVE_OFFERS_WIDGET_DISPLAY_COOLDOWN_IN_HOURS=48,t.MAX_NUMBER_OF_ALTERNATIVE_OFFERS_DISPLAYED_IN_ALTERNATIVE_OFFERS_WIDGET=2,t.checkCanDisplayAlternativeOffersWidget=function(e){return o(this,void 0,void 0,(function(){var t,n,r;return a(this,(function(o){switch(o.label){case 0:return I(e)?[4,(0,d.checkHasFeatureByPlatform)({desktopFeature:c.Feature.alternativeOffersWidgetDesktopBrowserExtension,mobileFeature:c.Feature.alternativeOffersWidgetMobileBrowserExtension})]:[2,!1];case 1:return o.sent()?document.getElementById((0,f.getHashedElementId)(f.JokoExtensionRootElement.alternativeOffersWidget))?[2,!1]:[4,Promise.all([C(e),(0,E.checkShouldStandDownOnWebpage)(null==e?void 0:e.offerId)])]:[2,!1];case 2:return t=i.apply(void 0,[o.sent(),2]),n=t[0],r=t[1],[2,!n&&!r]}}))}))},t.basicChecksCanDisplayAlternativeOffersWidget=I,t.displayAlternativeOffersWidgetAndLogUserEvent=function(e,t){var n;return o(this,void 0,void 0,(function(){var o,i,s,p;return a(this,(function(a){switch(a.label){case 0:return[4,(0,d.getUserFeaturesMapWithTimeout)()];case 1:return o=a.sent(),(null===(n=e.currentWebpageOffer.alternativeOffersIds)||void 0===n?void 0:n.length)?[4,(0,g.getMerchantOffersWithConditionsAndCouponsFromOfferIds)(e.currentWebpageOffer.alternativeOffersIds)]:[3,3];case 2:return s=a.sent()||[],[3,4];case 3:s=[],a.label=4;case 4:return 0===(i=s).length||((p=document.createElement("div")).id=(0,f.getHashedElementId)(f.JokoExtensionRootElement.alternativeOffersWidget),document.documentElement.appendChild(p),u.default.render(l.default.createElement(D.default,null,l.default.createElement(c.LocalesContextProvider,null,l.default.createElement(c.FeaturesContextProvider,{initialUserFeaturesMap:o},l.default.createElement(W.default,r({},e,{alternativeOffers:i}))))),p),function(e,t){var n=e.offerId,o=e.type,a=e.alternativeOffersIds,i=(0,c.getCurrentUrlHostname)(),s=r({widgetType:"alternativeOffers",widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:i,currentWebpageOfferId:n,currentWebpageOfferType:o,alternativeOffersIds:a},t);(0,y.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:s}}}),(0,y.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Displayed",properties:s}}})}(e.currentWebpageOffer,t)),[2]}}))}))},t.useAlternativeOffersWidgetInnerState=function(e){var n=this,r=e.currentWebpageOffer,i=e.alternativeOffers,s=e.userOfferActivationInfo,u=(0,p.useExtensionType)(),d=(0,m.useIsTemporaryUser)(),f=!!(0,w.useIsBnplSectionEnabledForOffer)(r),g=(0,k.useWidgetDisplay)(),E=g.isWidgetDisplayed,D=g.closeWidget,W=g.onWidgetInnerStateLoadEnd,I=(0,c.useUserRegion)(),C=l.default.useCallback((function(){return o(n,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.alternativeOffersWidgetLastClosedInSessionTimestampMsMap,(e={},e[r.offerId]=Date.now(),e))];case 1:return t.sent(),function(e,t){var n={widgetType:"alternativeOffers",offerId:e.offerId,offerType:e.type,isTemporaryUser:t};(0,y.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:n}}}),(0,y.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Closed",properties:n}}})}(r,d),D(),[2]}}))}))}),[D,r,d]),T=(0,b.useOnClickAlternativeOffer)({currentWebpageOfferId:r.offerId,userInterfaceComponentInteractionEventType:c.UserInterfaceComponentInteractionEventType.alternativeOffersWidgetBrowsedAlternativeOffer}),O=function(e){var n=this,r=e.currentWebpageOffer,i=e.alternativeOffers,s=e.closeWidget,u=e.isTemporaryUser,d=e.userOfferActivationInfo,f=e.isBnplSectionEnabledForCurrentWebpageOffer;return l.default.useCallback((function(){return o(n,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return(0,S.displayPanelAndLogEvents)({offer:r,userOfferActivationInfo:d,defaultPanelLocationOverride:{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.cashback},bnpl:{isBnplSectionEnabledForOffer:f},isTemporaryUser:u},"alternativeOffersWidget"),[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.alternativeOffersWidgetLastClosedInSessionTimestampMsMap,(e={},e[r.offerId]=Date.now(),e))];case 1:return n.sent(),function(e){var n=e.currentWebpageOffer,r=e.alternativeOffers,o={currentWebpageOfferId:n.offerId,displayedAlternativeOffersIdsInWidget:null==r?void 0:r.map((function(e){return e.offerId})).slice(0,t.MAX_NUMBER_OF_ALTERNATIVE_OFFERS_DISPLAYED_IN_ALTERNATIVE_OFFERS_WIDGET)};(0,y.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedShowMoreAlternativeOffers",payload:o}}}),(0,y.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Offers - Clicked Show More Alternative Offers",properties:o}}})}({currentWebpageOffer:r,alternativeOffers:i}),setTimeout((function(){return s()}),1e3*h.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS),[2]}}))}))}),[r,s])}({currentWebpageOffer:r,alternativeOffers:i,closeWidget:D,isTemporaryUser:d,userOfferActivationInfo:s,isBnplSectionEnabledForCurrentWebpageOffer:f}),P=(0,v.checkIsOnMobileScreen)(),A=(0,c.useHasFeatureByPlatform)({isMobileExtension:P,desktopFeature:c.Feature.alternativeOffersInPanelDesktopBrowserExtension,mobileFeature:c.Feature.alternativeOffersInPanelMobileBrowserExtension});return l.default.useEffect((function(){W()}),[]),{isWidgetDisplayed:E,userRegion:I,onClickWidgetHeaderCloseButton:C,closeWidget:D,extensionType:u,onClickAlternativeOffer:T,isDisplayAlternativeOffersInPanelAppFeatureEnabled:A,onClickShowMoreAlternativeOffersButton:O}}},2321:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return a(t,e),t},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},l=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkCanDisplayCardReadyWidget=t.displayBnplCardReadyWidget=void 0;var c=i(n(96540)),d=u(n(40961)),f=n(55015),p=n(7444),g=n(17621),v=n(46239),h=n(13897),m=u(n(77807)),y=u(n(40549));t.displayBnplCardReadyWidget=function(e,t){return s(this,void 0,void 0,(function(){var n,o;return l(this,(function(a){switch(a.label){case 0:return(n=document.createElement("div")).id=(0,g.getHashedElementId)(g.JokoExtensionRootElement.bnplCardReadyWidget),document.documentElement.appendChild(n),[4,(0,p.getUserFeaturesMapWithTimeout)()];case 1:return o=a.sent(),d.default.render(c.createElement(y.default,null,c.createElement(f.LocalesContextProvider,null,c.createElement(f.FeaturesContextProvider,{initialUserFeaturesMap:o},c.createElement(h.BnplNavigationContextProvider,r({isCardReadyWidget:!0},{offer:e}),c.createElement(m.default,r({},{offer:e,userBnplTransactionCreatedAt:t})))))),n),function(e){var t=(0,f.getCurrentUrlHostname)(),n={widgetType:"bnplCardReady",offerId:e.offerId,widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:t};(0,v.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:n}}}),(0,v.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Displayed",properties:n}}})}(e),[2]}}))}))},t.checkCanDisplayCardReadyWidget=function(){return s(this,void 0,void 0,(function(){return l(this,(function(e){switch(e.label){case 0:return[4,(0,f.checkHasFeature)(f.Feature.bnplNewCardReadyDisplayInExtensions)];case 1:return e.sent()?[2,!1]:[2,new Promise((function(e){return(0,v.sendMessageToBackgroundScript)({message:"checkCanDisplayCardReadyWidget"},(function(t){return e(!!(null==t?void 0:t.canDisplayCardReadyWidget))}))}))]}}))}))}},59003:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.displayBnplSubscriptionWidget=void 0;var l=s(n(96540)),u=s(n(40961)),c=n(55015),d=n(7444),f=n(17621),p=n(68134),g=n(46239),v=n(13897),h=s(n(20989)),m=s(n(40549));t.displayBnplSubscriptionWidget=function(e){var t=e.offer,n=e.isFromBnplSuggestionAtCheckoutWidget,s=void 0!==n&&n,y=e.unfinishedBnplSubscriptionState;return o(this,void 0,void 0,(function(){var e,n,o,b,w;return a(this,(function(a){switch(a.label){case 0:return c.browserKind===c.Browser.mobileAppWebView?[3,2]:((e=document.createElement("div")).id=(0,f.getHashedElementId)(f.JokoExtensionRootElement.bnplSubscriptionWidget),document.documentElement.appendChild(e),[4,Promise.all([(0,d.getUserFeaturesMapWithTimeout)(),(0,p.getTabId)()])]);case 1:return n=i.apply(void 0,[a.sent(),2]),o=n[0],b=n[1],w=!!y,u.default.render(l.default.createElement(m.default,null,l.default.createElement(c.LocalesContextProvider,null,l.default.createElement(c.FeaturesContextProvider,{initialUserFeaturesMap:o},l.default.createElement(v.BnplNavigationContextProvider,r({},{offer:t,isFromBnplSuggestionAtCheckoutWidget:s,unfinishedBnplSubscriptionState:y,tabId:b}),l.default.createElement(h.default,r({},{wasUnfinishedBnplSubscriptionResumed:w})))))),e),function(e){var t=(0,c.getCurrentUrlHostname)(),n={widgetType:"bnplSubscription",offerId:e.offerId,widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:t};(0,g.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:n}}}),(0,g.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Displayed",properties:n}}})}(t),[3,3];case 2:window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify({messageId:"startBnplFlow"})),a.label=3;case 3:return[2]}}))}))}},29491:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.displayBnplSuggestionAtCheckoutWidget=t.handleBnplSuggestionAtCheckoutWidgetDisplayDecision=void 0;var l=s(n(96540)),u=s(n(40961)),c=s(n(95093)),d=n(55015),f=n(14568),p=n(7444),g=n(17621),v=n(32668),h=n(84159),m=n(31229),y=n(643),b=n(46239),w=n(71145),S=n(72886),E=s(n(11849)),k=s(n(40549));function D(e){return o(this,void 0,void 0,(function(){var t,n,r,o,s,l,u,c,g;return a(this,(function(a){switch(a.label){case 0:return[4,new Promise((function(e){return setTimeout(e,1e3)}))];case 1:return a.sent(),(n=e&&e.merchantId===y.AMAZON_MERCHANT_ID)?[4,(0,p.checkHasFeatureByPlatform)({mobileFeature:d.Feature.bnplEmbeddedAmazonBnplButtonMobileBrowserExtension})]:[3,3];case 2:n=a.sent(),a.label=3;case 3:return(t=n)?[4,(0,p.checkHasFeatureByPlatform)({mobileFeature:d.Feature.bnplEmbeddedAmazonBnplButtonWithBnplCheckoutOptionWidget})]:[3,5];case 4:t=!a.sent(),a.label=5;case 5:return t?[2,!1]:(0,f.checkIsBnplEnabledForOffer)(e)?[4,Promise.all([(0,h.checkIsExtensionSnoozed)(),(0,f.checkIsBnplEnabled)(),W(),I(e.offerId),C(e.offerId),(0,w.checkShouldStandDownOnWebpage)(e.offerId)])]:[2,!1];case 6:return r=i.apply(void 0,[a.sent(),6]),o=r[0],s=r[1],l=r[2],u=r[3],c=r[4],g=r[5],[2,!o&&s&&!l&&!u&&!c&&!g]}}))}))}function W(){if(!!document.getElementById((0,g.getHashedElementId)(g.JokoExtensionRootElement.offerWidget))||document.getElementById((0,g.getHashedElementId)(g.JokoExtensionRootElement.bnplSubscriptionWidget))||document.getElementById((0,g.getHashedElementId)(g.JokoExtensionRootElement.bnplSuggestionAtCheckoutWidget))){var e={skippedWidgetType:"bnplSuggestionAtCheckout"};return(0,b.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"skippedBnplWidgetDueToExistingJokoWidget",payload:e}}}),(0,b.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"BNPL - Skipped BNPL Widget Due To Existing Joko Widget",properties:e}}}),!0}return!1}function I(e){return o(this,void 0,void 0,(function(){var t,n,r,o,s,l;return a(this,(function(a){switch(a.label){case 0:return[4,Promise.all([(0,d.getLocalStorageItem)(d.LocalStorageKey.lastDismissedBnplSuggestionAtCheckoutWidgetAt),(0,d.getLocalStorageItem)(d.LocalStorageKey.lastDismissedBnplSuggestionAtCheckoutWidgetTimestampMap)])];case 1:return t=i.apply(void 0,[a.sent(),2]),n=t[0],r=t[1],n&&r?[4,Promise.all([(0,d.getSetting)((0,v.checkIsOnMobileScreen)()?d.SettingKey.bnplMobileBrowserExtensionCheckoutOptionCooldownInSeconds:d.SettingKey.bnplDesktopBrowserExtensionCheckoutOptionCooldownInSeconds),(0,d.getSetting)((0,v.checkIsOnMobileScreen)()?d.SettingKey.bnplMobileBrowserExtensionCheckoutOptionOfferCooldownInSeconds:d.SettingKey.bnplDesktopBrowserExtensionCheckoutOptionOfferCooldownInSeconds)])]:[2,!1];case 2:return o=i.apply(void 0,[a.sent(),2]),s=o[0],l=o[1],(0,c.default)().isBefore(c.default.unix(n+(s||0)))||!(!r[e]||!(0,c.default)().isBefore(c.default.unix(r[e]+(l||0))))?((0,b.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"skippedBnplSuggestionAtCheckoutWidgetDueToCooldown"}}}),(0,b.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"BNPL - Skipped BNPL Suggestion At Checkout Widget Due To Cooldown"}}}),[2,!0]):[2,!1]}}))}))}function C(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(e){return(0,b.sendMessageToBackgroundScript)({message:"checkWasBnplCardCreatedRecently"},(function(t){return e(!!(null==t?void 0:t.wasBnplCardCreatedRecently))}))}))];case 1:return t.sent()?((0,b.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"skippedBnplSuggestionAtCheckoutWidgetDueToCardReady",payload:{offerId:e}}}}),[2,!0]):[2,!1]}}))}))}t.handleBnplSuggestionAtCheckoutWidgetDisplayDecision=function(e){var t=e.isCheckoutWebpage,n=e.offer;return o(this,void 0,void 0,(function(){var e,r;return a(this,(function(o){switch(o.label){case 0:return(r=t)?[4,D(n)]:[3,2];case 1:r=o.sent(),o.label=2;case 2:return e=r,(0,S.submitWidgetDisplayDecision)({widgetName:S.PriorityOrderedWidgetName.bnplSuggestionAtCheckoutWidget,shouldDisplayWidget:e,props:{offer:n}}),[2]}}))}))},t.displayBnplSuggestionAtCheckoutWidget=function(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(i){switch(i.label){case 0:return(t=document.createElement("div")).id=(0,g.getHashedElementId)(g.JokoExtensionRootElement.bnplSuggestionAtCheckoutWidget),document.documentElement.appendChild(t),[4,(0,p.getUserFeaturesMapWithTimeout)()];case 1:return n=i.sent(),u.default.render(l.default.createElement(k.default,null,l.default.createElement(d.LocalesContextProvider,null,l.default.createElement(d.FeaturesContextProvider,{initialUserFeaturesMap:n},l.default.createElement(E.default,r({},{offer:e}))))),t),function(e){o(this,void 0,void 0,(function(){var t,n,r;return a(this,(function(o){switch(o.label){case 0:return t=(0,d.getCurrentUrlHostname)(),r={widgetType:"bnplSuggestionAtCheckout",offerId:e.offerId,widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:t},[4,(0,m.checkIsTemporaryUser)()];case 1:return r.isTemporaryUser=o.sent(),n=r,(0,b.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:n}}}),(0,b.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Displayed",properties:n}}}),[2]}}))}))}(e),[2]}}))}))}},32221:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useCashbackActivationConfirmationWidgetInnerState=t.displayCashbackActivationConfirmationWidget=void 0;var o=r(n(96540)),a=r(n(40961)),i=n(55015),s=n(17621),l=n(46239),u=n(94700),c=r(n(40549)),d=r(n(15764));t.displayCashbackActivationConfirmationWidget=function(e){var t=document.createElement("div");t.id=(0,s.getHashedElementId)(s.JokoExtensionRootElement.cashbackActivationConfirmationWidget),document.documentElement.appendChild(t),a.default.render(o.default.createElement(c.default,null,o.default.createElement(i.LocalesContextProvider,null,o.default.createElement(i.FeaturesContextProvider,null,o.default.createElement(d.default,null)))),t),function(e){var t=(0,i.getCurrentUrlHostname)(),n={widgetType:"cashbackActivationConfirmation",widgetDisplayedTimestampInMs:Date.now(),currentUrlHostname:t,offerId:e};(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:n}}})}(e)};t.useCashbackActivationConfirmationWidgetInnerState=function(){var e=(0,u.useWidgetDisplay)(),t=e.isWidgetDisplayed,n=e.closeWidget,r=e.onWidgetInnerStateLoadEnd,a=o.default.useCallback((function(){var e;e={offerId:void 0,widgetType:"cashbackActivationConfirmation"},(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:e}}}),n()}),[n]);return o.default.useEffect((function(){r(),setTimeout((function(){n()}),2500)}),[]),{isWidgetDisplayed:t,onClickWidgetHeaderCloseButton:a}}},52852:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useCloseWidgetOnOfferActivation=t.useCashbackReactivationAtCheckoutWidgetInnerState=t.displayCashbackReactivationAtCheckoutWidgetAndLogUserEvent=t.handleCashbackReactivationAtCheckoutWidgetDisplayDecision=void 0;var l=s(n(96540)),u=s(n(40961)),c=n(55015),d=n(47248),f=n(7444),p=n(37392),g=n(17621),v=n(62849),h=n(32668),m=n(84159),y=n(26368),b=n(31229),w=n(46239),S=n(69568),E=n(23081),k=n(74617),D=n(71145),W=n(16868),I=n(94700),C=n(72886),T=s(n(40549)),O=s(n(81380));t.handleCashbackReactivationAtCheckoutWidgetDisplayDecision=function(e){var t=e.isCartOrCheckoutWebpage,n=e.offer,r=e.userOfferActivationInfo,i=e.isTemporaryUser;return o(this,void 0,void 0,(function(){var e,o;return a(this,(function(a){switch(a.label){case 0:return(o=t)?[4,A(n)]:[3,2];case 1:o=a.sent(),a.label=2;case 2:return e=o,(0,C.submitWidgetDisplayDecision)({widgetName:C.PriorityOrderedWidgetName.cashbackReactivationAtCheckoutWidget,shouldDisplayWidget:e,props:{offer:n,userOfferActivationInfo:r},additionalPayload:{isTemporaryUser:i}}),[2]}}))}))};var P=60;function A(e){var t;return o(this,void 0,void 0,(function(){var n,r,o,s,l,u,p;return a(this,(function(a){switch(a.label){case 0:return e&&e.type===d.OfferType.Online?[4,(0,v.getExtensionType)()]:[2,!1];case 1:return a.sent()===d.ExtensionType.mobileAppBrowserExtension||_()?[2,!1]:(0,W.checkShouldDisplayCashbackInformationInWidgetForOffer)({offer:e})&&function(e){var t,n,r,o;return!!((0,h.checkIsOnMobileScreen)()?null===(n=null===(t=e.browserExtension)||void 0===t?void 0:t.mobileVersion)||void 0===n?void 0:n.displayCashbackWidget:null===(o=null===(r=e.browserExtension)||void 0===r?void 0:r.desktopVersion)||void 0===o?void 0:o.displayCashbackWidget)}(e)?[4,(0,f.checkHasFeatureByPlatform)({desktopFeature:c.Feature.cashbackReactivationAtCheckoutWidgetDesktopBrowserExtension,mobileFeature:c.Feature.cashbackReactivationAtCheckoutWidgetMobileBrowserExtension})]:[2,!1];case 2:return a.sent()?[4,(0,c.getSetting)(d.SettingKey.maximumDelayForConsideringOfferAsActivatedVeryRecentlyInSeconds)]:[2,!1];case 3:return n=null!==(t=a.sent())&&void 0!==t?t:P,[4,Promise.all([(0,m.checkIsExtensionSnoozed)(),(0,S.checkWasOfferActivatedRecentlyFromLocalOrSessionStorage)(e),(0,S.checkWasOfferActivatedRecentlyFromLocalOrSessionStorage)(e,1e3*n),x(e),(0,D.checkShouldStandDownOnWebpage)(null==e?void 0:e.offerId)])];case 4:return r=i.apply(void 0,[a.sent(),5]),o=r[0],s=r[1],l=r[2],u=r[3],p=r[4],[2,!o&&s&&!l&&!u&&!p]}}))}))}function _(){return!!document.getElementById((0,g.getHashedElementId)(g.JokoExtensionRootElement.cashbackReactivationAtCheckoutWidget))}var B=1;function x(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return t=60*B*60*1e3,[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.cashbackReactivationAtCheckoutWidgetLastClosedInSessionTimestampMsMap)];case 1:return[2,!!(n=r.sent())&&!!n[e.offerId]&&Date.now()-n[e.offerId]<t]}}))}))}t.displayCashbackReactivationAtCheckoutWidgetAndLogUserEvent=function(e,t){if(!_()){var n=document.createElement("div");n.id=(0,g.getHashedElementId)(g.JokoExtensionRootElement.cashbackReactivationAtCheckoutWidget),document.documentElement.appendChild(n),u.default.render(l.default.createElement(T.default,null,l.default.createElement(c.LocalesContextProvider,null,l.default.createElement(c.FeaturesContextProvider,null,l.default.createElement(O.default,r({},e))))),n),function(e){var t=e.offer,n=e.additionalPayload,o=(0,c.getCurrentUrlHostname)(),a=t.offerId,i=t.type,s=r({widgetType:"cashbackReactivationAtCheckout",offerId:a,widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:o,offerType:i},n);(0,w.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:s}}})}({offer:e.offer,additionalPayload:t})}},t.useCashbackReactivationAtCheckoutWidgetInnerState=function(e){var t=this,n=e.offer,r=e.userOfferActivationInfo,i=(0,I.useWidgetDisplay)(),s=i.isWidgetDisplayed,u=i.closeWidget,f=i.onWidgetInnerStateLoadEnd,p=(0,c.useUserRegion)(),g=(0,b.useIsTemporaryUser)(),v=(0,E.useIsBnplSectionEnabledForOffer)(n),h=l.default.useCallback((function(){return o(t,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.cashbackReactivationAtCheckoutWidgetLastClosedInSessionTimestampMsMap,(e={},e[n.offerId]=Date.now(),e))];case 1:return t.sent(),M(n,g),u(),[2]}}))}))}),[u,n,g]),m=function(e,t,n,r,o){return l.default.useCallback((function(){void 0!==r&&((0,k.displayPanelAndLogEvents)({offer:e,userOfferActivationInfo:t,defaultPanelLocationOverride:{panelTab:d.PanelTab.offerDetails,offerDetailsSection:d.OfferDetailsSection.cashback},bnpl:{isBnplSectionEnabledForOffer:r},isTemporaryUser:o},"cashbackReactivationAtCheckoutWidget"),setTimeout((function(){return n()}),1e3*y.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS))}),[e,n,r])}(n,r,u,v,g);return l.default.useEffect((function(){f()}),[]),{isWidgetDisplayed:s,userRegion:p,isTemporaryUser:g,onClickWidgetCloseButton:h,onClickOfferConditionsButton:m,closeWidget:u}},t.useCloseWidgetOnOfferActivation=function(e){var t=this,n=e.offer,r=e.isTemporaryUser,i=e.closeWidget,s=function(){return o(t,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.cashbackReactivationAtCheckoutWidgetLastClosedInSessionTimestampMsMap,(e={},e[n.offerId]=Date.now(),e))];case 1:return t.sent(),M(n,r,!0),i(),[2]}}))}))};l.default.useEffect((function(){var e=(0,p.setJokoDomEventListener)(p.JokoDomEvent.onOfferActivated,(function(){return setTimeout(s,1e3)}));return function(){(0,p.removeJokoDomEventListener)(p.JokoDomEvent.onOfferActivated,e)}}),[])};var M=function(e,t,n){var r={widgetType:"cashbackReactivationAtCheckout",offerId:e.offerId,offerType:e.type,isTemporaryUser:t,isAutomaticallyClosedAfterOfferActivation:n};(0,w.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:r}}})}},10518:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useCashbackReminderWidgetInnerState=t.CashbackReminderWidgetVariants=t.displayCashbackReminderWidgetAndLogUserEvent=t.handleCashbackReminderWidgetDisplayDecision=void 0;var l=s(n(96540)),u=s(n(40961)),c=n(55015),d=n(47248),f=n(7444),p=n(17621),g=n(62849),v=n(32668),h=n(84159),m=n(26368),y=n(31229),b=n(46239),w=n(69568),S=n(23081),E=n(74617),k=n(71145),D=n(16868),W=n(94700),I=n(72886),C=s(n(40549)),T=s(n(80550));function O(e){return o(this,void 0,void 0,(function(){var t,n,r,o,s;return a(this,(function(a){switch(a.label){case 0:return e&&e.type===d.OfferType.Online?[4,(0,g.getExtensionType)()]:[2,!1];case 1:return a.sent()===d.ExtensionType.mobileAppBrowserExtension||P()?[2,!1]:(0,D.checkShouldDisplayCashbackInformationInWidgetForOffer)({offer:e})&&function(e){var t,n,r,o;return!!((0,v.checkIsOnMobileScreen)()?null===(n=null===(t=e.browserExtension)||void 0===t?void 0:t.mobileVersion)||void 0===n?void 0:n.displayCashbackReminderWidget:null===(o=null===(r=e.browserExtension)||void 0===r?void 0:r.desktopVersion)||void 0===o?void 0:o.displayCashbackReminderWidget)}(e)?[4,Promise.all([(0,h.checkIsExtensionSnoozed)(),(0,w.checkWasOfferActivatedRecentlyFromLocalOrSessionStorage)(e),A(e),(0,k.checkShouldStandDownOnWebpage)(null==e?void 0:e.offerId)])]:[2,!1];case 2:return t=i.apply(void 0,[a.sent(),4]),n=t[0],r=t[1],o=t[2],s=t[3],[2,!(n||r||o||s)]}}))}))}function P(){return!!document.getElementById((0,p.getHashedElementId)(p.JokoExtensionRootElement.cashbackReminderWidget))}function A(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return t=36e5*c.DEFAULT_OFFER_WIDGET_DISPLAY_COOLDOWN_IN_HOURS,[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.cashbackReminderWidgetLastClosedInSessionTimestampMsMap)];case 1:return[2,!!(n=r.sent())&&!!n[e.offerId]&&Date.now()-n[e.offerId]<t]}}))}))}t.handleCashbackReminderWidgetDisplayDecision=function(e){var t=e.isCartOrCheckoutWebpage,n=e.offer,r=e.userOfferActivationInfo,i=e.isTemporaryUser;return o(this,void 0,void 0,(function(){var e,o;return a(this,(function(a){switch(a.label){case 0:return(o=t)?[4,O(n)]:[3,2];case 1:o=a.sent(),a.label=2;case 2:return e=o,(0,I.submitWidgetDisplayDecision)({widgetName:I.PriorityOrderedWidgetName.cashbackReminderWidget,shouldDisplayWidget:e,props:{offer:n,userOfferActivationInfo:r},additionalPayload:{isTemporaryUser:i}}),[2]}}))}))};var _;t.displayCashbackReminderWidgetAndLogUserEvent=function(e,t){return o(this,void 0,void 0,(function(){var n,o,i;return a(this,(function(a){switch(a.label){case 0:return[4,(0,f.getUserFeaturesMapWithTimeout)(200)];case 1:return n=a.sent(),o=function(e,t){if(e.type!==d.OfferType.Online)return _.legacyCashbackReminderWidget;var n=(0,v.checkIsOnMobileScreen)();return!n&&(null==t?void 0:t[c.Feature.simplifiedCashbackReminderWidget6BDesktopBrowserExtension])||n&&(null==t?void 0:t[c.Feature.simplifiedCashbackReminderWidget6BMobileBrowserExtension])?_.cashbackReminderWidgetWithGreySecondaryCta:_.defaultCashbackReminderWidget}(e.offer,n),P()?[2]:((i=document.createElement("div")).id=(0,p.getHashedElementId)(p.JokoExtensionRootElement.cashbackReminderWidget),document.documentElement.appendChild(i),u.default.render(l.default.createElement(C.default,null,l.default.createElement(c.LocalesContextProvider,null,l.default.createElement(c.FeaturesContextProvider,{initialUserFeaturesMap:n},l.default.createElement(T.default,r({},e,{widgetVariant:o}))))),i),function(e){var t=e.offer,n=e.widgetVariant,o=e.additionalPayload,a=(0,c.getCurrentUrlHostname)(),i=t.offerId,s=t.type,l=r({widgetType:"cashbackReminder",widgetVariant:n,offerId:i,widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:a,offerType:s},o);(0,b.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:l}}})}({offer:e.offer,widgetVariant:o,additionalPayload:t}),[2])}}))}))},function(e){e.legacyCashbackReminderWidget="legacyCashbackReminderWidget",e.defaultCashbackReminderWidget="defaultCashbackReminderWidget",e.cashbackReminderWidgetWithGreySecondaryCta="cashbackReminderWidgetWithGreySecondaryCta"}(_=t.CashbackReminderWidgetVariants||(t.CashbackReminderWidgetVariants={})),t.useCashbackReminderWidgetInnerState=function(e){var t=this,n=e.offer,r=e.userOfferActivationInfo,i=e.closeButtonDisplayedText,s=(0,W.useWidgetDisplay)(),u=s.isWidgetDisplayed,f=s.closeWidget,p=s.onWidgetInnerStateLoadEnd,g=(0,c.useUserRegion)(),v=(0,y.useIsTemporaryUser)(),h=(0,S.useIsBnplSectionEnabledForOffer)(n),w=l.default.useCallback((function(){return o(t,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.cashbackReminderWidgetLastClosedInSessionTimestampMsMap,(e={},e[n.offerId]=Date.now(),e))];case 1:return t.sent(),function(e,t,n){var r={offerId:e.offerId,offerType:e.type,isTemporaryUser:t,closeButtonDisplayedText:n,widgetType:"cashbackReminder"};(0,b.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:r}}}),(0,b.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Closed",properties:r}}})}(n,v,i),f(),[2]}}))}))}),[f,n,v]),k=function(e,t,n,r,o){return l.default.useCallback((function(){void 0!==r&&((0,E.displayPanelAndLogEvents)({offer:e,userOfferActivationInfo:t,defaultPanelLocationOverride:{panelTab:d.PanelTab.offerDetails,offerDetailsSection:d.OfferDetailsSection.cashback},bnpl:{isBnplSectionEnabledForOffer:r},isTemporaryUser:o},"cashbackReminderWidget"),setTimeout((function(){return n()}),1e3*m.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS))}),[e,n,r])}(n,r,f,h,v);return l.default.useEffect((function(){p()}),[]),{isWidgetDisplayed:u,userRegion:g,onClickWidgetCloseButton:w,onClickOfferConditionsButton:k,closeWidget:f}}},75614:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useCashbackTrackingLostWidgetInnerState=t.displayCashbackTrackingLostWidgetAndLogUserEvent=t.checkWasCashbackOfferActivationOverriddenByCompetitorRecently=t.checkCanDisplayCashbackTrackingLostWidget=t.handleCashbackTrackingLostWidgetDisplay=void 0;var l=s(n(96540)),u=s(n(40961)),c=s(n(95093)),d=n(55015),f=n(47248),p=n(7444),g=n(17621),v=n(62849),h=n(84159),m=n(26368),y=n(31229),b=n(46239),w=n(69568),S=n(23081),E=n(74617),k=n(71145),D=n(94700),W=n(72886),I=s(n(40549)),C=n(98413),T=s(n(33121));function O(e){return o(this,void 0,void 0,(function(){var t,n,r,o,s;return a(this,(function(a){switch(a.label){case 0:return[4,(0,v.getExtensionType)()];case 1:return a.sent()===f.ExtensionType.mobileAppBrowserExtension||P()?[2,!1]:[4,(0,p.checkHasFeatureByPlatform)({desktopFeature:d.Feature.cashbackTrackingLostWidgetDesktopBrowserExtension,mobileFeature:d.Feature.cashbackTrackingLostWidgetMobileBrowserExtension})];case 2:return a.sent()?[4,Promise.all([(0,h.checkIsExtensionSnoozed)(),_(e.offerId),A(e),(0,k.checkShouldStandDownOnWebpage)(null==e?void 0:e.offerId)])]:[2,!1];case 3:return t=i.apply(void 0,[a.sent(),4]),n=t[0],r=t[1],o=t[2],s=t[3],[2,r&&!n&&!o&&!s]}}))}))}function P(){return!!document.getElementById((0,g.getHashedElementId)(g.JokoExtensionRootElement.cashbackTrackingLostWidget))}function A(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return t=36e5*d.DEFAULT_OFFER_WIDGET_DISPLAY_COOLDOWN_IN_HOURS,[4,(0,d.getLocalStorageItem)(d.LocalStorageKey.cashbackTrackingLostWidgetLastClosedInSessionTimestampMsMap)];case 1:return[2,!!(null==(n=r.sent())?void 0:n[e.offerId])&&Date.now()-n[e.offerId]<t]}}))}))}function _(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return e?[4,(0,d.getLocalStorageItem)(d.LocalStorageKey.offerActivatedInSessionTimestampMsMap)]:[2,!1];case 1:return(null==(t=r.sent())?void 0:t[e])?[4,(0,d.getLocalStorageItem)(d.LocalStorageKey.thirdPartyAffiliateLinkLoadingTimestampMsMap)]:[2,!1];case 2:return(null==(n=r.sent())?void 0:n[e])&&(0,c.default)(t[e]).isAfter((0,c.default)().subtract(w.OFFER_ACTIVATION_DURATION_HOURS,"hour"))&&(0,c.default)(t[e]).isBefore(n[e])?[2,!0]:[2,!1]}}))}))}t.handleCashbackTrackingLostWidgetDisplay=function(e,t,n){return o(this,void 0,void 0,(function(){var r;return a(this,(function(o){switch(o.label){case 0:return e&&e.type===f.OfferType.Online?[4,O(e)]:((0,W.submitWidgetDisplayDecision)({widgetName:W.PriorityOrderedWidgetName.cashbackTrackingLostWidget,shouldDisplayWidget:!1}),[2]);case 1:return r=o.sent(),(0,W.submitWidgetDisplayDecision)({widgetName:W.PriorityOrderedWidgetName.cashbackTrackingLostWidget,shouldDisplayWidget:r,props:{offer:e,userOfferActivationInfo:n},additionalPayload:{isTemporaryUser:t}}),[2]}}))}))},t.checkCanDisplayCashbackTrackingLostWidget=O,t.checkWasCashbackOfferActivationOverriddenByCompetitorRecently=_,t.displayCashbackTrackingLostWidgetAndLogUserEvent=function(e,t){if(!P()){(0,C.addOverlayToBackground)(e.offer,null==t?void 0:t.isTemporaryUser);var n=document.createElement("div");n.id=(0,g.getHashedElementId)(g.JokoExtensionRootElement.cashbackTrackingLostWidget),document.documentElement.appendChild(n),u.default.render(l.default.createElement(I.default,null,l.default.createElement(d.LocalesContextProvider,null,l.default.createElement(d.FeaturesContextProvider,null,l.default.createElement(T.default,r({},e))))),n),function(e){var t=e.offer,n=e.additionalPayload,o=(0,d.getCurrentUrlHostname)(),a=t.offerId,i=t.type,s=r({widgetType:"cashbackTrackingLost",offerId:a,widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:o,offerType:i},n);(0,b.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:s}}})}({offer:e.offer,additionalPayload:t})}},t.useCashbackTrackingLostWidgetInnerState=function(e){var t=this,n=e.offer,r=e.userOfferActivationInfo,i=e.closeButtonDisplayedText,s=(0,D.useWidgetDisplay)(),u=s.isWidgetDisplayed,c=s.closeWidget,p=s.onWidgetInnerStateLoadEnd,g=(0,d.useUserRegion)(),v=(0,y.useIsTemporaryUser)(),h=(0,S.useIsBnplSectionEnabledForOffer)(n),w=function(e,t,n,r,o){return function(){void 0!==r&&((0,E.displayPanelAndLogEvents)({offer:e,userOfferActivationInfo:t,defaultPanelLocationOverride:{panelTab:f.PanelTab.offerDetails,offerDetailsSection:f.OfferDetailsSection.cashback},bnpl:{isBnplSectionEnabledForOffer:r},isTemporaryUser:o},"cashbackTrackingLostWidget"),setTimeout((function(){return n()}),1e3*m.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS))}}(n,r,c,h,v);return l.default.useEffect((function(){p()}),[]),{isWidgetDisplayed:u,userRegion:g,onClickWidgetCloseButton:function(){return o(t,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,(0,d.updateLocalStorageItem)(d.LocalStorageKey.cashbackTrackingLostWidgetLastClosedInSessionTimestampMsMap,(e={},e[n.offerId]=Date.now(),e))];case 1:return t.sent(),function(e,t,n){var r={widgetType:"cashbackTrackingLost",offerId:e.offerId,offerType:e.type,isTemporaryUser:t,closeButtonDisplayedText:n};(0,b.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:r}}})}(n,v,i),c(),[2]}}))}))},onClickOfferConditionsButton:w,closeWidget:c}}},23907:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.displayCouponApplicationWidget=t.setLastCouponAutomationResult=t.checkIsCouponsCheckoutWidgetSnoozed=t.CouponAutomationResultType=t.checkShouldDisplayCouponsCheckoutWidgetForOffer=t.displayCouponAutomationProposalWidget=t.CouponAutomationProposalWidgetVariants=t.handleCouponAutomationProposalWidgetDisplay=void 0;var u,c=l(n(96540)),d=l(n(40961)),f=n(55015),p=n(55071),g=n(7444),v=n(17621),h=n(32668),m=n(84159),y=n(50479),b=n(46239),w=n(74617),S=n(71145),E=n(72886),k=l(n(40549)),D=l(n(30297)),W=l(n(68136));t.handleCouponAutomationProposalWidgetDisplay=function(e){(0,E.submitWidgetDisplayDecision)({widgetName:E.PriorityOrderedWidgetName.couponAutomationProposalWidget,shouldDisplayWidget:!0,props:e})},function(e){e.defaultCouponWidget="defaultCouponWidget",e.couponWidgetWithGreySecondaryCta="couponWidgetWithGreySecondaryCta"}(u=t.CouponAutomationProposalWidgetVariants||(t.CouponAutomationProposalWidgetVariants={}));t.displayCouponAutomationProposalWidget=function(e){var t=e.offerId,n=e.selectors,s=e.couponApplicationProcessId,l=i(e,["offerId","selectors","couponApplicationProcessId"]);return o(this,void 0,void 0,(function(){var e,o,i,p,m,b,S;return a(this,(function(a){switch(a.label){case 0:return[4,(0,g.getUserFeaturesMapWithTimeout)(300)];case 1:return e=a.sent(),o=function(e){var t=(0,h.checkIsOnMobileScreen)();return!t&&(null==e?void 0:e[f.Feature.simplifiedCouponWidget1BDesktopBrowserExtension])||t&&(null==e?void 0:e[f.Feature.simplifiedCouponWidget1BMobileBrowserExtension])?u.couponWidgetWithGreySecondaryCta:u.defaultCouponWidget}(e),i=l,[4,T(t)];case 2:return i.lastUsedAtAutoCoupons=a.sent(),document.getElementById((0,v.getHashedElementId)(v.JokoExtensionRootElement.couponAutomationProposalWidget))?[2]:(p=(0,v.getHashedElementId)(v.JokoExtensionRootElement.couponAutomationProposalWidget),m=(0,w.getPanelElement)(),null!==(b=document.getElementById(p))&&b.remove(),(S=document.createElement("div")).id=p,m?document.documentElement.insertBefore(S,m):document.documentElement.appendChild(S),d.default.render(c.default.createElement(k.default,null,c.default.createElement(f.LocalesContextProvider,null,c.default.createElement(f.FeaturesContextProvider,{initialUserFeaturesMap:e},c.default.createElement(W.default,r({},r({offerId:t,widgetVariant:o},l)))))),S),(0,y.logCouponAutomationProposalWidgetDisplayedEvents)(r({offerId:t,selectors:n,couponApplicationProcessId:s,widgetVariant:o},l)),[2])}}))}))};var I,C=500;function T(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return t=new Promise((function(t){return(0,b.sendMessageToBackgroundScript)({message:"getMerchantOfferLastUsedAtAutoCouponsFromAppSync",data:{offerId:e}},(function(e){var n=e.lastUsedAtAutoCoupons;return t(n)}))})),[4,(0,p.wrapPromiseWithTimeout)(t,C)];case 1:return[2,n.sent()]}}))}))}function O(e){var t=e.couponCheckoutWidgetSnoozingDurationsInSeconds,n=function(){try{var e=localStorage.getItem(P);if(!e)return;return JSON.parse(e)}catch(e){return}}();if(!n)return!1;switch(n.type){case I.completed:return Date.now()-n.timestampInMs<1e3*t.afterCompletedCouponApplicationProcess;case I.cancelled:case I.dismissed:return Date.now()-n.timestampInMs<1e3*t.afterClickedOnCross;case I.crashed:return Date.now()-n.timestampInMs<1e3*t.afterCrashedCouponApplicationProcess}}t.checkShouldDisplayCouponsCheckoutWidgetForOffer=function(e){return o(this,void 0,void 0,(function(){var t,n,r;return a(this,(function(o){switch(o.label){case 0:return 0===e.coupons.length||!e.isAutoCouponCheckoutWidgetDisplayEnabled||e.shouldHideAutoCouponCheckoutWidgetDueToLowSuccessRate||O(e)?[2,!1]:[4,Promise.all([(0,m.checkIsExtensionSnoozed)(),(0,S.checkShouldStandDownOnWebpage)(e.offerId)])];case 1:return t=s.apply(void 0,[o.sent(),2]),n=t[0],r=t[1],n||r?[2,!1]:[2,!0]}}))}))},function(e){e.dismissed="dismissed",e.cancelled="cancelled",e.completed="completed",e.crashed="crashed"}(I=t.CouponAutomationResultType||(t.CouponAutomationResultType={})),t.checkIsCouponsCheckoutWidgetSnoozed=O;var P="jokoLastCouponAutomationResult";t.setLastCouponAutomationResult=function(e){localStorage.setItem(P,JSON.stringify(e))},t.displayCouponApplicationWidget=function(e,t){return o(this,void 0,void 0,(function(){var n,o,i,s;return a(this,(function(a){switch(a.label){case 0:return n=(0,v.getHashedElementId)(v.JokoExtensionRootElement.couponApplicationWidget),null!==(o=document.getElementById(n))&&o.remove(),(i=document.createElement("div")).id=n,document.documentElement.appendChild(i),[4,(0,g.getUserFeaturesMapWithTimeout)()];case 1:return s=a.sent(),d.default.render(c.default.createElement(k.default,null,c.default.createElement(f.LocalesContextProvider,null,c.default.createElement(f.FeaturesContextProvider,{initialUserFeaturesMap:s},c.default.createElement(D.default,r({},{initialState:e,hasErrorAtInit:t}))))),i),[2]}}))}))}},16868:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkShouldDisplayCashbackInformationInWidgetForOffer=t.useCloseWidgetOnOfferActivation=t.closeOfferWidgetAndLogEvents=t.useOfferWidgetInnerState=t.OfferWidgetVariants=t.displayOfferWidgetAndLogUserEvent=t.checkWasCashbackOfferActivatedRecently=t.checkCanDisplayOfferWidget=void 0;var l=s(n(96540)),u=s(n(40961)),c=n(55015),d=n(55071),f=n(31814),p=n(7444),g=n(37392),v=n(17621),h=n(62849),m=n(32668),y=n(84159),b=n(26368),w=n(68134),S=n(31229),E=n(21427),k=n(46239),D=n(69568),W=n(23081),I=n(74617),C=n(71145),T=n(94700),O=n(13897),P=s(n(40549)),A=s(n(88500));function _(){return!!document.getElementById((0,v.getHashedElementId)(v.JokoExtensionRootElement.offerWidget))}function B(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return t=36e5*c.DEFAULT_OFFER_WIDGET_DISPLAY_COOLDOWN_IN_HOURS,[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.offerWidgetLastClosedInSessionTimestampMsMap)];case 1:return[2,!!(n=r.sent())&&!!n[e.offerId]&&Date.now()-n[e.offerId]<t]}}))}))}t.checkCanDisplayOfferWidget=function(e){return o(this,void 0,void 0,(function(){var t,n,r,o,s,l;return a(this,(function(a){switch(a.label){case 0:return t=e.type,function(e){var t,n,r,o,a=(0,m.checkIsOnMobileScreen)();return!(e.type!==c.OfferType.Online||(a||(null===(n=null===(t=e.browserExtension)||void 0===t?void 0:t.desktopVersion)||void 0===n?void 0:n.displayCashbackWidget))&&(!a||(null===(o=null===(r=e.browserExtension)||void 0===r?void 0:r.mobileVersion)||void 0===o?void 0:o.displayCashbackWidget)))}(e)||_()||t===c.OfferType.Ongoing?[2,!1]:function(e){var t;return!(null==e?void 0:e.matchingURLRegexes)||!(null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.href)||e.matchingURLRegexes.some((function(e){try{return new RegExp(e).test(window.location.href)}catch(e){return!1}}))}(e)?[4,Promise.all([(0,y.checkIsExtensionSnoozed)(),(0,D.checkWasOfferActivatedRecentlyFromLocalOrSessionStorage)(e),B(e),(0,C.checkShouldStandDownOnWebpage)(null==e?void 0:e.offerId)])]:[2,!1];case 1:return n=i.apply(void 0,[a.sent(),4]),r=n[0],o=n[1],s=n[2],l=n[3],[2,!(r||o||s||l)]}}))}))},t.checkWasCashbackOfferActivatedRecently=function(e,t){return void 0===t&&(t=36e5*D.OFFER_ACTIVATION_DURATION_HOURS),o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.offerActivatedInSessionTimestampMsMap)];case 1:return[2,!!(n=r.sent())&&!!n[e.offerId]&&Date.now()-n[e.offerId]<t]}}))}))};var x;function M(e){var t=e.offer,n=e.isTemporaryUser,r=e.closeButtonDisplayedText,o=e.isAutomaticallyClosedAfterOfferActivation,a={widgetType:"offer",offerId:t.offerId,offerType:t.type,isTemporaryUser:n,closeButtonDisplayedText:r,isAutomaticallyClosedAfterOfferActivation:o};(0,k.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:a}}}),(0,k.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Closed",properties:a}}})}function L(e){var t=e.offer,n=e.isBnplSectionEnabledForOffer,r=e.isMobileExtension,o=e.shouldForceDisplay;return!!n&&(!!o||!(!t.browserExtension||(r?t.browserExtension.mobileVersion&&!1===t.browserExtension.mobileVersion.displayBnplPromotionWidget:t.browserExtension.desktopVersion&&!1===t.browserExtension.desktopVersion.displayBnplPromotionWidget)))}t.displayOfferWidgetAndLogUserEvent=function(e,t){return o(this,void 0,void 0,(function(){var n,o,i,s,f,p,g;return a(this,(function(a){switch(a.label){case 0:o=!1,i=Date.now(),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,(0,d.wrapPromiseWithTimeout)((0,c.getUserFeaturesMap)(),200)];case 2:return n=a.sent(),[3,4];case 3:return s=a.sent(),console.error(s),o=!0,n={},[3,4];case 4:return f=Date.now()-i,p=function(e,t){if(e.type!==c.OfferType.Online)return x.legacyOfferWidget;var n=(0,m.checkIsOnMobileScreen)();return!n&&(null==t?void 0:t[c.Feature.simplifiedCashbackWidget10BDesktopBrowserExtension])||n&&(null==t?void 0:t[c.Feature.simplifiedCashbackWidget10BMobileBrowserExtension])?x.lightRayCtaOfferWidget:x.defaultOfferWidget}(e.offer,n),_()?[2]:((g=document.createElement("div")).id=(0,v.getHashedElementId)(v.JokoExtensionRootElement.offerWidget),document.documentElement.appendChild(g),u.default.render(l.default.createElement(P.default,null,l.default.createElement(c.LocalesContextProvider,null,l.default.createElement(c.FeaturesContextProvider,{initialUserFeaturesMap:n},l.default.createElement(A.default,r({},e,{widgetVariant:p}))))),g),function(e){var t=e.offer,n=e.additionalPayload,o=e.widgetVariant,a=e.userFeatureMapQueryDurationInMs,i=e.hasUserFeaturesMapPromiseTimedOut,s=t.offerId,l=t.type,u=(0,c.getCurrentUrlHostname)(),d=r({widgetType:"offer",offerId:s,widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:u,offerType:l,widgetVariant:o,userFeatureMapQueryDurationInMs:a,hasUserFeaturesMapPromiseTimedOut:i},n);(0,k.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:d}}})}({offer:e.offer,additionalPayload:t,widgetVariant:p,userFeatureMapQueryDurationInMs:f,hasUserFeaturesMapPromiseTimedOut:o}),[2])}}))}))},function(e){e.legacyOfferWidget="legacyOfferWidget",e.defaultOfferWidget="defaultOfferWidget",e.lightRayCtaOfferWidget="lightRayCtaOfferWidget"}(x=t.OfferWidgetVariants||(t.OfferWidgetVariants={})),t.useOfferWidgetInnerState=function(e,t,n,r){var s=this,u=(0,h.useExtensionType)(),d=(0,S.useIsTemporaryUser)(),v=(0,W.useIsBnplSectionEnabledForOffer)(e),y=(0,T.useWidgetDisplay)(),C=y.isWidgetDisplayed,P=y.closeWidget,A=y.onWidgetInnerStateLoadEnd,_=(0,c.useUserRegion)(),B=l.default.useCallback((function(){return o(s,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.offerWidgetLastClosedInSessionTimestampMsMap,(t={},t[e.offerId]=Date.now(),t))];case 1:return n.sent(),M({offer:e,isTemporaryUser:d,closeButtonDisplayedText:r}),P(),(0,g.sendJokoDomEvent)(g.JokoDomEvent.onOfferWidgetClosed,{}),[2]}}))}))}),[P,e,d]),x=l.default.useMemo((function(){return F({offer:e,shouldForceDisplay:n})}),[e]),N=(0,f.useAdBlockerDetectionInOfferWidget)(),H=function(e){var t=e.offer,n=e.userOfferActivationInfo,r=e.closeWidget,s=e.isBnplSectionEnabledForOffer,u=e.isTemporaryUser,d=e.shouldForceDisplay,f=l.default.useMemo(m.checkIsOnMobileScreen,[]),g=i(l.default.useState(void 0),2),v=g[0],h=g[1],y=function(e){var t=this,n=e.offer,r=e.userOfferActivationInfo,i=e.closeWidget,s=e.isBnplSectionEnabledForOffer,u=e.shouldDisplayCouponPromotion,d=e.setShouldDisplayCouponPromotion,f=e.isTemporaryUser,g=e.isMobileExtension,v=e.shouldForceDisplay,h=(0,E.useEnrichedMerchantCoupons)(n),m=l.default.useMemo((function(){if(h)return h.filter((function(e){var t=e.shouldSkip,n=e.isSelectedForReevaluation;return!t||!!n})).length}),[h]),y=l.default.useCallback((function(){return o(t,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return void 0===s?[2]:((0,I.displayPanelAndLogEvents)({offer:n,userOfferActivationInfo:r,defaultPanelLocationOverride:{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.coupons},bnpl:{isBnplSectionEnabledForOffer:s},isTemporaryUser:f},"offerWidget"),R("bnpl",s,u,n,f),n.type===c.OfferType.Online?[3,2]:[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.offerWidgetLastClosedInSessionTimestampMsMap,(e={},e[n.offerId]=Date.now(),e))]);case 1:t.sent(),t.label=2;case 2:return setTimeout((function(){return i()}),1e3*b.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS),[2]}}))}))}),[n,i,s,u,f]),w=(0,p.useAppFeature)(c.Feature.couponsSideButtonTabMobileBrowserExtension);return l.default.useEffect((function(){d(function(e){var t=e.numberOfAvailableCoupons,n=e.isCouponsSectionEnabled,r=e.offer,o=e.isMobileExtension,a=e.shouldForceDisplay,i=t&&t>0&&n;if(!i)return!1;if(a)return!0;var s=!(!r.browserExtension||(o?r.browserExtension.mobileVersion&&!1===r.browserExtension.mobileVersion.displayCouponsPromotionWidget:r.browserExtension.desktopVersion&&!1===r.browserExtension.desktopVersion.displayCouponsPromotionWidget));return s}({numberOfAvailableCoupons:m,isCouponsSectionEnabled:w,offer:n,isMobileExtension:g,shouldForceDisplay:v}))}),[m,w,n,g]),{shouldDisplayCouponPromotion:u,numberOfAvailableCoupons:m,onClickPromotionButton:y,promotionIconBackgroundColor:c.ColorName.magnolia}}({offer:t,userOfferActivationInfo:n,closeWidget:r,isBnplSectionEnabledForOffer:s,shouldDisplayCouponPromotion:v,setShouldDisplayCouponPromotion:h,isTemporaryUser:u,isMobileExtension:f,shouldForceDisplay:d}),w=function(e){var t=this,n=e.offer,r=e.userOfferActivationInfo,i=e.closeWidget,s=e.isBnplSectionEnabledForOffer,u=e.shouldDisplayCouponPromotion,d=e.isTemporaryUser,f=e.isMobileExtension,p=e.shouldForceDisplay,g=l.default.useCallback((function(){return o(t,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return void 0===s?[2]:((0,I.displayPanelAndLogEvents)({offer:n,userOfferActivationInfo:r,defaultPanelLocationOverride:{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.bnpl},bnpl:{isBnplSectionEnabledForOffer:s},isTemporaryUser:d},"offerWidget"),R("bnpl",s,u,n,d),n.type===c.OfferType.Online?[3,2]:[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.offerWidgetLastClosedInSessionTimestampMsMap,(e={},e[n.offerId]=Date.now(),e))]);case 1:t.sent(),t.label=2;case 2:return setTimeout((function(){return i()}),1e3*b.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS),[2]}}))}))}),[n,i,s,u,d]);return{shouldDisplayBnplPromotion:L({offer:n,isBnplSectionEnabledForOffer:s,isMobileExtension:f,shouldForceDisplay:p}),onClickPromotionButton:g,promotionIconBackgroundColor:c.ColorName.athensGray}}({offer:t,userOfferActivationInfo:n,closeWidget:r,isBnplSectionEnabledForOffer:s,shouldDisplayCouponPromotion:v,isTemporaryUser:u,isMobileExtension:f,shouldForceDisplay:d});return{couponPromotionButtonProps:y,bnplPromotionButtonProps:w}}({offer:e,userOfferActivationInfo:t,closeWidget:P,isBnplSectionEnabledForOffer:v,isTemporaryUser:d,shouldForceDisplay:n}),j=H.couponPromotionButtonProps,J=H.bnplPromotionButtonProps,V=function(e,t,n,r,i){var s=this,u=(0,w.useGetTabId)();return l.default.useCallback((function(){return o(s,void 0,void 0,(function(){var o;return a(this,(function(a){switch(a.label){case 0:return void 0===r?[2]:((0,O.removeUnfinishedBnplSubscriptionStateInLocalStorage)(u),(0,I.displayPanelAndLogEvents)({offer:e,userOfferActivationInfo:t,defaultPanelLocationOverride:{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.cashback},bnpl:{isBnplSectionEnabledForOffer:r},isTemporaryUser:i},"offerWidget"),e.type===c.OfferType.Online?[3,2]:[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.offerWidgetLastClosedInSessionTimestampMsMap,(o={},o[e.offerId]=Date.now(),o))]);case 1:a.sent(),a.label=2;case 2:return setTimeout((function(){return n()}),1e3*b.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS),[2]}}))}))}),[e,n,r])}(e,t,P,v,d);return l.default.useEffect((function(){void 0!==j.shouldDisplayCouponPromotion&&void 0!==J.shouldDisplayBnplPromotion&&void 0!==N&&A()}),[j.shouldDisplayCouponPromotion,J.shouldDisplayBnplPromotion,N]),l.default.useEffect((function(){e.type===c.OfferType.OneTime&&function(e){var t=e.offerId,n=Number(localStorage.getItem(U));if(Date.now()-n<3600*D.OFFER_ACTIVATION_DURATION_HOURS*1e3)return;localStorage.setItem(U,Date.now().toString()),(0,k.sendMessageToBackgroundScript)({message:"activateOnetimeOffer",data:{offerId:t,autoActivationMethod:c.AutoActivationMethod.displayedOnetimeOfferWidgetInBrowserExtensions,from:c.ActivatedOfferEventFromParameter.onetimeOfferWidgetInBrowserExtensions}})}(e)}),[e]),{isWidgetDisplayed:C,userRegion:_,isTemporaryUser:d,onClickWidgetHeaderCloseButton:B,shouldShowCashback:x,couponPromotionButtonProps:j,bnplPromotionButtonProps:J,onClickOfferConditionsButton:V,isAdBlockerDetected:N,closeWidget:P,extensionType:u}},t.closeOfferWidgetAndLogEvents=function(e,t,n){return o(this,void 0,void 0,(function(){var r;return a(this,(function(o){switch(o.label){case 0:return[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.offerWidgetLastClosedInSessionTimestampMsMap,(r={},r[e.offerId]=Date.now(),r))];case 1:return o.sent(),M({offer:e,isTemporaryUser:t,closeButtonDisplayedText:n}),(0,g.sendJokoDomEvent)(g.JokoDomEvent.onJokoWidgetsCloseRequest,{}),[2]}}))}))},t.useCloseWidgetOnOfferActivation=function(e){var t=this,n=e.offer,r=e.isTemporaryUser,i=e.closeWidget,s=function(){return o(t,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.offerWidgetLastClosedInSessionTimestampMsMap,(e={},e[n.offerId]=Date.now(),e))];case 1:return t.sent(),M({offer:n,isTemporaryUser:r,isAutomaticallyClosedAfterOfferActivation:!0}),i(),(0,g.sendJokoDomEvent)(g.JokoDomEvent.onOfferWidgetClosed,{}),[2]}}))}))};l.default.useEffect((function(){var e=(0,g.setJokoDomEventListener)(g.JokoDomEvent.onOfferActivated,(function(){return setTimeout(s,1e3)}));return function(){(0,g.removeJokoDomEventListener)(g.JokoDomEvent.onOfferActivated,e)}}),[])};var U="jokoLastActivatedOnetimeOfferAt";function R(e,t,n,r,o){var a=r.type,i=r.offerId,s=[];n&&s.push("coupons"),t&&s.push("bnpl");var l={offerId:i,offerType:a,isTemporaryUser:o,availablePromotions:s,promotionClicked:e};(0,k.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"openedPromotionInOfferWidgetOnBrowserExtension",payload:l}}}),(0,k.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Opened Promotion In Offer Widget",properties:l}}})}function F(e){var t=e.offer;return!!e.shouldForceDisplay||!(![c.OfferType.Online,c.OfferType.OneTime].includes(t.type)||!t.browserExtension||((0,m.checkIsOnMobileScreen)()?t.browserExtension.mobileVersion&&!1===t.browserExtension.mobileVersion.displayCashbackWidget:t.browserExtension.desktopVersion&&!1===t.browserExtension.desktopVersion.displayCashbackWidget))}t.checkShouldDisplayCashbackInformationInWidgetForOffer=F},9516:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.usePriceComparisonFeedbackSubmittedWidgetInnerState=t.displayPriceComparisonFeedbackSubmittedWidgetAndLogUserEvent=void 0;var o=r(n(96540)),a=r(n(40961)),i=n(55015),s=n(17621),l=n(46239),u=n(94700),c=r(n(40549)),d=r(n(50842));t.displayPriceComparisonFeedbackSubmittedWidgetAndLogUserEvent=function(){var e,t,n=document.createElement("div");n.id=(0,s.getHashedElementId)(s.JokoExtensionRootElement.priceComparisonFeedbackSubmittedWidget),document.documentElement.appendChild(n),a.default.render(o.default.createElement(c.default,null,o.default.createElement(i.LocalesContextProvider,null,o.default.createElement(i.FeaturesContextProvider,null,o.default.createElement(d.default,null)))),n),e=(0,i.getCurrentUrlHostname)(),t={widgetType:"priceComparisonFeedbackSubmitted",widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:e},(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:t}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Displayed",properties:t}}})};t.usePriceComparisonFeedbackSubmittedWidgetInnerState=function(){var e=(0,u.useWidgetDisplay)(),t=e.isWidgetDisplayed,n=e.closeWidget,r=e.onWidgetInnerStateLoadEnd,a=o.default.useCallback((function(){var e;e={offerId:void 0,widgetType:"priceComparisonFeedbackSubmitted"},(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:e}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Closed",properties:e}}}),n()}),[n]);return o.default.useEffect((function(){r(),setTimeout((function(){n()}),2e3)}),[]),{isWidgetDisplayed:t,onClickWidgetHeaderCloseButton:a}}},13279:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.usePriceComparisonFeedbackWidgetInnerState=t.displayPriceComparisonFeedbackWidgetAndLogUserEvent=t.checkCanDisplayPriceComparisonFeedbackWidget=t.handlePriceComparisonFeedbackWidgetDisplayDecision=void 0;var l=s(n(96540)),u=s(n(40961)),c=n(55015),d=n(7444),f=n(17621),p=n(31229),g=n(46239),v=n(71145),h=n(9516),m=n(94700),y=n(72886),b=s(n(40549)),w=s(n(28353));function S(e,t){return o(this,void 0,void 0,(function(){var n,r,o;return a(this,(function(a){switch(a.label){case 0:return document.getElementById((0,f.getHashedElementId)(f.JokoExtensionRootElement.priceComparisonFeedbackWidget))?[2,!1]:[4,k(e)];case 1:return a.sent()?[4,(0,d.checkHasFeatureByPlatform)({desktopFeature:c.Feature.priceComparisonFeedbackWidgetDesktopBrowserExtension,mobileFeature:c.Feature.priceComparisonFeedbackWidgetMobileBrowserExtension})]:[2,!1];case 2:return a.sent()?[4,Promise.all([D(e),(0,v.checkShouldStandDownOnWebpage)(t.offerId)])]:[2,!1];case 3:return n=i.apply(void 0,[a.sent(),2]),r=n[0],o=n[1],[2,!r&&!o]}}))}))}t.handlePriceComparisonFeedbackWidgetDisplayDecision=function(e){var t=e.currentWebpageOffer,n=e.currentWebpageUrl,r=e.currentWebpageProductDataSynchronizationResult;return o(this,void 0,void 0,(function(){var e,o,i;return a(this,(function(a){switch(a.label){case 0:return t&&"object"==typeof r&&(null==r?void 0:r.productData)?(e=r.productData,o=r.source,[4,S(n,t)]):((0,y.submitWidgetDisplayDecision)({widgetName:y.PriorityOrderedWidgetName.priceComparisonFeedbackWidget,shouldDisplayWidget:!1}),[2]);case 1:return i=a.sent(),(0,y.submitWidgetDisplayDecision)({widgetName:y.PriorityOrderedWidgetName.priceComparisonFeedbackWidget,shouldDisplayWidget:i,props:{currentWebpageUrl:n,currentWebpageOffer:t,currentWebpageProductData:{__typename:"ProductWebpage",webpageUrl:n,productData:e,source:o,searchScore:null}}}),[2]}}))}))},t.checkCanDisplayPriceComparisonFeedbackWidget=S;var E=10;function k(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.lastOpenedProductAlternative)];case 1:return[2,(t=n.sent())&&Date.now()-t.lastOpenedTimestamp<1e3*E&&t.webpageUrl===e]}}))}))}function D(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.priceComparisonFeedbackWidgetLastClosedInSessionTimestampMsMap)];case 1:return[2,!!(null==(t=n.sent())?void 0:t[e])&&Date.now()-t[e]<864e5]}}))}))}t.displayPriceComparisonFeedbackWidgetAndLogUserEvent=function(e,t){var n=document.createElement("div");n.id=(0,f.getHashedElementId)(f.JokoExtensionRootElement.priceComparisonFeedbackWidget),document.documentElement.appendChild(n),u.default.render(l.default.createElement(b.default,null,l.default.createElement(c.LocalesContextProvider,null,l.default.createElement(c.FeaturesContextProvider,null,l.default.createElement(w.default,r({},e))))),n),function(e,t){var n=e.offerId,o=e.type,a=(0,c.getCurrentUrlHostname)(),i=r({widgetType:"priceComparisonFeedback",widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:a,currentWebpageOfferId:n,currentWebpageOfferType:o},t);(0,g.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:i}}}),(0,g.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Displayed",properties:i}}})}(e.currentWebpageOffer,t)};t.usePriceComparisonFeedbackWidgetInnerState=function(e){var t=this,n=e.currentWebpageUrl,r=e.currentWebpageOffer,i=(0,p.useIsTemporaryUser)(),s=(0,m.useWidgetDisplay)(),u=s.isWidgetDisplayed,d=s.closeWidget,f=s.onWidgetInnerStateLoadEnd,v=function(){return o(t,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.priceComparisonFeedbackWidgetLastClosedInSessionTimestampMsMap,(e={},e[n]=Date.now(),e))];case 1:return t.sent(),function(e,t){var n={widgetType:"priceComparisonFeedback",offerId:e.offerId,offerType:e.type,isTemporaryUser:t};(0,g.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:n}}}),(0,g.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Closed",properties:n}}})}(r,i),d(),[2]}}))}))};return l.default.useEffect((function(){f();var e=setTimeout((function(){return d()}),5e3);return function(){return clearTimeout(e)}}),[]),{isWidgetDisplayed:u,onClickWidgetHeaderCloseButton:v,buildOnClickFeedbackButton:function(e){return function(){var t={currentWebpageUrl:n,feedback:e};(0,g.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"submittedPriceComparisonFeedback",payload:t}}}),setTimeout((function(){return v()}),50),setTimeout((function(){return(0,h.displayPriceComparisonFeedbackSubmittedWidgetAndLogUserEvent)()}),150)}}}}},37790:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.usePriceComparisonWidgetInnerState=t.displayPriceComparisonWidgetAndLogUserEvent=t.checkCanDisplayPriceComparisonWidget=t.handlePriceComparisonWidgetDisplayDecision=t.MAXIMUM_NUMBER_OF_PRODUCT_ALTERNATIVES_DISPLAYED_IN_PRICE_COMPARISON_WIDGET=t.DEFAULT_PRICE_COMPARISON_WIDGET_DISPLAY_COOLDOWN_IN_HOURS=void 0;var l=s(n(96540)),u=s(n(40961)),c=n(55015),d=n(7444),f=n(17621),p=n(26368),g=n(31229),v=n(46239),h=n(23081),m=n(74617),y=n(33931),b=n(71145),w=n(94700),S=n(72886),E=s(n(40549)),k=s(n(45376));t.DEFAULT_PRICE_COMPARISON_WIDGET_DISPLAY_COOLDOWN_IN_HOURS=1,t.MAXIMUM_NUMBER_OF_PRODUCT_ALTERNATIVES_DISPLAYED_IN_PRICE_COMPARISON_WIDGET=2;function D(e,t){return o(this,void 0,void 0,(function(){var n,r,o;return a(this,(function(a){switch(a.label){case 0:return document.getElementById((0,f.getHashedElementId)(f.JokoExtensionRootElement.priceComparisonWidget))?[2,!1]:[4,(0,d.checkHasFeatureByPlatform)({desktopFeature:c.Feature.priceComparisonWidgetDesktopBrowserExtension,mobileFeature:c.Feature.priceComparisonWidgetMobileBrowserExtension})];case 1:return a.sent()?[4,Promise.all([W(e),(0,b.checkShouldStandDownOnWebpage)(null==t?void 0:t.offerId)])]:[2,!1];case 2:return n=i.apply(void 0,[a.sent(),2]),r=n[0],o=n[1],[2,!r&&!o]}}))}))}function W(e){return o(this,void 0,void 0,(function(){var n,r;return a(this,(function(o){switch(o.label){case 0:return[4,(0,c.getSetting)(c.SettingKey.priceComparisonWidgetDisplayCooldownInHours)];case 1:return n=o.sent()||t.DEFAULT_PRICE_COMPARISON_WIDGET_DISPLAY_COOLDOWN_IN_HOURS,[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.priceComparisonWidgetLastClosedInSessionTimestampMsMap)];case 2:return[2,!!(null==(r=o.sent())?void 0:r[e])&&Date.now()-r[e]<60*n*60*1e3]}}))}))}t.handlePriceComparisonWidgetDisplayDecision=function(e){var t,n=e.currentWebpageOffer,r=e.currentWebpageUrl,i=e.currentWebpageProductDataSynchronizationResult;return o(this,void 0,void 0,(function(){var e,o,s;return a(this,(function(a){switch(a.label){case 0:return n&&"object"==typeof i&&(null==i?void 0:i.productData)?(e=i.productData,o=i.source,[4,D(r,n)]):((0,S.submitWidgetDisplayDecision)({widgetName:S.PriorityOrderedWidgetName.priceComparisonWidget,shouldDisplayWidget:!1}),[2]);case 1:return a.sent()?[4,(0,y.loadPriceComparisonDataAndLogEvents)({currentWebpageUrl:r,productData:e,merchantId:null==n?void 0:n.merchantId,automaticallyTriggered:!0,maximumNumberOfItems:10,shouldOnlyKeepCheaperAlternatives:!0,bestPriceTagDisplayEnabled:!0})]:((0,S.submitWidgetDisplayDecision)({widgetName:S.PriorityOrderedWidgetName.priceComparisonWidget,shouldDisplayWidget:!1}),[2]);case 2:return s=a.sent(),(0,S.submitWidgetDisplayDecision)({widgetName:S.PriorityOrderedWidgetName.priceComparisonWidget,shouldDisplayWidget:!!(null===(t=s.productAlternativesWithAssociatedOffers)||void 0===t?void 0:t.length),props:{currentWebpageUrl:r,currentWebpageOffer:n,currentWebpageProductData:{__typename:"ProductWebpage",webpageUrl:r,productData:e,source:o,searchScore:null},priceComparisonData:s}}),[2]}}))}))},t.checkCanDisplayPriceComparisonWidget=D,t.displayPriceComparisonWidgetAndLogUserEvent=function(e,t){var n=(0,m.getPanelElement)(),o=document.createElement("div");o.id=(0,f.getHashedElementId)(f.JokoExtensionRootElement.priceComparisonWidget),n?document.documentElement.insertBefore(o,n):document.documentElement.appendChild(o),u.default.render(l.default.createElement(E.default,null,l.default.createElement(c.LocalesContextProvider,null,l.default.createElement(c.FeaturesContextProvider,null,l.default.createElement(k.default,r({},e))))),o),function(e,t){var n=e.offerId,o=e.type,a=(0,c.getCurrentUrlHostname)(),i=r({widgetType:"priceComparison",widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:a,currentWebpageOfferId:n,currentWebpageOfferType:o},t);(0,v.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:i}}}),(0,v.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Displayed",properties:i}}})}(e.currentWebpageOffer,t)},t.usePriceComparisonWidgetInnerState=function(e){var t=this,n=e.currentWebpageUrl,r=e.currentWebpageOffer,i=(0,g.useIsTemporaryUser)(),s=!!(0,h.useIsBnplSectionEnabledForOffer)(r),u=(0,w.useWidgetDisplay)(),d=u.isWidgetDisplayed,f=u.closeWidget,y=u.onWidgetInnerStateLoadEnd,b=l.default.useCallback((function(){return o(t,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.priceComparisonWidgetLastClosedInSessionTimestampMsMap,(e={},e[n]=Date.now(),e))];case 1:return t.sent(),function(e,t){var n={widgetType:"priceComparison",offerId:e.offerId,offerType:e.type,isTemporaryUser:t};(0,v.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:n}}}),(0,v.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Closed",properties:n}}})}(r,i),f(),[2]}}))}))}),[f,r,i]),S=function(e){var t=this,n=e.currentWebpageUrl,r=e.currentWebpageOffer,i=e.closeWidget,s=e.isTemporaryUser,u=e.isBnplSectionEnabledForCurrentWebpageOffer;return l.default.useCallback((function(){return o(t,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return(0,m.displayPanelAndLogEvents)({offer:r,userOfferActivationInfo:void 0,defaultPanelLocationOverride:{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.product},bnpl:{isBnplSectionEnabledForOffer:u},isTemporaryUser:s},"priceComparisonWidget"),[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.priceComparisonWidgetLastClosedInSessionTimestampMsMap,(e={},e[n]=Date.now(),e))];case 1:return t.sent(),function(e){var t=e.currentWebpageUrl,n=e.currentWebpageOffer,r={currentWebpageOfferId:n.offerId,currentWebpageUrl:t};(0,v.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedPriceComparisonWidgetShowMoreButton",payload:r}}}),(0,v.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Products - Clicked Show More Button On Price Comparison Widget",properties:r}}})}({currentWebpageUrl:n,currentWebpageOffer:r}),setTimeout((function(){return i()}),1e3*p.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS),[2]}}))}))}),[r,i])}({currentWebpageUrl:n,currentWebpageOffer:r,closeWidget:f,isTemporaryUser:i,isBnplSectionEnabledForCurrentWebpageOffer:s});return l.default.useEffect((function(){y()}),[]),{isWidgetDisplayed:d,onClickWidgetHeaderCloseButton:b,onClickShowMoreProductAlternativesButton:S}}},18989:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return a(t,e),t},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},l=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},u=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useShouldDisplayCashbackActivationAnimation=t.useShouldDisplayRedBadgeIndicator=t.throttledRepositionSideButtonAtDomBottom=t.getSideButtonElement=t.useSideButtonInnerState=t.unmountSideButton=t.displaySideButton=t.checkShouldDisplaySideButtonOnWebpage=void 0;var d=c(n(96540)),f=c(n(40961)),p=n(2543),g=n(55015),v=n(80256),h=n(47248),m=n(14568),y=n(94576),b=n(7444),w=n(52879),S=n(37392),E=n(17621),k=n(32668),D=n(84159),W=n(31229),I=n(46239),C=n(4135),T=n(69568),O=n(23081),P=n(74617),A=n(95752),_=n(82198),B=n(71145),x=n(94700),M=c(n(40549)),L=i(n(43522));function U(e){var t,n,r,o,a;return e.type===h.OfferType.NoCashback&&!(null===(r=null===(n=null===(t=null==e?void 0:e.browserExtension)||void 0===t?void 0:t.coupons)||void 0===n?void 0:n.itemList)||void 0===r?void 0:r.length)&&!(null===(a=null===(o=null==e?void 0:e.browserExtension)||void 0===o?void 0:o.bnpl)||void 0===a?void 0:a.active)}function R(e,t,n){var r,o,a,i,s,l,u,c;return n?t?!(null===(o=null===(r=e.browserExtension)||void 0===r?void 0:r.mobileVersion)||void 0===o?void 0:o.hideSideButtonOnProductPage):!(null===(i=null===(a=e.browserExtension)||void 0===a?void 0:a.mobileVersion)||void 0===i?void 0:i.hideSideButtonOnNonProductPage):t?!(null===(l=null===(s=e.browserExtension)||void 0===s?void 0:s.desktopVersion)||void 0===l?void 0:l.hideSideButtonOnProductPage):!(null===(c=null===(u=e.browserExtension)||void 0===u?void 0:u.desktopVersion)||void 0===c?void 0:c.hideSideButtonOnNonProductPage)}function F(){return s(this,void 0,void 0,(function(){var e;return l(this,(function(t){switch(t.label){case 0:return e={isGloballyEnabledOnProductWebpages:!1,isGloballyEnabledOnNonProductWebpages:!1},[4,(0,b.checkHasFeatureByPlatform)({mobileFeature:g.Feature.productSideButtonMobileBrowserExtension,desktopFeature:g.Feature.productSideButtonDesktopBrowserExtension})];case 1:return t.sent()?[4,(0,b.checkHasFeatureByPlatform)({mobileFeature:g.Feature.sideButtonOnNonProductWebpagesMobileBrowserExtension,desktopFeature:g.Feature.sideButtonOnNonProductWebpagesDesktopBrowserExtension})]:[2,e];case 2:return[2,{isGloballyEnabledOnProductWebpages:!0,isGloballyEnabledOnNonProductWebpages:t.sent()}]}}))}))}t.checkShouldDisplaySideButtonOnWebpage=function(e,t){var n;return s(this,void 0,void 0,(function(){var r,o,a,i,s,c,d,f;return l(this,(function(l){switch(l.label){case 0:return g.browserKind===g.Browser.mobileAppWebView?[2,!0]:[4,Promise.all([(0,D.checkIsExtensionSnoozed)(),F(),(0,B.checkShouldStandDownOnWebpage)(null==t?void 0:t.offerId,e)])];case 1:return r=u.apply(void 0,[l.sent(),3]),o=r[0],a=r[1],i=a.isGloballyEnabledOnNonProductWebpages,s=a.isGloballyEnabledOnProductWebpages,c=r[2],o||c?[2,!1]:i&&function(e,t){var n,r,o,a;if(void 0===e||U(e))return!1;var i=t?null===(r=null===(n=null==e?void 0:e.browserExtension)||void 0===n?void 0:n.mobileVersion)||void 0===r?void 0:r.hideSideButtonOnNonProductPage:null===(a=null===(o=null==e?void 0:e.browserExtension)||void 0===o?void 0:o.desktopVersion)||void 0===a?void 0:a.hideSideButtonOnNonProductPage;return!i}(t,(0,k.checkIsOnMobileScreen)())?[2,!0]:[4,(0,_.getProductData)(e)];case 2:return d=l.sent().productData,(f=(0,_.checkIsProductWebpageFromProductData)(d))&&!s?[2,!1]:(f||i)&&(t&&(!U(t)||!!(null===(n=t.alternativeOffersIds)||void 0===n?void 0:n.length)))?[2,R(t,f,(0,k.checkIsOnMobileScreen)())]:[2,!1]}}))}))};function N(){var e=(0,E.getHashedElementId)(E.JokoExtensionRootElement.sideButton),t=document.getElementById(e);null!==t&&(f.default.unmountComponentAtNode(t),t.remove())}t.displaySideButton=function(e){var t;return s(this,void 0,void 0,(function(){var n,o,a,i,s,u;return l(this,(function(l){switch(l.label){case 0:return n=(0,E.getHashedElementId)(E.JokoExtensionRootElement.sideButton),null!==(o=document.getElementById(n))&&(f.default.unmountComponentAtNode(o),o.remove()),(a=document.createElement("div")).id=n,i=(0,E.getHashedElementId)(E.JokoExtensionRootElement.offerWidget),null!==(s=document.getElementById(i))&&null!==s.parentNode?s.parentNode.insertBefore(a,s):document.documentElement.appendChild(a),[4,(0,b.getUserFeaturesMapWithTimeout)(300)];case 1:return u=l.sent(),f.default.render(d.default.createElement(M.default,null,d.default.createElement(g.LocalesContextProvider,null,d.default.createElement(g.FeaturesContextProvider,{initialUserFeaturesMap:u},d.default.createElement(L.default,r({},e))))),a),function(e){var t=e.offerId,n={timeToDisplaySideButtonAfterPageLoadingStart:Date.now()-performance.timeOrigin,offerId:t};(0,I.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"sideButtonDisplayed",payload:n}}})}({offerId:null===(t=e.offer)||void 0===t?void 0:t.offerId}),[2]}}))}))},t.unmountSideButton=N;var H="jokoSideButton";t.useSideButtonInnerState=function(e,t,n){var r=d.default.useMemo(k.checkIsOnMobileScreen,[]),o=u(d.default.useState(void 0),2),a=o[0],i=o[1],c=d.default.useCallback((function(){return i(!1)}),[]),f=d.default.useCallback((function(e){"opacity"===e.propertyName&&!1===a&&N()}),[a]),p=u(d.default.useState(void 0),2),b=p[0],w=p[1],D=function(e){var t=e.webpageUrl,n=e.offer,r=e.userOfferActivationInfo,o=e.isMobileExtension,a=e.defaultPanelLocationOverride,i=e.closeSideButton,c=n?n.offerId:void 0,f=function(e){var t=this,n=e.isMobileExtension,r=e.webpageUrl,o=e.offer,a=e.userOfferActivationInfo,i=e.defaultPanelLocationOverride,c=e.closeSideButton;return d.default.useCallback((function(){return s(t,void 0,void 0,(function(){var e,t,s,d,f,p,g;return l(this,(function(l){switch(l.label){case 0:return[4,Promise.all([(0,A.checkIsProductAndCheckoutWebpage)(r),(0,O.checkIsBnplSectionEnabledForOffer)(o)])];case 1:return e=u.apply(void 0,[l.sent(),2]),t=e[0],s=t.isProductPage,d=t.isCheckoutPage,f=e[1],p=(0,m.getUserBnplTransactionsFromLocalStorage)(o),[4,(0,W.checkIsTemporaryUser)()];case 2:return g=l.sent(),(0,P.displayPanelAndLogEvents)({offer:o,userOfferActivationInfo:a,isProductPage:s,isCheckoutPage:d,bnpl:{isBnplSectionEnabledForOffer:f,userBnplTransactionsFromLocalStorage:p},isTemporaryUser:g,defaultPanelLocationOverride:i},"sideButton"),function(e,t){var n=t?{offerId:t.offerId,webpageUrl:e}:{};(0,I.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedSideButton",payload:n}}}),(0,I.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Clicked Side Button",properties:n}}})}(r,o),c(),n&&(0,y.unmountBottomSheet)(E.JokoExtensionElement.snoozingBottomSheet),[2]}}))}))}),[r,o,i])}({isMobileExtension:o,webpageUrl:t,offer:n,userOfferActivationInfo:r,defaultPanelLocationOverride:a,closeSideButton:i}),p=function(e,t,n){var r=function(){var e=0,t=d.default.useRef(void 0),n=d.default.useCallback((function(n,r,o){var a=o.startPosition,i=o.endPosition,s=o.windowDimensions;if(!(n===t.current&&e>=J)){var l={webpageUrl:r?n:void 0,startTopOffset:a.topOffset,endTopOffset:i.topOffset,windowHeight:s.height};(0,I.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"movedSideButton",payload:l}}}),(0,I.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Moved Side Button",properties:l}}}),n===t.current?e+=1:e=1,t.current=n}}),[]);return n}(),o=d.default.useCallback((function(o){n&&function(e){setTimeout((function(){var t=e.endPosition,n=t.topOffset,r=t.rightOffset,o=e.updatePosition,a=e.updatePreferredPosition,i=e.windowDimensions.width,s=e.componentDimensions.width,l={topOffset:n,rightOffset:r<i/2-s/2?0:i-s};o(l),a(l)}),10)}(o),r(e,t,o)}),[e,t]);return o}(t,c,o);return{onClickSideButton:f,onDragEnd:p}}({webpageUrl:e,offer:t,userOfferActivationInfo:n,isMobileExtension:r,defaultPanelLocationOverride:b,closeSideButton:c}),C=D.onClickSideButton,_=D.onDragEnd,B=function(e,t){var n=u(d.default.useState(!1),2),r=n[0],o=n[1],a=d.default.useCallback((function(){o(!0),j(null==t?void 0:t.offerId)}),[]),i=d.default.useCallback((function(){return o(!1)}),[]),s=d.default.useMemo((function(){return r&&!e}),[r,e]),l=(0,g.useHasFeature)(g.Feature.displayCashbackRateAtSideButtonHoverDesktopBrowserExtension)&&(null==t?void 0:t.type)!==h.OfferType.NoCashback&&!e&&r,c=function(e){var t=(0,g.useUserRegion)(),n=!!(0,g.useHasFeature)(g.Feature.enableMultipleCashbackRatesMergingInExtensions);if(!e||e.type===h.OfferType.NoCashback)return 0;var r=(0,v.getBoostedAndNonBoostedCashback)({offer:e,userRegion:t,isMultipleCashbackRatesMergingEnabled:n}),o=r.mainCashbackRate,a=r.nonBoostedCashback,i=r.boostedCashback,s=r.isCashbackBoosted;return 14+(s?i.length:a.length)*L.SIDE_BUTTON_DIMENSIONS.desktop.cashbackRateSingleCharacterWidth+(o.computationType===g.ComputationType.variable?2:0)}(t),f=function(e){var t=e.isMobileExtension,n=e.isHovered,r=e.shouldDisplayCashbackRateOnHover,o=e.cashbackRateContainerWidth;return t?L.SIDE_BUTTON_DIMENSIONS.mobile.containerWidth:n?L.SIDE_BUTTON_DIMENSIONS.desktop.containerWidth+L.SIDE_BUTTON_DIMENSIONS.desktop.fourDotsContainerWidth+(r?o:0):L.SIDE_BUTTON_DIMENSIONS.desktop.containerWidth}({isMobileExtension:e,isHovered:r,shouldDisplayCashbackRateOnHover:l,cashbackRateContainerWidth:c});return{shouldDisplayCashbackRateOnHover:l,areFourDotsVisible:s,sideButtonWidth:f,onMouseEnterSideButtonContainer:a,onMouseLeaveSideButtonContainer:i}}(r,t),x=B.shouldDisplayCashbackRateOnHover,M=B.areFourDotsVisible,U=B.sideButtonWidth,R=B.onMouseEnterSideButtonContainer,F=B.onMouseLeaveSideButtonContainer,V=d.default.useRef(null),G=function(e,t,n,r,o){(0,k.useDisableMobileSafariNativeSwipe)({isMobileExtension:t,sideButtonElementRef:e});var a=(0,g.useMakeComponentDraggable)({componentRef:e,isOnMobile:t,componentName:H,componentDimensions:{height:t?L.SIDE_BUTTON_DIMENSIONS.mobile.height:L.SIDE_BUTTON_DIMENSIONS.desktop.height,width:n},defaultPosition:{topOffset:t?L.SIDE_BUTTON_DIMENSIONS.mobile.defaultTopOffset:L.SIDE_BUTTON_DIMENSIONS.desktop.defaultTopOffset,rightOffset:0},shouldRememberLastPosition:!0,forbiddenDragDirection:t?void 0:"horizontal",onClick:r,onDragEnd:o}),i=a.position,s=a.isDragged;return{position:i,isDragged:s}}(V,r,U,C,_),K=G.position,z=G.isDragged;return d.default.useEffect((function(){setTimeout((function(){return i(!0)}),50);var e=(0,S.setJokoDomEventListener)(S.JokoDomEvent.onJokoPanelDisplayed,(function(){return c()}));return function(e){var t;return s(this,void 0,void 0,(function(){var n,r;return l(this,(function(o){switch(o.label){case 0:return(r=(null==e?void 0:e.type)!==h.OfferType.Online)?[3,2]:[4,(0,T.checkWasOfferActivatedRecentlyFromLocalOrSessionStorage)(e)];case 1:r=o.sent(),o.label=2;case 2:return n=r,(null==e?void 0:e.type)===h.OfferType.NoCashback&&!!(null===(t=e.alternativeOffersIds)||void 0===t?void 0:t.length)||!n?[2,{panelTab:g.PanelTab.offerDetails,offerDetailsSection:g.OfferDetailsSection.cashback}]:[2,void 0]}}))}))}(t).then(w),function(){return(0,S.removeJokoDomEventListener)(S.JokoDomEvent.onJokoPanelDisplayed,e)}}),[]),{sideButtonElementRef:V,isSideButtonDisplayed:a,shouldDisplayCashbackRateOnHover:x,areFourDotsVisible:M,sideButtonWidth:U,sideButtonPosition:K,onMouseEnterSideButtonContainer:R,onMouseLeaveSideButtonContainer:F,isDragged:z,isMobileExtension:r,onSideButtonTransitionEnd:f}};var j=(0,p.once)((function(e){(0,I.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"hoveredSideButton",payload:{offerId:e}}}})}));var J=3;t.getSideButtonElement=function(){return document.getElementById((0,E.getHashedElementId)(E.JokoExtensionRootElement.sideButton))},t.throttledRepositionSideButtonAtDomBottom=(0,p.throttle)((function(e){if(document.documentElement.lastChild===e)return;var t=(0,x.getWidgetElement)(E.JokoExtensionRootElement.offerWidget);t?document.documentElement.insertBefore(e,t):document.documentElement.appendChild(e)}),x.DELAY_BETWEEN_DOM_POSITION_RESET_IN_MS),t.useShouldDisplayRedBadgeIndicator=function(e){var t=e.isMobileExtension,n=e.offerId,r=e.offerType,o=e.isOfferActivated,a=(0,C.useCashbackNotActivatedIndicator)({isMobileExtension:t,offerId:n,offerType:r,isOfferActivated:o}).shouldDisplayCashbackNotActivatedIndicator,i=(0,w.useShouldDisplayBankReconnectionBanner)()&&t,s=a||i;return d.default.useEffect((function(){s&&function(e){var t=e.offerId,n=e.shouldDisplayCashbackNotActivatedIndicator,r=e.shouldDisplayBankReconnectionBanner,o={timeToDisplaySideButtonRedBadgeAfterPageLoadingStart:Date.now()-performance.timeOrigin,offerId:t,redBadgeDisplayedReason:n?h.RedBadgeDisplayedReason.cashbackNotActivated:r?h.RedBadgeDisplayedReason.bankDisconnected:void 0};(0,I.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"sideButtonRedBadgeDisplayed",payload:o}}})}({offerId:n,shouldDisplayCashbackNotActivatedIndicator:a,shouldDisplayBankReconnectionBanner:i})}),[s]),s},t.useShouldDisplayCashbackActivationAnimation=function(e){var t=u(d.default.useState(!1),2),n=t[0],r=t[1],o=(0,g.useHasFeatureByPlatform)({isMobileExtension:e,desktopFeature:g.Feature.sideButtonRedBadgeForNotActivatedCashbackDesktopBrowserExtension,mobileFeature:g.Feature.sideButtonRedBadgeForNotActivatedCashbackMobileBrowserExtension}),a=(0,g.useHasFeatureByPlatform)({isMobileExtension:e,desktopFeature:g.Feature.cashbackActivationAnimation1BDesktopBrowserExtension,mobileFeature:g.Feature.cashbackActivationAnimation1BMobileBrowserExtension});return d.default.useEffect((function(){var e=(0,S.setJokoDomEventListener)(S.JokoDomEvent.startSideButtonCashbackActivationAnimation,(function(){o&&r(!0)}));return function(){return(0,S.removeJokoDomEventListener)(S.JokoDomEvent.onOfferActivated,e)}}),[]),{shouldDisplayCashbackActivationAnimation:n,shouldDisplayCashbackActivatedGreenBadge:a}}},76764:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useSnoozingConfirmationWidgetInnerState=t.displaySnoozingConfirmationWidget=void 0;var l=s(n(96540)),u=s(n(40961)),c=n(55015),d=n(7444),f=n(17621),p=n(84159),g=n(46239),v=n(94700),h=s(n(40549)),m=s(n(87881));t.displaySnoozingConfirmationWidget=function(e){var t=e.offerId,n=e.websiteName;return o(this,void 0,void 0,(function(){var e,o;return a(this,(function(a){switch(a.label){case 0:return(e=document.createElement("div")).id=(0,f.getHashedElementId)(f.JokoExtensionRootElement.snoozingConfirmationWidget),document.documentElement.appendChild(e),[4,(0,d.getUserFeaturesMapWithTimeout)()];case 1:return o=a.sent(),u.default.render(l.default.createElement(h.default,null,l.default.createElement(c.LocalesContextProvider,null,l.default.createElement(c.FeaturesContextProvider,{initialUserFeaturesMap:o},l.default.createElement(m.default,r({},{offerId:t,websiteName:n}))))),e),[2]}}))}))},t.useSnoozingConfirmationWidgetInnerState=function(e){var t=this,n=(0,v.useWidgetDisplay)(),r=n.isWidgetDisplayed,s=n.closeWidget,u=n.onWidgetInnerStateLoadEnd,d=i(l.default.useState(!1),2),f=d[0],h=d[1],m=l.default.useCallback((function(){return o(t,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return h(!0),t=(0,p.getSnoozeEndTimestampInMs)(),[4,(0,c.setLocalStorageItem)(c.LocalStorageKey.snoozeForAllWebsitesEndTimestampInMs,t)];case 1:return n.sent(),function(e){var t={offerId:e};(0,g.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"snoozedExtensionForAllWebsites",payload:t}}}),(0,g.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Snoozed For All Websites",properties:t}}})}(e),[2]}}))}))}),[]),w=l.default.useCallback((function(){s(),function(e,t){var n={offerId:t,hasSnoozedAllWebsites:e};(0,g.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedSnoozingConfirmationWidget",payload:n}}}),(0,g.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Closed Snoozing Confirmation Widget",properties:n}}})}(f,e)}),[s,f]);return l.default.useEffect((function(){setTimeout(u,100)}),[]),function(e,t,n){l.default.useEffect((function(){var r,o;return t&&(r=setTimeout((function(){e()}),y)),n&&(r&&clearTimeout(r),t&&(o=setTimeout((function(){e()}),b))),function(){r&&clearTimeout(r),o&&clearTimeout(o)}}),[t,n])}(s,r,f),{isWidgetDisplayed:r,hasSnoozedAllWebsites:f,onClickSnoozeForAllWebsitesButton:m,onClickWidgetHeaderCloseButton:w}};var y=5e3,b=3e3},94700:function(e,t,n){var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.throttledRepositionWidgetAtDomBottom=t.DELAY_BETWEEN_DOM_POSITION_RESET_IN_MS=t.getWidgetElement=t.useOnClickInsideWidget=t.useWidgetContainerInnerState=t.useWidgetDisplay=void 0;var a=o(n(96540)),i=o(n(40961)),s=n(2543),l=n(37392),u=n(17621),c=n(32668),d=n(74617);t.useWidgetDisplay=function(){var e=r(a.default.useState(void 0),2),t=e[0],n=e[1],o=a.default.useCallback((function(){return n(!1)}),[]),i=a.default.useCallback((function(){setTimeout((function(){return n(!0)}),50)}),[]);return a.default.useEffect((function(){var e=(0,l.setJokoDomEventListener)(l.JokoDomEvent.onJokoWidgetsCloseRequest,(function(){return o()}));return function(){return(0,l.removeJokoDomEventListener)(l.JokoDomEvent.onJokoWidgetsCloseRequest,e)}}),[]),{isWidgetDisplayed:t,closeWidget:o,onWidgetInnerStateLoadEnd:i}},t.useWidgetContainerInnerState=function(e,t){var n=a.default.useMemo(c.checkIsOnMobileScreen,[]),o=(0,u.useHashedElementId)(e),s=a.default.useRef(null),l=r(a.default.useState(void 0),2),d=l[0],f=l[1],p=r(a.default.useState(!1),2),g=p[0],v=p[1],h=a.default.useCallback((function(){v(!0);var e=s.current;e&&(f(e.clientHeight),!1!==t&&function(e){e.addEventListener("touchmove",(function(e){e.preventDefault(),e.stopPropagation()}))}(e))}),[]);return a.default.useEffect((function(){var e=s.current;if(e){var t=new ResizeObserver((function(){f(e.clientHeight)}));return t.observe(e),function(){t.unobserve(e)}}}),[g]),{onWidgetTransitionEnd:a.default.useCallback((function(t,n){!1===n&&"opacity"===t.propertyName&&function(e){var t=(0,u.getHashedElementId)(u.JokoExtensionRootElement[e]),n=document.getElementById(t);null!==n&&(i.default.unmountComponentAtNode(n),n.remove())}(e)}),[]),height:d,elementId:o,handleMountedWidgetInnerContainer:h,widgetInnerContainerRef:s,isMobileExtension:n}},t.useOnClickInsideWidget=function(e){var t=e.widgetInnerContainerRef,n=e.onClick,r=e.excludedElementRefs;a.default.useEffect((function(){return(null==t?void 0:t.current)&&t.current.addEventListener("click",o),function(){(null==t?void 0:t.current)&&t.current.removeEventListener("click",o)}}),[]);var o=a.default.useCallback((function(e){if(e.target){var t=r.some((function(t){var n;return null===(n=null==t?void 0:t.current)||void 0===n?void 0:n.contains(e.target)}));t||n()}}),[])},t.getWidgetElement=function(e){return document.getElementById((0,u.getHashedElementId)(e))},t.DELAY_BETWEEN_DOM_POSITION_RESET_IN_MS=100,t.throttledRepositionWidgetAtDomBottom=(0,s.throttle)((function(e){if(document.documentElement.lastChild===e)return;var t=(0,d.getPanelElement)();t?document.documentElement.insertBefore(e,t):document.documentElement.appendChild(e)}),t.DELAY_BETWEEN_DOM_POSITION_RESET_IN_MS)},72886:function(e,t,n){var r,o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},o.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},l=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},u=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.checkShouldPrioritizeAutoCouponsWidgetOverCashbackReminderWidget=t.submitWidgetDisplayDecision=t.WIDGET_PRIORITY_MAP=t.PriorityOrderedWidgetName=void 0;var c,d=n(55015),f=n(7444),p=n(32668),g=n(74137),v=n(76688),h=n(46239),m=n(74617),y=n(22794),b=n(59003),w=n(29491),S=n(52852),E=n(10518),k=n(75614),D=n(23907),W=n(16868),I=n(13279),C=n(37790);!function(e){e.merchantWebsiteTrackingConsentErrorWidget="merchantWebsiteTrackingConsentErrorWidget",e.alternativeOffersWidget="alternativeOffersWidget",e.offerWidget="offerWidget",e.bnplSubscriptionWidget="bnplSubscriptionWidget",e.cashbackReminderWidget="cashbackReminderWidget",e.cashbackTrackingLostWidget="cashbackTrackingLostWidget",e.cashbackReactivationAtCheckoutWidget="cashbackReactivationAtCheckoutWidget",e.couponAutomationProposalWidget="couponAutomationProposalWidget",e.bnplSuggestionAtCheckoutWidget="bnplSuggestionAtCheckoutWidget",e.priceComparisonFeedbackWidget="priceComparisonFeedbackWidget",e.priceComparisonWidget="priceComparisonWidget"}(c=t.PriorityOrderedWidgetName||(t.PriorityOrderedWidgetName={})),t.WIDGET_PRIORITY_MAP=((r={})[c.merchantWebsiteTrackingConsentErrorWidget]=0,r[c.alternativeOffersWidget]=1,r[c.offerWidget]=2,r[c.bnplSubscriptionWidget]=3,r[c.cashbackReminderWidget]=4,r[c.cashbackTrackingLostWidget]=5,r[c.couponAutomationProposalWidget]=6,r[c.cashbackReactivationAtCheckoutWidget]=7,r[c.bnplSuggestionAtCheckoutWidget]=8,r[c.priceComparisonFeedbackWidget]=9,r[c.priceComparisonWidget]=10,r);var T=[{widgetName:c.merchantWebsiteTrackingConsentErrorWidget,shouldDisplayWidget:void 0},{widgetName:c.alternativeOffersWidget,shouldDisplayWidget:void 0},{widgetName:c.offerWidget,shouldDisplayWidget:void 0},{widgetName:c.bnplSubscriptionWidget,shouldDisplayWidget:void 0},{widgetName:c.cashbackReminderWidget,shouldDisplayWidget:void 0},{widgetName:c.cashbackTrackingLostWidget,shouldDisplayWidget:void 0},{widgetName:c.couponAutomationProposalWidget,shouldDisplayWidget:void 0},{widgetName:c.cashbackReactivationAtCheckoutWidget,shouldDisplayWidget:void 0},{widgetName:c.bnplSuggestionAtCheckoutWidget,shouldDisplayWidget:void 0},{widgetName:c.priceComparisonFeedbackWidget,shouldDisplayWidget:void 0},{widgetName:c.priceComparisonWidget,shouldDisplayWidget:void 0}],O=Object.keys(t.WIDGET_PRIORITY_MAP).length,P={widgetDisplayDecisions:l([],s(T),!1)};function A(e){var t=e.widgetDisplayDecision,n=e.earlyReturnReason;if(t.widgetName===c.offerWidget&&t.shouldDisplayWidget){var r=t.props.offer,a=t.additionalPayload,i=a.offerWidgetDisplayBackgroundScriptDebuggingTimestamps,s=a.offerQueriesDebuggingInfo,l=a.displayOfferWidgetMessageReceivedTimestampInMs,u=a.offerWidgetDisplayDecisionSubmittedTimestampInMs;!function(e){var t=e.offerId,n=e.offerWidgetDisplayBackgroundScriptDebuggingTimestamps,r=e.offerQueriesDebuggingInfo,a=e.displayOfferWidgetMessageReceivedTimestampInMs,i=e.offerWidgetDisplayDecisionSubmittedTimestampInMs,s=e.earlyReturnReason;(0,h.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"positiveOfferWidgetDisplayDecisionSet",active:!1,payload:o(o(o({offerId:t},n),r),{displayOfferWidgetMessageReceivedTimestampInMs:a,offerWidgetDisplayDecisionSubmittedTimestampInMs:i,earlyReturnReason:s})}}})}({offerId:r.offerId,offerWidgetDisplayBackgroundScriptDebuggingTimestamps:i,offerQueriesDebuggingInfo:s,displayOfferWidgetMessageReceivedTimestampInMs:l,offerWidgetDisplayDecisionSubmittedTimestampInMs:u,earlyReturnReason:n})}}function _(e){var n=e.priorityCheckTriggeredTimestampInMs,r=e.triggeringWidgetDisplayDecision,a=e.currentlyConsideredWidgetDisplayDecision,i=e.hasTriggeredWidgetDisplay,s=e.earlyReturnReason,l=Date.now(),u=P.widgetDisplayDecisions[t.WIDGET_PRIORITY_MAP[c.offerWidget]];if((null==u?void 0:u.widgetName)===c.offerWidget&&u.shouldDisplayWidget){var d=u.props.offer,f=u.additionalPayload,p=f.offerWidgetDisplayBackgroundScriptDebuggingTimestamps,g=f.offerQueriesDebuggingInfo,v=f.displayOfferWidgetMessageReceivedTimestampInMs,m=f.offerWidgetDisplayDecisionSubmittedTimestampInMs;!function(e){var t=e.offerId,n=e.offerWidgetDisplayBackgroundScriptDebuggingTimestamps,r=e.offerQueriesDebuggingInfo,a=e.displayOfferWidgetMessageReceivedTimestampInMs,i=e.offerWidgetDisplayDecisionSubmittedTimestampInMs,s=e.priorityCheckTriggeredTimestampInMs,l=e.priorityCheckReturnedTimestampInMs,u=e.widgetTriggeringWidgetDisplayDecision,c=e.currentlyConsideredWidget,d=e.hasTriggeredWidgetDisplay,f=e.earlyReturnReason;(0,h.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"priorityCheckWithPositiveOfferWidgetDisplayDecisionTriggered",active:!1,payload:o(o(o({offerId:t},n),r),{displayOfferWidgetMessageReceivedTimestampInMs:a,offerWidgetDisplayDecisionSubmittedTimestampInMs:i,priorityCheckTriggeredTimestampInMs:s,priorityCheckReturnedTimestampInMs:l,widgetTriggeringWidgetDisplayDecision:u,currentlyConsideredWidget:c,hasTriggeredWidgetDisplay:d,earlyReturnReason:f})}}})}({offerId:d.offerId,offerWidgetDisplayBackgroundScriptDebuggingTimestamps:p,offerQueriesDebuggingInfo:g,displayOfferWidgetMessageReceivedTimestampInMs:v,offerWidgetDisplayDecisionSubmittedTimestampInMs:m,priorityCheckTriggeredTimestampInMs:n,priorityCheckReturnedTimestampInMs:l,widgetTriggeringWidgetDisplayDecision:r.widgetName,currentlyConsideredWidget:null==a?void 0:a.widgetName,hasTriggeredWidgetDisplay:i,earlyReturnReason:s||"undefinedDecision"})}}t.submitWidgetDisplayDecision=function(e){!function(e){var n=P.widgetDisplayDecisions;if(n.length<O)return(0,g.captureSentryException)(new Error("The widgetDisplayDecisions array has an unexpected length.")),void A({widgetDisplayDecision:e,earlyReturnReason:"widgetDisplayDecisionsLengthError"});n[t.WIDGET_PRIORITY_MAP[e.widgetName]]=e,A({widgetDisplayDecision:e})}(e),function(e){a(this,void 0,void 0,(function(){var t,n,r,o,a,f,p,h;return i(this,(function(i){switch(i.label){case 0:if(t=Date.now(),(n=P.widgetDisplayDecisions).length<O)return(0,g.captureSentryException)(new Error("The widgetDisplayDecisions array has an unexpected length.")),_({priorityCheckTriggeredTimestampInMs:t,triggeringWidgetDisplayDecision:e,hasTriggeredWidgetDisplay:!1,earlyReturnReason:"widgetDisplayDecisionsLengthError"}),[2];i.label=1;case 1:i.trys.push([1,7,8,9]),r=u(n),o=r.next(),i.label=2;case 2:return o.done?[3,6]:void 0!==(a=o.value).shouldDisplayWidget?[3,3]:(_({priorityCheckTriggeredTimestampInMs:t,triggeringWidgetDisplayDecision:e,currentlyConsideredWidgetDisplayDecision:a,hasTriggeredWidgetDisplay:!1,earlyReturnReason:"undefinedDecision"}),[2]);case 3:return!0!==a.shouldDisplayWidget?[3,5]:[4,x()];case 4:return i.sent()?(_({priorityCheckTriggeredTimestampInMs:t,triggeringWidgetDisplayDecision:e,hasTriggeredWidgetDisplay:!1,earlyReturnReason:"couponAutomationActive"}),[2]):(_({priorityCheckTriggeredTimestampInMs:t,triggeringWidgetDisplayDecision:e,currentlyConsideredWidgetDisplayDecision:a,hasTriggeredWidgetDisplay:!0}),function(e){if(!e.shouldDisplayWidget)return;switch(function(){P.widgetDisplayDecisions=l([],s(T),!1)}(),e.widgetName){case c.merchantWebsiteTrackingConsentErrorWidget:return void(0,v.displayMerchantWebsiteTrackingConsentErrorWidgetWithTimeout)(e.props);case c.alternativeOffersWidget:return void(0,y.displayAlternativeOffersWidgetAndLogUserEvent)(e.props,e.additionalPayload);case c.offerWidget:return void(0,W.displayOfferWidgetAndLogUserEvent)(e.props,e.additionalPayload);case c.bnplSubscriptionWidget:return e.props.shouldUseFactorizedBnplSubscriptionWidgetIntoPanel?void(0,m.displayPanelAndLogEvents)({offer:e.props.offer,bnpl:{isBnplSectionEnabledForOffer:!0,shouldOpenBnplSubscription:!0,unfinishedBnplSubscriptionState:e.props.unfinishedBnplSubscriptionState,isFromBnplResumption:!0},isTemporaryUser:!1,userOfferActivationInfo:void 0,defaultPanelLocationOverride:{panelTab:d.PanelTab.offerDetails,offerDetailsSection:d.OfferDetailsSection.bnpl}},"bnplResumption"):void(0,b.displayBnplSubscriptionWidget)(e.props);case c.cashbackReminderWidget:return void(0,E.displayCashbackReminderWidgetAndLogUserEvent)(e.props,e.additionalPayload);case c.cashbackTrackingLostWidget:return void(0,k.displayCashbackTrackingLostWidgetAndLogUserEvent)(e.props);case c.couponAutomationProposalWidget:return void(0,D.displayCouponAutomationProposalWidget)(e.props);case c.cashbackReactivationAtCheckoutWidget:return void(0,S.displayCashbackReactivationAtCheckoutWidgetAndLogUserEvent)(e.props);case c.bnplSuggestionAtCheckoutWidget:return void(0,w.displayBnplSuggestionAtCheckoutWidget)(e.props.offer);case c.priceComparisonFeedbackWidget:return void(0,I.displayPriceComparisonFeedbackWidgetAndLogUserEvent)(e.props);case c.priceComparisonWidget:(0,C.displayPriceComparisonWidgetAndLogUserEvent)(e.props)}}(a),[2]);case 5:return o=r.next(),[3,2];case 6:return[3,9];case 7:return f=i.sent(),p={error:f},[3,9];case 8:try{o&&!o.done&&(h=r.return)&&h.call(r)}finally{if(p)throw p.error}return[7];case 9:return[2]}}))}))}(e)};var B=3e5;function x(){var e;return a(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t="".concat(d.LocalStorageKey.couponAutomationStateKeyPrefix).concat(window.location.hostname),[4,(0,d.getLocalStorageItem)(t)];case 1:return n=r.sent(),Date.now()>(null!==(e=null==n?void 0:n.timestampInMs)&&void 0!==e?e:0)+B?[2,!1]:[2,new Promise((function(e){return(0,h.sendMessageToBackgroundScript)({message:"getCouponAutomationState",data:{url:window.location.href}},(function(t){return e(!(!t||!t.active&&!t.done))}))}))]}}))}))}t.checkShouldPrioritizeAutoCouponsWidgetOverCashbackReminderWidget=function(){return a(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return[4,(0,f.getUserFeaturesMapWithTimeout)(300)];case 1:return(e=r.sent())?((!(n=(0,p.checkIsOnMobileScreen)())&&e[d.Feature.prioritizeAutoCouponsWidgetOverCashbackReminderWidgetDesktopBrowserExtension]||n&&e[d.Feature.prioritizeAutoCouponsWidgetOverCashbackReminderWidgetMobileBrowserExtension])&&(t.WIDGET_PRIORITY_MAP[c.cashbackReminderWidget]=6,t.WIDGET_PRIORITY_MAP[c.couponAutomationProposalWidget]=4),[2]):[2,!1]}}))}))}}}]);