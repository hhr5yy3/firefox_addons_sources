{"version":3,"sources":["webpack:///./src/plugins/shoelace.js","webpack:///./src/utils/browser.js","webpack:///./src/utils/resizeImage.js","webpack:///./src/services/LocalStorageDatabaseService.js","webpack:///./src/services/SyncService.js"],"names":["setBasePath","registerIconLibrary","resolver","name","setDefaultAnimation","keyframes","opacity","options","duration","transform","isFirefox","navigator","userAgent","toLowerCase","indexOf","isChrome","isEdge","window","resizeImage","a","Promise","resolve","reject","c","Image","src","onload","e","f","Math","floor","d","document","createElement","g","width","height","h","getContext","drawImage","i","toDataURL","onerror","DatabaseService","dropTables","browser","storage","local","get","installedOn","clear","set","getGroups","withHomeGroup","order","groups","preferences","result","savedPreferences","id","title","defaultGroupName","i18n","getMessage","position","sort","b","localeCompare","orderBy","getBookmarks","bookmarks","getBookmarksByGroup","orderAttribute","orderSort","filter","bookmark","Number","idgroup","thumbnail","dataThumbnail","getBookmarksCount","length","search","text","searchQuery","url","slice","map","group","find","groupTitle","getBookmarksWithNoThumbnail","Object","storageKeys","keys","thumbnailIds","key","startsWith","replace","includes","getBookmarksWithThumbnail","createBookmark","autoIncrement","max","record","visits","visits_morning","visits_afternoon","visits_evening","visits_night","ts_created","round","Date","getTime","createBookmarkWithId","editBookmark","item","destroyBookmark","remove","bulkDestroyBookmarks","ids","Array","isArray","bulkMoveBookmarks","createGroup","color","createGroupWithId","editGroup","destroyGroup","updateBookmarksPosition","data","index","updateGroupsPosition","addThumbnail","image","getThumbnail","dataThumbnailKey","cleanUpThumbnails","bookmarkIds","extraThumbnailIds","getDuplicateBookmarks","urlToId","duplicateBookmarksIds","forEach","push","getEmptyGroups","groupsFromBookmarks","emptyGroups","trackVisit","hours","getHours","attribute","console","log","syncUrl","client","endpoint","body","customConfig","config","method","fetch","then","response","json","SyncService","isAuthorized","username","password","undefined","syncParams","params","URLSearchParams","append","updatePreferences","payload","JSON","stringify","backup","merge","import","addBookmark","action","reorderBookmarks","neworder","addGroup","getGroupSharing","setGroupSharing","isPublic","isEditable","reorderGroups","getBackups","getProfile","signIn","signUp","upload"],"mappings":"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","file":"js/chunk-common.js","sourcesContent":["import '@shoelace-style/shoelace/dist/themes/light.css'\nimport '@shoelace-style/shoelace/dist/components/dialog/dialog.js'\nimport '@shoelace-style/shoelace/dist/components/icon/icon.js'\nimport '@shoelace-style/shoelace/dist/components/input/input.js'\nimport '@shoelace-style/shoelace/dist/components/textarea/textarea.js'\nimport '@shoelace-style/shoelace/dist/components/range/range.js'\nimport '@shoelace-style/shoelace/dist/components/radio/radio.js'\nimport '@shoelace-style/shoelace/dist/components/drawer/drawer.js'\nimport '@shoelace-style/shoelace/dist/components/breadcrumb/breadcrumb.js'\nimport '@shoelace-style/shoelace/dist/components/breadcrumb-item/breadcrumb-item.js'\nimport '@shoelace-style/shoelace/dist/components/radio-group/radio-group.js'\nimport '@shoelace-style/shoelace/dist/components/color-picker/color-picker.js'\nimport '@shoelace-style/shoelace/dist/components/select/select.js'\nimport '@shoelace-style/shoelace/dist/components/option/option.js'\nimport '@shoelace-style/shoelace/dist/components/switch/switch.js'\nimport '@shoelace-style/shoelace/dist/components/checkbox/checkbox.js'\nimport '@shoelace-style/shoelace/dist/components/spinner/spinner.js'\nimport '@shoelace-style/shoelace/dist/components/button/button.js'\nimport '@shoelace-style/shoelace/dist/components/button-group/button-group.js'\nimport '@shoelace-style/shoelace/dist/components/menu/menu.js'\nimport '@shoelace-style/shoelace/dist/components/menu-item/menu-item.js'\nimport '@shoelace-style/shoelace/dist/components/dropdown/dropdown.js'\n\nimport { setDefaultAnimation } from '@shoelace-style/shoelace/dist/utilities/animation-registry.js'\nimport { setBasePath } from '@shoelace-style/shoelace/dist/utilities/base-path'\nimport { registerIconLibrary } from '@shoelace-style/shoelace/dist/utilities/icon-library.js'\n\nsetBasePath('/shoelace')\n\nregisterIconLibrary('feather', {\n  resolver: (name) => `/shoelace/assets/icons/feather/${name}.svg`\n})\n\n// Change the default animation for all dialogs\nsetDefaultAnimation('dropdown.show', {\n  keyframes: [{ opacity: '0' }, { opacity: '1' }],\n  options: {\n    duration: 100\n  }\n})\n\nsetDefaultAnimation('dialog.denyClose', {\n  keyframes: [{ transform: 'scale(1)' }, { transform: 'scale(1.01)' }, { transform: 'scale(1)' }],\n  options: { duration: 250 }\n})\n","export function isFirefox() {\n  return navigator.userAgent.toLowerCase().indexOf('firefox') > -1\n}\n\nexport function isChrome() {\n  return navigator.userAgent.toLowerCase().indexOf('chrome') > -1\n}\n\nexport function isEdge() {\n  window.navigator.userAgent.toLowerCase().indexOf('edg') > -1\n}\n","export default function resizeImage(a) {\n  return new Promise((resolve, reject) => {\n    let c = new Image()\n    ;(c.src = a),\n      (c.onload = () => {\n        var a = Math.floor\n        const d = document.createElement('canvas')\n        let e,\n          f,\n          g = a(c.width / (280 * 3))\n        2 <= g\n          ? (5 <= g && (g = a(g / 1.3)),\n            1 & g && g--,\n            (e = c.width / g),\n            (f = c.height * (e / c.width)),\n            140 > f && ((e *= 140 / f), (f = 140)))\n          : ((e = c.width), (f = c.height)),\n          (d.width = e),\n          (d.height = f)\n        const h = d.getContext('2d')\n        h.drawImage(c, 0, 0, e, f)\n        const i = d.toDataURL('image/jpeg', 0.8)\n        resolve(i)\n      }),\n      (c.onerror = () => {\n        reject(null)\n      })\n  })\n}\n","import orderBy from 'lodash/orderBy'\n\nconst DatabaseService = {\n  async dropTables() {\n    const { installedOn } = await browser.storage.local.get({\n      installedOn: null\n    })\n\n    await browser.storage.local.clear()\n\n    if (installedOn) {\n      await browser.storage.local.set({ installedOn })\n    }\n  },\n\n  async getGroups(withHomeGroup = true, order = 'manual') {\n    const result = await browser.storage.local.get({\n      groups: [],\n      preferences: {}\n    })\n\n    let groups = result.groups\n    const savedPreferences = result.preferences\n\n    if (withHomeGroup) {\n      groups = [\n        {\n          id: 0,\n          title: savedPreferences?.defaultGroupName || browser.i18n.getMessage('home'),\n          position: 0\n        },\n        ...groups\n      ]\n    }\n\n    switch (order) {\n      case 'alphabetical':\n        return groups.sort((a, b) => (a.title || '').toLowerCase().localeCompare((b.title || '').toLowerCase()))\n      default:\n        return orderBy(groups, 'position', 'asc')\n    }\n  },\n\n  async getBookmarks() {\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    return result.bookmarks\n  },\n\n  async getBookmarksByGroup(id, order = 'manual') {\n    let orderAttribute\n    let orderSort\n\n    switch (order) {\n      case 'visits':\n        orderAttribute = ['visits', 'title']\n        orderSort = ['desc', 'asc']\n        break\n      case 'date_desc':\n        orderAttribute = ['ts_created']\n        orderSort = ['desc']\n        break\n      case 'date_asc':\n        orderAttribute = ['ts_created']\n        orderSort = ['asc']\n        break\n      case 'alphabetical':\n        orderAttribute = [({ title }) => (title || '').toLowerCase(), 'ts_created']\n        orderSort = ['asc', 'asc']\n        break\n      default:\n        orderAttribute = ['position', 'ts_created']\n        orderSort = ['asc', 'asc']\n    }\n\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    const bookmarks = result.bookmarks.filter((bookmark) => Number(bookmark?.idgroup) === Number(id))\n\n    // Add bookmark dataThumbnail\n    for (const bookmark of bookmarks) {\n      if (bookmark.thumbnail) {\n        continue\n      }\n\n      bookmark.dataThumbnail = (\n        await browser.storage.local.get({\n          [`thumbnail-${bookmark.id}`]: null\n        })\n      )[`thumbnail-${bookmark.id}`]\n    }\n\n    return orderBy(bookmarks, orderAttribute, orderSort)\n  },\n\n  async getBookmarksCount() {\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    return result.bookmarks.length\n  },\n\n  async search(text) {\n    const searchQuery = (text || '').toLowerCase()\n    const result = await browser.storage.local.get({\n      bookmarks: [],\n      groups: []\n    })\n\n    // TODO: Add matchsorter plugin and limit to 25 results\n    const bookmarks = result.bookmarks\n      .filter(\n        ({ title, url }) =>\n          (title || '').toLowerCase().indexOf(searchQuery) > -1 || (url || '').toLowerCase().indexOf(searchQuery) > -1\n      )\n      .slice(0, 24)\n      .map((bookmark) => {\n        const group = result.groups.find(({ id }) => Number(id) === Number(bookmark.idgroup)) || {}\n\n        return {\n          ...bookmark,\n          groupTitle: group?.title || 'Home'\n        }\n      })\n\n    // Add bookmark dataThumbnail\n    for (const bookmark of bookmarks) {\n      if (bookmark.thumbnail) {\n        continue\n      }\n\n      bookmark.dataThumbnail = (\n        await browser.storage.local.get({\n          [`thumbnail-${bookmark.id}`]: null\n        })\n      )[`thumbnail-${bookmark.id}`]\n    }\n\n    return bookmarks\n  },\n\n  async getBookmarksWithNoThumbnail() {\n    const storageKeys = Object.keys(await browser.storage.local.get(null))\n    const thumbnailIds = storageKeys\n      .filter((key) => key.startsWith('thumbnail-'))\n      .map((key) => key.replace('thumbnail-', ''))\n      .map((id) => Number(id))\n\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    return result.bookmarks.filter(({ id, thumbnail }) => {\n      return !thumbnail && !thumbnailIds.includes(Number(id))\n    })\n  },\n\n  async getBookmarksWithThumbnail() {\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    return result.bookmarks.filter(({ thumbnail }) => !thumbnail)\n  },\n\n  async createBookmark(bookmark) {\n    if (!bookmark['title'] || !bookmark['url']) {\n      return\n    }\n\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    const autoIncrement = !result.bookmarks.length ? 1 : Math.max(...result.bookmarks.map(({ id }) => id)) + 1\n\n    const record = {\n      id: autoIncrement,\n      title: bookmark['title'],\n      url: bookmark['url'],\n      thumbnail: bookmark['thumbnail'] || '',\n      position: typeof bookmark['position'] === 'undefined' ? 999 : Number(bookmark['position']),\n      idgroup: Number(bookmark['idgroup']) || 0,\n      visits: 0,\n      visits_morning: 0,\n      visits_afternoon: 0,\n      visits_evening: 0,\n      visits_night: 0,\n      ts_created: Math.round(new Date().getTime() / 1000)\n    }\n\n    await browser.storage.local.set({\n      bookmarks: [...result.bookmarks, record]\n    })\n\n    return record\n  },\n\n  async createBookmarkWithId(bookmark) {\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    // Prevent from creating duplicate bookmarks\n    if (result.bookmarks.find(({ id }) => Number(id) === Number(bookmark['id']))) {\n      return\n    }\n\n    const record = {\n      id: Number(bookmark['id']),\n      title: bookmark['title'],\n      url: bookmark['url'],\n      thumbnail: bookmark['thumbnail'] || '',\n      position: typeof bookmark['position'] === 'undefined' ? 999 : Number(bookmark['position']),\n      idgroup: Number(bookmark['idgroup']) || 0,\n      visits: Number(bookmark['visits']) || 0,\n      visits_morning: Number(bookmark['visits_morning']) || 0,\n      visits_afternoon: Number(bookmark['visits_afternoon']) || 0,\n      visits_evening: Number(bookmark['visits_evening']) || 0,\n      visits_night: Number(bookmark['visits_night']) || 0,\n      ts_created: Number(bookmark['ts_created']) || Math.round(new Date().getTime() / 1000)\n    }\n\n    await browser.storage.local.set({\n      bookmarks: [...result.bookmarks, record]\n    })\n\n    return record\n  },\n\n  async editBookmark(bookmark) {\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    const bookmarks = result.bookmarks.map((item) => {\n      return Number(item.id) !== Number(bookmark.id)\n        ? item\n        : {\n            ...item,\n            title: bookmark['title'],\n            url: bookmark['url'],\n            thumbnail: bookmark['thumbnail'] || '',\n            idgroup: Number(bookmark['idgroup']) || 0,\n            position: typeof bookmark['position'] === 'undefined' ? 999 : Number(bookmark['position'])\n          }\n    })\n\n    await browser.storage.local.set({\n      bookmarks\n    })\n\n    return bookmark\n  },\n\n  async destroyBookmark(bookmark) {\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    // Delete bookmark\n    await browser.storage.local.set({\n      bookmarks: result.bookmarks.filter(({ id }) => Number(id) !== Number(bookmark.id))\n    })\n\n    await browser.storage.local.remove(`thumbnail-${bookmark.id}`)\n  },\n\n  async bulkDestroyBookmarks(ids) {\n    if (!Array.isArray(ids)) {\n      return\n    }\n\n    ids = ids.map((id) => Number(id))\n\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    await browser.storage.local.set({\n      bookmarks: result.bookmarks.filter(({ id }) => !ids.includes(Number(id)))\n    })\n  },\n\n  async bulkMoveBookmarks(ids, group) {\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    ids = ids.map((id) => Number(id))\n\n    const bookmarks = result.bookmarks.map((item) => {\n      return !ids.includes(Number(item.id))\n        ? item\n        : {\n            ...item,\n            idgroup: Number(group)\n          }\n    })\n\n    await browser.storage.local.set({\n      bookmarks\n    })\n  },\n\n  async createGroup(group) {\n    const result = await browser.storage.local.get({\n      groups: []\n    })\n\n    const autoIncrement = !result.groups.length ? 1 : Math.max(...result.groups.map(({ id }) => Number(id))) + 1\n\n    const record = {\n      id: autoIncrement,\n      title: group['title'],\n      position: typeof group['position'] === 'undefined' ? 99 : Number(group['position']),\n      color: ''\n    }\n\n    await browser.storage.local.set({\n      groups: [...result.groups, record]\n    })\n\n    return record\n  },\n\n  async createGroupWithId(group) {\n    if (Number(group['id']) == 0) {\n      return\n    }\n\n    const result = await browser.storage.local.get({\n      groups: []\n    })\n\n    // Prevent from creating duplicate groups\n    if (result.groups.find(({ id }) => Number(id) === Number(group['id']))) {\n      return\n    }\n\n    const record = {\n      id: Number(group['id']),\n      title: group['title'],\n      position: typeof group['position'] === 'undefined' ? 99 : Number(group['position']),\n      color: ''\n    }\n\n    await browser.storage.local.set({\n      groups: [...result.groups, record]\n    })\n\n    return record\n  },\n\n  async editGroup(group) {\n    const result = await browser.storage.local.get({\n      groups: []\n    })\n\n    const groups = result.groups.map((item) => {\n      return Number(item.id) != Number(group.id)\n        ? item\n        : {\n            ...item,\n            title: group['title'],\n            position: typeof group['position'] === 'undefined' ? 99 : Number(group['position'])\n          }\n    })\n\n    await browser.storage.local.set({\n      groups\n    })\n\n    return group\n  },\n\n  async destroyGroup(group) {\n    const result = await browser.storage.local.get({\n      bookmarks: [],\n      groups: []\n    })\n\n    // Delete group\n    await browser.storage.local.set({\n      groups: result.groups.filter(({ id }) => Number(id) !== Number(group.id))\n    })\n\n    // Delete group bookmarks\n    await browser.storage.local.set({\n      bookmarks: result.bookmarks.filter(({ idgroup }) => Number(idgroup) !== Number(group.id))\n    })\n  },\n\n  async updateBookmarksPosition(data) {\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    const bookmarks = result.bookmarks.map((item) => {\n      const { id, index } = data.find(({ id }) => Number(id) === Number(item.id)) || {}\n      return id\n        ? {\n            ...item,\n            position: Number(index)\n          }\n        : item\n    })\n\n    await browser.storage.local.set({\n      bookmarks\n    })\n  },\n\n  async updateGroupsPosition(data) {\n    const result = await browser.storage.local.get({\n      groups: []\n    })\n\n    const groups = result.groups.map((item) => {\n      const { id, index } = data.find(({ id }) => Number(id) === Number(item.id)) || {}\n      return id\n        ? {\n            ...item,\n            position: Number(index)\n          }\n        : item\n    })\n\n    await browser.storage.local.set({\n      groups\n    })\n  },\n\n  async addThumbnail({ id, url, image }) {\n    await browser.storage.local.set({\n      [`thumbnail-${id}`]: image\n    })\n  },\n\n  async getThumbnail({ id }) {\n    const dataThumbnailKey = `thumbnail-${id}`\n    return (await browser.storage.local.get(dataThumbnailKey))?.[dataThumbnailKey]\n  },\n\n  async cleanUpThumbnails() {\n    const storageKeys = Object.keys(await browser.storage.local.get(null))\n    const thumbnailIds = storageKeys\n      .filter((key) => key.startsWith('thumbnail-'))\n      .map((key) => key.replace('thumbnail-', ''))\n      .map((id) => Number(id))\n\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    const bookmarkIds = result.bookmarks.map(({ id }) => Number(id))\n    const extraThumbnailIds = thumbnailIds.filter((id) => !bookmarkIds.includes(id))\n\n    for (const id of extraThumbnailIds) {\n      await browser.storage.local.remove(`thumbnail-${id}`)\n    }\n  },\n\n  async getDuplicateBookmarks() {\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    const urlToId = {}\n    const duplicateBookmarksIds = []\n\n    result.bookmarks.forEach(({ id, url }) => {\n      if (urlToId[url]) {\n        duplicateBookmarksIds.push(id)\n      } else {\n        urlToId[url] = id\n      }\n    })\n\n    return duplicateBookmarksIds\n  },\n\n  async getEmptyGroups() {\n    const result = await browser.storage.local.get({\n      groups: [],\n      bookmarks: []\n    })\n\n    const groupsFromBookmarks = result.bookmarks.map(({ idgroup }) => Number(idgroup))\n    const emptyGroups = result.groups.filter(({ id }) => !groupsFromBookmarks.includes(Number(id)))\n\n    return emptyGroups\n  },\n\n  async trackVisit(id) {\n    const result = await browser.storage.local.get({\n      bookmarks: []\n    })\n\n    const hours = new Date().getHours()\n\n    let attribute\n    if (hours >= 0) {\n      attribute = 'visits_night'\n    }\n    if (hours >= 6) {\n      attribute = 'visits_morning'\n    }\n    if (hours >= 12) {\n      attribute = 'visits_afternoon'\n    }\n    if (hours >= 18) {\n      attribute = 'visits_evening'\n    }\n\n    try {\n      const bookmarks = result.bookmarks.map((item) => {\n        return Number(item.id) !== Number(id)\n          ? item\n          : {\n              ...item,\n              visits: (Number(item.visits) || 0) + 1,\n              [attribute]: (Number(item[attribute]) || 0) + 1\n            }\n      })\n\n      await browser.storage.local.set({\n        bookmarks\n      })\n    } catch (e) {\n      console.log(e)\n    }\n  }\n}\n\nexport default DatabaseService\n","// TODO: add json response to the server: preferences, bookmark\n// const syncUrl = 'http://localhost/speeddial2.com/sync2'\nconst syncUrl = 'https://www.speeddial2.com/sync2'\n\nconst client = (endpoint, { body, ...customConfig } = {}) => {\n  const config = {\n    method: body ? 'POST' : 'GET',\n    ...customConfig\n  }\n\n  if (body) {\n    config.body = body\n  }\n\n  return fetch(`${syncUrl}/${endpoint}`, config)\n    .then((response) => response.json())\n    .then((result) => {\n      return result\n    })\n}\n\nconst SyncService = {\n  async isAuthorized() {\n    const result = await browser.storage.local.get({ preferences: {} })\n    const { username, password } = result.preferences\n    return typeof username !== undefined && typeof password !== undefined && username && password\n  },\n\n  async syncParams() {\n    let params = new URLSearchParams()\n    const result = await browser.storage.local.get({ preferences: {} })\n    const { username, password } = result.preferences\n\n    params.append('username', username)\n    params.append('password', password)\n\n    return params\n  },\n\n  async get() {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    let body = await this.syncParams()\n\n    return client('get', { body })\n  },\n\n  async updatePreferences(data) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    const preferences = { ...data }\n    delete preferences.username\n    delete preferences.password\n\n    const payload = {\n      preferences\n    }\n\n    let body = await this.syncParams()\n    body.append('s', JSON.stringify(payload))\n\n    return client('preferences', { body })\n  },\n\n  async backup(data) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    let body = await this.syncParams()\n    body.append('sync', JSON.stringify(data))\n\n    return client('backup', { body })\n  },\n\n  async merge(data) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    let body = await this.syncParams()\n    body.append('sync', JSON.stringify(data))\n\n    return client('merge', { body })\n  },\n\n  async import(data) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    let body = await this.syncParams()\n    body.append('sync', JSON.stringify(data))\n\n    return client('import', { body })\n  },\n\n  async addBookmark(bookmark) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    const payload = {\n      action: 'create',\n      id: bookmark.id,\n      bookmark\n    }\n\n    let body = await this.syncParams()\n    body.append('s', JSON.stringify(payload))\n\n    return client('bookmark', { body })\n  },\n\n  async editBookmark(bookmark) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    const payload = {\n      action: 'edit',\n      id: bookmark.id,\n      bookmark\n    }\n\n    let body = await this.syncParams()\n    body.append('s', JSON.stringify(payload))\n\n    return client('bookmark', { body })\n  },\n\n  async destroyBookmark(bookmark) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    const payload = {\n      action: 'remove',\n      id: bookmark.id\n    }\n\n    let body = await this.syncParams()\n    body.append('s', JSON.stringify(payload))\n\n    return client('bookmark', { body })\n  },\n\n  async bulkDestroyBookmarks(ids) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    const payload = {\n      action: 'bulk-remove',\n      bookmarks: ids\n    }\n\n    let body = await this.syncParams()\n    body.append('s', JSON.stringify(payload))\n\n    return client('bookmark', { body })\n  },\n\n  async bulkMoveBookmarks(ids, group) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    const payload = {\n      action: 'bulk-move',\n      bookmarks: ids,\n      group: group\n    }\n\n    let body = await this.syncParams()\n    body.append('s', JSON.stringify(payload))\n\n    return client('bookmark', { body })\n  },\n\n  async reorderBookmarks(bookmarks) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    let neworder = {}\n\n    bookmarks.forEach(({ id, index }) => {\n      neworder[id] = index\n    })\n\n    const payload = {\n      action: 'reorder',\n      bookmarks: neworder\n    }\n\n    let body = await this.syncParams()\n    body.append('s', JSON.stringify(payload))\n\n    return client('bookmark', { body })\n  },\n\n  async addGroup(group) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    const payload = {\n      action: 'create',\n      id: group.id,\n      group\n    }\n\n    let body = await this.syncParams()\n    body.append('s', JSON.stringify(payload))\n\n    return client('group', { body })\n  },\n\n  async editGroup(group) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    const payload = {\n      action: 'edit',\n      id: group.id,\n      group\n    }\n\n    let body = await this.syncParams()\n    body.append('s', JSON.stringify(payload))\n\n    return client('group', { body })\n  },\n\n  async getGroupSharing(group) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    let body = await this.syncParams()\n    body.append('id', group.id)\n\n    return client('get_group_sharing', { body })\n  },\n\n  async setGroupSharing(group, isPublic, isEditable) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    let body = await this.syncParams()\n    body.append('id', group.id)\n    body.append('is_public', Number(isPublic))\n    body.append('is_editable', Number(isEditable) || 0)\n\n    return client('set_group_sharing', { body })\n  },\n\n  async destroyGroup(group) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    const payload = {\n      action: 'remove',\n      id: group.id\n    }\n\n    let body = await this.syncParams()\n    body.append('s', JSON.stringify(payload))\n\n    return client('group', { body })\n  },\n\n  async reorderGroups(groups) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    let neworder = {}\n\n    groups.forEach(({ id, index }) => {\n      neworder[id] = index\n    })\n\n    const payload = {\n      action: 'reorder',\n      groups: neworder\n    }\n\n    let body = await this.syncParams()\n    body.append('s', JSON.stringify(payload))\n\n    return client('group', { body })\n  },\n\n  async getBackups() {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    let body = await this.syncParams()\n\n    return client('get_backup', { body })\n  },\n\n  async getProfile() {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    let body = await this.syncParams()\n\n    return client('test_account', { body })\n  },\n\n  signIn({ username, password }) {\n    let body = new URLSearchParams()\n\n    body.append('username', username)\n    body.append('password', password)\n\n    return client('test_account', { body })\n  },\n\n  signUp({ username, password }) {\n    let body = new URLSearchParams()\n\n    body.append('user[email]', username)\n    body.append('user[password]', password)\n\n    return client('sign_up', { body })\n  },\n\n  async upload(data) {\n    if (!(await this.isAuthorized())) {\n      return\n    }\n\n    let body = await this.syncParams()\n    body.append('data', data)\n\n    return client('upload', { body })\n  }\n}\n\nexport default SyncService\n"],"sourceRoot":""}