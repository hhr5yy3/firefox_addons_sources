(()=>{"use strict";const e="change_fonts_ninja_icon",n="pong_from_fonts_ninja_extension",t="persist:settings";let s,o=!1,a=!1,i=!1;const c=()=>{if(a=!a,s){s.style.display=a?"block":"none";const e=JSON.stringify({isOpen:a});document.dispatchEvent(new CustomEvent("fontsninja-ext-opened",{detail:e}))}};chrome.storage.sync.get(t,(n=>{"string"==typeof n[t]&&r(n[t]);const s=n[t];if(s){const n=s.iconIndex;n&&chrome.runtime.sendMessage({message:e,options:{iconIndex:n}})}})),chrome.runtime.onMessage.addListener(((e,n,t)=>"toggle_fonts_ninja"===e.message?(o||(()=>{if(window.self===window.top){const e=document.createElement("script");e.id="fonts-ninja-ext-script",e.src=chrome.runtime.getURL("extension.bundle.js"),(document.head||document.documentElement).appendChild(e),s=document.createElement("div"),s.id="fonts-ninja-ext",s.classList.add("notranslate"),document.body.appendChild(s)}o=!0})(),c(),t({response:"toggle_fonts_ninja_reponse"}),!0):"change_url"===e.message?((e=>{const n=document.getElementById("fonts-ninja-ext-script"),t=document.getElementById("fonts-ninja-helpers-script"),s=document.getElementById("fonts-ninja-ext");n&&t&&s&&(!e||e===window.location.href)&&window.location.reload()})(e.url),t({response:"change_url_response"}),!0):void 0)),window.addEventListener("message",(t=>{if(t.data){const o=t.data.message?t.data.message:t.data;if("inject_fonts_ninja_helpers"===o.type&&(()=>{const e=document.createElement("script");e.id="fonts-ninja-helpers-script",e.src=chrome.runtime.getURL("fonts-ninja-helpers/index.js"),e.dataset.extid=chrome.runtime.id,(document.head||document.documentElement).appendChild(e)})(),"get_extension_path"===o.type&&window.postMessage({type:"send_extension_path",results:chrome.runtime.getURL("")}),"close_fonts_ninja"===o.type&&c(),"get_machine_id"===o.type&&o.key&&(s=o.key,chrome.storage.sync.get(s,(e=>{const n=e&&e[s]&&JSON.parse(e[s]),t=n&&n.machineId.replaceAll('"',""),o=n&&n.authToken&&JSON.parse(n.authToken).email;if(t)if(o)chrome.storage.sync.remove(s);else{const e=Date.now();fetch(`https://api-v2.fonts.ninja/extension/legacy/${t}?ts=${e}`,{method:"GET"}).then((e=>e.json())).then((e=>{e.success?window.postMessage({type:"send_machine_id",machineId:t}):chrome.storage.sync.remove(s)}))}}))),"get_storage"===o.type&&o.key&&(e=>{chrome.storage.sync.get(e,(n=>{const t=n&&n[e];window.postMessage({type:"send_storage",storage:t})}))})(o.key),"save_storage"===o.type&&((e,n,t)=>{chrome.storage.sync.get(e,(s=>{const o=s&&s[e]?s[e]:{};n.forEach(((e,n)=>{o[e]=t[n]})),chrome.storage.sync.set({[e]:o})}))})(o.key,o.attributes,o.values),"ping_from_fonts_ninja_extension"===o.type&&window.postMessage({type:n,message:n}),o.type===e){const n=o.iconIndex;chrome.runtime.sendMessage({message:e,options:{iconIndex:n}})}if(!o||"ninja>ext"!==o.context)return;chrome.runtime.sendMessage(o,(e=>{window.postMessage(Object.assign(Object.assign(Object.assign({},o),{context:"ext>ninja"}),e),"*"),i||(window.postMessage({type:"identify",env:"prod"},"*"),i=!0)}))}var s}));const r=e=>{const n=JSON.parse(e),t=d(n);chrome.storage.sync.clear(),t.launchCount=0,t.instaSeen=!1,chrome.storage.sync.set({"persist:settings":t})},d=e=>{for(const n in e)if(e.hasOwnProperty(n)&&"string"==typeof e[n]){const t=e[n];"true"===t.toLowerCase()?e[n]=!0:"false"===t.toLowerCase()?e[n]=!1:isNaN(parseFloat(t))||""===t.trim()||(e[n]=parseFloat(t))}return e}})();
//# sourceMappingURL=contentScript.bundle.js.map