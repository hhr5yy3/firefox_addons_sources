{"version":3,"file":"background.js","sources":["../src/constants.ts","../src/background.ts"],"sourcesContent":["import type { Config } from './config';\n\nexport const Constants = {\n  defaultConfig: {\n    extensionEnabled: true,\n    pumlServerUrl: 'https://plantuml-service-willbooster.fly.dev',\n    allowedUrls: [\n      'https://github.com/*',\n      'https://raw.githubusercontent.com/*',\n      'https://gitlab.com/*',\n      'https://gist.github.com/*',\n      'file:///*/*',\n    ],\n    deniedUrls: ['https://github.com/*/edit/*'],\n  } as Config,\n  versionUmlText: ['@startuml', 'version', '@enduml'].join('\\n'),\n  ignoreAttribute: 'data-wb-ignore',\n  imageTestIdAttribute: 'puml-vis-wb-img',\n  textTestIdAttribute: 'puml-vis-wb-txt',\n  commands: {\n    getConfig: 'getConfig',\n    getExtensionEnabled: 'getExtensionEnabled',\n    getAllowedUrls: 'getAllowedUrls',\n    getDeniedUrls: 'getDeniedUrls',\n    getPumlServerUrl: 'getPumlServerUrl',\n    setConfig: 'setConfig',\n    toggleExtensionEnabled: 'toggleExtensionEnabled',\n    setAllowedUrls: 'setAllowedUrls',\n    setDeniedUrls: 'setDeniedUrls',\n    setPumlServerUrl: 'setPumlServerUrl',\n  },\n} as const;\n","import type { Config } from './config';\nimport { Constants } from './constants';\n\nlet config = { ...Constants.defaultConfig };\n\nchrome.storage.sync.get((storage: Partial<Config>) => {\n  if (storage.extensionEnabled !== undefined) config.extensionEnabled = storage.extensionEnabled;\n  if (storage.allowedUrls !== undefined) config.allowedUrls = storage.allowedUrls;\n  if (storage.deniedUrls !== undefined) config.deniedUrls = storage.deniedUrls;\n  if (storage.pumlServerUrl !== undefined) config.pumlServerUrl = storage.pumlServerUrl;\n  setIcon();\n});\n\nchrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\n  switch (request.command) {\n    case Constants.commands.getConfig: {\n      sendResponse(config);\n      break;\n    }\n    case Constants.commands.getExtensionEnabled: {\n      sendResponse(config.extensionEnabled);\n      break;\n    }\n    case Constants.commands.getAllowedUrls: {\n      sendResponse(config.allowedUrls);\n      break;\n    }\n    case Constants.commands.getDeniedUrls: {\n      sendResponse(config.deniedUrls);\n      break;\n    }\n    case Constants.commands.getPumlServerUrl: {\n      sendResponse(config.pumlServerUrl);\n      break;\n    }\n    case Constants.commands.setConfig: {\n      config = request.config;\n      sendResponse(config);\n      chrome.storage.sync.set(config);\n      chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\n        if (tabs[0].id) chrome.tabs.reload(tabs[0].id);\n      });\n      break;\n    }\n    case Constants.commands.toggleExtensionEnabled: {\n      config.extensionEnabled = !config.extensionEnabled;\n      sendResponse(config.extensionEnabled);\n      void chrome.storage.sync.set({ extensionEnabled: config.extensionEnabled });\n      setIcon();\n      chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\n        if (tabs[0].id) void chrome.tabs.reload(tabs[0].id);\n      });\n      break;\n    }\n    case Constants.commands.setAllowedUrls: {\n      config.allowedUrls = request.allowedUrls;\n      sendResponse(config.allowedUrls);\n      void chrome.storage.sync.set({ allowedUrls: config.allowedUrls });\n      chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\n        if (tabs[0].id) void chrome.tabs.reload(tabs[0].id);\n      });\n      break;\n    }\n    case Constants.commands.setDeniedUrls: {\n      config.deniedUrls = request.deniedUrls;\n      sendResponse(config.deniedUrls);\n      void chrome.storage.sync.set({ deniedUrls: config.deniedUrls });\n      chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\n        if (tabs[0].id) void chrome.tabs.reload(tabs[0].id);\n      });\n      break;\n    }\n    case Constants.commands.setPumlServerUrl: {\n      config.pumlServerUrl = request.pumlServerUrl;\n      sendResponse(config.pumlServerUrl);\n      void chrome.storage.sync.set({ pumlServerUrl: config.pumlServerUrl });\n      chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\n        if (tabs[0].id) void chrome.tabs.reload(tabs[0].id);\n      });\n      break;\n    }\n  }\n});\n\nfunction setIcon(): void {\n  chrome.browserAction.setIcon({ path: config.extensionEnabled ? 'icon/icon16.png' : 'icon/icon16gray.png' }, () => {\n    // do nothing\n  });\n}\n"],"names":["Constants","extensionEnabled","pumlServerUrl","allowedUrls","deniedUrls","join","getConfig","getExtensionEnabled","getAllowedUrls","getDeniedUrls","getPumlServerUrl","setConfig","toggleExtensionEnabled","setAllowedUrls","setDeniedUrls","setPumlServerUrl","config","setIcon","chrome","browserAction","path","storage","sync","get","undefined","runtime","onMessage","addListener","request","sender","sendResponse","command","set","tabs","query","active","currentWindow","id","reload"],"mappings":"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"}