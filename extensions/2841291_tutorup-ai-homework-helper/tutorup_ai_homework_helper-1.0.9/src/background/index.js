(function(){var B;"use strict";var I=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function z(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var F={exports:{}};(function(e,m){(function(a,g){g(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:I,function(a){var g,A;if(!((A=(g=globalThis.chrome)==null?void 0:g.runtime)!=null&&A.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const d="The message port closed before a response was received.",c=o=>{const f={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(f).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class l extends WeakMap{constructor(s,t=void 0){super(t),this.createItem=s}get(s){return this.has(s)||this.set(s,this.createItem(s)),super.get(s)}}const Y=r=>r&&typeof r=="object"&&typeof r.then=="function",D=(r,s)=>(...t)=>{o.runtime.lastError?r.reject(new Error(o.runtime.lastError.message)):s.singleCallbackArg||t.length<=1&&s.singleCallbackArg!==!1?r.resolve(t[0]):r.resolve(t)},E=r=>r==1?"argument":"arguments",ee=(r,s)=>function(i,...x){if(x.length<s.minArgs)throw new Error(`Expected at least ${s.minArgs} ${E(s.minArgs)} for ${r}(), got ${x.length}`);if(x.length>s.maxArgs)throw new Error(`Expected at most ${s.maxArgs} ${E(s.maxArgs)} for ${r}(), got ${x.length}`);return new Promise((b,h)=>{if(s.fallbackToNoCallback)try{i[r](...x,D({resolve:b,reject:h},s))}catch(n){console.warn(`${r} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,n),i[r](...x),s.fallbackToNoCallback=!1,s.noCallback=!0,b()}else s.noCallback?(i[r](...x),b()):i[r](...x,D({resolve:b,reject:h},s))})},W=(r,s,t)=>new Proxy(s,{apply(i,x,b){return t.call(x,r,...b)}});let _=Function.call.bind(Object.prototype.hasOwnProperty);const S=(r,s={},t={})=>{let i=Object.create(null),x={has(h,n){return n in r||n in i},get(h,n,w){if(n in i)return i[n];if(!(n in r))return;let u=r[n];if(typeof u=="function")if(typeof s[n]=="function")u=W(r,r[n],s[n]);else if(_(t,n)){let v=ee(n,t[n]);u=W(r,r[n],v)}else u=u.bind(r);else if(typeof u=="object"&&u!==null&&(_(s,n)||_(t,n)))u=S(u,s[n],t[n]);else if(_(t,"*"))u=S(u,s[n],t["*"]);else return Object.defineProperty(i,n,{configurable:!0,enumerable:!0,get(){return r[n]},set(v){r[n]=v}}),u;return i[n]=u,u},set(h,n,w,u){return n in i?i[n]=w:r[n]=w,!0},defineProperty(h,n,w){return Reflect.defineProperty(i,n,w)},deleteProperty(h,n){return Reflect.deleteProperty(i,n)}},b=Object.create(r);return new Proxy(b,x)},L=r=>({addListener(s,t,...i){s.addListener(r.get(t),...i)},hasListener(s,t){return s.hasListener(r.get(t))},removeListener(s,t){s.removeListener(r.get(t))}}),re=new l(r=>typeof r!="function"?r:function(t){const i=S(t,{},{getContent:{minArgs:0,maxArgs:0}});r(i)}),U=new l(r=>typeof r!="function"?r:function(t,i,x){let b=!1,h,n=new Promise(C=>{h=function(y){b=!0,C(y)}}),w;try{w=r(t,i,h)}catch(C){w=Promise.reject(C)}const u=w!==!0&&Y(w);if(w!==!0&&!u&&!b)return!1;const v=C=>{C.then(y=>{x(y)},y=>{let O;y&&(y instanceof Error||typeof y.message=="string")?O=y.message:O="An unexpected error occurred",x({__mozWebExtensionPolyfillReject__:!0,message:O})}).catch(y=>{console.error("Failed to send onMessage rejected reply",y)})};return v(u?w:n),!0}),se=({reject:r,resolve:s},t)=>{o.runtime.lastError?o.runtime.lastError.message===d?s():r(new Error(o.runtime.lastError.message)):t&&t.__mozWebExtensionPolyfillReject__?r(new Error(t.message)):s(t)},q=(r,s,t,...i)=>{if(i.length<s.minArgs)throw new Error(`Expected at least ${s.minArgs} ${E(s.minArgs)} for ${r}(), got ${i.length}`);if(i.length>s.maxArgs)throw new Error(`Expected at most ${s.maxArgs} ${E(s.maxArgs)} for ${r}(), got ${i.length}`);return new Promise((x,b)=>{const h=se.bind(null,{resolve:x,reject:b});i.push(h),t.sendMessage(...i)})},ne={devtools:{network:{onRequestFinished:L(re)}},runtime:{onMessage:L(U),onMessageExternal:L(U),sendMessage:q.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:q.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},N={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return f.privacy={network:{"*":N},services:{"*":N},websites:{"*":N}},S(o,ne,f)};a.exports=c(chrome)}else a.exports=globalThis.browser})})(F);var T=F.exports;const p=z(T);async function $(e,m){var g,A,d;if(!m){const[c]=await p.tabs.query({active:!0,currentWindow:!0});if(!(c!=null&&c.id))throw new Error("Failed to get tab id");if((g=c.url)!=null&&g.startsWith("chrome"))throw new Error("Cannot access current tab");m=c.id}const a=await p.scripting.executeScript({files:["/src/content/index.js"],target:{tabId:m}});if((A=a[0])!=null&&A.error)throw new Error((d=a[0])==null?void 0:d.error);if(e&&e.type)return p.tabs.sendMessage(m,{message:e.type,...e})}function P(){}function V(e,m){return e!=e?m==m:e!==m||e&&typeof e=="object"||typeof e=="function"}const k=[];function Z(e,m=P){let a;const g=new Set;function A(o){if(V(e,o)&&(e=o,a)){const f=!k.length;for(const l of g)l[1](),k.push(l,e);if(f){for(let l=0;l<k.length;l+=2)k[l][0](k[l+1]);k.length=0}}}function d(o){A(o(e))}function c(o,f=P){const l=[o,f];return g.add(l),g.size===1&&(a=m(A,d)||P),o(e),()=>{g.delete(l),g.size===0&&a&&(a(),a=null)}}return{set:A,update:d,subscribe:c}}async function G(e,m){return(await T.storage.local.get(e))[e]??m}async function M(e){return await T.storage.local.get(e)}function R(e){return T.storage.local.set(e)}(B=p.runtime)!=null&&B.getBrowserInfo,p.runtime.getURL("");const H="https://tutorup.vercel.app";async function J(e,m,a){const g=await fetch(`${H}/api`,{method:"POST",headers:{license_key:e,"Content-Type":"application/json"},body:JSON.stringify(m),signal:a});if(g.status===504)throw new Error("Answering the question took too long");return await g.json()}const K="ms4QiBLIi81fdTaJKiVEig==";async function Q(e){const m=new URLSearchParams({product_id:K,license_key:e,increment_uses_count:!1}),a=await fetch("https://api.gumroad.com/v2/licenses/verify",{method:"POST",body:m}),{message:g,success:A,uses:d,subscription_cancelled_at:c,subscription_ended_at:o,subscription_failed_at:f}=await a.json();if(!a.ok||g)throw new Error(g??"Failed to validate license key");return{valid:A&&!(c||o||f),usage:d,last_validated:Date.now()}}const X=(()=>{let e;const m={key:"",status:{valid:!1,usage:0,last_validated:Date.now()},stealth:!1,advanced_ai:!1,answer_limit:1},{subscribe:a,set:g,update:A}=Z(m);d();async function d(){if(e){await e;return}e=M(m);const o=await e,f=(Date.now()-o.status.last_validated)/(1e3*60);if(o.key&&f>1)try{const l=await Q(o.key);o.status=l,c("status",l)}catch(l){c("status",{valid:!1,usage:0,last_validated:Date.now()}),console.error(l)}g(o),e=Promise.resolve({})}function c(o,f){R({[o]:f}),A(l=>(l[o]=f,l))}return{subscribe:a,init:d,changeSetting:c}})();let j=new AbortController;p.runtime.onInstalled.addListener(e=>{!{}.dev&&e.reason==="install"&&p.tabs.create({url:"https://tutorupes.com/thank-you/",active:!0})}),p.commands.onCommand.addListener(async(e,m)=>{X.init().then(async()=>{var g;const a=await M(null);(((g=a.status)==null?void 0:g.valid)??!1)&&a.stealth&&e==="stealth-mode"&&$({type:"snip"},m==null?void 0:m.id)})}),p.runtime.onMessage.addListener((e,m,a)=>{var g;if(e.message==="cancel"&&(j.abort(),j=new AbortController),e.message==="run")return $(e).then(()=>a("")).catch(A=>a(A.message)),!0;if(e.message==="capture"&&((g=m.tab)!=null&&g.id))return p.tabs.captureVisibleTab(void 0,{format:"png"}).then(a),!0;if(e.message==="query")return(async()=>{try{const{key:A,answer_limit:d=0,status:c}=await M(null);if(!(c!=null&&c.valid))if(d<10)await R({answer_limit:d+1});else return a({data:[{question:"Answer limit reached",answer:"Answer limit reached"}]});const o=await G("advanced_ai",!1),f=await J(A,{...e.data,advanced:o},j.signal);a(f)}catch(A){A instanceof Error&&a({error:1,message:A.message??"An error occurred, please try again."})}})(),!0})})();
