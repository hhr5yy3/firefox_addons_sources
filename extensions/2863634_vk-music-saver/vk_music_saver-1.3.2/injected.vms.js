(()=>{var t,e,n,o,s,r,a={7639:(t,e,n)=>{"use strict";n.d(e,{By:()=>o,Z$:()=>i,_P:()=>c,ay:()=>a,bD:()=>s,oP:()=>r});var o="vmsDownloadAudioButton--tOpkN",s="vmsDownloadAudioButton--loading--XdHNs",r="vmsDownloadAudioButton__icon--download--iOBV2",a="vmsDownloadAudioButton__icon--loading--JoIqJ",i="vmsDownloadAudioButton__icons--t58GV",c="vmsDownloadAudioButton__size--BbZTc"},2089:(t,e,n)=>{"use strict";n.d(e,{BG:()=>a,Ex:()=>o,Mk:()=>s,_K:()=>r});var o="vmsActionButton__icon--ZWPrT",s="vmsActionButton__text--Can8i",r="vmsAudioPlaylistSnippet__actionButton--W_87M",a="vmsAudioPlaylistSnippet__actions--ckSFS"},7477:(t,e,n)=>{"use strict";n.d(e,{$f:()=>o,oJ:()=>r,sE:()=>s});var o="vmsaudioRowReact--withBitrate--gqjU9",s="vmsaudioRow__bitrate--HWOsS",r="vmsaudioRow__info--withBitrate--G2XSb"},9285:()=>{},5477:(t,e,n)=>{"use strict";n.a(t,(async(t,o)=>{try{n.d(e,{A:()=>u});var s=n(5373),r=n(3409),a=n(6692),i=n(4201),c=t([s,a]);[s,a]=c.then?(await c)():c;const l=(t=[])=>t.map((t=>t.name)).join(", "),d=t=>{let e=t.performer||t.artist;if(!e){const n=l(t.main_artists||t.mainArtists),o=l(t.featured_artists||t.featArtists);e=n,o&&(e+=` feat. ${o}`)}return e},u=async({audioObject:t,onProgress:e})=>{if(!t)return void window.Notifier.showEvent({title:"VK Music Saver",text:s.A.use("vms_audio_not_found")});const n=await(0,i.A)(t);if(!n.url)return void window.Notifier.showEvent({title:"VK Music Saver",text:s.A.use("vms_audio_url_not_found")});let o=[d(n).trim(),n.title].join(" - ");n.subtitle&&(o+=` (${n.subtitle})`);try{const t=await(0,a.G)({audio:n,onProgress:e}),s=URL.createObjectURL(t);await(0,r.A)(s,`${o}.mp3`),URL.revokeObjectURL(s)}catch(t){throw console.error("Error downloading audio:",t),new Error("Failed to download audio")}};o()}catch(t){o(t)}}))},2669:(t,e,n)=>{"use strict";n.a(t,(async(t,o)=>{try{n.d(e,{A:()=>i});var s=n(1290),r=n(6692),a=t([r]);r=(a.then?(await a)():a)[0];const i=async({audio:t,lastModified:e,signal:n,playlist:o,audioIndex:a})=>{if(n.aborted)return null;if(!t.url)return null;try{const i=await(0,r.G)({audio:t,playlist:o,signal:n}),c=[`${a}. `,`${t.artist} - ${t.title}`];return t.subtitle&&c.push(` (${t.subtitle})`),c.push(".mp3"),{name:(0,s.A)(c.join("")),lastModified:t.date?new Date(1e3*t.date):e,input:i}}catch(t){return console.error("error download audio",t),null}};o()}catch(t){o(t)}}))},3254:(t,e,n)=>{"use strict";n.a(t,(async(t,o)=>{try{n.d(e,{A:()=>u});var s=n(5373),r=n(613),a=n(3409),i=n(987),c=n(3759),l=n(2669),d=t([s,l]);[s,l]=d.then?(await d)():d;const u=async t=>{const e={title:"VK Music Saver",text:s.A.use("vms_downloading")};try{window.Notifier.showEvent(e)}catch(t){console.error(t)}clearTimeout(e.closeTO),clearTimeout(e.fadeTO),delete e.startFading;const o=t=>{if(!e.baloonEl)return;if(!e.baloonEl.closest("body"))return;const n=e.baloonEl.getElementsByClassName("notifier_baloon_msg")[0];n&&(n.innerText=t)},[d,u,m]=t.split("_"),p=await(0,c.A)({owner_id:parseInt(d),playlist_id:parseInt(u),access_key:m});if(!p)return void window.Notifier.showEvent({title:"VK Music Saver",text:s.A.use("vms_playlist_not_found")});if(p?.error?.error_msg)return void window.Notifier.showEvent({title:"VK Music Saver",text:p.error.error_msg});if(!p.audios?.length)return void window.Notifier.showEvent({title:"VK Music Saver",text:s.A.use("vms_playlist_is_empty")});const _=new AbortController,{signal:w}=_,f=new Date,v=(p.main_artists||[]).map((t=>t.name)),h=[];v.length&&h.push(`${v.join(", ")} - `),p.title?h.push(p.title):h.push("playlist");const y=(0,i.A)(`${h.join("")}.zip`),A=[];let g=1,b=0;const E=p.audios.length;o(`${y} (${b}/${E})`);for(const t of(0,r.A)(p.audios,8)){if(w.aborted)return;for(const e of t){const t=(0,l.A)({audio:e,lastModified:f,signal:w,audioIndex:g++,playlist:p});t.then((()=>{b++,o(`${y} (${b}/${E})`)})),A.push(t)}await Promise.all(A)}const k=(await Promise.all(A)).filter((t=>!!t));if(w.aborted)return;o(`${y} - ${s.A.use("vms_archivation")}`);const{downloadZip:S}=await n.e(941).then(n.bind(n,1941)),L=await S(k).blob(),x=URL.createObjectURL(L);try{window.Notifier.hideEvent(e)}catch(t){console.error(t)}await(0,a.A)(x,y),URL.revokeObjectURL(x)};o()}catch(t){o(t)}}))},7502:(t,e,n)=>{"use strict";n.a(t,(async(t,o)=>{try{n.d(e,{A:()=>d});var s=n(5373),r=n(3409),a=n(987),i=n(312),c=n(3759),l=t([s]);s=(l.then?(await l)():l)[0];const d=async t=>{const[e,n,o]=t.split("_"),l=await(0,c.A)({owner_id:parseInt(e),playlist_id:parseInt(n),access_key:o});if(!l)return void window.Notifier.showEvent({title:"VK Music Saver",text:s.A.use("vms_playlist_not_found")});const d=(0,i.Z)(l);if(!d)return void window.Notifier.showEvent({title:"VK Music Saver",text:s.A.use("vms_album_cover_not_found")});const u=(l.main_artists||[]).map((t=>t.name)),m=[];u.length&&m.push(`${u.join(", ")} - `),l.title?m.push(l.title):m.push("playlist"),(0,r.A)(d,(0,a.A)(m.join(""))+".jpg")};o()}catch(t){o(t)}}))},4017:(t,e,n)=>{"use strict";n.a(t,(async(t,o)=>{try{n.d(e,{A:()=>p});var s=n(1572),r=n(4759),a=n(9249),i=n(1881),c=n(5373),l=n(7639),d=t([c]);c=(d.then?(await d)():d)[0];const u={20:r.A,24:i.A},m={20:s.A,24:a.A},p=({iconSize:t=20,enableDefaultText:e=!0}={})=>{let n=!1;const o=u[t],s=m[t],r=document.createElement("button");r.className=l.By,r.style.setProperty("--icon-size",`${t}px`);const a=document.createElement("span");a.className=l._P,e&&(a.innerText=c.A.use("vms_loading"));const i=document.createElement("div");i.className=l.Z$;const d=s();d.classList.add(l.oP);const p=o();return p.classList.add(l.ay),i.append(d,p),r.append(i,a),{element:r,setIsLoading:t=>{n=t,t?r.classList.add(l.bD):r.classList.remove(l.bD)},getIsLoading:()=>n,setText:t=>{a.innerText=t}}};o()}catch(t){o(t)}}))},5220:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=({mode:t="primary",appearance:e="accent",size:n="s"}={})=>{let o=!1;const s=document.createElement("button");s.className=`vkuiButton vkuiButton--align-center vkuiButton--appearance-${e} vkuiButton--mode-${t} vkuiButton--size-${n} vkuiClickable__host vkuiClickable__realClickable vkuiClickable__resetButtonStyle vkuiRootComponent vkuiTappable vkuiTappable--hasPointer-none`,s.type="button",s.setAttribute("aria-expanded","false"),s.classList.add("vmsvkuiButton--_IK3H");const r=document.createElement("span");r.className="vkuiButton__in";const a=document.createElement("span");return a.className="vkuiButton__content",r.appendChild(a),s.appendChild(r),{element:s,setIsLoading:t=>{o=t,t?s.setAttribute("disabled",""):s.removeAttribute("disabled")},getIsLoading:()=>o,setText:t=>{a.innerText=t}}}},2393:(t,e,n)=>{"use strict";n.d(e,{A:()=>s});const o={},s=()=>{try{if("vknext"in globalThis)return globalThis.vknext;globalThis.vknext=o}catch(t){console.error(t)}return o}},2447:(t,e,n)=>{"use strict";n.d(e,{A:()=>d});var o=n(7054);let s=null;const r=async t=>document.body?document.body:s&&!t?s:(s=new Promise((t=>{if(document.body)return t(document.body);const e=new MutationObserver((()=>{document.body&&(t(document.body),e.disconnect())}));e.observe(document.documentElement,{childList:!0})})),await s);let a=null;var i=n(118),c=n(2809);const l=new Map,d=t=>{if(l.has(t))return l.get(t);const e=new Promise((async e=>{await r();let n=null,s=!1;const d=()=>!!window[t]&&(e(window[t]),l.delete(t),n&&clearInterval(n),s=!0,!0);if(d())return;const u=window.navigator.hardwareConcurrency;n=setInterval((()=>requestIdleCallback(d)),("loading"===document.readyState?1e4:5e4)/u);const m=new MutationObserver((()=>{d()&&(m.disconnect(),s=!0)}));m.observe(document.documentElement,{childList:!0});const p=await(async t=>document?.head?document.head:a&&!t?a:(a=new Promise((t=>{if(document?.head)return t(document.head);const e=new MutationObserver((()=>{document?.head&&(t(document.head),e.disconnect())}));e.observe(document.documentElement,{childList:!0})})),await a))();if(m.disconnect(),"loading"===document.readyState&&(await(0,i.A)(),await(0,c.A)()),s)return;m.observe(p,{childList:!0}),await new Promise(o.A);const _=await r();s||m.observe(_,{childList:!0})}));return l.set(t,e),e}},5014:(t,e,n)=>{"use strict";n.d(e,{A:()=>s});var o=n(2447);const s=()=>(0,o.A)("nav")},6757:(t,e,n)=>{"use strict";n.d(e,{A:()=>s});var o=n(2447);const s=()=>(0,o.A)("uiActionsMenu")},1572:(t,e,n)=>{"use strict";n.d(e,{A:()=>s});var o=n(3789);const s=()=>(0,o.A)('<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path clip-rule="evenodd" d="m4 17.75c0-.4142.33579-.75.75-.75h10.5c.4142 0 .75.3358.75.75s-.3358.75-.75.75h-10.5c-.41421 0-.75-.3358-.75-.75z" fill-rule="evenodd"/><path d="m10.7493 2.72581c0-.40086-.3355-.72581-.74931-.72581-.41385 0-.74933.32495-.74933.72581l-.00001 9.72199-3.97032-3.97029c-.29289-.29289-.76777-.29289-1.06066 0s-.29289.76777 0 1.06066l5.24532 5.24533c.2929.2929.76781.2929 1.06071 0l5.2558-5.25585c.2929-.2929.2929-.76777 0-1.06067-.2929-.29289-.7678-.29289-1.0606 0l-3.9716 3.97152z"/></g></svg>\n')},4759:(t,e,n)=>{"use strict";n.d(e,{A:()=>s});var o=n(3789);const s=()=>(0,o.A)('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M13.771 4.103a7 7 0 0 0-10.125 8.834.75.75 0 0 1-1.362.629A8.5 8.5 0 1 1 10 18.5a.75.75 0 0 1 0-1.5 7 7 0 0 0 3.771-12.897Z" clip-rule="evenodd"/></svg>\n')},9249:(t,e,n)=>{"use strict";n.d(e,{A:()=>s});var o=n(3789);const s=()=>(0,o.A)('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12.002 2a.9.9 0 0 1 .9.9v11.002l4.562-4.631a.9.9 0 1 1 1.283 1.263l-6.104 6.195a.9.9 0 0 1-1.284-.001l-6.09-6.206a.9.9 0 1 1 1.286-1.26l4.547 4.633V2.9a.9.9 0 0 1 .9-.9Zm-8 18.1a.9.9 0 0 1 .9-.9h14.2a.9.9 0 1 1 0 1.8h-14.2a.9.9 0 0 1-.9-.9Z" clip-rule="evenodd"/></svg>\n')},1881:(t,e,n)=>{"use strict";n.d(e,{A:()=>s});var o=n(3789);const s=()=>(0,o.A)('<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">\n  <path clip-rule="evenodd" d="M16.394 5.077A8.2 8.2 0 0 0 4.58 15.49a.9.9 0 0 1-1.628.767A10 10 0 1 1 12 22a.9.9 0 0 1 0-1.8 8.2 8.2 0 0 0 4.394-15.123z" fill="currentColor" fill-rule="evenodd"/>\n</svg>\n')},5810:(t,e,n)=>{"use strict";n.a(t,(async(t,e)=>{try{n(2495);var o=n(495),s=n(4305),r=(n(9285),n(2393)),a=n(3980),i=n(357),c=n(5275),l=n(3299),d=t([o,s,a,i,c]);[o,s,a,i,c]=d.then?(await d)():d,(0,r.A)().vms_installed=!0,(async()=>{try{(0,s.A)()}catch(t){console.error("[VMS/initShowBitrateNearDuration]",t)}try{(0,o.A)()}catch(t){console.error("[VMS/injectDownloadButtonInAudioRow]",t)}try{(0,a.A)()}catch(t){console.error("[VMS/initAudioPage]",t)}try{await(0,i.A)()}catch(t){console.error("[VMS/initAudioPlaylist]",t)}try{(0,c.A)()}catch(t){console.error("[VMS/initFeed]",t)}try{"webpack"in(0,r.A)()||(0,l.A)()}catch(t){console.error("[VMS/initVKNextBanner]",t)}})().catch(console.error),e()}catch(t){e(t)}}))},4640:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=class{_listeners=[];addListener(t){return this._listeners.includes(t)||this._listeners.push(t),{remove:()=>this.removeListener(t)}}removeListener(t){const e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}get listeners(){return[...this._listeners]}}},2287:(t,e,n)=>{"use strict";n.d(e,{A:()=>d});var o=n(2447);var s=n(5014),r=n(7054);const a=new(n(4640).A),i=t=>{for(const e of a.listeners)e(t)},c=()=>{for(const t of document.querySelectorAll(".AudioPlayerBlock__root"))i(t)};let l=!1;const d=t=>{const e=a.addListener(t);return(0,r.A)(c),l||(l=!0,(0,s.A)().then((()=>{window.nav.onLocationChange((t=>{t.startsWith("audio")&&c()})),(async()=>{await(0,o.A)("audioLayer"),window.audioLayer._initSection||(window.audioLayer._initSection=void 0),((t,e,n)=>{if(!(e in t))throw console.warn("[VMS/objectHook]:",t,t[e]),new Error(`[VMS/objectHook]: object "${e}" not found`);let o=t[e];try{n(o)}catch(t){console.error(t)}Object.defineProperty(t,e,{get:()=>o,set(t){o=t;try{n(o)}catch(t){console.error(t)}return o}})})(window.audioLayer,"_initSection",c)})().catch(console.error)}))),e}},2446:(t,e,n)=>{"use strict";n.d(e,{A:()=>w});var o=n(6339),s=n(2809),r=n(2447);var a=n(5014),i=n(7054),c=n(118);const l=new(n(4640).A),d=t=>{for(const e of l.listeners)e(t)},u=async t=>{t&&await(0,o.A)(1e3),await(0,s.A)(),await(0,c.A)();const e=document.querySelectorAll(".audio_row");for(const t of e)await(0,s.A)(),d(t);(()=>{const t=document.querySelectorAll(".audio_pl_snippet__list");for(const e of t)e._vms_mbs||(e._vms_mbs=new MutationObserver((t=>{for(const e of t)if("childList"===e.type&&e.addedNodes.length)for(const t of e.addedNodes)t instanceof HTMLElement&&t.classList.contains("audio_row")&&d(t)})),e._vms_mbs.observe(e,{childList:!0}))})()},m=["section","load_catalog_section","load_block_playlist","load_section"],p=async()=>{await(0,r.A)("ajax");const t=window.ajax.post;window.ajax.post=function(...e){try{const[t,n,o]=e,s=t.startsWith("al_audio.php")||t.startsWith("/audio");let r=n.act;if(s&&!r&&(r=new URL(t,window.location.origin).searchParams.get("act")),r&&m.includes(r)&&o.onDone){const t=o.onDone;o.onDone=function(...e){const n=t.apply(this,e);n instanceof Promise?n.finally((()=>u(!0))):u(!0).catch(console.error)}}}catch(t){console.error("[VMS/ajax/post]",t)}return t.apply(this,e)}};let _=!1;const w=t=>{const e=l.addListener(t);return(0,i.A)(u),_||(_=!0,p(),(0,a.A)().then((()=>{window.nav.onLocationChange((t=>{(t.startsWith("audio")||t.startsWith("music"))&&u()}))}))),e}},4313:(t,e,n)=>{"use strict";n.d(e,{A:()=>f});var o=n(6339);function s(t){const e={};if(!t)return e;for(const n of Object.keys(t))n.startsWith("__reactFiber")&&(e.fiber=t[n]),n.startsWith("__reactProps")&&(e.props=t[n]),n.startsWith("__reactContainer")&&(e.container=t[n]);return e}var r=n(6569),a=n(118),i=n(2809),c=n(4640),l=n(7964),d=n(6198);const u=new c.A,m='[class*="AudioRow__root"]',p=t=>{if(t.attributes.getNamedItem("disabled"))return;const e=(t=>{const{props:e}=s(t);if(e?.children?.props?.audio?.apiAudio)return e.children.props.audio.apiAudio;if(t.parentElement){const{props:e}=s(t.parentElement);if(e.children?.props?.audio?.apiAudio)return e.children.props.audio.apiAudio}return null})(t);for(const n of u.listeners)n(t,e)},_=async(t=0)=>{if(document.querySelector('.vkui__root .vkuiFlex [class*="Skeleton__skeleton"]'))return await(0,o.A)(1e3),_(t+1);await(0,i.A)(),await(0,a.A)();const e=document.querySelectorAll(m);for(const t of e)await(0,i.A)(),p(t);await(async()=>{for(const t of document.querySelectorAll('[class*="AudioListItems__root--"] > div'))t._vms_mbs||(t._vms_mbs=new MutationObserver((t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)if(t instanceof HTMLElement)if(t.matches(m))p(t);else for(const e of t.querySelectorAll(m))p(e)})),t._vms_mbs.observe(t,{childList:!0}))})()};let w=!1;const f=t=>{const e=u.addListener(t);return(0,r.A)(_),w||(w=!0,(0,l.A)((()=>_())),(0,d.A)((()=>_()))),e}},459:(t,e,n)=>{"use strict";n.d(e,{A:()=>b});var o=n(2447);var s=n(5014),r=n(6339),a=n(7054),i=n(118),c=n(2809),l=n(4640);const d=[".Post--redesign",".post","._post:not(.reply)",".Post",".FeedBlockWrap"].join(","),u=[".wall_module","#public_wall"].join(","),m=["#page_wall_posts",".page_wall_posts","#page_donut_posts"].join(","),p=["#feed_rows","._feed_rows"].join(","),_=new l.A,w=async t=>{for(const e of _.listeners)await(0,c.A)(),e(t)},f=t=>{t._vms_ibs||(t._vms_ibs=new IntersectionObserver((async e=>{for(const n of e)n.isIntersecting&&w(t)}),{threshold:.05}),t._vms_ibs.observe(t))},v=async()=>(await(0,i.A)(),document.querySelectorAll(d)),h=["feed","public","profile","wall","groups"];let y=null;const A=async()=>{if(null!==y&&(clearTimeout(y),y=null),document.getElementById("FeedPageSkeleton"))return void(y=setTimeout((()=>{y=null,A()}),2e3));const t=document.querySelectorAll(u);for(const e of t){await(0,c.A)();const t=e.querySelector(p);if(t){if(t._vms_mbs)continue;t._vms_mbs=new MutationObserver((async t=>{for(const e of t)if(e.addedNodes.length)for(const t of e.addedNodes){await(0,c.A)();const e=t.querySelector(d);e&&f(e)}})),t._vms_mbs.observe(t,{childList:!0})}}const e=document.querySelectorAll(m);for(const t of e)t._vms_mbs||(await(0,c.A)(),t._vms_mbs=new MutationObserver((async t=>{for(const e of t)if(e.addedNodes.length)for(const t of e.addedNodes)await(0,c.A)(),await w(t)})),t._vms_mbs.observe(t,{childList:!0}));await(0,c.A)();for(const t of await v())f(t)};let g=!1;const b=t=>{const e=_.addListener(t);return(0,a.A)((async()=>{const e=await v();for(const n of e)t(n)})),g||(g=!0,(async()=>{await(0,s.A)(),await(0,o.A)("cur"),window.nav.subscribeOnModuleEvaluated((async()=>{const t=window.cur.module;h.includes(t)&&("profile"===t&&await(0,r.A)(1e3),A())})),window.cur?.module||await new Promise((t=>(0,a.A)(t))),(h.includes(window.cur.module)||void 0===window.cur.module)&&await A()})()),e}},7964:(t,e,n)=>{"use strict";n.d(e,{A:()=>d});var o=n(5014),s=n(6339),r=n(6569),a=n(118);const i=new(n(4640).A),c=t=>t.replace("audio_playlist","").replace("/","_");let l=!1;const d=t=>{const e=i.addListener(t);return(0,r.A)((()=>{const e=new URLSearchParams(window.location.search).get("z");e&&e.startsWith("audio_playlist")&&requestAnimationFrame((()=>t(c(e)))),(async()=>{l||(l=!0,await(0,o.A)(),window.nav.onLocationChange((async()=>{const t=window.nav.objLoc.z;t&&t.startsWith("audio_playlist")&&(await(0,s.A)(1e3),await(0,a.A)(),(t=>{const e=c(t);for(const t of i.listeners)t(e)})(t))})))})()})),e}},6198:(t,e,n)=>{"use strict";n.d(e,{A:()=>l});var o=n(5014),s=n(6339),r=n(6569),a=n(118);const i=new(n(4640).A);let c=!1;const l=t=>{const e=i.addListener(t);return(0,r.A)((()=>{(window.location.pathname.startsWith("/music/album")||window.location.pathname.startsWith("/music/playlist"))&&requestAnimationFrame((()=>t())),(async()=>{c||(c=!0,await(0,o.A)(),window.nav.onLocationChange((async t=>{(t.startsWith("music/album")||t.startsWith("music/playlist"))&&(await(0,s.A)(1e3),await(0,a.A)(),(()=>{for(const t of i.listeners)t()})())})))})()})),e}},335:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=class{isDebug=!1;decodedKeys;constructor(t){this.decodedKeys=t}use(t,e={},n="decode"){if(!t)return"...";if(this.isDebug)return t;if(!(t in this.decodedKeys))return"";let o=this.decodedKeys[t];if("raw"===n)return o;if(Array.isArray(o)&&"number"==typeof e)return((t,e,n=!0,o=!0)=>`${n?t:""} ${o?e[4<t%100&&t%100<20?2:[2,0,1,1,1,2][Math.min(t%10,5)]]:""}`.trim())(e,o);if("string"==typeof o&&e&&"object"==typeof e)for(const[t,n]of o.matchAll(/\{(.*?)\}/g)){const s=e[n]||"";o=String(o).replace(t,s)}return o}toggleDebug(){this.isDebug=!this.isDebug}}},6636:(t,e,n)=>{"use strict";n.d(e,{A:()=>a});var o=n(2447);var s=n(8281);const r={0:"default",1:"Ukrainian",3:"English",6:"German",15:"Polish",97:"Kazakh",114:"Belarusian",777:"Soviet",73:"Portuguese, Brazilian"},a=async()=>{await(0,o.A)("vk");const t="number"==typeof window.vk?.lang?window.vk.lang:/^ru\b/.test(navigator.language)?0:/^uk\b/.test(navigator.language)?1:/^en\b/.test(navigator.language)?3:/^de\b/.test(navigator.language)?6:/^pl\b/.test(navigator.language)?15:/^kk\b/.test(navigator.language)?97:/^be\b/.test(navigator.language)?114:3,e=await(async t=>{try{const{default:e}=await n(7251)(`./${r[t]}`);return e}catch(t){console.error(t)}return{}})(t);return{...s.default,...e}}},5373:(t,e,n)=>{"use strict";n.a(t,(async(t,o)=>{try{n.d(e,{A:()=>t});var s=n(6636);const t=new(n(335).A)(await(0,s.A)());o()}catch(t){o(t)}}),1)},8281:(t,e,n)=>{"use strict";n.d(e,{default:()=>o});const o={vms_download:"Скачать",vms_loading:"Загрузка...",vms_error:"Ошибка",vms_download_cover:"Скачать обложку",vms_download_playlist:"Скачать плейлист",vms_downloading:"Скачивается...",vms_playlist_is_empty:"Плейлист пуст.",vms_playlist_not_found:"Плейлист не найден",vms_audio_not_found:"Трек не найден",vms_audio_url_not_found:"Отсутствует ссылка на трек",vms_album_cover_not_found:"У этого альбома нет обложки",vms_archivation:"архивация..."}},7054:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=t=>{"loading"!==document.readyState?t():document.addEventListener("DOMContentLoaded",t,{once:!0})}},613:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=(t,e=100)=>{const n=[...t],o=[];for(;n.length;)o.push(n.splice(0,e||n.length));return o}},7390:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=t=>{t.preventDefault?.(),t.stopPropagation?.(),t.stopImmediatePropagation?.()}},1024:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=t=>new Promise(((e,n)=>{const o=new FileReader;o.onload=t=>{if(t.target&&t.target.result instanceof ArrayBuffer){const n=t.target.result,o=new Uint8Array(n);e(o)}else n(new Error("Invalid result"))},o.onerror=t=>{n(t)},o.readAsArrayBuffer(t)}))},6339:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=t=>new Promise((e=>setTimeout(e,t)))},1290:(t,e,n)=>{"use strict";n.d(e,{A:()=>s});const o=/\/|\\|:|\*|\?|"|<|>|\||\+|%|@|@\\0/g,s=t=>t.replaceAll(o,"_")},7231:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=t=>`${Math.round(100*t)}%`},9070:(t,e,n)=>{"use strict";n.d(e,{A:()=>r});const o=1024,s=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],r=(t,e=1)=>{if(Math.abs(t)<o)return`${t.toFixed(e)} ${s[0]}`;let n=0;const r=10**e;do{t/=o,n++}while(Math.round(Math.abs(t)*r)/r>=o&&n<s.length-1);return`${t.toFixed(e)} ${s[n]}`}},6569:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=t=>{if("complete"===document.readyState)return void t();const e=()=>{"complete"===document.readyState&&(t(),document.removeEventListener("readystatechange",e))};document.addEventListener("readystatechange",e)}},3789:(t,e,n)=>{"use strict";n.d(e,{A:()=>s});let o=0;const s=t=>{const e=!!document.importNode;let n=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement;e&&(n=document.importNode(n,!0));for(const t of n.querySelectorAll("title,desc"))t.remove();for(const t of n.querySelectorAll("[id]")){if(!t.id)continue;const e="vms_icon-"+o++;let s=!1;for(const o of n.querySelectorAll(`[fill="url(#${t.id})"]`))o.setAttribute("fill",`url(#${e})`),s=!0;s&&(t.id=e)}return n}},3409:(t,e,n)=>{"use strict";n.d(e,{A:()=>r});const o=t=>{try{t.dispatchEvent(new MouseEvent("click"))}catch(e){const n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}},s=async(t,e="download")=>{const n=document.createElement("a");n.download=e,n.rel="noopener",globalThis?.chrome?.runtime?.id&&(n.target="_blank"),"string"==typeof t?(n.href=t,n.origin!==location.origin?await(async t=>{try{const e=await globalThis.fetch(t,{method:"HEAD"});return e.status>=200&&e.status<=299}catch(t){console.error(t)}return!1})(n.href)?await(async(t,e)=>{try{const n=await globalThis.fetch(t,{method:"GET"}),o=await n.blob();await s(o,e)}catch(t){console.error(t)}})(t,e):(n.target="_blank",o(n)):o(n)):(n.href=URL.createObjectURL(t),setTimeout((()=>{URL.revokeObjectURL(n.href)}),4e4),setTimeout((()=>{o(n)}),0))},r=s},987:(t,e,n)=>{"use strict";n.d(e,{A:()=>s});const o=document.createElement("textarea"),s=t=>(o.innerHTML=t,o.innerText)},118:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=async()=>await new Promise((t=>requestAnimationFrame(t)))},2809:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=async()=>await new Promise((t=>requestIdleCallback(t)))},9188:(t,e,n)=>{"use strict";n.d(e,{A:()=>r});const o=new Map,s=t=>t.trim().toLowerCase().replaceAll("ё","е"),r=async({title:t,mainArtists:e,featuredArtists:n,performer:r,signal:a})=>{const i=((t,e,n=[])=>{const o=s(t)+" "+e.map((t=>s(t.name))).concat(n).join(" ");return s(o)})(t,r?[{name:r}]:"string"==typeof e?[{name:e}]:e,n);if(o.has(i))return o.get(i);let c;try{const t=await fetch("https://api.genius.com/search?"+new URLSearchParams({q:i}),{signal:a});if(200!==t.status)return"";c=await t.json()}catch(t){return console.error("Error fetching search results:",t),""}const l=c?.response?.hits||[];let d=l.find((e=>s(e?.result?.title)===s(t)));if(!d){const t=[],e=l.filter((e=>{if(e?.result?.title){const n=s(e.result.full_title||[e.result.title,e.result.artist_names].filter((t=>t)).join(" ")),o=i.split(" ").filter((t=>!n.includes(t))).length,r=o<3;return r&&t.push(o),r}return!1}));let n=4;for(const[o,s]of Object.entries(t))n>s&&(n=s,d=e[o])}if(!d)return o.set(i,""),"";const u=d.result?.id;if(!u)return o.set(i,""),"";try{c=await fetch(`https://api.genius.com/songs/${u}?text_format=plain`,{signal:a}),c=await c.json()}catch(t){return console.error("Error fetching song details:",t),""}const m=c?.response?.song?.lyrics?.plain?.trim()||"";return o.set(i,m),m}},1505:(t,e,n)=>{"use strict";n.d(e,{A:()=>r});var o=n(6339);const s=async(t,e=0)=>{if(5===e)throw new Error("[VMS/audio hooks] users controls not found");return t.querySelector('[class*="AudioPlayerUserControlsContainer__userButtonsContainer--"]')||(await(0,o.A)(1e3),s(t,e+1))},r=s},3980:(t,e,n)=>{"use strict";n.a(t,(async(t,o)=>{try{n.d(e,{A:()=>h});var s=n(5477),r=n(4017),a=n(2447),i=n(2287),c=n(6198),l=n(5373),d=n(7390),u=n(7231),m=n(9070),p=n(3866),_=n(1505),w=t([s,r,l]);[s,r,l]=w.then?(await w)():w;const f=()=>window.AudioUtils.audioTupleToAudioObject(window.ap.getCurrentAudio()),v=async t=>{if(t._vms_inj)return;t._vms_inj=!0;const e=await(0,_.A)(t),{setIsLoading:n,setText:o,element:i,getIsLoading:c}=(0,r.A)(),w=document.createElement("div");w.style.paddingRight="12px",w.appendChild(i),e.prepend(w),i.addEventListener("click",(t=>{if((0,d.A)(t),c())return;const e=f();e&&(n(!0),o(l.A.use("vms_loading")),(0,s.A)({audioObject:e,onProgress:t=>{o((0,u.A)(t))}}).finally((()=>{n(!1),v().catch(console.error)})))}));const v=async()=>{const t=f();if(!t)return void o("");o(l.A.use("vms_loading"));const e=await(0,p.A)(t);o(e?.size?(0,m.A)(e.size,2):"")};v().catch(console.error),await(0,a.A)("ap"),window.ap.on(null,"curr",(()=>{v()}))},h=()=>{(0,i.A)(v),(0,c.A)((()=>{for(const t of document.querySelectorAll('[data-testid="audioplayerblocksectionslayout"],[class*="AudioPlayerBlockSectionsLayout__root"]'))v(t)}))};o()}catch(t){o(t)}}))},357:(t,e,n)=>{"use strict";n.a(t,(async(t,o)=>{try{n.d(e,{A:()=>g});var s=n(3254),r=n(7502),a=n(5220),i=n(6757),c=n(9249),l=n(7964),d=n(6198),u=n(5373),m=n(6339),p=n(2089),_=t([s,r,u]);[s,r,u]=_.then?(await _)():_;const w=async t=>{if(!t.classList.contains("audio_pl_snippet__action_btn"))return;const e=t.querySelector(".ui_actions_menu");if(!e||e.vms_down_inj)return;e.vms_down_inj=!0;const n=document.createElement("div");n.className="ui_actions_menu_item",n.innerText=u.A.use("vms_download"),n.addEventListener("click",(async()=>{const e=t.closest(".audio_pl_snippet2");e?.dataset?.playlistId?await(0,s.A)(e.dataset.playlistId.replace("playlist_","")):window.Notifier.showEvent({title:"VK Music Saver",text:u.A.use("vms_playlist_not_found")})}));const o=document.createElement("div");o.className="ui_actions_menu_item",o.innerText=u.A.use("vms_download_cover"),o.addEventListener("click",(async()=>{const e=t.closest(".audio_pl_snippet2");e?.dataset?.playlistId?await(0,r.A)(e.dataset.playlistId.replace("playlist_","")):window.Notifier.showEvent({title:"VK Music Saver",text:u.A.use("vms_playlist_not_found")})})),e.prepend(n,o)},f=async()=>{await(0,i.A)();const t=window.uiActionsMenu.show;window.uiActionsMenu.show=function(...e){try{w(e[0])}catch(t){console.error(t)}return t.apply(this,e)}},v=async()=>{const t=document.querySelector(".AudioPlaylistSnippet");if(!t)return;const{playlistId:e}=t.dataset;if(!e)return;const n=t.querySelector(".AudioPlaylistSnippet__header");if(!n||n.vms_down_inj)return;n.vms_down_inj=!0;const o=document.createElement("div");o.className=p.BG;const r=document.createElement("button");r.className=p._K,r.addEventListener("click",(()=>(0,s.A)(e.replace("playlist_","")).catch(console.error)));const a=document.createElement("div");a.className=p.Ex,a.appendChild((0,c.A)());const i=document.createElement("span");i.className=p.Mk,i.innerText=u.A.use("vms_download_playlist"),r.append(a,i),o.appendChild(r),n.appendChild(o)},h=async()=>{const t=document.querySelector(".AudioPlaylistSnippet__actionButton .ActionsMenu__inner");if(!t)return void v();if(t.vms_down_inj)return;t.vms_down_inj=!0;const e=document.createElement("button");e.className="ActionsMenu__item",e.innerText=u.A.use("vms_download"),e.addEventListener("click",(async()=>{const e=t.closest(".AudioPlaylistSnippet");e?.dataset?.playlistId?await(0,s.A)(e.dataset.playlistId.replace("playlist_","")):window.Notifier.showEvent({title:"VK Music Saver",text:u.A.use("vms_playlist_not_found")})})),t.prepend(e)},y=async(t=0)=>{if(t>10)throw new Error("[VK Next/audioPlaylist] Failed to inject");const e=document.getElementById("spa_root");if(!e)return;if(e.querySelector('[class*="Skeleton__skeleton"]'))return await(0,m.A)(1e3),y(t+1);const n=e.querySelector('[class*="AudioListHeader__actions--"]');if(!n)return;if(n.vms_down_inj)return;n.vms_down_inj=!0;const{element:o,setIsLoading:r,setText:i,getIsLoading:c}=(0,a.A)({mode:"secondary",appearance:"neutral",size:"m"});i(u.A.use("vms_download")),o.addEventListener("click",(async()=>{if(!c()){r(!0);try{const t=location.pathname.split("/").at(-1);if(!t)return void window.Notifier.showEvent({title:"VK Music Saver",text:u.A.use("vms_playlist_not_found")});await(0,s.A)(t)}catch(t){console.error(t)}r(!1)}})),n.appendChild(o)},A=async(t,e=0)=>{if(document.querySelector('.vkui__root .vkuiFlex [class*="Skeleton__skeleton"]'))return await(0,m.A)(1e3),A(t,e+1);for(const e of document.querySelectorAll('[class*="AudioListModalHeader__actions--"]')){if(!e)return;if(e.vms_down_inj)return;e.vms_down_inj=!0;const n=e.querySelector(".vkuiFlex"),{element:o,setIsLoading:r,setText:i,getIsLoading:c}=(0,a.A)({mode:"primary",appearance:"overlay",size:"m"});i(u.A.use("vms_download")),o.addEventListener("click",(async()=>{if(!c()){r(!0);try{await(0,s.A)(t)}catch(t){console.error(t)}r(!1)}})),(n||e).appendChild(o)}},g=async()=>{f().catch(console.error),(0,d.A)((()=>{h().catch(console.error),y().catch(console.error)})),(0,l.A)(A)};o()}catch(t){o(t)}}))},5275:(t,e,n)=>{"use strict";n.a(t,(async(t,o)=>{try{n.d(e,{A:()=>v});var s=n(5477),r=n(3254),a=n(4017),i=n(459),c=n(5373),l=n(7390),d=n(7231),u=n(9070),m=n(118),p=n(3866),_=t([s,r,a,c]);[s,r,a,c]=_.then?(await _)():_;const w=async t=>{const e=t.dataset.audio;if(!e)return;const n=window.AudioUtils.audioTupleToAudioObject(JSON.parse(e));if(!n||n?.restrictionStatus)return;if(t.vms_down_inj)return;t.vms_down_inj=!0,await(0,m.A)();const o=t.querySelector(".SecondaryAttachment__after");if(!o)return;const{setIsLoading:r,setText:i,element:_,getIsLoading:w}=(0,a.A)({iconSize:24}),f=async()=>{const t=await(0,p.A)(n),e=[];t?.bitrate&&e.push(`${t.bitrate} kb/s`),t?.size&&e.push((0,u.A)(t.size,2)),i(e.join("\n"))};f().catch(console.error),_.addEventListener("click",(t=>{(0,l.A)(t),w()||(r(!0),i(c.A.use("vms_loading")),(0,s.A)({audioObject:n,onProgress:async t=>{i((0,d.A)(t))}}).finally((()=>{r(!1),f().catch(console.error)})))}));const v=o.querySelector('[data-task-click="SecondaryAttachment/addAudio"]');v?o.insertBefore(_,v):o.prepend(_)},f=async t=>{const e=[];if(t.dataset.ownerId&&e.push(t.dataset.ownerId),t.dataset.playlistId&&e.push(t.dataset.playlistId),t.dataset.accessKey&&e.push(t.dataset.accessKey),!e.length)return void window.Notifier.showEvent({title:"VK Music Saver",text:c.A.use("vms_playlist_not_found")});if(t.vms_down_inj)return;t.vms_down_inj=!0,await(0,m.A)();const n=t.querySelector(".SecondaryAttachment__after");if(!n)return;const{setIsLoading:o,element:s,getIsLoading:i}=(0,a.A)({iconSize:24,enableDefaultText:!1});s.classList.add("SecondaryAttachment__buttonBase--action"),s.addEventListener("click",(t=>{(0,l.A)(t),i()||(o(!0),(0,r.A)(e.join("_")).catch(console.error).finally((()=>{o(!1)})))})),n.prepend(s)},v=()=>{(0,i.A)((t=>{for(const e of t.querySelectorAll(".SecondaryAttachment[data-audio]"))w(e).catch(console.error);for(const e of t.querySelectorAll(".SecondaryAttachment[data-playlist-id]"))f(e).catch(console.error)}))};o()}catch(t){o(t)}}))},495:(t,e,n)=>{"use strict";n.a(t,(async(t,o)=>{try{n.d(e,{A:()=>v});var s=n(5477),r=n(4017),a=n(2446),i=n(4313),c=n(5373),l=n(7390),d=n(7231),u=n(9070),m=n(3866),p=t([s,r,c]);[s,r,c]=p.then?(await p)():p;const _=(t,e)=>{const{setIsLoading:n,setText:o,element:a,getIsLoading:i}=(0,r.A)({iconSize:e}),p=async()=>{const e=await(0,m.A)(t);o(e?.size?(0,u.A)(e.size,2):"")};return a.addEventListener("click",(e=>{(0,l.A)(e),i()||(n(!0),o(c.A.use("vms_loading")),(0,s.A)({audioObject:t,onProgress:async t=>{o((0,d.A)(t))}}).finally((()=>{n(!1),p().catch(console.error)})))})),new IntersectionObserver((async(t,e)=>{t.forEach((async t=>{t.isIntersecting&&(await p(),e.unobserve(a))}))}),{threshold:.5}).observe(a),a},w=async t=>{const e=t.dataset.audio;if(!e)return;const n=AudioUtils.audioTupleToAudioObject(JSON.parse(e));if(!n)return;if(n?.restrictionStatus||t.classList.contains("audio_row__deleted"))return;const o=t.querySelector(".audio_row__inner");o&&(o._vms_inj||(o._vms_inj=!0,o.appendChild(_(n))))},f=async(t,e)=>{if(!e)return void console.error("no audio",{audioRow:t});const n=t.querySelector('[class*="AudioRow__actions--"]');if(!n)return;if(n._vms_inj)return;n._vms_inj=!0;const o=n.querySelector(".vkuiButtonGroup"),s=_(e,24);(o||n).prepend(s)},v=()=>{(0,a.A)(w),(0,i.A)(f)};o()}catch(t){o(t)}}))},4305:(t,e,n)=>{"use strict";n.a(t,(async(t,o)=>{try{n.d(e,{A:()=>p});var s=n(2446),r=n(4313),a=n(5373),i=n(3866),c=n(7477),l=t([a]);a=(l.then?(await l)():l)[0];const d=t=>{const e=document.createElement("span");return e.className=c.sE,e.innerText=a.A.use("vms_loading"),new IntersectionObserver((async(n,o)=>{n.forEach((async n=>{if(n.isIntersecting){const n=await(0,i.A)(t);e.innerText=n?.bitrate?`${n.bitrate}`:a.A.use("vms_error"),o.unobserve(e)}}))}),{threshold:.1}).observe(e),e},u=async t=>{const e=t.dataset.audio;if(!e)return;const n=AudioUtils.audioTupleToAudioObject(JSON.parse(e));if(!n)return;if(n?.restrictionStatus||t.classList.contains("audio_row__deleted"))return;const o=t.querySelector(".audio_row__info");if(!o)return;if(o.getElementsByClassName(c.sE).length)return;const s=d(n);o.classList.add(c.oJ),o.appendChild(s)},m=async(t,e)=>{if(!e)return;const n=t.querySelector('[class*="AudioRow__after--"]');if(!n)return;if(n.getElementsByClassName(c.sE).length)return;const o=d(e);n.classList.add(c.$f),n.appendChild(o)},p=()=>{(0,s.A)(u),(0,r.A)(m)};o()}catch(t){o(t)}}))},3299:(t,e,n)=>{"use strict";n.d(e,{A:()=>i});var o=n(2287),s=n(6339),r=n(118);const a=async()=>{await(0,s.A)(1e3),await(0,r.A)();const t=document.querySelector(".CatalogSection__stickyColumn");t&&"1"!==t.dataset.vknextBanner&&(t.dataset.vknextBanner="1",t.append((()=>{const t=document.createElement("div");t.className="CatalogBlock CatalogBlock--separator";const e=document.createElement("div");return e.className="CatalogBlock__content CatalogBlock__audio_friends_separator CatalogBlock__layout--in_block_separator",t.appendChild(e),t})(),(()=>{const t=document.createElement("div");t.className="CatalogBlock";const e=document.createElement("div");e.className="CatalogBlock__content CatalogBlock__subscription CatalogBlock__layout--placeholder",t.appendChild(e);const n=document.createElement("div");n.className="CatalogBlock__itemsContainer",e.appendChild(n);const o=document.createElement("div");o.className="AudioPlaceholder AudioPlaceholder--small",n.appendChild(o);const s=document.createElement("div");s.className="AudioPlaceholder__title",s.textContent="VK Next",o.appendChild(s);const r=document.createElement("div");r.className="AudioPlaceholder__text",r.textContent="Расширение с красивым дизайном в стиле VK, дополняющее ВКонтакте уникальными и эксклюзивными функциями",o.appendChild(r);const a=document.createElement("div");a.className="AudioPlaceholder__actions",o.appendChild(a);const i=document.createElement("a");i.className="FlatButton FlatButton--secondary FlatButton--size-m FlatButton--wide",i.draggable=!1,i.href="https://vknext.net?utm_source=vms",i.target="_blank",a.appendChild(i);const c=document.createElement("span");c.className="FlatButton__in",i.appendChild(c);const l=document.createElement("span");return l.className="FlatButton__content",l.textContent="Установить",c.appendChild(l),t})()))},i=()=>{(0,o.A)(a)}},1406:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=t=>{if(!t)return"";const e=new Date(1e3*t);return`${String(e.getUTCDate()).padStart(2,"0")}${String(e.getUTCMonth()+1).padStart(2,"0")}`}},8015:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=t=>{if(t.album&&!Array.isArray(t.album)){const e=t.album;return e?.access_key?[e.owner_id,e.id,e.access_key]:[e.owner_id,e.id]}return t.album?t.album:[]}},312:(t,e,n)=>{"use strict";n.d(e,{A:()=>a,Z:()=>r});var o=n(8015);const s=new Map,r=t=>{if(t.coverUrl_l)return t.coverUrl_l;if(t.coverUrl_m)return t.coverUrl_m;if(t.coverUrl_s)return t.coverUrl_s;if(Array.isArray(t.album))return null;const e=t.album?.thumb||t.photo;if(!e)return null;let n=0,o=null;for(const t of Object.keys(e)){const[,s]=t.split("_");s&&Number(s)>n&&(n=+s,o=e[t])}return o},a=t=>{const e=(t=>{const[e,n]=(0,o.A)(t);return[e,n].join("_")})(t);if(s.has(e))return s.get(e);const n=r(t);if(!n)return null;const a=fetch(n).then((t=>t.arrayBuffer()));return s.set(e,a),a}},3866:(t,e,n)=>{"use strict";n.d(e,{A:()=>u});var o=n(5932),s=n(5073),r=n(4115);var a=n(4201);const i=new Map,c=[];let l=0;const d=async()=>{if(l>=2||0===c.length)return;l++;const t=c.shift();await t(),l--,c.length>0&&setTimeout(d,800)},u=t=>{const e=`${t.owner_id}_${t.id}`;if(i.has(e))return i.get(e);const{promise:n,resolve:l}=(()=>{let t,e;return{promise:new Promise(((n,o)=>{t=n,e=o})),resolve:t,reject:e}})();var u;return i.set(e,n),u=async()=>{const n=t.url?t:await(0,a.A)(t);if(n.url)try{const t=await(async({url:t})=>{const{promise:e,resolve:n,reject:o}=(0,s.c)(),a=await(0,r.g)(),i=new a,c=new Audio;let l,d=0,u=null;const m=t=>{o(t),i.stopLoad(),i.destroy()};return i.on(a.Events.MANIFEST_PARSED,((t,e)=>{const n=e.levels[0]?.details;n&&(l=n.totalduration)})),i.on(a.Events.BUFFER_APPENDING,((t,e)=>{u=e.data})),i.on(a.Events.FRAG_BUFFERED,((t,e)=>{if(u)return i.detachMedia(),void((t,e)=>{const o=Math.min(32*Math.round(t/4096/e),320);n({bitrate:o,size:t,duration:e})})(u.length/e.frag.duration*l,l)})),i.on(a.Events.ERROR,((t,e)=>{if(!["bufferFullError","fragLoadError"].includes(e.details))return e.type==a.ErrorTypes.MEDIA_ERROR&&d<2?(++d>1&&i.swapAudioCodec(),void i.recoverMediaError()):void m(t);m(t)})),i.loadSource(t),i.attachMedia(c),await e})({url:(0,o.R)(n.url)});return void l(t)}catch(t){l(null),i.delete(e)}else l(null)},c.push(u),d(),n}},6692:(t,e,n)=>{"use strict";n.a(t,(async(t,o)=>{try{n.d(e,{G:()=>_});var s=n(5932),r=n(2526),a=n(5373),i=n(1024),c=n(9188),l=n(1406),d=n(8015),u=n(312),m=n(3759),p=t([a]);a=(p.then?(await p)():p)[0];const _=async({audio:t,playlist:e,onProgress:o})=>{if(!t.url)throw window.Notifier.showEvent({title:"VK Music Saver",text:a.A.use("vms_audio_url_not_found")}),console.error("Audio URL not found",t),new Error("Audio URL not found");const p=await(0,r.H)({url:(0,s.R)(t.url),onProgress:o});if(!e){const[n,o,s]=(0,d.A)(t);n&&o&&(e=await(0,m.A)({owner_id:n,playlist_id:o,access_key:s}))}const _=(0,u.A)(t);try{const{ID3Writer:o}=await n.e(596).then(n.bind(n,8596)),s=new o(await(0,i.A)(p));if(s.setFrame("COMM",{description:"vknext.net",text:"Track downloaded from VK via VK Music Saver: https://vknext.net",language:"eng"}),null!==_&&s.setFrame("APIC",{type:3,data:await _,description:"vknext.net",useUnicodeEncoding:!0}),t.title){let e=t.title;(t.subTitle||t.subtitle)&&(e+=`(${t.subTitle||t.subtitle})`),s.setFrame("TIT2",e)}(t.subTitle||t.subtitle)&&s.setFrame("TIT3",t.subTitle||t.subtitle),s.setFrame("TLEN",1e3*t.duration);const r=t.main_artists||t.mainArtists||[];if(t.featured_artists?r.push(...t.featured_artists):t.featArtists&&r.push({name:t.featArtists}),r.length){const t=r.map((t=>t.name))||[];s.setFrame("TPE1",t)}if(e){if(s.setFrame("TALB",e.title),s.setFrame("TYER",e.year),e.genres){const t=e.genres.map((t=>t.name));s.setFrame("TCON",t)}if(e.audios){const n=e.audios.findIndex((({id:e})=>e===t.id));-1!==n&&s.setFrame("TRCK",`${n+1}/${e.audios.length}`)}if(e.create_time){const t=(0,l.A)(e.create_time);s.setFrame("TDAT",t)}if(e.main_artists){const t=e.main_artists.map((t=>t.name));s.setFrame("TPE2",t)}}if("string"==typeof t.title)try{const e=await(0,c.A)({title:t.title,performer:t.performer||"",mainArtists:r});e?.length&&s.setFrame("USLT",{description:"vknext.net",lyrics:e,language:""})}catch(t){console.error("error add lyrics to audio",t)}return s.addTag(),s.getBlob()}catch(t){console.error("Ошибка записи id3 тегов",t)}return p};o()}catch(t){o(t)}}))},4201:(t,e,n)=>{"use strict";n.d(e,{A:()=>r});var o=n(5932),s=n(2447);const r=async t=>{const e=[t.owner_id,t.id];t.access_key?e.push(t.access_key):t.accessKey&&e.push(t.accessKey),await(0,s.A)("vkApi");const n=await window.vkApi.api("audio.getById",{audios:e.join("_"),v:"5.204"});for(const t of n)if(t?.url)return t.url=(0,o.R)(t.url),t;const r=t.hashes?.split("/");let a="",i="";r?(a=r[2],i=r[5]):(a=t.actionHash||"",i=t.urlHash||"");const[c]=await window.ajax.promisifiedPost("al_audio.php",{act:"reload_audio",ids:[t.owner_id,t.id,a,i].join("_"),al:1}),l=window.AudioUtils.audioTupleToAudioObject(c[0]);return l.url=(0,o.R)(l.url),l}},3759:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});const o=async t=>{const e=await(async t=>{try{const{playlist:e}=await window.vkApi.api("audio.getPlaylistById",{playlist_id:t.playlist_id,owner_id:t.owner_id,access_key:t.access_key,extra_fields:"owner, duration"});return e.photo&&(e.coverUrl_l=(t=>{let e,n=0;for(const[o,s]of Object.entries(t))if(o.startsWith("photo_")){const t=parseInt(o.split("photo_")[1],10);t>n&&(n=t,e=s)}return e})(e.photo)),e}catch(t){console.error(t)}try{const[e]=await window.ajax.promisifiedPost("/al_audio.php?act=load_section",{access_hash:t.access_key||"",al:"1",claim:"0",is_loading_all:"0",is_preload:"0",offset:"0",owner_id:t.owner_id,playlist_id:t.playlist_id,type:"playlist"});if(!e)return null;const n=await vkApi.api("audio.get",{owner_id:e.ownerId,playlist_id:e.id,access_key:t.access_key,count:1e4});return{id:e.id,owner_id:e.ownerId,title:e.title,description:e.rawDescription,type:0,count:e.totalCount||e.list?.length||0,followers:0,no_discover:Boolean(e.noDiscover),plays:0,create_time:e.lastUpdated,update_time:e.lastUpdated,audios:n.items,subtitle:`${e.subTitle||""}`,main_artists:e.authorName.split(",").map((t=>({name:t.trim()}))),coverUrl_l:e.coverUrl}}catch(t){console.error(t)}return null})(t);if(!e)return null;try{const n=await vkApi.api("audio.get",{owner_id:e.owner_id||e.ownerId,playlist_id:e.id,access_key:t.access_key,count:1e4});e.audios=n.items}catch(t){console.error(t)}return e}},2495:(t,e,n)=>{"use strict";n.p=(()=>{try{const t=window.sessionStorage.getItem("vms_public_path");if(t)return t;if(document.currentScript instanceof HTMLScriptElement)return new URL(document.currentScript.src).origin;if(document.documentElement.dataset.vms_public_path)return document.documentElement.dataset.vms_public_path}catch(t){console.error("[VMS/public-path]",t)}return""})()},7251:(t,e,n)=>{var o={"./Belarusian":[8566,566],"./Belarusian.ts":[8566,566],"./English":[9804,804],"./English.ts":[9804,804],"./German":[7400,400],"./German.ts":[7400,400],"./Kazakh":[5856,856],"./Kazakh.ts":[5856,856],"./Polish":[5479,479],"./Polish.ts":[5479,479],"./Portuguese, Brazilian":[73,73],"./Portuguese, Brazilian.ts":[73,73],"./Soviet":[5740,740],"./Soviet.ts":[5740,740],"./Ukrainian":[1938,938],"./Ukrainian.ts":[1938,938],"./default":[8281],"./default.ts":[8281]};function s(t){if(!n.o(o,t))return Promise.resolve().then((()=>{var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=o[t],s=e[0];return Promise.all(e.slice(1).map(n.e)).then((()=>n(s)))}s.keys=()=>Object.keys(o),s.id=7251,t.exports=s},5932:(t,e,n)=>{"use strict";n.d(e,{R:()=>o});const o=t=>{const e={v:t=>t.split("").reverse().join(""),r:(t,e)=>{t=t.split("");for(let o,s=n+n,r=t.length;r--;)~(o=s.indexOf(t[r]))&&(t[r]=s.substr(o-e,1));return t.join("")},s:(t,e)=>{const n=t.length;if(n){let o=function(t,e){const n=t.length,o=[];if(n){let t=n;for(e=Math.abs(e);t--;)e=(n*(t+1)^e+t)%n,o[t]=e}return o}(t,e),s=0;for(t=t.split("");++s<n;)t[s]=t.splice(o[n-1-s],1,t[s])[0];t=t.join("")}return t},i:(t,n)=>e.s(t,n^vk.id),x:(t,e)=>{const n=[];return e=e.charCodeAt(0),each(t.split(""),((t,o)=>{n.push(String.fromCharCode(o.charCodeAt(0)^e))})),n.join("")}},n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMN0PQRSTUVWXYZO123456789+/=",o=t=>{if(!t||t.length%4==1)return!1;for(var e,o,s=0,r=0,a="";o=t.charAt(r++);)~(o=n.indexOf(o))&&(e=s%4?64*e+o:o,s++%4)&&(a+=String.fromCharCode(255&e>>(-2*s&6)));return a};if((!window.wbopen||!~(window.open+"").indexOf("wbopen"))&&~t.indexOf("audio_api_unavailable")){let n=t.split("?extra=")[1].split("#"),i=""===n[1]?"":o(n[1]);if(n=o(n[0]),"string"!=typeof i||!n)return t;for(var s,r,a=(i=i?i.split(String.fromCharCode(9)):[]).length;a--;){if(s=(r=i[a].split(String.fromCharCode(11))).splice(0,1,n)[0],!e[s])return t;n=e[s].apply(null,r)}if(n&&"http"===n.substr(0,4))return n}return t}},2526:(t,e,n)=>{"use strict";n.d(e,{H:()=>u});var o=n(5073);const s=t=>new Promise((e=>setTimeout(e,t)));let r,a=null,i=0;const c=async()=>{r||(r=(async()=>{if(await s(6e4),!a)return;const t=await a;t&&(0===i&&await s(1e4),0===i&&(a=null,t.remove()))})(),r.finally((()=>{r=null})))},l=async({onProgress:t,type:e,iframeURL:s="https://vknext.net/ffmpeg",...r})=>{const{promise:l,reject:d,resolve:u}=(0,o.c)(),m="request-"+Math.random().toString(36).substr(2,9),p=await(t=>{if(a)return a;const{promise:e,resolve:n,reject:s}=(0,o.c)();a=e;const r=document.querySelector(`iframe[src="${t}"]`);if(r)return n(r),e;const i=document.createElement("iframe");return i.src=t,i.style.setProperty("display","none","important"),i.onload=()=>n(i),i.onerror=s,(document.body||document.documentElement).appendChild(i),e})(s),{Bridge:_}=await n.e(692).then(n.bind(n,2692)),w=new _(p.contentWindow,{prefix:"vknext-net-bridge"});return i++,t&&w.on("progress",(e=>{const n=e;n?.requestId===m&&t(n.progress,n.total)})),w.on("error",(t=>{const e=t;e?.requestId===m&&(d(e?.error||"unknown error"),w.destroy(),i--,c())})),w.on("response",(t=>{const e=t;e?.requestId===m&&(u(e.response),w.destroy(),i--,c())})),w.on("getBlob",(t=>{const e=t;if(e?.requestId===m)return fetch(e.url).then((t=>t.blob()))})),w.post(e,{...r,requestId:m}),l};var d=n(4115);const u=async({url:t,filename:e,onProgress:n,forceHls:s})=>{if(!s)try{return await l({url:t,filename:e,type:"convertHlsToMp3",onProgress:n})}catch(t){console.error(t)}const{promise:r,resolve:a,reject:i}=(0,o.c)(),c=await(0,d.g)(),u=new c,m=new Audio;let p=null;const _=[];let w,f,v=0;const h=t=>{i(t),u.stopLoad(),u.destroy()};return u.on(c.Events.MANIFEST_PARSED,((t,e)=>{const n=e.levels[0]?.details;n&&(f=n.fragments.length)})),u.on(c.Events.BUFFER_CODECS,((t,e)=>{e.audio&&"audio/mp4"!==e.audio.container||(w=e.audio)})),u.on(c.Events.BUFFER_APPENDING,((t,e)=>{p=e.data})),u.on(c.Events.ERROR,((t,e)=>{if(!["bufferFullError","fragLoadError"].includes(e.details))return e.type==c.ErrorTypes.MEDIA_ERROR&&v<2?(++v>1&&u.swapAudioCodec(),void u.recoverMediaError()):void h(t);h(t)})),u.on(c.Events.FRAG_BUFFERED,(async(t,e)=>{p&&_.push(w?p.slice(8,p.length):p),m.currentTime=e.frag.start+e.frag.duration;try{n&&n(_.length/f)}catch(t){console.error(t)}if(_.length>=f){u.stopLoad(),u.destroy();const t=new Blob(_,{type:"audio/mp3"});a(t)}})),u.loadSource(t),u.attachMedia(m),await r}},5073:(t,e,n)=>{"use strict";n.d(e,{c:()=>o});const o=()=>{let t,e;return{promise:new Promise(((n,o)=>{t=n,e=o})),resolve:t,reject:e}}},4115:(t,e,n)=>{"use strict";n.d(e,{g:()=>o});const o=async()=>{try{return(await n.e(945).then(n.bind(n,4945))).default}catch(t){if(globalThis?.Hls)return globalThis.Hls}throw new Error("hls.js not found")}}},i={};function c(t){var e=i[t];if(void 0!==e)return e.exports;var n=i[t]={exports:{}};return a[t](n,n.exports,c),n.exports}c.m=a,t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",o=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},c.a=(s,r,a)=>{var i;a&&((i=[]).d=-1);var c,l,d,u=new Set,m=s.exports,p=new Promise(((t,e)=>{d=e,l=t}));p[e]=m,p[t]=t=>(i&&t(i),u.forEach(t),p.catch((t=>{}))),s.exports=p,r((s=>{var r;c=(s=>s.map((s=>{if(null!==s&&"object"==typeof s){if(s[t])return s;if(s.then){var r=[];r.d=0,s.then((t=>{a[e]=t,o(r)}),(t=>{a[n]=t,o(r)}));var a={};return a[t]=t=>t(r),a}}var i={};return i[t]=t=>{},i[e]=s,i})))(s);var a=()=>c.map((t=>{if(t[n])throw t[n];return t[e]})),l=new Promise((e=>{(r=()=>e(a)).r=0;var n=t=>t!==i&&!u.has(t)&&(u.add(t),t&&!t.d&&(r.r++,t.push(r)));c.map((e=>e[t](n)))}));return r.r?l:a()}),(t=>(t?d(p[n]=t):l(m),o(i)))),i&&i.d<0&&(i.d=0)},c.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return c.d(e,{a:e}),e},c.d=(t,e)=>{for(var n in e)c.o(e,n)&&!c.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},c.f={},c.e=t=>Promise.all(Object.keys(c.f).reduce(((e,n)=>(c.f[n](t,e),e)),[])),c.u=t=>t+".vms.js",c.miniCssF=t=>{},c.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s={},r="vk-music-saver:",c.l=(t,e,n,o)=>{if(s[t])s[t].push(e);else{var a,i;if(void 0!==n)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==t||u.getAttribute("data-webpack")==r+n){a=u;break}}a||(i=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,c.nc&&a.setAttribute("nonce",c.nc),a.setAttribute("data-webpack",r+n),a.src=t),s[t]=[e];var m=(e,n)=>{a.onerror=a.onload=null,clearTimeout(p);var o=s[t];if(delete s[t],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach((t=>t(n))),e)return e(n)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=m.bind(null,a.onerror),a.onload=m.bind(null,a.onload),i&&document.head.appendChild(a)}},c.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.p="./",(()=>{var t={535:0};c.f.j=(e,n)=>{var o=c.o(t,e)?t[e]:void 0;if(0!==o)if(o)n.push(o[2]);else{var s=new Promise(((n,s)=>o=t[e]=[n,s]));n.push(o[2]=s);var r=c.p+c.u(e),a=new Error;c.l(r,(n=>{if(c.o(t,e)&&(0!==(o=t[e])&&(t[e]=void 0),o)){var s=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;a.message="Loading chunk "+e+" failed.\n("+s+": "+r+")",a.name="ChunkLoadError",a.type=s,a.request=r,o[1](a)}}),"chunk-"+e,e)}};var e=(e,n)=>{var o,s,[r,a,i]=n,l=0;if(r.some((e=>0!==t[e]))){for(o in a)c.o(a,o)&&(c.m[o]=a[o]);i&&i(c)}for(e&&e(n);l<r.length;l++)s=r[l],c.o(t,s)&&t[s]&&t[s][0](),t[s]=0},n=self.webpackChunkvk_music_saver=self.webpackChunkvk_music_saver||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),c(5810)})();