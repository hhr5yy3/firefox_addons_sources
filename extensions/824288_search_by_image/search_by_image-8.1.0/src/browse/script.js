(()=>{"use strict";var e,s={7046:(e,s,t)=>{var i=t(7416),n=t(1128),r=t(2024),a=t(822),o=t(4526);const c={key:0,class:"browse-content"},l={class:"drop-zone-content"},h={class:"drop-zone-text"},g={class:"browse-buttons"},d={class:"browse-preview"},p={class:"preview-images"},w=["srcset","type"],u=["src","alt"],m={class:"preview-buttons"},v={key:1,class:"share-content"},b={class:"preview-images"},f=["srcset","type"],k=["src","alt"],E=["src"],y=["src"],I={key:2,class:"error-content"},S={class:"error-text"},C={key:3,class:"spinner",src:"/src/assets/icons/misc/spinner.svg"};t(9849),t(6658),t(6831);var P=t(4390),_=t(9329),L=t(786),D=t(8618),W=t(3655);const x={components:{[_.qw.name]:_.qw,[_.$n.name]:_.$n,[_.cG.name]:_.cG,[_.In.name]:_.In,[_.B8.name]:_.B8,[_.ck.name]:_.ck},data:function(){return{dataLoaded:!1,processing:!1,isShare:!1,showSpinner:!1,showError:"",dropState:!1,showBrowseArea:!0,previewImages:null,engines:[],searchAllEngines:!1,showEngineIcons:!1,pasteEnabled:!1,dropEnabled:!1,confirmPaste:!1,theme:""}},computed:{appClasses:function(){return{"browse-view":!this.isShare,"share-view":this.isShare,"drop-state":this.dropState}}},rawData:{session:null},methods:{getText:D.q4,getEngineIcon:n.y2,initSetup:async function(){try{await this.setup()}catch(e){throw await(0,n.Ds)({messageId:"error_internalError"}),e}finally{this.dataLoaded=!0}},setup:async function(){const e=await L.Ay.get(W.M$);if(this.isShare){const s=new URL(window.location.href).searchParams.get("id"),t=await(0,n.hz)(e);if(await(0,n.tx)(s)){const i=[];for(const e of s.split("_")){const s=await browser.runtime.sendNativeMessage("application.id",{id:"getSharedImage",shareId:e});if(!s)return void(this.showError=(0,D.q4)("error_invalidPageUrl"));{const e=`data:${(0,n.IU)(s.imageExt)||"application/octet-stream"};base64,${s.imageDataStr}`,t=await(0,n.tW)({dataUrl:e});t&&i.push(t)}}if(i.length){let s;1===t.length?s=t[0]:t.length>1&&"main"===e.searchAllEnginesAction&&(s="allEngines"),s?await this.initShareSearch({engine:s,images:i}):(this.addPreviewImages(i),this.engines=t,this.searchAllEngines="sub"===e.searchAllEnginesAction&&!this.$env.isSamsung,this.showEngineIcons=e.showEngineIcons)}else this.showError=(0,D.q4)("error_invalidImageFile")}else this.showError=(0,D.q4)("error_invalidPageUrl")}else{const s=new URL(window.location.href).searchParams.get("id"),t=await browser.runtime.sendMessage({id:"storageRequest",asyncResponse:!0,saveReceipt:!0,storageId:s});t?(this.$options.rawData.session=t,this.dropEnabled=!this.$env.isAndroid,this.pasteEnabled=!(this.$env.isSamsung||this.$env.isMobile&&this.$env.isFirefox),this.confirmPaste=e.confirmPaste,this.pasteEnabled&&window.addEventListener("paste",this.onPasteEvent,{capture:!0,passive:!1})):this.showError=(0,D.q4)("error_invalidPageUrl")}this.theme=await(0,n.xB)(e.appTheme),document.addEventListener("themeChange",(e=>{this.theme=e.detail}))},startProcessing:function(){if(!this.processing)return this.processing=!0,!0},stopProcessing:function(){this.processing=!1},onEngineClick:async function(e){if(this.startProcessing())try{await this.initShareSearch({engine:e})}catch(e){throw this.stopProcessing(),await(0,n.Ds)({messageId:"error_internalError"}),e}},onCancelButtonClick:function(){this.processing||this.hidePreviewImages()},onSearchButtonClick:async function(){if(this.startProcessing())try{await this.initSearch()}catch(e){throw this.stopProcessing(),await(0,n.Ds)({messageId:"error_internalError"}),e}},onBrowseButtonClick:function(){this.processing||this.$refs.browseInput.click()},onPasteButtonClick:function(){this.startProcessing()&&(0,n.td)().then((e=>e?this.processClipboardImages():(0,n.Ds)({messageId:"error_noClipboardReadAccess"}))).finally((()=>{this.stopProcessing()}))},onFileEvent:function(e,s){if(!this.startProcessing())return;let t;"input-event"===s?t=e.target.files:"drop-event"===s&&(t=e.dataTransfer.files),this.processSelectedImages(t).finally((()=>{this.stopProcessing(),"drop-event"===s&&(this.dropState=!1)}))},onPasteEvent:function(e){if(!this.startProcessing())return;if(e.preventDefault(),e.stopImmediatePropagation(),this.showSpinner||this.showError)return void this.stopProcessing();const s=Array.prototype.slice.call(e.clipboardData.files,0,3);this.processClipboardImages(s).finally((()=>{this.stopProcessing()}))},processClipboardImages:async function(e){try{e||(e=await(0,n._C)());const s=await(0,n.OR)(e);s?this.confirmPaste?this.showPreviewImages(s):await this.initSearch(s):await(0,n.Ds)({messageId:"error_invalidImageFile"})}catch(e){throw await(0,n.Ds)({messageId:"error_internalError"}),e}},processSelectedImages:async function(e){try{if(e.length>3)return void await(0,n.Ds)({messageId:"error_invalidImageCount"});const s=await(0,n.OR)(e);s?await this.initSearch(s):await(0,n.Ds)({messageId:"error_invalidImageFile"})}catch(e){throw await(0,n.Ds)({messageId:"error_internalError"}),e}},showPreviewImages:function(e){this.showBrowseArea=!1,this.addPreviewImages(e)},hidePreviewImages:function(){this.removePreviewImages(),this.showBrowseArea=!0},addPreviewImages:function(e){e&&(this.previewImages=e.map((e=>({image:(0,P.IG)(e),objectUrl:URL.createObjectURL(e)}))))},removePreviewImages:function(){this.previewImages&&(this.previewImages.forEach((e=>URL.revokeObjectURL(e.objectUrl))),this.previewImages=null)},setBrokenPreviewImage:function(e){const s=e.target.previousElementSibling;s.srcset=e.target.src,s.type="image/svg+xml"},initShareSearch:async function({engine:e,images:s}={}){this.$options.rawData.session=await(0,n.jw)({sessionOrigin:"share",sessionType:"search",searchMode:"browse",engine:e}),await this.initSearch(s)},initSearch:async function(e){this.showSpinner=!0;try{const s=this.$options.rawData.session;s.closeSourceTab=!0;const t=e||this.previewImages.map((e=>e.image));if(!(e=await(0,n.UD)(t)))throw new Error("cannot process images");await(0,n.NI)({message:{id:"imageBrowseSubmit",session:s,images:e},openConnection:this.$env.isSafari})}catch(e){throw this.showSpinner=!1,e}}},created:function(){document.title=(0,D.q4)("pageTitle",[(0,D.q4)("pageTitle_browse"),(0,D.q4)("extensionName")]),this.isShare="share"===new URL(window.location.href).searchParams.get("origin"),this.initSetup()}},B=(0,t(1535).A)(x,[["render",function(e,s,t,n,r,P){const _=(0,a.g2)("vn-icon"),L=(0,a.g2)("vn-button"),D=(0,a.g2)("vn-list-item"),W=(0,a.g2)("vn-divider"),x=(0,a.g2)("vn-list"),B=(0,a.g2)("vn-app");return e.dataLoaded?((0,a.uX)(),(0,a.Wv)(B,{key:0,class:(0,o.normalizeClass)(P.appClasses)},{default:(0,a.k6)((()=>[e.isShare||e.showSpinner||e.showError?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",c,[(0,a.bo)((0,a.Lk)("div",null,[e.dropEnabled?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"drop-zone",onDrop:s[0]||(s[0]=(0,i.withModifiers)((e=>P.onFileEvent(e,"drop-event")),["prevent"])),onDragstart:s[1]||(s[1]=(0,i.withModifiers)((s=>e.dropState=!0),["prevent"])),onDragend:s[2]||(s[2]=s=>e.dropState=!1),onDragenter:s[3]||(s[3]=(0,i.withModifiers)((s=>e.dropState=!0),["prevent"])),onDragleave:s[4]||(s[4]=s=>e.dropState=!1),onDragover:s[5]||(s[5]=(0,i.withModifiers)((()=>{}),["prevent"]))},null,32)):(0,a.Q3)("",!0),(0,a.eW)(),(0,a.Lk)("div",l,[(0,a.bF)(_,{class:"drop-zone-icon",src:"/src/assets/icons/misc/image.svg"}),(0,a.eW)(),(0,a.Lk)("div",h,(0,o.toDisplayString)(e.dropEnabled?P.getText("pageContent_browse_"+(e.dropState?"drop":"drag")):P.getText("pageContent_browse")),1),(0,a.eW)(),(0,a.bo)((0,a.Lk)("div",g,[(0,a.Lk)("input",{ref:"browseInput",class:"browse-input",type:"file",accept:"image/*",multiple:"",onChange:s[6]||(s[6]=e=>P.onFileEvent(e,"input-event"))},null,544),(0,a.eW)(),(0,a.bF)(L,{class:"browse-button",disabled:e.processing,onClick:P.onBrowseButtonClick,variant:"tonal"},{default:(0,a.k6)((()=>[(0,a.eW)((0,o.toDisplayString)(P.getText("buttonLabel_browse")),1)])),_:1},8,["disabled","onClick"]),(0,a.eW)(),e.pasteEnabled?((0,a.uX)(),(0,a.Wv)(L,{key:0,class:"browse-button",disabled:e.processing,onClick:P.onPasteButtonClick,variant:"tonal"},{default:(0,a.k6)((()=>[(0,a.eW)((0,o.toDisplayString)(P.getText("buttonLabel_paste")),1)])),_:1},8,["disabled","onClick"])):(0,a.Q3)("",!0)],512),[[i.vShow,!e.dropState]])])],512),[[i.vShow,e.showBrowseArea]]),(0,a.eW)(),(0,a.bo)((0,a.Lk)("div",d,[(0,a.Lk)("div",p,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.previewImages,((t,i)=>((0,a.uX)(),(0,a.CE)("picture",{class:"tile-container",key:i},[(0,a.Lk)("source",{srcset:t.objectUrl,type:t.image.type},null,8,w),(0,a.eW)(),(0,a.Lk)("img",{class:"tile",src:`/src/assets/icons/misc/${"dark"===e.theme?"broken-image-dark":"broken-image"}.svg`,onErrorOnce:s[7]||(s[7]=(...e)=>P.setBrokenPreviewImage&&P.setBrokenPreviewImage(...e)),alt:t.image.name},null,40,u)])))),128))]),(0,a.eW)(),(0,a.Lk)("div",m,[(0,a.bF)(L,{class:"browse-button",disabled:e.processing,onClick:P.onCancelButtonClick,variant:"text"},{default:(0,a.k6)((()=>[(0,a.eW)((0,o.toDisplayString)(P.getText("buttonLabel_cancel")),1)])),_:1},8,["disabled","onClick"]),(0,a.eW)(),(0,a.bF)(L,{class:"browse-button",disabled:e.processing,onClick:P.onSearchButtonClick,variant:"tonal"},{default:(0,a.k6)((()=>[(0,a.eW)((0,o.toDisplayString)(P.getText("buttonLabel_search")),1)])),_:1},8,["disabled","onClick"])])],512),[[i.vShow,e.previewImages]])])),(0,a.eW)(),!e.isShare||e.showSpinner||e.showError?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",v,[(0,a.Lk)("div",b,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.previewImages,((t,i)=>((0,a.uX)(),(0,a.CE)("picture",{class:"tile-container",key:i},[(0,a.Lk)("source",{srcset:t.objectUrl,type:t.image.type},null,8,f),(0,a.eW)(),(0,a.Lk)("img",{class:"tile",src:`/src/assets/icons/misc/${"dark"===e.theme?"broken-image-dark":"broken-image"}.svg`,onErrorOnce:s[8]||(s[8]=(...e)=>P.setBrokenPreviewImage&&P.setBrokenPreviewImage(...e)),alt:t.image.name},null,40,k)])))),128))]),(0,a.eW)(),(0,a.bF)(x,{class:"list-items"},{default:(0,a.k6)((()=>[e.searchAllEngines?((0,a.uX)(),(0,a.Wv)(D,{key:0,title:P.getText("menuItemTitle_allEngines"),onClick:s[9]||(s[9]=e=>P.onEngineClick("allEngines"))},(0,a.eX)({_:2},[e.showEngineIcons?{name:"prepend",fn:(0,a.k6)((()=>[e.showEngineIcons?((0,a.uX)(),(0,a.CE)("img",{key:0,class:"list-item-icon",src:P.getEngineIcon("allEngines",{variant:e.theme})},null,8,E)):(0,a.Q3)("",!0)])),key:"0"}:void 0]),1032,["title"])):(0,a.Q3)("",!0),(0,a.eW)(),e.searchAllEngines?((0,a.uX)(),(0,a.Wv)(W,{key:1,class:"list-separator"})):(0,a.Q3)("",!0),(0,a.eW)(),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.engines,(s=>((0,a.uX)(),(0,a.Wv)(D,{title:P.getText(`menuItemTitle_${s}`),onClick:e=>P.onEngineClick(s)},(0,a.eX)({_:2},[e.showEngineIcons?{name:"prepend",fn:(0,a.k6)((()=>[(0,a.Lk)("img",{class:"list-item-icon",src:P.getEngineIcon(s,{variant:e.theme})},null,8,y)])),key:"0"}:void 0]),1032,["title","onClick"])))),256))])),_:1})])),(0,a.eW)(),e.showError?((0,a.uX)(),(0,a.CE)("div",I,[(0,a.bF)(_,{class:"error-icon",src:"/src/assets/icons/misc/error.svg"}),(0,a.eW)(),(0,a.Lk)("div",S,(0,o.toDisplayString)(e.showError),1)])):(0,a.Q3)("",!0),(0,a.eW)(),e.showSpinner&&!e.showError?((0,a.uX)(),(0,a.CE)("img",C)):(0,a.Q3)("",!0)])),_:1},8,["class"])):(0,a.Q3)("",!0)}]]);!async function(){await(0,n.rn)(["400 14px Roboto","500 14px Roboto"]);const e=(0,i.createApp)(B);await(0,n.K7)(e),await(0,r.H)(e),e.mount("body")}()}},t={};function i(e){var n=t[e];if(void 0!==n)return n.exports;var r=t[e]={exports:{}};return s[e].call(r.exports,r,r.exports,i),r.exports}i.m=s,e=[],i.O=(s,t,n,r)=>{if(!t){var a=1/0;for(h=0;h<e.length;h++){for(var[t,n,r]=e[h],o=!0,c=0;c<t.length;c++)(!1&r||a>=r)&&Object.keys(i.O).every((e=>i.O[e](t[c])))?t.splice(c--,1):(o=!1,r<a&&(a=r));if(o){e.splice(h--,1);var l=n();void 0!==l&&(s=l)}}return s}r=r||0;for(var h=e.length;h>0&&e[h-1][2]>r;h--)e[h]=e[h-1];e[h]=[t,n,r]},i.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return i.d(s,{a:s}),s},i.d=(e,s)=>{for(var t in s)i.o(s,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:s[t]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=421,(()=>{var e={421:0};i.O.j=s=>0===e[s];var s=(s,t)=>{var n,r,[a,o,c]=t,l=0;if(a.some((s=>0!==e[s]))){for(n in o)i.o(o,n)&&(i.m[n]=o[n]);if(c)var h=c(i)}for(s&&s(t);l<a.length;l++)r=a[l],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(h)},t=globalThis.webpackChunksearch_by_image=globalThis.webpackChunksearch_by_image||[];t.forEach(s.bind(null,0)),t.push=s.bind(null,t.push.bind(t))})();var n=i.O(void 0,[8830],(()=>i(7046)));n=i.O(n)})();