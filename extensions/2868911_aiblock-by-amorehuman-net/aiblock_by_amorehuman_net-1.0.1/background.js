var background=function(){"use strict";var U=Object.defineProperty;var $=(e,t,r)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var D=(e,t,r)=>$(e,typeof t!="symbol"?t+"":t,r);function defineBackground(e){return e==null||typeof e=="function"?{main:e}:e}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(s){var i=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(r,s,i.get?i:{enumerable:!0,get:function(){return e[s]}})}),r}var browserPolyfill={exports:{}};(function(e,t){(function(r,s){s(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:commonjsGlobal,function(r){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)r.exports=globalThis.browser;else{const s="The message port closed before a response was received.",i=n=>{const h={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(h).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class c extends WeakMap{constructor(u,d=void 0){super(d),this.createItem=u}get(u){return this.has(u)||this.set(u,this.createItem(u)),super.get(u)}}const x=m=>m&&typeof m=="object"&&typeof m.then=="function",y=(m,u)=>(...d)=>{n.runtime.lastError?m.reject(new Error(n.runtime.lastError.message)):u.singleCallbackArg||d.length<=1&&u.singleCallbackArg!==!1?m.resolve(d[0]):m.resolve(d)},A=m=>m==1?"argument":"arguments",R=(m,u)=>function(p,...E){if(E.length<u.minArgs)throw new Error(`Expected at least ${u.minArgs} ${A(u.minArgs)} for ${m}(), got ${E.length}`);if(E.length>u.maxArgs)throw new Error(`Expected at most ${u.maxArgs} ${A(u.maxArgs)} for ${m}(), got ${E.length}`);return new Promise((S,I)=>{if(u.fallbackToNoCallback)try{p[m](...E,y({resolve:S,reject:I},u))}catch(w){console.warn(`${m} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,w),p[m](...E),u.fallbackToNoCallback=!1,u.noCallback=!0,S()}else u.noCallback?(p[m](...E),S()):p[m](...E,y({resolve:S,reject:I},u))})},O=(m,u,d)=>new Proxy(u,{apply(p,E,S){return d.call(E,m,...S)}});let P=Function.call.bind(Object.prototype.hasOwnProperty);const o=(m,u={},d={})=>{let p=Object.create(null),E={has(I,w){return w in m||w in p},get(I,w,H){if(w in p)return p[w];if(!(w in m))return;let C=m[w];if(typeof C=="function")if(typeof u[w]=="function")C=O(m,m[w],u[w]);else if(P(d,w)){let v=R(w,d[w]);C=O(m,m[w],v)}else C=C.bind(m);else if(typeof C=="object"&&C!==null&&(P(u,w)||P(d,w)))C=o(C,u[w],d[w]);else if(P(d,"*"))C=o(C,u[w],d["*"]);else return Object.defineProperty(p,w,{configurable:!0,enumerable:!0,get(){return m[w]},set(v){m[w]=v}}),C;return p[w]=C,C},set(I,w,H,C){return w in p?p[w]=H:m[w]=H,!0},defineProperty(I,w,H){return Reflect.defineProperty(p,w,H)},deleteProperty(I,w){return Reflect.deleteProperty(p,w)}},S=Object.create(m);return new Proxy(S,E)},a=m=>({addListener(u,d,...p){u.addListener(m.get(d),...p)},hasListener(u,d){return u.hasListener(m.get(d))},removeListener(u,d){u.removeListener(m.get(d))}}),l=new c(m=>typeof m!="function"?m:function(d){const p=o(d,{},{getContent:{minArgs:0,maxArgs:0}});m(p)}),g=new c(m=>typeof m!="function"?m:function(d,p,E){let S=!1,I,w=new Promise(M=>{I=function(L){S=!0,M(L)}}),H;try{H=m(d,p,I)}catch(M){H=Promise.reject(M)}const C=H!==!0&&x(H);if(H!==!0&&!C&&!S)return!1;const v=M=>{M.then(L=>{E(L)},L=>{let F;L&&(L instanceof Error||typeof L.message=="string")?F=L.message:F="An unexpected error occurred",E({__mozWebExtensionPolyfillReject__:!0,message:F})}).catch(L=>{console.error("Failed to send onMessage rejected reply",L)})};return v(C?H:w),!0}),_=({reject:m,resolve:u},d)=>{n.runtime.lastError?n.runtime.lastError.message===s?u():m(new Error(n.runtime.lastError.message)):d&&d.__mozWebExtensionPolyfillReject__?m(new Error(d.message)):u(d)},T=(m,u,d,...p)=>{if(p.length<u.minArgs)throw new Error(`Expected at least ${u.minArgs} ${A(u.minArgs)} for ${m}(), got ${p.length}`);if(p.length>u.maxArgs)throw new Error(`Expected at most ${u.maxArgs} ${A(u.maxArgs)} for ${m}(), got ${p.length}`);return new Promise((E,S)=>{const I=_.bind(null,{resolve:E,reject:S});p.push(I),d.sendMessage(...p)})},N={devtools:{network:{onRequestFinished:a(l)}},runtime:{onMessage:a(g),onMessageExternal:a(g),sendMessage:T.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:T.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},b={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return h.privacy={network:{"*":b},services:{"*":b},websites:{"*":b}},o(n,N,h)};r.exports=i(chrome)}})})(browserPolyfill);var browserPolyfillExports=browserPolyfill.exports;const browser$1=getDefaultExportFromCjs(browserPolyfillExports);var parse$1={exports:{}},tomlParser={exports:{}};const ParserEND=1114112;class ParserError extends Error{constructor(t,r,s){super("[ParserError] "+t,r,s),this.name="ParserError",this.code="ParserError",Error.captureStackTrace&&Error.captureStackTrace(this,ParserError)}}class State{constructor(t){this.parser=t,this.buf="",this.returned=null,this.result=null,this.resultTable=null,this.resultArr=null}}class Parser{constructor(){this.pos=0,this.col=0,this.line=0,this.obj={},this.ctx=this.obj,this.stack=[],this._buf="",this.char=null,this.ii=0,this.state=new State(this.parseStart)}parse(t){if(t.length===0||t.length==null)return;this._buf=String(t),this.ii=-1,this.char=-1;let r;for(;r===!1||this.nextChar();)r=this.runOne();this._buf=null}nextChar(){return this.char===10&&(++this.line,this.col=-1),++this.ii,this.char=this._buf.codePointAt(this.ii),++this.pos,++this.col,this.haveBuffer()}haveBuffer(){return this.ii<this._buf.length}runOne(){return this.state.parser.call(this,this.state.returned)}finish(){this.char=ParserEND;let t;do t=this.state.parser,this.runOne();while(this.state.parser!==t);return this.ctx=null,this.state=null,this._buf=null,this.obj}next(t){if(typeof t!="function")throw new ParserError("Tried to set state to non-existent state: "+JSON.stringify(t));this.state.parser=t}goto(t){return this.next(t),this.runOne()}call(t,r){r&&this.next(r),this.stack.push(this.state),this.state=new State(t)}callNow(t,r){return this.call(t,r),this.runOne()}return(t){if(this.stack.length===0)throw this.error(new ParserError("Stack underflow"));t===void 0&&(t=this.state.buf),this.state=this.stack.pop(),this.state.returned=t}returnNow(t){return this.return(t),this.runOne()}consume(){if(this.char===ParserEND)throw this.error(new ParserError("Unexpected end-of-buffer"));this.state.buf+=this._buf[this.ii]}error(t){return t.line=this.line,t.col=this.col,t.pos=this.pos,t}parseStart(){throw new ParserError("Must declare a parseStart method")}}Parser.END=ParserEND,Parser.Error=ParserError;var parser=Parser,createDatetime=e=>{const t=new Date(e);if(isNaN(t))throw new TypeError("Invalid Datetime");return t},formatNum=(e,t)=>{for(t=String(t);t.length<e;)t="0"+t;return t};const f$2=formatNum;class FloatingDateTime extends Date{constructor(t){super(t+"Z"),this.isFloating=!0}toISOString(){const t=`${this.getUTCFullYear()}-${f$2(2,this.getUTCMonth()+1)}-${f$2(2,this.getUTCDate())}`,r=`${f$2(2,this.getUTCHours())}:${f$2(2,this.getUTCMinutes())}:${f$2(2,this.getUTCSeconds())}.${f$2(3,this.getUTCMilliseconds())}`;return`${t}T${r}`}}var createDatetimeFloat=e=>{const t=new FloatingDateTime(e);if(isNaN(t))throw new TypeError("Invalid Datetime");return t};const f$1=formatNum,DateTime=commonjsGlobal.Date;let Date$1=class extends DateTime{constructor(t){super(t),this.isDate=!0}toISOString(){return`${this.getUTCFullYear()}-${f$1(2,this.getUTCMonth()+1)}-${f$1(2,this.getUTCDate())}`}};var createDate$1=e=>{const t=new Date$1(e);if(isNaN(t))throw new TypeError("Invalid Datetime");return t};const f=formatNum;class Time extends Date{constructor(t){super(`0000-01-01T${t}Z`),this.isTime=!0}toISOString(){return`${f(2,this.getUTCHours())}:${f(2,this.getUTCMinutes())}:${f(2,this.getUTCSeconds())}.${f(3,this.getUTCMilliseconds())}`}}var createTime$1=e=>{const t=new Time(e);if(isNaN(t))throw new TypeError("Invalid Datetime");return t};tomlParser.exports=makeParserClass(parser),tomlParser.exports.makeParserClass=makeParserClass;class TomlError extends Error{constructor(t){super(t),this.name="TomlError",Error.captureStackTrace&&Error.captureStackTrace(this,TomlError),this.fromTOML=!0,this.wrapped=null}}TomlError.wrap=e=>{const t=new TomlError(e.message);return t.code=e.code,t.wrapped=e,t},tomlParser.exports.TomlError=TomlError;const createDateTime=createDatetime,createDateTimeFloat=createDatetimeFloat,createDate=createDate$1,createTime=createTime$1,CTRL_I=9,CTRL_J=10,CTRL_M=13,CTRL_CHAR_BOUNDARY=31,CHAR_SP=32,CHAR_QUOT=34,CHAR_NUM=35,CHAR_APOS=39,CHAR_PLUS=43,CHAR_COMMA=44,CHAR_HYPHEN=45,CHAR_PERIOD=46,CHAR_0=48,CHAR_1=49,CHAR_7=55,CHAR_9=57,CHAR_COLON=58,CHAR_EQUALS=61,CHAR_A=65,CHAR_E=69,CHAR_F=70,CHAR_T=84,CHAR_U=85,CHAR_Z=90,CHAR_LOWBAR=95,CHAR_a=97,CHAR_b=98,CHAR_e=101,CHAR_f=102,CHAR_i=105,CHAR_l=108,CHAR_n=110,CHAR_o=111,CHAR_r=114,CHAR_s=115,CHAR_t=116,CHAR_u=117,CHAR_x=120,CHAR_z=122,CHAR_LCUB=123,CHAR_RCUB=125,CHAR_LSQB=91,CHAR_BSOL=92,CHAR_RSQB=93,CHAR_DEL=127,SURROGATE_FIRST=55296,SURROGATE_LAST=57343,escapes={[CHAR_b]:"\b",[CHAR_t]:"	",[CHAR_n]:`
`,[CHAR_f]:"\f",[CHAR_r]:"\r",[CHAR_QUOT]:'"',[CHAR_BSOL]:"\\"};function isDigit(e){return e>=CHAR_0&&e<=CHAR_9}function isHexit(e){return e>=CHAR_A&&e<=CHAR_F||e>=CHAR_a&&e<=CHAR_f||e>=CHAR_0&&e<=CHAR_9}function isBit(e){return e===CHAR_1||e===CHAR_0}function isOctit(e){return e>=CHAR_0&&e<=CHAR_7}function isAlphaNumQuoteHyphen(e){return e>=CHAR_A&&e<=CHAR_Z||e>=CHAR_a&&e<=CHAR_z||e>=CHAR_0&&e<=CHAR_9||e===CHAR_APOS||e===CHAR_QUOT||e===CHAR_LOWBAR||e===CHAR_HYPHEN}function isAlphaNumHyphen(e){return e>=CHAR_A&&e<=CHAR_Z||e>=CHAR_a&&e<=CHAR_z||e>=CHAR_0&&e<=CHAR_9||e===CHAR_LOWBAR||e===CHAR_HYPHEN}const _type=Symbol("type"),_declared=Symbol("declared"),hasOwnProperty=Object.prototype.hasOwnProperty,defineProperty=Object.defineProperty,descriptor={configurable:!0,enumerable:!0,writable:!0,value:void 0};function hasKey(e,t){return hasOwnProperty.call(e,t)?!0:(t==="__proto__"&&defineProperty(e,"__proto__",descriptor),!1)}const INLINE_TABLE=Symbol("inline-table");function InlineTable(){return Object.defineProperties({},{[_type]:{value:INLINE_TABLE}})}function isInlineTable(e){return e===null||typeof e!="object"?!1:e[_type]===INLINE_TABLE}const TABLE=Symbol("table");function Table(){return Object.defineProperties({},{[_type]:{value:TABLE},[_declared]:{value:!1,writable:!0}})}function isTable(e){return e===null||typeof e!="object"?!1:e[_type]===TABLE}const _contentType=Symbol("content-type"),INLINE_LIST=Symbol("inline-list");function InlineList(e){return Object.defineProperties([],{[_type]:{value:INLINE_LIST},[_contentType]:{value:e}})}function isInlineList(e){return e===null||typeof e!="object"?!1:e[_type]===INLINE_LIST}const LIST=Symbol("list");function List(){return Object.defineProperties([],{[_type]:{value:LIST}})}function isList(e){return e===null||typeof e!="object"?!1:e[_type]===LIST}let _custom;try{const utilInspect=eval("require('util').inspect");_custom=utilInspect.custom}catch(e){}const _inspect=_custom||"inspect";class BoxedBigInt{constructor(t){try{this.value=commonjsGlobal.BigInt.asIntN(64,t)}catch{this.value=null}Object.defineProperty(this,_type,{value:INTEGER})}isNaN(){return this.value===null}toString(){return String(this.value)}[_inspect](){return`[BigInt: ${this.toString()}]}`}valueOf(){return this.value}}const INTEGER=Symbol("integer");function Integer(e){let t=Number(e);return Object.is(t,-0)&&(t=0),commonjsGlobal.BigInt&&!Number.isSafeInteger(t)?new BoxedBigInt(e):Object.defineProperties(new Number(t),{isNaN:{value:function(){return isNaN(this)}},[_type]:{value:INTEGER},[_inspect]:{value:()=>`[Integer: ${e}]`}})}function isInteger(e){return e===null||typeof e!="object"?!1:e[_type]===INTEGER}const FLOAT=Symbol("float");function Float(e){return Object.defineProperties(new Number(e),{[_type]:{value:FLOAT},[_inspect]:{value:()=>`[Float: ${e}]`}})}function isFloat(e){return e===null||typeof e!="object"?!1:e[_type]===FLOAT}function tomlType$1(e){const t=typeof e;if(t==="object"){if(e===null)return"null";if(e instanceof Date)return"datetime";if(_type in e)switch(e[_type]){case INLINE_TABLE:return"inline-table";case INLINE_LIST:return"inline-list";case TABLE:return"table";case LIST:return"list";case FLOAT:return"float";case INTEGER:return"integer"}}return t}function makeParserClass(e){class t extends e{constructor(){super(),this.ctx=this.obj=Table()}atEndOfWord(){return this.char===CHAR_NUM||this.char===CTRL_I||this.char===CHAR_SP||this.atEndOfLine()}atEndOfLine(){return this.char===e.END||this.char===CTRL_J||this.char===CTRL_M}parseStart(){if(this.char===e.END)return null;if(this.char===CHAR_LSQB)return this.call(this.parseTableOrList);if(this.char===CHAR_NUM)return this.call(this.parseComment);if(this.char===CTRL_J||this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M)return null;if(isAlphaNumQuoteHyphen(this.char))return this.callNow(this.parseAssignStatement);throw this.error(new TomlError(`Unknown character "${this.char}"`))}parseWhitespaceToEOL(){if(this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M)return null;if(this.char===CHAR_NUM)return this.goto(this.parseComment);if(this.char===e.END||this.char===CTRL_J)return this.return();throw this.error(new TomlError("Unexpected character, expected only whitespace or comments till end of line"))}parseAssignStatement(){return this.callNow(this.parseAssign,this.recordAssignStatement)}recordAssignStatement(s){let i=this.ctx,n=s.key.pop();for(let h of s.key){if(hasKey(i,h)&&(!isTable(i[h])||i[h][_declared]))throw this.error(new TomlError("Can't redefine existing key"));i=i[h]=i[h]||Table()}if(hasKey(i,n))throw this.error(new TomlError("Can't redefine existing key"));return isInteger(s.value)||isFloat(s.value)?i[n]=s.value.valueOf():i[n]=s.value,this.goto(this.parseWhitespaceToEOL)}parseAssign(){return this.callNow(this.parseKeyword,this.recordAssignKeyword)}recordAssignKeyword(s){return this.state.resultTable?this.state.resultTable.push(s):this.state.resultTable=[s],this.goto(this.parseAssignKeywordPreDot)}parseAssignKeywordPreDot(){if(this.char===CHAR_PERIOD)return this.next(this.parseAssignKeywordPostDot);if(this.char!==CHAR_SP&&this.char!==CTRL_I)return this.goto(this.parseAssignEqual)}parseAssignKeywordPostDot(){if(this.char!==CHAR_SP&&this.char!==CTRL_I)return this.callNow(this.parseKeyword,this.recordAssignKeyword)}parseAssignEqual(){if(this.char===CHAR_EQUALS)return this.next(this.parseAssignPreValue);throw this.error(new TomlError('Invalid character, expected "="'))}parseAssignPreValue(){return this.char===CHAR_SP||this.char===CTRL_I?null:this.callNow(this.parseValue,this.recordAssignValue)}recordAssignValue(s){return this.returnNow({key:this.state.resultTable,value:s})}parseComment(){do if(this.char===e.END||this.char===CTRL_J)return this.return();while(this.nextChar())}parseTableOrList(){if(this.char===CHAR_LSQB)this.next(this.parseList);else return this.goto(this.parseTable)}parseTable(){return this.ctx=this.obj,this.goto(this.parseTableNext)}parseTableNext(){return this.char===CHAR_SP||this.char===CTRL_I?null:this.callNow(this.parseKeyword,this.parseTableMore)}parseTableMore(s){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===CHAR_RSQB){if(hasKey(this.ctx,s)&&(!isTable(this.ctx[s])||this.ctx[s][_declared]))throw this.error(new TomlError("Can't redefine existing key"));return this.ctx=this.ctx[s]=this.ctx[s]||Table(),this.ctx[_declared]=!0,this.next(this.parseWhitespaceToEOL)}else if(this.char===CHAR_PERIOD){if(!hasKey(this.ctx,s))this.ctx=this.ctx[s]=Table();else if(isTable(this.ctx[s]))this.ctx=this.ctx[s];else if(isList(this.ctx[s]))this.ctx=this.ctx[s][this.ctx[s].length-1];else throw this.error(new TomlError("Can't redefine existing key"));return this.next(this.parseTableNext)}else throw this.error(new TomlError("Unexpected character, expected whitespace, . or ]"))}parseList(){return this.ctx=this.obj,this.goto(this.parseListNext)}parseListNext(){return this.char===CHAR_SP||this.char===CTRL_I?null:this.callNow(this.parseKeyword,this.parseListMore)}parseListMore(s){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===CHAR_RSQB){if(hasKey(this.ctx,s)||(this.ctx[s]=List()),isInlineList(this.ctx[s]))throw this.error(new TomlError("Can't extend an inline array"));if(isList(this.ctx[s])){const i=Table();this.ctx[s].push(i),this.ctx=i}else throw this.error(new TomlError("Can't redefine an existing key"));return this.next(this.parseListEnd)}else if(this.char===CHAR_PERIOD){if(!hasKey(this.ctx,s))this.ctx=this.ctx[s]=Table();else{if(isInlineList(this.ctx[s]))throw this.error(new TomlError("Can't extend an inline array"));if(isInlineTable(this.ctx[s]))throw this.error(new TomlError("Can't extend an inline table"));if(isList(this.ctx[s]))this.ctx=this.ctx[s][this.ctx[s].length-1];else if(isTable(this.ctx[s]))this.ctx=this.ctx[s];else throw this.error(new TomlError("Can't redefine an existing key"))}return this.next(this.parseListNext)}else throw this.error(new TomlError("Unexpected character, expected whitespace, . or ]"))}parseListEnd(s){if(this.char===CHAR_RSQB)return this.next(this.parseWhitespaceToEOL);throw this.error(new TomlError("Unexpected character, expected whitespace, . or ]"))}parseValue(){if(this.char===e.END)throw this.error(new TomlError("Key without value"));if(this.char===CHAR_QUOT)return this.next(this.parseDoubleString);if(this.char===CHAR_APOS)return this.next(this.parseSingleString);if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)return this.goto(this.parseNumberSign);if(this.char===CHAR_i)return this.next(this.parseInf);if(this.char===CHAR_n)return this.next(this.parseNan);if(isDigit(this.char))return this.goto(this.parseNumberOrDateTime);if(this.char===CHAR_t||this.char===CHAR_f)return this.goto(this.parseBoolean);if(this.char===CHAR_LSQB)return this.call(this.parseInlineList,this.recordValue);if(this.char===CHAR_LCUB)return this.call(this.parseInlineTable,this.recordValue);throw this.error(new TomlError("Unexpected character, expecting string, number, datetime, boolean, inline array or inline table"))}recordValue(s){return this.returnNow(s)}parseInf(){if(this.char===CHAR_n)return this.next(this.parseInf2);throw this.error(new TomlError('Unexpected character, expected "inf", "+inf" or "-inf"'))}parseInf2(){if(this.char===CHAR_f)return this.state.buf==="-"?this.return(-1/0):this.return(1/0);throw this.error(new TomlError('Unexpected character, expected "inf", "+inf" or "-inf"'))}parseNan(){if(this.char===CHAR_a)return this.next(this.parseNan2);throw this.error(new TomlError('Unexpected character, expected "nan"'))}parseNan2(){if(this.char===CHAR_n)return this.return(NaN);throw this.error(new TomlError('Unexpected character, expected "nan"'))}parseKeyword(){return this.char===CHAR_QUOT?this.next(this.parseBasicString):this.char===CHAR_APOS?this.next(this.parseLiteralString):this.goto(this.parseBareKey)}parseBareKey(){do{if(this.char===e.END)throw this.error(new TomlError("Key ended without value"));if(isAlphaNumHyphen(this.char))this.consume();else{if(this.state.buf.length===0)throw this.error(new TomlError("Empty bare keys are not allowed"));return this.returnNow()}}while(this.nextChar())}parseSingleString(){return this.char===CHAR_APOS?this.next(this.parseLiteralMultiStringMaybe):this.goto(this.parseLiteralString)}parseLiteralString(){do{if(this.char===CHAR_APOS)return this.return();if(this.atEndOfLine())throw this.error(new TomlError("Unterminated string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}parseLiteralMultiStringMaybe(){return this.char===CHAR_APOS?this.next(this.parseLiteralMultiString):this.returnNow()}parseLiteralMultiString(){return this.char===CTRL_M?null:this.char===CTRL_J?this.next(this.parseLiteralMultiStringContent):this.goto(this.parseLiteralMultiStringContent)}parseLiteralMultiStringContent(){do{if(this.char===CHAR_APOS)return this.next(this.parseLiteralMultiEnd);if(this.char===e.END)throw this.error(new TomlError("Unterminated multi-line string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I&&this.char!==CTRL_J&&this.char!==CTRL_M)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}parseLiteralMultiEnd(){return this.char===CHAR_APOS?this.next(this.parseLiteralMultiEnd2):(this.state.buf+="'",this.goto(this.parseLiteralMultiStringContent))}parseLiteralMultiEnd2(){return this.char===CHAR_APOS?this.return():(this.state.buf+="''",this.goto(this.parseLiteralMultiStringContent))}parseDoubleString(){return this.char===CHAR_QUOT?this.next(this.parseMultiStringMaybe):this.goto(this.parseBasicString)}parseBasicString(){do{if(this.char===CHAR_BSOL)return this.call(this.parseEscape,this.recordEscapeReplacement);if(this.char===CHAR_QUOT)return this.return();if(this.atEndOfLine())throw this.error(new TomlError("Unterminated string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}recordEscapeReplacement(s){return this.state.buf+=s,this.goto(this.parseBasicString)}parseMultiStringMaybe(){return this.char===CHAR_QUOT?this.next(this.parseMultiString):this.returnNow()}parseMultiString(){return this.char===CTRL_M?null:this.char===CTRL_J?this.next(this.parseMultiStringContent):this.goto(this.parseMultiStringContent)}parseMultiStringContent(){do{if(this.char===CHAR_BSOL)return this.call(this.parseMultiEscape,this.recordMultiEscapeReplacement);if(this.char===CHAR_QUOT)return this.next(this.parseMultiEnd);if(this.char===e.END)throw this.error(new TomlError("Unterminated multi-line string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I&&this.char!==CTRL_J&&this.char!==CTRL_M)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}errorControlCharInString(){let s="\\u00";return this.char<16&&(s+="0"),s+=this.char.toString(16),this.error(new TomlError(`Control characters (codes < 0x1f and 0x7f) are not allowed in strings, use ${s} instead`))}recordMultiEscapeReplacement(s){return this.state.buf+=s,this.goto(this.parseMultiStringContent)}parseMultiEnd(){return this.char===CHAR_QUOT?this.next(this.parseMultiEnd2):(this.state.buf+='"',this.goto(this.parseMultiStringContent))}parseMultiEnd2(){return this.char===CHAR_QUOT?this.return():(this.state.buf+='""',this.goto(this.parseMultiStringContent))}parseMultiEscape(){return this.char===CTRL_M||this.char===CTRL_J?this.next(this.parseMultiTrim):this.char===CHAR_SP||this.char===CTRL_I?this.next(this.parsePreMultiTrim):this.goto(this.parseEscape)}parsePreMultiTrim(){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===CTRL_M||this.char===CTRL_J)return this.next(this.parseMultiTrim);throw this.error(new TomlError("Can't escape whitespace"))}parseMultiTrim(){return this.char===CTRL_J||this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M?null:this.returnNow()}parseEscape(){if(this.char in escapes)return this.return(escapes[this.char]);if(this.char===CHAR_u)return this.call(this.parseSmallUnicode,this.parseUnicodeReturn);if(this.char===CHAR_U)return this.call(this.parseLargeUnicode,this.parseUnicodeReturn);throw this.error(new TomlError("Unknown escape character: "+this.char))}parseUnicodeReturn(s){try{const i=parseInt(s,16);if(i>=SURROGATE_FIRST&&i<=SURROGATE_LAST)throw this.error(new TomlError("Invalid unicode, character in range 0xD800 - 0xDFFF is reserved"));return this.returnNow(String.fromCodePoint(i))}catch(i){throw this.error(TomlError.wrap(i))}}parseSmallUnicode(){if(isHexit(this.char)){if(this.consume(),this.state.buf.length>=4)return this.return()}else throw this.error(new TomlError("Invalid character in unicode sequence, expected hex"))}parseLargeUnicode(){if(isHexit(this.char)){if(this.consume(),this.state.buf.length>=8)return this.return()}else throw this.error(new TomlError("Invalid character in unicode sequence, expected hex"))}parseNumberSign(){return this.consume(),this.next(this.parseMaybeSignedInfOrNan)}parseMaybeSignedInfOrNan(){return this.char===CHAR_i?this.next(this.parseInf):this.char===CHAR_n?this.next(this.parseNan):this.callNow(this.parseNoUnder,this.parseNumberIntegerStart)}parseNumberIntegerStart(){return this.char===CHAR_0?(this.consume(),this.next(this.parseNumberIntegerExponentOrDecimal)):this.goto(this.parseNumberInteger)}parseNumberIntegerExponentOrDecimal(){return this.char===CHAR_PERIOD?(this.consume(),this.call(this.parseNoUnder,this.parseNumberFloat)):this.char===CHAR_E||this.char===CHAR_e?(this.consume(),this.next(this.parseNumberExponentSign)):this.returnNow(Integer(this.state.buf))}parseNumberInteger(){if(isDigit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnder);if(this.char===CHAR_E||this.char===CHAR_e)return this.consume(),this.next(this.parseNumberExponentSign);if(this.char===CHAR_PERIOD)return this.consume(),this.call(this.parseNoUnder,this.parseNumberFloat);{const s=Integer(this.state.buf);if(s.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(s)}}}parseNoUnder(){if(this.char===CHAR_LOWBAR||this.char===CHAR_PERIOD||this.char===CHAR_E||this.char===CHAR_e)throw this.error(new TomlError("Unexpected character, expected digit"));if(this.atEndOfWord())throw this.error(new TomlError("Incomplete number"));return this.returnNow()}parseNoUnderHexOctBinLiteral(){if(this.char===CHAR_LOWBAR||this.char===CHAR_PERIOD)throw this.error(new TomlError("Unexpected character, expected digit"));if(this.atEndOfWord())throw this.error(new TomlError("Incomplete number"));return this.returnNow()}parseNumberFloat(){if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnder,this.parseNumberFloat);if(isDigit(this.char))this.consume();else return this.char===CHAR_E||this.char===CHAR_e?(this.consume(),this.next(this.parseNumberExponentSign)):this.returnNow(Float(this.state.buf))}parseNumberExponentSign(){if(isDigit(this.char))return this.goto(this.parseNumberExponent);if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)this.consume(),this.call(this.parseNoUnder,this.parseNumberExponent);else throw this.error(new TomlError("Unexpected character, expected -, + or digit"))}parseNumberExponent(){if(isDigit(this.char))this.consume();else return this.char===CHAR_LOWBAR?this.call(this.parseNoUnder):this.returnNow(Float(this.state.buf))}parseNumberOrDateTime(){return this.char===CHAR_0?(this.consume(),this.next(this.parseNumberBaseOrDateTime)):this.goto(this.parseNumberOrDateTimeOnly)}parseNumberOrDateTimeOnly(){if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnder,this.parseNumberInteger);if(isDigit(this.char))this.consume(),this.state.buf.length>4&&this.next(this.parseNumberInteger);else return this.char===CHAR_E||this.char===CHAR_e?(this.consume(),this.next(this.parseNumberExponentSign)):this.char===CHAR_PERIOD?(this.consume(),this.call(this.parseNoUnder,this.parseNumberFloat)):this.char===CHAR_HYPHEN?this.goto(this.parseDateTime):this.char===CHAR_COLON?this.goto(this.parseOnlyTimeHour):this.returnNow(Integer(this.state.buf))}parseDateTimeOnly(){if(this.state.buf.length<4){if(isDigit(this.char))return this.consume();if(this.char===CHAR_COLON)return this.goto(this.parseOnlyTimeHour);throw this.error(new TomlError("Expected digit while parsing year part of a date"))}else{if(this.char===CHAR_HYPHEN)return this.goto(this.parseDateTime);throw this.error(new TomlError("Expected hyphen (-) while parsing year part of date"))}}parseNumberBaseOrDateTime(){return this.char===CHAR_b?(this.consume(),this.call(this.parseNoUnderHexOctBinLiteral,this.parseIntegerBin)):this.char===CHAR_o?(this.consume(),this.call(this.parseNoUnderHexOctBinLiteral,this.parseIntegerOct)):this.char===CHAR_x?(this.consume(),this.call(this.parseNoUnderHexOctBinLiteral,this.parseIntegerHex)):this.char===CHAR_PERIOD?this.goto(this.parseNumberInteger):isDigit(this.char)?this.goto(this.parseDateTimeOnly):this.returnNow(Integer(this.state.buf))}parseIntegerHex(){if(isHexit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnderHexOctBinLiteral);{const s=Integer(this.state.buf);if(s.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(s)}}}parseIntegerOct(){if(isOctit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnderHexOctBinLiteral);{const s=Integer(this.state.buf);if(s.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(s)}}}parseIntegerBin(){if(isBit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnderHexOctBinLiteral);{const s=Integer(this.state.buf);if(s.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(s)}}}parseDateTime(){if(this.state.buf.length<4)throw this.error(new TomlError("Years less than 1000 must be zero padded to four characters"));return this.state.result=this.state.buf,this.state.buf="",this.next(this.parseDateMonth)}parseDateMonth(){if(this.char===CHAR_HYPHEN){if(this.state.buf.length<2)throw this.error(new TomlError("Months less than 10 must be zero padded to two characters"));return this.state.result+="-"+this.state.buf,this.state.buf="",this.next(this.parseDateDay)}else if(isDigit(this.char))this.consume();else throw this.error(new TomlError("Incomplete datetime"))}parseDateDay(){if(this.char===CHAR_T||this.char===CHAR_SP){if(this.state.buf.length<2)throw this.error(new TomlError("Days less than 10 must be zero padded to two characters"));return this.state.result+="-"+this.state.buf,this.state.buf="",this.next(this.parseStartTimeHour)}else{if(this.atEndOfWord())return this.returnNow(createDate(this.state.result+"-"+this.state.buf));if(isDigit(this.char))this.consume();else throw this.error(new TomlError("Incomplete datetime"))}}parseStartTimeHour(){return this.atEndOfWord()?this.returnNow(createDate(this.state.result)):this.goto(this.parseTimeHour)}parseTimeHour(){if(this.char===CHAR_COLON){if(this.state.buf.length<2)throw this.error(new TomlError("Hours less than 10 must be zero padded to two characters"));return this.state.result+="T"+this.state.buf,this.state.buf="",this.next(this.parseTimeMin)}else if(isDigit(this.char))this.consume();else throw this.error(new TomlError("Incomplete datetime"))}parseTimeMin(){if(this.state.buf.length<2&&isDigit(this.char))this.consume();else{if(this.state.buf.length===2&&this.char===CHAR_COLON)return this.state.result+=":"+this.state.buf,this.state.buf="",this.next(this.parseTimeSec);throw this.error(new TomlError("Incomplete datetime"))}}parseTimeSec(){if(isDigit(this.char)){if(this.consume(),this.state.buf.length===2)return this.state.result+=":"+this.state.buf,this.state.buf="",this.next(this.parseTimeZoneOrFraction)}else throw this.error(new TomlError("Incomplete datetime"))}parseOnlyTimeHour(){if(this.char===CHAR_COLON){if(this.state.buf.length<2)throw this.error(new TomlError("Hours less than 10 must be zero padded to two characters"));return this.state.result=this.state.buf,this.state.buf="",this.next(this.parseOnlyTimeMin)}else throw this.error(new TomlError("Incomplete time"))}parseOnlyTimeMin(){if(this.state.buf.length<2&&isDigit(this.char))this.consume();else{if(this.state.buf.length===2&&this.char===CHAR_COLON)return this.state.result+=":"+this.state.buf,this.state.buf="",this.next(this.parseOnlyTimeSec);throw this.error(new TomlError("Incomplete time"))}}parseOnlyTimeSec(){if(isDigit(this.char)){if(this.consume(),this.state.buf.length===2)return this.next(this.parseOnlyTimeFractionMaybe)}else throw this.error(new TomlError("Incomplete time"))}parseOnlyTimeFractionMaybe(){if(this.state.result+=":"+this.state.buf,this.char===CHAR_PERIOD)this.state.buf="",this.next(this.parseOnlyTimeFraction);else return this.return(createTime(this.state.result))}parseOnlyTimeFraction(){if(isDigit(this.char))this.consume();else if(this.atEndOfWord()){if(this.state.buf.length===0)throw this.error(new TomlError("Expected digit in milliseconds"));return this.returnNow(createTime(this.state.result+"."+this.state.buf))}else throw this.error(new TomlError("Unexpected character in datetime, expected period (.), minus (-), plus (+) or Z"))}parseTimeZoneOrFraction(){if(this.char===CHAR_PERIOD)this.consume(),this.next(this.parseDateTimeFraction);else if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)this.consume(),this.next(this.parseTimeZoneHour);else{if(this.char===CHAR_Z)return this.consume(),this.return(createDateTime(this.state.result+this.state.buf));if(this.atEndOfWord())return this.returnNow(createDateTimeFloat(this.state.result+this.state.buf));throw this.error(new TomlError("Unexpected character in datetime, expected period (.), minus (-), plus (+) or Z"))}}parseDateTimeFraction(){if(isDigit(this.char))this.consume();else{if(this.state.buf.length===1)throw this.error(new TomlError("Expected digit in milliseconds"));if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)this.consume(),this.next(this.parseTimeZoneHour);else{if(this.char===CHAR_Z)return this.consume(),this.return(createDateTime(this.state.result+this.state.buf));if(this.atEndOfWord())return this.returnNow(createDateTimeFloat(this.state.result+this.state.buf));throw this.error(new TomlError("Unexpected character in datetime, expected period (.), minus (-), plus (+) or Z"))}}}parseTimeZoneHour(){if(isDigit(this.char)){if(this.consume(),/\d\d$/.test(this.state.buf))return this.next(this.parseTimeZoneSep)}else throw this.error(new TomlError("Unexpected character in datetime, expected digit"))}parseTimeZoneSep(){if(this.char===CHAR_COLON)this.consume(),this.next(this.parseTimeZoneMin);else throw this.error(new TomlError("Unexpected character in datetime, expected colon"))}parseTimeZoneMin(){if(isDigit(this.char)){if(this.consume(),/\d\d$/.test(this.state.buf))return this.return(createDateTime(this.state.result+this.state.buf))}else throw this.error(new TomlError("Unexpected character in datetime, expected digit"))}parseBoolean(){if(this.char===CHAR_t)return this.consume(),this.next(this.parseTrue_r);if(this.char===CHAR_f)return this.consume(),this.next(this.parseFalse_a)}parseTrue_r(){if(this.char===CHAR_r)return this.consume(),this.next(this.parseTrue_u);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseTrue_u(){if(this.char===CHAR_u)return this.consume(),this.next(this.parseTrue_e);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseTrue_e(){if(this.char===CHAR_e)return this.return(!0);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_a(){if(this.char===CHAR_a)return this.consume(),this.next(this.parseFalse_l);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_l(){if(this.char===CHAR_l)return this.consume(),this.next(this.parseFalse_s);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_s(){if(this.char===CHAR_s)return this.consume(),this.next(this.parseFalse_e);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_e(){if(this.char===CHAR_e)return this.return(!1);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseInlineList(){if(this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M||this.char===CTRL_J)return null;if(this.char===e.END)throw this.error(new TomlError("Unterminated inline array"));return this.char===CHAR_NUM?this.call(this.parseComment):this.char===CHAR_RSQB?this.return(this.state.resultArr||InlineList()):this.callNow(this.parseValue,this.recordInlineListValue)}recordInlineListValue(s){if(this.state.resultArr){const i=this.state.resultArr[_contentType],n=tomlType$1(s);if(i!==n)throw this.error(new TomlError(`Inline lists must be a single type, not a mix of ${i} and ${n}`))}else this.state.resultArr=InlineList(tomlType$1(s));return isFloat(s)||isInteger(s)?this.state.resultArr.push(s.valueOf()):this.state.resultArr.push(s),this.goto(this.parseInlineListNext)}parseInlineListNext(){if(this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M||this.char===CTRL_J)return null;if(this.char===CHAR_NUM)return this.call(this.parseComment);if(this.char===CHAR_COMMA)return this.next(this.parseInlineList);if(this.char===CHAR_RSQB)return this.goto(this.parseInlineList);throw this.error(new TomlError("Invalid character, expected whitespace, comma (,) or close bracket (])"))}parseInlineTable(){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===e.END||this.char===CHAR_NUM||this.char===CTRL_J||this.char===CTRL_M)throw this.error(new TomlError("Unterminated inline array"));return this.char===CHAR_RCUB?this.return(this.state.resultTable||InlineTable()):(this.state.resultTable||(this.state.resultTable=InlineTable()),this.callNow(this.parseAssign,this.recordInlineTableValue))}recordInlineTableValue(s){let i=this.state.resultTable,n=s.key.pop();for(let h of s.key){if(hasKey(i,h)&&(!isTable(i[h])||i[h][_declared]))throw this.error(new TomlError("Can't redefine existing key"));i=i[h]=i[h]||Table()}if(hasKey(i,n))throw this.error(new TomlError("Can't redefine existing key"));return isInteger(s.value)||isFloat(s.value)?i[n]=s.value.valueOf():i[n]=s.value,this.goto(this.parseInlineTableNext)}parseInlineTableNext(){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===e.END||this.char===CHAR_NUM||this.char===CTRL_J||this.char===CTRL_M)throw this.error(new TomlError("Unterminated inline array"));if(this.char===CHAR_COMMA)return this.next(this.parseInlineTable);if(this.char===CHAR_RCUB)return this.goto(this.parseInlineTable);throw this.error(new TomlError("Invalid character, expected whitespace, comma (,) or close bracket (])"))}}return t}var tomlParserExports=tomlParser.exports,parsePrettyError=prettyError$2;function prettyError$2(e,t){if(e.pos==null||e.line==null)return e;let r=e.message;if(r+=` at row ${e.line+1}, col ${e.col+1}, pos ${e.pos}:
`,t&&t.split){const s=t.split(/\n/),i=String(Math.min(s.length,e.line+3)).length;let n=" ";for(;n.length<i;)n+=" ";for(let h=Math.max(0,e.line-1);h<Math.min(s.length,e.line+2);++h){let c=String(h+1);if(c.length<i&&(c=" "+c),e.line===h){r+=c+"> "+s[h]+`
`,r+=n+"  ";for(let x=0;x<e.col;++x)r+=" ";r+=`^
`}else r+=c+": "+s[h]+`
`}}return e.message=r+`
`,e}var parseString_1=parseString;const TOMLParser$2=tomlParserExports,prettyError$1=parsePrettyError;function parseString(e){commonjsGlobal.Buffer&&commonjsGlobal.Buffer.isBuffer(e)&&(e=e.toString("utf8"));const t=new TOMLParser$2;try{return t.parse(e),t.finish()}catch(r){throw prettyError$1(r,e)}}var parseAsync_1=parseAsync;const TOMLParser$1=tomlParserExports,prettyError=parsePrettyError;function parseAsync(e,t){t||(t={});const r=0,s=t.blocksize||40960,i=new TOMLParser$1;return new Promise((h,c)=>{setImmediate(n,r,s,h,c)});function n(h,c,x,y){if(h>=e.length)try{return x(i.finish())}catch(A){return y(prettyError(A,e))}try{i.parse(e.slice(h,h+c)),setImmediate(n,h+c,c,x,y)}catch(A){y(prettyError(A,e))}}}const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);var parseStream_1=parseStream;const stream=require$$0,TOMLParser=tomlParserExports;function parseStream(e){return e?parseReadable(e):parseTransform()}function parseReadable(e){const t=new TOMLParser;return e.setEncoding("utf8"),new Promise((r,s)=>{let i,n=!1,h=!1;function c(){if(n=!0,!i)try{r(t.finish())}catch(A){s(A)}}function x(A){h=!0,s(A)}e.once("end",c),e.once("error",x),y();function y(){i=!0;let A;for(;(A=e.read())!==null;)try{t.parse(A)}catch(R){return x(R)}if(i=!1,n)return c();h||e.once("readable",y)}})}function parseTransform(){const e=new TOMLParser;return new stream.Transform({objectMode:!0,transform(t,r,s){try{e.parse(t.toString(r))}catch(i){this.emit("error",i)}s()},flush(t){try{this.push(e.finish())}catch(r){this.emit("error",r)}t()}})}parse$1.exports=parseString_1,parse$1.exports.async=parseAsync_1,parse$1.exports.stream=parseStream_1,parse$1.exports.prettyError=parsePrettyError;var parseExports=parse$1.exports,stringify$1={exports:{}};stringify$1.exports=stringify,stringify$1.exports.value=stringifyInline;function stringify(e){if(e===null)throw typeError("null");if(e===void 0)throw typeError("undefined");if(typeof e!="object")throw typeError(typeof e);if(typeof e.toJSON=="function"&&(e=e.toJSON()),e==null)return null;const t=tomlType(e);if(t!=="table")throw typeError(t);return stringifyObject("","",e)}function typeError(e){return new Error("Can only stringify objects, not "+e)}function arrayOneTypeError(){return new Error("Array values can't have mixed types")}function getInlineKeys(e){return Object.keys(e).filter(t=>isInline(e[t]))}function getComplexKeys(e){return Object.keys(e).filter(t=>!isInline(e[t]))}function toJSON(e){let t=Array.isArray(e)?[]:Object.prototype.hasOwnProperty.call(e,"__proto__")?{["__proto__"]:void 0}:{};for(let r of Object.keys(e))e[r]&&typeof e[r].toJSON=="function"&&!("toISOString"in e[r])?t[r]=e[r].toJSON():t[r]=e[r];return t}function stringifyObject(e,t,r){r=toJSON(r);var s,i;s=getInlineKeys(r),i=getComplexKeys(r);var n=[],h=t||"";s.forEach(x=>{var y=tomlType(r[x]);y!=="undefined"&&y!=="null"&&n.push(h+stringifyKey(x)+" = "+stringifyAnyInline(r[x],!0))}),n.length>0&&n.push("");var c=e&&s.length>0?t+"  ":"";return i.forEach(x=>{n.push(stringifyComplex(e,c,x,r[x]))}),n.join(`
`)}function isInline(e){switch(tomlType(e)){case"undefined":case"null":case"integer":case"nan":case"float":case"boolean":case"string":case"datetime":return!0;case"array":return e.length===0||tomlType(e[0])!=="table";case"table":return Object.keys(e).length===0;default:return!1}}function tomlType(e){return e===void 0?"undefined":e===null?"null":typeof e=="bigint"||Number.isInteger(e)&&!Object.is(e,-0)?"integer":typeof e=="number"?"float":typeof e=="boolean"?"boolean":typeof e=="string"?"string":"toISOString"in e?isNaN(e)?"undefined":"datetime":Array.isArray(e)?"array":"table"}function stringifyKey(e){var t=String(e);return/^[-A-Za-z0-9_]+$/.test(t)?t:stringifyBasicString(t)}function stringifyBasicString(e){return'"'+escapeString(e).replace(/"/g,'\\"')+'"'}function stringifyLiteralString(e){return"'"+e+"'"}function numpad(e,t){for(;t.length<e;)t="0"+t;return t}function escapeString(e){return e.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/([\u0000-\u001f\u007f])/,t=>"\\u"+numpad(4,t.codePointAt(0).toString(16)))}function stringifyMultilineString(e){let t=e.split(/\n/).map(r=>escapeString(r).replace(/"(?="")/g,'\\"')).join(`
`);return t.slice(-1)==='"'&&(t+=`\\
`),`"""
`+t+'"""'}function stringifyAnyInline(e,t){let r=tomlType(e);return r==="string"&&(t&&/\n/.test(e)?r="string-multiline":!/[\b\t\n\f\r']/.test(e)&&/"/.test(e)&&(r="string-literal")),stringifyInline(e,r)}function stringifyInline(e,t){switch(t||(t=tomlType(e)),t){case"string-multiline":return stringifyMultilineString(e);case"string":return stringifyBasicString(e);case"string-literal":return stringifyLiteralString(e);case"integer":return stringifyInteger(e);case"float":return stringifyFloat(e);case"boolean":return stringifyBoolean(e);case"datetime":return stringifyDatetime(e);case"array":return stringifyInlineArray(e.filter(r=>tomlType(r)!=="null"&&tomlType(r)!=="undefined"&&tomlType(r)!=="nan"));case"table":return stringifyInlineTable(e);default:throw typeError(t)}}function stringifyInteger(e){return String(e).replace(/\B(?=(\d{3})+(?!\d))/g,"_")}function stringifyFloat(e){if(e===1/0)return"inf";if(e===-1/0)return"-inf";if(Object.is(e,NaN))return"nan";if(Object.is(e,-0))return"-0.0";var t=String(e).split("."),r=t[0],s=t[1]||0;return stringifyInteger(r)+"."+s}function stringifyBoolean(e){return String(e)}function stringifyDatetime(e){return e.toISOString()}function isNumber(e){return e==="float"||e==="integer"}function arrayType(e){var t=tomlType(e[0]);return e.every(r=>tomlType(r)===t)?t:e.every(r=>isNumber(tomlType(r)))?"float":"mixed"}function validateArray(e){const t=arrayType(e);if(t==="mixed")throw arrayOneTypeError();return t}function stringifyInlineArray(e){e=toJSON(e);const t=validateArray(e);var r="[",s=e.map(i=>stringifyInline(i,t));return s.join(", ").length>60||/\n/.test(s)?r+=`
  `+s.join(`,
  `)+`
`:r+=" "+s.join(", ")+(s.length>0?" ":""),r+"]"}function stringifyInlineTable(e){e=toJSON(e);var t=[];return Object.keys(e).forEach(r=>{t.push(stringifyKey(r)+" = "+stringifyAnyInline(e[r],!1))}),"{ "+t.join(", ")+(t.length>0?" ":"")+"}"}function stringifyComplex(e,t,r,s){var i=tomlType(s);if(i==="array")return stringifyArrayOfTables(e,t,r,s);if(i==="table")return stringifyComplexTable(e,t,r,s);throw typeError(i)}function stringifyArrayOfTables(e,t,r,s){s=toJSON(s),validateArray(s);var i=tomlType(s[0]);if(i!=="table")throw typeError(i);var n=e+stringifyKey(r),h="";return s.forEach(c=>{h.length>0&&(h+=`
`),h+=t+"[["+n+`]]
`,h+=stringifyObject(n+".",t,c)}),h}function stringifyComplexTable(e,t,r,s){var i=e+stringifyKey(r),n="";return getInlineKeys(s).length>0&&(n+=t+"["+i+`]
`),n+stringifyObject(i+".",t,s)}var parse=parseExports,FilterType=(e=>(e.CSS="css",e.CONTENT="content",e))(FilterType||{});function domainMatches(e,t){return t.some(r=>{if(r==="*")return!0;if(r.startsWith("*.")){const s=r.slice(2);return e.endsWith(s)||e===s}return e===r})}function logError(e,t){console.error(`aiBlock Error: ${e}`,t?JSON.stringify(t):"")}const browser=browser$1;var has=Object.prototype.hasOwnProperty;function dequal(e,t){var r,s;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return e.toString()===t.toString();if(r===Array){if((s=e.length)===t.length)for(;s--&&dequal(e[s],t[s]););return s===-1}if(!r||typeof e=="object"){s=0;for(r in e)if(has.call(e,r)&&++s&&!has.call(t,r)||!(r in t)||!dequal(e[r],t[r]))return!1;return Object.keys(t).length===s}}return e!==e&&t!==t}function print$1(e,...t){}const logger$1={debug:(...e)=>print$1(console.debug,...e),log:(...e)=>print$1(console.log,...e),warn:(...e)=>print$1(console.warn,...e),error:(...e)=>print$1(console.error,...e)};function toArray(e){return Array.isArray(e)?e:[e]}const E_CANCELED=new Error("request for lock canceled");var __awaiter$2=function(e,t,r,s){function i(n){return n instanceof r?n:new r(function(h){h(n)})}return new(r||(r=Promise))(function(n,h){function c(A){try{y(s.next(A))}catch(R){h(R)}}function x(A){try{y(s.throw(A))}catch(R){h(R)}}function y(A){A.done?n(A.value):i(A.value).then(c,x)}y((s=s.apply(e,t||[])).next())})};class Semaphore{constructor(t,r=E_CANCELED){this._value=t,this._cancelError=r,this._queue=[],this._weightedWaiters=[]}acquire(t=1,r=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((s,i)=>{const n={resolve:s,reject:i,weight:t,priority:r},h=findIndexFromEnd(this._queue,c=>r<=c.priority);h===-1&&t<=this._value?this._dispatchItem(n):this._queue.splice(h+1,0,n)})}runExclusive(t){return __awaiter$2(this,arguments,void 0,function*(r,s=1,i=0){const[n,h]=yield this.acquire(s,i);try{return yield r(n)}finally{h()}})}waitForUnlock(t=1,r=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return this._couldLockImmediately(t,r)?Promise.resolve():new Promise(s=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),insertSorted(this._weightedWaiters[t-1],{resolve:s,priority:r})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatchQueue()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatchQueue()}cancel(){this._queue.forEach(t=>t.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(t){const r=this._value;this._value-=t.weight,t.resolve([r,this._newReleaser(t.weight)])}_newReleaser(t){let r=!1;return()=>{r||(r=!0,this.release(t))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let t=this._value;t>0;t--){const r=this._weightedWaiters[t-1];r&&(r.forEach(s=>s.resolve()),this._weightedWaiters[t-1]=[])}else{const t=this._queue[0].priority;for(let r=this._value;r>0;r--){const s=this._weightedWaiters[r-1];if(!s)continue;const i=s.findIndex(n=>n.priority<=t);(i===-1?s:s.splice(0,i)).forEach(n=>n.resolve())}}}_couldLockImmediately(t,r){return(this._queue.length===0||this._queue[0].priority<r)&&t<=this._value}}function insertSorted(e,t){const r=findIndexFromEnd(e,s=>t.priority<=s.priority);e.splice(r+1,0,t)}function findIndexFromEnd(e,t){for(let r=e.length-1;r>=0;r--)if(t(e[r]))return r;return-1}var __awaiter$1=function(e,t,r,s){function i(n){return n instanceof r?n:new r(function(h){h(n)})}return new(r||(r=Promise))(function(n,h){function c(A){try{y(s.next(A))}catch(R){h(R)}}function x(A){try{y(s.throw(A))}catch(R){h(R)}}function y(A){A.done?n(A.value):i(A.value).then(c,x)}y((s=s.apply(e,t||[])).next())})};class Mutex{constructor(t){this._semaphore=new Semaphore(1,t)}acquire(){return __awaiter$1(this,arguments,void 0,function*(t=0){const[,r]=yield this._semaphore.acquire(1,t);return r})}runExclusive(t,r=0){return this._semaphore.runExclusive(()=>t(),1,r)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(t=0){return this._semaphore.waitForUnlock(1,t)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const storage=createStorage();function createStorage(){const e={local:createDriver("local"),session:createDriver("session"),sync:createDriver("sync"),managed:createDriver("managed")},t=o=>{const a=e[o];if(a==null){const l=Object.keys(e).join(", ");throw Error(`Invalid area "${o}". Options: ${l}`)}return a},r=o=>{const a=o.indexOf(":"),l=o.substring(0,a),g=o.substring(a+1);if(g==null)throw Error(`Storage key should be in the form of "area:key", but received "${o}"`);return{driverArea:l,driverKey:g,driver:t(l)}},s=o=>o+"$",i=(o,a)=>o??a??null,n=o=>typeof o=="object"&&!Array.isArray(o)?o:{},h=async(o,a,l)=>{const g=await o.getItem(a);return i(g,(l==null?void 0:l.fallback)??(l==null?void 0:l.defaultValue))},c=async(o,a)=>{const l=s(a),g=await o.getItem(l);return n(g)},x=async(o,a,l)=>{await o.setItem(a,l??null)},y=async(o,a,l)=>{const g=s(a),T={...n(await o.getItem(g))};Object.entries(l).forEach(([N,b])=>{b==null?delete T[N]:T[N]=b}),await o.setItem(g,T)},A=async(o,a,l)=>{if(await o.removeItem(a),l!=null&&l.removeMeta){const g=s(a);await o.removeItem(g)}},R=async(o,a,l)=>{const g=s(a);if(l==null)await o.removeItem(g);else{const _=n(await o.getItem(g));toArray(l).forEach(T=>delete _[T]),await o.setItem(g,_)}},O=(o,a,l)=>o.watch(a,l);return{getItem:async(o,a)=>{const{driver:l,driverKey:g}=r(o);return await h(l,g,a)},getItems:async o=>{const a=new Map,l=new Map;return o.forEach(_=>{let T,N;typeof _=="string"?T=_:(T=_.key,N=_.options);const{driverArea:b,driverKey:m}=r(T),u=a.get(b)??[];a.set(b,u.concat(m)),l.set(T,N)}),(await Promise.all(Array.from(a.entries()).map(async([_,T])=>(await e[_].getItems(T)).map(b=>{const m=`${_}:${b.key}`,u=l.get(m),d=i(b.value,(u==null?void 0:u.fallback)??(u==null?void 0:u.defaultValue));return{key:m,value:d}})))).flat()},getMeta:async o=>{const{driver:a,driverKey:l}=r(o);return await c(a,l)},setItem:async(o,a)=>{const{driver:l,driverKey:g}=r(o);await x(l,g,a)},setItems:async o=>{const a=new Map;o.forEach(({key:l,value:g})=>{const{driverArea:_,driverKey:T}=r(l),N=a.get(_)??[];a.set(_,N.concat({key:T,value:g}))}),await Promise.all(Array.from(a.entries()).map(async([l,g])=>{await t(l).setItems(g)}))},setMeta:async(o,a)=>{const{driver:l,driverKey:g}=r(o);await y(l,g,a)},removeItem:async(o,a)=>{const{driver:l,driverKey:g}=r(o);await A(l,g,a)},removeItems:async o=>{const a=new Map;o.forEach(l=>{let g,_;typeof l=="string"?g=l:(g=l.key,_=l.options);const{driverArea:T,driverKey:N}=r(g),b=a.get(T)??[];b.push(N),_!=null&&_.removeMeta&&b.push(s(N)),a.set(T,b)}),await Promise.all(Array.from(a.entries()).map(async([l,g])=>{await t(l).removeItems(g)}))},removeMeta:async(o,a)=>{const{driver:l,driverKey:g}=r(o);await R(l,g,a)},snapshot:async(o,a)=>{var _;const g=await t(o).snapshot();return(_=a==null?void 0:a.excludeKeys)==null||_.forEach(T=>{delete g[T],delete g[s(T)]}),g},restoreSnapshot:async(o,a)=>{await t(o).restoreSnapshot(a)},watch:(o,a)=>{const{driver:l,driverKey:g}=r(o);return O(l,g,a)},unwatch(){Object.values(e).forEach(o=>{o.unwatch()})},defineItem:(o,a)=>{const{driver:l,driverKey:g}=r(o),{version:_=1,migrations:T={}}=a??{};if(_<1)throw Error("Storage item version cannot be less than 1. Initial versions should be set to 1, not 0.");const N=async()=>{var C;const p=s(g),[{value:E},{value:S}]=await l.getItems([g,p]);if(E==null)return;const I=(S==null?void 0:S.v)??1;if(I>_)throw Error(`Version downgrade detected (v${I} -> v${_}) for "${o}"`);logger$1.debug(`Running storage migration for ${o}: v${I} -> v${_}`);const w=Array.from({length:_-I},(v,M)=>I+M+1);let H=E;for(const v of w)H=await((C=T==null?void 0:T[v])==null?void 0:C.call(T,H))??H;await l.setItems([{key:g,value:H},{key:p,value:{...S,v:_}}]),logger$1.debug(`Storage migration completed for ${o} v${_}`,{migratedValue:H})},b=(a==null?void 0:a.migrations)==null?Promise.resolve():N().catch(p=>{logger$1.error(`Migration failed for ${o}`,p)}),m=new Mutex,u=()=>(a==null?void 0:a.fallback)??(a==null?void 0:a.defaultValue)??null,d=()=>m.runExclusive(async()=>{const p=await l.getItem(g);if(p!=null||(a==null?void 0:a.init)==null)return p;const E=await a.init();return await l.setItem(g,E),E});return b.then(d),{get defaultValue(){return u()},get fallback(){return u()},getValue:async()=>(await b,a!=null&&a.init?await d():await h(l,g,a)),getMeta:async()=>(await b,await c(l,g)),setValue:async p=>(await b,await x(l,g,p)),setMeta:async p=>(await b,await y(l,g,p)),removeValue:async p=>(await b,await A(l,g,p)),removeMeta:async p=>(await b,await R(l,g,p)),watch:p=>O(l,g,(E,S)=>p(E??u(),S??u())),migrate:N}}}}function createDriver(e){const t=()=>{if(browser.runtime==null)throw Error(["'wxt/storage' must be loaded in a web extension environment",`
 - If thrown during a build, see https://github.com/wxt-dev/wxt/issues/371`,` - If thrown during tests, mock 'wxt/browser' correctly. See https://wxt.dev/guide/go-further/testing.html
`].join(`
`));if(browser.storage==null)throw Error("You must add the 'storage' permission to your manifest to use 'wxt/storage'");const s=browser.storage[e];if(s==null)throw Error(`"browser.storage.${e}" is undefined`);return s},r=new Set;return{getItem:async s=>(await t().get(s))[s],getItems:async s=>{const i=await t().get(s);return s.map(n=>({key:n,value:i[n]??null}))},setItem:async(s,i)=>{i==null?await t().remove(s):await t().set({[s]:i})},setItems:async s=>{const i=s.reduce((n,{key:h,value:c})=>(n[h]=c,n),{});await t().set(i)},removeItem:async s=>{await t().remove(s)},removeItems:async s=>{await t().remove(s)},snapshot:async()=>await t().get(),restoreSnapshot:async s=>{await t().set(s)},watch(s,i){const n=h=>{const c=h[s];c!=null&&(dequal(c.newValue,c.oldValue)||i(c.newValue??null,c.oldValue??null))};return t().onChanged.addListener(n),r.add(n),()=>{t().onChanged.removeListener(n),r.delete(n)}},unwatch(){r.forEach(s=>{t().onChanged.removeListener(s)}),r.clear()}}}class Storage{static async initialize(){if(!this.initialized)try{await storage.getItem(this.STORAGE_KEY),this.initialized=!0}catch(t){throw logError("Error initializing storage",t),new Error("Storage initialization failed")}}static async getStorageData(){await this.initialize();try{return await storage.getItem(this.STORAGE_KEY)??{userPreferences:{globalEnabled:!0},filterStates:{},siteStates:{}}}catch(t){return logError("Error getting storage data",t),{userPreferences:{globalEnabled:!0},filterStates:{},siteStates:{}}}}static async getUserPreferences(){var t;await this.initialize();try{return{globalEnabled:((t=(await this.getStorageData()).userPreferences)==null?void 0:t.globalEnabled)??!0}}catch(r){return logError("Error getting user preferences",r),{globalEnabled:!0}}}static async updatePreferences(t){await this.initialize();try{const r=await this.getStorageData(),s={...r.userPreferences,...t};await storage.setItem(this.STORAGE_KEY,{...r,userPreferences:s})}catch(r){logError("Error updating preferences",r)}}static async getFilterStates(){await this.initialize();try{return(await this.getStorageData()).filterStates}catch(t){return logError("Error getting filter states",t),{}}}static async setFilterStates(t){await this.initialize();try{const r=await this.getStorageData();await storage.setItem(this.STORAGE_KEY,{...r,filterStates:t})}catch(r){logError("Error setting filter states",r)}}static async getSiteStates(){await this.initialize();try{return(await this.getStorageData()).siteStates}catch(t){return logError("Error getting site states",t),{}}}static async setSiteStates(t){await this.initialize();try{const r=await this.getStorageData();await storage.setItem(this.STORAGE_KEY,{...r,siteStates:t})}catch(r){logError("Error setting site states",r)}}}D(Storage,"STORAGE_KEY","local:aiBlockData"),D(Storage,"initialized",!1);class FilterManager{constructor(){D(this,"filters",[]);D(this,"domainFilterMap",new Map)}async loadFilters(){try{const r=await(await fetch("/filters.toml")).text(),s=parse(r);if(this.isValidFilterList(s)){this.filters=s.filters,this.classifyFilters(),this.buildDomainFilterMap();const i=await Storage.getFilterStates();this.filters.forEach(n=>{n.enabled=i[n.id]??n.enabled})}else throw new Error("Invalid filter list format")}catch(t){logError("Error loading filters",t)}}isValidFilterList(t){const r=t;return typeof r.version=="string"&&typeof r.last_updated=="string"&&Array.isArray(r.categories)&&typeof r.metadata=="object"&&Array.isArray(r.filters)}classifyFilters(){this.filters.forEach(t=>{t.type=t.selectors?FilterType.CSS:FilterType.CONTENT})}buildDomainFilterMap(){this.domainFilterMap.clear(),this.filters.forEach(t=>{t.domains.forEach(r=>{this.domainFilterMap.has(r)||this.domainFilterMap.set(r,[]),this.domainFilterMap.get(r).push(t)})})}getActiveFiltersForDomain(t){return this.getFiltersForDomain(t).filter(s=>s.enabled)}getFiltersForDomain(t){const r=[];return this.domainFilterMap.forEach((s,i)=>{domainMatches(t,[i])&&r.push(...s)}),r}async toggleFilter(t,r){const s=this.filters.find(i=>i.id===t);s?(s.enabled=r,await this.saveFilterStates()):logError(`Filter not found: ${t}`)}async saveFilterStates(){const t={};this.filters.forEach(r=>{t[r.id]=r.enabled});try{await Storage.setFilterStates(t)}catch(r){logError("Error saving filter states",r)}}getAllFilters(){return this.filters}}const definition=defineBackground(()=>{const e=new FilterManager;let t;async function r(){try{await e.loadFilters(),await Storage.getUserPreferences()||await Storage.updatePreferences({globalEnabled:!0}),t=new Map(Object.entries(await Storage.getSiteStates()))}catch(c){logError("Error initializing extension",c)}}browser$1.runtime.onInstalled.addListener(r),r(),browser$1.runtime.onMessage.addListener(async(c,x)=>{try{switch(c.type){case"INITIALIZE_CONTENT_SCRIPT":return await n(x);case"GET_USER_PREFERENCES":return await Storage.getUserPreferences();case"UPDATE_PREFERENCES":c.preferences&&await Storage.updatePreferences(c.preferences);return;case"GET_ACTIVE_FILTERS":return await h(c,x);case"GET_FILTERS_FOR_DOMAIN":return e.getFiltersForDomain(c.domain);case"TOGGLE_FILTER":c.filterId!==void 0&&c.enabled!==void 0&&await e.toggleFilter(c.filterId,c.enabled);return;case"GET_FILTERS":return e.getAllFilters();case"GET_SITE_STATE":return{enabled:s(c.domain)};case"SET_SITE_STATE":i(c.domain,c.enabled);return;default:console.warn("Unknown message type:",c.type);return}}catch(y){throw logError("Error handling message",y),y}});function s(c){return t.get(c)??!0}async function i(c,x){t.set(c,x),await Storage.setSiteStates(Object.fromEntries(t))}async function n(c){var P;const x=(P=c.tab)!=null&&P.url?new URL(c.tab.url).hostname:null;if(!x)return{isEnabled:!1,siteAllowed:!1,filters:[]};const A=(await Storage.getUserPreferences()).globalEnabled,R=!s(x);if(!A||R)return{isEnabled:A,siteAllowed:R,filters:[]};const O=e.getActiveFiltersForDomain(x);return{isEnabled:A,siteAllowed:R,filters:O}}async function h(c,x){var O;const y=c.domain||((O=x.tab)!=null&&O.url?new URL(x.tab.url).hostname:null);if(!y)return[];const A=await Storage.getUserPreferences(),R=!s(y);return!A.globalEnabled||R?[]:e.getActiveFiltersForDomain(y)}});function initPlugins(){}function print(e,...t){}const logger={debug:(...e)=>print(console.debug,...e),log:(...e)=>print(console.log,...e),warn:(...e)=>print(console.warn,...e),error:(...e)=>print(console.error,...e)};let result;try{result=definition.main(),result instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(e){throw logger.error("The background crashed on startup!"),e}const result$1=result;return result$1}();
background;
