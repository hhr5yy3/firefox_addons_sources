/*! For license information please see app.js.LICENSE.txt */
(()=>{var e,t={946:(e,t,s)=>{const r=s(815),n=s(207),o=s(627);r.scripting||(r.scripting=new n(r)),r.storage.session||(r.storage.session=new o),r.action||(r.action=r.browserAction),e.exports=r},207:e=>{e.exports=class{constructor(e){this.browser=e}async executeScript(e){return e.func?await this._insertJsFunc(e):this._insertJsFiles(e)}insertCSS(e){let t=null;const s=e.files;for(let r=s.length-1;r>=0;--r){const n={file:s[r],runAt:"document_end",frameId:e.target?.frameIds[0]};t=this._createCssCallback(e.target.tabId,n,t)}t&&t()}_createJsCallback(e,t,s){return()=>chrome.tabs.executeScript(e,t,s)}_createCssCallback(e,t,s){return()=>chrome.tabs.insertCSS(e,t,s)}_insertJsFiles(e){let t=null;const s=e.files;for(let r=s.length-1;r>=0;--r){const n={file:s[r],runAt:"document_end",frameId:e.target?.frameIds[0]};t=this._createJsCallback(e.target.tabId,n,t)}t&&t()}async _insertJsFunc(e){const t=JSON.stringify(e.args),s=`;${e.func.name}.apply(window, ${t});`,r={code:e.func.toString()+s,runAt:"document_end",frameId:e.target?.frameIds[0]},n=await this.browser.tabs.executeScript(e.target.tabId,r);return n?.map((e=>({result:e})))}}},627:e=>{e.exports=class{constructor(){this._storedData={}}async get(e){const t=typeof e;if("string"!==t&&"undefined"!==t)throw new Error(`Expected keys type of "string" but received an unsopprted type: ${t}`);return e?this._storedData[e]?{[e]:this._storedData[e]}:{}:this._storedData}async set(e){if("object"!=typeof e)throw new Error('Expected keys type of "object" but received an unsopprted type: '+typeof e);for(const t in e)this._storedData[t]=JSON.parse(JSON.stringify(e[t]))}async remove(e){delete this._storedData[e]}async clear(){this._storedData={}}}},28:(e,t,s)=>{"use strict";var r=s(540),n=s(961),o=s(625),a=s(347),i=s(556),c=s.n(i);class p extends r.Component{constructor(e){super(e),this.createRefs()}componentDidMount(){this.loadAppIframe()}createRefs(){this.iframeRef=r.createRef()}async loadAppIframe(){const e=await this.props.port.request("passbolt.port.generate-id","App"),t=new URL(`${this.props.browserExtensionUrl}webAccessibleResources/passbolt-iframe-app.html`);t.searchParams.append("passbolt",e);const s=this.getPagePathname();s&&"/"!==s&&t.searchParams.append("pathname",s),this.iframeRef.current.contentWindow.location=t.toString()}getPagePathname(){return this.validatePagePathname()?this.props.location.pathname:null}validatePagePathname(){return/^[A-Za-z0-9\-\/]*$/.test(this.props.location.pathname)}render(){return r.createElement("iframe",{id:"passbolt-iframe-app",ref:this.iframeRef,className:"full-screen",allow:`clipboard-write ${this.props.browserExtensionUrl}webAccessibleResources/passbolt-iframe-app.html`})}}p.propTypes={browserExtensionUrl:c().string,location:c().object,port:c().object};const l=(0,a.y)(p);class h extends r.Component{constructor(e){super(e),this.createRefs()}componentDidMount(){this.loadIframe()}createRefs(){this.iframeRef=r.createRef()}async loadIframe(){const e=await this.props.port.request("passbolt.port.generate-id","FileIframe");this.iframeRef.current.contentWindow.location=`${this.props.browserExtensionUrl}webAccessibleResources/passbolt-iframe-file.html?passbolt=${e}`}render(){return r.createElement("iframe",{id:"passbolt-iframe-file",ref:this.iframeRef,className:"cachette"})}}h.propTypes={browserExtensionUrl:c().string,port:c().object};const u=h;class d{constructor(e){this.settings=e}get id(){return this.settings["user.id"]}get fullName(){return`${this.settings["user.firstname"]} ${this.settings["user.lastname"]}`}get username(){return this.settings["user.username"]}getTheme(){return this.settings["user.settings.theme"]}getTrustedDomain(){return this.settings["user.settings.trustedDomain"]}getSecurityToken(){return{code:this.settings["user.settings.securityToken.code"],backgroundColor:this.settings["user.settings.securityToken.color"],textColor:this.settings["user.settings.securityToken.textColor"]}}get locale(){return this.settings["user.settings.locale"]}}class g extends r.Component{componentDidMount(){this.handleRouteChangeRequested()}handleRouteChangeRequested(){this.props.port.on("passbolt.app-bootstrap.change-route",(e=>{/^\/[A-Za-z0-9\-\/]*$/.test(e)&&this.props.history.replace(e)}))}render(){return r.createElement(r.Fragment,null)}}g.propTypes={history:c().object,port:c().any};const m=(0,a.y)(g);class f extends r.Component{constructor(e){super(e),this.state=this.getDefaultState(e)}getDefaultState(e){return{port:e.port,storage:e.storage,userSettings:null}}componentDidMount(){this.getUserSettings()}isPassboltApp(){const e=document.getRootNode().lastChild;return"HTML"===e?.tagName&&e.classList.contains("passbolt")}async getUserSettings(){const e=await this.props.storage.local.get(["_passbolt_data"]),t=new d(e._passbolt_data.config);this.setState({userSettings:t})}get isReady(){return null!==this.state.userSettings}get basename(){const e=this.state.userSettings.getTrustedDomain();return new URL(e).pathname}render(){return this.isPassboltApp()?r.createElement(r.Fragment,null,this.isReady&&r.createElement(o.Kd,{basename:this.basename},r.createElement(m,{port:this.props.port}),r.createElement(a.dO,null,r.createElement(a.qh,{exact:!0,path:["/app/account-recovery/requests/review/:accountRecoveryRequestId","/app/administration/subscription","/app/administration/account-recovery","/app/administration/sso","/app/administration/password-policies","/app/administration/user-passphrase-policies","/app/administration/password-expiry","/app/folders/view/:filterByFolderId","/app/groups/view/:selectedGroupId","/app/groups/edit/:selectedGroupId","/app/passwords/view/:selectedResourceId","/app/passwords/filter/:filterType","/app/passwords","/app/settings","/app/settings/keys","/app/settings/profile","/app/settings/passphrase","/app/settings/security-token","/app/settings/mobile","/app/settings/desktop","/app/settings/account-recovery","/app/settings/account-recovery/edit","/app/settings/theme","/app/users/view/:selectedUserId","/app/users","/app","/"]},r.createElement(l,{port:this.props.port,browserExtensionUrl:this.props.browserExtensionUrl}),r.createElement(u,{port:this.props.port,browserExtensionUrl:this.props.browserExtensionUrl}))))):null}}f.propTypes={browserExtensionUrl:c().string,port:c().object,storage:c().object};const b=f;var y=s(11);const w=class{constructor(){this._locked=!1,this._queue=[]}acquire(){return this._locked?new Promise((e=>this._queue.push(e))):(this._locked=!0,Promise.resolve())}release(){const e=this._queue.shift();e?e():this._locked=!1}};var _=s(946);const v=class{constructor(e){if(this._listeners={},this.lock=new w,this.onConnectErrorHandler={},void 0===e)throw Error("A port name is required.");if("string"!=typeof e)throw Error("The port name should be a valid string.");this._name=e}connect(){let e;const t=new Promise((t=>{e=t}));try{this._port=_.runtime.connect({name:this._name})}catch(e){throw this.onConnectErrorHandler.callback(),e}return this._connected=!0,this.initListener(),this.once("passbolt.port.ready",e),t}initListener(){this._port.onDisconnect.addListener((()=>{console.warn(`port disconnected from addon code: ${this._name}`),this._connected=!1})),this._port.onMessage.addListener((e=>{this._onMessage(e)}))}_onMessage(e){const t=JSON.parse(e),s=t[0];if(Array.isArray(this._listeners[s])){const e=this._listeners[s];for(let r=0;r<e.length;r++){const n=e[r],o=Array.prototype.slice.call(t,1);n.callback.apply(this,o),n.once&&(this._listeners[s].splice(r,1),0===this._listeners[s].length&&delete this._listeners[s],r--)}}}_addListener(e,t,s){Array.isArray(this._listeners[e])||(this._listeners[e]=[]),this._listeners[e].push({name:e,callback:t,once:s})}on(e,t){this._addListener(e,t,!1)}once(e,t){this._addListener(e,t,!0)}async emit(...e){const t=JSON.stringify(e);await this.connectIfDisconnected(),this._port.postMessage(t)}request(e,...t){const s=(0,y.A)(),r=[e,s].concat(t);return new Promise(((e,t)=>{this.once(s,((s,...r)=>{"SUCCESS"===s?e.apply(null,r):"ERROR"===s&&t.apply(null,r)})),this.emit.apply(this,r)}))}async connectIfDisconnected(){try{await this.lock.acquire(),this._connected||await this.connect()}finally{this.lock.release()}}onConnectError(e){this.onConnectErrorHandler.callback=e}};var E=s(946);const S=class{constructor(){this._listeners={},this._onMessage=this._onMessage.bind(this),E.runtime.onMessage.addListener(this._onMessage)}async _onMessage(e){const t=e[0];if(void 0!==this._listeners[t]&&this._listeners[t].length>0){const s=this._listeners[t];for(let t=0;t<s.length;t++){const r=s[t],n=Array.prototype.slice.call(e,1);await r.callback.apply(this,n)}}}addListener(e,t){void 0===this._listeners[e]&&(this._listeners[e]=[]),this._listeners[e].push({name:e,callback:t})}success(e){return Promise.resolve(e)}error(e){return Promise.reject(e)}},x=class{constructor(e){if(!(e instanceof S))throw new Error("The messageService should be a valid MessageService instance.");this.messageService=e}listen(e,t,...s){if("string"!=typeof e)throw new Error("The message should be a valid string.");if(!e.length)throw new Error("The message should not be empty.");if("function"!=typeof t)throw new Error("The ControllerClass should be a valid class.");this.messageService.addListener(e,(async(...e)=>{e=e||{};try{const r=new t(...s||{}),n=await r.exec(...e);await this.messageService.success(n)}catch(e){await this.messageService.error(e)}}))}},k=class{constructor(e){this.port=e}async exec(e){this.port._name===e&&await this.port.connectIfDisconnected()}};var C=s(946);!async function(){const e=new v(self.portname);e.on("passbolt.port.check",(t=>e.emit(t,"SUCCESS"))),await e.connect();const t=new S;new x(t).listen("passbolt.port.connect",k,e);const s=C.storage,o=chrome.runtime.getURL("/"),a=document.createElement("div");document.body.appendChild(a),n.render(r.createElement(b,{port:e,storage:s,browserExtensionUrl:o}),a)}()}},s={};function r(e){var n=s[e];if(void 0!==n)return n.exports;var o=s[e]={exports:{}};return t[e].call(o.exports,o,o.exports,r),o.exports}r.m=t,e=[],r.O=(t,s,n,o)=>{if(!s){var a=1/0;for(l=0;l<e.length;l++){for(var[s,n,o]=e[l],i=!0,c=0;c<s.length;c++)(!1&o||a>=o)&&Object.keys(r.O).every((e=>r.O[e](s[c])))?s.splice(c--,1):(i=!1,o<a&&(a=o));if(i){e.splice(l--,1);var p=n();void 0!==p&&(t=p)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[s,n,o]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.j=524,(()=>{var e={524:0};r.O.j=t=>0===e[t];var t=(t,s)=>{var n,o,[a,i,c]=s,p=0;if(a.some((t=>0!==e[t]))){for(n in i)r.o(i,n)&&(r.m[n]=i[n]);if(c)var l=c(r)}for(t&&t(s);p<a.length;p++)o=a[p],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return r.O(l)},s=self.contentScriptChunkLoadingGlobal=self.contentScriptChunkLoadingGlobal||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var n=r.O(void 0,[96],(()=>r(28)));n=r.O(n)})();