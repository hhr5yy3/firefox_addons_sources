(()=>{var e,t={66243:(e,t,r)=>{"use strict";var n=r(64572),s=r(43528);var a=r(27484),o=r.n(a);const i={debug:10,info:100,warn:1e3,error:1e4};function c(){const e={};for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((t=>{t.forEach((t=>{Object.keys(t).forEach((r=>{e[r]=t[r]}))}))})),e}class l{constructor(e){this.core=e;for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.label=r}log(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),s=2;s<r;s++)n[s-2]=arguments[s];if(i[e]>=i[this.core.level]&&this.core.writer.write(e,t,c(this.label,n)),this.core.debug){"object"==typeof t&&(t=JSON.stringify(t));const r="".concat(o()(new Date).format("YYYY-MM-DD HH:mm:ss")," [").concat(e,"] msg=").concat(t," label=").concat(JSON.stringify(c(this.label,n)));switch(e){case"error":console.error(r);break;case"warn":console.warn(r);break;default:console.info(r)}}p.hook.trigger("log",{level:e,message:t,label:n})}with(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new l(this.core,...this.label,...t)}debug(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.log("debug",e,...r)}info(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.log("info",e,...r)}warn(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.log("warn",e,...r)}error(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.log("error",e,...r)}static E(e){return"string"==typeof e?{error:e}:e instanceof Error?{error:e.message}:"object"==typeof e?e:{}}}class p{static getInstance(){return p.instance}static getLogger(){return p.getInstance().logger(...arguments)}constructor(e){(0,n.Z)(this,"level","info"),(0,n.Z)(this,"debug",!1),this.writer=e.writer,this.level=e.level||this.level,this.debug=e.debug||this.debug,this.labels=e.labels||{},p.instance||(p.instance=this)}logger(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new l(this,this.labels,...t)}}(0,n.Z)(p,"hook",new class{constructor(){(0,n.Z)(this,"hookMap",{})}trigger(e){if(!this.hookMap[e])return;const t=[];for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];n.forEach((e=>{"object"==typeof e?t.push({...e}):t.push(e)})),this.hookMap[e].forEach((e=>{e(...t)}))}addListener(e,t){this.hookMap[e]||(this.hookMap[e]=[]),this.hookMap[e].push(t)}removeListener(e,t){if(!this.hookMap[e])return;const r=this.hookMap[e].indexOf(t);r>-1&&this.hookMap[e].splice(r,1)}});class h{constructor(e,t){(0,n.Z)(this,"disChannelHandlerArray",[]),"function"==typeof e?(this.setHandler(e),this.setCatch(t)):(this.manager=e,this.flag=t,this.setCatch((e=>{p.getInstance().logger(l.E(e)).error("channel error",{flag:this.flag})})),this.setHandler((()=>{p.getInstance().logger().warn("channel handler is null")})))}channel(e,t){this.manager.nativeSend({action:e,data:t,stream:this.flag,channel:!0})}send(e){this.manager.nativeSend({data:e,stream:this.flag,channel:!0})}throw(e){this.manager.nativeSend({stream:this.flag,error:e,channel:!0}),this.manager.disChannel(this)}syncSend(e,t){return this.manager.nativeSend({action:e,data:t,stream:this.flag,channel:!1}),new Promise(((e,t)=>{this.handler=t=>{e(t)},this.catch=e=>{t(e)}}))}setHandler(e){this.handler=function(t){if("dischannel"===t)return this.manager.disChannel(this),void this.disChannelHandlerArray.forEach((e=>{e("dischannel")}));e(t)}}setCatch(e){this.catch=function(t){e(t),this.manager.disChannel(this),this.disChannelHandlerArray.forEach((e=>{e("dischannel")}))}}setDisChannelHandler(e){this.disChannelHandlerArray.push(e)}disChannel(){this.send("dischannel"),this.manager.disChannel(this)}}Symbol("MessageBroadcast");class d{constructor(e){(0,n.Z)(this,"channelMap",new Map),this.nativeSend=e}channel(e){e||(e=(0,s.Z)());const t=new h(this,e);return this.channelMap.set(e,t),t}getChannel(e){return this.channelMap.get(e)}disChannel(e){this.channelMap.delete(e.flag)}free(){this.channelMap.forEach((e=>{e.disChannelHandlerArray.forEach((e=>{e("free")}))})),this.channelMap.clear()}}class u{constructor(){(0,n.Z)(this,"handlerMap",new Map),(0,n.Z)(this,"channelHandlerMap",new Map)}async handler(e,t,r){if(e.channel){let n=t.getChannel(e.stream);if(n)e.error?n.catch(e.error):n.handler(e.data);else{const s=this.channelHandlerMap.get(e.action);s&&(n=t.channel(e.stream),s(n,e.action,e.data,r))}return}if(e.stream){if(e.action){const n=this.handlerMap.get(e.action);if(n){const s=n(e.action,e.data,r);s?s instanceof Promise?s.then((r=>{t.nativeSend({stream:e.stream,data:r})})).catch((r=>{t.nativeSend({error:r.message,stream:e.stream})})):t.nativeSend({stream:e.stream,data:s}):p.getLogger({component:"message"}).warn("handler return is null")}}else{const r=t.getChannel(e.stream);r&&(e.error?r.catch(e.error):r.handler(e.data))}return}const n=this.handlerMap.get(e.action);n&&n(e.action,e.data,r)}setHandler(e,t){this.handlerMap.set(e,t)}setHandlerWithChannel(e,t){this.channelHandlerMap.set(e,t)}}class g{constructor(e){(0,n.Z)(this,"channelMap",new Map),this.manager=e}syncSend(e,t){return this.manager.syncSend(e,t)}send(e,t){return this.manager.send(e,t)}nativeSend(e){return this.manager.nativeSend(e)}channel(e){const t=this.manager.channel(e);return this.channelMap.set(t.flag,t),t.setHandler((()=>{this.channelMap.delete(t.flag)})),t}getChannel(e){return this.manager.getChannel(e)}disChannel(e){return this.manager.disChannel(e)}free(){return this.manager.free()}cleanChannel(){this.channelMap.forEach((e=>{e.disChannel()})),this.channelMap.clear()}sendCallback(e,t,r){this.manager.sendCallback(e,t,r)}getAndDelRelatedTarget(e){return this.manager.getAndDelRelatedTarget(e)}}class y extends u{constructor(e){super(),(0,n.Z)(this,"stream",new Map),this.window=e,this.channelManager=new d((e=>{this.nativeSend(e)})),window.addEventListener("message",(e=>{this.handler(e.data,this.channelManager,{targetTag:"sandbox"})}))}nativeSend(e){this.window.postMessage(e,"*")}getChannel(e){return this.channelManager.getChannel(e)}channel(e){return this.channelManager.channel(e)}disChannel(e){return this.channelManager.disChannel(e)}free(){return this.channelManager.free()}syncSend(e,t){return this.channelManager.channel().syncSend(e,t)}send(e,t){this.nativeSend({action:e,data:t})}}new(r(49520).ZP)("ScriptCat"),new Error("数据保存失败");const f="complete";var m=r(41976);class b{static Options(e){const t=e||{};return{Singleton(){return t.isSingleton=!0,this.Register()},Depend(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.depend=r,this},Nolazy(){return t.nolazy=!0,this},Alias(e){return t.alias=e,this},Register:()=>e=>{const r={...t};var n;(r.object=e,b.objectParams.set(e,r),t.nolazy&&b.instance(e),t.isSingleton)||(null===(n=t.alias)||void 0===n||n.forEach((e=>{b.objectParams.set(e,r)})))}}}static Register(){return b.Options().Depend(...arguments).Register()}static Singleton(){return b.Options().Depend(...arguments).Singleton()}static registerInstance(e,t){if(b.instances.has(e))throw new Error("".concat(e.name," has been registered"));return b.instances.set(e,t),{alias(t){return t?(t instanceof Array?t.forEach((t=>{b.registerInstanceAlias(e,t)})):b.registerInstanceAlias(e,t),this):this}}}static registerInstanceAlias(e,t){if(!b.instances.has(e))throw new Error("".concat(e.name," not registered"));return b.instances.set(t,b.instances.get(e)),b}static instance(e){var t;if(b.instances.has(e))return b.instances.get(e);if(!b.objectParams.has(e))throw new Error("".concat(e.name," not registered"));const r=b.objectParams.get(e),n=[];null===(t=r.depend)||void 0===t||t.forEach((e=>{switch(typeof e){case"function":case"object":case"symbol":n.push(b.instance(e));break;default:n.push(e)}}));const s=new r.object(...n);return r.isSingleton&&b.registerInstance(r.object,s).alias(r.alias),s}}(0,n.Z)(b,"instances",new Map),(0,n.Z)(b,"objectParams",new Map);var M=r(53229);var w=r(38152);var v,_,C,O,G,T,A,P,S,R,j,k,x,I,D,E,L,Z,U,H,B,V,N,F,J,q,W,X,Y,z,K,Q;r(81249),r(81354);function $(e){const t=/\/\*\s*==UserConfig==([\s\S]+?)\s*==\/UserConfig==\s*\*\//m.exec(e);if(!t)return;const r=t[1].trim().split(/[-]{3,}/),n={};return r.forEach((e=>{const t=w.ZP.parse(e);Object.keys(t).forEach((e=>{n[e]=t[e]}))})),n}class ee{static API(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t,r,n)=>{const s=r;if(e.listener&&e.listener(),"GMdotXmlHttpRequest"===s)return void ee.apis.set("GM.xmlHttpRequest",{api:n.value,param:e});ee.apis.set(s,{api:n.value,param:e});const a=s.replace("_",".");if(a!==s){if("GM.xmlhttpRequest"===a)return;ee.apis.set(a,{api:n.value,param:e})}}}}(0,n.Z)(ee,"apis",new Map);let te=(v=ee.API(),_=ee.API(),C=ee.API({depend:["GM_setValue"]}),O=ee.API(),G=ee.API(),T=ee.API(),A=ee.API(),P=ee.API(),S=ee.API(),R=ee.API({depend:["CAT_fetchBlob","CAT_createBlobUrl","CAT_fetchDocument","GM_xmlhttpRequest"]}),j=ee.API({depend:["CAT_fetchBlob","CAT_createBlobUrl","CAT_fetchDocument"]}),k=ee.API(),x=ee.API(),I=ee.API(),D=ee.API(),E=ee.API({depend:["GM_closeInTab"]}),L=ee.API(),Z=ee.API(),U=ee.API(),H=ee.API(),B=ee.API(),V=ee.API(),N=ee.API(),F=ee.API(),J=ee.API(),q=ee.API(),W=ee.API(),X=ee.API(),Y=ee.API(),z=ee.API(),K=ee.API({depend:["CAT_fetchBlob","CAT_createBlobUrl"]}),Q=class{constructor(){(0,n.Z)(this,"valueChangeListener",new Map)}sendMessage(e,t){return this.message.syncSend("gmApi",{api:e,scriptId:this.scriptRes.id,params:t,runFlag:this.runFlag})}connect(e,t,r){const n=(0,s.Z)(),a=this.message.channel(n);return a.setHandler(r),a.channel("gmApiChannel",{api:e,scriptId:this.scriptRes.id,params:t,runFlag:this.runFlag}),a}valueUpdate(e){const{storagename:t}=this.scriptRes.metadata;(e.value.scriptId===this.scriptRes.id||t&&e.value.storageName&&t[0]===e.value.storageName)&&(void 0===e.value.value?delete this.scriptRes.value[e.value.key]:this.scriptRes.value[e.value.key]=e.value,this.valueChangeListener.forEach((t=>{t.name===e.value.key&&t.listener(e.value.key,e.oldValue,e.value.value,e.sender.runFlag!==this.runFlag,e.sender.tabId)})))}static GM_info(e){const t=function(e){const t=e.indexOf("==UserScript=="),r=e.indexOf("==/UserScript==");return-1===t||-1===r?null:"// ".concat(e.substring(t,r+15))}(e.sourceCode),r=function(e){const t=e.indexOf("==UserConfig=="),r=e.indexOf("==/UserConfig==");return-1===t||-1===r?null:"/* ".concat(e.substring(t,r+15)," */")}(e.sourceCode)||"",n={description:e.metadata.description&&e.metadata.description[0]||null,matches:e.metadata.match||[],includes:e.metadata.include||[],"run-at":e.metadata["run-at"]&&e.metadata["run-at"][0]||"document-idle",icon:e.metadata.icon&&e.metadata.icon[0]||null,icon64:e.metadata.icon64&&e.metadata.icon64[0]||null,header:t,grant:e.metadata.grant||[],connects:e.metadata.connect||[]};return{scriptWillUpdate:!0,scriptHandler:"ScriptCat",scriptUpdateURL:e.downloadUrl,scriptMetaStr:t,userConfig:$(r),userConfigStr:r,version:"0.16.6",script:{name:e.name,namespace:e.namespace,version:e.metadata.version&&e.metadata.version[0],author:e.author,...n}}}GM_getValue(e,t){const r=this.scriptRes.value[e];return r?r.value:t}GM_setValue(e,t){"object"==typeof t&&(t=JSON.parse(JSON.stringify(t)));let r=this.scriptRes.value[e];return r?r.value=t:r={id:0,scriptId:this.scriptRes.id,storageName:this.scriptRes.metadata.storagename&&this.scriptRes.metadata.storagename[0]||"",key:e,value:t,createtime:(new Date).getTime(),updatetime:0},void 0===t?delete this.scriptRes.value[e]:this.scriptRes.value[e]=r,this.sendMessage("GM_setValue",[e,t])}GM_deleteValue(e){this.GM_setValue(e,void 0)}GM_listValues(){return Object.keys(this.scriptRes.value)}GM_addValueChangeListener(e,t){const r=1e7*Math.random();return this.valueChangeListener.set(r,{name:e,listener:t}),r}GM_removeValueChangeListener(e){this.valueChangeListener.delete(e)}CAT_fetchBlob(e){return this.message.syncSend("CAT_fetchBlob",e)}CAT_fetchDocument(e){return new Promise((t=>{let r;this.message.sendCallback("CAT_fetchDocument",e,(e=>{r=this.message.getAndDelRelatedTarget(e.relatedTarget),t(r)}))}))}CAT_createBlobUrl(e){return this.message.syncSend("CAT_createBlobUrl",e)}GMdotXmlHttpRequest(e){let t;const r=new Promise(((r,n)=>{const s=e.onload;e.onload=e=>{r(e),s&&s(e)};const a=e.onerror;e.onerror=e=>{n(e),a&&a(e)},t=this.GM_xmlhttpRequest(e)}));return t&&t.abort&&(r.abort=t.abort),r}GM_xmlhttpRequest(e){let t;const r=new URL(e.url,window.location.href);e.headers&&Object.keys(e.headers).forEach((t=>{"cookie"===t.toLowerCase()&&(e.cookie=e.headers[t],delete e.headers[t])}));const n={method:e.method,timeout:e.timeout,url:r.href,headers:e.headers,cookie:e.cookie,context:e.context,responseType:e.responseType,overrideMimeType:e.overrideMimeType,anonymous:e.anonymous,user:e.user,password:e.password,maxRedirects:e.maxRedirects};n.headers||(n.headers={}),e.nocache&&(n.headers["Cache-Control"]="no-cache");return(async()=>{var r;if(e.data)if(e.data instanceof FormData){n.dataType="FormData";const t=[],r={};e.data.forEach(((e,t)=>{r[t]=!0}));const s=Object.keys(r).map((r=>{const n=e.data.getAll(r).map((e=>new Promise((n=>{var s;e instanceof File?(s=e,new Promise((e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(s)}))).then((s=>{t.push({key:r,type:"file",val:s||"",filename:e.name}),n()})):(t.push({key:r,type:"text",val:e}),n())}))));return Promise.all(n)}));await Promise.all(s),n.data=t}else e.data instanceof Blob?(n.dataType="Blob",n.data=await this.CAT_createBlobUrl(e.data)):n.data=e.data;let s,a;const o=null===(r=e.responseType)||void 0===r?void 0:r.toLocaleLowerCase(),i=e=>("stream"===o&&(s=new ReadableStream({start(e){a=e}})),async t=>{if(t.response)if("document"===o)t.response=await this.CAT_fetchDocument(t.response),t.responseXML=t.response,t.responseType="document";else{const e=await this.CAT_fetchBlob(t.response);t.response="arraybuffer"===o?await e.arrayBuffer():e}"stream"===o&&(t.response=s),e(t)});"arraybuffer"!==o&&"blob"!==o&&"document"!==o&&"stream"!==o||(e.onload&&(e.onload=i(e.onload)),e.onreadystatechange&&(e.onreadystatechange=i(e.onreadystatechange)),e.onloadend&&(e.onloadend=i(e.onloadend)),"document"===o&&(n.responseType="blob"),"stream"===o&&e.onloadstart&&(e.onloadstart=i(e.onloadstart))),t=this.connect("GM_xmlhttpRequest",[n],(t=>{var r;const n=t.data||{};switch(t.event){case"onload":e.onload&&e.onload(n);break;case"onloadend":var o;if(e.onloadend&&e.onloadend(n),s)null===(o=a)||void 0===o||o.close();break;case"onloadstart":e.onloadstart&&e.onloadstart(n);break;case"onprogress":e.onprogress&&e.onprogress(n);break;case"onreadystatechange":e.onreadystatechange&&e.onreadystatechange(n);break;case"ontimeout":e.ontimeout&&e.ontimeout();break;case"onerror":e.onerror&&e.onerror("");break;case"onabort":e.onabort&&e.onabort();break;case"onstream":null===(r=a)||void 0===r||r.enqueue(new Uint8Array(t.data));break;default:p.getLogger().warn("GM_xmlhttpRequest resp is error",{resp:t})}})),t.setCatch((t=>{e.onerror&&e.onerror(t)}))})(),{abort:()=>{t&&t.disChannel()}}}async GM_notification(e,t,r,n){let s,a,o,i={};if("string"==typeof e)switch(i.text=e,arguments.length){case 4:i.onclick=n;case 3:i.image=r;case 2:i.title=t}else i=e,i.ondone=i.ondone||t;i.onclick&&(s=i.onclick,delete i.onclick),i.ondone&&(a=i.ondone,delete i.ondone),i.oncreate&&(o=i.oncreate,delete i.oncreate),this.connect("GM_notification",[i],(e=>{switch(e.event){case"click":s&&s.apply({id:e.id},[e.id,e.index]);break;case"done":a&&a.apply({id:e.id},[e.user]);break;case"create":o&&o.apply({id:e.id},[e.id]);break;default:p.getLogger().warn("GM_notification resp is error",{resp:e})}}))}GM_closeNotification(e){this.sendMessage("GM_closeNotification",[e])}GM_updateNotification(e,t){this.sendMessage("GM_updateNotification",[e,t])}GM_log(e,t,r){return"string"!=typeof e&&(e=JSON.stringify(e)),this.sendMessage("GM_log",[e,t,r])}GM_openInTab(e,t){let r,n={};1===arguments.length?n.active=!0:"boolean"==typeof t?n.active=!t:n=t,void 0===n.active&&(n.active=!0);const s={close:()=>{this.GM_closeInTab(r)}},a=this.connect("GM_openInTab",[e,n],(e=>{switch(e.event){case"oncreate":r=e.tabId;break;case"onclose":s.onclose&&s.onclose(),s.closed=!0,a.disChannel()}}));return s}GM_closeInTab(e){return this.sendMessage("GM_closeInTab",[e])}GM_getResourceText(e){if(!this.scriptRes.resource)return;const t=this.scriptRes.resource[e];return t?t.content:void 0}GM_getResourceURL(e,t){if(!this.scriptRes.resource)return;const r=this.scriptRes.resource[e];return r?t?URL.createObjectURL(function(e){const t=e.split(",")[0].split(":")[1].split(";")[0],r=atob(e.split(",")[1]),n=new ArrayBuffer(r.length),s=new Uint8Array(n);for(let e=0;e<r.length;e+=1)s[e]=r.charCodeAt(e);return new Blob([s],{type:t})}(r.base64)):r.base64:void 0}GM_addStyle(e){let t;return this.message.sendCallback("GM_addElement",{param:["style",{textContent:e}]},(e=>{t=this.message.getAndDelRelatedTarget(e.relatedTarget)})),t}async GM_getTab(e){e(await this.sendMessage("GM_getTab",[]))}GM_saveTab(e){return"object"==typeof e&&(e=JSON.parse(JSON.stringify(e))),this.sendMessage("GM_saveTab",[e])}async GM_getTabs(e){e(await this.sendMessage("GM_getTabs",[]))}GM_download(e,t){let r;r="string"==typeof e?{name:t||"",url:e}:e;const n=this.connect("GM_download",[{method:r.method,url:r.url,name:r.name,headers:r.headers,saveAs:r.saveAs,timeout:r.timeout,cookie:r.cookie,anonymous:r.anonymous}],(e=>{const t=e.data||{};switch(e.event){case"onload":r.onload&&r.onload(t);break;case"onprogress":r.onprogress&&r.onprogress(t);break;case"ontimeout":r.ontimeout&&r.ontimeout();break;case"onerror":r.onerror&&r.onerror({error:"unknown"});break;default:p.getLogger().warn("GM_download resp is error",{resp:e})}}));return{abort:()=>{n.disChannel()}}}GM_setClipboard(e,t){return this.sendMessage("GM_setClipboard",[e,t])}GM_cookie(e,t,r){this.sendMessage("GM_cookie",[e,t]).then((e=>{r&&r(e,void 0)})).catch((e=>{r&&r(void 0,e)}))}GM_registerMenuCommand(e,t,r){this.menuMap||(this.menuMap=new Map);let n=0;if(this.menuMap.forEach(((t,r)=>{t===e&&(n=r)})),n)return n;this.menuId?this.menuId+=1:this.menuId=1;const s=this.menuId;return this.connect("GM_registerMenuCommand",[s,e,r],(()=>{t()})),this.menuMap.set(s,e),s}GM_unregisterMenuCommand(e){this.menuMap||(this.menuMap=new Map),this.menuMap.delete(e),this.sendMessage("GM_unregisterMenuCommand",[e])}CAT_userConfig(){return this.sendMessage("CAT_userConfig",[])}GM_addElement(e,t,r){let n;return this.message.sendCallback("GM_addElement",{param:["string"==typeof e?e:t,"string"==typeof e?t:r],relatedTarget:"string"==typeof e?null:e},(e=>{n=this.message.getAndDelRelatedTarget(e.relatedTarget)})),n}async CAT_fileStorage(e,t){if("config"===e)return void this.sendMessage("CAT_fileStorage",["config"]);const r={baseDir:t.baseDir||"",path:t.path||"",filename:t.filename,file:t.file};if("upload"===e){const e=await this.CAT_createBlobUrl(t.data);r.data=e}this.connect("CAT_fileStorage",[e,r],(async r=>{if("download"===e){const e=await this.CAT_fetchBlob(r.data);t.onload&&t.onload(e)}else t.onload&&t.onload(r.data)})).setCatch((e=>{void 0!==e.code?t.onerror&&t.onerror(e):t.onerror&&t.onerror({code:-1,message:e.message})}))}},(0,M.Z)(Q.prototype,"GM_getValue",[v],Object.getOwnPropertyDescriptor(Q.prototype,"GM_getValue"),Q.prototype),(0,M.Z)(Q.prototype,"GM_setValue",[_],Object.getOwnPropertyDescriptor(Q.prototype,"GM_setValue"),Q.prototype),(0,M.Z)(Q.prototype,"GM_deleteValue",[C],Object.getOwnPropertyDescriptor(Q.prototype,"GM_deleteValue"),Q.prototype),(0,M.Z)(Q.prototype,"GM_listValues",[O],Object.getOwnPropertyDescriptor(Q.prototype,"GM_listValues"),Q.prototype),(0,M.Z)(Q.prototype,"GM_addValueChangeListener",[G],Object.getOwnPropertyDescriptor(Q.prototype,"GM_addValueChangeListener"),Q.prototype),(0,M.Z)(Q.prototype,"GM_removeValueChangeListener",[T],Object.getOwnPropertyDescriptor(Q.prototype,"GM_removeValueChangeListener"),Q.prototype),(0,M.Z)(Q.prototype,"CAT_fetchBlob",[A],Object.getOwnPropertyDescriptor(Q.prototype,"CAT_fetchBlob"),Q.prototype),(0,M.Z)(Q.prototype,"CAT_fetchDocument",[P],Object.getOwnPropertyDescriptor(Q.prototype,"CAT_fetchDocument"),Q.prototype),(0,M.Z)(Q.prototype,"CAT_createBlobUrl",[S],Object.getOwnPropertyDescriptor(Q.prototype,"CAT_createBlobUrl"),Q.prototype),(0,M.Z)(Q.prototype,"GMdotXmlHttpRequest",[R],Object.getOwnPropertyDescriptor(Q.prototype,"GMdotXmlHttpRequest"),Q.prototype),(0,M.Z)(Q.prototype,"GM_xmlhttpRequest",[j],Object.getOwnPropertyDescriptor(Q.prototype,"GM_xmlhttpRequest"),Q.prototype),(0,M.Z)(Q.prototype,"GM_notification",[k],Object.getOwnPropertyDescriptor(Q.prototype,"GM_notification"),Q.prototype),(0,M.Z)(Q.prototype,"GM_closeNotification",[x],Object.getOwnPropertyDescriptor(Q.prototype,"GM_closeNotification"),Q.prototype),(0,M.Z)(Q.prototype,"GM_updateNotification",[I],Object.getOwnPropertyDescriptor(Q.prototype,"GM_updateNotification"),Q.prototype),(0,M.Z)(Q.prototype,"GM_log",[D],Object.getOwnPropertyDescriptor(Q.prototype,"GM_log"),Q.prototype),(0,M.Z)(Q.prototype,"GM_openInTab",[E],Object.getOwnPropertyDescriptor(Q.prototype,"GM_openInTab"),Q.prototype),(0,M.Z)(Q.prototype,"GM_closeInTab",[L],Object.getOwnPropertyDescriptor(Q.prototype,"GM_closeInTab"),Q.prototype),(0,M.Z)(Q.prototype,"GM_getResourceText",[Z],Object.getOwnPropertyDescriptor(Q.prototype,"GM_getResourceText"),Q.prototype),(0,M.Z)(Q.prototype,"GM_getResourceURL",[U],Object.getOwnPropertyDescriptor(Q.prototype,"GM_getResourceURL"),Q.prototype),(0,M.Z)(Q.prototype,"GM_addStyle",[H],Object.getOwnPropertyDescriptor(Q.prototype,"GM_addStyle"),Q.prototype),(0,M.Z)(Q.prototype,"GM_getTab",[B],Object.getOwnPropertyDescriptor(Q.prototype,"GM_getTab"),Q.prototype),(0,M.Z)(Q.prototype,"GM_saveTab",[V],Object.getOwnPropertyDescriptor(Q.prototype,"GM_saveTab"),Q.prototype),(0,M.Z)(Q.prototype,"GM_getTabs",[N],Object.getOwnPropertyDescriptor(Q.prototype,"GM_getTabs"),Q.prototype),(0,M.Z)(Q.prototype,"GM_download",[F],Object.getOwnPropertyDescriptor(Q.prototype,"GM_download"),Q.prototype),(0,M.Z)(Q.prototype,"GM_setClipboard",[J],Object.getOwnPropertyDescriptor(Q.prototype,"GM_setClipboard"),Q.prototype),(0,M.Z)(Q.prototype,"GM_cookie",[q],Object.getOwnPropertyDescriptor(Q.prototype,"GM_cookie"),Q.prototype),(0,M.Z)(Q.prototype,"GM_registerMenuCommand",[W],Object.getOwnPropertyDescriptor(Q.prototype,"GM_registerMenuCommand"),Q.prototype),(0,M.Z)(Q.prototype,"GM_unregisterMenuCommand",[X],Object.getOwnPropertyDescriptor(Q.prototype,"GM_unregisterMenuCommand"),Q.prototype),(0,M.Z)(Q.prototype,"CAT_userConfig",[Y],Object.getOwnPropertyDescriptor(Q.prototype,"CAT_userConfig"),Q.prototype),(0,M.Z)(Q.prototype,"GM_addElement",[z],Object.getOwnPropertyDescriptor(Q.prototype,"GM_addElement"),Q.prototype),(0,M.Z)(Q.prototype,"CAT_fileStorage",[K],Object.getOwnPropertyDescriptor(Q.prototype,"CAT_fileStorage"),Q.prototype),Q);function re(e,t){return null!=e&&Object.prototype.hasOwnProperty.call(e,t)}function ne(e,t){if(t.param.depend)for(let r=0;r<t.param.depend.length;r+=1){const n=t.param.depend[r],s=ee.apis.get(n);if(!s)return;if(n.startsWith("GM.")){const[,t]=n.split(".");e.GM[t]=s.api.bind(e)}else e[n]=s.api.bind(e);ne(e,s)}}function se(e,t,r){const n={scriptRes:e,message:r,valueChangeListener:new Map,sendMessage:te.prototype.sendMessage,connect:te.prototype.connect,runFlag:(0,s.Z)(),valueUpdate:te.prototype.valueUpdate,GM:{Info:t},GM_info:t};return e.metadata.grant&&e.metadata.grant.forEach((e=>{const t=ee.apis.get(e);if(t){if(e.startsWith("GM.")){const[,r]=e.split(".");n.GM[r]=t.api.bind(n)}else if("GM_cookie"===e){n[e]=t.api.bind(n);const r=function(t){return(r,s)=>n[e](t,r,s)};n[e].list=r("list"),n[e].delete=r("delete"),n[e].set=r("set")}else n[e]=t.api.bind(n);ne(n,t)}})),n.unsafeWindow=window,n}const ae={addEventListener:r.g.addEventListener.bind(r.g),removeEventListener:r.g.removeEventListener.bind(r.g),dispatchEvent:r.g.dispatchEvent.bind(r.g)},oe=new Map,ie={NodeFilter:!0,RegExp:!0},ce=Object.getOwnPropertyDescriptors(r.g);function le(e,t,r){const n=Object.assign(ae);r||(r={}),r.eval=e.eval,r.define=void 0,function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];e.hasOwnProperty=t=>Object.hasOwnProperty.call(e,t)||r.some((e=>Object.hasOwnProperty.call(e,t))),e.isPrototypeOf=t=>Object.isPrototypeOf.call(e,t)||r.some((e=>Object.isPrototypeOf.call(e,t))),e.propertyIsEnumerable=t=>Object.propertyIsEnumerable.call(e,t)||r.some((e=>Object.propertyIsEnumerable.call(e,t)))}(r,n,e,t);const s={message:1,valueChangeListener:1,connect:1,runFlag:1,valueUpdate:1,sendMessage:1,scriptRes:1},a=new Proxy(t,{defineProperty:(e,t,n)=>!!Object.defineProperty(r,t,n),get(o,i){switch(i){case"window":case"self":case"globalThis":return a;case"top":case"parent":return e[i]===e.self?n.global||a:e.top}if("undefined"!==i){if(re(r,i))return r[i];if("string"==typeof i){if(re(t,i)){if(re(s,i))return;return t[i]}if(re(n,i))return"function"!=typeof n[i]||n[i].prototype?n[i]:n[i].bind(e);if(re(e,i)&&i.startsWith("on"))return"function"!=typeof e[i]||e[i].prototype?e[i]:e[i].bind(e);if(oe.has(i)){const t=e[i];return"function"!=typeof t||t.prototype?t:t.bind(e)}}else if(i===Symbol.unscopables)return ie}},has(a,o){switch(o){case"window":case"self":case"globalThis":return!0;case"top":case"parent":return e[o],e.self,!0}if("undefined"!==o)if("string"==typeof o){if(re(ie,o))return!1;if(re(r,o))return!0;if(re(t,o))return!re(s,o);if(re(n,o))return!0;if(re(e[o],o)&&o.startsWith("on"))return!0}else if("symbol"==typeof o)return re(r,o);return!1},set(t,s,a){switch(s){case"window":case"self":case"globalThis":return!1}if(re(n,s))return n[s]=a,!0;if(oe.has(s)){const t=Object.getOwnPropertyDescriptor(e,s);if(t&&t.get&&!t.set&&t.configurable)return!0;if(re(e,s)&&s.startsWith("on"))return void 0===a?e.removeEventListener(s.slice(2),r[s]):(r[s]&&e.removeEventListener(s.slice(2),r[s]),e.addEventListener(s.slice(2),a)),r[s]=a,!0}return r[s]=a,!0},getOwnPropertyDescriptor(n,s){try{let n=Object.getOwnPropertyDescriptor(r,s);return n||(n=Object.getOwnPropertyDescriptor(t,s),n||(n=Object.getOwnPropertyDescriptor(e,s),n))}catch(e){return}}});return a[Symbol.toStringTag]="Window",a}Object.keys(ce).forEach((e=>{const t=ce[e];t&&t.writable&&!ae[e]?"function"==typeof t.value?t.value.prototype?ae[e]=t.value:ae[e]=t.value.bind(r.g):ae[e]=t.value:oe.set(e,!0)}));class pe{constructor(e,t,n,s){var a;this.scriptRes=e,this.logger=p.getInstance().logger({component:"exec",id:this.scriptRes.id,name:this.scriptRes.name}),this.GM_info=te.GM_info(this.scriptRes),this.proxyMessage=new g(t),this.scriptFunc=n||(a=this.scriptRes.code,new Function("context","GM_info",a)),e.grantMap.none?this.proxyContent=r.g:(this.sandboxContent=se(e,this.GM_info,this.proxyMessage),this.proxyContent=le(r.g,this.sandboxContent,s))}valueUpdate(e){var t;null===(t=this.sandboxContent)||void 0===t||t.valueUpdate(e)}exec(){return this.logger.debug("script start"),this.scriptFunc.apply(this.proxyContent,[this.proxyContent,this.GM_info])}stop(){return this.logger.debug("script stop"),this.proxyMessage.cleanChannel(),!0}}class he{constructor(e,t){this.msg=e,this.time="number"==typeof t?new Date(Date.now()+1e3*t):t}}class de extends pe{constructor(e,t){const n={},s=new Map,a=new Map;n.setTimeout=function(e,t){for(var n=arguments.length,a=new Array(n>2?n-2:0),o=2;o<n;o++)a[o-2]=arguments[o];const i=r.g.setTimeout((function(){s.delete(i),"function"==typeof e&&e()}),t,...a);return s.set(i,!0),i},n.clearTimeout=function(e){s.delete(e),r.g.clearTimeout(e)},n.setInterval=function(e,t){for(var n=arguments.length,s=new Array(n>2?n-2:0),o=2;o<n;o++)s[o-2]=arguments[o];const i=r.g.setInterval((function(){"function"==typeof e&&e()}),t,...s);return a.set(i,!0),i},n.clearInterval=function(e){a.delete(e),r.g.clearInterval(e)},n.CATRetryError=he,super(e,t,void 0,n),this.setTimeout=s,this.setInterval=a}stop(){return this.setTimeout.forEach(((e,t)=>{r.g.clearTimeout(t)})),this.setTimeout.clear(),this.setInterval.forEach(((e,t)=>{r.g.clearInterval(t)})),this.setInterval.clear(),super.stop()}}var ue;let ge=b.Singleton(y)(ue=class{constructor(e){(0,n.Z)(this,"cronJob",new Map),(0,n.Z)(this,"execScripts",new Map),(0,n.Z)(this,"retryList",[]),this.message=e,this.logger=p.getInstance().logger({component:"sandbox"}),setInterval((()=>{if(!this.retryList.length)return;const e=Date.now(),t=[];for(let r=0;r<this.retryList.length;r+=1){const n=this.retryList[r];n.retryTime<e&&(this.retryList.splice(r,1),r-=1,t.push(n.script))}t.forEach((e=>{e.nextruntime=0,this.execScript(e)}))}),5e3)}joinRetryList(e){e.nextruntime&&(this.retryList.push({script:e,retryTime:e.nextruntime}),this.retryList.sort(((e,t)=>e.retryTime-t.retryTime)))}removeRetryList(e){for(let t=0;t<this.retryList.length;t+=1)this.retryList[t].script.id===e&&(this.retryList.splice(t,1),t-=1)}listenEvent(e,t){this.message.setHandler(e,((e,r)=>t.bind(this)(r)))}init(){this.listenEvent("enable",this.enable),this.listenEvent("disable",this.disable),this.listenEvent("start",this.start),this.listenEvent("stop",this.stop),this.message.setHandler("valueUpdate",((e,t)=>{this.execScripts.forEach((e=>{e.valueUpdate(t)}))}))}start(e){return this.execScript(e,!0)}stop(e){const t=this.execScripts.get(e);return t?(this.execStop(t),Promise.resolve(!0)):(this.message.send("scriptRunStatus",[e,f]),Promise.resolve(!1))}enable(e){switch(this.execScripts.has(e.id)&&this.disable(e.id),e.type){case 2:return this.stopCronJob(e.id),this.crontabScript(e);case 3:return this.execScript(e);default:throw new Error("不支持的脚本类型")}}disable(e){return this.stopCronJob(e),this.removeRetryList(e),this.stop(e)}stopCronJob(e){const t=this.cronJob.get(e);t&&(t.forEach((e=>{e.stop()})),this.cronJob.delete(e))}execScript(e,t){const r=this.logger.with({scriptId:e.id,name:e.name});this.execScripts.has(e.id)&&this.stop(e.id);const n=new de(e,this.message);this.execScripts.set(e.id,n),this.message.send("scriptRunStatus",[n.scriptRes.id,"running"]),e.lastruntime=(new Date).getTime();const s=n.exec();return s instanceof Promise?s.then((e=>{this.message.send("scriptRunStatus",[n.scriptRes.id,f]),r.info("exec script complete",{value:e})})).catch((s=>{let a,o=0;throw s instanceof he?(a={error:s.msg},t||(o=s.time.getTime(),e.nextruntime=o,this.joinRetryList(e))):a=l.E(s),r.error("exec script error",a),this.message.send("scriptRunStatus",[n.scriptRes.id,"error",a,o]),s})):r.warn("backscript return not promise"),s}crontabScript(e){if(!e.metadata.crontab)throw new Error("错误的crontab表达式");this.joinRetryList(e);let t=!1;const r=[];return e.metadata.crontab.forEach((n=>{let s=0,a=n;if(-1!==a.indexOf("once")){const e=a.split(" ");e.forEach(((e,t)=>{"once"===e&&(s=t)})),5===e.length&&(s+=1),a=a.replace(/once/g,"*")}try{const t=new m.CronJob(a,this.crontabExec(e,s));t.start(),r.push(t)}catch(r){t=!0,this.logger.error("create cronjob failed",{script:e.id,crontab:n})}})),r.length!==e.metadata.crontab.length?r.forEach((e=>{e.stop()})):this.cronJob.set(e.id,r),Promise.resolve(!t)}crontabExec(e,t){return t?()=>{if(!e.lastruntime)return void this.execScript(e);const r=new Date,n=new Date(e.lastruntime);let s=!1;switch(t){case 1:s=n.getMinutes()!==r.getMinutes();break;case 2:s=n.getHours()!==r.getHours();break;case 3:s=n.getDay()!==r.getDay();break;case 4:s=n.getMonth()!==r.getMonth();break;case 5:s=this.getWeek(n)!==this.getWeek(r)}s&&this.execScript(e)}:()=>{this.execScript(e)}}execStop(e){e.stop(),this.execScripts.delete(e.scriptRes.id),this.message.send("scriptRunStatus",[e.scriptRes.id,f])}getWeek(e){const t=new Date(e),r=new Date(e);r.setMonth(0),r.setDate(1);const n=Math.ceil((t.getTime()-r.getTime())/864e5),s=Math.ceil(n/7);return 0===s?1:s}})||ue;const ye=new y(top);b.registerInstance(y,ye);const fe=new p({debug:!1,writer:new class{constructor(e){this.connect=e}write(e,t,r){this.connect.send("log",{id:0,level:e,message:t,label:r,createtime:(new Date).getTime()})}}(ye),labels:{env:"sandbox"}});b.instance(ge).init();let me=!1;const be=()=>{if(me)return;const e=setTimeout((()=>{be()}),1e3);ye.syncSend("sandboxOnload",{}).then((()=>{clearTimeout(e),me=!0,fe.logger().debug("sandbox start")}))};be()},42480:()=>{}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var a=r[e]={id:e,loaded:!1,exports:{}};return t[e].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.m=t,e=[],n.O=(t,r,s,a)=>{if(!r){var o=1/0;for(p=0;p<e.length;p++){for(var[r,s,a]=e[p],i=!0,c=0;c<r.length;c++)(!1&a||o>=a)&&Object.keys(n.O).every((e=>n.O[e](r[c])))?r.splice(c--,1):(i=!1,a<o&&(o=a));if(i){e.splice(p--,1);var l=s();void 0!==l&&(t=l)}}return t}a=a||0;for(var p=e.length;p>0&&e[p-1][2]>a;p--)e[p]=e[p-1];e[p]=[r,s,a]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.j=451,(()=>{var e={451:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var s,a,[o,i,c]=r,l=0;if(o.some((t=>0!==e[t]))){for(s in i)n.o(i,s)&&(n.m[s]=i[s]);if(c)var p=c(n)}for(t&&t(r);l<o.length;l++)a=o[l],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(p)},r=self.webpackChunkscriptcat=self.webpackChunkscriptcat||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),n.nc=void 0;var s=n.O(void 0,[392,72,92,30],(()=>n(66243)));s=n.O(s)})();