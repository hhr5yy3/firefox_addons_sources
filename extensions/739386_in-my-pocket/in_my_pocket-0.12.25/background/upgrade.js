(()=>{var e={167:(e,t,r)=>{"use strict";r.d(t,{B:()=>o,V:()=>i});var s=r(822),n={};function i(){return(0,s.wD)()?r.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:n}function o(e,t,r){var s=r||i(),n=s.__SENTRY__=s.__SENTRY__||{};return n[e]||(n[e]=t())}},822:(e,t,r)=>{"use strict";function s(){return!("undefined"!=typeof __SENTRY_BROWSER_BUNDLE__&&__SENTRY_BROWSER_BUNDLE__)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)}function n(e,t){return e.require(t)}r.d(t,{fj:()=>n,wD:()=>s}),e=r.hmd(e)},461:(e,t,r)=>{"use strict";r.d(t,{lu:()=>c,zf:()=>l});var s=r(167),n=r(822);e=r.hmd(e);var i={nowSeconds:function(){return Date.now()/1e3}},o=(0,n.wD)()?function(){try{return(0,n.fj)(e,"perf_hooks").performance}catch(e){return}}():function(){var e=(0,s.V)().performance;if(e&&e.now)return{now:function(){return e.now()},timeOrigin:Date.now()-e.now()}}(),a=void 0===o?i:{nowSeconds:function(){return(o.timeOrigin+o.now())/1e3}},c=i.nowSeconds.bind(i),l=a.nowSeconds.bind(a);!function(){var e=(0,s.V)().performance;if(e&&e.now){var t=36e5,r=e.now(),n=Date.now(),i=e.timeOrigin?Math.abs(e.timeOrigin+r-n):t,o=i<t,a=e.timing&&e.timing.navigationStart,c="number"==typeof a?Math.abs(a+r-n):t;(o||c<t)&&(i<=c&&e.timeOrigin)}}()},131:function(e,t){var r,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,r=function(e){"use strict";if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)e.exports=globalThis.browser;else{const t="The message port closed before a response was received.",r=e=>{const r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(r).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class s extends WeakMap{constructor(e,t=void 0){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const n=(t,r)=>(...s)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):r.singleCallbackArg||s.length<=1&&!1!==r.singleCallbackArg?t.resolve(s[0]):t.resolve(s)},i=e=>1==e?"argument":"arguments",o=(e,t,r)=>new Proxy(t,{apply:(t,s,n)=>r.call(s,e,...n)});let a=Function.call.bind(Object.prototype.hasOwnProperty);const c=(e,t={},r={})=>{let s=Object.create(null),l={has:(t,r)=>r in e||r in s,get(l,u,g){if(u in s)return s[u];if(!(u in e))return;let d=e[u];if("function"==typeof d)if("function"==typeof t[u])d=o(e,e[u],t[u]);else if(a(r,u)){let t=((e,t)=>function(r,...s){if(s.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${i(t.minArgs)} for ${e}(), got ${s.length}`);if(s.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${i(t.maxArgs)} for ${e}(), got ${s.length}`);return new Promise(((i,o)=>{if(t.fallbackToNoCallback)try{r[e](...s,n({resolve:i,reject:o},t))}catch(n){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,n),r[e](...s),t.fallbackToNoCallback=!1,t.noCallback=!0,i()}else t.noCallback?(r[e](...s),i()):r[e](...s,n({resolve:i,reject:o},t))}))})(u,r[u]);d=o(e,e[u],t)}else d=d.bind(e);else if("object"==typeof d&&null!==d&&(a(t,u)||a(r,u)))d=c(d,t[u],r[u]);else{if(!a(r,"*"))return Object.defineProperty(s,u,{configurable:!0,enumerable:!0,get:()=>e[u],set(t){e[u]=t}}),d;d=c(d,t[u],r["*"])}return s[u]=d,d},set:(t,r,n,i)=>(r in s?s[r]=n:e[r]=n,!0),defineProperty:(e,t,r)=>Reflect.defineProperty(s,t,r),deleteProperty:(e,t)=>Reflect.deleteProperty(s,t)},u=Object.create(e);return new Proxy(u,l)},l=e=>({addListener(t,r,...s){t.addListener(e.get(r),...s)},hasListener:(t,r)=>t.hasListener(e.get(r)),removeListener(t,r){t.removeListener(e.get(r))}}),u=new s((e=>"function"!=typeof e?e:function(t){const r=c(t,{},{getContent:{minArgs:0,maxArgs:0}});e(r)})),g=new s((e=>"function"!=typeof e?e:function(t,r,s){let n,i,o=!1,a=new Promise((e=>{n=function(t){o=!0,e(t)}}));try{i=e(t,r,n)}catch(e){i=Promise.reject(e)}const c=!0!==i&&((l=i)&&"object"==typeof l&&"function"==typeof l.then);var l;if(!0!==i&&!c&&!o)return!1;return(c?i:a).then((e=>{s(e)}),(e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",s({__mozWebExtensionPolyfillReject__:!0,message:t})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)})),!0})),d=({reject:r,resolve:s},n)=>{e.runtime.lastError?e.runtime.lastError.message===t?s():r(new Error(e.runtime.lastError.message)):n&&n.__mozWebExtensionPolyfillReject__?r(new Error(n.message)):s(n)},m=(e,t,r,...s)=>{if(s.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${i(t.minArgs)} for ${e}(), got ${s.length}`);if(s.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${i(t.maxArgs)} for ${e}(), got ${s.length}`);return new Promise(((e,t)=>{const n=d.bind(null,{resolve:e,reject:t});s.push(n),r.sendMessage(...s)}))},h={devtools:{network:{onRequestFinished:l(u)}},runtime:{onMessage:l(g),onMessageExternal:l(g),sendMessage:m.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:m.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},f={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":f},services:{"*":f},websites:{"*":f}},c(e,h,r)};e.exports=r(chrome)}},void 0===(s=r.apply(t,[e]))||(e.exports=s)}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={id:s,loaded:!1,exports:{}};return e[s].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=r(131),t=r.n(e),s=function(){return s=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},s.apply(this,arguments)};function n(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,n,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)o.push(s.value)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o}function i(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e}var o=r(167);function a(){var e=(0,o.V)(),t=e.crypto||e.msCrypto;if(void 0!==t&&t.getRandomValues){var r=new Uint16Array(8);t.getRandomValues(r),r[3]=4095&r[3]|16384,r[4]=16383&r[4]|32768;var s=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return s(r[0])+s(r[1])+s(r[2])+s(r[3])+s(r[4])+s(r[5])+s(r[6])+s(r[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}var c,l=r(461),u="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,g=(0,o.V)(),d=["debug","info","warn","error","log","assert"];function m(e){var t=(0,o.V)();if(!("console"in t))return e();var r=t.console,s={};d.forEach((function(e){var n=r[e]&&r[e].__sentry_original__;e in t.console&&n&&(s[e]=r[e],r[e]=n)}));try{return e()}finally{Object.keys(s).forEach((function(e){r[e]=s[e]}))}}function h(){var e=!1,t={enable:function(){e=!0},disable:function(){e=!1}};return u?d.forEach((function(r){t[r]=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];e&&m((function(){var e;(e=g.console)[r].apply(e,i(["Sentry Logger ["+r+"]:"],t))}))}})):d.forEach((function(e){t[e]=function(){}})),t}c=u?(0,o.B)("logger",h):h();var f=r(822),p="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,A=Object.prototype.toString;function v(e){return function(e,t){return A.call(e)==="[object "+t+"]"}(e,"Object")}function _(e){return Boolean(e&&e.then&&"function"==typeof e.then)}var x=function(){function e(e){var t=this;this._state=0,this._handlers=[],this._resolve=function(e){t._setResult(1,e)},this._reject=function(e){t._setResult(2,e)},this._setResult=function(e,r){0===t._state&&(_(r)?r.then(t._resolve,t._reject):(t._state=e,t._value=r,t._executeHandlers()))},this._executeHandlers=function(){if(0!==t._state){var e=t._handlers.slice();t._handlers=[],e.forEach((function(e){e[0]||(1===t._state&&e[1](t._value),2===t._state&&e[2](t._value),e[0]=!0)}))}};try{e(this._resolve,this._reject)}catch(e){this._reject(e)}}return e.prototype.then=function(t,r){var s=this;return new e((function(e,n){s._handlers.push([!1,function(r){if(t)try{e(t(r))}catch(e){n(e)}else e(r)},function(t){if(r)try{e(r(t))}catch(e){n(e)}else n(t)}]),s._executeHandlers()}))},e.prototype.catch=function(e){return this.then((function(e){return e}),e)},e.prototype.finally=function(t){var r=this;return new e((function(e,s){var n,i;return r.then((function(e){i=!1,n=e,t&&t()}),(function(e){i=!0,n=e,t&&t()})).then((function(){i?s(n):e(n)}))}))},e}(),y=function(){function e(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={}}return e.clone=function(t){var r=new e;return t&&(r._breadcrumbs=i(t._breadcrumbs),r._tags=s({},t._tags),r._extra=s({},t._extra),r._contexts=s({},t._contexts),r._user=t._user,r._level=t._level,r._span=t._span,r._session=t._session,r._transactionName=t._transactionName,r._fingerprint=t._fingerprint,r._eventProcessors=i(t._eventProcessors),r._requestSession=t._requestSession),r},e.prototype.addScopeListener=function(e){this._scopeListeners.push(e)},e.prototype.addEventProcessor=function(e){return this._eventProcessors.push(e),this},e.prototype.setUser=function(e){return this._user=e||{},this._session&&this._session.update({user:e}),this._notifyScopeListeners(),this},e.prototype.getUser=function(){return this._user},e.prototype.getRequestSession=function(){return this._requestSession},e.prototype.setRequestSession=function(e){return this._requestSession=e,this},e.prototype.setTags=function(e){return this._tags=s(s({},this._tags),e),this._notifyScopeListeners(),this},e.prototype.setTag=function(e,t){var r;return this._tags=s(s({},this._tags),((r={})[e]=t,r)),this._notifyScopeListeners(),this},e.prototype.setExtras=function(e){return this._extra=s(s({},this._extra),e),this._notifyScopeListeners(),this},e.prototype.setExtra=function(e,t){var r;return this._extra=s(s({},this._extra),((r={})[e]=t,r)),this._notifyScopeListeners(),this},e.prototype.setFingerprint=function(e){return this._fingerprint=e,this._notifyScopeListeners(),this},e.prototype.setLevel=function(e){return this._level=e,this._notifyScopeListeners(),this},e.prototype.setTransactionName=function(e){return this._transactionName=e,this._notifyScopeListeners(),this},e.prototype.setTransaction=function(e){return this.setTransactionName(e)},e.prototype.setContext=function(e,t){var r;return null===t?delete this._contexts[e]:this._contexts=s(s({},this._contexts),((r={})[e]=t,r)),this._notifyScopeListeners(),this},e.prototype.setSpan=function(e){return this._span=e,this._notifyScopeListeners(),this},e.prototype.getSpan=function(){return this._span},e.prototype.getTransaction=function(){var e=this.getSpan();return e&&e.transaction},e.prototype.setSession=function(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this},e.prototype.getSession=function(){return this._session},e.prototype.update=function(t){if(!t)return this;if("function"==typeof t){var r=t(this);return r instanceof e?r:this}return t instanceof e?(this._tags=s(s({},this._tags),t._tags),this._extra=s(s({},this._extra),t._extra),this._contexts=s(s({},this._contexts),t._contexts),t._user&&Object.keys(t._user).length&&(this._user=t._user),t._level&&(this._level=t._level),t._fingerprint&&(this._fingerprint=t._fingerprint),t._requestSession&&(this._requestSession=t._requestSession)):v(t)&&(this._tags=s(s({},this._tags),t.tags),this._extra=s(s({},this._extra),t.extra),this._contexts=s(s({},this._contexts),t.contexts),t.user&&(this._user=t.user),t.level&&(this._level=t.level),t.fingerprint&&(this._fingerprint=t.fingerprint),t.requestSession&&(this._requestSession=t.requestSession)),this},e.prototype.clear=function(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this},e.prototype.addBreadcrumb=function(e,t){var r="number"==typeof t?Math.min(t,100):100;if(r<=0)return this;var n=s({timestamp:(0,l.lu)()},e);return this._breadcrumbs=i(this._breadcrumbs,[n]).slice(-r),this._notifyScopeListeners(),this},e.prototype.clearBreadcrumbs=function(){return this._breadcrumbs=[],this._notifyScopeListeners(),this},e.prototype.applyToEvent=function(e,t){if(this._extra&&Object.keys(this._extra).length&&(e.extra=s(s({},this._extra),e.extra)),this._tags&&Object.keys(this._tags).length&&(e.tags=s(s({},this._tags),e.tags)),this._user&&Object.keys(this._user).length&&(e.user=s(s({},this._user),e.user)),this._contexts&&Object.keys(this._contexts).length&&(e.contexts=s(s({},this._contexts),e.contexts)),this._level&&(e.level=this._level),this._transactionName&&(e.transaction=this._transactionName),this._span){e.contexts=s({trace:this._span.getTraceContext()},e.contexts);var r=this._span.transaction&&this._span.transaction.name;r&&(e.tags=s({transaction:r},e.tags))}return this._applyFingerprint(e),e.breadcrumbs=i(e.breadcrumbs||[],this._breadcrumbs),e.breadcrumbs=e.breadcrumbs.length>0?e.breadcrumbs:void 0,e.sdkProcessingMetadata=this._sdkProcessingMetadata,this._notifyEventProcessors(i((0,o.B)("globalEventProcessors",(function(){return[]})),this._eventProcessors),e,t)},e.prototype.setSDKProcessingMetadata=function(e){return this._sdkProcessingMetadata=s(s({},this._sdkProcessingMetadata),e),this},e.prototype._notifyEventProcessors=function(e,t,r,n){var i=this;return void 0===n&&(n=0),new x((function(o,a){var c=e[n];if(null===t||"function"!=typeof c)o(t);else{var l=c(s({},t),r);_(l)?l.then((function(t){return i._notifyEventProcessors(e,t,r,n+1).then(o)})).then(null,a):i._notifyEventProcessors(e,l,r,n+1).then(o).then(null,a)}}))},e.prototype._notifyScopeListeners=function(){var e=this;this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((function(t){t(e)})),this._notifyingListeners=!1)},e.prototype._applyFingerprint=function(e){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],this._fingerprint&&(e.fingerprint=e.fingerprint.concat(this._fingerprint)),e.fingerprint&&!e.fingerprint.length&&delete e.fingerprint},e}();function b(e){var t,r;if(v(e)){var s={};try{for(var n=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(Object.keys(e)),i=n.next();!i.done;i=n.next()){var o=i.value;void 0!==e[o]&&(s[o]=b(e[o]))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return s}return Array.isArray(e)?e.map(b):e}var w=function(){function e(e){this.errors=0,this.sid=a(),this.duration=0,this.status="ok",this.init=!0,this.ignoreDuration=!1;var t=(0,l.zf)();this.timestamp=t,this.started=t,e&&this.update(e)}return e.prototype.update=function(e){if(void 0===e&&(e={}),e.user&&(!this.ipAddress&&e.user.ip_address&&(this.ipAddress=e.user.ip_address),this.did||e.did||(this.did=e.user.id||e.user.email||e.user.username)),this.timestamp=e.timestamp||(0,l.zf)(),e.ignoreDuration&&(this.ignoreDuration=e.ignoreDuration),e.sid&&(this.sid=32===e.sid.length?e.sid:a()),void 0!==e.init&&(this.init=e.init),!this.did&&e.did&&(this.did=""+e.did),"number"==typeof e.started&&(this.started=e.started),this.ignoreDuration)this.duration=void 0;else if("number"==typeof e.duration)this.duration=e.duration;else{var t=this.timestamp-this.started;this.duration=t>=0?t:0}e.release&&(this.release=e.release),e.environment&&(this.environment=e.environment),!this.ipAddress&&e.ipAddress&&(this.ipAddress=e.ipAddress),!this.userAgent&&e.userAgent&&(this.userAgent=e.userAgent),"number"==typeof e.errors&&(this.errors=e.errors),e.status&&(this.status=e.status)},e.prototype.close=function(e){e?this.update({status:e}):"ok"===this.status?this.update({status:"exited"}):this.update()},e.prototype.toJSON=function(){return b({sid:""+this.sid,init:this.init,started:new Date(1e3*this.started).toISOString(),timestamp:new Date(1e3*this.timestamp).toISOString(),status:this.status,errors:this.errors,did:"number"==typeof this.did||"string"==typeof this.did?""+this.did:void 0,duration:this.duration,attrs:{release:this.release,environment:this.environment,ip_address:this.ipAddress,user_agent:this.userAgent}})},e}(),k=4,S=function(){function e(e,t,r){void 0===t&&(t=new y),void 0===r&&(r=k),this._version=r,this._stack=[{}],this.getStackTop().scope=t,e&&this.bindClient(e)}return e.prototype.isOlderThan=function(e){return this._version<e},e.prototype.bindClient=function(e){this.getStackTop().client=e,e&&e.setupIntegrations&&e.setupIntegrations()},e.prototype.pushScope=function(){var e=y.clone(this.getScope());return this.getStack().push({client:this.getClient(),scope:e}),e},e.prototype.popScope=function(){return!(this.getStack().length<=1||!this.getStack().pop())},e.prototype.withScope=function(e){var t=this.pushScope();try{e(t)}finally{this.popScope()}},e.prototype.getClient=function(){return this.getStackTop().client},e.prototype.getScope=function(){return this.getStackTop().scope},e.prototype.getStack=function(){return this._stack},e.prototype.getStackTop=function(){return this._stack[this._stack.length-1]},e.prototype.captureException=function(e,t){var r=this._lastEventId=t&&t.event_id?t.event_id:a(),n=t;if(!t){var i=void 0;try{throw new Error("Sentry syntheticException")}catch(e){i=e}n={originalException:e,syntheticException:i}}return this._invokeClient("captureException",e,s(s({},n),{event_id:r})),r},e.prototype.captureMessage=function(e,t,r){var n=this._lastEventId=r&&r.event_id?r.event_id:a(),i=r;if(!r){var o=void 0;try{throw new Error(e)}catch(e){o=e}i={originalException:e,syntheticException:o}}return this._invokeClient("captureMessage",e,t,s(s({},i),{event_id:n})),n},e.prototype.captureEvent=function(e,t){var r=t&&t.event_id?t.event_id:a();return"transaction"!==e.type&&(this._lastEventId=r),this._invokeClient("captureEvent",e,s(s({},t),{event_id:r})),r},e.prototype.lastEventId=function(){return this._lastEventId},e.prototype.addBreadcrumb=function(e,t){var r=this.getStackTop(),n=r.scope,i=r.client;if(n&&i){var o=i.getOptions&&i.getOptions()||{},a=o.beforeBreadcrumb,c=void 0===a?null:a,u=o.maxBreadcrumbs,g=void 0===u?100:u;if(!(g<=0)){var d=(0,l.lu)(),h=s({timestamp:d},e),f=c?m((function(){return c(h,t)})):h;null!==f&&n.addBreadcrumb(f,g)}}},e.prototype.setUser=function(e){var t=this.getScope();t&&t.setUser(e)},e.prototype.setTags=function(e){var t=this.getScope();t&&t.setTags(e)},e.prototype.setExtras=function(e){var t=this.getScope();t&&t.setExtras(e)},e.prototype.setTag=function(e,t){var r=this.getScope();r&&r.setTag(e,t)},e.prototype.setExtra=function(e,t){var r=this.getScope();r&&r.setExtra(e,t)},e.prototype.setContext=function(e,t){var r=this.getScope();r&&r.setContext(e,t)},e.prototype.configureScope=function(e){var t=this.getStackTop(),r=t.scope,s=t.client;r&&s&&e(r)},e.prototype.run=function(e){var t=E(this);try{e(this)}finally{E(t)}},e.prototype.getIntegration=function(e){var t=this.getClient();if(!t)return null;try{return t.getIntegration(e)}catch(t){return p&&c.warn("Cannot retrieve integration "+e.id+" from the current Hub"),null}},e.prototype.startSpan=function(e){return this._callExtensionMethod("startSpan",e)},e.prototype.startTransaction=function(e,t){return this._callExtensionMethod("startTransaction",e,t)},e.prototype.traceHeaders=function(){return this._callExtensionMethod("traceHeaders")},e.prototype.captureSession=function(e){if(void 0===e&&(e=!1),e)return this.endSession();this._sendSessionUpdate()},e.prototype.endSession=function(){var e=this.getStackTop(),t=e&&e.scope,r=t&&t.getSession();r&&r.close(),this._sendSessionUpdate(),t&&t.setSession()},e.prototype.startSession=function(e){var t=this.getStackTop(),r=t.scope,n=t.client,i=n&&n.getOptions()||{},a=i.release,c=i.environment,l=((0,o.V)().navigator||{}).userAgent,u=new w(s(s(s({release:a,environment:c},r&&{user:r.getUser()}),l&&{userAgent:l}),e));if(r){var g=r.getSession&&r.getSession();g&&"ok"===g.status&&g.update({status:"exited"}),this.endSession(),r.setSession(u)}return u},e.prototype._sendSessionUpdate=function(){var e=this.getStackTop(),t=e.scope,r=e.client;if(t){var s=t.getSession&&t.getSession();s&&r&&r.captureSession&&r.captureSession(s)}},e.prototype._invokeClient=function(e){for(var t,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];var n=this.getStackTop(),o=n.scope,a=n.client;a&&a[e]&&(t=a)[e].apply(t,i(r,[o]))},e.prototype._callExtensionMethod=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var s=T().__SENTRY__;if(s&&s.extensions&&"function"==typeof s.extensions[e])return s.extensions[e].apply(this,t);p&&c.warn("Extension method "+e+" couldn't be found, doing nothing.")},e}();function T(){var e=(0,o.V)();return e.__SENTRY__=e.__SENTRY__||{extensions:{},hub:void 0},e}function E(e){var t=T(),r=P(t);return O(t,e),r}function I(e){return!!(e&&e.__SENTRY__&&e.__SENTRY__.hub)}function P(e){return(0,o.B)("hub",(function(){return new S}),e)}function O(e,t){return!!e&&((e.__SENTRY__=e.__SENTRY__||{}).hub=t,!0)}function $(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var s,n=(I(s=T())&&!P(s).isOlderThan(k)||O(s,new S),(0,f.wD)()?function(e){try{var t=T().__SENTRY__,r=t&&t.extensions&&t.extensions.domain&&t.extensions.domain.active;if(!r)return P(e);if(!I(r)||P(r).isOlderThan(k)){var s=P(e).getStackTop();O(r,new S(s.client,y.clone(s.scope)))}return P(r)}catch(t){return P(e)}}(s):P(s));if(n&&n[e])return n[e].apply(n,i(t));throw new Error("No hub defined or "+e+" was not found on the hub, please open a bug report.")}const C=function(e,t={},r={}){F.init().then((()=>{var s;F.get("bugReport")&&$("captureException",s=e,{captureContext:{extra:t,tags:r},originalException:s,syntheticException:new Error("Sentry syntheticException")})}))},R=function(e,t={},r={}){F.init().then((()=>{F.get("bugReport")&&function(e,t){var r=new Error(e);$("captureMessage",e,"string"==typeof t?t:void 0,s({originalException:e,syntheticException:r},"string"!=typeof t?{captureContext:t}:void 0))}(e,{extra:t,tags:r})}))},j={debounce:(e,t)=>{let r;return function(){const s=this,n=arguments;r&&clearTimeout(r),r=setTimeout((function(){e.apply(s,n),r=null}),t||1e3)}},parseJson:e=>{let t;try{t=JSON.parse(e)}catch(t){C(t,{jsonWasAnEmptyString:""===e,jsonWasUndefined:void 0===e,jsonWasNull:null===e}),L.warn("Invalid JSON: could not parse "+e)}return t},getParent:function(e,t){for(;e&&!e.matches(t);)e=e.parentElement;return e},hasParent:function(e,t){return!!j.getParent(e,t)},matchesOrHasParent:function(e,t){return e.matches(t)||j.hasParent(e,t)},getPossibleUrls:function({id:e,url:t}){return[t,`about:reader?url=${encodeURIComponent(t)}`,`https://app.getpocket.com/read/${t}`,`https://app.getpocket.com/read/${e}`,`https://getpocket.com/read/${e}`,new RegExp(`https://getpocket.com/[a-z]+/read/${e}`,"gi")]},hashCode:function(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t>>>0},domain:function(e){const t=document.createElement("a");return t.setAttribute("href",e),t.hostname},getType:function(e){return null===e?"null":Array.isArray(e)?`Array(${e.length})`:typeof e}},N=j;const M=function(){let e={};const r={debugMode:!1,bugReport:!1,openInNewTab:!0,perPage:"50",showBadge:!0,showPageAction:!0,zoomLevel:"12px",archiveWhenOpened:!1,closeTabWhenAdded:!1,closeTabWhenRead:!1};return{init:function(){return function(){return s=this,n=void 0,o=function*(){const s=yield t().storage.local.get("settings");e=Object.assign(e,r),s&&s.settings&&(e=Object.assign(e,N.parseJson(s.settings)||{}))},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{c(o.next(e))}catch(e){t(e)}}function a(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(r,a)}c((o=o.apply(s,n||[])).next())}));var s,n,i,o}()},get:function(t){return t?e[t]:e},set:function(t,r){return e[t]=r,!0},save:function(){return t().storage.local.set({settings:JSON.stringify(e)}),!0}}}(),F=M,L=function(){const e="IMP | ";function t(){return F.init().then((function(){const e=F.get("debugMode");return!0===e?e:Promise.reject()}))}return{log:function(r){t().then((()=>{console.log(e+r)})).catch((function(){}))},warn:function(r){t().then((()=>{console.warn(e+r)})).catch((function(){}))},error:function(t){console.error(e+t)}}}(),B=function(){const e="⌟⌞⌜⌝";let r,s;function n(e){return e&&Object.keys(e).length>0?Object.keys(e).length.toString():""}function i(){L.log("(stopLoadingSpinner)"),s&&(clearInterval(s),s=null)}return{hide:function(){t().browserAction.setBadgeText({text:""})},updateCount:function(e){return new Promise((r=>{i(),F.init().then((function(){if(!0===F.get("showBadge"))if(t().browserAction.setBadgeBackgroundColor({color:"#333"}),e){const s=n(e);t().browserAction.setBadgeText({text:s.toString()}),r()}else t().storage.local.get("items").then((({items:e})=>{const s=n(N.parseJson(e)||[]);t().browserAction.setBadgeText({text:s.toString()}),r()}));else B.hide(),r()}))}))},startLoadingSpinner:function(){s||(L.log("(startLoadingSpinner) will start the spinner now"),s=setInterval((()=>{r=function(){const t=(e.indexOf(r)+1)%4;return e[t]}(),t().browserAction.setBadgeText({text:r})}),150))},flashSuccess:function(){return new Promise((e=>{setTimeout((()=>{i(),t().browserAction.setBadgeText({text:"✓"}),t().browserAction.setBadgeBackgroundColor({color:"#12bc00"}),setTimeout(B.updateCount,1500),e()}),1e3)}))},flashError:function(){return new Promise((e=>{setTimeout((()=>{i(),t().browserAction.setBadgeText({text:"!"}),t().browserAction.setBadgeBackgroundColor({color:"#ff0039"}),setTimeout(B.updateCount,1500),e()}),1e3)}))}}}(),D=B,U=function(){function e(){return new Promise(((e,t)=>{F.init().then((()=>{const r=F.get("showPageAction");L.log(`page action enabled ? ${r}`),r?e():t()}))}))}return{redraw:function(r,s){e().then((()=>{t().storage.local.get("items").then((({items:e})=>{Z.contains(e,s)?U.drawEnabled(r):U.drawDisabled(r),U.show(r)}))}))},redrawAllTabs:function(){e().then((()=>{t().tabs.query({}).then((function(e){for(const t of e)t.url&&U.redraw(t.id,t.url)}))}))},drawEnabled:function(...r){e().then((()=>{r.forEach((e=>{t().pageAction.setIcon({tabId:e,path:{19:"assets/icons/page-action-enabled.svg",38:"assets/icons/page-action-enabled.svg"}}),t().pageAction.setTitle({tabId:e,title:"Mark as read"})}))}))},drawDisabled:function(...r){e().then((()=>{r.forEach((e=>{t().pageAction.setIcon({tabId:e,path:{19:"assets/icons/page-action-disabled.svg",38:"assets/icons/page-action-disabled.svg"}}),t().pageAction.setTitle({tabId:e,title:"Add to pocket"})}))}))},show:function(r){e().then((()=>{t().pageAction.show(r)}))},hideAllTabs:function(){t().tabs.query({}).then((e=>{for(const r of e)r.id&&t().pageAction.hide(r.id)}))},toggle:function(r){e().then((()=>{t().storage.local.get("items").then((({items:e})=>{const s=Z.findByUrl(e,r.url);s?t().tabs.query({active:!0,currentWindow:!0}).then((([e])=>{Z.markAsRead(s.id,e.id)})):Z.addItem([{url:r.url,title:r.title,tabId:r.id}])}))}))}}}(),q=U,W="58817-addc87503598b7ed29e5bf72",J="already_in_list",V=["http","https","ftp","ftps"],Y=class{constructor(e,t,r){this.action=e,this.url=t,this.params=r,this.defaultHeaders={"Content-type":"application/json; charset=UTF-8","X-Accept":"application/json"}}hasErrorHeaders(e){return!!e.headers.get("X-Error")||!!e.headers.get("X-Error-Code")}buildErrorObject(e){const t={url:this.url,httpCode:e.status,xErrorHeader:e.headers.get("X-Error"),xErrorCodeHeader:e.headers.get("X-Error-Code")};switch(e.status){case 200:L.log("200: request was succesful but contains errors");break;case 401:L.error("401: unauthorized"),t.error="unauthorized";break;case 403:{const r=e.headers.get("X-Limit-User-Remaining");if(r&&0===r){const r=e.headers.get("X-Limit-User-Reset");L.error(`403: access_denied (rate limit), reset in ${r} seconds`),t.error="user_rate_limit_reached",t.resetDelay=r}else L.error("403: access_denied (missing permissions)"),t.error="missing_permissions";break}case 404:L.error("404: trying to reach a non-existing URL"),t.error="not_found";break;case 504:L.error("504: timeout"),t.error="timeout";break;default:L.error(`${e.status} http error`),t.error="unknown"}return t}handleSuccesfulResponse(e){const t=e.json();return L.log(`(Request.fetch) Response OK, received data : ${JSON.stringify(t)}`),t}handleFailedResponse(e,t){const r=this.buildErrorObject(e);return L.error(`${t}: ${JSON.stringify(r)}`),R(t,null,r),browser.runtime.sendMessage(r),r}fetch(){return new Promise(((e,t)=>{fetch(this.url,{method:this.action,headers:this.defaultHeaders,body:JSON.stringify(this.params)}).then((r=>{if(L.log(`(Request.fetch) response for ${this.url} - ${r.status}`),r.ok)if(this.hasErrorHeaders(r)){const e=this.handleFailedResponse(r,"(Request.fetch) HTTP response OK but with error headers");t(e)}else{const t=this.handleSuccesfulResponse(r);e(t)}else{const e=this.handleFailedResponse(r,"(Request.fetch) HTTP response not OK");t(e)}})).catch((e=>{C(new Error("(Request.fetch): promise rejected"),e),L.error("(Request.fetch) error while reaching the server or processing the response");const r={error:"generic"};browser.runtime.sendMessage(r),t(r)}))}))}},H=class{constructor(e){this.accessToken=e}add(e){L.log("(PocketApiRequester.add)");const t={consumer_key:W,access_token:this.accessToken,url:e.url,title:e.title};return new Y("POST","https://getpocket.com/v3/add",t).fetch()}addBatch(e){L.log("(PocketApiRequester.addBatch)");const t={consumer_key:W,access_token:this.accessToken,actions:e.map((e=>({action:"add",url:e.url,title:e.title})))};return new Y("POST","https://getpocket.com/v3/send",t).fetch()}archive(e){L.log("(PocketApiRequester.archive)");const t={consumer_key:W,access_token:this.accessToken,actions:[{action:"archive",item_id:e}]};return new Y("POST","https://getpocket.com/v3/send",t).fetch()}delete(e){L.log("(PocketApiRequester.delete)");const t={consumer_key:W,access_token:this.accessToken,actions:[{action:"delete",item_id:e}]};return new Y("POST","https://getpocket.com/v3/send",t).fetch()}favorite(e){L.log("(PocketApiRequester.favorite)");const t={consumer_key:W,access_token:this.accessToken,actions:[{action:"favorite",item_id:e}]};return new Y("POST","https://getpocket.com/v3/send",t).fetch()}unfavorite(e){L.log("(PocketApiRequester.unfavorite)");const t={consumer_key:W,access_token:this.accessToken,actions:[{action:"unfavorite",item_id:e}]};return new Y("POST","https://getpocket.com/v3/send",t).fetch()}update(e,{title:t,tags:r=[],previousTags:s=[],url:n,created_at:i}){L.log(`(PocketApiRequester.update) ${e} - ${t} - ${r} - ${n}`);const o=[{action:"add",item_id:e,title:t,url:n,time:i}],a=r.filter((e=>!s.includes(e))),c=s.filter((e=>!r.includes(e)));a.length>0&&o.push({action:"tags_add",item_id:e,tags:a}),c.length>0&&o.push({action:"tags_remove",item_id:e,tags:c});const l={consumer_key:W,access_token:this.accessToken,actions:o};return new Y("POST","https://getpocket.com/v3/send",l).fetch()}};var z,X,G;!function(e){e[e.closeWhenAdded=0]="closeWhenAdded",e[e.closeWhenRead=1]="closeWhenRead"}(z||(z={})),function(e){e[e.archive=0]="archive",e[e.delete=1]="delete"}(X||(X={})),function(e){e.toggle="toggle-page-status",e.openPopup="_execute_browser_action",e.openFirstItem="open-first-item",e.openRandomItem="open-random-item"}(G||(G={}));const K=function(){let e=null,r=null;function s(t){const s=t?N.hashCode(t):0;return L.log(`(Items.parseItems) checksum: "${e}"; new: "${s}"`),s!=e&&(L.log("(Items.parsedItems) checksum changed, parse the items"),e=s,r=N.parseJson(t)),r||[]}function n(e,r,s){L.log("(Items.removeItem) id to remove: "+e),D.startLoadingSpinner(),t().storage.local.get(["access_token","items"]).then((({access_token:n,items:i})=>{const a=new H(n);(r==X.archive?a.archive(e):a.delete(e)).then((n=>{const a=N.parseJson(i)||[],c=a.findIndex((t=>t.id===e)),l=a[c];if(c>=0){L.log(`(Items.removeItem) item ${e} has been found and removed`),a.splice(c,1),t().storage.local.set({items:JSON.stringify(a)});const n=r==X.archive?"marked-as-read":"deleted";t().runtime.sendMessage({action:n,id:e}).catch((e=>L.warn(`'action: ${n}' message could not be delivered: ${e}`))),D.flashSuccess().then((()=>{s&&t().tabs.get(s).then((e=>{const t=N.getPossibleUrls(l).filter((e=>"string"==typeof e));e.url&&t.includes(e.url)&&o(e.id,z.closeWhenRead)})),L.log("(Items.removeItem) item removed, update matching pageActions");const e=N.getPossibleUrls(l).filter((e=>"string"==typeof e));t().tabs.query({url:e}).then((e=>{const t=e.map((e=>e.id));q.drawDisabled(...t)}))}))}else L.warn(`(Items.removeItem) item ${e} could not be found!`),D.updateCount()})).catch((e=>{C(e),L.error(`(Items.removeItem) Error while removing item: ${e}`),D.flashError()}))}))}function i(e,r){L.log(`(Items.setFavorite) action='${r}'`),t().storage.local.get(["access_token","items"]).then((({access_token:s,items:n})=>{D.startLoadingSpinner();const i=new H(s);("favorite"===r?i.favorite(e):i.unfavorite(e)).then((s=>{const i=N.parseJson(n)||[];i.find((t=>t.id==e)).fav="favorite"===r?"1":"0",t().storage.local.set({items:JSON.stringify(i)});const o=`${r}d`;t().runtime.sendMessage({action:o,id:e}).catch((e=>L.warn(`'action: ${o}' message could not be delivered: ${e}`))),D.flashSuccess()})).catch((e=>{C(e),L.error(`(Items.setFavorite) Error for action ${r} : ${e}`),D.flashError()}))}))}function o(e,r){F.init().then((()=>{let s;switch(r){case z.closeWhenAdded:s=F.get("closeTabWhenAdded");break;case z.closeWhenRead:s=F.get("closeTabWhenRead");break;default:return void C(new Error(`closeTabsIfNeeded called with unknown event ${r}`))}s&&setTimeout((()=>{t().tabs.remove(e).then((()=>{L.log(`(Items.closeTabsIfNeeded) succesfully closed the tabs ${e}`)})).catch((t=>{L.warn(`(Items.closeTabsIfNeeded) could not close all the tabs ${e}`),L.warn(`(Items.closeTabsIfNeeded) Error: ${t}`),C(t)}))}),100)}))}return{formatFetchedPocketItemForStorage:function(e){return{id:e.item_id,title:e.given_title||e.resolved_title,url:e.given_url||e.resolved_url,fav:e.favorite,created_at:e.time_added,updated_at:e.time_updated,tags:Object.keys(e.tags||{})}},formatPocketItemForDebug:function(e){return{id:e.item_id,status:e.status,favorite:e.favorite,timeAdded:e.time_added,timeUpdated:e.time_updated,hasGivenTitle:!!e.given_title,hasResolvedTitle:!!e.resolved_title,hasGivenUrl:!!e.given_url,hasResolvedUrl:!!e.resolved_url,hasTags:Object.keys(e.tags||{}).length>0}},filter:function(e,t,r){return L.log(`(Items.filter) query=${t}, currentUrl=${r}`),s(e).filter((e=>{let s=!0;return r&&(s=s&&!K.matches(e,r)),t&&(s=s&&function(e,t){const r=t.toLowerCase(),s=r.includes("is:faved"),n=r.includes("is:unfaved"),i=r.includes("is:tagged"),o=r.includes("is:untagged"),a=r.replace(/is:(faved|unfaved|tagged|untagged)/g,"").trim();return function(e,t,r){return t?"1"===e.fav:!r||"0"===e.fav||!e.fav}(e,s,n)&&function(e,t,r){return t?e.tags&&e.tags.length>0:!r||!e.tags||0===e.tags.length}(e,i,o)&&function(e,t){if(""===t)return!0;const r=V.join("|"),s=new RegExp(`^(${r})://(www.)?`,"gi"),n=(e.url.replace(s,"")||"").toLowerCase(),i=(e.title||"").toLowerCase(),o=e.tags?e.tags.map((e=>e.toLowerCase())):[];return i.includes(t)||n.includes(t)||o.some((e=>e.includes(t)))}(e,a)}(e,t)),s}))},contains:function(e,t){return s(e).some((e=>K.matches(e,t)))},findByUrl:function(e,t){return s(e||"").find((e=>K.matches(e,t)))},findById:function(e,t){return s(e||"").find((e=>e.id===t))},paginate:function(e,t,r){const s=e.length,n=e.sort(((e,t)=>t.created_at-e.created_at));if(!r||0===s)return n;const i=Math.ceil(s/r);if(!(t<=0||t>i)){const e=(t-1)*r,s=t*r-1;return n.slice(e,s+1)}L.warn(`Could not get page ${t} (${s} items, asked ${r} per page)`)},favoriteItem:function(e){i(e,"favorite")},unfavoriteItem:function(e){i(e,"unfavorite")},updateItem:function(e,r){L.log(`(Items.updateItem) Item '${e}'`),t().storage.local.get(["access_token","items"]).then((({access_token:s,items:n})=>{D.startLoadingSpinner(),new H(s).update(e,r).then((s=>{const i=N.parseJson(n)||[],o=i.find((t=>t.id==e));o.title=r.title,o.tags=r.tags,t().storage.local.set({items:JSON.stringify(i)}),t().runtime.sendMessage({action:"updated",id:e}).catch((e=>L.warn(`'action: updated' message could not be delivered: ${e}`))),D.flashSuccess()})).catch((e=>{C(e),L.error(`(Items.updateItem) Error for update : ${e}`),D.flashError()}))}))},addItem:function(e){L.log(`(Items.addItem) Trying to add ${e.length} items to Pocket`),t().storage.local.get(["access_token","items"]).then((({access_token:r,items:s})=>{const n=e.filter((e=>!K.contains(s,e.url)));if(0===n.length)return void t().runtime.sendMessage({notice:J}).catch((e=>L.warn(`'notice: ${J}' message could not be delivered: ${e}`)));D.startLoadingSpinner();const i=new H(r);(1===n.length?i.add(n[0]):i.addBatch(n)).then((e=>{const r=N.parseJson(s)||[],i=(a=e,1===n.length?a.item?[a.item]:[a]:a.action_results);var a;const c=function(e,t){return e.map((e=>{if(!e.title){const r=t.find((t=>e.given_url==t.url));e.title=r&&r.title||"—"}return e}))}(i,n);!function(e,t,r){if(e!=r.length){const s=Object.keys(t).map((e=>{const r=t[e];return`${e}: ${N.getType(r)}`})),n={action:1===e?"add":"addBatch",itemsToAdd:e,addedItems:r.length,nonNullAddedItems:r.filter(Boolean).length,responseStatus:t.status,responseKeys:s};C(new Error("addItem: 200 response but unexpected number of items"),n)}}(n.length,e,i),c.forEach((e=>{var t;r.push({id:(t=e).item_id,title:t.title,url:t.given_url,tags:[],fav:"0",created_at:Date.now()/1e3|0,updated_at:Date.now()/1e3|0})})),t().storage.local.set({items:JSON.stringify(r)});const l=i.map((e=>e.item_id));t().runtime.sendMessage({action:"added-item",id:l}).catch((e=>L.warn(`'action: added-item, id: ${l}' message could not be delivered: ${e}`))),D.flashSuccess().then((()=>{o(n.map((e=>e.tabId)).filter(Boolean),z.closeWhenAdded),L.log("(Items.addItem) new items added, update matching pageActions");const e=c.flatMap((e=>N.getPossibleUrls({id:e.id,url:e.given_url}).filter((e=>"string"==typeof e))));t().tabs.query({url:e}).then((e=>{const t=e.map((e=>e.id));q.drawEnabled(...t)}))}))})).catch((e=>{C(e),L.error(`(Items.addItem) Error while adding item: ${e}`),D.flashError()}))}))},markAsRead:function(e,t){n(e,X.archive,t)},deleteItem:function(e,t){n(e,X.delete,t)},openItem:(e,...r)=>{return s=this,n=[e,...r],o=function*(e,r=!1,s){yield F.init();const n=F.get("openInNewTab")||r,i=F.get("archiveWhenOpened"),o={url:e.url};if(n)t().tabs.create(o);else{const e=s&&(yield s());e?t().tabs.update(e.id,o):t().tabs.update(o)}i&&K.markAsRead(e.id)},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{c(o.next(e))}catch(e){t(e)}}function a(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(r,a)}c((o=o.apply(s,n||[])).next())}));var s,n,i,o},openRandom:function(e=""){const r=t().tabs.query({active:!0,currentWindow:!0}).then((([e])=>e));t().storage.local.get("items").then((({items:t})=>{const s=K.filter(t,e);if(s.length>0){const e=s[Math.floor(Math.random()*s.length)];K.openItem(e,void 0,(()=>r))}}))},openFirst:function(e=""){t().storage.local.get("items").then((({items:t})=>{const r=K.filter(t,e);if(r.length>0){const e=r.sort(((e,t)=>t.created_at-e.created_at))[0];K.openItem(e)}}))},areSame:function(e,t){const r=e.title===t.title,s=(e.tags||[]).sort(),n=(t.tags||[]).sort(),i=JSON.stringify(s)===JSON.stringify(n);return r&&i},matches:function(e,t){return N.getPossibleUrls(e).some((e=>"string"==typeof e?e===t:e instanceof RegExp?e.test(t):(R("possibleUrl is neither a string nor a regexp",{typeofUrl:typeof e,urlWasAnArray:Array.isArray(e),urlWasAnObject:"object"==typeof e&&!Array.isArray(e),urlWasUndefined:void 0===e,urlWasNull:null===e}),!1)))}}}(),Z=K,Q=function(){function e(t,r,s=2,n=0){const i=(t=t||Q.getCurrentVersion()).split(".")[n],o=r.split(".")[n];return i>o||!(i<o)&&n<s&&n<2&&e(t,r,s,n+1)}return{getCurrentVersion:function(){return browser.runtime.getManifest().version},forceResyncVersion:function(){return"0.12.0"},isMajorOrMinorUpdate:function(t,r){return e(t,r,1)},mustShowUpdateNotification:function(e){if("update"!==e.reason)return!1;const t=Q.getCurrentVersion();return Q.isMajorOrMinorUpdate(t,e.previousVersion)},mustTriggerFullResync:function(t){return!!t&&!!Q.forceResyncVersion()&&e(Q.forceResyncVersion(),t)}}}(),ee=function(){function e(e){return"object"==typeof e&&!Array.isArray(e)&&(!!e.hasOwnProperty("list")&&!("object"!=typeof e.list||Array.isArray(e)))}function t(e,t){const r="object"==typeof e&&!Array.isArray(e),s=Object.keys(e).map((t=>{const r=e[t];return`${t}: ${"error"===t?r:N.getType(r)}`})),n={fetchSource:t,responseStatus:e.status,isResponseAnObject:r,responseKeys:s};L.error(`${t}: unexpected response format :: ${JSON.stringify(n)}`),R(`${t}: unexpected response format`,n)}return{retrieveItems:function(e){const t=Date.now()/1e3|0;browser.storage.local.get(["items","last_retrieve"]).then((({items:r,last_retrieve:s})=>{const n=t-s;L.log(`(ItemsFetcher.retrieveItems) timeout: ${n} / 900`),!e&&r&&s?n>900?ee.retrieveDiff():(browser.runtime.sendMessage({action:"retrieved-items"}).catch((e=>L.warn(`'action: retrieved-items' message could not be delivered: ${e}`))),D.updateCount()):ee.retrieveAll()}))},retrieveAll:function(r=0){L.log(`(ItemsFetcher.retrieveAll) Retrieve all items, offset=${r}`);const s=0===r;browser.storage.local.get(["access_token","items"]).then((({access_token:n,items:i})=>{const o=i&&!s?N.parseJson(i):[];new Y("POST","https://getpocket.com/v3/get",{consumer_key:W,access_token:n,offset:r,count:200,detailType:"complete",state:"unread",sort:"oldest"}).fetch().then((s=>{e(s)?L.log("(ItemsFetch.retrieveAll) Response format is valid"):t(s,"retrieveAll");const n=s.list||{},i=Object.values(n).map((e=>Z.formatFetchedPocketItemForStorage(e))),a=Object.values(n).filter((e=>"1"==e.status)),c=Object.values(n).filter((e=>"2"==e.status));if(a.length>0||c.length>0){const e=4;R("retrieveAll: received deleted or archived items",{totalItemsCount:i.length,archivedItemsCount:a.length,archivedItems:a.slice(0,e).map((e=>Z.formatPocketItemForDebug(e))),deletedItemsCount:c.length,deletedItems:c.slice(0,e).map((e=>Z.formatPocketItemForDebug(e)))})}const l=i.length;if(l>0){L.log(`(ItemsFetcher.retrieveAll) ${l} items in the response`);const e=[...o,...i];browser.storage.local.set({items:JSON.stringify(e)}).then((()=>{D.updateCount(e),ee.retrieveAll(l+r)}))}else L.log("(ItemsFetcher.retrieveAll) No item in this page, all pages fetched succesfully"),browser.storage.local.set({last_retrieve:s.since,lastFullSyncAtVersion:Q.getCurrentVersion()}),browser.runtime.sendMessage({action:"retrieved-items",full:!0}).catch((e=>L.warn(`'action: retrieved-items' message could not be delivered: ${e}`))),q.redrawAllTabs()})).catch((e=>{C(e),L.error(`(ItemsFetcher.retrieveAll) Error: ${e}`),D.flashError()}))}))},retrieveDiff:function(){L.log("(ItemsFetcher.retrieveDiff)"),browser.storage.local.get(["access_token","last_retrieve","items"]).then((({access_token:r,last_retrieve:s,items:n})=>{new Y("POST","https://getpocket.com/v3/get",{consumer_key:W,access_token:r,detailType:"complete",state:"all",since:s}).fetch().then((function(r){e(r)?L.log("(ItemsFetch.retrieveDiff) Response format is valid"):t(r,"retrieveDiff"),L.log(Object.keys(r.list).length+" items in the response");const i=N.parseJson(n)||[],o=[];for(const e in r.list){const t=r.list[e],s=i.findIndex((t=>t.id===e));switch(t.status){case"1":case"2":L.log(`(ItemsFetcher.retriveDiff) NEED TO ARCHIVE: ${e} (${t.title})`),s>=0?(L.log("(ItemsFetcher.retrieveDiff) Item found,  will be removed from the stored items"),i.splice(s,1)):L.warn("(ItemsFetcher.retrieveDiff) Could not find the item to archive in the stored items");break;case"0":s>=0?(L.log(`(ItemsFetcher.retriveDiff) Existing item ${e} (${t.title}) will be updated`),i[s]=Object.assign(i[s],Z.formatFetchedPocketItemForStorage(t))):(L.log(`(ItemsFetcher.retriveDiff) Add new item: ${e} (${t.title})`),i.push(Z.formatFetchedPocketItemForStorage(t)));break;default:L.log(`(ItemsFetcher.retriveDiff) Unknown item status: ${t.status}`),o.push(t)}}if(o.length>0){const e=4;C(new Error("retrieveDiff: items with unknown status"),{totalItemsCount:i.length,since:s,itemsWithUnknownStatusCount:o.length,itemsWithUnknownStatus:o.slice(0,e).map((e=>Z.formatPocketItemForDebug(e)))})}browser.storage.local.set({items:JSON.stringify(i)}),D.updateCount(i),browser.storage.local.set({last_retrieve:r.since}),browser.runtime.sendMessage({action:"retrieved-items"}).catch((e=>L.warn(`'action: retrieved-items' message could not be delivered: ${e}`))),q.redrawAllTabs()})).catch((e=>{C(e),L.warn(`(ItemsFetcher.retrieveDiff) something went wrong: ${e}`),browser.runtime.sendMessage({action:"retrieved-items"}).catch((e=>L.warn(`'action: retrieved-items' message could not be delivered: ${e}`))),q.redrawAllTabs(),D.flashError()}))}))}}}(),te=ee,re="0001",se="0002";browser.runtime.onInstalled.addListener((e=>{"install"===e.reason?(L.log("Fresh install! Welcome on board :)"),browser.notifications.create(re,{type:"basic",title:"Yay, welcome to In My Pocket 🎉",message:"Click this message to learn more about the addon!"})):Q.mustShowUpdateNotification(e)&&(L.log(`IMP has been upgraded from ${e.previousVersion} !`),browser.notifications.create(se,{type:"basic",title:"Yay, In My Pocket has been upgraded 🎉",message:"Click this message to learn what's new!"}),browser.storage.local.get(["access_token","lastFullSyncAtVersion"]).then((({access_token:e,lastFullSyncAtVersion:t})=>{e&&Q.mustTriggerFullResync(t)&&(L.log("IMP version needs a resync"),te.retrieveItems(!0))})))})),browser.notifications.onClicked.addListener((e=>{switch(e){case re:browser.notifications.clear(e),browser.tabs.create({url:"https://inmypocketaddon.com/faq.html?utm_source=addon&utm_medium=notification&utm_campaign=install"});break;case se:browser.notifications.clear(e),browser.tabs.create({url:"https://inmypocketaddon.com/changelog.html?utm_source=addon&utm_medium=notification&utm_campaign=upgrade"})}}))})()})();
//# sourceMappingURL=upgrade.js.map