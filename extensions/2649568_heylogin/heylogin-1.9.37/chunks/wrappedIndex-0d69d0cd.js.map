{"version":3,"file":"wrappedIndex-0d69d0cd.js","sources":["../../../src/entrypoints/options/Options.tsx","../../../src/entrypoints/options/wrappedIndex.tsx"],"sourcesContent":["import { Trans } from '@lingui/macro';\nimport classNames from 'classnames';\nimport React, { useEffect, useState } from 'react';\nimport browser from 'webextension-polyfill';\n\nimport { trackError } from 'backend-client-web';\nimport { globalStyles, useDebugVisibleContext, useUIMode } from 'client-web-sdk';\nimport { jsonParseThaw } from 'persistable-types';\n\nimport { HEYLOGIN_VERSION } from 'src/constants';\nimport { sendMessage } from 'src/message';\nimport { getFrontendServerUrl } from 'src/serverUrl';\nimport debugMode from 'src/util/debugMode';\nimport useErrorHandlingCallback from 'src/util/react/useErrorHandlingCallback';\n\nexport default function Options() {\n  const debugVisible = useDebugVisibleContext();\n  const settingsLink = `${getFrontendServerUrl()}/settings`;\n\n  const handleForceSyncClick = useErrorHandlingCallback(async () => {\n    await Promise.all([\n      sendMessage({ type: 'RequestSync' }),\n      sendMessage({ type: 'ForceOverrideUpdate' }),\n    ]);\n  }, []);\n\n  const handleForceRefreshClientCoreParameters = useErrorHandlingCallback(async () => {\n    await sendMessage({ type: 'RequestForceRefreshClientCoreParameters' });\n  }, []);\n\n  const overridesUpdateTime = useOverrideUpdateTime();\n  const uiMode = useUIMode();\n\n  return (\n    // Q: Why is there className=\"browser-style\" everywhere?\n    // A: https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_styles\n    // Q: When can we remove this?\n    // A: https://bugzilla.mozilla.org/show_bug.cgi?id=1465256\n    <div\n      // NOTE: the classes seem not to be applied properly to the document element in firefox,\n      // so we apply them here\n      className={classNames(\n        globalStyles.defaultStyle,\n        uiMode === 'dark' ? globalStyles.darkMode : globalStyles.lightMode,\n      )}\n      style={{ minHeight: '15rem' }}\n    >\n      <p>\n        <Trans>Version:</Trans>{' '}\n        {HEYLOGIN_VERSION ?? (\n          <em>\n            <Trans>unknown</Trans>\n          </em>\n        )}\n      </p>\n      <p>\n        <Trans>Override version:</Trans>{' '}\n        {overridesUpdateTime?.toISOString() ?? (\n          <em>\n            <Trans>unknown</Trans>\n          </em>\n        )}\n      </p>\n      <p>\n        <a href={settingsLink} target=\"_blank\" rel=\"noreferrer\">\n          <button type=\"button\" className=\"browser-style\">\n            <Trans>Open settings</Trans>\n          </button>\n        </a>\n        <button type=\"button\" onClick={handleForceSyncClick} className=\"browser-style\">\n          <Trans>Force sync (to fix syncing problems)</Trans>\n        </button>\n      </p>\n      {debugVisible && (\n        <p style={{ border: '5px solid #f0f' }}>\n          Debug mode enabled!{' '}\n          <button type=\"button\" onClick={() => (debugMode.debug = false)} className=\"browser-style\">\n            Disable\n          </button>{' '}\n          <button\n            type=\"button\"\n            onClick={handleForceRefreshClientCoreParameters}\n            className=\"browser-style\"\n          >\n            Force refresh ClientCoreParameters\n          </button>\n        </p>\n      )}\n    </div>\n  );\n}\n\nfunction useOverrideUpdateTime() {\n  const [overridesUpdateTime, setOverridesUpdateTime] = useState<Date>();\n  useEffect(() => {\n    async function getOverrideUpdateTime() {\n      const storageValues = await browser.storage.local.get(['overridesUpdateTime']);\n      try {\n        const newTime = jsonParseThaw(storageValues.overridesUpdateTime);\n        if (newTime === undefined || newTime instanceof Date) {\n          setOverridesUpdateTime(newTime);\n        }\n      } catch (e) {\n        setOverridesUpdateTime(undefined);\n      }\n    }\n\n    function handleStorageChanged(changes: { [key: string]: browser.Storage.StorageChange }) {\n      if (changes.overridesUpdateTime === undefined) {\n        return;\n      }\n      getOverrideUpdateTime().catch(trackError);\n    }\n\n    getOverrideUpdateTime().catch(trackError);\n    browser.storage.local.onChanged.addListener(handleStorageChanged);\n\n    return () => {\n      browser.storage.local.onChanged.removeListener(handleStorageChanged);\n    };\n  }, []);\n  return overridesUpdateTime;\n}\n","import 'client-web-sdk/index.css';\nimport { i18n } from '@lingui/core';\nimport { I18nProvider } from '@lingui/react';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport { UIModeContextProvider } from 'client-web-sdk';\n\nimport initSentry from 'src/initSentry';\nimport initUiLocale from 'src/locales/initUiLocale';\nimport { ExtDebugVisibleContextProvider } from 'src/util/react/ExtDebugVisibleContext';\n\nimport Options from './Options';\n\ninitSentry({ entryPoint: 'options' });\n\ninitUiLocale();\n\nReactDOM.render(\n  <I18nProvider i18n={i18n}>\n    <React.StrictMode>\n      <ExtDebugVisibleContextProvider>\n        <UIModeContextProvider>\n          <Options />\n        </UIModeContextProvider>\n      </ExtDebugVisibleContextProvider>\n    </React.StrictMode>\n  </I18nProvider>,\n  document.getElementById('root'),\n);\n"],"names":["Options","debugVisible","useDebugVisibleContext","settingsLink","getFrontendServerUrl","handleForceSyncClick","useErrorHandlingCallback","Promise","all","sendMessage","type","handleForceRefreshClientCoreParameters","overridesUpdateTime","useOverrideUpdateTime","uiMode","useUIMode","classNames","globalStyles","defaultStyle","darkMode","lightMode","minHeight","HEYLOGIN_VERSION","toISOString","border","debugMode","debug","setOverridesUpdateTime","useState","useEffect","getOverrideUpdateTime","storageValues","browser","storage","local","get","newTime","jsonParseThaw","undefined","Date","e","handleStorageChanged","changes","catch","trackError","onChanged","addListener","removeListener","initSentry","entryPoint","initUiLocale","ReactDOM","render","UIModeContextProvider","document","getElementById"],"mappings":"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"}