var icpbravoaccess_ie=null,icpBravoAccessExt=function(){function n(n,t){return{statusMessage:"Não foi possível localizar o parâmetro : ["+n+"] na chamada ao método : "+t}}function nt(t){return t.thumbprint?t.onSuccess?void 0:n("onSuccess","certificate"):n("thumbprint","certificate")}function tt(t){return t.thumbprint?t.onSuccess?void 0:n("onSuccess","certificate"):n("thumbprint","certificate")}function it(t){if(!t.onSuccess)return n("onSuccess","certificates")}function rt(t){return t.thumbprint?t.toSign?t.onSuccess?void 0:n("onSuccess","sign"):n("toSign","sign"):n("thumbprint","sign")}function ut(t){return t.toDecrypt?t.thumbprint?void 0:n("thumbprint","decrypt"):n("toDecrypt","decrypt")}function ft(t){return t.toEncrypt?t.thumbprint?void 0:n("thumbprint","encrypt"):n("toEncrypt","encrypt")}function et(t){if(!t.thumbprint)return n("thumbprint","remove")}function ot(t){return t.onNotInstalled?t.onSuccess?void 0:n("onSuccess","connect"):n("onNotInstalled","connect")}function u(n){s&&console.log(n)}var s=!1,h="0.8",l="0.7",f={Default:0,IE:1,Chrome:2,Firefox:3},t={BROWSER_NOT_SUPPORTED:0,EXTENSION_NOT_INSTALLED:1,NATIVE_NOT_INSTALLED:2,NATIVE_OUTDATED:3,JS_OUTDATED:4,INSTALLED:5},r=new function(){function v(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function y(n,t,i){return{command:t,requestId:i,license:icpBravoAccessExt.license,domain:window.location.hostname,content:JSON.stringify(n),browser:w()}}function w(){return a.browser.indexOf("Chrome")>=0?f.Chrome:a.browser.indexOf("Firefox")>=0?f.Firefox:a.browser.indexOf("Microsoft Internet Explorer")>=0?f.IE:void 0}var r={Error:0,Success:1},a=function(){var l="-",a=navigator.appVersion,n=navigator.userAgent,r=navigator.appName,t=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10),v,i,e,y,s,f,h,p,c,u;(i=n.indexOf("Opera"))!=-1&&(r="Opera",t=n.substring(i+6),(i=n.indexOf("Version"))!=-1&&(t=n.substring(i+8)));(i=n.indexOf("OPR"))!=-1?(r="Opera",t=n.substring(i+4)):(i=n.indexOf("Edge"))!=-1?(r="Microsoft Edge",t=n.substring(i+5)):(i=n.indexOf("MSIE"))!=-1?(r="Microsoft Internet Explorer",t=n.substring(i+5)):(i=n.indexOf("Chrome"))!=-1?(r="Chrome",t=n.substring(i+7)):(i=n.indexOf("Safari"))!=-1?(r="Safari",t=n.substring(i+7),(i=n.indexOf("Version"))!=-1&&(t=n.substring(i+8))):(i=n.indexOf("Firefox"))!=-1?(r="Firefox",t=n.substring(i+8)):n.indexOf("Trident/")!=-1?(r="Microsoft Internet Explorer",t=n.substring(n.indexOf("rv:")+3)):(v=n.lastIndexOf(" ")+1)<(i=n.lastIndexOf("/"))&&(r=n.substring(v,i),t=n.substring(i+1),r.toLowerCase()==r.toUpperCase()&&(r=navigator.appName));(e=t.indexOf(";"))!=-1&&(t=t.substring(0,e));(e=t.indexOf(" "))!=-1&&(t=t.substring(0,e));(e=t.indexOf(")"))!=-1&&(t=t.substring(0,e));o=parseInt(""+t,10);isNaN(o)&&(t=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10));y=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(a);s=navigator.cookieEnabled?!0:!1;typeof navigator.cookieEnabled!="undefined"||s||(document.cookie="testcookie",s=document.cookie.indexOf("testcookie")!=-1?!0:!1);f=l;h=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(p in h)if(c=h[p],c.r.test(n)){f=c.s;break}u=l;/Windows/.test(f)&&(u=/Windows (.*)/.exec(f)[1],f="Windows");switch(f){case"Mac OS X":u=/Mac OS X (10[\.\_\d]+)/.exec(n)[1];break;case"Android":u=/Android ([\.\_\d]+)/.exec(n)[1];break;case"iOS":u=/OS (\d+)_(\d+)_?(\d+)?/.exec(a);u=u[1]+"."+u[2]+"."+(u[3]|0)}return{browser:r,browserVersion:t,browserMajorVersion:o,mobile:y,os:f,osVersion:u,cookies:s}}(),o,n,s,p,e;if(a.mobile){var n={},e=function(n){response={instalationStatus:t.INSTALLED};n._dispatchSuccess(response)},s=function(t,i,r){var f=v(),o={callback:t,requestTime:new Date},e;n[f]=o;e=y(i,r,f);u("Command: "+r+" uuid: "+f);dispatchEvent(JSON.stringify(e))};function c(t){var i=t,f=n[i.requestId],e;f&&(delete n[i.requestId],u("Response uuid: "+i.requestId),i.statusCode===r.Error?f.callback._dispatchError(i):i.statusCode===r.Success&&(e=JSON.parse(i.content),f.callback.onReceiveReponse&&(e=f.callback.onReceiveReponse(e)),f.callback._dispatchSuccess(e)))}}else switch(w()){case f.Chrome:case f.Firefox:var n={},b="com.scytl.icpbravoaccess.request",k="com.scytl.icpbravoaccess.response",s=function(t,i,r){var f=v(),s={callback:t,requestTime:new Date},e,o;n[f]=s;e=y(i,r,f);u("Command: "+r+" uuid: "+f);o=new CustomEvent(b,{detail:e});document.dispatchEvent(o)};function d(n,r){var u=_callbackRegister({onSuccess:function(i){i.instalationStatus===t.NATIVE_OUTDATED?(n._dispatchSuccess(i),o(n,r)):n._dispatchSuccess(i)},onError:function(i){i.instalationStatus===t.NATIVE_NOT_INSTALLED?(n._dispatchSuccess(i),o(n,r)):i.notInstalled?(i.instalationStatus=t.NATIVE_NOT_INSTALLED,n._dispatchSuccess(i),o(n,r)):n._dispatchSuccess(i)}});s(u,r,i.check)}o=function(n,r){var u=_callbackRegister({onSuccess:function(i){i.instalationStatus===t.NATIVE_OUTDATED?setTimeout(function(){o(n,r)},1e3):n._dispatchSuccess(i)},onError:function(){setTimeout(function(){o(n,r)},1e3)}});s(u,r,i.check)};e=function(n,i){var r,f;if(u("Remaining tries: "+i),r=document.getElementById("icpbravoaccess_loaded"),r===null){i>1?setTimeout(function(){e(n,i-1)},200):n._dispatchSuccess({instalationStatus:t.EXTENSION_NOT_INSTALLED});return}f={jsClientVersion:h};d(n,f)};document.addEventListener(k,function(t){var i=t.detail,f=n[i.requestId],e;f&&(delete n[i.requestId],u("Response uuid: "+i.requestId),i.statusCode===r.Error?f.callback._dispatchError(i):i.statusCode===r.Success&&(e=JSON.parse(i.content),f.callback.onReceiveReponse&&(e=f.callback.onReceiveReponse(e)),f.callback._dispatchSuccess(e)))});break;case f.IE:n={};e=function(n,i){if(u("Remaining tries: "+i),typeof icpbravoaccess_ie=="undefined"||icpbravoaccess_ie===null){i>1?setTimeout(function(){e(n,i-1)},200):n._dispatchSuccess({instalationStatus:t.EXTENSION_NOT_INSTALLED});return}var r={jsClientVersion:h,ieMinSupportedVersion:l};g(n,r)};function g(n,t){var r=_callbackRegister({onSuccess:function(t){n._dispatchSuccess(t)},onError:function(t){n._dispatchSuccess(t)}});s(r,t,i.check)}s=function(t,i,r){var f=v(),h=y(i,r,f),e,o,s;u("Command: "+r+" uuid: "+f);e=JSON.stringify(h);o=icpbravoaccess_ie.request(e);o&&(s={callback:t,requestTime:new Date},n[f]=s)};p=function(){var s,o,f,e;if(typeof icpbravoaccess_ie!="undefined"&&icpbravoaccess_ie!==null)for(s=icpbravoaccess_ie.GetPool(),o=JSON.parse(s),f=0;f<o.length;f++){var h=o[f],t=JSON.parse(h),i=n[t.requestId];i&&(delete n[t.requestId],u("Response uuid: "+t.requestId),t.statusCode===r.Error?i.callback._dispatchError(t):t.statusCode===r.Success&&(e=JSON.parse(t.content),i.callback.onReceiveReponse&&(e=i.callback.onReceiveReponse(e)),icpbravoaccess_ie.RemovePool(t.requestId),i.callback._dispatchSuccess(e)))}setTimeout(function(){p()},300)};p();break;default:e=function(n){n._dispatchSuccess({instalationStatus:t.BROWSER_NOT_SUPPORTED})}}this.requestCommand=s;this.checkExtension=e;this.callbackApp=c},o;this.callbackHandle=function(n){this.onSuccess=new function(){};this.onError=new function(){};this.onReceiveReponse=null;this.angularScope=n;this._dispatchSuccess=function(n){this._safeApply(this.onSuccess,n)};this._dispatchError=function(n){this._safeApply(this.onError,n)};this._safeApply=function(n,t){if(icpBravoAccessExt.angularScope){var i=this.angularScope.$root.$$phase;i=="$apply"||i=="$digest"?n&&typeof n=="function"&&n(t):this.angularScope.$apply(n(t))}else n(t)}};this._callbackRegister=function(n){var t=new callbackHandle(icpBravoAccessExt.angularScope);return n.onSuccess&&(t.onSuccess=n.onSuccess),n.onError&&(t.onError=n.onError),n.onReceiveReponse&&(t.onReceiveReponse=n.onReceiveReponse),t};var i={certificates:"certificates",certificate:"certificate",remove:"remove",sign:"sign",tryExport:"tryExport",check:"check",decrypt:"decrypt",encrypt:"encrypt"},a=function(n,i,r,u){switch(u.instalationStatus){case t.BROWSER_NOT_SUPPORTED:u.statusMessage="O navegador não tem suporte para esta extensão.";u.info="Navegador não suportado";i(u);break;case t.EXTENSION_NOT_INSTALLED:u.statusMessage="A Extensão não está instalada. Instale para continuar.";u.info="Extensão não Instalada";i(u);break;case t.NATIVE_NOT_INSTALLED:u.statusMessage="A aplicação nativa não está instalada. Faça o download da aplicação e instale para continuar.";u.info="Aplicação não Instalada";u.downloadRequired=!0;i(u);break;case t.NATIVE_OUTDATED:u.statusMessage="A aplicação nativa está desatualiziada. Faça o download da versão mais atual e instale para continuar.";u.info="Atualização Disponível";u.downloadRequired=!0;i(u);break;case t.JS_OUTDATED:u.statusMessage="O JavaScript Client está desatualizado. Entre em contato com o administrador do site.";u.info="Erro";u.downloadRequired=!1;i(u);break;case t.INSTALLED:n();break;default:u.info="Erro";u.downloadRequired=!1;r(u)}},e=function(n,t){for(var r=[],i=0;n.length>i;i++)t(n[i])&&r.push(n[i]);return r},v=function(n,t){if(!n)return t;if(n.cpf){var i=n.cpf.replace(/\./g,"").replace(/-/g,"").split("|");t.certificates=e(t.certificates,function(n){for(cpfIndex in i)if(n.cpf==i[cpfIndex])return!0;return!1})}return n.type&&(n.type=n.type.toLowerCase(),n.type.search("icpbrasil")>=0?t.certificates=e(t.certificates,function(n){return n.certType===o.ICPBrasil}):n.type.search("unknown")>=0&&(t.certificates=e(t.certificates,function(n){return n.certType===o.Unknown}))),n.valid&&(t.certificates=e(t.certificates,function(n){return n.isValid})),t};this.certificates=function(n){var t=it(n),u;if(t){n.onError(t);return}u=_callbackRegister({onSuccess:n.onSuccess,onError:n.onError,onReceiveReponse:function(t){return v(n.filter,t)}});r.requestCommand(u,null,i.certificates)};var y=function(n){var t=tt(n),u,f;if(t){n.onError(t);return}u=_callbackRegister({onSuccess:n.onSuccess,onError:n.onError});f={thumbprint:n.thumbprint};r.requestCommand(u,f,i.certificate)},p=function(n){var t=nt(n),u,f;if(t){n.onError(t);return}u=_callbackRegister({onSuccess:n.onSuccess,onError:n.onError});f={thumbprint:n.thumbprint};r.requestCommand(u,f,i.tryExport)},w=function(n){var t=rt(n),u,f;if(t){n.onError(t);return}u=_callbackRegister({onSuccess:n.onSuccess,onError:n.onError});f={thumbprint:n.thumbprint,toSign:n.toSign,signatureAlgorithm:n.signatureAlgorithm};r.requestCommand(u,f,i.sign)},c=function(n){r.callbackApp(n)},b=function(n){var t=ft(n),u,f;if(t){n.onError(t);return}u=_callbackRegister({onSuccess:n.onSuccess,onError:n.onError});f={thumbprint:n.thumbprint,toEncrypt:n.toEncrypt,oaep:n.oaep};r.requestCommand(u,f,i.encrypt)},k=function(n){var t=ut(n),u,f;if(t){n.onError(t);return}u=_callbackRegister({onSuccess:n.onSuccess,onError:n.onError});f={thumbprint:n.thumbprint,toDecrypt:n.toDecrypt,oaep:n.oaep};r.requestCommand(u,f,i.decrypt)},d=function(n){var t=et(n),u,f;if(t){n.onError(t);return}u=_callbackRegister({onSuccess:n.onSuccess,onError:n.onError});f={thumbprint:n.thumbprint};r.requestCommand(u,f,i.remove)},g=function(n){var t=ot(n),i;if(t){n.onError(t);return}n.license&&(icpBravoAccessExt.license=n.license);n.angular&&(icpBravoAccessExt.angularScope=n.angular);i=_callbackRegister({onSuccess:function(t){a(n.onSuccess,n.onNotInstalled,n.onError,t)},onError:function(t){n.onError(t)}});r.checkExtension(i,25)};return o={Unknown:0,ICPBrasil:1},{connect:g,getCertificateList:certificates,getCertificate:y,sign:w,remove:d,encrypt:b,decrypt:k,tryExport:p,callbackApp:c,enableLog:s}}();