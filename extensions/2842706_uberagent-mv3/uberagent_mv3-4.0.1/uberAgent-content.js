console.debug("uberAgent content script loaded");function i(n,e){let o=!1;console.debug("Start processing performance entries..."),n.getEntries().forEach(t=>{if(t.entryType!=="navigation"){console.error("Entry type is not navigation");return}a(t),o=!0,e&&e.disconnect()}),o===!1&&(console.error("No performance entries found"),e&&e.disconnect(),chrome.runtime.sendMessage({status:"error"}))}function a(n){const e=n;if(console.debug(`Processing performance entry for <${n.name}>`),e.loadEventEnd==0){console.warn("No timing information available");return}const o=e.redirectStart==0?e.fetchStart:e.redirectStart,t=e.responseEnd-o;if(t<0){console.warn(`Page load network time is invalid: ${t}ms`);return}const r={status:"success",pageLoadTotalMs:e.duration,pageLoadNetworkMs:e.responseEnd-o,pageLoadRenderMs:e.loadEventEnd-e.responseEnd};console.debug("Send page load metrics to background script: Page load time: "+r.pageLoadTotalMs+"ms, Network time: "+r.pageLoadNetworkMs+"ms, Render time: "+r.pageLoadRenderMs+"ms"),chrome.runtime.sendMessage(r)}function s(){new PerformanceObserver(i).observe({entryTypes:["navigation"]})}window.addEventListener("load",()=>{console.debug("Page load event received, sending page load metrics"),s()});if(document.readyState==="complete"){console.debug("Document is already loaded, sending page load metrics");const n=performance.getEntriesByType("navigation");n.length>0?a(n[0]):(console.debug("No existing performance entries available, starting observation"),s())}
