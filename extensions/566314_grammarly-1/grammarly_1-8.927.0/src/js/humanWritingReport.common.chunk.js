(self.webpackChunk=self.webpackChunk||[]).push([[5739],{70632:(e,t,n)=>{var r=n(98544),a="chrome-extension://__MSG_@@extension_id__/",o="moz-extension://__MSG_@@extension_id__/",i="safari-web-extension://__MSG_@@extension_id__/",s=self.GR_RESOURCE_ROOT||a,c=self.GR_RESOURCE_ROOT||o,l=self.GR_RESOURCE_ROOT||i;e.exports={__css:r.toString().replace(new RegExp(a,"g"),s).replace(new RegExp(o,"g"),c).replace(new RegExp(i,"g"),l),...r.locals}},8396:(e,t,n)=>{n.r(t),n.d(t,{EditsTrackingControllerImpl:()=>An});var r=n(90023),a=n(82823),o=n(36072),i=n(65647),s=n(78488),c=n(55446),l=n(60841),d=n(73863),u=n(8748),h=n(58303),m=n(63843),p=n(25770),g=n(52341),f=n(72257),k=n(36334),b=n(4603),_=n(69686),v=n(33874),y=n(34967),w=n(48822),C=n(64965),S=n(70163),x=n(70989),E=n(74857),I=n(97697),T=n(20715),A=n(83780),B=n(14765),L=n(78008),D=n(37636),M=n(18615),R=n(99836),N=n(70932);const P="document_state",G="document_state_enc";class F extends Error{constructor(e,t){super(e),this._reason=t}get reason(){return this._reason}}class U extends F{}class O extends F{}class H extends F{}class W extends F{}class j extends F{}class Z extends W{}function z(e,t=W){return e instanceof F?e:new t(e.message,e)}var V,$,K,Y;!function(e){let t;!function(e){e.create=function(e){return{timestamp:e.timestamp,delta:e.delta,copyContentId:e.sourceContentId,isSelfAuthored:e.isSelfAuthored}},e.parse=function(e){try{const t=e;return t.timestamp&&!isNaN(t.timestamp)&&t.delta?{timestamp:Number(t.timestamp),delta:t.delta,sourceContentId:t.copyContentId?String(t.copyContentId):void 0,isSelfAuthored:t.isSelfAuthored}:null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),e.is=function(e){return null!==e}}(V||(V={})),function(e){let t,n;!function(e){e.create=function(e){return{timestamp:e.timestamp,text:e.char,copiedContentId:void 0!==e.sourceContentId&&null!==e.sourceContentId&&""!==e.sourceContentId?e.sourceContentId:void 0,isSelfAuthored:e.isSelfAuthored}},e.parse=function(e){try{const t=e;return void 0!==t.text&&t.text.length&&t.timestamp&&void 0!==t.isSelfAuthored?{char:String(t.text),timestamp:Number(t.timestamp),sourceContentId:t.copiedContentId?String(t.copiedContentId):void 0,isSelfAuthored:Boolean(t.isSelfAuthored)}:null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),function(e){e.create=function(e){return{character:e.char,timestamp:e.timestamp,sourceContentId:e.sourceContentId,isSelfAuthored:e.isSelfAuthored}}}(n=e.Backend||(e.Backend={})),e.is=function(e){return null!==e}}($||($={})),function(e){let t;e.create=function(e,t,n,r,a){let o=[],i=[],s=[];return r&&((0,m.kG)(n.length==r.length,`Expected that the text length ${n.length} be the same as the Char[] length ${r.length}`),o=r.map((e=>e.timestamp)),i=r.map((e=>e.isSelfAuthored)),s=r.map((e=>e.sourceContentId||null))),{id:crypto.randomUUID(),url:e,sourceName:t,text:n,timestamps:o,isSelfAuthoredTags:i,originalSourceContentIds:s,prompt:a}},function(e){e.create=function(e){return{id:e.id,url:e.url,sourceName:e.sourceName,text:e.text,timestamps:e.timestamps,isSelfAuthoredTags:e.isSelfAuthoredTags,originalCopiedContentIds:e.originalSourceContentIds,prompt:e.prompt||null}},e.parse=function(e){try{const t=e;if(t.id&&t.url&&t.sourceName&&t.text&&Array.isArray(t.timestamps)&&Array.isArray(t.isSelfAuthoredTags)&&Array.isArray(t.originalCopiedContentIds)){const e=t.timestamps.filter((e=>!isNaN(e))),n=t.isSelfAuthoredTags.map(Boolean),r=t.originalCopiedContentIds.filter((e=>null===e||"string"==typeof e));return e.length===n.length&&n.length===r.length?{id:t.id,url:t.url,sourceName:t.sourceName,text:t.text,timestamps:e,isSelfAuthoredTags:n,originalSourceContentIds:r,prompt:t.prompt||void 0}:null}return null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),e.is=function(e){return null!==e}}(K||(K={})),function(e){let t,n;e.empty=function(e){return{id:e,chars:[],sourcedContentStore:{kind:"internal",data:[]},deltaEdits:[]}},function(e){e.create=function(e){return{id:e.id,chararray:e.chars.map($.Legacy.create),copyStore:{storeType:e.sourcedContentStore.kind,data:e.sourcedContentStore.data.map(K.Legacy.create)},deltas:e.deltaEdits.map(V.Legacy.create)}},e.parse=function(e){try{const t=e;if(t.id&&Array.isArray(t.chararray)&&t.copyStore&&t.copyStore.storeType&&Array.isArray(t.copyStore.data)&&Array.isArray(t.deltas)){const e=t.chararray.map($.Legacy.parse).filter($.is),n=t.copyStore.data.map(K.Legacy.parse).filter(K.is),r=t.deltas.map(V.Legacy.parse).filter(V.is);return e.length!==t.chararray.length||n.length!==t.copyStore.data.length||r.length!==t.deltas.length?null:{id:t.id,chars:e,sourcedContentStore:{kind:t.copyStore.storeType,data:n},deltaEdits:r}}return null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),function(e){e.create=function(e,t,n){return{documentId:e.id,chars:e.chars.map($.Backend.create),sourcedContentStore:{kind:e.sourcedContentStore.kind,data:e.sourcedContentStore.data},deltaEdits:e.deltaEdits,title:n}}}(n=e.Backend||(e.Backend={}))}(Y||(Y={}));const q="AES-GCM",Q={name:q},J={length:256,...Q};function X(e){return{iv:e,...Q}}function ee(){if(!self.crypto)throw new W("Crypto API is not supported in this browser")}async function te(e){ee();const t=await self.crypto.subtle.exportKey("raw",e);return new Uint8Array(t)}var ne=n(33219);class re{static ofRequest(e){return new Promise(((t,n)=>{e.onsuccess=n=>t(e.result),e.onerror=t=>n(e.error)}))}static ofTransaction(e){return new Promise(((t,n)=>{e.oncomplete=e=>t(),e.onerror=t=>n(e.error)}))}}function ae(e){return t=>`${e}-${t}`}function oe(e){return function(e){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=e[n].toString(16).padStart(2,"0");return t.join("")}((0,ne.Bk)((new TextEncoder).encode(e)))}class ie{serialize(e){return Promise.resolve(Y.Legacy.create(e))}deserialize(e){const t=Y.Legacy.parse(e);return t?Promise.resolve(t):Promise.reject(new O("Document could not be parsed"))}}class se{constructor(e,t){this.keychain=t,this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder,this.uniqId=ae(e)}async serialize(e){try{const t=await this.keychain.getOrProvisionKey(e.id),n=JSON.stringify(e),r=this.textEncoder.encode(n),a=await async function(e,t){ee();const n=self.crypto.getRandomValues(new Uint8Array(12));return{iv:n,encrypted:await self.crypto.subtle.encrypt(X(n),t,e)}}(r,t);return{id:this.uniqId(e.id),documentId:e.id,data:a}}catch(e){throw z(e,W)}}async deserialize(e){const{documentId:t,data:n}=e,r=await this.keychain.getKey(t);if(!r)throw new O("Key not found for document");try{const e=await function(e,t){ee();const{iv:n,encrypted:r}=e;return self.crypto.subtle.decrypt(X(n),t,r)}(n,r);return JSON.parse(this.textDecoder.decode(e))}catch(e){throw z(e,O)}}}class ce{constructor(e,t,n,r,a,o){this.userId=e,this.documentId=t,this.keychain=n,this._onReadSuccess=r,this._onReadError=a,this._onWriteResult=o,this._initialized=p.h.create(!1),this._encryptionSerializer=new se(this.userId,this.keychain),this._legacySerializer=new ie,this._log=N.Y.create("HWRStorage"),this.uniqId=ae(e)}async reload(){if(this._log.info("reload"),this._db=await this.openDb(),!this._db)return this._log.error("Cannot open db"),void this.onReadError(new Z);try{const e=await this.fetchFromEncrypted(this._db);if(e)return void this._onReadSuccess(e);const t=await this.fetchFromLegacy(this._db);t?(await this.migrateToEncrypted(this._db,t),this._onReadSuccess(t)):this._onReadError(new U)}catch(e){this.onReadError(z(e))}finally{this._initialized.set(!0)}}async fetchFromEncrypted(e){const t=this.uniqId(this.documentId),n=e.transaction([G],"readonly"),r=n.objectStore(G),a=await re.ofRequest(r.get(t));return await re.ofTransaction(n),a?await this._encryptionSerializer.deserialize(a):null}async fetchFromLegacy(e){if(!e.objectStoreNames.contains(P))return null;const t=this.documentId,n=e.transaction([P],"readonly"),r=n.objectStore(P),a=await re.ofRequest(r.get(t));return await re.ofTransaction(n),a?await this._legacySerializer.deserialize(a):null}async migrateToEncrypted(e,t){this._log.info("Migrating document to encrypted storage");try{const n=t.id,r=await this._encryptionSerializer.serialize(t),a=e.transaction([G,P],"readwrite");a.objectStore(G).put(r),a.objectStore(P).delete(n),await re.ofTransaction(a)}catch(e){const t=(0,R.Tb)().humanWritingReport,n=(null==e?void 0:e.message)||"Unknown error";throw t.error("storageError",`Couldn't migrate document to encrypted storage: ${n}`),z(e)}}async writeDocumentState(e){if(await this.isInitialized(),this._db)try{const t=await this._encryptionSerializer.serialize(e),n=this._db.transaction([G],"readwrite");n.objectStore(G).put(t),await re.ofTransaction(n),this._onWriteResult("success")}catch(e){return void this._onWriteResult("error",z(e))}else this._onWriteResult("error",new Z)}isInitialized(){return this._initialized.pipe(c.h((e=>e)),M.P()).toPromise()}async openDb(){const e=indexedDB.open("human_writing_report",2);e.onupgradeneeded=this.onUpgradeNeeded.bind(this);try{return await re.ofRequest(e)}catch(e){return null}}onUpgradeNeeded(e){const t=e.target,n=t.result;if(t.result&&t.transaction)try{n.objectStoreNames.contains(G)||n.createObjectStore(G,{keyPath:"id",autoIncrement:!1})}catch(e){this._onReadError(z(e))}else this._onReadError(new Z)}onReadError(e){e instanceof O&&this._log.error(`Database corrupted: userId: ${this.userId} documentId: ${this.documentId}, (${e.name}) ${e.message}`),this._onReadError(e)}}var le=n(97521);class de{constructor(e){this._client=e}async getKey(e){const t=de.createKeyId(e),n=await this.fetchKey(t);if(!n)return null;const r=(0,le.K9)(n);return await function(e,t=!1,n=["encrypt","decrypt"]){return ee(),self.crypto.subtle.importKey("raw",e,q,t,n)}(r)}async getOrProvisionKey(e){let t=0;for(;t<=3;)try{return await this.getKey(e)||await this.provisionKey(e)}catch(e){if(e instanceof j){if(t++<=2)continue;if(e.reason)throw z(e.reason,W);throw new W("Too many retries")}throw z(e)}throw new W("Too many retries")}async provisionKey(e){const t=de.createKeyId(e),n=await(ee(),self.crypto.subtle.generateKey(J,!0,["encrypt","decrypt"]));return await this.storeKeys([{keyId:t,key:n}]),n}static createKeyId(e){return oe("key-"+e)}async fetchKey(e){const t=await this._client.getEncryptionKey({keyId:e});return null==t?void 0:t.keyMaterial}async storeKeys(e){const t=[];for(const n of e){const e=await te(n.key);t.push({id:n.keyId,keyMaterial:(0,le.J2)(e)})}await this._client.createEncryptionKeys({keys:t})}}var ue=n(7849),he=n(48246),me=n(5768),pe=n(36482),ge=n(11456),fe=n(68485);class ke{constructor(){this._rpc=(0,b.OB)().bgRpc,this._log=N.Y.create("GoogleDocsSourcedContentStore")}async getMatch(e,t,n){let r=null;return ue.QY.getNumDeletedLetters(t)>0&&(e.endsWith(" ")||e.endsWith("\n"))?r=K.create("hwr://delta/rewrite/google/correct/","Google Docs Corrections",e):0==ue.QY.getNumDeletedLetters(t)&&ue.QY.getNumInsertedLetters(t)<=me.QU&&(r=await this._matchPhraseCompletion(e,n)),this._log.debug(`[GoogleDocsSuggestionStore] getMatch('${e}') returning:`,r),r}async _matchPhraseCompletion(e,t){let n=null,r=null;if(null!=this._rpc.api.autocompletePhrase&&(r=await this._rpc.api.autocompletePhrase(t)),null!=r){const t=r.text.substring(r.prefixBegin-r.textBegin,r.prefixEnd-r.textBegin),a=r.text.substring(r.prefixEnd-r.textBegin),o=r.text.substring(t.length);(a==e||a.startsWith(e)||e.startsWith(a))&&(this._log.debug(`[GoogleDocsSuggestionStore] match: ${e} response: ${o}`),n=K.create("hwr://delta/rewrite/google/completion/","Google Docs Smart Compose Suggestions",e))}return n}}var be,_e=n(86378);!function(e){e.Internal="internal",e.Selection="selection",e.GrammarlyPrevious="grammarly-previous",e.GrammarlyCurrent="grammarly-current",e.External="external",e.GDocs="gdocs",e.Startup="startup",e.Temporary="temporary",e.Test="test"}(be||(be={}));class ve{constructor(e,t=[],n=1/0){this.kind=e,this.data=t,this._maxRecordsCount=n,this._sourcedContentById=new Map,this.data.forEach((e=>{this._sourcedContentById.set(e.id,e)})),this._log=N.Y.create(`[${this.kind}] ${ve.name}`),this._keepLastN()}getMatch(e,t){var n;let r=this.data;t&&(r=this.data.filter(t));const a=r.find((({text:t})=>t===e))||null;return null===(n=this._log)||void 0===n||n.info(`[${this.kind}] getMatch('${(0,ue.aS)(e,40)}') returning:`,a),a}getFuzzyMatch(e,t){var n;const r=(1-t)*e.length,a=this.data.find((t=>{var n,a;const o=(0,ue.CZ)(t.text),i=_e.zI.diffAsChanges(o,e);return null===(n=this._log)||void 0===n||n.info(`[FuzzyMatch] text length: ${e.length}, amount changed: ${i.amount}`),null===(a=this._log)||void 0===a||a.info("Delta",i),i.amount<=r&&!ue.Hq.hasPerLetterTags(t)}))||null;return null===(n=this._log)||void 0===n||n.info(`[${this.kind}] getFuzzyMatch('${(0,ue.aS)(e,40)}') returning:`,a),a}getContentById(e){return this._sourcedContentById.get(e)||null}addContent(e){var t;null===(t=this._log)||void 0===t||t.debug("addContent",e),this.data.push(e),this._sourcedContentById.set(e.id,e),this._keepLastN()}_keepLastN(){this.data.length<=this._maxRecordsCount||(this.data.slice(0,this.data.length-this._maxRecordsCount).forEach((({id:e})=>{this._sourcedContentById.delete(e)})),this.data=this.data.slice(-this._maxRecordsCount))}}class ye{constructor(e,t,n,r,a){this.text=e,this.delta=t,this.timestamp=n,this.sourcedContent=r,this.isWholeDeltaSelfAuthored=a,null!=r&&r.timestamps.length>0&&((0,m.kG)(e.length==r.timestamps.length),(0,m.kG)(e.length==r.isSelfAuthoredTags.length),(0,m.kG)(e.length==r.originalSourceContentIds.length))}getCharAt(e){var t,n,r;const a=null!=this.sourcedContent?this.sourcedContent.timestamps:[],o=(null===(t=this.sourcedContent)||void 0===t?void 0:t.isSelfAuthoredTags)||[],i=(null===(n=this.sourcedContent)||void 0===n?void 0:n.originalSourceContentIds)||[];let s=this.timestamp;const c=this.isWholeDeltaSelfAuthored||!!this.sourcedContent&&Boolean(o[e]);let l=(null===(r=this.sourcedContent)||void 0===r?void 0:r.id)||null;return a.length>0&&(s=a[e],l=i[e]||l),{char:this.text[e],timestamp:s,sourceContentId:l||void 0,isSelfAuthored:c}}}class we{constructor(e,t,n){this._documentId=e,this._events=t,this._trustedEvents=n,this._chars=[],this._last_updated_at=Date.now(),this._log=N.Y.create("ChangeTrackerImpl"),this._deltaEdits=[],this._internalCopyStore=new ve(be.Internal,[]),this._internalSelectionStore=new ve(be.Selection),this._prevGrammarlyAlerts=new ve(be.GrammarlyPrevious),this._currentGrammarlyAlerts=new ve(be.GrammarlyCurrent),this._externalCopyStore=new ve(be.External,[],4),this._googleDocsSourcedContentStore=new ke,this.startupCopyStore=new ve(be.Startup,[],4)}async updateKnownDocumentState(e,t){this._chars=e.chars,this._internalCopyStore=new ve(be.Internal,e.sourcedContentStore.data),this._deltaEdits=e.deltaEdits;const n=ue.QY.singleDelta(e.chars.map((e=>e.char)).join(""),t);ue.QY.isNoTextChangesDelta(n)?(this._log.info("No changes since last known state."),this._events.next({kind:"knownStateMatch"})):(this._log.info("Known document state is different from current",n),this._events.next({kind:"knownStateMismatch",lengthDifference:Math.abs(ue.QY.getNumInsertedLetters(n)+ue.QY.getNumDeletedLetters(n))})),n.forEach((e=>{he.s.isInsertString(e)&&this.startupCopyStore.addContent(K.create("hwr://delta/startup/","Delta on Document load",e.insert))})),await this.onTextChange(n)}async onTextChange(e){if(this._log.info("Got text change",e),0===e.ops.length)return this._log.info("Noop change, skipping"),0;const t=he.s.normalizeDelta(he.s.cleanAllAttrs(e));const n=function(e,t){if(0===t.length)return!1;const n=t.reduce(((e,t)=>`${e}${t.key}`),""),r=e.ops.reduce(((e,t)=>"insert"in t?`${e}${t.insert}`:e),"");return n===r||n.substring(0,r.length)===r}(t,this._trustedEvents.get()),r=Date.now(),{sourcedContentId:a,inserted:o}=await this._applyDelta(t,r,n),i=ue.QY.getNumInsertedLetters(t);if(!n&&a){const e=this._internalCopyStore.getContentById(a);e?this._events.next({kind:"sourcedTextAdded",sourceDomain:(0,ue.Xw)(e.url),textLength:i,promptDetected:Boolean(e.prompt)}):this._events.next({kind:"unknownSourceTextAdded",textLength:i})}else n||this._events.next({kind:"unknownSourceTextAdded",textLength:i});const s={timestamp:r,delta:t,sourceContentId:a||void 0,isSelfAuthored:n};return this._deltaEdits.push(s),this._last_updated_at=Date.now(),o}onSelectionChange(e){e.forEach((e=>{if(e.start!=e.end&&e.end-e.start>1){const t=this._chars.slice(e.start,e.end).map((e=>e.char)).join(""),n=this._chars.slice(e.start,e.end);this._internalSelectionStore.addContent(K.create(`hwr://delta/document/google/${this._documentId}`,self.name||"Unnamed",t,n)),this._events.next({kind:"sourceAdded",textLength:e.end-e.start,sourceDomain:self.location.origin,promptDetected:!1}),this._log.debug("HWR Selected Text:",{selectedText:t,selection_info:n})}}))}onAlertChange(e){this._log.debug("onAlertChange",e);const t=new ve(be.Temporary);for(const[n,r]of Object.entries(e)){if(void 0===r||!ge.S.isCapiAlert(r))continue;const e=r.text;r.replacements.forEach((r=>{const a=ue.QY.extractMaximalReplacementString(e,ue.QY.singleDelta(e,r));a&&(this._log.debug("adding alert to store","Grammarly edited: ("+e+" -> "+r+")"),t.addContent(K.create("hwr://delta/rewrite/grammarly/correct/?id="+n,"Grammarly edited: ("+e+" -> "+r+")",a)))}))}ue.Hq.eq(t.data,this._currentGrammarlyAlerts.data)||(this._prevGrammarlyAlerts=new ve(be.GrammarlyPrevious,this._currentGrammarlyAlerts.data),this._currentGrammarlyAlerts=new ve(be.GrammarlyCurrent,t.data))}addCopiedTextToExternalStore(e){if(!e.valid)return;const t=e.copiedText||"";null==this._externalCopyStore.getMatch(t)&&this._externalCopyStore.addContent(K.create(e.sourceURL||"",e.sourceName||"",t,void 0,e.userPrompt))}onReplacementApplied(e,t){if(this._log.debug("HWR replacement applied",{source:e,replacement:t}),e===fe.P.snippets||e===fe.P.oggyGenAI){let n="";void 0!==t.pos&&(n=this._chars.slice(t.pos.start,t.pos.end).map((e=>e.char)).join(""));const r=ue.QY.extractMaximalReplacementString(n,"string"==typeof t.value?ue.QY.singleDelta(n,t.value):t.value);r&&this._internalCopyStore.addContent(K.create("hwr://delta/rewrite/grammarly/"+e,"Grammarly generated ("+e+")",r))}}getDocumentState(){return{id:this._documentId,chars:this._chars,sourcedContentStore:{kind:"internal",data:this._internalCopyStore.data},deltaEdits:this._deltaEdits}}getReportableDocument(){return Y.Backend.create(this.getDocumentState(),this._last_updated_at,document.title)}getTextInfoForAlert(e){const t=[];return(0,pe.C)(e).forEach((e=>{if("transform"==e.meta.rangePurpose)for(let n=e.start;n<e.end;++n)t.push({...this._chars[n]})})),t}_applySingleDeletion(e,t){this._chars.splice(e,t)}_applySingleInsertion(e,t){const n=t.text.length,r=Array.from({length:n},((e,n)=>t.getCharAt(n)));this._log.debug("inserted chars",r),this._chars.splice(e,0,...r)}async _searchAllCopyStores(e,t,n){let r=this._prevGrammarlyAlerts.getMatch(e);return r?{storeKind:be.GrammarlyPrevious,sourcedContent:r}:(r=this._internalCopyStore.getMatch(e,(e=>"hwr://delta/startup/"!=e.url)),r?{storeKind:this._internalCopyStore.kind,sourcedContent:r}:(r=this._internalSelectionStore.getMatch(e),r?{storeKind:be.Selection,sourcedContent:r}:(r=this._externalCopyStore.getMatch(e),r?{storeKind:be.External,sourcedContent:r}:(r=await this._googleDocsSourcedContentStore.getMatch(e,t,n),r?{storeKind:be.GDocs,sourcedContent:r}:(r=this.startupCopyStore.getMatch(e),r?{storeKind:be.Startup,sourcedContent:r}:(r=this._externalCopyStore.getFuzzyMatch(e,.95),r?{storeKind:be.External,sourcedContent:r}:null))))))}async _applyDelta(e,t,n){let a=null,o=0;const i=this._chars.map((e=>e.char)).join(""),s=ue.QY.extractMaximalReplacementString(i,e),c=(0,r.zG)(he.s.rangeOfTheChange(e),h.UI((([e])=>i.substring(0,e))),h.fS((()=>i)));let l=null;n||(l=s?await this._searchAllCopyStores(s,e,c):null),a=(null==l?void 0:l.sourcedContent.id)||null,l&&l.storeKind!=be.Internal&&this._internalCopyStore.addContent(l.sourcedContent),this._log.info("Content search result",l);let d=0;for(const r of e.ops)he.s.isRetain(r)?o+=r.retain:he.s.isInsertString(r)?(this._applySingleInsertion(o,new ye(r.insert,e,t,(null==l?void 0:l.sourcedContent)||null,n)),o+=r.insert.length,d+=r.insert.length):he.s.isDelete(r)&&(this._trackDeletion(o,r.delete),this._applySingleDeletion(o,r.delete));return{sourcedContentId:a,inserted:d}}_trackDeletion(e,t){const n=Array.from({length:t},((t,n)=>this._chars[e+n])),r=n.map((e=>e.char)).join("");this._onCopyDelete(r,n)}_onCopyDelete(e,t){e.length>=me.Uv&&this._internalCopyStore.addContent(K.create(`hwr://delta/document/google/${this._documentId}`,self.name||"Unnamed",e,t))}onCopy(e){e.forEach((e=>{if(e.start!=e.end){const t=this._chars.slice(e.start,e.end).map((e=>e.char)).join(""),n=this._chars.slice(e.start,e.end);this._onCopyDelete(t,n)}}))}_getCSSFormatForLetter(e){const t="color: red;",n="color: black;",r=e.sourceContentId,a=null!=r?this._internalCopyStore.getContentById(r):null;let o;return o=null!=a?a.url.match(/delta\/rewrite\/grammarly\/(oggyGenAI|snippets)/)?"color: blue;":a.url.match("delta/rewrite/grammarly/correct")?"color: green;":a.url.match(/(chat.openai.com|chatgpt.com)/)?"color: purple;":a.url.match("gemini.google.com")?"color: orange;":a.url.match("delta/rewrite/google")?"color: teal;":a.url.match("delta/startup")?t:e.isSelfAuthored?n:t:e.isSelfAuthored?n:t,o}_logText(){const e=this._chars.map((e=>`%c${e.char}`)).join(""),t=this._chars.map((e=>this._getCSSFormatForLetter(e)));self.console.log(`HWR: ${e}`,...t)}}class Ce{constructor(e,t,n,r,a,i,s,c,l,d){this._listenerId=e,this._alertsState=t,this._textObserver=n,this._selectionSource=r,this._CSState=a,this._replacementListener=i,this._events=s,this._encryptionService=c,this._errors=l,this._keyboardEventsSource=d,this._subs=new w.L,this._trackingState=p.h.create("dormant"),this._documentRetrievalState=p.h.create("waiting"),this._log=N.Y.create("HWRListenerImpl"),this._documentVisibilityObs=C.R(document,"visibilitychange").pipe(S.B()),this._documentStateSubj=new o.xQ,this._writeToStorageRequestSubj=new o.xQ,this._trustedEvents=p.h.create([]);const u=(0,R.Tb)().humanWritingReport;this._setupKeyboardEventsHandling(),this._log.info("Document id",e);const h=new D.m;this._documentId=h.documentID||this._listenerId,this._changeTracker=new we(this._documentId,s,this._trustedEvents.view());const m=a.view("user").view("id").get();this._keychain=new de(this._encryptionService),this._hwrStorage=new ce(m,this._documentId,this._keychain,(e=>{this._log.info("Document state read: success"),this._documentStateSubj.next(e)}),(e=>{this._log.error("Storage read error:",e),this._handleStorageError(e,u)}),((e,t)=>{t?(this._log.error("Storage write error:",t),this._handleStorageError(t,u)):this._log.info("Storage write status",e)})),this._log.info("HWR Storage initialized"),this._setupEventHandlers()}_handleStorageError(e,t){e instanceof U?this._documentStateSubj.next(Y.empty(this._documentId)):e instanceof O?(this._documentStateSubj.next(Y.empty(this._documentId)),this._errors.next({kind:"databaseCorrupted"}),t.error("storageError",`Database corrupted: ${e.name}, '${e.message}'`)):e instanceof H?(this._errors.next({kind:"serverError",errorMessage:e.message}),t.error("storageError",`Server error: ${e.name}, '${e.message}'`)):e instanceof W?(this._errors.next({kind:"unrecoverableError",errorMessage:e.message}),t.error("storageError",`Unrecoverable error: ${e.name}, '${e.message}'`)):(this._errors.next({kind:"unrecoverableError",errorMessage:e.message}),t.error("storageError",`Unknown error: ${e.name}, '${e.message}'`))}get changeTracker(){return this._changeTracker}get documentId(){return this._documentId}_setupEventHandlers(){this._subs.add(this._replacementListener.obs.pipe(x.M(this._trackingState),c.h((([e,t])=>"active"===t))).subscribe((([e])=>{this._changeTracker.onReplacementApplied(e.source,e.replacement)}))),this._subs.add(this._alertsState.subscribe((e=>{this._changeTracker.onAlertChange(e)}))),this._subs.add(this._textObserver.contentChanges.async.pipe(c.h((({changes:e})=>e.length>0)),x.M(this._trackingState,this._documentRetrievalState),c.h((([e,t,n])=>"active"===t&&"ok"===n))).subscribe((([e])=>{this._handleTextChange(e)}))),this._subs.add(this._selectionSource.data.changes.pipe(x.M(this._trackingState),c.h((([e,t])=>"active"===t))).subscribe((([e])=>{this._changeTracker.onSelectionChange(e)}))),this._subs.add(this._writeToStorageRequestSubj.pipe(x.M(this._documentRetrievalState),c.h((([e,t])=>"ok"===t)),E.b(1e3)).subscribe((()=>this._writeToStorage()))),this._documentVisibilityObs.pipe(i.U((()=>document.hidden)),l.w((e=>I.s((()=>e),T.of(!0),T.of(!1).pipe(A.g(300)))))).subscribe((e=>{e?this._stopTrackingWhenHidden():this._resumeTrackingWhenVisible()})),this._subs.add(this._documentStateSubj.pipe(x.M(this._documentVisibilityObs.pipe(i.U((()=>document.hidden)),B.O(document.hidden)),this._trackingState)).subscribe((([e,t,n])=>{t||"active"!==n||this._handleDocumentStateChange(e)})))}_setupKeyboardEventsHandling(){const e=(0,b.OB)().config.systemInfo.os.isMac;this._subs.add(this._keyboardEventsSource.pipe(c.h((t=>t.isTrusted&&(1===t.key.length||"Enter"===t.key)&&!t.ctrlKey&&(e?!t.metaKey:!t.altKey))),x.M(this._trackingState,this._documentRetrievalState),c.h((([e,t,n])=>"active"===t&&"ok"===n))).subscribe((([e])=>{this._trustedEvents.modify((t=>t.concat({timestamp:Date.now(),key:"Enter"===e.key?"\n":e.key})))})))}_startTracking(){this._hwrStorage.reload(),this._changeTracker.addCopiedTextToExternalStore(this._CSState.view("copiedTextMessage").get())}startTracking(){this._trackingState.set("active"),this._startTracking()}stopTracking(){this._log.info("Stopping document tracking"),this._trackingState.set("paused")}getReportableDocument(){return this._documentRetrievalState.pipe(c.h((e=>"ok"===e)),d.q(1),L.V(2e3),i.U((()=>this._changeTracker.getReportableDocument()))).toPromise()}_stopTrackingWhenHidden(){this._log.info("Pausing document tracking while document is not visible"),this._trackingState.modify((e=>"active"===e?"dormant":e))}_resumeTrackingWhenVisible(){this._log.info("Resuming document tracking after document became visible"),this._documentRetrievalState.set("waiting"),this._trackingState.modify((e=>"paused"===e?e:"active")),"active"===this._trackingState.get()&&this._startTracking()}async _handleDocumentStateChange(e){this._log.info("Got saved or Empty document.",e),await this._changeTracker.updateKnownDocumentState(e,this._textObserver.getCurrentTextMap().getPlainText()),this._documentRetrievalState.set("ok"),this._writeToStorage()}_writeToStorage(){try{this._hwrStorage.writeDocumentState(this._changeTracker.getDocumentState())}catch(e){this._log.error("Error writing to storage:",e),this._handleStorageError(e,(0,R.Tb)().humanWritingReport)}}_handleTextChange(e){this._log.debug("Text change: ",e),this._log.info("Trusted events",this._trustedEvents.get());const t=this._CSState.view("copiedTextMessage").get();this._changeTracker.addCopiedTextToExternalStore(t);const n=ue.QY.singleDelta(e.prevText,e.newText);this._log.debug("HWR single delta: ",n),n.ops.length>0&&this._changeTracker.onTextChange(n).then((e=>{this._trustedEvents.modify((t=>t.slice(e))),this._writeToStorageRequestSubj.next()}))}dispose(){this._subs.unsubscribe(),this._writeToStorage()}}var Se=n(49231),xe=n(12015),Ee=n(54350),Ie=n(65802),Te=n(52811),Ae=n(14275),Be=n(4354),Le=n(53829),De=n(74514),Me=n(90049),Re=n(91901),Ne=n(91795);const Pe={offsetLeft:"20px",offsetBottom:"20px"},Ge=()=>T.of(Pe),Fe=()=>{const e=document.querySelector(".left-sidebar-container-content .navigation-widget"),t=document.querySelector(Re.Qy),n=document.querySelector(Re.os);return e&&t&&n?Ne.x.create(e,{attributes:!0,subtree:!1,childList:!1}).pipe(c.h((e=>e.some((e=>"style"===e.attributeName)))),i.U((t=>/opacity: 0/.test(e.getAttribute("style")||""))),B.O(/opacity: 0/.test(e.getAttribute("style")||"")),l.w((e=>e?T.of(Pe):Me.T(Ne.x.create(t,{attributes:!0,subtree:!1,childList:!1}).pipe(c.h((e=>e.some((e=>"style"===e.attributeName))))),C.R(self,"resize")).pipe(i.U((()=>n.getBoundingClientRect().x)),B.O(n.getBoundingClientRect().x),i.U((e=>({offsetLeft:`${e+20}px`,offsetBottom:"20px"}))))))):T.of(Pe)};var Ue=n(43818),Oe=n(36231),He=n(61112),We=n(72832),je=n(16286),Ze=n(30921),ze=n(65252),Ve=n(91820),$e=n(26463),Ke=n(77365);const Ye={width:Oe.ux.rem(5.1875),height:Oe.ux.rem(5.1875/4.61)},qe={$nest:{"& .gds-modal-content":{minWidth:"438px"},"& .gds-modal-medium":{width:"438px"},"& .gds-modal-header":{display:"none"},"& .gds-modal-body":{padding:Oe.ux.rem(He.x0)},"& .gds-heading-large":{fontSize:Oe.ux.rem(2.25),lineHeight:"1.11em"}}},Qe=Oe.ux.stylesheet({logo:[Ye],modal:[qe]}),Je=Be.UI.Node.make((({notify:e})=>Se.createElement(We.u_,{isOpen:!0,onClose:e({kind:"clipboardRequestResult",result:"close"}),title:"",dismissOnOutsideClick:!1,width:"small",role:"alertdialog",className:Qe.modal},Se.createElement(We.u_.Body,null,Se.createElement(Ke.o,null,Se.createElement(je.k,{direction:"column",gap:10},Se.createElement(Ze.c,{className:Qe.logo}),Se.createElement(je.k,{direction:"column",gap:3},Se.createElement(ze.X,{as:"h1",variant:"heading-large"},"Allow clipboard",Se.createElement("br",null),"access to track",Se.createElement("br",null),"writing accurately"),Se.createElement(Ve.x,{as:"p"},"We need access to your clipboard so we can record the sources you use. We’ll use it to identify text you copy and paste from websites plus links to those sites.")),Se.createElement(je.k,{direction:"row",gap:3},Se.createElement($e.z,{text:"Allow access",variant:"primary",onClick:e({kind:"clipboardRequestResult",result:"allow"})}),Se.createElement($e.z,{text:"Deny",variant:"ghost",onClick:e({kind:"clipboardRequestResult",result:"deny"})}))))))));var Xe=n(80882);const et=Be.UI.Node.make((({notify:e})=>Se.createElement(We.u_,{isOpen:!0,onClose:e({kind:"feedbackPopupClose"}),title:"",dismissOnOutsideClick:!1,width:"small",role:"alertdialog"},Se.createElement(We.u_.Body,null,Se.createElement(Xe.b,{onClose:e({kind:"feedbackPopupClose"}),align:"left",onSubmit:t=>e({kind:"feedbackSubmit",feedback:t.text})(),withScore:!1,fixSubmitButtonOverflowBottomPadding:!0,hideLogo:!0,title:"How can we improve?"})))));var tt=n(54939),nt=n(98203),rt=n(94936),at=n(98465),ot=n(99627),it=n(99306);var st=n(27645);const ct=[{id:"transparency",title:Se.createElement(je.k,{align:"center",gap:2},Se.createElement((()=>Se.createElement("svg",{width:"23",height:"32",viewBox:"0 0 23 32",fill:"none"},Se.createElement("path",{d:"M3.58829 4.35H15.2974C17.0724 4.35 18.5357 5.85744 18.5357 7.75342V23.8537C18.5357 25.7497 17.0724 27.2571 15.2974 27.2571H3.58829C1.81326 27.2571 0.35 25.7497 0.35 23.8537V7.75342C0.35 5.85744 1.81326 4.35 3.58829 4.35Z",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Se.createElement("path",{d:"M4 8.5H11.89",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Se.createElement("path",{d:"M4 17.5H14.89",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Se.createElement("path",{d:"M4 13H14.89",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Se.createElement("path",{d:"M13.704 24.3143C17.1757 24.3143 19.9901 21.4731 19.9901 17.9684C19.9901 14.4637 17.1757 11.6226 13.704 11.6226C10.2323 11.6226 7.41797 14.4637 7.41797 17.9684C7.41797 21.4731 10.2323 24.3143 13.704 24.3143Z",fill:"#B3F8F8",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinejoin:"round"}),Se.createElement("path",{d:"M8 19.4951C8 19.4951 8.17677 19.4951 9.69062 19.4951",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Se.createElement("path",{d:"M12 19.4951C12 19.4951 12.4182 19.4951 16 19.4951",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Se.createElement("path",{d:"M8 15.5645H10.9419",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Se.createElement("path",{d:"M13.5 15.5645H16",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Se.createElement("path",{d:"M21.9414 26.6366C22.0781 26.7733 22.2997 26.7733 22.4364 26.6366C22.5731 26.4999 22.5731 26.2783 22.4364 26.1416L21.9414 26.6366ZM18.0523 22.7475L21.9414 26.6366L22.4364 26.1416L18.5473 22.2525L18.0523 22.7475Z",fill:"#1C1C1C"}))),null),Se.createElement(Ve.x,{variant:"text-small",as:"p",weight:"normal"},"We’re transparent about data")),Content:({learnMoreURL:e})=>Se.createElement(je.k,{direction:"column",gap:2},Se.createElement(Ve.x,{variant:"text-xsmall",as:"p"},"Grammarly Authorship records your writing activity when you turn it on in a document. The data it gathers includes: text you type and delete, text you paste from other websites and links to those sites, and prompts you send to generative AI tools."),Se.createElement(tt.r,{href:e,variant:"primary",weight:"bold",target:"_blank",underline:"hover"},Se.createElement(Ve.x,{variant:"text-xsmall",as:"span"},"Learn more"," ",Se.createElement(rt.J,{icon:at.n,accessibilityLabel:"",variant:"inherit",className:st.linkIcon}))))},{id:"safety",title:Se.createElement(je.k,{align:"center",gap:2},Se.createElement((()=>Se.createElement("svg",{width:"21",height:"32",viewBox:"0 0 21 32",fill:"none"},Se.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.09141 3C6.66135 3 4.69141 4.96994 4.69141 7.4V13.0256C4.69141 15.4557 6.66136 17.4256 9.09141 17.4256H11.947C14.3771 17.4256 16.347 15.4557 16.347 13.0256V7.4C16.347 4.96995 14.3771 3 11.947 3H9.09141ZM9.98539 5.49507C8.57706 5.49507 7.43539 6.63675 7.43539 8.04507V11.8101C7.43539 13.2184 8.57706 14.3601 9.98538 14.3601H11.0786C12.4869 14.3601 13.6286 13.2184 13.6286 11.8101V8.04507C13.6286 6.63675 12.4869 5.49507 11.0786 5.49507H9.98539Z",fill:"white"}),Se.createElement("path",{d:"M5.04141 7.4C5.04141 5.16324 6.85465 3.35 9.09141 3.35V2.65C6.46805 2.65 4.34141 4.77664 4.34141 7.4H5.04141ZM5.04141 13.0256V7.4H4.34141V13.0256H5.04141ZM9.09141 17.0756C6.85466 17.0756 5.04141 15.2624 5.04141 13.0256H4.34141C4.34141 15.649 6.46806 17.7756 9.09141 17.7756V17.0756ZM11.947 17.0756H9.09141V17.7756H11.947V17.0756ZM15.997 13.0256C15.997 15.2624 14.1838 17.0756 11.947 17.0756V17.7756C14.5704 17.7756 16.697 15.649 16.697 13.0256H15.997ZM15.997 7.4V13.0256H16.697V7.4H15.997ZM11.947 3.35C14.1838 3.35 15.997 5.16325 15.997 7.4H16.697C16.697 4.77665 14.5704 2.65 11.947 2.65V3.35ZM9.09141 3.35H11.947V2.65H9.09141V3.35ZM7.78539 8.04507C7.78539 6.83005 8.77036 5.84507 9.98539 5.84507V5.14507C8.38376 5.14507 7.08539 6.44345 7.08539 8.04507H7.78539ZM7.78539 11.8101V8.04507H7.08539V11.8101H7.78539ZM9.98538 14.0101C8.77036 14.0101 7.78539 13.0251 7.78539 11.8101H7.08539C7.08539 13.4117 8.38376 14.7101 9.98538 14.7101V14.0101ZM11.0786 14.0101H9.98538V14.7101H11.0786V14.0101ZM13.2786 11.8101C13.2786 13.0251 12.2936 14.0101 11.0786 14.0101V14.7101C12.6802 14.7101 13.9786 13.4117 13.9786 11.8101H13.2786ZM13.2786 8.04507V11.8101H13.9786V8.04507H13.2786ZM11.0786 5.84507C12.2936 5.84507 13.2786 6.83004 13.2786 8.04507H13.9786C13.9786 6.44345 12.6802 5.14507 11.0786 5.14507V5.84507ZM9.98539 5.84507H11.0786V5.14507H9.98539V5.84507Z",fill:"#1C1C1C"}),Se.createElement("rect",{x:"0.35",y:"10.5629",width:"20.3",height:"17.5082",rx:"2.41596",fill:"#B3F8F8",stroke:"#1C1C1C",strokeWidth:"0.7",strokeLinecap:"round"}),Se.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.4866 20.0964C12.2255 19.7611 12.7339 19.0611 12.7339 18.2517C12.7339 17.1165 11.7338 16.1963 10.5002 16.1963C9.26654 16.1963 8.26648 17.1165 8.26648 18.2517C8.26648 19.061 8.77474 19.7611 9.51355 20.0963V22.3355C9.51355 22.8803 9.95524 23.322 10.5001 23.322C11.045 23.322 11.4866 22.8803 11.4866 22.3355V20.0964Z",fill:"white"}),Se.createElement("path",{d:"M11.4866 20.0964L11.342 19.7776L11.1366 19.8708V20.0964H11.4866ZM9.51355 20.0963H9.86355V19.8708L9.65818 19.7776L9.51355 20.0963ZM12.3839 18.2517C12.3839 18.9067 11.9722 19.4918 11.342 19.7776L11.6313 20.4151C12.4789 20.0305 13.0839 19.2154 13.0839 18.2517H12.3839ZM10.5002 16.5463C11.5685 16.5463 12.3839 17.3367 12.3839 18.2517H13.0839C13.0839 16.8964 11.8991 15.8463 10.5002 15.8463V16.5463ZM8.61648 18.2517C8.61648 17.3367 9.43186 16.5463 10.5002 16.5463V15.8463C9.10121 15.8463 7.91648 16.8964 7.91648 18.2517H8.61648ZM9.65818 19.7776C9.02814 19.4917 8.61648 18.9066 8.61648 18.2517H7.91648C7.91648 19.2154 8.52134 20.0304 9.36892 20.415L9.65818 19.7776ZM9.86355 22.3355V20.0963H9.16355V22.3355H9.86355ZM10.5001 22.972C10.1485 22.972 9.86355 22.687 9.86355 22.3355H9.16355C9.16355 23.0736 9.76194 23.672 10.5001 23.672V22.972ZM11.1366 22.3355C11.1366 22.687 10.8517 22.972 10.5001 22.972V23.672C11.2383 23.672 11.8366 23.0736 11.8366 22.3355H11.1366ZM11.1366 20.0964V22.3355H11.8366V20.0964H11.1366Z",fill:"#1C1C1C"}))),null),Se.createElement(Ve.x,{variant:"text-small",as:"p",weight:"normal"},"We’ll keep your data safe")),Content:({learnMoreURL:e})=>Se.createElement(je.k,{direction:"column",gap:2},Se.createElement(Ve.x,{variant:"text-xsmall",as:"p"},"When you start Authorship, its data is stored on your device in an encrypted format. When you see or share your report, this data is sent to Grammarly over an encrypted connection."),Se.createElement(tt.r,{href:e,variant:"primary",weight:"bold",target:"_blank",underline:"hover"},Se.createElement(Ve.x,{variant:"text-xsmall",as:"span"},"Learn more"," ",Se.createElement(rt.J,{icon:at.n,accessibilityLabel:"",variant:"inherit",className:st.linkIcon}))))},{id:"control",title:Se.createElement(je.k,{align:"center",gap:2},Se.createElement((()=>Se.createElement("svg",{width:"22",height:"32",viewBox:"0 0 22 32",fill:"none"},Se.createElement("rect",{x:"0.375",y:"6.375",width:"21.25",height:"7.25",rx:"3.625",fill:"#B3F8F8",stroke:"#1C1C1C",strokeWidth:"0.75"}),Se.createElement("circle",{cx:"18",cy:"10",r:"3.625",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.75"}),Se.createElement("rect",{x:"-0.375",y:"0.375",width:"21.25",height:"7.25",rx:"3.625",transform:"matrix(-1 0 0 1 21.25 18)",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.75"}),Se.createElement("circle",{cx:"4",cy:"4",r:"3.625",transform:"matrix(-1 0 0 1 8 18)",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.75"}))),null),Se.createElement(Ve.x,{variant:"text-small",as:"p",weight:"normal"},"You’re always in control")),Content:({learnMoreURL:e})=>Se.createElement(je.k,{direction:"column",gap:2},Se.createElement(Ve.x,{variant:"text-xsmall",as:"p"},"You choose when Authorship tracks your writing activity and when you share your report. You can stop sharing your report or delete your writing activity data anytime."),Se.createElement(tt.r,{href:e,variant:"primary",weight:"bold",target:"_blank",underline:"hover"},Se.createElement(Ve.x,{variant:"text-xsmall",as:"span"},"Learn more"," ",Se.createElement(rt.J,{icon:at.n,accessibilityLabel:"",variant:"inherit",className:st.linkIcon}))))}],lt={width:Oe.ux.rem(5.1875),height:Oe.ux.rem(5.1875/4.61)},dt={$nest:{"& .gds-modal-content":{minWidth:"860px"},"& .gds-modal-medium":{width:"860px"},"& .gds-modal-header":{display:"none"},"& .gds-modal-body":{padding:Oe.ux.rem(He.x0)},"& .gds-heading-large":{fontSize:Oe.ux.rem(2.25),lineHeight:"1.11em"}}},ut=Oe.ux.stylesheet({logo:[lt],link:[{whiteSpace:"normal"}],linkIcon:[{verticalAlign:"top"}],flip:[{transform:"rotate(180deg)"}],modal:[dt]}),ht=(0,ot.xb)(tt.r),mt=(0,ot.xb)((({learnMoreURLs:e})=>{const[t,n]=Se.useState([]);return Se.createElement("div",{className:st.accordionRoot},Se.createElement("div",null,ct.map((({id:r,title:a,Content:o})=>{const i=t.includes(r),s=`optInAccordion-title-${r}`,c=`optInAccordion-content-${r}`;return Se.createElement("div",{key:r,className:`${st.accordionItem}`},Se.createElement("button",{id:s,className:st.accordionHeader,onClick:()=>{n(i?[]:[r])},"aria-controls":c,"aria-expanded":i},Se.createElement("div",{className:st.accordionTrigger},a,Se.createElement(je.k,{className:`${st.accordionIcon} ${i?st.rotate:""}`},Se.createElement(rt.J,{size:"large",icon:it.p,accessibilityLabel:i?"Collapse section":"Expand section"})))),Se.createElement("div",{role:"region","aria-labelledby":s,className:`${st.accordionContent} ${i?st.shown:""}`},Se.createElement(o,{learnMoreURL:e[r]})))}))))})),pt=Be.UI.Node.make((({view:e,state:t,notify:n})=>Se.createElement(We.u_,{isOpen:!0,onClose:n({kind:"closeOptInPopup"}),title:"",dismissOnOutsideClick:!1,width:"medium",role:"alertdialog",className:ut.modal},Se.createElement(We.u_.Body,null,Se.createElement(Ke.o,null,Se.createElement(je.k,{direction:"row",gap:6},Se.createElement(je.k,{direction:"column",gap:10,flex:"1 1 50%"},Se.createElement(Ze.c,{className:ut.logo}),Se.createElement(je.k,{direction:"column",gap:3},Se.createElement(nt.V,{variant:"addition",label:"Beta"}),Se.createElement(ze.X,{as:"h1",variant:"heading-large"},"Prove where your",Se.createElement("br",null),"words come from"),Se.createElement(Ve.x,{as:"p"},"With Grammarly Authorship, you can certify what you type, copy, or generate with AI. You choose how to share this information."),Se.createElement(ht,{href:e("howItWorksURL"),variant:"primary",weight:"bold",target:"_blank",underline:"hover"},"See how it works"," ",Se.createElement(rt.J,{icon:at.n,accessibilityLabel:"",variant:"inherit",className:ut.linkIcon}))),Se.createElement($e.z,{text:"OK",onClick:n({kind:"optIn"})})),Se.createElement(je.k,{direction:"column",gap:3,flex:"1 1 50%",align:"stretch"},Se.createElement(je.k,{direction:"row",flex:"1 0 0%",align:"center"},Se.createElement(mt,{learnMoreURLs:t.pipe(i.U((({learnMoreTransparencyURL:e,learnMoreSafetyURL:t,learnMoreControlURL:n})=>({transparency:e,safety:t,control:n}))))})),Se.createElement(Ve.x,{as:"p",color:"base-subdued",variant:"text-xsmall"},"By tracking writing activity, the Beta terms in your agreement with Grammarly (",Se.createElement(tt.r,{href:"https://www.grammarly.com/terms/customer-business-agreement",variant:"secondary",className:ut.link},"Customer Business Agreement"),", ",Se.createElement(tt.r,{href:"https://www.grammarly.com/terms",variant:"secondary",className:ut.link},"Terms and Conditions")," ","and our"," ",Se.createElement(tt.r,{href:"https://www.grammarly.com/privacy-policy",variant:"secondary",className:ut.link},"Privacy Policy"),", as applicable) will apply.")))))))),gt=Be.UI.Union.make("kind",{optIn:pt,clipboardAccess:Je,feedback:et}),ft=Be.UI.Union.asOption(gt);var kt=n(80617);const bt=Oe.ux.stylesheet({toast:[{$nest:{"&&":{minWidth:"376px"}}}]}),_t=Be.UI.Node.make((({notify:e})=>Se.createElement(kt.F,{variant:"success",text:"Grammarly is tracking your writing activity in this document. Click the icon to stop tracking or see your report.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:bt.toast}))),vt=(0,ot.xb)(kt.F),yt=Be.UI.Node.make((({state:e,notify:t})=>Se.createElement(vt,{variant:"success",text:e.pipe(i.U((({domain:e,wasNewDocument:t})=>`Authorship ${t?"is tracking your writing activity in this doc. It will start tracking":"will start tracking your writing activity"} anytime you create a new ${"docs.google.com"===e?"Google doc":`doc on ${e}`}.`))),onClose:t({kind:"dismissToast"}),onMouseEnter:t({kind:"toastHover",hovered:!0}),onMouseLeave:t({kind:"toastHover",hovered:!1}),className:bt.toast}))),wt=Be.UI.Node.make((({notify:e})=>Se.createElement(kt.F,{variant:"success",text:"Grammarly Authorship is turned off. If you want the option to track your writing activity, you can turn it on in Settings.",primaryAction:Se.createElement($e.z,{text:"OK",variant:"primary",onClick:e({kind:"optOutToastOkClick"})}),onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:bt.toast}))),Ct=Be.UI.Node.make((({notify:e})=>Se.createElement(kt.F,{variant:"success",text:"Grammarly Authorship is now available. Start it to track your writing activity in a doc.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:bt.toast}))),St=Be.UI.Node.make((({notify:e})=>Se.createElement(kt.F,{variant:"critical",text:"Could not generate Authorship Report. Please try again later.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:bt.toast}))),xt=Be.UI.Node.make((({notify:e})=>Se.createElement(kt.F,{variant:"critical",text:"An error occurred while saving your editing history data.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:bt.toast}))),Et=Be.UI.Node.make((({notify:e})=>Se.createElement(kt.F,{variant:"critical",text:"Could not retrieve editing history data. Tracking will start from scratch.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:bt.toast}))),It=Be.UI.Node.make((({notify:e})=>Se.createElement(kt.F,{variant:"critical",text:"An error occurred while communicating with the server. Please try again later.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:bt.toast}))),Tt=Be.UI.Node.make((({notify:e})=>Se.createElement(kt.F,{variant:"warning",text:"Without clipboard access, Authorship will mark any text you paste as “Copied from unknown source.” To accurately record your sources, allow clipboard access.",primaryAction:Se.createElement($e.z,{text:"Allow clipboard access",variant:"primary",onClick:e({kind:"clipboardWarningResult",result:"allow"})}),secondaryAction:Se.createElement($e.z,{text:"Deny",variant:"ghost",onClick:e({kind:"clipboardWarningResult",result:"deny"})}),onClose:e({kind:"clipboardWarningResult",result:"close"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:bt.toast}))),At=Be.UI.Union.make("kind",{documentTrackingStarted:_t,domainTrackingStarted:yt,domainTrackingStartedWhenAlreadyTracked:yt,optedOut:wt,optedIn:Ct,reportGenerationFailed:St,clipboardWarning:Tt,storageUnrecoverableError:xt,storageDatabaseCorrupted:Et,storageServerError:It}),Bt=Be.UI.Union.asOption(At);var Lt=n(19337);const Dt=Oe.ux.keyframes({"0%":{transform:"scale(1)",opacity:.5},"75%":{transform:"scale(6)",opacity:0},"100%":{transform:"scale(6)",opacity:0}}),Mt={width:Oe.ux.rem(.5),height:Oe.ux.rem(.5),borderRadius:Oe.ux.rem(.25),position:"relative",backgroundColor:Lt.I.Background.Brand.Default,overflow:"visible",$nest:{"&:before":{content:"' '",width:"100%",height:"100%",borderRadius:"50%",position:"absolute",backgroundColor:Lt.I.Background.Brand.Default,top:0,left:0,transformOrigin:"50% 50%",animationName:Dt,animationDuration:"1.5s",animationIterationCount:"infinite",animationDirection:"normal",animationFillMode:"backwards"}}},Rt=Oe.ux.stylesheet({dot:[Mt]}),Nt=()=>Se.createElement("div",{className:Rt.dot}),Pt=()=>Se.createElement("svg",{fill:"none",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2",viewBox:"0 0 20 20"},Se.createElement("path",{d:"M14 20a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm0-1a5 5 0 1 0-.001-10.001A5 5 0 0 0 14 19Zm-2-7.7c0-.08.03-.156.084-.212a.279.279 0 0 1 .202-.088h.571c.076 0 .149.032.202.088a.305.305 0 0 1 .084.212v5.4c0 .08-.03.156-.084.212a.279.279 0 0 1-.202.088h-.571a.279.279 0 0 1-.202-.088A.305.305 0 0 1 12 16.7v-5.4Zm2.857 0c0-.08.03-.156.084-.212a.279.279 0 0 1 .202-.088h.571c.076 0 .149.032.202.088A.305.305 0 0 1 16 11.3v5.4c0 .08-.03.156-.084.212a.279.279 0 0 1-.202.088h-.571a.279.279 0 0 1-.202-.088.305.305 0 0 1-.084-.212v-5.4Z",fill:"inherit"}),Se.createElement("path",{d:"M6.964 14.924a6.912 6.912 0 0 1-.726-.148v-1.963a.425.425 0 1 0-.85-.001v1.683a7.013 7.013 0 0 1-2.651-1.881V8a5.264 5.264 0 0 1 10.426-1.025 6.987 6.987 0 0 0-.886.161A4.364 4.364 0 0 0 3.638 8v3.5a.425.425 0 1 0 .85 0V8a3.512 3.512 0 0 1 6.972-.608 7.066 7.066 0 0 0-.856.395A2.612 2.612 0 0 0 5.388 8v2.625a.425.425 0 1 0 .85 0V8a1.762 1.762 0 0 1 3.524 0v.325a7.057 7.057 0 0 0-2.798 6.599Zm7.054-7.998A6.113 6.113 0 0 0 1.888 8v3.412A7.004 7.004 0 0 1 8 1a7.005 7.005 0 0 1 6.927 5.986 7.166 7.166 0 0 0-.909-.06ZM7.575 8v.75a.425.425 0 1 0 .85 0V8a.425.425 0 1 0-.85 0Z",fill:"#027e6f"})),Gt=()=>Se.createElement("svg",{viewBox:"0 0 20 20",fill:"none",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2"},Se.createElement("path",{d:"M4 15.289V10a6 6 0 1 1 12 0v5.289a7.98 7.98 0 0 1-1 .954V13a.5.5 0 0 0-1 0v3.928c-.32.186-.654.349-1 .49V10a3 3 0 1 0-6 0v3a.5.5 0 0 0 1 0v-3a2 2 0 1 1 4 0v7.748a8.062 8.062 0 0 1-1.5.237V13.5a.5.5 0 0 0-1 0v4.485a8.062 8.062 0 0 1-1.5-.237V15.5a.5.5 0 0 0-1 0v1.918a8.022 8.022 0 0 1-3-2.129Zm10.474-4.29L14.5 11l.021-.003c.096-.016.479-.105.479-.508V10a5 5 0 0 0-10 0v4.5a.5.5 0 0 0 1 0V10a4 4 0 0 1 8 0l.5.5-.5-.5v.5a.5.5 0 0 0 .474.499ZM3 13.873A7.954 7.954 0 0 1 2 10c0-4.415 3.585-8 8-8a8.004 8.004 0 0 1 7 11.874V10a7 7 0 1 0-14 0v3.873ZM9.5 10v1a.5.5 0 0 0 1 0v-1a.5.5 0 0 0-1 0Z",fill:"inherit"})),Ft={$nest:{svg:{width:Oe.ux.rem(1.25),height:Oe.ux.rem(1.25),fill:Lt.I.Icon.Brand.Default}}},Ut={position:"absolute",right:Oe.ux.rem(-.25),top:Oe.ux.rem(-.25)},Ot=Oe.ux.stylesheet({icon:[Ft],button:[{background:"none",border:"none",cursor:"pointer",position:"relative"}],attractSequnce:[Ut]}),Ht=Be.UI.Node.make((({view:e,notify:t,state:n})=>Se.createElement(Se.Fragment,null,Se.createElement(Ue.F.button,{className:Ot.button,"aria-label":e("trackingState").pipe(i.U((e=>"tracking"===e?"Press to pause authorship tracking":"Press to start authorship tracking"))),onClick:t({kind:"trackingButtonClick"})},Se.createElement(Ue.F.div,{className:Ot.icon},e("trackingState").pipe(i.U((e=>"tracking"===e?Se.createElement(Pt,null):Se.createElement(Gt,null)))),n.pipe(i.U((({optInPopupWasClosedOnce:e,trackingState:t})=>!e&&"available"===t&&Se.createElement("div",{className:Ot.attractSequnce},Se.createElement(Nt,null))))))))));var Wt=n(74812),jt=n(34709),Zt=n(49992),zt=n(73507),Vt=n(96989),$t=n(88134),Kt=n(83955),Yt=n(54089);const qt=()=>Se.createElement("svg",{fill:"none",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2",viewBox:"0 0 20 20"},Se.createElement("path",{d:"M13.257,10.429C13.408,10.338 13.5,10.176 13.5,10C13.5,9.824 13.408,9.662 13.257,9.571L8.257,6.571C8.103,6.479 7.91,6.476 7.754,6.565C7.597,6.654 7.5,6.82 7.5,7L7.5,13C7.5,13.18 7.597,13.346 7.754,13.435C7.91,13.524 8.103,13.521 8.257,13.429L13.257,10.429ZM12.028,10L8.5,12.117C8.5,12.117 8.5,7.883 8.5,7.883L12.028,10Z",fill:"inherit"}),Se.createElement("path",{d:"M9.8,2.183C5.437,2.183 1.9,5.72 1.9,10.083C1.9,14.446 5.437,17.983 9.8,17.983C14.162,17.983 17.7,14.446 17.7,10.083C17.7,5.72 14.162,2.183 9.8,2.183ZM9.8,3.183C13.61,3.183 16.7,6.272 16.7,10.083C16.7,13.894 13.61,16.983 9.8,16.983C5.989,16.983 2.9,13.894 2.9,10.083C2.9,6.272 5.989,3.183 9.8,3.183Z",fill:"inherit"})),Qt=()=>Se.createElement("svg",{fill:"none",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2",viewBox:"0 0 20 20"},Se.createElement("path",{id:"Vector",d:"M7.714,6.914C7.714,6.823 7.749,6.736 7.81,6.672C7.871,6.608 7.954,6.571 8.041,6.571L8.694,6.571C8.781,6.571 8.864,6.608 8.925,6.672C8.986,6.736 9.02,6.823 9.02,6.914L9.02,13.086C9.02,13.177 8.986,13.264 8.925,13.328C8.864,13.392 8.781,13.429 8.694,13.429L8.041,13.429C7.954,13.429 7.871,13.392 7.81,13.328C7.749,13.264 7.714,13.177 7.714,13.086L7.714,6.914ZM10.98,6.914C10.98,6.823 11.014,6.736 11.075,6.672C11.137,6.608 11.22,6.571 11.306,6.571L11.959,6.571C12.046,6.571 12.129,6.608 12.19,6.672C12.251,6.736 12.286,6.823 12.286,6.914L12.286,13.086C12.286,13.177 12.251,13.264 12.19,13.328C12.129,13.392 12.046,13.429 11.959,13.429L11.306,13.429C11.22,13.429 11.137,13.392 11.075,13.328C11.014,13.264 10.98,13.177 10.98,13.086L10.98,6.914Z",fill:"inherit"}),Se.createElement("path",{id:"Subtract",d:"M10,16.857C13.787,16.857 16.857,13.787 16.857,10C16.857,6.213 13.787,3.143 10,3.143C6.213,3.143 3.143,6.213 3.143,10C3.143,13.787 6.213,16.857 10,16.857ZM10,15.714C13.156,15.714 15.714,13.156 15.714,10C15.714,6.844 13.156,4.286 10,4.286C6.844,4.286 4.286,6.844 4.286,10C4.286,13.156 6.844,15.714 10,15.714Z",fill:"inherit"})),Jt={boxShadow:Wt.H8.boxShadow,border:Wt.H8.border,background:Lt.I.Background.Base.Default,borderRadius:Oe.ux.rem(.5),position:"relative",minWidth:"260px"},Xt={position:"absolute",bottom:"100%",right:0,marginBottom:Oe.ux.rem(He.F2),background:Lt.I.Background.Base.Default,boxShadow:Wt.H8.boxShadow,border:Wt.H8.border,borderRadius:Oe.ux.rem(jt.xB),maxWidth:"200px",overflow:"hidden"},en={$nest:{svg:{width:Oe.ux.rem(1.25),height:Oe.ux.rem(1.25),fill:Lt.I.Icon.Base.Inverse,stroke:"none"}}},tn={$nest:{svg:{width:Oe.ux.rem(1.25),height:Oe.ux.rem(1.25),fill:Lt.I.Icon.Brand.Default,stroke:"none"}}},nn={borderBottom:`1px solid ${Lt.I.Border.Base.Subdued}`},rn={color:"inherit",display:"block",textDecoration:"none",padding:Oe.ux.rem(He.x),$nest:{"&:hover":{background:Lt.I.Background.Base.Subdued},"&:active":{background:Lt.I.Border.Base.Subdued}}},an={color:"inherit",display:"block",padding:Oe.ux.rem(He.x),background:"none",border:"none",margin:0,textAlign:"left",cursor:"pointer",$nest:{"&:hover":{background:Lt.I.Background.Base.Subdued},"&:active":{background:Lt.I.Border.Base.Subdued}}},on=Oe.ux.stylesheet({container:[Jt],settingsButton:[{alignSelf:"inherit"}],logButtonContainer:[{position:"relative"}],menu:[Xt],logButton:[en],pauseButton:[tn],infoIcon:[{$nest:{"&&":{cursor:"default"}}}],switch:[{transform:"scale(0.86) translateY(0.5px)",transformOrigin:"center right",width:"160px",whiteSpace:"nowrap",display:"flex",flexDirection:"row-reverse",overflow:"visible"}],section:[nn],menuLink:[rn],menuButton:[an],fullWidth:[{flex:"1 0 0%"}]}),sn=({onClick:e})=>Se.createElement($e.z,{className:on.logButton,onClick:e,width:"full"},Se.createElement(je.k,{direction:"row",gap:2,align:"center"},Se.createElement(Gt,null),Se.createElement(Ve.x,{as:"span",weight:"bold",variant:"text-small"},"Track writing activity"))),cn=({isPaused:e,onPauseClick:t,onResumeClick:n,onViewReportClick:r})=>Se.createElement(je.k,{direction:"row",gap:2,align:"center"},Se.createElement($e.z,{variant:"secondary",className:on.pauseButton,onClick:e?n:t,width:"full"},Se.createElement(je.k,{direction:"row",gap:2,align:"center"},e?Se.createElement(qt,null):Se.createElement(Qt,null),Se.createElement(Ve.x,{as:"span",weight:"bold",variant:"text-small"},e?"Resume tracking":"Stop tracking"))),Se.createElement($e.z,{text:"See report",onClick:r,width:"full"})),ln=Be.UI.Node.make((({notify:e,state:t,view:n})=>{const[r,a]=Se.useState(!1);return Se.createElement(Yt.d,{onClickAway:e({kind:"trackingButtonClickAway"})},Se.createElement(je.k,{direction:"column",padding:2,gap:2,className:on.container},Se.createElement(je.k,{direction:"row",gap:2,align:"center"},Se.createElement(rt.J,{icon:Zt.H,accessibilityLabel:"Grammarly",size:"small"}),Se.createElement(je.k,{direction:"row",flex:"1 0 auto",gap:1},Se.createElement(Ve.x,{as:"span",variant:"text-xsmall",color:"base-subdued"},"Grammarly Authorship"),Se.createElement(nt.V,{variant:"neutral",label:"Beta"})),Se.createElement(je.k,{direction:"row"},Se.createElement(zt.h,{accessibilityLabel:"Settings",icon:Vt.a,variant:"tertiary",onClick:()=>a(!r),size:"small","aria-controls":"hwr-settings-menu"}),Se.createElement(zt.h,{accessibilityLabel:"Close",icon:$t.V,variant:"tertiary",onClick:e({kind:"trackingButtonCloseClick"}),size:"small"}))),Se.createElement(Ue.F.Fragment,null,t.pipe(i.U((({trackingState:t})=>"available"===t||"newDocument"===t?Se.createElement(sn,{onClick:e({kind:"start"})}):Se.createElement(cn,{isPaused:"paused"===t,onResumeClick:e({kind:"resume"}),onPauseClick:e({kind:"pause"}),onViewReportClick:e({kind:"viewReport"})}))))),r&&Se.createElement(Yt.d,{onClickAway:()=>a(!1)},Se.createElement("div",{className:on.menu,role:"menu",id:"hwr-settings-menu"},Se.createElement(je.k,{direction:"column"},Se.createElement(Ue.F.Fragment,null,t.pipe(i.U((({enabledForDomain:t,domain:n,trackingState:r})=>{const a="docs.google.com"===n?"all new Google Docs":`all new documents on ${n}`;return Se.createElement(je.k,{direction:"column",gap:1,padding:2,className:on.section},Se.createElement(Kt.r,{label:"Start automatically",size:1,defaultSelected:t,onChange:t=>e(t?{kind:"enableForDomain",isNewDocument:"newDocument"===r}:{kind:"resetForDomain"})(),"aria-describedby":"hwr-toggle-description"}),Se.createElement(Ve.x,{as:"p",variant:"text-xsmall",color:"base-subdued",id:"hwr-toggle-description"},"Track writing activity for ",a,"."))})))),Se.createElement(je.k,{direction:"column",gap:1,className:on.section},Se.createElement(Ue.F.Fragment,null,n("urls").pipe(i.U((e=>Se.createElement(Se.Fragment,null,Se.createElement("a",{href:e.howItWorks,className:on.menuLink,role:"menuitem"},Se.createElement(Ve.x,{as:"span",variant:"text-small"},"How Authorship works?")),Se.createElement("a",{href:e.reportAnIssue,className:on.menuLink,role:"menuitem"},Se.createElement(Ve.x,{as:"span",variant:"text-small"},"Report an issue"))))))),Se.createElement("button",{onClick:()=>{e({kind:"giveFeedback"})(),a(!1)},className:on.menuButton,role:"menuitem"},Se.createElement(Ve.x,{as:"span",variant:"text-small"},"Give feedback"))),Se.createElement("button",{onClick:e({kind:"optOut"}),className:on.menuButton,role:"menuitem"},Se.createElement(Ve.x,{as:"span",variant:"text-small"},"Turn off Authorship")))))))})),dn=Be.UI.Union.make("state",{compact:Ht,expanded:ln}),un=Be.UI.Union.asOption(dn),hn=Be.UI.Grid.make((({slots:e,view:t})=>Se.createElement(Ue.F.div,{"data-grammarly-part":"human-writing-report-button",style:{position:"fixed",left:t("offsetLeft"),bottom:t("offsetBottom"),zIndex:1e4}},e.popup,e.trackingButton,Se.createElement("div",{style:{position:"absolute",left:"100%",bottom:0}},e.toast)))),mn=Be.UI.Knot.make(hn,{trackingButton:un,popup:ft,toast:Bt}),pn=Be.UI.Union.asOption(mn);function gn(e){return Be.Z.fromSideEffect((t=>{e.next(t)}),T.of(null))}function fn(e){return Be.Z.fromSideEffect((t=>{e.next(t)}),T.of(null))}function kn(e,t){return Be.Z.fromSideEffect((e=>{t.next({kind:e.kind})}),e.pipe(Ee.oA,i.U((({urls:e})=>({howItWorksURL:e.howItWorks,learnMoreTransparencyURL:e.learnMoreTransparency,learnMoreSafetyURL:e.learnMoreSafety,learnMoreControlURL:e.learnMoreControl})))))}function bn(e,t){return Be.Z.composeUnion({optIn:kn(e,t),clipboardAccess:gn(t),feedback:fn(t)},(()=>e.pipe(Ee.oA,Ie.j("popup"),Ee.oA,i.U((e=>({kind:e}))))))}function _n(e,t){return Be.Z.composeUnion({None:()=>T.of(null),Some:Be.Z.composeKnot({value:bn(e,t)})},(()=>e.pipe(Ee.oA,Ie.j("popup"))))}function vn(e,t){return Be.Z.composeUnion({documentTrackingStarted:Be.Z.fromSideEffect((e=>{t.next({...e})}),T.of(null)),domainTrackingStarted:Be.Z.fromSideEffect((e=>{t.next({...e})}),e.pipe(Ee.oA,i.U((({domain:e})=>({domain:e,wasNewDocument:!0}))))),domainTrackingStartedWhenAlreadyTracked:Be.Z.fromSideEffect((e=>{t.next({...e})}),e.pipe(Ee.oA,i.U((({domain:e})=>({domain:e,wasNewDocument:!1}))))),optedOut:Be.Z.fromSideEffect((e=>{t.next({...e})}),T.of(null)),optedIn:Be.Z.fromSideEffect((e=>{t.next({...e})}),T.of(null)),reportGenerationFailed:Be.Z.fromSideEffect((e=>{t.next({...e})}),T.of(null)),clipboardWarning:Be.Z.fromSideEffect((e=>{t.next({...e})}),T.of(null)),storageDatabaseCorrupted:Be.Z.fromSideEffect((e=>{t.next({...e})}),T.of(null)),storageUnrecoverableError:Be.Z.fromSideEffect((e=>{t.next({...e})}),T.of(null)),storageServerError:Be.Z.fromSideEffect((e=>{t.next({...e})}),T.of(null))},(()=>e.pipe(Ee.oA,Ie.j("toast"),Ee.oA,i.U((e=>({kind:e}))))))}function yn(e,t){return Be.Z.composeUnion({None:()=>T.of(null),Some:Be.Z.composeKnot({value:vn(e,t)})},(()=>e.pipe(Ee.oA,Ie.j("toast"))))}function wn(e,t){return Be.Z.fromSideEffect((e=>{if("trackingButtonClick"===e.kind)t.next({kind:"trackingButtonClick"});else(0,m.L0)(e.kind)}),e.pipe(Ee.oA))}function Cn(e,t){return Be.Z.fromSideEffect((e=>{switch(e.kind){case"trackingButtonClickAway":case"trackingButtonCloseClick":case"viewReport":case"optOut":case"start":case"pause":case"resume":case"enableForDomain":case"resetForDomain":case"giveFeedback":t.next(e);break;default:(0,m.L0)(e)}}),e.pipe(Ee.oA))}function Sn(e,t){return Be.Z.composeUnion({compact:wn(e,t),expanded:Cn(e,t)},(()=>e.pipe(Ee.oA,i.U((({trackingButtonExpanded:e})=>({state:e?"expanded":"compact"}))))))}class xn{constructor(e,t,n,r,o,i,s=Ge){this.actions=t,this.errors=n,this._events=r,this._documentId=o,this._gnar=i,this._createTButtonPositionSource=s,this._state=p.h.create(h.YP),this._tButtonPosition=p.h.create(Pe),this.state=this._state.view(),this.tButtonPosition=this._tButtonPosition.view(),this._subs=new a.w,this._domain=e.view("page").view("domain").get(),this._subs.add(this._handleCSStateChange(e).subscribe()),this._subs.add(this._handleActions().subscribe()),this._subs.add(this._handleErrors().subscribe()),this._subs.add(this._handleEvents().subscribe()),this._subs.add(this._handleEnabledForDomainOnce().subscribe()),this._subs.add(this._autocloseToast().subscribe()),this._subs.add(this._handleToastShow().subscribe()),this._subs.add(s().subscribe(xe.wW(this._tButtonPosition)))}_handleCSStateChange(e){return e.pipe(i.U((e=>{this._state.modify((t=>{var n;const a=null!==(n=e.page.humanWritingReport)&&void 0!==n?n:f.wg;return e.page.enabled&&("optedOut"===a.kind||"available"===a.kind||"enabled"===a.kind)?(0,r.zG)(t,h.UI((t=>this._reducePageStateToLocalState(e,t))),h.wp((()=>h.G(this._reducePageStateToLocalState(e))))):h.YP}))})))}_reducePageStateToLocalState({page:{domain:e,humanWritingReport:t=f.wg},dynamicConfig:n},r){var a;return{trackingState:"optedOut"===t.kind?"optedOut":"available"===t.kind?"available":(0,f.MP)(this._documentId,this._domain,t)?(0,f.Ng)(this._documentId,this._domain,t)?"tracking":"paused":"newDocument",optInPopupWasClosedOnce:"available"!==t.kind||t.optInPopUpWasClosedAtLeastOnce,trackingButtonExpanded:!!r&&r.trackingButtonExpanded,enabledForDomain:(0,f.E3)(this._domain,t),domain:e,popup:r?r.popup:h.YP,toast:r?r.toast:h.YP,urls:{...me.ym,...null===(a=null==n?void 0:n.hwr)||void 0===a?void 0:a.urls}}}_handleEnabledForDomainOnce(){return this.actions.pipe(c.h((e=>"enableForDomain"===e.kind)),d.q(1),s.b((({isNewDocument:e})=>this._state.modify((t=>(0,r.zG)(t,h.tS((t=>{const n={...t,toast:h.G(e?"domainTrackingStarted":"domainTrackingStartedWhenAlreadyTracked")};return h.G(n)}))))))))}_handleToastShow(){return this._state.pipe(Ee.oA,Ie.j("toast"),Ee.oA,s.b((e=>{switch(e){case"documentTrackingStarted":case"domainTrackingStarted":case"domainTrackingStartedWhenAlreadyTracked":case"optedOut":case"optedIn":case"clipboardWarning":this._gnar.hwrToastShow(this._documentId,"info",e);break;case"storageDatabaseCorrupted":case"reportGenerationFailed":case"storageUnrecoverableError":case"storageServerError":this._gnar.hwrToastShow(this._documentId,"error",e)}})))}_autocloseToast(){const e=this.actions.pipe(c.h((e=>"toastHover"===e.kind)),Ie.j("hovered"),B.O(!1));return this._state.pipe(Ee.oA,Ie.j("toast"),Ee.oA,l.w((t=>"clipboardWarning"===t?u.E:Te.S3(e.pipe(l.w((e=>e?u.E:Ae.timer(me.bd)))),this.actions.pipe(c.h((e=>"dismissToast"===e.kind)))))),s.b((()=>{this._state.modify((e=>(0,r.zG)(e,h.tS((e=>h.G({...e,toast:h.YP}))))))})))}_handleActions(){return this.actions.pipe(s.b((e=>{this._state.modify((t=>(0,r.zG)(t,h.tS((t=>{switch(e.kind){case"trackingButtonClick":return"available"===t.trackingState?(0,r.zG)(t.popup,h.hX((e=>"optIn"===e)),h.WG)?h.G({...t,popup:h.YP,optInPopupWasClosedOnce:!0}):(this._gnar.hwrOptInPopupShow(this._documentId),h.G({...t,popup:h.G("optIn")})):h.G({...t,trackingButtonExpanded:!0,toast:h.YP});case"trackingButtonClickAway":case"trackingButtonCloseClick":case"viewReport":return h.G({...t,trackingButtonExpanded:!1});case"pause":return h.G({...t,trackingState:"paused"});case"resume":case"start":return h.G({...t,trackingState:"tracking"});case"closeOptInPopup":return this._gnar.hwrOptInPopupClose(this._documentId),h.G({...t,trackingState:"newDocument",optInPopupWasClosedOnce:!0,trackingButtonExpanded:!1,popup:h.YP,toast:h.G("optedIn")});case"optOut":return h.G({...t,trackingState:"optedOut",optInPopupWasClosedOnce:!0,trackingButtonExpanded:!1,popup:h.YP,toast:h.G("optedOut")});case"optIn":return h.G({...t,trackingState:"newDocument",optInPopupWasClosedOnce:!0,trackingButtonExpanded:!0,popup:h.YP,toast:h.G("optedIn")});case"enableForDomain":return h.G({...t,trackingState:e.isNewDocument?"tracking":t.trackingState});case"resetForDomain":case"toastHover":return h.G(t);case"optOutToastOkClick":case"dismissToast":case"clipboardWarningResult":return h.G({...t,toast:h.YP});case"clipboardRequestResult":return"allow"===e.result?h.G({...t,popup:h.YP}):h.G({...t,popup:h.YP,toast:h.G("clipboardWarning")});case"giveFeedback":return this._gnar.hwrGiveFeedbackButtonClick(this._documentId,this._domain),h.G({...t,popup:h.G("feedback")});case"feedbackPopupClose":return h.G({...t,popup:h.YP});case"feedbackSubmit":return this._gnar.hwrFeedbackSubmit(this._documentId,this._domain,e.feedback),h.G(t);default:(0,m.L0)(e)}})))))})))}_handleErrors(){return this.errors.pipe(s.b((e=>{this._state.modify((t=>(0,r.zG)(t,h.tS((t=>{switch(e.kind){case"reportGenerationFailed":return h.G({...t,toast:h.G("reportGenerationFailed")});case"databaseCorrupted":return h.G({...t,toast:h.G("storageDatabaseCorrupted")});case"serverError":return h.G({...t,toast:h.G("storageServerError"),trackingState:"paused"});case"unrecoverableError":return h.G({...t,toast:h.G("storageUnrecoverableError"),trackingState:"paused"})}})))))})))}_handleEvents(){return this._events.pipe(c.h((e=>"clipboardAccessRequested"===e.kind)),s.b((e=>{this._state.modify((e=>(0,r.zG)(e,h.tS((e=>h.G({...e,popup:h.G("clipboardAccess"),toast:h.YP}))))))})))}view(){return Se.createElement(Le.w,null,Se.createElement(De.L,{chunkName:"humanWritingReport"},Be.UI.mount(pn,(e=this,Be.Z.composeUnion({None:()=>T.of(null),Some:Be.Z.composeKnot({value:Be.Z.composeKnot({root:()=>e.tButtonPosition,trackingButton:(t=e.state,n=e.actions,Be.Z.composeUnion({None:()=>T.of(null),Some:Be.Z.composeKnot({value:Sn(t,n)})},(()=>t.pipe(Ee.cp((({trackingState:e})=>"optedOut"===e?T.of(h.YP):T.of(h.G(e)))))))),popup:_n(e.state,e.actions),toast:yn(e.state,e.actions)})})},(()=>e.state))))));var e,t,n}dispose(){this._subs.unsubscribe()}}var En=n(1124);const In=()=>u.E,Tn=()=>{const e=(0,En.CI)(document);return e?C.R(e,"keydown"):u.E};class An{constructor(e){this._deps=e,this._subscriptions=new a.w,this._disposables=p.h.create([]),this._listener=p.h.create(h.YP),this._ui=p.h.create(h.YP),this._checkPermissions=new o.xQ,this.isActive=this._listener.view((e=>h.pC(e))),this._domain=e.CSState.view("page").view("domain").get(),this._subscriptions.add(this._handleCheckPermissions(this._checkPermissions).subscribe()),this._subscriptions.add(this._handleStateChanges(e.CSState).subscribe()),this._subscriptions.add(this._handleUIActions(this._deps.uiActions).subscribe()),this._subscriptions.add(this._handleFeatureEvents(this._deps.events).subscribe()),this._subscriptions.add(this._logStartedTracking(this._deps.uiActions,this._deps.events).subscribe()),this._subscriptions.add(this._handleErrors(this._deps.errors).subscribe())}_handleStateChanges(e){return e.view("page").view((({enabled:e,humanWritingReport:t})=>({enabled:e,humanWritingReport:t}))).pipe(i.U((({enabled:e,humanWritingReport:t})=>{if(e)if(t)switch(t.kind){case"available":case"optedOut":this._checkInitUI("optedOut"===t.kind),this._disposeListener();break;case"enabled":this._checkInitUI(),this._checkInitListener(),(0,f.Ng)(this._deps.documentId,this._domain,t)?(this._checkPermissions.next(),this._startTracking()):this._stopTracking();break;case"disabled":this._disposeListener(),this._disposeUI();break;default:(0,m.L0)(t)}else this._deps.csToBgActions.hwrSetInitial(this._deps.onForNewUsers);else this._disposeUI(),this._disposeListener()})))}_handleUIActions(e){return e.pipe(i.U((e=>{switch(e.kind){case"trackingButtonClick":this._deps.gnar.hwrButtonClick(this._deps.documentId);break;case"closeOptInPopup":this._deps.csToBgActions.hwrSetEnabled(!0);break;case"start":case"resume":this._deps.csToBgActions.hwrStartTracking({documentId:this._deps.documentId,domain:this._domain});break;case"enableForDomain":this._deps.gnar.hwrTrackingEnableForDomain(this._deps.documentId,this._domain),this._deps.csToBgActions.hwrStartTrackingDomain({documentId:this._deps.documentId,domain:this._domain});break;case"resetForDomain":this._deps.csToBgActions.hwrStopTrackingDomain({documentId:this._deps.documentId,domain:this._domain});break;case"pause":this._deps.gnar.hwrTrackingPause(this._deps.documentId),this._deps.csToBgActions.hwrStopTracking({documentId:this._deps.documentId,domain:this._domain});break;case"optOut":this._deps.gnar.hwrFeatureOptOut(this._deps.documentId),this._deps.csToBgActions.hwrOptOut();break;case"optIn":this._deps.gnar.hwrFeatureOptIn(this._deps.documentId),this._deps.csToBgActions.hwrOptIn();break;case"viewReport":this._deps.gnar.hwrReportButtonClick(this._deps.documentId),this._viewReport()}})))}_handleErrors(e){return e.pipe(s.b((e=>{switch(e.kind){case"serverError":case"unrecoverableError":this._deps.csToBgActions.hwrStopTracking({documentId:this._deps.documentId,domain:this._domain})}})))}_logStartedTracking(e,t){return e.pipe(c.h((({kind:e})=>"start"===e||"resume"===e)),i.U((({kind:e})=>"resume"===e)),l.w((e=>t.pipe(c.h((({kind:e})=>"knownStateMismatch"===e||"knownStateMatch"===e)),i.U((t=>({event:t,isResume:e})))))),d.q(1),s.b((({event:e,isResume:t})=>{"knownStateMismatch"===e.kind?this._deps.gnar.hwrTrackingStart(this._deps.documentId,t,e.lengthDifference):this._deps.gnar.hwrTrackingStart(this._deps.documentId,t,0)})))}_handleFeatureEvents(e){return e.pipe(s.b((e=>{switch(e.kind){case"sourcedTextAdded":this._deps.gnar.hwrKnownSourcePaste(this._deps.documentId,e.sourceDomain,e.textLength,e.promptDetected);break;case"unknownSourceTextAdded":this._deps.gnar.hwrUnknownSourcePaste(this._deps.documentId,e.textLength);break;case"sourceAdded":this._deps.gnar.hwrKnownSourceDetect(e.sourceDomain,e.textLength,!1)}})))}_checkInitUI(e=!1){this._ui.modify((t=>(0,r.zG)(t,h.wp((()=>{const t=new xn(this._deps.CSState,this._deps.uiActions,this._deps.errors,this._deps.events,this._deps.documentId,this._deps.gnar,this._getTButtonPositionSource()),n=_.V.get({monitorAs:"human-writing-report"}).inject(v.EM.fromDocument(self.document,"grammarly-human-writing-report"),v.zs.appendChild(self.document.documentElement),y.G7.showWhenLoaded(t.view()));return!e&&this._deps.gnar.hwrButtonShow(this._deps.documentId),h.G({viewModel:t,dispose:()=>{n.dispose(),t.dispose()}})})))))}_getTButtonPositionSource(){return(0,k.Lu)()?Fe:Ge}_getKeyboardEventsSource(){return(0,k.Lu)()?Tn:In}_startTracking(){(0,r.zG)(this._listener.get(),h.UI((e=>{e.startTracking()})))}_stopTracking(){(0,r.zG)(this._listener.get(),h.UI((e=>{e.stopTracking()})))}_checkInitListener(){this._listener.modify((e=>(0,r.zG)(e,h.wp((()=>h.G(new Ce(this._deps.documentId,this._deps.alertsState,this._deps.textObserver,this._deps.selectionSource,this._deps.CSState,this._deps.replacementListener,this._deps.events,this._deps.encryptionClient,this._deps.errors,this._getKeyboardEventsSource()())))))))}_handleCheckPermissions(e){return e.pipe(l.w((()=>(0,b.OB)().bgRpc.api.isPermissionGranted(g.d.clipboardRead))),c.h((e=>!e)),i.U((()=>{const e=this._deps.CSState.view("page","humanWritingReport").get();return"enabled"===(null==e?void 0:e.kind)&&void 0===(null==e?void 0:e.deniedClipboardAccessSince)})),c.h(Boolean),s.b((()=>{this._deps.events.next({kind:"clipboardAccessRequested"})})),l.w((()=>this._deps.uiActions.pipe(c.h((e=>"clipboardRequestResult"===e.kind&&"allow"===e.result||"clipboardWarningResult"===e.kind)),i.U((e=>"allow"===e.result)),d.q(1)))),l.w((e=>e?(this._deps.gnar.hwrClipboardPermissionRequest(this._deps.documentId),(0,b.OB)().bgRpc.api.requestGrantPermission(g.d.clipboardRead)):(this._deps.gnar.hwrClipboardPermissionDeny(this._deps.documentId),this._deps.csToBgActions.hwrDenyClipboardAccess(),u.E))),s.b((e=>{e?this._deps.gnar.hwrClipboardPermissionAllow(this._deps.documentId):(this._deps.gnar.hwrClipboardPermissionDeny(this._deps.documentId),this._deps.csToBgActions.hwrDenyClipboardAccess())})))}_viewReport(){(0,r.zG)(this._listener.get(),h.UI((e=>{e.getReportableDocument().then((e=>this._deps.backendClient.generateReport(e).then((e=>{self.open(e,"_blank")})))).catch((()=>{this._deps.errors.next({kind:"reportGenerationFailed"})}))})))}_disposeUI(){this._ui.modify((e=>(0,r.zG)(e,h.tS((e=>(e.dispose(),h.YP))))))}_disposeListener(){this._listener.modify((e=>(0,r.zG)(e,h.tS((e=>(e.dispose(),h.YP))))))}dispose(){this._subscriptions.unsubscribe(),this._disposeUI(),this._disposeListener()}}},7147:(e,t,n)=>{if(n.r(t),n.d(t,{CopyContentListener:()=>N}),1388==n.j)var r=n(82823);if(1388==n.j)var a=n(8748);if(1388==n.j)var o=n(65882);if(1388==n.j)var i=n(64965);if(1388==n.j)var s=n(78488);if(1388==n.j)var c=n(65647);if(1388==n.j)var l=n(14765);if(1388==n.j)var d=n(60841);if(1388==n.j)var u=n(14275);if(1388==n.j)var h=n(55446);if(1388==n.j)var m=n(78084);if(1388==n.j)var p=n(22889);if(1388==n.j)var g=n(13195);if(1388==n.j)var f=n(97697);if(1388==n.j)var k=n(44424);if(1388==n.j)var b=n(20715);if(1388==n.j)var _=n(83780);if(1388==n.j)var v=n(64218);if(1388==n.j)var y=n(74857);if(1388==n.j)var w=n(27628);if(1388==n.j)var C=n(90049);if(1388==n.j)var S=n(70989);if(1388==n.j)var x=n(25770);if(1388==n.j)var E=n(52341);if(1388==n.j)var I=n(72257);if(1388==n.j)var T=n(70932);if(1388==n.j)var A=n(14583);if(1388==n.j)var B=n(97991);if(1388==n.j)var L=n(37636);if(1388==n.j)var D=n(71351);if(1388==n.j)var M=n(80646);function R(e){return e.length>25?`${e.slice(0,25)}...`:e}class N{constructor(e,t,n){this._env=e,this._featureState=t,this._gnar=n,this._log=T.Y.create("CopyContentListener"),this._subs=new r.w,this._clipboardText=x.h.create(""),this._genAIMatcher=(0,M.O7)(),null==e.browserApi?(this._trackingEnabled=a.E,this._log.debug("CopyContentListener cannot be initialized, browserApi is not available")):(this._store=(0,D.T)((0,A.D)(e.browserApi.preferences)),this._trackingEnabled=o.aj(i.R(document,"visibilitychange").pipe(s.b((()=>{this._log.debug("visibilitychange",document.hidden?"hidden":"visible")})),c.U((()=>!document.hidden)),l.O(!document.hidden)),t).pipe(c.U((([e,t])=>e&&(0,I.sZ)(t))),d.w((e=>e?this._env.bgRpc.api.isPermissionGranted(E.d.clipboardRead):Promise.resolve(!1))),u.shareReplay({bufferSize:1,refCount:!0})),this._subs.add(this._trackingEnabled.subscribe((e=>{this._log.debug(`Tracking enabled: ${e}`)}))),this._subs.add(this._setupTrackingBecameEnabledHandler()),this._subs.add(this._clipboardText.pipe(h.h((e=>e.length>0))).subscribe((e=>this._onClipboardChange(e)))),this._log.debug("CopyContentListener initialized"))}_readClipboard(){return m.P((()=>navigator.clipboard.readText())).pipe(p.a((e=>e.pipe(g.b(((e,t)=>(0===t&&this._log.debug("Error getting text, will retry",e.message),f.s((()=>t>0),k._(e),b.of(e).pipe(_.g(50))))))))),v.K((e=>(this._log.debug("Error getting text, after one retry, give up for now",e.message),a.E))))}_setupTrackingBecameEnabledHandler(){return this._trackingEnabled.pipe(h.h(Boolean),y.b(0),d.w((()=>this._readClipboard().pipe(s.b((e=>{this._log.debug("Window focused and tracking enabled. Saving Clipboard text:",R(e)),this._clipboardText.set(e)}))))),w.c(this._userActionHandler())).subscribe()}_userActionHandler(){const e={capture:!0,once:!1,passive:!0};return C.T(i.R(self,"mouseup",e),i.R(self,"keyup",e),i.R(self,"copy",e)).pipe(y.b(300),S.M(this._trackingEnabled),h.h((([e,t])=>t)),d.w((()=>this._readClipboard())),s.b((e=>{this._log.debug("User action happened. Saving Clipboard text:",R(e)),this._clipboardText.set(e)})))}_onClipboardChange(e){const t=this._genAIMatcher.getPromptForText(e);t&&this._log.debug("Found genAI prompt for text:",t);this._store.get().then((n=>{const r=n.copiedTextMessage;if(null==r||!(null==r?void 0:r.valid)||(null==r?void 0:r.valid)&&r.copiedText!=e){const n=new L.m;this._log.debug("New clipboard text:",R(e)),this._gnar.hwrKnownSourceDetect(self.location.origin,e.length,Boolean(t)),this._store.set(B.v.make(n.url,n.title,e,t||void 0))}}))}dispose(){this._subs.unsubscribe(),this._genAIMatcher.dispose()}}},37636:(e,t,n)=>{n.d(t,{m:()=>a});var r=n(55231);class a{constructor(){this.location=self.location,this._title=document.title}get url(){return this.location.href}get title(){return this._title}isGoogleDocs(){return"docs.google.com"==this.location.hostname}get documentID(){return this.isGoogleDocs()?(0,r.j)(this.location.href):null}}},80646:(e,t,n)=>{if(n.d(t,{O7:()=>h}),1388==n.j)var r=n(82823);if(1388==n.j)var a=n(36072);if(1388==n.j)var o=n(65647);if(1388==n.j)var i=n(55446);if(1388==n.j)var s=n(25770);if(1388==n.j)var c=n(7849);if(1388==n.j)var l=n(91795);class d{getPromptForText(){return null}dispose(){}}class u{constructor(e,t){this._promptsSelector=e,this._responsesSelector=t,this._pairs=new Map,this._subs=new r.w,this._prompts=new a.xQ,this._pairsOutdated=s.h.create(!0),this._subs.add(this._setupMutationObserver().subscribe((()=>{this._pairsOutdated.set(!0)})))}_searchForPairs(){const e=Array.from(document.querySelectorAll(this._promptsSelector));if(e){const t=Array.from(document.querySelectorAll(this._responsesSelector));t&&t.length===e.length&&e.forEach(((e,n)=>{var r,a;const o=(null===(r=e.textContent)||void 0===r?void 0:r.trim())||null;if(o){const e=(null===(a=t[n].textContent)||void 0===a?void 0:a.trim())||null;e&&this._pairs.set((0,c.Ue)(e),{prompt:o,response:e})}}))}this._pairsOutdated.set(!1)}_setupMutationObserver(){return l.x.create(document,{attributes:!1,subtree:!0,childList:!0}).pipe((0,o.U)((e=>e.filter((e=>e.addedNodes.length>0)).some((e=>Array.from(e.addedNodes).filter((e=>e instanceof HTMLElement)).some((e=>e.matches(this._responsesSelector)||e.querySelector(this._responsesSelector))))))),(0,i.h)(Boolean))}getPromptForText(e){var t;return this._pairsOutdated.get()&&this._searchForPairs(),(null===(t=this._pairs.get((0,c.Ue)(e)))||void 0===t?void 0:t.prompt)||null}dispose(){this._subs.unsubscribe()}}function h(){const e=self.location.hostname;return"chat.openai.com"===e||"chatgpt.com"===e?new u('div[data-message-author-role="user"]','div[data-message-author-role="assistant"]'):"gemini.google.com"===e?new u("div.query-content","div.response-content"):/claude.ai\/chat\//.test(location.href)?new u("div.font-user-message","div.font-claude-message"):/^(www\.)?perplexity\.ai$/.test(location.hostname)?new u(".whitespace-pre-line.break-words","div.prose"):new d}},72257:(e,t,n)=>{n.d(t,{E3:()=>s,MP:()=>o,Ng:()=>a,sZ:()=>i,wg:()=>r});const r={kind:"available",optInPopUpWasClosedAtLeastOnce:!1};function a(e,t,n){if("enabled"===n.kind){const r=n.domainSettings.find((({domain:e})=>e===t));return!!r&&(r.logAllDocuments?!r.pausedDocumentIds.includes(e):r.activeDocumentIds.includes(e))}return!1}function o(e,t,n){var r;if("enabled"===n.kind){const a=n.domainSettings.find((({domain:e})=>e===t));return!!a&&(!!a.logAllDocuments||((null===(r=a.pausedDocumentIds)||void 0===r?void 0:r.includes(e))||a.activeDocumentIds.includes(e)))}return!1}function i(e){return"enabled"===(null==e?void 0:e.kind)&&e.domainSettings.some((e=>e.logAllDocuments?e.logAllDocuments:e.activeDocumentIds.length>0))}function s(e,t){var n,r;return"enabled"===t.kind&&Boolean(null===(r=null===(n=t.domainSettings)||void 0===n?void 0:n.find((({domain:t})=>t===e)))||void 0===r?void 0:r.logAllDocuments)}},7849:(e,t,n)=>{n.d(t,{CZ:()=>l,Hq:()=>o,QY:()=>r,Ue:()=>d,Xw:()=>u,aS:()=>c});var r,a,o,i=n(48246),s=n(21768);function c(e,t){if(e.length<=t)return e;if(t<=3)return"...";const n=Math.ceil((t-3)/2),r=Math.floor((t-3)/2);return`${e.substring(0,n)}...${e.substring(e.length-r,e.length)}`}function l(e){const t=e.match(/`{3,}[^`]*`{3,}/g);return null==t?e:t.reduce(((e,t)=>e.replace(t,"")),e)}function d(e){return e.replace(/[.,/#!$%^&*;:{}=\-_`~()\s]/g,"").toLowerCase()}function u(e){var t;return(null===(t=/^(hwr:\/\/.+$|https?:\/\/[^/]+)/.exec(e))||void 0===t?void 0:t[1])||"Undetermined"}!function(e){e.getNumInsertedLetters=function(e){return e.ops.reduce(((e,t)=>i.s.isInsertString(t)?e+i.s.getInsertLength(t):e),0)},e.getNumDeletedLetters=function(e){const t=e.ops.filter((e=>i.s.isDelete(e)));let n=0;return t.forEach((e=>{i.s.isDelete(e)&&(n+=e.delete)})),n},e.extractMaximalReplacementString=function(e,t){return t.ops.reduce(((t,n)=>(i.s.isInsertString(n)?t.text=`${t.text}${n.insert}`:i.s.isDelete(n)?t.originalTextPointer+=n.delete:i.s.isRetain(n)&&(t.text.length&&(t.text=`${t.text}${e.substring(t.originalTextPointer,t.originalTextPointer+n.retain)}`),t.originalTextPointer+=n.retain),t)),{text:"",originalTextPointer:0}).text||null},e.singleDelta=function(e,t){if(e===t)return new s.i([]);let n=0;const r=Math.min(e.length,t.length);for(;n<r&&e[n]===t[n];)n++;let a=0;for(;n+a<r&&t[t.length-a-1]===e[e.length-a-1];)a++;const o=e.length-(n+a),i=t.length-(n+a),c=[...n>0?[{retain:n}]:[],{delete:o},{insert:t.substring(n,n+i)}];return new s.i(c)},e.isNoTextChangesDelta=function(e){return e.ops.every((e=>i.s.isInsertString(e)?!e.insert.length:!i.s.isDelete(e)||!e.delete))}}(r||(r={})),function(e){e.isTextEqual=function(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;++n)if(e[n].char!=t[n].char)return!1;return!0},e.isContentEqual=function(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;++n)if(e[n].char!=t[n].char||e[n].sourceContentId!=t[n].sourceContentId||e[n].isSelfAuthored!=t[n].isSelfAuthored)return!1;return!0}}(a||(a={})),function(e){e.hasPerLetterTags=function(e){return e.isSelfAuthoredTags.length==e.text.length},e.toLoggableString=function(e){const t=c(e.text,40);return`CopiedContent [text length=${e.text.length}, has per letter tags=$hasPerLetterTags({sourcedContent)}, text=${t}]`},e.eq=function(e,t){if(e.length!==t.length)return!1;const n=e.slice().sort(((e,t)=>e.text.localeCompare(t.text)||e.sourceName.localeCompare(t.sourceName))),r=t.slice().sort(((e,t)=>e.text.localeCompare(t.text)||e.sourceName.localeCompare(t.sourceName)));return n.every(((e,t)=>e.text===r[t].text&&e.sourceName===r[t].sourceName))}}(o||(o={}))},91901:(e,t,n)=>{n.d(t,{$x:()=>i,F8:()=>p,Go:()=>a,Kt:()=>y,Lq:()=>l,QR:()=>I,Qy:()=>k,Vk:()=>w,Wp:()=>r,XG:()=>o,_m:()=>h,d0:()=>d,f:()=>c,gH:()=>f,gL:()=>C,gv:()=>g,ij:()=>E,j5:()=>v,jW:()=>m,lO:()=>x,os:()=>_,rx:()=>S,uj:()=>u,y1:()=>s,yw:()=>b});const r=".kix-appview-editor",a=".docos-input",o=".docs-texteventtarget-iframe",i=".kix-cursor",s=".kix-cursor-caret",c="#docs-revisions-sidebar",l='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',d="#docs-toolbar-mode-switcher",u="edit-mode",h="suggest-mode",m="#titlebar-mode-indicator-container .titlebar-request-access-button",p="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",g=".kix-canvas-tile-content",f="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",k=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",b=".kix-page-paginated",_=".kix-page-paginated.canvas-first-page",v=".docs-horizontal-ruler",y=".docs-vertical-ruler",w="#fontSizeSelect input",C=".docs-ruler-background",S=".docs-ruler-background-inner",x=".docs-ruler-indent-first-line",E=".modal-dialog.docs-dialog .fatal-error-message",I='#docs-titlebar-share-client-button div[role="button"]'},55231:(e,t,n)=>{n.d(t,{j:()=>a});var r=n(67458);function a(e){const t=e.match(/d\/(.*?)\//);return t?r.createHash("superfasthash").hash(t[1]):null}},44637:(e,t,n)=>{n.d(t,{J:()=>d});var r=n(90023),a=n(49231),o=n(42593),i=n(54350),s=n(78488),c=n(99627),l=n(14482);const d=({onChange:e,labelId:t,className:n,checkboxClassName:d,labelClassName:u,checked:h,children:m,disabled:p,useDS:g,dataGrammarlyPart:f="ui-kit-checkbox",tabIndex:k=0,onMount:b=r.Q1})=>{const[_,v]=a.useState(null!=h&&h);a.useEffect((()=>{v(Boolean(h))}),[h]);const y=t=>{t.preventDefault(),t.stopPropagation(),v(!_),null==e||e(!_)},{ref:w,onMount:C}=o.P.useElWatcher();return a.useEffect((()=>{const e=w.pipe(i.oA,s.b(b)).subscribe();return()=>e.unsubscribe()}),[]),a.createElement("div",{"data-grammarly-part":f,...(0,c.Sh)(l.checkboxContainer,n)},a.createElement("div",{...(0,c.Sh)(l.checkbox,d,_?l.checkboxChecked:null,g?l.checkboxDS:null),role:"checkbox","aria-checked":_,tabIndex:k,"aria-labelledby":t,onKeyDown:e=>{" "===e.key&&y(e)},onClick:p?r.Q1:y,ref:C},_?a.createElement("div",{className:l.checkboxCheckmark}):null),a.createElement("label",{id:t,onClick:y,className:u},m))}},96130:(e,t,n)=>{n.d(t,{E:()=>i});var r=n(49231),a=n(99627),o=n(17345);const i=({options:e,onChange:t=(()=>null),ariaLabel:n,className:i})=>{const s=[],[c,l]=r.useState(null);r.useEffect((()=>{var n;null!==c&&(null===(n=s[c])||void 0===n||n.focus()),t(null!==c?e[c].value:null)}),[c]);const d=null!==c?e[c]:null;return r.createElement("div",{"data-grammarly-part":"ui-kit-radio-group",className:i},r.createElement("div",{className:o.radioGroup,role:"radiogroup","aria-label":n,onKeyDown:t=>{if(" "!==t.key||d){if("ArrowRight"===t.key||"ArrowDown"===t.key){t.preventDefault(),t.stopPropagation();l(((c||0)+1)%e.length)}else if("ArrowLeft"===t.key||"ArrowUp"===t.key){t.preventDefault(),t.stopPropagation();const n=(c||0)-1;l(n<0?e.length-1:n)}}else t.preventDefault(),t.stopPropagation(),l(0)}},e.map(((e,t)=>{const n=(null==d?void 0:d.value)===e.value,i=0===t;return r.createElement("div",{key:e.value,...(0,a.Sh)(o.radioGroupOption,n?o.radioGroupOptionSelected:null),role:"radio",tabIndex:n||i&&!d?0:-1,"aria-checked":n,onClick:e=>{e.preventDefault(),e.stopPropagation(),l(t)},ref:e=>s.push(e)},e.render())}))))}},21136:(e,t,n)=>{n.d(t,{z:()=>h});var r=n(49231),a=n(64151);const o=({children:e,style:t,dataGrammarlyPart:n="ui-kit-iframe",...o})=>{const[i,s]=r.useState(null),c=r.useCallback((e=>{var t,n;let r=null;"contentDocument"in e.target&&(r=null!==(n=null===(t=e.target.contentDocument)||void 0===t?void 0:t.body)&&void 0!==n?n:null),s(r),r&&(r.style.margin="0",r.style.height="100vh",r.style.overflowY="hidden")}),[]);return r.createElement("iframe",{...o,style:{border:"none",...t},onLoad:c,srcDoc:"<html><body></body></html>","data-grammarly-part":n},i&&(0,a.createPortal)(e,i))};var i=n(1208),s=n(70632),c=n.n(s),l=n(6986),d=n(4798);const u=({placeholder:e,ariaLabel:t,onChange:n})=>{const[a,o]=r.useState("");return r.useEffect((()=>{n(a)}),[a]),r.createElement(r.Fragment,null,r.createElement(i.b,null,c().__css),r.createElement("div",{role:"textbox",className:c().textBox,contentEditable:!0,onInput:e=>{o(e.target.innerText)},"data-placeholder":e,"aria-placeholder":e,"aria-label":t}))},h=({placeholder:e,onChange:t,ariaLabel:n,iframeTitle:a,className:i})=>(0,l.E)().experimentClient.isGateEnabled(d.K.CentralizeStopEventPropagation)?r.createElement("div",{className:i,style:{width:"100%",height:"128px",maxHeight:"inherit"}},r.createElement(u,{onChange:t,ariaLabel:n,placeholder:e})):r.createElement(o,{dataGrammarlyPart:"ui-kit-textbox",className:i,style:{width:"100%",height:"100%"},title:a},r.createElement(u,{onChange:t,ariaLabel:n,placeholder:e}))},78225:(e,t,n)=>{n.d(t,{V:()=>i});var r=n(49231),a=n(63039),o=n(29357);const i=e=>e.isEnabled?r.createElement(o.T,{type:"mini",size:26,className:a.feedbackFormLogoLine}):null},80882:(e,t,n)=>{n.d(t,{b:()=>C});var r=n(49231),a=n(99627),o=n(12990),i=n(63039);const s=({fixSubmitButtonOverflowBottomPadding:e,className:t,...n})=>r.createElement(r.Fragment,null,r.createElement(o.z,{...n,className:null!=t?t:i.feedbackFormSubmitButton},n.children),r.createElement(c,{isEnabled:e})),c=e=>e.isEnabled?r.createElement("div",{className:i.feedbackFormSubmitButtonFixOverflowBottomPadding},r.createElement("div",{className:i.feedbackFormSubmitButtonFixOverflowBottomPaddingChild})):null,l=e=>r.createElement("div",{"data-grammarly-part":"surveys-feedback-form-thank-you",...(0,a.Sh)(i.feedbackFormContainer,i.feedbackFormContainerAlignCenter)},r.createElement("div",{className:i.feedbackFormSuccessMessageTextContainer},r.createElement("div",{className:i.feedbackFormSuccessMessageIcon}),r.createElement("div",{className:i.feedbackFormSuccessMessageTitle},"Thank you!"),r.createElement("div",{className:i.feedbackFormSuccessMessageSubtitle},"Your feedback helps us improve.")),r.createElement(s,{type:"button",kind:"success",onClick:e.onClose},"Done"));var d=n(21136),u=n(79992),h=n(96130),m=n(29221),p=n(45321);const g=e=>{const t=[m.B.bad,m.B.ok,m.B.good];return e.isEnabled?r.createElement(r.Fragment,null,r.createElement(h.E,{ariaLabel:"Feedback Score",options:t.map((e=>({value:e,render:()=>r.createElement("div",{className:p.feedbackFormOption},r.createElement("div",{...(0,a.Sh)(p.feedbackFormOptionIcon,f(e))}),r.createElement("div",null,function(e){switch(e){case m.B.bad:return"I dislike it";case m.B.ok:return"It’s OK";case m.B.good:return"I like it";default:(0,u.vE)(e)}}(e)))}))),onChange:e.onChange,...(0,a.Sh)(i.feedbackFormScore,e.compactDisplay&&i.compact)}),!e.hideTextBoxTitle&&r.createElement("div",{className:i.feedbackFormTextBoxTitle},"Anything we can improve?")):null};function f(e){switch(e){case m.B.bad:return p.feedbackFormOptionIconDisheartening;case m.B.ok:return p.feedbackFormOptionIconNeutral;case m.B.good:return p.feedbackFormOptionIconSmiling;default:(0,u.vE)(e)}}var k=n(78225);const b=e=>{var t;if(!e.isEnabled)return null;const n=null!==(t=e.title)&&void 0!==t?t:r.createElement("span",null,"How do you like ",r.createElement("br",null)," Grammarly?");return r.createElement("h3",{...(0,a.Sh)(i.feedbackFormTitle,e.isCompact&&i.compact)},n)};var _=n(44637);const v=e=>e.domain?r.createElement(r.Fragment,null,e.withHelpText&&r.createElement("div",{className:i.feedbackFormShareDomainTitle},"Help improve Grammarly by sharing the domain you’re on:"),r.createElement(_.J,{labelId:"feedback-form-share-domain-checkbox",onChange:e.onChange,className:i.feedbackFormShareDomainCheckbox},"Include the domain ",r.createElement("b",null,e.domain)," with my feedback")):null,y=e=>{var t,n,o;const[c,l]=r.useState(null),[u,h]=r.useState(""),[m,p]=r.useState(!1);return r.createElement("form",{"data-grammarly-part":"surveys-feedback-form-fields",...(0,a.Sh)(i.feedbackFormContainer,"center"===e.align&&i.feedbackFormContainerAlignCenter)},r.createElement("div",{className:i.feedbackFormFields},r.createElement(k.V,{isEnabled:!e.hideLogo}),r.createElement(b,{isEnabled:!e.hideTitle,title:e.title,isCompact:null!==(t=e.compactDisplay)&&void 0!==t&&t}),r.createElement(g,{isEnabled:e.withScore,compactDisplay:e.compactDisplay,hideTextBoxTitle:e.hideTextBoxTitle,onChange:l}),r.createElement(d.z,{onChange:h,placeholder:null!==(n=e.placeholderText)&&void 0!==n?n:"Your thoughts here",ariaLabel:"Feedback Text",iframeTitle:"Feedback text field",...(0,a.Sh)(i.feedbackFormTextBox,e.compactDisplay&&i.compact)}),r.createElement(v,{domain:e.domain,withHelpText:!e.hideDomainHelpText,onChange:p})),r.createElement(s,{type:"submit",kind:null!==(o=e.submitButtonKind)&&void 0!==o?o:"success",disabled:e.withScore?!c:!u,fixSubmitButtonOverflowBottomPadding:e.fixSubmitButtonOverflowBottomPadding,onClick:t=>{t.preventDefault();const n=m?e.domain:void 0;e.withScore&&c?e.onSubmit({score:c,text:u,domain:n}):!e.withScore&&u&&e.onSubmit({text:u,domain:n})}},"Submit"))};var w=n(84602);const C=({hideLogo:e=!1,align:t="center",fixSubmitButtonOverflowBottomPadding:n=!1,showPostSubmitScreen:a=!0,...o})=>{const[i,s]=r.useState(!1),c=i&&a;return r.createElement("div",{style:o.style,"data-grammarly-part":"surveys-feedback-form",role:"region","aria-label":"Provide feedback","aria-live":"polite"},c?r.createElement(l,{fixSubmitButtonOverflowBottomPadding:n,onClose:o.onClose}):r.createElement(y,{...o,hideLogo:e,align:t,fixSubmitButtonOverflowBottomPadding:n,onSubmit:e=>{o.withScore?((0,w.n8)(e),o.onSubmit(e)):((0,w.TY)(e),o.onSubmit(e)),s(!0)}}))}},29221:(e,t,n)=>{var r;n.d(t,{B:()=>r}),function(e){e.bad="bad",e.ok="ok",e.good="good"}(r||(r={}))},84602:(e,t,n)=>{function r(e){return"score"in e}function a(e){if(!r(e))throw new Error("Received unexpected feedback form data without score")}function o(e){if(r(e))throw new Error("Received unexpected feedback form data with score")}n.d(t,{TY:()=>o,dK:()=>r,n8:()=>a})},14583:(e,t,n)=>{n.d(t,{D:()=>r});const r=e=>({getAll:async()=>await e.getAll(),get:async t=>await e.get(t),view:()=>{throw new Error("not_implemented")},patch:async t=>await e.set(t),changes:e.changes})},97991:(e,t,n)=>{var r;n.d(t,{v:()=>r}),function(e){e.make=function(e,t,n,r){return{valid:!0,copiedText:n,sourceURL:e,sourceName:t,userPrompt:r}}}(r||(r={}))},98544:(e,t,n)=>{var r=n(42663),a=n(2963)(r);a.push([e.id,"._z3YOv-textBox{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#0e101a;font-size:14px;line-height:21px;font-feature-settings:'ss03' on;background:#f9faff;border:1px solid #e7e9f5;box-sizing:border-box;border-radius:4px;padding:10px 8px;overflow-y:auto;cursor:text;width:100%;height:100%;}._z3YOv-textBox:empty:before{font-feature-settings:'ss03' on;font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#6d758d;font-size:14px;line-height:21px;content:attr(data-placeholder)}",""]),a.locals={textBox:"_z3YOv-textBox"},e.exports=a},27645:e=>{e.exports={accordionContent:"RZ1tY",shown:"Rodx_",accordionHeader:"zZM6o",accordionItem:"SVcPo",accordionRoot:"ieqWq",accordionTrigger:"lQxeR",linkIcon:"oS7tX",headerContainer:"iMmjP",accordionIcon:"jaZE7",rotate:"Rbcv_"}},14482:e=>{e.exports={checkboxContainer:"Te37e",checkbox:"mFHkX",checkboxDS:"DdH2q",checkboxChecked:"JhHnz",checkboxCheckmark:"zShXt",spin:"tww6q"}},17345:e=>{e.exports={radioGroup:"KAzfW",radioGroupOption:"WkjDU",radioGroupOptionSelected:"onilo"}},63039:e=>{e.exports={feedbackFormContainer:"kjElf",feedbackFormContainerAlignCenter:"hkEx2",feedbackFormFields:"Ua5wJ",feedbackFormTitle:"GnQ_a",feedbackFormTextBoxTitle:"kWEW0",feedbackFormLogoLine:"osGQI",compact:"b7yYp",feedbackFormScore:"ZOSRK",feedbackFormTextBox:"l8New",feedbackFormShareDomainTitle:"Qbnj_",feedbackFormShareDomainCheckbox:"VBCx1",feedbackFormSubmitButton:"tYYGU",feedbackFormSubmitButtonFixOverflowBottomPadding:"Opd8X",feedbackFormSubmitButtonFixOverflowBottomPaddingChild:"QKLT7",feedbackFormSuccessMessageTextContainer:"ARBzt",feedbackFormSuccessMessageIcon:"kJIzg",feedbackFormSuccessMessageTitle:"iXQnf",feedbackFormSuccessMessageSubtitle:"Ydufo",spin:"Vv6WG"}},45321:e=>{e.exports={feedbackFormOption:"sp8vS",feedbackFormOptionIcon:"eH6DL",feedbackFormOptionIconDisheartening:"DhaWh",feedbackFormOptionIconNeutral:"BS_8d",feedbackFormOptionIconSmiling:"dUZNd",spin:"uouSO"}}}]);