"use strict";(()=>{let e,t=browser,n=t.runtime,o=()=>{window!==top&&parent.focus(),window.closed||window.close(),e=null},a=t=>{let n=t=>{e?e.postMessage(t):s(t),setTimeout(o,0)},{t:a,s:i,d:r,r:s}=t,c=()=>{switch(a){case 1:case 9:let e=(9===a?new Promise((e,t)=>{let n=document.createElement("img");n.onload=()=>{let o=document.createElement("canvas"),a=o.width=n.naturalWidth,i=o.height=n.naturalHeight,r=o.getContext("2d");if(r)try{r.drawImage(n,0,0,a,i),o.toBlob(n=>n?e(n):t("Can not export from canvas"))}catch(e){t("Can not export tainted canvas")}else t("Can not create canvas")},n.onerror=()=>{t(0)},n.src=i.u}).catch(e=>r||(0!==e?window.fetch(i.u):Promise.reject("Can not load image"))):r?Promise.resolve(r):window.fetch(i.u)).then(e=>(i.u="",e instanceof Response?e.blob():e)).then(e=>new Promise(t=>{let n=new FileReader;n.onload=()=>{w=n.result,t()},n.readAsDataURL(e)}));return 9!==a&&(i.u=""),e}},l=()=>{let e;try{e=c()}catch(e){}e?e.then(()=>{n(w)},e=>{console.log("Vimium C: can not run task=%o:",a,e),n(false)}):n(false)},w=true;document.hasFocus()?l():(window.onfocus=l,window.focus())},i=false;{let e=t.extension.getBackgroundPage,n=e&&e();if(n&&n.onPagesReq){let e=n.onPagesReq({i:-3,q:[]});return void(e&&a(e))}}try{e=n.connect({name:"2176"}),e.onDisconnect.addListener(o)}catch(e){return void o()}e.onMessage.addListener(e=>{let t=e;49!==t.N||i?o():(i=true,a(t))})})();