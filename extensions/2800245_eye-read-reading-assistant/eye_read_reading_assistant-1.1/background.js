const r={default_enabled:!0,avg_word_length:{type:"range",min:1,max:20,step:1,value:10},avg_highlight_percent:{type:"range",min:0,max:100,step:1,value:45},min_chars:{type:"range",min:0,max:5,step:1,value:1},distance_falloff:{type:"range",min:-50,max:50,step:1,value:20},noise_level:{type:"range",min:1,max:4,step:1,value:2}};async function s(){try{var t=await browser.storage.local.get(["settings"]);return t.settings?(e=t.settings,function t(e,a){var n,r,s=e;for(const i in e)a.hasOwnProperty(i)&&(s[i]=(n=e[i],r=a[i],Array.isArray(n)?n:"object"==typeof n?n.type===r.type?"range"===n.type?(isNaN(r.value)||(n.value=Math.min(Math.max(r.value,n.min),n.max)),n):t(n,r):n:r));return s}(JSON.parse(JSON.stringify(r)),e)):r}catch(t){return r}var e}function i(t){e(t),async function(t){try{await browser.storage.local.set({settings:t})}catch(t){}}(t)}async function e(e){try{var a;for(a of await browser.windows.getAll()){let t=await browser.tabs.query({active:!0,windowId:a.id});0<t.length&&(async()=>{try{await browser.tabs.sendMessage(t[0].id,{settings:e})}catch(t){}})()}}catch(t){}}browser.runtime.onMessage.addListener(function(a,t,n){return a&&("getSettings"==a.method?(async()=>{var t=await s();try{n(t)}catch(t){}})():"updateSettings"==a.method?i(a.data):"resetSettings"==a.method&&(async()=>{var t,e=await s();for(t of a.data)e.hasOwnProperty(t)&&(e[t]=JSON.parse(JSON.stringify(r[t])));i(e);try{n(e)}catch(t){}})()),!0}),browser.tabs.onActivated.addListener(function(t){s().then(t=>{!async function(t){try{var e=await browser.tabs.query({active:!0,currentWindow:!0});if(0<e.length)try{await browser.tabs.sendMessage(e[0].id,{settings:t})}catch(t){}}catch(t){}}(t)})}),browser.commands.onCommand.addListener(t=>{"toggle-highlighting"===t&&s().then(t=>{t.default_enabled=!t.default_enabled,i(t)})}),s().then(t=>{e(t)});