(function(){"use strict";var qt,$t,Ht,Gt,Kt;const Wt="Disallowed",Ze="Disabled",Jt="Error",Vt="Ignored",Qt="Loading",Yt="Playing",Zt="Paused",Xt="Scrobbled",es="Unknown",X="Unsupported",ts="Loved",ss="Unloved";var Xe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function et(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var tt={exports:{}};(function(s,e){(function(t,a){a(s)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Xe,function(t){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const a="The message port closed before a response was received.",r=o=>{const d={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(d).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class p extends WeakMap{constructor(i,b=void 0){super(b),this.createItem=i}get(i){return this.has(i)||this.set(i,this.createItem(i)),super.get(i)}}const j=c=>c&&typeof c=="object"&&typeof c.then=="function",S=(c,i)=>(...b)=>{o.runtime.lastError?c.reject(new Error(o.runtime.lastError.message)):i.singleCallbackArg||b.length<=1&&i.singleCallbackArg!==!1?c.resolve(b[0]):c.resolve(b)},A=c=>c==1?"argument":"arguments",N=(c,i)=>function(w,...y){if(y.length<i.minArgs)throw new Error(`Expected at least ${i.minArgs} ${A(i.minArgs)} for ${c}(), got ${y.length}`);if(y.length>i.maxArgs)throw new Error(`Expected at most ${i.maxArgs} ${A(i.maxArgs)} for ${c}(), got ${y.length}`);return new Promise((k,m)=>{if(i.fallbackToNoCallback)try{w[c](...y,S({resolve:k,reject:m},i))}catch(l){console.warn(`${c} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,l),w[c](...y),i.fallbackToNoCallback=!1,i.noCallback=!0,k()}else i.noCallback?(w[c](...y),k()):w[c](...y,S({resolve:k,reject:m},i))})},q=(c,i,b)=>new Proxy(i,{apply(w,y,k){return b.call(y,c,...k)}});let B=Function.call.bind(Object.prototype.hasOwnProperty);const U=(c,i={},b={})=>{let w=Object.create(null),y={has(m,l){return l in c||l in w},get(m,l,g){if(l in w)return w[l];if(!(l in c))return;let u=c[l];if(typeof u=="function")if(typeof i[l]=="function")u=q(c,c[l],i[l]);else if(B(b,l)){let Z=N(l,b[l]);u=q(c,c[l],Z)}else u=u.bind(c);else if(typeof u=="object"&&u!==null&&(B(i,l)||B(b,l)))u=U(u,i[l],b[l]);else if(B(b,"*"))u=U(u,i[l],b["*"]);else return Object.defineProperty(w,l,{configurable:!0,enumerable:!0,get(){return c[l]},set(Z){c[l]=Z}}),u;return w[l]=u,u},set(m,l,g,u){return l in w?w[l]=g:c[l]=g,!0},defineProperty(m,l,g){return Reflect.defineProperty(w,l,g)},deleteProperty(m,l){return Reflect.deleteProperty(w,l)}},k=Object.create(c);return new Proxy(k,y)},_=c=>({addListener(i,b,...w){i.addListener(c.get(b),...w)},hasListener(i,b){return i.hasListener(c.get(b))},removeListener(i,b){i.removeListener(c.get(b))}}),$=new p(c=>typeof c!="function"?c:function(b){const w=U(b,{},{getContent:{minArgs:0,maxArgs:0}});c(w)}),H=new p(c=>typeof c!="function"?c:function(b,w,y){let k=!1,m,l=new Promise(de=>{m=function(M){k=!0,de(M)}}),g;try{g=c(b,w,m)}catch(de){g=Promise.reject(de)}const u=g!==!0&&j(g);if(g!==!0&&!u&&!k)return!1;const Z=de=>{de.then(M=>{y(M)},M=>{let Ye;M&&(M instanceof Error||typeof M.message=="string")?Ye=M.message:Ye="An unexpected error occurred",y({__mozWebExtensionPolyfillReject__:!0,message:Ye})}).catch(M=>{console.error("Failed to send onMessage rejected reply",M)})};return Z(u?g:l),!0}),G=({reject:c,resolve:i},b)=>{o.runtime.lastError?o.runtime.lastError.message===a?i():c(new Error(o.runtime.lastError.message)):b&&b.__mozWebExtensionPolyfillReject__?c(new Error(b.message)):i(b)},K=(c,i,b,...w)=>{if(w.length<i.minArgs)throw new Error(`Expected at least ${i.minArgs} ${A(i.minArgs)} for ${c}(), got ${w.length}`);if(w.length>i.maxArgs)throw new Error(`Expected at most ${i.maxArgs} ${A(i.maxArgs)} for ${c}(), got ${w.length}`);return new Promise((y,k)=>{const m=G.bind(null,{resolve:y,reject:k});w.push(m),b.sendMessage(...w)})},W={devtools:{network:{onRequestFinished:_($)}},runtime:{onMessage:_(H),onMessageExternal:_(H),sendMessage:K.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:K.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},n={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return d.privacy={network:{"*":n},services:{"*":n},websites:{"*":n}},U(o,W,d)};t.exports=r(chrome)}})})(tt);var as=tt.exports;const h=et(as),st="*",rs="[hidden]",is=50;function D(s,e="log"){const t=console[e];if(typeof t!="function")throw new TypeError(`Unknown log type: ${e}`);t(s)}function at(s,e){if(s&&e){const t=st.repeat(s.length);return e.replace(s,t)}return e}function rt(s){return s?typeof s=="string"?st.repeat(s.length):Array.isArray(s)?`[Array(${s.length})]`:rs:s===null?"null":(s==null?void 0:s.toString())??"undefined"}function F(s,e){return new Promise((t,a)=>{const r=setTimeout(()=>{a(new Error("promise timeout"))},s);e.then(o=>{clearTimeout(r),t(o)},o=>{clearTimeout(r),a(o)})})}function os(){return!!(!self.window||(location.href.startsWith("safari-web-extension")||location.href.startsWith("moz-extension"))&&location.href.endsWith("generated_background_page.html"))}async function it(s){const e=await fetch(s,{method:"GET",credentials:"same-origin"});return e.ok?e.text():null}class ns{constructor(){this.events=new Map}on(e,t){const a=this.events.get(e)||[];this.events.set(e,[...a,t])}off(e,t){const a=this.events.get(e)||[];this.events.set(e,a.filter(r=>r!==t))}emit(e,...t){for(const a of this.events.get(e)||[])a(...t)}}function ot(s){const e=Object.entries(s).reduce((t,[a,r])=>(typeof r=="string"?t[a]=r:typeof r=="number"?t[a]=r.toString():(typeof r>"u"||r===null)&&(t[a]=""),t),{});return new URLSearchParams(e).toString()}function nt(s){h.tabs.update(s,{active:!0})}function ls(){return h.runtime.getManifest().version}function J(s,e){return h.i18n.getMessage(s,e)}async function P(s,e){return h.tabs.sendMessage(s,e)}function T(s){return e=>e(s)}function lt(...s){h.runtime.onMessage.addListener((e,t)=>{let a=!1;for(const r of s){const o=r(d=>{if(e.type===d.type)return a=!0,d.fn(e.payload,t)});if(a)return Promise.resolve(o)}})}async function cs(s){return h.runtime.sendMessage(s)}async function ds(s){return h.runtime.sendMessage(s)}(async()=>Promise.resolve().then(()=>fs))();const us=(async()=>Promise.resolve().then(()=>Ns))();class ms{constructor(){this.queue=[],this.isActive=!1,this.shouldPrint=us.then(e=>e.getOption(e.DEBUG_LOGGING_ENABLED))}push(e,t){this.queue.push({text:e,logType:t}),this.start()}async start(){var e;if(!this.isActive){this.isActive=!0;try{for(let t=0;t<100&&this.queue.length>0;t++){const a=this.queue.shift();if(a&&await this.shouldPrint){const r=console[a.logType];if(typeof r!="function")throw new TypeError(`Unknown log type: ${a.logType}`);const o=`Web Scrobbler: ${(e=a.text)==null?void 0:e.toString()}`;r(o)}}this.isActive=!1}catch{this.isActive=!1}}}}const gs=new ms;function R(s,e="log"){gs.push(s,e)}var f=(s=>(s.RESULT_OK="ok",s.RESULT_IGNORE="ignored",s.ERROR_AUTH="error-auth",s.ERROR_OTHER="error-other",s))(f||{});function hs(s,e){for(const t of s)if(t[e]===f.RESULT_IGNORE)return"ignored";for(const t of s)if(t[e]!==f.RESULT_OK)return"error";return"success"}const ct=3e3;class dt{constructor(e,t){this.requests=[],this.autoIncrement=0,this.emitter=new ns,this.interval=setInterval(()=>{this.unlock()},ct),this.storage=e,this.namespace=t}unlock(){this.requests=this.requests.slice(1),this.emitter.emit("updateLock",this.requests[0]),clearInterval(this.interval),this.interval=setInterval(()=>{this.unlock()},ct)}async get(){const e=await this.storage.get();return e&&this.namespace in e?e[this.namespace]:null}async getLocking(){return await new Promise(t=>{const a=this.autoIncrement++;if(this.requests.push(a),this.requests[0]===a){t(!0);return}const r=o=>{o===a&&(t(!0),this.emitter.off("updateLock",r))};this.emitter.on("updateLock",r)}),this.get()}async set(e){const t={[this.namespace]:e};await this.storage.set(t)}async setLocking(e){try{await this.set(e)}catch(t){R(t,"warn")}this.unlock()}async update(e){const t=await this.getLocking(),a=Object.assign(t??{},e);await this.setLocking(a)}async debugLog(e=[]){const t=await this.get(),r=JSON.stringify(t,(o,d)=>e.includes(o)?rt(d):d,2);(location==null?void 0:location.protocol)==="chrome-extension:"&&R(`storage.${this.namespace} = ${r}`,"info")}async clear(){await this.storage.remove(this.namespace)}}const x=0,V=1,ke="Connectors",Re="ConnectorsOverrideOptions",Ee="customPatterns",Te="Notifications",ut="BlockedTags",ee="LocalCache",xe="NativeScrobblerNotification",Le="Blocklists",Pe="Options",ue="StateManagement",me="DisabledTabs",te="RegexEdits",ge="ScrobbleCache",Oe="Core",bs={[ke]:V,[Re]:V,[Ee]:V,[Te]:V,[Pe]:V,LastFM:x,LibreFM:x,ListenBrainz:x,Maloja:x,Webhook:x,Pleroma:x,[xe]:x,[Le]:x,[ee]:x,[te]:x,[ge]:x,[ut]:x,[Oe]:x,[ue]:x,[me]:x};function E(s){switch(bs[s]){case V:return gt(s);case x:return Q(s);default:throw new Error(`Unknown storage namespace: ${s}`)}}function mt(s){return Q(s)}function Q(s){const e=h.storage.local;return new dt(e,s)}function gt(s){const e=h.storage.sync||h.storage.local;return new dt(e,s)}const fs=Object.freeze(Object.defineProperty({__proto__:null,BLOCKED_TAGS:ut,BLOCKLISTS:Le,CONNECTORS_OPTIONS:ke,CONNECTORS_OVERRIDE_OPTIONS:Re,CORE:Oe,CUSTOM_PATTERNS:Ee,DISABLED_TABS:me,LOCAL_CACHE:ee,NATIVE_SCROBBLER_NOTIFICATION:xe,NOTIFICATIONS:Te,OPTIONS:Pe,REGEX_EDITS:te,SCROBBLE_CACHE:ge,STATE_MANAGEMENT:ue,getLocalStorage:Q,getScrobblerStorage:mt,getStorage:E,getSyncStorage:gt},Symbol.toStringTag,{value:"Module"})),Ne=[{label:"YouTube",matches:["*://www.youtube.com/*","*://m.youtube.com/*"],js:"youtube.js",id:"youtube",usesBlocklist:!0},{label:"MySpace",matches:["*://myspace.com/*"],js:"myspace.js",id:"myspace"},{label:"Bandcamp Daily",matches:["*://daily.bandcamp.com/*"],js:"bandcamp-embed.js",id:"bandcamp-embed",allFrames:!0},{label:"Bandcamp",matches:["*://*.bandcamp.com/*","*://bandcamp.com/*"],js:"bandcamp.js",id:"bandcamp"},{label:"BNDCMPR",matches:["*://bndcmpr.co/*"],js:"bndcmpr.js",id:"bndcmpr",allFrames:!0},{label:"Buy Music Club",matches:["*://www.buymusic.club/*"],js:"buymusicclub.js",id:"buymusicclub"},{label:"Pandora",matches:["*://www.pandora.com/*"],js:"pandora.js",id:"pandora"},{label:"Pakartot",matches:["*://www.pakartot.lt/*"],js:"pakartot.js",id:"pakartot"},{label:"Deezer",matches:["*://www.deezer.com/*"],js:"deezer.js",id:"deezer"},{label:"SoundCloud",matches:["*://soundcloud.com/*","*://m.soundcloud.com/*"],js:"soundcloud.js",id:"soundcloud"},{label:"Amazon Music",matches:["*://music.amazon.*/*","*://www.amazon.*/gp/dmusic/cloudplayer/*"],js:"amazon.js",id:"amazon"},{label:"Amazon Echo",matches:["*://alexa.amazon.*/spa/*"],js:"amazon-alexa.js",id:"amazon-alexa"},{label:"VK",matches:["*://vk.com/*"],js:"vk.js",id:"vk"},{label:"Megalyrics",matches:["*://megalyrics.ru/*"],js:"megalyrics.js",id:"megalyrics"},{label:"iHeartRadio",matches:["*://*.iheart.com/*"],js:"iheart.js",id:"iheart"},{label:"Indie Shuffle",matches:["*://www.indieshuffle.com/*"],js:"indieshuffle.js",id:"indieshuffle"},{label:"Tuba.FM",matches:["*://fm.tuba.pl/*"],js:"tubafm.js",id:"tubafm"},{label:"Spotify",matches:["*://open.spotify.com/*"],js:"spotify.js",id:"spotify",hasNativeScrobbler:!0},{label:"plug.dj",matches:["*://plug.dj/*"],js:"plug.dj.js",id:"plug.dj"},{label:"Dandelion Radio",matches:["*://www.dandelionradio.com/player.htm"],js:"dandelionradio.js",id:"dandelionradio"},{label:"HillyDilly",matches:["*://www.hillydilly.com/*"],js:"hillydilly.js",id:"hillydilly"},{label:"8tracks",matches:["*://8tracks.com/*"],js:"8tracks.js",id:"8tracks"},{label:"Radio Cidade",matches:["*://radiocidade.fm/player/*","*://play.radiomania.com.br/*","*://*.melodia.com.br/*","*://jb.fm/player/*"],js:"radiocidade.js",id:"radiocidade"},{label:"Radio Nova",matches:["*://www.nova.fr/*"],js:"nova.js",id:"nova"},{label:"Radioplus",matches:["*://www.radioplus.be/*","*://radioplus.be/*"],js:"radioplus.js",id:"radioplus"},{label:"Радио Premium",matches:["*://rpfm.ru/*"],js:"rpfm.js",id:"rpfm"},{label:"Douban.FM",matches:["*://douban.fm/*","*://fm.douban.fm/*"],js:"douban.fm.js",id:"douban.fm"},{label:"Focus@Will",matches:["*://www.focusatwill.com/*"],js:"focusatwill.js",id:"focusatwill"},{label:"Subphonic (owncloud plugin)",matches:["*://*/*/apps/subphonic/minisub/*"],js:"subphonic.js",id:"subphonic"},{label:"Digitally Imported",matches:["*://www.di.fm/*"],js:"radiotunes.js",id:"di"},{label:"BBC Sounds",matches:["*://*.bbc.co.uk/*"],js:"bbc-sounds.js",id:"bbc-sounds"},{label:"Gaana",matches:["*://gaana.com/*"],js:"gaana.js",id:"gaana"},{label:"Яндекс.Музыка",matches:["*://music.yandex.ru/*","*://music.yandex.by/*","*://music.yandex.kz/*","*://music.yandex.ua/*"],js:"yandex-music.js",id:"yandex-music"},{label:"Plex",matches:["*://*32400/web/*","*://plex.tv/web/*","*://*.plex.tv/web/*","*://*.plex.tv/desktop*"],js:"plex.js",id:"plex"},{label:"TuneIn",matches:["*://tunein.com/*"],js:"tunein.js",id:"tunein"},{label:"Mixcloud",matches:["*://mixcloud.com/*","*://*.mixcloud.com/*"],js:"mixcloud.js",id:"mixcloud"},{label:"ReverbNation",matches:["*://www.reverbnation.com/*"],js:"reverbnation.js",id:"reverbnation"},{label:"NRK Radio",matches:["*://radio.nrk.no/*"],js:"nrk-radio.js",id:"nrk-radio"},{label:"Internet Archive",matches:["*://archive.org/details/*"],js:"archive.js",id:"archive"},{label:"Odnoklassniki",matches:["*://odnoklassniki.ru/*","*://ok.ru/*"],js:"odnoklassniki.js",id:"odnoklassniki"},{label:"Overcast",matches:["*://overcast.fm/*"],js:"overcast.js",id:"overcast"},{label:"Online Radio Box",matches:["*://onlineradiobox.com/*","*://p.onlineradiobox.com/*"],js:"onlineradiobox.js",id:"onlineradiobox"},{label:"163 Music",matches:["*://music.163.com/*"],js:"163-music.js",id:"163-music"},{label:"Ambient Sleeping Pill",matches:["*://ambientsleepingpill.com/"],js:"ambientsleepingpill.js",id:"ambientsleepingpill"},{label:"a.m. ambient",matches:["*://amambient.com/"],js:"ambientsleepingpill.js",id:"amambient"},{label:"Tidal",matches:["*://listen.tidalhifi.com/*","*://listen.tidal.com/*"],js:"tidal.js",id:"tidal"},{label:"Hype Machine Featured Albums",matches:["*://hypem.com/album/*"],js:"hypem-albums.js",id:"hypem-premieres"},{label:"Hype Machine",matches:["*://hypem.com/*"],js:"hypem.js",id:"hypem"},{label:"Radionomy",matches:["*://www.radionomy.com/*"],js:"radionomy.js",id:"radionomy"},{label:"J1 Radio",matches:["*://www.j1fm.tokyo/player/*","*://www.j1fm.tokyo/michi/player/*"],js:"aiircom.js",id:"j1-radio"},{label:"JazzAndRain",matches:["*://*.jazzandrain.com/*"],js:"jazzandrain.js",id:"jazzandrain"},{label:"RelaxingBeats",matches:["*://*.relaxingbeats.com/*"],js:"jazzandrain.js",id:"relaxingbeats"},{label:"EpicMusicTime",matches:["*://*.epicmusictime.com/*"],js:"jazzandrain.js",id:"epicmusictime"},{label:"AccuJazz",matches:["*://www.accuradio.com/pop_player/accujazz/*"],js:"accujazz.js",id:"accujazz"},{label:"AccuRadio",matches:["*://www.accuradio.com/*"],js:"accuradio.js",id:"accuradio"},{label:"Imusic.am",matches:["*://imusic.am/*"],js:"imusic.am.js",id:"imusic.am"},{label:"Earbits",matches:["*://www.earbits.com/*"],js:"earbits.js",id:"earbits"},{label:"Player.fm",matches:["*://player.fm/*"],js:"player.fm.js",id:"player.fm"},{label:"Sound Test",matches:["*://sndtst.com/*"],js:"sndtst.js",id:"sndtst"},{label:"RadioTunes",matches:["*://www.radiotunes.com/*"],js:"radiotunes.js",id:"radiotunes"},{label:"RockRadio",matches:["*://www.rockradio.com/*"],js:"radiotunes.js",id:"rockradio"},{label:"ClassicalRadio",matches:["*://www.classicalradio.com/*"],js:"radiotunes.js",id:"classicalradio"},{label:"Audacy",matches:["*://www.audacy.com/*"],js:"audacy.js",id:"audacy"},{label:"Audius",matches:["*://audius.co/*"],js:"audius.js",id:"audius"},{label:"GetWorkDoneMusic",matches:["*://*.getworkdonemusic.com/*"],js:"getworkdonemusic.js",id:"getworkdonemusic"},{label:"Jamendo",matches:["*://www.jamendo.com/*"],js:"jamendo.js",id:"jamendo"},{label:"Bandzone.cz",matches:["*://bandzone.cz/*"],js:"bandzone.cz.js",id:"bandzone.cz"},{label:"Music Player for Google Drive",matches:["*://www.driveplayer.com/*"],js:"driveplayer.js",id:"driveplayer"},{label:"Kodi",js:"kodi.js",id:"kodi"},{label:"Superplayer",matches:["*://www.superplayer.fm/*"],js:"superplayer.js",id:"superplayer"},{label:"RMFON",matches:["*://www.rmfon.pl/*"],js:"rmfon.js",id:"rmfon"},{label:"Radio 357",matches:["*://radio357.pl/*"],js:"radio357.js",id:"radio357"},{label:"JazzRadio",matches:["*://www.jazzradio.com/*"],js:"radiotunes.js",id:"jazzradio"},{label:"Zen Radio",matches:["*://www.zenradio.com/*"],js:"radiotunes.js",id:"zenradio"},{label:"SomaFM",matches:["*://somafm.com/player/*"],js:"somafm.js",id:"somafm"},{label:"Free Music Archive",matches:["*://*.freemusicarchive.org/*"],js:"freemusicarchive.js",id:"freemusicarchive"},{label:"Reddit Music Player",matches:["*://reddit.musicplayer.io/"],js:"redditmusicplayer.js",id:"redditmusicplayer"},{label:"Новое Радио",matches:["*://www.novoeradio.by/*"],js:"novoeradio.js",id:"novoeradio"},{label:"Яндекс.Радио",matches:["*://radio.yandex.ru/*","*://radio.yandex.by/*","*://radio.yandex.kz/*","*://radio.yandex.ua/*"],js:"yandex-music.js",id:"yandex-radio"},{label:"Radio Paradise",matches:["*://radioparadise.com/*"],js:"radioparadise.js",id:"radioparadise",allFrames:!0},{label:"Beatport",matches:["*://www.beatport.com/*"],js:"beatport.js",id:"beatport"},{label:"Beeline Music",matches:["*://music.beeline.ru/*"],js:"beeline-music.js",id:"beeline-music"},{label:"wavo",matches:["*://wavo.me/*"],js:"wavo.js",id:"wavo"},{label:"FluxFM Berlin",matches:["*://www.fluxfm.de/*"],js:"fluxfm.js",id:"fluxfm"},{label:"Noise FM",matches:["*://noisefm.ru/*","*://en.noisefm.ru/*"],js:"noisefm.js",id:"noisefm",allFrames:!0},{label:"WWOZ",matches:["*://www.wwoz.org/listen/player/*"],js:"wwoz.js",id:"wwoz"},{label:"Sonerezh",matches:["*://sonerezh.*/*","*://*/*sonerezh*"],js:"sonerezh.js",id:"sonerezh"},{label:"Youradio",matches:["*://www.youradio.cz/*"],js:"youradio.js",id:"youradio"},{label:"GPMusic",matches:["*://player.gpmusic.co/*"],js:"gpmusic.js",id:"gpmusic"},{label:"Nightwave Plaza",matches:["*://plaza.one/*"],js:"plaza.js",id:"plaza"},{label:"Retrowave",matches:["*://retrowave.ru/*"],js:"retrowave.js",id:"retrowave"},{label:"Genie",matches:["*://www.genie.co.kr/player/fPlayer*"],js:"genie.js",id:"genie"},{label:"Bugs",matches:["*://music.bugs.co.kr/newPlayer*"],js:"bugs.js",id:"bugs"},{label:"openfm",matches:["*://open.fm/*"],js:"openfm.js",id:"openfm"},{label:"Playmoss",matches:["*://playmoss.com/*"],js:"playmoss.js",id:"playmoss"},{label:"Apidog",matches:["*://apidog.ru/*"],js:"apidog.js",id:"apidog"},{label:"Pinguin Radio",matches:["*://pinguinradio.com/*"],js:"pinguinradio.js",id:"pinguinradio"},{label:"JioSaavn",matches:["*://www.jiosaavn.com/*"],js:"jiosaavn.js",id:"jiosaavn"},{label:"Anghami",matches:["*://*.anghami.com/*"],js:"anghami.js",id:"anghami"},{label:"Mail.ru Music",matches:["*://my.mail.ru/music","*://my.mail.ru/music/*"],js:"mail.ru.js",id:"mail.ru"},{label:"Emby/Jellyfin",matches:["*://*8096/web/*","*://*8920/web/*","*://app.emby.media/*"],js:"emby.js",id:"emby"},{label:"Freegal Music",matches:["*://*.freegalmusic.com/*"],js:"freegalmusic.js",id:"freegalmusic"},{label:"hoopla",matches:["*://www.hoopladigital.com/*"],js:"hoopladigital.js",id:"hoopladigital"},{label:"Amplify 817",matches:["*://amplify817.org/*"],js:"musicat.js",id:"amplify817"},{label:"Capital City Records",matches:["*://capitalcityrecords.ca/*"],js:"musicat.js",id:"capitalcityrecords"},{label:"Electric Lady Bird",matches:["*://atxlibrary.musicat.co/*"],js:"musicat.js",id:"musicat-atxlibrary"},{label:"FlipSide",matches:["*://flipside.apl.org/*"],js:"musicat.js",id:"apl-flipside"},{label:"HUM (Hear Utah Music)",matches:["*://hum.slcpl.org/*"],js:"musicat.js",id:"slcpl-hum"},{label:"KDL Vibes",matches:["*://vibes.kdl.org/*"],js:"musicat.js",id:"kdl-vibes"},{label:"Library Music Project",matches:["*://librarymusicproject.com/*"],js:"musicat.js",id:"librarymusicproject"},{label:"MNspin",matches:["*://hclib.musicat.co/*"],js:"musicat.js",id:"musicat-hclib"},{label:"Nashville BoomBox",matches:["*://boombox.library.nashville.org/*"],js:"musicat.js",id:"nashville-library-boombox"},{label:"QC Beats",matches:["*://qcbeats.org/*"],js:"musicat.js",id:"qcbeats"},{label:"Q-Dance",matches:["*://www.q-dance.com/*"],js:"q-dance.js",id:"q-dance"},{label:"Sawdust City Sounds",matches:["*://sawdustcitysounds.org/*"],js:"musicat.js",id:"sawdustcitysounds"},{label:"Seattle PlayBack",matches:["*://playback.spl.org/*"],js:"musicat.js",id:"spl-playback"},{label:"STACKS",matches:["*://stacks.carnegielibrary.org/*"],js:"musicat.js",id:"carnegielibrary-stacks"},{label:"Tracks Music Library",matches:["*://tracksmusiclibrary.org/*"],js:"musicat.js",id:"tracksmusiclibrary"},{label:"Monstercat",matches:["*://www.monstercat.com/*"],js:"monstercat.js",id:"monstercat"},{label:"Listen.moe",matches:["*://listen.moe/*"],js:"listen.moe.js",id:"listen.moe"},{label:"anime(bits)",matches:["*://radio.animebits.moe/","*://radio.animebits.moe/player/*"],js:"animebits.js",id:"animebits"},{label:"Fair Price Music",matches:["*://www.fairpricemusic.com/*"],js:"fairpricemusic.js",id:"fairpricemusic"},{label:"Radio ULTRA",matches:["*://player.radioultra.ru/*"],js:"radioultra.js",id:"radioultra"},{label:"Наше Радио",matches:["*://player.nashe.ru/*"],js:"radioultra.js",id:"nashe"},{label:"RockFM",matches:["*://player.rockfm.ru/*"],js:"radioultra.js",id:"rockfm"},{label:"Radio JAZZ",matches:["*://player.radiojazzfm.ru/*"],js:"radioultra.js",id:"radiojazzfm"},{label:"WO Streaming",matches:["*://*player.wostreaming.net/*"],js:"wostreaming.js",id:"wostreaming"},{label:"Listen Live",matches:["*://player.listenlive.co/*"],js:"listenlive.js",id:"listenlive"},{label:"Rayo",matches:["*://hellorayo.co.uk/*/play/*","*://hellorayo.co.uk/*/player/*"],js:"planetradio.js",id:"planetradio"},{label:"Roxx Radio",matches:["*://roxx.gr/radio/*"],js:"roxx.js",id:"roxx"},{label:"ListenOnRepeat",matches:["*://listenonrepeat.com/*"],js:"listenonrepeat.js",id:"listenonrepeat"},{label:"Duckburg Radio",matches:["*://*.radio-mb.com/*"],js:"radio-mb.js",id:"radio-mb"},{label:"Webradio.de",matches:["*://www.webradio.de/*"],js:"radioplayer.js",id:"webradio.de"},{label:"The Breeze",matches:["*://www.thebreeze.com/*/radioplayer/*"],js:"radioplayer.js",id:"thebreeze"},{label:"RadioPlayer",matches:["*://ukradioplayer.*/*","*://radioplayer.*/*","*://*/radioplayer/*","*://*/radio/player/","*://*/*/radio/player/"],js:"radioplayer.js",id:"radioplayer"},{label:"deltaradio",matches:["*://www.deltaradio.de/*"],js:"deltaradio.de.js",id:"deltaradio.de"},{label:"Radio Bob",matches:["*://*.radiobob.de/*"],js:"radiobob.js",id:"radiobob"},{label:"ByteFM",matches:["*://www.byte.fm/*"],js:"byte.fm.js",id:"byte.fm"},{label:"Deutschlandfunk Nova",matches:["*://www.deutschlandfunknova.de/*"],js:"deutschlandfunknova.js",id:"deutschlandfunknova"},{label:"QQ Music",matches:["*://y.qq.com/*"],js:"qq-music.js",id:"qq-music"},{label:"QQ Video",matches:["*://v.qq.com/x/*"],js:"qq-video.js",id:"qq-video"},{label:"Naver",matches:["*://playerui.music.naver.com/*"],js:"naver.js",id:"naver"},{label:"Soribada",matches:["*://www.soribada.com/*"],js:"soribada.js",id:"soribada"},{label:"Flo",matches:["*://www.music-flo.com/*"],js:"music-flo.js",id:"music-flo"},{label:"Discogs",matches:["*://www.discogs.com/*"],js:"youtube-embed.js",id:"youtube-embed",allFrames:!0},{label:"NPR",matches:["*://www.npr.org/*"],js:"npr.js",id:"npr"},{label:"Streamsquid",matches:["*://streamsquid.com/*"],js:"streamsquid.js",id:"streamsquid"},{label:"Streemlion",matches:["*://listen.streemlion.com/*"],js:"streemlion.js",id:"streemlion"},{label:"eMusic",matches:["*://www.emusic.com/*"],js:"emusic.js",id:"emusic"},{label:"LyricsTraining",matches:["*://lyricstraining.com/*"],js:"lyricstraining.js",id:"lyricstraining"},{label:"Music Walker",matches:["*://arkanath.com/MusicWalker/*"],js:"musicwalker.js",id:"musicwalker"},{label:"radioeins",matches:["*://www.radioeins.de/livestream/*"],js:"radioeins.js",id:"radioeins"},{label:"Fritz",matches:["*://www.fritz.de/livestream/*"],js:"fritz.js",id:"fritz"},{label:"Musicoin",matches:["*://musicoin.org/*"],js:"musicoin.js",id:"musicoin"},{label:"181.fm",matches:["*://player.181fm.com/*"],js:"181.fm.js",id:"181.fm"},{label:"Phish.in",matches:["*://phish.in/*"],js:"phish.in.js",id:"phish.in"},{label:"Rainwave",matches:["*://rainwave.cc/*","*://all.rainwave.cc/*","*://game.rainwave.cc/*","*://chiptune.rainwave.cc/*","*://ocr.rainwave.cc/*","*://covers.rainwave.cc/*"],js:"rainwave.js",id:"rainwave"},{label:"Retro Synthwave",matches:["*://www.retro-synthwave.com/*"],js:"retro-synthwave.js",id:"retro-synthwave"},{label:"Радиоволна.нет",matches:["*://radiovolna.net/*"],js:"radiovolna.js",id:"radiovolna"},{label:"Feedbands",matches:["*://feedbands.com/*"],js:"feedbands.js",id:"feedbands"},{label:"Taazi",matches:["*://taazi.com/*"],js:"taazi.js",id:"taazi"},{label:"Patari",matches:["*://patari.pk/*"],js:"patari.js",id:"patari"},{label:"pCloud",matches:["*://my.pcloud.com/*"],js:"pcloud.js",id:"pcloud"},{label:"JetSetRadio Live",matches:["*://jetsetradio.live/*"],js:"jetsetradio.live.js",id:"jetsetradio.live"},{label:"Radio France",matches:["*://www.radiofrance.fr/*"],js:"radiofrance.js",id:"radiofrance"},{label:"RemixRotation",matches:["*://remixrotation.com/*"],js:"remixrotation.js",id:"remixrotation"},{label:"WFMU",matches:["*://wfmu.org/*"],js:"wfmu.js",id:"wfmu"},{label:"SiriusXM",matches:["*://www.siriusxm.com/*","*://www.siriusxm.ca/*","*://*.siriusxm.com/player/*"],js:"siriusxm-player.js",id:"siriusxm-player"},{label:"1ting",matches:["*://www.1ting.com/player/*","*://www.1ting.com/p_*","*://www.1ting.com/album*","*://www.1ting.com/rand.php*","*://www.1ting.com/day/*","*://h5.1ting.com/*"],js:"1ting.js",id:"1ting"},{label:"Douban Artists",matches:["*://music.douban.com/artists/player/*"],js:"douban-artists.js",id:"douban-artists"},{label:"Kugou",matches:["*://www.kugou.com/song/*"],js:"kugou.js",id:"kugou"},{label:"Gimme Radio",matches:["*://gimmeradio.com/*","*://www.gimmeradio.com/*","*://gimmecountry.com/*","*://www.gimmecountry.com/*","*://gimmemetal.com/*","*://www.gimmemetal.com/*"],js:"gimmeradio.js",id:"gimmeradio"},{label:"9sky",matches:["*://www.9sky.com/music*","*://www.9sky.com/mv/detail*"],js:"9sky.js",id:"9sky"},{label:"Vagalume.FM",matches:["*://vagalume.fm/*","*://*.vagalume.com.br/*"],js:"vagalume.js",id:"vagalume"},{label:"Radiooooo",matches:["*://radiooooo.com/*","*://mobile.radiooooo.com/*"],js:"radiooooo.js",id:"radiooooo"},{label:"LetsLoop",matches:["*://letsloop.com/*"],js:"letsloop.js",id:"letsloop"},{label:"Mideast Tunes",matches:["*://mideastunes.com/*","*://map.mideastunes.com/*"],js:"mideastunes.js",id:"mideastunes"},{label:"Český Rozhlas",matches:["*://prehravac.rozhlas.cz/*"],js:"rozhlas.js",id:"rozhlas"},{label:"blocSonic",matches:["*://*.blocsonic.com/*"],js:"blocsonic.js",id:"blocsonic"},{label:"Resonate",matches:["*://stream.resonate.coop/*"],js:"resonate.js",id:"resonate"},{label:"KEXP",matches:["*://*.kexp.org/*"],js:"kexp.js",id:"kexp"},{label:"Hotmixradio.fr",matches:["*://www.hotmixradio.fr/*"],js:"hotmixradio.js",id:"hotmixradio"},{label:"Aphex Twin",matches:["*://aphextwin.warp.net/*"],js:"warp-aphextwin.js",id:"warp-aphextwin"},{label:"Zachary Seguin Music",matches:["*://music.zacharyseguin.ca/*"],js:"musickit.js",id:"zacharyseguin"},{label:"Joox",matches:["*://www.joox.com/*"],js:"joox.js",id:"joox"},{label:"Musish",matches:["*://musi.sh/*"],js:"musickit.js",id:"musish"},{label:"1001tracklists",matches:["*://www.1001tracklists.com/tracklist/*"],js:"1001tracklists.js",id:"1001tracklists"},{label:"YouTube Music",matches:["*://music.youtube.com/*"],js:"youtube-music.js",id:"youtube-music"},{label:"Radiozenders.FM",matches:["*://www.radiozenders.fm/*"],js:"radiozenders.js",id:"radiozenders"},{label:"Invidious",matches:["*://*.invidio.us/*"],js:"invidious.js",id:"invidious"},{label:"Piped",matches:["*://piped.video/*"],js:"piped.js",id:"piped"},{label:"Pretzel",matches:["*://*.pretzel.rocks/*"],js:"pretzel.js",id:"pretzel"},{label:"Primordial Radio",matches:["*://primordialradio.com/*"],js:"primordialradio.js",id:"primordialradio"},{label:"Radio Kyivstar",matches:["*://radio.kyivstar.ua/*"],js:"kyivstar.js",id:"kyivstar"},{label:"Funkwhale",js:"funkwhale.js",id:"funkwhale"},{label:"9128.live",matches:["*://9128.live/*","*://embed.radio.co/player/*"],js:"radioco.js",id:"9128.live",allFrames:!0},{label:"Radio.co",matches:["*://embed.radio.co/player/*"],js:"radioco.js",id:"radioco"},{label:"Super45.fm",matches:["*://super45.fm/"],js:"radioco.js",id:"super45fm",allFrames:!0},{label:"R/a/dio",matches:["*://r-a-d.io/*"],js:"r-a-d.io.js",id:"r-a-d.io"},{label:"Apple Music",matches:["*://*music.apple.com/*"],js:"musickit.js",id:"apple-music"},{label:"Primephonic",matches:["*://play.primephonic.com/*"],js:"primephonic.js",id:"primephonic"},{label:"Watch2Gether",matches:["*://w2g.tv/*"],js:"watch2gether.js",id:"watch2gether"},{label:"Poolsuite",matches:["*://poolsuite.net/*"],js:"poolsuite.js",id:"poolsuite"},{label:"GDS.FM",matches:["*://www.gds.fm/*","*://gds.fm/*"],js:"gds.fm.js",id:"gds"},{label:"Wynk Music",matches:["*://wynk.in/music*"],js:"wynk.js",id:"wynk"},{label:"RadioJavan",matches:["*://play.radiojavan.com/*"],js:"radiojavan.js",id:"radiojavan"},{label:"Audiomack",matches:["*://audiomack.com/*"],js:"audiomack.js",id:"audiomack"},{label:"Global Player",matches:["*://www.globalplayer.com/*"],js:"globalplayer.js",id:"globalplayer"},{label:"The Current",matches:["*://www.thecurrent.org/*"],js:"thecurrent.js",id:"thecurrent"},{label:"pan y rosas discos",matches:["*://www.panyrosasdiscos.net/*"],js:"panyrosasdiscos.js",id:"panyrosasdiscos"},{label:"GRRIF",matches:["*://*.grrif.ch/*"],js:"grrif.js",id:"grrif"},{label:"newgrounds",matches:["*://www.newgrounds.com/audio*"],js:"newgrounds.js",id:"newgrounds"},{label:"Jango",matches:["*://www.jango.com/*"],js:"jango.js",id:"jango"},{label:"PlayIrish",matches:["*://*.playirish.ie/*"],js:"playirish.js",id:"playirish"},{label:"Radio Record",matches:["*://www.radiorecord.ru/*"],js:"radiorecord.js",id:"radiorecord"},{label:"Imago Radio",matches:["*://*.imago.fm/*"],js:"imago.js",id:"imago"},{label:"Provoda.ch",matches:["*://*.provoda.ch/*"],js:"provoda.ch.js",id:"provoda.ch"},{label:"Atomic Music Space",matches:["*://stream.atomicmusic.space/*"],js:"atomicmusic.space.js",id:"atomicmusic.space"},{label:"The-radio.ru",matches:["*://the-radio.ru/*"],js:"the-radio.ru.js",id:"the-radio.ru"},{label:"HQ Radio",matches:["*://hqradio.ru/*"],js:"hqradio.js",id:"hqradio"},{label:"Smooth FM",matches:["*://smoothfm.iol.pt/*"],js:"smoothfm.js",id:"smoothfm"},{label:"Vodafone.fm",matches:["*://vodafone.fm/*"],js:"vodafone.fm.js",id:"vodafonefm"},{label:"Relisten.net",matches:["*://relisten.net/*"],js:"relisten.js",id:"relisten"},{label:"UpBeatRadio",matches:["*://upbeatradio.net/*"],js:"upbeatradio.js",id:"upbeatradio"},{label:"Chillhop",matches:["*://chillhop.com/*"],js:"chillhop.js",id:"chillhop"},{label:"DatPiff",matches:["*://www.datpiff.com/player/*"],js:"datpiff.js",id:"datpiff",allFrames:!0},{label:"Shuffle",matches:["*://shuffle.one/play*"],js:"shuffleone.js",id:"shuffleone"},{label:"JB FM",matches:["*://jb.fm/player/*"],js:"jb.fm.js",id:"jbfm"},{label:"SECTOR Radio",matches:["*://sectorradio.ru/*"],js:"sectorradio.js",id:"sectorradio"},{label:"LiveOne",matches:["*://*.liveone.com/*"],js:"liveone.js",id:"liveone"},{label:"PocketCasts",matches:["*://play.pocketcasts.com/*"],js:"pocketcasts.js",id:"pocketcasts"},{label:"Clyp",matches:["*://clyp.it/*"],js:"clyp.js",id:"clyp"},{label:"RTBF Radio",matches:["*://www.rtbf.be/radio/*"],js:"rtbf.js",id:"rtbf"},{label:"TuneTrack",matches:["*://tunetrack.net/*"],js:"tunetrack.js",id:"tunetrack"},{label:"Musify",matches:["*://*.musify.club/*"],js:"musify.js",id:"musify"},{label:"Radio Rethink",matches:["*://www.radiorethink.com/*"],js:"radiorethink.js",id:"radiorethink"},{label:"SoundClick",matches:["*://www.soundclick.com/*"],js:"soundclick.js",id:"soundclick"},{label:"Napster",matches:["*://app.napster.com/*"],js:"napster.js",id:"napster"},{label:"abc.net.au",matches:["*://www.abc.net.au/*/listen-live/*"],js:"abc.net.au.js",id:"abcnetau"},{label:"JQBX",matches:["*://app.jqbx.fm/*"],js:"jqbx.js",id:"jqbx"},{label:"music.jsososo.com",matches:["*://y.jsososo.com/*","*://music.jsososo.com/*"],js:"jsososo.js",id:"jsososo"},{label:"Supla",matches:["*://*.supla.fi/*"],js:"supla.js",id:"supla"},{label:"swr3",matches:["*://www.swr3.de/*"],js:"swr3.js",id:"swr3"},{label:"Epidemic Sound",matches:["*://*.epidemicsound.com/*"],js:"epidemicsound.js",id:"epidemicsound"},{label:"Rekt Network",matches:["*://rekt.network/*"],js:"rekt.network.js",id:"rektnetwork"},{label:"Nightride FM",matches:["*://nightride.fm/*"],js:"nightride.fm.js",id:"nightridefm"},{label:"Qobuz",matches:["*://*.qobuz.com/*"],js:"qobuz.js",id:"qobuz"},{label:"TruckersFM",matches:["*://*.truckers.fm/*"],js:"truckersfm.js",id:"truckersfm"},{id:"winampify",label:"Winampify",js:"winampify.js",matches:["*://winampify.io/*"]},{label:"detektor.fm",matches:["*://detektor.fm/*"],js:"detektorfm.js",id:"detektorfm"},{label:"iBroadcast",matches:["*://media.ibroadcast.com/*"],js:"ibroadcast.js",id:"ibroadcast"},{label:"Radio7",matches:["*://radio7.lv/*"],js:"radio7.js",id:"radio7lv"},{label:"TOWER RECORDS MUSIC",matches:["*://music.tower.jp/*"],js:"towerrecordsmusic.js",id:"towerrecordsmusic"},{label:"Eggs",matches:["*://eggs.mu/*"],js:"eggs.js",id:"eggs"},{label:"Jamstash",matches:["*://jamstash.com/*"],js:"jamstash.js",id:"jamstash"},{label:"SubFire",matches:["*://p.subfireplayer.net/*"],js:"subfire.js",id:"subfire"},{label:"Idagio",matches:["*://app.idagio.com/*"],js:"idagio.js",id:"idagio"},{label:"Relax FM",matches:["*://relax-fm.ru/*"],js:"relaxfm.js",id:"relaxfm"},{label:"Laut.fm",matches:["*://laut.fm/*"],js:"laut.fm.js",id:"laut.fm"},{label:"Magnatune",matches:["*://magnatune.com/*"],js:"magnatune.js",id:"magnatune"},{label:"Libre.fm",matches:["*://libre.fm/*"],js:"librefm.js",id:"librefm"},{label:"Brain.fm",matches:["*://my.brain.fm/*"],js:"brainfm.js",id:"brainfm"},{label:"bullofheaven.com",matches:["*://bullofheaven.com/*"],js:"bullofheaven.com.js",id:"bullofheavencom"},{label:"All Classical Portland",matches:["*://player.allclassical.org/*"],js:"allclassical.org.js",id:"allclassicalportland"},{label:"Migu Music",matches:["*://music.migu.cn/*"],js:"migu-music.js",id:"migu-music"},{label:"Weibo",matches:["*://weibo.com/*","*://*.weibo.com/*"],js:"weibo.js",id:"weibo"},{label:"Street Voice",matches:["*://streetvoice.cn/*","*://streetvoice.com/*"],js:"streetvoice.js",id:"streetvoice"},{label:"Red Bull",matches:["*://www.redbull.com/*"],js:"redbull.js",id:"redbull"},{label:"Synology",matches:["*://*5000/*","*://*/?launchApp=SYNO.SDS.AudioStation.Application*"],js:"synology.js",id:"synology"},{label:"Ragya",matches:["*://www.ragya.com/*"],js:"ragya.js",id:"ragya"},{label:"CodeRadio",matches:["*://coderadio.freecodecamp.org/*"],js:"coderadio.js",id:"coderadio"},{label:"LITT Live",matches:["*://littlive.com/*"],js:"littlive.js",id:"dashradio"},{label:"Niconico",matches:["*://www.nicovideo.jp/*"],js:"nicovideo.js",id:"nicovideo"},{label:"Звук",matches:["*://zvuk.com/*"],js:"zvuk.js",id:"zvuk"},{label:"Navidrome",js:"navidrome.js",id:"navidrome"},{label:"deep-cut.fm",matches:["*://deepcut.fm/*","*://turntable.fm/*","*://deep-cut.fm/*","*://deepcuts.fm/*"],js:"deep-cut.fm.js",id:"deepcut.fm"},{label:"Burntable",matches:["*://*.burntable.com/*"],js:"burntable.js",id:"burntable"},{label:"Stingray Music",matches:["*://*.stingray.com/*"],js:"stingray.js",id:"stingray"},{label:"CBC Music",matches:["*://www.cbc.ca/listen/cbc-music-playlists*"],js:"cbcmusic.js",id:"cbcmusic"},{label:"Indie88",matches:["*://indie88.com/lean-stream-player/*","*://cob.leanplayer.com/CINDFM*"],js:"indie88.js",id:"indie88"},{label:"Playlist Randomizer",matches:["*://www.playlist-randomizer.com/*","*://playlist-randomizer.com/*"],js:"playlist-randomizer.js",id:"playlist-randomizer"},{label:"QueUp",matches:["*://www.queup.net/*"],js:"queup.js",id:"queup"},{label:"Live 365",matches:["*://*.live365.com/*"],js:"live365.js",id:"live365"},{label:"Lounge.fm",matches:["*://www.lounge.fm/*"],js:"lounge.fm.js",id:"lounge.fm"},{label:"EulerBeats",matches:["*://eulerbeats.com/*"],js:"eulerbeats.js",id:"eulerbeats"},{label:"FilmMusic.io",matches:["*://*.filmmusic.io/*"],js:"filmmusic.io.js",id:"filmmusic.io"},{label:"X-Team Radio",matches:["*://radio.x-team.com/*"],js:"xteam-radio.js",id:"xteam-radio"},{label:"Calm",matches:["*://*.calm.com/*"],js:"calm.js",id:"calm"},{label:"Keakie",matches:["*://*.keakie.com/*"],js:"keakie.js",id:"keakie"},{label:"KKBOX",matches:["*://*play.kkbox.com/*"],js:"kkbox.js",id:"kkbox"},{label:"Thrill Jockey",matches:["*://thrilljockey.com/products/*"],js:"thrilljockey.js",id:"thrilljockey"},{label:"Radio Horizonte",matches:["*://horizonte.cl/*"],js:"mediastream.js",id:"horizontecl"},{label:"Sonar FM",matches:["*://sonarfm.cl/*"],js:"mediastream.js",id:"sonarfmcl"},{label:"Play FM",matches:["*://playfm.cl/*"],js:"mediastream.js",id:"playfmcl"},{label:"WKM Radio",matches:["*://www.wkmradio.com/*"],js:"mediastream.js",id:"wkmradio"},{label:"Rockaxis",matches:["*://www.rockaxis.com/*"],js:"mediastream.js",id:"rockaxis"},{label:"Rock&Pop Chile",matches:["*://www.rockandpop.cl/*"],js:"rockandpopcl.js",id:"rockandpopcl"},{label:"WYEP",matches:["*://wyep.org/*"],js:"wyep.js",id:"wyep"},{label:"ZENO",matches:["*://*zeno.fm/*"],js:"zeno.js",id:"zeno"},{label:"Naxos Music Library",matches:["*://*.naxosmusiclibrary.com/*"],js:"naxosmusiclibrary.js",id:"naxosmusiclibrary"},{label:"Klassik Radio",matches:["*://*klassikradio.de/*"],js:"klassikradio.de.js",id:"klassikradio"},{label:"Beetle",js:"beetle.js",id:"beetle"},{label:"RefNet",matches:["*://listen.refnet.fm/*"],js:"refnet.js",id:"refnet"},{label:"La Radio du bord de l'eau",matches:["*://*auborddeleau.radio/*"],js:"auborddeleau.radio.js",id:"auborddeleau.radio",allFrames:!0},{label:"Radio Willy",matches:["*://*willy.radio/player/willy/*"],js:"willy.radio.js",id:"willy.radio"},{label:"NIGHT.FM",matches:["*://*night.fm/*"],js:"night.fm.js",id:"night.fm"},{label:"Radio Nowy Swiat",matches:["*://nowyswiat.online/*"],js:"nowyswiat.js",id:"nowyswiat"},{label:"Radiolla",matches:["*://*radiolla.com/*"],js:"radiolla.js",id:"radiolla"},{label:"Oxigenio.fm",matches:["*://*oxigenio.fm/*"],js:"oxigenio.fm.js",id:"oxigenio.fm"},{label:"Intergalactic FM",matches:["*://*intergalactic.fm/*"],js:"intergalacticfm.js",id:"intergalactic.fm"},{label:"Radio Cuca",matches:["*://*radiocuca.es/*"],js:"radiocuca.js",id:"radiocuca"},{label:"Irama Nusantara",matches:["*://*.iramanusantara.org/*"],js:"iramanusantara.js",id:"iramanusantara"},{label:"Yammat FM",matches:["*://*yammat.fm/*"],js:"yammat.fm.js",id:"yammat.fm"},{label:"Husk Recordings",matches:["*://huskrecordings.com/music/*"],js:"huskrecordings.js",id:"huskrecordings"},{label:"nugs.net",matches:["*://play.nugs.net/*"],js:"nugs.js",id:"nugs"},{label:"livephish.com",matches:["*://plus.livephish.com/*"],js:"livephish.js",id:"livephish.com"},{label:"Ishkur's Guide to Electronic Music",matches:["*://music.ishkur.com/*"],js:"ishkur.js",id:"music.ishkur.com"},{label:"Nonoki",matches:["*://nonoki.com/music/*"],js:"nonoki.js",id:"nonoki"},{label:"Beatbump",matches:["*://beatbump.io/*"],js:"beatbump.js",id:"beatbump"},{label:"LINE MUSIC",matches:["*://music.line.me/*"],js:"line-music.js",id:"linemusic"},{label:"KCRW",matches:["*://www.kcrw.com/*"],js:"kcrw.js",id:"kcrw"},{label:"World Fusion Radio",matches:["*://worldfusionradio.com/*"],js:"worldfusionradio.js",id:"worldfusionradio"},{label:"Hardtunes",matches:["*://www.hard-tunes.de/*","*://www.hardtunes.com/*","*://www.hardtunes.fr/*","*://www.hardtunes.it/*","*://www.hardtunes.nl/*"],js:"hardtunes.js",id:"hardtunes"},{label:"KINK",matches:["*://kink.nl/player","*://kink.nl/player/*"],js:"kinknl.js",id:"kinknl"},{label:"The Jazz Groove",matches:["*://jazzgroove.org/*"],js:"jazzgroove.js",id:"jazzgroove"},{label:"XRAY.FM",matches:["*://*.xray.fm/*"],js:"xrayfm.js",id:"xrayfm"},{label:"DKFM Shoegaze Radio",matches:["*://decayfm.com/*"],js:"decayfm.js",id:"decayfm"},{label:"QCIndie",matches:["*://www.qcindie.com/listen-live/*"],js:"qcindie.js",id:"qcindie"},{label:"Colorado Public Radio",matches:["*://www.cpr.org/*"],js:"cpr.js",id:"cpr"},{label:"Indie 102.3",matches:["*://indie.cpr.org/"],js:"cpr-indie.js",id:"cpr-indie"},{label:"WXPN",matches:["*://xpn.org/*"],js:"xpn.js",id:"xpn"},{label:"FRISKY",matches:["*://*.frisky.fm/*"],js:"friskyfm.js",id:"friskyfm"},{label:"GotRadio",matches:["*://player.gotradio.com/*"],js:"gotradio.js",id:"gotradio"},{label:"LightningStream",matches:["*://*.lightningstream.com/Player*","*://*.lightningstream.com/player*"],js:"lightningstream.js",id:"lightningstream"},{label:"Securenet Systems",matches:["*://radio.securenetsystems.net/*","*://stream*.securenetsystems.net/*"],js:"securenetsystems.js",id:"securenetsystems"},{label:"WBRU",matches:["*://www.wbru.com/*"],js:"radioco.js",id:"wbru",allFrames:!0},{label:"uwu radio",matches:["*://radio.uwu.network/*"],js:"uwu-radio.js",id:"uwu-radio"},{label:"MyStreamPlayer",matches:["*://*.mystreamplayer.com/*"],js:"mystreamplayer.js",id:"mystreamplayer"},{label:"BagelRadio",matches:["*://*.bagelradio.com/*"],js:"mystreamplayer.js",id:"bagelradio",allFrames:!0},{label:"Amazing Radio",matches:["*://amazingradio.com/*","*://amazingradio.us/*"],js:"amazingradio.js",id:"amazingradio"},{label:"DR Lyd",matches:["*://www.dr.dk/lyd*"],js:"dr-lyd.js",id:"dr-lyd"},{label:"lulu.fm",matches:["*://*lulu.fm/*"],js:"lulu.fm.js",id:"lulufm"},{label:"ROCK ANTENNE",matches:["*://*rockantenne.*/webradio/*"],js:"rockantenne.js",id:"rockantenne"},{label:"copyparty",matches:["*://127.0.0.1:3923/*","*://a.ocv.me/*"],js:"copyparty.js",id:"copyparty"},{label:"Fungjai",matches:["*://*.fungjai.com/*"],js:"fungjai.js",id:"fungjai"},{label:"Radio Caprice",matches:["*://radcap.ru/*"],js:"radcap.js",id:"radcap"},{label:"TrackerHub",matches:["*://trackerhub.vercel.app/*"],js:"trackerhub.js",id:"trackerhub"},{label:"Gensokyo Radio",matches:["*://gensokyoradio.net/*"],js:"gensokyoradio.js",id:"gensokyoradio"},{label:"Stationhead",matches:["*://*stationhead.com/*"],js:"stationhead.js",id:"stationhead"},{label:"TECHNOBASE.FM",matches:["*://*technobase.fm/*","*://*housetime.fm/*","*://*hardbase.fm/*","*://*trancebase.fm/*","*://*coretime.fm/*","*://*clubtime.fm/*","*://*teatime.fm/*","*://*replay.fm/*"],js:"technobase.fm.js",id:"technobase.fm"},{label:"Telegram A",matches:["*://web.telegram.org/a/*"],js:"telegram-a.js",id:"telegram-a"},{label:"Telegram K",matches:["*://web.telegram.org/k/*"],js:"telegram-k.js",id:"telegram-k"},{label:"TuneGenieEmbed",matches:["*://b3.tunegenie.com/*"],js:"tunegenie-embed.js",id:"tunegenie-embed",allFrames:!0},{label:"TuneGenie",matches:["*://*.tunegenie.com/*"],js:"tunegenie.js",id:"tunegenie"},{label:"RTL+ Musik",matches:["*://plus.rtl.de/*"],js:"rtl-plus-musik.js",id:"rtl-plus-musik"},{label:"Tomorrowland",matches:["*://www.tomorrowland.com/*"],js:"tomorrowland.js",id:"tomorrowland"},{label:"hearthis.at",matches:["*://hearthis.at/*"],js:"hearthis-at.js",id:"hearthis-at"},{label:"Blend",matches:["*://blend.io/*"],js:"blend.js",id:"blend"},{label:"Radio Italia",matches:["*://www.radioitalia.it/*"],js:"radio-italia.js",id:"radio-italia"},{label:"Lyden av Norge",matches:["*://www.lydenavnorge.no/*"],js:"lyden-av-norge.js",id:"lyden-av-norge"},{label:"audio.com",matches:["*://audio.com/*"],js:"audio.js",id:"audio-com"},{label:"AfroCharts",matches:["*://*.afrocharts.com/*"],js:"afrocharts.js",id:"afrocharts"},{label:"Ed Banger Records",matches:["*://*.edbangerrecords.com/*"],js:"ed-banger-records.js",id:"ed-banger-records"},{label:"Hyperpipe",matches:["*://hyperpipe.surge.sh/*"],js:"hyperpipe.js",id:"hyperpipe"},{label:"Radiofreccia",matches:["*://play.rtl.it/live/*"],js:"radiofreccia.js",id:"radiofreccia"},{label:"khinsider",matches:["*://downloads.khinsider.com/*"],js:"khinsider.js",id:"khinsider"},{label:"WDR",matches:["*://*.wdr.de/radio/*"],js:"wdr.js",id:"wdr"},{label:"radio.de",matches:["*://www.radio.de/*"],js:"radio.de.js",id:"radiode"},{label:"FMSpins",matches:["*://*.fmspins.com/*"],js:"fmspins.js",id:"fmspins"},{label:"vk-save",matches:["*://*.vk-save.com/*"],js:"vk-save.js",id:"vk-save"},{label:"Radio Student",matches:["*://www.radiostudent.hr/*"],js:"radiostudent.js",id:"radiostudent"},{label:"BiliBili",matches:["*://www.bilibili.com/*"],js:"bilibili.js",id:"bilibili",usesBlocklist:!0},{label:"jam.coop",matches:["*://jam.coop/*"],js:"jam.coop.js",id:"jam.coop"},{label:"Zing MP3",matches:["*://zingmp3.vn/*"],js:"zingmp3.js",id:"zingmp3"},{label:"NTS Live",matches:["*://*nts.live/live-tracklist/*"],js:"nts-live.js",id:"nts-live"},{label:"NTS Shows",matches:["*://*nts.live/","*://*nts.live/latest*","*://*nts.live/shows*","*://*nts.live/explore*","*://*nts.live/infinite-mixtapes*","*://*nts.live/radio*","*://*nts.live/supporters*","*://*nts.live/my-nts*","*://*nts.live/events*","*://*nts.live/videos*","*://*nts.live/incoming*","*://*nts.live/about*"],js:"nts-shows.js",id:"nts-shows"},{label:"earth.fm",matches:["*://earth.fm/*"],js:"earth.fm.js",id:"earthfm"},{label:"apt-get's auditorium",matches:["*://tunes.apt-get.xyz/*"],js:"apt-get-tunes.js",id:"apt-get-tunes"},{label:"AzuraCast",js:"azuracast.js",id:"azuracast"},{label:"scrobblerad.io",matches:["*://scrobblerad.io/*"],js:"scrobbleradio.js",id:"scrobbleradio"},{label:"weareone.fm",matches:["*://weareone.fm/*"],js:"weareone.js",id:"weareone"},{label:"Bollerwagen",matches:["*://radiobollerwagen.de/*"],js:"bollerwagen.js",id:"bollerwagen"},{label:"МТС Музыка",matches:["*://music.mts.ru/*"],js:"mts-music.js",id:"mts-music"},{label:"ChirpRadio",matches:["*://chirpradio.org/*"],js:"chirpradio.js",id:"chirpradio"},{label:"InstantAudio",matches:["*://instant.audio/*","*://radiosdecuba.com/*","*://radio.ht/*","*://jamaicaradio.net/*","*://emisoras.com.mx/*","*://radiosdepuertorico.com/*","*://radios.com.do/*","*://trinidadradiostations.net/*","*://radios.co.cr/*","*://radios.com.sv/*","*://emisoras.com.gt/*","*://radios.hn/*","*://radios.co.ni/*","*://radios.com.pa/*","*://radioarg.com/*","*://radios.com.bo/*","*://radiosaovivo.net/*","*://emisora.cl/*","*://radios.com.co/*","*://radios.com.ec/*","*://emisoras.com.py/*","*://radios.com.pe/*","*://surinaamseradio.com/*","*://radios.com.uy/*","*://radio.co.ve/*","*://radiosonline.be/*","*://ceskaradiaonline.cz/*","*://radio.co.dk/*","*://radiolisten.de/*","*://raadiod.com/*","*://emisora.org.es/*","*://ecouterradioenligne.com/*","*://radiofona.com.gr/*","*://radios.hr/*","*://ieradio.org/*","*://ascoltareradio.com/*","*://latvijasradio.com/*","*://radios.lu/*","*://radijas.org/*","*://radiohallgatas.hu/*","*://nederlandseradio.nl/*","*://nettradionorge.com/*","*://radios.co.at/*","*://onlineradio.pl/*","*://radioonline.com.pt/*","*://radio.org.ro/*","*://radiosonline.ch/*","*://siradio.si/*","*://radiostanice.rs/*","*://nettiradiot.org/*","*://radio.org.se/*","*://internetradiouk.com/*","*://bg-radio.org/*","*://radio.pp.ru/*","*://radioua.net/*","*://radioalgerie.eu/*","*://radio.co.cm/*","*://radio.cd/*","*://radio.co.ci/*","*://radio.com.gh/*","*://radio.or.ke/*","*://radio.mg/*","*://radio.co.ma/*","*://egyptradio.net/*","*://radio.org.ng/*","*://radio.sn/*","*://radiosa.org/*","*://radiotunisienne.org/*","*://radio.co.ug/*","*://radio-bd.com/*","*://radioonline.kr/*","*://radios.hk/*","*://onlineradios.in/*","*://radioonline.co.id/*","*://radioonline.my/*","*://radionp.com/*","*://jpradio.jp/*","*://radio.net.pk/*","*://radio.org.ph/*","*://radiosingapore.org/*","*://radio.com.lk/*","*://vietnamradio.org/*","*://radios.org.il/*","*://radioth.net/*","*://zhibo.fm/*","*://radios.tw/*","*://radioau.net/*","*://radio.org.nz/*"],js:"instantaudio.js",id:"instantaudio"},{label:"Basspistol Radio",matches:["*://*.basspistol.com/*"],js:"basspistol.js",id:"basspistol"},{label:"RadioFreeFedi",matches:["*://radiofreefedi.net/*"],js:"radiofreefedi.js",id:"radiofreefedi"},{label:"MyTuner",matches:["*://mytuner-radio.com/*"],js:"mytuner.js",id:"mytuner"},{label:"Mirlo",matches:["*://mirlo.space/*"],js:"mirlo.js",id:"mirlo"},{label:"Simulator Radio",matches:["*://*.simulatorradio.com/*"],js:"simulatorradio.js",id:"simulatorradio"}];function ht(s){return s.replace(/[$()*+.?[\\^{|}]/g,"\\$&")}function bt(s){return s.split("*").map(ht).join(".*")}function ps(s){if(typeof s!="string")return null;const e=/^(\*|https?):\/\/([^/]*)(\/.*)/.exec(s);if(!e)return null;const t=e[1],a=e[2],r=e[3];let o="^";if(t==="*"?o+="https?":o+=`${t}`,o+=ht("://"),a==="*")o+="[^\\/]+";else if(a){let d=a;a.startsWith("*.")&&(o+="([^\\/]+\\.|)",d=d.substr(2)),o+=bt(d)}else return null;return o+=bt(r),o+="$",new RegExp(o)}function ws(s,e){const t=ps(e);return t?t.test(s):!1}const js=E(Ee);function ys(){return js.get()}async function Ie(s){const e=await ys()||{};for(const t of Ne){const a=t.matches||[];e[t.id]&&a.push(...e[t.id]);for(const r of a)if(ws(s,r))return t}return null}const O=E(Pe),Y=E(ke),he=E(Re),be="useNotifications",fe="useUnrecognizedSongNotifications",Ce="showInfobox",Ue="scrobblePodcasts",_e="autoToggleLove",Me="forceRecognize",De="scrobbleRecognizedTracks",ze="scrobbleEditedTracksOnly",ft="scrobblePercent",I="disabledConnectors",pt="debugLoggingEnabled",wt="albumGuessingDisabled",jt="albumGuessingUneditedOnly",yt="albumGuessingAllTracks",At={[Me]:!1,[Ue]:!0,[be]:!0,[fe]:!1,[De]:!0,[ze]:!1,[pt]:!1,[ft]:is,[Ce]:!0,[_e]:!0,[wt]:!1,[jt]:!0,[yt]:!1,[I]:{}},As={[Me]:!1,[De]:!0,[ze]:!1,[Ue]:!0,[be]:!0,[fe]:!1,[Ce]:!0,[_e]:!0},se={YouTube:{scrobbleMusicOnly:!1,scrobbleEntertainmentOnly:!1,scrobbleMusicRecognisedOnly:!1,enableGetTrackInfoFromYtMusic:!1}};async function Ss(){const s={...At,...await O.get()};await O.set(s),O.debugLog([I]);const e={...se,...await Y.get()};for(const t in se){const a=t;e[a]={...se[a],...e[a]}}await Y.set(e),Y.debugLog(),he.debugLog()}async function vs(){const s=await O.get();if(!s)throw new Error("No options data found");for(const e of Object.keys(s[I])){let t=!1;for(const a of Ne)if(a.id===e){t=!0;break}t||(delete s[I][e],R(`Remove ${e} from storage`))}}async function Be(s,e){if(vt(s),e!==void 0){const a=await St(e,s);if(a!==void 0)return a}const t=await O.get();return t==null?void 0:t[s]}async function ks(s,e){vt(s),await O.update({[s]:e})}async function Rs(s,e){kt(s),Rt(s,e);const t=await Y.get();return t==null?void 0:t[s][e]}async function Es(s,e,t){kt(s),Rt(s,e);const a=await Y.get();if(!(a!=null&&a[s]))throw new Error(`Connector ${s} not found in storage`);a[s][e]=t,await Y.set(a)}async function St(s,e){var a;if(!xs(e))return;const t=await he.get();return(a=t==null?void 0:t[s])==null?void 0:a[e]}async function Ts(s,e,t){const a=await he.get();if(!a)throw new Error("No connectors override data found");a[s]||(a[s]={}),a[s][e]=t,await he.set(a)}function vt(s){if(!(s in At))throw new Error(`Unknown option key: ${s}`);return!0}function xs(s){return s in As}function kt(s){if(!(s in se))throw new Error(`Unknown connector: ${s}`);return!0}function Rt(s,e){if(!(e in se[s]))throw new Error(`Unknown connector option key: ${e}`);return!0}async function Ls(s){const e=await O.get();if(!e)throw new Error("No options data found");return!e[I][s.id]}async function Ps(s,e){const t=await O.get();if(!t)throw new Error("No options data found");e?delete t[I][s.id]:t[I][s.id]=!0,await O.set(t)}async function Os(s){const e=await O.get();if(!e)throw new Error("No options data found");if(e[I]={},!s)for(const t of Ne)e[I][t.id]=!0;await O.set(e)}Ss().then(vs);const Ns=Object.freeze(Object.defineProperty({__proto__:null,ALBUM_GUESSING_ALL_TRACKS:yt,ALBUM_GUESSING_DISABLED:wt,ALBUM_GUESSING_UNEDITED_ONLY:jt,AUTO_TOGGLE_LOVE:_e,DEBUG_LOGGING_ENABLED:pt,DISABLED_CONNECTORS:I,FORCE_RECOGNIZE:Me,SCROBBLE_EDITED_TRACKS_ONLY:ze,SCROBBLE_PERCENT:ft,SCROBBLE_PODCASTS:Ue,SCROBBLE_RECOGNIZED_TRACKS:De,USE_INFOBOX:Ce,USE_NOTIFICATIONS:be,USE_UNRECOGNIZED_SONG_NOTIFICATIONS:fe,getConnectorOption:Rs,getConnectorOverrideOption:St,getOption:Be,isConnectorEnabled:Ls,setAllConnectorsEnabled:Os,setConnectorEnabled:Ps,setConnectorOption:Es,setConnectorOverrideOption:Ts,setOption:ks},Symbol.toStringTag,{value:"Module"}));class pe{getArtist(){return this.processed.artist||this.parsed.artist}getTrack(){return this.processed.track||this.parsed.track}getAlbum(){return this.processed.album||this.parsed.album}getAlbumArtist(){return this.processed.albumArtist||this.parsed.albumArtist}getDuration(){return this.parsed.duration||this.processed.duration}getTrackArt(){return this.parsed.trackArt||this.metadata.trackArtUrl||null}getArtistTrackString(){return this.isEmpty()?null:`${this.getArtist()??"undefined"} — ${this.getTrack()??"undefined"}`}getUniqueId(){return this.parsed.uniqueID}getOriginUrl(){return this.parsed.originUrl}isEmpty(){return!(this.getArtist()&&this.getTrack())}isValid(){return this.flags.isValid||this.flags.isCorrectedByUser}equals(e){if(!e||!(e instanceof pe))return!1;const t=this.getUniqueId(),a=e.getUniqueId();return t||a?t===a:this.getArtist()===e.getArtist()&&this.getTrack()===e.getTrack()&&this.getAlbum()===e.getAlbum()}toString(){return JSON.stringify(this,null,2)}getCloneableData(){return{parsed:this.parsed,noRegex:this.noRegex,processed:this.processed,metadata:this.metadata,flags:this.flags,connector:this.connector}}setLoveStatus(e,t=!1){if(t){this.metadata.userloved=e;return}e?this.metadata.userloved===void 0&&(this.metadata.userloved=!0):this.metadata.userloved=!1}static get USER_FIELDS(){return["artist","track","album","albumArtist"]}static get BASE_FIELDS(){return["artist","track","album","albumArtist"]}static get PROCESSED_FIELDS(){return["track","album","artist","albumArtist","duration"]}}class Fe extends pe{constructor(e,t){super(),this.parsed=Object.assign({track:null,artist:null,albumArtist:null,album:null,duration:null},e),this.processed={track:null,artist:null,albumArtist:null,album:null,duration:null},this.noRegex={track:null,artist:null,albumArtist:null,album:null,duration:null},this.flags={},this.metadata={},this.connector=t,this.initSongData()}resetInfo(){this.initProcessedData()}resetData(){this.initFlags(),this.initMetadata()}initSongData(){this.initFlags(),this.initMetadata(),this.initProcessedData()}initFlags(){this.flags={isScrobbled:!1,isCorrectedByUser:!1,isRegexEditedByUser:{track:!1,artist:!1,album:!1,albumArtist:!1},isAlbumFetched:!1,isValid:!1,isMarkedAsPlaying:!1,isSkipped:!1,isReplaying:!1,hasBlockedTag:!1,isLovedInService:null,finishedProcessing:!1}}initMetadata(){this.metadata={userloved:void 0,startTimestamp:Math.floor(Date.now()/1e3),label:this.connector.label}}initProcessedData(){for(const e of Fe.PROCESSED_FIELDS)this.processed[e]=null,this.noRegex[e]=null}}var Et={exports:{}};(function(s){(function(e){function t(n,c){var i=(n&65535)+(c&65535),b=(n>>16)+(c>>16)+(i>>16);return b<<16|i&65535}function a(n,c){return n<<c|n>>>32-c}function r(n,c,i,b,w,y){return t(a(t(t(c,n),t(b,y)),w),i)}function o(n,c,i,b,w,y,k){return r(c&i|~c&b,n,c,w,y,k)}function d(n,c,i,b,w,y,k){return r(c&b|i&~b,n,c,w,y,k)}function p(n,c,i,b,w,y,k){return r(c^i^b,n,c,w,y,k)}function j(n,c,i,b,w,y,k){return r(i^(c|~b),n,c,w,y,k)}function S(n,c){n[c>>5]|=128<<c%32,n[(c+64>>>9<<4)+14]=c;var i,b,w,y,k,m=1732584193,l=-271733879,g=-1732584194,u=271733878;for(i=0;i<n.length;i+=16)b=m,w=l,y=g,k=u,m=o(m,l,g,u,n[i],7,-680876936),u=o(u,m,l,g,n[i+1],12,-389564586),g=o(g,u,m,l,n[i+2],17,606105819),l=o(l,g,u,m,n[i+3],22,-1044525330),m=o(m,l,g,u,n[i+4],7,-176418897),u=o(u,m,l,g,n[i+5],12,1200080426),g=o(g,u,m,l,n[i+6],17,-1473231341),l=o(l,g,u,m,n[i+7],22,-45705983),m=o(m,l,g,u,n[i+8],7,1770035416),u=o(u,m,l,g,n[i+9],12,-1958414417),g=o(g,u,m,l,n[i+10],17,-42063),l=o(l,g,u,m,n[i+11],22,-1990404162),m=o(m,l,g,u,n[i+12],7,1804603682),u=o(u,m,l,g,n[i+13],12,-40341101),g=o(g,u,m,l,n[i+14],17,-1502002290),l=o(l,g,u,m,n[i+15],22,1236535329),m=d(m,l,g,u,n[i+1],5,-165796510),u=d(u,m,l,g,n[i+6],9,-1069501632),g=d(g,u,m,l,n[i+11],14,643717713),l=d(l,g,u,m,n[i],20,-373897302),m=d(m,l,g,u,n[i+5],5,-701558691),u=d(u,m,l,g,n[i+10],9,38016083),g=d(g,u,m,l,n[i+15],14,-660478335),l=d(l,g,u,m,n[i+4],20,-405537848),m=d(m,l,g,u,n[i+9],5,568446438),u=d(u,m,l,g,n[i+14],9,-1019803690),g=d(g,u,m,l,n[i+3],14,-187363961),l=d(l,g,u,m,n[i+8],20,1163531501),m=d(m,l,g,u,n[i+13],5,-1444681467),u=d(u,m,l,g,n[i+2],9,-51403784),g=d(g,u,m,l,n[i+7],14,1735328473),l=d(l,g,u,m,n[i+12],20,-1926607734),m=p(m,l,g,u,n[i+5],4,-378558),u=p(u,m,l,g,n[i+8],11,-2022574463),g=p(g,u,m,l,n[i+11],16,1839030562),l=p(l,g,u,m,n[i+14],23,-35309556),m=p(m,l,g,u,n[i+1],4,-1530992060),u=p(u,m,l,g,n[i+4],11,1272893353),g=p(g,u,m,l,n[i+7],16,-155497632),l=p(l,g,u,m,n[i+10],23,-1094730640),m=p(m,l,g,u,n[i+13],4,681279174),u=p(u,m,l,g,n[i],11,-358537222),g=p(g,u,m,l,n[i+3],16,-722521979),l=p(l,g,u,m,n[i+6],23,76029189),m=p(m,l,g,u,n[i+9],4,-640364487),u=p(u,m,l,g,n[i+12],11,-421815835),g=p(g,u,m,l,n[i+15],16,530742520),l=p(l,g,u,m,n[i+2],23,-995338651),m=j(m,l,g,u,n[i],6,-198630844),u=j(u,m,l,g,n[i+7],10,1126891415),g=j(g,u,m,l,n[i+14],15,-1416354905),l=j(l,g,u,m,n[i+5],21,-57434055),m=j(m,l,g,u,n[i+12],6,1700485571),u=j(u,m,l,g,n[i+3],10,-1894986606),g=j(g,u,m,l,n[i+10],15,-1051523),l=j(l,g,u,m,n[i+1],21,-2054922799),m=j(m,l,g,u,n[i+8],6,1873313359),u=j(u,m,l,g,n[i+15],10,-30611744),g=j(g,u,m,l,n[i+6],15,-1560198380),l=j(l,g,u,m,n[i+13],21,1309151649),m=j(m,l,g,u,n[i+4],6,-145523070),u=j(u,m,l,g,n[i+11],10,-1120210379),g=j(g,u,m,l,n[i+2],15,718787259),l=j(l,g,u,m,n[i+9],21,-343485551),m=t(m,b),l=t(l,w),g=t(g,y),u=t(u,k);return[m,l,g,u]}function A(n){var c,i="",b=n.length*32;for(c=0;c<b;c+=8)i+=String.fromCharCode(n[c>>5]>>>c%32&255);return i}function N(n){var c,i=[];for(i[(n.length>>2)-1]=void 0,c=0;c<i.length;c+=1)i[c]=0;var b=n.length*8;for(c=0;c<b;c+=8)i[c>>5]|=(n.charCodeAt(c/8)&255)<<c%32;return i}function q(n){return A(S(N(n),n.length*8))}function B(n,c){var i,b=N(n),w=[],y=[],k;for(w[15]=y[15]=void 0,b.length>16&&(b=S(b,n.length*8)),i=0;i<16;i+=1)w[i]=b[i]^909522486,y[i]=b[i]^1549556828;return k=S(w.concat(N(c)),512+c.length*8),A(S(y.concat(k),640))}function U(n){var c="0123456789abcdef",i="",b,w;for(w=0;w<n.length;w+=1)b=n.charCodeAt(w),i+=c.charAt(b>>>4&15)+c.charAt(b&15);return i}function _(n){return unescape(encodeURIComponent(n))}function $(n){return q(_(n))}function H(n){return U($(n))}function G(n,c){return B(_(n),_(c))}function K(n,c){return U(G(n,c))}function W(n,c,i){return c?i?G(c,n):K(c,n):i?$(n):H(n)}s.exports?s.exports=W:e.md5=W})(Xe)})(Et);var Is=Et.exports;const Tt=et(Is);class qe{constructor(){this.storageRef=null}_init(e){this.storageRef=e}async clear(){if(this.storageRef)return await this.storageRef.clear()}async getData(){return this.storageRef?await this.storageRef.get():(D("Storage reference is not initialized","warn"),null)}async saveData(e){if(!this.storageRef){D("Storage reference is not initialized","warn");return}return await this.storageRef.set(e)}async updateData(e){if(!this.storageRef){D("Storage reference is not initialized","warn");return}return await this.storageRef.update(e)}}class z extends qe{async loadSongInfo(e){let t=z.getSongId(e);const a=await this.getSongInfoStorage();if((!a||!(t in a))&&(t=z.makeSongId(e,["artist","track","album"])),(!a||!(t in a))&&(t=z.makeSongId(e,["artist","track"])),a&&t in a){const r=a[t];return z.applyLoadedInfo(e,r),!0}return!1}async saveSongInfo(e,t){const a=z.getSongId(e),r=await this.getSongInfoStorage();if(r===null){await this.saveSongInfoToStorage({[a]:t});return}r[a]={...r[a],...t},await this.saveSongInfoToStorage(r)}async removeSongInfo(e){if(e===null)throw new Error("Song is null");const t=z.getSongId(e);await this.removeSongInfoById(t)}async removeSongInfoById(e){const t=await this.getSongInfoStorage();t!==null&&(delete t[e],await this.saveSongInfoToStorage(t))}static applyLoadedInfo(e,t){e.processed={...e.processed,...t}}static getSongId(e){const t=e.getUniqueId();return t||z.makeSongId(e,Fe.BASE_FIELDS)}static makeSongId(e,t){let a="";for(const r of t)e.parsed[r]&&(a+=e.parsed[r]);if(a)return Tt(a);throw new Error("Empty song")}}class Cs extends z{constructor(){super(...arguments),this.songInfoStorage=E(ee)}init(){this._init(Q(ee))}async clear(){return await this.songInfoStorage.clear()}async getSongInfoStorage(){return this.songInfoStorage.get()}async saveSongInfoToStorage(e){return await this.songInfoStorage.set(e)}getStorage(){return E(ee)}}new Cs;const $e=s=>({isGlobal:s.isGlobal,isCaseInsensitive:s.isCaseInsensitive,isRegexDisabled:s.isRegexDisabled}),xt=s=>s.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");function Lt(s){let e="";return s.isGlobal&&(e+="g"),s.isCaseInsensitive&&(e+="i"),e}function Us(s,e){for(const[t,a]of Object.entries(s)){const r=t;if(a!==null&&e.flags.isRegexEditedByUser[r])return!0}return!1}function _s(s,e){if(Us(s.replace,e))return!1;const t=$e(s);for(const[a,r]of Object.entries(s.search)){const d=ae(e,a);if(!Pt(r,d,t))return!1}return!0}function Pt(s,e,t){if(s===null)return!0;const a=t.isRegexDisabled?xt(s):s;try{return new RegExp(t.isGlobal?a:`^${a}$`,Lt(t)).test(e)}catch{return!1}}function Ms(s,e,t,a){if(s===null||e===null)return t;const r=a.isRegexDisabled?xt(s):s;try{const o=new RegExp(a.isGlobal?r:`^${r}$`,Lt(a));return t.replace(o,e)}catch{return t}}function Ds(s,e){const t=$e(s);for(const a of Object.keys(e)){const r=a;if(!Pt(s.search[r],e[r],t))return e}for(const a of Object.keys(e)){const r=a;e[r]=Ms(s.search[r],s.replace[r],e[r],$e(s))}return e}function zs(s){return{track:ae(s,"track"),artist:ae(s,"artist"),album:ae(s,"album"),albumArtist:ae(s,"albumArtist")}}function Bs(s,e){const t=Ds(s,zs(e));for(const[a,r]of Object.entries(t)){const o=a;s.search[o]&&typeof s.replace[o]=="string"&&(e.flags.isRegexEditedByUser[o]=!0,e.processed[o]=r)}}function Fs(s){return s.charAt(0).toUpperCase()+s.slice(1)}function ae(s,e){return s[`get${Fs(e)}`]()??""}const qs=[{search:{track:null,artist:null,album:"(.*) - Single",albumArtist:null},replace:{track:null,artist:null,album:"$1",albumArtist:null}},{search:{track:null,artist:null,album:"(.*) - EP",albumArtist:null},replace:{track:null,artist:null,album:"$1",albumArtist:null}}];async function $s(){const s=E(te);await s.get()||s.set(qs)}class Hs extends qe{async loadSongInfo(e){const t=await this.getRegexEditStorage();if(t)for(let a=t.length-1;a>=0;a--)_s(t[a],e)&&Bs(t[a],e)}async saveRegexEdit(e){e.search={...e.search},e.replace={...e.replace};const t=await this.getRegexEditStorage();if(t===null){await this.saveRegexEditToStorage([e]);return}const a=[...t,e];await this.saveRegexEditToStorage(a)}async deleteRegexEdit(e){const t=await this.getRegexEditStorage();t!==null&&(t.splice(e,1),await this.saveRegexEditToStorage(t))}}class Gs extends Hs{constructor(){super(...arguments),this.regexEditStorage=this.getStorage()}init(){this._init(Q(te))}async getRegexEditStorage(){return this.regexEditStorage.get()}async saveRegexEditToStorage(e){return await this.regexEditStorage.set(e)}getStorage(){return E(te)}}new Gs;class Ks extends qe{constructor(){super(...arguments),this.MAX_SCROBBLE_CACHE_SIZE=1e3}async replaceScrobble(e,t){const a=await this.getScrobbleCacheStorageLocking();if(a){for(let r=0;r<a.length;r++)a[r].id===e&&(a[r]={...t,id:e});await this.saveScrobbleCacheToStorageLocking(a)}}async pushScrobble(e){var r;const t=await this.getScrobbleCacheStorageLocking();if(t===null)return await this.saveScrobbleCacheToStorageLocking([{...e,id:1}]),1;const a=(((r=t.at(-1))==null?void 0:r.id)??0)+1;return t.push({...e,id:a}),await this.saveScrobbleCacheToStorageLocking(t.slice(-this.MAX_SCROBBLE_CACHE_SIZE)),a}async deleteScrobbles(e){const t=await this.getScrobbleCacheStorageLocking();if(!t)return;const a=new Map;for(const r of e)a.set(r,!0);await this.saveScrobbleCacheToStorageLocking(t.filter(r=>a.get(r.id)!==!0))}}class Ws extends Ks{constructor(){super(...arguments),this.scrobbleCacheStorage=this.getStorage()}init(){this._init(Q(ge))}async getScrobbleCacheStorage(){return this.scrobbleCacheStorage.get()}async getScrobbleCacheStorageLocking(){return this.scrobbleCacheStorage.getLocking()}async saveScrobbleCacheToStorage(e){return await this.scrobbleCacheStorage.set(e)}async saveScrobbleCacheToStorageLocking(e){return await this.scrobbleCacheStorage.setLocking(e)}getStorage(){return E(ge)}}const Js=new Ws,He={[Wt]:!0,[Yt]:!0,[Zt]:!0,[Xt]:!0,[Qt]:!0,[es]:!0,[Vt]:!0,[Jt]:!0,[ts]:!0,[ss]:!0};E(me);class C extends pe{constructor(e,t){super(),this.parsed=e.parsed,this.processed=e.processed,this.noRegex=e.noRegex,this.flags=e.flags,this.metadata=e.metadata,this.connector=e.connector,this.controllerTabId=t}resetData(){P(this.controllerTabId,{type:"resetData",payload:void 0})}resetInfo(){P(this.controllerTabId,{type:"resetInfo",payload:void 0})}}async function Vs(s){ds({type:"currentTab",payload:s}).catch(e=>{console.warn(e)}),await Qs(s),Ys(s)}async function Qs(s){var r,o,d,p,j,S,A,N,q,B,U,_,$,H,G,K,W,n,c,i;if(s.mode===X){(r=h.contextMenus)==null||r.update(v.ENABLE_CONNECTOR,{visible:!1}),(o=h.contextMenus)==null||o.update(v.DISABLE_CONNECTOR,{visible:!1}),(d=h.contextMenus)==null||d.update(v.DISABLE_UNTIL_CLOSED,{visible:!1}),(p=h.contextMenus)==null||p.update(v.DISABLE_CHANNEL,{visible:!1}),(j=h.contextMenus)==null||j.update(v.ENABLE_CHANNEL,{visible:!1});return}const e=await h.tabs.get(s.tabId),t=await Ie(e.url??"");if(s.mode===Ze){(S=h.contextMenus)==null||S.update(v.ENABLE_CONNECTOR,{visible:!0,title:J("menuEnableConnector",t==null?void 0:t.label)}),(A=h.contextMenus)==null||A.update(v.DISABLE_CONNECTOR,{visible:!1}),(N=h.contextMenus)==null||N.update(v.DISABLE_UNTIL_CLOSED,{visible:!1}),(q=h.contextMenus)==null||q.update(v.DISABLE_CHANNEL,{visible:!1}),(B=h.contextMenus)==null||B.update(v.ENABLE_CHANNEL,{visible:!1});return}(U=h.contextMenus)==null||U.update(v.ENABLE_CONNECTOR,{visible:!1}),(_=h.contextMenus)==null||_.update(v.DISABLE_CONNECTOR,{visible:!0,title:J("menuDisableConnector",t==null?void 0:t.label)}),($=h.contextMenus)==null||$.update(v.DISABLE_UNTIL_CLOSED,{visible:!0,title:J("menuDisableUntilTabClosed",t==null?void 0:t.label)});const a=await ta(s.tabId);!a||!((H=a.channelInfo)!=null&&H.id)||!a.connector?((G=h.contextMenus)==null||G.update(v.DISABLE_CHANNEL,{visible:!1}),(K=h.contextMenus)==null||K.update(v.ENABLE_CHANNEL,{visible:!1})):await sa(a.channelInfo.id,a.connector)?((W=h.contextMenus)==null||W.update(v.DISABLE_CHANNEL,{visible:!1}),(n=h.contextMenus)==null||n.update(v.ENABLE_CHANNEL,{visible:!0,title:J("menuEnableChannel",a.channelInfo.label)})):((c=h.contextMenus)==null||c.update(v.DISABLE_CHANNEL,{visible:!0,title:J("menuDisableChannel",a.channelInfo.label)}),(i=h.contextMenus)==null||i.update(v.ENABLE_CHANNEL,{visible:!1}))}function we(s){const e=h.runtime.getURL(s);return e.startsWith("safari")?s:e}async function Ys(s){let e="";if(s.song){const r=new C(s.song,-1);e=`${r.getArtist()} - ${r.getTrack()}`}const t=await Zs(),a=r=>`icons/action_${s.mode.toLowerCase()}_${r}_${t}.png`;h.action.setIcon({path:{16:we(a(16)),19:we(a(19)),32:we(a(32)),38:we(a(38))}}),h.action.setTitle({title:J(`pageAction${s.mode}`,e)})}async function Zs(){return h.notifications?oa():"safari"}const re=E(ue),Xs=E(Le),v={ENABLE_CONNECTOR:"enableConnector",DISABLE_CONNECTOR:"disableConnector",DISABLE_UNTIL_CLOSED:"disableUntilClosed",ENABLE_CHANNEL:"enableChannel",DISABLE_CHANNEL:"disableChannel"};async function ea(s,e){if(!s)return[];const t=[];for(const r of s)t.push(e(r));const a=[];for(const[r,o]of(await Promise.all(t)).entries())o&&a.push(s[r]);return a}async function Ge(s){return ea(s,async e=>{try{const t=await h.tabs.get(e.tabId);return await Ie(t.url??""),!0}catch{return!1}})}async function ta(s){return P(s,{type:"getChannelDetails",payload:void 0})}async function sa(s,e){var a;const t=(a=await Xs.get())==null?void 0:a[e.id];return!t||!t[s]?null:t[s]}function aa(){return re.unlock()}async function ie(s){return re.setLocking(s)}async function je(s,e){const t=await Ke(s,e);return Vs(t),t}async function Ke(s,e){const t=ia(s);let a=e;a||(a=await ye());const r=await ra(a);return t&&!He[r.mode]?t:r}async function ra(s){try{if(!await h.tabs.get(s))throw new Error("Tab not found");const t=await P(s,{type:"getConnectorDetails",payload:void 0});return{tabId:s,mode:t.mode,permanentMode:t.permanentMode,song:t.song}}catch{return{tabId:s,mode:X,permanentMode:X,song:null}}}function ia(s){for(const e of s)if(He[e.mode])return e;return null}async function ye(){const s={active:!0,lastFocusedWindow:!0},[e]=await h.tabs.query(s);return(e==null?void 0:e.id)??-1}async function Ot(){const s=await re.get()??We;return Ke(s.activeTabs)}async function Ae(){return await re.getLocking()??We}async function oa(){var s;return((s=await re.get())==null?void 0:s.browserPreferredTheme)??"light"}const We={activeTabs:[],browserPreferredTheme:"light"};function Nt(s){P(s,{type:"setConnectorState",payload:!1})}function It(s){P(s,{type:"setConnectorState",payload:!0})}function na(s){P(s,{type:"addToBlocklist",payload:void 0})}function la(s){P(s,{type:"removeFromBlocklist",payload:void 0})}function ca(s){P(s,{type:"disableConnectorUntilTabIsClosed",payload:void 0})}class da{constructor(){this.storage=E(xe)}async saveHasNotified(e){if(!e)return;let t=await this.storage.getLocking();t||(t={}),t[e]=!0,await this.storage.setLocking(t)}async shouldNotifyAboutNativeScrobbler(e){const t=await this.storage.get();return t?!t[e]:!0}}const ua=h.runtime.getManifest(),ma={type:"basic",iconUrl:h.runtime.getURL(((qt=ua.icons)==null?void 0:qt["128"])??"")},Se=h.runtime.getURL("/img/cover_art_default.png"),ga=h.runtime.getURL("img/cover_art_unknown.png"),ha=5e3,oe={};let ve=null;async function ba(){return!!(h!=null&&h.notifications)}async function Ct(s){return Be(be,s.id)}function fa(s,e){oe[s]=e}function pa(s){oe[s]&&delete oe[s]}async function ne(s,e){var r,o;if(!await ba())throw new Error("Notifications are not available");typeof e=="function"&&(s.isClickable=!0);const t={...ma,...s};let a;try{a=await((r=h.notifications)==null?void 0:r.create("",t))}catch(d){if(t.iconUrl===Se)throw d;t.iconUrl=Se,a=await((o=h.notifications)==null?void 0:o.create("",t))}return typeof e=="function"&&fa(a,e),a}async function wa(s){const e=new da;if(!s.hasNativeScrobbler||!await e.shouldNotifyAboutNativeScrobbler(s.id))return;const t={title:h.i18n.getMessage("notificationNativeScrobbler",s.label),message:h.i18n.getMessage("notificationNativeScrobblerText")};try{await ne(t,()=>{h.tabs.create({url:h.runtime.getURL("src/ui/options/index.html?p=connectors")})}),await e.saveHasNotified(s.id)}catch(a){R("Unable to show native scrobbler notification: ","warn"),R(a,"warn")}}async function ja(s,e,t){if(!await Ct(e))return;const a=s.metadata.label,r=s.getTrackArt()||Se;let o=s.getArtist(),d=s.getTrack();o=`${s.getTrack()}
${s.getArtist()}`,d=`Web Scrobbler • ${a}`;const p=s.getAlbum();p&&(o=`${o??"null"}
${p}`);const j=s.metadata.userPlayCount;if(j){const A=h.i18n.getMessage("infoYourScrobbles",j.toString());o=`${o??"null"}
${A}`}const S={iconUrl:r,title:d??"null",message:o??"null"};Ut(),ve=setTimeout(()=>{ne(S,t).then(A=>{s.metadata.notificationId=A}).catch(A=>{R("Unable to show now playing notification: ","warn"),R(A,"warn")})},ha)}function ya(s){if(!s.metadata.notificationId)throw new Error("Notification ID is not set");Ut(),Ta(s.metadata.notificationId)}async function Aa(s,e,t){if(!await Be(fe,e.id))return;const a={iconUrl:ga,title:h.i18n.getMessage("notificationNotRecognized"),message:h.i18n.getMessage("notificationNotRecognizedText")};try{const r=await ne(a,t);s.metadata.notificationId=r}catch(r){R("Unable to show song not recognized notification: ","warn"),R(r,"warn")}}const Sa=3,Je=E(Te);async function va(){var e;return(((e=await Je.get())==null?void 0:e.authDisplayCount)||0)<Sa}async function ka(){let s=await Je.get();s||(s={authDisplayCount:0}),s.authDisplayCount=s.authDisplayCount+1,await Je.set(s)}async function Ra(){if(!await va())return;const s={title:h.i18n.getMessage("notificationConnectAccounts"),message:h.i18n.getMessage("notificationConnectAccountsText")};try{await ne(s,()=>{h.tabs.create({url:h.runtime.getURL("src/ui/options/index.html?p=accounts")})})}catch(e){R("Unable to show auth notification: ","warn"),R(e,"warn"),h.tabs.create({url:h.runtime.getURL("src/ui/options/index.html?p=accounts")})}ka()}async function Ea(s,e){if(!await Ct(s.connector))return;const t=s.getTrackArt()||Se,a=`${s.getTrack()}
${s.getArtist()}`,r=e?h.i18n.getMessage("pageActionLoved",a):h.i18n.getMessage("pageActionUnloved",a),o={iconUrl:t,title:r,message:a};try{await ne(o,null)}catch(d){R("Unable to show loved notification: ","warn"),R(d,"warn")}}function Ta(s){var e;s&&((e=h.notifications)==null||e.clear(s))}function Ut(){ve&&(clearTimeout(ve),ve=null)}($t=h.notifications)==null||$t.onClicked.addListener(s=>{R(`Notification onClicked: ${s}`),oe[s]&&oe[s](s)}),(Ht=h.notifications)==null||Ht.onClosed.addListener(s=>{pa(s)});async function xa(s){if(typeof s.id>"u")throw new Error(`Could not identify tab: ${JSON.stringify(s)}`);let e=s.url;if(typeof e>"u"&&(e=await h.tabs.get(s.id).then(t=>t.url)),typeof e>"u")throw new Error(`Could not identify URL of tab: ${JSON.stringify(s)}`);return La(s.id,e)}async function La(s,e){if(!await Ie(e))return;h.scripting.executeScript({target:{tabId:s},files:["content/main.js"]})}async function Pa(){var e;const s=await((e=h.tabs)==null?void 0:e.query({}));for(const t of s??[])try{await xa(t)}catch(a){console.warn("Error while injecting into tab: ",a)}}class le{constructor(){this.userApiUrl=null,this.userToken=null,this.arrayProperties=null,this.storage=this.initStorage(),this.initUserProps(),lt(T({type:"updateScrobblerProperties",fn:()=>{this.initUserProps()}}))}async getUserProperties(){const e=await this.storage.get();return!e||!("properties"in e)||!e.properties?{}:e.properties}async applyUserProperties(e){this.applyProps(e,this.getUserDefinedProperties());let t=await this.storage.get();if(t||(t={}),!t){D("No data in storage","error");return}if((!("properties"in t)||t.properties===void 0)&&(t.properties={}),!("properties"in t)||t.properties===void 0){D("No properties in storage","error");return}for(const a in e){const r=e[a];r?t.properties[a]=r:a in t.properties&&delete t.properties[a]}await this.storage.set(t)}getUserDefinedProperties(){return[]}getUserDefinedArrayProperties(){return[]}async getArrayProperties(){const e=await this.storage.get();return!e||!("arrayProperties"in e)||!e.arrayProperties?[]:e.arrayProperties}async addUserArrayProperties(e){let t=await this.storage.get();if((!t||!("arrayProperties"in t)||!t.arrayProperties)&&(t={arrayProperties:[]}),!t||!("arrayProperties"in t)||!t.arrayProperties){D("No data in storage","error");return}t.arrayProperties.push(e),this.applyArrayProps(t.arrayProperties,this.getUserDefinedArrayProperties()),await this.storage.set(t)}async applyUserArrayProperties(e){let t=await this.storage.get();if((!t||!("arrayProperties"in t)||!t.arrayProperties)&&(t={arrayProperties:[]}),!t||!("arrayProperties"in t)||!t.arrayProperties){D("No data in storage","error");return}t.arrayProperties=e,this.applyArrayProps(t.arrayProperties,this.getUserDefinedArrayProperties()),await this.storage.set(t)}async signOut(){const e=await this.storage.get();if(!e){D("No data in storage","error");return}"sessionID"in e&&delete e.sessionID,"sessionName"in e&&delete e.sessionName,"arrayProperties"in e&&delete e.arrayProperties,await this.storage.set(e)}async getProfileUrl(){const{sessionName:e}=await this.getSession();return`${this.getBaseProfileUrl()}${e??"undefined"}`}canLoveSong(){return!1}canLoadSongInfo(){return!1}applyFilter(e){return e}get REQUEST_TIMEOUT(){return 15e3}debugLog(e,t="log"){const a=`${this.getLabel()}: ${e}`;D(a,t)}initStorage(){const e=["token","sessionID","sessionName"];e.push(...this.getUserDefinedProperties());const t=mt(this.getStorageName());return t.debugLog(e),t}async initUserProps(){const e=await this.storage.get();if(e&&"properties"in e)for(const t in e.properties)t==="userApiUrl"&&"userApiUrl"in e.properties&&(this.userApiUrl=e.properties.userApiUrl),t==="userToken"&&"userToken"in e.properties&&(this.userToken=e.properties.userToken);e&&"arrayProperties"in e&&(this.arrayProperties=e.arrayProperties??[])}applyProps(e,t){for(const a in e){if(!t.includes(a))throw new Error(`Unknown property: ${a}`);const r=e[a];if(r===void 0)throw new Error(`Property is not set: ${a}`);r&&a in this?this[a]=e[a]:a in this&&delete this[a]}}applyArrayProps(e,t){if(!e)throw new Error("No props passed to applyArrayProps()");if(e.length===0){this.arrayProperties=[];return}for(const a of e)for(const[r,o]of Object.entries(a)){if(!t.includes(r))throw new Error(`Unknown property: ${r}`);if(o===void 0)throw new Error(`Property is not set: ${r}`)}this.arrayProperties=e}}class _t extends le{constructor(){super(...arguments),this.isLocalOnly=!1}async getAuthUrl(){var r;const e={method:"auth.gettoken"};let t=null,a=await((r=this.storage)==null?void 0:r.get());try{t=(await this.sendRequest({method:"GET"},e,!1)).token}catch{throw this.debugLog("Error acquiring a token","warn"),new Error("Error acquiring a token")}return a||(a={token:t}),a.token=t,"sessionID"in a&&delete a.sessionID,"sessionName"in a&&delete a.sessionName,await this.storage.set(a),`${this.getBaseAuthUrl()}?api_key=${this.getApiKey()}&token=${t||""}`}async getSession(){const e=await this.storage.get();if(!e)throw new Error(f.ERROR_AUTH);if(!("token"in e)){if(!("sessionID"in e))throw new Error(f.ERROR_AUTH);return{sessionID:e.sessionID??"undefined",sessionName:e.sessionName}}const t=e.token||null;if(t!==null)try{const a=await this.tradeTokenForSession(t);return delete e.token,e.sessionID=a.sessionID,e.sessionName=a.sessionName,await this.storage.set(e),a}catch{throw this.debugLog("Failed to trade token for session","warn"),await this.signOut(),new Error(f.ERROR_AUTH)}return{sessionID:e.sessionID,sessionName:e.sessionName}}async isReadyForGrantAccess(){const e=await this.storage.get();return!e||!("token"in e)?!1:!!e.token}async sendNowPlaying(e){const{sessionID:t}=await this.getSession(),a={method:"track.updatenowplaying",track:e.getTrack(),artist:e.getArtist(),sk:t};e.getAlbum()&&(a.album=e.getAlbum()),e.getAlbumArtist()&&(a.albumArtist=e.getAlbumArtist()),e.getDuration()&&(a.duration=`${e.getDuration()??""}`);const r=await this.sendRequest({method:"POST"},a);return this.processResponse(r)}async sendPaused(){return Promise.resolve(f.RESULT_OK)}async sendResumedPlaying(){return Promise.resolve(f.RESULT_OK)}async scrobble(e){const{sessionID:t}=await this.getSession(),a={method:"track.scrobble",sk:t};for(const[d,p]of e.slice(0,50).entries())a[`timestamp[${d}]`]=p.metadata.startTimestamp.toString(),a[`track[${d}]`]=p.getTrack(),a[`artist[${d}]`]=p.getArtist(),p.getAlbum()&&(a[`album[${d}]`]=p.getAlbum()),p.getAlbumArtist()&&(a[`albumArtist[${d}]`]=p.getAlbumArtist());const r=await this.sendRequest({method:"POST"},a),o=this.processResponse(r);if(o===f.RESULT_OK){const d=r.scrobbles;if(d){const p=d["@attr"].ignored;if(Number(p)===0)return new Array(Math.min(e.length,50)).fill(f.RESULT_OK);if(!Array.isArray(d.scrobble))return new Array(Math.min(e.length,50)).fill(f.RESULT_IGNORE);const j={};for(const[A,N]of e.entries())j[N.metadata.startTimestamp.toString()]=A;const S=new Array(Math.min(e.length,50));for(const A of d.scrobble)S[j[A.timestamp]]=A.ignoredMessage.code==="0"?f.RESULT_OK:f.RESULT_IGNORE}else return new Array(Math.min(e.length,50)).fill(f.ERROR_OTHER)}return new Array(Math.min(e.length,50)).fill(o)}async toggleLove(e,t){const{sessionID:a}=await this.getSession(),r={method:t?"track.love":"track.unlove",track:e.getTrack(),artist:e.getArtist(),sk:a},o=await this.sendRequest({method:"POST"},r);return this.processResponse(o)}canLoveSong(){return!0}async sendRequest(e,t,a=!0){const r=this.makeRequestUrl(t,a),o=fetch(r,e),d=this.REQUEST_TIMEOUT;let p=null,j=null;try{p=await F(d,o),j=await p.json()}catch{throw new Error(f.ERROR_OTHER)}const S=JSON.stringify(j,null,2),A=Oa(j,S);if(!p.ok)throw this.debugLog(`${t.method} response:
${A}`,"error"),new Error(f.ERROR_OTHER);return this.debugLog(`${t.method} response:
${A}`),j}async tradeTokenForSession(e){const t={method:"auth.getsession",token:e},a=await this.sendRequest({method:"GET"},t);if(this.processResponse(a)!==f.RESULT_OK)throw new Error(f.ERROR_AUTH);const o=a.session.name;return{sessionID:a.session.key,sessionName:o}}makeRequestUrl(e,t){e.api_key=this.getApiKey(),e.format="json",t&&(e.api_sig=this.generateSign(e));const a=ot(e);return`${this.getApiUrl()}?${a}`}generateSign(e){const t=Object.keys(e).sort();let a="";for(const r of t)["format","callback"].includes(r)||(a+=`${r}${e[r]||""}`);return Tt(a+this.getApiSecret())}processResponse(e){return e.error?f.ERROR_OTHER:f.RESULT_OK}}function Oa(s,e){let t=e;const a=[s.token],r=s.session;r&&(a.push(r.name),a.push(r.key));for(const o of a)typeof o=="string"?t=at(o,t):typeof o=="number"&&(t=at(o.toString(),t));return t}class Na extends _t{getApiUrl(){return"https://ws.audioscrobbler.com/2.0/"}getApiKey(){return"d9bb1870d3269646f740544d9def2c95"}getApiSecret(){return"2160733a567d4a1a69a73fad54c564b2"}getBaseAuthUrl(){return"https://www.last.fm/api/auth/"}getBaseProfileUrl(){return"https://last.fm/user/"}getId(){return"lastfm"}getLabel(){return"Last.fm"}getStatusUrl(){return"http://status.last.fm/"}getStorageName(){return"LastFM"}async getSongInfo(e){const t={track:e.getTrack(),artist:e.getArtist(),method:"track.getinfo"};try{const{sessionName:d}=await this.getSession();t.username=d}catch{}e.getAlbum()&&(t.album=e.getAlbum());const a=await this.sendRequest({method:"GET"},t,!1);if(this.processResponse(a)!==f.RESULT_OK)throw new Error("Unable to load song info");const o=this.parseSongInfo(a);return this.canLoveSong()&&o&&P(e.controllerTabId,{type:"updateLove",payload:{isLoved:o.userloved||!1}}),o}canLoadSongInfo(){return!0}parseSongInfo(e){const t={},a=e.track,r=e.track.album,o=e.track.artist,d=a.userloved;if(d?t.userloved=d==="1":t.userloved=void 0,t.artist=o.name,t.artistUrl=o.url,t.track=a.name,t.trackUrl=a.url,t.duration=parseInt(a.duration)/1e3||null,r&&(t.album=r.title,t.albumUrl=r.url,t.albumMbId=r.mbid,Array.isArray(r.image))){const p=r.image.reduce((S,A)=>(S[A.size]=A["#text"],S),{}),j=["extralarge","large","medium"];for(const S of j){const A=p[S];if(A){t.trackArtUrl=A;break}}}return t.userPlayCount=parseInt(a.userplaycount)||0,t}applyFilter(e){if(e.getAlbumArtist()){const t=e.getAlbumArtist()||"";e.parsed.albumArtist=t.includes("Various Artists")?"Various Artists":t}return e}}class Ia extends _t{getApiUrl(){return"https://libre.fm/2.0/"}getApiKey(){return"r8i1y91hz71tcx7vyrp9hk1alhqp1898"}getApiSecret(){return"8187db5vg234yq6tm7o62q8mtl1niala"}getBaseAuthUrl(){return"https://www.libre.fm/api/auth/"}getBaseProfileUrl(){return"https://libre.fm/user/"}getLabel(){return"Libre.fm"}getStatusUrl(){return""}getStorageName(){return"LibreFM"}async getSongInfo(){return Promise.resolve({})}sendRequest(e,t,a){var r;return((r=e.method)==null?void 0:r.toLowerCase())==="post"&&(e.headers={"Content-Type":"application/x-www-form-urlencoded"},e.body=ot(t)),super.sendRequest(e,t,a)}}const Ca="https://listenbrainz.org/settings/",Ve="https://api.listenbrainz.org/1",Ua=`${Ve}/submit-listens`;class _a extends le{constructor(){super(...arguments),this.isLocalOnly=!1}async getSongInfo(){return Promise.resolve({})}async getAuthUrl(){const e=await this.storage.get();let t;return e&&"properties"in e&&(t=e.properties),t?await this.storage.set({isAuthStarted:!0,properties:t}):await this.storage.set({isAuthStarted:!0}),"https://listenbrainz.org/login/musicbrainz?next=%2Fsettings%2F"}getBaseProfileUrl(){return"https://listenbrainz.org/user/"}getLabel(){return"ListenBrainz"}async getProfileUrl(){return this.userToken?"":await super.getProfileUrl()}getStatusUrl(){return this.userToken?"":"https://listenbrainz.org/current-status"}getStorageName(){return"ListenBrainz"}getUserDefinedProperties(){return["userApiUrl","userToken"]}async signOut(){(this.userApiUrl||this.userToken)&&await this.applyUserProperties({userApiUrl:null,userToken:null}),await super.signOut()}async getSession(){if(this.userToken)return{sessionID:this.userToken};const e=await this.storage.get();if(!e)throw this.debugLog("no data","error"),await this.signOut(),new Error(f.ERROR_AUTH);if("isAuthStarted"in e&&e.isAuthStarted)try{const t=await this.requestSession();return e.sessionID=t.sessionID,e.sessionName=t.sessionName,delete e.isAuthStarted,await this.storage.set(e),t}catch{throw this.debugLog("Failed to get session","warn"),await this.signOut(),new Error(f.ERROR_AUTH)}else if(!("sessionID"in e)||!e.sessionID)throw new Error(f.ERROR_AUTH);return{sessionID:e.sessionID,sessionName:e.sessionName}}async isReadyForGrantAccess(){if(this.userToken)return!1;const e=await this.storage.get();return!e||!("isAuthStarted"in e)?!1:e.isAuthStarted??!1}async sendNowPlaying(e){const{sessionID:t}=await this.getSession(),r={listen_type:"playing_now",payload:[{track_metadata:this.makeTrackMetadata(e)}]};return this.sendScrobbleRequest(r,t)}async sendPaused(){return Promise.resolve(f.RESULT_OK)}async sendResumedPlaying(){return Promise.resolve(f.RESULT_OK)}async scrobble(e,t){const{sessionID:a}=await this.getSession(),r={listen_type:t?"single":"import",payload:e.slice(0,50).map(d=>({listened_at:d.metadata.startTimestamp,track_metadata:this.makeTrackMetadata(d)}))},o=await this.sendScrobbleRequest(r,a);return new Array(Math.min(e.length,50)).fill(o)}async toggleLove(e,t){const a=e.getTrack(),r=e.getArtist();if(typeof a!="string"||typeof r!="string")throw new Error(`Invalid track ${JSON.stringify({artist:r,track:a})}`);const o=new URLSearchParams({recording_name:a,artist_name:r});let d={};try{d=await this.listenBrainzApi("GET",`${Ve}/metadata/lookup?${o.toString()}`,null,null)}catch{}if(this.debugLog(`lookup result: ${JSON.stringify(d,null,2)}`),!d.recording_mbid)return this.debugLog(`Could not lookup metadata for song: ${e.toString()}`),{};const{sessionID:p}=await this.getSession(),j={recording_mbid:d.recording_mbid,score:t?1:0},S=await this.listenBrainzApi("POST",`${Ve}/feedback/recording-feedback`,j,p);return this.processResult(S)}canLoveSong(){return!0}async listenBrainzApi(e,t,a,r){const o={method:e,headers:{"Content-Type":"application/json; charset=UTF-8"}};a&&(o.body=JSON.stringify(a)),r&&o.headers&&(o.headers.Authorization=`Token ${r}`);const d=fetch(t,o),p=this.REQUEST_TIMEOUT;let j=null,S=null;try{S=await F(p,d),j=await S.json()}catch{throw this.debugLog("Error while sending request","error"),new Error(f.ERROR_OTHER)}switch(S.status){case 400:throw this.debugLog("Invalid JSON sent","error"),new Error(f.ERROR_AUTH);case 401:throw this.debugLog("Invalid Authorization sent","error"),new Error(f.ERROR_AUTH)}return this.debugLog(JSON.stringify(j,null,2)),j}async sendScrobbleRequest(e,t){const a=await this.listenBrainzApi("POST",this.userApiUrl||Ua,e,t);return this.processResult(a)}async requestSession(){let e=null;try{e=await this.fetchSession(Ca)}catch{this.debugLog("request session timeout","warn")}if(e){const t=rt(e.sessionID);return this.debugLog(`Session ID: ${t}`),e}throw new Error(f.ERROR_AUTH)}async fetchSession(e){var o;this.debugLog(`Use ${e}`);const t=os()?it(e):cs({type:"sendListenBrainzRequest",payload:{url:e}}),a=this.REQUEST_TIMEOUT,r=await F(a,t);if(r!==null){let d=null;const p=(o=r.match(/<script id="global-react-props" type="application\/json">(.*?)<\/script>/))==null?void 0:o[1];p&&(d=JSON.parse(p));const j=d==null?void 0:d.current_user.name,S=d==null?void 0:d.current_user.auth_token;if(S&&j)return{sessionID:S,sessionName:j}}return null}processResult(e){return e.status!=="ok"?f.ERROR_OTHER:f.RESULT_OK}makeTrackMetadata(e){const t={artist_name:e.getArtist()??"",track_name:e.getTrack()??"",additional_info:{submission_client:"Web Scrobbler",submission_client_version:ls(),music_service_name:e.metadata.label}},a=e.getAlbum();a&&(t.release_name=a);const r=e.getOriginUrl();r&&(t.additional_info.origin_url=r);const o=e.getAlbumArtist();o&&(t.additional_info.release_artist_name=o),r&&e.metadata.label==="Spotify"&&(t.additional_info.spotify_id=r);const d=e.getDuration();return d&&(t.additional_info.duration=d),t}}class Ma extends le{constructor(){super(...arguments),this.isLocalOnly=!0}getStorageName(){return"Maloja"}getLabel(){return"Maloja"}getStatusUrl(){return""}getUserDefinedProperties(){return["userApiUrl","userToken"]}async getProfileUrl(){return Promise.resolve("")}async getAuthUrl(){return Promise.resolve("")}getBaseProfileUrl(){return""}getSongInfo(){return Promise.resolve({})}toggleLove(){return Promise.resolve(f.ERROR_OTHER)}async getSession(){if(!this.userToken)throw new Error(f.ERROR_AUTH);return Promise.resolve({sessionID:this.userToken})}isReadyForGrantAccess(){return Promise.resolve(!1)}sendNowPlaying(){return Promise.resolve(f.RESULT_OK)}async sendPaused(){return Promise.resolve(f.RESULT_OK)}async sendResumedPlaying(){return Promise.resolve(f.RESULT_OK)}async scrobble(e){const t=[];for(const a of e.slice(0,50)){const r=this.makeTrackMetadata(a);t.push(this.sendRequest(r,this.userToken))}return Promise.all(t)}async sendRequest(e,t){e.key=t;const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},r=fetch(this.userApiUrl,a),o=this.REQUEST_TIMEOUT;let d=null;try{if(d=await F(o,r),d.status!==200)return f.ERROR_OTHER}catch{return this.debugLog("Error while sending request","error"),f.ERROR_OTHER}return f.RESULT_OK}makeTrackMetadata(e){const t={artist:e.getArtist()??"",title:e.getTrack()??"",time:e.metadata.startTimestamp},a=e.getAlbum();a&&(t.album=a);const r=e.getAlbumArtist();return r&&(t.albumartists=[r]),t}}class Da extends le{constructor(){super(...arguments),this.isLocalOnly=!0}getBaseProfileUrl(){return""}getLabel(){return"Webhook"}getStatusUrl(){return""}getStorageName(){return"Webhook"}getSession(){return!this.arrayProperties||this.arrayProperties.length===0?Promise.reject(new Error("")):Promise.resolve({sessionID:"webhook"})}getAuthUrl(){return Promise.resolve("")}isReadyForGrantAccess(){return Promise.resolve(!1)}async getProfileUrl(){return Promise.resolve("")}getUserDefinedArrayProperties(){return["applicationName","userApiUrl"]}async getSongInfo(){return Promise.resolve({})}async sendRequest(e){if(!this.arrayProperties||this.arrayProperties.length===0)return f.ERROR_AUTH;this.debugLog(`Webhook - sendRequest: ${JSON.stringify(e,null,2)}`);const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},a=[];for(const o of this.arrayProperties)a.push(fetch(o.userApiUrl,t));const r=this.REQUEST_TIMEOUT;try{const o=await F(r,Promise.all(a));for(const d of o)if(d.status!==200)return this.debugLog(`Error in ${d.url}.`,"error"),f.ERROR_OTHER}catch{return this.debugLog("Error while sending request","error"),f.ERROR_OTHER}return f.RESULT_OK}async sendNowPlaying(e){return this.sendRequest({eventName:"nowplaying",time:Date.now(),data:{song:e}})}async sendPaused(e){return this.sendRequest({eventName:"paused",time:Date.now(),data:{song:e}})}async sendResumedPlaying(e){return this.sendRequest({eventName:"resumedplaying",time:Date.now(),data:{song:e}})}async scrobble(e,t){const a=await this.sendRequest({eventName:"scrobble",time:Date.now(),data:{song:e[0],songs:e,currentlyPlaying:t}});return new Array(e.length).fill(a)}toggleLove(e,t){return this.sendRequest({eventName:"loved",time:Date.now(),data:{song:e,isLoved:t}})}}class za extends le{constructor(){super(...arguments),this.isLocalOnly=!0}getStorageName(){return"Pleroma"}getLabel(){return"Pleroma"}getStatusUrl(){return""}getUserDefinedProperties(){return["userApiUrl","userToken"]}async getProfileUrl(){return Promise.resolve("")}async getAuthUrl(){return Promise.resolve("")}getBaseProfileUrl(){return""}getSongInfo(){return Promise.resolve({})}toggleLove(){return Promise.resolve(f.ERROR_OTHER)}async getSession(){if(!this.userToken)throw new Error(f.ERROR_AUTH);const e={method:"GET",headers:{Authorization:`Bearer ${this.userToken}`}},t=`https://${this.userApiUrl}/api/v1/accounts/verify_credentials`,a=fetch(t,e),r=this.REQUEST_TIMEOUT;let o=null;try{if(o=await F(r,a),o.status!==200)throw new Error(f.ERROR_AUTH);const d=await o.json(),p=d?d.fqn:"";return{sessionID:this.userToken,sessionName:p}}catch{throw this.debugLog("Error while sending request","error"),new Error(f.ERROR_AUTH)}}isReadyForGrantAccess(){return Promise.resolve(!1)}sendNowPlaying(){return Promise.resolve(f.RESULT_OK)}async sendResumedPlaying(){return Promise.resolve(f.RESULT_OK)}async sendPaused(){return Promise.resolve(f.RESULT_OK)}async scrobble(e){const t=[];for(const a of e.slice(0,50)){const r=this.makeTrackMetadata(a);t.push(this.sendRequest(r,this.userToken))}return Promise.all(t)}async sendRequest(e,t){const a={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)},r=`https://${this.userApiUrl}/api/v1/pleroma/scrobble`,o=fetch(r,a),d=this.REQUEST_TIMEOUT;let p=null;try{if(p=await F(d,o),p.status!==200)return f.ERROR_OTHER}catch{return this.debugLog("Error while sending request","error"),f.ERROR_OTHER}return f.RESULT_OK}makeTrackMetadata(e){const t={artist:e.getArtist()??"",title:e.getTrack()??"",length:e.getDuration(),url:e.parsed.originUrl??""},a=e.getAlbum();return a&&(t.album=a),t}}const ce=[new Na,new Ia,new _a,new Ma,new Da,new za];function Mt(s,e){return e.some(t=>t.getLabel()===s.getLabel())}class Ba{constructor(){this.boundScrobblers=[]}async bindAllScrobblers(){for(const e of ce)try{await e.getSession(),this.bindScrobbler(e)}catch{R(`Unable to bind ${e.getLabel()}`,"warn")}return this.boundScrobblers}bindScrobbler(e){Mt(e,this.boundScrobblers)||(this.boundScrobblers.push(e),R(`Bind ${e.getLabel()} scrobbler`))}unbindScrobbler(e){if(Mt(e,this.boundScrobblers)){const t=this.boundScrobblers.indexOf(e);this.boundScrobblers.splice(t,1),R(`Unbind ${e.getLabel()} scrobbler`)}else R(`${e.getLabel()} is not bound`,"error")}getSongInfo(e){const t=ce.filter(a=>a.canLoadSongInfo());return R(`Send "get info" request: ${t.length}`),Promise.all(t.map(async a=>{try{return await a.getSongInfo(e)}catch{return R(`Unable to get song info from ${a.getLabel()}`,"warn"),null}}))}sendNowPlaying(e){return R(`Send "now playing" request: ${this.boundScrobblers.length}`),Promise.all(this.boundScrobblers.map(async t=>{try{return await t.sendNowPlaying(t.applyFilter(e))}catch(a){return this.processErrorResult(t,a)}}))}sendPaused(e){const t=this.boundScrobblers.filter(a=>typeof a.sendPaused=="function");return t.length===0?Promise.resolve([f.RESULT_OK]):(R(`Send "paused" request: ${t.length}`),Promise.all(t.map(async a=>{try{return await a.sendPaused(a.applyFilter(e))}catch(r){return this.processErrorResult(a,r)}})))}sendResumedPlaying(e){const t=this.boundScrobblers.filter(a=>typeof a.sendResumedPlaying=="function");return t.length===0?Promise.resolve([f.RESULT_OK]):(R(`Send "paused" request: ${t.length}`),Promise.all(t.map(async a=>{try{return await a.sendResumedPlaying(a.applyFilter(e))}catch(r){return this.processErrorResult(a,r)}})))}async scrobble(e,t){R(`Send "scrobble" request: ${this.boundScrobblers.length}`);const a=await Promise.all(this.boundScrobblers.map(async r=>{try{return await r.scrobble(e.map(r.applyFilter),t)}catch(o){return this.processScrobbleErrorResult(r,o)}}));for(let r=0;r<a[0].length;r++)await Js.pushScrobble({song:e[r].getCloneableData(),status:hs(a,r)});return a}async toggleLove(e,t){const a=ce.filter(o=>o.canLoveSong());return R(`Send "${t?"love":"unlove"}" request: ${a.length}`),Promise.all(a.map(async o=>{try{return await o.toggleLove(e,t)}catch(d){return this.processErrorResult(o,d)}}))}getRegisteredScrobblers(){return ce}getScrobblerByLabel(e){for(const t of ce)if(t.getLabel()===e)return t;return null}async processErrorResult(e,t){const a=t===f.ERROR_OTHER,r=t===f.ERROR_AUTH;if(!(a||r))throw new Error(`Invalid result: ${t}`);return r&&(await e.isReadyForGrantAccess()||this.unbindScrobbler(e)),t}async processScrobbleErrorResult(e,t){const a=t[0]===f.ERROR_OTHER,r=t[0]===f.ERROR_AUTH;if(!(a||r))throw new Error(`Invalid result: ${t[0]}`);return r&&(await e.isReadyForGrantAccess()||this.unbindScrobbler(e)),t}}const L=new Ba;async function Fa(s){return await L.bindAllScrobblers(),wa(s.connector),L.sendNowPlaying(s)}async function qa(s){return await L.bindAllScrobblers(),L.sendPaused(s)}async function $a(s){return await L.bindAllScrobblers(),L.sendResumedPlaying(s)}async function Ha(s,e){return await L.bindAllScrobblers(),L.scrobble(s,e)}async function Ga(s){return await L.bindAllScrobblers(),L.getSongInfo(s)}async function Ka(s,e){await L.bindAllScrobblers();const t=await L.toggleLove(s,e);if(t.some(a=>a===f.ERROR_OTHER))throw new Error("An error occurred while toggling love for track");return t}const Qe=E(me);h.runtime.onStartup.addListener(Ft),h.runtime.onInstalled.addListener(tr),h.tabs.onRemoved.addListener(s=>void Ja(s)),h.tabs.onUpdated.addListener((s,e,t)=>void Qa(s,e,t)),h.tabs.onActivated.addListener(s=>void Va(s)),(Gt=h.contextMenus)==null||Gt.onClicked.addListener(s=>void sr(s)),(Kt=h.commands)==null||Kt.onCommand.addListener(s=>void Wa(s));async function Wa(s){var a;const e=await Ot(),t=(a=e.song)==null?void 0:a.metadata.userloved;switch(s){case"toggle-connector":e.mode===Ze?It(e.tabId):Nt(e.tabId);break;case"love-song":t||Dt(e.tabId,!0,!0);break;case"unlove-song":t&&Dt(e.tabId,!1,!0);break}}function Dt(s,e,t){P(s??-1,{type:"toggleLove",payload:{isLoved:e,shouldShowNotification:t}})}async function Ja(s){const e=await Ae(),t=await Ge(e.activeTabs);await ie({activeTabs:t,browserPreferredTheme:e.browserPreferredTheme});const a=await ye();je(t,a);const r=await Qe.get();r!=null&&r[s]&&(delete r[s],Qe.set(r))}async function Va(s){await zt(s.tabId,!0)}async function Qa(s,e,t){t!=null&&t.active&&e.status==="complete"&&await zt(s,!1)}async function zt(s,e){const t=await Ae();let a=e?t.activeTabs.filter(d=>d.tabId!==s):t.activeTabs;const r=await Ke(a,s);He[r.mode]&&r.tabId===s&&(e?a=[r,...a]:a=a.map(d=>d.tabId===s?r:d));const o=await Ge(a);await ie({activeTabs:o,browserPreferredTheme:t.browserPreferredTheme}),je(o,s)}async function Bt(s,e){if(!s)throw new Error("No tabid given");let t=!1;try{const a=await Ae(),r=await Ge(a.activeTabs);for(let p=0;p<r.length;p++){if(r[p].tabId!==s)continue;r[p]=e(r[p]),t=!0,await ie({activeTabs:r,browserPreferredTheme:a.browserPreferredTheme});const j=await ye();je(r,j);return}t=!0;const o=[e({tabId:s,mode:X,permanentMode:X,song:null}),...r];await ie({activeTabs:o,browserPreferredTheme:a.browserPreferredTheme});const d=await ye();je(r,d)}catch{t||aa()}}async function Ya(s,e,t){await Bt(s,a=>({tabId:a.tabId,mode:e,permanentMode:t,song:a.song}))}async function Za(s,e){await Bt(s,t=>({tabId:t.tabId,mode:t.mode,permanentMode:t.permanentMode,song:e}))}lt(T({type:"controllerModeChange",fn:({mode:s,permanentMode:e},t)=>{var a,r;Ya((a=t.tab)==null?void 0:a.id,s,e),console.log(`changed mode to ${s} in tab ${(r=t.tab)==null?void 0:r.id}`)}}),T({type:"songUpdate",fn:(s,e)=>{var t,a;Za((t=e.tab)==null?void 0:t.id,s),console.log(`song changed in tab ${(a=e.tab)==null?void 0:a.id}`),console.log(s)}}),T({type:"getTabId",fn:(s,e)=>{var t,a;return console.log("getting tab id"),console.log(s,(t=e.tab)==null?void 0:t.id),(a=e.tab)==null?void 0:a.id}}),T({type:"showNowPlaying",fn:(s,e)=>{var t;ja(new C(s.song,((t=e.tab)==null?void 0:t.id)??-1),s.connector,()=>{var a;nt(((a=e.tab)==null?void 0:a.id)??-1)})}}),T({type:"setNowPlaying",fn:(s,e)=>{var t;return Fa(new C(s.song,((t=e.tab)==null?void 0:t.id)??-1))}}),T({type:"setPaused",fn:(s,e)=>{var t;return qa(new C(s.song,((t=e.tab)==null?void 0:t.id)??-1))}}),T({type:"setResumedPlaying",fn:(s,e)=>{var t;return $a(new C(s.song,((t=e.tab)==null?void 0:t.id)??-1))}}),T({type:"scrobble",fn:(s,e)=>Ha(s.songs.map(t=>{var a;return new C(t,((a=e.tab)==null?void 0:a.id)??-1)}),s.currentlyPlaying)}),T({type:"getSongInfo",fn:(s,e)=>{var t;return Ga(new C(s.song,((t=e.tab)==null?void 0:t.id)??-1))}}),T({type:"toggleLove",fn:(s,e)=>{var a;const t=new C(s.song,((a=e.tab)==null?void 0:a.id)??-1);return s.shouldShowNotification&&Ea(t,s.isLoved),Ka(t,s.isLoved)}}),T({type:"sendListenBrainzRequest",fn:async s=>it(s.url)}),T({type:"clearNowPlaying",fn:(s,e)=>{var t;ya(new C(s.song,((t=e.tab)==null?void 0:t.id)??-1))}}),T({type:"showSongNotRecognized",fn:(s,e)=>{var t;Aa(new C(s.song,((t=e.tab)==null?void 0:t.id)??-1),s.connector,()=>{var a;nt(((a=e.tab)==null?void 0:a.id)??-1)})}}),T({type:"updateTheme",fn:async s=>{const e=await Ae();await ie({activeTabs:e.activeTabs,browserPreferredTheme:s})}}),T({type:"fetch",fn:async({url:s,init:e})=>{const t=await fetch(s,e);return t.ok?{ok:!0,content:await t.text()}:{ok:!1,content:""}}}),T({type:"isTabAudible",fn:async(s,e)=>{var a;const t=(a=e.tab)==null?void 0:a.id;return typeof t!="number"?Promise.resolve(!0):(await h.tabs.get(t)).audible??!0}}));async function Xa(){const s=E(Oe);let e=await s.get();e||(e={appVersion:""}),e.appVersion=h.runtime.getManifest().version,await s.set(e),s.debugLog()}async function er(){return(await L.bindAllScrobblers()).length>0}function Ft(){var e,t,a;E(ue).set(We),Qe.set({}),$s(),Xa(),er().then(r=>{r||(console.warn("No scrobblers are bound"),Ra())}),(e=h.contextMenus)==null||e.create({id:v.ENABLE_CONNECTOR,visible:!1,contexts:["action"],title:"Error: You should not be seeing this"}),(t=h.contextMenus)==null||t.create({id:v.DISABLE_CONNECTOR,visible:!1,contexts:["action"],title:"Error: You should not be seeing this"}),(a=h.contextMenus)==null||a.create({id:v.DISABLE_UNTIL_CLOSED,visible:!1,contexts:["action"],title:"Error: You should not be seeing this"}),h.contextMenus.create({id:v.ENABLE_CHANNEL,visible:!1,contexts:["action"],title:"Error: You should not be seeing this"}),h.contextMenus.create({id:v.DISABLE_CHANNEL,visible:!1,contexts:["action"],title:"Error: You should not be seeing this"})}function tr(){Ft(),Pa()}async function sr(s){const e=await Ot();switch(s.menuItemId){case v.ENABLE_CONNECTOR:{It(e.tabId);break}case v.DISABLE_CONNECTOR:{Nt(e.tabId);break}case v.DISABLE_UNTIL_CLOSED:{ca(e.tabId);break}case v.ENABLE_CHANNEL:{la(e.tabId);break}case v.DISABLE_CHANNEL:{na(e.tabId);break}}}})();
