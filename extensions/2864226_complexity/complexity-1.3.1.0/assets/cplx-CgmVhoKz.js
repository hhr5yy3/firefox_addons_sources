import{r as n}from"./cplx-M4JPizzD.js";import{S as b,H as m,T as d,U as f,R as p}from"./cplx-CVsLL7Ku.js";import{p as y}from"./cplx-DEt7CUyc.js";import{n as v,s as O}from"./cplx-km2FGkQ4.js";var g=class extends b{#e;#i=void 0;#t;#s;constructor(t,s){super(),this.#e=t,this.setOptions(s),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var i;const s=this.options;this.options=this.#e.defaultMutationOptions(t),m(this.options,s)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&d(s.mutationKey)!==d(this.options.mutationKey)?this.reset():((i=this.#t)==null?void 0:i.state.status)==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=this.#t)==null||t.removeObserver(this)}onMutationUpdate(t){this.#r(),this.#o(t)}getCurrentResult(){return this.#i}reset(){var t;(t=this.#t)==null||t.removeObserver(this),this.#t=void 0,this.#r(),this.#o()}mutate(t,s){var i;return this.#s=s,(i=this.#t)==null||i.removeObserver(this),this.#t=this.#e.getMutationCache().build(this.#e,this.options),this.#t.addObserver(this),this.#t.execute(t)}#r(){var s;const t=((s=this.#t)==null?void 0:s.state)??f();this.#i={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#o(t){p.batch(()=>{var s,i,e,r,u,o,a,c;if(this.#s&&this.hasListeners()){const h=this.#i.variables,l=this.#i.context;(t==null?void 0:t.type)==="success"?((i=(s=this.#s).onSuccess)==null||i.call(s,t.data,h,l),(r=(e=this.#s).onSettled)==null||r.call(e,t.data,null,h,l)):(t==null?void 0:t.type)==="error"&&((o=(u=this.#s).onError)==null||o.call(u,t.error,h,l),(c=(a=this.#s).onSettled)==null||c.call(a,void 0,t.error,h,l))}this.listeners.forEach(h=>{h(this.#i)})})}};function x(t,s){const i=y(),[e]=n.useState(()=>new g(i,t));n.useEffect(()=>{e.setOptions(t)},[e,t]);const r=n.useSyncExternalStore(n.useCallback(o=>e.subscribe(p.batchCalls(o)),[e]),()=>e.getCurrentResult(),()=>e.getCurrentResult()),u=n.useCallback((o,a)=>{e.mutate(o,a).catch(v)},[e]);if(r.error&&O(e.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:u,mutateAsync:r.mutate}}export{x as u};
