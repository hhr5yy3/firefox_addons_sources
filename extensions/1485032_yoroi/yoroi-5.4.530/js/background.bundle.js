(()=>{"use strict";var e,t,a,n,r,s,o,i,l,d,c,u,p,g,h,f,w,y,m,b,v,x,_,T,k,I,A,M,S,R,D,C,P,W,E,N,B,L,H,U,V,O,F,K,G,Y,q,z,Z,$,j,J,X,Q,ee,te,ae,ne,re,se,oe,ie,le,de,ce,ue,pe,ge,he={60274:(e,t,a)=>{a.d(t,{ZP:()=>Pe,oN:()=>We,iZ:()=>de.cip8Sign,jK:()=>Ee,ZE:()=>Ne,Zy:()=>Be,mO:()=>Le,vX:()=>He});var n=a(94198),r=a.n(n),s=a(89400),o=a.n(s),i=a(94473),l=a.n(i),d=a(80426),c=a.n(d),u=a(77766),p=a.n(u),g=a(39392),h=a.n(g),f=a(78580),w=a.n(f),y=a(93476),m=a.n(y),b=a(39291),v=a.n(b),x=a(72119),_=a.n(x),T=a(25843),k=a.n(T),I=a(86902),A=a.n(I),M=a(78914),S=a.n(M),R=a(59340),D=a.n(R),C=a(41511),P=a.n(C),W=a(20116),E=a.n(W),N=a(36384),B=a.n(N),L=a(51938),H=a.n(L),U=a(51942),V=a.n(U),O=a(32366),F=a.n(O),K=a(2991),G=a.n(K),Y=a(905),q=a(13469),z=a(37790),Z=a(36231),$=a(66905),j=a(34654),J=a(4922),X=a(24283),Q=a(54901),ee=a(11015),te=a(52367),ae=a(38079),ne=a(90691),re=a(38441),se=a(3577),oe=(a(27189),a(4158)),ie=a(84184),le=a(76900),de=a(75723),ce=a(15476),ue=a(62021),pe=a(70184),ge=a(21131),he=a(63139),fe=a(73744),we=a(40026),ye=a(34786),me=a(33913),be=a(1499),ve=a(37495),xe=a(27649),_e=a(86335),Te=a(84174),ke=a(67362),Ie=a(55343),Ae=a(45918),Me=a(15687),Se=a(90649),Re=a(87315),De=a(51965),Ce=a(27697);class Pe{async getAllAddressesForDisplay(e){q.Yd.debug("AdaApi::getAllAddressesForDisplay called");try{return await(0,ve.XN)(e)}catch(e){if(q.Yd.error("AdaApi::getAllAddressesForDisplay error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}async getChainAddressesForDisplay(e){q.Yd.debug("AdaApi::getChainAddressesForDisplay called");try{return await(0,be.cP)(e)}catch(e){if(q.Yd.error("AdaApi::getChainAddressesForDisplay error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}async refreshTransactions(e){try{var t;let a;if(e.isLocalRequest)a=await(0,J._v)({publicDeriver:e.publicDeriver,skip:e.skip||0,limit:e.limit||20});else{e.beforeTx||await(0,J.tu)(e.publicDeriver.getDb(),e.publicDeriver,e.checkAddressesInUse,e.getTokenInfo,e.getMultiAssetMetadata,e.getMultiAssetSupply);const t=e=>null!=e&&e.block?{blockHash:e.block.Hash,txHash:e.txid}:void 0;a=await(0,J.Ci)(e.publicDeriver.getDb(),e.publicDeriver,e.checkAddressesInUse,e.getTransactionHistory,e.getRecentTransactionHashes,e.getTransactionsByHashes,e.getBestBlock,e.getTokenInfo,e.getMultiAssetMetadata,e.getMultiAssetSupply,t(e.afterTx),t(e.beforeTx))}return G()(t=a.txs).call(t,(t=>{if(t.txType===ne.iU.CardanoByron)return z.Z.fromAnnotatedTx({tx:t,addressLookupMap:a.addressLookupMap,network:e.publicDeriver.getParent().getNetworkInfo(),defaultToken:e.publicDeriver.getParent().getDefaultToken()});if(t.txType===ne.iU.CardanoShelley)return Z.Z.fromAnnotatedTx({tx:t,addressLookupMap:a.addressLookupMap,network:e.publicDeriver.getParent().getNetworkInfo(),defaultToken:e.publicDeriver.getParent().getDefaultToken()});throw new Error(`refreshTransactions unknown tx type ${t.type}`)}))}catch(e){if(q.Yd.error("AdaApi::refreshTransactions error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}async refreshPendingTransactions(e){q.Yd.debug("AdaApi::refreshPendingTransactions called");try{var t;const a=await(0,J.ON)({publicDeriver:e.publicDeriver});return q.Yd.debug("AdaApi::refreshPendingTransactions success: "+(0,q.WO)(a)),G()(t=a.txs).call(t,(t=>{if(t.txType===ne.iU.CardanoByron)return z.Z.fromAnnotatedTx({tx:t,addressLookupMap:a.addressLookupMap,network:e.publicDeriver.getParent().getNetworkInfo(),defaultToken:e.publicDeriver.getParent().getDefaultToken()});if(t.txType===ne.iU.CardanoShelley)return Z.Z.fromAnnotatedTx({tx:t,addressLookupMap:a.addressLookupMap,network:e.publicDeriver.getParent().getNetworkInfo(),defaultToken:e.publicDeriver.getParent().getDefaultToken()});throw new Error(`refreshPendingTransactions unknown tx type ${t.type}`)}))}catch(e){if(q.Yd.error("AdaApi::refreshPendingTransactions error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}async getForeignAddresses(e){try{return await(0,J.Jr)({publicDeriver:e.publicDeriver})}catch(e){if(q.Yd.error("AdaApi::getForeignAddresses error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}async createWallet(e){return await this.restoreWallet(e)}async signAndBroadcast(e){q.Yd.debug("AdaApi::signAndBroadcast called");const{password:t}=e;try{const a=await e.publicDeriver.getSigningKey(),n=await e.publicDeriver.normalizeKey({...a,password:t}),{txHash:r,encodedTx:s}=_e.RustModule.WasmScope((t=>{const a=(0,ie.OJ)(e.signRequest.senderUtxos,e.signRequest.unsignedTx,e.publicDeriver.getParent().getPublicDeriverLevel(),t.WalletV4.Bip32PrivateKey.from_hex(n.prvKeyHex),e.signRequest.neededStakingKeyHashes.wits,e.signRequest.metadata);return{txHash:t.WalletV4.FixedTransaction.from_hex(a.to_hex()).transaction_hash().to_hex(),encodedTx:a.to_bytes()}})),{txId:o}=await e.sendTx({network:e.publicDeriver.getParent().getNetworkInfo(),id:r,encodedTx:s});return q.Yd.debug("AdaApi::signAndBroadcast success: "+(0,q.WO)({txId:o})),{txId:o,signedTxHex:(0,Se.bytesToHex)(s)}}catch(e){if(e instanceof me.UZ)throw new ge.dJ;if(q.Yd.error(`AdaApi::signAndBroadcast error: ${(0,q.uh)(e)}`),e instanceof ge.kl)throw new ge.kl;if(e instanceof he.default)throw e;throw new ge.rp}}createTrezorSignTxData(e){try{var t;q.Yd.debug("AdaApi::createTrezorSignTxData called");const a=F()(t=(0,Te.getCardanoHaskellBaseConfig)(e.network)).call(t,((e,t)=>V()(e,t)),{}),n=(0,ue.Gi)(e.signRequest,a.ByronNetworkId,H()(a.ChainNetworkId,10));return q.Yd.debug("AdaApi::createTrezorSignTxData success: "+(0,q.WO)(n)),{trezorSignTxPayload:n}}catch(e){if(q.Yd.error("AdaApi::createTrezorSignTxData error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}createLedgerSignTxData(e){try{var t;q.Yd.debug("AdaApi::createLedgerSignTxData called");const a=F()(t=(0,Te.getCardanoHaskellBaseConfig)(e.network)).call(t,((e,t)=>V()(e,t)),{}),n=(0,pe.Fb)({signRequest:e.signRequest,byronNetworkMagic:a.ByronNetworkId,networkId:H()(a.ChainNetworkId,10),addressingMap:e.addressingMap,cip36:e.cip36});return q.Yd.debug("AdaApi::createLedgerSignTxData success: "+(0,q.WO)(n)),{ledgerSignTxPayload:n}}catch(e){if(q.Yd.error("AdaApi::createLedgerSignTxData error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}createHwSignTxDataFromRawTx(e,t){try{var a;q.Yd.debug("AdaApi::createHwSignTxDataFromRawTx called");const r=(0,Te.getCardanoHaskellBaseConfigCombined)(t.network),s=null!==(a=r.ByronNetworkId)&&void 0!==a?a:(0,Se.fail)("Missing ByronNetworkId in network config!"),o=e=>{var a;return null===(a=t.addressingMap(e))||void 0===a?void 0:a.path};if("ledger"===e){var n;const a=(0,pe.od)(t.txBodyHex,Number(r.ChainNetworkId),s,o,t.senderUtxos,null!==(n=t.additionalRequiredSigners)&&void 0!==n?n:[]);return q.Yd.debug("AdaApi::createHwSignTxDataFromRawTx success: "+(0,q.WO)(a)),{hw:e,result:{ledgerSignTxPayload:a}}}if("trezor"===e){const a=(0,ue.fu)(t.txBodyHex,Number(r.ChainNetworkId),s,o,t.senderUtxos);return q.Yd.debug("AdaApi::createHwSignTxDataFromRawTx success: "+(0,q.WO)(a)),{hw:e,result:{trezorSignTxPayload:a}}}throw new Error("Now supported HW type: "+e)}catch(e){if(q.Yd.error("AdaApi::createHwSignTxDataFromRawTx error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}async createUnsignedTxForUtxos(e){q.Yd.debug("AdaApi::createUnsignedTxForUtxos called");try{let r;const s=void 0!==e.metadata?(0,Q.bp)(e.metadata):void 0,{protocolParameters:o}=e;let i;if((0,oe.qP)(e.tokens)){if(1!==e.receivers.length)throw new Error("createUnsignedTxForUtxos wrong output size for sendAll");const t=e.receivers[0];i={address:t.address,handle:t.addressHandle},r=(0,ie.T$)(t,e.utxos,e.absSlotNumber,{keyDeposit:_e.RustModule.WalletV4.BigNum.from_str(o.keyDeposit),linearFee:_e.RustModule.WalletV4.LinearFee.new(_e.RustModule.WalletV4.BigNum.from_str(o.linearFee.coefficient),_e.RustModule.WalletV4.BigNum.from_str(o.linearFee.constant)),coinsPerUtxoByte:_e.RustModule.WalletV4.BigNum.from_str(o.coinsPerUtxoByte),poolDeposit:_e.RustModule.WalletV4.BigNum.from_str(o.poolDeposit),networkId:Number(e.network.BaseConfig[0].ChainNetworkId)},s,e.network.NetworkId)}else{var t,a,n;const l=F()(t=e.receivers).call(t,((e,t)=>null!=t.addressing?(e.push({address:t.address,addressing:t.addressing}),e):e),[]);if(1!==l.length)throw new Error("createUnsignedTxForUtxos needs exactly one change address");const d=l[0],c=F()(a=e.receivers).call(a,((e,t)=>null==t.addressing?(e.push({address:t.address,addressHandle:t.addressHandle}),e):e),[]);if(c.length>1)throw new Error("createUnsignedTxForUtxos can't send to more than one address");const u=c[0];i={address:u.address,handle:u.addressHandle},r=await(0,ie.fi)(1===c.length?[{address:u.address,amount:(0,oe._Y)(e.defaultToken,e.tokens,G()(n=e.utxos).call(n,(t=>(0,xe.Bi)(t,e.network.NetworkId))))}]:[],{address:d.address,addressing:d.addressing},e.utxos,e.absSlotNumber,{keyDeposit:o.keyDeposit,linearFeeCoefficient:o.linearFee.coefficient,linearFeeConstant:o.linearFee.constant,coinsPerUtxoByte:o.coinsPerUtxoByte,poolDeposit:o.poolDeposit,networkId:Number(e.network.BaseConfig[0].ChainNetworkId)},[],[],!1,s,e.network.NetworkId)}return q.Yd.debug("AdaApi::createUnsignedTxForUtxos success: "+(0,q.WO)(r)),new ye.Y({senderUtxos:r.senderUtxos,unsignedTx:r.txBuilder,changeAddr:r.changeAddr,metadata:s,networkSettingSnapshot:{ChainNetworkId:Number((0,Te.getCardanoHaskellBaseConfig)(e.network)[0].ChainNetworkId),KeyDeposit:new Y.Z(o.keyDeposit),PoolDeposit:new Y.Z(o.poolDeposit),NetworkId:e.network.NetworkId},neededStakingKeyHashes:{neededHashes:new(B()),wits:new(B())},receiver:i})}catch(e){if(q.Yd.error("AdaApi::createUnsignedTxForUtxos error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}async createUnsignedTx(e){var t;const a=E()(t=e.publicDeriver.utxos).call(t,(t=>E()(e).call(e,t))),n=(0,xe.ue)(a),r=[{address:e.receiver,addressHandle:e.receiverHandle}];if(!(0,oe.qP)(e.tokens)){const t=e.publicDeriver.receiveAddress;r.push({address:t.addr.Hash,addressing:t.addressing})}return this.createUnsignedTxForUtxos({absSlotNumber:e.absSlotNumber,receivers:r,network:(0,Te.getNetworkById)(e.publicDeriver.networkId),defaultToken:{defaultNetworkId:e.publicDeriver.networkId,defaultIdentifier:e.publicDeriver.defaultTokenId},utxos:n,tokens:e.tokens,metadata:e.metadata,protocolParameters:e.protocolParameters})}async createUnsignedTxForConnector(e,t){const a=(0,se.se)(e.publicDeriver);if(!a)throw new Error("unable to get UTxO addresses from public deriver");const n=await a.getAllUtxoAddresses(),r=await(0,Ae.WH)(e.publicDeriver);if(null==r)throw new Error("no internal addresses left. Should never happen");return this._createUnsignedTxForConnector(e.cardanoTxRequest,e.publicDeriver.getParent().getDefaultToken(),e.publicDeriver.publicDeriverId,n,r,e.publicDeriver.getParent().getNetworkInfo(),e.absSlotNumber,e.submittedTxs,e.utxos,e.protocolParameters,t)}async _createUnsignedTxForConnector(e,t,a,n,r,s,o,i,l,d,c){var u;const{includeInputs:p,includeOutputs:g,includeTargets:h,mintRequest:f,onlyInputsIntended:w,validityIntervalStart:y,ttl:m,requiredSigners:b}=e,v=e=>{if(null!=e&&!P()(e))throw new Error(`Array is expected, got: ${D()(e)}`);return null==e||0===e.length},x=v(p);if(v(g)&&v(h)){if(x)throw new Error("Invalid tx-build request, must specify inputs, outputs, or targets");if(!1===Boolean(w))throw new Error("No outputs is specified and `onlyInputsIntended` flag is false")}const _=await this._addressedUtxosWithSubmittedTxs(l,a,n,i),T=new(B())(G()(_).call(_,(e=>e.utxo_id))),I=[],M=F()(u=p||[]).call(u,((e,t)=>{const a="string"==typeof t?t:"string"==typeof t.id?t.id:null;if(null==a)throw new Error(`Unrecognised input request format: ${D()(t)}`);return T.has(a)||I.push(a),e[a]=t,e}),{}),R=[];if(I.length>0){if(null==c)throw new Error("Foreign utxos are present, but foreign utxo fetcher is missing!");R.push(...await c(I)),S()(R).call(R,((e,t)=>{if(null==e)throw new Error(`No UTxO found for input id: ${D()(I[t])}`)}))}const C=[],W=[];for(const e of[...R,..._]){const t=M[e.utxo_id];null!=t?C.push([e,t.witness]):W.push(e)}const E={address:r.addr.Hash,addressing:r.addressing},N=[],L=[],H={},U=[];function V(e,t,a){if(e){const n=new Y.Z(e.tag).toString(),r=H[n]=H[n]||{version:"1.0"};(r[t]=r[t]||{})[(0,Se.hexToUtf)(a)]=JSON.parse(e.json)}}function O(e){const{script:t,assetName:a}=e,n=_e.RustModule.WasmScope((e=>(0,Se.bytesToHex)(e.WalletV4.NativeScript.from_bytes((0,Se.hexToBytes)(t)).hash().to_bytes())));return{policyId:n,assetId:`${n}.${a}`}}_e.RustModule.WasmScope((e=>{for(const a of null!=g?g:[]){const n=e.WalletV4.TransactionOutput.from_bytes((0,Se.hexToBytes)(a)),r={address:(0,Se.bytesToHex)(n.address().to_bytes()),amount:(0,xe.$Z)(n.amount(),t)},s=n.data_hash();null!=s&&(r.dataHash=(0,Se.bytesToHex)(s.to_bytes())),N.push(r)}}));for(const e of null!=h?h:[]){var K;const a={...e.assets||{}},n=e=>{const n=[{identifier:t.defaultIdentifier,networkId:s.NetworkId,amount:new Y.Z(e)}];for(const e of A()(a)){const t=a[e];null!=t&&n.push({identifier:e,networkId:s.NetworkId,amount:new Y.Z(t)})}return new Ie.a(n,{defaultNetworkId:s.NetworkId,defaultIdentifier:t.defaultIdentifier})},r=e.mintRequest;if(null!=r&&r.length>0){var q;if(0===k()(q=e.address||"").call(q).length)throw new Error("A transaction target must include a valid non-empty address `address`!");for(const e of r){var z;const{script:t,assetName:n,amount:r,metadata:s,storeScriptOnChain:o}=e,{policyId:i,assetId:l}=O(e),d=new Y.Z(null!==(z=a[l])&&void 0!==z?z:"0").plus(new Y.Z(null!=r?r:"1"));if(!d.isPositive())throw new Error("Target mint cannot sum to a non-positive amount! Use root mint-request for burning!");const c=d.toString();L.push({policyScript:t,assetName:n,amount:c}),a[l]=c,V(s,i,n),!0===Boolean(o)&&U.push(t)}}let o=n(null!==(K=e.value)&&void 0!==K?K:"1000000");const i=e.dataHash,l=e.ensureRequiredMinimalValue;if(null==l||!1===l){if(null==e.value)throw new Error(`Value is required for a valid tx output, got: ${D()(e)}`)}else{var Z;const t=(0,xe.RY)(o,new Y.Z(d.coinsPerUtxoByte));t.gt(null!==(Z=e.value)&&void 0!==Z?Z:"0")&&(o=n(t.toString()))}N.push({address:e.address,amount:o,dataHash:i})}for(const e of f||[]){const{script:t,assetName:a,amount:n,metadata:r}=e,{policyId:s}=O(e);L.push({policyScript:t,assetName:a,amount:null!=n?n:"1"}),V(r,s,a)}const $={};for(const e of A()(H))$[String(e)]=D()(H[e]);const j={metadata:$,nativeScripts:U},J=await(0,ie.u2)(N,L,j,E,C,W,o,y,m,b,{linearFeeCoefficient:d.linearFee.coefficient,linearFeeConstant:d.linearFee.constant,coinsPerUtxoByte:d.coinsPerUtxoByte,poolDeposit:d.poolDeposit,keyDeposit:d.keyDeposit,networkId:s.NetworkId},s.NetworkId);return new ye.Y({senderUtxos:J.senderUtxos,unsignedTx:J.txBuilder,changeAddr:J.changeAddr,metadata:void 0,networkSettingSnapshot:{ChainNetworkId:Number((0,Te.getCardanoHaskellBaseConfig)(s)[0].ChainNetworkId),KeyDeposit:new Y.Z(d.keyDeposit),PoolDeposit:new Y.Z(d.poolDeposit),NetworkId:s.NetworkId},neededStakingKeyHashes:{neededHashes:new(B()),wits:new(B())}})}async createDelegationTx(e){q.Yd.debug("AdaApi::createDelegationTx called");try{const{wallet:t}=e,a=(0,Te.getNetworkById)(t.networkId),n={keyDeposit:e.protocolParameters.keyDeposit,linearFeeCoefficient:e.protocolParameters.linearFee.coefficient,linearFeeConstant:e.protocolParameters.linearFee.constant,coinsPerUtxoByte:e.protocolParameters.coinsPerUtxoByte,poolDeposit:e.protocolParameters.poolDeposit,networkId:a.NetworkId},r=_e.RustModule.WalletV4.Bip32PublicKey.from_hex(t.publicKey),s=(0,Re.c)({addressing:t.stakingAddressing.addressing,startingFrom:{level:t.publicDeriverLevel,key:r}}).to_raw_key(),o=(0,X.createCertificate)(s.hash().to_hex(),e.registrationStatus,e.poolRequest,e.drepCredential),i=t.utxos,d=(0,xe.ue)(i),c=await t.receiveAddress,u=await(0,ie.fi)([],{address:c.addr.Hash,addressing:c.addressing},d,e.absSlotNumber,n,o,[],!1,void 0,e.wallet.networkId),p=(0,X.filterAddressesByStakingKey)(_e.RustModule.WalletV4.Credential.from_keyhash(s.hash()),i,!1),g={defaultNetworkId:t.networkId,defaultIdentifier:t.defaultTokenId},h=F()(p).call(p,((e,t)=>{var a;return e.joinAddMutable(new Ie.a(G()(a=t.output.tokens).call(a,(e=>({identifier:e.Token.Identifier,amount:new Y.Z(e.TokenList.Amount),networkId:e.Token.NetworkId}))),g))}),new Ie.a([],g)),f=function(e,t,a,n){const r=_e.RustModule.WasmScope((e=>e.WalletV4.Credential.from_keyhash(a.hash()).to_hex())),s=new Ie.a([],n);for(const a of e.senderUtxos){const e=l()(t).call(t,(e=>e.output.Transaction.Hash===a.tx_hash&&e.output.UtxoTransactionOutput.OutputIndex===a.tx_index));if(null==e)throw new Error("getDifferenceAfterTx utxo not found. Should not happen");const i=e.address;var o;(0,X.addrContainsAccountKey)(i,r,!0)&&s.joinAddMutable(new Ie.a(G()(o=e.output.tokens).call(o,(e=>({identifier:e.Token.Identifier,amount:new Y.Z(e.TokenList.Amount),networkId:e.Token.NetworkId}))),n))}const i=new Ie.a([],n);{const t=e.txBuilder.build();for(const e of(0,Se.iterateLenGet)(t.outputs()))(0,X.addrContainsAccountKey)(e.address().to_hex(),r,!0)&&i.joinAddMutable((0,xe.$Z)(e.amount(),n))}return i.joinSubtractCopy(s)}(u,i,s,g),w=h.joinAddCopy(f).joinAddCopy(e.valueInAccount),y=_e.RustModule.WasmScope((e=>e.WalletV4.Credential.from_keyhash(s.hash()).to_hex()));return{signTxRequest:new ye.Y({senderUtxos:u.senderUtxos,unsignedTx:u.txBuilder,changeAddr:u.changeAddr,metadata:void 0,networkSettingSnapshot:{ChainNetworkId:Number((0,Te.getCardanoHaskellBaseConfig)(a)[0].ChainNetworkId),KeyDeposit:new Y.Z(e.protocolParameters.keyDeposit),PoolDeposit:new Y.Z(e.protocolParameters.poolDeposit),NetworkId:a.NetworkId},neededStakingKeyHashes:{neededHashes:new(B())([y]),wits:new(B())}}),totalAmountToDelegate:w}}catch(e){if(q.Yd.error("AdaApi::createDelegationTx error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}async createWithdrawalTx(e){q.Yd.debug("AdaApi::createUnsignedTx called");try{var t,a,n;const r=(0,Te.getNetworkById)(e.wallet.networkId),s=F()(t=(0,Te.getCardanoHaskellBaseConfig)(r)).call(t,((e,t)=>V()(e,t)),{}),o={keyDeposit:e.protocolParameters.keyDeposit,linearFeeCoefficient:e.protocolParameters.linearFee.coefficient,linearFeeConstant:e.protocolParameters.linearFee.constant,coinsPerUtxoByte:e.protocolParameters.coinsPerUtxoByte,poolDeposit:e.protocolParameters.poolDeposit,networkId:e.wallet.networkId},i=e.wallet.utxos,l=(0,xe.ue)(i),d=e.wallet.receiveAddress,c=[],u={neededHashes:new(B()),wits:new(B())},p=[];for(const t of e.withdrawals){const e=_e.RustModule.WalletV4.RewardAddress.from_address(_e.RustModule.WalletV4.Address.from_hex(t.rewardAddress));if(null==e)throw new Error("AdaApi::createUnsignedTx withdrawal not a reward address");const a=e.payment_cred(),n=a.to_keyhash();if(null==n)throw new Error("Unexpected: withdrawal from a script hash");p.push(n),t.shouldDeregister&&(c.push(_e.RustModule.WalletV4.Certificate.new_stake_deregistration(_e.RustModule.WalletV4.StakeDeregistration.new(a))),u.neededHashes.add(a.to_hex()))}const g=await e.getAccountState({network:r,addresses:G()(a=e.withdrawals).call(a,(e=>e.rewardAddress))}),h=F()(n=A()(g)).call(n,((e,t)=>{const a=g[t];if(null==a)return e;if(new Y.Z(a.remainingAmount).eq(0))return e;const n=_e.RustModule.WalletV4.RewardAddress.from_address(_e.RustModule.WalletV4.Address.from_hex(t));if(null==n)throw new Error("AdaApi::createUnsignedTx withdrawal not a reward address");{const e=n.payment_cred();u.neededHashes.add(e.to_hex())}return e.push({address:n,amount:_e.RustModule.WalletV4.BigNum.from_str(a.remainingAmount)}),e}),[]);if(0===h.length&&0===c.length)throw new ge.oy;const f=await(0,ie.fi)([],{address:d.addr.Hash,addressing:d.addressing},l,e.absSlotNumber,o,c,h,!1,void 0,e.wallet.networkId);if(0===f.changeAddr.length)throw new ge.r7;q.Yd.debug("AdaApi::createWithdrawalTx success: "+(0,q.WO)(f));{const t=f.txBuilder.build_tx();for(const a of e.withdrawals)if(null!=a.privateKey){const{privateKey:e}=a;u.wits.add(_e.RustModule.WalletV4.make_vkey_witness(_e.RustModule.WalletV4.FixedTransaction.from_hex(t.to_hex()).transaction_hash(),e).to_hex())}}return new ye.Y({senderUtxos:f.senderUtxos,unsignedTx:f.txBuilder,changeAddr:f.changeAddr,metadata:void 0,networkSettingSnapshot:{ChainNetworkId:H()(s.ChainNetworkId,10),KeyDeposit:new Y.Z(e.protocolParameters.keyDeposit),PoolDeposit:new Y.Z(e.protocolParameters.poolDeposit),NetworkId:e.wallet.networkId},neededStakingKeyHashes:u})}catch(e){if(q.Yd.error("AdaApi::createWithdrawalTx error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}async createSimpleTx(e){q.Yd.debug("AdaApi::createSimpleTx called");try{const t=(0,Te.getCardanoHaskellBaseConfig)((0,Te.getNetworkById)(e.publicDeriver.networkId)),a=F()(t).call(t,((e,t)=>V()(e,t)),{}),n={keyDeposit:e.protocolParameters.keyDeposit,linearFeeCoefficient:e.protocolParameters.linearFee.coefficient,linearFeeConstant:e.protocolParameters.linearFee.constant,coinsPerUtxoByte:e.protocolParameters.coinsPerUtxoByte,poolDeposit:e.protocolParameters.poolDeposit,networkId:e.publicDeriver.networkId},r=(0,xe.ue)(e.publicDeriver.utxos),s=e.publicDeriver.receiveAddress,o=new Y.Z(De.Z.timeToAbsoluteSlot(t,new Date)),i=await(0,ie.fi)(_()(e),{address:s.addr.Hash,addressing:s.addressing},r,o,n,[],[],!1,e.metadata,e.publicDeriver.networkId);return new ye.Y({senderUtxos:i.senderUtxos,unsignedTx:i.txBuilder,changeAddr:i.changeAddr,metadata:e.metadata,networkSettingSnapshot:{ChainNetworkId:H()(a.ChainNetworkId,10),KeyDeposit:new Y.Z(e.protocolParameters.keyDeposit),PoolDeposit:new Y.Z(e.protocolParameters.poolDeposit),NetworkId:e.publicDeriver.networkId},neededStakingKeyHashes:{neededHashes:new(B()),wits:new(B())}})}catch(e){if(q.Yd.error("AdaApi::createSimpleTx error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}async createVotingRegTx(e){q.Yd.debug("AdaApi::createVotingRegTx called");try{var t;const a=F()(t=(0,Te.getCardanoHaskellBaseConfig)((0,Te.getNetworkById)(e.wallet.networkId))).call(t,((e,t)=>V()(e,t)),{}),n={keyDeposit:e.protocolParameters.keyDeposit,linearFeeCoefficient:e.protocolParameters.linearFee.coefficient,linearFeeConstant:e.protocolParameters.linearFee.constant,coinsPerUtxoByte:e.protocolParameters.coinsPerUtxoByte,poolDeposit:e.protocolParameters.poolDeposit,networkId:e.wallet.networkId},r=await e.wallet.utxos,s=(0,xe.ue)(r),o=e.wallet.receiveAddress;if(null==o)throw new Error("createVotingRegTx no internal addresses left. Should never happen");let i;if(e.trezorTWallet||e.ledgerNanoWallet){const t=e.trezorTWallet||e.ledgerNanoWallet;i=(0,Me.L4)(t.votingPublicKey,t.stakingKey,t.paymentAddress,t.nonce,(e=>v()("0").call("0",128)))}else i=e.normalWallet.metadata;const l=await(0,ie.fi)([],{address:o.addr.Hash,addressing:o.addressing},s,e.absSlotNumber,n,[],[],!1,i,e.wallet.networkId);return new ye.Y({senderUtxos:l.senderUtxos,unsignedTx:l.txBuilder,changeAddr:l.changeAddr,metadata:i,networkSettingSnapshot:{ChainNetworkId:H()(a.ChainNetworkId,10),KeyDeposit:new Y.Z(e.protocolParameters.keyDeposit),PoolDeposit:new Y.Z(e.protocolParameters.poolDeposit),NetworkId:e.wallet.networkId},neededStakingKeyHashes:{neededHashes:new(B()),wits:new(B())},trezorTCatalystRegistrationTxSignData:e.trezorTWallet?e.trezorTWallet:void 0,ledgerNanoCatalystRegistrationTxSignData:e.ledgerNanoWallet?e.ledgerNanoWallet:void 0})}catch(e){if(q.Yd.error("AdaApi::createVotingRegTx error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}async saveLastReceiveAddressIndex(e){q.Yd.debug("AdaApi::saveLastReceiveAddressIndex called");try{const t=(0,se.Bq)(e.publicDeriver);if(null==t)return;await t.setCutoff({newIndex:e.index})}catch(e){if(q.Yd.error("AdaApi::saveLastReceiveAddressIndex error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}static isValidMnemonic(e){return(0,ce.n)(e.mnemonic,e.numberOfWords)}generateWalletRecoveryPhrase(){q.Yd.debug("AdaApi::generateWalletRecoveryPhrase called");try{const e=new(m())((e=>e((0,le.sn)())));return q.Yd.debug("AdaApi::generateWalletRecoveryPhrase success"),e}catch(e){if(q.Yd.error("AdaApi::generateWalletRecoveryPhrase error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}async restoreWallet(e){q.Yd.debug("AdaApi::restoreWallet called");const{recoveryPhrase:t,walletName:a,walletPassword:n}=e;if(e.accountIndex<$.yK)throw new Error("restoreWallet needs hardened index");try{const r=(0,le.BT)(t),s=[],o=await(0,j.fd)({db:e.db,rootPk:r,password:n,accountIndex:e.accountIndex,walletName:a,accountName:"",network:e.network}),i=await ee.H.createCip1852Wallet(e.db,o.cip1852WrapperRow);for(const e of o.publicDeriver)s.push(await re.n.createPublicDeriver(e.publicDeriverResult,i));return q.Yd.debug("AdaApi::restoreWallet success"),{publicDerivers:s}}catch(e){var r;if(q.Yd.error("AdaApi::restoreWallet error: "+(0,q.n)(e)),null!=e.message&&w()(r=e.message).call(r,"Wallet with that mnemonics already exists"))throw new ge.JI;if(e instanceof he.default)throw e;throw new ge.rp}}async restoreWalletForTransfer(e){var t;q.Yd.debug("AdaApi::restoreWalletForTransfer called");const{checkAddressesInUse:a}=e,n=F()(t=(0,Te.getCardanoHaskellBaseConfig)(e.network)).call(t,((e,t)=>V()(e,t)),{});try{const t=new(h()),r=new(B()),s=e=>{if(!r.has(e.address.data)){let a=t.get(e.keyDerivationId);null==a&&(a=[],t.set(e.keyDerivationId,a)),a.push(e.address.data),r.add(e.address.data)}return m().resolve()},o=_e.RustModule.WalletV2.Bip44AccountPublic.new((0,de.v4PublicToV2)(e.accountPubKey),_e.RustModule.WalletV2.DerivationScheme.v2()),i=await(0,fe.Mo)({network:e.network,generateInternalAddresses:(0,we.H)(o.bip44_chain(!1),n.ByronNetworkId),generateExternalAddresses:(0,we.H)(o.bip44_chain(!0),n.ByronNetworkId),lastUsedInternal:-1,lastUsedExternal:-1,checkAddressesInUse:a,addByHash:s,type:ae.dq.CARDANO_LEGACY}),l=(0,te.I_)(i),d=[];for(let a=0;a<l.length;a++){const n=l[a];await n.insert({db:null,tx:null,lockedTables:[],keyDerivationId:a});const r=t.get(a);if(null==r)throw new Error("restoreWalletForTransfer should never happen");const s=G()(r).call(r,(t=>{var a;return{address:t,addressing:{startLevel:Ce.Bip44DerivationLevels.ACCOUNT.level,path:p()(a=[e.accountIndex]).call(a,n.path)}}}));d.push(...s)}return q.Yd.debug("restoreWalletForTransfer success"),{addresses:d}}catch(e){var r;if(q.Yd.error("restoreWalletForTransfer error: "+(0,q.n)(e)),null!=e.message&&w()(r=e.message).call(r,"Wallet with that mnemonics already exists"))throw new ge.JI;if(e instanceof he.default)throw e;throw new ge.rp}}async transferToCip1852(e){try{var t,a;const n=await this.restoreWalletForTransfer({accountPubKey:e.bip44AccountPubKey,accountIndex:e.accountIndex,checkAddressesInUse:e.checkAddressesInUse,network:e.network}),r=e.cip1852AccountPubKey.derive($.OC.INTERNAL).derive(0).to_raw_key().hash(),s=e.cip1852AccountPubKey.derive($.OC.CHIMERIC_ACCOUNT).derive(0).to_raw_key().hash(),o=F()(t=(0,Te.getCardanoHaskellBaseConfig)(e.network)).call(t,((e,t)=>V()(e,t)),{}),i=H()(o.ChainNetworkId,10),l=_e.RustModule.WalletV4.BaseAddress.new(i,_e.RustModule.WalletV4.Credential.from_keyhash(r),_e.RustModule.WalletV4.Credential.from_keyhash(s)),d=G()(a=[...n.addresses]).call(a,(e=>({address:e.address,addressing:{path:[$.r7.BIP44,$.M8.CARDANO,...e.addressing.path],startLevel:Ce.Bip44DerivationLevels.PURPOSE.level}}))),c=await(0,ke.i)({network:e.network,addresses:d,getUTXOsForAddresses:e.getUTXOsForAddresses});return{publicKey:{key:e.bip44AccountPubKey,addressing:{startLevel:1,path:[$.r7.CIP1852,$.M8.CARDANO,e.accountIndex]}},signRequest:await this.createUnsignedTxForUtxos({absSlotNumber:e.absSlotNumber,receivers:[{address:l.to_address().to_hex(),addressing:{path:[$.r7.CIP1852,$.M8.CARDANO,e.accountIndex,$.OC.INTERNAL,0],startLevel:1}}],network:e.network,defaultToken:{defaultIdentifier:e.defaultToken.Identifier,defaultNetworkId:e.defaultToken.NetworkId},tokens:[{shouldSendAll:!0,token:e.defaultToken}],utxos:c,metadata:void 0,protocolParameters:e.protocolParameters})}}catch(e){if(q.Yd.error("transferToCip1852 error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}async createHardwareWallet(e){try{if(q.Yd.debug("AdaApi::createHardwareWallet called"),e.addressing.startLevel!==Ce.Bip44DerivationLevels.PURPOSE.level)throw new Error("AdaApi::createHardwareWallet bad addressing start level");if(e.addressing.path[0]!==$.r7.CIP1852)throw new Error("createHardwareWallet unknown restoration mode");const t=await(0,j.B8)({db:e.db,accountPublicKey:_e.RustModule.WalletV4.Bip32PublicKey.from_hex(e.publicKey),accountIndex:e.addressing.path[Ce.Bip44DerivationLevels.ACCOUNT.level-e.addressing.startLevel],walletName:e.walletName,accountName:"",hwWalletMetaInsert:e.hwFeatures,network:e.network}),a=await ee.H.createCip1852Wallet(e.db,t.cip1852WrapperRow);if(1!==t.publicDeriver.length)throw new Error("AdaApi::createHardwareWallet should only do 1 HW derivation at a time");const n=t.publicDeriver[0].publicDeriverResult,r=await re.n.createPublicDeriver(n,a);return q.Yd.debug("AdaApi::restoreWallet success"),{publicDeriver:r}}catch(e){if(q.Yd.error("AdaApi::createHardwareWallet error: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}async getTransactionRowsToExport(e){try{const t=await(0,J._v)({publicDeriver:e.publicDeriver});return q.Yd.debug("AdaApi::getTransactionRowsToExport: success"),(0,xe.Nf)(t.txs,e.getDefaultToken(e.publicDeriver.getParent().getNetworkInfo().NetworkId))}catch(e){if(q.Yd.error("AdaApi::getTransactionRowsToExport: "+(0,q.n)(e)),e instanceof he.default)throw e;throw new ge.rp}}utxosWithSubmittedTxs(e,t,a){const n=E()(a).call(a,(e=>e.publicDeriverId===t)),r=new(B())(c()(n).call(n,(({usedUtxos:e})=>{var t;return G()(t=e||[]).call(t,(({txHash:e,index:t})=>`${e}${t}`))}))),s=E()(e).call(e,(e=>!r.has(e.utxo_id)));for(const{transaction:e}of n)for(const[t,{address:a,value:n}]of _()(i=e.addresses.to).call(i)){var i,d,u,p,g;if(l()(s).call(s,(a=>a.utxo_id===`${e.txid}${t}`)))continue;const r=(null===(d=l()(u=o()(n)).call(u,(({identifier:e})=>e===n.defaults.defaultIdentifier)))||void 0===d?void 0:d.amount.toString())||"0",c=G()(p=E()(g=o()(n)).call(g,(({identifier:e})=>e!==n.defaults.defaultIdentifier))).call(p,(e=>{const[t,a=""]=e.identifier.split(".");return{policyId:t,name:a,amount:e.amount.toString(),assetId:e.identifier}}));s.push({utxo_id:`${e.txid}${t}`,tx_hash:e.txid,tx_index:t,receiver:a,amount:r,assets:c})}return s}async addressedUtxosWithSubmittedTxs(e,t,a){const n=(0,se.se)(t);if(!n)throw new Error("unable to get UTxO addresses from public deriver");const r=await n.getAllUtxoAddresses();return this._addressedUtxosWithSubmittedTxs(e,t.publicDeriverId,r,a)}async _addressedUtxosWithSubmittedTxs(e,t,a,n){const r=E()(n).call(n,(e=>e.publicDeriverId===t)),s=new(B())(c()(r).call(r,(({usedUtxos:e})=>{var t;return G()(t=e||[]).call(t,(({txHash:e,index:t})=>`${e}${t}`))}))),i=E()(e).call(e,(e=>!s.has(e.utxo_id)));for(const{transaction:e}of r)for(const[t,{address:n,value:r}]of _()(d=e.addresses.to).call(d)){var d,u,p,g,h;if(l()(i).call(i,(a=>a.utxo_id===`${e.txid}${t}`)))continue;const s=(null===(u=l()(p=o()(r)).call(p,(({identifier:e})=>e===r.defaults.defaultIdentifier)))||void 0===u?void 0:u.amount.toString())||"0",c=G()(g=E()(h=o()(r)).call(h,(({identifier:e})=>e!==r.defaults.defaultIdentifier))).call(g,(e=>{const[t,a=""]=e.identifier.split(".");return{policyId:t,name:a,amount:e.amount.toString(),assetId:e.identifier}})),f=()=>{for(const{addrs:e,addressing:t}of a)for(const{Hash:a}of e)if(a===n)return t},w=f();w&&i.push({utxo_id:`${e.txid}${t}`,tx_hash:e.txid,tx_index:t,receiver:n,amount:s,assets:c,addressing:w})}return i}async getAllUsedAddresses(e,t){const a=await(0,ve.Hk)(e);return this._getAllUsedAddresses({allAddresses:a,submittedTransactions:t,publicDeriverId:e.getPublicDeriverId()})}async _getAllUsedAddresses(e){var t,a,n,r,s,o;const i=G()(t=E()(a=e.allAddresses.utxoAddresses).call(a,(e=>e.address.IsUsed))).call(t,(e=>e.address.Hash)),l=G()(n=E()(r=e.allAddresses.utxoAddresses).call(r,(e=>!e.address.IsUsed))).call(n,(e=>e.address.Hash)),d=new(B())(c()(s=E()(o=e.submittedTransactions).call(o,(t=>t.publicDeriverId===e.publicDeriverId))).call(s,(({transaction:e})=>{var t;return G()(t=e.addresses.to).call(t,(({address:e})=>e))})));return[...i,...E()(l).call(l,(e=>d.has(e)))]}async createReorgTx(e,t,a,n,r,s,o){const i=e.getParent().getNetworkInfo(),l=(0,se.se)(e);if(null==l)throw new Error("missing utxo functionality");if(null==(0,se.sX)(l))throw new Error("missing chains functionality");const d=await(0,Ae.WH)(e);if(null==d)throw new Error("no receive addresses. Should never happen");const c=await this.getAllUsedAddresses(e,r),u=o||c[0];if(!u)throw new Error("unexpected: no target address or used addresses available");return this._createReorgTx(i,e.getParent().getDefaultToken(),e.getPublicDeriverId(),await l.getAllUtxoAddresses(),d,t,a,n,r,u,s)}async _createReorgTx(e,t,a,n,r,s,o,i,l,d,c){var u;const p=(0,Te.getCardanoHaskellBaseConfig)(e),g=new Y.Z(De.Z.timeToAbsoluteSlot(p,new Date)),h=new(B())(s),f=[{address:d,isForeign:!1,value:Y.Z.max(o,"1000000").toString()}];return{unsignedTx:await this._createUnsignedTxForConnector({includeTargets:f},t,a,n,r,e,g,l,E()(u=await this._addressedUtxosWithSubmittedTxs(i,a,n,l)).call(u,(e=>!h.has(e.utxo_id))),c,null),collateralOutputAddressSet:new(B())([d])}}createForeignUtxoFetcher(e,t){return async a=>{const n=G()(a).call(a,(e=>{var t;if((null!==(t=e.length)&&void 0!==t?t:0)<65)throw new Error(`Invalid utxo ID "${e}", expected \`{hash}{index}\` with no separator`);try{return{txHash:e.substring(0,64),txIndex:r()(e.substring(64),10)}}catch(t){throw new Error(`Failed to parse utxo ID "${e}": ${String(t)}`)}})),s=await e.getUtxoData({network:t,utxos:n});return G()(s).call(s,((e,t)=>{if(null==e)return null;const{txHash:r,txIndex:s}=n[t];return{utxo_id:a[t],tx_hash:r,tx_index:s,receiver:e.output.address,amount:e.output.amount,assets:e.output.assets}}))}}}async function We(e){try{const t=await e.publicDeriver.getSigningKey(),a=await e.publicDeriver.getStakingKey(),n=await e.publicDeriver.normalizeKey({...t,password:e.password}),r=_e.RustModule.WalletV4.Bip32PrivateKey.from_hex(n.prvKeyHex);return(0,Re.r)({addressing:a.addressing,startingFrom:{key:r,level:e.publicDeriver.getParent().getPublicDeriverLevel()}}).to_raw_key()}catch(e){if(q.Yd.error("genOwnStakingKey error: "+(0,q.n)(e)),e instanceof me.UZ)throw new ge.dJ;if(e instanceof he.default)throw e;throw new ge.rp}}function Ee(e,t,a){const n=_e.RustModule.WalletV4.Bip32PublicKey.from_hex(e.publicKey),r={addressing:{path:[$.r7.CIP1852,Ce.CoinType.CARDANO,$.yK,t,a],startLevel:Ce.Bip44DerivationLevels.PURPOSE.level}};return[(0,Re.c)({...r,startingFrom:{level:e.publicDeriverLevel,key:n}}).to_raw_key(),r]}async function Ne(e){const t=(0,se.O8)(e);if(null==t)throw new Error("Unable to get public key from the wallet");const a=(0,se.JM)(e);if(null==a)throw new Error("Unable to get derivation levels from the wallet");return Ee({publicKey:(await t.getPublicKey()).Hash,publicDeriverLevel:a.getParent().getPublicDeriverLevel()},$.OC.GOVERNANCE_DREP_KEYS,$.x_)}async function Be(e,t){const a=e=>{for(const{addrs:a,addressing:n}of e)for(const{Hash:e}of a)if(e===t)return{addressing:n}},n=(0,se.Oq)(e);if(!n)throw new Error("unable to get accounting addresses from public deriver");const r=a(await n.getAllAccountingAddresses());if(r)return r;const[s,o]=await Ne(e);if(s.hash().to_hex()===t)return o;const i=(0,se.se)(e);if(!i)throw new Error("unable to get UTxO addresses from public deriver");return a(await i.getAllUtxoAddresses())}async function Le(e,t,a,n){const r=(0,se.y9)(e);if(!r)throw new Error("unable to get signing key");const s=await r.normalizeKey({...await r.getSigningKey(),password:t}),o=(0,se.JM)(e);if(!o)throw new Error("unable to get levels");const i=await Be(e,a);if(!i)throw new Error("key derivation path does not exist");const l=(0,Re.r)({addressing:i.addressing,startingFrom:{key:_e.RustModule.WalletV4.Bip32PrivateKey.from_hex(s.prvKeyHex),level:o.getParent().getPublicDeriverLevel()}}).to_raw_key(),d=await(0,de.cip8Sign)((0,Se.hexToBytes)(a),l,(0,Se.hexToBytes)(n)),c=(0,de.makeCip8Key)(l.to_public().as_bytes());return{signature:(0,Se.bytesToHex)(d.to_bytes()),key:(0,Se.bytesToHex)(c.to_bytes())}}async function He(e,t,a,n){const r=await(0,de.buildCoseSign1FromSignature)((0,Se.hexToBytes)(e),(0,Se.hexToBytes)(t),(0,Se.hexToBytes)(a)),s=(0,de.makeCip8Key)((0,Se.hexToBytes)(n));return{signature:(0,Se.bytesToHex)(r.to_bytes()),key:(0,Se.bytesToHex)(s.to_bytes())}}},75723:(e,t,a)=>{a.d(t,{v4PublicToV2:()=>s,addressBech32ToHex:()=>o,transactionHexToWitnessSet:()=>i,transactionHexToHash:()=>l,transactionHexReplaceWitnessSet:()=>d,cip8Sign:()=>c,buildCoseSign1FromSignature:()=>u,makeCip8Key:()=>p}),a(29828);var n=a(86335),r=a(90649);function s(e){return n.RustModule.WalletV2.PublicKey.from_hex((0,r.bytesToHex)(e.as_bytes()))}function o(e){return n.RustModule.WasmScope((t=>t.WalletV4.Address.from_bech32(e).to_hex()))}function i(e){return n.RustModule.WasmScope((t=>(0,r.bytesToHex)(t.WalletV4.FixedTransaction.from_hex(e).raw_witness_set())))}function l(e){return n.RustModule.WasmScope((t=>t.WalletV4.FixedTransaction.from_hex(e).transaction_hash().to_hex()))}function d(e,t){return n.RustModule.WasmScope((a=>{const n=a.WalletV4.FixedTransaction.from_hex(e);return n.set_witness_set((0,r.hexToBytes)(t)),n.to_hex()}))}a(95667);const c=async(e,t,a)=>{const r=n.RustModule.MessageSigning.HeaderMap.new();r.set_algorithm_id(n.RustModule.MessageSigning.Label.from_algorithm_id(n.RustModule.MessageSigning.AlgorithmId.EdDSA)),r.set_header(n.RustModule.MessageSigning.Label.new_text("address"),n.RustModule.MessageSigning.CBORValue.new_bytes(e));const s=n.RustModule.MessageSigning.ProtectedHeaderMap.new(r),o=n.RustModule.MessageSigning.HeaderMap.new(),i=n.RustModule.MessageSigning.Headers.new(s,o),l=n.RustModule.MessageSigning.COSESign1Builder.new(i,a,!1),d=l.make_data_to_sign().to_bytes(),c=t.sign(d).to_bytes();return l.build(c)},u=async(e,t,a)=>{const r=n.RustModule.MessageSigning.HeaderMap.new();r.set_algorithm_id(n.RustModule.MessageSigning.Label.from_algorithm_id(n.RustModule.MessageSigning.AlgorithmId.EdDSA)),r.set_header(n.RustModule.MessageSigning.Label.new_text("address"),n.RustModule.MessageSigning.CBORValue.new_bytes(e));const s=n.RustModule.MessageSigning.ProtectedHeaderMap.new(r),o=n.RustModule.MessageSigning.HeaderMap.new(),i=n.RustModule.MessageSigning.Headers.new(s,o);return n.RustModule.MessageSigning.COSESign1Builder.new(i,a,!1).build(t)},p=e=>{const t=n.RustModule.MessageSigning.COSEKey.new(n.RustModule.MessageSigning.Label.from_key_type(n.RustModule.MessageSigning.KeyType.OKP));return t.set_algorithm_id(n.RustModule.MessageSigning.Label.from_algorithm_id(n.RustModule.MessageSigning.AlgorithmId.EdDSA)),t.set_header(n.RustModule.MessageSigning.Label.new_int(n.RustModule.MessageSigning.Int.new_negative(n.RustModule.MessageSigning.BigNum.from_str("1"))),n.RustModule.MessageSigning.CBORValue.new_int(n.RustModule.MessageSigning.Int.new_i32(6))),t.set_header(n.RustModule.MessageSigning.Label.new_int(n.RustModule.MessageSigning.Int.new_negative(n.RustModule.MessageSigning.BigNum.from_str("2"))),n.RustModule.MessageSigning.CBORValue.new_bytes(e)),t}},32533:(e,t,a)=>{a.d(t,{p:()=>A,g:()=>M});var n=a(93476),r=a.n(n),s=a(32366),o=a.n(s),i=a(20455),l=a.n(i),d=a(29828),c=a.n(d),u=a(87672),p=a.n(u),g=a(59340),h=a.n(g),f=a(78580),w=a.n(f),y=a(2991),m=a.n(y),b=a(9669),v=a.n(b),x=a(13469),_=a(21131),T=a(27715),k=a(75723),I=a(90649);const A=({body:e,lastLaunchVersion:t,currentLocale:a,errorHandler:n})=>{var r;const s=null!==(r=e.txs)&&void 0!==r?r:[e];if(0===s.length)throw new Error("At least one transaction is required for submit");const o=m()(s).call(s,(e=>(0,I.bytesToBase64)(e.encodedTx))),{BackendService:i}=e.network.Backend;if(null==i)throw new Error("sendTx missing backend url");return v()(`${i}/api/txs/signed`,{method:"post",timeout:6e4,data:{signedTx:o},headers:{"yoroi-version":t,"yoroi-locale":a}}).then((()=>({txId:(0,I.forceNonNull)((0,I.last)(s)).id}))).catch((e=>{var t,a,r,s;null!=n&&n(e);const o={msg:e.message,res:(null===(t=e.response)||void 0===t?void 0:t.data)||null};if(x.Yd.error(`RemoteFetcher::sendTx error: ${(0,x.n)(o)}`),w()(a=h()(null!==(r=null===(s=e.response)||void 0===s?void 0:s.data)&&void 0!==r?r:"")).call(a,"InvalidWitnessesUTXOW"))throw new _.kl;throw new _.qH}))};class M{constructor(e,t,a){p()(this,"getLastLaunchVersion",void 0),p()(this,"getCurrentLocale",void 0),p()(this,"getPlatform",void 0),p()(this,"getUTXOsForAddresses",(async e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getUTXOsForAddresses missing backend url");const a=await v()(`${t}/api/txs/utxoForAddresses`,{method:"post",timeout:6e4,data:{addresses:e.addresses},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then((e=>e.data)).catch((e=>{throw x.Yd.error("RemoteFetcher::getUTXOsForAddresses error: "+(0,x.n)(e)),new _.oc}));return m()(a).call(a,(e=>{var t;if(c()(t=e.receiver).call(t,"addr")){const t=(0,k.addressBech32ToHex)(e.receiver);return{...e,receiver:t}}return e}))})),p()(this,"getTransactionsHistoryForAddresses",(e=>{const{network:t,...a}=e,{BackendService:n}=t.Backend;if(null==n)throw new Error("getTransactionsHistoryForAddresses missing backend url");return v()(`${n}/api/v2/txs/history`,{method:"post",timeout:6e4,data:a,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then((e=>{var t;return m()(t=e.data).call(t,(e=>{if("shelley"===e.type){for(const a of e.inputs){var t;a.assets=null!==(t=a.assets)&&void 0!==t?t:[];try{a.address=(0,I.bytesToHex)(T.bech32.fromWords(T.bech32.decode(a.address,1e3).words))}catch(e){}}for(const t of e.outputs){var a;t.assets=null!==(a=t.assets)&&void 0!==a?a:[];try{t.address=(0,I.bytesToHex)(T.bech32.fromWords(T.bech32.decode(t.address,1e3).words))}catch(e){}}}if(null!=e.height)return e;const n=e.block_num;return delete e.block_num,{...e,height:n}}))})).catch((e=>{var t,a,n;x.Yd.error("RemoteFetcher::getTransactionsHistoryForAddresses error: "+(0,x.n)(e));const r=null==e||null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a||null===(n=a.error)||void 0===n?void 0:n.response;if("REFERENCE_BLOCK_MISMATCH"===r||"REFERENCE_TX_NOT_FOUND"===r||"REFERENCE_BEST_BLOCK_MISMATCH"===r)throw new _.zJ;throw new _.PQ}))})),p()(this,"getRecentTransactionHashes",(e=>{const{network:t,addresses:a,before:n}=e,{BackendService:r}=t.Backend;if(null==r)throw new Error("getRecentTransactionHashes missing backend url");return v()(`${r}/api/v2.1/txs/summaries`,{method:"post",timeout:6e4,data:{addresses:a,before:n},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then((e=>e.data))})),p()(this,"getTransactionsByHashes",(e=>{const{network:t,txHashes:a}=e,{BackendService:n}=t.Backend;if(null==n)throw new Error("getTransactionsByHashes missing backend url");return v()(`${n}/api/v2/txs/get`,{method:"post",timeout:6e4,data:{txHashes:a},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then((e=>{var t;return m()(t=l()(e.data)).call(t,(e=>{if("shelley"===e.type){for(const a of e.inputs){var t;a.assets=null!==(t=a.assets)&&void 0!==t?t:[];try{a.address=(0,I.bytesToHex)(T.bech32.fromWords(T.bech32.decode(a.address,1e3).words))}catch(e){}}for(const t of e.outputs){var a;t.assets=null!==(a=t.assets)&&void 0!==a?a:[];try{t.address=(0,I.bytesToHex)(T.bech32.fromWords(T.bech32.decode(t.address,1e3).words))}catch(e){}}}if(null!=e.height)return e;const n=e.block_num;return delete e.block_num,{...e,height:n}}))}))})),p()(this,"getTransactionSlotsByHashes",(e=>{const{network:t,txHashes:a}=e,{BackendService:n}=t.Backend;if(null==n)throw new Error("getTransactionsByHashes missing backend url");return v()(`${n}/api/v2.1/tx/status`,{method:"post",timeout:6e4,data:{txHashes:a},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then((e=>{var t,a;return null!==(t=null===(a=e.data)||void 0===a?void 0:a.slot)&&void 0!==t?t:{}}))})),p()(this,"getRewardHistory",(e=>{const{network:t,...a}=e,{BackendService:n}=t.Backend;if(null==n)throw new Error("getRewardHistory missing backend url");return v()(`${n}/api/account/rewardHistory`,{method:"post",data:a,timeout:6e4,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then((e=>e.data)).catch((e=>{throw x.Yd.error("RemoteFetcher::getRewardHistory error: "+(0,x.n)(e)),new _.E8}))})),p()(this,"getBestBlock",(e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getBestBlock missing backend url");return v()(`${t}/api/v2/bestblock`,{method:"get",timeout:6e4,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then((e=>e.data)).catch((e=>{throw x.Yd.error("RemoteFetcher::getBestBlock error: "+(0,x.n)(e)),new _.k}))})),p()(this,"sendTx",(e=>A({body:e,lastLaunchVersion:this.getLastLaunchVersion(),currentLocale:this.getCurrentLocale()}))),p()(this,"checkAddressesInUse",(e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("checkAddressesInUse missing backend url");return v()(`${t}/api/v2/addresses/filterUsed`,{method:"post",timeout:6e4,data:{addresses:e.addresses},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then((e=>e.data)).catch((e=>{throw x.Yd.error("RemoteFetcher::checkAddressesInUse error: "+(0,x.n)(e)),new _.HH}))})),p()(this,"getAccountState",(e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getAccountState missing backend url");return v()(`${t}/api/account/state`,{method:"post",timeout:6e4,data:{addresses:e.addresses},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then((e=>e.data)).catch((e=>{throw x.Yd.error("RemoteFetcher::getAccountState error: "+(0,x.n)(e)),new _.AH}))})),p()(this,"getPoolInfo",(e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getPoolInfo missing backend url");return v()(`${t}/api/pool/info`,{method:"post",timeout:6e4,data:{poolIds:e.poolIds},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then((e=>e.data)).catch((e=>{throw x.Yd.error("RemoteFetcher::getPoolInfo error: "+(0,x.n)(e)),new _.nW}))})),p()(this,"getTokenInfo",(async e=>{var t,a;const{TokenInfoService:n}=e.network.Backend;if(null==n)return{};const s=m()(t=e.tokenIds).call(t,(e=>v()(`${n}/metadata/${e}`,{method:"get",timeout:6e4}).then((e=>({error:null,data:e.data}))).catch((t=>{var a;return 404===(null===(a=t.response)||void 0===a?void 0:a.status)?{error:"noMetadata",data:e}:(x.Yd.error("RemoteFetcher::getTokenInfo error: "+(0,x.n)(t)),{error:"fail",data:null})}))));return o()(a=await r().all(s)).call(a,((e,t)=>{if("noMetadata"===t.error)e[t.data]=null;else if(!t.error&&t.data.subject){var a,n,r,s;const o={};null!==(a=t.data.name)&&void 0!==a&&a.value&&(o.name=t.data.name.value),null!==(n=t.data.decimals)&&void 0!==n&&n.value&&(o.decimals=t.data.decimals.value),null!==(r=t.data.ticker)&&void 0!==r&&r.value&&(o.ticker=t.data.ticker.value),null!==(s=t.data.logo)&&void 0!==s&&s.value&&(o.logo=t.data.logo.value),(o.name||o.decimals||o.ticker||o.logo)&&(e[t.data.subject]=o)}return e}),{})})),p()(this,"getCatalystRoundInfo",(async e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getCatalystRoundInfo missing backend url");return await v()(`${t}/api/v0/catalyst/fundInfo`,{method:"get"}).then((e=>e.data)).catch((e=>{throw x.Yd.error("RemoteFetcher::getCatalystRoundInfo error: "+(0,x.n)(e)),new _.Dy}))})),p()(this,"getMultiAssetMintMetadata",(async e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getMultiAssetMintMetadata missing backend url");return await v()(`${t}/api/multiAsset/metadata`,{method:"post",data:{assets:e.assets}}).then((e=>e.data)).catch((e=>(x.Yd.error("RemoteFetcher::getMultiAssetMintMetadata error: "+(0,x.n)(e)),{})))})),p()(this,"getMultiAssetSupply",(async e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getMultiAssetSupply missing backend url");return await v()(`${t}/api/multiAsset/supply?numberFormat=string`,{method:"post",data:{assets:e.assets}}).then((e=>e.data.supplies)).catch((e=>(x.Yd.error("RemoteFetcher::getMultiAssetSupply error: "+(0,x.n)(e)),{})))})),p()(this,"getUtxoData",(async e=>{var t;const{BackendService:a}=e.network.Backend;if(null==a)throw new Error("getUtxoData missing backend url");return r().all(m()(t=e.utxos).call(t,(({txHash:e,txIndex:t})=>v()(`${a}/api/txs/io/${e}/o/${t}`,{method:"get",timeout:6e4,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then((e=>e.data)).catch((e=>{if(404===e.response.status&&"No outputs found"===e.response.data)return null;throw x.Yd.error("RemoteFetcher::getUtxoData error: "+(0,x.n)(e)),new _.Jq})))))})),p()(this,"getLatestBlockBySlot",(async e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getLatestBlockBySlot missing backend url");return v()(`${t}/api/v2.1/lastBlockBySlot`,{method:"post",data:{slots:e.slots},timeout:6e4,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then((e=>e.data)).catch((e=>(x.Yd.error("RemoteFetcher::getCatalystRoundInfo error: "+(0,x.n)(e)),{blockHashes:{}})))})),p()(this,"getSwapFeeTiers",(async e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getSwapFeeTiers missing backend url");return await v()(`${t}/api/v2.1/swap/feesInfo`,{method:"get"}).then((e=>e.data)).catch((e=>{throw x.Yd.error("RemoteFetcher::getCatalystRoundInfo error: "+(0,x.n)(e)),new _.Dy}))})),this.getLastLaunchVersion=e,this.getCurrentLocale=t,this.getPlatform=a}}},21636:(e,t,a)=>{a.d(t,{p:()=>s,U:()=>o});var n=a(56474),r=a.n(n);const s=r()({byron:"byron",shelley:"shelley"}),o=r()({StakeRegistration:"StakeRegistration",StakeDeregistration:"StakeDeregistration",StakeDelegation:"StakeDelegation",PoolRegistration:"PoolRegistration",PoolRetirement:"PoolRetirement",GenesisKeyDelegation:"GenesisKeyDelegation",MoveInstantaneousRewardsCert:"MoveInstantaneousRewardsCert",Registration:"Registration",Unregistration:"Unregistration",VoteDelegation:"VoteDelegation",StakeVoteDelegation:"StakeVoteDelegation",StakeRegistrationDelegation:"StakeRegistrationDelegation",VoteRegistrationDelegation:"VoteRegistrationDelegation",StakeVoteRegistrationDelegation:"StakeVoteRegistrationDelegation",AuthCommitteeHot:"AuthCommitteeHot",ResignCommitteeCold:"ResignCommitteeCold",RegisterDrep:"RegisterDrep",UnregisterDrep:"UnregisterDrep",UpdateDrep:"UpdateDrep"})},37495:(e,t,a)=>{a.d(t,{XN:()=>_,Hk:()=>T,te:()=>k,g_:()=>I});var n=a(86902),r=a.n(n),s=a(2991),o=a.n(s),i=a(80426),l=a.n(i),d=a(56474),c=a.n(d),u=a(39392),p=a.n(u),g=a(20116),h=a.n(g),f=a(3577),w=(a(38441),a(27189),a(57421)),y=a(39845),m=a(38079),b=a(91811),v=a(82982),x=a(1499);async function _(e){var t,a;const n=(0,f.JM)(e.publicDeriver),s=null==n?new(p()):n.getParent().getDerivationTables(),i=c()({GetUtxoTxOutputsWithTx:v.NW,GetAddress:y.t9,GetPathWithSpecific:y.LY,GetDerivationSpecific:b.n}),d=l()(t=o()(a=r()(i)).call(a,(e=>i[e]))).call(t,(t=>(0,w.Hz)(e.publicDeriver.getDb(),t)));return await(0,w.zm)(e.publicDeriver.getDb(),[...d,...(0,w.pS)(e.publicDeriver.getDb(),s)],(async t=>await async function(e,t,a,n){const r=(0,f.se)(a.publicDeriver);let s=null!=r?await r.rawGetAllUtxoAddresses(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},void 0,n):[];const o=(0,f.Oq)(a.publicDeriver),i=null!=o?await o.rawGetAllAccountingAddresses(e,{GetPathWithSpecific:t.GetPathWithSpecific,GetAddress:t.GetAddress,GetDerivationSpecific:t.GetDerivationSpecific},void 0,n):[],l=(0,f.Bq)(a.publicDeriver);if(null!=l&&!a.ignoreCutoff){const a=await l.rawGetCutoff(e,{GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},void 0,n);s=h()(s).call(s,(e=>e.addressing.path[e.addressing.path.length-1]<=a))}const d=[...s,...i];return await(0,x.oI)(a.publicDeriver.getDb(),e,{GetUtxoTxOutputsWithTx:t.GetUtxoTxOutputsWithTx},{addresses:d,type:a.type,networkId:a.publicDeriver.getParent().getNetworkInfo().NetworkId,defaultToken:a.publicDeriver.getParent().getDefaultToken()})}(t,i,{publicDeriver:e.publicDeriver,type:e.type,ignoreCutoff:!0===e.ignoreCutoff},s)))}async function T(e){var t,a;const n=(0,f.JM)(e);if(!n)throw new Error("getAllAddressesForWallet publicDerviver traits missing");const s=n.getParent().getDerivationTables(),i=c()({GetPathWithSpecific:y.LY,GetAddress:y.t9,GetDerivationSpecific:b.n}),d=l()(t=o()(a=r()(i)).call(a,(e=>i[e]))).call(t,(t=>(0,w.Hz)(e.getDb(),t)));return await(0,w.zm)(e.getDb(),[...d,...(0,w.pS)(e.getDb(),s)],(t=>I(t,i,{publicDeriver:e},s)))}async function k(e,t){var a,n;const{utxoAddresses:r,accountingAddresses:s}=await T(e);return o()(a=h()(n=[...r,...s]).call(n,(e=>e.address.IsUsed===t&&e.address.Type===m.dq.CARDANO_BASE))).call(a,(e=>e.address.Hash))}async function I(e,t,a,n){const r=[],s=[],o=(0,f.se)(a.publicDeriver);if(null!=o){const a=await o.rawGetAllUtxoAddresses(e,{GetPathWithSpecific:t.GetPathWithSpecific,GetAddress:t.GetAddress,GetDerivationSpecific:t.GetDerivationSpecific},void 0,n);for(const e of a)for(const t of e.addrs)r.push({address:t,path:e.addressing.path})}const i=(0,f.Oq)(a.publicDeriver);if(null!=i){const a=await i.rawGetAllAccountingAddresses(e,{GetPathWithSpecific:t.GetPathWithSpecific,GetAddress:t.GetAddress,GetDerivationSpecific:t.GetDerivationSpecific},void 0,n);for(const e of a)for(const t of e.addrs)s.push({address:t,path:e.addressing.path})}return{utxoAddresses:r,accountingAddresses:s}}},95667:(e,t,a)=>{a.d(t,{addressToKind:()=>p,normalizeToAddress:()=>w,getCardanoSpendingKeyHash:()=>y,toHexOrBase58:()=>m,unwrapStakingKey:()=>b,isCertificateKindDrepDelegation:()=>v});var n=a(94473),r=a.n(n),s=a(97093),o=a.n(s),i=(a(59340),a(51938),a(38079)),l=a(86335),d=a(84174),c=(a(99095),a(27715)),u=a(90649);function p(e,t,a){try{return l.RustModule.WasmScope((n=>{if((0,d.isCardanoHaskell)(a)){if(n.WalletV4.ByronAddress.is_valid(e))return i.dq.CARDANO_LEGACY;const a="bytes"===t?n.WalletV4.Address.from_hex(e):n.WalletV4.Address.from_bech32(e);if(n.WalletV4.ByronAddress.from_address(a))return i.dq.CARDANO_LEGACY;if(n.WalletV4.BaseAddress.from_address(a))return i.dq.CARDANO_BASE;if(n.WalletV4.PointerAddress.from_address(a))return i.dq.CARDANO_PTR;if(n.WalletV4.EnterpriseAddress.from_address(a))return i.dq.CARDANO_ENTERPRISE;if(n.WalletV4.RewardAddress.from_address(a))return i.dq.CARDANO_REWARD;throw new Error("addressToKind unknown address type")}throw new Error(`addressToKind not implemented for network ${a.NetworkId}`)}))}catch(t){throw new Error(`addressToKind failed to parse address type ${t} ${e}`)}}const g=e=>(0,u.bytesToHex)(c.bech32.fromWords(e)),h=e=>{const t=c.bech32.decodeUnsafe(e,e.length);return(0,u.maybe)(null==t?void 0:t.words,g)},f=[{validate:e=>57===(0,u.hexToBytes)(e).length,header:/^[0-3]/},{validate:e=>(0,u.hexToBytes)(e).length>=32,header:/^[4-5]/},{validate:e=>29===(0,u.hexToBytes)(e).length,header:/^[6-7]/},{parse:e=>{const t=(e=>{const t=[];let a=e;for(;a>0;){const e=a/BigInt(58),n=a%BigInt(58);a=e,t.push("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"[n])}return o()(t).call(t).join("")})(BigInt(`0x${e}`));if(l.RustModule.WalletV4.ByronAddress.is_valid(t))return l.RustModule.WalletV4.ByronAddress.from_base58(t).to_address()},header:/^[8]/},{validate:e=>29===(0,u.hexToBytes)(e).length,header:/^[e-f]|[E-F]/}];function w(e){var t;if(l.RustModule.WalletV4.ByronAddress.is_valid(e))return l.RustModule.WalletV4.ByronAddress.from_base58(e).to_address();const a=e=>{const t=r()(f).call(f,(t=>t.header.test(e)));if(t){if(t.parse)return t.parse(e);if(t.validate(e))try{return l.RustModule.WalletV4.Address.from_hex(e)}catch{}}};return/^[a-fA-F0-9]+$/.test(e)?a(e):null!==(t=(0,u.maybe)(h(e),a))&&void 0!==t?t:void 0}function y(e){if(l.RustModule.WalletV4.ByronAddress.from_address(e))return null;{const t=l.RustModule.WalletV4.BaseAddress.from_address(e);if(t)return t.payment_cred().to_keyhash()}{const t=l.RustModule.WalletV4.PointerAddress.from_address(e);if(t)return t.payment_cred().to_keyhash()}{const t=l.RustModule.WalletV4.EnterpriseAddress.from_address(e);if(t)return t.payment_cred().to_keyhash()}{const t=l.RustModule.WalletV4.RewardAddress.from_address(e);if(t)return t.payment_cred().to_keyhash()}throw new Error("getCardanoSpendingKeyHash unknown address type")}function m(e){var t,a;return null!==(t=null===(a=l.RustModule.WalletV4.ByronAddress.from_address(e))||void 0===a?void 0:a.to_base58())&&void 0!==t?t:e.to_hex()}function b(e){var t,a;return null!==(t=null===(a=l.RustModule.WalletV4.RewardAddress.from_address(l.RustModule.WalletV4.Address.from_hex(e)))||void 0===a?void 0:a.payment_cred())&&void 0!==t?t:(0,u.fail)("unwrapStakingKey staking key invalid")}function v(e){return e===l.RustModule.WalletV4.CertificateKind.VoteDelegation||e===l.RustModule.WalletV4.CertificateKind.StakeAndVoteDelegation||e===l.RustModule.WalletV4.CertificateKind.VoteRegistrationAndDelegation||e===l.RustModule.WalletV4.CertificateKind.StakeVoteRegistrationAndDelegation}},83349:(e,t,a)=>{a.d(t,{S:()=>p});var n=a(94473),r=a.n(n),s=a(39392),o=a.n(s),i=a(84174);const l=[{ExplorerId:106,NetworkId:i.networks.CardanoMainnet.NetworkId,IsBackup:!0,Endpoints:{address:"https://cardanoscan.io/address/",transaction:"https://cardanoscan.io/transaction/",pool:"https://cardanoscan.io/pool/",stakeAddress:"https://cardanoscan.io/stakeKey/",token:"https://cardanoscan.io/token/"},Name:"CardanoScan"},{ExplorerId:108,NetworkId:i.networks.CardanoMainnet.NetworkId,IsBackup:!1,Endpoints:{stakeAddress:"https://adastat.net/addresses/",address:"https://adastat.net/addresses/",transaction:"https://adastat.net/transactions/",pool:"https://adastat.net/pools/",token:"https://adastat.net/tokens/"},Name:"AdaStat"},{ExplorerId:104,NetworkId:i.networks.CardanoMainnet.NetworkId,IsBackup:!1,Endpoints:{address:"https://explorer.cardano.org/en/address?address=",transaction:"https://explorer.cardano.org/en/transaction?id="},Name:"CardanoExplorer"},{ExplorerId:100,NetworkId:i.networks.CardanoMainnet.NetworkId,IsBackup:!1,Endpoints:{address:"https://cexplorer.io/address/",transaction:"https://cexplorer.io/tx/",pool:"https://cexplorer.io/pool/",stakeAddress:"https://cexplorer.io/stake/",token:"https://cexplorer.io/asset/"},Name:"Cexplorer"},{ExplorerId:102,NetworkId:i.networks.CardanoMainnet.NetworkId,IsBackup:!1,Endpoints:{address:"https://blockchair.com/cardano/address/",transaction:"https://blockchair.com/cardano/transaction/"},Name:"Blockchair"},{ExplorerId:105,NetworkId:i.networks.CardanoMainnet.NetworkId,IsBackup:!1,Endpoints:{stakeAddress:"https://adapools.org/stake/",address:"https://adapools.org/address/",transaction:"https://adapools.org/transactions/",pool:"https://adapools.org/pool/"},Name:"ADApools"},{ExplorerId:107,NetworkId:i.networks.CardanoMainnet.NetworkId,IsBackup:!1,Endpoints:{pool:"https://pooltool.io/pool/"},Name:"PoolTool"}],d=[{ExplorerId:450,NetworkId:i.networks.CardanoPreprodTestnet.NetworkId,IsBackup:!0,Endpoints:{address:"https://testnet.cardanoscan.io/address/",transaction:"https://testnet.cardanoscan.io/transaction/",pool:"https://testnet.cardanoscan.io/pool/",stakeAddress:"https://testnet.cardanoscan.io/stakeKey/",token:"https://testnet.cardanoscan.io/token/"},Name:"CardanoScan"}],c=[{ExplorerId:550,NetworkId:i.networks.CardanoPreviewTestnet.NetworkId,IsBackup:!0,Endpoints:{address:"https://preview.cardanoscan.io/address/",transaction:"https://preview.cardanoscan.io/transaction/",pool:"https://preview.cardanoscan.io/pool/",stakeAddress:"https://preview.cardanoscan.io/stakeKey/",token:"https://preview.cardanoscan.io/token/"},Name:"CardanoScan"}],u=[{ExplorerId:650,NetworkId:i.networks.CardanoSanchoTestnet.NetworkId,IsBackup:!0,Endpoints:{address:"https://sancho.cexplorer.io/address/",transaction:"https://sancho.cexplorer.io/tx/",pool:"https://sancho.cexplorer.io/pool/",stakeAddress:"https://sancho.cexplorer.io/stake/",token:"https://sancho.cexplorer.io/asset/"},Name:"Cexplorer"}],p=new(o())([[i.networks.CardanoMainnet.NetworkId,l],[i.networks.CardanoPreprodTestnet.NetworkId,d],[i.networks.CardanoPreviewTestnet.NetworkId,c],[i.networks.CardanoSanchoTestnet.NetworkId,u]]),g=function(e){if(null==e)throw new Error("No backup explorer for type");return e};new(o())([[i.networks.CardanoMainnet.NetworkId,g(r()(l).call(l,(e=>e.IsBackup)))],[i.networks.CardanoPreprodTestnet.NetworkId,g(r()(d).call(d,(e=>e.IsBackup)))],[i.networks.CardanoPreviewTestnet.NetworkId,g(r()(c).call(c,(e=>e.IsBackup)))],[i.networks.CardanoSanchoTestnet.NetworkId,g(r()(u).call(u,(e=>e.IsBackup)))]])},41979:(e,t,a)=>{a.d(t,{o:()=>f,C:()=>w});var n=a(56474),r=a.n(n),s=a(20116),o=a.n(s),i=a(2991),l=a.n(i),d=a(87672),c=a.n(d),u=a(90691),p=a(97143),g=a(44946),h=a(78740);class f{static async addTxWithIOs(e,t,a){const{block:n,transaction:r}=a,s=await f.depTables.ModifyTransaction.addNew(e,t,{block:n,transaction:r}),{utxoInputs:i,utxoOutputs:d,tokenList:c}=a.ioGen(s.transaction.TransactionId),p=await f.depTables.ModifyUtxoTransaction.addIOsToTx(e,t,{utxoInputs:i,utxoOutputs:d}),g=await f.depTables.ModifyTokenList.upsert(e,t,l()(c).call(c,(e=>e.TokenList)));return{txType:u.iU.CardanoByron,...s,...p,tokens:l()(g).call(g,(e=>({TokenList:e,Token:{TokenId:e.TokenId,Identifier:o()(c).call(c,(t=>t.TokenList.TokenId===e.TokenId))[0].identifier,NetworkId:o()(c).call(c,(t=>t.TokenList.TokenId===e.TokenId))[0].networkId}})))}}}c()(f,"ownTables",r()({})),c()(f,"depTables",r()({ModifyTransaction:p.BP,ModifyUtxoTransaction:g.w,ModifyTokenList:p.xx}));class w{static async addTxWithIOs(e,t,a){const{block:n,transaction:r}=a,{depTables:s}=w,i=await s.ModifyTransaction.addNew(e,t,{block:n,transaction:r}),{utxoInputs:d,utxoOutputs:c,accountingInputs:p,tokenList:g}=a.ioGen(i.transaction.TransactionId),h=await s.ModifyUtxoTransaction.addIOsToTx(e,t,{utxoInputs:d,utxoOutputs:c}),f=await s.ModifyAccountingTransaction.addIOsToTx(e,t,{accountingInputs:p,accountingOutputs:[]}),y=[];for(const n of a.certificates){const a=n(i.transaction.TransactionId);null!=a&&y.push(await s.ModifyCertificate.addNew(e,t,a))}const m=await w.depTables.ModifyTokenList.upsert(e,t,l()(g).call(g,(e=>e.TokenList)));return{txType:u.iU.CardanoShelley,...i,certificates:y,...h,accountingInputs:f.accountingInputs,tokens:l()(m).call(m,(e=>({TokenList:e,Token:{TokenId:e.TokenId,Identifier:o()(g).call(g,(t=>t.TokenList.TokenId===e.TokenId))[0].identifier,NetworkId:o()(g).call(g,(t=>t.TokenList.TokenId===e.TokenId))[0].networkId}})))}}}c()(w,"ownTables",r()({})),c()(w,"depTables",r()({ModifyTransaction:p.BP,ModifyCertificate:p.XH,ModifyUtxoTransaction:g.w,ModifyAccountingTransaction:h.i,ModifyTokenList:p.xx}))},82982:(e,t,a)=>{a.d(t,{uR:()=>T,NW:()=>I,zb:()=>M,i9:()=>S});var n=a(56474),r=a.n(n),s=a(39392),o=a.n(s),i=a(36384),l=a.n(i),d=a(66419),c=a.n(d),u=a(87672),p=a.n(u),g=a(2991),h=a.n(g),f=a(47197),w=a(96486),y=a(68680),m=a(90691),b=a(39845),v=a(38079),x=a(57421);async function _(e,t,a,n,r){const s=await A.depTables.AssociateToken.join(e,t,{listIds:h()(a).call(a,(e=>n(e))),networkId:r}),o=[];for(const e of a){const t={...e,tokens:[]};for(const a of s)a.TokenList.ListId===n(e)&&t.tokens.push(a);o.push(t)}return o}class T{static async fromAddressIds(e,t,a){const n=T.ownTables[y.WF.name];return await(0,x.q$)(e,t,n.name,n.properties.AddressId,a.ids)}static async fromTxIds(e,t,a){const n=T.ownTables[y.WF.name];return await(0,x.q$)(e,t,n.name,n.properties.TransactionId,a.ids)}}p()(T,"ownTables",r()({[y.WF.name]:y.WF})),p()(T,"depTables",r()({}));class k{static async fromAddressIds(e,t,a){const n=k.ownTables[y.eM.name];return await(0,x.q$)(e,t,n.name,n.properties.AddressId,a.ids)}static async fromTxIds(e,t,a){const n=k.ownTables[y.eM.name];return await(0,x.q$)(e,t,n.name,n.properties.TransactionId,a.ids)}}p()(k,"ownTables",r()({[y.eM.name]:y.eM})),p()(k,"depTables",r()({}));class I{static baseQuery(e,t){const a=e.getSchema().table(I.ownTables[m.p5.name].name),n=e.getSchema().table(I.ownTables[y.eM.name].name);return e.select().from(a).innerJoin(n,a[m.p5.properties.TransactionId].eq(n[y.eM.properties.TransactionId])).where(t(a,n))}static async getSingleOutput(e,t,a){const n=I.baseQuery(e,((e,t)=>f.op.and(e[m.p5.properties.TransactionId].eq(a.txId),t[y.eM.properties.OutputIndex].eq(a.outputIndex)))),r=await t.attach(n);if(0!==r.length)return(await _(e,t,r,(e=>e.UtxoTransactionOutput.TokenListId),a.networkId))[0]}static async getUtxo(e,t,a,n){const r=I.baseQuery(e,((e,t)=>f.op.and(e[m.p5.properties.Status].eq(v.YM.IN_BLOCK),t[y.eM.properties.IsUnspent].eq(!0),t[y.eM.properties.AddressId].in(a)))),s=await t.attach(r);return await _(e,t,s,(e=>e.UtxoTransactionOutput.TokenListId),n)}static async getOutputsForAddresses(e,t,a,n,r){const s=I.baseQuery(e,((e,t)=>f.op.and(e[m.p5.properties.Status].in(n),t[y.eM.properties.AddressId].in(a)))),o=await t.attach(s);return await _(e,t,o,(e=>e.UtxoTransactionOutput.TokenListId),r)}}p()(I,"ownTables",r()({[m.p5.name]:m.p5,[y.eM.name]:y.eM,[y.eM.name]:y.eM})),p()(I,"depTables",r()({}));class A{static baseQuery(e,t){const a=e.getSchema().table(A.ownTables[m.p5.name].name),n=e.getSchema().table(A.ownTables[y.WF.name].name);return e.select().from(a).innerJoin(n,a[m.p5.properties.TransactionId].eq(n[y.WF.properties.TransactionId])).where(t(a,n))}static async getInputsForAddresses(e,t,a,n,r){const s=A.baseQuery(e,((e,t)=>f.op.and(e[m.p5.properties.Status].in(n),t[y.WF.properties.AddressId].in(a)))),o=await t.attach(s);return await _(e,t,o,(e=>e.UtxoTransactionInput.TokenListId),r)}}p()(A,"ownTables",r()({[m.p5.name]:m.p5,[y.WF.name]:y.WF})),p()(A,"depTables",r()({AssociateToken:b.qr}));class M{static async getTxIdsForAddresses(e,t,a){const n=await M.depTables.GetUtxoInputs.fromAddressIds(e,t,{ids:a.addressIds}),r=await M.depTables.GetUtxoOutputs.fromAddressIds(e,t,{ids:a.addressIds});return c()(new(l())([...h()(n).call(n,(e=>e.TransactionId)),...h()(r).call(r,(e=>e.TransactionId))]))}static async getIOsForTx(e,t,a){var n;const r=h()(n=a.txs).call(n,(e=>e.TransactionId)),s=await M.depTables.GetUtxoInputs.fromTxIds(e,t,{ids:r}),i=await M.depTables.GetUtxoOutputs.fromTxIds(e,t,{ids:r}),l=(0,w.groupBy)(s,(e=>e.TransactionId)),d=(0,w.groupBy)(i,(e=>e.TransactionId)),c=new(o());for(const e of a.txs)c.set(e,{utxoInputs:l[e.TransactionId]||[],utxoOutputs:d[e.TransactionId]||[]});return c}}async function S(e,t,a){let n=await a.AssociateToken.nextTokenListId(e,t);return()=>{const e=n;return n++,e}}p()(M,"ownTables",r()({})),p()(M,"depTables",r()({GetUtxoInputs:T,GetUtxoOutputs:k}))},44946:(e,t,a)=>{a.d(t,{t:()=>u,w:()=>p});var n=a(56474),r=a.n(n),s=a(87672),o=a.n(s),i=a(47197),l=a(68680),d=a(57421),c=a(82982);class u{static async markAs(e,t,a){const n=await u.depTables.GetUtxoTxOutputsWithTx.getSingleOutput(e,t,{txId:a.txId,outputIndex:a.outputIndex,networkId:a.networkId});if(void 0===n)return;const r=e.getSchema().table(u.ownTables[l.eM.name].name),s=e.update(r).set(r[l.eM.properties.IsUnspent],a.isUnspent).where(i.op.and(r[l.eM.properties.UtxoTransactionOutputId].eq(n.UtxoTransactionOutput.UtxoTransactionOutputId)));return await t.attach(s),{...n,UtxoTransactionOutput:{...n.UtxoTransactionOutput,IsUnspent:!1}}}}o()(u,"ownTables",r()({[l.eM.name]:l.eM})),o()(u,"depTables",r()({GetUtxoTxOutputsWithTx:c.NW}));class p{static async addIOsToTx(e,t,a){const{utxoInputs:n,utxoOutputs:r}=a;return{utxoInputs:await(0,d.JY)(e,t,n,p.ownTables[l.WF.name].name),utxoOutputs:await(0,d.JY)(e,t,r,p.ownTables[l.eM.name].name)}}}o()(p,"ownTables",r()({[l.WF.name]:l.WF,[l.eM.name]:l.eM})),o()(p,"depTables",r()({}))},94536:(e,t,a)=>{a.d(t,{H:()=>c,a:()=>u});var n=a(56474),r=a.n(n),s=a(87672),o=a.n(s),i=a(21266),l=a(57421),d=a(22261);class c{static async get(e,t,a){return await(0,l.HI)(e,t,a,c.ownTables[i.K.name].name,c.ownTables[i.K.name].properties.ConceptualWalletId)}}o()(c,"ownTables",r()({[i.K.name]:i.K})),o()(c,"depTables",r()({}));class u{static async get(e,t){const a=e.getSchema().table(u.ownTables[d.zq.name].name),n=e.getSchema().table(u.ownTables[i.K.name].name),r=e.select().from(n).innerJoin(a,a[d.zq.properties.ConceptualWalletId].eq(n[d.zq.properties.ConceptualWalletId]));return await t.attach(r)}}o()(u,"ownTables",r()({[i.K.name]:i.K,[d.zq.name]:d.zq})),o()(u,"depTables",r()({}))},28423:(e,t,a)=>{a.d(t,{k:()=>c,b:()=>u});var n=a(56474),r=a.n(n),s=a(87672),o=a.n(s),i=a(88863),l=a(57421),d=a(22261);class c{static async get(e,t,a){return await(0,l.HI)(e,t,a,c.ownTables[i.g.name].name,c.ownTables[i.g.name].properties.ConceptualWalletId)}}o()(c,"ownTables",r()({[i.g.name]:i.g})),o()(c,"depTables",r()({}));class u{static async get(e,t){const a=e.getSchema().table(u.ownTables[d.zq.name].name),n=e.getSchema().table(u.ownTables[i.g.name].name),r=e.select().from(n).innerJoin(a,a[d.zq.properties.ConceptualWalletId].eq(n[d.zq.properties.ConceptualWalletId]));return await t.attach(r)}}o()(u,"ownTables",r()({[i.g.name]:i.g,[d.zq.name]:d.zq})),o()(u,"depTables",r()({}))},91811:(e,t,a)=>{a.d(t,{n:()=>d});var n=a(56474),r=a.n(n),s=a(87672),o=a.n(s),i=a(57421),l=a(90691);class d{static async get(e,t,a,n,r){const s=r.get(n);if(null==s)throw new Error("GetDerivationSpecific::get Unknown table queried");return await(0,i.q$)(e,t,s,d.ownTables[l.aq.name].properties.KeyDerivationId,a)}}o()(d,"ownTables",r()({[l.aq.name]:l.aq})),o()(d,"depTables",r()({}))},22261:(e,t,a)=>{a.d(t,{$u:()=>s,zq:()=>o,nc:()=>i,H5:()=>l,uh:()=>d});var n=a(47197),r=a(90691);const s={name:"ConceptualWallet",properties:{ConceptualWalletId:"ConceptualWalletId",Name:"Name",NetworkId:"NetworkId"}},o={name:"PublicDeriver",properties:{PublicDeriverId:"PublicDeriverId",ConceptualWalletId:"ConceptualWalletId",KeyDerivationId:"KeyDerivationId",Name:"Name",Index:"Index",LastSyncInfoId:"LastSyncInfoId"}},i={name:"LastSyncInfo",properties:{LastSyncInfoId:"LastSyncInfoId",Time:"Time",SlotNum:"SlotNum",BlockHash:"BlockHash",Height:"Height"}},l={name:"HwWalletMeta",properties:{ConceptualWalletId:"ConceptualWalletId",Vendor:"Vendor",Model:"Model",DeviceId:"DeviceId"}},d=e=>{e.createTable(s.name).addColumn(s.properties.ConceptualWalletId,n.Type.INTEGER).addColumn(s.properties.NetworkId,n.Type.INTEGER).addColumn(s.properties.Name,n.Type.STRING).addPrimaryKey([s.properties.ConceptualWalletId],!0),e.createTable(o.name).addColumn(o.properties.PublicDeriverId,n.Type.INTEGER).addColumn(o.properties.ConceptualWalletId,n.Type.INTEGER).addColumn(o.properties.KeyDerivationId,n.Type.INTEGER).addColumn(o.properties.Name,n.Type.STRING).addColumn(o.properties.Index,n.Type.INTEGER).addColumn(o.properties.LastSyncInfoId,n.Type.INTEGER).addPrimaryKey([o.properties.PublicDeriverId],!0).addForeignKey("PublicDeriver_ConceptualWallet",{local:o.properties.ConceptualWalletId,ref:`${s.name}.${s.properties.ConceptualWalletId}`}).addForeignKey("PublicDeriver_KeyDerivation",{local:o.properties.KeyDerivationId,ref:`${r.aq.name}.${r.aq.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}).addForeignKey("PublicDeriver_LastSyncInfo",{local:o.properties.LastSyncInfoId,ref:`${i.name}.${i.properties.LastSyncInfoId}`}).addIndex("Bip44ToPublicDeriver_ConceptualWallet_Index",[o.properties.ConceptualWalletId],!1),e.createTable(i.name).addColumn(i.properties.LastSyncInfoId,n.Type.INTEGER).addColumn(i.properties.Time,n.Type.DATE_TIME).addColumn(i.properties.SlotNum,n.Type.NUMBER).addColumn(i.properties.BlockHash,n.Type.STRING).addColumn(i.properties.Height,n.Type.NUMBER).addPrimaryKey([i.properties.LastSyncInfoId],!0).addNullable([i.properties.Time,i.properties.SlotNum,i.properties.BlockHash]),e.createTable(l.name).addColumn(l.properties.ConceptualWalletId,n.Type.INTEGER).addColumn(l.properties.Vendor,n.Type.STRING).addColumn(l.properties.Model,n.Type.STRING).addColumn(l.properties.DeviceId,n.Type.STRING).addForeignKey("HwWalletMetaSchema_ConceptualWallet",{local:l.properties.ConceptualWalletId,ref:`${s.name}.${s.properties.ConceptualWalletId}`,action:n.ConstraintAction.CASCADE}).addUnique("HwWalletMetaSchema_ConceptualWallet_Unique",[l.properties.ConceptualWalletId])}},87326:(e,t,a)=>{a.d(t,{J:()=>x});var n=a(52424),r=a.n(n),s=a(87672),o=a.n(s),i=a(26337),l=a.n(i),d=a(86045),c=a.n(d),u=a(27189),p=a(69594),g=a(81369),h=a(52367);function f(e,t,a){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,a)}var w=new(r()),y=new(r()),m=new(r()),b=new(r()),v=new(r());class x extends u.tT{constructor(e,t,a,n,r){return super(t),f(this,w,{writable:!0,value:void 0}),f(this,y,{writable:!0,value:void 0}),f(this,m,{writable:!0,value:void 0}),f(this,b,{writable:!0,value:void 0}),f(this,v,{writable:!0,value:void 0}),o()(this,"getDerivationTables",(()=>h.lE)),o()(this,"rawRemove",(async(e,t)=>{await g._.remove(e,t,this.getConceptualWalletId()),await(0,u.PO)(e,t,this.getConceptualWalletId())})),c()(this,w,a.PublicDeriverLevel),c()(this,y,a.SignerLevel),c()(this,m,n),c()(this,b,r),this}getPublicDeriverLevel(){return l()(this,w)}getSigningLevel(){return l()(this,y)}getPrivateDeriverLevel(){return l()(this,m)}getPrivateDeriverKeyDerivationId(){return l()(this,b)}static async createBip44Wallet(e,t){return await(0,p.Su)(e,t,x)}}},11015:(e,t,a)=>{a.d(t,{H:()=>v});var n=a(52424),r=a.n(n),s=a(87672),o=a.n(s),i=a(26337),l=a.n(i),d=a(86045),c=a.n(d),u=a(27189),p=a(69594),g=a(2151),h=a(52367);function f(e,t,a){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,a)}var w=new(r()),y=new(r()),m=new(r()),b=new(r());class v extends u.tT{constructor(e,t,a,n,r){return super(t),f(this,w,{writable:!0,value:void 0}),f(this,y,{writable:!0,value:void 0}),f(this,m,{writable:!0,value:void 0}),f(this,b,{writable:!0,value:void 0}),o()(this,"getDerivationTables",(()=>h.lE)),o()(this,"rawRemove",(async(e,t)=>{await g.S.remove(e,t,this.getConceptualWalletId()),await(0,u.PO)(e,t,this.getConceptualWalletId())})),c()(this,w,a.PublicDeriverLevel),c()(this,y,a.SignerLevel),c()(this,m,n),c()(this,b,r),this}getPublicDeriverLevel(){return l()(this,w)}getSigningLevel(){return l()(this,y)}getPrivateDeriverLevel(){return l()(this,m)}getPrivateDeriverKeyDerivationId(){return l()(this,b)}static async createCip1852Wallet(e,t){return await(0,p.VV)(e,t,v)}}},19008:(e,t,a)=>{a.d(t,{M:()=>v});var n=a(39392),r=a.n(n),s=a(86902),o=a.n(s),i=a(2991),l=a.n(i),d=a(80426),c=a.n(d),u=a(56474),p=a.n(u),g=a(57421),h=a(38441),f=a(87326),w=a(11015),y=a(94536),m=a(28423),b=a(3577);async function v(e){var t,a;const n=[],s=p()({GetAllBip44Wallets:y.a,GetAllCip1852Wallets:m.b}),i=c()(t=l()(a=o()(s)).call(a,(e=>s[e]))).call(t,(t=>(0,g.Hz)(e,t))),d=await(0,g.zm)(e,i,(async t=>({bip44:await s.GetAllBip44Wallets.get(e,t),cip1852:await s.GetAllCip1852Wallets.get(e,t)})));{const t=new(r());for(const a of d.bip44){let r=t.get(a.Bip44Wrapper.ConceptualWalletId);if(null==r){r=await f.J.createBip44Wallet(e,a.Bip44Wrapper);const n=r.networkInfo.CoinType.toString();if(!(0,b.lD)(n))continue;t.set(a.Bip44Wrapper.ConceptualWalletId,r)}try{const e=await h.n.createPublicDeriver(a.PublicDeriver,r);n.push(e)}catch(e){console.error("Failed to load a BIP44 wallet",e)}}}{const t=new(r());for(const a of d.cip1852){let r=t.get(a.Cip1852Wrapper.ConceptualWalletId);null==r&&(r=await w.H.createCip1852Wallet(e,a.Cip1852Wrapper),t.set(a.Cip1852Wrapper.ConceptualWalletId,r));const s=await h.n.createPublicDeriver(a.PublicDeriver,r);n.push(s)}}return n}},1499:(e,t,a)=>{a.d(t,{sC:()=>W,oI:()=>N,cP:()=>B,yN:()=>L,JS:()=>H,_k:()=>U,sV:()=>V,p:()=>K});var n=a(87672),r=a.n(n),s=a(94473),o=a.n(s),i=(a(77766),a(32366),a(86902)),l=a.n(i),d=a(56474),c=a.n(d),u=a(80426),p=a.n(u),g=a(20116),h=a.n(g),f=a(36384),w=a.n(f),y=a(47302),m=a.n(y),b=a(2991),v=a.n(b),x=a(96486),_=a(905),T=(a(27189),a(81369),a(39845)),k=a(57421),I=a(91811),A=a(52367),M=a(82982),S=a(52776),R=a(35072),D=a(38079),C=a(55343),P=a(66905);async function W(e,t,a,n,r){const s=await async function(e,t,a,n,r,s){var o;const i=await a.GetPathWithSpecific.getTree(e,t,n,(async n=>await a.GetDerivationSpecific.get(e,t,n,r,s)));return v()(o=i.rows).call(o,(e=>{const t=i.pathMap.get(e.KeyDerivationId);if(null==t)throw new Error("rawGetDerivationsByPath should never happen");return{row:e,addressing:{path:t,startLevel:n.derivationLevel-n.commonPrefix.length+1}}}))}(e,t,{GetPathWithSpecific:a.GetPathWithSpecific,GetDerivationSpecific:a.GetDerivationSpecific},n,A.CZ.ADDRESS.level,r),o=await a.GetAddress.fromCanonical(e,t,v()(s).call(s,(e=>e.row.KeyDerivationId)),void 0);return v()(s).call(s,(e=>{const t=o.get(e.row.KeyDerivationId);if(null==t)throw new Error("rawGetAddressesByDerivationPath should never happen");return{...e,addrs:t}}))}async function E(e,t,a,n){const r=await a.GetUtxoTxOutputsWithTx.getOutputsForAddresses(e,t,n.addressIds,[D.YM.IN_BLOCK],n.networkId);return new(w())(v()(r).call(r,(e=>e.UtxoTransactionOutput.AddressId)))}async function N(e,t,a,n){var r,s,o,i;const l=v()(r=h()(s=p()(o=n.addresses).call(o,(e=>e.addrs))).call(s,(e=>e.Type===n.type))).call(r,(e=>e.AddressId)),d=await E(e,t,{GetUtxoTxOutputsWithTx:a.GetUtxoTxOutputsWithTx},{addressIds:l,networkId:n.networkId}),c=function(e,t){const a=(0,x.groupBy)(e,(e=>e.UtxoTransactionOutput.AddressId));return(0,x.mapValues)(a,(e=>H(e,t)))}(await a.GetUtxoTxOutputsWithTx.getUtxo(e,t,l,n.networkId),n.defaultToken);return p()(i=n.addresses).call(i,(e=>{var t,a;return v()(t=h()(a=e.addrs).call(a,(e=>e.Type===n.type))).call(t,(t=>({address:t.Hash,values:c[t.AddressId],addressing:e.addressing,isUsed:d.has(t.AddressId),type:n.type})))}))}async function B(e){var t,a;const n=e.publicDeriver.getParent().getDerivationTables(),r=c()({GetUtxoTxOutputsWithTx:M.NW,GetAddress:T.t9,GetPathWithSpecific:T.LY,GetDerivationSpecific:I.n}),s=p()(t=v()(a=l()(r)).call(a,(e=>r[e]))).call(t,(t=>(0,k.Hz)(e.publicDeriver.getDb(),t)));return await(0,k.zm)(e.publicDeriver.getDb(),[...s,...(0,k.pS)(e.publicDeriver.getDb(),n)],(async t=>await async function(e,t,a,n){const r=await a.publicDeriver.rawGetAddressesForChain(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},a.chainsRequest,n);let s=r;if(a.chainsRequest.chainId===P.OC.EXTERNAL){const o=await a.publicDeriver.rawGetCutoff(e,{GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},void 0,n);s=h()(r).call(r,(e=>e.addressing.path[e.addressing.path.length-1]<=o))}let o=await N(a.publicDeriver.getDb(),e,{GetUtxoTxOutputsWithTx:t.GetUtxoTxOutputsWithTx},{addresses:s,type:a.type,networkId:a.publicDeriver.getParent().getNetworkInfo().NetworkId,defaultToken:a.publicDeriver.getParent().getDefaultToken()});if(a.chainsRequest.chainId===P.OC.INTERNAL){let e=-1;for(const t of o)if(t.isUsed){const a=t.addressing.path[t.addressing.path.length-1];a>e&&(e=a)}o=h()(o).call(o,(t=>t.addressing.path[t.addressing.path.length-1]<=e+1))}return o}(t,r,{publicDeriver:e.publicDeriver,chainsRequest:e.chainsRequest,type:e.type},n)))}async function L(e,t,a,n){var r;const s=await E(e,t,{GetUtxoTxOutputsWithTx:a.GetUtxoTxOutputsWithTx},{addressIds:p()(r=n.addressesForChain).call(r,(e=>{var t;return v()(t=e.addrs).call(t,(e=>e.AddressId))})),networkId:n.networkId}),o=function(e){var t;m()(t=e.singleChainAddresses).call(t,((e,t)=>e.addressing.path[e.addressing.path.length-1]-t.addressing.path[t.addressing.path.length-1]));let a=-1;for(let t=0;t<e.singleChainAddresses.length;t++)for(const n of e.singleChainAddresses[t].addrs)e.usedStatus.has(n.AddressId)&&(a=t);return a}({singleChainAddresses:n.addressesForChain,usedStatus:s}),i=n.addressesForChain[o+1];return void 0===i?{addressInfo:void 0,index:o+1}:{addressInfo:{...i},index:o+1}}function H(e,t){const a=new C.a([],t);for(const t of e)for(const e of t.tokens)a.add({identifier:e.Token.Identifier,amount:new _.O(e.TokenList.Amount),networkId:e.Token.NetworkId});return a}async function U(e,t,a,n){if(null!=a.displayCutoffInstance){const r=(()=>{if(a.publicDeriverLevel===A.CZ.ACCOUNT.level){var e;const t=o()(e=a.tree).call(e,(e=>e.index===P.OC.EXTERNAL));if(null==t||null==t.children)throw new Error("updateCutoffFromInsert should never happen");return t.children}if(a.publicDeriverLevel===A.CZ.CHAIN.level)return a.tree;throw new Error("updateCutoffFromInsert incorrect pubderiver level")})();let s=0;for(const e of r)e.index>s&&(s=e.index);const i=await a.displayCutoffInstance.rawGetCutoff(e,{GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},void 0,n);s-P.C4>i&&await a.displayCutoffInstance.rawSetCutoff(e,{ModifyDisplayCutoff:t.ModifyDisplayCutoff,GetDerivationsByPath:t.GetDerivationsByPath,GetKeyDerivation:t.GetKeyDerivation},{newIndex:s-P.C4})}}function V(e){if(e.startLevel!==A.CZ.PURPOSE.level)throw new Error("verifyFromDerivationRoot addressing does not start from root");if(e.startLevel+e.path.length-1!==A.CZ.ADDRESS.level)throw new Error("verifyFromDerivationRoot incorrect addressing size")}function O(e){var t;return{...e,assets:v()(t=e.assets).call(t,(e=>({assetId:e.assetId,policyId:e.policyId,name:e.name,amount:e.amount}))),amount:new _.O(e.amount)}}function F(e){var t;return{utxoId:e.utxoId,txHash:e.txHash,txIndex:e.txIndex,receiver:e.receiver,blockNum:e.blockNum,assets:v()(t=e.assets).call(t,(e=>({assetId:e.assetId,policyId:e.policyId,name:e.name,amount:e.amount}))),amount:e.amount.toString()}}class K{constructor(e){r()(this,"conceptualWalletId",void 0),r()(this,"db",void 0),r()(this,"dbTx",void 0),this.conceptualWalletId=e}setDb(e){this.db=e}setDbTx(e){this.dbTx=e}async getUtxoAtSafePoint(){const e=await S.r.forWallet(this.db,this.dbTx,this.conceptualWalletId);var t;if(e)return{lastSafeBlockHash:e.UtxoAtSafePoint.lastSafeBlockHash,utxos:v()(t=e.UtxoAtSafePoint.utxos).call(t,O)}}async getUtxoDiffToBestBlock(){var e;return v()(e=await S.S.forWallet(this.db,this.dbTx,this.conceptualWalletId)).call(e,(e=>{var t;return{...e,newUtxos:v()(t=e.newUtxos).call(t,O)}}))}async replaceUtxoAtSafePoint(e,t){await R.I.addOrReplace(this.db,this.dbTx,this.conceptualWalletId,{lastSafeBlockHash:t,utxos:v()(e).call(e,F)})}async clearUtxoState(){await R.I.remove(this.db,this.dbTx,this.conceptualWalletId),await R.j.removeAll(this.db,this.dbTx,this.conceptualWalletId)}async appendUtxoDiffToBestBlock(e){var t;await R.j.add(this.db,this.dbTx,this.conceptualWalletId,{lastBestBlockHash:e.lastBestBlockHash,spentUtxoIds:e.spentUtxoIds,newUtxos:v()(t=e.newUtxos).call(t,F)})}async removeDiffWithBestBlock(e){await R.j.remove(this.db,this.dbTx,this.conceptualWalletId,e)}}r()(K,"depsTables",c()({ModifyUtxoAtSafePoint:R.I,ModifyUtxoDiffToBestBlock:R.j,GetUtxoAtSafePoint:S.r,GetUtxoDiffToBestBlock:S.S}))},70184:(e,t,a)=>{a.d(t,{Fb:()=>m,od:()=>R});var n=a(86902),r=a.n(n),s=a(78914),o=a.n(s),i=(a(36384),a(59340),a(10062),a(94473)),l=a.n(i),d=a(2991),c=a.n(d),u=a(47302),p=a.n(u),g=a(1499),h=a(68469),f=(a(34786),a(86335)),w=a(95667),y=(a(52367),a(66905),a(87315),a(90649));function m(e){var t,a,n,r,s,o;const i=e.signRequest.unsignedTx.build_tx(),d=i.body(),u=f.RustModule.WasmScope((e=>e.WalletV4.has_transaction_set_tag(i.to_bytes())));if(u===f.RustModule.WalletV4.TransactionSetsState.MixedSets)throw new Error("Transaction with mixed sets cannot be signed by Ledger");const m=u===f.RustModule.WalletV4.TransactionSetsState.AllSetsHaveTag,x=function(e){var t;for(const t of e)(0,g.sV)(t.addressing);return p()(t=c()(e).call(e,(e=>({txHashHex:e.tx_hash,outputIndex:e.tx_index,path:e.addressing.path})))).call(t,b)}(e.signRequest.senderUtxos),T=function(e){const t=[];for(const s of(0,y.iterateLenGet)(e.txOutputs)){var a,n,r;const o=s.address(),i=(0,w.toHexOrBase58)(o),d=null!==(a=null===(n=s.data_hash())||void 0===n?void 0:n.to_hex())&&void 0!==a?a:null,c=l()(r=e.changeAddrs).call(r,(e=>i===e.address));if(null!=c){(0,g.sV)(c.addressing);const a=S({networkId:e.networkId,address:o,path:c.addressing.path,addressingMap:e.addressingMap});t.push({amount:s.amount().coin().to_str(),tokenBundle:v(s.amount().multiasset()),destination:{type:h.TxOutputDestinationType.DEVICE_OWNED,params:a},datumHashHex:d})}else t.push({amount:s.amount().coin().to_str(),tokenBundle:v(s.amount().multiasset()),destination:{type:h.TxOutputDestinationType.THIRD_PARTY,params:{addressHex:o.to_hex()}},datumHashHex:d})}return t}({networkId:e.networkId,txOutputs:d.outputs(),changeAddrs:e.signRequest.changeAddr,addressingMap:e.addressingMap}),k=d.withdrawals(),I=d.certs(),A=[];null!=k&&k.len()>0&&A.push(..._(k,e.addressingMap));const R=[];let D;if(null!=I&&I.len()>0&&R.push(...M(e.networkId,I,e.addressingMap)),e.signRequest.ledgerNanoCatalystRegistrationTxSignData){const{votingPublicKey:t,stakingKeyPath:a,nonce:n,paymentKeyPath:r}=e.signRequest.ledgerNanoCatalystRegistrationTxSignData;D=e.cip36?{type:h.TxAuxiliaryDataType.CIP36_REGISTRATION,params:{format:h.CIP36VoteRegistrationFormat.CIP_36,delegations:[{type:h.CIP36VoteDelegationType.KEY,voteKeyHex:t.replace(/^0x/,""),weight:1}],stakingPath:a,paymentDestination:{type:h.TxOutputDestinationType.DEVICE_OWNED,params:{type:h.AddressType.BASE_PAYMENT_KEY_STAKE_KEY,params:{spendingPath:r,stakingPath:a}}},nonce:n,votingPurpose:0}}:{type:h.TxAuxiliaryDataType.CIP36_REGISTRATION,params:{format:h.CIP36VoteRegistrationFormat.CIP_15,voteKeyHex:t.replace(/^0x/,""),stakingPath:a,paymentDestination:{type:h.TxOutputDestinationType.DEVICE_OWNED,params:{type:h.AddressType.BASE_PAYMENT_KEY_STAKE_KEY,params:{spendingPath:r,stakingPath:a}}},nonce:n}}}else null!=e.signRequest.metadata&&(D={type:h.TxAuxiliaryDataType.ARBITRARY_HASH,params:{hashHex:f.RustModule.WalletV4.hash_auxiliary_data(e.signRequest.metadata).to_hex()}});return{signingMode:h.TransactionSigningMode.ORDINARY_TRANSACTION,tx:{inputs:x,outputs:T,ttl:null!==(t=null===(a=d.ttl_bignum())||void 0===a?void 0:a.to_str())&&void 0!==t?t:null,validityIntervalStart:null!==(n=null===(r=d.validity_start_interval_bignum())||void 0===r?void 0:r.to_str())&&void 0!==n?n:null,fee:d.fee().to_str(),network:{networkId:e.networkId,protocolMagic:e.byronNetworkMagic},withdrawals:0===A.length?null:A,certificates:0===R.length?null:R,auxiliaryData:D,scriptDataHashHex:null!==(s=null===(o=d.script_data_hash())||void 0===o?void 0:o.to_hex())&&void 0!==s?s:null},additionalWitnessPaths:[],options:{tagCborSets:m}}}function b(e,t){return e.txHashHex!==t.txHashHex?e.txHashHex<t.txHashHex?-1:1:e.outputIndex-t.outputIndex}function v(e){var t;if(null==e)return null;const a=c()(t=(0,y.iterateLenGetMap)(e)).call(t,(([e,t])=>{var a;const n=c()(a=(0,y.iterateLenGetMap)(t).nonNullValue()).call(a,(([e,t])=>({assetNameHex:(0,y.bytesToHex)(e.name()),amount:t.to_str()}))).toArray();return p()(n).call(n,((e,t)=>x(e.assetNameHex,t.assetNameHex))),{policyIdHex:e.to_hex(),tokens:n}})).toArray();return p()(a).call(a,((e,t)=>x(e.policyIdHex,t.policyIdHex))),a}function x(e,t){return e.length<t.length?-1:e.length>t.length?1:e<t?-1:e>t?1:0}function _(e,t){const a=[];for(const[n,r]of(0,y.iterateLenGetMap)(e).nonNullValue()){const e=n.to_address().to_hex(),s=t(e);let o;if(null!=s)o={type:h.CredentialParamsType.KEY_PATH,keyPath:s.path};else{const e=n.payment_cred(),t=e.to_keyhash(),a=e.to_scripthash();t?o={type:h.CredentialParamsType.KEY_HASH,keyHashHex:t.to_hex()}:a&&(o={type:h.CredentialParamsType.SCRIPT_HASH,scriptHashHex:a.to_hex()})}if(null==o)throw new Error("Failed to resolve credential type for reward address: "+e);a.push({amount:r.to_str(),stakeCredential:o})}return a}function T(e){const t=e.anchor();return null==t?void 0:{url:t.url().url(),hashHex:t.anchor_data_hash().to_hex()}}function k(e,t){return{type:h.CredentialParamsType.KEY_PATH,keyPath:t(e.stake_credential())}}function I(e,t){return{type:h.CredentialParamsType.KEY_PATH,keyPath:t(e.voting_credential())}}function A(e){const t=e.drep();switch(t.kind()){case f.RustModule.WalletV4.DRepKind.KeyHash:return{type:h.DRepParamsType.KEY_HASH,keyHashHex:(0,y.forceNonNull)(t.to_key_hash()).to_hex()};case f.RustModule.WalletV4.DRepKind.ScriptHash:return{type:h.DRepParamsType.SCRIPT_HASH,scriptHashHex:(0,y.forceNonNull)(t.to_script_hash()).to_hex()};case f.RustModule.WalletV4.DRepKind.AlwaysAbstain:return{type:h.DRepParamsType.ABSTAIN};case f.RustModule.WalletV4.DRepKind.AlwaysNoConfidence:return{type:h.DRepParamsType.NO_CONFIDENCE};default:throw new Error("Ledger: Unsupported dRep kind: "+t.to_hex())}}function M(e,t,a){var n;const r=t=>{const n=f.RustModule.WalletV4.RewardAddress.new(e,t).to_address().to_hex(),r=a(n);if(null==r)throw new Error(`getPath Ledger only supports certificates from own address ${n}`);return r.path};return c()(n=(0,y.iterateLenGet)(t)).call(n,(e=>function(e,t){const a=e.kind();switch(a){case f.RustModule.WalletV4.CertificateKind.StakeRegistration:return function(e,t){const a=k(e,t),n=e.coin();return null==n?{type:h.CertificateType.STAKE_REGISTRATION,params:{stakeCredential:a}}:{type:h.CertificateType.STAKE_REGISTRATION_CONWAY,params:{stakeCredential:a,deposit:n.to_str()}}}((0,y.forceNonNull)(e.as_stake_registration()),t);case f.RustModule.WalletV4.CertificateKind.StakeDeregistration:return function(e,t){const a=k(e,t),n=e.coin();return null==n?{type:h.CertificateType.STAKE_DEREGISTRATION,params:{stakeCredential:a}}:{type:h.CertificateType.STAKE_DEREGISTRATION_CONWAY,params:{stakeCredential:a,deposit:n.to_str()}}}((0,y.forceNonNull)(e.as_stake_deregistration()),t);case f.RustModule.WalletV4.CertificateKind.StakeDelegation:return function(e,t){return{type:h.CertificateType.STAKE_DELEGATION,params:{stakeCredential:k(e,t),poolKeyHashHex:e.pool_keyhash().to_hex()}}}((0,y.forceNonNull)(e.as_stake_delegation()),t);case f.RustModule.WalletV4.CertificateKind.VoteDelegation:return function(e,t){return{type:h.CertificateType.VOTE_DELEGATION,params:{stakeCredential:k(e,t),dRep:A(e)}}}((0,y.forceNonNull)(e.as_vote_delegation()),t);case f.RustModule.WalletV4.CertificateKind.DRepRegistration:{const a=(0,y.forceNonNull)(e.as_drep_registration());return{type:h.CertificateType.DREP_REGISTRATION,params:{dRepCredential:I(a,t),anchor:T(a),deposit:a.coin().to_str()}}}case f.RustModule.WalletV4.CertificateKind.DRepUpdate:{const a=(0,y.forceNonNull)(e.as_drep_update());return{type:h.CertificateType.DREP_UPDATE,params:{dRepCredential:I(a,t),anchor:T(a)}}}case f.RustModule.WalletV4.CertificateKind.DRepDeregistration:{const a=(0,y.forceNonNull)(e.as_drep_deregistration());return{type:h.CertificateType.DREP_DEREGISTRATION,params:{dRepCredential:I(a,t),deposit:a.coin().to_str()}}}case f.RustModule.WalletV4.CertificateKind.StakeAndVoteDelegation:case f.RustModule.WalletV4.CertificateKind.StakeRegistrationAndDelegation:case f.RustModule.WalletV4.CertificateKind.VoteRegistrationAndDelegation:case f.RustModule.WalletV4.CertificateKind.StakeVoteRegistrationAndDelegation:throw new Error(`formatLedgerCertificates Ledger doesn't support combinatory certificate types (${a}), use multiple simple certificates instead! `+e.to_hex());default:throw new Error("formatLedgerCertificates Ledger doesn't support this certificate type! "+e.to_hex())}}(e,r))).toArray()}function S(e){if(f.RustModule.WalletV4.ByronAddress.from_address(e.address))return{type:h.AddressType.BYRON,params:{spendingPath:e.path}};{const n=f.RustModule.WalletV4.BaseAddress.from_address(e.address);if(n){const r=f.RustModule.WalletV4.RewardAddress.new(e.networkId,n.stake_cred()).to_address().to_hex(),s=e.addressingMap(r);if(null==s){var t,a;const r=n.stake_cred(),s=null!==(t=r.to_keyhash())&&void 0!==t?t:r.to_scripthash(),o=null!==(a=null==s?void 0:s.to_hex())&&void 0!==a?a:(0,y.fail)("toLedgerAddressParameters unknown hash type");return{type:h.AddressType.BASE_PAYMENT_KEY_STAKE_KEY,params:{spendingPath:e.path,stakingKeyHashHex:o}}}return{type:h.AddressType.BASE_PAYMENT_KEY_STAKE_KEY,params:{spendingPath:e.path,stakingPath:s.path}}}}{const t=f.RustModule.WalletV4.PointerAddress.from_address(e.address);if(t){const a=t.stake_pointer();return{type:h.AddressType.POINTER_KEY,params:{spendingPath:e.path,stakingBlockchainPointer:{blockIndex:a.slot(),txIndex:a.tx_index(),certificateIndex:a.cert_index()}}}}}if(f.RustModule.WalletV4.EnterpriseAddress.from_address(e.address))return{type:h.AddressType.ENTERPRISE_KEY,params:{spendingPath:e.path}};if(f.RustModule.WalletV4.RewardAddress.from_address(e.address))return{type:h.AddressType.REWARD_KEY,params:{stakingPath:e.path}};throw new Error("toLedgerAddressParameters unknown address type")}function R(e,t,a,n,s,i=[]){var d,u,p,g,w,m,b,x,T,k,I,A,S;const R=f.RustModule.WasmScope((t=>t.WalletV4.has_transaction_set_tag(t.WalletV4.FixedTransaction.new_from_body_bytes((0,y.hexToBytes)(e)).to_bytes())));if(R===f.RustModule.WalletV4.TransactionSetsState.MixedSets)throw new Error("Transaction with mixed sets cannot be signed by Ledger");const D=R===f.RustModule.WalletV4.TransactionSetsState.AllSetsHaveTag,C=f.RustModule.WalletV4.TransactionBody.from_hex(e);function P(e){var t;return c()(t=(0,y.iterateLenGet)(e)).call(t,(e=>{var t;const a=e.transaction_id().to_hex(),n=e.index(),r=l()(s).call(s,(e=>e.tx_hash===a&&e.tx_index===n)),o=null!==(t=null==r?void 0:r.addressing.path)&&void 0!==t?t:null;return{txHashHex:a,outputIndex:n,path:o}})).toArray()}function W(e){const a=e.serialization_format()===f.RustModule.WalletV4.CborContainerType.Map,r=e.address();let s;const o=f.RustModule.WalletV4.ByronAddress.from_address(r),i=f.RustModule.WalletV4.PointerAddress.from_address(r);if((o||i)&&(s={type:h.TxOutputDestinationType.THIRD_PARTY,params:{addressHex:r.to_hex()}}),f.RustModule.WalletV4.EnterpriseAddress.from_address(r)){const e=n(r.to_hex());s=e?{type:h.TxOutputDestinationType.DEVICE_OWNED,params:{type:h.AddressType.ENTERPRISE_KEY,params:{spendingPath:e}}}:{type:h.TxOutputDestinationType.THIRD_PARTY,params:{addressHex:r.to_hex()}}}const l=f.RustModule.WalletV4.BaseAddress.from_address(r);if(l){const e=f.RustModule.WalletV4.EnterpriseAddress.new(t,l.payment_cred()).to_address().to_hex(),a=n(e);if(a){const e=l.stake_cred(),r=f.RustModule.WalletV4.RewardAddress.new(t,e).to_address().to_hex(),o=n(r);if(o)s={type:h.TxOutputDestinationType.DEVICE_OWNED,params:{type:h.AddressType.BASE_PAYMENT_KEY_STAKE_KEY,params:{spendingPath:a,stakingPath:o}}};else{const t=e.to_keyhash(),n=e.to_scripthash();if(t)s={type:h.TxOutputDestinationType.DEVICE_OWNED,params:{type:h.AddressType.BASE_PAYMENT_KEY_STAKE_KEY,params:{spendingPath:a,stakingKeyHashHex:t.to_hex()}}};else{if(!n)throw new Error("unexpected stake credential type in base address");s={type:h.TxOutputDestinationType.DEVICE_OWNED,params:{type:h.AddressType.BASE_PAYMENT_KEY_STAKE_SCRIPT,params:{spendingPath:a,stakingScriptHashHex:n.to_hex()}}}}}}else s={type:h.TxOutputDestinationType.THIRD_PARTY,params:{addressHex:r.to_hex()}}}if(!s)throw new Error("not expecting to pay to reward address");const d=e.amount().coin().to_str(),c=v(e.amount().multiasset()),u=e.data_hash(),p=e.plutus_data(),g=e.script_ref();if(a||g||p){let e=null;return p?e={type:h.DatumType.INLINE,datumHex:p.to_hex()}:u&&(e={type:h.DatumType.HASH,datumHashHex:u.to_hex()}),{format:h.TxOutputFormat.MAP_BABBAGE,amount:d,destination:s,tokenBundle:c,datum:e,referenceScriptHex:g?g.to_hex():null}}return{format:h.TxOutputFormat.ARRAY_LEGACY,amount:d,destination:s,tokenBundle:c,datumHashHex:u?u.to_hex():null}}const E=c()(d=(0,y.iterateLenGet)(C.outputs())).call(d,W).toArray(),N=[],B=[];function L(e){const t=n(e);if(t)return{path:t}}f.RustModule.WasmScope((e=>{var a,r;function s(a){const r=e.WalletV4.Ed25519KeyHash.from_hex(a),s=e.WalletV4.EnterpriseAddress.new(t,e.WalletV4.Credential.from_keyhash(r)).to_address().to_hex(),o=e.WalletV4.RewardAddress.new(t,e.WalletV4.Credential.from_keyhash(r)).to_address().to_hex();return n(s)||n(o)}o()(a=c()(r=(0,y.iterateLenGet)(C.required_signers())).call(r,(e=>e.to_hex())).unique()).call(a,(e=>{const t=s(e);null!=t?(B.push({type:h.TxRequiredSignerType.PATH,path:t}),N.push(t)):B.push({type:h.TxRequiredSignerType.HASH,hashHex:e})}));for(const e of i||[]){const t=s(e);null!=t&&N.push(t)}}));let H=null;const U=C.certs();U&&(H=M(t,U,L));let V=null;const O=C.withdrawals();O&&(V=_(O,L));let F=null;const K=C.auxiliary_data_hash();K&&(F={type:h.TxAuxiliaryDataType.ARBITRARY_HASH,params:{hashHex:K.to_hex()}});let G=null;const Y=C.collateral();Y&&(G=P(Y));const q=(0,y.maybe)(C.collateral_return(),W);let z=null;const Z=C.reference_inputs();Z&&(z=P(Z));let $=h.TransactionSigningMode.ORDINARY_TRANSACTION;return G&&($=h.TransactionSigningMode.PLUTUS_TRANSACTION),{signingMode:$,tx:{network:{networkId:t,protocolMagic:a},inputs:P(C.inputs()),outputs:E,fee:C.fee().to_str(),ttl:null!==(u=null===(p=C.ttl_bignum())||void 0===p?void 0:p.to_str())&&void 0!==u?u:null,validityIntervalStart:null!==(g=null===(w=C.validity_start_interval_bignum())||void 0===w?void 0:w.to_str())&&void 0!==g?g:null,certificates:H,withdrawals:V,auxiliaryData:F,mint:null!==(m=null===(b=JSON.parse(null!==(x=null===(T=C.mint())||void 0===T?void 0:T.to_json())&&void 0!==x?x:"null"))||void 0===b?void 0:c()(b).call(b,(([e,t])=>{var a;return{policyIdHex:e,tokens:c()(a=r()(t)).call(a,(e=>({assetNameHex:e,amount:t[e]})))}})))&&void 0!==m?m:null,scriptDataHashHex:null!==(k=null===(I=C.script_data_hash())||void 0===I?void 0:I.to_hex())&&void 0!==k?k:null,collateralInputs:G,requiredSigners:B.length>0?B:null,includeNetworkId:null!=C.network_id(),collateralOutput:q,totalCollateral:null!==(A=null===(S=C.total_collateral())||void 0===S?void 0:S.to_str())&&void 0!==A?A:null,referenceInputs:z},additionalWitnessPaths:N,options:{tagCborSets:D}}}a(27649)},84184:(e,t,a)=>{a.d(t,{T$:()=>J,fi:()=>ee,u2:()=>te,OJ:()=>ae,TV:()=>re});var n=a(94198),r=a.n(n),s=a(86902),o=a.n(s),i=(a(51942),a(89400)),l=a.n(i),d=a(77149),c=a.n(d),u=a(93476),p=a.n(u),g=a(78580),h=a.n(g),f=a(32366),w=a.n(f),y=a(59340),m=a.n(y),b=a(20116),v=a.n(b),x=a(36384),_=a.n(x),T=a(56474),k=a.n(T),I=a(2991),A=a.n(I),M=a(69301),S=a.n(M),R=a(66419),D=a.n(R),C=a(39392),P=a.n(C),W=a(905),E=a(21131),N=a(86335),B=a(52367),L=a(95667),H=a(55343),U=a(38079),V=a(27649),O=a(90649),F=(a(84174),a(4158),a(94346)),K=a(34704),G=a(71265),Y=a(27423),q=a(17462),z=a.n(q),Z=a(87315),$=a(48764).Buffer;const j=7200;function J(e,t,a,n,r,s){var o;const i=new(P());for(const e of t)i.set({amount:e.amount,receiver:e.receiver,tx_hash:e.tx_hash,tx_index:e.tx_index,utxo_id:e.utxo_id,assets:e.assets},e);const l=function(e,t,a,n,r,s){var o;const i=w()(o=A()(t).call(t,(e=>new W.Z(e.amount)))).call(o,((e,t)=>e.plus(t)),new W.Z(0));if(i.isZero())throw new E.r7;const l=N.RustModule.WalletV4TxBuilder(n);l.set_ttl(a.plus(j).toNumber());for(const e of t)if(Q(l,void 0,e,!1,s)===X.OVERFLOW)throw new E.gC;let d;void 0!==r&&l.set_auxiliary_data(r);try{d=l.min_fee().to_str()}catch(e){if(/Maximum transaction size of \d+ exceeded\./.test(e))throw new E.o_;throw e}if(i.lt(d))throw new E.r7;{const t=(0,L.normalizeToAddress)(e.address);if(null==t)throw new Error("sendAllUnsignedTxFromUtxo receiver not a valid Shelley address");let a=!1;try{a=l.add_change_if_needed(t)}catch(e){var c;if(!h()(c=String(e)).call(c,"Not enough ADA"))throw console.error("Failed to construct send-all output!",e),e}if(!a)throw new E.r7}const u=(()=>{if(null==e.addressing)return[];const{addressing:t}=e;return[{addressing:t,address:e.address,values:(0,V.$Z)(l.get_explicit_output(),{defaultNetworkId:n.networkId,defaultIdentifier:U.hd.Cardano})}]})();return{senderUtxos:t,txBuilder:l,changeAddr:u}}(e,D()(S()(i).call(i)),a,n,r,s);return{senderUtxos:A()(o=l.senderUtxos).call(o,(e=>{const t=i.get(e);if(null==t)throw new Error("sendAllUnsignedTx utxo reference was changed. Should not happen");return t})),txBuilder:l.txBuilder,changeAddr:l.changeAddr,certificates:[]}}const X=k()({VALID:0,TOO_SMALL:1,OVERFLOW:2,NO_NEED:3});function Q(e,t,a,n,r,s){const o=(0,L.normalizeToAddress)(a.receiver);if(null==o)throw new Error("addUtxoInput input not a valid Shelley address");const i=(u=a,N.RustModule.WalletV4.TransactionInput.new(N.RustModule.WalletV4.TransactionHash.from_hex(u.tx_hash),u.tx_index)),l=(0,V.Dw)(a),d=()=>{const t=e.get_explicit_input().checked_add(e.get_implicit_input());try{t.checked_add(l)}catch(e){return X.OVERFLOW}return X.VALID},c=(()=>{var s,c;if(null==t)return d();const u={defaultNetworkId:r,defaultIdentifier:U.hd.Cardano},p=new(_())(A()(s=a.assets).call(s,(e=>e.assetId))),g=(0,V.$Z)(t.value,u),h=v()(c=g.nonDefaultEntries()).call(c,(e=>p.has(e.identifier)));return g.getDefaultEntry().amount.gt(0)&&new W.Z(a.amount).gt(0)&&h.push(g.getDefaultEntry()),1===h.length&&h[0].identifier===u.defaultIdentifier&&n&&new W.Z(e.fee_for_input(o,i,l).to_str()).gt(a.amount)?X.TOO_SMALL:d()})();var u;if(c!==X.VALID)return c;if(null==s)(0,O.logErr)((()=>{e.add_regular_input(o,i,l)}),"Failed to add a regular input");else if(null!=s.nativeScript){const t=(0,O.logErr)((()=>N.RustModule.WalletV4.NativeScript.from_bytes((0,O.hexToBytes)(s.nativeScript))),`Failed to parse witness.nativeScript: ${m()(s)}`);(0,O.logErr)((()=>{e.add_native_script_input(t,i,l)}),"Failed to add a native script input")}else if(null!=s.plutusScript){const t=(0,O.logErr)((()=>N.RustModule.WalletV4.PlutusScript.from_bytes((0,O.hexToBytes)(s.plutusScript))),`Failed to parse witness.plutusScript: ${m()(s)}`),a=(0,O.logErr)((()=>N.RustModule.WalletV4.PlutusData.from_bytes((0,O.hexToBytes)(s.datum))),`Failed to parse witness.datum: ${m()(s)}`),n=(0,O.logErr)((()=>N.RustModule.WalletV4.Redeemer.from_bytes((0,O.hexToBytes)(s.redeemer))),`Failed to parse witness.redeemer: ${m()(s)}`);(0,O.logErr)((()=>{e.add_plutus_script_input(N.RustModule.WalletV4.PlutusWitness.new(t,a,n),i,l)}),"Failed to add a plutus script input")}return X.VALID}async function ee(e,t,a,n,r,s,o,i,d,u){var g;const f=new(P());for(const e of a)f.set({amount:e.amount,receiver:e.receiver,tx_hash:e.tx_hash,tx_index:e.tx_index,utxo_id:e.utxo_id,assets:e.assets},e);const y=await async function(e,t,a,n,r,s,o,i,d,u){var g;await N.RustModule.load(),(0,F.setRuntime)(N.RustModule.CrossCsl.init);const f={networkId:r.networkId,linearFee:{coefficient:r.linearFeeCoefficient,constant:r.linearFeeConstant},coinsPerUtxoByte:r.coinsPerUtxoByte,poolDeposit:r.poolDeposit,keyDeposit:r.keyDeposit,maxValueSize:5e3,maxTxSize:16384,memPriceFrom:577,memPriceTo:1e3,stepPriceFrom:721,stepPriceTo:1e7,coinsPerUtxoWord:8*Number(r.coinsPerUtxoByte)+2},y=new K.UTxOSet(await p().all(A()(a).call(a,re))),m=await Y.TxBuilder.new(f,y),b=c()(e).call(e,(e=>null!=e.data&&null!=e.dataHash)),x=await Y.SendRequest.from(A()(e).call(e,(t=>{var a;const n=t.amount.getDefaultEntry().amount.toString(),r=v()(a=l()(t.amount)).call(a,(({identifier:t})=>t!==e[0].amount.defaults.defaultIdentifier));return{data:t.data,dataHash:t.dataHash,receiver:t.address,value:new K.Value(new K.Amount(n),K.NativeAssets.from(A()(r).call(r,(e=>{const[t,a]=e.identifier.split(".");return{asset:{policy:(0,O.hexToBytes)(t),name:(0,O.hexToBytes)(a)},amount:new K.Amount(e.amount.toString())}}))))}})));try{await m.withSendRequest(x)}catch(e){var _;if(e instanceof G.NotEnoughMoneyToSendError)throw new E.r7;if(e instanceof G.OverflowError)throw new E.gC;if(h()(_=String(e)).call(_,"less than the minimum UTXO value"))throw new E.JZ;throw e}if(d&&await m.setAuxiliaryData(d.to_bytes()),s.length>0){const e=w()(s).call(s,((e,t)=>(e.add(t),e)),N.RustModule.WalletV4.Certificates.new());await m.setCertificates(e.to_bytes())}if(o.length>0){const e=w()(o).call(o,((e,t)=>(e.insert(t.address,t.amount),e)),N.RustModule.WalletV4.Withdrawals.new());await m.setWithdrawals(e.to_bytes())}m.setTtl(n.plus(j).toNumber());const T=t&&await K.WalletAddress.from(t.address,F.WalletType.Shelley,{path:t.addressing.path,start:t.addressing.startLevel});let k;b&&await m.calcScriptDataHash("default"),await m.addChangeAndFee(T);try{k=await m.build()}catch(e){if(e instanceof G.NoOutputError)throw new E.hH;throw e}const I=[];k.change&&I.push({address:k.change.address.hex,addressing:{path:k.change.address.spendingKeyInfo.path,startLevel:k.change.address.spendingKeyInfo.start},values:ne(k.change.value,u,U.hd.Cardano)});const M=new(P())(A()(a).call(a,(e=>[e.utxo_id,e])));return{senderUtxos:A()(g=k.inputs.asArray()).call(g,(e=>M.get(e.tx+e.index))),txBuilder:k.builder.wasm,changeAddr:I}}(e,t,D()(S()(f).call(f)),n,r,s,o,0,d,u);return{senderUtxos:A()(g=y.senderUtxos).call(g,(e=>{const t=f.get(e);if(null==t)throw new Error("newAdaUnsignedTx utxo reference was changed. Should not happen");return t})),txBuilder:y.txBuilder,changeAddr:y.changeAddr,certificates:s}}async function te(e,t,a,n,s,i,d,c,u,g,f,w){var y;const m=e=>({amount:e.amount,receiver:e.receiver,tx_hash:e.tx_hash,tx_index:e.tx_index,utxo_id:e.utxo_id,assets:e.assets}),b=[],x=new(P()),_=new(P());for(const[e,t]of s){const a=m(e);b.push([a,t]),x.set(a,e)}for(const e of i)_.set(m(e),e);const T=await async function(e,t,a,n,s,i,d,c,u,g,f,w){var y,m,b;await N.RustModule.load(),(0,F.setRuntime)(N.RustModule.CrossCsl.init);const x={linearFee:{coefficient:f.linearFeeCoefficient,constant:f.linearFeeConstant},coinsPerUtxoByte:f.coinsPerUtxoByte,poolDeposit:f.poolDeposit,keyDeposit:f.keyDeposit,maxValueSize:5e3,maxTxSize:16384,memPriceFrom:577,memPriceTo:1e3,stepPriceFrom:721,stepPriceTo:1e7,coinsPerUtxoWord:8*Number(f.coinsPerUtxoByte)+2},_=new K.UTxOSet(await p().all(A()(i).call(i,re))),T=await Y.TxBuilder.new(x,_);await T.addRequiredInputs(await p().all(A()(s).call(s,(async([e,t])=>{let a;if(null==t)a=[];else if(t.nativeScript)a=[{type:"native",nativeScript:t.nativeScript}];else{if(!t.plutusScript)throw new Error("unxpected witness value");a=[{type:"plutus",plutusScript:t.plutusScript,datum:t.datum,redeemer:t.redeemer}]}return[await re(e),...a]})))),null!=u?await T.setTtl(u):await T.setTtl(d.plus(j).toNumber()),null!=c&&await T.setValidityStartInterval(c),null!=g&&await T.addRequiredSigners(g);const k=null!==(y=a.metadata)&&void 0!==y?y:{};if(o()(k).length>0){const e={};for(const t of o()(k))e[r()(t,10)]=k[t];await T.withMetadata(e)}a.nativeScripts&&await T.addNativeScripts(a.nativeScripts),await T.addMint(t);const I=await Y.SendRequest.from(A()(e).call(e,(t=>{var a;const n=t.amount.getDefaultEntry().amount.toString(),r=v()(a=l()(t.amount)).call(a,(({identifier:t})=>t!==e[0].amount.defaults.defaultIdentifier));return{receiver:t.address,value:new K.Value(new K.Amount(n),K.NativeAssets.from(A()(r).call(r,(e=>{const[t,a]=e.identifier.split(".");return{asset:{policy:(0,O.hexToBytes)(t),name:(0,O.hexToBytes)(a)},amount:new K.Amount(e.amount.toString())}}))))}})));try{await T.withSendRequest(I)}catch(e){var M;if(e instanceof G.NotEnoughMoneyToSendError)throw new E.r7;if(h()(M=String(e)).call(M,"less than the minimum UTXO value"))throw new E.JZ;throw e}await T.prepareForPlutus(f.networkId>0?"vasil":"default");const S=n&&await K.WalletAddress.from(n.address,F.WalletType.Shelley,{path:n.addressing.path,start:n.addressing.startLevel});await T.addChangeAndFee(S);const R=await T.build(),D=[];R.change&&D.push({address:R.change.address.hex,addressing:{path:R.change.address.spendingKeyInfo.path,startLevel:R.change.address.spendingKeyInfo.start},values:ne(R.change.value,w,U.hd.Cardano)});const C=new(P())(A()(m=[...A()(s).call(s,(([e,t])=>e)),...i]).call(m,(e=>[e.utxo_id,e])));return{senderUtxos:A()(b=R.inputs.asArray()).call(b,(e=>C.get(e.tx+e.index))),txBuilder:R.builder.wasm,changeAddr:D}}(e,t,a,n,b,D()(S()(_).call(_)),d,c,u,g,f,w);return{senderUtxos:A()(y=T.senderUtxos).call(y,(e=>{const t=x.get(e)||_.get(e);if(null==t)throw new Error("newAdaUnsignedTx utxo reference was changed. Should not happen");return t})),txBuilder:T.txBuilder,changeAddr:T.changeAddr,certificates:[]}}function ae(e,t,a,n,r,s,o=[]){var i,l,d;const c=new(_()),u=new(_()),p=[];function g(e,t){const a=(0,L.normalizeToAddress)(e);if(null==a)throw new Error("signTransaction utxo not a valid Shelley address");const n=(0,L.getCardanoSpendingKeyHash)(a),r=a.to_hex();if(null!==n){if(void 0===n)throw new Error("signTransaction cannot sign script inputs");{const e=n.to_hex();u.has(e)||(u.add(e),p.push(t))}}else c.has(r)||(c.add(r),p.push(t))}for(const t of e)g(t.receiver,t);for(const e of o)g(e.address,e);let h,f,w;if(t instanceof N.RustModule.WalletV4.Transaction)h=t.body(),w=t.witness_set(),f=N.RustModule.WalletV4.FixedTransaction.from_hex(t.to_hex()).transaction_hash();else if(t instanceof N.RustModule.WalletV4.TransactionBuilder){const e=t.build_tx();h=e.body(),w=e.witness_set(),f=N.RustModule.WalletV4.FixedTransaction.from_hex(e.to_hex()).transaction_hash()}else if(t instanceof N.RustModule.WalletV4.TransactionBody)h=t,f=N.RustModule.WalletV4.FixedTransaction.new_from_body_bytes(h.to_bytes()).transaction_hash();else{if(!(t instanceof $||t instanceof Uint8Array))throw new Error("unexpected tx body type");h=N.RustModule.WalletV4.TransactionBody.from_bytes(t),f=N.RustModule.WalletV4.TransactionHash.from_bytes(z()(32).update(t).digest("binary"))}const y=null!==(i=w)&&void 0!==i?i:N.RustModule.WalletV4.TransactionWitnessSet.new(),b=null!==(l=y.vkeys())&&void 0!==l?l:N.RustModule.WalletV4.Vkeywitnesses.new(),v=null!==(d=y.bootstraps())&&void 0!==d?d:N.RustModule.WalletV4.BootstrapWitnesses.new();!function(e,t,a,n,r,s){const o=A()(t).call(t,(e=>{if(e.addressing.startLevel+e.addressing.path.length-1!==B.CZ.ADDRESS.level)throw new Error("addWitnesses incorrect addressing size");return(0,Z.r)({addressing:e.addressing,startingFrom:{level:a,key:n}})}));for(let a=0;a<t.length;a++){const n=t[a],i=()=>{if(null!=n.receiver)return n.receiver;if(null!=n.address)return n.address;throw new Error(`[addWitnesses] Unexpected addressing for signing: ${m()(n)}`)},l=(0,L.normalizeToAddress)(i());if(null==l)throw new Error("addWitnesses utxo not a valid Shelley address");const d=N.RustModule.WalletV4.ByronAddress.from_address(l);if(null==d){const t=N.RustModule.WalletV4.make_vkey_witness(e,o[a].to_raw_key());r.add(t)}else{const t=N.RustModule.WalletV4.make_icarus_bootstrap_witness(e,d,o[a]);s.add(t)}}}(f,p,a,n,b,v);const x=new(_());for(const e of r)x.has(e)||(x.add(e),b.add(N.RustModule.WalletV4.Vkeywitness.from_hex(e)));v.len()>0&&y.set_bootstraps(v),b.len()>0&&y.set_vkeys(b);const T=null==s?null:N.RustModule.WalletV4.AuxiliaryData.from_bytes($.from(s.to_bytes()));return N.RustModule.WalletV4.Transaction.new(h,y,T)}function ne(e,t,a){var n;return new H.a([{amount:new W.Z(e.amount.toString()),identifier:a,networkId:t},...A()(n=e.assets.asArray()).call(n,(([e,a])=>({amount:new W.Z(a.toString()),identifier:e.getHash(),networkId:t})))],{defaultIdentifier:a,defaultNetworkId:t})}async function re(e){var t;return{address:await K.Address.from(e.receiver),tx:e.tx_hash,index:e.tx_index,value:new K.Value(new K.Amount(e.amount),K.NativeAssets.from(A()(t=e.assets).call(t,(e=>({asset:{policy:(0,O.hexToBytes)(e.policyId),name:(0,O.hexToBytes)(e.name)},amount:new K.Amount(e.amount)})))))}}},62021:(e,t,a)=>{a.d(t,{Gi:()=>I,fu:()=>D});var n=a(86902),r=a.n(n),s=(a(36384),a(94473)),o=a.n(s),i=a(56474),l=a.n(i),d=a(47302),c=a.n(d),u=a(89400),p=a.n(u),g=a(2991),h=a.n(g),f=a(1499),w=a(5557),y=a(74057),m=(a(34786),a(52367)),b=a(66905),v=a(86335),x=a(95667),_=a(17462),T=a.n(_),k=(a(87315),a(90649));function I(e,t,a){var n,r,s;const i=(()=>{const t=e.senderUtxos[0];if(t.addressing.startLevel!==m.CZ.PURPOSE.level)throw new Error("createTrezorSignTxPayload unexpected addressing start level");const a=[...t.addressing.path];return a[m.CZ.CHAIN.level-1]=b.OC.CHIMERIC_ACCOUNT,a[m.CZ.ADDRESS.level-1]=0,a})(),l=e.unsignedTx.build_tx(),d=l.body(),u=v.RustModule.WasmScope((e=>e.WalletV4.has_transaction_set_tag(l.to_bytes())));if(u===v.RustModule.WalletV4.TransactionSetsState.MixedSets)throw new Error("Transaction with mixed sets cannot be signed by Ledger");const p=u===v.RustModule.WalletV4.TransactionSetsState.AllSetsHaveTag,g=function(e){var t;for(const t of e)(0,f.sV)(t.addressing);return c()(t=h()(e).call(e,(e=>({prev_hash:e.tx_hash,prev_index:e.tx_index,path:(0,w.FB)(e.addressing.path)})))).call(t,S)}(e.senderUtxos),_=function(e,t,a){const n=[];for(const i of(0,k.iterateLenGet)(e)){var r,s;const e=i.address(),l=(0,x.toHexOrBase58)(i.address()),d=R(i.amount().multiasset()),c=null!==(r=(0,k.maybe)(null===(s=i.data_hash())||void 0===s?void 0:s.to_hex(),(e=>({datumHash:e}))))&&void 0!==r?r:{},u=o()(t).call(t,(e=>l===e.address));if(null!=u)if((0,f.sV)(u.addressing),v.RustModule.WalletV4.BaseAddress.from_address(e))n.push({addressParameters:{addressType:y.CardanoAddressType.BASE,path:u.addressing.path,stakingPath:a},amount:i.amount().coin().to_str(),...d,...c});else{if(!v.RustModule.WalletV4.ByronAddress.from_address(e))throw new Error("unexpected change address type");n.push({addressParameters:{addressType:y.CardanoAddressType.BYRON,path:u.addressing.path},amount:i.amount().coin().to_str(),...c})}else{const t=v.RustModule.WalletV4.ByronAddress.from_address(e);n.push({address:null==t?e.to_bech32():t.to_base58(),amount:i.amount().coin().to_str(),...d,...c})}}return n}(d.outputs(),e.changeAddr,i);let I={signingMode:y.CardanoTxSigningMode.ORDINARY_TRANSACTION,inputs:g,outputs:_,fee:d.fee().to_str(),ttl:null===(n=d.ttl_bignum())||void 0===n?void 0:n.to_str(),validityIntervalStart:null===(r=d.validity_start_interval_bignum())||void 0===r?void 0:r.to_str(),scriptDataHash:null===(s=d.script_data_hash())||void 0===s?void 0:s.to_hex(),protocolMagic:t,networkId:a};const D=d.withdrawals();I=null==D?I:{...I,withdrawals:A(D,[i])};const C=d.certs();if(I=null==C?I:{...I,certificates:M(C,(e=>i))},e.trezorTCatalystRegistrationTxSignData){const{votingPublicKey:t,nonce:a,paymentKeyPath:n}=e.trezorTCatalystRegistrationTxSignData;I={...I,auxiliaryData:{cVoteRegistrationParameters:{delegations:[{votePublicKey:t.replace(/^0x/,""),weight:1}],stakingPath:i,paymentAddressParameters:{addressType:y.CardanoAddressType.BASE,path:n,stakingPath:i},nonce:String(a),format:y.CardanoGovernanceRegistrationFormat.CIP36,votingPurpose:0}}}}else{const t=e.metadata;I=void 0===t?I:{...I,auxiliaryData:{hash:T()(32).update(t.to_bytes()).digest("hex")}}}return p&&(I={...I,tagCborSets:!0}),I}function A(e,t){var a,n;return h()(a=p()(n=(0,k.iterateLenGetMap)(e)).call(n).nonNull().zip(t)).call(a,(([e,t])=>({amount:e.to_str(),path:t}))).toArray()}function M(e,t){const a=[];for(const n of(0,k.iterateLenGet)(e)){const e=n.as_stake_registration();if(null!=e){a.push({type:y.CardanoCertificateType.STAKE_REGISTRATION,path:t(e.stake_credential())});continue}const r=n.as_stake_deregistration();if(null!=r){a.push({type:y.CardanoCertificateType.STAKE_DEREGISTRATION,path:t(r.stake_credential())});continue}const s=n.as_stake_delegation();if(null!=s){a.push({type:y.CardanoCertificateType.STAKE_DELEGATION,path:t(s.stake_credential()),pool:s.pool_keyhash().to_hex()});continue}const o=n.as_vote_delegation();if(null==o)throw new Error("formatTrezorCertificates Trezor doesn't support this certificate type");{const e=o.drep();let n;switch(e.kind()){case v.RustModule.WalletV4.DRepKind.KeyHash:n={type:y.CardanoDRepType.KEY_HASH,keyHash:(0,k.forceNonNull)(o.drep().to_key_hash()).to_hex()};break;case v.RustModule.WalletV4.DRepKind.ScriptHash:n={type:y.CardanoDRepType.SCRIPT_HASH,scriptHash:(0,k.forceNonNull)(o.drep().to_script_hash()).to_hex()};break;case v.RustModule.WalletV4.DRepKind.AlwaysAbstain:n={type:y.CardanoDRepType.ABSTAIN};break;case v.RustModule.WalletV4.DRepKind.AlwaysNoConfidence:n={type:y.CardanoDRepType.NO_CONFIDENCE};break;default:throw new Error("Trezor: Unsupported dRep kind: "+e.kind())}a.push({type:y.CardanoCertificateType.VOTE_DELEGATION,dRep:n,path:t(o.stake_credential())})}}return a}function S(e,t){return e.prev_hash!==t.prev_hash?e.prev_hash<t.prev_hash?-1:1:e.prev_index-t.prev_index}function R(e){var t;return null==e?l()({}):{tokenBundle:h()(t=(0,k.iterateLenGetMap)(e).nonNullValue()).call(t,(([e,t])=>{var a;const n=h()(a=(0,k.iterateLenGetMap)(t).nonNullValue()).call(a,(([e,t])=>({assetNameBytes:(0,k.bytesToHex)(e.name()),amount:t.to_str()}))).toArray();return{policyId:e.to_hex(),tokenAmounts:n}})).toArray()}}function D(e,t,a,n,s){var i,l,d,c,u,p,g;const f=v.RustModule.WasmScope((t=>t.WalletV4.has_transaction_set_tag(t.WalletV4.FixedTransaction.new_from_body_bytes((0,k.hexToBytes)(e)).to_bytes())));if(f===v.RustModule.WalletV4.TransactionSetsState.MixedSets)throw new Error("Transaction with mixed sets cannot be signed by Ledger");const w=f===v.RustModule.WalletV4.TransactionSetsState.AllSetsHaveTag,m=v.RustModule.WalletV4.TransactionBody.from_hex(e);function b(e){const t=[];for(const a of(0,k.iterateLenGet)(e)){const e=a.transaction_id().to_hex(),n=a.index(),r=o()(s).call(s,(t=>t.tx_hash===e&&t.tx_index===n)),i={prev_hash:e,prev_index:n};r&&(i.path=r.addressing.path),t.push(i)}return t}function x(e){const a=e.serialization_format()===v.RustModule.WalletV4.CborContainerType.Map,r=e.amount().coin().to_str(),{tokenBundle:s}=R(e.amount().multiasset()),o=e.data_hash(),i=e.address();let l;const d=v.RustModule.WalletV4.ByronAddress.from_address(i),c=v.RustModule.WalletV4.PointerAddress.from_address(i);if((d||c)&&(l={address:i.to_bech32(),amount:r}),v.RustModule.WalletV4.EnterpriseAddress.from_address(i)){const e=n(i.to_bech32());l=e?{addressParameters:{addressType:y.CardanoAddressType.ENTERPRISE,path:e},amount:r}:{address:i.to_bech32(),amount:r}}const u=v.RustModule.WalletV4.BaseAddress.from_address(i);if(u){const e=v.RustModule.WalletV4.EnterpriseAddress.new(t,u.payment_cred()).to_address().to_hex(),a=n(e);if(a){const e=u.stake_cred(),s=v.RustModule.WalletV4.RewardAddress.new(t,e).to_address().to_hex(),o=n(s);if(o)l={addressParameters:{addressType:y.CardanoAddressType.BASE,path:a,stakingPath:o},amount:r};else{const t=e.to_keyhash(),n=e.to_scripthash();if(t)l={addressParameters:{addressType:y.CardanoAddressType.BASE,path:a,stakingKeyHash:t.to_hex()},amount:r};else{if(!n)throw new Error("unexpected stake credential type in base address");l={addressParameters:{addressType:y.CardanoAddressType.BASE,path:a,stakingScriptHash:n.to_hex()},amount:r}}}}else l={address:i.to_bech32(),amount:r}}if(!l)throw new Error("not expecting to pay to reward address");s&&(l.tokenBundle=s),o&&(l.datumHash=o.to_hex()),a&&(l.format=y.CardanoTxOutputSerializationFormat.MAP_BABBAGE);const p=e.plutus_data();p&&(l.inlineDatum=p.to_hex(),l.format=y.CardanoTxOutputSerializationFormat.MAP_BABBAGE);const g=e.script_ref();return g&&(l.referenceScript=g.to_hex(),l.format=y.CardanoTxOutputSerializationFormat.MAP_BABBAGE),l}const _=h()(i=(0,k.iterateLenGet)(m.outputs())).call(i,x).toArray(),T=[],I=[],A=m.required_signers();if(A)for(const e of(0,k.iterateLenGet)(A)){const a=v.RustModule.WalletV4.EnterpriseAddress.new(t,v.RustModule.WalletV4.Credential.from_keyhash(e)).to_address().to_hex(),r=v.RustModule.WalletV4.RewardAddress.new(t,v.RustModule.WalletV4.Credential.from_keyhash(e)).to_address().to_hex(),s=n(a)||n(r);s?(T.push({keyPath:s}),I.push(s)):T.push({keyHash:e.to_hex()})}let S=null;const D=m.certs();D&&(S=M(D,(e=>{const a=v.RustModule.WalletV4.RewardAddress.new(t,e).to_address().to_hex(),r=n(a);if(null==r)throw new Error("not own address in certificate");return r})));let C=null;const P=m.withdrawals();if(P){const e=[];for(const[t,a]of(0,k.iterateLenGetMap)(P).nonNullValue()){const r=t.to_address().to_hex(),s=n(r);if(null==s)throw new Error("foreign withdrawal reward address");e.push({amount:a.to_str(),path:s})}C=e}let W=null;const E=m.auxiliary_data_hash();E&&(W={hash:E.to_hex()});let N=null;const B=m.collateral();B&&(N=b(B));const L=null===(l=JSON.parse(null!==(d=null===(c=m.mint())||void 0===c?void 0:c.to_json())&&void 0!==d?d:"null"))||void 0===l?void 0:h()(l).call(l,(([e,t])=>{var a;return{policyId:e,tokenAmounts:h()(a=r()(t)).call(a,(e=>({assetNameBytes:e,mintAmount:t[e]})))}})),H=null===(u=m.script_data_hash())||void 0===u?void 0:u.to_hex(),U={signingMode:y.CardanoTxSigningMode.ORDINARY_TRANSACTION,inputs:b(m.inputs()),outputs:_,fee:m.fee().to_str(),protocolMagic:a,networkId:t,includeNetworkId:null!=m.network_id()},V=null===(p=m.ttl_bignum())||void 0===p?void 0:p.to_str(),O=null===(g=m.validity_start_interval_bignum())||void 0===g?void 0:g.to_str();V&&(U.ttl=V),O&&(U.validityIntervalStart=O),S&&(U.certificates=S),C&&(U.withdrawals=C),W&&(U.auxiliaryData=W),L&&(U.mint=L),H&&(U.scriptDataHash=H),N&&(U.collateralInputs=N,U.signingMode=y.CardanoTxSigningMode.PLUTUS_TRANSACTION),A&&(U.requiredSigners=T);const F=m.collateral_return();F&&(U.collateralReturn=x(F));const K=m.total_collateral();K&&(U.totalCollateral=K.to_str());const G=m.reference_inputs();if(G){const e=[];for(const t of(0,k.iterateLenGet)(G))e.push({prev_hash:t.transaction_id().to_hex(),prev_index:t.index()});U.referenceInputs=e}return I.length>0&&(U.additionalWitnessRequests=I),w&&(U.tagCborSets=!0),U}a(27649)},9243:(e,t,a)=>{a.d(t,{s:()=>s});var n=a(56474),r=a.n(n);a(86335),a(55343);const s=r()({EXPEND:"expend",INCOME:"income",EXCHANGE:"exchange",SELF:"self",MULTI:"multi"})},4158:(e,t,a)=>{a.d(t,{MX:()=>g,qP:()=>h,_Y:()=>f});var n=a(32366),r=a.n(n),s=a(94473),o=a.n(s),i=(a(59340),a(905)),l=a(13469),d=a(19008),c=(a(38441),a(21131)),u=a(63139),p=(a(27189),a(14986),a(33913),a(26333),a(55343));async function g(e){try{return await(0,d.M)(e.db)}catch(e){if(l.Yd.error("getWallets error: "+(0,l.n)(e)),e instanceof u.default)throw e;throw new c.rp}}function h(e){return null!=o()(e).call(e,(e=>!(!0!==e.shouldSendAll||!e.token.IsDefault)))}function f(e,t,a){const n=new p.a([],e);for(const e of t)if(null!=e.amount)n.add({amount:new i.Z(e.amount),identifier:e.token.Identifier,networkId:e.token.NetworkId});else if(e.token.IsDefault){const t=r()(a).call(a,((e,t)=>e.plus(t.getDefaultEntry().amount)),new i.Z(0));n.add({amount:t,identifier:e.token.Identifier,networkId:e.token.NetworkId})}else{const t=r()(a).call(a,((t,a)=>{var n;const r=o()(n=a.nonDefaultEntries()).call(n,(t=>t.identifier===e.token.Identifier));return null!=r?t.plus(r.amount):t}),new i.Z(0));n.add({amount:t,identifier:e.token.Identifier,networkId:e.token.NetworkId})}return n}},71865:(e,t,a)=>{a.d(t,{w:()=>s});var n=a(87672),r=a.n(n);class s{constructor(e){r()(this,"baseFetcher",void 0),r()(this,"checkServerStatus",(e=>this.baseFetcher.checkServerStatus(e))),r()(this,"getCurrentCoinPrice",(e=>this.baseFetcher.getCurrentCoinPrice(e))),r()(this,"getHistoricalCoinPrice",(e=>this.baseFetcher.getHistoricalCoinPrice(e))),this.baseFetcher=e}}},11767:(e,t,a)=>{a.d(t,{g:()=>p});var n=a(87672),r=a.n(n),s=a(9669),o=a.n(s),i=a(13469),l=a(21131),d=a(84174),c=a(85412);const u=(()=>{let e;if(e=c.N.isNightly()?d.networks.CardanoPreprodTestnet.Backend.BackendService:d.networks.CardanoMainnet.Backend.BackendService,null==e)throw new Error;return e})();class p{constructor(e,t,a){r()(this,"getLastLaunchVersion",void 0),r()(this,"getCurrentLocale",void 0),r()(this,"getPlatform",void 0),r()(this,"checkServerStatus",(e=>o()(`${e.backend||function(){const e=d.networks.CardanoMainnet.Backend.BackendService;if(null==e)throw new Error;return e}()}/api/status`,{method:"get",timeout:6e4,headers:{"yoroi-version":`${this.getPlatform()} / ${this.getLastLaunchVersion()}`,"yoroi-locale":this.getCurrentLocale()}}).then((e=>e.data)).catch((e=>{throw i.Yd.error("RemoteFetcher::checkServerStatus error: "+(0,i.n)(e)),new l.AW})))),r()(this,"getCurrentCoinPrice",(e=>o()(`${u}/api/price/${e.from}/current`,{method:"get",timeout:6e4,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then((e=>e.data)).catch((e=>{throw i.Yd.error("RemoteFetcher::getCurrentCoinPrice error: "+(0,i.n)(e)),new l.Px})))),r()(this,"getHistoricalCoinPrice",(e=>o()(`${u}/api/price/${e.from}/${e.timestamps.join(",")}`,{method:"get",timeout:6e4,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then((e=>e.data)).catch((e=>{throw i.Yd.error("RemoteFetcher::getHistoricalCoinPrice error: "+(0,i.n)(e)),new l.js})))),this.getLastLaunchVersion=e,this.getCurrentLocale=t,this.getPlatform=a}}},24651:(e,t,a)=>{a.d(t,{dw:()=>I,K0:()=>M,SL:()=>S});var n=a(39392),r=a.n(n),s=a(32366),o=a.n(s),i=a(20116),l=a.n(i),d=a(36384),c=a.n(d),u=a(86902),p=a.n(u),g=a(2991),h=a.n(g),f=a(66419),w=a.n(f),y=a(56474),m=a.n(y),b=a(97143),v=a(39845),x=a(86335),_=a(38079),T=a(95667),k=a(57421);function I(e){return async t=>{var a;const n=m()({GetAddress:v.t9,ModifyAddress:b.ad}),r=w()((0,k.fO)(...h()(a=p()(n)).call(a,(e=>n[e])))),s=new(c())(t.lockedTables);for(const e of r)if(!s.has(e))throw new Error("rawGenAddByHash missing lock on "+e);const o=await n.GetAddress.getByHash(t.db,t.tx,[t.address.data]);for(const t of o)if(e.has(t.AddressId))return;const i=await n.ModifyAddress.addFromCanonicalByHash(t.db,t.tx,[{...t.address,keyDerivationId:t.keyDerivationId}]);for(const t of i)e.add(t.AddressId)}}async function A(e,t,a,n,r,s,o,i){var d;const c=l()(d=await a.GetAddress.getByHash(e,t,[i])).call(d,(e=>r.has(e.AddressId)));if(c.length>1)throw new Error("addFromCanonical Should never happen multi-match");if(0===c.length)n.push(s);else{const n=await a.GetAddress.getKeyForFamily(e,t,c[0].AddressId);if(null==n)throw new Error("addFromCanonical Should never happen no mapping");const i=await a.ModifyAddress.addFromCanonicalByHash(e,t,[{keyDerivationId:n,data:s.data,type:s.type}]);o.set(s.data,i[0].AddressId),r.add(i[0].AddressId)}}function M(e){return async t=>{var a;const n=m()({GetAddress:v.t9}),r=w()((0,k.fO)(...h()(a=p()(n)).call(a,(e=>n[e])))),s=new(c())(t.lockedTables);for(const e of r)if(!s.has(e))throw new Error("rawGenFindOwnAddress missing lock on "+e);const o=await n.GetAddress.getByHash(t.db,t.tx,[t.hash]);for(const t of o)if(e.has(t.AddressId))return t.AddressId}}const S=(e,t)=>x.RustModule.WasmScope((a=>function(e,t,a){return async n=>{var s;const i=m()({GetAddress:v.t9,ModifyAddress:b.ad}),d=w()((0,k.fO)(...h()(s=p()(i)).call(s,(e=>i[e])))),u=new(c())(n.lockedTables);for(const e of d)if(!u.has(e))throw new Error("rawGenHashToIdsFunc missing lock on "+e);const g=w()(new(c())(n.hashes)),f=await i.GetAddress.getByHash(n.db,n.tx,g),y=o()(f).call(f,((e,t)=>{const a=e.get(t.Hash)||[];return e.set(t.Hash,[...a,t]),e}),new(r())),x=[],I=new(r());for(const e of g)if(y.has(e)){const a=y.get(e);if(null==a)throw new Error("should never happen");const n=l()(a).call(a,(e=>t.has(e.AddressId)));if(n.length>1)throw new Error("rawGenHashToIdsFunc Address associated multiple times with same wallet");if(1===n.length){I.set(e,n[0].AddressId);continue}x.push(e)}else x.push(e);const M=[],S=h()(x).call(x,(e=>({data:e,type:(0,T.addressToKind)(e,"bytes",a)})));for(const a of S)if(a.type===_.dq.CARDANO_BASE){const r=e.WalletV4.Address.from_hex(a.data),s=e.WalletV4.BaseAddress.from_address(r);if(null==s)throw new Error("rawGenHashToIdsFunc not base address Should never happen");const o=e.WalletV4.EnterpriseAddress.new(r.network_id(),s.payment_cred()).to_address().to_hex();await A(n.db,n.tx,i,M,t,a,I,o)}else if(a.type===_.dq.CARDANO_PTR){const r=e.WalletV4.Address.from_hex(a.data),s=e.WalletV4.PointerAddress.from_address(r);if(null==s)throw new Error("rawGenHashToIdsFunc not ptr address Should never happen");const o=e.WalletV4.EnterpriseAddress.new(r.network_id(),s.payment_cred()).to_address().to_hex();await A(n.db,n.tx,i,M,t,a,I,o)}else M.push(a);const R=await i.ModifyAddress.addForeignByHash(n.db,n.tx,M);for(let e=0;e<M.length;e++)I.set(M[e].data,R[e].AddressId);return I}}(a,e,t)))},42746:(e,t,a)=>{a.d(t,{Gs:()=>h,ug:()=>f});var n=a(86902),r=a.n(n),s=a(2991),o=a.n(s),i=a(80426),l=a.n(i),d=a(56474),c=a.n(d),u=(a(94473),a(59340),a(57421)),p=a(6144),g=a(34642);async function h(e){var t,a;const n=c()({ModifyPriceData:g.z}),s=l()(t=o()(a=r()(n)).call(a,(e=>n[e]))).call(t,(t=>(0,u.Hz)(e.db,t)));return await(0,u.zm)(e.db,s,(async t=>n.ModifyPriceData.upsertPrices(e.db,t,e.prices)))}async function f(e){var t,a;const n=c()({GetPriceData:p.y}),s=l()(t=o()(a=r()(n)).call(a,(e=>n[e]))).call(t,(t=>(0,u.Hz)(e.db,t)));return await(0,u.zm)(e.db,s,(async t=>n.GetPriceData.getAllPrices(e.db,t)))}},26333:(e,t,a)=>{a.d(t,{r:()=>g});var n=a(86902),r=a.n(n),s=a(2991),o=a.n(s),i=a(80426),l=a.n(i),d=a(56474),c=a.n(d),u=a(57421),p=a(39845);async function g(e){var t,a;const n=c()({GetToken:p.YT}),s=l()(t=o()(a=r()(n)).call(a,(e=>n[e]))).call(t,(t=>(0,u.Hz)(e.db,t)));return await(0,u.zm)(e.db,s,(async t=>n.GetToken.all(e.db,t)))}},49871:(e,t,a)=>{a.d(t,{T:()=>o}),a(3577);var n=a(84174),r=a(87326),s=a(72672);async function o(e){if(null==e)throw new Error("getWalletChecksum gets unexpected null");const t=(await e.getPublicKey()).Hash;return(0,n.isCardanoHaskell)(e.getParent().getNetworkInfo())&&e.getParent()instanceof r.J?(0,s.legacyWalletChecksum)(t):(0,s.walletChecksum)(t)}},74119:(e,t,a)=>{a.d(t,{Jt:()=>p,mM:()=>g,Hx:()=>h,cJ:()=>f});var n=a(86902),r=a.n(n),s=(a(56474),a(59340)),o=a.n(s),i=a(93476),l=a.n(i),d=a(85412);const c=async e=>new(l())(((t,a)=>{chrome.storage.local.get(e,(n=>{if(chrome.runtime.lastError&&a(chrome.runtime.lastError),void 0===e)t(o()(n));else{const r=n[e];null==r||"string"==typeof r?t(r):"object"==typeof r?t(o()(r)):a(new Error("getStorageItemInExtension cannot get non-string value"))}}))})),u=async e=>void 0===e?l().resolve(o()(localStorage)):l().resolve(localStorage[e]);async function p(e){return d.Z.isExtension()?await c(e):await u(e)}async function g(e,t){d.Z.isExtension()?await new(l())(((a,n)=>{chrome.storage.local.set({[e]:t},(()=>{chrome.runtime.lastError&&n(chrome.runtime.lastError),a()}))})):localStorage.setItem(e,t)}async function h(e){d.Z.isExtension()?await new(l())(((t,a)=>{chrome.storage.local.remove(e,(()=>{chrome.runtime.lastError&&a(chrome.runtime.lastError),t()}))})):localStorage.removeItem(e)}async function f(){return d.Z.isExtension()?await c().then((e=>0===r()(e).length)):0===localStorage.length}},36018:(e,t,a)=>{a.d(t,{a:()=>r});var n=a(56474);const r=a.n(n)()({ADDRESS:"addr",PAYMENT_KEY_HASH:"addr_vkh"})},24558:(e,t,a)=>{a.d(t,{Zj:()=>l,qN:()=>c}),a(38441);var n=a(86335),r=a(3577),s=a(60274),o=a(90649),i=a(48764).Buffer;const l=async e=>n.RustModule.WasmScope((t=>d(t,e))),d=async(e,{appAuthID:t,deriver:a,checksum:n,password:l})=>{if(null==t)return null;if(null==n)throw new Error("[createAuthEntry] app auth is requested but wallet-checksum does not exist");const d=(0,r.y9)(a);if(!d)throw new Error("[createAuthEntry] no signing key");const c=await d.getSigningKey(),u=await d.normalizeKey({...c,password:l}),p=e.WalletV4.Bip32PrivateKey.from_hex(u.prvKeyHex),g=p.derive(0).derive(0).to_raw_key(),h=p.derive(2).derive(0).to_raw_key(),f=e.WalletV4.BaseAddress.new(a.getParent().networkInfo.NetworkId,e.WalletV4.Credential.from_keyhash(g.to_public().hash()),e.WalletV4.Credential.from_keyhash(h.to_public().hash())).to_address(),w=(await(0,s.iZ)(i.from(f.to_bytes()),g,(0,o.utfToBytes)(`DAPP_LOGIN: ${t}`))).signature(),y=e.WalletV4.Bip32PrivateKey.from_bip39_entropy(w,i.from("")).to_raw_key(),m=y.to_public();return{walletId:n.ImagePart,pubkey:(0,o.bytesToHex)(m.as_bytes()),privkey:(0,o.bytesToHex)(y.as_bytes())}},c=async({privKey:e,payloadHex:t})=>n.RustModule.WalletV4.PrivateKey.from_extended_bytes((0,o.hexToBytes)(e)).sign((0,o.hexToBytes)(t)).to_hex()},90649:(e,t,a)=>{a.d(t,{bytesToHex:()=>S,bytesToBase64:()=>R,hexToBytes:()=>D,hexToUtf:()=>C,utfToBytes:()=>P,logErr:()=>W,createFilterUniqueBy:()=>E,listValues:()=>N,last:()=>B,maybe:()=>L,fail:()=>H,forceNonNull:()=>U,isEmptyArray:()=>V,sanitizeForLog:()=>O,ensureArray:()=>F,iterateLenGet:()=>K,iterateLenGetMap:()=>G});var n=a(2991),r=a.n(n),s=a(20116),o=a.n(s),i=a(66419),l=a.n(i),d=a(98341),c=a.n(d),u=a(87672),p=a.n(u),g=a(16976),h=a.n(g),f=a(69301),w=a.n(f),y=a(86902),m=a.n(y),b=(a(11128),a(41511)),v=a.n(b),x=(a(33032),a(93476),a(59340),a(32366)),_=a.n(x),T=(a(47302),a(26295),a(20455)),k=a.n(T),I=a(36384),A=a.n(I),M=(a(29828),a(48764).Buffer);function S(e){return M.from(e).toString("hex")}function R(e){return M.from(e).toString("base64")}function D(e){return M.from(e,"hex")}function C(e){return D(e).toString("utf-8")}function P(e){return M.from(e,"utf-8")}function W(e,t){try{return e()}catch(e){throw console.error("string"==typeof t?t:t(e),e),e}}function E(e=(e=>e)){const t=new(A());return a=>{const n=e(a);return!t.has(n)&&t.add(n)&&!0}}function N(e){return k()(e)}function B(e){return e[e.length-1]}function L(e,t){return null==e?e:t(e)}function H(...e){throw new Error(...e)}function U(e){return e}function V(e){return v()(e)&&0===e.length}function O(e){const t=["password"];if(null!=e&&"object"==typeof e){var a;let n=_()(a=m()(e)).call(a,((t,a)=>({...t,[a]:O(e[a])})),{});for(const e of t)null!=n[e]&&(n={...n,[e]:"[sanitized]"});return n}return e}function F(e){return v()(e)?e:[e]}function K(e){return Y.from(function*(){if(null!=e){const t=e.len();for(let a=0;a<t;a++)yield e.get(a)}}())}function G(e){return q.fromTuples(function*(){if(e)for(const t of K(w()(e).call(e)))yield[t,e.get(t)]}())}class Y{constructor(e){p()(this,"__source",void 0),this.__source=e}static from(e){return new Y(e)}[c()](){return h()(this.__source)}forEach(e){for(const t of this.__source)e(t)}zip(e){return function(e,t){return Y.from(function*(){const a=h()(e),n=h()(t);for(;;){const e=a.next(),t=n.next();if(e.done||t.done)break;yield[e.value,t.value]}}())}(this.__source,e)}join(e){const t=this.__source;return Y.from(function*(){for(const e of t)yield e;for(const t of e)yield t}())}toArray(){return l()(this.__source)}toSet(){return new(A())(this.__source)}map(e){const t=this.__source;return Y.from(function*(){for(const a of t)yield e(a)}())}flatMap(e){const t=this.__source;return Y.from(function*(){for(const a of t)for(const t of e(a))yield t}())}filter(e){const t=this.__source;return Y.from(function*(){for(const a of t)e(a)&&(yield a)}())}unique(){const e=new(A());return o()(this).call(this,(t=>!e.has(t)&&(e.add(t),!0)))}nonNull(){return o()(this).call(this,(e=>null!=e))}}class q extends Y{static fromTuples(e){return new q(e)}keys(){return r()(this).call(this,(([e])=>e))}values(){return r()(this).call(this,(([,e])=>e))}nonNullValue(){return q.fromTuples(o()(this).call(this,(([,e])=>null!=e)))}}},37790:(e,t,a)=>{a.d(t,{Z:()=>p});var n,r=a(34074),s=a.n(r),o=a(89749),i=a.n(o),l=a(2991),d=a.n(l),c=a(22188),u=a(14986);a(55343);let p=(n=class e extends u.Z{static fromAnnotatedTx(t){var a;const{addressLookupMap:n,defaultToken:r,tx:s}=t;return new e({txid:s.transaction.Hash,block:s.block,type:s.type,amount:s.amount.joinAddCopy(s.fee),fee:s.fee,date:null!=s.block?s.block.BlockTime:new Date(s.transaction.LastUpdateTime),addresses:{from:(0,u.E)({rows:s.utxoInputs,addressLookupMap:n,tokens:s.tokens,defaultToken:r}),to:d()(a=(0,u.E)({rows:s.utxoOutputs,addressLookupMap:n,tokens:s.tokens,defaultToken:r})).call(a,(e=>({...e,isForeign:!1})))},state:s.transaction.Status,errorMsg:s.transaction.ErrorMessage})}static fromData(t){return new e(t)}},i()(n,"fromAnnotatedTx",[c.action],s()(n,"fromAnnotatedTx"),n),i()(n,"fromData",[c.action],s()(n,"fromData"),n),n)},85412:(e,t,a)=>{a.d(t,{N:()=>c,Z:()=>u});var n=a(12355),r=a(35487);const s=[null];function o(){return"chrome-extension:"===location.protocol}function i(){return"moz-extension:"===location.protocol}function l(){return o()||i()}function d(){return null!=s[0]?s[0]:!!i()||!l()&&"undefined"!=typeof InstallTrigger}"undefined"!=typeof browser&&browser.runtime.getBrowserInfo().then((({name:e})=>{const t="Firefox"===e;return console.debug(`isFirefox = ${String(t)} / defined by browser info API`),s[0]=t,null})).catch((e=>{console.error("failed to call browser info API",e)}));const c={NODE_ENV:"production",COMMIT:"a6579847a1a3ee7bb20476a994c7647197be82fb",BRANCH:"fix/connector-foreign-withrawal",NIGHTLY:!1,POOLS_UI_URL_FOR_YOROI:"https://adapools.yoroiwallet.com",IS_LIGHT:!1,getNetworkName:()=>"mainnet",getVersion:function(){const e=a(51887);return(void 0!==e.default?e.default(!0):e()).version},MOBX_DEV_TOOLS:{NODE_ENV:"production",COMMIT:"a6579847a1a3ee7bb20476a994c7647197be82fb",BRANCH:"fix/connector-foreign-withrawal",NIGHTLY:!1,POOLS_UI_URL_FOR_YOROI:"https://adapools.yoroiwallet.com",IS_LIGHT:!1}.MOBX_DEV_TOOLS,commit:"a6579847a1a3ee7bb20476a994c7647197be82fb",isJest:()=>!1,branch:"fix/connector-foreign-withrawal",isDev:()=>!1,isNightly:()=>JSON.parse(!1),isLight:Boolean(!1),isTest:()=>"mainnet"===n.t.TEST,isMainnet:()=>c.getNetworkName()===n.t.MAINNET,isProduction:()=>!0,getWalletRefreshInterval:()=>3e4,getServerStatusRefreshInterval:()=>2e4,userAgentInfo:r.Z,isFirefox:d,isChrome:function(){return!!o()||!l()&&!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime||d())},isExtension:l,canRegisterProtocol:function(){return!(l()&&d()||!l()&&"https:"!==window.location.protocol)},externalPrivacyPolicyURL:()=>d()?"https://addons.mozilla.org/en-US/firefox/addon/yoroi/privacy":null},u=c},63139:(e,t,a)=>{a.d(t,{default:()=>d});var n=a(59340),r=a.n(n),s=a(87672),o=a.n(s),i=a(27216);(0,a(99095).defineMessages)({unknownError:{id:"app.errors.unknowError",defaultMessage:"!!!Unknown error occurred. Please retry."},unexpectedError:{id:"app.errors.unexpectedError",defaultMessage:"!!!Unexpected error occurred. Please retry."}});class l extends i.Z{constructor({id:e,defaultMessage:t,values:a}){if(!e)throw new Error("id:string is required.");if(null==t)throw new Error("defaultMessage:string is required.");super(`${e}: ${void 0===a?"undefined":r()(a)}`),o()(this,"id",void 0),o()(this,"defaultMessage",void 0),o()(this,"values",void 0),this.id=e,this.defaultMessage=t,this.values=a||{}}}const d=l},38043:(e,t,a)=>{a.d(t,{default:()=>r});var n=a(99095);const r=(0,n.defineMessages)({receive:{id:"global.receive",defaultMessage:"!!!Receive"},send:{id:"wallet.navigation.send",defaultMessage:"!!!Send"},yoroi:{id:"global.yoroi",defaultMessage:"!!!Yoroi"},yoroiNightly:{id:"global.yoroiNightly",defaultMessage:"!!!Yoroi Nightly"},yoroiIntro:{id:"global.yoroi.intro",defaultMessage:"!!!Light wallet for Cardano assets"},here:{id:"global.util.here",defaultMessage:"!!!here"},addToken:{id:"global.labels.addToken",defaultMessage:"!!!Add Token"},addNft:{id:"global.labels.addNft",defaultMessage:"!!!Add NFT"},nfts:{id:"global.labels.nft",defaultMessage:"!!!NFTs"},passwordLabel:{id:"global.labels.password",defaultMessage:"!!!Password"},standardWallet:{id:"wallet.nav.type.standard",defaultMessage:"!!!Standard wallet"},transactionFee:{id:"wallet.send.preview.transactionFee",defaultMessage:"!!!Transaction Fee"},trezorWallet:{id:"wallet.nav.type.trezor",defaultMessage:"!!!Trezor wallet"},ledgerWallet:{id:"wallet.nav.type.ledger",defaultMessage:"!!!Ledger wallet"},important:{id:"global.dialogs.important",defaultMessage:"!!!Important"},fieldIsRequired:{id:"global.errors.fieldIsRequired",defaultMessage:"!!!This field is required."},invalidWalletName:{id:"global.errors.invalidWalletName",defaultMessage:"!!!Wallet name requires at least 1 and no more than 40 characters."},invalidWalletPassword:{id:"global.errors.invalidWalletPassword",defaultMessage:"!!!Password requires at least 10 characters."},invalidRepeatPassword:{id:"global.errors.invalidRepeatPassword",defaultMessage:"!!!Passwords do not match. Please retype."},errorLabel:{id:"global.labels.error",defaultMessage:"!!!Error"},processingLabel:{id:"global.labels.processing",defaultMessage:"!!!Processing..."},nextButtonLabel:{id:"global.labels.next",defaultMessage:"!!!Next"},backButtonLabel:{id:"global.labels.back",defaultMessage:"!!!Back"},instructionTitle:{id:"transfer.instructions.instructions.title.label",defaultMessage:"!!!Instructions"},confirm:{id:"global.labels.confirm",defaultMessage:"!!!Confirm"},continue:{id:"global.labels.continue",defaultMessage:"!!!Continue"},current:{id:"global.labels.current",defaultMessage:"!!!Current"},name:{id:"global.labels.name",defaultMessage:"!!!Name"},amount:{id:"global.labels.amount",defaultMessage:"!!!Amount"},minAda:{id:"global.labels.minAda",defaultMessage:"!!!Min-ADA"},id:{id:"global.labels.id",defaultMessage:"!!!ID"},finish:{id:"global.labels.finish",defaultMessage:"!!!Finish"},cancel:{id:"global.labels.cancel",defaultMessage:"!!!Cancel"},close:{id:"global.labels.close",defaultMessage:"!!!Close"},change:{id:"global.labels.change",defaultMessage:"!!!Change"},delegateLabel:{id:"global.labels.delegate",defaultMessage:"!!!Delegate"},create:{id:"global.labels.create",defaultMessage:"!!!Create"},restore:{id:"global.labels.restore",defaultMessage:"!!!Restore"},remove:{id:"global.labels.remove",defaultMessage:"!!!Remove"},cardanoscan:{id:"global.explorers.cardanoscan",defaultMessage:"!!!Cardanoscan"},exportButtonLabel:{id:"wallet.transaction.export.dialog.exportButton.label",defaultMessage:"!!!Export"},derivationPathLabel:{id:"wallet.receive.confirmationDialog.derivationPathLabel",defaultMessage:"!!!Derivation Path"},publicKeyExplanation:{id:"global.publicKey.explanation",defaultMessage:"!!!Public keys allow seeing the wallet history for the wallet, but does <strong>not</strong> allow to spend or move the funds in any way (private key is <strong>not</strong> included)"},whyUse:{id:"global.why",defaultMessage:"!!!This can be used to:"},save:{id:"global.labels.save",defaultMessage:"!!!Save"},learnMore:{id:"global.labels.LearnMore",defaultMessage:"!!!Learn more"},smartContracts:{id:"global.labels.smartContracts",defaultMessage:"!!!Smart contracts"},walletLabel:{id:"settings.menu.wallet.link.label",defaultMessage:"!!!Wallet"},assetDepositLabel:{id:"settings.menu.assetDeposit.link.label",defaultMessage:"!!!Locked assets deposit"},languageEnglish:{id:"global.language.english",defaultMessage:"!!!English"},languageJapanese:{id:"global.language.japanese",defaultMessage:"!!!日本語"},languageRussian:{id:"global.language.russian",defaultMessage:"!!!Pусский"},languageChineseSimplified:{id:"global.language.chinese.simplified",defaultMessage:"!!!简体中文"},languageChineseTraditional:{id:"global.language.chinese.traditional",defaultMessage:"!!!繁體中文"},languageKorean:{id:"global.language.korean",defaultMessage:"!!!한국어"},languageGerman:{id:"global.language.german",defaultMessage:"!!!Deutsch"},languageFrench:{id:"global.language.french",defaultMessage:"!!!Français"},languagePortuguese:{id:"global.language.portuguese",defaultMessage:"!!!Português"},languageDutch:{id:"global.language.dutch",defaultMessage:"!!!Nederlands"},languageIndonesian:{id:"global.language.indonesian",defaultMessage:"!!!Bahasa Indonesia"},languageTurkish:{id:"global.language.turkish",defaultMessage:"!!!Turkish"},languageSpanish:{id:"global.language.spanish",defaultMessage:"!!!Español"},languageItalian:{id:"global.language.italian",defaultMessage:"!!!Italiano"},languageCzech:{id:"global.language.czech",defaultMessage:"!!!Czech"},languageSlovak:{id:"global.language.slovak",defaultMessage:"!!!Slovak"},languageVietnamese:{id:"global.language.vietnamese",defaultMessage:"!!!Vietnamese"},addressLabel:{id:"wallet.receive.confirmationDialog.addressLabel",defaultMessage:"!!!Address"},addressesLabel:{id:"wallet.receive.confirmationDialog.addressesLabel",defaultMessage:"!!!Addresses"},addWalletLabel:{id:"wallet.nav.addButton",defaultMessage:"!!!Add new wallet"},allWalletsLabel:{id:"wallet.nav.allWalletsLabel",defaultMessage:"!!!All wallets"},changeWallet:{id:"wallet.nav.changeWallet",defaultMessage:"!!!Change wallet"},attentionHeaderText:{id:"widgets.warningBox.headerText",defaultMessage:"!!!Attention"},recoveryPhraseDialogTitle:{id:"wallet.backup.recovery.phrase.dialog.title",defaultMessage:"!!!Recovery phrase"},faqLinkUrl:{id:"settings.support.faq.faqLinkURL",defaultMessage:"!!!https://yoroi-wallet.com/faq/"},walletSendConfirmationDialogTitle:{id:"wallet.send.confirmationDialog.title",defaultMessage:"!!!Confirm transaction"},walletSendConfirmationAddressToLabel:{id:"wallet.send.confirmationDialog.addressToLabel",defaultMessage:"!!!To"},amountLabel:{id:"wallet.send.confirmationDialog.amountLabel",defaultMessage:"!!!Amount"},walletSendConfirmationFeesLabel:{id:"wallet.send.confirmationDialog.feesLabel",defaultMessage:"!!!Fees"},walletSendConfirmationTotalLabel:{id:"wallet.send.confirmationDialog.totalLabel",defaultMessage:"!!!Total"},walletSendConfirmationTxSizeLabel:{id:"wallet.send.confirmationDialog.txSizeLabel",defaultMessage:"!!!Size"},connectLabel:{id:"wallet.connect.hw.dialog.connect.button.label",defaultMessage:"!!!Connect"},hwConnectDialogSaveButtonLabel:{id:"wallet.connect.hw.dialog.save.button.label",defaultMessage:"!!!Save"},hwConnectDialogAboutPrerequisite4:{id:"wallet.connect.hw.dialog.step.about.prerequisite.4",defaultMessage:"!!!Your computer must remain connected to the Internet throughout the process."},hwConnectDialogAboutPrerequisiteHeader:{id:"wallet.connect.hw.dialog.step.about.prerequisite.header",defaultMessage:"!!!Prerequisites"},hwConnectDialogConnectIntroTextLine3:{id:"wallet.connect.hw.dialog.step.connect.introText.line.3",defaultMessage:"!!!This process shares the Cardano public key with Yoroi."},hwConnectDialogSaveWalletNameInputLabel:{id:"wallet.connect.hw.dialog.step.save.walletName.label",defaultMessage:"!!!Wallet name"},hwConnectDialogSaveWalletNameInputPH:{id:"wallet.connect.hw.dialog.step.save.walletName.hint",defaultMessage:"!!!Enter wallet name"},ledgerConnectAllDialogTitle:{id:"wallet.connect.ledger.dialog.title.label",defaultMessage:"!!!Connect to Ledger Hardware Wallet"},ledgerError101:{id:"wallet.connect.ledger.error.101",defaultMessage:"!!!Failed to connect. Please check your ledger device and retry."},trezorConnectAllDialogTitle:{id:"wallet.connect.trezor.dialog.title.label",defaultMessage:"!!!Connect to Trezor Hardware Wallet"},trezorError101:{id:"wallet.connect.trezor.error.101",defaultMessage:"!!!Failed to connect trezor.io. Please check your Internet connection and retry."},hwError101:{id:"wallet.hw.common.error.101",defaultMessage:"!!!Necessary permissions were not granted by the user. Please retry."},trezorError103:{id:"wallet.connect.trezor.error.103",defaultMessage:"!!!Cancelled. Please retry."},walletCreatedNotificationMessage:{id:"wallet.summary.page.walletCreatedNotificationMessage",defaultMessage:"!!!You have successfully created a new wallet"},walletRestoredNotificationMessage:{id:"wallet.summary.page.walletRestoredNotificationMessage",defaultMessage:"!!!You have successfully restored your wallet"},integratedNotificationMessage:{id:"wallet.summary.page.integratedNotificationMessage",defaultMessage:"!!!You have successfully integrated with your {deviceName}"},noTransactionsFound:{id:"wallet.summary.no.transaction",defaultMessage:"!!!No transaction history."},assetSelect:{id:"global.selectAsset.labael",defaultMessage:"!!!Select asset"},assets:{id:"global.label.assets",defaultMessage:"!!!assets"},success:{id:"global.label.success",defaultMessage:"!!!Success"},step1:{id:"transfer.form.instructions.step1.text",defaultMessage:"!!!It will take about 1 minute to restore your balance. In the next step, you will be presented with a transaction that will move all of your funds. Please review the details of the transaction carefully. You will need to pay a standard transaction fee on the Cardano network to make the transaction."},feeLabel:{id:"wallet.transaction.fee",defaultMessage:"!!!Fee"},languageSelectLabel:{id:"profile.languageSelect.form.languageSelectLabel",defaultMessage:"!!!Select your language"},languageSelectLabelShort:{id:"profile.languageSelect.form.languageSelectLabelShort",defaultMessage:"!!!Select language"},languageSelectLabelInfo:{id:"settings.general.languageSelect.labelInfo",defaultMessage:"!!!The selected language translation is fully provided by the community"},languageSelectInfo:{id:"settings.general.languageSelect.info",defaultMessage:"!!!For EMURGO, friendliness in Yoroi is an important topic. We believe understanding blockchain concepts is easier in your native language. We try supporting as many languages as possible, but for a broader selection of languages we need to accept the help from community translators. The selected language translation is fully provided by the community."},translationAcknowledgment:{id:"settings.general.translation.acknowledgment",defaultMessage:"!!!Thanks to the following"},translationContributors:{id:"settings.general.translation.contributors",defaultMessage:"_"},paperPasswordLabel:{id:"wallet.restore.dialog.paperPasswordLabel",defaultMessage:"!!!Paper wallet password"},shortRecoveryPhrase:{id:"wallet.restore.dialog.form.errors.shortRecoveryPhrase",defaultMessage:"!!!Short recovery phrase"},goBack:{id:"global.labels.goBack",defaultMessage:"!!!Go back label"},allowLabel:{id:"global.label.allow",defaultMessage:"!!!Allow"},contactSupport:{id:"global.contact",defaultMessage:"!!!contact support"},staleTxnWarningLine1:{id:"global.staleTxnWarningLine1",defaultMessage:"!!!Your wallet has changed since you created this transaction."},staleTxnWarningLine2:{id:"global.staleTxnWarningLine2",defaultMessage:"!!!You can still send this transaction but it may fail."},forMoreHelp:{id:"loading.screen.error",defaultMessage:"!!!Unexpected error occurred. We apologize for the inconvenience. If this error persists, please reach out to our support team {supportRequestLink}"},logsContent:{id:"settings.support.logs.content",defaultMessage:"!!!If you want to inspect logs, you can {downloadLogsLink}. Logs do not contain sensitive information, and it would be helpful to attach them to problem reports to help the team investigate the issue you are experiencing. Logs can be attached automatically when using the bug reporting feature."},downloadLogsLink:{id:"settings.support.logs.downloadLogsLink",defaultMessage:"!!!download them here"},downloadLogsButtonLabel:{id:"settings.support.logs.downloadLogsButtonLabel",defaultMessage:"!!!Download Logs"},blockchainExplorer:{id:"settings.general.explorer",defaultMessage:"!!!explorer"},newPasswordLabel:{id:"wallet.settings.changePassword.dialog.newPasswordLabel",defaultMessage:"!!!New password"},newPasswordFieldPlaceholder:{id:"wallet.settings.changePassword.dialog.newPasswordFieldPlaceholder",defaultMessage:"!!!Type new password"},repeatPasswordLabel:{id:"wallet.settings.changePassword.dialog.repeatPasswordLabel",defaultMessage:"!!!Repeat new password"},repeatPasswordFieldPlaceholder:{id:"wallet.settings.changePassword.dialog.repeatPasswordFieldPlaceholder",defaultMessage:"!!!Type new password"},uriSchemeLabel:{id:"global.uriSchemeTitleLabel",defaultMessage:"!!!Cardano Payment URLs"},uriExplanation:{id:"global.uriExplanation",defaultMessage:"!!!These allow you to easily share invoices with friends and businesses by simply clicking a URL."},uriExplanationRevamp:{id:"global.uriExplanation.revamp",defaultMessage:"!!!Allow URLs to easily share invoices with friends and businesses"},updatePool:{id:"global.updatePool",defaultMessage:"!!!  UPDATE POOL"},copyTooltipMessage:{id:"global.copyTooltipMessage",defaultMessage:"!!!Copied"},attentionTitle:{id:"transfer.instructions.attention.title.label",defaultMessage:"!!!Attention"},invalidMemo:{id:"wallet.transaction.memo.invalid",defaultMessage:"!!!Memo must be at least 1 and at most {maxMemo} characters."},transactionFailed:{id:"wallet.transaction.transactionFailed",defaultMessage:"!!!Transaction failed"},transactionFailedInfo:{id:"wallet.transaction.transactionFailedInfo",defaultMessage:"!!!Your transaction has not been processed properly due to technical issues"},tryAgain:{id:"wallet.transaction.tryAgain",defaultMessage:"!!!Try Again"},transactionSubmitted:{id:"wallet.transaction.transactionSubmitted",defaultMessage:"!!!Transaction submitted"},transactionSubmittedInfo:{id:"wallet.transaction.transactionSubmittedInfo",defaultMessage:"!!!Check this transaction in the list of wallet transactions"},sendingIsDisabled:{id:"wallet.send.form.sendingIsDisabled",defaultMessage:"!!!Unable to process. Please retry after the previous transaction has been completed."},passwordDisclaimer:{id:"wallet.restore.dialog.passwordDisclaimer",defaultMessage:"!!!Typing the wrong wallet password will give you a different wallet. This allows for plausible deniability."},recoveryPhraseInputLabel:{id:"wallet.restore.dialog.recovery.phrase.input.label",defaultMessage:"!!!Recovery phrase"},recoveryPhraseInputHint:{id:"wallet.restore.dialog.recovery.phrase.input.hint",defaultMessage:"!!!Enter recovery phrase"},recoveryPhraseNoResults:{id:"wallet.restore.dialog.recovery.phrase.input.noResults",defaultMessage:"!!!Not found"},invalidRecoveryPhrase:{id:"wallet.restore.dialog.form.errors.invalidRecoveryPhrase",defaultMessage:"!!!Invalid recovery phrase. Please retype."},totalRewardsLabel:{id:"wallet.dashboard.summary.rewardsTitle",defaultMessage:"!!!Total Rewards"},skipLabel:{id:"profile.uriPrompt.form.skipLabel",defaultMessage:"!!!Skip"},checkLabel:{id:"wallet.connect.hw.dialog.step.about.label",defaultMessage:"!!!CHECK"},walletUpgrade:{id:"wallet.backup.dialog.legacy.upgrade",defaultMessage:"!!!Wallet Upgrade"},dateToday:{id:"wallet.summary.page.todayLabel",defaultMessage:"!!!Today"},dateYesterday:{id:"wallet.summary.page.yesterdayLabel",defaultMessage:"!!!Yesterday"},uriLandingDialogConfirmLabel:{id:"uri.landing.dialog.confirm.label",defaultMessage:"!!!I understand"},restoreByronEraWalletDescription:{id:"wallet.add.optionDialog.walletEra.byronEra.description",defaultMessage:"!!!Wallets created before July 29th, 2020 are Byron-era wallets and cannot delegate."},sendButtonLabel:{id:"wallet.send.confirmationDialog.submit",defaultMessage:"!!!Send"},walletPasswordLabel:{id:"wallet.send.confirmationDialog.walletPasswordLabel",defaultMessage:"!!!Password"},walletPasswordFieldPlaceholder:{id:"wallet.send.confirmationDialog.walletPasswordFieldPlaceholder",defaultMessage:"!!!Type your password"},txGeneration:{id:"wallet.delegation.transaction.generation",defaultMessage:"!!!Generating transaction"},poolFetching:{id:"wallet.delegation.poolInfo.fetching",defaultMessage:"!!!Fetching pool information"},transactionId:{id:"wallet.transaction.transactionId",defaultMessage:"!!!Transaction ID"},epochLabel:{id:"global.labels.epoch",defaultMessage:"!!!Epoch"},stakepoolNameLabel:{id:"global.labels.stakepool",defaultMessage:"!!!Stakepool Name"},stakePoolChecksumAndName:{id:"global.labels.stakePoolChecksumAndName",defaultMessage:"!!!Stake pool checksum and name"},rewardsLabel:{id:"global.labels.rewardsLabel",defaultMessage:"!!!Rewards"},rewardsListLabel:{id:"global.labels.rewardsListLabel",defaultMessage:"!!!Rewards list"},totalTokenLabel:{id:"wallet.dashboard.summary.adaTitle",defaultMessage:"!!!Total {ticker}"},marginsLabel:{id:"wallet.dashboard.stakePool.margins",defaultMessage:"!!!Margins"},loadMoreButtonLabel:{id:"global.labels.loadMore",defaultMessage:"!!!Load more"},unknownPoolLabel:{id:"wallet.staking.pool.unknownLabel",defaultMessage:"!!!Unknown pool"},poolSize:{id:"wallet.staking.pool.size",defaultMessage:"!!!Pool size"},poolShare:{id:"wallet.staking.pool.share",defaultMessage:"!!!Share"},poolSaturation:{id:"wallet.staking.pool.saturation",defaultMessage:"!!!Saturation"},sidebarWallets:{id:"sidebar.wallets",defaultMessage:"!!!My wallets"},sidebarAssets:{id:"sidebar.assets",defaultMessage:"!!!Assets"},sidebarSettings:{id:"sidebar.settings",defaultMessage:"!!!Settings"},sidebarGovernance:{id:"sidebar.governance",defaultMessage:"!!!Governance"},sidebarTransfer:{id:"sidebar.transfer",defaultMessage:"!!!Claim or transfer wallet"},stakingDashboard:{id:"sidebar.stakingDashboard",defaultMessage:"!!!Staking Dashboard"},sidebarStaking:{id:"sidebar.staking",defaultMessage:"!!!Staking"},sidebarPortfolio:{id:"sidebar.portfolio",defaultMessage:"!!!Portfolio"},sidebarNfts:{id:"sidebar.nfts",defaultMessage:"!!!NFTs"},sidebarVoting:{id:"sidebar.voting",defaultMessage:"!!!Voting"},sidebarSwap:{id:"sidebar.swap",defaultMessage:"!!!Swap"},sidebarFaq:{id:"sidebar.faq",defaultMessage:"!!!Faq"},sidebarNewUpdates:{id:"sidebar.newUpdates",defaultMessage:"!!!New updates"},sidebarFeedback:{id:"sidebar.feedback",defaultMessage:"!!!Feedback"},ledgerTitle:{id:"wallet.add.optionDialog.connect.hw.ledger.title",defaultMessage:"!!!Ledger Hardware Wallet"},trezorTitle:{id:"wallet.add.optionDialog.connect.hw.trezor.title",defaultMessage:"!!!Trezor Hardware Wallet"},undelegateLabel:{id:"global.labael.undelegate",defaultMessage:"!!!Undelegate"},roa30d:{id:"wallet.staking.banner.roa30d",defaultMessage:"!!!ROA 30d"},roaHelperMessage:{id:"wallet.staking.banner.roaHelperMessage",defaultMessage:"!!!Estimated ROA (Return of ADA) based on staking result from the last 30 days"},stakePoolDelegated:{id:"wallet.dashboard.upcomingRewards.stakePoolDelegated",defaultMessage:"!!!Stake Pool Delegated"},totalDelegated:{id:"wallet.dashboard.summary.totalDelegated",defaultMessage:"!!!Total Delegated"},overview:{id:"wallet.staking.overview",defaultMessage:"!!!Overview"},rewardHistory:{id:"wallet.staking.rewards.rewardHistory",defaultMessage:"!!!Reward History"},rewardValue:{id:"wallet.staking.rewards.rewardValue",defaultMessage:"!!!Reward value"},openRewardHistory:{id:"wallet.staking.rewards.openRewardHistory",defaultMessage:"!!!Open Reward History"},epochProgress:{id:"wallet.staking.epochProgress",defaultMessage:"!!!Epoch Progress"},epochs:{id:"wallet.staking.epochsLabel",defaultMessage:"!!!Epochs"},tokens:{id:"wallet.assets.tokens",defaultMessage:"!!!Tokens"},fingerprint:{id:"wallet.assets.fingerprint",defaultMessage:"!!!Fingerprint"},auditAddressWarning:{id:"wallet.receive.page.internalWarning2",defaultMessage:"!!!addresses are shown here for personal auditing purposes and should never be used."},rewardAddressesTitle:{id:"wallet.receive.page.rewardAddressesTitle",defaultMessage:"!!!Reward addresses"},internalAddressesTitle:{id:"wallet.receive.page.internalAddressesTitle",defaultMessage:"!!!Internal addresses"},lastSyncMessage:{id:"myWallets.wallets.lastSyncText",defaultMessage:"!!!Last sync"},neverSyncedMessage:{id:"myWallets.wallets.neverSync",defaultMessage:"!!!Never synced"},createWalletLabel:{id:"wallet.add.page.create.title",defaultMessage:"!!!Create Wallet"},allLabel:{id:"wallet.receive.navigation.allLabel",defaultMessage:"!!!All"},noteLabel:{id:"global.labels.note",defaultMessage:"!!!Note:"},upgradeLabel:{id:"global.labels.upgrade",defaultMessage:"!!!Upgrade"},pendingTxWarning:{id:"wallet.staking.warning.pendingTx",defaultMessage:"!!!You cannot change your delegation preference while a transaction is pending"},stakePoolHash:{id:"wallet.delegation.transaction.stakePoolHash",defaultMessage:"!!!Stake pool id"},finalBalanceLabel:{id:"transfer.summary.finalBalance.label",defaultMessage:"!!!Final balance"},StakeDeregistration:{id:"wallet.transaction.certificate.StakeDeregistration",defaultMessage:"!!!Staking key deregistration"},withdrawalsLabel:{id:"wallet.transaction.withdrawalsLabel",defaultMessage:"!!!Withdrawals"},withdrawLabel:{id:"wallet.transaction.withdraw",defaultMessage:"!!!Withdraw"},byronLabel:{id:"wallet.receive.navigation.byronLabel",defaultMessage:"!!!Byron"},shelleyLabel:{id:"global.labels.shelleyLabel",defaultMessage:"!!!Shelley"},spendingKeyHashLabel:{id:"global.labels.spendingKeyHash",defaultMessage:"!!!Spending key hash"},stakingKeyHashLabel:{id:"global.labels.stakingKeyHash",defaultMessage:"!!!Staking key hash"},keyRegistrationPointer:{id:"global.labels.keyRegistrationPointer",defaultMessage:"!!!Key registration pointer"},support:{id:"settings.menu.support.link.label",defaultMessage:"!!!Support"},termsOfUse:{id:"settings.menu.termsOfUse.link.label",defaultMessage:"!!!Terms of use"},termsOfService:{id:"settings.menu.termsOfService.link.label",defaultMessage:"!!!Terms of Service Agreement"},fromAddresses:{id:"wallet.transaction.addresses.from",defaultMessage:"!!!From addresses"},toAddresses:{id:"wallet.transaction.addresses.to",defaultMessage:"!!!To addresses"},resyncButtonLabel:{id:"wallet.settings.resync.buttonLabel",defaultMessage:"!!!Resync wallet"},blogLinkWrapper:{id:"settings.support.faq.blogLinkWrapper",defaultMessage:"!!!blog post"},blogLearnMore:{id:"global.blog.learnMore",defaultMessage:"!!!You can read our {blogLink} to learn more."},keyLabel:{id:"global.key.label",defaultMessage:"!!!Key"},stepPin:{id:"wallet.voting.dialog.stepPin",defaultMessage:"!!!PIN"},stepConfirm:{id:"wallet.voting.dialog.stepConfirm",defaultMessage:"!!!Confirm"},registerLabel:{id:"wallet.voting.dialog.registerLabel",defaultMessage:"!!!Register"},transactionLabel:{id:"wallet.voting.dialog.transactionLabel",defaultMessage:"!!!Transaction"},stepQrCode:{id:"wallet.voting.dialog.stepQrCode",defaultMessage:"!!!QR Code"},votingRegistrationTitle:{id:"wallet.voting.dialog.title",defaultMessage:"!!!Register for Voting"},confirmPin:{id:"wallet.voting.dialog.confirmPin",defaultMessage:"!!!Confirm PIN"},pinDoesNotMatch:{id:"global.errors.pinDoesNotMatch",defaultMessage:"!!!PIN codes do not match. Please retype."},invalidPin:{id:"global.errors.invalidPin",defaultMessage:"!!!Invalid PIN. Please retype."},buyAda:{id:"button.buyAda",defaultMessage:"!!!Buy ADA"},sellAda:{id:"button.sellAda",defaultMessage:"!!!Sell ADA"},buySellAda:{id:"button.buySellAda",defaultMessage:"!!!Buy/Sell ADA"},txConfirmationLedgerNanoLine2:{id:"wallet.send.ledger.confirmationDialog.info.line.2",defaultMessage:"!!!Make sure Cardano ADA app must remain open on the Ledger device throughout the process."},txConfirmationTrezorTLine2:{id:"wallet.send.trezor.confirmationDialog.info.line.2",defaultMessage:"!!!A new tab will appear. Please follow the instructions in the new tab."},syncing:{id:"wallet.syncing",defaultMessage:"!!!Syncing..."},loading:{id:"wallet.loading",defaultMessage:"!!!Loading..."},confirmOnLedger:{id:"label.confirm.ledger",defaultMessage:"!!!Confirm on Ledger"},confirmOnTrezor:{id:"label.confirm.trezor",defaultMessage:"!!!Confirm on Trezor"},tosAgreement:{id:"profile.languageSelect.tosAgreement",defaultMessage:'!!!I agree with <span id="tosLink">Terms of Service Agreement</span> and <span id="privacyLink">Privacy Notice</span>'},poolNotGenerating:{id:"wallet.transitionDialog.poolNotGenerating",defaultMessage:"!!!This pool is NOT generating staking rewards anymore"},goToTransactions:{id:"wallet.transaction.success.button.label",defaultMessage:"!!!Go To Transactions"},provider:{id:"buysell.dialog.provider",defaultMessage:"!!!Provider"}});(0,n.defineMessages)({memoLabel:{id:"global.labels.memo",defaultMessage:"!!!Memo"},addMemo:{id:"global.labels.addMemo",defaultMessage:"!!!Add memo"},editMemo:{id:"global.labels.editMemo",defaultMessage:"!!!Edit memo"},deleteMemo:{id:"global.labels.deleteMemo",defaultMessage:"!!!Delete memo"},optionalMemo:{id:"global.labels.optionalMemo",defaultMessage:"!!!Memo (optional)"},memoWarning:{id:"wallet.send.form.memoWarning",defaultMessage:"!!!(Optional) Memo is stored locally"}}),(0,n.defineMessages)({connectedWebsites:{id:"global.connector.connectedWebsites",defaultMessage:"!!!Connected Websites"},messageReadOnly:{id:"global.connector.messageReadOnly",defaultMessage:"!!!We are granting read-only to view utxos/addresses."},about:{id:"connector.settings.about",defaultMessage:"!!!About"},signTransaction:{id:"connector.settings.signTransaction",defaultMessage:"!!!Sign transaction"},signData:{id:"connector.signin.signData",defaultMessage:"!!!Sign data"},connect:{id:"connector.settings.connect",defaultMessage:"!!!Connect"},dappConnector:{id:"connector.appName",defaultMessage:"!!!Dapp Connector"},connector:{id:"connector.appNameShort",defaultMessage:"!!!Connector"},yourAddresses:{id:"connector.yourAddresses",defaultMessage:"!!!Your Addresses"},foreignAddresses:{id:"connector.foreignAddresses",defaultMessage:"!!!Foreign Addresses"},fromWallet:{id:"connector.fromWallet",defaultMessage:"!!!From wallet"},fromAddresses:{id:"connector.from",defaultMessage:"!!!From (Inputs): {qty}"},toAddresses:{id:"connector.to",defaultMessage:"!!!To (Outputs): {qty}"},send:{id:"wallet.navigation.send",defaultMessage:"!!!Send"},receive:{id:"wallet.navigation.receive",defaultMessage:"!!!Receive"},assetsSent:{id:"connector.assetsSent",defaultMessage:"!!!{quantity} assets sent"},assetsReceived:{id:"connector.assetsReceived",defaultMessage:"!!!{quantity} assets received"},assetSent:{id:"connector.assetSent",defaultMessage:"!!!{assetName} sent"},assetReceived:{id:"connector.assetReceived",defaultMessage:"!!!{assetName} received"},noAssetsSent:{id:"connector.noAssetsSent",defaultMessage:"!!!No assets sent"},noAssetsReceived:{id:"connector.noAssetsReceived",defaultMessage:"!!!No assets received"}})},5227:(e,t,a)=>{},45918:(e,t,a)=>{a.d(t,{WH:()=>u}),a(94473),a(89400);var n=a(20116),r=a.n(n),s=a(41274),o=a(3577),i=(a(95667),a(16885));a(5227),a(39329),a(84174);const l=[];function d(e){return l.push(e),e}const c=[i.DN.None,i.DN.Unused,i.DN.Used,i.DN.HasBalance];async function u(e){const t=(0,o.sX)(e);if(t)return(await t.nextInternal()).addressInfo;const a=(0,o.se)(e);if(a){const e=await a.getAllUtxoAddresses(),t=(0,o.h5)(a);if(t)return t.pickReceive(e[0]);const n=e[0];return{addr:n.addrs[0],row:n.row,addressing:n.addressing}}}d({isRelated:()=>!1,class:s.kh,validFilters:c,name:{subgroup:i.CW.all,group:i.m2.byron},isHidden:e=>!1}),d({isRelated:()=>!1,class:s.T2,validFilters:c,name:{subgroup:i.CW.external,group:i.m2.byron},isHidden:e=>!1}),d({isRelated:()=>!1,class:s.z3,validFilters:c,name:{subgroup:i.CW.internal,group:i.m2.byron},isHidden:e=>!1}),d({isRelated:()=>!0,class:s.IJ,validFilters:c,name:{subgroup:i.CW.external,group:i.m2.base},isHidden:e=>!1}),d({isRelated:()=>!0,class:s.Wx,validFilters:c,name:{subgroup:i.CW.internal,group:i.m2.base},isHidden:e=>!1}),d({isRelated:()=>!0,class:s.zq,validFilters:c,name:{subgroup:i.CW.mangled,group:i.m2.base},isHidden:e=>null==e.result||0===e.result.length}),d({isRelated:()=>!0,class:s._4,validFilters:c,name:{subgroup:i.CW.external,group:i.m2.enterprise},isHidden:e=>{var t;return null==e.result||0===r()(t=e.result).call(t,(e=>e.isUsed)).length}}),d({isRelated:()=>!0,class:s.gO,validFilters:c,name:{subgroup:i.CW.internal,group:i.m2.enterprise},isHidden:e=>{var t;return null==e.result||0===r()(t=e.result).call(t,(e=>e.isUsed)).length}}),d({isRelated:()=>!0,class:s.xP,validFilters:[i.DN.None],name:{subgroup:i.CW.all,group:i.m2.reward},isHidden:e=>null==e.result||0===e.result.length}),d({isRelated:()=>!0,class:s.JV,validFilters:[i.DN.None],name:{subgroup:i.CW.all,group:i.m2.addressBook},isHidden:e=>!1})},28336:(e,t,a)=>{function n(e){return e.isInteger()?e.toFixed(1):e.toString()}a.d(t,{formatBigNumberToFloatString:()=>n}),a(39291),a(3649),a(905)},13469:(e,t,a)=>{a.d(t,{Yd:()=>h,WO:()=>f,n:()=>w,uh:()=>y});var n=a(48604),r=a.n(n),s=a(59340),o=a.n(s),i=a(30381),l=a.n(i),d=a(89539);a(85412);const c=console,{logsBufferSize:u,logsFileSuffix:p}={walletRefreshInterval:3e4,serverStatusRefreshInterval:2e4,logsBufferSize:500,logsFileSuffix:"-yoroi.log",addressRequestSize:50,txsBodiesRequestSize:150,coinPriceRefreshInterval:6e4,coinPriceFreshnessThreshold:9e5,pubKeyData:"0e011fe7149bff8e3802168261aec6da54febee37da6a41d6179fa545868421e",pubKeyMaster:"ab9e4f1c4d996a0e9cdda8546bf5ee1dd8397fd7ab287c331ff171c7e4e0e9e2"},g=[],h={debug:(...e)=>{c.debug(...e)},info:(...e)=>{c.info(...e)},error:e=>{const t=e.replace(/\\n/g,"\n");var a;c.error(t),a=`[${l()().format()}] ${t}\n`,g.push(a),g.length>u&&g.shift()},warn:(...e)=>{c.warn(...e)}},f=e=>(0,d.inspect)(e),w=e=>o()(e,r()(e),2),y=e=>o()(e,null,2)},39329:(e,t,a)=>{a(86902),a(78914),a(41511),a(29828)},61346:(e,t,a)=>{a.d(t,{sz:()=>i});var n=a(11128),r=a.n(n),s=a(56474),o=a.n(s);a(74119);const i=o()({Primary:"openTabId",YoroiConnector:"openTabId-YoroiConnector"});r()().toString()},90578:(e,t,a)=>{a.d(t,{xh:()=>_,FC:()=>I,ud:()=>A});var n=a(80426),r=a.n(n),s=a(26295),o=a.n(s),i=a(2991),l=a.n(i),d=a(20116),c=a.n(d),u=a(39392),p=a.n(u),g=a(11128),h=a.n(g),f=a(31581),w=a.n(f),y=a(41058),m=a(79562),b=a(34147),v=a(42746),x=a(37872);function _(){I("poll"),w()((()=>{I("poll")}),6e4)}const T="ADA";let k=null;function I(e){(async t=>{const a=new m.ZP;if(!(await a.getUnitOfAccount()).enabled)return;if("poll"===e&&0===(0,b.tJ)().length)return;const n=await(0,y.C)();if(h()()-((null===(t=k)||void 0===t?void 0:t.timestamp)||0)>3e4){const e=T;try{const t=await n.getCurrentCoinPrice({from:e});null!=t.error&&console.error("coin price backend error: "+t.error),k=t.ticker}catch(t){console.error("error when fetching price data for %s: %s",e,t)}}(0,b.aR)({type:"coin-price-update",params:{ticker:k}})})().catch((e=>{console.error("error when refreshing current coin price",e)}))}async function A(e){var t,a;const n=new(p()),s=await(0,x.zA)(),i=await(0,v.ug)({db:s});if(null==i)throw new Error("Should never happen");for(const e of i){const t=e.Time.valueOf(),a=n.get(t);a?a.push(e):n.set(t,[e])}const d="TADA"===e.from?"ADA":e.from,u=c()(t=e.timestamps).call(t,(e=>null==n.get(e)));if(u.length){const e=await(0,y.C)(),t=await e.getHistoricalCoinPrice({from:d,timestamps:u});if(null!=t.error)throw new Error("historical coin price query error: "+t.error);if(t.tickers.length!==u.length)throw new Error("historical coin price query error: data length mismatch");for(let e=0;e<u.length;e++){var g;const a=t.tickers[e];if(null==a)continue;const r=l()(g=o()(a.prices)).call(g,(([a,n])=>({From:t.tickers[e].from,To:a,Price:n}))),i=await(0,v.Gs)({db:s,prices:l()(r).call(r,(t=>({...t,Time:new Date(u[e])})))});for(const e of i){const t=e.Time.valueOf(),a=n.get(t);a?a.push(e):n.set(t,[e])}}}return r()(a=e.timestamps).call(a,(e=>n.get(e)||[]))}},58905:(e,t,a)=>{a.d(t,{Y7:()=>v,AO:()=>x,jF:()=>_,h3:()=>T,dl:()=>k,I2:()=>I,$z:()=>A,_T:()=>M,N_:()=>S});var n,r=a(20116),s=a.n(r),o=a(94473),i=a.n(o),l=a(93476),d=a.n(l),c=(a(38441),a(79562)),u=a(13469),p=a(18689),g=a(4158),h=a(37872);const f="background-",w=chrome.storage.session||(null===(n=window.browser)||void 0===n?void 0:n.storage.local)||chrome.storage.local;async function y(e,t){await w.set({[f+e]:t})}async function m(e){const t=f+e;return new(d())((e=>{w.get(t,(a=>{e(void 0===a?void 0:a[t])}))}))}const b="connectedSites";async function v(){return await m(b)||{}}async function x(e){const t=await m(b);return t?t[String(e)]:null}async function _(e){const t=await m(b)||{};delete t[String(e)],await y(b,t)}async function T(e,t){const a=await m(b)||{};a[String(e)]=t,await y(b,a)}function k(e,t,a,n){"cardano-connect-request"===e&&(0,p.B9)(n,{type:"yoroi_connect_response/cardano",success:null!=t,auth:a})}function I(e,t){(0,p.B9)(e,{type:"yoroi_connect_response/cardano",success:!1,err:(0,u.n)(t)})}async function A(e,t,a){var n;const r=Boolean(t),s=r?e:void 0,o=null!==(n=await a.getWhitelist())&&void 0!==n?n:[];return i()(o).call(o,(t=>{const a=t.url===e,n=t.appAuthID===s,o=null!=t.appAuthID;return a&&(!r||o&&n)}))}async function M(e,t){var a,n;const r=await(0,h.zA)(),o=await(0,g.MX)({db:r}),l=await x(e);if(!l)throw new Error(`could not find tabId ${e} in connected sites`);if("number"!=typeof(null===(a=l.status)||void 0===a?void 0:a.publicDeriverId))throw new Error("site not connected yet");const{publicDeriverId:d}=null!==(n=null==l?void 0:l.status)&&void 0!==n?n:{},u=i()(o).call(o,(e=>e.getPublicDeriverId()===d));if(null==u)throw await _(e),await async function(e,t,a){await _(e);const n=await a.getWhitelist();await a.setWhitelist(null==n?void 0:s()(n).call(n,(e=>e.publicDeriverId!==t)))}(e,d,new c.ZP),new Error(`Public deriver index not found: ${String(d)}`);return t&&await(0,h.UA)(u,"connector-call"),u}async function S(e,t,a){const n=new c.ZP;try{await async function(e,t,a,n,r){const{url:s,requestIdentification:o,onlySilent:i}=a,l=Boolean(o),c=l?s:void 0,[u,g]=await d().all([(0,p.al)(t),A(s,o,n)]);if(null!=g)return null==await x(t)&&await T(t,{url:s,imgBase64Url:r,appAuthID:c,status:{publicDeriverId:g.publicDeriverId,auth:l?g.auth:void 0},pendingSigns:{}}),void k(e,g.publicDeriverId,l?g.auth:void 0,t);if(!0===Boolean(i))throw new Error("[onlySilent:fail] No active connection");await T(t,{url:s,imgBase64Url:r,appAuthID:c,status:{requestType:e,openedWindow:!1,publicDeriverId:null,auth:null},pendingSigns:{}}),chrome.windows.create({...p.wk,url:chrome.runtime.getURL("main_window_connector.html"),left:u.width+u.positionX-p.wk.width,top:u.positionY+80})}("cardano-connect-request",e,t,n,a)}catch(t){I(e,t)}}},18689:(e,t,a)=>{a.d(t,{B9:()=>s,al:()=>i,wk:()=>l});var n=a(93476),r=a.n(n);function s(e,t){chrome.tabs.sendMessage(e,t)}async function o(){let e;return e=null!=window.screen?window.screen.availWidth:(await chrome.system.display.getInfo())[0].bounds.width,{width:e,positionX:0,positionY:0}}function i(e){return new(r())((t=>{chrome.tabs.get(e,(e=>{if(null==e)return t(o());chrome.windows.get(e.windowId,(e=>{if(null==e)return t(o());t(async function(e){var t,a,n;const r=await o();return{width:null!==(t=e.width)&&void 0!==t?t:r.width,positionX:null!==(a=e.left)&&void 0!==a?a:r.positionX,positionY:null!==(n=e.top)&&void 0!==n?n:r.positionY}}(e))}))}))}))}const l={width:500,height:700,focused:!0,type:"popup"}},49369:(e,t,a)=>{var n=a(59340),r=a.n(n),s=a(23279),o=a.n(s),i=a(20116),l=a.n(i),d=a(94198),c=a.n(d),u=a(51942),p=a.n(u),g=a(32366),h=a.n(g),f=a(2991),w=a.n(f),y=a(56474),m=a.n(y),b=(a(38441),a(79562)),v=a(86335),x=a(13469),_=a(21131),T=a(63371),k=a(41058),I=a(60274),A=a(10062),M=a.n(A),S=a(41511),R=a.n(S),D=a(66419),C=a.n(D),P=a(94473),W=a.n(P),E=a(90649);function N(e,t,a){var n,r,s,o,i,l;if(!a)return null;const d=W()(a).call(a,(e=>null!=e[721]));if(void 0===d)return null;const c=d[721],u=w()(n=C()((0,E.hexToBytes)(t))).call(n,(e=>String.fromCharCode(e))).join(""),p=(null===(r=c[e])||void 0===r?void 0:r[u])||(null===(s=c[e])||void 0===s?void 0:s[t]);if(!p)return null;const g={};return"string"==typeof p.name?g.name=p.name:g.name="",("string"==typeof p.image||R()(p.image)&&M()(o=p.image).call(o,(e=>"string"==typeof e)))&&(g.image=p.image),"string"==typeof p.mediaType&&(g.mediaType=p.mediaType),("string"==typeof p.description||R()(p.description)&&M()(i=p.description).call(i,(e=>"string"==typeof e)))&&(g.description=p.description),R()(p.files)&&M()(l=p.files).call(l,(({name:e,mediaType:t,src:a})=>"string"==typeof e&&"string"==typeof t&&("string"==typeof a||R()(a)&&M()(a).call(a,(e=>"string"==typeof e)))))&&(g.files=p.files),"string"==typeof p.author&&(g.author=p.author),"string"==typeof p.authors&&(g.author=p.authors),g}var B=a(43577),L=a(24558),H=a(84174),U=a(18689),V=a(3577),O=a(27649),F=a(58905),K=a(72499);async function G(e,t,a,n,r){const s=await(0,U.al)(e);a.pendingSigns[String(t.uid)]={request:t,openedWindow:!1,continuationData:n,uid:r},await(0,F.h3)(e,a),chrome.windows.create({...U.wk,url:chrome.runtime.getURL("/main_window_connector.html#/signin-transaction"),left:s.width+s.positionX-U.wk.width,top:s.positionY+80})}class Y{static basic(e){return{needConnectedWallet:!1,handle:e}}static withWallet(e){return{needConnectedWallet:!0,syncConnectedWallet:!1,handle:e}}static withSyncedWallet(e){return{needConnectedWallet:!0,syncConnectedWallet:!0,handle:e}}}const q=Y.withSyncedWallet((async({message:e,wallet:t,tabId:a})=>{const n=e.params[0],r=e.params[1],s=await(0,F.AO)(a);if(null==s)return void x.Yd.error(`ERR - sign_data could not find connection with tabId = ${a}`);let o;try{o=v.RustModule.WalletV4.Address.from_bech32(n).to_hex()}catch{o=n}if(!await(0,I.Zy)(t,o))return{err:{code:T.y.DATA_SIGN_ADDRESS_NOT_PK,info:"address not found"}};await G(a,{type:"data",address:o,payload:r,uid:e.uid},s,{type:"cardano-data",address:o,payload:r},e.uid)})),z=m()({"is_enabled/cardano":Y.basic((async({message:e,tabId:t})=>{try{return{ok:null!=await(0,F.$z)(e.url,!1,new b.ZP)}}catch(e){(0,F.I2)(t,e)}})),"sign_tx/cardano":Y.basic((async({message:e,tabId:t})=>{const a=await(0,F.AO)(t);if(null==a)return void x.Yd.error(`ERR - sign_tx could not find connection with tabId = ${t}`);const{tx:n,partialSign:r,returnTx:s}=e.params[0];await G(t,{type:"tx/cardano",tx:{tx:n,partialSign:r,tabId:t},uid:e.uid},a,{type:"cardano-tx",returnTx:s,tx:n},e.uid)})),sign_data:q,cip95_sign_data:q,get_balance:Y.withSyncedWallet((async({message:e,wallet:t})=>{const a=(0,T.oz)(e.params[0]),n=await(0,B.Yb)(t,a);if("cbor"===e.returnType&&"*"===a&&"string"!=typeof n){const e=v.RustModule.WalletV4,t=e.Value.new(e.BigNum.from_str(n.default));if(n.assets.length>0){var r;const e=w()(r=n.assets).call(r,(e=>{const[t,a]=e.identifier.split(".");return{amount:e.amount,assetId:e.identifier,policyId:t,name:a}}));t.set_multiasset((0,B.RL)(e))}const a=t.to_hex();return t.free(),{ok:a}}return{ok:n}})),"get_utxos/cardano":Y.withSyncedWallet((async({wallet:e,message:t})=>{var a;const n=null==t.params[0]?null:(0,T.Wf)(t.params[0]),r=null==t.params[1]?null:(0,T.Ct)(t.params[1]),s=e.getParent().getNetworkInfo(),o=h()(a=(0,H.getCardanoHaskellBaseConfig)(s)).call(a,((e,t)=>p()(e,t)),{}),i=v.RustModule.WalletV4.BigNum.from_str(o.CoinsPerUtxoWord);try{const a=await(0,B.Mk)(await(0,B.b7)(e,n,r,i),"cbor"===t.returnType);return i.free(),{ok:a}}catch(e){return e instanceof _.r7?{ok:null}:{err:e.message}}})),get_used_addresses:Y.withWallet((async({wallet:e,message:t})=>{const a=null==t.params[0]?null:(0,T.Ct)(t.params[0]),n=await(0,B.sL)(e,a);return"cbor"===t.returnType?{ok:n}:{ok:await $(n)}})),get_unused_addresses:Y.withWallet((async({wallet:e,message:t})=>{const a=await(0,B.D0)(e);return"cbor"===t.returnType?{ok:a}:{ok:await $(a)}})),"get_reward_addresses/cardano":Y.withWallet((async({wallet:e,message:t})=>{const a=await(0,B.Fx)(e);return"cbor"===t.returnType?{ok:a}:{ok:await $(a)}})),get_drep_key:Y.withWallet((async({wallet:e})=>({ok:await(0,B.cQ)(e)}))),get_stake_key:Y.withWallet((async({wallet:e})=>{const t=await(0,k.s)(new b.ZP);return{ok:await(0,B.YZ)(e,t.getAccountState)}})),get_change_address:Y.withWallet((async({wallet:e,message:t})=>{const a=await(0,B.O)(e);return"cbor"===t.returnType?{ok:a}:{ok:(await $([a]))[0]}})),submit_tx:Y.withWallet((async({wallet:e,message:t})=>{const a=t.params[0],n=(0,E.hexToBytes)(a);await(0,B.gf)(e,n,new b.ZP);const r=v.RustModule.WalletV4.Transaction.from_bytes(n),s=v.RustModule.WalletV4.FixedTransaction.from_hex(a).transaction_hash().to_hex();try{await(0,B.xC)(e,r)}catch(e){console.error("error recording submitted tx",e)}return r.free(),{ok:s}})),ping:Y.basic((async()=>({ok:!0}))),"create_tx/cardano":Y.withWallet((async({wallet:e,message:t,tabId:a})=>{if(null==await(0,F.AO)(a))return void x.Yd.error(`ERR - sign_tx could not find connection with tabId = ${a}`);const n=await(0,k.s)(new b.ZP),r=e.getParent().getNetworkInfo(),s=(new I.ZP).createForeignUtxoFetcher(n,r);return{ok:await(0,B.SW)(e,null,t.params[0],s,await(0,K.xZ)(e.getParent().getNetworkInfo().NetworkId))}})),get_network_id:Y.withWallet((async({wallet:e,tabId:t})=>{if(null==await(0,F.AO)(t))return void x.Yd.error(`ERR - get_network_id could not find connection with tabId = ${t}`);const a=e.getParent().getNetworkInfo().BaseConfig[0].ChainNetworkId;return{ok:c()(a,10)}})),"list_nfts/cardano":Y.withSyncedWallet((async({wallet:e})=>{const t=await(0,B.$g)(e),a=l()(t).call(t,(e=>"1"===e.amount)),n=w()(a).call(a,(e=>e.identifier)),r=await(0,B.NJ)(n,e),s={};for(const e of r){if(!e.IsNFT)continue;if("Cardano"!==e.Metadata.type)throw new Error("this API only supports Cardano");const t=N(e.Metadata.policyId,e.Metadata.assetName,e.Metadata.assetMintMetadata);t&&(s[e.Identifier]={metadata:t})}return{ok:s}})),"auth_sign_hex_payload/cardano":Y.basic((async({tabId:e,message:t})=>{var a;const n=await(0,F.AO)(e),r=null==n||null===(a=n.status)||void 0===a?void 0:a.auth;return r?{ok:await(0,L.qN)({privKey:r.privkey,payloadHex:t.params[0]})}:{err:"auth_sign_hex_payload is requested but no auth is present in the connection!"}})),"auth_check_hex_payload/cardano":Y.basic((async({tabId:e,message:t})=>{var a,n,r,s;const o=await(0,F.AO)(e);if(!o)throw new Error(`could not find tabId ${e} in connected sites`);if("number"!=typeof(null===(a=o.status)||void 0===a?void 0:a.publicDeriverId))throw new Error("site not connected yet");if(null==o||null===(n=o.status)||void 0===n||!n.auth)return{err:"auth_check_hex_payload is requested but no auth is present in the connection!"};const[i,l]=t.params,d=v.RustModule.WalletV4.PublicKey.from_hex(String(null===(r=o.status)||void 0===r||null===(s=r.auth)||void 0===s?void 0:s.pubkey)),c=v.RustModule.WalletV4.Ed25519Signature.from_hex(l),u=d.verify((0,E.hexToBytes)(i),c);return d.free(),{ok:u}})),get_collateral_utxos:Y.withSyncedWallet((async({wallet:e,tabId:t,message:a})=>{const n=a.params[0],r=!!n;let s=n||String(B.t3);if(!/^\d+$/.test(s))try{s=v.RustModule.WalletV4.Value.from_hex(s).coin().to_str()}catch{return{err:{code:T.np.API_INVALID_REQUEST,info:"failed to parse the required collateral amount"}}}const o=(0,V.se)(e);if(null==o)throw new Error("wallet doesn't support IGetAllUtxos");const i=await o.getAllUtxos(),l=(0,O.ue)(i),d=await(0,b._W)()||[],{utxosToUse:c,reorgTargetAmount:u}=await(0,B.gZ)(e,s,w()(l).call(l,(e=>{const{addressing:t,...a}=e;return a})),d),p=null==u,g=c.length>0;if(p||g&&!r)return{ok:await(0,B.Mk)(c,"cbor"===a.returnType)};if(null!=u){const n=w()(c).call(c,(e=>e.utxo_id));try{const t=new I.ZP;await t.createReorgTx(e,n,s,l,d,await(0,K.xZ)(e.getParent().getNetworkInfo().NetworkId))}catch(e){if(e instanceof _.r7)return{err:{code:T.np.API_INTERNAL_ERROR,info:"not enough UTXOs"}};throw e}const r=await(0,F.AO)(t);if(null==r)throw new Error(`ERR - get_collateral_utxos could not find connection with tabId = ${t}`);await G(t,{type:"tx-reorg/cardano",tx:{usedUtxoIds:n,reorgTargetAmount:s,utxos:i},uid:a.uid},r,{type:"cardano-reorg-tx",utxosToUse:c,isCBOR:"cbor"===a.returnType},a.uid)}}))});function Z(e,t,a){(0,U.B9)(t,{type:"connector_rpc_response",uid:a,return:e,protocol:"cardano"})}async function $(e){return w()(e).call(e,(e=>{const t=v.RustModule.WalletV4.Address.from_hex(e),a=t.to_bech32();return t.free(),a}))}var j=a(62198),J=a(23307),X=a(37872);const Q=m()({typeTag:"upsert-tx-memo",handle:async e=>{const t=await(0,X.zA)();return await(0,J.dj)({db:t,memo:ae(e.memo)})}}),ee=m()({typeTag:"delete-tx-memo",handle:async e=>{const t=await(0,X.zA)();await(0,J.Oy)({db:t,key:e.key})}}),te=m()({typeTag:"get-all-tx-memos",handle:async()=>{const e=await(0,X.zA)();return await(0,J.jM)({db:e})},fixMemoDate:ae});function ae(e){return e.LastUpdated=new Date(e.LastUpdated),e}var ne=a(3649),re=a.n(ne),se=a(11128),oe=a.n(se),ie=a(34147),le=a(10108),de=a(12565),ce=a(21233),ue=a(19008),pe=a(4922);a(14986);const ge=m()({typeTag:"create-wallet",handle:async e=>{await v.RustModule.load();const t=await(0,X.zA)(),a=(0,H.getNetworkById)(e.networkId),n=new I.ZP,{publicDerivers:r}=await n.createWallet({db:t,network:a,recoveryPhrase:e.recoveryPhrase,walletName:e.walletName,walletPassword:e.walletPassword,accountIndex:e.accountIndex});return(0,ie.aR)({type:"wallet-state-update",params:{eventType:"new",publicDeriverId:r[0].getPublicDeriverId()}}),(0,X.UA)(r[0],"new wallet",1),await(0,le._)(r[0])}}),he=m()({typeTag:"create-hardware-wallet",handle:async e=>{await v.RustModule.load();const t=await(0,X.zA)(),a=await(0,k.s)(new b.ZP),n=new I.ZP,{publicDeriver:r}=await n.createHardwareWallet({db:t,network:e.network,walletName:e.walletName,publicKey:e.publicKey,hwFeatures:e.hwFeatures,checkAddressesInUse:a.checkAddressesInUse,addressing:e.addressing});return(0,ie.aR)({type:"wallet-state-update",params:{eventType:"new",publicDeriverId:r.getPublicDeriverId()}}),(0,X.UA)(r,"new wallet",1),await(0,le._)(r)}}),fe=m()({typeTag:"remove-wallet",handle:async e=>{const t=await(0,de.A)(e.publicDeriverId);await(0,ce.q)({publicDeriver:t,conceptualWallet:t.getParent()}),(0,ie.aR)({type:"wallet-state-update",params:{eventType:"remove",publicDeriverId:e.publicDeriverId}})}}),we=m()({typeTag:"rename-public-deriver",handle:async e=>{const t=await(0,de.A)(e.publicDeriverId);await t.rename({newName:e.newName})}}),ye=m()({typeTag:"rename-conceptual-wallet",handle:async e=>{const t=await(0,X.zA)();for(const a of await(0,ue.M)(t))a.getParent().getConceptualWalletId()===e.conceptualWalletId&&await a.getParent().rename({newName:e.newName})}}),me=m()({typeTag:"get-wallets",handle:async e=>await(0,le.k)(e.walletId)}),be=m()({typeTag:"resync-wallet",handle:async e=>{const t=await(0,de.A)(e.publicDeriverId);await(0,X.UA)(t,"UI resync"),await(0,K.sI)(t.getParent().getNetworkInfo().NetworkId)}}),ve=m()({typeTag:"change-signing-password",handle:async e=>{const t=await(0,de.A)(e.publicDeriverId),a=(0,V.y9)(t);if(null==a)throw new Error("unexpected missing asGetSigningKey result");const n=new Date(oe()());await a.changeSigningKeyPassword({currentTime:n,oldPassword:e.oldPassword,newPassword:e.newPassword})}}),xe=m()({typeTag:"get-private-staking-key",handle:async e=>{const t=await(0,de.A)(e.publicDeriverId),a=(0,V.y9)(t);if(null==a)throw new Error("unexpected missing asGetSigningKey result");const n=(0,V.Oq)(a);if(null==n)throw new Error("unexpected missing asGetAllAcccounting result");try{return(await(0,I.oN)({publicDeriver:n,password:e.password})).to_hex()}catch(e){return{error:e.message}}}}),_e=m()({typeTag:"remove-all-transactions",handle:async e=>{const t=await(0,de.A)(e.publicDeriverId),a=(0,V.JM)(t);if(!a)throw new Error("unexpected missing asHasLevels result");await(0,pe.ew)({publicDeriver:a});const n=await(0,b._W)();if(!n)return;const r=l()(n).call(n,(({publicDeriverId:t})=>t!==e.publicDeriverId));await(0,b.dF)(r)}}),Te=m()({typeTag:"pop-address",handle:async e=>{const t=await(0,de.A)(e.publicDeriverId),a=(0,V.Bq)(t);if(null==a)throw new Error("unexpected missing asDisplayCutoff result");await a.popAddress()}}),ke=m()({typeTag:"refresh-transactions",handle:async e=>{const t=await(0,de.A)(e.publicDeriverId),a=(0,V.JM)(t);if(!a)throw new Error("unexpected missing asHasLevels result");const n=await(0,k.s)(new b.ZP),s=new I.ZP,o={publicDeriver:a,isLocalRequest:!0,getRecentTransactionHashes:n.getRecentTransactionHashes,getTransactionsByHashes:n.getTransactionsByHashes,checkAddressesInUse:n.checkAddressesInUse,getBestBlock:n.getBestBlock,getTokenInfo:n.getTokenInfo,getMultiAssetMetadata:n.getMultiAssetMintMetadata,getMultiAssetSupply:n.getMultiAssetSupply,getTransactionHistory:n.getTransactionsHistoryForAddresses};let i;if("number"==typeof e.skip&&e.limit&&e.beforeTx){const{skip:t,limit:a,beforeTx:n}=e;o.skip=t,o.limit=a;const r=await s.refreshTransactions(o);if(r.length===a)i=r;else{o.beforeTx=r.length?r[r.length-1]:n,o.isLocalRequest=!1;const e=await s.refreshTransactions(o);i=[...r,...re()(e).call(e,0,a-r.length)]}}else i=await s.refreshTransactions(o);return r()(i)}});var Ie=a(72119),Ae=a.n(Ie),Me=a(59927);const Se=m()({typeTag:"get-all-explorers",handle:async()=>{const e=await(0,X.zA)(),t=await(0,Me.o2)({db:e});return[...Ae()(t).call(t)]}}),Re=m()({typeTag:"get-selected-explorer",handle:async()=>{const e=await(0,X.zA)(),t=await(0,Me.Gb)({db:e});return[...Ae()(t).call(t)]}}),De=m()({typeTag:"save-selected-explorer",handle:async e=>{const t=await(0,X.zA)();return await(0,Me.Qy)({db:t,explorer:e.explorer})}});var Ce=a(36384),Pe=a.n(Ce),We=a(78580),Ee=a.n(We),Ne=a(75723);const Be=m()({typeTag:"sign-transaction",handle:async e=>{const{publicDeriverId:t,password:a,transactionHex:n}=e,r=await(0,de.A)(t);try{const e=await(0,B.nH)(r,a,{tx:n,tabId:-1,partialSign:!1}),t=(0,O.b9)((0,Ne.transactionHexToWitnessSet)(n),e);return(0,Ne.transactionHexReplaceWitnessSet)(n,t)}catch(e){return{error:e.message}}}}),Le=m()({typeTag:"sign-and-broadcast-transaction",handle:async e=>v.RustModule.WasmScope((async t=>{const a=await(0,de.A)(e.publicDeriverId),{senderUtxos:n,unsignedTx:r,metadata:s,wits:o,neededHashes:i,txHash:l}=e;try{const d=(0,V.y9)(a);if(null==d)throw new Error("unexpected missing asGetSigningKey result");if(i.length-o.length>=2)throw new Error("Too many missing witnesses");if(i.length!==o.length){const a=(0,V.Oq)(d);if(null==a)throw new Error("unexpected missing asGetAllAcccounting result");const n=await(0,I.oN)({publicDeriver:a,password:e.password});if(!Ee()(i).call(i,t.WalletV4.Credential.from_keyhash(n.to_public().hash()).to_hex()))throw new Error("missing witness but it was not ours");o.push(t.WalletV4.make_vkey_witness(t.WalletV4.TransactionHash.from_hex(l),n).to_hex())}const c=v.RustModule.WalletV4.Transaction.from_hex(r),u={senderUtxos:n,unsignedTx:c,metadata:s?t.WalletV4.AuxiliaryData.from_hex(s):void 0,neededStakingKeyHashes:{wits:new(Pe())(o)}},p=await(0,k.s)(new b.ZP),g=new I.ZP,{txId:h,signedTxHex:f}=await g.signAndBroadcast({publicDeriver:d,password:e.password,signRequest:u,sendTx:p.sendTx});c.free();try{await(0,B.xC)(a,t.WalletV4.Transaction.from_hex(f))}catch(e){}return Ue(e.publicDeriverId),{txId:h}}catch(e){return{error:e.message}}}))}),He=m()({typeTag:"broadcast-transaction",handle:async e=>{const t=await(0,de.A)(e.publicDeriverId);let a,n;if(e.signedTxHexArray){var r;a=w()(r=e.signedTxHexArray).call(r,(e=>({id:(0,Ne.transactionHexToHash)(e),encodedTx:(0,E.hexToBytes)(e)}))),n=[]}else{const{signedTxHex:t,addressedUtxos:r}=e;if("string"!=typeof t)throw new Error("unexpected missing `signedTxHex` in request");a=[{id:(0,Ne.transactionHexToHash)(t),encodedTx:(0,E.hexToBytes)(t)}],n=[r]}const s=await(0,k.s)(new b.ZP);try{await s.sendTx({network:t.getParent().getNetworkInfo(),txs:a});try{for(let e=0;e<a.length;e++)await v.RustModule.WasmScope((r=>(0,B.xC)(t,r.WalletV4.Transaction.from_bytes(a[e].encodedTx),n[e])))}catch(e){}return Ue(e.publicDeriverId),null}catch(e){return{error:e.message}}}});function Ue(e){(async()=>{(0,ie.aR)({type:"wallet-state-update",params:{eventType:"update",publicDeriverId:e,isRefreshing:!1,walletState:(await(0,le.k)(e))[0],newTxs:[]}})})().catch(console.error)}var Ve=a(57096),Oe=a(87639);const Fe=m()({[j.k.typeTag]:j.k.handle,[j.X.typeTag]:j.X.handle,[Q.typeTag]:Q.handle,[ee.typeTag]:ee.handle,[te.typeTag]:te.handle,[ge.typeTag]:ge.handle,[he.typeTag]:he.handle,[fe.typeTag]:fe.handle,[ye.typeTag]:ye.handle,[we.typeTag]:we.handle,[me.typeTag]:me.handle,[be.typeTag]:be.handle,[ve.typeTag]:ve.handle,[xe.typeTag]:xe.handle,[_e.typeTag]:_e.handle,[Te.typeTag]:Te.handle,[ke.typeTag]:ke.handle,[Se.typeTag]:Se.handle,[Re.typeTag]:Re.handle,[De.typeTag]:De.handle,[Be.typeTag]:Be.handle,[Le.typeTag]:Le.handle,[He.typeTag]:He.handle,[Ve.I.typeTag]:Ve.I.handle,[Oe.ln.typeTag]:Oe.ln.handle,[Oe.Xm.typeTag]:Oe.Xm.handle,[Oe.aV.typeTag]:Oe.aV.handle,[Oe.FS.typeTag]:Oe.FS.handle,[Oe.RX.typeTag]:Oe.RX.handle,[Oe.U9.typeTag]:Oe.U9.handle,[Oe.b.typeTag]:Oe.b.handle,[Oe.oZ.typeTag]:Oe.oZ.handle,[Oe.MH.typeTag]:Oe.MH.handle,[K.Zc.typeTag]:K.Zc.handle});var Ke=a(33032),Ge=a.n(Ke),Ye=a(93476),qe=a.n(Ye),ze=a(89400),Ze=a.n(ze),$e=a(39392),je=a.n($e),Je=a(86902),Xe=a.n(Je),Qe=a(22261),et=a(57421),tt=a(85412);let at=0;const nt=new(je());async function rt(){if(oe()()-at>tt.Z.getServerStatusRefreshInterval()){const e=await async function(){var e,t;const a=await(0,X.zA)(),n=await(0,et.zm)(a,[a.getSchema().table(Qe.$u.name)],(e=>(0,et.go)(a,e,Qe.$u.name))),r=new(Pe())(w()(n).call(n,(e=>e.NetworkId)));return l()(e=w()(t=Xe()(H.networks)).call(t,(e=>H.networks[e]))).call(e,(({NetworkId:e})=>r.has(e)))}(),t=await(0,k.C)();for(const a of e){const e=a.Backend.BackendService;if(!e)throw new Error("unexpectedly missing backend zero");const n=oe()();let r;try{r=await t.checkServerStatus({backend:e})}catch{r={isServerOk:!1,isMaintenance:!1,serverTime:oe()()}}const s=oe()(),o=s-n;nt.set(a.NetworkId,{networkId:a.NetworkId,isServerOk:r.isServerOk,isMaintenance:r.isMaintenance||!1,clockSkew:r.serverTime+o/2-s,lastUpdateTimestamp:Math.floor(n+o/2)})}at=oe()()}(0,ie.aR)({type:"server-status-update",params:[...Ze()(nt).call(nt)]})}let st=!1;var ot=a(90578),it=a(9669),lt=a.n(it),dt=a(68917);lt().defaults.adapter=dt.Z;const ct=()=>{chrome.tabs.create({url:"main_window.html"})};chrome.action?chrome.action.onClicked.addListener(o()(ct,500,{leading:!0})):chrome.browserAction.onClicked.addListener(o()(ct,500,{leading:!0})),chrome.runtime.onMessage.addListener(((e,t,a)=>{tt.N.isDev()&&console.debug(`get message ${r()((0,E.sanitizeForLog)(e))} from ${t.tab.id}`);const n=function(e){if("subscribe"===e)return async(e,t,a)=>{(0,ie.Ld)(t.tab.id,e.request.activeWalletId),a(void 0)};const t=Fe[e];return t?async(a,n,s)=>{try{const n=await t(a.request);console.debug(`BACKGROUND [${e}] sending result: `,r()((0,E.sanitizeForLog)(n))),s(n)}catch(e){s({error:e.message})}}:void 0}(e.type);return n?(n({type:e.type,request:JSON.parse(e.request)},t,a),!0):async function(e,t){const a=t.tab.id;if("yoroi_connect_request/cardano"===e.type)try{await(0,F.N_)(a,e.connectParameters,e.imgBase64Url)}catch(e){(0,U.B9)(a,{type:"yoroi_connect_response/cardano",success:!1,err:(0,x.n)(e)})}else"connector_rpc_request"===e.type&&await async function(e,t){const a=t.tab.id;x.Yd.debug(`[yoroi][handleInjectorConnect] ${e.function} (Return type is: ${e.returnType})`);try{await v.RustModule.load();const t=e.returnType;if("cbor"!==t&&"json"!==t)throw T.u1.invalidRequest(`Invalid return type "${t}". Expected "cbor" or "json"`);const n=z[e.function];if(!n)return void Z({err:{code:T.np.API_INVALID_REQUEST,info:`unknown API function: ${e.function}`}},a,e.uid);let r;n.needConnectedWallet&&(r=await(0,F._T)(a,n.syncConnectedWallet));const s=await n.handle({wallet:r,tabId:a,message:e});void 0!==s&&Z(s,a,e.uid)}catch(t){if(t instanceof T.u1)Z({err:t.toAPIError()},a,e.uid);else{var n;const s=`Yoroi internal error: RPC call ${e.function}(${w()(n=e.params).call(n,r()).join(", ")}) failed due to internal error: ${t}`,o=null==(null==t?void 0:t.stack)?s:`${s}\n${t.stack}`;x.Yd.error(o),Z({err:{code:T.np.API_INTERNAL_ERROR,info:o}},a,e.uid)}}}(e,t)}(e,t)})),(0,X.S1)().catch(console.error),(0,ie.jC)((e=>{"subscriptionChange"===e.type&&async function(){if(!st)for(st=!0;;){if(0===(0,ie.tJ)().length)return void(st=!1);await rt(),await new(qe())((e=>Ge()(e,tt.Z.getServerStatusRefreshInterval())))}}().catch((e=>{console.error("error when updating server status",e)}))})),(0,ot.xh)(),tt.N.isFirefox()&&browser.runtime.onInstalled.addListener((async()=>{null==await(new b.ZP).loadIsAnalyticsAllowed()&&ct()}))},37872:(e,t,a)=>{a.d(t,{zA:()=>n.z,UA:()=>r.U,S1:()=>s});var n=a(84698),r=a(74429);async function s(){await(0,n.z)()}},74429:(e,t,a)=>{a.d(t,{X:()=>R,U:()=>C});var n=a(92762),r=a.n(n),s=a(11128),o=a.n(s),i=a(36384),l=a.n(i),d=a(33032),c=a.n(d),u=a(93476),p=a.n(u),g=a(4158),h=a(86335),f=a(41058),w=a(60274),y=a(3577),m=a(85412),b=a(84698),v=a(34147),x=a(79562),_=a(79111),T=(a(14986),a(10108)),k=a(51965),I=a(72499),A=a(84174);(0,v.jC)((e=>{"subscriptionChange"===e.type&&async function(){if(!M){for(M=!0;0!==(0,v.tJ)().length;)await S(),await new(p())((e=>c()(e,m.Z.getWalletRefreshInterval())));M=!1}}().catch((e=>{console.error("error when refreshing:",e)}))}));let M=!1;async function S(){const e=await(0,b.z)(),t=await(0,g.MX)({db:e});for(let e=0;e<t.length;e++)try{await C(t[e],`periodical refresh ${e+1} of ${t.length}`)}catch(e){console.error("Error when refreshing wallet.",e)}}const R=new(l()),D=new _.c;async function C(e,t,a=0){return D.run((()=>async function(e,t){var a;const n=e.getPublicDeriverId();console.debug('Syncing wallet ID %s name "%s" for %s.',n,(await e.getParent().getFullConceptualWalletInfo()).Name,t);const s=await e.getLastSyncInfo();if(o()()-((null===(a=s.Time)||void 0===a?void 0:a.valueOf())||0)<m.Z.getWalletRefreshInterval())console.debug("last sync was %s, skip syncing",s.Time);else{R.add(n),P(n,!0);try{await h.RustModule.load();const t=new x.ZP,a=await(0,f.s)(t),s=(0,y.JM)(e);if(!s)throw new Error("unexpected missing asHasLevels result");const o=new w.ZP,i=await o.refreshTransactions({limit:1,publicDeriver:s,isLocalRequest:!0,beforeTx:void 0,afterTx:void 0,getRecentTransactionHashes:a.getRecentTransactionHashes,getTransactionsByHashes:a.getTransactionsByHashes,checkAddressesInUse:a.checkAddressesInUse,getBestBlock:a.getBestBlock,getTokenInfo:a.getTokenInfo,getMultiAssetMetadata:a.getMultiAssetMintMetadata,getMultiAssetSupply:a.getMultiAssetSupply,getTransactionHistory:a.getTransactionsHistoryForAddresses}),d=await o.refreshTransactions({publicDeriver:s,isLocalRequest:!1,beforeTx:void 0,afterTx:i[0],getRecentTransactionHashes:a.getRecentTransactionHashes,getTransactionsByHashes:a.getTransactionsByHashes,checkAddressesInUse:a.checkAddressesInUse,getBestBlock:a.getBestBlock,getTokenInfo:a.getTokenInfo,getMultiAssetMetadata:a.getMultiAssetMintMetadata,getMultiAssetSupply:a.getMultiAssetSupply,getTransactionHistory:a.getTransactionsHistoryForAddresses}),c=new(l());for(const{txid:e}of d)c.add(e);const u=await(0,x._W)();let p=!1;for(let e=0;e<u.length;){const t=u[e].transaction.txid;c.has(t)?(r()(u).call(u,e,1),p=!0):e++}p&&(0,x.dF)(u),console.debug("Syncing wallet %s finished.",n),P(n,!1,(await(0,T.k)(n))[0],d);const g=e.getParent().getNetworkInfo().NetworkId,m=(0,A.getCardanoHaskellBaseConfig)((0,A.getNetworkById)(g)),b=await e.getLastSyncInfo();if(null!=(null==b?void 0:b.SlotNum)){const{epoch:e}=k.Z.toRelativeSlotNumber(m,b.SlotNum);await(0,I.sI)(g,e)}}catch(e){console.error("Syncing wallet %s failed:",n,e)}finally{R.delete(n)}}}(e,t)),a)}function P(e,t,a,n){(0,v.aR)({type:"wallet-state-update",params:{eventType:"update",publicDeriverId:e,isRefreshing:t,walletState:a,newTxs:n}})}},34147:(e,t,a)=>{a.d(t,{Ld:()=>m,tJ:()=>b,jC:()=>v,aR:()=>x});var n=a(59340),r=a.n(n),s=a(92762),o=a.n(s),i=a(62462),l=a.n(i),d=a(94473),c=a.n(d),u=a(78914),p=a.n(u);const g=[],h=[];function f(e){p()(h).call(h,(t=>t(e)))}function w(e){return c()(g).call(g,(t=>t.tabId===e))}function y(e){const t=l()(g).call(g,(({tabId:t,activeWalletId:a})=>t===e.tabId&&a===e.activeWalletId));-1!==t&&(o()(g).call(g,t,1),f({type:"subscriptionChange"}))}function m(e,t){const a=w(e);a&&y(a),function(e,t){g.push({tabId:e,activeWalletId:t}),f({type:"subscriptionChange"})}(e,t)}function b(){return g}function v(e){h.push(e)}function x(e){for(const{tabId:t}of b())chrome.tabs.sendMessage(t,{type:"yoroi-emit-update",data:r()(e)})}chrome.tabs.onRemoved.addListener(((e,t)=>{const a=w(e);a&&y(a)}))},43577:(e,t,a)=>{a.d(t,{Yb:()=>re,$g:()=>se,b7:()=>oe,t3:()=>ie,gZ:()=>ce,sL:()=>pe,D0:()=>ge,cQ:()=>he,YZ:()=>fe,Fx:()=>we,O:()=>ye,nH:()=>_e,SW:()=>Te,gf:()=>ke,xC:()=>Ie,NJ:()=>Ae,RL:()=>Me,Mk:()=>Se});var n=a(86902),r=a.n(n),s=a(51938),o=a.n(s),i=(a(94198),a(51942),a(32366)),l=a.n(i),d=a(36384),c=a.n(d),u=a(47302),p=a.n(u),g=a(20116),h=a.n(g),f=a(78580),w=a.n(f),y=a(25843),m=a.n(y),b=a(80426),v=a.n(b),x=a(94473),_=a.n(x),T=a(2991),k=a.n(T),I=a(93476),A=a.n(I),M=a(3649),S=a.n(M),R=a(63371),D=a(86335),C=(a(38441),a(3577)),P=(a(27189),a(905)),W=a(21131),E=a(38079),N=a(37495),B=a(45918),L=a(79562),H=a(27649),U=a(84184),V=a(84174),O=a(51965),F=a(60274),K=a(90649),G=a(55343),Y=a(39845),q=a(57421),z=a(34704),Z=a(27423),$=a(94346),j=a(71265),J=a(66905),X=a(75723),Q=a(32533),ee=a(95667),te=a(48764).Buffer;function ae(e,t){if(null!=t){const a=t.page*t.limit;if(a>=e.length)throw new R.u1({maxSize:e.length});return S()(e).call(e,a,Math.min(a+t.limit,e.length))}return e}function ne(e){return e.toString()}async function re(e,t){if("ADA"===t||"TADA"===t){const t=(0,C.yB)(e);if(null!=t){const e=await t.getBalance();return A().resolve(ne(e.getDefault()))}throw Error("asGetBalance failed in connectorGetBalance")}{const a=(0,C.yB)(e);if(null!=a){const e=await a.getBalance(),n=e.nonDefaultEntries();if("*"===t)return A().resolve({default:ne(e.getDefault()),networkId:e.getDefaultEntry().networkId,assets:k()(n).call(n,(e=>({identifier:e.identifier,networkId:e.networkId,amount:ne(e.amount)})))});const r=_()(n).call(n,(e=>e.identifier===t));return A().resolve(ne((null==r?void 0:r.amount)||new P.Z(0)))}throw Error("asGetBalance failed in connectorGetBalance")}}async function se(e){const t=(0,C.yB)(e);if(null!=t){const e=(await t.getBalance()).nonDefaultEntries();return A().resolve(k()(e).call(e,(e=>({identifier:e.identifier,networkId:e.networkId,amount:ne(e.amount)}))))}throw Error("asGetBalance failed in connectorGetAssets")}async function oe(e,t,a,n){var r,s,o;const i=(0,C.se)(e);if(null==i)throw new Error("wallet doesn't support IGetAllUtxos");const l=await i.getAllUtxos(),d=await(0,L._W)()||[],c=(new F.ZP).utxosWithSubmittedTxs(k()(r=(0,H.ue)(l)).call(r,(e=>({amount:e.amount,receiver:e.receiver,tx_hash:e.tx_hash,tx_index:e.tx_index,utxo_id:e.utxo_id,assets:e.assets}))),e.publicDeriverId,d),u=null!==(s=null==t?void 0:m()(t).call(t))&&void 0!==s?s:"";if(0===u.length)return A().resolve(ae(c,a));(0,$.setRuntime)(D.RustModule.CrossCsl.init);const p=new z.UTxOSet(await A().all(k()(c).call(c,U.TV))),g=function(e){if(/^\d+$/.test(e))return new z.Value(new z.Amount(e),z.NativeAssets.from([]));try{return D.RustModule.WasmScope((t=>{const a=t.WalletV4.Value.from_bytes((0,K.hexToBytes)(e));return new z.Value(new z.Amount(a.coin().to_str()),function(e){var t;const a=v()(t=(0,K.iterateLenGetMap)(e)).call(t,(([e,t])=>{var a;return k()(a=(0,K.iterateLenGetMap)(t).nonNullValue()).call(a,(([t,a])=>({asset:{policy:e.to_bytes(),name:t.to_bytes()},amount:new z.Amount(a.to_str())})))})).toArray();return z.NativeAssets.from(a)}(a.multiasset()))}))}catch(t){throw R.u1.invalidRequest(`Invalid required value string "${e}". Expected an int number or a hex of serialized Value instance. Cause: ${String(t)}`)}}(u);let h;try{h=(await(0,Z.coinSelectionClassificationStrategy)(p,[g],n.to_str())).selectedUtxos}catch(e){var f;if(e instanceof j.NotEnoughMoneyToSendError)throw new W.r7;if(w()(f=String(e)).call(f,"less than the minimum UTXO value"))throw new W.JZ;throw e}return k()(o=h.asArray()).call(o,(e=>{var t;return{utxo_id:`${e.tx}${e.index}`,tx_hash:e.tx,tx_index:e.index,receiver:e.address.hex,amount:e.value.amount.toString(),assets:k()(t=e.value.assets.asArray()).call(t,(([e,t])=>({amount:t.toString(),assetId:e.getHash(),policyId:e.policy.asHex(),name:e.name.asHex()})))}}))}const ie=new P.Z("5000000"),le=new P.Z("2000000"),de=3;async function ce(e,t,a,n){var r;const s=new P.Z(t);if(s.gt(ie))throw new Error("requested collateral amount is beyond the allowed limits");const o=new F.ZP,i=s.plus(le),l=h()(r=o.utxosWithSubmittedTxs(a,e.publicDeriverId,n)).call(r,(e=>0===e.assets.length&&new P.Z(e.amount).lt(i)));p()(l).call(l,((e,t)=>new P.Z(e.amount).comparedTo(t.amount)));const d=[];let c=new P.Z("0"),u=!1;for(const e of l){for(d.push(e),c=c.plus(e.amount);d.length>de||c.minus(d[0].amount).gte(s);){const e=d.shift();c=c.minus(e.amount)}if(c.gte(s)){u=!0;break}}if(u){for(;;){const e=d[0],t=c.minus(e.amount);if(!t.gte(s))break;d.shift(),c=t}return{utxosToUse:d,reorgTargetAmount:null}}return{utxosToUse:d,reorgTargetAmount:s.minus(c).toString()}}function ue(e){return v()(e).call(e,(({transaction:e})=>{var t;return k()(t=e.addresses.to).call(t,(({address:e})=>e))}))}async function pe(e,t){return async function(e,t,a,n){return ae([...e,...h()(t).call(t,(e=>a.has(e)))],n)}(await(0,N.te)(e,!0),await(0,N.te)(e,!1),new(c())(await async function(e){const t=await(0,L._W)()||[];return ue(h()(t).call(t,(t=>t.publicDeriverId===e)))}(e.publicDeriverId)),t)}async function ge(e){const t=await(0,L._W)()||[];return async function(e,t){const a=new(c())(ue(t));return h()(e).call(e,(e=>!a.has(e)))}(await(0,N.te)(e,!1),h()(t).call(t,(t=>t.publicDeriverId===e.publicDeriverId)))}async function he(e){return(await(0,F.ZE)(e))[0].to_hex()}async function fe(e,t){var a,n;const r=(0,C.O8)(e);if(null==r)throw new Error("Unable to get public key from the wallet");const s=(0,C.JM)(e);if(null==s)throw new Error("Unable to get derivation levels from the wallet");const i=(await r.getPublicKey()).Hash,l=s.getParent().getPublicDeriverLevel(),d=(0,F.jK)({publicKey:i,publicDeriverLevel:l},J.OC.CHIMERIC_ACCOUNT,J.Iz)[0],c=e.getParent().getNetworkInfo(),u=D.RustModule.WasmScope((e=>e.WalletV4.RewardAddress.new(o()(c.BaseConfig[0].ChainNetworkId,10),e.WalletV4.Credential.from_keyhash(d.hash())).to_address().to_hex())),p=await t({addresses:[u],network:c});return{key:d.to_hex(),isRegistered:null!==(a=null===(n=p[u])||void 0===n?void 0:n.stakeRegistered)&&void 0!==a&&a}}async function we(e){return async function(e){if("Cardano"!==e.getParent().defaultToken.Metadata.type)throw new Error("Invalid wallet for a cardano request");const t=E.dq.CARDANO_REWARD,a=(0,N.XN)({publicDeriver:e,type:t});await D.RustModule.load();const n=await a;return k()(n).call(n,(e=>({fullAddress:e,base58:e.address})))}(e).then((e=>k()(e).call(e,(e=>e.base58))))}async function ye(e){const t=await(0,B.WH)(e);if(null==t)throw new Error("could not get change address - this should never happen");return t.addr.Hash}function me(e,t){var a,n;const r=null==e?void 0:e.native_scripts();return k()(a=v()(n=(0,K.iterateLenGet)(r)).call(n,(e=>(0,K.iterateLenGet)(e.get_required_signers())))).call(a,(e=>e.to_hex())).toSet()}function be(e){var t;return k()(t=(0,K.iterateLenGet)(e.required_signers())).call(t,(e=>e.to_hex())).toSet()}const ve=[[e=>e.as_stake_deregistration(),e=>e.stake_credential().to_keyhash()],[e=>e.as_stake_delegation(),e=>e.stake_credential().to_keyhash()],[e=>e.as_vote_delegation(),e=>e.stake_credential().to_keyhash()],[e=>e.as_stake_and_vote_delegation(),e=>e.stake_credential().to_keyhash()],[e=>e.as_stake_registration_and_delegation(),e=>e.stake_credential().to_keyhash()],[e=>e.as_stake_vote_registration_and_delegation(),e=>e.stake_credential().to_keyhash()],[e=>e.as_drep_registration(),e=>e.voting_credential().to_keyhash()],[e=>e.as_drep_deregistration(),e=>e.voting_credential().to_keyhash()],[e=>e.as_drep_update(),e=>e.voting_credential().to_keyhash()],[e=>e.as_pool_registration(),e=>(0,K.iterateLenGet)(e.pool_params().pool_owners()).toArray()]];function xe(e){var t,a,n,r;const s=v()(t=(0,K.iterateLenGet)(e.certs()).nonNull()).call(t,(e=>{for(const[t,a]of ve){const n=(0,K.maybe)(t(e),a);if(null!=n)return(0,K.ensureArray)(n)}return[]})),o=k()(a=(0,K.iterateLenGet)(null===(n=e.voting_procedures())||void 0===n?void 0:n.get_voters()).nonNull()).call(a,(e=>{var t;return null===(t=e.to_drep_credential())||void 0===t?void 0:t.to_keyhash()})).nonNull();return k()(r=s.join(o)).call(r,(e=>e.to_hex())).toSet()}async function _e(e,t,a){return D.RustModule.WasmScope((n=>async function(e,t,a,n){var r;const{txBody:s,witnessSet:o,auxiliaryData:i,rawTxBody:l}=function(e,t){const{tx:a}=e;let n,r,s,o;const i=(0,K.hexToBytes)(a);try{const e=t.WalletV4.FixedTransaction.from_bytes(i);n=e.body(),r=e.witness_set(),s=e.auxiliary_data(),o=te.from(e.raw_body())}catch(e){try{n=t.WalletV4.TransactionBody.from_bytes(i),o=i}catch(t){throw e}}return{txBody:n,witnessSet:r,auxiliaryData:s,rawTxBody:o}}(a,n),d=(0,C.se)(e);if(null==d)throw new Error("missing utxo functionality");const u=(0,C.sX)(d);if(null==u)throw new Error("missing chains functionality");const p=new(c())([...be(s),...me(o),...xe(s)]),g=p.size>0,[f,w,y]=await A().all([u.getAllUtxos(),g?(0,N.XN)({publicDeriver:e,type:E.dq.CARDANO_BASE}):A().resolve([]),g?(0,N.XN)({publicDeriver:e,type:E.dq.CARDANO_REWARD}):A().resolve([])]),m=new(c()),b=[];if(g){var v;if(0===w.length)throw new Error("Cannot sign transaction script - no base addresses are available in the wallet!");const t=n.WalletV4.Address.from_bytes((0,K.hexToBytes)(w[0].address)),a=t.network_id(),r=null===(v=n.WalletV4.BaseAddress.from_address(t))||void 0===v?void 0:v.stake_cred();if(null==r)throw new Error("Cannot sign transaction script - failed to parse the base address staking cred!");for(const e of p){const t=n.WalletV4.Ed25519KeyHash.from_bytes((0,K.hexToBytes)(e)),s=n.WalletV4.Credential.from_keyhash(t),o=n.WalletV4.BaseAddress.new(a,s,r).to_address();m.add((0,K.bytesToHex)(o.to_bytes()))}for(const e of w){const{address:t,addressing:a}=e;if(m.delete(t)&&b.push({address:t,addressing:a}),0===m.size)break}for(const e of y){const{address:t,addressing:a}=e;p.has(S()(t).call(t,2))&&b.push({address:t,addressing:a})}const[s,o]=await(0,F.ZE)(e),i=s.hash().to_hex();if(p.has(i)){const e=n.WalletV4.RewardAddress.new(0,n.WalletV4.Credential.from_keyhash(s.hash())).to_address().to_hex();b.push({address:e,...o})}}const x=await(0,L._W)()||[],_=new F.ZP,T=await _.addressedUtxosWithSubmittedTxs((0,H.ue)(f),e,x),I=(0,C.JM)(e);if(!I)throw new Error("can't get level");const M=(0,C.y9)(e);if(!M)throw new Error("expect to be able to get signing key");const R=await M.getSigningKey(),D=await M.normalizeKey({...R,password:t}),P=k()(r=(0,K.iterateLenGet)(s.inputs()).join((0,K.iterateLenGet)(s.collateral()))).call(r,(e=>`${e.transaction_id().to_hex()}${String(e.index())}`)).toSet(),W=h()(T).call(T,(e=>P.has(e.utxo_id)));return(0,U.OJ)(W,l,I.getParent().getPublicDeriverLevel(),n.WalletV4.Bip32PrivateKey.from_hex(D.prvKeyHex),new(c()),i,b).witness_set().to_hex()}(e,t,a,n)))}async function Te(e,t,a,n,r){const s=(0,C.se)(e);if(null==s)throw new Error("missing utxo functionality");if(null==(0,C.sX)(s))throw new Error("missing chains functionality");const o=e.getParent().getNetworkInfo(),i=(0,V.getCardanoHaskellBaseConfig)(o),l=new P.Z(O.Z.timeToAbsoluteSlot(i,new Date)),d=await(0,L._W)()||[],c=(0,H.ue)(await s.getAllUtxos()),u=new F.ZP,p=await u.createUnsignedTxForConnector({publicDeriver:e,absSlotNumber:l,cardanoTxRequest:a,submittedTxs:d,utxos:c,protocolParameters:r},n);if(null==t)return p.unsignedTx.build_tx().to_hex();const g=(0,C.y9)(e);if(!g)throw new Error("expect to be able to get signing key");const h=await g.getSigningKey(),f=await g.normalizeKey({...h,password:t}),w=(0,C.JM)(e);if(!w)throw new Error("can't get level");return(0,U.OJ)(p.senderUtxos,p.unsignedTx,w.getParent().getPublicDeriverLevel(),D.RustModule.WalletV4.Bip32PrivateKey.from_hex(f.prvKeyHex),p.neededStakingKeyHashes.wits,p.metadata).to_hex()}async function ke(e,t,a){var n,r;await(0,Q.p)({body:{network:e.getParent().getNetworkInfo(),id:(0,X.transactionHexToHash)((0,K.bytesToHex)(t)),encodedTx:t},lastLaunchVersion:null!==(n=await a.getLastLaunchVersion())&&void 0!==n?n:"",currentLocale:null!==(r=await a.getUserLocale())&&void 0!==r?r:"",errorHandler:e=>{var t,a,n;const r=400===(null===(t=e.response)||void 0===t?void 0:t.status)?R.Z.REFUSED:R.Z.FAILURE,s=null!==(a=null===(n=e.response)||void 0===n?void 0:n.data)&&void 0!==a?a:`Failed to submit transaction: ${String(e)}`;throw new R.u1({code:r,info:s})}})}async function Ie(e,t,a){var n,r;const s=(0,C.se)(e);if(!s)throw new Error("expect to be able to get all UTXOs");const o=new(c())(v()(n=await s.getAllUtxoAddresses()).call(n,(e=>{var t;return k()(t=e.addrs).call(t,(e=>e.Hash))})));let i;i=a||(0,H.ue)(await s.getAllUtxos());const l=await(0,L._W)()||[],d=new F.ZP;i=await d.addressedUtxosWithSubmittedTxs(i,e,l);const u=(0,X.transactionHexToHash)(t.to_hex()),p=e.getParent().defaultToken,g={defaultNetworkId:p.NetworkId,defaultIdentifier:p.Identifier},h=new G.a([],g),f=new G.a([],g),w={from:[],to:[]};let y=!0;const m=t.body(),b=[];for(const e of(0,K.iterateLenGet)(m.inputs())){const t=e.transaction_id().to_hex(),a=e.index(),n=_()(i).call(i,(e=>e.tx_hash===t&&e.tx_index===a));if(!n)throw new Error("missing UTXO");b.push({txHash:t,index:a});const r=new G.a([],g);r.add({amount:new P.Z(n.amount),identifier:p.Identifier,networkId:p.NetworkId});for(const e of n.assets)r.add({amount:new P.Z(e.amount),identifier:e.assetId,networkId:p.NetworkId});w.from.push({address:n.receiver,value:r}),o.has(n.receiver)&&h.joinSubtractMutable(r),f.joinAddMutable(r)}for(const e of(0,K.iterateLenGet)(m.outputs())){const t=(0,H.$Z)(e.amount(),g),a=e.address().to_hex();w.to.push({address:a,value:t,isForeign:!1}),o.has(a)?h.joinAddMutable(t):y=!1,f.joinSubtractMutable(t)}const x=k()(r=(0,K.iterateLenGetMap)(m.withdrawals()).nonNullValue()).call(r,(([e,t])=>({address:e.to_address().to_hex(),value:new G.a([{amount:new P.Z(t.to_str()),identifier:p.Identifier,networkId:p.NetworkId}],g)}))).toArray();let T=!1;for(const e of(0,K.iterateLenGet)(m.certs()))if((0,ee.isCertificateKindDrepDelegation)(e.kind())){T=!0;break}const I=t.auxiliary_data(),A={txid:u,type:y?"self":"expend",amount:h,fee:f,date:new Date,addresses:w,state:E.YM.SUBMITTED,errorMsg:null,block:null,certificates:[],ttl:new P.Z(String(m.ttl())),metadata:null==I?void 0:I.to_hex(),withdrawals:x,isValid:!0};l.push({publicDeriverId:e.publicDeriverId,transaction:A,networkId:e.getParent().getNetworkInfo().NetworkId,usedUtxos:b,isDrepDelegation:T}),await(0,L.dF)(l)}function Ae(e,t){const a=t.getParent().getNetworkInfo().NetworkId,n=t.getDb();return(0,q.zm)(n,(0,q.Hz)(n,Y.YT),(async t=>{var r;return h()(r=await Y.YT.fromIdentifier(n,t,e)).call(r,(e=>e.NetworkId===a))}))}function Me(e){const t=l()(e).call(e,((e,t)=>((e[t.policyId]=e[t.policyId]||[]).push(t),e)),{}),a=D.RustModule.WalletV4,n=a.MultiAsset.new();for(const e of r()(t)){const r=t[e],s=a.ScriptHash.from_hex(e),o=D.RustModule.WalletV4.Assets.new();for(const e of r)o.insert(a.AssetName.new((0,K.hexToBytes)(e.name)),a.BigNum.from_str(e.amount));n.insert(s,o)}return n}async function Se(e,t){const a=e;await D.RustModule.load();const n=D.RustModule.WalletV4;return t?k()(a).call(a,(e=>{const t=n.TransactionInput.new(n.TransactionHash.from_hex(e.tx_hash),e.tx_index),a=n.Value.new(n.BigNum.from_str(e.amount));(e.assets||[]).length>0&&a.set_multiasset(Me(e.assets));const r=n.TransactionOutput.new(n.Address.from_hex(e.receiver),a);return n.TransactionUnspentOutput.new(t,r).to_hex()})):k()(a).call(a,(e=>({...e,receiver:n.Address.from_hex(e.receiver).to_bech32()})))}},63371:(e,t,a)=>{a.d(t,{Ct:()=>d,oz:()=>c,Wf:()=>u,Z:()=>p,CO:()=>g,y:()=>h,np:()=>f,u1:()=>w});var n=a(87672),r=a.n(n),s=a(56474),o=a.n(s),i=a(59340),l=a.n(i);function d(e){if("object"==typeof e&&"number"==typeof e.page&&"number"==typeof e.limit)return{page:e.page,limit:e.limit};throw w.invalidRequest(`invalid Paginate: ${l()(e)}`)}function c(e){if("string"==typeof e)return e;throw w.invalidRequest(`invalid TokenId: ${l()(e)}`)}function u(e){if("string"==typeof e)return e;throw w.invalidRequest(`Value must be a string: : ${l()(e)}`)}a(38441),a(55343);const p=o()({REFUSED:1,FAILURE:2}),g=o()({PROOF_GENERATION:1,USER_DECLINED:2}),h=o()({DATA_SIGN_PROOF_GENERATION:1,DATA_SIGN_ADDRESS_NOT_PK:2,DATA_SIGN_USER_DECLINED:3,DATA_SIGN_INVALID_FORMAT:4}),f=o()({API_INVALID_REQUEST:-1,API_INTERNAL_ERROR:-2,API_REFUSED:-3});class w extends Error{constructor(e){super(l()(e)),r()(this,"e",void 0),this.e=e}toAPIError(){return this.e}static invalidRequest(e){return new w({code:f.API_INVALID_REQUEST,info:e})}}}},fe={};function we(e){if(fe[e])return fe[e].exports;var t=fe[e]={id:e,loaded:!1,exports:{}};return he[e].call(t.exports,t,t.exports,we),t.loaded=!0,t.exports}we.m=he,we.c=fe,we.x=e=>{},we.amdO={},we.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return we.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,we.t=function(a,n){if(1&n&&(a=this(a)),8&n)return a;if("object"==typeof a&&a){if(4&n&&a.__esModule)return a;if(16&n&&"function"==typeof a.then)return a}var r=Object.create(null);we.r(r);var s={};e=e||[null,t({}),t([]),t(t)];for(var o=2&n&&a;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((e=>s[e]=()=>a[e]));return s.default=()=>a,we.d(r,s),r},we.d=(e,t)=>{for(var a in t)we.o(t,a)&&!we.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},we.f={},we.e=e=>Promise.all(Object.keys(we.f).reduce(((t,a)=>(we.f[a](e,t),t)),[])),we.u=e=>e+".chunk.js",we.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),we.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),we.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a={},n="yoroi:",we.l=(e,t,r,s)=>{if(a[e])a[e].push(t);else{var o,i;if(void 0!==r)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var c=l[d];if(c.getAttribute("src")==e||c.getAttribute("data-webpack")==n+r){o=c;break}}o||(i=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,we.nc&&o.setAttribute("nonce",we.nc),o.setAttribute("data-webpack",n+r),o.src=e),a[e]=[t];var u=(t,n)=>{o.onerror=o.onload=null,clearTimeout(p);var r=a[e];if(delete a[e],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach((e=>e(n))),t)return t(n)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),i&&document.head.appendChild(o)}},we.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},we.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),we.p="/js/",(()=>{var e={3352:0},t=[[98390,3922,4228,6350,3602,4147,9641,2322,3981],[49369,3922,4228,6350,3602,4147,9641,2322,3981]];we.f.j=(t,a)=>{var n=we.o(e,t)?e[t]:void 0;if(0!==n)if(n)a.push(n[2]);else{var r=new Promise(((a,r)=>{n=e[t]=[a,r]}));a.push(n[2]=r);var s=we.p+we.u(t),o=new Error;we.l(s,(a=>{if(we.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var r=a&&("load"===a.type?"missing":a.type),s=a&&a.target&&a.target.src;o.message="Loading chunk "+t+" failed.\n("+r+": "+s+")",o.name="ChunkLoadError",o.type=r,o.request=s,n[1](o)}}),"chunk-"+t,t)}};var a=e=>{},n=(n,r)=>{for(var s,o,[i,l,d,c]=r,u=0,p=[];u<i.length;u++)o=i[u],we.o(e,o)&&e[o]&&p.push(e[o][0]),e[o]=0;for(s in l)we.o(l,s)&&(we.m[s]=l[s]);for(d&&d(we),n&&n(r);p.length;)p.shift()();return c&&t.push.apply(t,c),a()},r=self.webpackChunkyoroi=self.webpackChunkyoroi||[];function s(){for(var a,n=0;n<t.length;n++){for(var r=t[n],s=!0,o=1;o<r.length;o++){var i=r[o];0!==e[i]&&(s=!1)}s&&(t.splice(n--,1),a=we(we.s=r[0]))}return 0===t.length&&(we.x(),we.x=e=>{}),a}r.forEach(n.bind(null,0)),r.push=n.bind(null,r.push.bind(r));var o=we.x;we.x=()=>(we.x=o||(e=>{}),(a=s)())})(),ue={},pe={1416:function(){return{"./cardano_wallet_browser.js":{__wbindgen_string_new:function(e,t){return void 0===r&&(r=we.c[82123].exports),r.__wbindgen_string_new(e,t)},__wbindgen_object_drop_ref:function(e){return void 0===s&&(s=we.c[82123].exports),s.__wbindgen_object_drop_ref(e)},__wbindgen_json_parse:function(e,t){return void 0===o&&(o=we.c[82123].exports),o.__wbindgen_json_parse(e,t)},__wbindgen_json_serialize:function(e,t){return void 0===i&&(i=we.c[82123].exports),i.__wbindgen_json_serialize(e,t)},__wbindgen_throw:function(e,t){return void 0===l&&(l=we.c[82123].exports),l.__wbindgen_throw(e,t)},__wbindgen_rethrow:function(e){return void 0===d&&(d=we.c[82123].exports),d.__wbindgen_rethrow(e)}}}},84747:function(){return{"./cardano_serialization_lib_bg.js":{__wbindgen_object_drop_ref:function(e){return void 0===c&&(c=we.c[87019].exports),c.ug$(e)},__wbindgen_string_new:function(e,t){return void 0===u&&(u=we.c[87019].exports),u.h4u(e,t)},__wbindgen_number_new:function(e){return void 0===p&&(p=we.c[87019].exports),p.pT7(e)},__wbindgen_string_get:function(e,t){return void 0===g&&(g=we.c[87019].exports),g.qtq(e,t)},__wbindgen_error_new:function(e,t){return void 0===h&&(h=we.c[87019].exports),h.hdV(e,t)},__wbindgen_object_clone_ref:function(e){return void 0===f&&(f=we.c[87019].exports),f.m_1(e)},__wbindgen_is_object:function(e){return void 0===w&&(w=we.c[87019].exports),w.WlW(e)},__wbg_String_91fba7ded13ba54c:function(e,t){return void 0===y&&(y=we.c[87019].exports),y.RVh(e,t)},__wbg_set_20cbc34131e76824:function(e,t,a){return void 0===m&&(m=we.c[87019].exports),m.Wl7(e,t,a)},__wbg_crypto_1d1f22824a6a080c:function(e){return void 0===b&&(b=we.c[87019].exports),b.q4o(e)},__wbg_process_4a72847cc503995b:function(e){return void 0===v&&(v=we.c[87019].exports),v.eoR(e)},__wbg_versions_f686565e586dd935:function(e){return void 0===x&&(x=we.c[87019].exports),x.uYV(e)},__wbg_node_104a2ff8d6ea03a2:function(e){return void 0===_&&(_=we.c[87019].exports),_.qxi(e)},__wbindgen_is_string:function(e){return void 0===T&&(T=we.c[87019].exports),T.eYF(e)},__wbg_require_cca90b1a94a0255b:function(){return void 0===k&&(k=we.c[87019].exports),k.OQ_()},__wbg_msCrypto_eb05e62b530a1508:function(e){return void 0===I&&(I=we.c[87019].exports),I.hcz(e)},__wbg_randomFillSync_5c9c955aa56b6049:function(e,t){return void 0===A&&(A=we.c[87019].exports),A.oH7(e,t)},__wbg_getRandomValues_3aa56aa6edec874c:function(e,t){return void 0===M&&(M=we.c[87019].exports),M.Iui(e,t)},__wbg_new_16b304a2cfa7ff4a:function(){return void 0===S&&(S=we.c[87019].exports),S.G26()},__wbindgen_is_function:function(e){return void 0===R&&(R=we.c[87019].exports),R.o$X(e)},__wbg_newnoargs_e258087cd0daa0ea:function(e,t){return void 0===D&&(D=we.c[87019].exports),D.eh8(e,t)},__wbg_new_d9bc3a0147634640:function(){return void 0===C&&(C=we.c[87019].exports),C.oS$()},__wbg_call_27c0f87801dedf93:function(e,t){return void 0===P&&(P=we.c[87019].exports),P.SpE(e,t)},__wbg_new_72fb9a18b5ae2624:function(){return void 0===W&&(W=we.c[87019].exports),W.Rx9()},__wbg_self_ce0dbfc45cf2f5be:function(){return void 0===E&&(E=we.c[87019].exports),E.m75()},__wbg_window_c6fb939a7f436783:function(){return void 0===N&&(N=we.c[87019].exports),N.YYI()},__wbg_globalThis_d1e6af4856ba331b:function(){return void 0===B&&(B=we.c[87019].exports),B.Bgs()},__wbg_global_207b558942527489:function(){return void 0===L&&(L=we.c[87019].exports),L.nDs()},__wbindgen_is_undefined:function(e){return void 0===H&&(H=we.c[87019].exports),H.XP4(e)},__wbg_set_d4638f722068f043:function(e,t,a){return void 0===U&&(U=we.c[87019].exports),U.CFs(e,t,a)},__wbg_call_b3ca7c6051f9bec1:function(e,t,a){return void 0===V&&(V=we.c[87019].exports),V.EIi(e,t,a)},__wbg_set_8417257aaedc936b:function(e,t,a){return void 0===O&&(O=we.c[87019].exports),O.MZW(e,t,a)},__wbg_buffer_12d079cc21e14bdb:function(e){return void 0===F&&(F=we.c[87019].exports),F._D(e)},__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb:function(e,t,a){return void 0===K&&(K=we.c[87019].exports),K.a6l(e,t,a)},__wbg_new_63b92bc8671ed464:function(e){return void 0===G&&(G=we.c[87019].exports),G.KX$(e)},__wbg_set_a47bac70306a19a7:function(e,t,a){return void 0===Y&&(Y=we.c[87019].exports),Y.fH$(e,t,a)},__wbg_newwithlength_e9b4878cebadb3d3:function(e){return void 0===q&&(q=we.c[87019].exports),q.qlr(e)},__wbg_subarray_a1f73cd4b5b42fe1:function(e,t,a){return void 0===z&&(z=we.c[87019].exports),z.kW0(e,t,a)},__wbg_new_d87f272aec784ec0:function(e,t){return void 0===Z&&(Z=we.c[87019].exports),Z.neC(e,t)},__wbg_call_eae29933372a39be:function(e,t){return void 0===$&&($=we.c[87019].exports),$.UZK(e,t)},__wbindgen_jsval_eq:function(e,t){return void 0===j&&(j=we.c[87019].exports),j.YqC(e,t)},__wbg_self_e0b3266d2d9eba1a:function(e){return void 0===J&&(J=we.c[87019].exports),J.NRn(e)},__wbg_require_0993fe224bf8e202:function(e,t){return void 0===X&&(X=we.c[87019].exports),X.dVC(e,t)},__wbg_crypto_e95a6e54c5c2e37f:function(e){return void 0===Q&&(Q=we.c[87019].exports),Q.yfN(e)},__wbg_getRandomValues_dc67302a7bd1aec5:function(e){return void 0===ee&&(ee=we.c[87019].exports),ee.j8U(e)},__wbg_randomFillSync_dd2297de5917c74e:function(e,t,a){return void 0===te&&(te=we.c[87019].exports),te.SaM(e,t,a)},__wbg_getRandomValues_02639197c8166a96:function(e,t,a){return void 0===ae&&(ae=we.c[87019].exports),ae.ZU4(e,t,a)},__wbindgen_debug_string:function(e,t){return void 0===ne&&(ne=we.c[87019].exports),ne.fYP(e,t)},__wbindgen_throw:function(e,t){return void 0===re&&(re=we.c[87019].exports),re.Or8(e,t)},__wbindgen_memory:function(){return void 0===se&&(se=we.c[87019].exports),se.oHO()}}}},24040:function(){return{"./cardano_message_signing_bg.js":{__wbindgen_object_drop_ref:function(e){return void 0===oe&&(oe=we.c[78263].exports),oe.ug(e)},__wbindgen_string_new:function(e,t){return void 0===ie&&(ie=we.c[78263].exports),ie.h4(e,t)},__wbindgen_debug_string:function(e,t){return void 0===le&&(le=we.c[78263].exports),le.fY(e,t)},__wbindgen_throw:function(e,t){return void 0===de&&(de=we.c[78263].exports),de.Or(e,t)},__wbindgen_rethrow:function(e){return void 0===ce&&(ce=we.c[78263].exports),ce.nD(e)}}}}},ge={4351:[84747],4388:[1416],5573:[24040]},we.w={},we.f.wasm=function(e,t){(ge[e]||[]).forEach((function(a,n){var r=ue[a];if(r)t.push(r);else{var s,o=pe[a](),i=fetch(we.p+""+{4351:{84747:"ea630b3b4f4fbafe877f"},4388:{1416:"775accd33a430df30a9c"},5573:{24040:"09324a3d5ee138c181b8"}}[e][a]+".module.wasm");s=o instanceof Promise&&"function"==typeof WebAssembly.compileStreaming?Promise.all([WebAssembly.compileStreaming(i),o]).then((function(e){return WebAssembly.instantiate(e[0],e[1])})):"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,o):i.then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,o)})),t.push(ue[a]=s.then((function(e){return we.w[a]=(e.instance||e).exports})))}}))},we.x()})();