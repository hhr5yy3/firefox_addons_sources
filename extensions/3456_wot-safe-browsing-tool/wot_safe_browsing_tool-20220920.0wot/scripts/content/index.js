self.yodules=self.yodules||{},void(yodules.CntHelpers={init:function(){const e=yodules.CntHelpers;e.class=class{helperDomReady(e){return e=e||document,new Promise(t=>{e.addEventListener("DOMContentLoaded",t),window.addEventListener("load",t),"complete"===e.readyState&&t()})}getChildIframe(e,t){t=t||0;const n=e.querySelectorAll("iframe");let s=null;if(n&&n[t])try{s=n[t].contentDocument}catch(e){s=null}return s}getDomainName(e){return this.convertToLink(e).hostname}convertToLink(e){let t=document.createElement("a");return t.href=e,t}isTopPage(){return top===self&&!!window.location}isRequiredHost(e){return location.hostname.includes(e)}findParent(e,t){do{if(e===document||e===document.body)return null;if(t.call(this,e))return e}while(e=e.parentElement);return null}documentListener(){document&&document.addEventListener.apply(document,arguments)}toArray(e){return Array.prototype.slice.call(e)}chromeSendMessage(e){chrome&&chrome.runtime&&chrome.runtime.sendMessage(e)}},e.instance=new e.class}}),self.yodules=self.yodules||{},yodules.SourceHelper={init:function(e){const t=yodules.SourceHelper,n=e.instance;t.class=class{constructor(){this._defaultSourceConfig=null,this._strKey="setter_config"}initSourceHelper(){this._isReadyState=new Promise((e,t)=>{this._defaultSourceConfig&&e(!0),chrome.storage.local.get(this._strKey,t=>{if(t&&t[this._strKey]){try{this._defaultSourceConfig=JSON.parse(t[this._strKey])}catch(t){return e(!1),void 0}e(!0)}else e(!1)})})}get configIsReady(){return this._isReadyState}getConfigField(e){if(!e||!this._defaultSourceConfig)return null;"string"==typeof e&&(e=[e]);let t=Object.assign({},this._defaultSourceConfig);return e.forEach(e=>t=t&&t[e]),this.formatValue(t)}formatValue(e){if(!e)return null;if("string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>this.formatValue(e));if("object"==typeof e){const t=Object.assign({},e);return Object.entries(t).forEach(e=>{t[e[0]]=this.formatValue(e[1])}),t}return e}get supportLink(){return`[href*="${this.getConfigField(["helpers","s_link"])}"]`}get supportLinkDomain(){return`[href*="${this.getConfigField(["helpers","s_domain"])}"]`}get nonSupportLink(){return`a[href*="//"]:not(${this.supportLink}):not(${this.supportLinkDomain})`}get tpcImagesDomain(){return this.getConfigField(["helpers","im_domain"])}checkItemAttr(e,t){return!!["data-type","class"].find(n=>t.find(t=>{const s=e.getAttribute(n);return s&&s.includes(t)}))}checkTag(e,t){return e&&e.tagName.toLowerCase()===t?e:e.querySelector(t)||null}getIma(e){return(e||{}).ima||null}getItemChildText(e,t){const n=e.querySelector(t.join(","));return!!n&&n.innerText||""}getHref(e){return this.getAttr(e,"href")}getInnerText(e){return e&&e.innerText}getAttr(e,t){return e&&e.getAttribute(t)}getFrame(e,t){let n=[(t=e.querySelector("html")||t).offsetWidth,t.offsetHeight];if(!n[1]){const t=e.documentElement;n[1]=Math.max(t.clientHeight,t.scrollHeight,t.offsetHeight)}return n}isNotEmptyObject(e){return e&&!!Object.keys(e).length}isNotEmpty(e){return e&&!!e.length}getWidth(e){return e?e.width||e.offsetWidth||0:null}getHeight(e){return e?e.height||e.offsetHeight||0:null}sendData(e){n.chromeSendMessage({type:e.type||"gas",subtype:e.subtype,v:"0.8.6",data:e.data,hash:e.hash})}},t.instance=new t.class,t.instance.initSourceHelper()},deps:["CntHelpers"]},self.yodules=self.yodules||{},yodules.SourceIm={init:function(e){const t=yodules.SourceIm,n=e.instance;t.class=class{getImage(e){const t=n.checkTag(e,"img");if(!t)return null;let s=t.style.backgroundImage||null;s&&(s=s.slice(5,s.length-2));let i={h:n.getHeight(t),w:n.getWidth(t)},o=s||t.getAttribute("src")||null;if(i.w<80||i.h<80||!o||!o.startsWith(n.getConfigField(["common","ht"])))return null;let r=i.w===i.h?{wh:i.h}:i;return r.src=this._filterSrc(o),{ima:r,sq:i.w*i.h}}_filterSrc(e){return e.includes(n.getConfigField(["helpers","im_domain"]))?e.split("?")[0]:e}getBannerImages(e){let t,s={};const i={l:["logo"],p:["product"]};return e.querySelectorAll(n.nonSupportLink+" img").forEach(e=>{const o=this.getImage(e),r=n.getIma(o);if(!r)return;const a=!t||o.sq>t.sq;Object.keys(i).some(t=>{if(n.checkItemAttr(e.parentElement,i[t]))return s[t]=r,!0})||a&&(t=o)}),t&&(s.o=n.getIma(t)),n.isNotEmptyObject(s)?s:null}},t.instance=new t.class},deps:["SourceHelper"]},self.yodules=self.yodules||{},yodules.SourceText={init:function(e){const t=yodules.SourceText,n=e.instance;t.class=class{getTextData(e){if(!e.innerText)return null;let t=e.querySelector(n.getConfigField(["gasSimple","sel"])),s=t&&t.innerText;return s=s&&s.split("\n").map(e=>e.replace(/\t/g,"")).filter(e=>!!e),s?{te:s}:null}},t.instance=new t.class},deps:["SourceHelper"]},self.yodules=self.yodules||{},yodules.SourceLink={init:function(e){const t=yodules.SourceLink,n=e.instance;t.class=class{isLinkValid(e){const t=n.getConfigField(["common","ht"]),s=n.getConfigField(["common","aU"]),i=n.getConfigField(["sourceLink","double"]);return!(!e||!e.startsWith(t))&&(!(e.length>15e3)&&(!(!/^https?:\/\/[\w-_]+\.\w+.*/.test(e)||e.startsWith(i)&&!e.includes(s))&&!n.getConfigField(["sourceLink","gasFilter"]).find(t=>e.includes(t))))}getLink(e){const t=n.checkTag(e,"a");if(!t)return null;const s=n.getAttr(t,n.getConfigField(["common","docu"]))||n.getHref(t);return this.formatLink(s)}formatLink(e){if(!e)return null;if("string"!=typeof e&&(e=e.find(e=>e&&e.includes(n.getConfigField(["common","aU"])))||e[0]),e=e.trim(),!this.isLinkValid(e))return null;e=this.getLPValue(e);const t=n.getConfigField(["sourceLink","nx"]);return e.endsWith(t)&&(e=e.substring(0,e.length-6)),{l:e}}getLPValue(e){if(!(e=this.normaliseValue(e,2))||!e.includes("?"))return e;const t=n.getConfigField(["sourceLink","dnParams"]);let s;for(let n=0;n<t.length&&(s=this.getParamValue(e,t[n][0],t[n][1]),!s);n++);return s=this.getHashValue(s)||this.getHashValue(e)||s,s&&s!==e?(s=this.normaliseValue(s,2),s=this.isLinkValid(s)?s:e,this.getLPValue(s)||e):e}getParamValue(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=e.substring(0,e.indexOf("?")),i=e.substring(e.indexOf("?")+1);if(n&&"*"!==n&&!s.includes(n))return null;let o;try{const e=new URLSearchParams(i);o=e&&e.get(t)}catch(e){return null}return o||null}getHashValue(e){const t=n.getConfigField(["sourceLink","dnHashes"]);if(!e||!t.find(t=>!e.includes(t)))return null;const s=e.split(/\/http|3DDhttp/);return 2===s.length?n.getConfigField(["common","ht"])+s[1]:null}normaliseValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(let s=0;s<t;s++)try{const t=n.getConfigField(["common","ht"]),s=e.toLowerCase();(s.startsWith(t+"%3a")||s.startsWith(t+"s%3a"))&&(e=decodeURIComponent(e))}catch(e){}return e}},t.instance=new t.class},deps:["SourceHelper"]},self.yodules=self.yodules||{},yodules.GasCommonAdvanced={init:function(e,t){const n=yodules.GasCommonAdvanced,s=e.instance,i=t.instance;n.class=class{hasGasCanvas(e){const t=e.querySelector("a canvas.image, a canvas.logo");if(!t)return!1;const n=this._getBackground(t);return n&&n.includes(s.tpcImagesDomain)}collectAdvCommon(e){const t=e.querySelector(s.nonSupportLink);let n=t&&i.getLink(t);if(n||(n=this._getMetaData(e)),!n)return{};const o=this._getImages(e);if(!o)return{};const r=this._getRichText(e);let a=Object.assign({},n,{ima:o});return r&&Object.assign(a,r),{subtype:"Br",data:{adv:[a]}}}_getMetaData(e){const t=e.querySelector(s.getConfigField(["gasAdvanced","exit"]));let n=t&&t.getAttribute("content");try{n=JSON.parse(n)}catch(e){}const o=this._getValue(n);return i.formatLink(o)}_getValue(e){if(!e)return!1;const t=s.getConfigField(["gasAdvanced","pageA"]),n=s.getConfigField(["gasAdvanced","simpleFilter"]);if(e&&"string"==typeof e&&e.includes(t)&&e.includes(n))return e;if(Array.isArray(e)){let t;return e.find(e=>{const n=this._getValue(e);return n&&(t=n),n}),t}}_getBackground(e){let t;try{t=e.currentStyle||window.getComputedStyle(e,!1)}catch(e){t=!1}return t&&t.backgroundImage&&t.backgroundImage.slice(4,-1).replace(/"/g,"")}_getRichText(e){let t="";["title","body"].forEach((e,n)=>{n>0&&(t+=", "),t+=`.${e}[role=link], .${e} [role=link]`});let n=[];if(e.querySelectorAll(s.nonSupportLink+", a:not([src])").forEach(e=>e.querySelectorAll(t).forEach(e=>{const t=e.innerText;t&&n.push(t)})),n.length)return{te:n}}_getImages(e){let t={},n=this._getItemData(e,"canvas.image","p");if(n||(n=this._getItemData(e,".x-layout","p")),!n)return;Object.assign(t,n);const s=this._getItemData(e,"canvas.logo","l");return s&&Object.assign(t,s),Object.keys(t).length?t:null}_getItemData(e,t,n){let i={};const o=e.querySelector(t),r=o&&this._getBackground(o);return!(!r||!r.includes(s.tpcImagesDomain))&&(i[n]={src:r,w:o.clientWidth,h:o.clientHeight},i)}},n.instance=new n.class},deps:["SourceHelper","SourceLink"]};const dirtyHackForFirefox={ReactDOM:ReactDOM,React:React,ReactRedux:ReactRedux};if(window.top===window){webextApi.runtime.onMessage.addListener((e,t,n)=>{e.action===PING&&n(PONG)}),imAlive(),injectFontsContent();const e=new Store({portName:"4873"});e.ready().then(()=>{const t={serp:new SerpHandler(e),warning:new WarningHandler(e),sharing:new SharingHandler,redirect:new RedirectHandler,socialLogin:new SocialAuthHandler(e),preCheckAssistant:new PreCheckAssistantHandler(e),assistant:new AssistantHandler(e),blocker:new BlockerHandler(e),slider:new SliderManager(e),addReviewHandler:new AddReviewHandler(e),leakHook:new LeakHookHandler(e),pinWotPopupHandler:new PinPopupHandler(e)};t.slider.init(),t.redirect.init(),t.pinWotPopupHandler.init(),function n(){if(Object.keys(dirtyHackForFirefox).forEach(e=>{void 0===window[e]&&(window[e]=dirtyHackForFirefox[e])}),window[WOT_TRACE_ID.name]=e.getState().wotTraceId,document.getElementsByTagName("body").length<1)setTimeout(n.bind(this),500);else{t.blocker.init(),t.warning.render(),t.sharing.init(),t.serp.init(),t.assistant.init(),t.socialLogin.init(),t.leakHook.render();const n=e.getState();if(webextApi.runtime.onMessage.addListener((e,s,i)=>{e.action===PRE_CHECK&&i(t.preCheckAssistant.init(n.ratings,e.url))}),WOT_WEBSITE_DOMAINS_WITH_AUTH.find(e=>window.location.hostname.startsWith(e))){let n=!1;const s=()=>{const t=e.getState().settings;window.postMessage({"wot-ext-data-received":{version:VERSION,protection:t.protection}},window.location.origin)},i=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(n)return;n=!0,setTimeout(()=>{n=!1},1200);const s=e.getState().user.token;t&&t!==s?e.dispatch(saveToken(t)):s&&!t&&e.dispatch(logout())},o={"wot-user-update":{func:i,arg:"token"},"wot-ext-data":{func:s},"wot-ext-opt-in":{func:()=>{e.dispatch(turnOnProtection()),e.dispatch(turnOffParentalControl()),e.dispatch(setWarningsLevel(WARNINGS_LEVEL_HIGH))}},"wot-open-tab":{func:openInternalPage,arg:"page"},"wot-show-pin-popup":{func:()=>{t.pinWotPopupHandler.render()}}},r=window.localStorage.getItem("JWT");r&&webextApi.storage.local.set({JWT:r}),window.addEventListener("message",e=>{if(!e.data)return;const t=e.data.type||e.data,n=o[t];n&&n.func(n.arg&&(e.data[n.arg]||"wot-user-update"===t&&window.localStorage.getItem("JWT")))}),s(),setTimeout(()=>{i(window.localStorage.getItem("JWT"))},1e3)}}}()})}self.yodules=self.yodules||{},void(yodules.GasSimple={init:function(e,t,n,s){const i=yodules.GasSimple,o=e.instance,r=t.instance,a=n.instance,l=s.instance;i.class=class{getTextElement(e,t){return t&&e.querySelector(o.getConfigField(["gasSimple","ca"]))}collectSimple(e){let t=[];return e.querySelectorAll(o.getConfigField(["gasSimple","c0"])).forEach(e=>{const n=a.getLink(e),s=Object.assign({},l.getTextData(e));if(o.isNotEmptyObject(s)){let i=r.getBannerImages(e);o.isNotEmptyObject(i)&&(i={ima:i}),t.push(Object.assign({},n,s,i))}}),o.isNotEmpty(t)?{subtype:"T",data:{adv:t}}:{}}},i.instance=new i.class},deps:["SourceHelper","SourceIm","SourceLink","SourceText"]}),self.yodules=self.yodules||{},yodules.GASCommon={init:function(e,t,n,s){const i=yodules.GASCommon,o=e.instance,r=t.instance,a=n.instance,l=s.instance;i.class=class{hasGasImages(e,t,n){return!!e.querySelector(`a img[src*="${n}"]`)||t&&!!e.querySelector(o.nonSupportLink+" img")}collectCommon(e){const t=a.getLink(e),n=r.getTextData(e);let s="Bh",i=l.getBannerImages(e);if(!t||!i)return{};const o=Object.keys(i);1===o.length&&"o"===o[0]&&(s="B",i=i.o);let c=Object.assign({},t,{ima:i});return n&&Object.assign(c,n),{subtype:s,data:{adv:[c]}}}},i.instance=new i.class},deps:["SourceHelper","SourceText","SourceLink","SourceIm"]},self.yodules=self.yodules||{},yodules.RolCommon={init:function(e,t,n){const s=yodules.RolCommon,i=e.instance,o=t.instance,r=n.instance;s.class=class{collectRol(e){const t=Object.assign({},{o:i.getIma(r.getImage(e))},o.getLink(e));return i.isNotEmpty(t.l)&&i.isNotEmptyObject(t.ima)?(t.l=t.l.split("?")[0],{type:"rolling",subtype:"B",data:{adv:[t]}}):{}}getRolItem(e){return e.querySelector(i.getConfigField(["rol","dm"]))}},s.instance=new s.class},deps:["SourceHelper","SourceLink","SourceIm"]},self.yodules=self.yodules||{},yodules.SourceCommon={init:function(e,t,n,s,i,o){const r=yodules.SourceCommon,a=e.instance,l=t.instance,c=n.instance,u=i.instance,d=s.instance,g=o.instance;r.class=class{initSource(){l.configIsReady.then(e=>{e&&(a.isTopPage()?a.helperDomReady().then(()=>setTimeout(this.framesChecker.bind(this,document),3e3)):this.collectAdv(document))})}collectAdv(e,t){let n=!t;t=t||Math.random().toString(36).substring(5,11);const s=l.getConfigField(["gasDomains","synd"]),i=this.isWhitelistedUri(e)||this.isAdContainer(e),o=d.hasGasImages(e,i,s),r=i&&g.hasGasCanvas(e),a=c.getTextElement(e,i),m=u.getRolItem(e);let h={},f=e.body;m?h=u.collectRol(m):o?h=d.collectCommon(f):r?h=g.collectAdvCommon(f):a&&(h=c.collectSimple(a)),h&&h.data&&l.isNotEmpty(h.data.adv)?(h.data.fs=l.getFrame(e,f),h.data.hash=t,this.sendCommonResult(e,t,h)):n&&setTimeout(e=>{this.collectAdv(e,t)},2e3,e)}sendCommonResult(e,t,n){window._rhash||(window._rhash=t,l.sendData(n))}getGasDomains(e){const t=l.getConfigField("gasDomains");return e?t[e]?t[e]:"":Object.values(t)}isWhitelistedUri(e){const t=e.baseURI;return t&&!!this.getGasDomains().find(e=>t.includes(e))}isAdContainer(e){return!!e.querySelector("a"+l.supportLink)||!!e.querySelector(`a[href*="${l.getConfigField(["gasDomains","double"])}"]`)}framesChecker(e){e.querySelectorAll('iframe:not([src]), iframe:not([src*="http"])').forEach(e=>{if(e.clientHeight)try{const t=e.contentWindow.document;this.collectAdv(t)}catch(e){}})}},r.instance=new r.class,r.instance.initSource()},deps:["CntHelpers","SourceHelper","GasSimple","GASCommon","RolCommon","GasCommonAdvanced"]};