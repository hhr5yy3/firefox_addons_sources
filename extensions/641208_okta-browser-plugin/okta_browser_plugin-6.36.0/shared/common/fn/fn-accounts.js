!function(){const l={};Okta.fn.accounts=l;const d=Okta.Q,f=d.all;var n=Okta._okta;const g=n.isEmpty,A=n.pick,c=n.each,m=n.find,i=n.some,a=n.filter,u=n.isString,r=n.keys,h=n.partial,s=Okta.fn.other.string.stripWhitespace,p=Okta.fn.other.string.isSubString,k=Okta.fn.url.urlPartsToDomain,w=Okta.fn.url.isOktaPluginHomePage,L=Okta.fn.url.urlPartsToDomainWithoutPort,o=Okta.fn.url.hrefToUrlParts,E=Okta.fn.url.isUrlPathStartsWith,I=Okta.fn.promises.pipelineP,v=Okta.fn.cookieManager.setHttpOnlyCookiesInSessionBeforeConsent,P=Okta.fn.base.timestamp,t=/^\S+@\S+\.\S+$/,C=Okta.fn.url.isOktaPersonalAccount;function D(n,t){n=m(n,function(n){return l.isSameAccount(n,t)});return!g(n)}function O(n,t,e,o,i,r,c){var a,u="FnAccountsIIFE:: handleCurrentLoginAccount: ";if(!(a=n)||!a.login)return Log.warn(u+"invalid endUser, skip the account"),d.reject("invalid end user.");const s=(n=n,A(n,"login","firstName","lastName","personalAppsEnabled","userId","orgName","orgLogo","orgId"));s.orgDomainUrl=k(e);r=!(r&&r.disablePluginAccountChooser);return Log.debug(u+"pluginAccountChooserIsEnabled is "+r),r&&function(n,t){var e="FnAccountsIIFE::requireAccountValidation: ";if(!g(n))return C(t.orgDomainUrl)?void Log.info(e+"Allow list is not empty and this is a personal account. Account validation is not required"):(Log.info(e+"Allow list is not empty and this is not a personal account. Account validation is required"),1);Log.info(e+"Allow list is empty. Account validation is not required")}(t,s)?function(n,t,e,o,i,r){var c="FnAccountsIIFE::validateCurrentLoginAccount: ";let a;return t.customDomain&&(a=k(t.customDomain)),a!==e.customDomainUrl&&(e.customDomainUrl=a),D(n,e)?(Log.debug(c+"account already in allow list"),o.updateAllowListedOktaAccount(n,e)):(Log.debug(c+"account requires consent"),(i.isSafari()||i.isSafariWebExt()||a)&&i.injectAccountPendingConsent(e.login),e.consentRequired=!0,e.timestamp=P(),o.setEnduserHomePendingConsent(e),r.updateBadge({text:"!",color:"red"}),d.reject("Account requires consent."))}(t,e,s,o,i,c):D(t,s)?(Log.debug(u+"account already in allow list"),o.updateAllowListedOktaAccount(t,s)):(Log.debug(u+"found new account not yet in allow list"),function(n,t,e,o){const i="FnAccountsIIFE::addNewAccount: ";e.customDomainUrl=t.customDomain?k(t.customDomain):void 0,e.index=n.length;let r=d();const c=C(e.orgDomainUrl);c?(Log.info(i+"adding new personal account"),r=o.getDBGPluginSettings().then(function(n){return n.oktaPersonalEnabled=!0,n.multiAccountAwarePlugin=!0,n.enhancedPopoverUIEnabled=!0,o.setDBGPluginSettings(n)}).then(o.readMultiAccount).then(o.migrateToMultiAccount)):Log.info(i+"adding new workforce account"),n=m(n,function(n){return C(n.orgDomainUrl)});const a=g(n);return o.addToAllowListedOktaAccounts(e).then(o.setEnduserHomePendingConsent("")).then(function(){return c?o.getTrackedFirstTimeActions().then(function(n){return n.showGetStartedPersonal=a,n.keyboardShortcutAck=!0,o.setTrackedFirstTimeActions(n)}):d()}).then(r).then(h(l.changeActiveAccount,o,e.index)).fail(function(){return Log.warn(i+"could not add account to allow list"),d()})}(t,e,s,o))}function S(n,t){var e=a(n,function(n){return t(n)});if(e&&1===e.length)return e[0];if(e&&1<e.length){n=m(e,function(n){return C(n.account.orgDomainUrl)});return n?n:e[0]}}l.reorderAccountAllowList=function(n,o,t){return i=t,r=o,n.getAllEnduserHome().then(function(n){n=a(n,function(t){return!!(t&&t.data&&t.data.userId)&&!!m(r,function(n){return!!n&&n.userId===t.data.userId})});const t=i.toLowerCase();let e=l.isValidEmail(t)&&S(n,function(n){return n.data.login.toLowerCase()===t});return e||(e=l.isValidEmail(t)&&S(n,function(n){return n.data.email.toLowerCase()===t}),e||(e=S(n,function(n){return n.data.login.toLowerCase().split("@")[0]===t}),e||(e=S(n,function(n){return n.data.email.toLowerCase().split("@")[0]===t}),e||(e=m(n,function(n){return C(n.account.orgDomainUrl)}),e||n[0]))))}).then(function(t){for(let n=1;n<o.length;n++)if(t.account.login===o[n].login&&t.account.orgDomainUrl===o[n].orgDomainUrl){var e=o[0];o[0]=o[n],o[n]=e;break}return o}).fail(function(n){return Log.error("fn::reorderAccountAllowList: "+n),o});var i,r},l.filterNonRecentAccounts=function(n,t){return n.getAllAuthToken().then(function(n){const o={};return c(n,function(n){var t,e;n&&n.data&&n.account&&((t=r(n.data))&&n.data[t]&&n.data[t].access_token&&(e=n.data[t].access_token.expiresAt,(!o[t]||o[t].data[t].access_token.expiresAt<e)&&(o[t]=n)))}),a(t,function(n){return!(!n||!n.orgDomainUrl)&&(o[n.orgDomainUrl]&&o[n.orgDomainUrl].account.index===n.index)})})},l.isValidEmail=function(n){return n&&t.test(n)},l.isNonWorkEmail=function(n,t){if(!u(n)||!t)return"N/A";if(!u(t.login)&&!u(t.email))return"N/A";const e=u(t.login)?s(t.login):"",o=u(t.email)?s(t.email):"";var i=s(n).toLowerCase().split("@");if(2!==i.length)return"N/A";t=e.toLowerCase().split("@"),n=o.toLowerCase().split("@");let r=!1;return t[1]&&(r=r||p(i[1],t[1])),n[1]&&(r=r||p(i[1],n[1])),!r},l.getEmailDomain=function(n){const t=u(n)?s(n):"";n=t.toLowerCase().split("@");return 2!==n.length?"":n[1]},l.isSubdomain=function(n,t){if(g(n)||g(t))return!1;var e=n.toLowerCase().split("."),o=t.toLowerCase().split(".");let i=e.length-1,r=o.length-1;for(;0<=i&&0<=r;)if(e[i--]!==o[r--])return!1;return-1===r},l.doesEmailShareDomainWithAccount=function(n,t){n=l.getEmailDomain(n),t=l.getEmailDomain(t.login);return l.isSubdomain(n,t)},l.changeActiveAccount=function(o,i){const r="FnAccountsIIFE::changeActiveAccount: ";return i<0?d.reject("Invalid accountIndex"):o.getAllowListedOktaAccounts().then(function(n){const t=m(n,function(n){return n.index===i});if(!t)return d.reject("Invalid accountIndex");if(!t.isCurrentAccount||!t.isActiveAccount){const e=m(n,function(n){return!0===n.isActiveAccount});return e&&(Log.info(r+"Marking current active account as inactive"),e.isActiveAccount=!1,e.isCurrentAccount=!1),Log.info(r+"Changing active account to account with index "+i),t.isActiveAccount=!0,t.isCurrentAccount=!0,o.setAllowListedOktaAccounts(n)}Log.info(r+"No action needed as account is already selected")})},l.changeActiveAccountByLogin=function(o,i,r){return o.getAllowListedOktaAccounts().then(n=>{if(!n||0===n.length)return d.reject("no accounts in storage");let t=!1,e=!1;return c(n,n=>{n.orgDomainUrl===i&&n.login===r?(t=!0,n.isCurrentAccount&&n.isActiveAccount?e=!0:n.isCurrentAccount=n.isActiveAccount=!0):n.isCurrentAccount=n.isActiveAccount=!1}),t?e?void 0:o.setAllowListedOktaAccounts(n):d.reject("did not find account in storage")})},l.createAccountFriendlyName=function(n){const t=o(n),e=t.host&&t.host.split(".")[0];return e?e.charAt(0).toUpperCase()+e.slice(1):""},l.validateIsLoginConsented=function(e,n,o,i,r,t,c){const a="FnAccountsIIFE::validateIsLoginConsented: ";if(!(!!C(k(e))||w(e))||i.hasOktaLoginDom())return d();const u=1===i.findInTop("#okta-PLUGIN_NEW_ENDUSER_INTERNAL_APIS-enabled").length,s=i.findInTop("#okta-encryptedUserId"),l=1===s.length?s.text():null,g="PLUGIN_SKIP_GET_TOKEN_NEW_ENDPOINT";return v(r,i,o,L(e.customDomain||e)).then(I(r.getPluginVersion(),function(n){return(i.isSafari()||i.isSafariWebExt()||e.customDomain)&&i.injectPluginVersion(n,!0),d()})).then(h(o.setOktaDomainPendingConsent,e)).then(function(){if(u){if(l){if(E(e,"/home/plugin"))return Log.warn(a+"skip getting user on pluginHome page when using new endpoint"),d.reject(g);var n={encryptedUserId:l};return Log.info(a+"new enduser endpoint enabled, getting token on "+e.host+" for user "+l),t.getTokenWithoutPrompt(e,n,!0)}Log.warn(a+"encryptedUserId missing, will not get access token")}}).then(function(){return f([n.getEnduserHomeResponseForAccountValidation(u),o.getAllowListedOktaAccounts()]).spread(function(n,t){return O(n,t||[],e,o,i,c,r)})}).fail(function(n){if(n!==g)return d.reject(n)})},l.checkPendingAccountTimeoutStatus=function(n,t,e){return n.isTopWindow()?e.getEnduserHomePendingConsent().then(function(n){if(n&&n.timestamp&&!(P()-n.timestamp<9e5))return n={},t.updateBadge({text:"",color:""}),e.setEnduserHomePendingConsent(n)}):d()},l.isSameAccount=function(n,t){var e=n.login,o=t.login,i=n.userId,r=t.userId,n=n.orgDomainUrl,t=t.orgDomainUrl,o=e===o&&n===t,r=i===r&&n===t,t=C(n)&&C(t);return o||t&&r},l.getCanShowOktaPersonalForWorkforcePrompt=function(e,n,o){return n.getEnduserHome().then(function(n){var t=l.isNonWorkEmail(e,n);return o&&o.pluginIsOktaPersonalForWorkforceEnabled&&!0===t&&n.showOktaPersonalDashboardBanner})},l.isActiveOktaPersonalAccount=function(n){return!(!n||!n.pluginOktaPersonalCoreServiceEnabled)},l.isForceWICExperienceEnabled=function(n,t){return n?.multiAccountAwarePlugin?t.getAllPluginSettings().then(function(n){return i(n,function(n){return!!n?.data?.orgSettings?.pluginForceWICExperienceEnabled})}):t.getPluginSettings().then(function(n){return!!n?.orgSettings?.pluginForceWICExperienceEnabled})},l.resetForceWICPlugin=function(t,o){return f([t.getDBGPluginSettings(),t.getAllowListedOktaAccounts()]).spread(function(n,e){return l.isForceWICExperienceEnabled(n,t).then(function(n){var t=i(e,function(n){return C(n.orgDomainUrl)});if(n&&t)return f([o.clearPersistentStorage(),o.clearAllSessionState()]).then(function(){window.location.reload()})})})}}();