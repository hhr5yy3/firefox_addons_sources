"undefined"==typeof _idaptiveUniqueGlobal&&(_idaptiveUniqueGlobal={}),function(){function I(e,t,i,n,r){var s=Math.random();browser.runtime.onMessage.addListener(function(e){e.action==M.communication.CentrifyEventEnum.centrifyServiceResponse&&e.data.messageId!==s||(browser.runtime.onMessage.addListener(arguments.callee),e.data.success?n(e.data.success):r(e.data.error))}),M.firefox.communicate2Bg.sendMessage2Bg({action:M.communication.CentrifyEventEnum.centrifyServiceRequest,data:{messageId:s,input:t,path:e,method:i}})}var M=this;void 0===M.login&&(M.login={}),void 0===M.capture&&(M.capture={}),M.firefox.i18n={get:function(e){return browser.i18n.getMessage(e)}};M.login.CentrifyBEShade=function(){M.login.CentrifyBEShadeBase.call(this),this.logWithLevel=M.firefox.Log.prototype.logWithLevel;var t=this;this.shadeListener=function(e){t.shadeListenerHandler.call(t,e)}},M.login.CentrifyBEShade.prototype={checkIfAddShade:function(t){var i=this;M.firefox.communicate2Bg.sendMessage2Bg({action:M.communication.CentrifyEventEnum.getLoginData},function(e){i.checkIfAddShadeCallBack(t,e)},function(e){i.logError(e)})}},M.common.objectExtend(M.login.CentrifyBEShade,M.login.CentrifyBEShadeBase),M.login.centrifyBEShade=new M.login.CentrifyBEShade,M.firefox.communicate2Bg.sendMessage2Bg({action:M.communication.CentrifyEventEnum.initAll},function(e){M.login.centrifyBEShade.debugMode=e.debugMode,M.login.centrifyBEShade.preCheckPage(document)}),M.capture.FIELD_TYPE={TYPE_USERNAME:"username",TYPE_PASSWORD:"password",TYPE_SUBMIT:"submit",TYPE_OTHER:"other",TYPE_UNKNOWN:"unknown",TYPE_IGNORE:"ignore"},M.capture.Field=function(e){this.element=e,this.type=M.capture.FIELD_TYPE.TYPE_UNKNOWN,this.score=0},M.capture.Field.prototype={getElementType:function(){return this.element.type.toLowerCase()}},M.capture.CaptureLog=function(e){this.doc=e,this.logs=[],this.html=e.documentElement.outerHTML},M.capture.CaptureLog.prototype={logWithLevel:M.firefox.Log.prototype.logWithLevel,toData:function(){var e="\0CaptureHTML\n"+encodeURI(this.html)+"\n";return M.internal.generateDiagnosisData(this.logs,e)}},M.capture.LoginForm=function(e,t){M.common.CentrifyBEBase.call(this),this.formElement=e,this.fields=[],this.score=0,this.captureLog=t,this.logWithLevel=M.capture.CaptureLog.prototype.logWithLevel,this.latestLoginFields={username:null,password:null,submit:null,form:null},this.bestFields=null},M.capture.LoginForm.prototype={loggerName:"CaptureForm",usernamePattern:/(username)|(email)|((user)?id)|(^id[^a-z])|([^a-z]id$)/i,passwordPattern:/(password)|(passwd)|(pwd)|(^id[^a-z])|([^a-z]id$)/i,submitTextPattern:/^\s*((log\s*in)|(sign\s*in)|(submit))\s*$/i,submitTextPattern2:/((log\s*in)|(sign\s*in)|(submit))/i,isInputIgnore:function(e){var e=e.element,t=e.type.toLowerCase();return!("hidden"!==t&&"checkbox"!==t&&!e.readonly&&!e.disabled)},analysis:function(){this.log("Analysis form "+M.capture.findCssSelector(this.formElement));var e=this.formElement.querySelectorAll("input");this.log("The form has "+e.length+" input fields");for(var t=0;t<e.length;t++)this.fields.push(new M.capture.Field(e[t]));for(t=0;t<this.fields.length;t++){var i=this.fields[t];this.analysisInputField(i),this.log("The input field type is "+i.type)}null===this.latestLoginFields.submit&&(this.log("Latest submitField is not found, call findSubmitFieldByButton()"),this.findSubmitFieldByButton()),null===this.latestLoginFields.submit&&(this.log("Latest submitField is not found, call findSubmitFieldByContent()"),this.findSubmitFieldByContent())},findSubmitFieldByButton:function(){for(var e,t=this.formElement.querySelectorAll("button[type=submit]"),i=(this.fields.length,0);i<t.length;i++)M.capture.isElementVisiable(t[i])&&(e=new M.capture.Field(t[i]),this.analysisSubmit(e),this.log("findSubmitFieldByButton = "+e.type),this.fields.push(e))},findSubmitFieldByContent:function(){var e=[];this.visitSubmitFieldNode(this.formElement,e);for(var t,i=0;i<e.length;i++)M.capture.isElementVisiable(e[i])&&(t=new M.capture.Field(e[i]),this.analysisSubmit(t),this.fields.push(t))},visitSubmitFieldNode:function(e,t){e.text&&(e.text.match(this.submitTextPattern2)||e.text.match(this.submitTextPattern))&&t.push(e);for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];this.visitSubmitFieldNode(n,t)}},analysisInputField:function(e){var t=e.element;this.isInputIgnore(e)||!M.capture.isElementVisiable(t)?e.type=M.capture.FIELD_TYPE.TYPE_IGNORE:"email"===(t=t.type.toLowerCase())||"text"===t?this.analysisUsername(e):"password"===t?this.analysisPassword(e):"submit"===t||"button"===t||"image"===t?this.analysisSubmit(e):this.analysisOther(e)},analysisUsername:function(e){var t=e.element;t.id&&t.id.match(this.usernamePattern)||t.name&&t.name.match(this.usernamePattern)?(""!==t.value?e.score=100:e.score=80,this.log("setting latest username to "+M.capture.findCssSelector(t)),this.latestLoginFields.username=e):""!==t.value?e.score=10:e.score=0,e.type=M.capture.FIELD_TYPE.TYPE_USERNAME},analysisPassword:function(e){var t=e.element;t.id&&t.id.match(this.passwordPattern)||t.name&&t.name.match(this.passwordPattern)?""!==t.value?e.score=100:e.score=80:e.score=25,this.latestLoginFields.password=e,this.log("setting latest password to "+M.capture.findCssSelector(t)),e.type=M.capture.FIELD_TYPE.TYPE_PASSWORD},analysisSubmit:function(e){var t=e.element;switch(e.score=0,t.tagName){case"INPUT":var i=t.value&&t.value.match(this.submitTextPattern)||t.name&&t.name.match(this.submitTextPattern);switch(t.type.toLowerCase()){case"submit":e.score=100;break;case"button":e.score=i?90:82;break;case"image":e.score=i?85:78}break;case"A":!t.href||"#"!==t.href&&""!==t.href?(t.href&&t.href.match(/^javascript:/)||t.onclick)&&(e.score=40):e.score=75;break;case"BUTTON":"submit"==t.type.toLowerCase()&&(e.score=75)}0===e.score&&t.text&&(t.text.match(this.submitTextPattern)?e.score=25:t.text.match(this.submitTextPattern2)&&(e.score=12)),0===e.score?this.analysisOther(e):(this.latestLoginFields.submit=e,this.log("setting latest submit to "+M.capture.findCssSelector(t)),e.type=M.capture.FIELD_TYPE.TYPE_SUBMIT)},analysisOther:function(e){e.type=M.capture.FIELD_TYPE.TYPE_OTHER},calcauteScore:function(){var e={username:0,password:0,submit:0,other:0,ignore:0,unknown:0},t={username:0,password:0,submit:0};this.bestFields={username:null,password:null,submit:null};for(var i=0;i<this.fields.length;i++){var n=this.fields[i];this.logTrace("field : "+M.capture.findCssSelector(n.element)+", type = "+n.type+", score = "+n.score),n.type===M.capture.FIELD_TYPE.TYPE_USERNAME?(t.username=0===e.username?n.score:0,(!this.bestFields.username||n.score>this.bestFields.username.score)&&(this.bestFields.username=n),e.username++):n.type===M.capture.FIELD_TYPE.TYPE_PASSWORD?(t.password=0===e.password?n.score:0,(!this.bestFields.password||n.score>this.bestFields.password.score)&&(this.bestFields.password=n),e.password++):n.type===M.capture.FIELD_TYPE.TYPE_SUBMIT?(t.submit=0===e.submit?n.score:0,(!this.bestFields.submit||n.score>this.bestFields.submit.score)&&(this.bestFields.submit=n),e.submit++):n.type===M.capture.FIELD_TYPE.TYPE_OTHER?e.other++:n.type===M.capture.FIELD_TYPE.TYPE_IGNORE?e.ignore++:e.unknown++}return this.logTrace("username = #"+e.username+", "+t.username+" pts"),this.logTrace("password = #"+e.password+", "+t.password+" pts"),this.logTrace("submit = #"+e.submit+", "+t.submit+" pts"),this.logTrace("other = #"+e.other),this.logTrace("ignore = #"+e.ignore),this.logTrace("unknown = #"+e.unknown),this.score=t.username+t.password+t.submit+(1==e.username&&1==e.password&&1==e.submit?300:0),this.logTrace("score = "+this.score),this.score},getLoginFields:function(){return null===this.bestFields.username||null===this.bestFields.password?(this.logTrace("missing one of the username/password/submit field, "+(this.bestFields.username?"U":"u")+(this.bestFields.password?"P":"p")+(this.bestFields.submit?"S":"s")),null):{usernameField:this.bestFields.username.element,passwordField:this.bestFields.password.element,submitField:this.bestFields.submit?this.bestFields.submit.element:null,formField:this.formElement}}},M.common.objectExtend(M.capture.LoginForm,M.common.CentrifyBEBase),M.capture.CaptureEngine=function(e,t){M.common.CentrifyBEBase.call(this),this.doc=e,this.captureLog=t,this.logWithLevel=M.capture.CaptureLog.prototype.logWithLevel},M.capture.CaptureEngine.prototype={loggerName:"CaptureEngine",start:function(){for(var e=this.doc.URL,t=(this.log("start capture, url = "+e),this.setAppUrl(e),this.querySelectorAll(this.doc,"form input[type=password]")),i=(this.log("found "+t.length+" password elements inside a form"),[]),n=0;n<t.length;n++){var r=t[n];if(this.log("checking passwordElement "+M.capture.findCssSelector(r)),M.capture.isElementVisiable(r)){this.log("passwordElement is visible");var s=M.capture.findParent(r,"FORM");if(s){this.log("passwordElement is belong to the form "+M.capture.findCssSelector(s));for(var o=!1,l=0;l<i.length;l++)if(i[l].formElement===s){o=!0;break}o?this.log("already added this form"):(this.log("this is a new form, ADD"),i.push(new M.capture.LoginForm(s,this.captureLog)))}else this.log("this password element is not belong to a form, TODO")}else this.log("passwordElement is not visible, ignore.")}this.log("Base on the input[type=password], I found "+i.length+" forms");for(n=0;n<i.length;n++){var a=i[n];a.analysis(),a.calcauteScore()}return 0<i.length&&i.sort(function(e,t){return t.score-e.score}),i},setAppUrl:function(e){}},M.common.objectExtend(M.capture.CaptureEngine,M.common.CentrifyBEBase),M.capture.CaptureUI=function(e,t,i){M.common.CentrifyBEBase.call(this),this.doc=e,this.userSetting=t,this.captureLog=i,this.logWithLevel=M.capture.CaptureLog.prototype.logWithLevel,this.highlights={username:null,password:null,corpId:null,submit:null,overlay:null,wizard:null,wizardDragListener:null,highlightClickListener:null,highlightInspectListener:null,previousMouseOverElement:null,previousMouseOverBg:null,windowResizeListener:null},this.mySelectedLoginFields=null,this.userSelectedLoginFields={usernameField:null,passwordField:null,corpIdField:null,submitField:null,formField:null},this.appDetail={name:null,description:null,url:null,icon:null,usernameField:null,passwordField:null,corpIdField:null,submitField:null,formField:null,formAction:null,version:1};var n=this;this.windowResizeListener=function(){function e(e){var t;e&&e.arrow&&(t=n.findPosition(e.element),e.arrow.style.left=t.left+4+"px",e.arrow.style.top=t.top+4+"px")}e(n.highlights.username),e(n.highlights.password),e(n.highlights.corpId),e(n.highlights.submit)}},M.capture.CaptureUI.prototype={loggerName:"CaptureUI",CAPTRUE_OVERLAY_ID:"centrify::capture.background",CAPTRUE_WIZARD_ID:"centrify::capture.wizard",arrow:M.brand.captureUIArrow,logo:M.brand.captureUILogo,radioButtonSpriteSheet:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAeCAMAAADEgrRGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AYdAQInYV12HgAAAhBQTFRFAAAAr6+vy8vLra2ty8vLra2tr6+vycnJycnJzMzMxMTEzMzMq6urtLS0q6urtLS0xMTEeqLBkLXQkbbSeaHBj7TRkLXSeqPCeaLDdZ/CdJ/CfKXGiLDPjrbTjrXTe6TGiK/Pra2tsrKyy8vLra2tsrKyx8fHx8fHzMzMwsLCzMzMq6urt7e3q6urt7e3wsLCq6urzMzMq6urv7+/urq6urq6v7+/YJrLcqjTdarUYJrLcafUdKnUYZzOYp3NWpjMYp7QaaPTcKnWYZ7QaKPTq6urvLy8zMzMOXWtOX26Oo/aO4G/PoG9P4jKP5HaQIvOQY3PQZLbQo7RQ5LWRI/RRJLWRJTZRZTZRoXAS5bWTJfWTpjWT5nWT5rZT5raWJ7XY5K7Y5TAZJK8Z5fBZ6jiaanja6rjbKLRbaXYbqzjcaXScajZdK/idbDidrDieLHirtDvr9HvsbGxs9Pvs9TwtNTvtNTwttXwuNbxudfxvLy8vNjxv9rxv9rywMDAwcHBwdvywtzyxsbGx8fHysrK0tLS1tbW19fX3t7e39/f3+fu4Ojv4eHh4uLi4+z05O305eXl5ubm5u725u/26Ojo6enp6urq6vL56/P57Ozs7PT67PT77e3t7fT78PDw8fHx8vLy8/Pz9PT09fX19vb29/f3+Pj4+fn5+vr6+vr7+/v7+/3+/Pz8/f39/v7+////Rz2T/gAAAEh0Uk5TACsrLCwvLzA0Oz09Pj4/QUFtbW5zdHR6fouOjpCQkpWVlpaWmJiZnaSmpqenqKqq5OTl5ufo6O3t7e7u7vDw9PT19fb2+v39hdqjtgAAAAFiS0dEr85sozEAAAFYSURBVBjTTc9VWwJBGIbhz+7uDuzuVmzFxG7sbuxGBRW7sHVZ3AFdAf+is9fuqs/JzHv23QA4m6jkiuQYO2AzFRw86r51L4cCc2ZayW+NbCq5Nd4RKqOBzaiKBLBVGPR8BoUzRKvoDz76LhEykO4vlArrNPqLLod0ClF8iEqDuEtKw0ddJYDDnpZUs5HafSeAUCWlJpjUlDIc32MiPUIk8UaQ6EhqyRxsFrJ9SiDibCfMghPZxyaVpcQ7Al9AcW9Pb3Egt9yyp2XPX6+7s3mezHSVLHHeFYkH3lkLv96VXAD/qX/emWAo2sTe44HKvhPslZVC1xN29ouqRYP4feiGVsZbU1tf247fzzboeMDeUXGjeAJ77zuhcAN7zyebxy6wd6sE/EawV6P/1muwdzwIoGCR974v5+N7vOrmOO98gzdzsEvm0Oo1ulkbznHnRD7ClqomoS/z/QG59cC3j9VlWAAAAABJRU5ErkJggg==",defaultStyle:{"background-color":"transparent",background:"none",border:"0px","border-collapse":"separate","border-radius":0,"border-spacing":"0px","box-shadow":"none","box-sizing":"content-box","-moz-box-sizing":"content-box",color:"#444444",float:"none",clear:"none","font-family":"Open Sans, Verdana, Arial","font-size":"16px","font-style":"normal","font-variant":"normal","font-weight":"normal","font-size-adjust":"none","letter-spacing":"normal","line-height":"normal","white-space":"normal","word-spacing":"normal","-moz-hyphens":"manual",outline:"invert none medium","-moz-appearance":"none",transition:"none",margin:"0px","min-height":"0px","min-width":"0px",padding:"0px","table-layout":"auto","empty-cells":"show","text-align":"left","text-indent":"0px","text-shadow":"none","text-transform":"none","vertical-align":"baseline",width:"auto",height:"auto",position:"static",left:"auto",top:"auto",opacity:"1"},defaultIconSize:60,setStyle:function(e,t){for(var i in t)try{e.style.setProperty(i,t[i],"important")}catch(e){this.logWarn("Can't set my style "+i+" for tag "+tagName)}},createElement:function(e,t,i){var n,r,s=this.doc.createElement(t);for(n in this.defaultStyle)try{s.style.setProperty(n,this.defaultStyle[n],"important")}catch(e){this.logWarn("Can't set default style "+n+" for tag "+t)}switch(t.toLowerCase()){case"div":case"form":case"section":case"form":r="block";break;case"table":r="table";break;case"td":case"th":r="table-cell";break;case"tr":r="table-row";break;case"col":r="table-column";break;case"li":r="list-item";break;default:r="inline"}return s.style.setProperty("display",r,"important"),this.setStyle(s,i),e.appendChild(s),s},createSubHeaderElement:function(e,t,i){e=this.createElement(e,t,i);return e.style.setProperty("font-size","15px","important"),e.style.setProperty("font-weight","bold","important"),e},createPageDescElement:function(e,t,i){e=this.createElement(e,t,i);return e.style.setProperty("font-size","14px","important"),e.style.setProperty("line-height","28px","important"),e.style.setProperty("margin-top","5px","important"),e.style.setProperty("min-height","34px","important"),e},init:function(e){this.log("allPossibleForms.length = "+e.length);function t(e){if(e=e||event||null,i)return d.setStyle(i,{left:e.pageX-r.x+"px",top:e.pageY-r.y+"px"}),!(e.cancelBubble=!0)}var i,n=this.createElement(this.doc.body,"div"),r=(n.id=this.CAPTRUE_OVERLAY_ID,this.highlights.overlay=n,0<e.length?(n=e[0].getLoginFields(),this.mySelectedLoginFields=n):this.mySelectedLoginFields=null,this.initAppDetail(),{x:0,y:0}),h=[],d=this,s=this.createElement(this.doc.body,"table",{position:"absolute",top:"100px",left:"100px",width:"500px",height:"360px","border-spacing":"0px",border:"0px","z-index":"2147483647","border-radius":"4px","box-shadow":"-3px 5px 5px rgba(0, 0, 0, 0.2)","line-height":"normal","image-rendering":"auto"}),e=(s.id=this.CAPTRUE_WIZARD_ID,this.createElement(s,"tr",{cursor:"move"})),n=this.createElement(e,"td",{height:"60px","background-color":"#ffffff",border:"1px solid #cccccc","border-radius":"4px 4px 0px 0px","vertical-align":"middle"}),o=this.createElement(n,"img",{float:"left",height:"40px",width:"40px",cursor:"default",margin:"0px 0px 0px 26px"});o.src=this.logo;this.createElement(n,"div",{float:"left","font-weight":"bold","font-size":"18px",color:"#444444","line-height":"22px","padding-left":"10px","user-select":"none","-moz-user-select":"none",margin:"8px 0px 0px 8px"}).innerHTML=M.firefox.i18n.get("AppCaptureUtility");var l=this.createElement(n,"img",{float:"right",height:"17px",width:"17px",cursor:"pointer",margin:"12px 18px 0px 0px"}),n=(l.src=M.brand.closeDialogIcon,l.onclick=function(){d.onUnload()},e.onmousedown=function(e){var t=(e=e||event||null).target;t!==o&&t!==l&&(i=s,t=M.capture.shmGetPos(i),r.x=e.pageX-t.X,r.y=e.pageY-t.Y)},e.onmouseup=function(){i&&(d.setStyle(i,{cursor:"auto"}),i=null)},this.createElement(s,"tr",{height:"232px"})),e=this.createElement(n,"td",{"background-color":"#ffffff","border-left":"1px solid #cccccc","border-right":"1px solid #cccccc"}),p=(e.vAlign="top",d.createElement(e,"div",{margin:"20px 30px 5px 30px","font-size":"13px","line-height":"28px",width:"452px"})),n=this.createElement(s,"tr"),e=this.createElement(n,"td",{height:"50px","background-color":"#ffffff","border-left":"1px solid #cccccc","border-right":"1px solid #cccccc","border-bottom":"1px solid #cccccc","border-radius":"0px 0px 4px 4px","vertical-align":"middle"}),n=this.createElement(e,"div",{display:"inline",float:"left"}),c=this.createElement(n,"button",{"border-radius":"4px",border:"1px solid #d7d7d7","background-color":"#f0f0f0",color:"#362f2d","font-size":"13px",height:"30px","margin-left":"30px","margin-bottom":"20px",cursor:"pointer","text-align":"center","min-width":"70px"}),n=(c.innerHTML=M.firefox.i18n.get("SetManually"),c.onmouseover=function(){d.setStyle(c,{"background-color":"#e4e4e4"})},c.onmouseout=function(){d.setStyle(c,{"background-color":"#f0f0f0"})},c.onmousedown=function(){d.setStyle(c,{border:"1px solid #cecece"})},c.blur=function(){d.setStyle(c,{border:"1px solid #d7d7d7"})},this.createElement(e,"div",{display:"inline"}));function a(e){d.setStyle(e,{"border-radius":"4px","font-size":"13px","min-width":"70px",height:"30px","margin-right":"30px","margin-bottom":"20px","text-align":"center"})}function g(e){e.disabled=!1,d.setStyle(e,{cursor:"pointer",color:"#ffffff","background-color":"#0280e5"}),e.onmouseover=function(){d.setStyle(e,{"background-color":"#0172ce"})},e.onmouseout=function(){d.setStyle(e,{"background-color":"#0280e5"})}}function u(e){e.disabled=!1,d.setStyle(e,{cursor:"pointer",color:"#362f2d","background-color":"#f0f0f0"}),e.onmouseover=function(){d.setStyle(e,{"background-color":"#e4e4e4"})},e.onmouseout=function(){d.setStyle(e,{"background-color":"#f0f0f0"})}}function f(e){e.disabled=!0,d.setStyle(e,{cursor:"default",color:"#ffffff","background-color":"#87c3f0"}),e.onmouseover=null,e.onmouseout=null}var m=this.createElement(n,"button"),y=(a(e=m),d.setStyle(e,{border:"1px solid #d7d7d7","background-color":"#f0f0f0",color:"#362f2d","margin-left":"30px"}),m.innerHTML=M.firefox.i18n.get("Back"),m.onclick=function(){d.transitToNewPage(),h.pop()()},this.createElement(n,"button"));function x(e,t,i){if(Array.isArray(i)&&!(i.length<1)){for(var n=[],r=function(){for(var e=0;e<n.length;e++)n[e].radio.checked?n[e].label.style.backgroundPosition="0px -15px":n[e].label.style.backgroundPosition="0px 0px"},s=0;s<i.length;s++){var o=d.createElement(e,"input"),l=(o.type="radio",o.name=d.CAPTRUE_WIZARD_ID+"-"+t,o.id=t+"_"+s,o.onclick=function(){g(y)},d.createElement(e,"label",{"background-color":"transparent","background-image":"url("+d.radioButtonSpriteSheet+")","background-position":"0px 0px","background-repeat":"no-repeat",cursor:"pointer",display:"inline-block","font-size":"14px",height:"15px","line-height":"13px",margin:0===s?"20px 0px 0px 0px":"10px 0px 0px 0px","padding-left":"25px"}));l.htmlFor=o.id,l.appendChild(d.doc.createTextNode(i[s])),d.createElement(e,"br"),o.onchange=r,n.push({radio:o,label:l})}return n}}function b(){return-1==h.indexOf(E)&&-1==h.indexOf(S)}function v(e){do{if(e===d.highlights.overlay||e===s)return 1}while(e=e.parentNode)}function E(){for(;p.firstChild;)p.removeChild(p.firstChild);d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("ManualCaptureUsername"),d.createElement(p,"br");var e,t;d.createPageDescElement(p,"div").appendChild(d.doc.createTextNode(M.firefox.i18n.get("ClickUsernameFieldToCapture"))),d.userSetting.canCreateAppInAP&&((e=d.createElement(p,"div",{"font-size":"14px",height:"56px",padding:"80px 0px 0px 0px"})).appendChild(d.doc.createTextNode(M.firefox.i18n.get("HavingTrouble")+" ")),(t=d.createElement(e,"a",{"font-size":"13px",color:"#1288DE"})).appendChild(d.doc.createTextNode(M.firefox.i18n.get("ReportProblem"))),t.onmouseover=function(){d.setStyle(t,{cursor:"pointer"})},t.onmouseout=function(){d.setStyle(t,{cursor:"default"})},t.onclick=function(){d.transitToNewPage(),h.push(E),F()}),d.highlights.username&&(d.unhighlightField(d.highlights.username),d.highlights.username=null);function i(e){if(!v(e)&&("INPUT"===e.tagName&&!e.disabled))return-1==["button","file","hidden","image","reset","submit"].indexOf(e.type)?1:void 0}d.highlights.highlightInspectListener=function(e){d.highlights.previousMouseOverElement&&(d.highlights.previousMouseOverElement.style.background=d.highlights.previousMouseOverBg,d.highlights.previousMouseOverElement=null);var t=e.target;i(t)&&(e.relatedTarget||e.fromElement,d.highlights.previousMouseOverElement=t,d.highlights.previousMouseOverBg=t.style.background,t.style.background="rgba(181, 209, 233, 0.8)")},d.doc.addEventListener("mouseover",d.highlights.highlightInspectListener),d.highlights.highlightClickListener=function(e){e=e.target;i(e)&&(d.highlightUsername(e),d.userSelectedLoginFields.usernameField=e,d.transitToNewPage(),h.push(E),S())},d.doc.addEventListener("click",d.highlights.highlightClickListener,!0),d.setStyle(m,{display:"inline"}),u(m),d.setStyle(y,{display:"none"}),d.setStyle(c,{display:"none"}),d.addIframeCover(P)}function S(){for(;p.firstChild;)p.removeChild(p.firstChild);d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("ManualCapturePassword"),d.createElement(p,"br");var e,t;d.createPageDescElement(p,"div").appendChild(d.doc.createTextNode(M.firefox.i18n.get("ClickPasswordFieldToCapture"))),d.userSetting.canCreateAppInAP&&((e=d.createElement(p,"div",{"font-size":"14px",height:"56px",padding:"80px 0px 0px 0px"})).appendChild(d.doc.createTextNode(M.firefox.i18n.get("HavingTrouble")+" ")),(t=d.createElement(e,"a",{"font-size":"13px",color:"#1288DE"})).appendChild(d.doc.createTextNode(M.firefox.i18n.get("ReportProblem"))),t.onmouseover=function(){d.setStyle(t,{cursor:"pointer"})},t.onmouseout=function(){d.setStyle(t,{cursor:"default"})},t.onclick=function(){d.transitToNewPage(),h.push(S),F()}),d.highlights.password&&(d.unhighlightField(d.highlights.password),d.highlights.password=null);function i(e){if(!v(e)&&("INPUT"===e.tagName&&!e.disabled))return-1==["button","checkbox","file","hidden","image","radio","reset","submit"].indexOf(e.type)?1:void 0}d.highlights.highlightClickListener=function(e){var t=e.target;i(t)&&(d.highlightPassword(t),e.stopPropagation(),d.userSelectedLoginFields.passwordField=t,d.transitToNewPage(),h.push(S),T())},d.doc.addEventListener("click",d.highlights.highlightClickListener,!0),d.setStyle(m,{display:"inline"}),u(m),d.setStyle(y,{display:"none"}),d.setStyle(c,{display:"none"}),d.highlights.highlightInspectListener=function(e){d.highlights.previousMouseOverElement&&(d.highlights.previousMouseOverElement.style.background=d.highlights.previousMouseOverBg,d.highlights.previousMouseOverElement=null);var t=e.target;i(t)&&(e.relatedTarget||e.fromElement,d.highlights.previousMouseOverElement=t,d.highlights.previousMouseOverBg=t.style.background,t.style.background="rgba(181, 209, 233, 0.8)")},d.doc.addEventListener("mouseover",d.highlights.highlightInspectListener),d.addIframeCover(P)}function w(){for(;p.firstChild;)p.removeChild(p.firstChild);function i(){d.transitToNewPage(),h.push(w),L()}d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("ManualCaptureSignInAction"),d.createElement(p,"br"),d.createPageDescElement(p,"div").appendChild(d.doc.createTextNode(M.firefox.i18n.get("SelectSignInToCapture"))),d.createElement(p,"br");var e=x(d.createElement(p,"div",{display:"block","font-size":"13px"}),"optionEnter",[M.firefox.i18n.get("UseKeyboardEnterKeyEvent"),M.firefox.i18n.get("RightClickToCapture")]),t=(d.setStyle(e[0].label,{"line-height":"14px"}),e[0].radio);t.checked="true",t.onchange(),t.addEventListener("change",function(){g(y),d.transitToNewPage()}),d.setStyle(e[1].label,{"line-height":"14px","margin-top":"18px"}),e[1].radio.addEventListener("change",function(){f(y),d.transitToNewPage(),d.highlights.highlightClickListener=function(e){var t=e.target;v(t)||(d.highlightSubmit(t),e.stopPropagation(),e.preventDefault(),d.userSelectedLoginFields.submitField=t,i())},d.doc.addEventListener("contextmenu",d.highlights.highlightClickListener,!0),d.highlights.highlightInspectListener=function(e){d.highlights.previousMouseOverElement&&(d.highlights.previousMouseOverElement.style.background=d.highlights.previousMouseOverBg,d.highlights.previousMouseOverElement=null);var t=e.target;v(t)||(e.relatedTarget||e.fromElement,d.highlights.previousMouseOverElement=t,d.highlights.previousMouseOverBg=t.style.background,t.style.background="rgba(181, 209, 233, 0.8)")},d.doc.addEventListener("mouseover",d.highlights.highlightInspectListener)}),d.highlights.submit&&(d.unhighlightField(d.highlights.submit),d.highlights.submit=null),d.setStyle(m,{display:"inline"}),u(m),d.setStyle(y,{display:"inline"}),y.innerHTML=M.firefox.i18n.get("Next"),g(y),y.onclick=i,d.setStyle(c,{display:"none"}),d.addIframeCover(P)}function T(){for(;p.firstChild;)p.removeChild(p.firstChild);d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("AdditionalLoginField"),d.createPageDescElement(p,"div").innerHTML=M.firefox.i18n.get("hasAdditionalCorporateID");var e=x(d.createElement(p,"div",{display:"block","font-size":"13px",padding:"15px 0px 15px 0px"}),"needCorpId",[M.firefox.i18n.get("No"),M.firefox.i18n.get("Yes")])[1].radio;d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("SelectorTimeoutField");d.createPageDescElement(p,"div").innerHTML=M.firefox.i18n.get("SelectorTimeoutDescription");var t=d.createElement(p,"input",{color:"#362f2d","font-size":"13px",width:"338px",height:"28px","border-radius":"3px",border:"1px solid #d7d7d7",margin:"15px 0px 15px 0px",padding:"0px 10px 0px 10px"});t.type="number",t.min=0,t.max=6e4,t.value=2e3,t.onchange=function(){this.value<0?this.value=0:6e4<this.value&&(this.value=6e4)},d.setStyle(m,{display:"inline"}),u(m),d.setStyle(y,{display:"inline"}),y.innerHTML=M.firefox.i18n.get("Next"),y.onclick=function(){if(d.transitToNewPage(),d.appDetail.selectorTimeout=t.value.trim(),h.push(T),e.checked)if(d.userSetting.canCreateAppInAP)C();else{for(;p.firstChild;)p.removeChild(p.firstChild);d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("AdditionalLoginField"),d.createElement(p,"br"),p.appendChild(d.doc.createTextNode(M.firefox.i18n.get("AddAdditionalFieldNeedAdministratorsContactAdministrator"))),d.setStyle(m,{display:"inline"}),u(m),d.setStyle(y,{display:"none"}),f(y)}else(b()?L:w)()},f(y),d.setStyle(c,{display:"none"})}function C(){for(;p.firstChild;)p.removeChild(p.firstChild);d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("ManualCaptureAdditionalField");d.createPageDescElement(p,"div").innerHTML=M.firefox.i18n.get("ClickAdditionalFieldToCapture"),d.highlights.corpId&&(d.unhighlightField(d.highlights.corpId),d.highlights.corpId=null);function i(e){if(!v(e)&&("INPUT"===e.tagName&&!e.disabled))return-1==["button","file","hidden","image","reset","submit"].indexOf(e.type)?1:void 0}d.highlights.highlightInspectListener=function(e){d.highlights.previousMouseOverElement&&(d.highlights.previousMouseOverElement.style.background=d.highlights.previousMouseOverBg,d.highlights.previousMouseOverElement=null);var t=e.target;i(t)&&(e.relatedTarget||e.fromElement,d.highlights.previousMouseOverElement=t,d.highlights.previousMouseOverBg=t.style.background,t.style.background="rgba(181, 209, 233, 0.8)")},d.doc.addEventListener("mouseover",d.highlights.highlightInspectListener),d.highlights.highlightClickListener=function(e){e=e.target;i(e)&&(d.highlightCorpId(e),d.userSelectedLoginFields.corpIdField=e,d.transitToNewPage(),h.push(C),(b()?L:w)())},d.doc.addEventListener("click",d.highlights.highlightClickListener,!0),d.setStyle(m,{display:"inline"}),u(m),d.setStyle(y,{display:"none"}),d.setStyle(c,{display:"none"}),d.addIframeCover(P)}function L(){for(;p.firstChild;)p.removeChild(p.firstChild);function i(e){for(;e.parentNode&&(e=e.parentNode);)if(e instanceof ShadowRoot)return e}var e=d.createElement(p,"table"),t=d.createElement(e,"tr"),n=d.createElement(t,"td"),n=(d.createElement(n,"div",{"font-size":"13px","font-weight":"bold","text-align":"right"}).innerHTML=M.firefox.i18n.get("Name"),d.createElement(t,"td")),r=(n.setAttribute("colspan","3"),d.createElement(n,"input",{color:"#362f2d","font-size":"13px",width:"338px",height:"28px","border-radius":"3px",border:"1px solid #d7d7d7","margin-left":"10px",padding:"0px 10px 0px 10px"})),t=(r.value=d.appDetail.name,r.onkeyup=function(){(0<r.value.trim().length?g:f)(y)},d.createElement(e,"tr")),n=d.createElement(t,"td"),n=(d.createElement(n,"div",{"font-size":"13px","font-weight":"bold","text-align":"right"}).innerHTML=M.firefox.i18n.get("Description"),d.createElement(t,"td",{padding:"25px 0px 20px 0px"})),s=(n.setAttribute("colspan","3"),d.createElement(n,"textarea",{color:"#362f2d","font-size":"13px",width:"338px",height:"54px",resize:"none","border-radius":"3px",border:"1px solid #d7d7d7","margin-left":"10px",padding:"0px 10px 0px 10px",overflow:"visible","overflow-x":"visible","overflow-y":"visible","white-space":"pre-wrap"})),t=(s.value=d.appDetail.description,d.createElement(e,"tr")),n=d.createElement(t,"td"),e=(d.createElement(n,"div",{"font-size":"13px","font-weight":"bold","margin-top":"13px","text-align":"right"}).innerHTML=M.firefox.i18n.get("Icon"),d.createElement(t,"td",{"vertical-align":"middle"})),o=d.createElement(e,"input",{color:"#727272","font-size":"13px",width:"165px",height:"28px","margin-left":"10px",padding:"0px 10px 0px 10px","border-radius":"3px",border:"1px solid #d7d7d7"}),n=(o.disabled=!0,d.createElement(t,"td",{"vertical-align":"middle",width:"108px",padding:"0px 8px 0px 0px"})),e=d.createElement(n,"div"),n=d.createElement(e,"input",{"z-index":"2147483647",position:"absolute",opacity:"0",width:"96px",height:"30px",cursor:"pointer"}),l=(n.type="file",d.createElement(e,"button",{"border-radius":"4px","background-color":"#0280e5",color:"#ffffff","font-size":"13px",width:"112px",height:"30px","text-align":"center"})),e=(l.innerHTML=M.firefox.i18n.get("Browsing"),n.onmouseover=function(){d.setStyle(l,{"background-color":"#0172ce"})},n.onmouseout=function(){d.setStyle(l,{"background-color":"#0280e5"})},d.createElement(t,"td",{"vertical-align":"middle"})),a=d.createElement(e,"img",{width:"40px",height:"40px",border:"1px solid #d7d7d7","border-radius":"10px",float:"left",display:d.appDetail.icon?"block":"none"});d.appDetail.icon&&(a.src=d.appDetail.icon),n.onchange=function(e){var t,e=e.target.files[0];e&&(a.src=null,d.setStyle(a,{display:"none"}),o.value=e.name,(t=new FileReader).onload=function(e){var i=d.doc.createElement("img");i.crossOrigin="Anonymous",i.onload=function(){var e=d.doc.createElement("canvas"),t=e.getContext("2d"),t=(e.height=d.defaultIconSize,e.width=d.defaultIconSize,t.drawImage(i,0,0,d.defaultIconSize,d.defaultIconSize),e.toDataURL());1e6<t.length?o.value="Invalid image":(a.src=t,d.setStyle(a,{display:"block"}))},i.onerror=function(){o.value="Invalid image"},i.src=e.target.result},t.readAsDataURL(e))},d.setStyle(m,{display:"inline"}),u(m),d.setStyle(y,{display:"inline"}),(0<r.value.trim().length?g:f)(y);y.innerHTML=M.firefox.i18n.get("Finish"),y.onclick=function(){var e;if(d.highlights.username.element&&d.highlights.password.element?(d.appDetail.usernameField=M.capture.findCssSelector(d.highlights.username.element),e=i(d.highlights.username.element),d.appDetail.usernameField=(null!=e?e.host.tagName+" #shadow-root ":"")+d.appDetail.usernameField,d.appDetail.passwordField=M.capture.findCssSelector(d.highlights.password.element),e=i(d.highlights.password.element),d.appDetail.passwordField=(null!=e?e.host.tagName+" #shadow-root ":"")+d.appDetail.passwordField,d.highlights.corpId&&(d.appDetail.corpIdField=M.capture.findCssSelector(d.highlights.corpId.element),e=i(d.highlights.corpId.element),d.appDetail.corpIdField=(null!=e?e.host.tagName+" #shadow-root ":"")+d.appDetail.corpIdField),d.highlights.submit&&(d.appDetail.submitField=M.capture.findCssSelector(d.highlights.submit.element),e=i(d.highlights.submit.element),d.appDetail.submitField=(null!=e?e.host.tagName+" #shadow-root ":"")+d.appDetail.submitField),(e=M.capture.findParent(d.highlights.password.element,"FORM"))?(d.appDetail.formField=M.capture.findCssSelector(e),d.appDetail.formAction=e.action,e=i(e),d.appDetail.formField=(null!=e?e.host.tagName+" #shadow-root ":"")+d.appDetail.formField):(d.appDetail.formField=null,d.appDetail.formAction=null)):(d.appDetail.usernameField=M.capture.findCssSelector(d.mySelectedLoginFields.usernameField),e=i(d.mySelectedLoginFields.usernameField),d.appDetail.usernameField=(null!=e?e.host.tagName+" #shadow-root ":"")+d.appDetail.usernameField,d.appDetail.passwordField=M.capture.findCssSelector(d.mySelectedLoginFields.passwordField),e=i(d.mySelectedLoginFields.passwordField),d.appDetail.passwordField=(null!=e?e.host.tagName+" #shadow-root ":"")+d.appDetail.passwordField,d.mySelectedLoginFields.formField?(d.appDetail.formField=M.capture.findCssSelector(d.mySelectedLoginFields.formField),d.appDetail.formAction=d.mySelectedLoginFields.formField.action,e=i(d.mySelectedLoginFields.formField),d.appDetail.formField=(null!=e?e.host.tagName+" #shadow-root ":"")+d.appDetail.formField):(d.appDetail.formField=null,d.appDetail.formAction=null),d.highlights.corpId&&(d.appDetail.corpIdField=M.capture.findCssSelector(d.highlights.corpId.element),e=i(d.highlights.corpId.element),d.appDetail.corpIdField=(null!=e?e.host.tagName+" #shadow-root ":"")+d.appDetail.corpIdField)),d.appDetail.name=r.value.trim(),d.appDetail.description=s.value,d.appDetail.icon=a.src,d.transitToNewPage(),h.push(L),d.userSetting.canCreateAppInAP){if(d.appDetail.corpIdField||!d.userSetting.canCreateAppInUP){for(;p.firstChild;)p.removeChild(p.firstChild);d.createSubHeaderElement(p,"span").innerHTML="Submit App",d.createPageDescElement(p,"div").innerHTML=d.userSetting.canCreateAppInUP?M.firefox.i18n.get("AdditionalFieldForAdminPortalOnly"):M.firefox.i18n.get("SubmitToAdminPortalOnlyForPolicy"),d.setStyle(m,{display:"none"}),d.setStyle(y,{display:"inline"}),y.innerHTML=M.firefox.i18n.get("Submit"),g(y),y.onclick=function(){A(!1)}}else{for(;p.firstChild;)p.removeChild(p.firstChild);d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("SubmitApp"),d.createPageDescElement(p,"div").innerHTML=M.firefox.i18n.get("WhereToAdd");var t=x(d.createElement(p,"div",{display:"block","font-size":"13px",padding:"15px 0px 0px 0px"}),"appType",[M.firefox.i18n.get("AddAppToUP"),M.firefox.i18n.get("AddAppToAP")])[0].radio;d.setStyle(m,{display:"none"}),d.setStyle(y,{display:"inline"}),y.innerHTML=M.firefox.i18n.get("Submit"),f(y),y.onclick=function(){A(t.checked)}}d.setStyle(c,{display:"none"})}else A(!0)},d.setStyle(c,{display:"none"})}function A(r){for(;p.firstChild;)p.removeChild(p.firstChild);d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("SubmitApp");d.createPageDescElement(p,"div").innerHTML=M.firefox.i18n.get("SubmittedToCloudServicesWaitComplete");var e=d.createElement(p,"table",{display:"block",border:"0px",width:"100%",padding:"20px 0px 0px 0px"}),t=d.createElement(e,"tr"),s=(d.createElement(t,"td",{"font-size":"13px"}).innerHTML=M.firefox.i18n.get("Status")+":",d.createElement(t,"td",{"font-size":"13px",padding:"0px 0px 0px 5px"}));s.innerHTML=M.firefox.i18n.get("SendingData"),d.setStyle(m,{display:"none"}),d.setStyle(y,{display:"none"}),d.setStyle(c,{display:"none"}),d.setStyle(e,{display:"block"}),I(r?"/uprest/CreateCapturedPersonalApp":"/SaasManage/CreateCapturedApp",d.appDetail,"post",function(e){if(e.success){d.log("Success: appkey = "+e.Result.appKey);for(var t=r;p.firstChild;)p.removeChild(p.firstChild);d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("AppCaptureComplete"),d.createElement(p,"br"),t=t?M.firefox.i18n.get("AppAddedToUP"):M.firefox.i18n.get("AppAddedToAP"),p.appendChild(d.doc.createTextNode(t)),d.setStyle(m,{display:"none"}),d.setStyle(y,{display:"none"}),d.setStyle(c,{display:"none"})}else{d.logError("Failed: "+this.responseText);var i,n=e.Message+". ";for(i in e.Result)e.Result.hasOwnProperty(i)&&(n+='The "'+i+'" is '+e.Result[i]+". ");s.innerHTML=n}},function(e){var t=e.statusCode,e=e.msg;d.logWarn("There is an error when submitting a captured app. "+e),200==t?s.innerHTML=e:(s.innerHTML=401==t?M.firefox.i18n.get("MustSignIn"):null===t?M.firefox.i18n.get("NetworkErrorTryAgain"):M.firefox.i18n.get("UnknownErrorSubmitAgain"),d.setStyle(y,{display:"inline"}))})}function F(){for(;p.firstChild;)p.removeChild(p.firstChild);d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("SorryForTrouble"),d.createElement(p,"br"),d.createPageDescElement(p,"div").appendChild(d.doc.createTextNode(M.firefox.i18n.get("SendDiagnosticForCapture"))),d.setStyle(m,{display:"none"}),d.setStyle(y,{display:"inline"}),g(y),y.innerHTML=M.firefox.i18n.get("Submit"),y.onclick=function(){d.transitToNewPage(),h.push(F),D()},d.setStyle(c,{display:"none"})}function P(){for(;p.firstChild;)p.removeChild(p.firstChild);var e=d.createElement(p,"table",{border:"0px"}),e=d.createElement(e,"tr"),t=d.createElement(e,"td"),t=(d.createElement(t,"img",{padding:"7px 16px 0px 12px"}).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAtCAMAAADflBjwAAABs1BMVEUAAAD//////4D/qlX/v0D/zDP/qiv/v0D/uS7/sSf/rzD/rij/syb/qiT/ri72qib2pyP3qif4rSb5qCX5qiT5piT5qCn5pif6qCb6pyT1qiP1qCb2pyX2qSf3pyb4qSb4qCT4qSb4qCX1qST1pyT1qCT1qSP2piT3pyX3pyT1qCP1qCT2pyX2qCX2pyT2piP2qCX3piT3pyX1piT1pyP1pyT2qCT2piT2qCX2pyT2pyT3pyT3pyP3piP1pyT1piT1pyP1piT2pyT2piT2piT1pyT1pyT1piP2pyP2pyP2piT2piT2piT1piT1pyP1pyP2piT2pyP2piP2pyT2pyP2piT2pyT1piP1pyP1piT1piP1piP1pyP1piT2piT2pyT2pyP2pyP2pyT2piT2pyT2pyP2piMAAAAHBQEJBgEMCAEPCgIRCwISDAIUDQIXDwMYEAMZEQMaEgMgFgQlGQUpGwU2JQdFLglJMQpLMwpNNAtTOAthQQ1vSw99VRGLXhOMXxSZaBWeaxaocRisdRiyeRm2exrEhBzNix3Oix3QjR3RjR3Sjh7gmCDxoyLypCL1piPm3fwNAAAAZ3RSTlMAAQIDBAUGCAsNEBMUFRYbHSEiKSorLC4vMTM1Nzs9REZKTE1OT1BWWmJmaW5vcXN1eXyBg4WMjZKTlJaXmJqboKGprLK3ubu8vb7Byc/R09fZ2tzh4+Xm6Ozu7/Dx8vP19vn6+/z9PI39PAAAAdJJREFUeAGV0+df02AUxfGD1CEqDq17494bh7hxK1bcgAqljaAgooCUoYCCIrTnTzbJTZMnT9Im/b7/vbjn87kIlbzxovVBHWLbn6blQhXi2ZGlOINYap7TkdmKOM7T9WgBoq3tpOcgojVS8XIJouyiz2lESDyhJZ/PF2h5vxLlHaVpstcw9U7SdA1lLXtDU49h66EpuwnlXKSlW4JuWu6jjKRM2i9BP217Udpt2gYkGKAtlUApuykGJRikOIISFqYohiQYonhdg3DH6BiRYISOeoRa3kLHqASjdHSsQZhLLBqTYIxFNxFifYZF4xKM07UNQXfo+iHBT7oeVkG3h54JCSboOQDNoqf0TEkwRc+zxfA7TsW0BNNUnITPilYqZiSYoeJtLVQNVM1JMEdVAxQbMlTNSzBPVSYJzz36FD4Zpo8F+jTCtY+a398M4+svana6kzYzlqZqiBOM6RBstW3U/ct9+Tw8S92rpbBcoW62yzB1BYuzMG3MUpczbDnq2lfJ4+v6JOhjwHVgMysJOlfjKoNyEgwz6ByaKYJHf/jLoMdIUwRm/f6HIdJ4x4q04xYrchfbs6xEHXC4g7FlT8G0rr6phTG0pS5vQVF1IlI1bP8BJ8/BusrsWMsAAAAASUVORK5CYII=",d.createElement(e,"td",{"font-size":"13px","vertical-align":"top"}));d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("ManualCaptureIFramesNotSupported"),d.createElement(t,"br"),t.appendChild(d.doc.createTextNode(M.firefox.i18n.get("IFramesNotSupportedReport"))),d.setStyle(m,{display:"none"}),d.setStyle(y,{display:"inline"}),g(y),y.innerHTML=M.firefox.i18n.get("Submit"),y.onclick=function(){d.transitToNewPage(),h.push(F),D()},d.setStyle(c,{display:"none"})}function D(){for(;p.firstChild;)p.removeChild(p.firstChild);d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("SendingDiagnosticInfo");d.createPageDescElement(p,"div").innerHTML=M.firefox.i18n.get("PleaseWait2");var e=d.createElement(p,"table",{display:"block",border:"0px",width:"100%",padding:"20px 0px 0px 0px"}),t=d.createElement(e,"tr"),i=(d.createElement(t,"td",{"font-size":"13px"}).innerHTML=M.firefox.i18n.get("Status")+":",d.createElement(t,"td",{"font-size":"13px",padding:"0px 0px 0px 5px"}));i.innerHTML=M.firefox.i18n.get("SendingData"),d.setStyle(m,{display:"none"}),d.setStyle(y,{display:"none"}),d.setStyle(c,{display:"none"}),d.setStyle(e,{display:"block"}),I("/cbe/PostAppCaptureLog",{version:"1",log:d.captureLog.toData(),url:d.doc.URL},"post",function(e){if(e.success){d.log("Success: referenceId = "+e.Result.referenceId);for(var t=e.Result.referenceId;p.firstChild;)p.removeChild(p.firstChild);d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("DiagnosticSubmitted"),d.createElement(p,"br"),p.appendChild(d.doc.createTextNode(M.firefox.i18n.get("CaptureDiagnosticsSubmitted"))),d.createElement(p,"br"),d.createElement(p,"br"),p.appendChild(d.doc.createTextNode(M.firefox.i18n.get("ReferenceId")+": "+t)),d.setStyle(m,{display:"none"}),d.setStyle(y,{display:"none"}),d.setStyle(c,{display:"none"})}else d.logError("Failed: "+this.responseText),i.innerHTML=e.Message},function(e){var t=e.statusCode,e=e.msg;d.logWarn("There is an error when submitting a captured log. "+e),200==t?i.innerHTML=e:(i.innerHTML=401==t?M.firefox.i18n.get("UnableSubmitLogMustSignIn"):null===t?M.firefox.i18n.get("NetworkErrorTryAgain"):M.firefox.i18n.get("UnknownErrorSubmitLogAgain"),d.setStyle(y,{display:"inline"}))})}a(e=y),d.setStyle(e,{float:"right"}),y.innerHTML=M.firefox.i18n.get("Next"),this.highlights.wizard=s,this.doc.addEventListener("mousemove",t),this.highlights.wizardDragListener=t,(this.mySelectedLoginFields?function e(){for(;p.firstChild;)p.removeChild(p.firstChild);d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("AppCapture"),d.createElement(p,"br");var t=d.createPageDescElement(p,"div");t.appendChild(d.doc.createTextNode(M.firefox.i18n.get("AutomaticallyDiscoveredFieldsClickNextToContinue"))),d.createElement(t,"br"),d.createElement(t,"br"),t.appendChild(d.doc.createTextNode(M.firefox.i18n.get("ClickManual"))),d.highlightUsername(d.mySelectedLoginFields.usernameField),d.highlightPassword(d.mySelectedLoginFields.passwordField),d.setStyle(m,{display:"none"}),d.setStyle(y,{display:"inline"}),y.innerHTML=M.firefox.i18n.get("Next"),y.onclick=function(){h.push(e),T()},g(y),d.setStyle(c,{display:"inline"}),c.onclick=function(){d.appDetail.usernameField=null,d.appDetail.passwordField=null,d.appDetail.corpIdField=null,d.appDetail.submitField=null,d.appDetail.formField=null,d.appDetail.formAction=null,h.push(e),d.clearAllHighlights(),E()}}:function e(){for(;p.firstChild;)p.removeChild(p.firstChild);d.createSubHeaderElement(p,"span").innerHTML=M.firefox.i18n.get("AppCapture"),d.createPageDescElement(p,"div").appendChild(d.doc.createTextNode(M.firefox.i18n.get("ClickToSelectField"))),d.setStyle(m,{display:"none"}),d.setStyle(y,{display:"none"}),y.innerHTML=M.firefox.i18n.get("Next"),d.setStyle(c,{display:"inline"}),c.onclick=function(){h.push(e),d.clearAllHighlights(),E()}})()},getElementInHead:function(e,t,i){i=i.toUpperCase();for(var n=this.doc.head.getElementsByTagName(e),r=0;r<n.length;r++){var s=n[r],o=s.getAttribute(t);if(o&&o.toUpperCase()===i)return s}return null},getMetaDataContent:function(e,t){e=this.getElementInHead("meta",e,t);return e&&e.content?((t=this.doc.createElement("div")).innerHTML=e.content,t.childNodes[0].nodeValue.trim()):null},initAppDetail:function(){function t(){var e=i.doc.location.protocol+"//"+i.doc.location.host+"/favicon.ico";i.getImage(e,function(e){e&&(i.appDetail.icon=e)})}var e,i=this,n=(this.appDetail.url=this.doc.URL,this.doc.createElement("div")),r=(this.appDetail.name=this.getMetaDataContent("name","application-name"),this.appDetail.name||(this.appDetail.name=this.getMetaDataContent("property","og:site_name")),this.appDetail.name||(this.appDetail.name=this.getMetaDataContent("property","og:title")),this.appDetail.name||(this.appDetail.name=this.getMetaDataContent("name","title")),this.appDetail.name||(r=this.doc.querySelector("html > head > title"))&&r.innerHTML&&(n.innerHTML=r.innerHTML,this.appDetail.name=n.childNodes[0].nodeValue.trim()),this.appDetail.name||(this.appDetail.name=this.doc.location.hostname),this.appDetail.description=this.getMetaDataContent("name","description"),this.appDetail.description||(this.appDetail.description=this.getMetaDataContent("property","og:description")),this.getMetaDataContent("property","og:image"));r&&((n=this.doc.createElement("a")).href=r,r=n.href),r||(e=this.getElementInHead("link","rel","shortcut icon"))&&(r=e.href),r||(e=this.getElementInHead("link","rel","icon"))&&(r=e.href),r?this.getImage(r,function(e){e?i.appDetail.icon=e:t()}):t()},getImage:function(e,n){this.log("getImage url = "+e);var r=this,t=new XMLHttpRequest;t.onload=function(){var i=r.doc.createElement("img");i.src=r.doc.defaultView.URL.createObjectURL(t.response),i.height=r.defaultIconSize,i.width=r.defaultIconSize,i.onload=function(){var e=r.doc.createElement("canvas"),t=e.getContext("2d");e.height=r.defaultIconSize,e.width=r.defaultIconSize,t.drawImage(i,0,0,r.defaultIconSize,r.defaultIconSize),n(e.toDataURL())},i.onerror=function(){n(null)}},t.onerror=function(){n(null)},t.open("get",e,!0),t.responseType="blob",t.send()},unhighlightField:function(e){e.element.style.border=e.originalBorder,e.arrow.parentNode.removeChild(e.arrow)},highlightField:function(e,t,i){var n;return e?e.element.style.border=e.originalBorder:e={},e.element=t,e.originalBorder=t.style.border,t.style.border="1px dashed red",e.arrow?(n=this.findPosition(t),this.setStyle(e.arrow,{left:n.left+4+"px",top:n.top+4+"px"})):e.arrow=this.createArrow(this.highlights.overlay,t,i),e},highlightUsername:function(e){this.highlights.username=this.highlightField(this.highlights.username,e,M.firefox.i18n.get("UsernameField")),this.highlights.windowResizeListener||(this.highlights.windowResizeListener=this.windowResizeListener,this.doc.defaultView.addEventListener("resize",this.highlights.windowResizeListener))},highlightPassword:function(e){this.highlights.password=this.highlightField(this.highlights.password,e,M.firefox.i18n.get("PasswordField")),this.highlights.windowResizeListener||(this.highlights.windowResizeListener=this.windowResizeListener,this.doc.defaultView.addEventListener("resize",this.highlights.windowResizeListener))},highlightCorpId:function(e){this.highlights.corpId=this.highlightField(this.highlights.corpId,e,M.firefox.i18n.get("AdditionalField")),this.highlights.windowResizeListener||(this.highlights.windowResizeListener=this.windowResizeListener,this.doc.defaultView.addEventListener("resize",this.highlights.windowResizeListener))},highlightSubmit:function(e){this.highlights.submit=this.highlightField(this.highlights.submit,e,M.firefox.i18n.get("SubmitField")),this.highlights.windowResizeListener||(this.highlights.windowResizeListener=this.windowResizeListener,this.doc.defaultView.addEventListener("resize",this.highlights.windowResizeListener))},createArrow:function(e,t,i){t=this.findPosition(t),e=this.createElement(e,"div",{"background-image":"url("+this.arrow+")",position:"absolute",opacity:"0.9","z-index":"2147483647",left:t.left+4+"px",top:t.top+4+"px",width:"171px",height:"25px"});return this.createElement(e,"div",{"padding-top":"3px","padding-left":"39px","font-size":"11px",color:"#ffffff"}).innerHTML=i,e},findPosition:function(e){var t=0,i=0;if(e.offsetParent)for(;t+=e.offsetLeft,i+=e.offsetTop,e=e.offsetParent;);return{left:t,top:i}},clearAllHighlights:function(){if(this.highlights.overlay)for(;this.highlights.overlay.firstChild;)this.highlights.overlay.removeChild(this.highlights.overlay.firstChild);this.highlights.username&&(this.highlights.username.element.style.border=this.highlights.username.originalBorder,this.highlights.username=null),this.highlights.password&&(this.highlights.password.element.style.border=this.highlights.password.originalBorder,this.highlights.password=null),this.highlights.corpId&&(this.highlights.corpId.element.style.border=this.highlights.corpId.originalBorder,this.highlights.corpId=null),this.highlights.submit&&(this.highlights.submit.element.style.border=this.highlights.submit.originalBorder,this.highlights.submit=null)},addIframeCover:function(e){this.removeIframeCover();var t=this.doc.getElementsByTagName("iframe");this.log("found "+t.length+" iframes");for(var i=0;i<t.length;i++){var n=this.doc.createElement("div"),r=t[i],s=0,o=0;r.offsetParent&&(s=r.offsetLeft,o=r.offsetTop),n.style.left=s+"px",n.style.top=o+"px",n.style.width=r.offsetWidth+"px",n.style.height=r.offsetHeight+"px",n.style.backgroundColor="#F5A623",n.style.opacity="0.3",n.style.cursor="default",n.style.position="absolute",n.setAttribute("cbecover","fRAmE"),e&&(n.onclick=function(){n.onclick=null,e()}),r.parentNode.insertBefore(n,r.nextSibling)}},removeIframeCover:function(){for(var e=this.doc.querySelectorAll("div[cbecover=fRAmE]"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])},onUnload:function(){this.highlights.overlay&&(this.doc.body.removeChild(this.highlights.overlay),this.highlights.overlay=null),this.highlights.wizard&&(this.doc.body.removeChild(this.highlights.wizard),this.highlights.wizard=null),this.highlights.wizardDragListener&&(this.doc.removeEventListener("mousemove",this.highlights.wizardDragListener),this.highlights.wizardDragListener=null),this.highlights.windowResizeListener&&(this.doc.defaultView.removeEventListener("resize",this.highlights.windowResizeListener),this.highlights.windowResizeListener=null),this.removeIframeCover(),this.transitToNewPage(),this.clearAllHighlights()},transitToNewPage:function(){this.highlights.highlightClickListener&&(this.doc.removeEventListener("click",this.highlights.highlightClickListener,!0),this.highlights.highlightClickListener=null),this.highlights.highlightInspectListener&&(this.doc.removeEventListener("mouseover",this.highlights.highlightInspectListener),this.highlights.highlightInspectListener=null),this.highlights.previousMouseOverElement&&(this.highlights.previousMouseOverElement.style.background=this.highlights.previousMouseOverBg,this.highlights.previousMouseOverElement=null,this.highlights.previousMouseOverBg=null),this.removeIframeCover()}},M.common.objectExtend(M.capture.CaptureUI,M.common.CentrifyBEBase),M.capture.CentrifyBEUI=function(){M.common.CentrifyBEBase.call(this);var t=this;this.logWithLevel=M.firefox.Log.prototype.logWithLevel,this.messageListener=function(e){t.showCaptureInline(e.data)}},M.capture.CentrifyBEUI.prototype={loggerName:"CaptureUI",showCaptureInline:function(e){var t,i=document;"FRAMESET"===i.body.tagName?alert(M.firefox.i18n.get("CaptureNotSupportedPage")):(t=i.body.querySelector("body > table#centrify\\:\\:capture\\.wizard"))?(t.style.top="100px",t.style.left="100px"):(t=new M.capture.CaptureLog(i),e=new M.capture.CaptureUI(i,e,t),i=new M.capture.CaptureEngine(i,t).start(),this.log(i),e.init(i))}},M.common.objectExtend(M.capture.CentrifyBEUI,M.common.CentrifyBEBase),M.capture.centrifyBEUI=new M.capture.CentrifyBEUI,browser.runtime.onMessage.addListener(function(e,t,i){e.action==M.communication.CentrifyEventEnum.captureStart&&M.capture.centrifyBEUI.messageListener(e)})}.call(_idaptiveUniqueGlobal);