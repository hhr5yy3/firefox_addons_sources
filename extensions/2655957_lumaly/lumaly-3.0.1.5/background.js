try{(()=>{"use strict";var t,e,n,r,o,i,a,u,s={694:(t,e,n)=>{n.d(e,{BD:()=>G,Ct:()=>I,Dc:()=>y,EW:()=>q,Eg:()=>f,Eh:()=>h,Ey:()=>z,FA:()=>it,FN:()=>nt,Fe:()=>ht,Fn:()=>dt,GB:()=>v,GZ:()=>pt,H0:()=>et,Hb:()=>Z,I:()=>F,Ik:()=>S,LW:()=>d,Lz:()=>g,N5:()=>O,NY:()=>tt,P$:()=>ft,Q$:()=>s,R4:()=>X,T0:()=>lt,T5:()=>o,TK:()=>k,Uj:()=>E,Ux:()=>at,V2:()=>b,W_:()=>T,YL:()=>J,_y:()=>_,aH:()=>H,as:()=>Q,dd:()=>p,ds:()=>N,eD:()=>r,eG:()=>rt,eh:()=>ct,fy:()=>st,gl:()=>$,hQ:()=>R,hs:()=>u,jW:()=>U,lc:()=>M,m2:()=>ut,mM:()=>P,pF:()=>x,ph:()=>D,pw:()=>c,qo:()=>i,s4:()=>ot,sV:()=>l,tL:()=>a,v7:()=>A,vr:()=>j,w9:()=>L,y7:()=>C,zW:()=>w});var r=!1,o="https://api.lumaly.de/",i="api/84835852f602e004e3b77baa72c483b2",a="https://lu-static.fra1.cdn.digitaloceanspaces.com/all-shops.json",u="api/coupons",s="api/shops",c="api/shops-list",l="api/gift-cards",f="api/gift-cards/buy",p={BASE:"api/v1/extension",COUPON_APPLICATION_TIME:"/coupon-application-time",COUPON_APPLICATION_STATS:"/coupon-application-stats"},d="api/auth",h="api/logout",y="api/registration",b="api/v3/user/current",v="api/user/current",w="api/auth/google",_="api/auth/facebook",g="api/user/sync/referral",m="https://admin.lumaly.de/",S=m+"auth/google/",A=m+"auth/facebook/",O="api/v3/user/current/transactions",x={BASE:"api/actions",APPLIES:"/applies",UNIQUE_APPLIES:"/unique-applies",CASHBACK_APPLIES:"/cashback-applies",OPENS:"/opens",CLOSES:"/closes",VISITS:"/visits",UNIQUE_VISITS:"/unique-visits",VERSIONS:"/versions",SAVES:"/saves",PURCHASE_TOTAL:"/purchase-totals",FEATURES:"/features",SHOWN_POPUPS:"/shown-popups",PRODUCT_PAGE_VISITS:"/product_page_visits"},T="api/currency-rates",P="api/lead/install",k="api/lead",E="api/user/check/lead",C="api/broken-shops",I="https://files.lumaly.de/ext/js/",j="https://api.mixpanel.com/",D="/static/socialAuthParser.js",R="/static/getReferralInvitedCookie.js",L="static/app.html?authModal=true",U="/static/js-helpers/",N={EMAIL_ALREADY_REGISTERED:409,INVALID_EMAIL_OR_PASSWORD:401},B="https://lumaly.de",G={install:"".concat(o,"api/lead/track/install"),uninstall:"".concat(o,"api/lead/track/uninstall"),discover:"".concat(B,"/discover"),smartDiscover:"".concat(B,"/discover-smart")},F={DEFAULT_STORAGE_SHOP_KEY:"DEFAULT_SHOP_DATA",SHOP_SCRIPT:"shop_script_",EBAY_KEY:"ebay_openings_",EBAY_DISABLED_CALCULATE:"ebay_disabled_calculate",CJ_TAB_KEY:"cj_tab_",RAKUTEN_TAB_KEY:"rakuten_tab_",INTERRUPTED_PROGRESS_POPUP:"interrupted_progress_popup_",MIXPANEL_TAB_EVENTS:"mixpanel_tab_events_"},M="smart-auth",H=new RegExp("^lumaly[.](de|com)","i"),K=3e5,W=6e5,Y=36e5,V=864e5,q=18e5,J=Y,z=Y,$=W,Q=Y,X=Y,Z=K,tt=6e4,et=Y,nt=V,rt=1728e5,ot=V,it="RABBATZEIT",at="4f7b170a1865f6b7fd17fc226b114268",ut={CHECK_EBAY_CAN_NE_OPENED:"check-ebay-can-be-opened",CHECK_EBAY_CALCULATION_BLOCK_ENABLED:"check-ebay-calculation-block-enabled",INCREMENT_EBAY_CAN_BE_OPENED:"increment-ebay-can-be-opened",DISABLE_EBAY_CALCULATION_BLOCK:"disable-ebay-calculation-block"},st=1/0,ct=["afcyhf.com","anrdoezrs.net","apmebf.com","awltovhc.com","cj.dotomi.com","dpbolvw.net","emjcd.com","ftjcfx.com","jdoqocy.com","kqzyfj.com","lduhtrp.net","mjbpab.com","qksrv.net","qksz.net","tkqlhce.com","tqlkg.com","awxibrm.com","cj.com","cj.mplxtms.com","commission-junction.com","cualbr.com","emjcd.com","kdukvh.com","mczbf.com","pkracv.com","rnsfpw.net","sjwoe.com","vofzpwh.com","yceml.net","www.cj.conversant.mgr.consensu.org","www.p.zjptg.com"],lt={id:"ULaAaiWLMpM",url:"click.linksynergy.com",blockString:"linksynergy",blockParams:"afscr=1"},ft="#88c987",pt=[],dt=!1,ht="__NETWORK__ERROR__"},160:(t,e,n)=>{n.d(e,{Bc:()=>r,Cv:()=>devLog,Ki:()=>devWarn,V3:()=>devError,pC:()=>devTable});var r,o=n(694),__spreadArray=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))};!function(t){t.MESSAGING="background: gold; color: black;",t.COMPONENTS="color: SteelBlue;",t.API="background: crimson; color: white; font-weight: bold; padding: 0 10px;",t.BROWSER="background: sienna; color: white",t.HIJACK="color: SandyBrown",t.AFFILIATE="color: #025450;",t.EBAY="color: #86B817",t.SHOP_ENGINE="background: black; color: green; padding: 15px; border-radius: 5px",t.SHOP_EXCEPTION="color:#fff;background:red;padding:5px;border-radius:8px",t.SHOP_RCT="background: #e46d2d; color: #fff; padding: 5px; border-radius: 5px",t.SHOP_INFO="color: CadetBlue; font-style: italic;",t.SHOP_WARN="color: IndianRed; font-style: italic;",t.REDIRECT="color: white; background: darkolivegreen; padding: 0 8px;",t.BASKET_TOTAL="background: #aef8c0; color: black; padding: 5px; border-radius: 5px",t.BASKET_DISCOUNT="background: salmon; color: black; padding: 5px; border-radius: 5px",t.RESCHEDULING="font-style: italic; color: DarkGoldenRod",t.NETWORK="color: silver; font-style: italic;",t.BUILD="color: SlateGray; font-style: italic;"}(r||(r={}));var devLog=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];o.eD&&(o.Fn&&(window.devLogs=window.devLogs||[],window.devLogs.push(__spreadArray([t],e,!0))),console.log.apply(console,__spreadArray([t],e||"",!1)))},devError=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];o.eD&&console.log.apply(console,__spreadArray(["%c"+t,"background: maroon; color: white; font-weight: bold;  padding: 5px; border: 4px solid red;"],e||"",!1))},devTable=function(t,e){o.eD&&console.table(t,e)},devWarn=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];o.eD&&(o.Fn&&(window.devLogs=window.devLogs||[],window.devLogs.push(__spreadArray([t,e],n,!0))),console.log.apply(console,__spreadArray(["%c"+t,e],n,!1)))}}},c={};function __webpack_require__(t){var e=c[t];if(void 0!==e)return e.exports;var n=c[t]={exports:{}};return s[t](n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),e=__webpack_require__(160),t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)},n=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)},r=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},o=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},function(t){function ClientFirefox(){return null!==t&&t.apply(this,arguments)||this}n(ClientFirefox,t),ClientFirefox.prototype.connectToBg=function(t){return this.fromFirefoxPortToBrowserPort(browser.runtime.connect({name:t}))}}(i=function(){function GenericFirefox(){var t=this;this.storage={getAll:function(t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,browser.storage.local.get(t)];case 1:return[2,r.sent()];case 2:return n=r.sent(),(0,e.Cv)("storage getAll [".concat(t,"] error:"),null==n?void 0:n.message),[2,{}];case 3:return[2]}}))}))},get:function(t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,browser.storage.local.get([t])];case 1:return[2,r.sent()[t]];case 2:return n=r.sent(),(0,e.Cv)("storage get ".concat(t," error:"),null==n?void 0:n.message),[2,null];case 3:return[2]}}))}))},getIfNotExpired:function(t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,browser.storage.local.get([t])];case 1:return[2,r.sent()[t]];case 2:return n=r.sent(),(0,e.Cv)("storage getIfNotExpired ".concat(t," error:"),null==n?void 0:n.message),[2,null];case 3:return[2]}}))}))},set:function(t,n){return r(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,browser.storage.local.set((i={},i[t]=n,i))];case 1:return[2,o.sent()];case 2:return r=o.sent(),(0,e.Cv)("storage set ".concat(t," error:"),null==r?void 0:r.message),[2];case 3:return[2]}}))}))},setWithExpire:function(t,n){return r(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,browser.storage.local.set((i={},i[t]=n,i))];case 1:return[2,o.sent()];case 2:return r=o.sent(),(0,e.Cv)("storage setWithExpire ".concat(t," error:"),null==r?void 0:r.message),[2];case 3:return[2]}}))}))},unset:function(t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,browser.storage.local.remove(t)];case 1:return[2,r.sent()];case 2:return n=r.sent(),(0,e.Cv)("storage unset ".concat(t," error:"),null==n?void 0:n.message),[2];case 3:return[2]}}))}))},onChanged:{addListener:function(t){return browser.storage.onChanged.addListener(t)},removeListener:function(t){return browser.storage.onChanged.removeListener(t)}}},this.windows={create:function(t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,browser.windows.create(t)];case 1:return[2,r.sent()||null];case 2:return n=r.sent(),(0,e.Cv)("windows create  error:",null==n?void 0:n.message),[2,null];case 3:return[2]}}))}))},remove:function(t){return r(this,void 0,void 0,(function(){return o(this,(function(n){try{browser.windows.remove(t)}catch(t){return(0,e.Cv)("windows remove  error:",null==t?void 0:t.message),[2]}return[2]}))}))},getCurrent:function(){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,browser.windows.getCurrent()];case 1:return[2,n.sent()];case 2:return t=n.sent(),(0,e.Cv)("windows getCurrent  error:",null==t?void 0:t.message),[2,{}];case 3:return[2]}}))}))}},this.tabs={active:function(){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,browser.tabs.query({active:!0,currentWindow:!0})];case 1:return[2,n.sent()[0]];case 2:return t=n.sent(),(0,e.Cv)("tabs active  error:",null==t?void 0:t.message),[2,{}];case 3:return[2]}}))}))},onUpdated:{addListener:function(t){return browser.tabs.onUpdated.addListener(t)},removeListener:function(t){return browser.tabs.onUpdated.removeListener(t)}},onActivated:{addListener:function(t){return browser.tabs.onActivated.addListener(t)}},onRemoved:{addListener:function(t){return browser.tabs.onRemoved.addListener(t)}},create:function(t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,browser.tabs.create(t)];case 1:return[2,r.sent()];case 2:return n=r.sent(),(0,e.Cv)("tabs create  error:",null==n?void 0:n.message),[2,{}];case 3:return[2]}}))}))},update:function(t,n){return r(this,void 0,void 0,(function(){var r;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,browser.tabs.update(t,n)];case 1:return[2,o.sent()];case 2:return r=o.sent(),(0,e.Cv)("tabs update  error:",null==r?void 0:r.message),[2,{}];case 3:return[2]}}))}))},query:function(t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,browser.tabs.query(t)];case 1:return[2,r.sent()];case 2:return n=r.sent(),(0,e.Cv)("tabs query  error:",null==n?void 0:n.message),[2,[{}]];case 3:return[2]}}))}))},get:function(t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,browser.tabs.get(t)];case 1:return[2,r.sent()];case 2:return n=r.sent(),(0,e.Cv)("tabs get  error:",null==n?void 0:n.message),[2,{}];case 3:return[2]}}))}))},remove:function(t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,browser.tabs.remove(t)];case 1:return r.sent(),[3,3];case 2:return n=r.sent(),(0,e.Cv)("tabs remove  error:",null==n?void 0:n.message),[2];case 3:return[2]}}))}))},sendMessage:function(t,n,i){return r(this,void 0,void 0,(function(){var r;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,browser.tabs.sendMessage(t,n,i)];case 1:return o.sent(),[3,3];case 2:return r=o.sent(),(0,e.Cv)("tabs sendMessage  error:",null==r?void 0:r.message),[2];case 3:return[2]}}))}))}},this.scripting={executeScript:function(n){return r(t,void 0,void 0,(function(){var t,r;return o(this,(function(o){switch(o.label){case 0:t=n.file?{file:n.file}:{code:n.code},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,browser.tabs.executeScript(n.target.tabId,t)];case 2:return[2,o.sent()];case 3:return r=o.sent(),(0,e.Cv)("scripting executeScript  error:",null==r?void 0:r.message),[2,[]];case 4:return[2]}}))}))}},this.action={setBadgeText:function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,browser.browserAction.setBadgeText(t)];case 1:return e.sent(),[2]}}))}))},setBadgeBackgroundColor:function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,browser.browserAction.setBadgeBackgroundColor({color:t})];case 1:return e.sent(),[2]}}))}))}},this.runtime={getURL:function(t){return browser.runtime.getURL(t)},onInstalled:{addListener:function(t){return browser.runtime.onInstalled.addListener(t)}},setUninstallURL:function(t){browser.runtime.setUninstallURL(t)},onMessage:{addListener:function(t){return browser.runtime.onMessage.addListener(t)},removeListener:function(t){return browser.runtime.onMessage.removeListener(t)}},sendMessage:function(t){browser.runtime.sendMessage(t)},getManifest:function(){return browser.runtime.getManifest()},reload:function(){browser.runtime.reload()},lastError:browser.runtime.lastError},this.webRequest={get supported(){return"object"==typeof browser.webRequest},onHeadersReceived:{addListener:function(t,e,n){return browser.webRequest.onHeadersReceived.addListener(t,e,n)},removeListener:function(t,e,n){return browser.webRequest.onHeadersReceived.addListener(t,e,n)}},onBeforeSendHeaders:{addListener:function(t,e,n){return browser.webRequest.onBeforeSendHeaders.addListener(t,e,n)},removeListener:function(t,e,n){return browser.webRequest.onBeforeSendHeaders.addListener(t,e,n)}},onCompleted:{addListener:function(t,e,n){return browser.webRequest.onCompleted.addListener(t,e,n)},removeListener:function(t,e,n){return browser.webRequest.onCompleted.addListener(t,e,n)}}}}return GenericFirefox.prototype.fromFirefoxPortToBrowserPort=function(t){var e,n,r,o,i,a;return{name:t.name,tabId:null===(n=null===(e=t.sender)||void 0===e?void 0:e.tab)||void 0===n?void 0:n.id,url:null===(o=null===(r=t.sender)||void 0===r?void 0:r.tab)||void 0===o?void 0:o.url,windowId:null===(a=null===(i=t.sender)||void 0===i?void 0:i.tab)||void 0===a?void 0:a.windowId,disconnect:function(){return t.disconnect()},onDisconnect:function(e){return t.onDisconnect.addListener(e)},onMessage:function(e){return t.onMessage.addListener(e)},postMessage:function(e){return t.postMessage(e)}}},GenericFirefox}()),a=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),u=function(t){function Firefox(){return null!==t&&t.apply(this,arguments)||this}return a(Firefox,t),Firefox.prototype.onConnect=function(t){var e=this;browser.runtime.onConnect.addListener((function(n){t(e.fromFirefoxPortToBrowserPort(n))}))},Firefox}(i),__webpack_require__.g.compat=new u,(()=>{var t,e=new Uint8Array(16);function rng(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(e)}const n=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const esm_browser_validate=function(t){return"string"==typeof t&&n.test(t)};for(var r=[],o=0;o<256;++o)r.push((o+256).toString(16).substr(1));const esm_browser_stringify=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(r[t[e+0]]+r[t[e+1]]+r[t[e+2]]+r[t[e+3]]+"-"+r[t[e+4]]+r[t[e+5]]+"-"+r[t[e+6]]+r[t[e+7]]+"-"+r[t[e+8]]+r[t[e+9]]+"-"+r[t[e+10]]+r[t[e+11]]+r[t[e+12]]+r[t[e+13]]+r[t[e+14]]+r[t[e+15]]).toLowerCase();if(!esm_browser_validate(n))throw TypeError("Stringified UUID is invalid");return n};const esm_browser_v4=function(t,e,n){var r=(t=t||{}).random||(t.rng||rng)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){n=n||0;for(var o=0;o<16;++o)e[n+o]=r[o];return e}return esm_browser_stringify(r)};var i=__webpack_require__(160),__awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},__generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},a=function(){function Messaging(){this.endpoints={},this.sockets={}}return Messaging.prototype.listen=function(t,e){return this.endpoints[t.name]?((0,i.Cv)("\n                There already exists an endpoint for '".concat(t.name,"'.\n            ")),this):(this.endpoints[t.name]=[t,e],this)},Messaging.prototype.receiveMessage=function(t,e){return __awaiter(this,void 0,void 0,(function(){var n,r,o,a,u,s,c;return __generator(this,(function(l){switch(l.label){case 0:return!e||!e.name||"string"!=typeof e.name||!Object.prototype.hasOwnProperty.call(e,"payload")||e.id&&"string"!=typeof e.id?[2,(0,i.V3)("Invalid message format received for port '".concat(t.name,"':"),e)]:this.sockets[e.id]?(n=this.sockets[e.id],u=n[0],r=n[1],o=n[2],delete this.sockets[e.id],e.name!==u.name?o(new Error("To message '".concat(e.id,"' got reply\n                        of type '").concat(e.name,"'\n                        but expected '").concat(u.name,"'"))):r(new u(e.payload)),[3,5]):[3,1];case 1:return this.endpoints[e.name]?(a=this.endpoints[e.name],u=a[0],[4,(s=a[1]).handle(new u(e.payload),t)]):[2,(0,i.Cv)("\n                    No endpoint exists for message '".concat(e.name,"'\n                    which has been received from '").concat(t.name,"'\n                    with payload:\n                    "),e.payload)];case 2:return c=l.sent(),e.id&&c?[4,this.send(t,c,e.id)]:[3,4];case 3:return l.sent(),[3,5];case 4:if(e.id&&!c)return[2,(0,i.V3)("\n                    Expected a response to '".concat(e.name,"' with id\n                    ").concat(e.id," from endpoint '").concat(s.constructor.name,"'.\n                "))];l.label=5;case 5:return[2]}}))}))},Messaging.prototype.send=function(t,e,n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){try{t.postMessage({id:n,name:e.constructor.name,payload:e.payload})}catch(n){(0,i.Ki)("send postMessage error:",i.Bc.MESSAGING,{port:t,message:e,error:n})}return[2]}))}))},Messaging.prototype.sendAndRecvResponse=function(t,e,n,r){return void 0===r&&(r=1e4),__awaiter(this,void 0,void 0,(function(){var o,a,u=this;return __generator(this,(function(s){o=esm_browser_v4(),a=new Promise((function(t,a){var s=setTimeout((function(){(0,i.Ki)("A response ('".concat(n.name,"') to the message ").concat(e.constructor.name,"' took more than ").concat(r),i.Bc.MESSAGING,{message:e}),a()}),r);u.sockets[o]=[n,function(e){clearTimeout(s),t(e)},function(t){clearTimeout(s),a(t)}]}));try{t.postMessage({id:o,name:e.constructor.name,payload:e.payload})}catch(t){(0,i.Cv)("Messaging sendAndRecvResponse postMessage error:",{message:e,error:t})}return[2,a]}))}))},Messaging}(),u=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),s=function(t){function Background(e){var n=t.call(this)||this;return n.ports={},e((function(t){n.newPort(t)})),n}return u(Background,t),Background.prototype.newPort=function(t){var e,n=this,r=null;for(var o in this.ports)if(Object.prototype.hasOwnProperty.call(this.ports,o)){var a=this.ports[o];if(a.name===t.name||a.tabId===t.tabId&&a.windowId===t.windowId&&a.name.includes("content")&&t.name.includes("content")){r=a;break}}r&&((0,i.Cv)("\n                Another port with name '".concat(r.name,"' already exists.\n                Disconnecting previous port in favour of the new connection.\n            ")),null===(e=this.ports[r.name])||void 0===e||e.disconnect(),delete this.ports[r.name]),t.onMessage((function(e){return n.receiveMessage(t,e)})),t.onDisconnect((function(){n.ports[t.name]&&((0,i.Ki)("Connection to content script ".concat(t.windowId,":").concat(t.tabId," was lost: ").concat(t.url),i.Bc.MESSAGING),delete n.ports[t.name])})),this.ports[t.name]=t},Background}(a),sleep=function(t){return new Promise((function(e){return setTimeout(e,t)}))},instantNavigation_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},instantNavigation_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},waitForPrerendering=function(t){return void 0===t&&(t=500),instantNavigation_awaiter(void 0,void 0,void 0,(function(){return instantNavigation_generator(this,(function(e){switch(e.label){case 0:return"prerendering"in document&&document.prerendering?((0,i.Ki)("prerendering, will wait ".concat(t),i.Bc.BROWSER),[4,sleep(t)]):[3,2];case 1:return e.sent(),[3,0];case 2:return[2]}}))}))},c=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Client_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},Client_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},l=(function(t){function Client(e){var n=t.call(this)||this;return n.connect=e,n.waitUntilReady=function(){return Client_awaiter(n,void 0,void 0,(function(){return Client_generator(this,(function(t){switch(t.label){case 0:return this.ready?[3,2]:[4,sleep(100)];case 1:return t.sent(),[3,0];case 2:return[2]}}))}))},n.connectToNewPort(),n}c(Client,t),Client.prototype.connectToNewPort=function(){return Client_awaiter(this,void 0,void 0,(function(){var t=this;return Client_generator(this,(function(e){switch(e.label){case 0:return[4,waitForPrerendering()];case 1:return e.sent(),this.port&&this.port.disconnect(),this.port=this.connect(),this.port.onMessage((function(e){return t.receiveMessage(t.port,e)})),this.port.onDisconnect((function(){return Client_awaiter(t,void 0,void 0,(function(){var t,e;return Client_generator(this,(function(n){switch(n.label){case 0:(0,i.Ki)("Connection to background script lost, reconnecting",i.Bc.MESSAGING),n.label=1;case 1:return n.trys.push([1,3,,4]),t=this.port.name,[4,this.connectToNewPort()];case 2:if(n.sent(),!(t&&this.port.name&&t!==this.port.name))throw"cannot make a new port";return(0,i.Ki)("Connection to background script reestablished",i.Bc.MESSAGING),[3,4];case 3:return e=n.sent(),(0,i.Ki)("An attempt to restore connection to the background script failed",i.Bc.MESSAGING,e),[3,4];case 4:return[2]}}))}))})),[2]}}))}))},Client.prototype.sendToBg=function(t){return Client_awaiter(this,void 0,void 0,(function(){return Client_generator(this,(function(e){switch(e.label){case 0:return[4,this.waitUntilReady()];case 1:return e.sent(),[2,this.send(this.port,t)]}}))}))},Client.prototype.sendToBgAndRecvResponse=function(t,e,n){return void 0===n&&(n=1e4),Client_awaiter(this,void 0,void 0,(function(){return Client_generator(this,(function(r){switch(r.label){case 0:return[4,this.waitUntilReady()];case 1:return r.sent(),[2,this.sendAndRecvResponse(this.port,t,e,n)]}}))}))},Object.defineProperty(Client.prototype,"ready",{get:function(){return!!this.port},enumerable:!1,configurable:!0})}(a),function(t){this.payload=t}),f=__webpack_require__(694),storage_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},storage_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},p=function(){function StorageQuery(t,e){this.expiryTime=6e5,this.storage=t,this.key=e}return StorageQuery.prototype.get=function(){return storage_awaiter(this,void 0,void 0,(function(){return storage_generator(this,(function(t){switch(t.label){case 0:return[4,this.storage.get(this.key)];case 1:return[2,t.sent()]}}))}))},StorageQuery.prototype.getIfNotExpired=function(){return storage_awaiter(this,void 0,void 0,(function(){var t;return storage_generator(this,(function(e){switch(e.label){case 0:return[4,this.storage.get(this.key)];case 1:return(t=e.sent())?[3,2]:[2,null];case 2:return t.expired&&Date.now()>t.expired?[4,this.storage.unset(this.key)]:[3,4];case 3:return e.sent(),[2,null];case 4:return[2,t.data]}}))}))},StorageQuery.prototype.setWithExpire=function(t,e){return storage_awaiter(this,void 0,void 0,(function(){var n,r;return storage_generator(this,(function(o){switch(o.label){case 0:return n=e||this.expiryTime,r={expired:Date.now()+n,data:t},[4,this.storage.set(this.key,r)];case 1:return o.sent(),[2]}}))}))},StorageQuery.prototype.getOrThrow=function(){return storage_awaiter(this,void 0,void 0,(function(){var t;return storage_generator(this,(function(e){switch(e.label){case 0:return[4,this.get()];case 1:if(void 0===(t=e.sent()))throw new Error("The storage key '".concat(this.key,"' is undefined"));return[2,t]}}))}))},StorageQuery.prototype.set=function(t){return storage_awaiter(this,void 0,void 0,(function(){return storage_generator(this,(function(e){switch(e.label){case 0:return[4,this.storage.set(this.key,t)];case 1:return e.sent(),[2]}}))}))},StorageQuery.prototype.unset=function(){return storage_awaiter(this,void 0,void 0,(function(){return storage_generator(this,(function(t){switch(t.label){case 0:return[4,this.storage.unset(this.key)];case 1:return t.sent(),[2]}}))}))},StorageQuery}();var d,h=new s((function(t){return compat.onConnect(t)})),y=function(t){function str(e){return new p(t,e)}function bool(e){return new p(t,e)}function number(e){return new p(t,e)}function object(e){return new p(t,e)}return{leadId:str("lead_id"),token:str("token"),referralInvitedToken:str("referral_invited_token"),lastUser:object("user"),authWindowOptions:function(t){return object("auth_modal_options_"+t)},affiliateTabIds:object("affiliate_tab_ids"),supportedDomains:object("supported_domains"),shopData:function(t){return object(t)},isInstructionPopupShown:bool("is_instruction_popup_shown"),isInstructionAmazonPopupShown:bool("is_instruction_amazon_popup_shown"),isExplanationShown:bool("is_explanation_shown"),successfulAppliesCount:number("successful_applies_count"),isLoggedUser:bool("isLoggedUser"),clickedDomains:object("clicked_domains"),lastShopDomain:str("last_shop_domain"),shops:object("shops"),user:object("user"),ebay:function(t,e){return object(f.I.EBAY_KEY+"tab-"+t+"-window-"+e)},cj:function(t){return object(f.I.CJ_TAB_KEY+t)},rakuten:function(t){return object(f.I.RAKUTEN_TAB_KEY+t)},counterCanPromptRegistration:number("counter_can_prompt_registration"),couponsApplicationStats:object("coupons_application_stats"),checkLeadIdTimeout:number("check_lead_id_timeout"),interruptedProgressPopup:function(t){return object(f.I.INTERRUPTED_PROGRESS_POPUP+t)},snoozedShops:object("snoozed_shops"),userId:object("user_id"),lastActiveTab:object("last_active_tab_id"),mixpanelTabEvents:function(t,e){return object(f.I.MIXPANEL_TAB_EVENTS+"tab_"+t+"_window_"+e||"default")},session:function(t){return object("session-".concat(t))},visitedProducts:object("visited_products"),log:object("log")}}(compat.storage),b={extension_version:"3.0.1.5",environment:"prod"};!function(t){t.JSON="json",t.JS="js",t.UNKNOWN="unknown"}(d||(d={}));var v,w,_,g,m,S,A,O,x,T,detectScriptType=function(t,e){return String(t).toLowerCase().endsWith(".json")||(null==e?void 0:e.includes("helper-scripts/autoapply-v2.js"))?d.JSON:String(t).toLowerCase().endsWith(".js")?d.JS:d.UNKNOWN};function convertApiCashbackToModel(t){return{data:t.data.map((function(t){return{title:t.title,currencyType:t.currency_type,clientCashback:t.client_cashback}})),additional:{displayCashback:t.additional.display_cashback,clientCashbackMax:t.additional.client_cashback_max,clientCashbackMin:t.additional.client_cashback_min}}}!function(t){t.INSTALLED="installed",t.UPDATED="updated"}(v||(v={})),function(t){t.INITIAL="initial",t.FOUND="found",t.NOT_FOUND="not_found",t.RESET="reset"}(w||(w={})),function(t){t[t.CART_TOTAL=0]="CART_TOTAL",t[t.SENT_CART_TOTAL=1]="SENT_CART_TOTAL",t[t.DISCOUNTED_AND_CART_TOTAL=2]="DISCOUNTED_AND_CART_TOTAL"}(_||(_={})),function(t){t.LOG_IN="Log in",t.SIGN_UP="Sign up",t.LOG_OUT="Log out"}(g||(g={})),function(t){t.APPLY_COUPONS="applyCoupons",t.HIDE_POPUPS="hidePopups"}(m||(m={})),function(t){t[t.CHECK_CAN_BE_OPENED=0]="CHECK_CAN_BE_OPENED",t[t.INCREMENT_OPEN_COUNT=1]="INCREMENT_OPEN_COUNT",t[t.DISABLE_CALCULATION_BLOCK=2]="DISABLE_CALCULATION_BLOCK"}(S||(S={})),function(t){t[t.TRY_COUPONS=0]="TRY_COUPONS",t[t.TRY_COUPONS_AGAIN=1]="TRY_COUPONS_AGAIN",t[t.TRY_COUPONS_AGAIN_AFTER_APPLIED=2]="TRY_COUPONS_AGAIN_AFTER_APPLIED",t[t.TRY_COUPONS_NO_CODES=3]="TRY_COUPONS_NO_CODES",t[t.TRY_COUPONS_HOME_PAGE_POPUP=4]="TRY_COUPONS_HOME_PAGE_POPUP",t[t.PARTIAL_SUPPORTED_TRY_COUPONS=5]="PARTIAL_SUPPORTED_TRY_COUPONS",t[t.CASHBACK_POPUP=6]="CASHBACK_POPUP",t[t.NOT_FOUND_COUPON_NO_CODES_POPUP=7]="NOT_FOUND_COUPON_NO_CODES_POPUP"}(A||(A={})),function(t){t.ALL="ALL",t.CURRENT="CURRENT"}(O||(O={})),function(t){t.CJ="cj",t.RAKUTEN="rakuten"}(x||(x={})),function(t){t.CARDS="cards",t.TRANSFER="transfer",t.DONE="done"}(T||(T={}));var convertApiPaginationToModel=function(t){return{currentPage:t.current_page,lastPage:t.last_page}};function convertApiTransactionDataToModel(t){return t.map((function(t){return{btcAmount:t.btc_amount,createdAt:t.created_at,eurAmount:t.eur_amount,logo:t.logo,statusIcon:t.status_icon,title:t.title,tooltip:t.tooltip}}))}function convertApiCouponToModel(t){var e,n=/(\d+(?:[.,]\d+)%)\s+Cashback/i.test(t.title);return{id:t.id,title:t.title,code:t.code,discount:t.discount,emailCode:t.email_code,minSum:t.min_sum,validUntil:t.valid_until,description:t.description,codeUrl:t.code_url,whereToFound:t.where_to_found,shopUrl:t.shop_url,shopId:t.shop_id,shopLogo:t.shop_logo,shopLogoAbsolute:t.shop_logo_absolute_url,shopName:t.shop_name,isCashback:t.is_cashback,isPreSupported:t.supported_partial,isOnlyCashback:n,affiliateNetwork:t.affiliate_network,affiliateUrl:t.affiliate_url,isSameTabLink:t.same_tab_link,favouriteCashback:(e=t.favourite_cashback,{biggestClientReward:(null==e?void 0:e.biggest_client_reward)||"",description:(null==e?void 0:e.description)||"",totalTransactionsCount:(null==e?void 0:e.total_transactions_count)||0})}}function urlToDomain(t,e){if(!t||!t.includes(".")||t.startsWith("about:")||-1!==t.indexOf("chrome://"))return e?t:void 0;if(t.includes(".holzhütte.com"))return"holzhütte.com";if(t.includes("toucanbox-deutschland.myshopify.com"))return"toucanbox.com";var n=[];try{n=decodeURI(new URL(t).hostname).split(".")}catch(e){n=t.split(".")}var r=n[n.length-2];/myshopify/i.test(r)&&n.splice(n.length-2,1);var o=["eu","org","web","uk","co","com"].indexOf(r)>-1;return n.splice(0,Math.max(n.length-(o?3:2),0)),n.join(".")}var __assign=function(){return __assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},__assign.apply(this,arguments)},coupons_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},coupons_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},P=function(){function CouponsApi(t,e,n,r,o){void 0===r&&(r={}),this.storage=t,this.apiUrl=e,this.couponsCacheTime=n,this.defaultParams=r,this.defaultShopKey=o,this.isFetching={}}return CouponsApi.prototype.fetch=function(t,e,n){var r,o,a;return coupons_awaiter(this,void 0,void 0,(function(){var u,s,c,l,f,p,h,y,b,v,w,_,g,m,S,A,O,x,T,P,k,E=this;return coupons_generator(this,(function(C){switch(C.label){case 0:return[4,W.fetch()];case 1:return u=C.sent(),s=t?urlToDomain(t):null,c=Boolean(u&&s&&s in u),f=[__assign({},this.defaultParams)],T={},[4,this.storage.leadId.get()];case 2:return l=__assign.apply(void 0,f.concat([(T.lead_id=C.sent()||"",T)])),s&&c&&(l.hostname=s),p=null!==(r=l.hostname)&&void 0!==r?r:this.defaultShopKey,h="".concat(this.apiUrl,"?")+new URLSearchParams(l).toString(),[4,this.storage.shopData(p).get()];case 3:return y=C.sent()||{},!e&&y&&y.data&&Date.now()<y.data.expired?[2,A={shop:null===(o=y.data)||void 0===o?void 0:o.shop,random:y.data.random,coupons:null===(a=y.data)||void 0===a?void 0:a.coupons}]:this.isFetching[p]?((0,i.Ki)("CouponsApi.fetch is busy and will retry",i.Bc.API),[2,new Promise((function(r){return setTimeout((function(){return r(E.fetch(t,e,n))}),1e3)}))]):(this.isFetching[p]=!0,P={},k={},null==n?[3,4]:(v=n,[3,6]));case 4:return[4,this.storage.token.get()];case 5:v=C.sent()||"",C.label=6;case 6:P.headers=(k.token=v,k),b=P,C.label=7;case 7:return C.trys.push([7,12,,13]),[4,fetch(h,b)];case 8:return(w=C.sent()).ok||(0,i.Cv)("Fetching data from '".concat(this.apiUrl,"' failed\n                    with code ").concat(w.status," and message:"),w.text),[4,w.json()];case 9:return _=C.sent(),g=_.error,m=_.data,g?(delete this.isFetching[p],[2,{error:g,shop:null,random:!0,coupons:[]}]):(S=m.shop&&function(t,e){var n=detectScriptType(t.script_name,t.js)!==d.JSON||t.supported_partial;return{url:t.shop_url,id:t.shop_id,logo:t.shop_logo,absoluteLogo:t.shop_logo_absolute_url,name:t.shop_name,scriptName:t.script_name||"",isPreSupported:n,isHomePagePopup:t.home_page_popup,isSameTabLink:t.same_tab_link,existInSupported:e,affiliateUrl:t.affiliate_url,affiliateNetwork:t.affiliate_network,isCashback:t.is_cashback,matches:t.matches,js:t.js||[""],cashback:convertApiCashbackToModel(t.cashback),rct_object:t.rct_object}}(m.shop,c),A={shop:S,random:m.random,coupons:m.coupons.data.map(convertApiCouponToModel)},[4,this.storage.shopData(p).get()]);case 10:return(O=C.sent()||{}).data=__assign(__assign({},A),{expired:Date.now()+this.couponsCacheTime}),[4,this.storage.shopData(p).set(O)];case 11:return C.sent(),delete this.isFetching[p],[2,A];case 12:return x=C.sent(),delete this.isFetching[p],(0,i.Ki)("CouponsApi.fetch failed",i.Bc.API,{error:x}),[2,{error:x,shop:null,random:!0,coupons:[]}];case 13:return[2]}}))}))},CouponsApi}(),k=new P(y,f.T5+f.hs,f.gl,b,f.I.DEFAULT_STORAGE_SHOP_KEY),convertApiShopsToModel=function(t){return t.map((function(t){return{couponsCount:t.coupons_count,id:t.id,isCashback:t.is_cashback,isPopular:t.is_popular,isUrlValid:t.is_url_valid,logo:t.logo_resize,absoluteLogo:t.logo_resize_absolute_url,name:t.name,protocol:t.protocol,supported:t.supported,url:t.url,cashback:t.cashback&&convertApiCashbackToModel(t.cashback)}}))},shops_assign=function(){return shops_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},shops_assign.apply(this,arguments)},shops_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},shops_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},E=function(){function ShopsApi(t,e,n,r){void 0===e&&(e={}),void 0===n&&(n={}),this.storage=t,this.endpoints=e,this.defaultParams=n,this.cacheTime=r,this.isFetching={}}return ShopsApi.prototype.fetch=function(t){var e;return void 0===t&&(t=1),shops_awaiter(this,void 0,void 0,(function(){var n,r,o,i,a,u,s,c,l,f,p,d;return shops_generator(this,(function(h){switch(h.label){case 0:return t&&1!==t?[3,2]:[4,this.storage.shops.getIfNotExpired()];case 1:if((s=h.sent())&&1===(null===(e=s.pagination)||void 0===e?void 0:e.currentPage))return[2,s];h.label=2;case 2:return this.isFetching[t]?[2,{shops:[],pagination:null,error:null}]:(this.isFetching[t]=!0,d={page:"".concat(t),environment:this.defaultParams.environment},[4,this.storage.leadId.get()]);case 3:d.lead_id=h.sent()||"",n=d,r="".concat(this.endpoints.API_URL+this.endpoints.SHOPS_GET_ENDPOINT,"?")+new URLSearchParams(n).toString(),h.label=4;case 4:return h.trys.push([4,9,,10]),[4,fetch(r)];case 5:return[4,h.sent().json()];case 6:return o=h.sent(),i=o.error,a=o.data,delete this.isFetching[t],i?[2,{shops:[],pagination:null,error:i}]:(u=a.shops,s=u.data,c=u.current_page,l=u.last_page,f={shops:convertApiShopsToModel(s),pagination:convertApiPaginationToModel({current_page:c,last_page:l})},1!==c?[3,8]:[4,this.storage.shops.setWithExpire(f,this.cacheTime)]);case 7:h.sent(),h.label=8;case 8:return[2,shops_assign(shops_assign({},f),{error:null})];case 9:return p=h.sent(),delete this.isFetching[t],[2,{shops:[],pagination:null,error:p}];case 10:return[2]}}))}))},ShopsApi.prototype.search=function(t){return shops_awaiter(this,void 0,void 0,(function(){var e,n,r,o,i,a,u,s,c,l;return shops_generator(this,(function(f){switch(f.label){case 0:return l={shopName:t.shopName,environment:this.defaultParams.environment},[4,this.storage.leadId.get()];case 1:l.lead_id=f.sent()||"",e=l,t.page&&(e.page="".concat(t.page)),n="".concat(this.endpoints.API_URL+this.endpoints.SHOPS_SEARCH_ENDPOINT,"?")+new URLSearchParams(e).toString(),f.label=2;case 2:return f.trys.push([2,5,,6]),[4,fetch(n)];case 3:return[4,f.sent().json()];case 4:return r=f.sent(),o=r.error,i=r.data,o?[2,{shops:[],pagination:null,error:o}]:(a=i.shops,u=a.data,s=a.current_page,c=a.last_page,[2,{shops:convertApiShopsToModel(u),pagination:convertApiPaginationToModel({current_page:s,last_page:c}),error:null}]);case 5:return[2,{shops:[],pagination:null,error:f.sent()}];case 6:return[2]}}))}))},ShopsApi}(),C={API_URL:f.T5,SHOPS_GET_ENDPOINT:f.Q$,SHOPS_SEARCH_ENDPOINT:f.pw},I=new E(y,C,b,f.as),convertStringToNumber=function(t){return t?+t:0};var getShopType=function(t){var e=t.partialSupported,n=t.isCashback,r=t.hasCoupons;return r&&!e?"Fully supported":e&&!r?"No coupons":n?"Cashback only":r?"":"No coupons"},auth_assign=function(){return auth_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},auth_assign.apply(this,arguments)},auth_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},auth_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},__spreadArray=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},j=function(){function AuthApi(t,e,n,r,o,i){void 0===e&&(e={}),void 0===n&&(n={}),void 0===r&&(r={}),this.storage=t,this.defaultParams=e,this.endpoints=n,this.authStatusCodes=r,this.tokenParserFilePath=o,this.cacheTime=i}return AuthApi.prototype.storeLogoutMessage=function(t,e){var n;return auth_awaiter(this,void 0,void 0,(function(){var r,o,i;return auth_generator(this,(function(a){switch(a.label){case 0:return r=10,[4,this.storage.log.get()];case 1:return o=a.sent(),i={message:"".concat((new Date).toLocaleString(),": ").concat(t),payload:e},[4,this.storage.log.set(auth_assign(auth_assign({},o),{logouts:__spreadArray([i],null!==(n=null==o?void 0:o.logouts)&&void 0!==n?n:[],!0).slice(0,r)}))];case 2:return a.sent(),[2]}}))}))},AuthApi.prototype.register=function(t){return auth_awaiter(this,void 0,void 0,(function(){var e,n,r,o,i,a,u,s,c,l;return auth_generator(this,(function(f){switch(f.label){case 0:return f.trys.push([0,5,,6]),[4,this.storage.referralInvitedToken.get()];case 1:return e=f.sent(),n={login:t.login,password:t.password},e&&(n.ref=e),r=fetch,o=[this.endpoints.API_URL+this.endpoints.REGISTRATION_ENDPOINT],c={method:"POST"},l={"Content-Type":"application/json"},i="lead-id",[4,this.storage.leadId.get()];case 2:return[4,r.apply(void 0,o.concat([(c.headers=(l[i]=f.sent()||"",l["extension-version"]=this.defaultParams.extension_version,l),c.body=JSON.stringify(n),c)]))];case 3:return[4,f.sent().json()];case 4:return a=f.sent(),u=a.error,s=a.token,u&&u.code===this.authStatusCodes.EMAIL_ALREADY_REGISTERED?[2,this.login(t)]:[2,this.handleAuthResponse({error:u,token:s,isModal:t.isModal,isNewUser:!0})];case 5:return[2,{user:null,error:f.sent()}];case 6:return[2]}}))}))},AuthApi.prototype.login=function(t){return auth_awaiter(this,void 0,void 0,(function(){var e,n,r;return auth_generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,fetch(this.endpoints.API_URL+this.endpoints.LOGIN_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})];case 1:return[4,o.sent().json()];case 2:return e=o.sent(),n=e.error,r=e.token,[2,this.handleAuthResponse({error:n,token:r,isModal:t.isModal,isNewUser:!1})];case 3:return[2,{user:null,error:o.sent()}];case 4:return[2]}}))}))},AuthApi.prototype.deleteAccount=function(){return auth_awaiter(this,void 0,void 0,(function(){var t,e,n,r,o,a,u,s,c,l,f;return auth_generator(this,(function(p){switch(p.label){case 0:return p.trys.push([0,12,,13]),c={},e="lead-id",[4,this.storage.leadId.get()];case 1:return c[e]=p.sent()||"",c["extension-version"]=this.defaultParams.extension_version,t=c,n=fetch,r=[this.endpoints.API_URL+this.endpoints.CURRENT_USER_UPDATE_ENDPOINT],l={method:"DELETE"},f={"Content-Type":"application/json"},[4,this.storage.token.get()];case 2:return[4,n.apply(void 0,r.concat([(l.headers=(f.token=p.sent()||"",f),l.body=JSON.stringify(t),l)]))];case 3:return[4,p.sent().json()];case 4:return o=p.sent(),a=o.error,u=o.message,(s="deleted"===u)?[4,this.storage.isLoggedUser.set(!1)]:[3,10];case 5:return p.sent(),[4,this.storage.user.unset()];case 6:return p.sent(),[4,this.storage.userId.unset()];case 7:return p.sent(),[4,this.storage.token.unset()];case 8:return p.sent(),[4,this.storeLogoutMessage("lo01")];case 9:return p.sent(),[3,11];case 10:(0,i.Cv)("DELETE /api/user/current not successful",u),p.label=11;case 11:return[2,{success:s,error:a}];case 12:return[2,{success:!1,error:p.sent()}];case 13:return[2]}}))}))},AuthApi.prototype.logout=function(t,e){return auth_awaiter(this,void 0,void 0,(function(){var n,r,o,a,u,s,c;return auth_generator(this,(function(l){switch(l.label){case 0:return[4,Promise.all([this.storage.token.get(),this.storage.leadId.get()])];case 1:n=l.sent(),r=n[0],o=void 0===r?"":r,a=n[1],u=void 0===a?"":a,l.label=2;case 2:return l.trys.push([2,4,,5]),[4,fetch(this.endpoints.API_URL+this.endpoints.LOGOUT_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json",token:o},body:JSON.stringify({token:o,lead_id:u,extension_version:this.defaultParams.extension_version})})];case 3:return l.sent(),[3,5];case 4:return s=l.sent(),(0,i.Cv)("Logout error: ",s.message),[3,5];case 5:return t?[4,this.storage.shopData(t).get()]:[3,8];case 6:return(c=l.sent())?(delete c.cashback,[4,this.storage.shopData(t).set(c)]):[3,8];case 7:l.sent(),l.label=8;case 8:return[4,this.storage.isLoggedUser.set(!1)];case 9:return l.sent(),[4,this.storage.user.unset()];case 10:return l.sent(),[4,this.storage.userId.unset()];case 11:return l.sent(),[4,this.storage.token.unset()];case 12:return l.sent(),[4,this.storeLogoutMessage("lo02",e)];case 13:return l.sent(),[4,k.fetch(t,!0)];case 14:return l.sent(),Tn.sendEvent(g.LOG_OUT),[2,!0]}}))}))},AuthApi.prototype.getUser=function(t){return auth_awaiter(this,void 0,void 0,(function(){var e,n,r,o,i,a,u;return auth_generator(this,(function(s){switch(s.label){case 0:return X.checkLeadIdUser(),[4,this.storage.user.getIfNotExpired()];case 1:return(e=s.sent())?[2,{user:e}]:[4,this.storage.leadId.get()];case 2:n=s.sent()||"",r={lead_id:n,extension_version:this.defaultParams.extension_version},o=this.endpoints.API_URL+this.endpoints.CURRENT_USER_ENDPOINT,i="".concat(o,"?")+new URLSearchParams(r).toString(),s.label=3;case 3:return s.trys.push([3,5,,11]),[4,fetch(i,{method:"GET",headers:{"Content-Type":"application/json",token:t}})];case 4:return a=s.sent(),[2,this.handleUserDataResponse(a)];case 5:return u=s.sent(),[4,this.storage.isLoggedUser.set(!1)];case 6:return s.sent(),[4,this.storage.user.unset()];case 7:return s.sent(),[4,this.storage.userId.unset()];case 8:return s.sent(),[4,this.storage.token.unset()];case 9:return s.sent(),[4,this.storeLogoutMessage("lo03",u)];case 10:return s.sent(),[2,{user:null,error:u}];case 11:return[2]}}))}))},AuthApi.prototype.updateUser=function(t){return auth_awaiter(this,void 0,void 0,(function(){var e,n,r,o,i,a;return auth_generator(this,(function(u){switch(u.label){case 0:return u.trys.push([0,4,,5]),n=fetch,r=[this.endpoints.API_URL+this.endpoints.CURRENT_USER_UPDATE_ENDPOINT],i={method:"PUT"},a={"Content-Type":"application/json"},[4,this.storage.token.get()];case 1:return a.token=u.sent()||"",o="lead-id",[4,this.storage.leadId.get()];case 2:return[4,n.apply(void 0,r.concat([(i.headers=(a[o]=u.sent()||"",a["extension-version"]=this.defaultParams.extension_version,a),i.body=JSON.stringify(t),i)]))];case 3:return e=u.sent(),[2,this.handleUserDataResponse(e,!0)];case 4:return[2,{user:null,error:u.sent()}];case 5:return[2]}}))}))},AuthApi.prototype.handleAuthResponse=function(t){var e,n=t.error,r=t.token,o=t.isModal,i=t.isNewUser;return auth_awaiter(this,void 0,void 0,(function(){var t;return auth_generator(this,(function(a){switch(a.label){case 0:return n?[2,{user:null,error:n}]:[4,this.saveToken(r)];case 1:return a.sent(),[4,this.getUser(r)];case 2:return(t=a.sent()).user&&this.sendAuthAnalytics({email:t.user.login,name:null===(e=t.user)||void 0===e?void 0:e.name,isModal:o,isNewUser:i}),[2,t]}}))}))},AuthApi.prototype.handleUserDataResponse=function(t,e){return auth_awaiter(this,void 0,void 0,(function(){var n,r,o,i,a;return auth_generator(this,(function(u){switch(u.label){case 0:return[4,t.json()];case 1:return n=u.sent(),r=n.error,o=n.data,r?[4,this.storage.isLoggedUser.set(!1)]:[3,7];case 2:return u.sent(),[4,this.storage.user.unset()];case 3:return u.sent(),[4,this.storage.userId.unset()];case 4:return u.sent(),[4,this.storage.token.unset()];case 5:return u.sent(),[4,this.storeLogoutMessage("lo04",r)];case 6:return u.sent(),[2,{user:null,error:r}];case 7:return[4,this.storage.isLoggedUser.set(!0)];case 8:return u.sent(),i=function(t){return{id:t.id,email:t.login,referralLink:t.referral_link}}(o),[4,this.storage.lastUser.set(i)];case 9:return u.sent(),[4,updateUninstallUrl({email:i.email})];case 10:return u.sent(),a=function(t){return{allPoints:parseFloat(t.all_points),balance:parseFloat(t.balance),btcTotal:convertStringToNumber(t.btc_total),eurTotal:convertStringToNumber(t.eur_total),pendingBtc:convertStringToNumber(t.pending_btc),pendingEur:convertStringToNumber(t.pending_eur),confirmedBtc:convertStringToNumber(t.confirmed_btc),confirmedEur:convertStringToNumber(t.confirmed_eur),couponsPurchaseSaved:parseFloat(t.coupons_purchase_saved),pendingPoints:t.pending_points?parseFloat(t.pending_points):0,id:t.id,invitationPopupShownCount:t.invitation_popup_shown_count,invitationPopupShownLastTime:t.invitation_popup_shown_last_time,login:t.login,name:t.name,points:parseFloat(t.points),referralLink:t.referral_link,transactionLastTime:t.transaction_last_time,treesPlanted:t.trees_planted,relationships:{transactions:(e=t.relationships.transactions,{data:convertApiTransactionDataToModel(e.data),pagination:convertApiPaginationToModel({current_page:e.current_page,last_page:e.last_page})})}};var e}(o),[4,this.storage.user.setWithExpire(a,this.cacheTime)];case 11:return u.sent(),[4,this.storage.userId.set(a.id)];case 12:return u.sent(),e&&Tn.sendUserProperties({name:a.name}),[2,{user:a,error:null}]}}))}))},AuthApi.prototype.googleAuth=function(t){return this.createAuthWindow({url:this.endpoints.GOOGLE_AUTH_ENDPOINT,width:500,height:560},t)},AuthApi.prototype.facebookAuth=function(t){return this.createAuthWindow({url:this.endpoints.FACEBOOK_AUTH_ENDPOINT,width:640,height:700},t)},AuthApi.prototype.sendAuthAnalytics=function(t){var e=t.isNewUser,n=t.email,r=t.name,o=t.isModal;if(e){var i=function(t){var e=t.email,n=t.isModal;return{eventName:g.SIGN_UP,alias:e,eventProperties:{Context:n?"Pop Up":"Extension"},userProperties:{email:e,"Registration Method":"E-mail"}}}({email:n,isModal:o});Tn.send(i)}else{i=function(t){var e=t.email,n=t.isModal;return{eventName:g.LOG_IN,identify:e,userProperties:{email:e},eventProperties:{Context:n?"Pop Up":"Extension","Login Method":"E-mail"}}}({email:n,isModal:o});Tn.send(i)}r&&Tn.sendUserProperties({name:r}),Tn.sendSuperProperties({"Extension Version":"3.0.1.5"})},AuthApi.prototype.saveToken=function(t,e,n){return auth_awaiter(this,void 0,void 0,(function(){var r,o;return auth_generator(this,(function(i){switch(i.label){case 0:return[4,this.storage.lastShopDomain.get()];case 1:return r=i.sent(),[4,k.fetch(r,!0,t)];case 2:return i.sent(),[4,this.storage.token.set(t)];case 3:return i.sent(),[4,Promise.all([this.storage.referralInvitedToken.get(),this.getUser(t)])];case 4:return o=i.sent()[0],n&&"registration"===e&&o?[4,Rn.sendUserSyncReferral(o)]:[3,6];case 5:i.sent(),i.label=6;case 6:return[2]}}))}))},AuthApi.prototype.sendSocialAuthAnalytics=function(t){var e,n,r,o={provider:t.provider,isModal:t.isModal};if(t.type&&"registration"===t.type){var i=(n=(e=o).provider,r=e.isModal,{eventName:g.SIGN_UP,eventProperties:{Context:r?"Pop Up":"Extension"},userProperties:{"Registration Method":n}});Tn.send(i)}else{i=function(t){var e=t.provider,n=t.isModal;return{eventName:g.LOG_IN,eventProperties:{"Login Method":e,Context:n?"Pop Up":"Extension"}}}(o);Tn.send(i)}Tn.sendSuperProperties({"Extension Version":"3.0.1.5"})},AuthApi.prototype.createAuthWindow=function(t,e){var n;return auth_awaiter(this,void 0,void 0,(function(){var r,o,i,a;return auth_generator(this,(function(u){switch(u.label){case 0:return u.trys.push([0,5,,6]),f.Fn?[4,compat.tabs.create({url:this.endpoints.API_URL+t.url,active:!0})]:[3,2];case 1:return[2,(a=null===(n=u.sent())||void 0===n?void 0:n.id)?this.getAuthToken(e,0,a):null];case 2:return[4,compat.windows.create({url:this.endpoints.API_URL+t.url,type:"popup",width:t.width,height:t.height})];case 3:return r=u.sent(),o=r&&r.tabs?r.tabs[0]:null,i=(null==r?void 0:r.id)||(null==o?void 0:o.windowId)||null,a=(null==o?void 0:o.id)||null,[2,i?this.getAuthToken(e,i,a):null];case 4:return[3,6];case 5:return u.sent(),[2,null];case 6:return[2]}}))}))},AuthApi.prototype.getAuthToken=function(t,e,n){return auth_awaiter(this,void 0,void 0,(function(){var r=this;return auth_generator(this,(function(o){return[2,new Promise((function(o){var authTokenListener=function(i,a,u){return auth_awaiter(r,void 0,void 0,(function(){var r,s,c,l,p,d,h,y,b,v,w;return auth_generator(this,(function(_){switch(_.label){case 0:if(r="",s="",c=!!(null===(v=u.url)||void 0===v?void 0:v.includes(this.endpoints.ADMIN_AUTH_GOOGLE_URL)),l=!!(null===(w=u.url)||void 0===w?void 0:w.includes(this.endpoints.ADMIN_AUTH_FACEBOOK_URL)),"complete"!==a.status||!c&&!l||n!==u.id)return[3,5];_.label=1;case 1:return _.trys.push([1,4,,5]),[4,compat.scripting.executeScript({target:{tabId:n},file:this.tokenParserFilePath})];case 2:for(p=_.sent(),d=0,h=p;d<h.length;d++)if(y=h[d],(b=y.result||y)&&b.token){r=b.token,s=(null==b?void 0:b.type)||"",this.sendSocialAuthAnalytics({type:s,provider:null==b?void 0:b.provider,isModal:t});break}return f.Fn?compat.tabs.remove(u.id||i):e&&compat.windows.remove(e),[4,this.saveToken(r,s,!0)];case 3:return _.sent(),compat.tabs.onUpdated.removeListener(authTokenListener),o(r),[3,5];case 4:return _.sent(),o(null),[3,5];case 5:return[2]}}))}))};compat.tabs.onUpdated.addListener(authTokenListener)}))]}))}))},AuthApi}(),D={API_URL:f.T5,LOGIN_ENDPOINT:f.LW,LOGOUT_ENDPOINT:f.Eh,REGISTRATION_ENDPOINT:f.Dc,CURRENT_USER_ENDPOINT:f.V2,CURRENT_USER_UPDATE_ENDPOINT:f.GB,GOOGLE_AUTH_ENDPOINT:f.zW,FACEBOOK_AUTH_ENDPOINT:f._y,ADMIN_AUTH_GOOGLE_URL:f.Ik,ADMIN_AUTH_FACEBOOK_URL:f.v7},R=new j(y,b,D,f.ds,f.ph,f.R4),getBrowserName=function(){var t=navigator.userAgent;return t.match(/edg/i)?"edge":t.match(/opr\//i)?"opera":t.match(/chrome|chromium|crios/i)?"chrome":t.match(/firefox|fxios/i)?"firefox":t.match(/safari/i)?"safari":""},authWindow_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},authWindow_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},L=function(){function AuthWindowApi(t,e){this.authModalUrl=t,this.storage=e}return AuthWindowApi.prototype.open=function(t){return authWindow_awaiter(this,void 0,void 0,(function(){var e,n,r,o,i,a;return authWindow_generator(this,(function(u){switch(u.label){case 0:return t?[4,this.close()]:[2];case 1:return u.sent(),[4,this.storage.authWindowOptions(t.shopUrl).set(t)];case 2:return u.sent(),[4,compat.windows.getCurrent()];case 3:return e=u.sent(),n=360,r="firefox"===getBrowserName()?570:560,o=0,i=0,(null==e?void 0:e.width)&&e.left&&e.height&&e.top&&(o=(null==e?void 0:e.width)/2-n/2+e.left,i=e.height/2-r/2+e.top),a="".concat(this.authModalUrl,"&shopUrl=").concat(t.shopUrl),f.Fn?[4,compat.tabs.create({url:a,active:!0})]:[3,5];case 4:return u.sent(),[3,7];case 5:return[4,compat.windows.create({url:a,type:"popup",width:n,height:r,top:Math.round(i),left:Math.round(o)})];case 6:u.sent(),u.label=7;case 7:return[2]}}))}))},AuthWindowApi.prototype.close=function(){return authWindow_awaiter(this,void 0,void 0,(function(){var t;return authWindow_generator(this,(function(e){switch(e.label){case 0:return[4,this.getOpenedAuthWindowId()];case 1:if(!(t=e.sent()))return[3,7];e.label=2;case 2:return e.trys.push([2,6,,7]),f.Fn?[4,compat.tabs.remove(t)]:[3,4];case 3:return e.sent(),[2];case 4:return[4,compat.windows.remove(t)];case 5:return e.sent(),[3,7];case 6:return e.sent(),(0,i.Cv)("couldn't remove auth window"),[3,7];case 7:return[2]}}))}))},AuthWindowApi.prototype.getOpenedAuthWindowId=function(){return authWindow_awaiter(this,void 0,void 0,(function(){var t,e,n,r;return authWindow_generator(this,(function(o){switch(o.label){case 0:return[4,compat.tabs.query({active:!f.Fn||void 0})];case 1:if(0===(t=o.sent()).length)return[2,null];for(e=0,n=t;e<n.length;e++)if((r=n[e]).url&&r.id&&r.url.includes(this.authModalUrl))return f.Fn?[2,r.id]:[2,r.windowId||null];return[2,null]}}))}))},AuthWindowApi}(),U=new L(f.w9,y),transactions_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},transactions_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},N=function(){function TransactionsApi(t,e,n){void 0===n&&(n={}),this.storage=t,this.apiUrl=e,this.defaultParams=n,this.isFetching={}}return TransactionsApi.prototype.fetch=function(t,e){return transactions_awaiter(this,void 0,void 0,(function(){var e,n,r,o,a,u,s,c,l,p,d,h=this;return transactions_generator(this,(function(y){switch(y.label){case 0:return this.isFetching[t]?[2,{data:[],pagination:null,error:null}]:(this.isFetching[t]=!0,l={page:String(t)},[4,this.storage.leadId.get()]);case 1:return l.lead_id=y.sent()||"",l.extension_version=this.defaultParams.extension_version,e=l,n="".concat(this.apiUrl,"?")+new URLSearchParams(e).toString(),p={},d={"Cache-Control":"max-age=".concat(this.defaultParams.cacheTime)},[4,this.storage.token.get()];case 2:p.headers=(d.token=y.sent()||"",d),r=p,y.label=3;case 3:return y.trys.push([3,6,,7]),[4,fetch(n,r).catch((function(){throw delete h.isFetching[t],f.Fe}))];case 4:return[4,y.sent().json()];case 5:return o=y.sent(),a=o.error,u=o.data,s=o.meta,a?(delete this.isFetching[t],[2,{data:[],pagination:null,error:a}]):(delete this.isFetching[t],[2,{data:convertApiTransactionDataToModel(u),pagination:convertApiPaginationToModel({current_page:s.current_page,last_page:s.last_page}),error:null}]);case 6:return(c=y.sent())===f.Fe&&(0,i.Ki)("TransactionsApi: no connection",i.Bc.NETWORK),delete this.isFetching[t],[2,{data:[],pagination:null,error:String(c||"unknown")}];case 7:return[2]}}))}))},TransactionsApi}(),B=new N(y,f.T5+f.N5,b),G=/tripadvisor[.]com|lufthansa[.]com/i,F=/awin/i;function isBlockingAffiliateLink(t){return t===x.CJ}var affiliate_assign=function(){return affiliate_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},affiliate_assign.apply(this,arguments)},affiliate_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},affiliate_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},M=function(){function AffiliateApi(t){this.storage=t,this.isFetching={}}return AffiliateApi.prototype.apply=function(t,e){var n=t.affiliateUrl,r=t.affiliateNetwork,o=t.shopUrl,a=t.shopId,u=t.withinSameTab;return affiliate_awaiter(this,void 0,void 0,(function(){var t,s,c,l,p,d,h,y,b,v;return affiliate_generator(this,(function(w){switch(w.label){case 0:return this.isFetching[n]?[2,!0]:(_=n,Boolean(_&&/(http(s?)):\/\//i.test(_))?[3,1]:((0,i.Cv)("Affiliate link is incorrect",n),[2,!1]));case 1:return this.isFetching[n]=!0,this.cashbackAppliedStat(a),t=function(t){return F.test(t)}(r),s=function(t){return G.test(urlToDomain(t)||"")}(o),c={url:n,pinned:!s,active:!1},[4,this.getCurrentShopTabData(o,u,e.tabId)];case 2:return l=w.sent(),p=l.currentShopTab,(d=l.activeWindowId)&&(c.windowId=e.windowId||d),h={affiliateUrl:n,affiliateNetwork:r,isAwin:t,keepOpen:s,withinSameTab:u,shopUrl:o},p?[2,this.onTabCreated(affiliate_assign(affiliate_assign({},h),{currentTab:p,mustUpdateUrl:!0}))]:[3,3];case 3:return f.Fn?[4,compat.tabs.active()]:[3,9];case 4:return y=w.sent(),[4,this.storage.lastActiveTab.get()];case 5:return(b=w.sent())&&b.tabId!==y.id&&b.tabUrl!==y.url?[4,compat.tabs.update(b.tabId,{active:!0})]:[3,7];case 6:w.sent(),w.label=7;case 7:return[4,this.storage.lastActiveTab.unset()];case 8:w.sent(),w.label=9;case 9:return[4,compat.tabs.create(c)];case 10:return v=w.sent(),[2,this.onTabCreated(affiliate_assign(affiliate_assign({},h),{currentTab:v}))]}var _}))}))},AffiliateApi.prototype.onTabCreated=function(t){var e=t.currentTab,n=t.mustUpdateUrl,r=t.affiliateUrl,o=t.affiliateNetwork,a=void 0===o?"":o,u=t.isAwin,s=t.keepOpen,c=t.withinSameTab,l=t.shopUrl;return affiliate_awaiter(this,void 0,void 0,(function(){var t,o,f,p,d=this;return affiliate_generator(this,(function(h){switch(h.label){case 0:return t=!1,isBlockingAffiliateLink(a)&&e.id?[4,isAffiliateDomainBlocked(e.id,l,a)]:[3,4];case 1:return h.sent()?((0,i.Cv)("".concat(a," affiliate cannot be opened in this tab"),r),[2,!1]):[3,2];case 2:return[4,blockingAffiliateMergeDomainData(e.id,l,{redirectAllowed:!0},a)];case 3:h.sent(),t=!0,h.label=4;case 4:return[4,this.storage.affiliateTabIds.get()];case 5:return(o=h.sent()||{})[String(e.id)]=!0,[4,this.storage.affiliateTabIds.set(o)];case 6:return h.sent(),n&&e.id?(f=e.id,[4,new Promise((function(t){return setTimeout((function(){return affiliate_awaiter(d,void 0,void 0,(function(){return affiliate_generator(this,(function(e){switch(e.label){case 0:return[4,compat.tabs.update(f,{url:r})];case 1:return e.sent(),t(!0),[2]}}))}))}),300)}))]):[3,8];case 7:h.sent(),h.label=8;case 8:return[2,new Promise((function(o){var affiliatePageListener=function(i,f,h){return affiliate_awaiter(d,void 0,void 0,(function(){var y;return affiliate_generator(this,(function(b){var v,w,_;return"complete"===f.status&&i===(null==e?void 0:e.id)&&(y=function(t){var e=t.withinSameTab,n=t.isAwin;return e?0:n?2e3:7e3}({withinSameTab:c,isAwin:u}),v=affiliatePageListener,w=y,_=h,p&&clearTimeout(p),p=setTimeout((function(){return affiliate_awaiter(d,void 0,void 0,(function(){var e;return affiliate_generator(this,(function(i){switch(i.label){case 0:return[4,this.closeAffiliateTab({tab:_,listener:v,keepOpen:s,mustUpdateUrl:n,blockingAffiliateDisallowRedirect:t,shopUrl:l,affiliateUrl:r,affiliateNetwork:a})];case 1:return e=i.sent(),o(e),[2]}}))}))}),w)),[2]}))}))};compat.tabs.onUpdated.addListener(affiliatePageListener)}))]}}))}))},AffiliateApi.prototype.closeAffiliateTab=function(t){var e=t.tab,n=t.listener,r=t.keepOpen,o=t.mustUpdateUrl,a=t.blockingAffiliateDisallowRedirect,u=t.shopUrl,s=t.affiliateUrl,c=t.affiliateNetwork;return affiliate_awaiter(this,void 0,void 0,(function(){var t,l;return affiliate_generator(this,(function(f){switch(f.label){case 0:return[4,this.storage.affiliateTabIds.get()];case 1:return(t=f.sent()||{})[String(e.id)]?(delete t[String(e.id)],[4,this.storage.affiliateTabIds.set(t)]):[3,3];case 2:f.sent(),f.label=3;case 3:return compat.tabs.onUpdated.removeListener(n),e.id&&a&&isBlockingAffiliateLink(c)?[4,blockingAffiliateMergeDomainData(e.id,u,{redirectAllowed:!1},c)]:[3,5];case 4:f.sent(),f.label=5;case 5:if(delete this.isFetching[s],o)return[3,11];if(r)return[2,!0];f.label=6;case 6:return f.trys.push([6,10,,11]),e.id?[4,compat.tabs.remove(e.id)]:[3,8];case 7:return f.sent(),[3,9];case 8:throw new Error("closeAffiliateTab: no id for tab ".concat(e.url));case 9:return[3,11];case 10:return l=f.sent(),(0,i.Cv)("failed to delete affiliate tab: ",null==l?void 0:l.message),[3,11];case 11:return[2,!0]}}))}))},AffiliateApi.prototype.getCurrentShopTabData=function(t,e,n){return affiliate_awaiter(this,void 0,void 0,(function(){var r,o;return affiliate_generator(this,(function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),n?[4,compat.tabs.get(n)]:[3,2];case 1:return r=a.sent(),[2,this.getShopTabData(e,t,r)];case 2:return[4,compat.tabs.query({active:!0,currentWindow:!0})];case 3:return o=a.sent(),[2,this.getShopTabData(e,t,o[0])];case 4:return[3,6];case 5:return a.sent(),(0,i.Cv)("couldn't get current windowId"),[2,{currentShopTab:null,activeWindowId:null}];case 6:return[2]}}))}))},AffiliateApi.prototype.cashbackAppliedStat=function(t){t&&z.cashbackApplied({shopId:t})},AffiliateApi.prototype.getShopTabData=function(t,e,n){var r,o=null,i=null;return n&&n.url&&urlToDomain(n.url)===urlToDomain(e)&&(o=t?n:null,i=null!==(r=n.windowId)&&void 0!==r?r:null),{currentShopTab:o,activeWindowId:i}},AffiliateApi}(),H=new M(y),supportedDomains_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},supportedDomains_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},K=function(){function SupportedDomainsApi(t,e,n,r,o){void 0===o&&(o={}),this.apiUrl=t,this.fallbackApiUrl=e,this.domainsCacheTime=n,this.storage=r,this.defaultParams=o}return SupportedDomainsApi.prototype.fetch=function(){return supportedDomains_awaiter(this,void 0,void 0,(function(){var t,e,n,r,o,i=this;return supportedDomains_generator(this,(function(a){switch(a.label){case 0:return[4,this.storage.supportedDomains.get()];case 1:if((t=a.sent())&&Date.now()<t.expired)return[2,t.data];if(SupportedDomainsApi.busy)return[2,new Promise((function(t){return setTimeout((function(){return t(i.fetch())}),1e3)}))];SupportedDomainsApi.busy=!0,e={extension_version:this.defaultParams.extension_version,environment:"prod"},r="".concat(this.apiUrl,"?")+new URLSearchParams(e).toString(),a.label=2;case 2:return a.trys.push([2,8,,10]),[4,fetch(r)];case 3:return(o=a.sent()).ok?[4,o.json()]:[3,5];case 4:return n=a.sent(),[3,7];case 5:return[4,this.fetchFallbackSupportedDomains()];case 6:n=a.sent(),a.label=7;case 7:return[3,10];case 8:return a.sent(),[4,this.fetchFallbackSupportedDomains()];case 9:return n=a.sent(),[3,10];case 10:return!n&&t?(SupportedDomainsApi.busy=!1,[2,t.data]):[4,this.storage.supportedDomains.setWithExpire(n,this.domainsCacheTime)];case 11:return a.sent(),SupportedDomainsApi.busy=!1,[2,n]}}))}))},SupportedDomainsApi.prototype.fetchFallbackSupportedDomains=function(){return supportedDomains_awaiter(this,void 0,void 0,(function(){return supportedDomains_generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,fetch(this.fallbackApiUrl)];case 1:return[4,t.sent().json()];case 2:return[2,t.sent()];case 3:return t.sent(),[2,null];case 4:return[2]}}))}))},SupportedDomainsApi}(),W=new K(f.T5+f.qo,f.tL,f.Ey,y,b),shopScript_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},shopScript_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Y=function(){function ShopScriptApi(){}return ShopScriptApi.prototype.fetch=function(t,e,n,r){return shopScript_awaiter(this,void 0,void 0,(function(){var o,i,a,u;return shopScript_generator(this,(function(s){switch(s.label){case 0:return n||(n=function(t,e){switch(e){case d.JSON:return t+".json";case d.JS:return t.split(".")[0]+".js";default:return""}}(t,e)),o="".concat(f.Ct).concat(n,"?").concat(Date.now().toString().slice(0,-3)),[4,fetch(o,{method:"GET",headers:{"Content-Type":e===d.JSON?"application/json":"text/javascript"}})];case 1:if(!(i=s.sent()).ok)throw new Error(i.status.toString());return e!==d.JSON?[3,2]:[2,i.json()];case 2:return[4,this.fetchExtensionScripts(r)];case 3:return a=s.sent(),[4,i.text()];case 4:return u=s.sent(),[2,{requiredScript:a,shopScript:u}]}}))}))},ShopScriptApi.prototype.fetchExtensionScripts=function(t){return shopScript_awaiter(this,void 0,void 0,(function(){var e,n,r,o,i,a,u;return shopScript_generator(this,(function(s){switch(s.label){case 0:e="",n=0,r=t,s.label=1;case 1:return n<r.length?(o=r[n],i=o.replace("helper-scripts/",""),(a=compat.runtime.getURL("".concat(f.jW).concat(i)))?[4,fetch(a)]:[3,4]):[3,5];case 2:return[4,s.sent().text()];case 3:u=s.sent(),e+=u,s.label=4;case 4:return n++,[3,1];case 5:return[2,e]}}))}))},ShopScriptApi}(),V=new Y,badge_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},badge_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},setBadgeState=function(t,e){return badge_awaiter(void 0,void 0,void 0,(function(){var n,r,o;return badge_generator(this,(function(a){switch(a.label){case 0:if(a.trys.push([0,5,,6]),n=e?String(e):"",!t)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,compat.action.setBadgeText({tabId:t,text:n})];case 2:return a.sent(),[3,4];case 3:return r=a.sent(),(0,i.Cv)("Error resetting the badge text",r),[3,4];case 4:return compat.action.setBadgeBackgroundColor(f.P$),[3,6];case 5:return o=a.sent(),(0,i.Cv)("setBadgeState error: ",null==o?void 0:o.message),[3,6];case 6:return[2]}}))}))},setBadgeStateEbay=function(t){return badge_awaiter(void 0,void 0,void 0,(function(){var e,n,r;return badge_generator(this,(function(o){switch(o.label){case 0:return[4,compat.tabs.active().then((function(t){return t}))];case 1:return(e=o.sent())&&e.id&&e.windowId?[4,y.ebay(e.id,e.windowId).get()]:[3,10];case 2:return n=o.sent(),r=t?String(t):"",n?n.restricted?[4,compat.action.setBadgeText({tabId:e.id,text:""})]:[3,4]:[3,7];case 3:return o.sent(),[3,6];case 4:return n.restricted||n.calculationDisabled?[3,6]:[4,compat.action.setBadgeText({tabId:e.id,text:r})];case 5:o.sent(),o.label=6;case 6:return[3,9];case 7:return[4,compat.action.setBadgeText({tabId:e.id,text:r})];case 8:o.sent(),o.label=9;case 9:return[3,12];case 10:return[4,compat.action.setBadgeText({text:""})];case 11:o.sent(),o.label=12;case 12:return compat.action.setBadgeBackgroundColor(f.P$),[2]}}))}))},stats_assign=function(){return stats_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},stats_assign.apply(this,arguments)},stats_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},stats_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},__rest=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n},q=function(){function StatsApi(t,e,n){void 0===e&&(e={}),void 0===n&&(n={}),this.storage=t,this.endpoints=e,this.defaultParams=n}return StatsApi.prototype.versionChanged=function(t){var e=t.type;return stats_awaiter(this,void 0,void 0,(function(){return stats_generator(this,(function(t){return[2,this.sendAction({endpoint:this.endpoints.VERSIONS,type:e})]}))}))},StatsApi.prototype.popupOpened=function(){return stats_awaiter(this,void 0,void 0,(function(){return stats_generator(this,(function(t){return[2,this.sendAction({endpoint:this.endpoints.OPENS})]}))}))},StatsApi.prototype.productPageVisited=function(t){var e=t.url,n=t.shop_id,r=t.asin;return stats_awaiter(this,void 0,void 0,(function(){return stats_generator(this,(function(t){return[2,this.sendAction({endpoint:this.endpoints.PRODUCT_PAGE_VISITS,url:e,shop_id:n,asin:r})]}))}))},StatsApi.prototype.visited=function(t){var e=t.shopId;return stats_awaiter(this,void 0,void 0,(function(){return stats_generator(this,(function(t){return[2,this.sendAction({endpoint:this.endpoints.VISITS,shop_id:e})]}))}))},StatsApi.prototype.uniqueVisited=function(t){var e=t.shopId;return stats_awaiter(this,void 0,void 0,(function(){return stats_generator(this,(function(t){return[2,this.sendAction({endpoint:this.endpoints.UNIQUE_VISITS,shop_id:e})]}))}))},StatsApi.prototype.applied=function(t){var e=t.shopId;return stats_awaiter(this,void 0,void 0,(function(){return stats_generator(this,(function(t){return[2,this.sendAction({endpoint:this.endpoints.APPLIES,shop_id:e})]}))}))},StatsApi.prototype.uniqueApplied=function(t){var e=t.shopId;return stats_awaiter(this,void 0,void 0,(function(){return stats_generator(this,(function(t){return[2,this.sendAction({endpoint:this.endpoints.UNIQUE_APPLIES,shop_id:e})]}))}))},StatsApi.prototype.cashbackApplied=function(t){var e=t.shopId;return stats_awaiter(this,void 0,void 0,(function(){return stats_generator(this,(function(t){return[2,this.sendAction({endpoint:this.endpoints.CASHBACK_APPLIES,shop_id:e,distinct_id:Tn.getDistinctId()})]}))}))},StatsApi.prototype.saved=function(t){return stats_awaiter(this,void 0,void 0,(function(){return stats_generator(this,(function(e){return[2,this.sendAction({endpoint:this.endpoints.SAVES,shop_id:t.shopId,amount:t.amount,coupon_id:t.couponId})]}))}))},StatsApi.prototype.closed=function(t){return stats_awaiter(this,void 0,void 0,(function(){return stats_generator(this,(function(e){return[2,this.sendAction({endpoint:this.endpoints.CLOSES,shop_id:t.shopId})]}))}))},StatsApi.prototype.purchaseTotal=function(t){return stats_awaiter(this,void 0,void 0,(function(){var e,n;return stats_generator(this,(function(r){switch(r.label){case 0:return e=function(t){var e={shop_id:t.shopId,amount:t.amount,affiliate_url:t.affiliateUrl};return t.currency&&(e.currency=t.currency),t.orderId&&(e.order_id=t.orderId),t.couponId&&(e.coupon_id=t.couponId),t.fullAmount&&(e.full_amount=t.fullAmount),t.saved&&(e.saved=t.saved),e}(t),[4,this.storage.userId.get()];case 1:return n=r.sent(),[2,this.sendAction(stats_assign(stats_assign({},e),{client_id:n,distinct_id:Tn.getDistinctId(),endpoint:this.endpoints.PURCHASE_TOTAL}))]}}))}))},StatsApi.prototype.sendAction=function(t){var e=t.endpoint,n=__rest(t,["endpoint"]);return stats_awaiter(this,void 0,void 0,(function(){var t,r,o,a;return stats_generator(this,(function(u){switch(u.label){case 0:if("dev"===this.defaultParams.environment&&e!==this.endpoints.PURCHASE_TOTAL)return(0,i.Cv)("Enable environment prod. Stat ".concat(e," was not increased.")),[2,!1];u.label=1;case 1:return u.trys.push([1,4,,5]),(0,i.Cv)("%c"+"".concat(this.endpoints.BASE+e),"color: orangered; font-weight: bold",n),a={},[4,this.storage.leadId.get()];case 2:return a.lead_id=u.sent()||"",a.extension_version=this.defaultParams.extension_version,t={"Content-Type":"application/json"},r=stats_assign(stats_assign({},a),n),o=this.endpoints.API_URL+this.endpoints.BASE+e,[4,fetch(o,{method:"POST",headers:t,body:JSON.stringify(r)})];case 3:return u.sent(),[2,!0];case 4:return u.sent(),[2,!1];case 5:return[2]}}))}))},StatsApi}(),services_stats_assign=function(){return services_stats_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},services_stats_assign.apply(this,arguments)},J=services_stats_assign({API_URL:f.T5},f.pF),z=new q(y,J,b),cartStatStorageApi_assign=function(){return cartStatStorageApi_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},cartStatStorageApi_assign.apply(this,arguments)},cartStatStorageApi_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},cartStatStorageApi_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},cartStatStorageApi_setTotal=function(t){var e=t.shopUrl,n=t.shopId,r=t.oldTotal;return cartStatStorageApi_awaiter(void 0,void 0,void 0,(function(){var t;return cartStatStorageApi_generator(this,(function(o){switch(o.label){case 0:return[4,y.shopData(e).get()];case 1:return(t=o.sent())?(t.cartTotal={total:r,expired:Date.now()+f.Hb},[4,y.shopData(e).set(t)]):[2];case 2:return o.sent(),(0,i.Ki)("Stats storage saved value: ".concat(r," for shop id: ").concat(n,"."),i.Bc.BASKET_TOTAL),[2]}}))}))},cartStatStorageApi_getTotal=function(t){return cartStatStorageApi_awaiter(void 0,void 0,void 0,(function(){var e;return cartStatStorageApi_generator(this,(function(n){switch(n.label){case 0:return[4,y.shopData(t).get()];case 1:return(e=n.sent())&&e.cartTotal?Date.now()>e.cartTotal.expired?(delete e.cartTotal,[2,null]):[2,e.cartTotal.total]:[2,null]}}))}))},cartStatStorageApi_setOrderId=function(t){var e=t.shopUrl,n=t.orderId;return cartStatStorageApi_awaiter(void 0,void 0,void 0,(function(){var t;return cartStatStorageApi_generator(this,(function(r){switch(r.label){case 0:return[4,y.shopData(e).get()];case 1:return(t=r.sent())?(t.orderId=n,[4,y.shopData(e).set(t)]):[2];case 2:return r.sent(),(0,i.Ki)("Stats storage saved orderId: ".concat(n," for shop: ").concat(e,"."),i.Bc.BASKET_TOTAL),[2]}}))}))},cartStatStorageApi_setCurrency=function(t){var e=t.shopUrl,n=t.currency,r=t.doNotOverride;return cartStatStorageApi_awaiter(void 0,void 0,void 0,(function(){var t;return cartStatStorageApi_generator(this,(function(o){switch(o.label){case 0:return[4,y.shopData(e).get()];case 1:return(t=o.sent())?t.currency&&r?[2]:[3,2]:[2];case 2:return t.currency=n,[4,y.shopData(e).set(t)];case 3:o.sent(),o.label=4;case 4:return[2]}}))}))},cartStatStorageApi_setSentTotal=function(t){var e=t.shopUrl,n=t.sentTotal;return cartStatStorageApi_awaiter(void 0,void 0,void 0,(function(){var t;return cartStatStorageApi_generator(this,(function(r){switch(r.label){case 0:return[4,y.shopData(e).get()];case 1:return(t=r.sent())?(t.sentCartTotal={sentTotal:n,expired:Date.now()+f.Hb},[4,y.shopData(e).set(t)]):[2];case 2:return r.sent(),[2]}}))}))},cartStatStorageApi_getSentTotal=function(t){return cartStatStorageApi_awaiter(void 0,void 0,void 0,(function(){var e;return cartStatStorageApi_generator(this,(function(n){switch(n.label){case 0:return[4,y.shopData(t).get()];case 1:return(e=n.sent())&&e.sentCartTotal?Date.now()>e.sentCartTotal.expired?(delete e.cartTotal,[2,null]):[2,e.sentCartTotal.sentTotal]:[2,null]}}))}))},cartStatStorageApi_setDiscountedAndCartTotal=function(t){var e=t.shopUrl,n=t.oldTotal,r=t.newTotal;return cartStatStorageApi_awaiter(void 0,void 0,void 0,(function(){var t,o,a,u;return cartStatStorageApi_generator(this,(function(s){switch(s.label){case 0:return[4,y.shopData(e).get()];case 1:return(t=s.sent())?(o={expired:Date.now()+f.Hb,total:r},a=String(n),t.discountedCartsTotal=cartStatStorageApi_assign(cartStatStorageApi_assign({},t.discountedCartsTotal||{}),((u={})[a]=o,u)),t.cartTotal={total:r,expired:Date.now()+f.Hb},[4,y.shopData(e).set(t)]):[2];case 2:return s.sent(),(0,i.Ki)("Stats storage saved discounted value: ".concat(r," in key: ").concat(a,"."),i.Bc.BASKET_DISCOUNT),[2]}}))}))},cartStatStorageApi_checkDiscountedTotal=function(t,e){return cartStatStorageApi_awaiter(void 0,void 0,void 0,(function(){var n,r,o,i,a,u;return cartStatStorageApi_generator(this,(function(s){switch(s.label){case 0:return n=String(e),[4,y.shopData(t).get()];case 1:if(!(null==(r=s.sent())?void 0:r.discountedCartsTotal))return[2,{amount:e}];for(i in o=null,r.discountedCartsTotal)if(i===n){if(!(a=r.discountedCartsTotal[i])||!a.total)continue;if(Date.now()>a.expired){delete r.discountedCartsTotal[i];continue}if(u=parseFloat(i),a.total===e){o={amount:e,fullAmount:u,saved:(100*u-100*e)/100};break}if(u===e){o={amount:a.total,fullAmount:u,saved:(100*u-100*a.total)/100};break}}return o||(o={amount:e}),[4,y.shopData(t).set(r)];case 2:return s.sent(),[2,o]}}))}))},lead_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},lead_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},$=function(){function LeadApi(t,e,n,r,o,i){void 0===e&&(e={}),void 0===n&&(n={}),this.storage=t,this.endpoints=e,this.defaultParams=n,this.leadTriggerTime=r,this.isProcessing=o,this.bindExpireIn=i,this.isFetching=!1}return LeadApi.prototype.createLeadId=function(t){return lead_awaiter(this,void 0,void 0,(function(){var e,n=this;return lead_generator(this,(function(r){switch(r.label){case 0:if(this.isProcessing)return[2];r.label=1;case 1:return r.trys.push([1,6,,7]),this.isProcessing=!0,[4,this.fetchLeadId(Boolean(t))];case 2:return(e=r.sent())?[4,this.storage.leadId.set(e)]:[3,5];case 3:return r.sent(),this.isProcessing=!1,[4,this.storage.token.get()];case 4:return r.sent()&&this.checkLeadIdUser(),[2,e];case 5:return[3,7];case 6:return r.sent(),[2,new Promise((function(e){setTimeout((function(){n.isProcessing=!1,e(n.createLeadId(t))}),n.leadTriggerTime)}))];case 7:return[2]}}))}))},LeadApi.prototype.getLeadId=function(){return lead_awaiter(this,void 0,void 0,(function(){var t;return lead_generator(this,(function(e){switch(e.label){case 0:return[4,this.storage.leadId.get()];case 1:return(t=e.sent())?[2,t]:[3,2];case 2:return[4,this.createLeadId()];case 3:return(t=e.sent())?[4,this.storage.leadId.set(t)]:[3,5];case 4:return e.sent(),[2,t];case 5:return[2,t||""]}}))}))},LeadApi.prototype.fetchLeadId=function(t){return lead_awaiter(this,void 0,void 0,(function(){var e,n,r;return lead_generator(this,(function(o){switch(o.label){case 0:return e={"Content-Type":"application/json"},n=this.endpoints.API_URL+(t?this.endpoints.LEAD_ID_INSTALL_ENDPOINT:this.endpoints.LEAD_ID_ENDPOINT),r={browser:getBrowserName(),distinct_id:Tn.getDistinctId(),extension_version:this.defaultParams.extension_version,alreadyInstalled:t?0:1},[4,fetch(n,{method:"POST",headers:e,body:JSON.stringify(r)})];case 1:return[4,o.sent().json()];case 2:return[2,o.sent().data.id]}}))}))},LeadApi.prototype.checkLeadIdUser=function(){return lead_awaiter(this,void 0,void 0,(function(){var t,e,n,r,o,a;return lead_generator(this,(function(u){switch(u.label){case 0:if(this.isFetching)return[2,!1];u.label=1;case 1:return u.trys.push([1,6,,7]),[4,Promise.all([this.storage.token.get(),this.storage.leadId.get(),this.storage.checkLeadIdTimeout.get()])];case 2:return t=u.sent(),e=t[0],n=t[1],r=t[2],e&&n?!r||r&&r<Date.now()?(this.isFetching=!0,[4,this.sendCheckLeadIdUser(e,n)]):[3,5]:[2,!1];case 3:return o=u.sent(),this.isFetching=!1,o?[4,this.storage.checkLeadIdTimeout.set(Date.now()+this.bindExpireIn)]:[3,5];case 4:return u.sent(),[2,!0];case 5:return[2,!1];case 6:return a=u.sent(),(0,i.Cv)("checkLeadIdUser error:",null==a?void 0:a.message),[2,!1];case 7:return[2]}}))}))},LeadApi.prototype.sendCheckLeadIdUser=function(t,e){return lead_awaiter(this,void 0,void 0,(function(){var n,r,o;return lead_generator(this,(function(a){switch(a.label){case 0:return n=this.endpoints.API_URL+this.endpoints.LEAD_ID_CHECK_ENDPOINT,r={"Content-Type":"application/json",token:t},o={token:t,lead_id:e,extension_version:this.defaultParams.extension_version},[4,fetch(n,{method:"POST",headers:r,body:JSON.stringify(o)})];case 1:return[4,a.sent().json()];case 2:return a.sent().error?((0,i.Ki)("sendCheckLeadIdUser failed",i.Bc.API,{token:t,leadId:e}),[2,!1]):[2,!0]}}))}))},LeadApi}(),Q={API_URL:f.T5,LEAD_ID_INSTALL_ENDPOINT:f.mM,LEAD_ID_ENDPOINT:f.TK,LEAD_ID_CHECK_ENDPOINT:f.Uj},X=new $(y,Q,b,f.NY,!1,f.EW),v2Storage_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},v2Storage_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},v2Storage_spreadArray=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},Z=["alreadyInstalled","current-user","default_api_coupons_response","lm_opened_timestamp","lumaly_api_coupons_last_error","lumaly_auth_tabs","lumaly_installation_id","lumaly_installed_evented","lumaly_installed_reason","lumaly_installed_time","lumaly_last_email","lumaly_rct_currency","lumaly_user_id","lumaly_user_referral_link","shops_cached_first_page","stateOfDomains","lumaly_application_stats","lumaly_last_saved_stat_value","lumaly_rct_affiliate_url","schedule_after_reload"],tt=["_lumaly_cart_total_","_lumaly_cart_total_","_lumaly_discounted_cart_total_","cached_domain_","lm_e_b_openingstab-"],onInstalled_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},onInstalled_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},updateUninstallUrl_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},updateUninstallUrl_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},updateUninstallUrl=function(t){var e=t.leadId,n=t.email;return updateUninstallUrl_awaiter(void 0,void 0,void 0,(function(){var t,r,o,i,a,u,s;return updateUninstallUrl_generator(this,(function(c){switch(c.label){case 0:return t=Tn.getDistinctId(),e?(o=e,[3,3]):[3,1];case 1:return[4,y.leadId.get()];case 2:o=c.sent(),c.label=3;case 3:return r=o,n?(a=n,[3,6]):[3,4];case 4:return[4,y.lastUser.get()];case 5:a=null===(s=c.sent())||void 0===s?void 0:s.email,c.label=6;case 6:return i=a,u="".concat(f.BD.uninstall,"/?browser=").concat(getBrowserName()).concat(i?"&email="+i:"").concat(r?"&lead_id="+r:"").concat(t?"&distinct_id="+t:""),compat.runtime.setUninstallURL(u),[2]}}))}))},initialize_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},initialize_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},et={},initialize=function(){onInstalled_awaiter(void 0,void 0,void 0,(function(){return onInstalled_generator(this,(function(t){return W.fetch(),compat.runtime.onInstalled.addListener((function(t){return onInstalled_awaiter(void 0,void 0,void 0,(function(){var e,n,r,o;return onInstalled_generator(this,(function(i){switch(i.label){case 0:return[4,y.leadId.get()];case 1:return e=i.sent(),n="install"===(null==t?void 0:t.reason),e?[3,3]:[4,X.createLeadId(n)];case 2:(e=i.sent())&&k.fetch(null,!1),i.label=3;case 3:return n?(z.versionChanged({type:v.INSTALLED}),[4,compat.tabs.create({url:"".concat(f.BD.install,"/?lead_id=").concat(e,"&browser=").concat(getBrowserName()),active:!0})]):[3,8];case 4:return(r=i.sent()).id?[4,getInvitedReferralToken(r.id)]:[3,7];case 5:return(o=i.sent())?[4,y.referralInvitedToken.set(o)]:[3,7];case 6:i.sent(),i.label=7;case 7:return updateContentScripts(),[3,10];case 8:return"update"!==t.reason?[3,10]:[4,v2Storage_awaiter(void 0,void 0,void 0,(function(){var t,e;return v2Storage_generator(this,(function(n){switch(n.label){case 0:return[4,compat.storage.getAll()];case 1:return t=n.sent(),e=Object.keys(t).filter((function(t){return tt.some((function(e){return t.startsWith(e)}))})),[4,compat.storage.unset(v2Storage_spreadArray(v2Storage_spreadArray([],Z,!0),e,!0))];case 2:return n.sent(),[2]}}))}))];case 9:i.sent(),z.versionChanged({type:v.UPDATED}),updateContentScripts(),i.label=10;case 10:return[4,updateUninstallUrl({leadId:e})];case 11:return i.sent(),[2]}}))}))})),[2]}))})),webRequestListener(),onTabChanged(),initialize_awaiter(void 0,void 0,void 0,(function(){var t,e;return initialize_generator(this,(function(n){switch(n.label){case 0:return[4,y.token.get()];case 1:return(t=n.sent())?[4,R.getUser(t)]:[3,4];case 2:return(e=n.sent()).user?[4,Tn.send({identify:e.user.login,userProperties:{email:e.user.login,name:e.user.name},superProperties:{"Extension Version":"3.0.1.5"}})]:[2];case 3:n.sent(),n.label=4;case 4:return[2]}}))})).catch((function(t){return(0,i.Ki)("initAnalyticUser failed",i.Bc.API,{error:t})}))},getCurrentShopUrl_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},getCurrentShopUrl_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},isEbay=function(t){var e=/ebay[.](de|com)/;try{var n=new URL(t).origin;return e.test(n)}catch(n){return e.test(t)}},isLumalyDomain=function(t){return!!t.match(f.aH)},isAmazonCartPage=function(t){return t.indexOf(".amazon.")>=0&&(t.indexOf("/gp/buy/payselect")>=0||t.indexOf("/gp/buy/spc")>=0)},nt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),rt=(function(t){function EmptyResponse(){return t.call(this,"ok")||this}nt(EmptyResponse,t)}(l),function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}()),ot=function(t){function FetchCoupons(){return null!==t&&t.apply(this,arguments)||this}return rt(FetchCoupons,t),FetchCoupons}(l),it=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),at=function(t){function RunHandlePageLoad(){return null!==t&&t.apply(this,arguments)||this}return it(RunHandlePageLoad,t),RunHandlePageLoad}(l),ut=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),st=function(t){function CouponsInfo(){return null!==t&&t.apply(this,arguments)||this}return ut(CouponsInfo,t),CouponsInfo}(l),ct=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),lt=function(t){function FetchShops(){return null!==t&&t.apply(this,arguments)||this}return ct(FetchShops,t),FetchShops}(l),ft=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),pt=function(t){function ShopsInfo(){return null!==t&&t.apply(this,arguments)||this}return ft(ShopsInfo,t),ShopsInfo}(l),dt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),ht=function(t){function SearchShops(){return null!==t&&t.apply(this,arguments)||this}return dt(SearchShops,t),SearchShops}(l),yt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),bt=function(t){function FetchTransactions(){return null!==t&&t.apply(this,arguments)||this}return yt(FetchTransactions,t),FetchTransactions}(l),vt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),wt=function(t){function TransactionsInfo(){return null!==t&&t.apply(this,arguments)||this}return vt(TransactionsInfo,t),TransactionsInfo}(l),_t=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),gt=function(t){function Affiliate(){return null!==t&&t.apply(this,arguments)||this}return _t(Affiliate,t),Affiliate}(l),mt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),St=function(t){function AffiliateInfo(){return null!==t&&t.apply(this,arguments)||this}return mt(AffiliateInfo,t),AffiliateInfo}(l),At=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Ot=function(t){function FetchSupportedDomains(){return null!==t&&t.apply(this,arguments)||this}return At(FetchSupportedDomains,t),FetchSupportedDomains}(l),xt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Tt=function(t){function SupportedDomainsInfo(){return null!==t&&t.apply(this,arguments)||this}return xt(SupportedDomainsInfo,t),SupportedDomainsInfo}(l),Pt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),kt=function(t){function SendAnalytics(){return null!==t&&t.apply(this,arguments)||this}return Pt(SendAnalytics,t),SendAnalytics}(l),Et=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Ct=function(t){function Login(){return null!==t&&t.apply(this,arguments)||this}return Et(Login,t),Login}(l),It=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),jt=function(t){function Register(){return null!==t&&t.apply(this,arguments)||this}return It(Register,t),Register}(l),Dt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Rt=function(t){function UserInfo(){return null!==t&&t.apply(this,arguments)||this}return Dt(UserInfo,t),UserInfo}(l),Lt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Ut=function(t){function GetUser(){return null!==t&&t.apply(this,arguments)||this}return Lt(GetUser,t),GetUser}(l),Nt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Bt=function(t){function UpdateUser(){return null!==t&&t.apply(this,arguments)||this}return Nt(UpdateUser,t),UpdateUser}(l),Gt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Ft=function(t){function GoogleAuth(){return null!==t&&t.apply(this,arguments)||this}return Gt(GoogleAuth,t),GoogleAuth}(l),Mt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Ht=function(t){function FacebookAuth(){return null!==t&&t.apply(this,arguments)||this}return Mt(FacebookAuth,t),FacebookAuth}(l),Kt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Wt=function(t){function AuthFormWindow(){return null!==t&&t.apply(this,arguments)||this}return Kt(AuthFormWindow,t),AuthFormWindow}(l),Yt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Vt=function(t){function Logout(){return null!==t&&t.apply(this,arguments)||this}return Yt(Logout,t),Logout}(l),qt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Jt=function(t){function PageLoaded(){return null!==t&&t.apply(this,arguments)||this}return qt(PageLoaded,t),PageLoaded}(l),zt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),$t=function(t){function TokenResponse(){return null!==t&&t.apply(this,arguments)||this}return zt(TokenResponse,t),TokenResponse}(l),Qt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Xt=function(t){function LogoutResponse(){return null!==t&&t.apply(this,arguments)||this}return Qt(LogoutResponse,t),LogoutResponse}(l),Zt=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),te=function(t){function DeleteAccount(){return null!==t&&t.apply(this,arguments)||this}return Zt(DeleteAccount,t),DeleteAccount}(l),ee=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),ne=function(t){function DeleteAccountResponse(){return null!==t&&t.apply(this,arguments)||this}return ee(DeleteAccountResponse,t),DeleteAccountResponse}(l),re=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),oe=function(t){function SendStatPopupOpened(){return null!==t&&t.apply(this,arguments)||this}return re(SendStatPopupOpened,t),SendStatPopupOpened}(l),ie=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),ae=function(t){function SendStatClosed(){return null!==t&&t.apply(this,arguments)||this}return ie(SendStatClosed,t),SendStatClosed}(l),ue=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),se=function(t){function SendStatApplied(){return null!==t&&t.apply(this,arguments)||this}return ue(SendStatApplied,t),SendStatApplied}(l),ce=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),le=function(t){function SendStatCashbackApplied(){return null!==t&&t.apply(this,arguments)||this}return ce(SendStatCashbackApplied,t),SendStatCashbackApplied}(l),fe=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),pe=function(t){function SendStatPurchaseTotal(){return null!==t&&t.apply(this,arguments)||this}return fe(SendStatPurchaseTotal,t),SendStatPurchaseTotal}(l),de=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),he=function(t){function SendStatSaved(){return null!==t&&t.apply(this,arguments)||this}return de(SendStatSaved,t),SendStatSaved}(l),ye=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),be=function(t){function SendStatVersionChanged(){return null!==t&&t.apply(this,arguments)||this}return ye(SendStatVersionChanged,t),SendStatVersionChanged}(l),ve=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),we=function(t){function SendStatVisited(){return null!==t&&t.apply(this,arguments)||this}return ve(SendStatVisited,t),SendStatVisited}(l),_e=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),ge=function(t){function SaveStatCartTotal(){return null!==t&&t.apply(this,arguments)||this}return _e(SaveStatCartTotal,t),SaveStatCartTotal}(l),me=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Se=function(t){function SendCouponStats(){return null!==t&&t.apply(this,arguments)||this}return me(SendCouponStats,t),SendCouponStats}(l),Ae=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Oe=function(t){function StatsResponse(){return null!==t&&t.apply(this,arguments)||this}return Ae(StatsResponse,t),StatsResponse}(l),xe=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Te=function(t){function SaveStatOrderId(){return null!==t&&t.apply(this,arguments)||this}return xe(SaveStatOrderId,t),SaveStatOrderId}(l),Pe=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),ke=function(t){function SaveStatCurrency(){return null!==t&&t.apply(this,arguments)||this}return Pe(SaveStatCurrency,t),SaveStatCurrency}(l),Ee=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Ce=function(t){function SendError(){return null!==t&&t.apply(this,arguments)||this}return Ee(SendError,t),SendError}(l),Ie=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),je=function(t){function RunShopInstructions(){return null!==t&&t.apply(this,arguments)||this}return Ie(RunShopInstructions,t),RunShopInstructions}(l),De=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Re=function(t){function GetReferrer(){return null!==t&&t.apply(this,arguments)||this}return De(GetReferrer,t),GetReferrer}(l),Le=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Ue=function(t){function SendReferrer(){return null!==t&&t.apply(this,arguments)||this}return Le(SendReferrer,t),SendReferrer}(l),Ne=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Be=function(t){function FetchCurrencyRates(){return null!==t&&t.apply(this,arguments)||this}return Ne(FetchCurrencyRates,t),FetchCurrencyRates}(l),Ge=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Fe=function(t){function CurrencyRates(){return null!==t&&t.apply(this,arguments)||this}return Ge(CurrencyRates,t),CurrencyRates}(l),Me=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),He=function(t){function SendCouponApplicationTime(){return null!==t&&t.apply(this,arguments)||this}return Me(SendCouponApplicationTime,t),SendCouponApplicationTime}(l),Ke=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),We=function(t){function CouponApplicationTimeInfo(){return null!==t&&t.apply(this,arguments)||this}return Ke(CouponApplicationTimeInfo,t),CouponApplicationTimeInfo}(l),Ye=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Ve=function(t){function SendIsAffiliateBlocked(){return null!==t&&t.apply(this,arguments)||this}return Ye(SendIsAffiliateBlocked,t),SendIsAffiliateBlocked}(l),qe=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Je=function(t){function IsAffiliateBlockedResponse(){return null!==t&&t.apply(this,arguments)||this}return qe(IsAffiliateBlockedResponse,t),IsAffiliateBlockedResponse}(l),ze=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),$e=function(t){function FetchCors(){return null!==t&&t.apply(this,arguments)||this}return ze(FetchCors,t),FetchCors}(l),Qe=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Xe=function(t){function FetchCorsResponse(){return null!==t&&t.apply(this,arguments)||this}return Qe(FetchCorsResponse,t),FetchCorsResponse}(l),Ze=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),tn=function(t){function FetchGiftCards(){return null!==t&&t.apply(this,arguments)||this}return Ze(FetchGiftCards,t),FetchGiftCards}(l),en=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),nn=function(t){function GiftCardsInfo(){return null!==t&&t.apply(this,arguments)||this}return en(GiftCardsInfo,t),GiftCardsInfo}(l),rn=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),on=function(t){function BuyGiftCard(){return null!==t&&t.apply(this,arguments)||this}return rn(BuyGiftCard,t),BuyGiftCard}(l),an=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),un=function(t){function BoughtGiftCardInfo(){return null!==t&&t.apply(this,arguments)||this}return an(BoughtGiftCardInfo,t),BoughtGiftCardInfo}(l),sn=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),cn=function(t){function EbayInfo(){return null!==t&&t.apply(this,arguments)||this}return sn(EbayInfo,t),EbayInfo}(l),ln=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),fn=function(t){function EbayCheck(){return null!==t&&t.apply(this,arguments)||this}return ln(EbayCheck,t),EbayCheck}(l),pn=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),dn=function(t){function TestConnection(){return null!==t&&t.apply(this,arguments)||this}return pn(TestConnection,t),TestConnection}(l),hn=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),yn=function(t){function TestConnectionResponse(){return null!==t&&t.apply(this,arguments)||this}return hn(TestConnectionResponse,t),TestConnectionResponse}(l),bn=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),vn=function(t){function IsTabActiveMessage(){return null!==t&&t.apply(this,arguments)||this}return bn(IsTabActiveMessage,t),IsTabActiveMessage}(l),wn=function(t){function IsTabActiveResponse(){return null!==t&&t.apply(this,arguments)||this}return bn(IsTabActiveResponse,t),IsTabActiveResponse}(l),_n=function(){var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},extendStatics(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),gn=function(t){function GetSessionMessage(){return null!==t&&t.apply(this,arguments)||this}return _n(GetSessionMessage,t),GetSessionMessage}(l),mn=function(t){function GetSessionResponse(){return null!==t&&t.apply(this,arguments)||this}return _n(GetSessionResponse,t),GetSessionResponse}(l),Sn=function(t){function SetSessionMessage(){return null!==t&&t.apply(this,arguments)||this}return _n(SetSessionMessage,t),SetSessionMessage}(l),An=function(t){function SetSessionResponse(){return null!==t&&t.apply(this,arguments)||this}return _n(SetSessionResponse,t),SetSessionResponse}(l),onTabChanged_assign=function(){return onTabChanged_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},onTabChanged_assign.apply(this,arguments)},onTabChanged_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},onTabChanged_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},onTabChanged=function(){function updateBadgeState(t,e){return onTabChanged_awaiter(this,void 0,void 0,(function(){var n,r,o,i,a,u,s,c;return onTabChanged_generator(this,(function(l){switch(l.label){case 0:return e?[4,k.fetch(e)]:(setBadgeState(t,0),[2]);case 1:return n=l.sent(),o=(r=n||{}).coupons,i=void 0===o?[]:o,a=r.shop,u=r.random,s=void 0===u||u?0:i.length,a&&(null==a?void 0:a.url)&&f.GZ.includes(a.url)?[2]:isEbay(e)?[4,setBadgeStateEbay(s)]:[3,3];case 2:return l.sent(),[3,7];case 3:return c=!1,(null==a?void 0:a.url)&&isBlockingAffiliateLink(a.affiliateNetwork)?[4,getBlockingAffiliateDomainData(t,a.url,a.affiliateNetwork)]:[3,5];case 4:l.sent().redirectBlocked&&(c=!0),l.label=5;case 5:return[4,setBadgeState(t,c?0:s)];case 6:l.sent(),l.label=7;case 7:return[2]}}))}))}compat.tabs.onActivated.addListener((function(t){return onTabChanged_awaiter(void 0,void 0,void 0,(function(){var e,n,r,o,i;return onTabChanged_generator(this,(function(a){switch(a.label){case 0:return[4,(u=t.tabId,getCurrentShopUrl_awaiter(void 0,void 0,void 0,(function(){var t;return getCurrentShopUrl_generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),u?[4,compat.tabs.get(u).then((function(t){return t.url}))]:[3,2];case 1:return t=e.sent(),[3,4];case 2:return[4,compat.tabs.active().then((function(t){return null==t?void 0:t.url}))];case 3:t=e.sent(),e.label=4;case 4:return[2,urlToDomain(t||"")||null];case 5:return e.sent(),[2,null];case 6:return[2]}}))})))];case 1:if(e=a.sent(),updateBadgeState(t.tabId,e),!e)return[2];for(o in isLumalyDomain(e)&&(smartAuth(t.tabId),redirectUser(t.tabId)),n=isAmazonCartPage(e),r=null,h.ports)if(Object.prototype.hasOwnProperty.call(h.ports,o)&&(i=h.ports[o]).tabId===t.tabId&&i.windowId===t.windowId&&i.name.includes("content")){r=i;break}return r?[4,h.send(r,new je({url:e,isAmazon:n}))]:[3,3];case 2:a.sent(),a.label=3;case 3:return[2]}var u}))}))})),compat.tabs.onUpdated.addListener((function(t,e,n){return onTabChanged_awaiter(void 0,void 0,void 0,(function(){var r,o,i,a;return onTabChanged_generator(this,(function(u){switch(u.label){case 0:return n.url?(r="complete"===e.status,et[t]&&r&&onRedirectingCompleted(t,n.url),(o=urlToDomain(n.url||""))?((i=isLumalyDomain(o))&&e.url&&redirectUser(t,e.url),r&&(updateBadgeState(t,o),i&&smartAuth(t,n.url)),[4,W.fetch()]):[2]):[2];case 1:return a=u.sent(),Boolean(o in a)&&(y.lastShopDomain.set(o),r&&function(t,e,n){var r;onTabChanged_awaiter(this,void 0,void 0,(function(){var o,i,a,u;return onTabChanged_generator(this,(function(s){switch(s.label){case 0:return[4,Promise.all([y.mixpanelTabEvents(e,n.windowId).get(),y.affiliateTabIds.get()])];case 1:return o=s.sent(),i=o[0],(void 0===(a=o[1])?{}:a)[e]||!n.url||(null==i?void 0:i.visitedShop)&&(null==i?void 0:i.shopDomain)===t||"/"!==new URL(n.url).pathname?[2]:[4,y.shopData(t).get()];case 2:return u=s.sent(),Tn.send({eventName:"Visit Shop - Landing Page",eventProperties:{"Shop Name":t,"Shop Id":(null===(r=null==u?void 0:u.data.shop)||void 0===r?void 0:r.id)||""}}),[4,y.mixpanelTabEvents(e,n.windowId).set(onTabChanged_assign(onTabChanged_assign({},i||{}),{shopDomain:t,visitedShop:!0}))];case 3:return s.sent(),[2]}}))}))}(o,t,n)),[2]}}))}))})),compat.tabs.onRemoved.addListener((function(t,e){return onTabChanged_awaiter(void 0,void 0,void 0,(function(){return onTabChanged_generator(this,(function(n){switch(n.label){case 0:return[4,y.session(t).unset()];case 1:return n.sent(),[4,y.mixpanelTabEvents(t,e.windowId).unset()];case 2:return n.sent(),[2]}}))}))}))},mixpanel_assign=function(){return mixpanel_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},mixpanel_assign.apply(this,arguments)},mixpanel_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},mixpanel_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},On=new(function(){function MixpanelApi(t,e,n,r,o){void 0===r&&(r=""),void 0===o&&(o={}),this.token=t,this.apiHost=e,this.defaultParams=n,this.distinctId=r,this.superProperties=o,this.distinctId=esm_browser_v4(),this.superProperties={}}return MixpanelApi.prototype.identify=function(t){return mixpanel_awaiter(this,void 0,void 0,(function(){return mixpanel_generator(this,(function(e){return this.distinctId=t,this.send({endpoint:"track#create-identity",eventName:"identify",options:{identify:t}}),[2]}))}))},MixpanelApi.prototype.alias=function(t){return mixpanel_awaiter(this,void 0,void 0,(function(){return mixpanel_generator(this,(function(e){return this.send({endpoint:"track#identity-create-alias",eventName:"alias",options:{alias:t}}),[2]}))}))},MixpanelApi.prototype.track=function(t,e){return mixpanel_awaiter(this,void 0,void 0,(function(){return mixpanel_generator(this,(function(n){return this.send({endpoint:"track",eventName:t,options:e||{}}),[2]}))}))},MixpanelApi.prototype.union=function(t,e){return mixpanel_awaiter(this,void 0,void 0,(function(){var n,r;return mixpanel_generator(this,(function(o){return n=this.formatAnalyticsData("engage#profile-union",{$union:(r={},r[t]=[e],r)}),this.send(n),[2]}))}))},MixpanelApi.prototype.track_charge=function(t){return mixpanel_awaiter(this,void 0,void 0,(function(){var e,n;return mixpanel_generator(this,(function(r){return e=this.formatAnalyticsData("engage#profile-numerical-add",{$add:(n={},n.Transactions=t,n)}),this.send(e),[2]}))}))},MixpanelApi.prototype.increment=function(t,e){return mixpanel_awaiter(this,void 0,void 0,(function(){var n,r;return mixpanel_generator(this,(function(o){return n=this.formatAnalyticsData("engage#profile-numerical-add",{$add:(r={},r[t]=e,r)}),this.send(n),[2]}))}))},MixpanelApi.prototype.setUserProperties=function(t){return mixpanel_awaiter(this,void 0,void 0,(function(){var e;return mixpanel_generator(this,(function(n){return e=this.formatAnalyticsData("engage#profile-set",{$set:t}),this.send(e),[2]}))}))},MixpanelApi.prototype.register=function(t){return mixpanel_awaiter(this,void 0,void 0,(function(){return mixpanel_generator(this,(function(e){return this.superProperties=t,[2]}))}))},MixpanelApi.prototype.getDistinctId=function(){return this.distinctId},MixpanelApi.prototype.formatAnalyticsData=function(t,e){var n=mixpanel_assign(mixpanel_assign({$distinct_id:this.distinctId,$token:this.token},e),this.superProperties);return{endpoint:t,options:JSON.stringify(n),alreadyFormatted:!0}},MixpanelApi.prototype.send=function(t){var e=t.endpoint,n=t.eventName,r=t.options,o=t.alreadyFormatted;return mixpanel_awaiter(this,void 0,void 0,(function(){var t,a,u,s,c;return mixpanel_generator(this,(function(l){switch(l.label){case 0:if("dev"===this.defaultParams.environment)return(0,i.Cv)("Enable environment prod, mixpanel event %c".concat(n||e),"color: purple;","wasn't sent"),[2];t=this.apiHost+e,a="",u={method:"POST",headers:{Accept:"text/plain","Content-Type":"application/x-www-form-urlencoded"}},o?a=r:(s={event:n||"",properties:mixpanel_assign(mixpanel_assign(mixpanel_assign({},r),this.superProperties),{distinct_id:this.distinctId,token:this.token})},a=JSON.stringify(s)),u.body=new URLSearchParams({data:a}),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,fetch(t,u)];case 2:return l.sent(),[3,4];case 3:return c=l.sent(),(0,i.Cv)("mixpanel error: ",null==c?void 0:c.message),[3,4];case 4:return[2]}}))}))},MixpanelApi}())(f.Ux,f.vr,b),analytics_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},analytics_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},xn=function(){function AnalyticsApi(t,e,n,r){this.defaultParams=t,this.storage=e,this.analytics=n,this.logged=r}return AnalyticsApi.prototype.getDistinctId=function(){return this.analytics.getDistinctId()},AnalyticsApi.prototype.send=function(t){return analytics_awaiter(this,void 0,void 0,(function(){return analytics_generator(this,(function(t){return[2]}))}))},AnalyticsApi.prototype.sendAlias=function(t){},AnalyticsApi.prototype.sendIdentify=function(t){},AnalyticsApi.prototype.sendSuperProperties=function(t){},AnalyticsApi.prototype.sendVisitedShop=function(t){},AnalyticsApi.prototype.sendResetEvent=function(){},AnalyticsApi.prototype.sendRevenue=function(t){},AnalyticsApi.prototype.sendEvent=function(t,e){return analytics_awaiter(this,void 0,void 0,(function(){return analytics_generator(this,(function(t){return[2]}))}))},AnalyticsApi.prototype.sendUserProperties=function(t){},AnalyticsApi.prototype.log=function(t,e){},AnalyticsApi}(),Tn=new xn(b,y,On,!1),error_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},error_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Pn=function(){function ErrorApi(t,e,n,r){void 0===r&&(r={}),this.storage=t,this.apiUrl=e,this.errorCacheTime=n,this.defaultParams=r}return ErrorApi.prototype.send=function(t){return error_awaiter(this,void 0,void 0,(function(){var e,n,r;return error_generator(this,(function(o){switch(o.label){case 0:return[4,this.canSendError(t.shopDomain,t.message)];case 1:return e=o.sent(),n=e.canSend,(r=e.data)?[4,this.saveErrorList(r)]:[3,3];case 2:o.sent(),o.label=3;case 3:return n?[4,this.sendError(t)]:[3,5];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))},ErrorApi.prototype.canSendError=function(t,e){return error_awaiter(this,void 0,void 0,(function(){var n,r,o,a,u,s,c;return error_generator(this,(function(l){switch(l.label){case 0:return[4,this.storage.shopData(t).get()];case 1:if(!(n=l.sent()))return(0,i.Ki)("canSendError: no shop data?",i.Bc.SHOP_EXCEPTION,{shopDomain:t,message:e}),[2,{canSend:!1}];if(r=Date.now(),o=[],n.lastErrors&&n.lastErrors.length){for(a=void 0,u=0,s=n.lastErrors;u<s.length;u++)(c=s[u]).expired>r&&(o.push(c),e===c.message&&(a=!0));return a?[2,{canSend:!1,data:{shopDomain:t,shopData:n,errorList:o}}]:[2,{canSend:!0,data:{shopDomain:t,shopData:n,errorList:o,newError:e}}]}return[2,{canSend:!0,data:{shopDomain:t,shopData:n,errorList:o,newError:e}}]}}))}))},ErrorApi.prototype.saveErrorList=function(t){var e=t.shopDomain,n=t.shopData,r=t.errorList,o=t.newError;return error_awaiter(this,void 0,void 0,(function(){var t;return error_generator(this,(function(i){switch(i.label){case 0:return o&&(t={expired:Date.now()+this.errorCacheTime,message:o},r.push(t)),n.lastErrors=r,[4,this.storage.shopData(e).set(n)];case 1:return i.sent(),[2]}}))}))},ErrorApi.prototype.sendError=function(t){return error_awaiter(this,void 0,void 0,(function(){var e,n,r;return error_generator(this,(function(o){switch(o.label){case 0:return e=t.code.split("-"),r={shop_url:t.shopDomain},[4,this.storage.leadId.get()];case 1:return r.lead_id=o.sent()||"",r.browser=getBrowserName(),r.extension_version=this.defaultParams.extension_version,r.execution_stage=e[0],r.stage_step=e[1],r.step_caller=e[2],r.error_code=e[3],r.message=t.message,r.environment=this.defaultParams.environment,n=r,(0,i.Ki)("broken shops",i.Bc.SHOP_EXCEPTION,t.shopDomain),fetch(this.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),[2]}}))}))},ErrorApi}(),kn=new Pn(y,f.T5+f.y7,f.H0,b),ebay_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},ebay_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},blockEbayPage=function(t,e){return ebay_awaiter(void 0,void 0,void 0,(function(){return ebay_generator(this,(function(n){switch(n.label){case 0:return[4,y.ebay(t,e).set({restricted:!0})];case 1:return n.sent(),[4,setBadgeStateEbay(0)];case 2:return n.sent(),[2]}}))}))},ebayDisableCalculationBlock=function(t,e){return ebay_awaiter(void 0,void 0,void 0,(function(){var n;return ebay_generator(this,(function(r){switch(r.label){case 0:return[4,setBadgeStateEbay(0)];case 1:return r.sent(),[4,y.ebay(t,e).get()];case 2:return(n=r.sent()||{}).calculationDisabled=!0,[4,y.ebay(t,e).set(n)];case 3:return r.sent(),[2,!0]}}))}))},ebayCheckCanBeOpened=function(t,e,n){return ebay_awaiter(void 0,void 0,void 0,(function(){var r,o,a;return ebay_generator(this,(function(u){switch(u.label){case 0:return[4,y.ebay(t,e).get()];case 1:return(r=u.sent())&&r.restricted?[4,ebayDisableCalculationBlock(t,e)]:[3,3];case 2:return u.sent(),[2,!1];case 3:return!!(r&&r.expireBy&&r.expireBy>Date.now())?[3,5]:[4,y.ebay(t,e).set({count:0,expireBy:Date.now()+f.s4,openedFromInactivity:!0})];case 4:return u.sent(),(0,i.Ki)("".concat(f.m2.CHECK_EBAY_CAN_NE_OPENED,": "),i.Bc.EBAY,!0),[2,!0];case 5:return o=!(r&&r.count&&r.count>=f.fy),(0,i.Ki)("[tab ".concat(t,"] ebay calculation count: ").concat(null==r?void 0:r.count,"/").concat(f.fy),i.Bc.EBAY),o&&n?(a=urlToDomain(n))?[3,6]:(o=!1,[3,9]):[3,9];case 6:return u.trys.push([6,8,,9]),[4,y.supportedDomains.get().then((function(t){return ebay_awaiter(void 0,void 0,void 0,(function(){return ebay_generator(this,(function(e){return t&&t.data[a]||(o=!1),[2]}))}))}))];case 7:return u.sent(),[3,9];case 8:return u.sent(),o=!1,[3,9];case 9:return(0,i.Ki)("".concat(f.m2.CHECK_EBAY_CAN_NE_OPENED,": "),i.Bc.EBAY,o),o?[3,11]:[4,ebayDisableCalculationBlock(t,e)];case 10:u.sent(),u.label=11;case 11:return[2,o]}}))}))},currencyRates_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},currencyRates_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},En=function(){function CurrencyRatesApi(t,e,n){void 0===e&&(e={}),void 0===n&&(n={}),this.storage=t,this.endpoints=e,this.defaultParams=n,this.isFetching=!1}return CurrencyRatesApi.prototype.fetchCurrencyRates=function(t){var e=t.currencyFrom,n=t.currencyTo;return currencyRates_awaiter(this,void 0,void 0,(function(){var t,r,o,i,a,u,s,c,l,f,p;return currencyRates_generator(this,(function(d){switch(d.label){case 0:return this.isFetching?[2,{error:null,data:null}]:(this.isFetching=!0,t="".concat(this.endpoints.API_URL).concat(this.endpoints.CURRENCY_RATES,"/").concat(e,"/").concat(n),l={},f={"Content-Type":"application/json"},[4,this.storage.token.get()]);case 1:return l.headers=(f.token=d.sent()||"",f),[4,fetch(t,l)];case 2:return[4,d.sent().json()];case 3:return r=d.sent(),o=r.error,i=r.data,this.isFetching=!1,o?[2,{error:o,data:null}]:i?(a="".concat(e,"_to_").concat(n),u="".concat(n,"_to_").concat(e),s=+i[a],c=+i[u],s>0?[2,{data:(p={},p[a.toLocaleUpperCase()]=s,p[u.toLocaleUpperCase()]=c,p),error:null}]:[2,{error:o.message||"wrong format",data:null}]):[2,{error:o.message||"wrong format",data:null}]}}))}))},CurrencyRatesApi}(),Cn={API_URL:f.T5,CURRENCY_RATES:f.W_},In=new En(y,Cn,b),getInvitedReferralToken_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},getInvitedReferralToken_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},getInvitedReferralToken=function(t){return getInvitedReferralToken_awaiter(void 0,void 0,void 0,(function(){var e,n,r,o,i;return getInvitedReferralToken_generator(this,(function(a){switch(a.label){case 0:if(!t)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,compat.scripting.executeScript({target:{tabId:t},file:f.hQ})];case 2:if(e=a.sent())for(n=0,r=e;n<r.length;n++)if(o=r[n],(i=o.result||o)&&i.refCookie)return[2,i.refCookie];return[2,null];case 3:return a.sent(),[2,null];case 4:return[2,null]}}))}))},referral_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},referral_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},jn=function(){function ReferralApi(t,e){void 0===e&&(e={}),this.storage=t,this.endpoints=e}return ReferralApi.prototype.sendUserSyncReferral=function(t){return referral_awaiter(this,void 0,void 0,(function(){var e,n,r,o;return referral_generator(this,(function(i){switch(i.label){case 0:return e=this.endpoints.API_URL+this.endpoints.USER_SYNC_REFERRAL,o={"Content-Type":"application/json"},[4,this.storage.token.get()];case 1:return o.token=i.sent()||"",n={ref_token:t},[4,fetch(e,{method:"POST",headers:o,body:JSON.stringify(n)})];case 2:return[4,i.sent().json()];case 3:return(r=i.sent().error)?[2,{success:!1,error:r.message}]:[2,{success:!0,error:null}]}}))}))},ReferralApi}(),Dn={API_URL:f.T5,USER_SYNC_REFERRAL:f.Lz},Rn=new jn(y,Dn),couponApplicationStats_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},couponApplicationStats_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Ln=function(){function CouponApplicationStatsApi(t,e,n){void 0===e&&(e={}),void 0===n&&(n={}),this.storage=t,this.endpoints=e,this.defaultParams=n}return CouponApplicationStatsApi.prototype.sendCouponTime=function(t){return couponApplicationStats_awaiter(this,void 0,void 0,(function(){var e;return couponApplicationStats_generator(this,(function(n){return e=this.endpoints.API_URL+this.endpoints.BASE+this.endpoints.COUPON_APPLICATION_TIME,[2,this.send(e,t)]}))}))},CouponApplicationStatsApi.prototype.sendCouponStats=function(t){return couponApplicationStats_awaiter(this,void 0,void 0,(function(){var e;return couponApplicationStats_generator(this,(function(n){return e=this.endpoints.API_URL+this.endpoints.BASE+this.endpoints.COUPON_APPLICATION_STATS,[2,this.send(e,t)]}))}))},CouponApplicationStatsApi.prototype.send=function(t,e){return couponApplicationStats_awaiter(this,void 0,void 0,(function(){var n,r,o;return couponApplicationStats_generator(this,(function(a){switch(a.label){case 0:return"dev"===this.defaultParams.environment?((0,i.Cv)("Enable environment prod. Stat ".concat(t," was not sent.")),[2,null]):(n={"Content-Type":"application/json",Accept:"application/json"},[4,this.storage.leadId.get()]);case 1:return r=a.sent()||"",[4,fetch(t,{method:"POST",headers:n,body:JSON.stringify({data:e,lead_id:r})})];case 2:return[4,a.sent().json()];case 3:return(o=a.sent().error)?[2,{success:!1,error:o.message}]:[2,{success:!0,error:""}]}}))}))},CouponApplicationStatsApi}(),couponApplicationApi_assign=function(){return couponApplicationApi_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},couponApplicationApi_assign.apply(this,arguments)},Un=couponApplicationApi_assign({API_URL:f.T5},f.dd),Nn=new Ln(y,Un,b),blockingAffiliate_assign=function(){return blockingAffiliate_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},blockingAffiliate_assign.apply(this,arguments)},blockingAffiliate_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},blockingAffiliate_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}};function blockingAffiliateGetTabData(t,e){return blockingAffiliate_awaiter(this,void 0,void 0,(function(){return blockingAffiliate_generator(this,(function(n){switch(n.label){case 0:return[4,y[e](t).get()];case 1:return[2,n.sent()||{}]}}))}))}function getBlockingAffiliateDomainData(t,e,n){return blockingAffiliate_awaiter(this,void 0,void 0,(function(){var r;return blockingAffiliate_generator(this,(function(o){switch(o.label){case 0:return(r=urlToDomain(e,!0))?[4,blockingAffiliateGetTabData(t,n)]:[2,{}];case 1:return[2,o.sent()[r]||{}]}}))}))}function isTabAlive(t){return blockingAffiliate_awaiter(this,void 0,void 0,(function(){return blockingAffiliate_generator(this,(function(e){switch(e.label){case 0:return[4,compat.tabs.get(t)];case 1:return[2,!!e.sent()]}}))}))}function blockingAffiliateRemoveTabData(t,e){return blockingAffiliate_awaiter(this,void 0,void 0,(function(){return blockingAffiliate_generator(this,(function(n){switch(n.label){case 0:return[4,y[e](t).unset()];case 1:return[2,n.sent()]}}))}))}function blockingAffiliateMergeTabData(t,e,n){return blockingAffiliate_awaiter(this,void 0,void 0,(function(){var r;return blockingAffiliate_generator(this,(function(o){switch(o.label){case 0:return[4,blockingAffiliateGetTabData(t,n)];case 1:return r=o.sent(),[4,y[n](t).set(blockingAffiliate_assign(blockingAffiliate_assign({},r),e))];case 2:return o.sent(),[4,isTabAlive(t)];case 3:return o.sent()?[3,5]:((0,i.Ki)("".concat(n,"-MergeTabData: tab not alive; remove it"),i.Bc.AFFILIATE),[4,blockingAffiliateRemoveTabData(t,n)]);case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}var blockingAffiliateMergeDomainData=function(t,e,n,r){return blockingAffiliate_awaiter(void 0,void 0,void 0,(function(){var o,i,a;return blockingAffiliate_generator(this,(function(u){switch(u.label){case 0:return(o=urlToDomain(e,!0))?[4,getBlockingAffiliateDomainData(t,e,r)]:[2];case 1:return i=u.sent(),[2,blockingAffiliateMergeTabData(t,(a={},a[o]=blockingAffiliate_assign(blockingAffiliate_assign({},i),n),a),r)]}}))}))},blockingAffiliateBlockDomain=function(t,e,n){return blockingAffiliate_awaiter(void 0,void 0,void 0,(function(){var r,o;return blockingAffiliate_generator(this,(function(a){switch(a.label){case 0:return r=urlToDomain(e,!0),[4,getBlockingAffiliateDomainData(t,e,n)];case 1:return(o=a.sent()).redirectAllowed?((0,i.Ki)("".concat(n," redirect is allowed for this tab #").concat(t," (").concat(r,")"),i.Bc.AFFILIATE),[3,4]):[3,2];case 2:return o.redirectBlocked=!0,[4,blockingAffiliateMergeDomainData(t,e,o,n)];case 3:a.sent(),(0,i.Ki)("".concat(n," domain will  BLOCK  ").concat(r," at tab #").concat(t),i.Bc.AFFILIATE),a.label=4;case 4:return[2]}}))}))},isAffiliateDomainBlocked=function(t,e,n){return blockingAffiliate_awaiter(void 0,void 0,void 0,(function(){var r;return blockingAffiliate_generator(this,(function(o){switch(o.label){case 0:return[4,getBlockingAffiliateDomainData(t,e,n)];case 1:return o.sent().redirectBlocked?[2,!0]:(e=e.toLowerCase(),r=!1,n===x.CJ&&(e.includes("afsrc=1")||e.includes("cjevent="))&&(r=!0),[2,r])}}))}))},webRequestListener=function(){compat.webRequest.supported?(compat.webRequest.onHeadersReceived.addListener((function(t){var e=t.tabId;et[e]||(et[e]=[]),et[e].push(t.url),isEbay(t.url)&&function(t){ebay_awaiter(void 0,void 0,void 0,(function(){var e,n;return ebay_generator(this,(function(r){switch(r.label){case 0:if(!(t.url.includes("mkevt=")||t.url.includes("mkcid=")||t.url.includes("campid="))||t.url.includes("campid=5338791069"))return[3,6];r.label=1;case 1:return r.trys.push([1,5,,6]),[4,compat.tabs.get(t.tabId)];case 2:return(e=r.sent()).id&&e.windowId?((0,i.Ki)("onEbayHeadersReceived -> blockEbayPage - Case 3 ",i.Bc.EBAY),[4,blockEbayPage(e.id,e.windowId)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[3,6];case 5:return n=r.sent(),(0,i.Ki)("onEbayHeadersReceived: failed",i.Bc.EBAY,{error:n}),[3,6];case 6:return[2]}}))}))}(t)}),{types:["main_frame"],urls:["<all_urls>"]}),compat.webRequest.onCompleted.addListener((function(t){onRedirectingCompleted(t.tabId,t.url)}),{types:["main_frame"],urls:["<all_urls>"]})):(0,i.Ki)("webRequest is not supported in this build",i.Bc.BUILD)},autoapplyAdapter_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},autoapplyAdapter_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Bn=new(function(){function AutoapplyAdapterApi(){}return AutoapplyAdapterApi.prototype.fetchCors=function(t,e){return autoapplyAdapter_awaiter(this,void 0,void 0,(function(){var n;return autoapplyAdapter_generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,fetch(t,e)];case 1:return[4,r.sent().text()];case 2:return[2,null!=(n=r.sent())?n:null];case 3:return r.sent(),[2,null];case 4:return[2]}}))}))},AutoapplyAdapterApi}()),convertApiBuyCardToModel=function(t,e){return{code:e,confirmedEur:+t.balance,transactionValue:+t.transaction.value}},giftCards_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},giftCards_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Gn=function(){function GiftCardsApi(t,e,n){void 0===e&&(e={}),void 0===n&&(n={}),this.storage=t,this.defaultParams=e,this.endpoints=n}return GiftCardsApi.prototype.fetch=function(){return giftCards_awaiter(this,void 0,void 0,(function(){var t,e,n,r,o,i,a,u,s,c,l,f;return giftCards_generator(this,(function(p){switch(p.label){case 0:return t=this.endpoints.API_URL+this.endpoints.GIFT_CARDS_ENDPOINT,[4,Promise.all([this.storage.token.get(),this.storage.leadId.get()])];case 1:e=p.sent(),n=e[0],r=void 0===n?"":n,o=e[1],i={headers:{token:r}},a={"lead-id":void 0===o?"":o,"extension-version":this.defaultParams.extension_version},u="".concat(t,"?")+new URLSearchParams(a).toString(),p.label=2;case 2:return p.trys.push([2,5,,6]),[4,fetch(u,i)];case 3:return[4,p.sent().json()];case 4:return s=p.sent(),c=s.error,l=s.data,f=s.meta,c?[2,{cards:[],pagination:null,error:c}]:[2,{cards:(d=l,d.map((function(t){return{backgroundImg:t.background_img,id:t.id,sortNumber:t.sort_number,title:t.title,values:t.values}}))),pagination:convertApiPaginationToModel({current_page:f.current_page,last_page:f.last_page}),error:null}];case 5:return[2,{cards:[],pagination:null,error:p.sent()}];case 6:return[2]}var d}))}))},GiftCardsApi.prototype.buy=function(t){var e=t.id,n=t.value;return giftCards_awaiter(this,void 0,void 0,(function(){var t,r,o,i,a,u,s,c;return giftCards_generator(this,(function(l){switch(l.label){case 0:return s={"Content-Type":"application/json"},[4,this.storage.token.get()];case 1:return s.token=l.sent()||"",t=s,c={gift_card_id:e,value:n},[4,this.storage.leadId.get()];case 2:c.lead_id=l.sent()||"",c.extension_version=this.defaultParams.extension_version,r=c,l.label=3;case 3:return l.trys.push([3,6,,7]),[4,fetch(this.endpoints.API_URL+this.endpoints.BUY_GIFT_CARD_ENDPOINT,{method:"POST",headers:t,body:JSON.stringify(r)})];case 4:return[4,l.sent().json()];case 5:return o=l.sent(),i=o.errors,a=o.data,u=o.code,i?[2,{data:null,error:{message:i.message}}]:[2,{data:convertApiBuyCardToModel(a,u),error:null}];case 6:return[2,{data:null,error:l.sent()}];case 7:return[2]}}))}))},GiftCardsApi}(),Fn={API_URL:f.T5,GIFT_CARDS_ENDPOINT:f.sV,BUY_GIFT_CARD_ENDPOINT:f.Eg},Mn=new Gn(y,b,Fn),updateContentScripts_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},updateContentScripts_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},updateTabWithContentScripts=function(t,e){return updateContentScripts_awaiter(void 0,void 0,void 0,(function(){return updateContentScripts_generator(this,(function(n){try{e.forEach((function(e){return updateContentScripts_awaiter(void 0,void 0,void 0,(function(){return updateContentScripts_generator(this,(function(n){switch(n.label){case 0:return[4,compat.scripting.executeScript({target:{tabId:t},file:e})];case 1:return n.sent(),[2]}}))}))}))}catch(t){(0,i.Cv)("updateContent executeScript error: ",null==t?void 0:t.message)}return[2]}))}))},updateContentScripts=function(t){return updateContentScripts_awaiter(void 0,void 0,void 0,(function(){var e,n,r,o,a,u,s,c,l,f,p,d,h;return updateContentScripts_generator(this,(function(y){switch(y.label){case 0:e=!1,y.label=1;case 1:return y.trys.push([1,13,,14]),[4,Promise.all([W.fetch(),compat.tabs.query({})])];case 2:n=y.sent(),r=n[0],o=n[1],a=0,u=compat.runtime.getManifest().content_scripts,y.label=3;case 3:return a<u.length?(s=u[a]).js?o&&(null==t?void 0:t.tabId)&&o.find((function(e){return e.id===t.tabId}))?(e=!0,[4,updateTabWithContentScripts(t.tabId,s.js)]):[3,5]:[2,!1]:[3,12];case 4:return y.sent(),[3,11];case 5:if(t)return[3,11];c=0,l=o,y.label=6;case 6:return c<l.length?(f=l[c],p=f.url,f.url||!f.id?[3,8]:[4,compat.tabs.get(f.id).then((function(t){return t.url}))]):[3,11];case 7:p=y.sent()||"",y.label=8;case 8:return d=p?urlToDomain(p):null,d&&d in r&&f.id?(e=!0,[4,updateTabWithContentScripts(f.id,s.js)]):[3,10];case 9:y.sent(),y.label=10;case 10:return c++,[3,6];case 11:return a++,[3,3];case 12:return[2,e];case 13:return h=y.sent(),(0,i.Cv)("updateContent error: ",null==h?void 0:h.message),[2,e];case 14:return[2]}}))}))},smartAuth_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},smartAuth_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}};function executeScriptSmartAuth(t,e){return smartAuth_awaiter(this,void 0,void 0,(function(){var n;return smartAuth_generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),[3,2];case 1:return r.sent(),[3,4];case 2:return[4,compat.scripting.executeScript({target:{tabId:t},code:"\n                (function(){\n                    const storedSmartAuth = localStorage.getItem('".concat(f.lc,"');\n                    const smartAuthData =\n                        typeof storedSmartAuth === \"string\"\n                            ? JSON.parse(storedSmartAuth)\n                            : storedSmartAuth ?? { leadId: [] };\n                    if (smartAuthData.leadId.includes('").concat(e,"')) return;\n                     \n                    smartAuthData.leadId.push('").concat(e,"');\n                    localStorage.setItem(\n                        '").concat(f.lc,"',\n                        JSON.stringify(smartAuthData),\n                    );\n                }()); ")})];case 3:r.sent(),r.label=4;case 4:return[3,6];case 5:return n=r.sent(),(0,i.Cv)("executeScriptSmartAuth error:",n.message),[3,6];case 6:return[2]}}))}))}var Hn,Kn,Wn,Yn,smartAuth=function(t,e){return smartAuth_awaiter(void 0,void 0,void 0,(function(){var n,r,o,i;return smartAuth_generator(this,(function(a){switch(a.label){case 0:if(!t)return[2];a.label=1;case 1:return a.trys.push([1,7,,8]),(r=e)?[3,3]:[4,compat.tabs.get(t).then((function(t){return t.url}))];case 2:r=a.sent(),a.label=3;case 3:return n=r,[4,y.leadId.get()];case 4:return o=a.sent(),(i=urlToDomain(n||""))&&isLumalyDomain(i)&&o?[4,executeScriptSmartAuth(t,o)]:[3,6];case 5:a.sent(),a.label=6;case 6:return[3,8];case 7:return a.sent(),[3,8];case 8:return[2]}}))}))},redirectUser_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},redirectUser_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},redirectUser=function(t,e){return redirectUser_awaiter(void 0,void 0,void 0,(function(){var n,r,o,i,a;return redirectUser_generator(this,(function(u){switch(u.label){case 0:return u.trys.push([0,6,,7]),null==e?[3,1]:(r=e,[3,3]);case 1:return[4,compat.tabs.get(t).then((function(t){return t.url}))];case 2:r=u.sent(),u.label=3;case 3:return(n=r)?(o=new URL(n),i=o.hostname,a=o.pathname,isLumalyDomain(i)&&"/"===a?[4,compat.tabs.update(t,{url:f.BD.smartDiscover})]:[3,5]):[2];case 4:u.sent(),u.label=5;case 5:return[3,7];case 6:return u.sent(),[3,7];case 7:return[2]}}))}))},onRedirectingCompleted_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},onRedirectingCompleted_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},onRedirectingCompleted=function(t,e){return onRedirectingCompleted_awaiter(void 0,void 0,void 0,(function(){var n,r,o,a,u,s,c;return onRedirectingCompleted_generator(this,(function(l){switch(l.label){case 0:return n=Array.isArray(et[t])?et[t]:[],delete et[t],[4,W.fetch()];case 1:return r=l.sent(),o=urlToDomain(e)||"",a=Boolean(o in r),[4,y.session(t).get()];case 2:return!(u=l.sent())||u[o]?[3,4]:[4,y.session(t).unset()];case 3:l.sent(),l.label=4;case 4:return a&&n.length&&(0,i.Ki)("ON COMPLETED",i.Bc.REDIRECT,{redirects:n}),a?(s=!1,c=!1,n.some((function(t){return function(t){var e=t=String(t||"");return f.eh.some((function(t){return e.includes(t)}))}(t)?(s=!0,!0):function(t){return(t=String(t||"")).includes(f.T0.url)}(t)?(c=!0,!0):void 0})),s||c?[4,blockingAffiliateBlockDomain(t,e,s?x.CJ:x.RAKUTEN)]:[3,6]):[3,6];case 5:return l.sent(),[2];case 6:return[2]}}))}))},compareMatchesAgainstUrl=function(t,e){t?Array.isArray(t)||(t=[String(t)]):t=[];for(var n=0,r=function(t){var e=t.filter((function(t){return/[^/*]$/.test(t)}));if(e.length){var n={};return t.forEach((function(t){return n[t]=!0})),e.forEach((function(t){return n[t+"/"]=!0})),Object.keys(n)}return t}(t);n<r.length;n++){var o=r[n].replace(new RegExp(/\*:\/\/\*\./,"gmi"),"*://*").replace(new RegExp(/\./,"gmi"),"\\.").replace(new RegExp(/\[/,"gmi"),"\\[").replace(new RegExp(/\]/,"gmi"),"\\]").replace(new RegExp(/\^/,"gmi"),"\\^").replace(new RegExp(/\$/,"gmi"),"\\$").replace(new RegExp(/\|/,"gmi"),"\\|").replace(new RegExp(/\?/,"gmi"),"\\?").replace(new RegExp(/\+/,"gmi"),"\\+").replace(new RegExp(/\(/,"gmi"),"\\(").replace(new RegExp(/\)/,"gmi"),"\\)").replace(new RegExp(/\*/,"gmi"),".*").replace(new RegExp(/\//,"gmi"),"\\/")+"$";if(e.match(o))return!0}return!1},getNotEmailCouponCodes_spreadArray=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},HandlesPageLoad_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},HandlesPageLoad_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Vn=function(){function HandlesPageLoad(){var t=this;this.handleReferrerIfDomainIsEbay=function(e,n){return HandlesPageLoad_awaiter(t,void 0,void 0,(function(){return HandlesPageLoad_generator(this,(function(t){switch(t.label){case 0:return isEbay(e)?[4,h.send(n,new Re(null))]:[3,2];case 1:return t.sent(),[3,5];case 2:return n.tabId&&n.windowId?[4,y.ebay(n.tabId,n.windowId).get()]:[3,5];case 3:return t.sent()?[4,y.ebay(n.tabId,n.windowId).unset()]:[3,5];case 4:t.sent(),t.label=5;case 5:return[2]}}))}))}}return HandlesPageLoad.prototype.handle=function(t,e){var n,r=t.payload;return HandlesPageLoad_awaiter(this,void 0,void 0,(function(){var t,o,a,u,s,c,l,p,b,v,w,_,g,m,S,A,O,x,T,P,E,C,I,j,D,R,L,U;return HandlesPageLoad_generator(this,(function(N){switch(N.label){case 0:return[4,Promise.all([W.fetch(),k.fetch(r),y.affiliateTabIds.get(),compat.tabs.active().then((function(t){return(null==t?void 0:t.id)||null})).catch((function(){return null}))])];case 1:t=N.sent(),o=t[0],a=t[1],u=t[2],s=void 0===u?{}:u,c=t[3],l=e.tabId,p=o[(null===(n=null==a?void 0:a.shop)||void 0===n?void 0:n.url)||""],v=(b=a||{}).coupons,w=void 0===v?[]:v,_=b.shop,g=void 0===_?null:_,m=b.random,S=void 0===m||m;try{if(!(null==g?void 0:g.isSameTabLink)&&l&&s[l])return[2]}catch(t){(0,i.Cv)("error while comparing affiliateUrl and current url")}return(0,i.Cv)("shop: ",{shop:g}),A=S?0:w.length,!!(null==g?void 0:g.url)&&f.GZ.includes(g.url)?[2]:(null==g?void 0:g.url)&&isEbay(g.url)?e.tabId&&e.windowId?[4,ebayCheckCanBeOpened(e.tabId,e.windowId,g.url)]:[3,3]:[3,6];case 2:return O=N.sent(),[3,4];case 3:O=!0,N.label=4;case 4:return[4,setBadgeStateEbay(O?A:0)];case 5:return N.sent(),[3,10];case 6:return l&&(null==g?void 0:g.url)&&(null==g?void 0:g.affiliateNetwork)?(x=!1,isBlockingAffiliateLink(g.affiliateNetwork)?[4,getBlockingAffiliateDomainData(l,g.url,g.affiliateNetwork)]:[3,8]):[3,10];case 7:N.sent().redirectBlocked&&(x=!0),N.label=8;case 8:return[4,setBadgeState(l,x?0:A)];case 9:N.sent(),N.label=10;case 10:return T=c===l,(P=isAmazonCartPage(r))&&T?[4,h.send(e,new je({url:r,isAmazon:P}))]:[3,12];case 11:return N.sent(),[2];case 12:return p&&!0!==S&&(null==g?void 0:g.url)?(E=g.js,C=g.matches,I=!!C&&compareMatchesAgainstUrl(C,r),(0,i.Cv)("is cart page",I),j=!g.isPreSupported&&I,T?[4,h.send(e,new je({url:g.url}))]:[3,14]):[2,void 0];case 13:N.sent(),N.label=14;case 14:return this.handleReferrerIfDomainIsEbay(g.url,e),D=detectScriptType(g.scriptName,g.js),g.isPreSupported||g.rct_object?(R=(null==g?void 0:g.rct_object)||null,[4,h.send(e,new at({isPreSupported:g.isPreSupported,scriptType:D,script:R}))]):[3,16];case 15:return N.sent(),[2];case 16:if(!j)return[3,24];D===d.JSON?(0,i.Ki)("Using autoapply-v2 script",i.Bc.SHOP_ENGINE):(0,i.Ki)("Using JS script",i.Bc.SHOP_ENGINE),N.label=17;case 17:return N.trys.push([17,22,,24]),[4,V.fetch(g.url,D,g.scriptName,E)];case 18:return(R=N.sent())&&D===d.JSON?[4,h.send(e,new at({script:R,isPreSupported:g.isPreSupported,scriptType:D}))]:[3,20];case 19:return N.sent(),[3,21];case 20:if("requiredScript"in R)throw new Error("Unable to run ".concat(D," script"));N.label=21;case 21:return[3,24];case 22:return L=N.sent(),U="0-4-0-".concat(null==L?void 0:L.message),[4,this.handleError(U,g.url)];case 23:return N.sent(),[3,24];case 24:return[2]}}))}))},HandlesPageLoad.prototype.handleError=function(t,e){return HandlesPageLoad_awaiter(this,void 0,void 0,(function(){var n;return HandlesPageLoad_generator(this,(function(r){switch(r.label){case 0:return n=function(t){var e=t.code,n=t.message,r="",o=e.split("-").map((function(t){return Number(t)})),a=[["Part One: Show Popups","Part Two: Show Progress","Part Three: Show Result","Part Four: Send cart total stat"],["getting applied coupon","inserting coupon","removing applied coupon","getting total cart","downloading shop script"],["AJAX-query.","simulate user."]];return o.forEach((function(t,e){3!==e&&a[e]&&a[e][t]&&(r+=(0===e?"":1===e?", error ":2===e?" with use ":"")+a[e][t])})),n&&(r+=" Shop API message: ".concat(n)),(0,i.Ki)("ErrorHandler: ".concat(r),i.Bc.SHOP_EXCEPTION,{code:e,message:n}),r}({code:t,message:"Failed to download script for: ".concat(e)}),[4,kn.send({shopDomain:e,code:t,message:n})];case 1:return r.sent(),[2]}}))}))},HandlesPageLoad.prototype.sendCouponsFoundPopup=function(t,e,n){return HandlesPageLoad_awaiter(this,void 0,void 0,(function(){var r;return HandlesPageLoad_generator(this,(function(o){return r=function(t){var e=t.reduce((function(t,e){return e.emailCode?t:getNotEmailCouponCodes_spreadArray(getNotEmailCouponCodes_spreadArray([],t,!0),[e.code],!1)}),[]);return e.length?e:[f.FA]}(e),n&&compat.tabs.sendMessage(n,{cmd:"coupons_found_popup",supported:!0,domain:t.url,coupons:r,couponsObjArr:e,shop_id:t.id}),[2]}))}))},HandlesPageLoad}(),FetchesSupportedDomains_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},FetchesSupportedDomains_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},qn=function(){function FetchesSupportedDomains(){}return FetchesSupportedDomains.prototype.handle=function(){return FetchesSupportedDomains_awaiter(this,void 0,void 0,(function(){var t;return FetchesSupportedDomains_generator(this,(function(e){switch(e.label){case 0:return[4,W.fetch()];case 1:return t=e.sent(),[2,new Tt(t)]}}))}))},FetchesSupportedDomains}(),FetchesCoupons_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},FetchesCoupons_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Jn=function(){function FetchesCoupons(){}return FetchesCoupons.prototype.handle=function(t){var e=t.payload;return FetchesCoupons_awaiter(this,void 0,void 0,(function(){var t,n,r,o,i,a,u,s,c;return FetchesCoupons_generator(this,(function(l){switch(l.label){case 0:return[4,k.fetch(e.hostname,e.ignoreCache)];case 1:return t=l.sent(),r=(n=t||{}).coupons,o=void 0===r?[]:r,i=n.shop,a=void 0===i?null:i,u=n.random,s=void 0===u||u,c=n.error,[2,new st({coupons:o,shop:a,random:s,error:c})]}}))}))},FetchesCoupons}(),FetchesShops_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},FetchesShops_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},zn=function(){function FetchesShops(){}return FetchesShops.prototype.handle=function(t){var e=t.payload;return FetchesShops_awaiter(this,void 0,void 0,(function(){var t;return FetchesShops_generator(this,(function(n){switch(n.label){case 0:return[4,I.fetch(e)];case 1:return t=n.sent(),[2,new pt(t)]}}))}))},FetchesShops}(),SearchesShops_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SearchesShops_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},$n=function(){function SearchesShops(){}return SearchesShops.prototype.handle=function(t){var e=t.payload;return SearchesShops_awaiter(this,void 0,void 0,(function(){var t;return SearchesShops_generator(this,(function(n){switch(n.label){case 0:return[4,I.search(e)];case 1:return t=n.sent(),[2,new pt(t)]}}))}))},SearchesShops}(),FetchesTransactions_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},FetchesTransactions_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Qn=function(){function FetchesTransactions(){}return FetchesTransactions.prototype.handle=function(t,e){var n=t.payload;return FetchesTransactions_awaiter(this,void 0,void 0,(function(){var t,r,o;return FetchesTransactions_generator(this,(function(i){switch(i.label){case 0:return(t=e.url)?[3,2]:[4,compat.tabs.active().then((function(t){return null==t?void 0:t.url}))];case 1:t=i.sent(),i.label=2;case 2:return r=urlToDomain(t||""),[4,B.fetch(n,r)];case 3:return o=i.sent(),[2,new wt(o)]}}))}))},FetchesTransactions}(),AuthLogin_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},AuthLogin_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Xn=function(){function AuthLogin(){}return AuthLogin.prototype.handle=function(t){var e=t.payload;return AuthLogin_awaiter(this,void 0,void 0,(function(){var t;return AuthLogin_generator(this,(function(n){switch(n.label){case 0:return[4,R.login(e)];case 1:return t=n.sent(),[2,new Rt(t)]}}))}))},AuthLogin}(),AuthRegister_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},AuthRegister_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Zn=function(){function AuthRegister(){}return AuthRegister.prototype.handle=function(t){var e=t.payload;return AuthRegister_awaiter(this,void 0,void 0,(function(){var t;return AuthRegister_generator(this,(function(n){switch(n.label){case 0:return[4,R.register(e)];case 1:return t=n.sent(),[2,new Rt(t)]}}))}))},AuthRegister}(),AuthGetUser_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},AuthGetUser_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},tr=function(){function AuthGetUser(){}return AuthGetUser.prototype.handle=function(t){var e=t.payload;return AuthGetUser_awaiter(this,void 0,void 0,(function(){var t;return AuthGetUser_generator(this,(function(n){switch(n.label){case 0:return[4,R.getUser(e)];case 1:return t=n.sent(),[2,new Rt(t)]}}))}))},AuthGetUser}(),AuthUpdateUser_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},AuthUpdateUser_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},er=function(){function AuthUpdateUser(){}return AuthUpdateUser.prototype.handle=function(t){var e=t.payload;return AuthUpdateUser_awaiter(this,void 0,void 0,(function(){var t;return AuthUpdateUser_generator(this,(function(n){switch(n.label){case 0:return[4,R.updateUser(e)];case 1:return t=n.sent(),[2,new Rt(t)]}}))}))},AuthUpdateUser}(),AuthLogout_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},AuthLogout_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},nr=function(){function AuthLogout(){}return AuthLogout.prototype.handle=function(t){var e=t.payload;return AuthLogout_awaiter(this,void 0,void 0,(function(){return AuthLogout_generator(this,(function(t){switch(t.label){case 0:return[4,R.logout(e.shopUrl,e.reason)];case 1:return t.sent(),[2,new Xt(!0)]}}))}))},AuthLogout}(),DeletesAccount_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},DeletesAccount_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},rr=function(){function DeletesAccount(){}return DeletesAccount.prototype.handle=function(){return DeletesAccount_awaiter(this,void 0,void 0,(function(){var t;return DeletesAccount_generator(this,(function(e){switch(e.label){case 0:return[4,R.deleteAccount()];case 1:return t=e.sent(),[2,new ne(t)]}}))}))},DeletesAccount}(),AuthFacebook_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},AuthFacebook_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},or=function(){function AuthFacebook(){}return AuthFacebook.prototype.handle=function(t){var e=t.payload;return AuthFacebook_awaiter(this,void 0,void 0,(function(){var t;return AuthFacebook_generator(this,(function(n){switch(n.label){case 0:return[4,R.facebookAuth(e)];case 1:return t=n.sent(),[2,new $t(t)]}}))}))},AuthFacebook}(),AuthGoogle_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},AuthGoogle_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},ir=function(){function AuthGoogle(){}return AuthGoogle.prototype.handle=function(t){var e=t.payload;return AuthGoogle_awaiter(this,void 0,void 0,(function(){var t;return AuthGoogle_generator(this,(function(n){switch(n.label){case 0:return[4,R.googleAuth(e)];case 1:return t=n.sent(),[2,new $t(t)]}}))}))},AuthGoogle}(),AuthWindow_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},AuthWindow_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},ar=function(){function AuthWindow(){}return AuthWindow.prototype.handle=function(t,e){var n=t.payload;return AuthWindow_awaiter(this,void 0,void 0,(function(){return AuthWindow_generator(this,(function(t){switch(t.label){case 0:return f.Fn&&e.tabId&&e.url&&n.options&&"open"===n.action?[4,y.lastActiveTab.set({tabId:e.tabId,tabUrl:e.url})]:[3,2];case 1:t.sent(),t.label=2;case 2:return U[n.action](n.options),[2]}}))}))},AuthWindow}(),AffiliateApplying_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},AffiliateApplying_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},ur=function(){function AffiliateApplying(){}return AffiliateApplying.prototype.handle=function(t,e){var n=t.payload;return AffiliateApplying_awaiter(this,void 0,void 0,(function(){var t;return AffiliateApplying_generator(this,(function(r){switch(r.label){case 0:return[4,H.apply(n,e)];case 1:return t=r.sent(),[2,new St(t)]}}))}))},AffiliateApplying}(),SendsStatPopupOpened_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SendsStatPopupOpened_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},sr=function(){function SendsStatPopupOpened(){}return SendsStatPopupOpened.prototype.handle=function(){return SendsStatPopupOpened_awaiter(this,void 0,void 0,(function(){return SendsStatPopupOpened_generator(this,(function(t){switch(t.label){case 0:return[4,z.popupOpened()];case 1:return t.sent(),[2]}}))}))},SendsStatPopupOpened}(),SendsStatVersionChanged_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SendsStatVersionChanged_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},cr=function(){function SendsStatVersionChanged(){}return SendsStatVersionChanged.prototype.handle=function(t){var e=t.payload;return SendsStatVersionChanged_awaiter(this,void 0,void 0,(function(){return SendsStatVersionChanged_generator(this,(function(t){switch(t.label){case 0:return[4,z.versionChanged(e)];case 1:return t.sent(),[2]}}))}))},SendsStatVersionChanged}(),SendsStatVisited_assign=function(){return SendsStatVisited_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},SendsStatVisited_assign.apply(this,arguments)},SendsStatVisited_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SendsStatVisited_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},lr=function(){function SendsStatVisited(){}return SendsStatVisited.prototype.handle=function(t){var e,n=t.payload;return SendsStatVisited_awaiter(this,void 0,void 0,(function(){var t;return SendsStatVisited_generator(this,(function(r){switch(r.label){case 0:return[4,y.shopData(n.shopUrl).get()];case 1:return!(t=r.sent())||(null===(e=null==t?void 0:t.stats)||void 0===e?void 0:e.isUniqueVisit)?[3,3]:(t.stats=SendsStatVisited_assign(SendsStatVisited_assign({},(null==t?void 0:t.stats)||{}),{isUniqueVisit:!0}),[4,y.shopData(n.shopUrl).set(t)]);case 2:r.sent(),z.uniqueVisited({shopId:n.shopId}),r.label=3;case 3:return z.visited({shopId:n.shopId}),[2,new Oe(null)]}}))}))},SendsStatVisited}(),SendsStatApplied_assign=function(){return SendsStatApplied_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},SendsStatApplied_assign.apply(this,arguments)},SendsStatApplied_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SendsStatApplied_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},fr=function(){function SendsStatApplied(){}return SendsStatApplied.prototype.handle=function(t){var e,n=t.payload;return SendsStatApplied_awaiter(this,void 0,void 0,(function(){var t,r,o;return SendsStatApplied_generator(this,(function(a){switch(a.label){case 0:return a.trys.push([0,6,,7]),[4,y.shopData(n.shopUrl).get()];case 1:if(!(t=a.sent())||(null===(e=null==t?void 0:t.stats)||void 0===e?void 0:e.isUniqueApplied))return[3,5];a.label=2;case 2:return a.trys.push([2,4,,5]),t.stats=SendsStatApplied_assign(SendsStatApplied_assign({},t.stats||{}),{isUniqueApplied:!0}),[4,y.shopData(n.shopUrl).set(t)];case 3:return a.sent(),z.uniqueApplied({shopId:n.shopId}),[3,5];case 4:return r=a.sent(),(0,i.Cv)("SendsStatApplied catch 001",r),[3,5];case 5:return z.applied({shopId:n.shopId}),[2,new Oe(null)];case 6:return o=a.sent(),(0,i.Cv)("SendsStatApplied catch 002",o),[2,new Oe(null)];case 7:return[2]}}))}))},SendsStatApplied}(),SendsStatCashbackApplied_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SendsStatCashbackApplied_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},pr=function(){function SendsStatCashbackApplied(){}return SendsStatCashbackApplied.prototype.handle=function(t){var e=t.payload;return SendsStatCashbackApplied_awaiter(this,void 0,void 0,(function(){return SendsStatCashbackApplied_generator(this,(function(t){switch(t.label){case 0:return[4,z.cashbackApplied(e)];case 1:return t.sent(),[2]}}))}))},SendsStatCashbackApplied}(),SendsStatSaved_assign=function(){return SendsStatSaved_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},SendsStatSaved_assign.apply(this,arguments)},SendsStatSaved_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SendsStatSaved_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},dr=function(){function SendsStatSaved(){}return SendsStatSaved.prototype.handle=function(t){var e,n=t.payload;return SendsStatSaved_awaiter(this,void 0,void 0,(function(){var t,r,o,a,u;return SendsStatSaved_generator(this,(function(s){switch(s.label){case 0:return[4,y.shopData(n.shopUrl).get()];case 1:return(t=s.sent())?(r=(null==t?void 0:t.stats)||{},o=!r||!r.lastSavedValue,a=!o&&r.lastSavedValue&&r.lastSavedValue.expireBy<Date.now(),u=!o&&(null===(e=r.lastSavedValue)||void 0===e?void 0:e.value)!==n.amount,o||a||u?(t.stats=SendsStatSaved_assign(SendsStatSaved_assign({},r),{lastSavedValue:{value:Number(n.amount.toFixed(2)),expireBy:Date.now()+f.YL}}),[4,y.shopData(n.shopUrl).set(t)]):[3,3]):[2,new Oe(null)];case 2:return s.sent(),z.saved(n),[3,4];case 3:(0,i.Cv)("Saved stat was not sent - the value was already counted"),s.label=4;case 4:return[2,new Oe(null)]}}))}))},SendsStatSaved}(),SendsStatPurchaseTotal_assign=function(){return SendsStatPurchaseTotal_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},SendsStatPurchaseTotal_assign.apply(this,arguments)},SendsStatPurchaseTotal_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SendsStatPurchaseTotal_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},hr=function(){function SendsStatPurchaseTotal(){}return SendsStatPurchaseTotal.prototype.handle=function(t){var e,n=t.payload,r=n.shopUrl,o=n.currentUrl;return SendsStatPurchaseTotal_awaiter(this,void 0,void 0,(function(){var t,n,a,u,s,c,l,f,p,d,h,b,v,_,g;return SendsStatPurchaseTotal_generator(this,(function(m){switch(m.label){case 0:return[4,cartStatStorageApi_getTotal(r)];case 1:return(t=m.sent())?[4,cartStatStorageApi_getSentTotal(r)]:[2];case 2:return!(n=m.sent())||n&&n!==t?[4,Promise.all([y.shopData(r).get(),cartStatStorageApi_checkDiscountedTotal(r,t)])]:[3,10];case 3:return a=m.sent(),u=a[0],s=a[1],u&&u.data.shop?(c=u.orderId||"",l=u.currency||"",f=((null==u?void 0:u.cartData)||{}).appliedCouponId,p=u.data.shop,d=p.affiliateUrl,h=void 0===d?"":d,b=p.id,v={amount:t,shopId:b,affiliateUrl:h,orderId:c,currency:l},f&&(v.couponId=f),s&&(v=SendsStatPurchaseTotal_assign(SendsStatPurchaseTotal_assign({},v),s)),[4,z.purchaseTotal(v)]):[2];case 4:return m.sent(),(0,i.Ki)("Real cart total stats increased by: "+v.amount,i.Bc.SHOP_RCT),[4,y.shopData(r).set(SendsStatPurchaseTotal_assign(SendsStatPurchaseTotal_assign({},u),{orderId:"",currency:"",cartTotal:null,cartData:SendsStatPurchaseTotal_assign(SendsStatPurchaseTotal_assign({},u.cartData),{appliedCoupon:"",appliedCouponId:null,savedAmount:0,totalAfterLastAppliedCoupon:0,isCartChanged:!1,couponStatus:w.INITIAL,cartTotal:0,cartOldTotal:0})}))];case 5:return m.sent(),[4,cartStatStorageApi_setSentTotal({shopUrl:r,sentTotal:t})];case 6:return m.sent(),_=function(t){var e=t.statistics,n=t.shopName,r=t.shopId,o=t.currencySign,i=t.currentUrl,a=t.shopData,u=e.saved&&e.fullAmount?Math.round(e.saved/e.fullAmount*1e4)/100:0,s=a.data.coupons.filter((function(t){return!t.emailCode})).length>0;return{eventName:"Complete Purchase",eventProperties:{$current_url:i,"Shop Name":n,"Shop id":r,"Shop Type":getShopType({partialSupported:a.data.shop.isPreSupported,isCashback:a.data.shop.isCashback,hasCoupons:s}),"Coupon Percent":u,"Coupon Amount":e.saved||!1,"Cart total":e.amount},revenue:/eur|€/i.test(o)?e.amount:0}}({statistics:v,shopId:b,currentUrl:o,shopName:u.data.shop.name,currencySign:(null===(e=null==u?void 0:u.cartData)||void 0===e?void 0:e.currencySign)||u.currency||"",shopData:u}),[4,Tn.send(_)];case 7:return m.sent(),u.data.shop.isCashback?(S=v.amount,g={userProperties:{"Total Spend Partnershops":S,"# of Partnershop Transactions":"+1"}},[4,Tn.send(g)]):[3,9];case 8:m.sent(),m.label=9;case 9:return[3,11];case 10:n===t&&(0,i.Ki)("Real cart total stats update rejected. New total equals to already saved value.",i.Bc.SHOP_RCT),m.label=11;case 11:return[2]}var S}))}))},SendsStatPurchaseTotal}(),SavesStatCartTotal_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SavesStatCartTotal_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},yr=function(){function SavesStatCartTotal(){}return SavesStatCartTotal.prototype.handle=function(t){var e=t.payload;return SavesStatCartTotal_awaiter(this,void 0,void 0,(function(){return SavesStatCartTotal_generator(this,(function(t){switch(t.label){case 0:switch(e.type){case _.CART_TOTAL:return[3,1];case _.DISCOUNTED_AND_CART_TOTAL:return[3,3]}return[3,5];case 1:return[4,cartStatStorageApi_setTotal(e.data)];case 2:case 4:return t.sent(),[2,new Oe(null)];case 3:return[4,cartStatStorageApi_setDiscountedAndCartTotal(e.data)];case 5:return[2,new Oe(null)]}}))}))},SavesStatCartTotal}(),SendsCouponApplicationTime_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SendsCouponApplicationTime_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},br=function(){function SendsCouponApplicationTime(){}return SendsCouponApplicationTime.prototype.handle=function(t){var e=t.payload;return SendsCouponApplicationTime_awaiter(this,void 0,void 0,(function(){var t;return SendsCouponApplicationTime_generator(this,(function(n){switch(n.label){case 0:return[4,Nn.sendCouponTime(e)];case 1:return t=n.sent(),[2,new We(t)]}}))}))},SendsCouponApplicationTime}(),SendsCouponStats_assign=function(){return SendsCouponStats_assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},SendsCouponStats_assign.apply(this,arguments)},SendsCouponStats_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SendsCouponStats_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},SendsCouponStats_rest=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n},vr=function(){function SendsCouponStats(){}return SendsCouponStats.prototype.handle=function(t){var e=t.payload;return SendsCouponStats_awaiter(this,void 0,void 0,(function(){var t,n,r,o,a,u,s,c,l,p,d,h,b,v;return SendsCouponStats_generator(this,(function(w){switch(w.label){case 0:return[4,Promise.all([y.couponsApplicationStats.get(),y.token.get(),y.leadId.get()])];case 1:return t=w.sent(),n=t[0],r=void 0===n?{}:n,o=t[1],a=t[2],r.ids||(r.ids={},r.creationTime=Date.now()),u="3.0.1.5",o?[4,y.userId.get()]:[3,3];case 2:return c=w.sent(),[3,4];case 3:c=null,w.label=4;case 4:return s=c,l=0,e.forEach((function(t){var e=t.id,n=SendsCouponStats_rest(t,["id"]);if(e&&n.discountPercent>0){Array.isArray(r.ids[e])||(r.ids[e]=[]);var o=SendsCouponStats_assign(SendsCouponStats_assign({},n),{client_id:s,lead_id:a,extension_version:u});r.ids[e].push(o),l++}})),l>0?[4,y.couponsApplicationStats.set(r)]:[3,6];case 5:w.sent(),w.label=6;case 6:return 0!==Object.keys(r.ids).length&&Date.now()>r.creationTime+f.FN?((0,i.Cv)("pushApplicationCouponStats: time to flash",r),[4,Nn.sendCouponStats(r.ids)]):[3,11];case 7:return(null==(p=w.sent())?void 0:p.success)?[4,y.couponsApplicationStats.unset()]:[3,9];case 8:return w.sent(),[3,11];case 9:for(d=Date.now(),h=0,b=Object.keys(r.ids);h<b.length;h++)v=b[h],r.ids[v]=r.ids[v].filter((function(t){return t&&t.created_at+f.eG>d})),0===r.ids[v].length&&delete r.ids[v];return[4,y.couponsApplicationStats.set(r)];case 10:w.sent(),w.label=11;case 11:return[2]}}))}))},SendsCouponStats}(),SavesStatOrderId_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SavesStatOrderId_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},wr=function(){function SavesStatOrderId(){}return SavesStatOrderId.prototype.handle=function(t){var e=t.payload;return SavesStatOrderId_awaiter(this,void 0,void 0,(function(){return SavesStatOrderId_generator(this,(function(t){switch(t.label){case 0:return[4,cartStatStorageApi_setOrderId(e)];case 1:return t.sent(),[2,new Oe(null)]}}))}))},SavesStatOrderId}(),SavesStatCurrency_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SavesStatCurrency_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},_r=function(){function SavesStatCurrency(){}return SavesStatCurrency.prototype.handle=function(t){var e=t.payload;return SavesStatCurrency_awaiter(this,void 0,void 0,(function(){return SavesStatCurrency_generator(this,(function(t){switch(t.label){case 0:return[4,cartStatStorageApi_setCurrency(e)];case 1:return t.sent(),[2,new Oe(null)]}}))}))},SavesStatCurrency}(),FetchesGiftCards_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},FetchesGiftCards_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},gr=function(){function FetchesGiftCards(){}return FetchesGiftCards.prototype.handle=function(t){t.payload;return FetchesGiftCards_awaiter(this,void 0,void 0,(function(){var t;return FetchesGiftCards_generator(this,(function(e){switch(e.label){case 0:return[4,Mn.fetch()];case 1:return t=e.sent(),[2,new nn(t)]}}))}))},FetchesGiftCards}(),BuysGiftCard_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},BuysGiftCard_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},mr=function(){function BuysGiftCard(){}return BuysGiftCard.prototype.handle=function(t){var e=t.payload;return BuysGiftCard_awaiter(this,void 0,void 0,(function(){var t;return BuysGiftCard_generator(this,(function(n){switch(n.label){case 0:return[4,Mn.buy(e)];case 1:return t=n.sent(),[2,new un(t)]}}))}))},BuysGiftCard}(),SendsAnalytics_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SendsAnalytics_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Sr=function(){function SendsAnalytics(){}return SendsAnalytics.prototype.handle=function(t){var e=t.payload;return SendsAnalytics_awaiter(this,void 0,void 0,(function(){return SendsAnalytics_generator(this,(function(t){switch(t.label){case 0:return[4,Tn.send(e)];case 1:return t.sent(),[2]}}))}))},SendsAnalytics}(),SendsError_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SendsError_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Ar=function(){function SendsError(){}return SendsError.prototype.handle=function(t){var e=t.payload;return SendsError_awaiter(this,void 0,void 0,(function(){return SendsError_generator(this,(function(t){switch(t.label){case 0:return[4,kn.send(e)];case 1:return t.sent(),[2]}}))}))},SendsError}(),HandleReferrer_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},HandleReferrer_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Or=function(){function HandleReferrer(){}return HandleReferrer.prototype.handle=function(t,e){var n=t.payload;return HandleReferrer_awaiter(this,void 0,void 0,(function(){var t,r,o,a;return HandleReferrer_generator(this,(function(u){switch(u.label){case 0:return e.tabId&&e.windowId?[4,y.ebay(e.tabId,e.windowId).get()]:[2];case 1:if((t=u.sent())&&!t.openedFromInactivity)return(0,i.Ki)("existing",i.Bc.EBAY,t,e.url),[2];r=!1,u.label=2;case 2:return u.trys.push([2,6,,8]),[4,W.fetch()];case 3:return(o=u.sent())&&o[urlToDomain(n.url)||""]?[3,5]:[4,blockEbayPage(e.tabId,e.windowId)];case 4:u.sent(),r=!0,u.label=5;case 5:return[3,8];case 6:return a=u.sent(),(0,i.Ki)("Error getting supported domains while checking ebay page",i.Bc.EBAY,a),[4,blockEbayPage(e.tabId,e.windowId)];case 7:return u.sent(),r=!0,[3,8];case 8:return r?((0,i.Ki)("BLOCKED",i.Bc.EBAY),[2]):n.referrer.includes("lumaly.de")&&n.url.includes("campid=5338791069")?((0,i.Ki)("Case 1.",i.Bc.EBAY),[4,y.ebay(e.tabId,e.windowId).set({count:0,expireBy:Date.now()+f.s4,openedFromLanding:!0})]):[3,10];case 9:return u.sent(),[3,20];case 10:return!n.referrer.includes(".google.")&&!n.referrer.includes(".bing.")||(n.url.includes("mkevt")||n.url.includes("mkcid")||n.url.includes("campid"))?[3,12]:((0,i.Ki)("Case 2.",i.Bc.EBAY),[4,y.ebay(e.tabId,e.windowId).set({count:0,expireBy:Date.now()+f.s4,openedFromSearchEngine:!0})]);case 11:return u.sent(),[3,20];case 12:return n.url.includes("mkevt")||n.url.includes("mkcid")||n.url.includes("campid")||""!==n.referrer?[3,14]:((0,i.Ki)("Case 3.",i.Bc.EBAY),[4,y.ebay(e.tabId,e.windowId).set({count:0,expireBy:Date.now()+f.s4,openedFromDirectNavigation:!0})]);case 13:return u.sent(),[3,20];case 14:return n.url.includes("mkevt")||n.url.includes("mkcid")||n.url.includes("campid")||!isEbay(n.referrer)||(n.referrer.includes("mkevt")||n.referrer.includes("mkcid")||n.referrer.includes("campid"))?[3,16]:((0,i.Ki)("Case 4.",i.Bc.EBAY),[4,y.ebay(e.tabId,e.windowId).set({count:0,expireBy:Date.now()+f.s4,openedFromEbayLink:!0})]);case 15:return u.sent(),[3,20];case 16:return n.url.includes("campid=5338791069")&&""===n.referrer?((0,i.Ki)("Case 5.",i.Bc.EBAY),[4,y.ebay(e.tabId,e.windowId).set({count:0,expireBy:Date.now()+f.s4,openedFromDirectNavigationWithLumaly:!0})]):[3,18];case 17:return u.sent(),[3,20];case 18:return(0,i.Ki)("Case else.",i.Bc.EBAY),[4,blockEbayPage(e.tabId,e.windowId)];case 19:u.sent(),u.label=20;case 20:return[2]}}))}))},HandleReferrer}(),FetchesCurrencyRates_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},FetchesCurrencyRates_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},xr=function(){function FetchesCurrencyRates(){}return FetchesCurrencyRates.prototype.handle=function(t){var e=t.payload;return FetchesCurrencyRates_awaiter(this,void 0,void 0,(function(){var t;return FetchesCurrencyRates_generator(this,(function(n){switch(n.label){case 0:return[4,In.fetchCurrencyRates(e)];case 1:return t=n.sent(),[2,new Fe(t)]}}))}))},FetchesCurrencyRates}(),SendsIsAffiliateBlocked_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SendsIsAffiliateBlocked_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Tr=function(){function SendsIsAffiliateBlocked(){}return SendsIsAffiliateBlocked.prototype.handle=function(t,e){var n=t.payload;return SendsIsAffiliateBlocked_awaiter(this,void 0,void 0,(function(){var t;return SendsIsAffiliateBlocked_generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e.tabId&&e.url?[4,isAffiliateDomainBlocked(e.tabId,e.url,n)]:[2,new Je(!1)];case 1:return t=r.sent(),[2,new Je(t)];case 2:return r.sent(),[2,new Je(!1)];case 3:return[2]}}))}))},SendsIsAffiliateBlocked}(),FetchesCors_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},FetchesCors_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Pr=function(){function FetchesCors(){}return FetchesCors.prototype.handle=function(t){var e=t.payload;return FetchesCors_awaiter(this,void 0,void 0,(function(){var t;return FetchesCors_generator(this,(function(n){switch(n.label){case 0:return[4,Bn.fetchCors(e.url,e.options)];case 1:return t=n.sent(),[2,new Xe(t)]}}))}))},FetchesCors}(),Ebay_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},Ebay_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},kr=function(){function Ebay(){}return Ebay.prototype.handle=function(t,e){var n=t.payload;return Ebay_awaiter(this,void 0,void 0,(function(){var t;return Ebay_generator(this,(function(r){switch(r.label){case 0:if(!e.tabId||!e.windowId)return[2,new cn(!1)];switch(t=!1,n.type){case S.CHECK_CAN_BE_OPENED:return[3,1];case S.DISABLE_CALCULATION_BLOCK:return[3,3];case S.INCREMENT_OPEN_COUNT:return[3,5]}return[3,7];case 1:return[4,ebayCheckCanBeOpened(e.tabId,e.windowId,e.url)];case 2:case 4:case 6:return t=r.sent(),[3,8];case 3:return[4,ebayDisableCalculationBlock(e.tabId,e.windowId)];case 5:return[4,(o=e.tabId,i=e.windowId,ebay_awaiter(void 0,void 0,void 0,(function(){var t,e;return ebay_generator(this,(function(n){switch(n.label){case 0:return[4,y.ebay(o,i).get()];case 1:return t=n.sent()||{},e=t&&t.count?t.count+1:1,t.count=e,[4,y.ebay(o,i).set(t)];case 2:return n.sent(),[2,!0]}}))})))];case 7:return[3,8];case 8:return[2,new cn(t)]}var o,i}))}))},Ebay}(),TestsConnection_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},TestsConnection_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Er=function(){function TestsConnection(){}return TestsConnection.prototype.handle=function(t,e){var n=t.payload;return TestsConnection_awaiter(this,void 0,void 0,(function(){var t,r,o;return TestsConnection_generator(this,(function(a){for(r in t=!1,h.ports)if(Object.prototype.hasOwnProperty.call(h.ports,r)&&(o=h.ports[r]).name.includes("content")&&o.tabId===(n.id||e.tabId)){t=!0;break}return(0,i.Cv)("TestsConnection isConnectedContent: ",t),[2,new yn(t)]}))}))},TestsConnection}(),Cr=(Hn=["////////////","//////@@////////","///////@@@////////","///////@@@////////","///////@@@////////","///////@@@////////","///////@@@@@//////","////////@@@@@@////","////////////////","T E S T I N G"],Kn=Math.max.apply(Math,Hn.map((function(t){return t.length}))),Hn.map((function(t){return" ".repeat((Kn-t.length)/2)+t})).join("\n")),HandlesIsTabActive_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},HandlesIsTabActive_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Ir=function(){function HandlesIsTabActive(){}return HandlesIsTabActive.prototype.handle=function(t,e){t.payload;return HandlesIsTabActive_awaiter(this,void 0,void 0,(function(){var t,n;return HandlesIsTabActive_generator(this,(function(r){switch(r.label){case 0:return[4,compat.tabs.query({active:!0,currentWindow:!0})];case 1:return t=r.sent()[0],n=Boolean(e.tabId&&(null==t?void 0:t.id)===e.tabId),[2,new wn(n)]}}))}))},HandlesIsTabActive}(),SendsStatClosed_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},SendsStatClosed_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},jr=function(){function SendsStatClosed(){}return SendsStatClosed.prototype.handle=function(t){var e=t.payload;return SendsStatClosed_awaiter(this,void 0,void 0,(function(){return SendsStatClosed_generator(this,(function(t){switch(t.label){case 0:return[4,z.closed(e)];case 1:return t.sent(),[2,new Oe(null)]}}))}))},SendsStatClosed}(),HandlesSession_awaiter=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function fulfilled(t){try{step(r.next(t))}catch(t){i(t)}}function rejected(t){try{step(r.throw(t))}catch(t){i(t)}}function step(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())}))},HandlesSession_generator=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Dr=function(){function HandlesGetSession(){}return HandlesGetSession.prototype.handle=function(t,e){t.payload;return HandlesSession_awaiter(this,void 0,void 0,(function(){var t,n,r;return HandlesSession_generator(this,(function(o){switch(o.label){case 0:return e.tabId&&e.url?[4,y.session(e.tabId).get()]:[3,2];case 1:if(t=o.sent(),n=urlToDomain(e.url),t&&n&&(r=t[n]))return[2,new mn(r)];o.label=2;case 2:return[2,new mn({mainPopupRejectedUntil:0,shopCartData:null,analyticsCheckout:null})]}}))}))},HandlesGetSession}(),Rr=function(){function HandlesSetSession(){}return HandlesSetSession.prototype.handle=function(t,e){var n=t.payload;return HandlesSession_awaiter(this,void 0,void 0,(function(){var t,r;return HandlesSession_generator(this,(function(o){switch(o.label){case 0:return e.tabId&&e.url&&(t=urlToDomain(e.url))?[4,y.session(e.tabId).set((r={},r[t]=n,r))]:[3,2];case 1:o.sent(),o.label=2;case 2:return[2,new An(null)]}}))}))},HandlesSetSession}();Wn=!0,(0,i.Cv)("Background page loaded"),f.eD&&((0,i.Cv)("%c"+Cr,"color: #6f48ff;"),(0,i.pC)({BRANCH:void 0,HOST_BRANCH:"PROD",API_URL:f.T5,SHOP_SCRIPT_ENDPOINT:f.Ct,COMMITHASH:void 0,LASTCOMMITDATETIME:void 0,MANIFEST_VERSION:2,EXT_VERSION:"3.0.1.5",browser:getBrowserName(),OS:(Yn=navigator.userAgent,Yn.includes("Macintosh")?"macos":Yn.includes("Windows")?"windows":Yn.includes("Linux")?"linux":Yn.includes("Android")?"android":""),USE_LOCAL_SHOP_SCRIPTS:!1,CAN_OPEN_AFFILIATE:!0,CAN_REPORT_ERRORS:!0,TESTING_LEAD_ID:""})),Wn&&initialize(),h.listen(Jt,new Vn),h.listen(Ot,new qn),h.listen(ot,new Jn),h.listen(lt,new zn),h.listen(ht,new $n),h.listen(bt,new Qn),h.listen(gt,new ur),h.listen(Ct,new Xn),h.listen(jt,new Zn),h.listen(Ut,new tr),h.listen(Bt,new er),h.listen(Ht,new or),h.listen(Ft,new ir),h.listen(Wt,new ar),h.listen(Vt,new nr),h.listen(te,new rr),h.listen(oe,new sr),h.listen(ae,new jr),h.listen(be,new cr),h.listen(we,new lr),h.listen(se,new fr),h.listen(le,new pr),h.listen(he,new dr),h.listen(pe,new hr),h.listen(ge,new yr),h.listen(Te,new wr),h.listen(ke,new _r),h.listen(He,new br),h.listen(Se,new vr),h.listen(kt,new Sr),h.listen(Ce,new Ar),h.listen(Ue,new Or),h.listen(Be,new xr),h.listen(Ve,new Tr),h.listen($e,new Pr),h.listen(tn,new gr),h.listen(on,new mr),h.listen(fn,new kr),h.listen(dn,new Er),h.listen(vn,new Ir),h.listen(gn,new Dr),h.listen(Sn,new Rr)})()})()}catch(t){console.log("global error:",t)}