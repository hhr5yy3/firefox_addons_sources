let gsContentScript={language:"",extensionNamespace:"",dialplanregulars:[],tipCount:0,panel:document.createElement("div"),addGRPElement:"",isHiddenElement:!1,contactSearchFrom:{ldap:!0,localAddressBook:!0},wordDialingEnabled:!0,init:async function(){let e;console.log("namespace init");try{chrome&&chrome.runtime&&(e=chrome,console.log("get extension namespace, ",chrome))}catch(t){browser&&browser.runtime&&(e=browser,console.log("get extension namespace, ",browser))}e&&e.runtime&&e.runtime.onMessage&&(console.log("set runtime onMessage listener"),await e.runtime.onMessage.addListener(this.runtimeOnMessageListener)),this.extensionNamespace=e,await this.extensionNamespace.storage.local.get("phoneBooks",(function(e){e&&e.phoneBooks&&(gsContentScript.phoneBooks=JSON.parse(e.phoneBooks)),console.log("gsContentScript.phoneBooks:",gsContentScript.phoneBooks)})),await this.extensionNamespace.storage.local.get("dialplanregulars",(function(e){if(e&&e.dialplanregulars){let t=e.dialplanregulars;for(let e=0;e<t.length;e++){let n=t[e].pattern;n&&(n=n.replace(/\$$/g,""),gsContentScript.dialplanregulars[e]={pattern:new RegExp(n,"g"),block:t[e].block})}console.log("get dial plan regular:",gsContentScript.dialplanregulars)}})),await this.extensionNamespace.storage.local.get("updateAccountLists",(function(e){gsContentScript.accountLists=e.updateAccountLists,console.log("gsContentScript.accountLists:",gsContentScript.accountLists)})),this.extensionNamespace.storage.onChanged.addListener((function(e){for(let t in e)"phoneBooks"===t&&e[t].newValue&&(gsContentScript.phoneBooks=JSON.parse(e[t].newValue)),"language"===t&&e[t].newValue&&(gsContentScript.language=e[t].newValue),"updateAccountLists"===t&&e[t].newValue&&(gsContentScript.accountLists=e[t].newValue,gsContentScript.handlePhoneNumber())})),await this.extensionNamespace.storage.local.get("language",(function(e){gsContentScript.language=e.language,console.log("gsContentScript.language:",gsContentScript.language)}))},grpDialPlan:function(e){let t;for(const n of this.dialplanregulars)if(t=e.match(n.pattern),t&&!n.block)break;return t},sendMessageToBackgroundJS:function(e,t){if(this.extensionNamespace.runtime&&this.extensionNamespace.runtime.sendMessage)try{e.requestType="contentMessage2Background",this.extensionNamespace.runtime.sendMessage(e,(function(e){t&&t(e)}))}catch(e){}else console.log("sendMessage to Background runtime not found")},runtimeOnMessageListener:function(e,t,n){e&&"backgroundMessage2ContentScript"===e.requestType&&"pageReload"===e.cmd&&(console.log("[EXT] Reload the page after authorization"),!0===confirm("Reload the page after authorization is complete.")&&window.location.reload(!0)),n("request success")},throttle(e,t){var n=0;return function(){let a=Date.now(),o=arguments;a-n>t&&(e.apply(this,o),n=a)}},isEmptyStr:e=>null==e||null==e||""==e,isChinese:function(e){return!!e&&/^[\u4E00-\u9FA5]+$/.test(e)},tip:function(e){e=e||"";let t=document.createElement("div");t.className="chrome-plugin-simple-tip slideInLeft",t.style.top=70*this.tipCount+20+"px",t.innerHTML=`<div>${e}</div>`,document.body.appendChild(t),t.classList.add("animated"),this.tipCount++,setTimeout((()=>{t.style.top="-100px",setTimeout((()=>{t.remove(),this.tipCount--}),1e3)}),1e3)},getFullName:function(e){let t="",n="";if(e.CallerIDName||e.calleridname)t=e.CallerIDName||e.calleridname,this.isChinese(t[0])&&t.indexOf(" ")>-1&&(n=t?.split(" ").reverse().join("").replace(/[ ]/g,""));else if(e.FirstName||e.LastName)if(e.FirstName&&e.LastName){t=e.FirstName+" "+e.LastName;let a=e.FirstName.split("");this.isChinese(a[0])&&(n=e.LastName+e.FirstName)}else t=e.FirstName||e.LastName;return{fullName:t.toString().trim(),chineseFullName:n.toString().trim()}},getContentForFuzzyMatch:function(e){if(!e)return console.log("[EXT] searchContent parameter MUST offer!"),"";let t=[],n=0,a=this.phoneBooks;if(a){let o=function(e,t){let n;if("[object Object]"===Object.prototype.toString.call(e.Phone))e.Phone.phonenumber?.includes(t)&&(n=e.Phone.phonenumber);else if("[object Array]"===Object.prototype.toString.call(e.Phone))for(let a=0;a<e.Phone.length;a++)if(e.Phone[a].phonenumber?.includes(t)){n=e.Phone[a].phonenumber;break}return n};e=e.toLowerCase();let s=new RegExp("-","g");if(e=e.replace(s,""),gsContentScript.contactSearchFrom.ldap&&a.ldap)for(let o=0;o<a.ldap.length;o++){let s=a.ldap[o],{fullName:r,chineseFullName:i}=this.getFullName(s),l=r,c=r?.toLowerCase();if(i=i?.toLowerCase(),s?.AccountNumber?.includes(e)||c?.includes(e)||i?.includes(e)||s?.email?.includes(e)){let e=[];e[0]||(e[0]={}),s?.AccountNumber&&(e[0].accountNumber=s?.AccountNumber),s?.HomeNumber&&(e[0].homeNumber=s?.HomeNumber),s?.MobileNumber&&(e[0].mobileNumber=s?.MobileNumber),t[n]={},t[n].from="ldap",t[n].phoneNumber=e,s?.CallerIDName&&(t[n].name=l),s?.email&&(t[n].email=s?.email),n++}}if(gsContentScript.contactSearchFrom.localAddressBook&&a.localAddressBook){let s=a.localAddressBook;for(let a=0;a<s.length;a++){let r=s[a],i=r?.Phone,{fullName:l,chineseFullName:c}=this.getFullName(r),d=l,p=c;if(l=l?.toLowerCase(),c=c?.toLowerCase(),l?.includes(e)||c?.includes(e)||r?.email?.includes(e)||o(r,e)){let a=[];t[n]={},i&&("[object Array]"===Object.prototype.toString.call(i)?a=i:a.push(i));let o=l?.includes(e)||c?.includes(e);t[n].from="localAddressBook",t[n].phoneNumber=a,t[n].name=o?l?.includes(e)?d:p:l||p,t[n].email=r?.email,t[n].jobTitle=r?.JobTitle,t[n].company=r?.Company,n++}}}if(!t.length&&!isNaN(Number(e))&&gsContentScript.dialplanregulars.length){let n={phoneNumber:[{phoneNumber:this.grpDialPlan(e)}]};t.push(n)}}return t},loadContentScript:async function(){console.log("load content script"),await gsContentScript.init(),await gsContentScript.initCustomPanel(),await gsContentScript.initCustomEventListens()},initCustomPanel:function(e={}){this.panel.className="addGrpSpan addGrpSpan_hidden",this.panel.innerHTML='\n            <div class="addContentWrapper">\n                <div class="GRP-icon-close addGrpClose"></div>\n                <div class="addGrpTop">\n                    <div class="addGrpLeft">\n                        <span class="addGrpIcon GRP-icon-icon_left"></span>\n                    </div>\n                    <div class="addGrpCenter">\n                        <div class="addGrpCenter_icon">\n                            <span class="addGrp_iconText GRP-icon-icon_meeting"> </span>\n                        </div>\n                        <div class="addGrpCenter_content"></div>\n                    </div>\n                    <div class="addGrpRight">\n                        <span class="addGrpIcon GRP-icon-icon_right " ></span>\n                    </div>\n                </div>\n\n                <div class="addGrpBottom">\n                    <div class="addGrpContent">\n                        <div class="addGrpShow">\n                            <span class="addGrp_email"></span>\n                        </div>\n\n                        <div id="addGrpTipsContent" class="addGrpTips">\n                            <div class="addGrp_tips_content addGrp_tips_number">\n                                <span class="addGrp_tip_number_txt">Number：</span>\n                                <span class="addGrp_tip_number"></span>\n                            </div>\n                            <div class="addGrp_tips_content addGrp_tips_name">\n                                <span class="addGrp_tip_name_txt">Name：</span>\n                                <span class="addGrp_tip_name"></span>\n                            </div>\n                            <div class="addGrp_tips_content addGrp_tips_email">\n                                <span class="addGrp_tip_email_txt">Email：</span>\n                                <span class="addGrp_tip_email"></span>\n                            </div>\n                            <div class="addGrp_tips_content addGrp_tips_company">\n                                <span class="addGrp_tip_company_txt">Company：</span>\n                                <span class="addGrp_tip_company"></span>\n                            </div>\n                            <div class="addGrp_tips_content addGrp_tips_department">\n                                <span class="addGrp_tip_department_txt">Department：</span>\n                                <span class="addGrp_tip_department"></span>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="userAccount"> \n                        <div class="addGrp_showSelectOption">\n                            <ul class="addGrp_ul"></ul>\n                        </div>\n                        <div class="addGrp_wrapper">\n                            <div class="addGrp_selectContent">\n                                <div class="addGrp-icon-parent GRP-icon-person">\n                                    <div class="addGrp-icon-floater"></div>\n                                </div>\n                                <div class="addGrp_getContent_wrapper">\n                                  <div class="addGrp_getContent addGrp_container_words "></div>\n                                </div>                              \n                                <div class="addGrp_iconBtn">\n                                     <span class="addGrp_icon GRP-icon-down"></span>\n                                </div>\n                            </div>\n                            <div class="addGrp_btn">\n                                <button class="addGrp_call">呼叫</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>',document.body.append(this.panel)},initCustomEventListens:function(){this.clickEvent(),this.hoverEvent(),this.leaveEvent()},clickEvent:function(){let e=document.getElementsByClassName("addGrp_btn")[0];e&&e.addEventListener("click",(function(e){let t=document.getElementsByClassName("addGrp_getContent")[0].getAttribute("accountid"),{currentElement:n}=gsContentScript.getCurrent(),a=n.value?.trim();gsContentScript.sendMessageToBackgroundJS({cmd:"contentScriptMakeCall",data:{accountId:t,phonenumber:a}}),(document.getElementsByClassName("addGrpSpan")[0]||gsContentScript.target?.document.getElementsByClassName("addGrpSpan")[0]).style.display="none"}));let t=document.getElementsByClassName("GRP-icon-icon_left")[0];t&&t.addEventListener("click",(function(e){e.stopPropagation(),gsContentScript.switchContacts("pre")}),!1);let n=document.getElementsByClassName("GRP-icon-icon_right")[0];n&&n.addEventListener("click",(function(e){e.stopPropagation(),gsContentScript.switchContacts("next")}),!1);let a=document.getElementsByClassName("addGrp_showSelectOption")[0],o=document.getElementsByClassName("addGrp_selectContent")[0];o&&(o.onclick=function(){gsContentScript.isHiddenElement?(gsContentScript.isHiddenElement=!1,a.style.display="none"):(gsContentScript.isHiddenElement=!0,a.style.display="block")});let s=document.getElementsByClassName("addGrp_ul")[0],r=document.getElementsByClassName("addGrp_getContent")[0],i=document.getElementsByClassName("addGrp-icon-floater")[0];s&&(s.onclick=function(e){gsContentScript.isHiddenElement=!1;let t=e.target.parentNode?.parentNode,n=t?.children;for(let t=0;t<n.length;t++){let a=n[t];a&&(a.style.color="#222222",t===n.length-1&&e.target.parentNode&&(e.target.parentNode.style.color="#2F91FF"))}i.textContent=e.target.getAttribute("accountId")||e.target.getAttribute("currentindex"),r.textContent=`${e.target.getAttribute("name")} (${e.target.getAttribute("sipId")})`,r.classList.contains("addGrp_container_words_hover")&&(r.classList.remove("addGrp_container_words_hover"),r.setAttribute("title","")),r.setAttribute("accountId",e.target.getAttribute("accountId")),r.setAttribute("name",e.target.getAttribute("name")),r.setAttribute("sipId",e.target.getAttribute("sipId")),a.style.display="none"});let l=document.querySelector(".addGrpClose");l&&l.addEventListener("click",(function(e){(document.getElementsByClassName("addGrpSpan")[0]||gsContentScript.target?.document.getElementsByClassName("addGrpSpan")[0]).style.display="none"}))},hoverEvent:function(){let e=document.getElementsByClassName("addGrpShow")[0];e&&(e.onmousemove=function(){gsContentScript.handleTipsContent()});let t=document.getElementsByClassName("addGrp_getContent")[0];t&&(t.onmousemove=function(e){let t=e.target,n=t.offsetWidth;t.scrollWidth>n&&(t.title=t.textContent,t.classList.add("addGrp_container_words_hover"))});let n=document.getElementsByClassName("addGrp_ul")[0];n&&(n.onmousemove=function(e){let t=e.target,n=t.offsetWidth,a=t.scrollWidth;t.classList.contains("addGrp_span")&&a>n&&(t.title=t.textContent)})},leaveEvent:function(){let e=document.getElementsByClassName("addGrpShow")[0];e&&(e.onmouseleave=function(){gsContentScript.handleTipsContent(),document.getElementsByClassName("addGrpTips")[0].style.display="none"})},handleTipsContent:function(){let e={},t=gsContentScript.getCurrent().currentElement;t&&t&&["email","name","jobTitle","company","department","phone"].forEach((n=>{const a=t.getAttribute(n);a&&("phone"===n?e.number=a:e[n]=a)})),"[object Object]"===Object.prototype.toString.call(e)&&function(e){const t=document.querySelector(".addGrpTips");let n=Object.keys(e).length;if(0!==n){{const e=-40-20*(n-1);t.style.top=e+"px",t.style.display="block"}["number","name","email","company","department"].forEach((t=>{const n=document.querySelector(`.addGrp_tips_${t}`),a=document.querySelector(`.addGrp_tip_${t}`);e[t]?(a.textContent=e[t],n.style.display="flex"):n.style.display="none"}))}else t.style.display="none"}(e)},getCurrent:function(){let e,t,n=document.getElementsByClassName("addGrpCenter_content")[0];for(let a=0;a<n.children.length;a++){let o=n.children[a];if(o.classList.contains("addGrp_active")){t=o,e=a;break}}return{currentIndex:e,currentElement:t}},changeEmail:function(e){let t=document.getElementsByClassName("addGrp_email")[0],n=e.getAttribute("email"),a=e.getAttribute("name");t&&(t.textContent=n&&a?`${n}(${a})`:n||a||"")},changeTips:function(e){const t={email:"addGrp_tip_email",name:"addGrp_tip_name",jobTitle:"addGrp_tip_jobTitle",company:"addGrp_tip_company",department:"addGrp_tip_department",phone:"addGrp_tip_number"};for(const n in t){const a=e.getAttribute(n),o=document.getElementsByClassName(t[n])[0];o&&(o.textContent=a||"")}},switchContacts:function(e){let t,n=document.getElementsByClassName("addGrpCenter_content")[0],a=n.children.length,{currentIndex:o}=gsContentScript.getCurrent();if(a>0){for(let e=0;e<n.children.length;e++){let t=n.children[e];if(o===e){t.style.display="none",t.classList.remove("addGrp_active");break}}for(let a=0;a<n.children.length;a++){let s=n.children[a];"pre"===e?(t=o-1,t<0&&(t=n.children.length-1)):(t=o+1,t>n.children.length-1&&(t=0)),a===t&&(s.style.display="block",s.classList.add("addGrp_active"),gsContentScript.handleIcon(s),gsContentScript.changeEmail(s),gsContentScript.changeTips(s))}}},handleIcon:function(e){let t,n=document.getElementsByClassName("addGrp_iconText")[0],a=e.numberType?.toLowerCase();t="work"===a||"office"===a||"number"===a||"accountnumber"===a?"GRP-icon-icon_company":"home"===a||"homenumber"===a?"GRP-icon-icon_home":"mobile"===a||"cell"===a||"phone"===a||"mobilenumber"===a?"GRP-icon-icon_phone":"conference"===a?"GRP-icon-icon_meeting":"GRP-icon-icon_phone_default",n&&(n.classList.value=n.classList.value.split(" ").splice(0,1).join("")),n&&n.classList.add(t)},showContent:function(e){!function(e){let t=function(e){let t=document.getElementsByClassName("addGrpCenter_content")[0]||gsContentScript.target?.document.getElementsByClassName("addGrpCenter_content")[0],n=document.createDocumentFragment();n.className="addGrpFragment";for(let t=0;t<e.length;t++){let a=e[t],o=a?.name,s=a?.email,r=a?.jobTitle,i=a?.company,l=a?.department,c=function(e,a,c){for(let d=0;d<a.length;d++){let p=a[d],m=e[p];if("accountindex"===p||"_type"===p)break;{let a=document.createElement("input").cloneNode(!0);a.className=`addGrp_input addGrp_${m}`,a.value=m,a.placeholder=m,a.number=m,a.numberType=e?._type||p,a.setAttribute("phone",m),o&&a.setAttribute("name",o),s&&a.setAttribute("email",s),r&&a.setAttribute("jobTitle",r),i&&a.setAttribute("company",i),(e?._type||p)&&a.setAttribute("phoneType",e?._type||p),l&&a.setAttribute("department",l),gsContentScript.handleIcon(a),e?0===t&&0===c&&0===d?a.className+=" addGrp_active":a.style.display="none":0===t&&0===d&&0===d?a.className+=" addGrp_active":a.style.display="none",n.appendChild(a)}}},d=function(e=null,t=null){let n;"[object Object]"===Object.prototype.toString.call(e)&&(n=Object.keys(e)),n&&n.length&&c(e,n,t)};if("[object Object]"===Object.prototype.toString.call(a.phoneNumber))d();else if("[object Array]"===Object.prototype.toString.call(a.phoneNumber))for(let e=0;e<a.phoneNumber.length;e++)d(a.phoneNumber[e],e)}t&&n&&t.appendChild(n)};!function(e){let n=document.getElementsByClassName("addGrpCenter_content")[0]||gsContentScript.target?.document.getElementsByClassName("addGrpCenter_content")[0];if(n&&n.children.length)for(let a=n.children.length-1;a>=0;a--){let o=n.children[a];n.removeChild(o),0===n.children.length&&t(e)}else t(e)}(e)}(e),function(e){let t=document.getElementsByClassName("addGrp_email")[0]||gsContentScript.target?.document.getElementsByClassName("addGrp_email")[0];for(let n=0;n<e.length;n++){let a=e[n];if(0===n&&t){let e=a?.email,n=a?.name;t.textContent=e&&n?`${e}(${n})`:e||n||""}}}(e)},displayContentBasedOnLanguage:function(){const e={addGrp_call:"call",addGrp_tip_number_txt:"number",addGrp_tip_name_txt:"name",addGrp_tip_email_txt:"email",addGrp_tip_company_txt:"company",addGrp_tip_department_txt:"department"};if(gsContentScript.language)for(const t in e){const n=document.querySelector(`.${t}`)||gsContentScript.target?.document.querySelector(`.${t}`),a=gsContentScript.language[e[t]];n&&a&&(n.textContent="addGrp_call"===t?`${a}`:`${a}:`)}},setContentPosition:function(e,t){let n=document.querySelector(".addGrpSpan")||document.querySelector(".addGrpSpan");if(e.length&&n){t.pageX&&t.pageY?(n.classList.remove("addGrpSpan_center"),n.style.left=t.pageX-20+"px",n.style.top=t.pageY+20+"px",n.style.right="",n.style.bottom=""):(n.classList.add("addGrpSpan_center"),n.style.top="0",n.style.left="0",n.style.right="0",n.style.bottom="0"),n&&n.classList.contains("addGrpSpan_hidden")&&n.classList.toggle("addGrpSpan_hidden");let a=function(e,t,n){e&&(t?e.style.display=t:n&&(e.style.paddingLeft=n))},o=document.querySelector(".addGrpLeft")||gsContentScript.target?.document.querySelector(".addGrpLeft"),s=document.querySelector(".addGrpRight")||gsContentScript.target?.document.querySelector(".addGrpRight"),r=document.querySelector(".addGrpTop")||gsContentScript.target?.document.querySelector(".addGrpTop");e.length<=1&&e[0].phoneNumber&&e[0].phoneNumber.length<=1?(a(o,"none"),a(s,"none"),a(r,"","30px")):(a(o,"flex"),a(s,"flex"),a(r,"","10px"))}else n&&!n.classList.contains("addGrpSpan_hidden")&&n.classList.toggle("addGrpSpan_hidden")},handlePhoneNumber:async function(){let e=function(){let e=document.getElementsByClassName("addGrp_ul")[0]||gsContentScript.target?.document.getElementsByClassName("addGrp_ul")[0];if(e&&e.children.length>0)for(let n=e.children.length-1;n>=0;n--){let a=e.children[n];e.removeChild(a),e.children.length||t()}else t()},t=function(){let e=document.createDocumentFragment(),t=document.getElementsByClassName("addGrp_ul")[0]||gsContentScript.target?.document.getElementsByClassName("addGrp_ul")[0],n=document.getElementsByClassName("addGrp_getContent")[0]||gsContentScript.target?.document.getElementsByClassName("addGrp_getContent")[0],a=document.getElementsByClassName("addGrp-icon-floater ")[0]||gsContentScript.target?.document.getElementsByClassName("addGrp-icon-floater ")[0];if(gsContentScript.accountLists)for(let o=0;o<gsContentScript.accountLists.length;o++){let s=gsContentScript.accountLists[o],r=s.sip_id,i=s.name,l=s.id,c=document.createElement("li").cloneNode(!0);c.className="addGrpOption",c.setAttribute("currentIndex",l),c.setAttribute("sipId",r),c.setAttribute("name",i),c.setAttribute("accountId",l);let d=document.createElement("div").cloneNode(!0);d.className="addGrp-icon-parent GRP-icon-person",d.setAttribute("sipId",r),d.setAttribute("accountId",l),d.setAttribute("name",i),d.setAttribute("accountType",s.auto_cfg);let p=document.createElement("div").cloneNode(!0);p.className="addGrp-icon-floater",p.setAttribute("sipId",r),p.setAttribute("accountId",l),p.setAttribute("name",i),p.setAttribute("accountType",s.auto_cfg),p.textContent=l,d.appendChild(p),c.appendChild(d);let m=document.createElement("span").cloneNode(!0);m.className=`addGrp${r} addGrp_span`,m.setAttribute("accountId",l),m.setAttribute("name",i),m.setAttribute("accountType",s.auto_cfg),m.setAttribute("sipId",r),m.textContent=`${i} (${r})`,c.appendChild(m),e.appendChild(c),0===o&&(a&&(a.textContent=l),c.style.color="#6fa8dc",n&&(n.textContent=`${i} (${r})`,n.setAttribute("accountId",l),n.setAttribute("sipId",r),n.classList.contains("addGrp_container_words_hover")&&(n.classList.remove("addGrp_container_words_hover"),n.setAttribute("title","")))),o===gsContentScript.accountLists.length-1&&t&&t.appendChild(e)}};gsContentScript?.accountLists&&"{}"!==JSON.stringify(gsContentScript?.accountLists)?e():new Promise((async e=>{await gsContentScript.extensionNamespace.storage.local.get("updateAccountLists",(function(t){gsContentScript.accountLists=t.updateAccountLists,e(gsContentScript.accountLists)}))})).then((t=>{t&&e()})).catch((e=>{console.log("handlePhoneNumber error")}));let n=document.getElementsByClassName("addGrp_showSelectOption")[0]||gsContentScript.target?.document.getElementsByClassName("addGrp_showSelectOption")[0];n&&(n.style.display="none")},getMousePosition:function(e,t){let n=t.clientX,a=t.clientY,o=0,s=0;if(e){e=e.frameElement;var r=e?.getBoundingClientRect();o+=r.left,s+=r.top}return{x:n+o,y:a+s}},getSelectionContent:function(){let e,t,n=function(n){if(n.length)for(let a=0;a<n.length;a++)try{let o=n[a];if(e=o.frameElement?.contentWindow?.getSelection(),t=e?.toString()?.trim(),t)break}catch(e){}};try{self.length?n(self):self.frames?self.frames.length?n(self.frames):(e=self.frames?.frameElement?.contentWindow?.getSelection(),t=e?.toString()?.trim()):self.frameElement&&(self.frameElement.length?n(self.frameElement):(e=self.frameElement?.contentWindow?.getSelection(),t=e?.toString()?.trim())),t||(e=window.getSelection?window.getSelection():window.document.getSelection(),t=e?.toString()?.trim())}catch(e){console.log("get selection content error:",e)}return t},deleteIframeElement:function(){let e=document.getElementsByTagName("iframe");for(let n=0;n<e.length;n++){let a=e[n],o=a?.contentDocument||a?.contentDocument?.document,s=o?.getElementsByClassName("addGrpSpan")[0];s&&s.parentNode.removeChild(s);var t=o?.getElementsByTagName("script")[0];t&&t.parentNode.removeChild(t)}},processSelectionTextContent(e){if("GRPSPAN"===e.target.nodeName||e.target.getAttribute&&e.target.getAttribute("grpcallnumber"))return;if(e.target.classList&&(e.target.classList.contains("addGrp_account")||e.target.classList.contains("addGrp_call")||e.target.classList.value.indexOf("addGrp")>-1))return;gsContentScript.target=e.currentTarget&&e.currentTarget?.window?.parent,gsContentScript.deleteIframeElement();let t=document.getElementsByClassName("addGrpSpan")[0]||gsContentScript.target?.document.getElementsByClassName("addGrpSpan")[0],n=gsContentScript.getSelectionContent();n?gsContentScript.sendMessageToBackgroundJS({cmd:"configureQuery"},(function(a){gsContentScript.wordDialingEnabled=a.wordDialing,gsContentScript.contactSearchFrom=a.contactSearchFrom,gsContentScript.wordDialingEnabled&&new Promise(((e,t)=>{let a=gsContentScript.getContentForFuzzyMatch(n);n=null,a&&"[object Array]"===Object.prototype.toString.call(a)?(gsContentScript.showContent(a),gsContentScript.displayContentBasedOnLanguage(),e(a)):t("The current data is not an array or data is null")})).then((n=>{n&&n.length?(t&&(t.style.display="block"),gsContentScript.setContentPosition(n,e),gsContentScript.handlePhoneNumber()):t&&(t.style.display="none")})).catch((e=>{console.log("error:",e),t&&(t.style.display="none")}))})):t&&(t.style.display="none")},getBrowserDetail(){function e(e,t,n){let a=e.match(t);return a&&a.length>=n&&parseInt(a[n],10)}var t={browser:null,version:null,UIVersion:null,chromeVersion:null,systemFriendlyName:null};if(navigator.userAgent.match(/Windows/)?t.systemFriendlyName="windows":navigator.userAgent.match(/Mac/)?t.systemFriendlyName="mac":navigator.userAgent.match(/Linux/)&&(t.systemFriendlyName="linux"),"undefined"==typeof window||!window.navigator)return t.browser="Not a browser.",t;if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=e(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),t.UIVersion=navigator.userAgent.match(/Edge\/([\d.]+)/)[1];else if(!navigator.mediaDevices&&(window.ActiveXObject||"ActiveXObject"in window||navigator.userAgent.match(/MSIE (\d+)/)||navigator.userAgent.match(/rv:(\d+)/)))t.browser="ie",navigator.userAgent.match(/MSIE (\d+)/)?(t.version=e(navigator.userAgent,/MSIE (\d+).(\d+)/,1),t.UIVersion=navigator.userAgent.match(/MSIE ([\d.]+)/)[1]):navigator.userAgent.match(/rv:(\d+)/)&&(t.version=e(navigator.userAgent,/rv:(\d+).(\d+)/,1),t.UIVersion=navigator.userAgent.match(/rv:([\d.]+)/)[1]);else if(navigator.mozGetUserMedia)t.browser="firefox",t.version=e(navigator.userAgent,/Firefox\/(\d+)\./,1),t.UIVersion=navigator.userAgent.match(/Firefox\/([\d.]+)/)[1];else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection)navigator.userAgent.match(/(OPR|Opera).([\d.]+)/)?(t.browser="opera",t.version=e(navigator.userAgent,/O(PR|pera)\/(\d+)\./,2),t.UIVersion=navigator.userAgent.match(/O(PR|pera)\/([\d.]+)/)[2],navigator.userAgent.match(/Chrom(e|ium)\/([\d.]+)/)[2]&&(t.chromeVersion=e(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2))):(t.browser="chrome",t.version=e(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2),t.UIVersion=navigator.userAgent.match(/Chrom(e|ium)\/([\d.]+)/)[2]);else{if(!(!navigator.webkitGetUserMedia&&navigator.userAgent.match(/AppleWebKit\/([0-9]+)\./)||navigator.webkitGetUserMedia&&!navigator.webkitRTCPeerConnection))return t.browser="Not a supported browser.",t;if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return t.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",t;t.browser="safari",t.version=e(navigator.userAgent,/AppleWebKit\/(\d+)\./,1),t.UIVersion=navigator.userAgent.match(/Version\/([\d.]+)/)[1]}return t}};"firefox"===gsContentScript.getBrowserDetail().browser?gsContentScript.loadContentScript():document.addEventListener("DOMContentLoaded",(function(){console.log("DOMContentLoaded completed"),gsContentScript.loadContentScript()})),window.addEventListener("mouseup",(function(e){setTimeout((function(){gsContentScript.processSelectionTextContent(e)}),0)}));