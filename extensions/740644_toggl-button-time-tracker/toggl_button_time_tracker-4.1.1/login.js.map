{"version":3,"file":"login.js","sources":["../../src/background/login.ts"],"sourcesContent":["/* eslint-disable no-console */\n\nfunction completeLogin() {\n  location.href = chrome.runtime.getURL('settings.html')\n}\n\nfunction verifyUser(userId: number) {\n  chrome.runtime\n    .sendMessage({\n      type: 'VERIFY_USER',\n      payload: {\n        userId,\n        isStaging: location.hostname.includes('toggl.space'),\n      },\n    })\n    .catch((e) => {\n      console.error(e, 'error in checkUser event handler')\n    })\n}\n\nfunction logoutUser() {\n  chrome.runtime\n    .sendMessage({\n      type: 'CLEAR_DATA',\n      payload: {\n        isStaging: location.hostname.includes('toggl.space'),\n      },\n    })\n    .catch((e) => {\n      console.error(e, 'Login::error in logoutUser event handler')\n    })\n}\n\nfunction handleIncomingMessage(event) {\n  if (\n    event.source === window &&\n    event.data &&\n    event.data.direction === 'from-webapp'\n  ) {\n    console.debug('Login::handleIncomingMessage', event.data)\n\n    switch (event.data.message) {\n      case 'user-loaded':\n        verifyUser(event.data.userId)\n        break\n      case 'logout':\n        logoutUser()\n        break\n      case 'extension-login':\n        // TODO: Handle the full fetch on login completion.\n        completeLogin()\n        break\n      default:\n        console.debug(\n          'Login::handleIncomingMessage',\n          'Unsupported event',\n          event\n        )\n    }\n  }\n}\n\nwindow.addEventListener('message', handleIncomingMessage)\n"],"names":["completeLogin","location","href","chrome","runtime","getURL","verifyUser","userId","sendMessage","type","payload","isStaging","hostname","includes","catch","e","error","logoutUser","handleIncomingMessage","event","source","window","data","direction","debug","message","addEventListener"],"mappings":"AAEA,SAASA,GAAgB,CACvBC,SAASC,KAAOC,OAAOC,QAAQC,OAAO,eAAe,CACvD,CAEA,SAASC,EAAWC,EAAgB,CAClCJ,OAAOC,QACJI,YAAY,CACXC,KAAM,cACNC,QAAS,CACPH,OAAAA,EACAI,UAAWV,SAASW,SAASC,SAAS,aAAa,CACrD,CACF,CAAC,EACAC,MAAaC,GAAA,CACJC,QAAAA,MAAMD,EAAG,kCAAkC,CACrD,CAAC,CACL,CAEA,SAASE,GAAa,CACpBd,OAAOC,QACJI,YAAY,CACXC,KAAM,aACNC,QAAS,CACPC,UAAWV,SAASW,SAASC,SAAS,aAAa,CACrD,CACF,CAAC,EACAC,MAAaC,GAAA,CACJC,QAAAA,MAAMD,EAAG,0CAA0C,CAC7D,CAAC,CACL,CAEA,SAASG,EAAsBC,EAAO,CAElCA,GAAAA,EAAMC,SAAWC,QACjBF,EAAMG,MACNH,EAAMG,KAAKC,YAAc,cAIzB,OAFQC,QAAAA,MAAM,+BAAgCL,EAAMG,IAAI,EAEhDH,EAAMG,KAAKG,aACZ,cACQN,EAAAA,EAAMG,KAAKf,MAAM,EAC5B,UACG,SACQU,IACX,UACG,kBAEWjB,IACd,cAEQwB,QAAAA,MACN,+BACA,oBACAL,CACF,EAGR,CAEAE,OAAOK,iBAAiB,UAAWR,CAAqB"}