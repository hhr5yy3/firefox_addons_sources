(()=>{"use strict";var e={42327:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InternalMessageBgType=t.MessageBgType=void 0,function(e){e.INIT="INIT",e.REQUEST_HANDLE="REQUEST_HANDLE",e.IFRAME_LOADED="IFRAME_LOADED"}(t.MessageBgType||(t.MessageBgType={})),function(e){e.TRACK="ECOMMERCE_INTERNAL_TRACK"}(t.InternalMessageBgType||(t.InternalMessageBgType={}))},1106:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.debounce=t.DEFAULT_DEBOUNCE_TIME=t.pipe=t.uuid=t.isIframe=void 0,t.isIframe=function(){try{return window.self!==window.top}catch{return!0}},t.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))};t.pipe=(...e)=>t=>e.reduce(((e,t)=>t(e)),t),t.DEFAULT_DEBOUNCE_TIME=150;t.debounce=(e,a=t.DEFAULT_DEBOUNCE_TIME)=>{let r=0;return(...t)=>{clearTimeout(r),r=setTimeout((()=>e(...t)),a)}}},11272:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Observer=void 0;t.Observer=class{constructor(){this.listeners={}}emit(e,t){if(!this.listeners[e])return;this.listeners[e].forEach((e=>e(t)))}subscribe(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}}},74990:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtractorManager=void 0;const r=a(40233);var n;!function(e){e.RUNTIME_STORAGE_SAVE="@runtime.storage.save"}(n||(n={}));t.ExtractorManager=class{constructor(e,t,a,r,n){this.templateVersion=e,this.outMessageManager=t,this.logging=a,this.storage=r,this.sharedMethods=n}run(e,t={}){const a=this.makeExtractor(e.operations,document,t);setTimeout((()=>{a.run().then((t=>{t&&this.outMessageManager.trackMessage(e.event,this.templateVersion,t,e.customEvent)}))}),e.waitMs??0)}get config(){return{log:this.logging}}makeExtractor(e,t,a){const s={...this.storage.getStorage(),...a},i=new r.Extractor(this.config,e,t,s,this.sharedMethods);return i.on(n.RUNTIME_STORAGE_SAVE,this.onRuntimeStorageSaveExtractorEvent.bind(this)),i}onRuntimeStorageSaveExtractorEvent([e,t]){this.storage.save(e,t),this.outMessageManager.runtimeStorageSaveMessage(e,t)}}},51648:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryManager=void 0,function(e){e.URL_CHANGED="URL_CHANGED"}(a||(a={}));t.HistoryManager=class{constructor(e){this.observer=e,this.scriptAttribute="extend-native-history-api",this.scriptPath="libs/extend-native-history-api.js",window.addEventListener("message",(e=>{"CUSTOM_ON_URL_CHANGED"===e.data._custom_type_&&this.observer.emit(a.URL_CHANGED,location.href)}))}replaceNativeApi(){this.waitDomReady()}onUrlChanged(e){this.observer.subscribe(a.URL_CHANGED,e)}waitDomReady(){setTimeout((()=>{this.injectScript()}),0)}injectScript(){if(this.isHistoryScriptInjected())return;const e=document.createElement("script");e.setAttribute("ecommerce-type",this.scriptAttribute);e.innerHTML=`(${(()=>{const e=history.pushState,t=history.replaceState,a=history.back,r=history.forward;function n(){window.postMessage({_custom_type_:"CUSTOM_ON_URL_CHANGED"})}history.pushState=function(){e.apply(history,arguments),n()},history.replaceState=function(){t.apply(history,arguments),n()},history.back=function(){a.apply(history,arguments),n()},history.forward=function(){r.apply(history,arguments),n()}}).toString()})()`,"text/html"===document.contentType&&(document.head||document.documentElement).append(e)}isHistoryScriptInjected(){const e=Boolean(document.querySelector(`script[ecommerce-type="${this.scriptAttribute}"]`)),t=Boolean(document.querySelector(`script[src*="${this.scriptPath}"]`));return e||t}}},91049:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InContentMessageManager=void 0;const r=a(42327),n=a(1106),s=a(74990),i=a(97044);class o{constructor(e,t,a,r){this.id=e,this.outMessageManager=t,this.history=a,this.requestsManager=r,chrome.runtime.onMessage.addListener(this.bindListeners.bind(this)),this.history.onUrlChanged(this.onUrlChanged.bind(this)),this.requestsManager.onHttpDataSave(this.onHttpDataSave.bind(this))}onInit(e){const{payload:t}=e,{logging:a,templateVersion:r,config:n,varScope:o}=t;this.config=n,this.logging=a,this.storage=new i.ContentStorage(this.logging),this.extractor=new s.ExtractorManager(r,this.outMessageManager,this.logging,this.storage,this.config.func);try{if(document.body.getAttribute(this.processedFlagAttribute))return}catch(t){return void setTimeout((()=>this.onInit(e)),100)}document.body.setAttribute(this.processedFlagAttribute,"true"),this.storage.initStorage(o),this.initClickHandlers(),this.initLoadHandlers()}onRequestHandle({payload:e}){const{onHttpRequest:t=[],onHttpResponse:a=[]}=e.config;(t.length>0||a.length>0)&&this.requestsManager.injectInterceptors(t,a)}onIframeLoaded({payload:e}){if((0,n.isIframe)())return;const{url:t}=e;this.config?.onIframeLoaded?.forEach((e=>{o.isConfigMatchesUrl(e,t)&&this.extractor?.run?.(e)}))}initLoadHandlers(){(0,n.isIframe)()||this.config?.onLoad?.forEach((e=>this.extractor?.run?.(e)))}initClickHandlers(){document.addEventListener("click",(e=>{const t=(0,n.uuid)();this.config?.onClick?.forEach((a=>{if(e.target.matches(a.selector)){const r={$element:e.target,$event:e,$eventId:t};this.extractor?.run?.(a,r)}}))}),{capture:!0})}onHttpDataSave(e){this.storage.upsert(e.variable,e.payload)}onUrlChanged(e){this.config?.onUrlChanged?.forEach((t=>{o.isConfigMatchesUrl(t,e)&&this.extractor?.run?.(t)}))}bindListeners(e){const t={[r.MessageBgType.INIT]:this.onInit.bind(this),[r.MessageBgType.REQUEST_HANDLE]:this.onRequestHandle.bind(this),[r.MessageBgType.IFRAME_LOADED]:this.onIframeLoaded.bind(this)};t[e.type]?t[e.type](e):this.logging}static isConfigMatchesUrl({regex:e},t){return new RegExp(e,"i").test(t)}get processedFlagAttribute(){return`__processed_${this.id}__`}}t.InContentMessageManager=o},14476:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OutContentMessageManager=void 0;const r=a(46444),n=a(1106);t.OutContentMessageManager=class{constructor(e){this.id=e}trackMessage(e,t,a={},n=!1){const s={id:this.id,type:r.MessageContentType.ECOMMERCE_TRACK,customEvent:n,payload:{templateVersion:t,event:e,clientTs:Date.now(),url:location.href,title:document.title,lang:document.documentElement.lang,data:a}};this.sendMessage(s)}initMessage(){const e={id:this.id,type:r.MessageContentType.ECOMMERCE_INIT,payload:{url:document.location.href,isIframe:(0,n.isIframe)()}};this.sendMessage(e)}sendMessage(e){chrome.runtime.sendMessage(e)}runtimeStorageSaveMessage(e,t){const a={id:this.id,type:r.MessageContentType.ECOMMERCE_RUNTIME_STORAGE_SAVE,payload:{name:e,data:t}};this.sendMessage(a)}}},46444:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageContentType=void 0,function(e){e.ECOMMERCE_INIT="ECOMMERCE_INIT",e.ECOMMERCE_TRACK="ECOMMERCE_TRACK",e.ECOMMERCE_RUNTIME_STORAGE_SAVE="ECOMMERCE_RUNTIME_STORAGE_SAVE"}(t.MessageContentType||(t.MessageContentType={}))},44353:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.RequestsManager=void 0,function(e){e.SAVE_HTTP_DATA="SAVE_HTTP_DATA",e.INIT_HTTP_SCRIPT="INIT_HTTP_SCRIPT"}(a||(a={}));t.RequestsManager=class{constructor(e){this.observer=e,this.scriptAttribute="requests",this.scriptPath="requests.js",this.isInitiated=!1,window.addEventListener("message",(e=>{"SAVE_HTTP_DATA"===e.data._custom_type_&&this.observer.emit(a.SAVE_HTTP_DATA,JSON.parse(JSON.stringify(e.data.payload))),"HTTP_SCRIPT_INITIATED"===e.data._custom_type_&&this.observer.emit(a.INIT_HTTP_SCRIPT)}))}injectInterceptors(e,t=[]){if(this.isInitiated)return;this.injectScript();this.sendHttpConfig((()=>{const a={_custom_type_:"INIT_HTTP_CONFIG",payload:{onHttpRequest:e,onHttpResponse:t}};window.postMessage(a)}))}onHttpDataSave(e){this.observer.subscribe(a.SAVE_HTTP_DATA,e)}sendHttpConfig(e){this.observer.subscribe(a.INIT_HTTP_SCRIPT,e)}injectScript(){if(this.isRequestsScriptInjected())return;const e=document.createElement("script");e.setAttribute("ecommerce-type",this.scriptAttribute);e.innerHTML=`(${(()=>{class e{}class t{}class a extends t{constructor(e,t){super(),this.validator=e,this.communicator=t,this.initInterceptor()}static init(e,t){this.instance||(this.instance=new a(e,t))}async interceptRequest(e,t){const a=t?.method,r=t?.body,n=this.validator.validateRequest(e,a);n&&this.communicator.dispatchEvent({variable:n.var,payload:r})}async interceptResponse(e,[t,a]){const r=a?.method,n=this.validator.validateResponse(t,r);n&&await this.proceedResponse(e,n.var)}async proceedResponse(e,t){const a=await e.clone(),r=e.headers.get("content-type");r&&(r.includes("json")?this.communicator.dispatchEvent({variable:t,payload:await a.json()}):r.includes("text")&&this.communicator.dispatchEvent({variable:t,payload:await a.text()}))}initInterceptor(){const e=window.fetch;window.fetch=async(...t)=>{this.interceptRequest(...t);const a=await e(...t);return this.interceptResponse(a,t),a}}}class r extends t{constructor(e,t){super(),this.validator=e,this.communicator=t,this.initInterceptor()}static init(e,t){this.instance||(this.instance=new r(e,t))}async interceptRequest({method:e,url:t,body:a}){const r=this.validator.validateRequest(t,e);r&&this.communicator.dispatchEvent({variable:r.var,payload:a})}async interceptResponse({status:e,response:t,responseType:a,method:r,url:n}){const s=this.validator.validateResponse(n,r);`${e}`.startsWith("20")&&s&&this.proceedResponse(t,a,s.var)}proceedResponse(e,t,a){if("json"===t)this.communicator.dispatchEvent({variable:a,payload:e});else if("text"===t||""===t)try{this.communicator.dispatchEvent({variable:a,payload:JSON.parse(e)})}catch{this.communicator.dispatchEvent({variable:a,payload:e})}}initInterceptor(){const e=XMLHttpRequest.prototype.open,t=XMLHttpRequest.prototype.send,a=this;window.XMLHttpRequest.prototype.open=function(...t){return this.__METHOD__=t[0],this.__URL__=t[1],this.addEventListener("load",(function({target:e}){a.interceptResponse({status:e.status,response:e.response,responseType:e.responseType,method:t[0],url:t[1]})})),e.apply(this,t)},window.XMLHttpRequest.prototype.send=function(...e){return a.interceptRequest({method:this.__METHOD__,url:this.__URL__,body:e[0]}),t.apply(this,e)}}}const n=new class{constructor(){this.dispatchInitEvent()}dispatchEvent(e){const t={_custom_type_:"SAVE_HTTP_DATA",payload:e};window.postMessage(t)}dispatchInitEvent(){window.postMessage({_custom_type_:"HTTP_SCRIPT_INITIATED"})}},s=new class extends e{validateRequest(e,t="GET"){return!!this.onHttpRequest?.length&&(this.onHttpRequest.find(this.httpMatherPredicate(e,t))??!1)}validateResponse(e,t="GET"){return!!this.onHttpResponse?.length&&(this.onHttpResponse.find(this.httpMatherPredicate(e,t))??!1)}setConfig(e,t){this.onHttpRequest=e,this.onHttpResponse=t}httpMatherPredicate(e,t){return({regex:a,methods:r})=>{const n=new RegExp(a,"i");return r.includes(t)&&n.test(e)}}};a.init(s,n),r.init(s,n),window.addEventListener("message",(e=>{if("INIT_HTTP_CONFIG"!==e.data?._custom_type_)return;const{onHttpRequest:t,onHttpResponse:a}=e.data.payload;s.setConfig(t,a)}))}).toString()})()`,"text/html"===document.contentType&&(document.head||document.documentElement).append(e),this.isInitiated=!0}isRequestsScriptInjected(){const e=Boolean(document.querySelector(`script[ecommerce-type="${this.scriptAttribute}"]`)),t=Boolean(document.querySelector(`script[src*="${this.scriptPath}"]`));return e||t}}},97044:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentStorage=void 0;t.ContentStorage=class{constructor(e){this.logging=e,this.runtimeStorage=new Map}initStorage(e){this.runtimeStorage=new Map(Object.entries(e))}save(e,t){this.logging,this.runtimeStorage.set(e,t)}getStorage(){return Object.fromEntries(this.runtimeStorage)}getItem(e){return this.runtimeStorage.get(e)}upsert(e,t){const a=this.runtimeStorage.has(e)?[...this.getItem(e),t]:[t];this.logging,this.runtimeStorage.set(e,a)}}},40233:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Extractor=void 0;const r=a(74322),n=a(25183),s=a(98392);t.Extractor=class{constructor(e,t,a,n,s){this.config=e,this.program=t,this.elScope=a,this.varScope=n,this.funcs=s,this.observer=new r.Observer}async run(){const e=(new n.ProgramFactory).create(this.config,this.observer,this.elScope,this.varScope,this.funcs);for(const t of this.program){const a=await e.handle(t);if((0,s.isFailed)(a,t))return!1;if(a.return)return a.value.value}return{}}on(e,t){this.observer.subscribe(e,t)}}},93176:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FlowList=t.SINGLE_GET_TYPE=t.OperationType=void 0,function(e){e.SINGLE="single",e.PLURAL="plural",e.SPLIT_SCOPE="splitScope",e.OR="or",e.AND="and",e.COMPUTED="computed",e.EXIST="exist",e.LOG="log",e.IS_NOT_HIDDEN_ELEMENT="isNotHiddenElement",e.MARK_PROCESSED_ELEMENT="markProcessedElement",e.WAIT_FOR_NOT_PROCESSED_ELEMENT="waitForNotProcessedElement",e.WAIT_FOR_URL_CHANGED="waitForUrlChanged",e.FUNC="func",e.SELECT="select",e.CALL_METHOD="callMethod",e.GET_PROPERTY="property",e.LITERAL="literal",e.VAR="var",e.FOR_EACH="forEach",e.RETURN="return",e.MAP="map",e.MERGE="merge",e.CLOSEST="closest",e.PRICE_PARSER="priceParser",e.JSON_PARSER="jsonParser",e.HTML_COLLECTOR="htmlCollector",e.EMIT="emit",e.FLOW="flow",e.CONDITION="condition",e.REPLACE="replace",e.REPLACE_BETWEEN="replaceBetween",e.MATH="math",e.GLOBAL_VAR="globalVar"}(t.OperationType||(t.OperationType={})),function(e){e.TEXT="text",e.VALUE="value",e.ATTRIBUTE="attribute"}(t.SINGLE_GET_TYPE||(t.SINGLE_GET_TYPE={})),function(e){e.NONE="none",e.THEN="then",e.ELSE="else"}(t.FlowList||(t.FlowList={}))},74322:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Observer=void 0;t.Observer=class{constructor(){this.listeners={}}emit(e,t){this.listeners[e]&&this.listeners[e].forEach((e=>e(t)))}subscribe(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}}},5606:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseHandler=void 0;t.BaseHandler=class{constructor(e,t,a,r){this.main=e,this.observer=t,this.factory=a,this.logger=r}}},60108:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlCollector=void 0;const r=a(93176),n=a(98392);t.HtmlCollector=class{constructor(e,t,a,r){this.main=e,this.observer=t,this.factory=a,this.logger=r}type(){return r.OperationType.HTML_COLLECTOR}async handle({selector:e}){const t=this.main.getElScopeRef();try{const a=t.querySelector(e);if(!a)return await(0,n.failed)();const r=JSON.stringify(a.outerHTML);return await(0,n.succeeded)(r)}catch(e){return this.logger.error("HtmlCollector: ",e),await(0,n.failed)()}}}},40164:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Computed=void 0;const r=a(93176),n=a(98392);t.Computed=class{constructor(e){this.main=e}type(){return r.OperationType.COMPUTED}async handle(e){const t=[];for(const a of e.subjects){const e=(await this.main.handle(a)).value.value;t.push(e)}let a;if(Array.isArray(e.value)){a=[];for(const t of e.value)a.push((await this.main.handle(t)).value.value)}else a=(await this.main.handle(e.value)).value.value;const s={var:t.join("."),type:r.OperationType.LITERAL,value:a,accumulate:e.accumulate};return await this.main.handle(s),await(0,n.succeeded)(a)}}},27578:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Closest=void 0;const r=a(93176),n=a(98392);t.Closest=class{constructor(e){this.main=e}type(){return r.OperationType.CLOSEST}async handle(e){const t=await this.main.handle(e.subject);if(!t.success)return await(0,n.failed)();const a=t.value.value,r=await this.main.handle(e.selector);if(!r.success)return await(0,n.failed)();const s=a.closest(r.value.value);return await(0,n.succeeded)(s)}}},425:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExistElement=void 0;const r=a(93176),n=a(98392);t.ExistElement=class{constructor(e,t,a,r){this.main=e,this.observer=t,this.factory=a,this.logger=r}type(){return r.OperationType.EXIST}async handle(e){const t=this.main.getElScopeRef();try{for(const a of e.selectors){if(t.querySelector(a))return await(0,n.succeeded)(!0)}}catch(e){return this.logger.error(e),await(0,n.failed)()}return await(0,n.failed)(!1)}}},63073:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalVar=void 0;const r=a(93176),n=a(98392);t.GlobalVar=class{type(){return r.OperationType.GLOBAL_VAR}async handle(e){const t=window||globalThis;return t&&null!=t[e.value]?await(0,n.succeeded)(t[e.value]):await(0,n.failed)()}}},58876:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IsNotHiddenElement=void 0;const r=a(93176),n=a(98392);t.IsNotHiddenElement=class{constructor(e,t,a,r){this.main=e,this.observer=t,this.factory=a,this.logger=r}type(){return r.OperationType.IS_NOT_HIDDEN_ELEMENT}async handle(e){const t=this.main.getElScopeRef();for(const a of e.selectors){let e;try{e=t.querySelector(a)}catch(e){this.logger.error("IsNotHiddenElement:",e);continue}if(!e)continue;if(!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length))return await(0,n.succeeded)(!0)}return await(0,n.failed)(!1)}}},30819:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Select=void 0;const r=a(93176),n=a(98392);t.Select=class{constructor(e){this.main=e}type(){return r.OperationType.SELECT}async handle(e){const t=this.main.getElScopeRef(),a=await this.main.handle(e.selector);if(!a.success)return await(0,n.failed)();const r=t.querySelector(a.value.value);return await(0,n.succeeded)(r)}}},64491:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Emit=void 0;const r=a(98392),n=a(93176);t.Emit=class{constructor(e,t,a){this.main=e,this.observer=t,this.factory=a}type(){return n.OperationType.EMIT}async handle(e){const t=await this.main.handle(e.event);if((0,r.isFailed)(t,e.event))return await(0,r.failed)();if("string"!=typeof t.value.value)return await(0,r.failed)();const a=await(0,r.succeeded)([]);if(null!=e.args&&Array.isArray(e.args)){const t=this.factory.prototype(this.main);for(const t of e.args){const e=await this.main.handle(t);if((0,r.isFailed)(e,t))return await(0,r.failed)();const n="object"==typeof e.value.value?(0,r.clone)(e.value.value):e.value.value;a.value.value.push(n)}this.main.mergeVarScope(t.getVarScopeRef())}return this.observer.emit(t.value.value,a?a.value.value:void 0),await(0,r.succeeded)(!0)}}},63778:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Func=void 0;const r=a(93176),n=a(98392);t.Func=class{constructor(e,t,a){this.main=e,this.observer=t,this.factory=a}type(){return r.OperationType.FUNC}async handle(e){const t=await this.main.handle(e.name);if(!t.success)return await(0,n.failed)();const a=t.value.value;if("string"!=typeof a)return await(0,n.failed)();const s=this.main.getFuncsRef();if(!s[a])return await(0,n.failed)();const i=s[a],o={},c=null!=e.args?e.args:[];for(let e=0;e<c.length;e++){const t=await this.main.handle(c[e]);if(!t.success)return await(0,n.failed)();if(i.params[e]){o[i.params[e]]=t.value.value}}const l=this.factory.create(this.main.getConfig(),this.main.getObserver(),this.main.getElScopeRef(),o,s);for(const e of i.operations){const t=await l.handle(e);if((0,n.isFailed)(t,e))return await(0,n.failed)(void 0);if(e.type===r.OperationType.RETURN)return await(0,n.succeeded)(t.value.value)}return await(0,n.succeeded)(void 0)}}},24224:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Literal=void 0;const r=a(98392),n=a(93176);t.Literal=class{type(){return n.OperationType.LITERAL}async handle(e){return await(0,r.succeeded)(e.value)}}},69767:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Log=void 0;const r=a(93176),n=a(98392);t.Log=class{constructor(e){this.main=e}type(){return r.OperationType.LOG}async handle(e){if(!this.main.getConfig().log)return await(0,n.succeeded)(!0);let t=e.msg;const a=this.main.getVarScopeRef();if(Object.keys(a).forEach((e=>{t=t.replace(`$${e}`,a[e])})),e.args&&Array.isArray(e.args)){const t={};Object.values(e.args).forEach((e=>{t[e]=a[e]}))}return await(0,n.succeeded)(!0)}}},18028:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.And=void 0;const r=a(98392),n=a(93176);t.And=class{constructor(e,t,a){this.main=e,this.observer=t,this.factory=a}type(){return n.OperationType.AND}async handle(e){const t=this.factory.prototype(this.main);for(const a of e.operations){const e=await t.handle(a);if(!e.success||!e.value.value)return await(0,r.failed)(!1)}return this.main.mergeVarScope(t.getVarScopeRef()),await(0,r.succeeded)(!0)}}},90010:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Condition=void 0;const r=a(93176),n=a(98392);t.Condition=class{constructor(e,t,a){this.main=e,this.observer=t,this.factory=a}type(){return r.OperationType.CONDITION}async handle(e){const t=this.factory.prototype(this.main),a=await t.handle(e.left);if(!a.success)return await(0,n.failed)(!1);const r=await t.handle(e.right);if(!r.success)return await(0,n.failed)(!1);const s={"!=":()=>a.value.value!=r.value.value,"!==":()=>a.value.value!==r.value.value,">":()=>a.value.value>r.value.value,"<":()=>a.value.value<r.value.value,"<=":()=>a.value.value<=r.value.value,">=":()=>a.value.value>=r.value.value,"==":()=>a.value.value==r.value.value,"===":()=>a.value.value===r.value.value};if(!s[e.operator])throw new Error('Unsupportable "cond operator"');return s[e.operator]()?(this.main.mergeVarScope(t.getVarScopeRef()),await(0,n.succeeded)(!0)):await(0,n.failed)(!1)}}},42205:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Flow=void 0;const r=a(93176),n=a(98392);t.Flow=class{constructor(e,t,a){this.main=e,this.observer=t,this.factory=a}type(){return r.OperationType.FLOW}async handle(e){const t={condition:!0,flow:{name:r.FlowList.NONE,result:!0}},a=this.factory.prototype(this.main),s=this.factory.prototype(this.main);for(const a of e.condition){const e=await s.handle(a);if(!e.success||!e.value.value){t.condition=!1;break}}t.condition&&a.mergeVarScope(s.getVarScopeRef());const i=t.condition?r.FlowList.THEN:r.FlowList.ELSE;if(i===r.FlowList.ELSE&&void 0===e[i])return await(0,n.failed)(t);if(void 0!==e[i]){t.flow.name=i;const r=this.mapFlowBlockToFullFormat(e[i]),s=this.factory.prototype(a);for(const e of r.operations){let a=!1;try{const t=await s.handle(e);a=(0,n.isFailed)(t,e)}catch(e){a=!0}if(a)return t.flow.result=!1,r.optional?await(0,n.succeeded)(t):await(0,n.failed)(t)}a.mergeVarScope(s.getVarScopeRef())}return this.main.mergeVarScope(a.getVarScopeRef()),await(0,n.succeeded)(t)}mapFlowBlockToFullFormat(e){if(Array.isArray(e))return{optional:!1,operations:e};if("object"==typeof e)return e;throw new Error("Could not map a block to FlowBlockToFullFormat")}}},47607:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Or=void 0;const r=a(98392),n=a(93176);t.Or=class{constructor(e,t,a){this.main=e,this.observer=t,this.factory=a}type(){return n.OperationType.OR}async handle(e){for(const t of e.operations){const e=this.factory.prototype(this.main),a=await e.handle(t);if(a.success&&a.value.value)return this.main.mergeVarScope(e.getVarScopeRef()),await(0,r.succeeded)(!0)}return await(0,r.failed)(!1)}}},31995:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ForEach=void 0;const r=a(93176),n=a(98392);t.ForEach=class{constructor(e,t,a){this.main=e,this.observer=t,this.factory=a}type(){return r.OperationType.FOR_EACH}async handle(e){const t=await this.main.handle(e.subject);if(!t.success)return await(0,n.failed)(!1);const a=t.value.value,s=this.factory.prototype(this.main);for(let t=0;t<a.length;t++){const i={type:r.OperationType.LITERAL,var:e.index??"$index",value:t},o={type:r.OperationType.LITERAL,var:e.item??"$item",value:a[t]};await s.handle(i),await s.handle(o);for(const t of e.forEach){const e=await s.handle(t);if((0,n.isFailed)(e,t))return await(0,n.failed)()}}return this.main.mergeVarScope(s.getVarScopeRef()),await(0,n.succeeded)(!0)}}},20480:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Map=void 0;const r=a(93176),n=a(98392);t.Map=class{constructor(e){this.main=e}type(){return r.OperationType.MAP}async handle(e){const t=(await this.main.handle(e.subject)).value.value,a=(await this.main.handle(e.dictionary)).value.value;let r=!1===e.trim?t:t.trim();const s=void 0===e.caseSensitive||!e.caseSensitive;r=s?r.toLowerCase():r;for(const e of a){if((s?e.key.map((e=>e.toLowerCase())):e.key).includes(r))return await(0,n.succeeded)(e.value)}return await(0,n.failed)()}}},70302:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MathAction=void 0;const r=a(93176),n=a(98392);t.MathAction=class{constructor(e,t,a){this.main=e,this.observer=t,this.factory=a}type(){return r.OperationType.MATH}async handle(e){const t=this.factory.prototype(this.main),a=await t.handle(e.left),r=await t.handle(e.right);if(!a.success||!r.success)return await(0,n.failed)();const s=Number(a.value.value),i=Number(r.value.value);if(Number.isNaN(s)||Number.isNaN(i))return await(0,n.failed)();const o=this.mathHandlers[e.sign];if(!o)throw new Error('Unsupportable "math sign"');const c=o(s,i);return Number.isNaN(c)?await(0,n.failed)():await(0,n.succeeded)(c)}get mathHandlers(){return{"+":(e,t)=>e+t,"-":(e,t)=>e-t,"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t}}}},43914:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallMethod=void 0;const r=a(93176),n=a(98392);t.CallMethod=class{constructor(e){this.main=e}type(){return r.OperationType.CALL_METHOD}async handle(e){const t=(await this.main.handle(e.subject)).value.value,a=[];for(const t of e.args){const e=await this.main.handle(t);a.push(e.value.value)}const r=t[e.method].apply(t,a);return await(0,n.succeeded)(r)}}},49442:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GetProperty=void 0;const r=a(93176),n=a(98392);t.GetProperty=class{constructor(e){this.main=e}type(){return r.OperationType.GET_PROPERTY}async handle(e){const t=(await this.main.handle(e.subject)).value.value;if("object"!=typeof t||null===t)return{success:!1,value:{type:r.OperationType.LITERAL,value:void 0}};const a=t[(await this.main.handle(e.prop)).value.value];return await(0,n.succeeded)(a)}}},28163:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Merge=void 0;const r=a(93176);t.Merge=class{constructor(e){this.main=e}type(){return r.OperationType.MERGE}async handle(e){const t=await this.main.handle(e.subject),a=await this.main.handle(e.value);return{success:!0,value:{type:r.OperationType.LITERAL,value:Object.assign(t.value,a.value)}}}}},82232:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JsonParser=void 0;const r=a(93176),n=a(98392);t.JsonParser=class{constructor(e){this.main=e}type(){return r.OperationType.JSON_PARSER}async handle(e){const t=(await this.main.handle(e.value)).value.value,a=JSON.parse(t);return await(0,n.succeeded)(a)}}},7330:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PriceParser=void 0;const r=a(93176),n=a(98392),s={$:{name:"U.S. Dollar",currency:"USD"},US$:{name:"U.S. Dollar",currency:"USD"},USD:{name:"U.S. Dollar",currency:"USD"},AED:{name:"Arab Emirates Dirham",currency:"AED"},ARS:{name:"Argentine Peso",currency:"ARS"},AMD:{name:"Armenian Dram",currency:"AMD"},AWG:{name:"Aruban Florin",currency:"AWG"},A$:{name:"Australian Dollar",currency:"AUD"},AU$:{name:"Australian Dollar",currency:"AUD"},AUD:{name:"Australian Dollar",currency:"AUD"},AZN:{name:"Azerbaijan New Manat",currency:"AZN"},BSD:{name:"Bahamas Dollar",currency:"BSD"},BZD:{name:"Belize Dollar",currency:"BZD"},BOB:{name:"Bolivian Boliviano",currency:"BOB"},R$:{name:"Brazilian Real",currency:"BRL"},BRL:{name:"Brazilian Real",currency:"BRL"},BND:{name:"Bruneian Dollar",currency:"BND"},BGN:{name:"Bulgaria Lev",currency:"BGN"},KHR:{name:"Cambodian Riel",currency:"KHR"},KYD:{name:"Caymanian Dollar",currency:"KYD"},KYD$:{name:"Caymanian Dollar",currency:"KYD"},CI$:{name:"Caymanian Dollar",currency:"KYD"},CLP:{name:"Chilean Peso",currency:"CLP"},"CN¥":{name:"Chinese Yuan Renminbi",currency:"CNY"},CNY:{name:"Chinese Yuan Renminbi",currency:"CNY"},COP:{name:" Colombian Peso",currency:"COP"},CRC:{name:"Costa Rican Colon",currency:"CRC"},DOP:{name:"Dominican Republic Peso",currency:"DOP"},EC$:{name:"East Caribbean Dollar",currency:"XCD"},XCD:{name:"East Caribbean Dollar",currency:"XCD"},EGP:{name:"Egyptian Pound",currency:"EGP"},"€":{name:"Euro",currency:"EUR"},EUR:{name:"Euro",currency:"EUR"},GHS:{name:"Ghanaian Cedi",currency:"GHS"},GTQ:{name:"Guatemalan Quetzal",currency:"GTQ"},HNL:{name:"Honduran Lempira",currency:"HNL"},HK$:{name:"Honduran Lempira",currency:"HKD"},HKD:{name:"Honduran Lempira",currency:"HKD"},HUF:{name:"Hungarian Forint",currency:"HUF"},"₹":{name:"Indian Rupee",currency:"INR"},INR:{name:"Indian Rupee",currency:"INR"},IDR:{name:"Indonesian Rupiah",currency:"IDR"},"₪":{name:"Israeli Shekel",currency:"ILS"},ILS:{name:"Israeli Shekel",currency:"ILS"},JMD:{name:"Jamaican Dollar",currency:"JMD"},"¥":{name:"Japanese Yen",currency:"JPY"},JPY:{name:"Japanese Yen",currency:"JPY"},"JP¥":{name:"Japanese Yen",currency:"JPY"},"￥":{name:"Japanese Yen",currency:"JPY"},KZT:{name:"Kazakhstan Tenge",currency:"KZT"},KES:{name:"Kenyan Shilling",currency:"KES"},LBP:{name:"Lebanese Pound",currency:"LBP"},MOP:{name:"Macanese Pataca",currency:"MOP"},MOP$:{name:"Macanese Pataca",currency:"MOP"},MYR:{name:"Malaysian Ringgit",currency:"MYR"},MUR:{name:"Mauritian Rupee",currency:"MUR"},MX$:{name:"Mexico Peso",currency:"MXN"},MXN:{name:"Mexico Peso",currency:"MXN"},MNT:{name:"Mongolian Tugrik",currency:"MNT"},MAD:{name:"Moroccan Dirham",currency:"MAD"},NAD:{name:"Namibia Dollar",currency:"NAD"},NZ$:{name:"New Zealand Dollar",currency:"NZD"},NZD:{name:"New Zealand Dollar",currency:"NZD"},NGN:{name:"Nigerian Naira",currency:"NGN"},NOK:{name:"Norwegian Krone",currency:"NOK"},PAB:{name:"Panamanian Balboa",currency:"PAB"},PYG:{name:"Paraguayan Guarani",currency:"PYG"},PEN:{name:"Peruvian Sol",currency:"PEN"},PHP:{name:"Philippine Peso",currency:"PHP"},"£":{name:"Pounds",currency:"GBP"},GBP:{name:"Pounds",currency:"GBP"},QAR:{name:"Qatari Riyal",currency:"QAR"},RUB:{name:"Russian Ruble",currency:"RUB"},SAR:{name:"Saudi Arabian Riyal",currency:"SAR"},SGD:{name:"Singapore Dollar",currency:"SGD"},ZAR:{name:"South African Rand",currency:"ZAR"},"₩":{name:"South Korean Won",currency:"KRW"},KRW:{name:"South Korean Won",currency:"KRW"},NT$:{name:"Taiwan New Dollar",currency:"TWD"},TWD:{name:"Taiwan New Dollar",currency:"TWD"},TZS:{name:"Tanzania Shilling",currency:"TZS"},THB:{name:"Thai Baht",currency:"THB"},TTD:{name:"Trinidadian Dollar",currency:"TTD"},TRY:{name:"Turkish Lira",currency:"TRY"},UYU:{name:"Uruguayan Peso",currency:"TRY"},"֏":{name:"Armenian Dram",currency:"AMD"},"₼":{name:"Azerbaijani Manat",currency:"AZN"},BAM:{name:"Bosnia and Herzegovina Convertible Mark",currency:"BAM"},KM:{name:"Bosnia and Herzegovina Convertible Mark",currency:"BAM"},лв:{name:"Bulgarian lev",currency:"BGN"},BHD:{name:"Bahraini Dinar",currency:"BHD"},"ب.د":{name:"Bahraini Dinar",currency:"BHD"},BD:{name:"Bahraini Dinar",currency:"BHD"},B$:{name:"Brunei Dollar",currency:"BND"},BYN:{name:"Belarusian Ruble",currency:"BYN"},Br:{name:"Belarusian Ruble",currency:"BYN"},CAD:{name:"Canadian Dollar",currency:"CAD"},C$:{name:"Canadian Dollar",currency:"CAD"},CA$:{name:"Canadian Dollar",currency:"CAD"},CHF:{name:"Swiss Franc",currency:"CHF"},Fr:{name:"Swiss Franc",currency:"CHF"},Col$:{name:" Colombian Peso",currency:"COP"},CZK:{name:"Czech Koruna",currency:"CZK"},Kč:{name:"Czech Koruna",currency:"CZK"},DJF:{name:"Djiboutian Franc",currency:"DJF"},Fdj:{name:"Djiboutian Franc",currency:"DJF"},DKK:{name:"Danish Krone",currency:"DKK"},kr:{name:"Swedish Krona",currency:"SEK"},DZD:{name:"Algerian Dinar ",currency:"DZD"},دج:{name:"Algerian Dinar ",currency:"DZD"},DA:{name:"Algerian Dinar ",currency:"DZD"},GEL:{name:"Georgian Lari",currency:"GEL"},ლ:{name:"Georgian Lari",currency:"GEL"},"GH₵":{name:"Ghanaian Cedi ",currency:"GHS"},GNF:{name:"Guinean Franc",currency:"GNF"},FG:{name:"Guinean Franc",currency:"GNF"},Ft:{name:"Hungarian Forint",currency:"HUF"},Rp:{name:"Indonesian Rupiah",currency:"IDR"},ISK:{name:"Icelandic Króna",currency:"ISK"},Íkr:{name:"Icelandic Króna",currency:"ISK"},JOD:{name:"Jordanian Dinar ",currency:"JOD"},JD:{name:"Jordanian Dinar ",currency:"JOD"},KGS:{name:"Kyrgyzstani Som",currency:"KGS"},с:{name:"Kyrgyzstani Som",currency:"KGS"},"៛":{name:"Cambodian Riel",currency:"KHR"},KWD:{name:"Kuwaiti Dinar",currency:"KWD"},"K.D.":{name:"Kuwaiti Dinar",currency:"KWD"},"₸":{name:"Kazakhstani Tenge",currency:"KZT"},LVL:{name:"Latvian Lats",currency:"LVL"},Ls:{name:"Latvian Lats",currency:"LVL"},DH:{name:"Moroccan Dirham",currency:"MAD"},MDL:{name:"Moldovan Leu ",currency:"MDL"},L:{name:"Romanian Leu",currency:"RON"},MKD:{name:"Macedonian Denar",currency:"MKD"},ден:{name:"Macedonian Denar",currency:"MKD"},MVR:{name:"Maldivian Rufiyaa",currency:"MVR"},ރ:{name:"Maldivian Rufiyaa",currency:"MVR"},MWK:{name:"Malawian Kwacha",currency:"MWK"},MK:{name:"Malawian Kwacha",currency:"MWK"},Mex$:{name:"Mexican Peso",currency:"MXN"},RM:{name:"Malaysian Ringgit",currency:"MYR"},N:{name:"Nigerian Naira",currency:"NGN"},"₦":{name:"Nigerian Naira",currency:"NGN"},NPR:{name:"Nepalese Rupee ",currency:"NPR"},रू:{name:"Nepalese Rupee ",currency:"NPR"},OMR:{name:"Omani Rial",currency:"OMR"},"S/":{name:"Peruvian Nuevo Sol",currency:"PEN"},"₱":{name:"Philippine Peso",currency:"PHP"},PKR:{name:"Pakistani Rupee",currency:"PKR"},"₨":{name:"Pakistani Rupee",currency:"PKR"},PLN:{name:"Polish Zloty",currency:"PLN"},zł:{name:"Polish Zloty",currency:"PLN"},QR:{name:"Qatari Riyal",currency:"QAR"},RON:{name:"Romanian Leu",currency:"RON"},lei:{name:"Romanian Leu",currency:"RON"},RSD:{name:"Serbian Dinar ",currency:"RSD"},РСД:{name:"Serbian Dinar ",currency:"RSD"},"₽":{name:"Russian Ruble",currency:"RUB"},RWF:{name:"Rwandan Franc",currency:"RWF"},FRw:{name:"Rwandan Franc",currency:"RWF"},"ر.س":{name:"Saudi Riyal",currency:"SAR"},SEK:{name:"Swedish Krona",currency:"SEK"},SG$:{name:"Singapore Dollar",currency:"SGD"},STN:{name:"Sao Tome and Principe Dobra",currency:"STN"},Db:{name:"Sao Tome and Principe Dobra",currency:"STN"},SZL:{name:"Swazi Lilangeni",currency:"SZL"},E:{name:"Swazi Lilangeni",currency:"SZL"},"฿":{name:"Thai Baht",currency:"THB"},TOP:{name:"Tongan Paʻanga",currency:"TOP"},T$:{name:"Tongan Paʻanga",currency:"TOP"},TL:{name:"Turkish Lira",currency:"TRY"},"₺":{name:"Turkish Lira",currency:"TRY"},UAH:{name:"Ukrainian Hryvnia",currency:"UAH"},"₴":{name:"Ukrainian Hryvnia",currency:"UAH"},UGX:{name:"Ugandan Shilling",currency:"UGX"},USh:{name:"Ugandan Shilling",currency:"UGX"},UZS:{name:"Uzbekistan Som",currency:"UZS"},soʻm:{name:"Uzbekistan Som",currency:"UZS"},VEF:{name:"Venezuelan Bolívar Fuerte",currency:"VEF"},"Bs.F.":{name:"Venezuelan Bolívar Fuerte",currency:"VEF"},vef:{name:"Venezuelan Bolívar Fuerte",currency:"VEF"},VND:{name:"Vietnamese Dong",currency:"VND"},"₫":{name:"Vietnamese Dong",currency:"VND"},XAF:{name:"Central African CFA Franc",currency:"XAF"},"F.CFA":{name:"Central African CFA Franc",currency:"XAF"},CFA:{name:"Central African CFA Franc",currency:"XAF"},YER:{name:"Yemeni Rial",currency:"YER"},"﷼":{name:"Yemeni Rial",currency:"YER"},R:{name:"South African Rand",currency:"ZAR"}};Object.freeze(s);t.PriceParser=class{constructor(e){this.main=e}type(){return r.OperationType.PRICE_PARSER}async handle(e){const t=[",","."];let a,r="",i=0;const o=(await this.main.handle(e.price)).value.value;if("string"!=typeof o)return await(0,n.failed)();const c=o.trim().split(" ").join(""),l=o.includes("-"),u=o.includes("."),d=l?c.replace("-",""):c;if(0===d.length)return await(0,n.failed)();for(let e=0;e<d.length;e++){const n=d[e];t.includes(n)?r+=".":Number.isNaN(+n)?(void 0===a&&(a=e),i+=1):r+=n}const h=d.substring(a,a+i).trim(),p=s.hasOwnProperty(h)?s[h].currency:null,y=r.split(".");if(y.length>1)if(u){const e=y.pop();r=`${y.join("")}.${e}`}else r=`${y.join("")}`;const m=parseFloat(r);if(Number.isNaN(m))return await(0,n.failed)();const v={price:e.modulus?Math.abs(m):l?-m:m,currency:p};return await(0,n.succeeded)(v)}}},49214:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Program=void 0;const r=a(93176),n=a(98392),s=a(93032);t.Program=class{constructor(e,t,a,r,n,i,o){this.config=e,this.observer=t,this.elScope=a,this.varScope=r,this.funcs=n,this.operations={};const c=new s.MyLogger(this.config);Object.values(o).forEach((e=>{const a=new e(this,t,i,c);this.operations[a.type()]=a}))}async handle(e){if(!this.operations[e?.type])throw new Error(`Unsupportable operation type "${e?.type}"`);const t=this.getVarScopeRef();try{e.debug;const a=this.operations[e.type],r=await a.handle(e);let n=!1;if(e.accumulate){const t=this.operations[e.accumulate.type];n=(await t.handle(e.accumulate)).value.value}if(e.var){const a=e.var.split(".");let s=t;for(let e=0;e<a.length-1;e++)s.hasOwnProperty(a[e])||(s[a[e]]={}),s=s[a[e]];const i=a[a.length-1];if(n){const e=null!=s[i],t=[s[i],r.value.value],a=[r.value.value];s[i]=Array.isArray(s[i])?[...s[i],r.value.value]:e?t:a}else s[i]=r.value.value}return r}catch(e){return{success:!1,value:{type:r.OperationType.LITERAL,value:void 0}}}}getConfig(){return this.config}getElScopeRef(){return this.elScope}getVarScopeRef(){return this.varScope}cloneVarScope(){return(0,n.clone)(this.getVarScopeRef())}mergeVarScope(e){return Object.assign(this.getVarScopeRef(),e),this.getVarScopeRef()}getFuncsRef(){return this.funcs}getObserver(){return this.observer}}},91497:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReturnOperationHandler=void 0;const r=a(93176);t.ReturnOperationHandler=class{constructor(e,t,a){this.main=e,this.observer=t,this.factory=a}type(){return r.OperationType.RETURN}async handle(e){const t=await this.main.handle(e.value);return{success:!0,return:!0,value:{type:r.OperationType.LITERAL,value:t.value.value}}}}},291:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getter=void 0;const r=a(93176);t.getter=function(e,t){const a={[r.SINGLE_GET_TYPE.TEXT]:()=>{const e=t;return(e.innerText||e.textContent).trim()},[r.SINGLE_GET_TYPE.VALUE]:()=>t.value,[r.SINGLE_GET_TYPE.ATTRIBUTE]:()=>t.getAttribute(e.attr)};return a[e.get]?a[e.get]():a[r.SINGLE_GET_TYPE.TEXT]()}},19008:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Plural=void 0;const r=a(5606),n=a(93176),s=a(68253),i=a(71979),o=a(98392),c=a(291);class l extends r.BaseHandler{constructor(e,t,a,r){super(e,t,a,r),this.main=e,this.observer=t,this.factory=a,this.logger=r,this.elementSolver=new s.HtmlElementSolver(e,r),this.selectorsSolver=new i.SelectorsSolver(e,r)}type(){return n.OperationType.PLURAL}async handle(e){let t=this.main.getElScopeRef();if(null!=e.scope){const a=await this.elementSolver.solve(e.scope);if(!a.success)return await(0,o.failed)();t=a.value.value}const a=await this.selectorsSolver.solve(e.selectors);if(!a.success)return await(0,o.failed)();const r=a.value.value;for(const a of r){let r;try{if(r=t.querySelectorAll(a),0===r.length)continue}catch(e){return this.logger.error(e),await(0,o.failed)()}const n=[];return r.forEach((t=>n.push((0,c.getter)(e,t)))),await(0,o.succeeded)(n)}return await(0,o.failed)()}}t.Plural=l},72813:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Single=void 0;const r=a(5606),n=a(68253),s=a(71979),i=a(98392),o=a(291),c=a(93176);class l extends r.BaseHandler{constructor(e,t,a,r){super(e,t,a,r),this.main=e,this.observer=t,this.factory=a,this.logger=r,this.elementSolver=new n.HtmlElementSolver(e,r),this.selectorsSolver=new s.SelectorsSolver(e,r)}type(){return c.OperationType.SINGLE}async handle(e){let t=this.main.getElScopeRef();if(null!=e.scope){const a=await this.elementSolver.solve(e.scope);if(!a.success)return await(0,i.failed)();t=a.value.value}const a=await this.selectorsSolver.solve(e.selectors);if(!a.success)return await(0,i.failed)();const r=a.value.value;try{for(const a of r){const r=t.querySelector(a);if(!r)continue;const n=(0,o.getter)(e,r);return await(0,i.succeeded)(n)}}catch(e){return this.logger.error(e),await(0,i.failed)()}return await(0,i.failed)()}}t.Single=l},95190:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SplitScope=void 0;const r=a(93176),n=a(71979),s=a(98392);t.SplitScope=class{constructor(e,t,a,r){this.main=e,this.observer=t,this.factory=a,this.logger=r,this.selectorsSolver=new n.SelectorsSolver(e,r)}type(){return r.OperationType.SPLIT_SCOPE}async handle(e){const t=this.main.getElScopeRef(),a=await this.selectorsSolver.solve(e.selectors);if(!a.success)return await(0,s.failed)();const n=a.value.value;for(const a of n){const n=t.querySelectorAll(a);if(0===n.length)continue;const i=[];for(const t of n){const a={};let n=!0;const s=this.factory.create(this.main.getConfig(),this.main.getObserver(),t,a,this.main.getFuncsRef());for(const i of e.operations){const e={var:"$scope",type:r.OperationType.LITERAL,value:t};await s.handle(e);try{if(!(await s.handle(i)).success&&!i.optional){n=!1;break}}catch(e){if(!i.optional){n=!1;break}}delete a.$scope}n&&i.push(a)}return await(0,s.succeeded)(i)}return await(0,s.failed)()}}},32950:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Replace=void 0;const r=a(93176),n=a(98392);t.Replace=class{constructor(e,t,a){this.main=e,this.observer=t,this.factory=a}type(){return r.OperationType.REPLACE}async handle(e){const t=this.factory.prototype(this.main),a=await t.handle(e.subject),r=await t.handle(e.needle),s=await t.handle(e.replacement),i=e.mode?e.mode:"first",o={first:(e,t)=>e.replace(t,s.value.value),all:(e,t)=>e.replace(new RegExp(t,"g"),s.value.value)};if(!o[i])throw new Error("Unsupportable replacement mode");let c=a.value.value;return(Array.isArray(r.value.value)?r.value.value:[r.value.value]).forEach((e=>{c=o[i](c,e)})),this.main.mergeVarScope(t.getVarScopeRef()),await(0,n.succeeded)(c)}}},6519:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReplaceBetween=void 0;const r=a(93176),n=a(98392);t.ReplaceBetween=class{constructor(e,t,a){this.main=e,this.observer=t,this.factory=a}type(){return r.OperationType.REPLACE_BETWEEN}async handle(e){const t=this.factory.prototype(this.main),a=await t.handle(e.subject),r=await t.handle(e.start),s=await t.handle(e.end),i=await t.handle(e.replacement),o=((e,t,a,r)=>{const n=e.indexOf(a);if(-1===n)return e;const s=e.lastIndexOf(r);if(-1===s)return e;return e.substring(0,n)+t+e.substring(s+r.length)})(a.value.value,i.value.value,r.value.value,s.value.value);return this.main.mergeVarScope(t.getVarScopeRef()),await(0,n.succeeded)(o)}}},97163:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Variable=void 0;const r=a(93176);t.Variable=class{constructor(e){this.main=e}type(){return r.OperationType.VAR}async handle(e){const t=this.main.getVarScopeRef(),a=e.value.split(".");let n=t;for(let e=0;e<a.length-1;e++)"object"!=typeof n[a[e]]||(n=n[a[e]]);const s=a[a.length-1];return{success:!0,value:{type:r.OperationType.LITERAL,value:n[s]}}}}},32065:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MarkProcessedElement=void 0;const r=a(93176),n=a(98392);t.MarkProcessedElement=class{constructor(e){this.main=e}type(){return r.OperationType.MARK_PROCESSED_ELEMENT}async handle(e){const t=this.main.getElScopeRef();for(const a of e.selectors){let e;try{e=t.querySelector(a)}catch(e){continue}if(e)return e.setAttribute("data-lib-processed","true"),await(0,n.succeeded)(!0)}return await(0,n.failed)(!1)}}},94862:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WaitForNotProcessedElementHandler=void 0;const r=a(93176),n=a(98392);t.WaitForNotProcessedElementHandler=class{constructor(e){this.main=e}type(){return r.OperationType.WAIT_FOR_NOT_PROCESSED_ELEMENT}async handle(e){return await new Promise((t=>{const a=setInterval((()=>{const s=this.main.getElScopeRef();for(const i of e.selectors){let e;try{e=s.querySelector(i)}catch(e){continue}e&&(e.hasAttribute("data-lib-processed")||(clearInterval(a),clearTimeout(r),t((0,n.succeeded)(!0))))}}),500),r=setTimeout((()=>{clearInterval(a),t((0,n.failed)(!1))}),e.timeout)}))}}},16627:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WaitForUrlChanged=void 0;const r=a(93176),n=a(98392);t.WaitForUrlChanged=class{type(){return r.OperationType.WAIT_FOR_URL_CHANGED}async handle(){return await new Promise((e=>{const t=location.href,a=setInterval((()=>{t!==location.href&&(clearInterval(a),clearInterval(r),e((0,n.succeeded)(!0)))}),500),r=setTimeout((()=>{clearInterval(a),e((0,n.failed)(!1))}),5e3)}))}}},25183:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProgramFactory=void 0;const r=a(49214),n=a(18028),s=a(43914),i=a(27578),o=a(40164),c=a(425),l=a(31995),u=a(63778),d=a(58876),h=a(82232),p=a(24224),y=a(69767),m=a(20480),v=a(32065),f=a(28163),g=a(47607),E=a(19008),R=a(7330),T=a(91497),S=a(30819),_=a(72813),M=a(95190),w=a(97163),O=a(94862),P=a(16627),b=a(49442),A=a(64491),D=a(42205),C=a(90010),L=a(32950),N=a(6519),I=a(60108),H=a(70302),F=a(63073);t.ProgramFactory=class{create(e,t,a,j,U){return new r.Program(e,t,a,j,U,this,{AND:n.And,CALL_METHOD:s.CallMethod,CLOSEST:i.Closest,COMPUTED:o.Computed,CONDITION:C.Condition,EXIST:c.ExistElement,FOR_EACH:l.ForEach,FUNC:u.Func,IS_NOT_HIDDEN_ELEMENT:d.IsNotHiddenElement,JSON_PARSER:h.JsonParser,LITERAL:p.Literal,LOG:y.Log,MAP:m.Map,MARK_PROCESSED_ELEMENT:v.MarkProcessedElement,MERGE:f.Merge,OR:g.Or,PLURAL:E.Plural,PRICE_PARSER:R.PriceParser,RETURN:T.ReturnOperationHandler,SELECT:S.Select,SINGLE:_.Single,SPLIT_SCOPE:M.SplitScope,VAR:w.Variable,WAIT_FOR_NOT_PROCESSED_ELEMENT:O.WaitForNotProcessedElementHandler,WAIT_FOR_URL_CHANGED:P.WaitForUrlChanged,GET_PROPERTY:b.GetProperty,EMIT:A.Emit,FLOW:D.Flow,REPLACE:L.Replace,REPLACE_BETWEEN:N.ReplaceBetween,HTML_COLLECTOR:I.HtmlCollector,MATH:H.MathAction,GLOBAL_VAR:F.GlobalVar})}prototype(e){return this.create(e.getConfig(),e.getObserver(),e.getElScopeRef(),e.cloneVarScope(),e.getFuncsRef())}}},68253:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlElementSolver=void 0;const r=a(98392);t.HtmlElementSolver=class{constructor(e,t){this.main=e,this.logger=t}async solve(e){try{const t=await this.main.handle(e);return t.success?t.value.value instanceof HTMLElement?await(0,r.succeeded)(t.value.value):(this.logger.log('argument for "scope" must be an instance of "HTMLElement"'),await(0,r.failed)()):(this.logger.log('error handling argument operation for "scope"'),await(0,r.failed)())}catch(e){return this.logger.log(e),await(0,r.failed)()}}}},71979:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectorsSolver=void 0;const r=a(98392);t.SelectorsSolver=class{constructor(e,t){this.main=e,this.logger=t}async solve(e){if(void 0===e)return this.logger.log('argument for "selectors" are missed'),await(0,r.failed)();if(!Array.isArray(e))return this.logger.log('argument for "selectors" must be an array'),await(0,r.failed)();const t=[];for(const a of e){const e=await this.main.handle(a);if((0,r.isFailed)(e,a))return this.logger.log('error handling an argument for "selectors"'),await(0,r.failed)();t.push(e.value.value)}return 0===e.length?(this.logger.log('argument for "selectors" are empty'),await(0,r.failed)()):await(0,r.succeeded)(t)}}},93032:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MyLogger=void 0;t.MyLogger=class{constructor(e){this.config=e}log(e,...t){this.config.log}error(e,...t){this.config.log}}},98392:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isFailed=t.clone=t.succeeded=t.failed=void 0;const r=a(93176);t.failed=async function(e=undefined){return{success:!1,value:{type:r.OperationType.LITERAL,value:e}}},t.succeeded=async function(e){return{success:!0,value:{type:r.OperationType.LITERAL,value:e}}},t.clone=function(e){const t={},a=Object.keys(e),r=e=>{if(Array.isArray(e)){const t=[];for(let a=0;a<e.length;a++)t.push(r(e[a]));return t}if("object"==typeof e&&e){if(e instanceof Element||e instanceof Document)return e;const t=Object.keys(e),a={};for(const n of t)a[n]=r(e[n]);return a}return e};for(const n of a)t[n]=r(e[n]);return t},t.isFailed=function(e,t){return!e.success&&!t.optional}}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,a),s.exports}(()=>{const e=a(1106),t=a(14476),r=a(91049),n=a(51648),s=a(11272),i=a(44353),o=(0,e.uuid)(),c=new s.Observer,l=new n.HistoryManager(c),u=new i.RequestsManager(c);l.replaceNativeApi();const d=new t.OutContentMessageManager(o);new r.InContentMessageManager(o,d,l,u);d.initMessage()})()})();