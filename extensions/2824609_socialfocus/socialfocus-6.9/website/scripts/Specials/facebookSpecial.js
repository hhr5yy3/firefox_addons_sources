const facebookFeedSponsoredLabels = [
  "Sponsored",
  "Gesponsert",
  "Sponsorisée",
  "Publicidad",
  "Sponzorováno",
  "Được tài trợ",
  "Sponsorizzato",
  "Apmaksāta reklāma",
  "Sponsorowane",
  "Gesponsord",
  "Bersponsor",
  "赞助内容",
  "贊助",
  "広告",
  "Sponsoroitu",
  "Sponsorlu",
  "Χορηγούμενη",
  "Реклама",
  "Ispoonsara godhameera",
  "Geborg",
  "Ditaja",
  "Disponsori",
  "Giisponsoran",
  "Sponsoreret",
  "Anzeige",
  "May Sponsor",
  "Oipytyvôva",
  "Ɗaukar Nayin",
  "Uterwa inkunga",
  "Imedhaminiwa",
  "Peye",
  "Hirdetés",
  "Misy Mpiantoka",
  "Sponset",
  "Patrocinado",
  "Sponsorizat",
  "Zvabhadharirwa",
  "Sponzorované",
  "Sponzorirano",
  "Sponsrat",
  "Спонсорирано",
  "Спонзорирано",
  "Ивээн тэтгэсэн",
  "Спонзорисано",
  "Хәйрияче",
  "Sponsitud",
  "Sponsore",
  "Sponsa",
  "Sponsorizuar",
  "Sponzorrirano",
  "Sponsrad",
  "La maalgeliyey",
  "Remiama",
  "Sponsorjat",
  "Reklama",
  "Noddwyd",
  "Patrocinat",
  "Spunsurizatu",
  "Paeroniet",
  "pəɹosuodS",
  "Urraithe",
  "Yoɓanaama",
  "Daukar Nauyi",
  "Plaćeni oglas",
  "Icyamamaza ndasukirwaho",
  "Рэклама",
  "Babestua",
  "Reklamo",
  "Szpōnzorowane",
  "Бо сарпарастӣ",
  "مُموَّل",
  "Sponsor dəstəkli",
  "Patronadu de:",
  "Демөөрчүлөнгөн",
  "Демеушілік көрсеткен",
  "Գովազդային",
  "سپانسرڈ",
  "دارای پشتیبانی مالی",
  "تمويل شوي",
  "پاڵپشتیکراو",
  "ܒܘܕܩܐ ܡܡܘܘܢܐ",
  "পৃষ্ঠপোষকতা কৰা",
  "ਸਰਪ੍ਰਸਤੀ ਪ੍ਰਾਪਤ",
  "પ્રાયોજિત",
  "ପ୍ରଯୋଜିତ",
  "விளம்பரம்",
  "ప్రాయోజితం చేయబడింది",
  "ಪ್ರಾಯೋಜಿತ",
  "സ്പോൺസർ ചെയ്തത്",
  "අනුග්‍රාහක",
  "ຜູ້ສະໜັບສະໜູນ",
  "အခပေးကြော်ငြာ",
  "რეკლამა",
  "የተከፈለበት ማስታወቂያ",
  "បានឧបត្ថម្ភ",
  "ⵉⴷⵍ",
  "贊助",
  "赞助内容",
  "広告",
  "ממומן",
  "ได้รับการสนับสนุน",
  "Reklam",
];

const facebookFeedFollowLabels = [
  "Raac",
  "Volg",
  "İzlə",
  "Ikuti",
  "Ikut",
  "Sundi",
  "Prati",
  "Heuliañ",
  "Segueix",
  "Seguità",
  "Dilyn",
  "Følg",
  "Folgen",
  "Jälgi",
  "Follow",
  "Seguir",
  "Aboni",
  "Jarraitu",
  "I-follow",
  "S’abonner",
  "Suivre",
  "Folgje",
  "Rewindo",
  "Segui",
  "Fylg",
  "Lean",
  "Prati",
  "Fuata",
  "Swiv",
  "Bişopîne",
  "Sekot",
  "Stebėti",
  "Követem",
  "Segwi",
  "Volgen",
  "Følg",
  "Kuzatish",
  "Obserwuj",
  "Urmăreşte",
  "Sighi",
  "Tevera",
  "Ndiqe",
  "Sledovať",
  "Seuraa",
  "Följ",
  "Theo dõi",
  "Takip Et",
  "Volgen",
  "Fylgjast með",
  "Sledovat",
  "Ακολουθήστε",
  "Сачыць",
  "Последване",
  "Дагах",
  "Подписаться",
  "Прати",
  "Язылу",
  "Пайравӣ кардан",
  "Стежити",
  "Жазылуу",
  "Жазылу",
  "Հետևել",
  "מעקב",
  "فالو کریں",
  "متابعة",
  "دنبال کردن",
  "وڅارئ",
  "شوێنکەوتن",
  "पछ्याउनुहोस्",
  "फॉलो करा",
  "फ़ॉलो करें",
  "অনুসৰণ কৰক",
  "ফলো করুন",
  "ਫਾਲੋ ਕਰੋ",
  "ફૉલો કરો",
  "ଅନୁସରଣ କରନ୍ତୁ",
  "பின்தொடர்",
  "ఫాలో అవ్వండి",
  "ಅನುಸರಿಸು",
  "പിന്തുടരുക",
  "හඹා යන්න",
  "ติดตาม",
  "ຕິດຕາມ",
  "စောင့်ကြည့်ရန်",
  "გამოწერა",
  "តាមដាន",
  "ⴹⴼⵕ",
  "追蹤",
  "关注",
  "追蹤",
  "フォローする",
  "フォローするで",
  "팔로우",
];

var hideFacebookSponsored = false;
var hideFacebookPeopleYouMayKnow = false;
var hideFacebookReelsAndShorts = false;
var hideFacebookSuggestedGroups = false;
var hideFacebookGroupPosts = false;
var hideFacebookPostsFromPeopleToFollow = false;

function triggerFilterFacebookPosts() {
  setFaceboookFeedVars();
}

function setFaceboookFeedVars() {
  browser.storage.local.get(
    [
      "socialFocus_facebook_feed_hide_sponsored_posts",
      "socialFocus_facebook_feed_hide_group_posts",
      "socialFocus_facebook_feed_hide_section_people_you_may_know",
      "socialFocus_facebook_feed_hide_section_reels_and_short_videos",
      "socialFocus_facebook_feed_hide_suggested_groups",
      "socialFocus_facebook_feed_hide_posts_from_people_to_follow",
    ],
    function (obj) {
      hideFacebookSponsored =
        obj["socialFocus_facebook_feed_hide_sponsored_posts"] ?? false;
      hideFacebookGroupPosts =
        obj["socialFocus_facebook_feed_hide_group_posts"] ?? false;
      hideFacebookPeopleYouMayKnow =
        obj["socialFocus_facebook_feed_hide_section_people_you_may_know"] ??
        false;
      hideFacebookReelsAndShorts =
        obj["socialFocus_facebook_feed_hide_section_reels_and_short_videos"] ??
        false;
      hideFacebookSuggestedGroups =
        obj["socialFocus_facebook_feed_hide_suggested_groups"] ?? false;
      hideFacebookPostsFromPeopleToFollow =
        obj["socialFocus_facebook_feed_hide_posts_from_people_to_follow"] ??
        false;
      filterFacebookPostsFromQuery();
    }
  );
}

setFaceboookFeedVars();

function hidePost(post) {
  if (post.hasAttribute("data-mcomponent")) {
    post.style.display = "none";
  } else {
    post.remove();
  }
}

function filterFacebookPosts(posts) {
  for (const post of posts) {
    // Mobile

    if (post.hasAttribute("data-type")) {
      if (post.getAttribute("data-type") == "vscroller") {
        post.classList.add("disable-virtualization");
        continue;
      }
    }

    const postContent = post.innerText.toLowerCase();

    // Sponsored

    if (hideFacebookSponsored) {
      const hasSponsoredWord = facebookFeedSponsoredLabels.some((word) =>
        postContent.includes(word.toLowerCase())
      );
      const hasAdsLink = post.querySelector("a[href*='l.php']");

      if (hasSponsoredWord || hasAdsLink) {
        hidePost(post);
      }
    }

    // Group Posts

    if (hideFacebookGroupPosts) {
      const hasGroupsLink = post.querySelector("a[href*='/groups/']");

      if (hasGroupsLink) {
        hidePost(post);
      }
    }

    // Posts From People to Follow

    if (hideFacebookPostsFromPeopleToFollow) {
      var contentToCheck = "";
      const postHeader = post.querySelector("h4");

      if (postHeader) {
        contentToCheck = postHeader.innerText.toLowerCase();
      } else {
        contentToCheck = postContent;
      }

      const hasFollowButton = facebookFeedFollowLabels.some((word) =>
        contentToCheck.includes(word.toLowerCase())
      );

      if (hasFollowButton) {
        hidePost(post);
      }
    }

    // Section - People You May Know

    if (hideFacebookPeopleYouMayKnow) {
      const hasFriendsLink = post.querySelector("a[href*='/friends/']");

      if (hasFriendsLink) {
        hidePost(post);
      }
    }

    // Section - Reels and Shorts Videos

    if (hideFacebookReelsAndShorts) {
      const hasReelsLink =
        post.querySelector("a[href*='/reel/']") ||
        post.querySelector("a[href*='/reels/create/']");

      if (hasReelsLink) {
        hidePost(post);
      }
    }

    // Section - Suggested Groups

    if (hideFacebookSuggestedGroups) {
      const hasGroupsDiscoverLink = post.querySelector(
        "a[href*='/groups/discover/']"
      );

      if (hasGroupsDiscoverLink) {
        hidePost(post);
      }
    }
  }
}

function filterFacebookPostsFromQuery() {
  const facebookPosts = document.querySelectorAll(
    "body:has(div[role='navigation'] a[href='/'][aria-current='page']) div[role='main'] div[aria-describedby], div[data-mcomponent='MContainer'][data-tracking-duration-id][data-type='container'].m, #MFirstBatch article"
  );

  filterFacebookPosts(facebookPosts);
}

function filterFacebookPostsFromObserver(posts) {
  if (!location.href.includes("/marketplace")) {
    filterFacebookPosts(posts[0].added);
  }
}

var facebookPostsObserver = new MutationSummary({
  callback: filterFacebookPostsFromObserver,
  queries: [
    {
      element:
        "div[aria-describedby], div[data-mcomponent='MContainer'][data-tracking-duration-id][data-type='container'].m, div[data-type='vscroller'], aricle[data-store-id]",
    },
  ],
});
