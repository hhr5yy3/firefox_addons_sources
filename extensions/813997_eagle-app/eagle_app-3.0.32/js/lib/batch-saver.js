class BatchSaver{constructor(){this.#initShortcut(),this.#registerRuntimeChannel(),eagle.shortcuts.changed(()=>{this.#initShortcut()})}async execute(){var e=[...await eagle.elementCollector.getCollectableItems(),...await eagle.elementCollector.getIframeCollectableItems(),...await eagle.elementCollector.getShadowRootCollectableItems()];let t=await Promise.all(e.map(async e=>{var t=e.elementMeta;let a=!1;return"svg"==e.type&&(e.type="image",t.src=e.src),"bg-image"==e.type&&(e.type="image",a=!0),t.src?(e.width=parseInt(e.width),e.height=parseInt(e.height),{type:e.type,width:e.width,height:e.height,title:t.title,src:t.src,url:t.url,urlConverted:a}):null})).then(e=>e.filter(e=>null!==e));const a={};if(t=t.reduce((e,t)=>(a[t.src]||(a[t.src]=!0,e.push(t)),e),[]),!eagle.urlEnlarger.isEagleHasAbilityToEnlarge){e=t.map(e=>e.src);let r=await eagle.urlEnlarger.enlargeBatch(e);t.forEach((e,t)=>{var{url:t,largeUrl:a}=r[t];t!==a&&(e.urlConverted=!0,e.src=a||e.src)})}eagle.item.batchSave(t)}#initShortcut(){var e;eagle.preference.keybindings["batch-save"]&&(e=eagle.preference.keybindings["batch-save"].replace(/\s/g,"").toLowerCase(),Mousetrap.bind(e,eagle.utils.debounce(async e=>{if(await eagle.env.isReady())return e.preventDefault(),this.execute(),!1},500,!0)))}#registerRuntimeChannel(){eagle.runtime.onMessage("batch-save",async(e,t,a)=>{if(await eagle.env.isReady())return this.execute(),a(),!0})}}eagle.preference.ready(()=>{eagle.batchSaver=new BatchSaver});