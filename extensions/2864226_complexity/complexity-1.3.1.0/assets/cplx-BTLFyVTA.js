import{r as d}from"./cplx-M4JPizzD.js";import{q as p,h as _,K as C}from"./cplx-CVsLL7Ku.js";import{t as u,B as k,C as I,D as L,b as K}from"./cplx-CejnDNPm.js";import{j as e,c as N}from"./cplx-DEt7CUyc.js";import{u as f}from"./cplx-B42KOvrD.js";import{C as q,T as h,c as P,d as E,f as F,e as M,a as O}from"./cplx-C7vqVxs5.js";import{s as U}from"./cplx-Bey00KRS.js";import{a as Q,h as x,S as V,D as v,i as z}from"./cplx-CWPpH3dB.js";import{r as D,t as T,U as A,w as R}from"./cplx-Cdcyb6EG.js";import{T as B}from"./cplx-Cqfmi6PF.js";import{a as W}from"./cplx-C-SYgQKx.js";import{u as y}from"./cplx-CgmVhoKz.js";import{g as m}from"./cplx-CEwbiDR6.js";import{b as $}from"./cplx-BqwXc_LR.js";function G({space:t,setOpen:s}){var r,i;const a=Q(o=>o.url),n=D(a).pathname.split("/").pop(),l=n===t.slug||n===t.uuid;return e.jsxs(q,{className:N("tw-relative tw-min-h-10 tw-text-sm tw-font-medium",{"tw-text-primary":l}),value:t.uuid,keywords:[t.title,(r=t.description)==null?void 0:r.slice(0,100),(i=t.instructions)==null?void 0:i.slice(0,100)],onSelect:()=>{s(!1),U("spa-router:push",{url:`/collections/${t.slug}`},"window")},children:[e.jsxs("div",{className:"tw-flex tw-items-center tw-gap-2",children:[t.emoji&&e.jsx("div",{children:T(t.emoji)}),t.title]}),e.jsx("div",{className:"tw-ml-2 tw-flex tw-items-center tw-gap-1",children:l&&e.jsx("div",{className:"tw-text-xs tw-text-muted-foreground",children:u("plugin-space-navigator:spaceNavigator.spaceItem.currentLocation")})})]},t.uuid)}function H({file:t,spaceUuid:s}){return e.jsxs("div",{className:"tw-flex tw-items-center tw-space-x-2",children:[e.jsx(W,{className:"tw-inline-block tw-size-4"}),e.jsx("span",{className:"tw-line-clamp-1 tw-cursor-pointer hover:tw-underline",onClick:async()=>{const a=await p.fetchQuery(x.spaces._ctx.files(s)._ctx.downloadUrl(t.file_uuid));a!=null&&a.file_url&&window.open(a.file_url,"_blank")},children:t.filename})]})}const g=_("sidebarPinnedSpaces",{list:{queryKey:null,queryFn:()=>m().getAll()},get:t=>({queryKey:[{uuid:t}],queryFn:()=>m().get(t)})});function J(){return y({mutationKey:["pinSpaceOnSidebar"],mutationFn:async({space:t})=>await m().add({uuid:t.uuid,title:t.title,emoji:t.emoji,slug:t.slug}),onSettled:()=>{p.invalidateQueries({queryKey:g.list.queryKey,exact:!0})}})}function X(){return y({mutationKey:["unpinSpace"],mutationFn:async({uuid:t})=>await m().delete(t),onSettled:()=>{p.invalidateQueries({queryKey:g.list.queryKey,exact:!0})}})}function Y({spaces:t}){var r;const s=h(i=>{const o=i.value;return t==null?void 0:t.find(c=>c.uuid===o)}),a=h(i=>i.value===(s==null?void 0:s.uuid)),{data:n}=f({...x.spaces._ctx.files((s==null?void 0:s.uuid)??""),enabled:s!=null&&a,refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:3e4});return s==null?null:!s.description&&!s.instructions&&((n==null?void 0:n.num_total_files)??0)<=0?e.jsxs("div",{className:"tw-relative tw-flex tw-size-full tw-items-center tw-justify-center tw-text-muted-foreground",children:[e.jsx(j,{space:s}),e.jsx("div",{children:u("plugin-space-navigator:spaceNavigator.spaceItem.noPreviewData")})]}):e.jsxs("div",{className:"tw-relative tw-flex tw-flex-col tw-gap-4 tw-p-4",children:[e.jsx(j,{space:s}),s.description&&e.jsxs("div",{className:"tw-flex tw-flex-col tw-justify-between tw-gap-2",children:[e.jsx("div",{className:"tw-text-sm tw-font-medium tw-text-muted-foreground",children:u("plugin-space-navigator:spaceNavigator.spaceItem.details.description")}),e.jsx("div",{className:"tw-line-clamp-1 tw-whitespace-pre-wrap",children:s.description})]}),s.instructions&&e.jsxs("div",{className:"tw-flex tw-flex-col tw-justify-between tw-gap-2",children:[e.jsx("div",{className:"tw-text-sm tw-font-medium tw-text-muted-foreground",children:u("plugin-space-navigator:spaceNavigator.spaceItem.details.instructions")}),e.jsx(V,{className:"tw-whitespace-pre-wrap tw-rounded-md tw-bg-secondary",children:e.jsx("div",{className:"tw-max-h-[200px] tw-p-2",children:s.instructions})})]}),((r=s.focused_web_config)==null?void 0:r.link_configs.length)>0&&e.jsxs("div",{className:"tw-flex tw-flex-col tw-justify-between tw-gap-2",children:[e.jsx("div",{className:"tw-truncate tw-text-sm tw-font-medium tw-text-muted-foreground",children:u("plugin-space-navigator:spaceNavigator.spaceItem.details.focusedWebLinks",{count:s.focused_web_config.link_configs.length})}),e.jsx("div",{className:"tw-flex tw-flex-wrap tw-items-center tw-gap-2",children:s.focused_web_config.link_configs.map((i,o)=>e.jsxs("div",{className:"tw-flex tw-items-center tw-gap-2",children:[e.jsx(k,{className:"tw-size-4"}),e.jsx("div",{className:"tw-line-clamp-1 tw-underline",children:i.link})]},o))})]}),n&&(n==null?void 0:n.num_total_files)>0&&e.jsxs("div",{className:"tw-flex tw-flex-col tw-justify-between tw-gap-2",children:[e.jsx("div",{className:"tw-text-sm tw-font-medium tw-text-muted-foreground",children:u("plugin-space-navigator:spaceNavigator.spaceItem.details.files",{count:n.num_total_files})}),n.files.map((i,o)=>e.jsx(H,{file:i,spaceUuid:s.uuid},o))]})]})}function j({space:t}){const{data:s}=f(g.list),a=s==null?void 0:s.some(r=>r.uuid===t.uuid),{mutate:n}=J(),{mutate:l}=X();return e.jsx("div",{className:"tw-absolute tw-right-2 tw-top-2",children:e.jsx(B,{content:u(`plugin-space-navigator:spaceNavigator.spaceItem.pinActions.${a?"unpin":"pin"}`),children:e.jsx("div",{className:"tw-cursor-pointer tw-rounded-md tw-p-2 tw-text-muted-foreground tw-transition-all hover:tw-bg-secondary hover:tw-text-foreground active:tw-scale-95",onClick:()=>{a?l({uuid:t.uuid}):n({space:t})},children:a?e.jsx(I,{className:"tw-size-4"}):e.jsx(L,{className:"tw-size-4"})})})})}function we({setOpen:t}){const{isMobile:s}=$(),{data:a,isLoading:n}=f(x.spaces),[l,r]=d.useState("");return e.jsxs(P,{filter:(i,o,c)=>{const S=i+((c==null?void 0:c.join(""))??"").replace(/\s+/g,"").toLowerCase(),b=o.replace(/\s+/g,"").toLowerCase();return S.includes(b)?1:0},onKeyDown:i=>{i.key===C.Key.Escape&&(i.preventDefault(),i.stopPropagation(),setTimeout(()=>{A.getActiveQueryBoxTextarea().trigger("focus")},100))},children:[e.jsx(E,{placeholder:u("plugin-space-navigator:spaceNavigator.search.placeholder"),value:l,className:N({"tw-font-medium":!l}),searchIcon:!1,onValueChange:i=>r(i)}),!n&&e.jsx(F,{children:u("plugin-space-navigator:spaceNavigator.search.noResults")}),e.jsxs("div",{className:"tw-flex tw-items-start tw-divide-x tw-divide-border/50",children:[e.jsx(M,{className:"tw-flex-1",children:n?e.jsxs("div",{className:"tw-my-10 tw-w-full tw-space-x-2 tw-text-center",children:[e.jsx(K,{className:"tw-inline-block tw-size-4 tw-animate-spin"}),e.jsx("span",{children:u("plugin-space-navigator:spaceNavigator.loading")})]}):e.jsx(O,{children:a==null?void 0:a.map(i=>e.jsx(G,{space:i,setOpen:t},i.uuid))})}),!s&&!n&&a&&e.jsx("div",{className:"custom-scrollbar tw-h-[300px] tw-overflow-auto sm:tw-w-[300px] lg:tw-w-[400px] xl:tw-w-[500px]",children:e.jsx(Y,{spaces:a})})]})]})}const w="cookies-pplx-incognito-mode";function pe(){if(R()==="unknown")throw new Error("useCookies can only be used in perplexity.ai domains");const[t,s]=d.useState([]),a=d.useCallback(()=>{const l=document.cookie.split(";").map(r=>{const i=r.trim().split("=");if(i.length!==2)return null;const[o,c]=i;return o?{name:o,value:decodeURIComponent(c||"")}:null}).filter(r=>r!==null);s(r=>r.length!==l.length||r.some((o,c)=>!l[c]||o.name!==l[c].name||o.value!==l[c].value)?l:r)},[]);return d.useEffect(()=>(a(),v.create(w,{target:document.body,config:{childList:!0,subtree:!0},onMutation:()=>z.getInstance().enqueue(a,w)}),()=>{v.destroy(w)}),[a]),t}export{we as S,X as a,g as p,pe as u};
