import{Info,SETUP_URL,Settings,Styles,broadcast}from"../chunk-4KZVVU6Z.js";import"../chunk-FF3JOXTG.js";(async function(){Info.setInstanceType(6);let checkInfoBtnEl=document.getElementById("btn_check_ip"),confBtnEl=document.getElementById("btn_conf"),ipValueEl=document.getElementById("info_ip"),countryValueEl=document.getElementById("info_country");!checkInfoBtnEl||!confBtnEl||!ipValueEl||!countryValueEl||(initTitle(),initConfigInfo(),await Settings.loadSettings(),Styles.initColorScheme().then(()=>{document.body.setAttribute("data-frame-color-scheme",Styles.reactive.frameColorScheme),document.body.setAttribute("data-popup-color-scheme",Styles.reactive.popupColorScheme),document.body.setAttribute("data-ready","true")}),setTimeout(()=>{window.resizeTo(450,640)},2e3),checkInfoBtnEl.addEventListener("click",async()=>{document.body.classList.add("-loading");let[activeTab]=await browser.tabs.query({currentWindow:!0,active:!0}),info=await broadcast({dstType:0,action:"checkIpInfo",arg:activeTab.cookieStoreId});if(!info){document.body.classList.remove("-loading"),document.body.classList.add("-error");return}info.ip?ipValueEl.innerText=info.ip:ipValueEl.innerText="---",info.country?countryValueEl.innerText=info.country:countryValueEl.innerText="---",document.body.classList.remove("-loading")}),confBtnEl.addEventListener("click",async()=>{let url=SETUP_URL,tabs=await browser.tabs.query({currentWindow:!0}),activeTab=tabs.find(t=>t.active),existedTab=tabs.find(t=>t.url.startsWith(url));if(activeTab){if(url+="#settings_containers."+activeTab.cookieStoreId,existedTab)existedTab.url===url?browser.tabs.update(existedTab.id,{active:!0}):browser.tabs.update(existedTab.id,{url,active:!0});else{let conf={url,windowId:browser.windows.WINDOW_ID_CURRENT};browser.tabs.create(conf)}window.close()}}))})();async function initTitle(){let[activeTab]=await browser.tabs.query({currentWindow:!0,active:!0});if(!activeTab)return;let container=await browser.contextualIdentities.get(activeTab.cookieStoreId);if(!container)return;let popupTitleEl=document.getElementById("popup_title"),titlePre=browser.i18n.getMessage("proxy_popup_title_prefix"),titlePost=browser.i18n.getMessage("proxy_popup_title_postfix"),title=titlePre+container.name+titlePost;document.title=title,popupTitleEl&&(popupTitleEl.innerText=title)}async function initConfigInfo(){let[activeTab]=await browser.tabs.query({currentWindow:!0,active:!0});if(!activeTab)return;let typeValueEl=document.getElementById("conf_type"),hostValueEl=document.getElementById("conf_host"),dnsValueEl=document.getElementById("conf_dns");if(!typeValueEl||!hostValueEl||!dnsValueEl)return;let{containers}=await browser.storage.local.get({containers:{}});if(!containers)return;let container=containers[activeTab.cookieStoreId];if(!container||!container.proxy)return;let conf=container.proxy;conf.type==="socks"?typeValueEl.innerText="socks5":conf.type==="socks4"?typeValueEl.innerText="socks4":typeValueEl.innerText=conf.type,hostValueEl.innerText=`${conf.host??"???"}:${conf.port??"???"}`,dnsValueEl.innerText=String(conf.proxyDNS)}
