(()=>{"use strict";class e{constructor(){this.logDebugMessage=(...e)=>{this.logMessage(t.DEBUG,...e)},this.logInfo=(...e)=>{this.logMessage(t.INFO,...e)},this.logWarn=(...e)=>{this.logMessage(t.WARN,...e)},this.logError=(...e)=>{this.logMessage(t.ERROR,...e)}}}var t;!function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR"}(t||(t={}));const s="x-session";function n(e,t){if(function(){const e=globalThis;if(void 0!==e.cloneInto)return e}()){const s=globalThis.content,n=s?.fetch;if("function"==typeof n)return n(e,t)}return fetch(e,t)}class i extends e{constructor(e,t,s,n,i){super(),this.logServerUrl=e,this.publicTokenProvider=t,this.urlProvider=s,this.pluginDataProvider=n,this.logLevel=i,this.batchSize=50,this.batch=[],this.maxSendTimeout=1e4,this.sendTimeoutId=0,this.messageId=1e3*globalThis.crypto.getRandomValues(new Uint8Array(1))[0],window&&window.addEventListener("beforeunload",(()=>{this.sendBatch()}))}logMessage(e,...s){if(e<this.logLevel)return;const n=t[e],i=[];for(const e of s)e instanceof Error?i.push(JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)))):i.push(e);this.batch.push({eventType:n,timestamp:Date.now(),url:this.urlProvider(),pluginData:this.pluginDataProvider(),messageId:++this.messageId,data:JSON.stringify(i)}),this.sendBatchIfNeeded()}clearSendBatchTimeout(){this.sendTimeoutId&&(clearTimeout(this.sendTimeoutId),this.sendTimeoutId=0)}sendBatchIfNeeded(){this.batch.length<this.batchSize?this.sendTimeoutId||(this.sendTimeoutId=Number(setTimeout((()=>{this.sendBatch()}),this.maxSendTimeout))):this.sendBatch()}sendBatch(){if(this.clearSendBatchTimeout(),!this.batch.length)return;const e=function(e,t,n,i,o,r,a="text/plain"){const c=new URL(n,e);let h=new Headers({"Content-Type":a});o?(h.set("Accept",o),t&&(h=function(e,t){if(!t)return e;const n="Accept",i=e.get(n);if(!i)throw new Error(`Invalid headers object: it doesn't have ${n} header!`);return e.set(n,`${i};${s}=${t}`)||e}(h,t))):t&&t&&h.set(s,t);const l={credentials:"omit",method:i,headers:h};return void 0!==r&&(l.body=JSON.stringify(r)),{url:c.toString(),options:l}}(this.logServerUrl,this.publicTokenProvider(),this.logServerUrl,"POST","application/vnd.intersub.log.response.v1+json",[...this.batch]);this.batch.length=0,n(e.url,e.options)}}var o,r,a;!function(e){e.ALL="ALL",e.YOUTUBE="YOUTUBE",e.COURSERA="COURSERA",e.NETFLIX="NETFLIX",e.HDREZKA="HDREZKA",e.TED="TED",e.KINOPUB="KINOPUB",e.LORD_FILM="LORD_FILM",e.OTHER="OTHER",e.INTERSUB_LANDING="INTERSUB_LANDING",e.INTERSUB_DEV="INTERSUB_DEV",e.SOAP4ME="SOAP4ME",e.TWO_SUB_MOVIE="TWO_SUB_MOVIE",e.INORIGINAL="INORIGINAL",e.AMAZON_PRIME="AMAZON_PRIME",e.LINKEDIN_LEARNING="LINKEDIN_LEARNING",e.UDEMY="UDEMY",e.CRUNCHYROLL="CRUNCHYROLL",e.ORORO="ORORO"}(o||(o={})),function(e){e.getTypeName=function(){return"ExternalVideoServiceType"},e.values=[e.ALL,e.YOUTUBE,e.COURSERA,e.NETFLIX,e.HDREZKA,e.TED,e.KINOPUB,e.LORD_FILM,e.OTHER,e.INTERSUB_LANDING,e.INTERSUB_DEV,e.SOAP4ME,e.TWO_SUB_MOVIE,e.INORIGINAL,e.AMAZON_PRIME,e.LINKEDIN_LEARNING,e.UDEMY,e.CRUNCHYROLL,e.ORORO]}(o||(o={})),function(e){e.SUBTITLES_URLS="SUBTITLES_URLS"}(r||(r={})),function(e){e.SEND_ALL_SUBS="SEND_ALL_SUBS",e.INIT="INIT"}(a||(a={})),function(){const t=new class extends e{logMessage(e,...t){this.sentryLogger&&this.sentryLogger.logMessage(e,t)}setSentryLogger(e){this.sentryLogger=e}};window.addEventListener("is_two_sub_movie_command",(e=>{const s=e.detail;switch(t.logDebugMessage(`TWO_SUB_MOVIE_SUBTITLE: Received command ${s.type}`),s.type){case a.SEND_ALL_SUBS:{const e=function(){const e={},t=window.yoPlayer?.player;if(null===t)return;if(!t)return;if(!t.remoteTextTrackEls)return;const s=t.remoteTextTrackEls();if(s?.length){for(let t=0;t<s.length;++t){const n=s[t];e[n.srclang]=n.src}return e}}();e&&window.dispatchEvent(new CustomEvent("is_two_sub_movie_subtitles",{detail:{type:r.SUBTITLES_URLS,data:e}}));break}case a.INIT:{const e=s.data;o.TWO_SUB_MOVIE,window.location.href,t.setSentryLogger(new i(e.logServerUrl,(()=>e.publicToken),(()=>window.location.href),(()=>e.pluginData),e.logLevel));break}}}))}()})();