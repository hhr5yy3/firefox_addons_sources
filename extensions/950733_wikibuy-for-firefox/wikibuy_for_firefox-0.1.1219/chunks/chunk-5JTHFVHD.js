import{a as f}from"./chunk-VWNXKYD4.js";import{a as h}from"./chunk-FQ7KGWHN.js";import{b as D}from"./chunk-4DY7Q7SZ.js";import{a as p}from"./chunk-BCG2KUGW.js";import{a as O}from"./chunk-O4TFJKJQ.js";import{B as u,c as g,r as k,v as B,x as P}from"./chunk-WRHUMLYF.js";import{b as H,i as L,l as E,p as it,q as A}from"./chunk-OEPSEZ5A.js";import{e as w}from"./chunk-3GYLW4KZ.js";async function S(t,e,n,o){let r=Date.now(),s=0,i=t();for(;!i&&s<e;)await at(n),i=t(),s=Date.now()-r;i&&o(i)}function at(t){return new Promise(e=>{setTimeout(e,t)})}it();var b=w(A());var d,F=!1;async function ct(){return f(I,t=>(d=t,N()))}function N(){let t=[...d.querySelectorAll('div[style*="color: initial;"] div div > div')].find(e=>{let n=e.querySelector('[style="position: relative;"]');if(n)return n.textContent.includes("Apply Rewards")});if(t)return F||G(),st(t),t}function st(t){t.addEventListener("click",()=>{m("coupert","cashback"),u("track","coupertActivate",{url:location.href,cashbackRate:x()})})}function x(){d||(d=R());let t=[...d.querySelectorAll('div[style*="color: initial;"] div div > div > div')].find(n=>n.textContent.includes("Rewards Found!"));if(t){let n=t.nextElementSibling&&t.nextElementSibling.innerText;return n||null}let e=[...d.querySelectorAll('div[style*="color: initial;"] div div > div span')].find(n=>n.textContent.includes("Cash Back"));if(e){let n=e.previousElementSibling&&e.previousElementSibling.innerText;return n||null}}function G(){F=!0;let t=x();u("track","coupertNotification",{name:"cashback",url:location.href,ctaText:t})}async function W(){f(I,async t=>{d||(d=t);let e=!1,n={childList:!0};new MutationObserver(i=>{b.default.forEach(i,async l=>{b.default.get(l,"type")==="childList"&&e===!1&&(e=!0,await ct())})}).observe(t,n);let r=N(),s=await h({action:"getCompState",comp:"coupert"});r&&!s&&G()})}function I(){try{let t=R();return d=t,t}catch{return!1}}function _(){let t=[...d.querySelectorAll("div span")].find(n=>n.textContent.includes("Continue to Checkout")),e=[...d.querySelectorAll('div [class*="cpui-btn-primary"]')].find(n=>n.textContent.includes("Continue to Checkout"));if(t||e)return d.querySelector('div[style*="color: initial;"]')}async function lt(t){h({action:"endSavingsCheck",comp:"coupert"});let e=[...t.querySelectorAll("div")].find(r=>r.textContent.match(/Congratulations!|You saved/)),n=0,o=[];if(e){let r=[...t.querySelectorAll("div p")].find(l=>l.textContent.includes("Congratulations!")),s=[...t.querySelectorAll("div div > div > div > div > div")].find(l=>l.textContent.includes("You saved")),i=r?r.previousElementSibling:s;if(i){let v=[...i.querySelectorAll("span")].find(M=>M.textContent==="With the code:").nextElementSibling.textContent,y;s?y=[...s.querySelectorAll("div > div")].find(rt=>rt.innerText.includes("You saved")).nextElementSibling.textContent:y=i.previousElementSibling.textContent,y&&(n=p(y)),v&&o.push(v)}}u("track","coupertTryCouponsResult",{savings:n,coupons:o,url:location.href}),x(),m("coupert","coupons")}async function ut(){return f($,t=>(d=t,U()))}function U(){let t=[...d.querySelectorAll('div[style*="color: initial;"] div div > div > [class^=button]')].find(e=>e.textContent.includes("Apply Coupons"));if(t)return dt(t),t}function dt(t){let e=t.innerText;t.addEventListener("click",()=>{h({action:"initSavingsCheck",comp:"coupert"}),u("track","coupertTryCoupons",{ctaText:e,url:location.href}),S(_,4e4,500,lt)})}async function Y(){f($,t=>{d||(d=t);let e=!1,n={childList:!0};new MutationObserver(s=>{b.default.forEach(s,async i=>{b.default.get(i,"type")==="childList"&&e===!1&&(e=!0,await ut())})}).observe(t,n);let r=U();if(r){let s=r.innerText;u("track","coupertNotification",{name:"coupon",ctaText:s,url:location.href})}})}function $(){try{let t=R();d=t;let e=[...d.querySelectorAll('div[style*="color: initial;"] div')].find(n=>n.textContent.includes("Apply Coupons"));return _(),e?t:!1}catch{return!1}}function R(){let e=[...document.querySelectorAll('div[style^="display: block"]')].find(n=>{let o=n.openOrClosedShadowRoot||chrome.dom.openOrClosedShadowRoot(n);if(o&&o.querySelector('[href="chrome-extension://mfidniedemcgceagapgdekdbmanojomk/css/content.css"]'))return o});if(e)return e.openOrClosedShadowRoot||chrome.dom.openOrClosedShadowRoot(e)}var T=w(O());async function j(){let t=await h({action:"getHoneyState",comp:"honey"}),e=await h({action:"getCompState",comp:"piggy"});!t&&!e&&f(ft,n=>{let[o,r]=pt(n);u("track","ebatesNotif",{url:location.href,cashbackRate:o,previousCashbackRate:r});let s=yt(n);s&&s.addEventListener("click",()=>{u("track","ebatesActivate",{url:location.href,cashbackRate:o,previousCashbackRate:r}),m("ebates","cashback")});let i=n.querySelector(".rr-button-close, [title^=Dismiss], .rr-tertiary");i&&i.addEventListener("click",()=>{u("track","ebatesDismiss",{url:location.href,cashbackRate:o,previousCashbackRate:r})})})}async function V(){await h({action:"getHoneyState",comp:"honey"})||f(ht,e=>{u("track","ebatesCouponNotif",{url:location.href});let n=[...e.querySelectorAll(".r-button")].find(r=>r.textContent.includes("Apply Coupons"));n&&n.addEventListener("click",()=>{u("track","ebatesTryCoupons",{url:location.href})});let o=e.querySelector(".rr-button-close, [aria-label^=Dismiss]");o&&o.addEventListener("click",()=>{u("track","ebatesCouponDismiss",{url:location.href})})})}function ft(){try{return K().shadowRoot.querySelector(".ebates-notification")}catch{return!1}}function ht(){try{let t=K().shadowRoot;return[...t.querySelectorAll(".r-button")].find(n=>n.textContent.includes("Apply Coupons"))?t.querySelector("aside[data-tid=coupons-magic-notification]"):!1}catch{return!1}}function yt(t){let e=t.querySelector(".rr-button-primary, button.r-button");return e&&/activate/i.test(e.innerText)?e:t.querySelector(".ebates-notification-button.ebates-notification-button-activate")||t.querySelector("ebates-notification-button.ebates-notification-button-login")}function pt(t){try{let e=t.querySelector(".ebates-notification .ebates-notification-button-activate")||t.querySelector(".rr-button-primary, button.r-button"),n=t.querySelector(".rr-text-secondary"),o=(0,T.default)(e).text(),r=(0,T.default)(n).text().trim()||void 0;return[o,r]}catch{return!1}}function K(){return[...document.querySelectorAll("html > *")].find(t=>{if(t.shadowRoot&&t.shadowRoot.querySelector(".ebates-notification, aside[data-tid=coupons-magic-notification]"))return!0})}var C=w(O()),c=w(A());var a;function J(){try{let t=a?.querySelectorAll("#honey button");return t?.length&&t}catch{return!1}}function q(){try{let t=a?.querySelector("#honey-shadow"),e;if(t){let n=(0,C.default)(t).find("[id*=HoneyGoldAmount]").text()||(0,C.default)(t).find("[class*=DescriptiveGold] span[class*=textBold]").text()||(0,C.default)(t).find("[class^=ctaColumn] [class^=container] [class^=title]").text()||(0,C.default)(t).find('[class*=goldText] span:contains("Gold")').text()||(0,C.default)(t).find("[class^=valueContainer] [class*=price]").text()||(0,C.default)(t).find("[class^=subTextAndTerms] [class*=subText]").text(),o=n&&n.match(/(\d+[,\.]?\d*% to \d+[,\.]?\d*(?:%|\sHoney Gold|\sGold|\scash back))/);e=o?o[1]:null}return e}catch{return null}}function mt(){return new Promise((t,e)=>{f(J,n=>{let o=c.default.last(n);t(o)})})}function Q(){let t=a?.querySelector("#honey-shadow"),e;return t&&(e=(0,C.default)(t).find('[class*=bodyContentGreen] p:contains("Cart Total")').text(),e=p(e)),e}function X(){let t=a?.querySelector("#honey-shadow"),e;return t&&(e=(0,C.default)(t).find("div:contains('re-activate Honey')").text()),!!e}function z(){m("honey","cashback")}function Ct(t){let e=t?.innerText;u("track","activateHoney",{url:location.href,ctaText:e,cashbackRate:q(),reactivation:X()})}function vt(){f(J,t=>{let e=[...t].find(r=>r.innerText==="Apply Coupons"),n=gt(t),o=St(t);if(e){let r=Q(),s=e.textContent,i=q();e.addEventListener("click",()=>{n&&u("track","honeyTryCoupons",{url:location.href,cartTotal:r,ctaText:s,cashbackRate:i}),h({action:"initSavingsCheck",comp:"honey"}),S(et,4e4,500,tt)})}n&&n.addEventListener("click",z),o&&o.addEventListener("click",()=>{Ct(o),z()})})}async function Z(){try{S(et,4e4,500,tt),f(()=>{let e=[...document.querySelectorAll("#honeyContainer, div[data-reactroot]")].find(n=>{let o=n.openOrClosedShadowRoot||chrome.dom.openOrClosedShadowRoot(n);return o&&o?.getElementById("honey-shadow")});if(e)return e.openOrClosedShadowRoot||chrome.dom.openOrClosedShadowRoot(e)},async t=>{a=t,vt();let e=await mt(),n=e?e.textContent:null,o=Q(),r=c.default.debounce(l=>{u("track",l?"showHoney":"hideHoney",{url:location.href,cartTotal:o,ctaText:n,cashbackRate:q(),reactivation:X()})},1e3),s=new MutationObserver(l=>{c.default.forEach(l,v=>{let y=c.default.get(v,"target.style.visibility");y==="hidden"?r(!1):(y==="initial"||y==="visible")&&r(!0)})}),i=a?.querySelector("#honey-shadow");if(i){s.observe(i,{attributes:!0,attributeFilter:["style"]});let l=i?.style?.visibility;l==="hidden"?r(!1):(l==="initial"||l==="visible")&&r(!0)}})}catch{}}function tt(t){h({action:"endSavingsCheck",comp:"honey"});let e=c.default.get(t,"savings")&&typeof t.savings=="number"?+t.savings:null,n=c.default.get(t,"originalPrice")&&typeof t.originalPrice=="number"?+t.originalPrice:null,o=c.default.get(t,"withHoneyPrice")&&typeof t.withHoneyPrice=="number"?+t.withHoneyPrice:null;u("track","honeyTryCouponsResult",{savings:e,rewardsSavings:c.default.get(t,"rewards",null),originPrice:n,finalPrice:o,codeApplied:c.default.get(t,"workingCode",null),url:location.href}),m("honey","coupons",()=>g.set(["warnAboutStandDown"],!0))}function gt(t){return c.default.find(t,e=>/coupon(?:s)?|code(?:s)?/i.test(e.innerHTML))||c.default.find(a?.querySelector("#honey")?.querySelectorAll("span"),e=>e.innerHTML==="Coupon codes")}function St(t){return c.default.find(t,e=>/claim honey gold|claim rewards|activate cash back|activate rewards/i.test(e.innerHTML))}var bt=[()=>{try{let t=/You saved|youâ€™re saving/i;if(a?.innerHTML.match(t)){let n=c.default.get(a?.querySelector("[class*=savingsPrice], [class^=savingsText]"),"textContent"),o=n?p(n):null,r=c.default.get(a?.querySelector("[id*=OriginalPrice], [class^=originalTotal]"),"textContent"),s=r?p(r):null,i=c.default.get(a?.querySelector("[id*=WithHoneyPrice], [class^=price].price5"),"textContent"),l=i?p(i):null,v=c.default.get(a?.querySelector("[id*=HoneyGoldAmount], [class^=valueContainer] > [class^=value]"),"textContent"),y=c.default.get(a?.querySelector("[class*=workingCode], [class*=bestCode-]"),"textContent");return{foundModal:!0,savings:o,rewards:v,originalPrice:s,withHoneyPrice:l,workingCode:y}}}catch{}return!1},()=>{try{let t=/Honey Gold.+activated/i;if(a?.innerHTML.match(t))return{foundModal:!0,rewards:c.default.get(a?.querySelector("[class*=DescriptiveGold] span[class*=textBold]"),"textContent")}}catch{}return!1},()=>{try{let t=/forget your free sample/i;if(a?.innerHTML.match(t)){let n=c.default.get(a?.querySelector("[id*=FreeItemReceipt][id*=titleContent]"),"textContent"),o=n?p(n):null,r=c.default.get(a?.querySelector("[id*=honeyGoldContainer] [class*=bold]"),"textContent"),s=a?.querySelectorAll("[class*=couponsContainer] [class*=couponPointer] [class*=couponTitle]"),i=c.default.map(s,l=>l.textContent);return{foundModal:!0,savings:o,rewards:r,workingCode:i}}}catch{}return!1},()=>{try{let t=/have the best/i;if(a?.innerHTML.match(t)){let n=a?.querySelector("[class^=price]")?.textContent;return{foundModal:!0,withHoneyPrice:n?p(n):void 0}}}catch{}return!1},()=>{try{let t=/Get.+Gold back/;if(a?.innerHTML.match(t))return{foundModal:!0,rewards:c.default.get(a?.querySelector("[id*=bonusCashContentContainer] [id*=span-bonusCashContent]"),"textContent")}}catch{}return!1},()=>{try{let t=/\d+% back|activated/;if(a?.innerHTML.match(t))return{foundModal:!0,rewards:c.default.get(a?.querySelector("[id*=bonusCashContentContainer] [id*=span-bonusCashContent]"),"textContent")}}catch{}return!1},()=>{try{let t=/youâ€™re earning cash back/i;if(a?.innerHTML.match(t))return{foundModal:!0,rewards:c.default.get(a?.querySelector("[class^=valueContainer] [class*=price]"),"textContent")}}catch{}return!1}];function et(){let t=!1;return c.default.forEach(bt,e=>{let n=e();if(c.default.has(n,"foundModal")){t=n;return}}),t}function wt(){function t(){f(()=>document.querySelector('form[action*="i.clean.gg"]'),e=>{u("track","extensionError",{type:"possible_error",source:"clean"})})}document.readyState!=="loading"?t():document.addEventListener("DOMContentLoaded",t)}async function nt(){let t=B();return t=k("ext_separate_domain_platform")?g.get("platformDomain"):await D(t)||t,t}var Zt=()=>{Z(),j(),V(),W(),Y(),wt()};var ot=(t,e)=>P("hasActivatedCompetitor",t);async function m(t,e,n){let o=await nt(),r=`${t}WarningNotif-${o}`;chrome.storage.local.get(r,s=>{let i=s[r];(e==="cashback"&&g.get(["cashback","user","activated"])||e==="coupons")&&(!i||E(H(L(i),{days:1}),new Date))&&k("notif_reactivation_base")&&(n&&n(),ot({domain:o,comp:t}))})}export{S as a,m as b,Zt as c};
