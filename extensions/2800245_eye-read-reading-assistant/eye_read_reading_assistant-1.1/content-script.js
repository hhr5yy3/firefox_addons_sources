const i="eye-read",s=RegExp("[\\p{L}]+('\\p{L})?|[0-9]+","gmu"),a=new Set(["AREA","AUDIO","BASE","BASEFONT","BIG","BR","CANVAS","CODE","DATA","DATALIST","EMBED","FIELDSET","FONT","FRAME","FRAMESET","HEAD","HR","HTML","IMG","INPUT","KBD","LINK","MAP","META","METER","NOFRAMES","NOSCRIPT","OBJECT","OPTGROUP","OPTION","PARAM","PICTURE","PRE","PROGRESS","RP","RT","RUBY","SCRIPT","SOURCE","STYLE","SUB","SUP","SVG","TEMPLATE","text","TEXTAREA","TIME","TITLE","TRACK","VIDEO","WBR"]),o=new Set(["BUTTON","NAV"]),l=new Set(["H1","H2","H3","H4","H5","H6"]);var d=a;const u=new Set(["BODY","DIALOG","FOOTER","IFRAME","MAIN","NAV"]),v=["material-icon","material-symbol"];var c={},h=!1,f=new Map,p=new Map;function g(){for(var[e,t]of f)t.textContent=e.textContent,e.parentNode&&e.parentNode.removeChild(e);f.clear(),p.clear()}function N(){if(c.default_enabled){var e,t,n;h&&(h=!1,g(),d=a,c.noise_level.value!==c.noise_level.max&&(d=new Set([...d,...o])),2<c.noise_level.value||(d=new Set([...d,"A"])),1<c.noise_level.value||(d=new Set([...d,...l]))),performance.now();for(e of function(){var r,e=[];for(r of function(){for(var e,t=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode(e){return e.parentNode&&f.has(e.parentNode)||e.parentNode.parentNode&&f.has(e.parentNode.parentNode)||0==e.textContent.trim().length?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),n=[];e=t.nextNode();)n.push(e);return n}()){var t=function(){var e={level:1,link:null,link_level:0,paragraph:null,paragraph_level:0,div:null,div_level:0,discarded:!1,editable:!1,prohibitedClass:!1};let n=r.parentElement;for(;n;){if(d.has(n.nodeName)){e.discarded=!0;break}"A"===n.nodeName?(e.link=n,e.link_level=e.level):"P"===n.nodeName?(e.paragraph=n,e.paragraph_level=e.level):"DIV"!==n.nodeName||e.div||(e.div=n,e.div_level=e.level);var t=n.getAttribute("contenteditable");if(t&&"false"!=t){e.editable=!0;break}if(function(){for(var e of n.classList.values())for(var t of v)if(e.toLowerCase().includes(t))return 1}()){e.prohibitedClass=!0;break}if(u.has(n.nodeName))break;e.level++,n=n.parentElement}return e}();t.discarded||t.editable||t.prohibitedClass||e.push(r)}return e}()){var r=p.get(e),r=(r&&(r.parentNode&&r.parentNode.removeChild(r),f.delete(r),p.delete(e)),function(t){if(void 0!==t.parentNode&&null!==t.parentNode){let e=0;var n,r,a=[];for(n of function(e){for(var t,n,r=[];null!==(t=s.exec(e));){var a=t[0].length;r.push({start:s.lastIndex-a,length:a,highlight:(a=t[0],t=-.1*c.distance_falloff.value,t=c.avg_highlight_percent.value-t*(c.avg_word_length.value-a.length),t=Math.round(a.length*t/100),n=c.min_chars.value,a=a.length,Math.min(Math.max(t,n),a))})}return r}(t.textContent)){0<n.start-e&&(o=document.createTextNode(t.textContent.substring(e,n.start)),a.push(o));var o=document.createElement("b");o.textContent=t.textContent.substring(n.start,n.start+n.highlight),a.push(o),e=n.start+n.highlight}t.textContent.length>e&&(r=document.createTextNode(t.textContent.substring(e,t.textContent.length)),a.push(r));var l,d=document.createElement("span");d.classList.add(i);for(l of a)d.appendChild(l);return d}}(e));f.set(r,e),p.set(e,r),t=void 0,t=e.parentNode,n=e.nextSibling,t.insertBefore(r,n),e.textContent=""}performance.now()}else g()}function e(e){var t=document.createElement("style"),e=(t.setAttribute("type","text/css"),document.createTextNode(e));t.appendChild(e),document.head.appendChild(t)}new MutationObserver(e=>{let t=0;for(var n of e)for(var r of n.removedNodes)t+=function e(t){var n=f.get(t);if(n)return n.textContent=t.textContent,f.delete(t),p.delete(n),1;var r,n=p.get(t);if(n)return t.textContent=n.textContent,n.parentNode&&n.parentNode.removeChild(n),f.delete(n),p.delete(t),1;let a=0;for(r of t.childNodes)a+=e(r);return a}(r);t,N()}).observe(document,{childList:!0,subtree:!0,characterData:!0}),browser.runtime.onMessage.addListener(function(e,t,n){e.settings&&JSON.stringify(e.settings)!==JSON.stringify(c)&&(c=e.settings,h=!0,N())}),e("."+i+" > b {font-weight: bold !important;}"),window.location.hostname.includes("books.googleusercontent.com")&&e("reader-rendered-page {overflow-y: auto !important;}"),browser.runtime.sendMessage({method:"getSettings",data:{}}).then(e=>{c=e,h=!0,N()});