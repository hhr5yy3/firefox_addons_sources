(()=>{"use strict";var e={4056:(e,t,i)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.maxResolution=t.handledVideosPlatform=t.url_belin_api_resources=t.url_belin_api=t.url_belin_resources=t.url_belin=t.url_labo=t.url_frigo=t.url_auth=t.url_keycloack=t.url_api=t.base_url_front=t.VERSION=void 0,i(7505),i(872),i(7466),i(3848);const o=i(7260);let n;i(3734),n=o.config,t.VERSION=null!==(r=n.VERSION)&&void 0!==r?r:"3.50.1",t.base_url_front=n.base_url_front,t.url_api=n.url_api,t.url_keycloack=n.url_keycloack,t.url_auth=t.url_keycloack+"/realms/lde-poplab/protocol/openid-connect",t.url_frigo=t.base_url_front+"/frigo",t.url_labo=t.base_url_front+"/labo/mes-documents",t.url_belin="https://manuelnumeriquemax.belin.education/",t.url_belin_resources="https://resources.manuelnumeriquemax.belin.education/",t.url_belin_api="https://api.manuelnumeriquemax.belin.education/main/v1/nodes/",t.url_belin_api_resources="https://api.manuelnumeriquemax.belin.education/main/v1/resources",t.handledVideosPlatform=["youtube.com/watch","youtube.com/embed","youtu.be/","vimeo.com/","dailymotion.com/"],t.maxResolution=49e6},7466:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.integration-its.poplab.education",url_api:"https://app.integration-its.poplab.education/api",url_keycloack:"https://id.integration-its.poplab.education"}},7505:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"http://localhost:8000",url_api:"http://localhost:8082/api",url_keycloack:"http://auth.poplab.local"}},3848:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.preprod-its.poplab.education",url_api:"https://app.preprod-its.poplab.education/api",url_keycloack:"https://id.preprod-its.poplab.education"}},7260:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.poplab.education",url_api:"https://app.poplab.education/api",url_keycloack:"https://auth.poplab.education"}},872:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.sandbox.poplab.education",url_api:"https://app.sandbox.poplab.education/api",url_keycloack:"https://id.sandbox.poplab.education"}},3734:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={VERSION:"TEST",base_url_front:"https://app.sandbox.poplab.education",url_api:"https://app.sandbox.poplab.education/api",url_keycloack:"https://id.sandbox.poplab.education"}},3892:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinCommon=void 0;const r=i(2688),o=i(4056),n=i(4911),l=i(4393),s=i(8286);t.CaptureBelinCommon=class{constructor(e){this.captureBelin=e}transformHandableUrls(e,t){var i,r;const n=t.find((t=>t.content.url===e.url));return e.url.includes("json://")?`${o.url_belin_resources}${null===(i=n.content.downloadPath)||void 0===i?void 0:i.split(".zip")[0]}/index.html`:e.url.includes("astra://")?`${o.url_belin_resources}${null===(r=n.content.downloadPath)||void 0===r?void 0:r.split("/Astra/")[0]}/Astra/pack/${n.id}.html`:e.url.includes("word://")||e.url.includes("pptx://")?`${o.url_belin_resources}${n.content.downloadPath}`:e.url}removeTags(e,t){let i=e;for(const e of t)i=this.removeTag(i,e);return i}removeTag(e,t){const i=`<${t}`;let r=e.indexOf(i);for(;-1!==r;){const o=e.indexOf(">",r),n=e.slice(r,o+1),l=e.slice(0,r),s=e.slice(o+1);if(n.includes("/>"))e=l+s;else{const i=`</${t}>`,r=e.indexOf(i,o);e=-1!==r?l+e.slice(r+i.length):l+s}r=e.indexOf(i)}return e}isGrainComplexe(e,t){if((0,n.hasSameFileTypeMoreThanOnce)(t))return!0;const i=this.getGrainContentSections(e);for(const e of i)if(e.outerHTML.includes("<table"))return!0;return 1!==i.length&&this.hasMoreThanOneText(i)}removeEmptyTags(e){const t=new RegExp(/<(\w+)(\s*[^>]*)> *<\/\1>/g);let i=e.replace(t,"");for(;t.test(i);)i=i.replace(t,"");return i}hasMoreThanOneText(e){let t=0;for(const i of e)if("RESOURCE"!==i.tagName){let e=this.removeTags(i.innerHTML,["media","img","audio","video","resource"]).replace(new RegExp(/\n/g),"").trim();if(e=this.removeEmptyTags(e),e.length>0&&(t++,t>1))break}return t>1}getGrainContentSections(e){const t=(0,s.createElementFromDomParser)(e).querySelector("topic"),i=[];if(t){const e=t.children;for(const t of e){const e=t;"METADATA"!==e.tagName&&"BELIN-TITLE"!==e.tagName&&"SURTITLE"!==e.tagName&&(e.innerHTML=this.removeTag(e.innerHTML,"metadata"),i.push(e))}}return i}createCredit(e,t,i){let r="";e.images[0]&&(r=r.concat(e.images[0].copyright?e.images[0].copyright:"")),e.videos[0]&&(r=r.concat(e.videos[0].copyright?e.videos[0].copyright:"")),e.audios[0]&&(r=r.concat(e.audios[0].copyright?e.audios[0].copyright:""));const o=`<a href="${window.location.href}">${chrome.i18n.getMessage("voir_manuel_max")}</a> (${t} ${i})`;return r=r?`${r} - ${o}`:o,r}putManuelPageLinkInElement(e){var t,i;if(e.type===l.ElementType.ELEMENT){if(1===e.urls.length){const i=e.urls[0];e.description=null===(t=e.description)||void 0===t?void 0:t.concat(`\n<a href="${i.url}">${i.label}</a>`)}e.type===l.ElementType.ELEMENT&&(e.urls=[new r.UrlMediaObject(window.location.href,window.location.href,"",chrome.i18n.getMessage("voir_manuel_max"))])}else if(e.type===l.ElementType.SECTION&&e.description){const t=`<a href="${window.location.href}">${chrome.i18n.getMessage("voir_manuel_max")}</a>`;e.description.endsWith(t)||(e.description=null===(i=e.description)||void 0===i?void 0:i.concat(`\n${t}`))}}createMetaElement(e){const t={manualId:e.manualId,discipline:e.discipline,niveau:e.level,grainId:e.grainId,pageId:e.pageId};return{editeur:l.Editeur.BELIN,origine:window.location.href,additionalInfo:t}}createMetaDocument(e){const t={manualId:e.manualId,discipline:e.discipline,niveau:e.level,grainId:e.grainId,pageId:e.pageId};return{editeur:l.Editeur.BELIN,origine:window.location.href,additionalInfo:t}}setEditeurForMedias(e){e.getMedias().forEach((e=>e.editeur=l.Editeur.BELIN))}handleMathFormulas(e){let t=e;if(null==t?void 0:t.includes("<latex>")){let e;for(;e=t.match(/<latex>(.*?)<\/latex>/);)t=t.replace("<latex>",`<span data-latex='${e[1]}' data-evaluate='no' data-display='no' data-type='inlineMath'>`),t=t.replace("</latex>","</span>")}return t}}},8286:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createElementFromDomParser=t.sanitize=void 0;const r=i(4056);function o(e,t){for(let i=e.length-1;i>=0;i--){const r=e[i],o=document.createElement(t);o.innerHTML=r.innerHTML,Array.from(r.attributes).forEach((e=>{o.setAttribute(e.name,e.value)})),r.replaceWith(o)}}function n(e){return e=e.replace(/<title>/g,"<belin-title>").replace(/<\/title>/g,"</belin-title>"),(new DOMParser).parseFromString(`<body>${e}</body>`,"text/html").body}t.sanitize=function(e,t){return function(e){const t=n(e);return o(t.querySelectorAll('[style="ordered"]'),"ol"),t.querySelectorAll("ol").forEach((e=>{const t=e.getAttribute("start");if(t){const i=parseInt(t,10)-1;e.style.counterReset="item "+i}})),o(t.querySelectorAll("list"),"ul"),o(t.querySelectorAll("item"),"li"),o(t.querySelectorAll("emphasis"),"i"),t.innerHTML}(e=function(e){const t=n(e);return t.querySelectorAll('[for="teacher"]').forEach((e=>{e.remove()})),t.innerHTML}(e=function(e,t,i){return e=(e=(e=e.replace(new RegExp(/<link/g),"<a")).replace(new RegExp(/<\/link>/g),"</a>")).replace(new RegExp(/uri="topic:\/\//g),`href="${r.url_belin}${t.toLowerCase()}-${i.toLowerCase()}/topics/`)}(e,t.discipline,t.level)))},t.createElementFromDomParser=n},4911:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fromHTML=t.clearHighlight=t.smoothScrollToTargetedHtmlElement=t.hasSameFileTypeMoreThanOnce=t.getCountPerFileType=void 0;const r=i(2688);function o(e){return Object.entries(e.reduce(((e,t)=>{const i=t.type_fichier;return e[i]=(e[i]||0)+1,e}),{})).map((([e,t])=>({typeFichier:e,count:t})))}t.getCountPerFileType=o,t.hasSameFileTypeMoreThanOnce=function(e){const t=o(e);return t.filter((e=>e.count>1)).length>0||2===t.filter((e=>e.typeFichier===r.TypeFichier.IMAGE||e.typeFichier===r.TypeFichier.VIDEO)).length};t.smoothScrollToTargetedHtmlElement=function(e,t=0){const i=document.querySelector(`#${e}`);if(i){const e=function(e){let t=e.parentElement;for(;t;){const e=window.getComputedStyle(t);if("auto"===e.overflowY||"scroll"===e.overflowY)return t;t=t.parentElement}return null}(i);if(e){let r=i.getBoundingClientRect().top+e.scrollTop-t;r>e.scrollHeight-e.getBoundingClientRect().height&&(r=e.scrollHeight-e.getBoundingClientRect().height),s(Math.floor(r),e).then((()=>l(i)))}else{let e=i.getBoundingClientRect().top+window.scrollY-t;const r=function(){const e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)-window.innerHeight-40}();e>r&&(e=r),s(Math.floor(e)).then((()=>l(i)))}}};let n=null;function l(e){n&&n.classList.remove("poplab-highlighted"),n=e;let t=document.getElementById("poplab-highlight-stylesheet");t||(t=document.createElement("style"),t.id="poplab-highlight-stylesheet",t.textContent="\n        .poplab-highlighted {\n            border: solid 8px rgb(75, 198, 185);\n        }",document.head.appendChild(t)),setTimeout((()=>{e.classList.add("poplab-highlighted")}),100)}function s(e,t){return t?t.scrollTo({top:e,behavior:"smooth"}):window.scrollTo({top:e,behavior:"smooth"}),new Promise((i=>{const r=()=>{t?Math.floor(t.scrollTop)!==e&&Math.ceil(t.scrollTop)!==e||(t.removeEventListener("scroll",r),i()):Math.floor(window.scrollY)!==e&&Math.ceil(window.scrollY)!==e||(window.removeEventListener("scroll",r),i())};t?(t.removeEventListener("scroll",r),Math.floor(t.scrollTop)===e||Math.ceil(t.scrollTop)===e?i():t.addEventListener("scroll",r)):(window.removeEventListener("scroll",r),Math.floor(window.scrollY)===e||Math.ceil(window.scrollY)===e?i():window.addEventListener("scroll",r))}))}t.clearHighlight=function(){var e;const t=document.getElementById("poplab-highlight-stylesheet");t&&(null===(e=t.parentNode)||void 0===e||e.removeChild(t))},t.fromHTML=function(e){if(!e)return null;const t=document.createElement("template");t.innerHTML=e;const i=t.content.children;return 1===i.length?i[0]:i}},2688:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentCaptureData=t.ElementCaptureData=t.CaptureData=t.FichierMediaObject=t.ExerciseurMediaObject=t.UrlMediaObject=t.AudioMediaObject=t.VideoMediaObject=t.ImageMediaObject=t.MediaObject=t.TypeFichier=t.CaptureType=void 0;const r=i(4393);var o,n;!function(e){e.BASIQUE="BASIQUE",e.UPLOAD="UPLOAD"}(o||(t.CaptureType=o={})),function(e){e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.FICHIER="FICHIER",e.LIEN="LIEN",e.EXERCISEUR="EXERCISEUR"}(n||(t.TypeFichier=n={}));class l{constructor(e,t,i,r,o,n,l){this.id=e,this.url=t,this.type_fichier=i,this.copyright=r,this.file=o,this.editeur=n,this.subTypeFichier=l}}t.MediaObject=l,t.ImageMediaObject=class extends l{constructor(e,t,i,r,o){super(e,t,n.IMAGE,i,r,o)}},t.VideoMediaObject=class extends l{constructor(e,t,i,r,o){super(e,t,n.VIDEO,i,r,o)}},t.AudioMediaObject=class extends l{constructor(e,t,i,r,o){super(e,t,n.AUDIO,i,r,o)}},t.UrlMediaObject=class extends l{constructor(e,t,i,r){super(e,t,n.LIEN,i),this.displayPreview=!1,this.bigPreview=!1,this.label=r}},t.ExerciseurMediaObject=class extends l{constructor(e,t,i){super(e,t,n.EXERCISEUR),this.typeExerciseur=i}},t.FichierMediaObject=class extends l{constructor(e,t,i,r,o){super(e,t,n.FICHIER,void 0,i,void 0,r),this.label=o}};class s{constructor(e,t,i){this.titre=e,this.description=t,this.auteurInitial=i}}t.CaptureData=s;class a extends s{constructor(e){var t,i,o,n,l,s,a;super(null==e?void 0:e.titre,null==e?void 0:e.description,null==e?void 0:e.auteurInitial),this.type=r.ElementType.ELEMENT,this.images=[],this.videos=[],this.audios=[],this.urls=[],this.exerciseurs=[],this.fichiers=[],this.credit=null==e?void 0:e.credit,this.images=null!==(t=null==e?void 0:e.images)&&void 0!==t?t:[],this.videos=null!==(i=null==e?void 0:e.videos)&&void 0!==i?i:[],this.audios=null!==(o=null==e?void 0:e.audios)&&void 0!==o?o:[],this.urls=null!==(n=null==e?void 0:e.urls)&&void 0!==n?n:[],this.exerciseurs=null!==(l=null==e?void 0:e.exerciseurs)&&void 0!==l?l:[],this.fichiers=null!==(s=null==e?void 0:e.fichiers)&&void 0!==s?s:[],this.type=null!==(a=null==e?void 0:e.type)&&void 0!==a?a:r.ElementType.ELEMENT,this.options=null==e?void 0:e.options,this.meta=null==e?void 0:e.meta}setTitre(e){return this.titre=e,this}setDescription(e){return this.description=e,this}setCredit(e){return this.credit=e,this}setImages(e){return this.images=e,this}setVideos(e){return this.videos=e,this}setAudios(e){return this.audios=e,this}setUrls(e){return this.urls=e,this}setExerciseurs(e){return this.exerciseurs=e,this}setType(e){return this.type=e,this}getMedias(){return this.images.concat(this.videos.concat(this.audios.concat(this.fichiers)))}getAllEmbeds(){return this.getMedias().concat(this.urls).concat(this.exerciseurs)}}t.ElementCaptureData=a,t.DocumentCaptureData=class extends s{constructor(e){super(null==e?void 0:e.titre,null==e?void 0:e.description,null==e?void 0:e.auteurInitial),this.elements=[],null==e||e.elements.forEach((e=>this.elements.push(new a(e)))),this.meta=null==e?void 0:e.meta}setTitre(e){return this.titre=e,this}setDescription(e){return this.description=e,this}setElements(e){return this.elements=e,this}}},1142:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.AuteurInitial=t.Auteur=void 0,t.Auteur=class{constructor(e,t){this.username=e,this.userId=t}},function(e){e.BELIN="© Belin Éducation / Humensis"}(i||(t.AuteurInitial=i={}))},4393:(e,t)=>{var i,r,o,n;Object.defineProperty(t,"__esModule",{value:!0}),t.Editeur=t.ElementType=t.ExerciseurType=t.PoplabElementCreationRequest=void 0,t.PoplabElementCreationRequest=class{constructor(e,t){var r,n,l;this.titre=null!==(r=e.titre)&&void 0!==r?r:"",this.description=null!==(n=e.description)&&void 0!==n?n:"",this.type=e.type,this.options={isnew:!0,separator:!1},this.type!==o.SECTION||this.titre||(this.options.separator=!0),this.credits=null!==(l=e.credit)&&void 0!==l?l:"",this.webAuteurInitial=e.auteurInitial,this.imageEmbed=e.images[0]?{url:e.images[0].url,type:i.IMAGE}:void 0,this.videoEmbed=e.videos[0]?{url:e.videos[0].url,type:i.VIDEO}:void 0,this.audioEmbed=e.audios[0]?{url:e.audios[0].url,type:i.AUDIO}:void 0,this.lienEmbed=e.urls[0]?{url:e.urls[0].url,label:e.urls[0].label,displayPreview:e.urls[0].displayPreview,bigPreview:e.urls[0].bigPreview,type:i.LIEN}:void 0,this.exerciseur=e.exerciseurs[0]?{url:e.exerciseurs[0].url,exerciseurType:e.exerciseurs[0].typeExerciseur,type:i.EXERCISEUR}:void 0,t&&(this.document=t),this.meta=e.meta}},function(e){e.LIEN="LIEN",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.FICHIER="FICHIER",e.EXERCISEUR="EXERCISEUR"}(i||(i={})),function(e){e.QUIZLET="QUIZLET",e.LEARNINGAPPS="LEARNINGAPPS",e.GENIALLY="GENIALLY",e.BOOKWIDGETS="BOOKWIDGETS",e.EDUPOOL="EDUPOOL",e.BELIN="BELIN"}(r||(t.ExerciseurType=r={})),function(e){e.ELEMENT="element",e.SECTION="section"}(o||(t.ElementType=o={})),function(e){e.BELIN="https://www.belin-education.com/"}(n||(t.Editeur=n={}))}},t={};function i(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,i),n.exports}(()=>{i(2688);const e=i(3892);i(1142);e.CaptureBelinCommon})()})();