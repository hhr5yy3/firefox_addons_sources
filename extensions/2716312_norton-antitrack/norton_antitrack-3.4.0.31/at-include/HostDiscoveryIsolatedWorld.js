(()=>{let e;var t;(t=e||(e={})).GET_MAINFRAME_SETTINGS="GET_MAINFRAME_SETTINGS",t.GET_SUBFRAME_SETTINGS="GET_SUBFRAME_SETTINGS",t.TRACKER_FINGERPRINTING="TRACKER_FINGERPRINTING",t.NEW_HOSTS_DISCOVERED="NEW_HOSTS_DISCOVERED",t.PROTECTION_APPLIED="PROTECTION_APPLIED";function n(e){if("LINK"===e.tagName){const t=e.attributes?.getNamedItem("rel")?.value;if(t&&(t.includes("preconnect")||"publisher"===t||"canonical"===t||"alternate"===t||"author"===t))return!1}return"A"!==e.tagName}function r(e){const t=[];if(!e.attributes)return t;const s=e.attributes.getNamedItem("src")??e.attributes.getNamedItem("href");return s&&n(e)&&t.push(s.value),e.childNodes&&e.childNodes.forEach((e=>{if(e){r(e).forEach((e=>t.push(e)))}})),t}let s;var i;(i=s||(s={}))[i.OneSecond=1e3]="OneSecond",i[i.TwoSeconds=2e3]="TwoSeconds",i[i.OneMinute=6e4]="OneMinute";let o=0,a=new Set;function c(e){const t=r(document.documentElement);t.length>0&&u(t),e===s.OneMinute&&o++,o<=5&&window.setTimeout((()=>{c(Math.min(2*e,s.OneMinute))}),e)}function u(t){const n=Array.isArray(t)?t:[t],r=new Set;n.forEach((e=>{const t=function(e){if(e.startsWith("//"))e="https:"+e;else if(e.startsWith("/"))return;try{const t=new URL(e);if(t.hostname)return t.hostname}catch{}}(e);t&&!a.has(t)&&r.add(t)})),r.size>0&&(window.browser.runtime.sendMessage({id:e.NEW_HOSTS_DISCOVERED,hostNames:Array.from(r)}),a=new Set([...a,...r]))}let d=0,E=!1;const N=()=>{E||(E=!0,c(s.OneSecond))},m=e=>{u(e.detail.urlStr)};const S=new MutationObserver((e=>{e.forEach((e=>{if("childList"===e.type)e.removedNodes.forEach((e=>{if("attributes"in e){const t=e;if(t){const e=t.attributes.getNamedItem("src")?.value??t.attributes.getNamedItem("href")?.value;e&&u(e)}}}));else{const t=e.target;if(t&&e.attributeName){const r=t.attributes.getNamedItem(e.attributeName)?.value;r&&n(t)&&u(r)}}}))}));window.addEventListener("DOMContentLoaded",N),d=window.setTimeout(N,s.TwoSeconds),window.addEventListener("NewHostDiscovered",m),S.observe(document.documentElement,{childList:!0,attributes:!0,subtree:!0,attributeFilter:["src","href"]})})();
//# sourceMappingURL=HostDiscoveryIsolatedWorld.js.map
