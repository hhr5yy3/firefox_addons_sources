import{a as V}from"../chunks/chunk-5SH53EW4.js";import{a as H}from"../chunks/chunk-3REBBJSH.js";import{c as q}from"../chunks/chunk-L4RDDWJP.js";import{a as G}from"../chunks/chunk-XD5O2TNZ.js";import{c as z,d as K,e as F}from"../chunks/chunk-6V4PETGI.js";import{b as v}from"../chunks/chunk-IJLSJJ7U.js";import{e as O}from"../chunks/chunk-LG525BKV.js";import"../chunks/chunk-WOENBU2A.js";import{a as $}from"../chunks/chunk-W32UHEZE.js";import"../chunks/chunk-4GJAJKDK.js";import"../chunks/chunk-HGJD3ZUF.js";import"../chunks/chunk-JDV5FZKX.js";import{a as R}from"../chunks/chunk-FVPQGETT.js";import{a as A}from"../chunks/chunk-Z64FBUPL.js";import{a as E}from"../chunks/chunk-KWDMUJJA.js";import"../chunks/chunk-MT4LVDUX.js";import{a as rt}from"../chunks/chunk-WN4MFSKN.js";import{a as I}from"../chunks/chunk-7S3YJSN5.js";import{a as d}from"../chunks/chunk-QUFHRGH2.js";import"../chunks/chunk-BODFWMPN.js";import{K as L,M as k,a as w,d as P,e as T,f as m}from"../chunks/chunk-LADTODTA.js";import{a as U}from"../chunks/chunk-O4TFJKJQ.js";import{B as l,c as f,m as B,r as M,v as u}from"../chunks/chunk-WRHUMLYF.js";import"../chunks/chunk-AC7VHEB5.js";import"../chunks/chunk-HY2GWXPO.js";import"../chunks/chunk-XSKOAVIS.js";import{q as b}from"../chunks/chunk-OEPSEZ5A.js";import"../chunks/chunk-XERCZVWP.js";import"../chunks/chunk-AT6M4CEW.js";import{e as s}from"../chunks/chunk-3GYLW4KZ.js";var tt=s(U()),p=s(b());var ft=s(w()),X=s(w()),g=s(rt()),j=s(U()),e=s(b());var r=s(m()),W="activateMirageNotification",x,N,D=class extends X.Component{constructor(...t){super(...t),this.state={hideNotification:!0}}componentDidMount(){let t=e.default.get(this.props.view,"actions",[]);e.default.each(t,i=>{let n=e.default.get(i,"type");["openNonLoyaltyUrl","openUrl"].includes(n)&&(x=e.default.get(i,"props.domain"),n==="openUrl"&&(N=e.default.get(i,"props.vendorMetaId")))}),l("page","mirageNotification",{view:"mirageNotification",type:"notification",destDomain:x,vendorMetaId:N});let o=Number(e.default.get(this.props.view,"launchDelayMS"))||1e3;setTimeout(()=>{this.setState({hideNotification:!1})},o)}render(){let{hideNotification:t}=this.state,{image:o,heading:i,subheading:n,cta:c}=this.props.view,y=!0;return t||l("page","mirageNotificationShown",{view:"mirageNotification",type:"notification",destDomain:x,vendorMetaId:N}),(0,r.jsx)(R,{className:t?"disabled mirage-notification":"mirage-notification",style:{top:"0",bottom:"auto",left:y?"auto":"0",right:y?"0":"auto"},children:(0,r.jsx)(g.Motion,{style:{opacity:(0,g.spring)(t?0:1,{stiffness:180,damping:20}),y:(0,g.spring)(t?-100:0,{stiffness:180,damping:20})},dragSelector:"header",isDraggable:M("ext_notif_drag"),onDragEnd:this.trackFirstDragEnd,children:({opacity:nt,y:at})=>(0,r.jsxs)("div",{className:"mirage-notification-content",style:{transform:`translate3d(0,${at}%,0)`,opacity:`${nt}`},children:[(0,r.jsxs)("header",{children:[(0,r.jsx)(I,{width:120}),(0,r.jsx)(q,{}),(0,r.jsx)(E,{onClick:this.onClosePopup.bind(this,"x")})]}),(0,r.jsxs)("section",{children:[e.default.get(o,"src")?(0,r.jsx)("div",{className:"notification-image-wrapper",style:e.default.get(o,"wrapperStyle"),children:(0,r.jsx)("div",{className:"notification-image",style:{backgroundImage:`url("${e.default.get(o,"src")}")`,...e.default.get(o,"style",{})}})}):null,(0,r.jsx)("h2",{style:e.default.get(i,"style"),children:e.default.get(i,"value")}),(0,r.jsx)("h4",{style:e.default.get(n,"style"),children:e.default.get(n,"value","")}),(0,r.jsx)("div",{className:"button-wrapper",children:(0,r.jsx)("button",{className:"primary-btn-large",style:e.default.get(c,"style"),onClick:this.onClickCTA.bind(this),children:e.default.get(c,"value")})})]})]})})})}trackFirstDragEnd=e.default.once((t,o)=>{H("mirageNotification",t,o)});async onClickCTA(){let{clickId:t,redirectId:o}=A();e.default.map(e.default.get(this.props.view,"actions"),i=>{let n=e.default.get(i,"props.vendorMetaId")||this.props.view.vendorMetaId;if(["openNonLoyaltyUrl","openUrl"].includes(i.type)&&e.default.get(i,"props.href")){let c=i.type==="openUrl"?this.getRedirectUrl(i,o,n):e.default.get(i,"props.href");window.open(c)}else if(i.type==="track")l("trackClick",i.event||W,"",e.default.assign({clickId:t,redirectId:o,vendorMetaId:n},i.props));else if(i.type==="click")(0,j.default)(i.selector).click();else if(i.type==="pinnedTab"){let c=this.getRedirectUrl(i,o,n);this.pinnedTab(t,c)}}),this.setState({hideNotification:!0}),this.throttleNotif()}onClosePopup(t){this.setState({hideNotification:!0}),l("trackClick","dismissMirageNotification",t),this.throttleNotif()}throttleNotif(){let t=u();d({domain:t,message:"throttle"})}async pinnedTab(t,o){try{V({url:o})}catch{}}getRedirectUrl(t,o,i){let n=e.default.get(t,"props.channel","cashback");return B({params:{channel:n,clickEvent:W,credits:n==="cashback"||n==="cashback-ims",destUrl:e.default.get(t,"props.href"),destDomain:e.default.get(t,"props.destDomain")||e.default.get(t,"props.domain"),redirectId:o,subExperience:e.default.get(t,"props.subExperience")||"mirage_notification",vendorMetaId:i},isWbPublisher:!0})}},C=T({view:["mirageNotification"],events:["events"],session:["session"]},D);var h=s(w()),J=s(b());var Y=s(m());async function st(a,t){let o=f.get("siteAPIData"),i={rootEl:"div",logLevel:null},n={siteAPIData:o,providedData:t,...(0,J.pick)(t,["throttleDurationMS","throttleKey"])},c=await G();return{config:i,content:a,data:n,...c}}var Q=({content:a,providedData:t,onUnload:o})=>{let[i,n]=(0,h.useState)();return(0,h.useEffect)(()=>{st(a,t).then(c=>n(c)).catch(console.error)},[]),i?(0,Y.jsx)(z,{config:i.config,content:i.content,host:i.host,user:i.user,data:i.data,onEvent:c=>K(c,o),onRequest:F}):null};var _=s(m());window.__wb_timing.mirageNoteRequireAt=performance.now();var it;function ct(){it?.()}var S;async function et(a){if(!a)return;let t=document;if(t.deweyParser=tt.default,t.html=document.documentElement.innerHTML,await v.evaluateIdentifierTree(a,t))return!0}async function ot(a){if(S)return;let t=await O({deweyResult:a}),o=p.default.get(t,"throttleDurationMs");if(!await d({domain:u(),message:"checkThrottled",throttleDurationMs:o})&&!S){if(S=!0,typeof t?.blocksTemplate=="string"&&t.blocksTemplate.length){let{blocksTemplate:n,blocksData:c}=t;it=(await k({initialRoute:"/blocksNotification",blankSlate:!0,app:(0,_.jsx)(L,{children:(0,_.jsx)(Q,{content:n,providedData:c,onUnload:ct})}),disableDelay:!0})).unloadApp}else if(t&&!t.error&&(p.default.get(t,"heading.value")||p.default.get(t,"subheading.value")||p.default.get(t,"cta.value"))){if(p.default.get(t,"skipNotification")===!0){l("track","mirageNotificationSkipped");return}f.set("mirageNotification",t),k({initialRoute:"/mirageNotification",cssUrl:"mirageNotification.css",route:(0,_.jsx)(P,{path:"mirageNotification",component:C})})}}}async function Z(){try{let{siteData:a}=await $(),t=f.get(["deweyResult"]),o=await et(p.default.get(a,"mirageNotification.identifiers"));t&&o?await ot(t):pt(a)}catch(a){console.log(a)}}function pt(a){v.emitter.on("result",async t=>{await et(p.default.get(a,"mirageNotification.identifiers"))&&await ot(t)})}document.readyState!=="loading"?Z():document.addEventListener("DOMContentLoaded",Z);
