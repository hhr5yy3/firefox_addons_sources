var index001=function(){"use strict";function e({maxActiveReader:e=1/0}={}){let t,n,r=0;const o={read:e=>c(e,!1),write:e=>c(e,!0),length:0};return o;function c(e,r){const c=function({fn:e,block:t=!1,prev:n,next:r,q:o=l(),q2:c=(e.length?l():null)}){return{fn:e,block:t,prev:n,next:r,q:o,q2:c}}({fn:e,block:r});return n?(n.next=c,c.prev=n,n=c,t||(t=n)):t=n=c,o.length++,s(),c.q.promise}function l(){const e={};return e.promise=new Promise(((t,n)=>{e.resolve=t,e.reject=n})),e}function s(){const c=t;if(!c||c.block&&c.prev||c.prev&&c.prev.block||r>=e)return;let l;c.block||r++,t=c.next;try{l=c.fn(c.q2&&c.q2.resolve)}catch(e){return c.q.reject(e),void i()}if(c.q2&&c.q2.promise.then(u),l&&l.then){const e=l.then(c.q.resolve,c.q.reject);c.q2||e.then(i)}else if(c.q.resolve(l),!c.q2)return void i();function i(){u()}function u(e){c.prev&&(c.prev.next=c.next),c.next&&(c.next.prev=c.prev),n===c&&(n=c.prev),c.block||r--,o.length--,e&&e(),s()}s()}}return{a:function(t){const n=new Map;return{read:(e,t)=>r(e,t,"read"),write:(e,t)=>r(e,t,"write"),locks:n};async function r(r,o,c){const l=[],s=[];for(const o of r){let r=n.get(o);r||(r=e(t),n.set(o,r));const i={lock:r,scope:o,relase:null};s.push(r[c]((e=>{i.release=e}))),l.push(i)}let i;await Promise.all(s);try{i=o(o.length&&u)}catch(e){throw u(),e}return i&&i.then?(o.length||i.then(u,u),await i):(o.length||u(),i);function u(){for(const e of l)e.release((()=>{e.lock.length||n.delete(e.scope)}));l.length=0}}},c:e}}();
//# sourceMappingURL=index-BmprrkjV.js.map
