(()=>{"use strict";chrome.browserAction;const e={username:"a2epfq5ugq0u",password:"ptkx3fqg6v7n"},t="https://1vpn.org",o=(chrome.i18n.getUILanguage(),()=>{chrome.storage.local.get(["isConnected","currentLocation"],(e=>{e.isConnected&&(chrome.action.setBadgeBackgroundColor({color:"#22c774"}),chrome.action.setBadgeTextColor({color:"#fff"}),chrome.action.setBadgeText({text:e.currentLocation.countryCode.substring(0,2).toUpperCase()}))}))}),r=async(e,o)=>{const r=async(t,n=!1)=>{try{return await fetch(`${t}/${e}/`,o)}catch(e){if(console.log(e),n)throw e;return await r("https://1vpn.website",!0)}};return await r(t)},n=e=>new Promise(((t,o)=>{const r=new URL(e.url).hostname;["localhost","127.0.0.1"].includes(r)?t({type:"direct"}):chrome.storage.local.get(["isConnected","currentLocation"],(e=>{if(e.isConnected){const o=e.currentLocation.hosts[0];t({type:"https",host:o.hostname,port:o.port})}else t({type:"direct"})}))})),s=[{country:"Australia",countryCode:"au",isPremium:!0},{country:"Brazil",countryCode:"br",isPremium:!0},{country:"Canada",countryCode:"ca",isPremium:!0},{country:"Chile",countryCode:"cl",isPremium:!0},{country:"France",countryCode:"fr",isPremium:!0},{country:"Germany",countryCode:"de",hosts:[{hostname:"germany-free-1.cloudcdnflare.site",port:443},{hostname:"germany-free-2.cloudspacecdn.site",port:443}],latitude:50.119,longitude:8.7147},{country:"India",countryCode:"in",isPremium:!0},{country:"Japan",countryCode:"jp",isPremium:!0},{country:"South Korea",countryCode:"kr",isPremium:!0},{country:"Mexico",countryCode:"mx",isPremium:!0},{country:"Netherlands",countryCode:"nl",isPremium:!0},{country:"Poland",countryCode:"pl",isPremium:!0},{country:"Singapore",countryCode:"sg",isPremium:!0},{country:"South Africa",countryCode:"za",isPremium:!0},{country:"Spain",countryCode:"es",isPremium:!0},{country:"Sweden",countryCode:"se",isPremium:!0},{country:"United Kingdom",countryCode:"uk",isPremium:!0},{country:"USA East",countryCode:"use",isPremium:!0},{country:"USA South",countryCode:"uss",isPremium:!0},{country:"USA West",countryCode:"usw",hosts:[{hostname:"usa-west-free-1.cloudcdnflare.site",port:443},{hostname:"usa-west-free-2.cloudspacecdn.site",port:443}],latitude:34.0541,longitude:-118.2441}],c=()=>{chrome.storage.local.set({isConnected:!1}),chrome.action.setBadgeText({text:""});const e=["messages"];chrome.storage.local.get(null,(t=>{const o=Object.keys(t).filter((t=>!e.includes(t)));o.length&&chrome.storage.local.remove(o),chrome.storage.local.set({currentLocation:s.at(-1)})}))},a=e=>{const t={apply:(t,o,r)=>{const n=r[0];return r[0]=t=>{const o=t=>{Object.defineProperty(t,"latitude",{value:e.latitude?+e.latitude:null}),Object.defineProperty(t,"longitude",{value:e.longitude?+e.longitude:null}),Object.defineProperty(t,"speed",{value:null}),Object.defineProperty(t,"heading",{value:null}),Object.defineProperty(t,"accuracy",{value:2e4}),Object.defineProperty(t,"altitude",{value:null}),Object.defineProperty(t,"altitudeAccuracy",{value:null})};"timestamp"in t&&Object.defineProperty(t,"timestamp",{value:Date.now()}),"coords"in t&&(o(t.coords),o(GeolocationCoordinates.prototype)),n(t)},t.apply(o,r)}};window.navigator?.geolocation&&(Object.getPrototypeOf(navigator.geolocation).getCurrentPosition=new Proxy(Object.getPrototypeOf(navigator.geolocation).getCurrentPosition,t),Object.getPrototypeOf(navigator.geolocation).watchPosition=new Proxy(Object.getPrototypeOf(navigator.geolocation).watchPosition,t))};chrome.runtime.onInstalled.addListener((e=>{o(),"install"===e.reason&&chrome.tabs.create({url:chrome.runtime.getURL("install.html")})})),chrome.runtime.onStartup.addListener(o),chrome.webRequest.onAuthRequired.addListener(((t,o)=>{const r=()=>new Promise(((t,o)=>{chrome.storage.local.get(["isPremium","username","sessionAuthToken"],(r=>{if(chrome.runtime.lastError)o(new Error(chrome.runtime.lastError));else{const o=r.isPremium?{username:r.username,password:r.sessionAuthToken}:e;t({authCredentials:o})}}))}));return r()}),{urls:["<all_urls>"]},["blocking"]),browser.proxy.onRequest.addListener(n,{urls:["<all_urls>"]}),chrome.alarms.create("fetchUserData",{periodInMinutes:360}),chrome.alarms.onAlarm.addListener((e=>{chrome.storage.local.get(["sessionAuthToken"],(t=>{t.sessionAuthToken&&"fetchUserData"===e.name&&r("api/refresh_token",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Token "+t.sessionAuthToken}}).then((async e=>{if(!e.ok){const t=await e.json();throw c(),t}return e.json()})).then((e=>{chrome.storage.local.set(e)})).catch((e=>{console.error("Error:",e)}))}))})),chrome.webNavigation.onCommitted.addListener((e=>{e.url?.startsWith("chrome://")||e.url?.startsWith("chrome-extension://")||e.url?.startsWith("https://chromewebstore.google.com/")||chrome.storage.local.get(["spoofGeolocation","isConnected","currentLocation"],(t=>{t.spoofGeolocation&&t.isConnected&&t.currentLocation&&chrome.scripting.executeScript({target:{tabId:e.tabId,allFrames:!0},world:"MAIN",injectImmediately:!0,func:a,args:[{latitude:t.currentLocation.latitude,longitude:t.currentLocation.longitude}]})}))})),chrome.runtime.onMessage.addListener(((e,t,o)=>{if("popupOpened"===e.type)return chrome.storage.local.get(["sessionAuthToken","username"],(e=>{const t=e.sessionAuthToken?"Token "+e.sessionAuthToken:null;r("get_user_data",{method:"POST",headers:{"Content-Type":"application/json",...t&&{Authorization:t}}}).then((e=>e.json())).then((t=>{t.username?chrome.storage.local.set(t):e.username&&c()})).catch((e=>{console.error("Error fetching user data:",e)}))})),!0}))})();