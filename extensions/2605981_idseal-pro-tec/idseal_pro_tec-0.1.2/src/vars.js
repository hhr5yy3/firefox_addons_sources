browser.browserAction.setBadgeBackgroundColor({color:"#F46B1C"}),browser.browserAction.setBadgeText({text:""}),browser.browserAction.disable();var Whitelist={Url:"foo",WhiteListType:"bar",Timestamp:123,Removed:!1};function SendToDesktop(e,t){socketSendMessage({Browser:"FIREFOX",Command:e,Value:t})}function MergeWhitelist(e){if(Array.isArray(Whitelist)&&0!=Whitelist.length){let t=[];for(ix=0;ix<Whitelist.length;++ix){currentItem=Whitelist[ix];let o=e.find(e=>e.Url==currentItem.Url);o?(o.Removed&&o.Timestamp>currentItem.Timestamp||currentItem.Removed&&currentItem.Timestamp>o.Timestamp||o.Removed&&currentItem.Removed?t.push(ix):currentItem.Removed&&(currentItem.Removed=!1),currentItem.WhiteListType!=o.WhiteListType&&o.Timestamp>currentItem.Timestamp&&(currentItem.WhiteListType=o.WhiteListType,currentItem.Timestamp=getTimestamp())):currentItem.Removed&&t.push(ix)}t.forEach(e=>{Whitelist.splice(e,1)}),e.forEach(e=>{currentItem=Whitelist.find(t=>t.Url==e.Url),currentItem||Whitelist.push(e)})}else Whitelist=e;browser.storage.sync.set({whitelist:Whitelist},function(){}),SendToDesktop("MERGEDWHITELIST",Whitelist)}function AddNewDomain(e,t){if(wlDomain=Whitelist.find(t=>t.Url==e),void 0==wlDomain){let o={Url:e,Timestamp:getTimestamp(),WhiteListType:t,Removed:!1};Whitelist.push(o)}else wlDomain.Removed&&(wlDomain.Removed=!1),1==wlDomain.WhiteListType&&(wlDomain.WhiteListType=t),(2==wlDomain.WhiteListType&&3==t||3==wlDomain.WhiteListType&&2==t)&&(wlDomain.WhiteListType=0),wlDomain.Timestamp=getTimestamp()}function RemoveDomainFromWhitelist(e,t){for(var o=Whitelist.length-1;o>=0;--o)if(Whitelist[o].Url==e){if(Whitelist[o].WhiteListType==t)Whitelist[o].Removed=!0,Whitelist[o].WhiteListType=1;else if(0==Whitelist[o].WhiteListType)Whitelist[o].WhiteListType=3==t?2:3;else if(1==Whitelist[o].WhiteListType)continue;Whitelist[o].Timestamp=getTimestamp();break}}function isEmpty(e){if(null==e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;if("object"!=typeof e)return!0;for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0}function IsDomainWhitelisted(e,t){return!isEmpty(Whitelist)&&("tracking"==t?Whitelist.find(t=>t.Url==e&&!t.Removed&&(0==t.WhiteListType||2==t.WhiteListType)):Whitelist.find(t=>t.Url==e&&!t.Removed&&(0==t.WhiteListType||3==t.WhiteListType)))}browser.storage.sync.get("whitelist",function(e){void 0!=e.whitelist&&MergeWhitelist(e.whitelist)}),Date.prototype.getWeek=function(){var e=new Date(this.getTime());e.setHours(0,0,0,0),e.setDate(e.getDate()+3-(e.getDay()+6)%7);var t=new Date(e.getFullYear(),0,4);return 1+Math.round(((e.getTime()-t.getTime())/864e5-3+(t.getDay()+6)%7)/7)},Array.prototype.remove=function(){for(var e,t,a=arguments,o=a.length;o&&this.length;)for(e=a[--o];-1!==(t=this.indexOf(e));)this.splice(t,1);return this};var json,date={get today(){return this.day+"/"+this.month+"/"+this.year},get day(){return(new Date).getDate()},get week(){return(new Date).getWeek()},get month(){return(new Date).getMonth()+1},get year(){return(new Date).getFullYear()}},windowItem=function(CurrentDomain,CurrentSession){this.CurrentDomain=CurrentDomain,this.CurrentSession=CurrentSession},Preventer={},ActiveTab={},AdBlockToday=0,x=15896,DEBUG=0,domain1="N/A",domain2="N/A",domain3="N/A",domain4="N/A",all_time=0,this_year=0,this_month=0,this_week=0,this_day=0,counter1=0,counter2=0,counter3=0,counter4=0,progress1=0,progress2=0,progress3=0,progress4=0,blockedObject={domains:[],date:[],list:[]};function session(e,t,o){this.tabId=e,this.counter=t,this.domain=o}var tabSessions=new Object,__PRIMARY_DOMAIN_STORAGE=new Object,_$=!1,TrackingBlocker=!0,AdBlocker=!1;browser.storage.sync.get("TrackingEnabled",function(e){switch(e.Enabled){case!0:TrackingBlocker=!0,GenerateFingerprint();break;case!1:TrackingBlocker=!1}}),browser.storage.sync.get("AdBlocker",function(e){switch(e.AdBlocker){case!0:EnableAdBlocker();break;case!1:DisableAdBlocker()}}),browser.storage.sync.get(["_$","exp"],function(e){if(e._$){var t=e.exp^x;new Date(1e3*t).getTime()<=(new Date).getTime()?(_$=!1,startTrial()):startPremium()}else startTrial()}),browser.storage.local.get(["whitelist"],function(e){Whitelist=e});var urlOpened=[],newID=RandomString();function randomIntFromInterval(e,t){return Math.floor(Math.random()*(t-e)+e)}function RandomString(){for(var e="",t="abcdefghijklmnopqrstuvwxyz",o=0;o<5;o++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function GenerateFingerprint(){data={},data.r=10-randomIntFromInterval(0,30),data.g=10-randomIntFromInterval(0,30),data.b=10-randomIntFromInterval(0,30),data.a=10-randomIntFromInterval(0,30);var e=JSON.stringify(data);return localStorage.data=e,md5(e).substring(0,10)}function SPACE(e){var t;for(t in localStorage)2*(localStorage[t].length+t.length)}function wait(e){for(var t=(new Date).getTime(),o=t;o<t+e;)o=(new Date).getTime()}var queue__modules__=function(){var e=[];return{Enqueue:function(t){e.push(t),this.Dequeue()},Dequeue:function(){for(;0!=e.length;)e.shift()}}}(),cookiesToPush=[];function ProcessSendingQueue(e){queue__modules__.Enqueue(e)}var blockedTabData={},AlreadyBlocked=function(e,t){if(void 0!=blockedTabData[e]){var o=!1;return(n=blockedTabData[e]).forEach(function(e){e===t&&(o=!0)}),o||(n.push(t),blockedTabData[e]=n),o}var n;return(n=[]).push(t),blockedTabData[e]=n,!1};function Statistics_Reader_Domains(){if(webSocketClient.isConnected)void 0!==json&&(counter1=json.IssueCount[0],counter2=json.IssueCount[1],counter3=json.IssueCount[2],counter4=json.IssueCount[3],domain1=PrepareDomainForGUI(json.Domain[0]),domain2=PrepareDomainForGUI(json.Domain[1]),domain3=PrepareDomainForGUI(json.Domain[2]),domain4=PrepareDomainForGUI(json.Domain[3]),all_time=json.Total,this_year=json.Year,this_month=json.Month,this_week=json.Week,this_day=json.Today);else for(var e=blockedObject.list.length-1;e>=0;e--){for(var t=0,o=PrepareDomainForGUI(blockedObject.list[e]),b=blockedObject.domains.length-1;b>=0;b--)e===blockedObject.domains[b]&&blockedObject.date[e]==date.today&&(t+=1);t>counter1?(counter1=t,domain1=o):t>counter2&&t<counter1?(counter2=t,domain2=o):t>counter3&&t<counter2?(counter3=t,domain3=o):t>counter4&&t<counter3&&(counter4=t,domain4=o)}"NaN"!==this_day&&void 0!==this_day&&(progress1=Math.round(counter1/this_day*100),progress2=Math.round(counter2/this_day*100),progress3=Math.round(counter3/this_day*100),progress4=Math.round(counter4/this_day*100))}var PrepareDomainForGUI=function(e){if(void 0!=e&&"newtab"!=e){var t=e.split(".");if(void 0===t)return"N/A";var o=t[t.length-2];return void 0===o?"N/A":(o.length>9&&(o=o.substring(0,8),o+=".."),o.charAt(0).toUpperCase()+o.substring(1,o.length))}return"N/A"};function Block(e,t,o){var n=tabSessions[t];if(void 0===n?(n=0,tabSessions[t]=+n+1):tabSessions[t]=+n+1,ActiveTab[o]===t){Preventer[o].CurrentSession=n;try{-1!==t&&0!==n&&(browser.browserAction.setBadgeText({tabId:t,text:n.toString()}),UpdatePopupData())}catch(e){console.log(e)}}webSocketClient.isConnected||(0===blockedObject.list.length&&(blockedObject.list=[],blockedObject.list.push(e)),blockedObject.list.includes(e)||blockedObject.list.push(e),blockedObject.domains.push(blockedObject.list.indexOf(e)),blockedObject.date.push(date.today),++all_time,++this_year,++this_month,++this_week,++this_day,saveBlocked(),Statistics_Reader_Domains())}function saveBlocked(){setTimeout(function(){browser.storage.local.set({all_time:all_time},function(){}),browser.storage.local.set({this_year:this_year},function(){}),browser.storage.local.set({this_month:this_month},function(){}),browser.storage.local.set({this_week:this_week},function(){}),browser.storage.local.set({this_day:this_day},function(){}),browser.storage.local.set({year:date.year},function(){}),browser.storage.local.set({month:date.month},function(){}),browser.storage.local.set({week:date.week},function(){}),browser.storage.local.set({today:date.today},function(){}),browser.storage.local.set({blockedObject:blockedObject},function(){})},200)}function saveChanges(){browser.storage.sync.set({EnabledTracking:TrackingBlocker,EnabledAdblock:AdBlocker},function(){})}function LoadData(e,t){browser.storage.local.get(e,function(e){t(e)})}browser.storage.local.get("blockedObject",function(e){if(void 0!=e.blockedObject){for(var t=(blockedObject=e.blockedObject).list.length-1;t>=0;t--){for(var o=0,n=PrepareDomainForGUI(blockedObject.list[t]),b=blockedObject.domains.length-1;b>=0;b--)t===blockedObject.domains[b]&&blockedObject.date[t]==date.today&&(o+=1);o>counter1?(counter1=o,domain1=n):o>counter2&&o<counter1?(counter2=o,domain2=n):o>counter3&&o<counter2?(counter3=o,domain3=n):o>counter4&&o<counter3&&(counter4=o,domain4=n)}if("NaN"===this_day||void 0===this_day)return;progress1=Math.round(counter1/this_day*100),progress2=Math.round(counter2/this_day*100),progress3=Math.round(counter3/this_day*100),progress4=Math.round(counter4/this_day*100)}}),browser.storage.local.get("AdBlockToday",function(e){void 0!==e.AdBlockToday&&(AdBlockToday=e.AdBlockToday)}),browser.storage.local.get("all_time",function(e){void 0!=e.all_time&&(all_time=e.all_time)}),browser.storage.local.get(["this_year","this_month","this_week","this_day"],function(e){void 0!=e.this_year&&void 0!=e.this_month&&void 0!=e.this_week&&void 0!=e.this_day&&(this_year=e.this_year,this_month=e.this_month,this_week=e.this_week,this_day=e.this_day)}),browser.storage.local.get(["year","month","week","today"],function(e){0!=e.length&&(date.year!=e.year&&(this_year=0),date.month!=e.month&&(this_month=0),date.week!=e.week&&(this_week=0),date.today!=e.today&&(this_day=0,AdBlockToday=0))}),browser.tabs.query({active:!0},function(e){for(var t=0;t<e.length;t++){var o=e[t];ActiveTab[o.windowId]=o.id;var n=new URL("https://"+eRoot(o.url)),i=new windowItem(n.hostname,0);i.CurrentDomain=n.hostname,Preventer[o.windowId]=i}}),browser.runtime.onMessage.addListener(onMessage),browser.windows.onCreated.addListener(onWindowCreated),browser.windows.onRemoved.addListener(onWindowRemoved),browser.tabs.onCreated.addListener(onTabsCreated),browser.tabs.onActivated.addListener(onTabsActivated),browser.tabs.onUpdated.addListener(onTabsUpdated),browser.tabs.onRemoved.addListener(onTabsRemoved),browser.browserAction.setBadgeText({text:""});var millisecondsPerWeek=6048e5,oneWeekAgo=(new Date).getTime()-millisecondsPerWeek;function RemoveTracker(e){browser.cookies.getAll({domain:e},function(e){e.forEach(function(e){browser.cookies.remove({url:"https://"+e.domain,name:e.name})})})}function _SET_LICENCE_EXPIRED(){var e=(new Date).getTime()^x;return browser.storage.sync.set({exp:e},function(){}),!0}