import{a as T,b as $}from"./chunk-3DLX7NOK.js";import{B as d,c as a,f as _,m as P,r as S,v as m,x as o}from"./chunk-WRHUMLYF.js";import{R as A,S as H,d as g,j as v,p as V,q as x,r as O}from"./chunk-OEPSEZ5A.js";import{e as b}from"./chunk-3GYLW4KZ.js";var y=async t=>o("activatePinnedTab",t);function h(){return a.get(["sameTabRedirectDomains"])?.includes(m())}V();var f=b(x()),R=b(O());H();$();var E=b(x());var N=t=>{let{pageViewId:e,domain:i}=t,n=E.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"]);return o("affiliateLinkMonitorSetup",{startingLocation:n,pageViewId:e,domain:i})};var k=t=>o("competitorCashbackCacheGet",{domain:m(),comp:t});var l=t=>o("competitorCashbackCacheRemove",{domain:m(),comp:t});var U=t=>o("dismissCashback",t);var C=(t,e)=>o("domainLocalStorageSet",{domain:m(),key:t,value:e});var L=()=>o("getCashback");function w(t,e,i,n,{redirect:s=!1,cashback:r=!1,...p}={}){let c,u;if(window.__wb_contentId){switch(t){case"cashbackNotification":c="cashback";break;case"couponNotification":case"couponNotificationResult":c="coupons";break;case"siteHubOffers":c="sitehub";break}c&&(u=window.__wb_contentId[c])}d("track","desktopExtensionClick",{name:t,label:e?.toLowerCase(),type:i,subType:n,cashback:r,redirect:s,...p,contentId:u})}var M=t=>o("checkIfInEbayPriceComparison",t);async function I(t){if(t==="ebay.com")return M()}function Lt(){U()}async function Mt(){let t=!1;if(J())return!1;let e=await L();return e&&f.default.get(e,"reward.amount")&&(t=e),t}function Vt(t){let e={[t]:Date.now()},i=f.default.cloneDeep(a.get(["events"]));i=f.default.merge(i,e),a.set(["events"],i),_(t)}async function Ot(t){let e={rakuten:"rakuten",honey:"honey",rmn:"rmn"},i=await k(e.honey),n=await k(e.rakuten),s=await k(e.rmn),r="";i&&(r="honey"),s&&(r="rmn"),n&&(r="rakuten"),chrome.storage.local.set({[`${r}WarningNotif-${t}`]:T()},()=>{n&&l(e.rakuten),i&&l(e.honey),s&&l(e.rmn),r===""&&l(r)})}async function F({clickId:t,coupons:e,codeEntered:i,fromAutoRun:n,fromActivateRewards:s,isSiteHub:r}={}){let p=m();a.set(["couponsAffiliateDisabledSites",`${p}_${a.get("tabId")}`],v(g(new Date,30)));let c=t||R.default.v4().replace(/-/g,"");return y({pageViewId:a.get("pageViewId"),clickId:c,domain:p,coupons:e,codeEntered:i,programId:a.get(["siteAPIData","programId"]),vendorMetaId:a.get("cashback","id"),fromAutoRun:n,fromActivateRewards:s,isSiteHub:r})}async function G(){let t=m();if(h()||document.URL.includes("shop.app")){let u=a.get("pageViewId");await N({pageViewId:u,domain:t})}await Promise.all([C("affiliateRedirect",JSON.stringify({redirected:!0,location:location.href})),C("emailCreateAccount",JSON.stringify({shouldLoadNotification:!0}))]),a.set(["couponsAffiliateDisabledSites",`${t}_${a.get("tabId")}`],v(g(new Date,30)));let e=R.default.v4().replace(/-/g,""),i,n=a.get("siteAPIData","tld"),s="cashback",r=await I(t);r&&(s="cashback-ims");let p={destUrl:location.href,channel:s,subExperience:"credits",redirectId:A(e),sameTab:!0,vendorMetaId:a.get("cashback","id"),clickEvent:"cashbackRedirect",...!r&&{destDomain:n}};i=P({params:p});let c={affiliateUrl:i,pageViewId:a.get("pageViewId"),clickId:e,domain:t,preventPinnedTab:!S("also_pin_202401_test"),vendorMetaId:a.get("cashback","id"),programId:a.get(["siteAPIData","programId"])};return y(c),c}async function $t({reward:t,pageLocation:e,view:i,label:n}={}){d("trackClick","activateCashback","activate",{rewardAmount:t.amount,rewardDisplay:t.type,label:n,view:i,pageLocation:e}),w(e==="sitehub"?"siteHubOffers":i==="cashbackReactivate"?"rewardsReactivation":"cashbackNotification",n,"cta","primary",{redirect:!0,cashback:!!t.amount,rewardAmount:t.amount,rewardDisplay:t.type,view:i});let s=a.get(["siteAPIData"]),r=a.get(["deweyResult"]),p=f.default.get(r,"pageData.meta"),c=!0;if(p&&f.default.has(p,"disable_aff_link_current_tab")&&(c=!1),c&&(f.default.get(s,"meta.affiliate_link_current_tab")||h())){let D=await G();return d("track","activateCashbackRedirect",f.default.assign({rewardAmount:t.amount,rewardDisplay:t.type,view:i},D)),location.href=D.affiliateUrl,{isRedirectEnabled:!0}}a.set(["cashbackView","user","activating"],!0),a.set(["cashback","user","activating"],!0),a.set(["offers","cashback","user","activating"],!0);let u=await F();return a.set(["cashbackView","user","activated"],!0),a.set(["cashback","user","activated"],!0),a.set(["offers","cashback","user","activated"],!0),d("track","activateCashbackRedirect",f.default.assign({rewardAmount:t.amount,rewardDisplay:t.type,view:i},u)),{isRedirectEnabled:!1}}function J(){let t=[/weightwatchers\.com\/us\/shop/];return!!f.default.find(t,e=>e.test(document.URL))}export{w as a,y as b,N as c,C as d,h as e,I as f,Lt as g,Mt as h,Vt as i,Ot as j,F as k,G as l,$t as m};
