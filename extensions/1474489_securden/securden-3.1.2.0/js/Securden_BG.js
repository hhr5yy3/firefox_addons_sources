this.browser=function(){return this.msBrowser||this.browser||this.chrome}();var userAgent=navigator.userAgent.toLowerCase();-1===userAgent.indexOf("firefox/")&&importScripts("./Securden_utils.js");var Securden_BG={username:null,password:null,url:null,topDomain:null,iframeDomain:null,is_submit:null,accountTitle:null,serverUrl:null,org_name:null,tabId:null,frameurl:null,formSubmitted:!1,submittedFormRootDomain:null,productVersion:null,isAutoFilled:!1,autoFillLaunchedFromPlugin:!1,currentTabId:null,account_id:null,is_personal_enabled:!0,save_account_form_shown:!1,only_personal_enabled:!1,validateTicketIdForPasswordFill:!1,validateTicketIdShowErrorInWindow:!1,validateTicketIdFromWebUI:!1,showAddNewFormInSamePage:!1,addOrUpdateFormShown:!1,ticketID:null,getIfAccountExists:!0,showGeneratedPasswordInsideDiv:!1,folderStructureAllowedInWebPageSave:!1,folders:null,recordedEvents:null,eventRecords:{},isRecording:!1,remainingSeconds:0,recordingTab:null,recordActionCount:1,init:function(){if(Securden_BG.clearValues(),"firefox"==SecurdenExtensionUtils.getBrowserName())browser.storage.sync.get(["org_name","serverUrl"],(function(e){e.org_name;var r=e.serverUrl;if(null!=r&&null!=r){Securden_BG.serverUrl=r,Securden_BG.sendRequest({action:"is_browser_extension_api_available",onSuccessFunc:"serverUrlPingSuccess",onFailureFunc:"serverUrlPingError"})}}));else try{browser.storage.managed.get(["DefaultSecurdenServerUrl"],(function(e){var r=e.DefaultSecurdenServerUrl;null!=r&&null!=r?(Securden_BG.serverUrl=r,Securden_BG.sendRequest({action:"is_browser_extension_api_available",onSuccessFunc:"serverUrlPingSuccess",onFailureFunc:"serverUrlPingError"})):browser.storage.sync.get(["org_name","serverUrl"],(function(e){e.org_name;var r=e.serverUrl;if(null!=r&&null!=r){Securden_BG.serverUrl=r,Securden_BG.sendRequest({action:"is_browser_extension_api_available",onSuccessFunc:"serverUrlPingSuccess",onFailureFunc:"serverUrlPingError"})}}))}))}catch(e){console.log("Error in getting DefaultSecurdenServerUrl"),browser.storage.sync.get(["org_name","serverUrl"],(function(e){e.org_name;var r=e.serverUrl;if(null!=r&&null!=r){Securden_BG.serverUrl=r,Securden_BG.sendRequest({action:"is_browser_extension_api_available",onSuccessFunc:"serverUrlPingSuccess",onFailureFunc:"serverUrlPingError"})}}))}browser.storage.sync.get(["productVersion"],(function(e){var r=e.productVersion;null!=r&&null!=r&&(Securden_BG.productVersion=r)}));try{browser.tabs.onActivated.addListener((function(e){Securden_BG.currentTabId=e.tabId}))}catch(e){console.log("Error in adding onRemoved BG listener")}try{browser.tabs.onRemoved.addListener((function(e){Securden_BG.currentTabId==e&&Securden_BG.clearValues()}))}catch(e){console.log("Error in adding onRemoved BG listener")}Securden_BG.disablePasswordSaveInBrowser();try{browser.runtime.onMessage.addListener(Securden_BG.processRequest)}catch(e){console.log("Error in adding onMessage BG listener")}},clearValues:function(){Securden_BG.clearLoginData(),Securden_BG.clearExtraBGValues()},clearExtraBGValues:function(){Securden_BG.url=null,Securden_BG.topDomain=null,Securden_BG.iframeDomain=null,Securden_BG.accountTitle=null,Securden_BG.frameurl=null,Securden_BG.tabId=null,Securden_BG.formSubmitted=!1,Securden_BG.submittedFormRootDomain=null,Securden_BG.isAutoFilled=!1,Securden_BG.autoFillLaunchedFromPlugin=!1,Securden_BG.save_account_form_shown=!1,Securden_BG.currentTabId=null,Securden_BG.account_id=null,Securden_BG.ticketID=null,Securden_BG.is_personal_enabled=!0,Securden_BG.only_personal_enabled=!1,Securden_BG.folderStructureAllowedInWebPageSave=!1,Securden_BG.folders=null,Securden_BG.eventRecords={}},clearLoginData:function(){Securden_BG.account_id=null,Securden_BG.accountTitle=null,Securden_BG.accounts=null,Securden_BG.username=null,Securden_BG.password=null,Securden_BG.is_submit=null},processRequest:function(e,r,n){var s=e.action;null!=(I=e.data)&&null!=I||(I={});var c=void 0!==r.tab&&void 0!==r.tab.id&&-1!==r.tab.id?r.tab.id:-1,a=-1!==c?c:I.tabId,u=!0;switch(null!=a&&null!=a&&(Securden_BG.currentTabId=a),s){case"autoLoginFromExtension":Securden_BG.autoFillLaunchedFromPlugin=!0,Securden_BG.disablePasswordSaveInBrowser(),SecurdenExtensionUtils.sendMessage(a,"autoLogin",I);break;case"setAutologinDetails":Securden_BG.username=I.username,Securden_BG.password=I.password,Securden_BG.url=I.url,Securden_BG.is_submit=I.is_submit;break;case"getAccountDetailsForLogin":var t=Securden_BG.account_id,o=null!=I.urlDomain?I.urlDomain:Securden_BG.url,d={};null!=t&&null!=t&&(d.account_id=t),d.url=o,Securden_BG.resetFlags(),Securden_BG.validateTicketIdFromWebUI=!0;s="get_username_password_for_account";var i="getUserNamePasswordSuccess",l=SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("REASON_FOR_PASSWORD_RETRIEVAL",Securden_BG.productVersion),_=SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("TICKETING_SYSTEM",Securden_BG.productVersion);SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("FORM_FIELD_SAVE",Securden_BG.productVersion)?(s="get_new_username_password_for_account_with_field_mapping",i="showTicketIdDiv"):l?(s="get_new_username_password_for_account_2",i="showTicketIdDiv"):_&&(s="get_new_username_password_for_account",i="showTicketIdDiv");Securden_BG.sendRequest({action:s,data:d,onSuccessFunc:i,onSuccessFuncArg:{dont_show_error:!0}}),Securden_BG.account_id=null;break;case"clearLoginData":Securden_BG.clearLoginData();break;case"get_server_url_to_set":if("firefox"==SecurdenExtensionUtils.getBrowserName())browser.storage.sync.get(["org_name","serverUrl"],(function(e){var r=e.org_name,n=null;null!=e.serverUrl&&(n=e.serverUrl);var s={serverUrl:n,org_name:r};SecurdenExtensionUtils.sendMessage(null,"setServerUrlDetails",s)}));else try{browser.storage.managed.get(["DefaultSecurdenServerUrl"],(function(e){var r=null,n={};SecurdenExtensionUtils.isParamValid(e)?e.DefaultSecurdenServerUrl?(r=e.DefaultSecurdenServerUrl,n.serverUrl=r,SecurdenExtensionUtils.sendMessage(null,"setServerUrlDetails",n)):browser.storage.sync.get(["org_name","serverUrl"],(function(e){var r=e.org_name,n=null;null!=e.serverUrl&&(n=e.serverUrl);var s={serverUrl:n,org_name:r};SecurdenExtensionUtils.sendMessage(null,"setServerUrlDetails",s)})):browser.storage.sync.get(["org_name","serverUrl"],(function(e){var r=e.org_name,n=null;null!=e.serverUrl&&(n=e.serverUrl);var s={serverUrl:n,org_name:r};SecurdenExtensionUtils.sendMessage(null,"setServerUrlDetails",s)}))}))}catch(e){browser.storage.sync.get(["serverUrl"],(function(e){var r=null,n={};null!=e.serverUrl&&(r=e.serverUrl),n.serverUrl=r,SecurdenExtensionUtils.sendMessage(null,"setServerUrlDetails",n)}))}break;case"get_username_for_login":browser.storage.sync.get(["username"],(function(e){var r=null;null!=e.username&&(r=e.username),SecurdenExtensionUtils.sendMessage(null,"setUserNameInLoginPage",r)}));break;case"get_server_url":u=Securden_BG.serverUrl;break;case"set_enabled_icon":var S=!0;Securden_BG.changeBrowserIcon(S);break;case"set_disabled_icon":S=!1;Securden_BG.changeBrowserIcon(S);break;case"set_server_url":Securden_BG.setServerUrl(I.serverUrl);break;case"set_org_name":Securden_BG.setOrgName(I.org_name);break;case"clear_org_name":Securden_BG.clearOrgName();break;case"saveDetailsForAccountForm":var g=r.tab.url;Securden_BG.tabId=r.tab.id,Securden_BG.url=I.frameurl,Securden_BG.frameurl=I.frameurl,Securden_BG.topDomain=SecurdenExtensionUtils.getDomain(g);var B=SecurdenExtensionUtils.getDomain(I.frameurl),G=I.username,m=I.password;null!=Securden_BG.iframeDomain&&SecurdenExtensionUtils.getRootDomain(B)!=SecurdenExtensionUtils.getRootDomain(Securden_BG.iframeDomain)&&(Securden_BG.username=null,Securden_BG.password=null,Securden_BG.iframeDomain=null),Securden_BG.iframeDomain=B,Securden_BG.username=null!=G?G:Securden_BG.username,Securden_BG.password=null!=m?m:Securden_BG.password,Securden_BG.accountTitle=B+" - "+Securden_BG.username,Securden_BG.submittedFormRootDomain=B,Securden_BG.formSubmitted=!0,Securden_BG.save_account_form_shown=!1,Securden_BG.showAddNewFormInSamePage=!0,Securden_BG.showAddNewAccountForm();break;case"showAddNewAccountForm":Securden_BG.showAddNewFormInSamePage=!1,Securden_BG.showAddNewAccountForm();break;case"getNewAccountDetails":var v=!1;SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("NEVER_SAVE_WEBSITE_CREDENTIALS",Securden_BG.productVersion)&&(v=!0);var E={account_id:Securden_BG.account_id,account_title:Securden_BG.accountTitle,accounts:Securden_BG.accounts,account_name:Securden_BG.username,password:Securden_BG.password,url:Securden_BG.url,serverUrl:Securden_BG.serverUrl,is_personal_enabled:Securden_BG.is_personal_enabled,only_personal_enabled:Securden_BG.only_personal_enabled,never_save_allowed:v,product_version:Securden_BG.productVersion,is_folder_needed_for_add_account:Securden_BG.folderStructureAllowedInWebPageSave,folders:Securden_BG.folders,work_text:Securden_BG.workText};u=E;break;case"getDataForCurrentURL":Securden_BG.serverUrl||SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"showDataForUrl",null);var b=I.windowUrl;Securden_BG.frameurl=b;o=SecurdenExtensionUtils.getDomain(b);var w=SecurdenExtensionUtils.getURLWithProtocol(b),I={url_root_domain:o};SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("IP_ADDRESS_IN_AUTOFILL",Securden_BG.productVersion)&&(I.complete_url=w),Securden_BG.resetFlags(),Securden_BG.validateTicketIdShowErrorInWindow=!0;s="get_account_data_for_url",i="addAccountDataForUrlSuccess";var f="addAccountDataForUrlError",p="GET";if(_=SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("TICKETING_SYSTEM",Securden_BG.productVersion)){var F=["TICKETING_SYSTEM"];(l=SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("REASON_FOR_PASSWORD_RETRIEVAL",Securden_BG.productVersion))&&(F=["TICKETING_SYSTEM","ENFORCE_REASON_ON_PASSWORD_RETRIEVE"]);var U=[];"string"==typeof F?U.push(F):U=F,I.conf_keys=JSON.stringify(U),s="get_account_data_for_url_with_conf_values",i="showTicketIdDiv",f="errorMsgFunction",p="POST",SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("TICKETING_SYSTEM_CHECK_WITHOUT_ACCOUNT_IN_CONF_VALUES",Securden_BG.productVersion)||(i="getAccountIdAndSendRequestAgain")}Securden_BG.sendRequest({action:s,data:I,type:p,onSuccessFunc:i,onFailureFunc:f});break;case"getAccountPassword":Securden_BG.username=I.username,Securden_BG.is_submit=I.is_submit,Securden_BG.account_id=I.account_id,Securden_BG.resetFlags(),Securden_BG.validateTicketIdForPasswordFill=!0,Securden_BG.getAccountPassword(I.account_id,I.url_domain);break;case"getTotp":t=I.account_id;Securden_BG.getTotp(t);break;case"getIfFormSubmittedAndDetailsSaved":var T={formSubmitted:Securden_BG.formSubmitted,storedTabId:Securden_BG.tabId,currentTabId:Securden_BG.currentTabId,submittedFormRootDomain:Securden_BG.submittedFormRootDomain,isAutoFilled:Securden_BG.isAutoFilled,autoFillLaunchedFromPlugin:Securden_BG.autoFillLaunchedFromPlugin,save_account_form_shown:Securden_BG.save_account_form_shown};u=T;break;case"clearBGValues":Securden_BG.clearValues();break;case"clearExtraBGValues":Securden_BG.clearExtraBGValues();break;case"saveNewAccountDetails":var x=I.account_title?I.account_title:Securden_BG.accountTitle;Securden_BG.accountTitle=x;var A={account_title:x,account_name:Securden_BG.username,password:Securden_BG.password,ipaddress:Securden_BG.url,personal_account:I.is_personal_account};I.folder_id&&(A.folder_id=I.folder_id),Securden_BG.clearLoginData(),SecurdenExtensionUtils.sendMessage(a,"removeIFrameInCS"),Securden_BG.sendRequest({action:"add_new_account",data:A,type:"POST",onSuccessFunc:"addNewAccountSuccess",onFailureFunc:"addNewAccountError"});break;case"updateAccountDetails":I={account_id:Securden_BG.account_id,account_title:Securden_BG.accountTitle,account_name:Securden_BG.username,password:Securden_BG.password,ipaddress:Securden_BG.url};Securden_BG.clearLoginData(),SecurdenExtensionUtils.sendMessage(a,"removeIFrameInCS"),Securden_BG.sendRequest({action:"update_password",data:I,type:"POST",onSuccessFunc:"updatePasswordSuccess",onFailureFunc:"updatePasswordError"});break;case"updateWorkPersonalAccountDetails":var R={account_title:Securden_BG.accountTitle,account_name:Securden_BG.username,password:Securden_BG.password,ipaddress:Securden_BG.url};I.is_personal_account?R.account_id=Securden_BG.personal_account_id_to_update:R.account_id=Securden_BG.work_account_id_to_update,I.account_id&&(R.account_id=I.account_id),Securden_BG.clearLoginData(),SecurdenExtensionUtils.sendMessage(a,"removeIFrameInCS"),Securden_BG.sendRequest({action:"update_password",data:R,type:"POST",onSuccessFunc:"updatePasswordSuccess",onFailureFunc:"updatePasswordError"});break;case"updateAllWorkPersonalAccountDetails":(R={account_title:Securden_BG.accountTitle,account_name:Securden_BG.username,password:Securden_BG.password,ipaddress:Securden_BG.url}).account_ids=JSON.stringify(I.account_ids),Securden_BG.clearLoginData(),SecurdenExtensionUtils.sendMessage(a,"removeIFrameInCS"),Securden_BG.sendRequest({action:"update_all_password",data:R,type:"POST",onSuccessFunc:"updatePasswordSuccess",onFailureFunc:"updatePasswordError"});break;case"neverSaveAccountDetails":var h={url:SecurdenExtensionUtils.getRootDomain(SecurdenExtensionUtils.getDomain(Securden_BG.url))};Securden_BG.clearLoginData(),SecurdenExtensionUtils.sendMessage(a,"removeIFrameInCS"),Securden_BG.sendRequest({action:"blacklist_site",data:h,type:"POST",onSuccessFunc:"updatePasswordSuccess",onFailureFunc:"updatePasswordError"});break;case"removeIFrame":Securden_BG.clearValues(),SecurdenExtensionUtils.sendMessage(a,"removeIFrameInCS");break;case"set_product_version":Securden_BG.setProductVersion(I.productVersion);break;case"get_product_version":u=Securden_BG.productVersion;break;case"setIsAutoFilled":Securden_BG.isAutoFilled=!0;break;case"setIsLaunchedFromPlugin":Securden_BG.autoFillLaunchedFromPlugin=!0;break;case"set_user_name_domain":G=I.username;var k=I.domain_id;browser.storage.sync.set({username:G},(function(){})),browser.storage.sync.set({domain_id:k},(function(){}));break;case"setSaveAccountFormShownVariable":Securden_BG.showAddNewFormInSamePage||(Securden_BG.save_account_form_shown=!0);break;case"set_account_id_and_url":Securden_BG.account_id=I.account_id,Securden_BG.url=I.urlDomain,Securden_BG.currentTabId=I.currentTabId,Securden_BG.resetFlags(),Securden_BG.validateTicketIdForPasswordFill=!0,Securden_BG.getPasswordForLaunchFromPlugin=!0,I.openNewTab||Securden_BG.getAccountPassword(I.account_id,I.urlDomain);break;case"validateTicketId":SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("AUTOFILL_AUDIT_REASON",Securden_BG.productVersion)&&(I.is_from_autologon=!0),SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("AUTOFILL_URLS",Securden_BG.productVersion)||delete I.url_domain;s="get_account_password_auto_submit_status",l=SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("REASON_FOR_PASSWORD_RETRIEVAL",Securden_BG.productVersion),_=SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("TICKETING_SYSTEM",Securden_BG.productVersion);l?s="get_new_account_password_and_status_2":_&&(s="get_new_account_password_and_status"),Securden_BG.sendRequest({action:s,data:I,onSuccessFunc:"getAccountPasswordSuccess",onFailureFunc:"errorMsgFunction"});break;case"get_if_browser_extension_available":return async function(e){if(SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("AUTOFILL_URLS",Securden_BG.productVersion)){u={enabled:!0,is_url_available:!1};var r={url_root_domain:I.urlDomain},n="get_account_data_for_url";SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("URL_DETAILS",Securden_BG.productVersion)&&(n="get_url_details");var s=await Securden_BG.sendRequest({action:n,data:r});s&&s.result&&s.result.mapped_field_for_url&&s.result.mapped_field_for_url.length>0?u.mapped_field_for_url=s.result.mapped_field_for_url:s&&s.result&&s.result.fill_icon_in_all_inputs&&(s.result.no_matching_accounts||(u.is_url_available=!0)),s&&s.result&&s.result.work_text&&(Securden_BG.workText=s.result.work_text),u.server_url=Securden_BG.serverUrl}else SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("BLOCK_EXTENSION",Securden_BG.productVersion)?(u=!1,SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("NEW_ENABLE_BROWSER_EXTENSION_URL",Securden_BG.productVersion)?SecurdenExtensionUtils.featureBlocked("ENABLE_BROWSER_EXTENSION",Securden_BG.serverUrl)&&(u=!0):u=!0):u=!0;e({data:u})}(n),!0;case"generatePasswordInsideDiv":Securden_BG.showGeneratedPasswordInsideDiv=!0;case"generatePassword":Securden_BG.sendRequest({action:"get_generated_password",onSuccessFunc:"generatePasswordSuccess",onFailureFuncFile:"errorMsgFunction"});break;case"save_search_text":Securden_BG.saveSearchText(I.searchText);break;case"get_search_text":browser.storage.sync.get(["searchText"],(function(e){var r=null;null!=e.searchText&&(r=e.searchText),SecurdenExtensionUtils.sendMessage(null,"setSearchTextAndGetAccounts",r)}));break;case"get_window_url":SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"getWindowUrl",{});break;case"setWindowUrl":SecurdenExtensionUtils.sendMessage(null,"setWindowUrlForAddAccount",I.currentUrl);break;case"get_window_form_fields":SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"getFormFields",{});break;case"setFormFields":SecurdenExtensionUtils.sendMessage(null,"setFormFieldsForSave",I.formFields);break;case"save_work_text":I&&(Securden_BG.workText=I.workText);break;case"get_recorded_inputs":browser.storage.sync.get(["recordedInputs"],(function(e){var r=null;null!=e.recordedInputs&&(r=e.recordedInputs),SecurdenExtensionUtils.sendMessage(null,"sendRecordedInputs",r)}));break;case"formFieldRecord":Securden_BG.eventRecords={},Securden_BG.isRecording=!0,Securden_BG.remainingSeconds=0,Securden_BG.recordingTab=Securden_BG.currentTabId;I={isRecording:Securden_BG.isRecording};SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"recording",I);break;case"timer_opened":SecurdenExtensionUtils.sendMessage(null,"timer_opened_success");break;case"checkRecordInStorage":browser.storage.sync.get("recordedInputs",(function(e){if(e.recordedInputs){var r=e.recordedInputs,n={recordedUrl:Object.values(r)[0].currentUrlDomain};SecurdenExtensionUtils.sendMessage(null,"recordStored",n)}}));break;case"deleteRecordInStorage":browser.storage.sync.remove("recordedInputs"),SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"stopRecordimmediately",I),Securden_BG.isRecording=!1,Securden_BG.remainingSeconds=0,Securden_BG.recordingTab=null,SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"removeIFrameInCS"),Securden_BG.clearValues();break;case"recordEvent":Securden_BG.processRecordedEvents(I);break;case"stopRecord":SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"stopRecordimmediately",I),Securden_BG.isRecording=!1,Securden_BG.remainingSeconds=0,Securden_BG.recordingTab=null,Securden_BG.recordActionCount=1;break;case"seconds_when_reloded":Securden_BG.remainingSeconds=I.seconds;case"send_remaining_seconds":E={time:Securden_BG.remainingSeconds};u=E;break;case"getIfRecordedDataAvailable":if(Securden_BG.isRecording&&Securden_BG.recordingTab==Securden_BG.currentTabId){I={isRecording:Securden_BG.isRecording};SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"recording",I)}break;case"storeClick":browser.storage.sync.set({reload_store:I},(function(){}));break;case"moveRecordIframe":SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"moveRecordIframeInCS",{});break;case"reloadContentScript":browser.tabs.reload(Securden_BG.currentTabId);break;case"returnStoreClick":browser.storage.sync.get(["reload_store"],(function(e){null!=e.reload_store&&(u=e.reload_store),setTimeout((function(){SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"startFillAfterReload",u),browser.storage.sync.remove("reload_store")}),2e3)}))}n({data:u})},generatePasswordSuccess:function(e){var r={password:e.password};r.showGeneratedPasswordInsideDiv=Securden_BG.showGeneratedPasswordInsideDiv,Securden_BG.showGeneratedPasswordInsideDiv=!1,SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"showGeneratedPassword",r)},getAccountIdAndSendRequestAgain:function(e){if(e&&e.result&&e.result.TICKETING_SYSTEM)if(e.result.account_id){var r={account_id:e.result.account_id};SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("AUTOFILL_AUDIT_REASON",Securden_BG.productVersion)&&(r.is_from_autologon=!0),Securden_BG.resetFlags(),Securden_BG.sendRequest({action:"get_new_account_password_and_status",data:r,onSuccessFunc:"showTicketIdDiv",onFailureFunc:"errorMsgFunction"})}else Securden_BG.showTicketIdDiv(e);else Securden_BG.showTicketIdDiv(e)},getTotp:function(e){var r={account_id:e};Securden_BG.sendRequest({action:"get_totp_start_value_server",data:r,onSuccessFunc:"sendTotp"})},sendTotp:function(e){var r=e;SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"fillTotp",r)},getAccountPassword:function(e,r){var n={account_id:e};SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("AUTOFILL_AUDIT_REASON",Securden_BG.productVersion)&&(n.is_from_autologon=!0),SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("AUTOFILL_URLS",Securden_BG.productVersion)&&null!=r&&null!=r&&(n.url_domain=r);var s="get_account_password_auto_submit_status",c="getAccountPasswordSuccess",a="errorMsgFunction",u=SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("REASON_FOR_PASSWORD_RETRIEVAL",Securden_BG.productVersion),t=SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("TICKETING_SYSTEM",Securden_BG.productVersion);if(SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("FORM_FIELD_SAVE",Securden_BG.productVersion))s="get_account_details_with_field_mapping",c="showTicketIdDiv";else if(u)s="get_new_account_password_and_status_2",c="showTicketIdDiv";else if(t)s="get_new_account_password_and_status",c="showTicketIdDiv";else{if(Securden_BG.getPasswordForLaunchFromPlugin)s="get_username_password_for_account",c="getUserNamePasswordSuccess",a=void 0,n={account_id:n.account_id,url:Securden_BG.url}}Securden_BG.sendRequest({action:s,data:n,onSuccessFunc:c,onFailureFunc:a})},getUserNamePasswordSuccess:function(e){var r={};if(null!=e){var n=e.password,s=null!=e.is_auto_submit_enabled&&e.is_auto_submit_enabled,c=!1,a={};if(SecurdenExtensionUtils.isParamValid(e.fill_values)?(a=SecurdenExtensionUtils.basicChecksBeforePasswordAccess(e.password_fill_status),c=!0):a=SecurdenExtensionUtils.basicChecksBeforePasswordAccess(e),a.is_valid)c?r=e:(e.username&&(r.username=e.username),n&&(r.password=n)),r.is_submit=s,setTimeout((function(){if(SecurdenExtensionUtils.isParamValid(r.username)||SecurdenExtensionUtils.isParamValid(r.password)||SecurdenExtensionUtils.isParamValid(r.fill_values)){var e=!1;Securden_BG.validateTicketIdFromWebUI?null==Securden_BG.account_id&&(e=!0):!Securden_BG.getPasswordForLaunchFromPlugin&&Securden_BG.addOrUpdateFormShown||(e=!0),e&&(Securden_BG.disablePasswordSaveInBrowser(),SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"fillAccountPasswordFromExtension",r),Securden_BG.autoFillLaunchedFromPlugin=!0,Securden_BG.resetFlags())}}),2e3);else{var u={success:!1,message:a.error_msg,error_msg_timeout:a.error_msg_timeout};SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"showSubmitStatusMsg",u)}}},serverUrlPingSuccess:function(e){if(e&&e.product_version&&(Securden_BG.productVersion=e.product_version),e&&!e.show_login_page){Securden_BG.changeBrowserIcon(!0)}},serverUrlPingError:function(e){Securden_BG.changeBrowserIcon(!1)},updatePasswordSuccess:function(e){var r={success:!0,message:e.message};SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"showSubmitStatusMsg",r),Securden_BG.currentTabId=null,Securden_BG.clearValues()},updatePasswordError:function(e){Securden_BG.errorMsgFunction(e),Securden_BG.currentTabId=null,Securden_BG.clearValues()},getAccountExistsSuccess:function(e){Securden_BG.getIfAccountExists=!0;var r=!0,n={};if(e&&e.account_status_result){var s=e.account_status_result,c=null,a=SecurdenExtensionUtils.getDomain(Securden_BG.iframeDomain),u=SecurdenExtensionUtils.getRootDomain(a),t=SecurdenExtensionUtils.getRootDomainWithoutPort(a),o=s.blacklisted_sites,d=s.account_save_page_enabled;Securden_BG.folderStructureAllowedInWebPageSave=s.is_folder_needed_for_add_account,Securden_BG.folders=s.folders,Securden_BG.accountTitle=null!=s.account_title&&null!=s.account_title?s.account_title:Securden_BG.accountTitle;var i=!0;if(SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("ACCOUNT_SAVE_PROMPT",Securden_BG.productVersion)&&!d&&(i=!1),null!=o&&null!=o){(o.indexOf(a)>-1||o.indexOf(u)>-1)&&(i=!1);const e=o.filter((e=>e.includes(a))),r=o.filter((e=>e.includes(u))),n=o.filter((e=>e.includes(t)));(e.length>0||r.length>0||n.length>0)&&(i=!1)}if(s.is_exists&&s.update_password&&s.password_change_available)SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("UPDATE_WORK_ACCOUNT_PASSWORD",Securden_BG.productVersion)?s.accounts&&s.update_password?(Securden_BG.accounts=s.accounts,c="addUpdateWorkPersonalAccountForm",n.accounts_length=s.accounts.length):(Securden_BG.account_id=s.account_id,c="addUpdateAccountForm"):s.is_personal_account&&s.is_personal_enabled&&(Securden_BG.account_id=s.account_id,c="addUpdateAccountForm");else i&&(!s.is_exists&&s.is_account_add_enabled?(s.is_personal_enabled?Securden_BG.is_personal_enabled=!0:Securden_BG.is_personal_enabled=!1,c="addNewAccountForm",n.is_folder_needed_for_add_account=Securden_BG.folderStructureAllowedInWebPageSave):s.is_exists||s.is_account_add_enabled||!s.is_personal_enabled||(Securden_BG.only_personal_enabled=!0,c="addNewAccountForm",n.is_folder_needed_for_add_account=Securden_BG.folderStructureAllowedInWebPageSave));null!=c&&(r=!1,Securden_BG.addOrUpdateFormShown=!0,SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,c,n))}r&&Securden_BG.clearValues()},getAccountExistsFailure:function(){Securden_BG.getIfAccountExists=!0},getAccountPasswordSuccess:function(e){var r=null;Securden_BG.validateTicketIdForPasswordFill&&(r=e.result),null!=r&&null!=r||(r=e.conf_values),null!=r&&null!=r||(r=e);var n=!1,s={},c="";SecurdenExtensionUtils.isParamValid(e.fill_values)?(r=e,s=SecurdenExtensionUtils.basicChecksBeforePasswordAccess(e.password_fill_status),n=!0):(s=SecurdenExtensionUtils.basicChecksBeforePasswordAccess(r),null!=(c=r.username)&&null!=c||(c=Securden_BG.username));var a=Securden_BG.is_submit;Securden_BG.clearLoginData();var u={};s.is_valid||(u={success:!1,message:s.error_msg,error_msg_timeout:s.error_msg_timeout}),Securden_BG.validateTicketIdShowErrorInWindow&&!s.is_valid?SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"showSubmitStatusMsg",u):n?(r.is_submit=a,Securden_BG.disablePasswordSaveInBrowser(),SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"fieldMappingFill",r)):(null!=a&&null!=a||(r.is_auto_submit_enabled,a=r.is_auto_submit_enabled),r.username=c,r.is_submit=a,Securden_BG.disablePasswordSaveInBrowser(),SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"fillAccountPasswordInField",r)),Securden_BG.resetFlags()},errorMsgFunction:function(e){var r=e&&e.responseJSON&&null!=e.responseJSON.message?e.responseJSON.message:null;null!=r&&null!=r||(r=e&&null!=e.message?e.message:browser.i18n.getMessage("error_in_processing_request"));var n=e&&e.responseJSON&&null!=e.responseJSON.additional_info?e.responseJSON.additional_info:null;if(null==n&&(n=e&&null!=e.additional_info?e.additional_info:null),n&&n.logged_out){var s={server_url:Securden_BG.serverUrl,product_version:Securden_BG.productVersion,logged_out:!0};SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"showDataForUrl",s)}else if(Securden_BG.validateTicketIdShowErrorInWindow||Securden_BG.validateTicketIdFromWebUI){s={success:!1,message:r};SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"showSubmitStatusMsg",s)}else SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"showErrorMessage",{error_msg:r});Securden_BG.currentTabId=null,Securden_BG.resetFlags()},addAccountDataForUrlSuccess:function(e){var r={};if(e&&e.result){var n=e.result,s=(n.password,n.username,n.secret_key_acc_id),c=!!n.is_auto_submit_enabled,a=!!n.org_list_in_autofill,u=SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("FILL_TOTP_FROM_ICON_CLICK",Securden_BG.productVersion);if(n.no_matching_accounts||n.accounts)n.no_matching_accounts?r={is_password_available:!1,no_matching_accounts:!0}:n.accounts&&(r={is_password_available:!1,is_auto_submit_enabled:c,accounts:n.accounts,all_org_in_autofill:a}),r.frameurl=Securden_BG.frameurl,SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"showDataForUrl",r);else{var t={},o=!1;if(SecurdenExtensionUtils.isParamValid(n.fill_values)?(t=SecurdenExtensionUtils.basicChecksBeforePasswordAccess(n.password_fill_status),o=!0):t=SecurdenExtensionUtils.basicChecksBeforePasswordAccess(n),t.is_valid||t.password_not_available)t.is_valid?(r=o?n:{is_password_available:!0,password:n.password,username:n.account_name},u&&(r.secret_key_acc_id=s),r.is_submit=c,Securden_BG.disablePasswordSaveInBrowser()):t.password_not_available&&(r={is_password_available:!1,no_matching_accounts:!0}),r.frameurl=Securden_BG.frameurl,SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"showDataForUrl",r);else{var d={success:!1,message:t.error_msg,error_msg_timeout:t.error_msg_timeout};SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"showSubmitStatusMsg",d)}}}Securden_BG.resetFlags()},addAccountDataForUrlError:function(e){Securden_BG.changeBrowserIcon(!1);var r={server_url:Securden_BG.serverUrl,product_version:Securden_BG.productVersion,logged_out:!0};SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"showDataForUrl",r),Securden_BG.currentTabId=null},addNewAccountSuccess:function(e){var r={success:!0,message:e.message};SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"showSubmitStatusMsg",r),Securden_BG.currentTabId=null,Securden_BG.clearValues()},addNewAccountError:function(e){Securden_BG.errorMsgFunction(e),Securden_BG.currentTabId=null,Securden_BG.clearValues()},showAddNewAccountForm:function(){if(!Securden_BG.isRecording&&Securden_BG.getIfAccountExists&&SecurdenExtensionUtils.isValidString(Securden_BG.topDomain)&&SecurdenExtensionUtils.isValidString(Securden_BG.iframeDomain)&&Securden_BG.iframeDomain!=SecurdenExtensionUtils.getRootDomain(SecurdenExtensionUtils.getDomain(Securden_BG.serverUrl))){Securden_BG.getIfAccountExists=!1;var e={};e.username=Securden_BG.username,e.password=Securden_BG.password,e.url=SecurdenExtensionUtils.getDomain(Securden_BG.iframeDomain),null!=e.username&&""!=e.username&&null!=e.password&&""!=e.password?Securden_BG.sendRequest({action:"get_if_account_exists",data:e,type:"POST",onSuccessFunc:"getAccountExistsSuccess",onFailureFunc:"getAccountExistsFailure"}):Securden_BG.getIfAccountExists=!0}},setServerUrl:function(e){Securden_BG.serverUrl=e,SecurdenExtensionUtils.serverUrl=e,browser.storage.sync.set({serverUrl:e},(function(){}))},setOrgName:function(e){Securden_BG.org_name=e,browser.storage.sync.set({org_name:e},(function(){}))},clearOrgName:function(){browser.storage.sync.remove(["org_name"],(function(){}))},setProductVersion:function(e){Securden_BG.productVersion=e,SecurdenExtensionUtils.productVersion=e,browser.storage.sync.set({productVersion:e},(function(){}))},changeBrowserIcon:function(e){var r=e?"/images/logo16.png":"/images/logo-disable16.png",n=e?"/images/logo20.png":"/images/logo-disable20.png",s=null;s="edge"==SecurdenExtensionUtils.getBrowserName()?n:{16:r,48:"/images/logo48.png",128:"/images/logo128.png"},-1===userAgent.indexOf("firefox/")?browser.action.setIcon({path:s}):browser.browserAction.setIcon({path:s})},showTicketIdDiv:function(e,r){var n=!0;r&&r.dont_show_error&&(n=!1),!e&&n&&Securden_BG.errorMsgFunction(e);var s=e;if(s.result&&s.result.TICKETING_SYSTEM||s.param&&s.param.TICKETING_SYSTEM||s.conf_values&&s.conf_values.TICKETING_SYSTEM||s.result&&s.result.ENFORCE_REASON_ON_PASSWORD_RETRIEVE||s.param&&s.param.ENFORCE_REASON_ON_PASSWORD_RETRIEVE||s.conf_values&&s.conf_values.ENFORCE_REASON_ON_PASSWORD_RETRIEVE){var c=e;Securden_BG.validateTicketIdShowErrorInWindow||Securden_BG.validateTicketIdForPasswordFill?(c=null==e.result||null==e.result?c:e.result,(c=null==e.param||null==e.param?c:e.param).show_in_window=!0):Securden_BG.validateTicketIdFromWebUI?(c.account_id=e.param.account_id,c.show_in_window=!0):c.account_id=Securden_BG.account_id;var a=null==e.result||null==e.result?null:e.result.ticket_id_label;null!=a&&null!=a||(a=null==e.param||null==e.param?browser.i18n.getMessage("ticket_id"):e.param.ticket_id_label),null!=a&&null!=a||(a=null==e.conf_values||null==e.conf_values?browser.i18n.getMessage("ticket_id"):e.conf_values.ticket_id_label),null!=a&&null!=a||(a=browser.i18n.getMessage("ticket_id")),c.ticket_id_label=a,Securden_BG.account_id=null,(s.result&&s.result.TICKETING_SYSTEM||s.param&&s.param.TICKETING_SYSTEM||s.conf_values&&s.conf_values.TICKETING_SYSTEM)&&(c.TICKETING_SYSTEM=!0),(s.result&&s.result.ENFORCE_REASON_ON_PASSWORD_RETRIEVE||s.param&&s.param.ENFORCE_REASON_ON_PASSWORD_RETRIEVE||s.conf_values&&s.conf_values.ENFORCE_REASON_ON_PASSWORD_RETRIEVE)&&(c.ENFORCE_REASON_ON_PASSWORD_RETRIEVE=!0);var u=SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("REASON_FOR_PASSWORD_RETRIEVAL",Securden_BG.productVersion);c.reasonCheckAllowedInVersion=u,c.account_id&&SecurdenExtensionUtils.sendMessage(Securden_BG.currentTabId,"showTicketIdDiv",c)}else Securden_BG.validateTicketIdShowErrorInWindow?Securden_BG.addAccountDataForUrlSuccess(e):Securden_BG.validateTicketIdFromWebUI?Securden_BG.getUserNamePasswordSuccess(e):Securden_BG.getAccountPasswordSuccess(e)},resetFlags:function(){Securden_BG.validateTicketIdForPasswordFill=!1,Securden_BG.validateTicketIdShowErrorInWindow=!1,Securden_BG.validateTicketIdFromWebUI=!1,Securden_BG.getPasswordForLaunchFromPlugin=!1},sendRequest:function(e){e.serviceWorker=!0;var r=e.onSuccessFunc,n=e.onFailureFunc,s=e.onSuccessFuncArg;return SecurdenExtensionUtils.sendRequest({ajaxConfig:e},Securden_BG.serverUrl).then((e=>{if(n&&e&&!1===e.ok)Securden_BG[n](e.responseData);else{if(!r)return e;Securden_BG[r](e,s)}})).catch((e=>{n&&Securden_BG[n](e)}))},disablePasswordSaveInBrowser:function(){try{browser.privacy.services.passwordSavingEnabled.set({value:!1},(function(){}))}catch(e){}try{browser.privacy.services.passwordSavingEnabled&&browser.privacy.services.passwordSavingEnabled.get({},(function(e){"controllable_by_this_extension"===e.levelOfControl&&browser.privacy.services.passwordSavingEnabled.set({value:!1},(function(){}))}))}catch(e){console.log("Error in disabling browser password manager")}},saveSearchText:function(e){browser.storage.sync.set({searchText:e},(function(){}))},processRecordedEvents:function(e){if(e.clickEventData){var r=e.clickEventData.eventId;if(Securden_BG.eventRecords[r]){var n=Securden_BG.eventRecords[r].step;e.clickEventData.step=n}else e.clickEventData.step=Securden_BG.recordActionCount,Securden_BG.recordActionCount++;Securden_BG.eventRecords[r]=e.clickEventData}if(e.inputEventData){r=e.inputEventData.eventId;if(Securden_BG.eventRecords[r]){var s=Securden_BG.eventRecords[r].step;e.inputEventData.step=s}else e.inputEventData.step=Securden_BG.recordActionCount,Securden_BG.recordActionCount++;Securden_BG.eventRecords[r]=e.inputEventData}Securden_BG.saveRecordedInputs(Securden_BG.eventRecords)},saveRecordedInputs:function(e){browser.storage.sync.set({recordedInputs:e},(function(){}))}};Securden_BG.init();