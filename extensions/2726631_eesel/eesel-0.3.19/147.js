(globalThis.webpackChunk_eesel_app=globalThis.webpackChunk_eesel_app||[]).push([[147],{57068:(e,t,r)=>{var a=r(94182).w_;e.exports.r=function(e){return a({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}},{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}}]})(e)}},20784:(e,t,r)=>{var a=r(94182).w_;e.exports.r=function(e){return a({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}},{tag:"line",attr:{x1:"1",y1:"1",x2:"23",y2:"23"}}]})(e)}},79741:(e,t,r)=>{var a=r(94182).w_;e.exports.b=function(e){return a({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"path",attr:{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}},{tag:"line",attr:{x1:"12",y1:"17",x2:"12.01",y2:"17"}}]})(e)}},65998:(e,t,r)=>{var a=r(94182).w_;e.exports.O=function(e){return a({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12",y2:"16"}},{tag:"line",attr:{x1:"8",y1:"12",x2:"16",y2:"12"}}]})(e)}},34282:(e,t,r)=>{var a=r(94182).w_;e.exports.Y=function(e){return a({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(e)}},68833:(e,t,r)=>{"use strict";r.d(t,{a:()=>i});var a=r(3974),n=r(30130),l=r(41473);const i=e=>{var{children:t,optional:r}=e,i=(0,a.__rest)(e,["children","optional"]);return n.createElement(l.x.span,Object.assign({display:{_:r?"none":"inline",sm:"inline"},fontWeight:"normal",overflow:"hidden",paddingLeft:"0.5rem",textAlign:"left",textOverflow:"ellipsis"},i),t)}},65125:(e,t,r)=>{"use strict";r.d(t,{s:()=>c});var a=r(3974),n=r(30130),l=r(34282),i=r(44235),o=r(68833);const s=(0,r(35313).I)(l.Y),c=n.forwardRef(((e,t)=>{var{children:r}=e,l=(0,a.__rest)(e,["children"]);return n.createElement(i.z,Object.assign({color:"danger",ref:t},l),n.createElement(s,null),n.createElement(o.a,null,r))}))},37696:(e,t,r)=>{"use strict";r.d(t,{D:()=>o});var a=r(3974),n=r(30130),l=r(44235),i=r(68833);const o=n.forwardRef(((e,t)=>{var{children:r}=e,o=(0,a.__rest)(e,["children"]);return n.createElement(l.z,Object.assign({ref:t},o),n.createElement(i.a,{style:{padding:0}},r))}))},87395:(e,t,r)=>{"use strict";r.d(t,{L:()=>i});var a=r(3974),n=r(30130),l=r(73081);const i=(0,r(35313).I)((e=>{var t,{entity:r,fallback:i=""}=e,o=(0,a.__rest)(e,["entity","fallback"]);const s=(e=>e.getName?e.getName():e.name?e.name:e.value?e.value:e.title||"")(r),c=(null===(t=r.getLogo)||void 0===t?void 0:t.call(r))||r.logo;return"string"!=typeof c?n.createElement(l.Icon,{"aria-label":s,component:c}):n.createElement("img",Object.assign({alt:s,src:c||i},o))}))},96341:(e,t,r)=>{"use strict";r.d(t,{J:()=>c});var a=r(3974),n=r(30130),l=r(21178),i=r(44235),o=r(68833);const s=n.forwardRef(((e,t)=>{var{children:r}=e,l=(0,a.__rest)(e,["children"]);return n.createElement(i.z,Object.assign({color:"text",ref:t},l),n.createElement(o.a,null,r))})),c=n.forwardRef(((e,t)=>{var{onClick:r}=e,i=(0,a.__rest)(e,["onClick"]);const{resetForm:o}=(0,l.useFormikContext)(),c=n.useCallback((e=>{o(),r&&r(e)}),[r,o]);return n.createElement(s,Object.assign({onClick:c,ref:t},i))}))},45860:(e,t,r)=>{"use strict";r.d(t,{$:()=>a});const a=r(21743).default.div`
  align-items: flex-start;
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  padding: 1.5rem;

  > * {
    width: 100%;
  }

  > * + * {
    margin-top: 0.5rem;
  }
`},52915:(e,t,r)=>{"use strict";r.d(t,{l:()=>a});const a=r(21743).default.label`
  align-items: center;
  display: flex;
`},19580:(e,t,r)=>{"use strict";r.d(t,{p:()=>a});const a=r(21743).default.div`
  display: flex;
  margin: -1.5rem;
`},27848:(e,t,r)=>{"use strict";r.d(t,{r:()=>d});var a=r(3974),n=r(30130),l=r(41473);const i=n.forwardRef(((e,t)=>n.createElement(l.x.a,Object.assign({appearance:"none",border:"none",borderRadius:"0.25rem",cursor:{_:"pointer",disabled:"default"},display:"inline-block",outline:"none",px:"1rem",py:"0.5rem",ref:t,textDecoration:"none",transitionDuration:(window.navigator.webdriver?1:128)+"ms",transitionProperty:"background-color, color",transitionTimingFunction:"ease; "},e)))),o=n.forwardRef(((e,t)=>{var{color:r="primary"}=e,l=(0,a.__rest)(e,["color"]);const o=Object.assign(Object.assign(Object.assign(Object.assign({backgroundColor:"transparent",borderStyle:"solid",borderWidth:"1px"},"primary"===r?{borderColor:"primary",color:"primary"}:{}),"danger"===r?{borderColor:"error",color:"error"}:{}),"text"===r?{borderColor:"onBG",color:"onBG"}:{}),"white"===r?{borderColor:"onBG03",color:"onBG03"}:{});return n.createElement(i,Object.assign({ref:t},o,l))})),s=n.forwardRef(((e,t)=>{var{color:r="primary"}=e,l=(0,a.__rest)(e,["color"]);const o=Object.assign(Object.assign(Object.assign({},"primary"===r?{backgroundColor:"primary",color:"onPrimary"}:{}),"danger"===r?{backgroundColor:"error",color:"onError"}:{}),"text"===r?{backgroundColor:"bg03",color:"onBG03"}:{});return n.createElement(i,Object.assign({ref:t},o,l))})),c=n.forwardRef(((e,t)=>{var{color:r="primary",underlined:l}=e,o=(0,a.__rest)(e,["color","underlined"]);const s=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({backgroundColor:"transparent",padding:0},l?{borderRadius:0,margin:"-0.5rem"}:{}),"primary"===r?{borderColor:"primary",color:"primary"}:{}),"danger"===r?{borderColor:"error",color:"error"}:{}),"text"===r?{borderColor:"bg03",color:"bg03"}:{}),"white"===r?{borderColor:"bg",color:"bg"}:{});return n.createElement(i,Object.assign({ref:t},s,o))})),d=n.forwardRef(((e,t)=>{var{shape:r}=e,l=(0,a.__rest)(e,["shape"]);switch(r){case"bordered":return n.createElement(o,Object.assign({},l,{ref:t}));case"icon":return n.createElement(c,Object.assign({border:"none",borderRadius:"0.25rem",padding:"0.5rem"},l,{ref:t}));case"plain":return n.createElement(s,Object.assign({},l,{ref:t}));default:return n.createElement(c,Object.assign({},l,{ref:t}))}}))},47484:(e,t,r)=>{"use strict";r.d(t,{t:()=>u});var a=r(3974),n=r(30130),l=r(21743),i=r(79741),o=r(27848),s=r(68833);const c=(0,r(35313).I)(i.b),d=(0,l.default)(o.r)`
  align-items: center;
  display: flex;
  overflow: hidden;
  white-space: nowrap;
`,u=n.forwardRef(((e,t)=>{var{children:r}=e,l=(0,a.__rest)(e,["children"]);return n.createElement(d,Object.assign({color:"primary",ref:t,style:{alignItems:"center",display:"flex"}},l),n.createElement(c,null),n.createElement(s.a,{optional:!0},r))}))},89677:(e,t,r)=>{"use strict";r.d(t,{P:()=>i});var a=r(30130),n=r(41473),l=r(49864);const i=({isCurrentPage:e,app:t,variant:r})=>a.createElement(a.Fragment,null,a.createElement(n.x.span,{"aria-label":"title"},t.name),"url"===r&&a.createElement(a.Fragment,null,a.createElement(n.x.span,{color:"onBGSubtle",flexGrow:{_:1},fontSize:"3",marginLeft:"2"},t instanceof l.ManagedApp?t.getURL().replace(/^https?:\/\//,""):t.getHostname()),e&&a.createElement(n.x.span,{color:"secondary",fontSize:"3",overflow:"hidden",paddingLeft:"1rem",textOverflow:"ellipsis"},"based on current page"),t.activatedAt?a.createElement(n.x.span,{color:"onBG",fontSize:"3",opacity:.5,overflow:"hidden",paddingLeft:"1rem",textOverflow:"ellipsis"},"already added"):null))},77147:(e,t,r)=>{"use strict";r.r(t),r.d(t,{SettingsAppUpdateContainer:()=>ie});var a=r(3974),n=r(30130),l=r(79740),i=r(8330),o=r(6844),s=r(89389),c=r(17683),d=r(75278),u=r(63693),m=r(17622),p=r(11930),g=r(87395),f=r(36324),b=r(89677),v=r(21743),h=r(21178),y=r(57068),E=r(20784),x=r(34282),w=r(65998),k=r(54221),C=r(12530),j=r(93394),O=r(44235),_=r(48248),L=r(35313),R=r(19580),A=r(45860),S=r(52915),I=r(96341),D=r(47484),F=r(30845),B=r(68833);const $=(0,L.I)(F.FiPlus),z=n.forwardRef(((e,t)=>{var{children:r}=e,l=(0,a.__rest)(e,["children"]);return n.createElement(O.z,Object.assign({color:"primary",ref:t},l),n.createElement($,null),n.createElement(B.a,null,r))}));var P=r(65125),U=r(37696),G=r(96264),V=r(85163),M=r(82450),W=r(75733),Y=r(86014);const q=(0,v.default)((0,L.I)(y.r))`
  margin-right: 2;
`,N=(0,v.default)((0,L.I)(E.r))`
  margin-right: 2;
`,H=(0,v.default)((0,L.I)(w.O))`
  transform: rotate(45deg);
`,T=(0,v.default)((0,L.I)(x.Y))`
  margin-right: 2;
`,Q=e=>n.createElement(O.z,Object.assign({pr:"0px"},e,{"aria-label":"delete rule",color:"text",shape:"icon"}),n.createElement(H,null)),J=(0,v.default)((e=>n.createElement(O.z,Object.assign({},e,{color:"primary",shape:"text"}),"Undo")))`
  margin-left: 2;
`,K=v.default.div`
  align-items: center;
  color: primary;
  display: flex;
  min-height: 2.225rem;
`,X=e=>{var{index:t,name:r,required:l}=e,i=(0,a.__rest)(e,["index","name","required"]);const[o,s,c]=(0,h.useField)({name:r,validate:e=>{if(e&&!e.deleted)try{(0,j.compile)(e.value)}catch(e){return"malformatted rule"}}}),{error:d,touched:u,value:m}=s,{setValue:p}=c,g=n.useCallback((()=>p(Object.assign(Object.assign({},m),{deleted:!m.deleted}))),[m,p]);return m.deleted?n.createElement(K,null,n.createElement(T,{display:"left"}),"This rule has been deleted",n.createElement(J,{onClick:g})):n.createElement("div",{style:{display:"flex"}},n.createElement(k.Input,Object.assign({},o,i,{id:t>0?void 0:r,invalid:!!d&&u,onChange:e=>{p(Object.assign(Object.assign({},m),{value:e.target.value}))},style:{flexGrow:1},value:m.value||""})),(!l||t>0)&&n.createElement(Q,{onClick:g}))};function Z({name:e,required:t,values:r}){return n.createElement(h.FieldArray,{name:e},(a=>{var l;return n.createElement(n.Fragment,null,null===(l=r[e])||void 0===l?void 0:l.map(((r,a)=>n.createElement(X,{index:a,key:a,name:`${e}.${a}`,required:t}))),n.createElement(W.N,null,(e=>n.createElement(z,Object.assign({},e,{onClick:()=>a.push(""),shape:"text",style:{width:"auto"}}),"Add URL"))))}))}const ee=({app:e,onDelete:t,onSubmit:r})=>{const a=n.useMemo((()=>e?{allowList:e.ruleList.filter((e=>!e.startsWith("!"))).map((e=>({deleted:!1,value:e}))),denyList:e.ruleList.filter((e=>e.startsWith("!"))).map((e=>e.substring(1))).map((e=>({deleted:!1,value:e}))),id:e.id}:{allowList:[{deleted:!1,value:""}]}),[e]),l=n.useCallback((e=>{const t={};return e.allowList.filter((({deleted:e})=>!e)).length||(t.allowList="Minimum if 1 allowList"),t}),[]),[i,o]=n.useState(null),s=n.useCallback((async({denyList:e=[],id:t,allowList:a})=>{o(null);try{r&&await r({id:t,ruleList:[...a.filter((e=>Boolean(e)&&!e.deleted)).map((e=>e.value)),...e.filter((e=>Boolean(e)&&!e.deleted)).map((e=>`!${e.value}`))]})}catch(e){(0,C.H)(e),o(new Error("An unexpected error has occured. Please try again."))}}),[r]),[c,d]=n.useState(!1),u=n.useCallback((async()=>{if(o(null),t){d(!0);try{await t()}catch(e){d(!1),(0,C.H)(e),o(new Error("An unexpected error has occured. Please try again."))}}}),[t]);return n.createElement(h.Formik,{enableReinitialize:!0,initialValues:a,onSubmit:s,validate:l},(({dirty:e,isSubmitting:t,isValid:r,values:a})=>n.createElement(G.l,null,n.createElement(V.V,null,i&&n.createElement(R.p,null,n.createElement(A.$,null,n.createElement(_.b,{color:"danger"},i.message))),n.createElement(R.p,null,n.createElement(A.$,null,n.createElement(S.l,{htmlFor:"allowList"},n.createElement(q,{display:"left"}),"Show pages that match:"),n.createElement(Z,{name:"allowList",required:!0,values:a}))),n.createElement(R.p,null,n.createElement(A.$,null,n.createElement(S.l,{htmlFor:"denyList"},n.createElement(N,{display:"left"}),"Ignore pages that match:"),n.createElement(Z,{name:"denyList",values:a}))),!!a.id&&n.createElement(R.p,null,n.createElement(A.$,null,n.createElement(W.N,null,(e=>n.createElement(P.s,Object.assign({},e,{"aria-label":"remove app",disabled:c||t,onClick:u,shape:"text",style:{width:"auto"}}),"Remove app")))))),n.createElement(M.G,{style:{justifyContent:"space-between"}},n.createElement(W.N,null,(e=>n.createElement(D.t,Object.assign({},e,{href:"https://intercom.help/eesel/en/articles/3729009-the-ultimate-guide-to-product-rules",shape:"text",target:"_blank"}),"How to customise apps"))),n.createElement(Y.Y,null,e&&n.createElement(n.Fragment,null,n.createElement(W.N,null,(e=>n.createElement(I.J,Object.assign({"aria-label":"cancel",disabled:c||t,shape:"text"},e),"Cancel"))),n.createElement(U.D,{"aria-label":"save App",color:"text",disabled:c||t||!r,type:"submit"},"Save app")))))))},te=({onBackClick:e,onDeleteClick:t,onSubmit:r,app:a})=>n.createElement(n.Fragment,null,n.createElement(p.h4,null,n.createElement(f.xE,{onClick:e}),n.createElement(f.Dx,null,n.createElement("div",{style:{alignItems:"center",display:"inline-flex"}},n.createElement(g.L,{entity:a,style:{marginRight:"1rem"}}),n.createElement(b.P,{app:a})))),n.createElement(f.VY,null,n.createElement(ee,{app:a,onDelete:t,onSubmit:r})));var re=r(94506);const ae=l.Ps`
  query SettingsAppUpdateContainerQuery($id: ID!) {
    app(id: $id) {
      id
      name
      ruleList
      type
    }
  }
`,ne=l.Ps`
  mutation SettingsAppUpdateContainerAppUpdateMutation(
    $id: ID!
    $input: AppUpdateInput!
  ) {
    appUpdate(id: $id, input: $input) {
      id
      name
      ruleList
      type
    }
  }
`,le=l.Ps`
  mutation SettingsAppUpdateContainerAppDeleteMutation($id: ID!) {
    appDelete(id: $id)
  }
`,ie=()=>{const e=(0,o.k6)(),{id:t}=(0,o.UO)(),{data:{app:r}={},error:l,loading:p}=(0,c.useQuery)(ae,{nextFetchPolicy:"cache-first",variables:{id:t}}),g=n.useMemo((()=>r&&(0,s.r)(r)),[r]),{trackEvent:f}=(0,re.useAnalyticsListener)(),[b]=(0,i.D)(ne,{onCompleted({appUpdate:{ruleList:e}}){f("appUpdated",{ruleList:e})}}),[v]=(0,i.D)(le,{awaitRefetchQueries:!0,onCompleted(){f("appRemoved")},refetchQueries:[{query:m.Vx}]}),h=n.useCallback((async e=>{var{id:t}=e,r=(0,a.__rest)(e,["id"]);await b({variables:{id:t,input:r}})}),[b]),y=n.useCallback((async()=>{g&&await v({variables:{id:g.id}}),e.push("/settings/apps")}),[v,e,g]),E=n.useCallback((()=>{e.push("/settings/apps")}),[e]);return p?n.createElement(d.a,null):l||!g?n.createElement(u.R,null):n.createElement(te,{app:g,onBackClick:E,onDeleteClick:y,onSubmit:h})}},63693:(e,t,r)=>{"use strict";r.d(t,{R:()=>i});var a=r(30130),n=r(48248),l=r(36324);const i=({children:e})=>a.createElement(l.VY,{style:{paddingTop:"2rem"}},a.createElement(n.b,{color:"danger"},e||"An error has occured. Please try again later."))},36324:(e,t,r)=>{"use strict";r.d(t,{Dx:()=>m,VY:()=>p,xE:()=>u});var a=r(3974),n=r(30130),l=r(21743),i=r(14289),o=r(41473),s=r(11930),c=r(44235);const d=(0,r(35313).I)(i.FiChevronLeft),u=n.forwardRef(((e,t)=>n.createElement(c.z,Object.assign({alignItems:"center",color:"text",display:"flex",ml:"-0.5rem",ref:t,shape:"icon"},e),n.createElement(d,null)))),m=n.forwardRef(((e,t)=>{var{variant:r="centered"}=e,l=(0,a.__rest)(e,["variant"]);const i=Object.assign(Object.assign({flexGrow:1,fontSize:"1rem",fontWeight:600,margin:"0px 1rem 0px 0.5rem"},"centered"===r?{textAlign:"center"}:{}),"left"===r?{textAlign:"left"}:{});return n.createElement(o.x.h2,Object.assign({ref:t},i,l))})),p=(0,l.default)(s.VY)`
  flex-grow: 1;
  overflow-y: auto;
`},96264:(e,t,r)=>{"use strict";r.d(t,{l:()=>n});var a=r(21178);const n=(0,r(21743).default)(a.Form)`
  display: flex;
  flex-direction: column;
  height: 100%;
`},85163:(e,t,r)=>{"use strict";r.d(t,{V:()=>a});const a=r(21743).default.div`
  flex-grow: 1;
  overflow-y: auto;
  overflow-x: hidden;
  width: 100%;
`},82450:(e,t,r)=>{"use strict";r.d(t,{G:()=>a});const a=r(21743).default.div`
  align-items: center;
  display: flex;
  min-height: 4rem;
  width: 100%;

  > * + * {
    margin-left: 3;
  }
`},75733:(e,t,r)=>{"use strict";r.d(t,{N:()=>a});const a=({children:e})=>e({px:"0px"})},86014:(e,t,r)=>{"use strict";r.d(t,{Y:()=>a});const a=r(21743).default.div`
  align-items: center;
  display: flex;

  > button + button {
    margin-left: 3;
  }
`}}]);