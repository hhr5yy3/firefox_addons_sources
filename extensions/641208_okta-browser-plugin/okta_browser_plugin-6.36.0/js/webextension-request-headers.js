Okta.RequestHeaders=function(e,r,a,s,t){var n={};var o=Okta.RequestHeadersBase(e,r,a,s,t);var u=Okta.fn.url.isOktaEndUserHomeHref;var i=Okta.fn.storage.syncStorageData;var d=Okta.fn.bg.getPendingConsentAccount;var l=Okta.fn.url.isCustomEndUserHomeHref;var c=Okta.fn.url.hrefToDomain;var f=o.HeaderConstants;var v=f.EXTENDED_USER_AGENT_KEY;var H=f.PLUGIN_USER_AGENT_VALUE;var m=f.EXTENDED_PLUGIN_ACCOUNTS_USER_AGENT_KEY;var g=o.getStorageCache();var q="WebExtension::onBeforeSendHeaders Error: ";function E(e,r,a,s){var t=e.find(e=>{return e.name&&e.name.toLowerCase()===r.toLowerCase()});if(t){s?t.value+=" "+a:t.value=a}else{e.push({name:r,value:a})}return e}n.onBeforeSendHeaders=function(e){var r={requestHeaders:[]};if(e.requestHeaders){r.requestHeaders=e.requestHeaders}try{var a=g.domains.val;var s=false;var t=u&&u(e.url);if(!t&&l){if(a&&a.customDomain&&a.oktaDomain){s=l(e.url,a.customDomain)}}if(t||s){var n=d(g.dbgPluginSettings.val,g.allowListedAccounts.val,s?a:null);E(r.requestHeaders,v,H,true);E(r.requestHeaders,m,n)}}catch(e){Log.error(q+e.message)}return r};n.getPluginAuthorizeResponseParams=o.getPluginAuthorizeResponseParams;n.modifyHeadersBeforeGetAccessToken=function(){return Promise.resolve("Already modified headers when getting access token")};n.onBeforeSendHeaderGetAccessToken=function(e){var r={requestHeaders:[]};if(e.requestHeaders){r.requestHeaders=e.requestHeaders}var a=e.url;if(!a){return r}var s=c(a);E(r.requestHeaders,"Origin",s);E(r.requestHeaders,"Referrer",s);return r};n.initialize=function(){i(g);var e={urls:["<all_urls>"]};chrome.webRequest.onBeforeSendHeaders.addListener(n.onBeforeSendHeaders,e,["requestHeaders","blocking"]);var r={urls:["*://*/oauth2/v1/token"],types:["xmlhttprequest"],tabId:chrome.tabs.TAB_ID_NONE};chrome.webRequest.onBeforeSendHeaders.addListener(n.onBeforeSendHeaderGetAccessToken,r,["requestHeaders","blocking"]);var a={urls:["*://*/plugin/callback?*"],types:["xmlhttprequest"],tabId:chrome.tabs.TAB_ID_NONE};chrome.webRequest.onBeforeRequest.addListener(function(){return{cancel:true}},a,["blocking"]);o.initialize()};return n};