import{CurCVer_ as e,CurFFVer_ as t,OnFirefox as n,OnChrome as o,OnEdge as i,$ as l,$$ as a,post_ as r,disconnect_ as s,isVApiReady_ as c,simulateClick_ as u,PageOs_ as d,toggleDark_ as p,browser_ as f,selfTabId_ as m,enableNextTick_ as h,nextTick_ as w,IsEdg_ as k,import2_ as b,BrowserName_ as A,pageTrans_ as g,isRepeated_ as v,prevent_ as V}from"./async_bg.js";import{bgSettings_ as y,showI18n_ as x,setupBorderWidth_ as _,Option_ as T,debounce_ as C,oTrans_ as M,delayBinding_ as H,didBindEvent_ as S}from"./options_base.js";import{saveBtn_ as I,exportBtn_ as j,savedStatus_ as $,onKeyMappingsError_ as E}from"./options_defs.js";import{manifest_ as O}from"./options_permissions.js";export let delayed_task;export const clear_delayed_task=()=>{delayed_task=null};h(8),w(x),_&&w(_),w(e=>{e.textContent=O.version_name||O.version,parseInt(O.version)>=2!=(3===O.manifest_version)&&(e.parentElement.nextElementSibling.textContent="-mv"+O.manifest_version)},l("#version")),H(I,"click",e=>{if(false!==e)return void T.ht().then(e=>{e&&I.onclick(false)});let t=T.j;T.j=[],I.blur(),I.disabled=true,I.firstChild.data=M("115_3"),j.disabled=false,$(false),window.onbeforeunload=null,window.addEventListener("beforeunload",L,true),0!==t.length&&setTimeout(e=>{r(4,e.map(e=>y.f[e]))},100,t)},"on");let L=()=>{r(30)},P=function(){T.$=false;for(let e in T.D)T.D[e].w();T.D.exclusionRules.S.length>0&&w(e=>{e.style.visibility=""},l("#exclusionToolbar")),document.addEventListener("keyup",F),H("[data-check]","input",function e(){for(let t of a("[data-check]"))t.removeEventListener("input",e);b("./options_checker.js")}),H("[data-auto-resize]","click",e=>{let t=l("#"+e.target.dataset.autoResize),n=t.scrollHeight,o=t.scrollWidth,i=o-t.clientWidth;if(n<=t.clientHeight&&i<=0)return;let a=Math.max(Math.min(innerWidth,1024)-120,550);t.style.maxWidth=o>a?a+"px":"",t.style.height=t.style.width="",i=o-t.clientWidth;let r=t.offsetHeight-t.clientHeight;r=i>0?Math.max(26,r):r+18,n+=r,i>0&&(t.style.width=t.offsetWidth+i+4+"px"),t.style.height=n+"px"}),H("[data-delay]","click",function(e){let t=this.dataset.delay,n=null;"event"===t&&(n=e||null),"continue"!==t&&e&&V(e),delayed_task=["#"+this.id,n],"complete"!==document.readyState?window.addEventListener("load",function e(t){t.target===document&&(window.removeEventListener("load",e),b("./options_ext.js"))}):b("./options_ext.js")},"on");let e=a("[data-permission]");e.length>0&&(e=>{function t(){let e=this.querySelector("[data-permission]");if(this.onclick=null,!e)return;let t=e.dataset.permission;e.placeholder=M("lackPermission",[t?`: "${t}"`:""])}let n=O.permissions||[];for(let o=e.length;0<=--o;){let i,l=e[o],a=l.dataset.permission;if("C"===a[0]){if(a.includes("nonC"))continue;let e=a.split(",",2)[1]||",";if("."===e[0]?null!=window[e.slice(1)]:"("===e[0]&&matchMedia(e).matches)continue;if("."===e[0]){w(e=>{e.style.display="none"},l.parentElement);continue}i=","===e?["beforeChromium",[a.slice(1).split(",",1)[0]]]:["lackPermission",[e]]}else{if("mv3,nonFF"===a){l.parentNode.parentNode.parentNode.style.display="none";continue}if("action"===a&&(a="browser_action"),a in O||n.includes(a))continue;i=["lackPermission",[a?":\n* "+a:""]]}w(e=>{e.disabled=true;let n=M("invalidOption",[M(i[0],i[1])]);e instanceof HTMLInputElement&&"checkbox"===e.type?(e.nextElementSibling.tabIndex=-1,(e=e.parentElement).title=n):(e.value="",e.title=n,H(e.parentElement,"click",t,"on"),e instanceof HTMLSpanElement&&(e.style.textDecoration="line-through"))},l)}})(e),H("[data-href]","mousedown",()=>{document.onmouseover=null;for(let e of a("[data-href]"))e.onmousedown=null,r(10,[e.dataset.href,-1]).then(([t])=>{e.removeAttribute("data-href"),e.href=t})},"on"),document.onmouseover=()=>{S("mousedown"),l("[data-href]").onmousedown()};let t=l("#openExtensionsPage");w(([e,t,n])=>{e.textContent=e.href="about:addons";let o="https://addons.mozilla.org/firefox/addon/",i="manageShortcut",l=`${i}_2`;e.before(M(i)),e.after(M(l)),t.href=o+"shortcut-forwarding-tool/?src=external-vc-options",n.href=o+"newtab-adapter/?src=external-vc-options"},[t,l("#shortcutHelper"),l("#newTabAdapter")]),w(e=>{let t=e.children,n=t[1],o=M("NewTabAdapter");t[0].textContent="moz",n.textContent=o,n.href="https://addons.mozilla.org/firefox/addon/newtab-adapter/?src=external-vc-options_omni",n.title=o+" - "+M("addons")},l("#chromeExtVomnibar"));let n=e=>{V(e);let t=e.currentTarget.dataset.for.split(":").slice(-1)[0],n=a(t),i=(n.find(e=>e.checked)||n[0]).nextElementSibling;N(i,o,e=>{VApi&&VApi.x(e.parentElement.parentElement)})};for(let e of a(".ref-text")){let t=e.dataset.for,o=t.slice(t.indexOf(":")+1),i=t.split(":")[0],l=T.D[i.replace("#","")],r=l.m,s=e.parentElement,c=()=>{w(([e,t,n])=>{let o=n.find(e=>e.checked)||n[0];if(e.textContent=M(o.checked?"145_2":"144"),t){let e=o.nextElementSibling,n=e.getAttribute("data-i2");t.textContent=n?g(n):e.textContent}},[s.querySelector(".status-of-related"),s.querySelector(".name-of-related"),o!==t?a(o):[l.x]])};l.m=()=>(c(),r.call(l)),H(e,"click",n,"on"),H(l.x,"change",c,true)}},z=()=>{P(),P=z=null,d||w(e=>{e.textContent="Cmd"},l("#Ctrl"));for(let e in T.D)T.D[e].m();w(()=>{document.documentElement.classList.remove("loading")}),c.then(s),location.hash&&w(window.onhashchange),h(0,8),T.D.keyMappings.m=()=>r(7).then(E);let e=matchMedia("(prefers-color-scheme: dark)"),n=()=>{t>77||o.O&&r(11),setTimeout(i,34)},o=T.D.autoDarkMode,i=()=>{let t=o.z(),n=2===t?!!e&&e.matches:1===t;if(VApi&&VApi.z){let e=VApi.y().r;if(e){let t=(e.firstElementChild&&"span"===e.firstElementChild.localName?e.firstElementChild:e).children;for(let e of t)if("style"!==e.localName&&(e.classList.toggle("D",n),e=e.firstElementChild||e,"iframe"===e.localName)){let t=e.classList.contains("Find"),o=e.contentDocument,i=o.querySelector("style#dark");if(i&&i.sheet&&(i.sheet.disabled=!n),o.body.classList.toggle(t?"D":"has-dark",n),t){let e=VApi.y().f;e&&e.parentElement.classList.toggle("D",n)}}}r(3,{key:"d",val:n}).then(e=>{VApi.z.d=e})}p(n?2===t?2:1:0)};o.m=n,w(()=>{t<66?e=null:(2===o.S&&c.then(n),e.onchange=n)}),setTimeout(()=>{let e,t="isHC_f",n=matchMedia("(forced-colors)").matches,o=n?null:document.createElement("div");o&&(o.style.display="none",o.style.color="#543",document.body.append(o)),r(27,t).then(i=>{e=i[t],(o||null!=e)&&requestIdleCallback(()=>{let t=o&&(getComputedStyle(o).color||"").replace(/ /g,"").toLowerCase(),i=!n&&!!t&&"rgb(85,68,51)"!==t;o&&o.remove(),i!==("1"===e)&&r(9,{hc:i})},{timeout:1e3})})},34),w(()=>{setTimeout(()=>{let e=document.createElement("script");e.src="loader.js",e.async=true,document.head.append(e),document.documentElement.classList.add("smooth")},120)})},F=e=>{let t=e.target,n=e.keyCode;if(13===n)t instanceof HTMLAnchorElement?t.hasAttribute("href")||(setTimeout(e=>{u(e),e.blur()},0,t),V(e)):(e.ctrlKey||e.metaKey)&&(V(e),t.blur&&t.blur(),$()&&(S("click"),I.onclick()));else{if(32!==n)return;if(t instanceof HTMLSpanElement&&t.parentElement instanceof HTMLLabelElement){V(e);let n=t.parentElement.control;n.disabled||n.readOnly||u(n)}}};H(T.D.userDefinedCss.x,"input",C(()=>{let e=T.D.userDefinedCss,t=e.x.classList.contains("debugging");if(e.O&&!t||!VApi||!VApi.z)return;let n=e.z(),o=n===e.S,i=r(8,[n,m]),l=VApi.y().r;i.then(t=>{e.x.classList.toggle("debugging",!o),VApi.t({k:l||o?0:1,t:M("livePreview")||"Live preview CSS\u2026",H:t.ui,f:t.find});let n=l&&l.querySelector("iframe.Omnibar"),i=n&&n.contentDocument;if(i){let e=i.querySelector("style.debugged")||i.querySelector("style#custom");e||(e=i.createElement("style"),e.id="custom"),e.parentNode||i.head.append(e),e.classList.add("debugged"),e.textContent=(o?"\n":"\n.inactive { opacity: 1; }\n")+(t.omni&&t.omni+"\n"||"")}})},1200,null,0));export const noBlobSupport_cr_mv2_=()=>false;H("#importButton","click",()=>{let e=l("#importOptions");e.onchange?e.onchange(null):u(l("#settingsFile"))},"on"),w(e=>{let n=y.o,o=A,i=t;if(!o){let e=navigator.userAgentData,n=(e&&e.brands||[]).filter(e=>parseInt(e.version)===t&&!` ${e.brand} `.includes(" Not "))[0],l="Firefox";o=n?n.brand:e?l||"Chromium":l||"Chrome",n&&(i=parseInt(n.version))}e.textContent=o+" "+i+M("comma")+M("NS")+(M(n)||n[0].toUpperCase()+n.slice(1))},l("#browserName")),document.addEventListener("keydown",e=>{if(!d&&e.metaKey)return void F(e);if(32!==e.keyCode){if(!VApi||!VApi.z||"input textarea".includes(document.activeElement.localName))return;let t=VApi.r[3]({c:" ",e,i:e.keyCode,v:""},11);if("a-f12"===t){let e=l("#importOptions"),t=e.selectedIndex,n=()=>{e.onchange&&e.onchange(null),e.selectedIndex=t};l("#recommendedSettings").selected=true,null!=e.onchange?n():setTimeout(n,100)&&e.click()}else"?"===t&&l("#showCommands").click();return}let t=e.target;"span"===t.localName&&"label"===t.parentElement.localName&&e.preventDefault()});export const onHash_=e=>{let t;if((e=e.slice("!"===e[1]?2:1))&&/^[a-z][\w-]*$/i.test(e))if(t=l(`[data-hash="${e}"]`))S("click"),t.onclick&&t.onclick(null,"hash");else if(t=l(`[id="${e.replace(/-/g,"")}" i]`)){t.dataset.model&&(t="input"===t.localName&&"checked"===t.type?t.parentElement:t,t.classList.add("highlight"));let e=e=>{if(e&&e.target!==window)return;window.onload&&(window.onload=null,scrollTo({behavior:"instant",top:0,left:0})),N(t);let n=t.localName;"button"!==n&&"a"!==n||u(t)};if("complete"===document.readyState)return e();window.scrollTo(0,0),window.onload=e}};window.onhashchange=()=>{onHash_(location.hash)};let N=(e,t,n)=>{let o=-1;e.scrollIntoView({block:t?"nearest":"center",behavior:"smooth"});let i=setInterval(()=>{let t=scrollY;t===o&&(clearInterval(i),n&&n(e),e.focus()),o=t},72)};y.u().then(z),r(7).then(e=>{w(E,e)}),r(12).then(e=>{"?"!==e&&w(([e,t])=>{e.textContent=t},[l("#questionShortcut"),e])}),H("#openExtensionsPage","click",e=>{V(e),VApi?VApi.h(1,0,M("haveToOpenManually")):alert(M("haveToOpenManually"))}),H(document,"click",function e(){let t=VApi,n=t&&t.y();n&&n.r&&(document.removeEventListener("click",e,true),n.r.addEventListener("click",e=>{let t,n=e.target;VApi&&n.classList.contains("HelpCommandName")&&(t=n.textContent.slice(1,-1),VApi.p({H:18,s:t}))},true))},true),H("#testKeyInputBox","focus",function e(t){let n,o,i=t.currentTarget,a=l("#testKeyInput"),r=(e,t)=>{let n=void 0!==e?a.textContent=e:a.textContent;if(e&&0!==t&&document.activeElement===a){let t=getSelection(),n=a.firstChild;t.setBaseAndExtent(n,e.length,n,e.length)}return n},s=0,c=false;a.onkeydown=e=>{if(c&&(c=false,a.classList.remove("outline")),229!==e.keyCode&&"Process"!==e.key){if(VApi&&!v(e)){let t={c:" ",e,i:e.keyCode,v:""},i=VApi.r[3](t,11),l="esc"===i||"c-["===i,s=4&VApi.z.l?VApi.r[3](t,10):i;if(!i&&(16===t.i||"Shift"===e.key))return;let c=i.length>1?`<${i}>`:i||"(empty)",u=s===i?"":s.length>1?`<${s}>`:s||"(empty)";if(n=e,o=VApi.z.l,r(u?`${c} / ${u}`:c),"enter"===i||"tab"===i||"s-tab"===i||l||"f12"===i)return void(("enter"===i||l)&&a.blur())}s=e.keyCode,V(e)}else r("")},a.onkeyup=e=>{e.keyCode===s&&V(e)},a.onfocus=()=>{VApi&&(a.classList.add("outline"),c=true,VApi.f(7,Object.setPrototypeOf({i:true,r:0,k:"v-esc:test",p:true,h:a.previousElementSibling.textContent},null),1,0))},a.onblur=()=>{VApi&&VApi.f(16,Object.setPrototypeOf({type:"keydown",key:"Esc",esc:true},null),1,0)},a.addEventListener("compositionend",()=>{r("")}),a.onpaste=V,a.onclick=()=>{a.focus()};let u=l("#testKeyInInput");u.onchange=()=>{u.checked?a.contentEditable="true":a.removeAttribute("contenteditable"),a.focus()},i.removeEventListener("focus",e,true),i.addEventListener("blur",e=>{let t=c?e.relatedTarget:null;(t?!i.contains(t):c)&&(c=false,a.classList.remove("outline"))},true),T.V=()=>{n&&o!==VApi.z.l&&a.onkeydown(n)}},true);