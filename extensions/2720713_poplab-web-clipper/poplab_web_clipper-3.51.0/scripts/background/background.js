(()=>{"use strict";var e={8199:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=o(1227),i=o(4056),s=o(8033),a=o(853),c=o(2688),l=o(308),u=o(4393);function d(e){return r(this,void 0,void 0,(function*(){const t=(yield browser.tabs.query({active:!0,currentWindow:!0}))[0];yield browser.tabs.sendMessage(t.id,e)}))}"undefined"==typeof window&&importScripts("../polyfill/browser-polyfill.min.js"),function(){r(this,void 0,void 0,(function*(){const e=yield(0,n.est_connecte)(),t=()=>{browser.runtime.lastError};browser.contextMenus.create({id:s.BrowserContextMenusId.SE_DECONNECTER,title:chrome.i18n.getMessage("se_deconnecter"),contexts:["action"],enabled:e},t),browser.contextMenus.create({id:s.BrowserContextMenusId.VOIR_FRIGO,title:chrome.i18n.getMessage("voir_frigo"),contexts:["action"],enabled:e},t),browser.contextMenus.create({id:s.BrowserContextMenusId.ENVOYER_LIEN,title:chrome.i18n.getMessage("envoyer_lien"),contexts:["link"],enabled:e},t),browser.contextMenus.create({id:s.BrowserContextMenusId.ENVOYER_IMAGE,title:chrome.i18n.getMessage("envoyer_image"),contexts:["image"],enabled:e},t),browser.contextMenus.create({id:s.BrowserContextMenusId.ENVOYER_VIDEO,title:chrome.i18n.getMessage("envoyer_video"),contexts:["video"],enabled:e},t),browser.contextMenus.onClicked.addListener((e=>r(this,void 0,void 0,(function*(){e.menuItemId==s.BrowserContextMenusId.SE_DECONNECTER?(yield(0,n.logoutFromKeycloak)(),d(new s.MessageOnglet(s.MessageOngletType.STOP_CAPTURE))):e.menuItemId==s.BrowserContextMenusId.VOIR_FRIGO?browser.tabs.create({url:i.url_frigo}):e.menuItemId==s.BrowserContextMenusId.ENVOYER_LIEN?d(new s.MessageOnglet(s.MessageOngletType.CAPTURER_LIEN)):e.menuItemId==s.BrowserContextMenusId.ENVOYER_IMAGE?d(new s.MessageOnglet(s.MessageOngletType.CAPTURER_IMAGE)):e.menuItemId==s.BrowserContextMenusId.ENVOYER_VIDEO&&d(new s.MessageOnglet(s.MessageOngletType.CAPTURER_VIDEO))}))))}))}(),browser.action.onClicked.addListener((function(){return r(this,void 0,void 0,(function*(){const e=yield browser.storage.local.get("first_name"),t=e&&e.first_name?e.first_name:chrome.i18n.getMessage("utilisateur_mystere"),o=yield browser.storage.local.get("provenance"),r=o&&o.provenance?o.provenance:"";d(new s.MessageOnglet(s.MessageOngletType.TOGGLE_CAPTURE,t,r))}))})),browser.runtime.onMessage.addListener((e=>r(void 0,void 0,void 0,(function*(){const t=yield browser.storage.local.get("access_token");if(e.type==s.BrowserRuntimeMessageEventType.STATUS){if((yield browser.storage.local.get(["use_clipper"])).use_clipper)return Promise.resolve(s.BrowserRuntimeResponse.INTERDIT);if(!t||!t.access_token)return Promise.resolve(s.BrowserRuntimeResponse.DECONNECTE);const e=yield browser.storage.local.get(["first_name"]),o=yield browser.storage.local.get(["provenance"]),r=e.first_name||chrome.i18n.getMessage("utilisateur_mystere"),i=o.provenance;return(0,n.update_menus)(!0),d(new s.MessageOnglet(s.MessageOngletType.TOGGLE_CAPTURE,r,i)),Promise.resolve(s.BrowserRuntimeResponse.CONNECTE)}if(e.type==s.BrowserRuntimeMessageEventType.CONNECT){const t=yield(0,n.login)(!0,e.idp?e.idp:""),o=t.first_name,r=t.provenance,i=yield(0,n.loginToBackend)(t.access_token);return i.user.permissions.can_use_webclipper?(yield browser.storage.local.set({frigoRootId:i.user.workspace.frigo.rootId}),yield browser.storage.local.set({laboRootId:i.user.workspace.labo.rootId}),d(new s.MessageOnglet(s.MessageOngletType.START_CAPTURE,o,r)),Promise.resolve(s.BrowserRuntimeResponse.CONNECTE)):(yield browser.storage.local.set({use_clipper:i.user.permissions.can_use_webclipper}),yield browser.action.setPopup({popup:browser.runtime.getURL("pages/popup.html")}),!1)}if(e.type==s.BrowserRuntimeMessageEventType.ENVOYER_SUR_POPLAB){const t=e;t.data.titre.length>100&&(t.data.titre=t.data.titre.substring(0,97)+"...");try{let e=t.destination.id;if(t.type_item_poplab===a.PoplabObjectType.ELEMENT)t.data=new c.ElementCaptureData(t.data),yield(0,n.createElement)(t.data,t.type_capture,e);else{t.data=new c.DocumentCaptureData(t.data),t.destination.type===l.ArborescenceType.DOSSIER?e=(yield(0,n.createDocument)(t.data,e)).id:t.data.elements.unshift((new c.ElementCaptureData).setTitre(t.data.titre).setType(u.ElementType.SECTION));for(const o of t.data.elements)yield(0,n.createElement)(o,t.type_capture,e)}e===(yield browser.storage.local.get("frigoRootId")).frigoRootId&&(e="frigo"),e===(yield browser.storage.local.get("laboRootId")).laboRootId&&(e="labo"),d(new s.MessageOngletDone(s.MessageOngletType.UPLOAD_FRIGO_DONE,e))}catch(e){e instanceof Error&&(console.error(e.message),browser.notifications.create({type:"basic",iconUrl:browser.runtime.getURL("images/icon-48.png"),title:chrome.i18n.getMessage("erreur_importation"),message:e.message}),d(new s.MessageOnglet(s.MessageOngletType.CANCEL_UPLOAD)),"Merci de vous connecter."==e.message&&(0,n.logoutFromKeycloak)())}return Promise.resolve(s.BrowserRuntimeResponse.ENVOYE)}if(e.type==s.BrowserRuntimeMessageEventType.CAPTURE_TAB)return Promise.resolve(yield browser.tabs.captureVisibleTab({format:"png"}));if(e.type===s.BrowserRuntimeMessageEventType.GET_RECENT_ARBORESCENCE)try{return e.subType===s.BrowserRuntimeMessageEventSubType.WITH_SELECTIONNABLE?yield(0,n.getMostRecentConsultedHierarchiesWithSelectionnable)():yield(0,n.getMostRecentConsultedHierarchies)()}catch(e){if(e instanceof Error)return console.error(e),browser.notifications.create({type:"basic",iconUrl:browser.runtime.getURL("images/icon-48.png"),title:chrome.i18n.getMessage("erreur_destinations_recentes"),message:e.message}),!1}if(e.type===s.BrowserRuntimeMessageEventType.SEARCH_ARBORESCENCE)try{const t=e;return e.subType===s.BrowserRuntimeMessageEventSubType.WITH_SELECTIONNABLE?yield(0,n.searchArborescenceWithSelectionnable)(t.value):yield(0,n.searchArborescence)(t.value)}catch(e){if(e instanceof Error)return console.error(e.message),browser.notifications.create({type:"basic",iconUrl:browser.runtime.getURL("images/icon-48.png"),title:chrome.i18n.getMessage("erreur_recherche_destinations"),message:e.message}),!1}return console.error("type de message inconnu : "+e.type),!1})))),browser.tabs.onUpdated.addListener(((e,t,o)=>{var r;!(null===(r=o.url)||void 0===r?void 0:r.includes(i.url_belin))||void 0!==t.status&&"complete"!==t.status||d(new s.MessageOnglet(s.MessageOngletType.REFRESH_CAPTURE))}))},7280:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transformMediaIntoFile=void 0,t.transformMediaIntoFile=function(e,t){const o=e.split(";")[0].split(":")[1],r=atob(e.split(",")[1]),n=[];for(let e=0;e<r.length;e+=512){const t=r.slice(e,e+512),o=new Array(t.length);for(let e=0;e<t.length;e++)o[e]=t.charCodeAt(e);const i=new Uint8Array(o);n.push(i)}const i=new Blob(n,{type:o});return new File([i],`${t}.${o.split("/")[1]}`,{type:o})}},1227:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.searchArborescenceWithSelectionnable=t.searchArborescence=t.getMostRecentConsultedHierarchiesWithSelectionnable=t.getMostRecentConsultedHierarchies=t.getDocuments=t.logoutFromKeycloak=t.est_connecte=t.update_menus=t.uploadFile=t.createDocument=t.createElement=t.loginToBackend=t.login=void 0;const n=o(4056),i=o(4393),s=o(853),a=o(8033),c=o(2688),l=o(351),u=o(5541),d=o(7970),p=o(9246),h=o(7280);let b;const f="poplab-webclipper";function E(e=!0,t=""){return r(this,void 0,void 0,(function*(){const o=n.base_url_front;b=n.url_auth;let i,s,a=b+"/auth?";""!==t&&(a+=`kc_idp_hint=${t}&`),a+=`client_id=${f}`,a+="&response_type=code",a+="&state=default",a+=`&redirect_uri=${encodeURIComponent(o)}`,a+=`&scope=${encodeURIComponent("openid")}`,a+="&prompt=select_account";try{let t={state:"normal",focused:!0};if("TEST"!==n.VERSION){const e=yield browser.windows.getCurrent(),o=500,r=e.left+e.width-o;t=Object.assign(Object.assign({},t),{height:e.height-16,width:o,left:r,top:e.top})}i=yield(0,u.launchWebAuthFlow)({interactive:e,url:a,redirect_uri:o,alwaysUseTab:!1,windowOptions:t})}catch(e){throw console.error(i+"Erreur rencontrÃ©e. ",e),yield(0,d.cleanLocalSessionsData)(),yield g(!1),new Error(chrome.i18n.getMessage("erreur_reseau"))}if(null==i&&!e)throw yield(0,d.cleanLocalSessionsData)(),yield g(!1),new Error("Need user interaction for connection, but asked for passive connection");const c={code:"",session_state:"",state:""},l=i.slice(i.indexOf("?")+1).split("&");for(const e of l)s=e.split("="),c[s[0]]=s[1];const p=c.code,h={redirect_uri:o,client_id:f,grant_type:"authorization_code",code:p,scope:"openid"},E=[];for(const e in h){const t=encodeURIComponent(e),o=encodeURIComponent(h[e]);E.push(t+"="+o)}const _=E.join("&");let y={};return y=yield fetch(b+"/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:_}).then((e=>e.json())).then((e=>((0,d.extractTokenFields)(y,e),y))).catch((e=>r(this,void 0,void 0,(function*(){throw yield(0,d.cleanLocalSessionsData)(),yield g(!1),new Error("Error when fetching/processing token",e)})))),yield(0,d.saveTokenDataToSession)(y),yield g(!0),y}))}function _(){return r(this,void 0,void 0,(function*(){const e={"content-type":"application/json",Accept:"application/json",authorization:""},t=yield m();return e.authorization="Bearer "+t,e}))}function y(e,t,o,i,s){return r(this,void 0,void 0,(function*(){const r=new FormData;r.append("file",i),r.append("uuid",e),r.append("objectType",t.toLowerCase()),r.append("mediaType",o.type_fichier.toLowerCase()),o.editeur&&r.append("editeur",o.editeur),"label"in o&&o.label&&r.append("label",o.label),s!==(yield browser.storage.local.get("frigoRootId")).frigoRootId&&r.append("documentId",s.toLowerCase());const a={authorization:"Bearer "+(yield m())},c=yield fetch(n.url_api+"/v1/medias/upload",{method:"POST",headers:a,body:r});if(!c.ok)throw new Error(`${chrome.i18n.getMessage("erreur_upload_media")} : `+(yield c.json()).status);return yield c.json()}))}function g(e){return r(this,void 0,void 0,(function*(){yield browser.contextMenus.update(a.BrowserContextMenusId.SE_DECONNECTER,{enabled:e}),yield browser.contextMenus.update(a.BrowserContextMenusId.VOIR_FRIGO,{enabled:e}),yield browser.contextMenus.update(a.BrowserContextMenusId.ENVOYER_LIEN,{enabled:e}),yield browser.contextMenus.update(a.BrowserContextMenusId.ENVOYER_IMAGE,{enabled:e}),yield browser.contextMenus.update(a.BrowserContextMenusId.ENVOYER_VIDEO,{enabled:e}),e?browser.action.setPopup({popup:""}):browser.action.setPopup({popup:browser.runtime.getURL("./pages/popup.html")})}))}function m(e=!0){return r(this,void 0,void 0,(function*(){const t=new Date;let o={};const i=new Date((yield browser.storage.local.get("expiration_date")).expiration_date);if((0,d.isTokenExpired)(i,t)){const i=new Date((yield browser.storage.local.get("refresh_expiration_date")).refresh_expiration_date);if((0,d.isTokenExpired)(i,t))o=yield E(e);else{const t=n.url_auth+"/token",i=(yield browser.storage.local.get("refresh_token")).refresh_token;yield fetch(t,{method:"POST",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:`grant_type=refresh_token&client_id=${f}&refresh_token=${i}`}).then((t=>r(this,void 0,void 0,(function*(){if(t.ok)return(0,d.extractTokenFields)(o,yield t.json());o=yield E(e)})))).catch((e=>console.warn(e))),yield(0,d.saveTokenDataToSession)(o)}return o.access_token}return(yield browser.storage.local.get("access_token")).access_token}))}function v(e){return r(this,void 0,void 0,(function*(){const t=`${n.url_api}/documents/_search-documents`,o=yield _(),r={documentUuids:e},i=yield fetch(t,{method:"POST",headers:o,body:JSON.stringify(r)});return yield i.json()}))}function w(){return r(this,void 0,void 0,(function*(){const e=`${n.url_api}/arborescence/recents`,t=yield _(),o=yield fetch(e,{method:"POST",headers:t});return yield o.json()}))}function O(e){return r(this,void 0,void 0,(function*(){const t=`${n.url_api}/documents/_search`,o=yield _(),r=yield fetch(t,{method:"POST",headers:o,body:JSON.stringify({format:"mini",depuis:[],recherche:e})});return(yield r.json()).resultats}))}function R(e){return r(this,void 0,void 0,(function*(){(yield v(e.map((e=>e.id)))).forEach((t=>{t.infosPartages.filter((e=>e.access===l.DocumentAccessType.PUBLIC)).length>0&&(e.find((e=>e.id===t.id)).selectionnable=!1)}))}))}t.login=E,t.loginToBackend=function(e){return r(this,void 0,void 0,(function*(){const t=n.url_api+"/auth/login";return fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}).then((e=>e.json())).then((e=>e)).catch((e=>console.warn(e)))}))},t.createElement=function(e,t,o){return r(this,void 0,void 0,(function*(){const r=yield _();let a="elements";({endpoint:a,parentId:o}=yield(0,p.handleRoot)(a,o));const l=new i.PoplabElementCreationRequest(e,o),u=yield fetch(`${n.url_api}/${a}`,{method:"POST",headers:r,body:JSON.stringify(l)});if(!u.ok){const e=yield u.json(),t=chrome.i18n.getMessage(e.localizedMessage.replace(/\./g,"_"));throw new Error(`${chrome.i18n.getMessage("erreur_creation_element")} : `+t||e.errorCode)}const d=yield u.json();if(t==c.CaptureType.UPLOAD){const t=[];for(const r of e.getMedias())if(r.file){const e=(0,h.transformMediaIntoFile)(r.file,r.id);t.push(y(d.id,s.PoplabObjectType.ELEMENT,r,e,o))}yield Promise.all(t)}return d}))},t.createDocument=function(e,t){return r(this,void 0,void 0,(function*(){const o=yield _();let r="documents";({endpoint:r,parentId:t}=yield(0,p.handleRoot)(r,t));const i=new l.PoplabDocumentCreationRequest(e,t),s=yield fetch(`${n.url_api}/${r}`,{method:"POST",headers:o,body:JSON.stringify(i)});if(!s.ok)throw new Error(`${chrome.i18n.getMessage("erreur_creation_document")} : `+(yield s.json()).status);return yield s.json()}))},t.uploadFile=y,t.update_menus=g,t.est_connecte=function(){return r(this,void 0,void 0,(function*(){try{const e=new Date,t=new Date((yield browser.storage.local.get("expiration_date")).expiration_date);if((0,d.isTokenExpired)(t,e))return!1}catch(e){return!1}return!0}))},t.logoutFromKeycloak=function(){return r(this,void 0,void 0,(function*(){const e=(yield browser.storage.local.get("id_token")).id_token,t=n.url_auth+`/logout?post_logout_redirect_uri=${encodeURIComponent(n.base_url_front)}&id_token_hint=${encodeURIComponent(e)}`;try{yield(0,u.launchWebAuthFlow)({interactive:!0,url:t,redirect_uri:n.base_url_front})}finally{yield(0,d.cleanLocalSessionsData)(),yield g(!1)}}))},t.getDocuments=v,t.getMostRecentConsultedHierarchies=w,t.getMostRecentConsultedHierarchiesWithSelectionnable=function(){return r(this,void 0,void 0,(function*(){const e=yield w();return yield R(e),e}))},t.searchArborescence=O,t.searchArborescenceWithSelectionnable=function(e){return r(this,void 0,void 0,(function*(){const t=yield O(e);return yield R(t),t}))}},9246:function(e,t){var o=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.handleRoot=void 0,t.handleRoot=function(e,t){return o(this,void 0,void 0,(function*(){return"frigo"===t?{endpoint:"frigo",parentId:(yield browser.storage.local.get("frigoRootId")).frigoRootId}:"labo"===t?{endpoint:e,parentId:(yield browser.storage.local.get("laboRootId")).laboRootId}:{endpoint:e,parentId:t}}))}},7970:function(e,t){var o=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.extractTokenFields=t.cleanLocalSessionsData=t.saveTokenDataToSession=t.isTokenExpired=void 0,t.isTokenExpired=function(e,t){return null==e||isNaN(e.getTime())||t.getTime()>=e.getTime()},t.saveTokenDataToSession=function(e){return o(this,void 0,void 0,(function*(){yield browser.storage.local.set({refresh_token:e.refresh_token,access_token:e.access_token,id_token:e.id_token,expiration_date:e.expiration_date,refresh_expiration_date:e.refresh_expiration_date,first_name:e.first_name,provenance:e.provenance})}))},t.cleanLocalSessionsData=function(){return o(this,void 0,void 0,(function*(){yield browser.storage.local.remove(["refresh_token","access_token","expiration_date","refresh_expiration_date","first_name","provenance","use_clipper"])}))},t.extractTokenFields=function(e,t){e.refresh_token=t.refresh_token,e.access_token=t.access_token,e.id_token=t.id_token;const o=new Date,r=new Date;o.setSeconds(o.getSeconds()+t.expires_in),e.expiration_date=o.getTime(),r.setSeconds(r.getSeconds()+t.refresh_expires_in),e.refresh_expiration_date=r.getTime();try{const o=JSON.parse(atob(t.access_token.split(".")[1])),r=o.given_name;e.first_name=decodeURIComponent(escape(r)),e.provenance=o.poplab.provenance}catch(e){console.error("cannot parse JWT token, unable to fetch user firstname",e)}}},5541:function(e,t){var o=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};function r(e,t,o,r,n,i,s){var a,c;try{c=(a=e[i](s)).value}catch(e){return void o(e)}a.done?t(c):Promise.resolve(c).then(r,n)}function n(e){return function(){let t=this,o=arguments;return new Promise((function(n,i){var s=e.apply(t,o);function a(e){r(s,n,i,a,c,"next",e)}function c(e){r(s,n,i,a,c,"throw",e)}a(void 0)}))}}function i(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){let r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((t=>Object.getOwnPropertyDescriptor(e,t).enumerable))),o.push.apply(o,r)}return o}function a(e,t){return c.apply(this,arguments)}function c(){return n((function*(e,t){if(browser.windows&&!t)return yield browser.windows.create(e);const o={active:"minimized"!==e.state,url:e.url};return{tabs:[yield browser.tabs.update(browser.tabs.getCurrent().id,o)]}})).apply(this,arguments)}function l(e,t,o){return u.apply(this,arguments)}function u(){return n((function*(e,t,o){return e?yield browser.windows.update(e,o):yield browser.tabs.update(t,{active:o.focused})})).apply(this,arguments)}function d(e,t){return p.apply(this,arguments)}function p(){return n((function*(e,t){return e?yield browser.windows.remove(e):yield browser.tabs.remove(t)})).apply(this,arguments)}function h(){var e=n((function*({url:e,redirect_uri:t,interactive:r=!1,alwaysUseTab:n=!1,windowOptions:c}){const u=yield a(function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?s(Object(o),!0).forEach((function(t){i(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({type:"popup",url:e,state:"minimized"},c),n),p=u.id,h=u.tabs[0].id,b=function(){const e={};return e.promise=new Promise(((t,o)=>{e.resolve=t,e.reject=o})),e}(),f=b.promise,E=b.resolve,_=b.reject;browser.tabs.onUpdated.addListener(y),browser.webNavigation.onDOMContentLoaded.addListener(g),browser.tabs.onRemoved.addListener(m);try{return yield f}finally{browser.tabs.onUpdated.removeListener(y),browser.webNavigation.onDOMContentLoaded.removeListener(g),browser.tabs.onRemoved.removeListener(m),d(p,h).catch((e=>console.warn(JSON.stringify(e))))}function y(e,r,n){return o(this,void 0,void 0,(function*(){if(e===h&&null!=n.url&&n.url.startsWith(t))return E(n.url),{cancel:!0}}))}function g(e){e.frameId||e.tabId!==h||(r?l(p,h,{focused:!0,state:"normal"}).catch((e=>console.error(e))):E(null),browser.webNavigation.onDOMContentLoaded.removeListener(g))}function m(e){e===h&&_()}}));return e.apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.launchWebAuthFlow=void 0,t.launchWebAuthFlow=function(e){return h.apply(this,arguments)}},4056:(e,t,o)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.maxResolution=t.handledVideosPlatform=t.url_belin_api_resources=t.url_belin_api=t.url_belin_resources=t.url_belin=t.url_labo=t.url_frigo=t.url_auth=t.url_keycloack=t.url_api=t.base_url_front=t.VERSION=void 0,o(7505),o(872),o(7466),o(3848);const n=o(7260);let i;o(3734),i=n.config,t.VERSION=null!==(r=i.VERSION)&&void 0!==r?r:"3.50.1",t.base_url_front=i.base_url_front,t.url_api=i.url_api,t.url_keycloack=i.url_keycloack,t.url_auth=t.url_keycloack+"/realms/lde-poplab/protocol/openid-connect",t.url_frigo=t.base_url_front+"/frigo",t.url_labo=t.base_url_front+"/labo/mes-documents",t.url_belin="https://manuelnumeriquemax.belin.education/",t.url_belin_resources="https://resources.manuelnumeriquemax.belin.education/",t.url_belin_api="https://api.manuelnumeriquemax.belin.education/main/v1/nodes/",t.url_belin_api_resources="https://api.manuelnumeriquemax.belin.education/main/v1/resources",t.handledVideosPlatform=["youtube.com/watch","youtube.com/embed","youtu.be/","vimeo.com/","dailymotion.com/"],t.maxResolution=49e6},7466:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.integration-its.poplab.education",url_api:"https://app.integration-its.poplab.education/api",url_keycloack:"https://id.integration-its.poplab.education"}},7505:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"http://localhost:8000",url_api:"http://localhost:8082/api",url_keycloack:"http://auth.poplab.local"}},3848:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.preprod-its.poplab.education",url_api:"https://app.preprod-its.poplab.education/api",url_keycloack:"https://id.preprod-its.poplab.education"}},7260:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.poplab.education",url_api:"https://app.poplab.education/api",url_keycloack:"https://auth.poplab.education"}},872:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.sandbox.poplab.education",url_api:"https://app.sandbox.poplab.education/api",url_keycloack:"https://id.sandbox.poplab.education"}},3734:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={VERSION:"TEST",base_url_front:"https://app.sandbox.poplab.education",url_api:"https://app.sandbox.poplab.education/api",url_keycloack:"https://id.sandbox.poplab.education"}},1218:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectableOptionClass=void 0,t.SelectableOptionClass=function(e,t){return function(o){return"id"!==e&&"text"!==t?class extends o{get id(){return this[e]}get text(){return this[t]}}:"id"!==e&&"text"===t?class extends o{get id(){return this[e]}}:"id"===e&&"text"!==t?class extends o{get text(){return this[t]}}:class extends o{}}}},2688:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentCaptureData=t.ElementCaptureData=t.CaptureData=t.FichierMediaObject=t.ExerciseurMediaObject=t.UrlMediaObject=t.AudioMediaObject=t.VideoMediaObject=t.ImageMediaObject=t.MediaObject=t.TypeFichier=t.CaptureType=void 0;const r=o(4393);var n,i;!function(e){e.BASIQUE="BASIQUE",e.UPLOAD="UPLOAD"}(n||(t.CaptureType=n={})),function(e){e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.FICHIER="FICHIER",e.LIEN="LIEN",e.EXERCISEUR="EXERCISEUR"}(i||(t.TypeFichier=i={}));class s{constructor(e,t,o,r,n,i,s){this.id=e,this.url=t,this.type_fichier=o,this.copyright=r,this.file=n,this.editeur=i,this.subTypeFichier=s}}t.MediaObject=s,t.ImageMediaObject=class extends s{constructor(e,t,o,r,n){super(e,t,i.IMAGE,o,r,n)}},t.VideoMediaObject=class extends s{constructor(e,t,o,r,n){super(e,t,i.VIDEO,o,r,n)}},t.AudioMediaObject=class extends s{constructor(e,t,o,r,n){super(e,t,i.AUDIO,o,r,n)}},t.UrlMediaObject=class extends s{constructor(e,t,o,r){super(e,t,i.LIEN,o),this.displayPreview=!1,this.bigPreview=!1,this.label=r}},t.ExerciseurMediaObject=class extends s{constructor(e,t,o){super(e,t,i.EXERCISEUR),this.typeExerciseur=o}},t.FichierMediaObject=class extends s{constructor(e,t,o,r,n){super(e,t,i.FICHIER,void 0,o,void 0,r),this.label=n}};class a{constructor(e,t,o){this.titre=e,this.description=t,this.auteurInitial=o}}t.CaptureData=a;class c extends a{constructor(e){var t,o,n,i,s,a,c;super(null==e?void 0:e.titre,null==e?void 0:e.description,null==e?void 0:e.auteurInitial),this.type=r.ElementType.ELEMENT,this.images=[],this.videos=[],this.audios=[],this.urls=[],this.exerciseurs=[],this.fichiers=[],this.credit=null==e?void 0:e.credit,this.images=null!==(t=null==e?void 0:e.images)&&void 0!==t?t:[],this.videos=null!==(o=null==e?void 0:e.videos)&&void 0!==o?o:[],this.audios=null!==(n=null==e?void 0:e.audios)&&void 0!==n?n:[],this.urls=null!==(i=null==e?void 0:e.urls)&&void 0!==i?i:[],this.exerciseurs=null!==(s=null==e?void 0:e.exerciseurs)&&void 0!==s?s:[],this.fichiers=null!==(a=null==e?void 0:e.fichiers)&&void 0!==a?a:[],this.type=null!==(c=null==e?void 0:e.type)&&void 0!==c?c:r.ElementType.ELEMENT,this.options=null==e?void 0:e.options,this.meta=null==e?void 0:e.meta}setTitre(e){return this.titre=e,this}setDescription(e){return this.description=e,this}setCredit(e){return this.credit=e,this}setImages(e){return this.images=e,this}setVideos(e){return this.videos=e,this}setAudios(e){return this.audios=e,this}setUrls(e){return this.urls=e,this}setExerciseurs(e){return this.exerciseurs=e,this}setType(e){return this.type=e,this}getMedias(){return this.images.concat(this.videos.concat(this.audios.concat(this.fichiers)))}getAllEmbeds(){return this.getMedias().concat(this.urls).concat(this.exerciseurs)}}t.ElementCaptureData=c,t.DocumentCaptureData=class extends a{constructor(e){super(null==e?void 0:e.titre,null==e?void 0:e.description,null==e?void 0:e.auteurInitial),this.elements=[],null==e||e.elements.forEach((e=>this.elements.push(new c(e)))),this.meta=null==e?void 0:e.meta}setTitre(e){return this.titre=e,this}setDescription(e){return this.description=e,this}setElements(e){return this.elements=e,this}}},8033:(e,t)=>{var o,r,n,i,s;Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserContextMenusId=t.MessageOngletDone=t.MessageOnglet=t.MessageOngletType=t.BrowserRuntimeResponse=t.BrowserRuntimeMessageSearchArborescenceWithSelectionnable=t.BrowserRuntimeMessageSearchArborescence=t.BrowserRuntimeMessageGetRecentArborescenceWithSelectionnable=t.BrowserRuntimeMessageGetRecentArborescence=t.BrowserRuntimeMessageForPoplab=t.BrowserRuntimeMessage=t.BrowserRuntimeMessageEventSubType=t.BrowserRuntimeMessageEventType=void 0,function(e){e.STATUS="status",e.CONNECT="connect",e.ENVOYER_SUR_POPLAB="envoyer_sur_poplab",e.CAPTURE_TAB="captureTab",e.GET_RECENT_ARBORESCENCE="getRecentHierarchies",e.SEARCH_ARBORESCENCE="searchArborescence"}(o||(t.BrowserRuntimeMessageEventType=o={})),function(e){e.WITH_SELECTIONNABLE="WithSelectionnable"}(r||(t.BrowserRuntimeMessageEventSubType=r={}));class a{constructor(e,t,o){this.type=e,this.subType=t,this.idp=o}}t.BrowserRuntimeMessage=a,t.BrowserRuntimeMessageForPoplab=class extends a{constructor(e,t,r,n){super(o.ENVOYER_SUR_POPLAB),this.type_item_poplab=e,this.type_capture=t,this.data=r,this.destination=n}},t.BrowserRuntimeMessageGetRecentArborescence=class extends a{constructor(){super(o.GET_RECENT_ARBORESCENCE)}},t.BrowserRuntimeMessageGetRecentArborescenceWithSelectionnable=class extends a{constructor(){super(o.GET_RECENT_ARBORESCENCE,r.WITH_SELECTIONNABLE)}};class c extends a{constructor(e,t,o){super(t,o),this.value=e}}t.BrowserRuntimeMessageSearchArborescence=class extends c{constructor(e){super(e,o.SEARCH_ARBORESCENCE)}},t.BrowserRuntimeMessageSearchArborescenceWithSelectionnable=class extends c{constructor(e){super(e,o.SEARCH_ARBORESCENCE,r.WITH_SELECTIONNABLE)}},function(e){e.INTERDIT="interdit",e.DECONNECTE="dÃ©connectÃ©",e.CONNECTE="connectÃ©",e.ENVOYE="envoyÃ©"}(n||(t.BrowserRuntimeResponse=n={})),function(e){e.STOP_CAPTURE="stopCapture",e.CAPTURER_LIEN="capturerLien",e.CAPTURER_IMAGE="capturerImage",e.CAPTURER_VIDEO="capturerVideo",e.TOGGLE_CAPTURE="toggleCapture",e.START_CAPTURE="startCapture",e.UPLOAD_FRIGO_DONE="uploadFrigoDone",e.CANCEL_UPLOAD="cancelUpload",e.REFRESH_CAPTURE="refreshCapture"}(i||(t.MessageOngletType=i={}));class l{constructor(e,t,o){this.first_name=void 0,this.provenance=void 0,this.type=e,this.first_name=t,this.provenance=o}}t.MessageOnglet=l,t.MessageOngletDone=class extends l{constructor(e,t){super(e),this.documentId=t}},function(e){e.SE_DECONNECTER="se-deconnecter",e.VOIR_FRIGO="voir-frigo",e.ENVOYER_LIEN="envoyer-lien",e.ENVOYER_IMAGE="envoyer-image",e.ENVOYER_VIDEO="envoyer-video"}(s||(t.BrowserContextMenusId=s={}))},308:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.ArborescenceLabo=t.ArborescenceFrigo=t.Arborescence=t.ArborescenceType=void 0;const n=o(1218);var i;!function(e){e.DOCUMENT="document",e.DOSSIER="dossier"}(i||(t.ArborescenceType=i={}));let s=class{constructor(e){this.id=e.id,this.titre=e.titre,this.type=e.type,this.selectionnable=e.selectionnable}};t.Arborescence=s,t.Arborescence=s=r([(0,n.SelectableOptionClass)("id","titre")],s);let a=class extends s{constructor(){super({id:"frigo",titre:chrome.i18n.getMessage("frigo"),type:i.DOSSIER}),this.imageSrc=browser.runtime.getURL("images/fridge.svg")}};t.ArborescenceFrigo=a,t.ArborescenceFrigo=a=r([(0,n.SelectableOptionClass)("id","titre")],a);let c=class extends s{constructor(){super({id:"labo",titre:chrome.i18n.getMessage("labo"),type:i.DOSSIER}),this.imageSrc=browser.runtime.getURL("images/labo.svg")}};t.ArborescenceLabo=c,t.ArborescenceLabo=c=r([(0,n.SelectableOptionClass)("id","titre")],c)},351:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentAccessType=t.PoplabDocumentCreationRequest=void 0,t.PoplabDocumentCreationRequest=class{constructor(e,t){var o;this.type="document",this.ordreFlux=[],this.options={isnew:!1},this.titre=e.titre,this.description=null!==(o=e.description)&&void 0!==o?o:"",this.webAuteurInitial=e.auteurInitial,this.meta=e.meta,this.parent=t}},function(e){e.PUBLIC="PUBLIC",e.REGISTERED="REGISTERED",e.EXPLICIT="EXPLICIT",e.OWNER="OWNER",e.NONE="NONE"}(o||(t.DocumentAccessType=o={}))},4393:(e,t)=>{var o,r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.Editeur=t.ElementType=t.ExerciseurType=t.PoplabElementCreationRequest=void 0,t.PoplabElementCreationRequest=class{constructor(e,t){var r,i,s;this.titre=null!==(r=e.titre)&&void 0!==r?r:"",this.description=null!==(i=e.description)&&void 0!==i?i:"",this.type=e.type,this.options={isnew:!0,separator:!1},this.type!==n.SECTION||this.titre||(this.options.separator=!0),this.credits=null!==(s=e.credit)&&void 0!==s?s:"",this.webAuteurInitial=e.auteurInitial,this.imageEmbed=e.images[0]?{url:e.images[0].url,type:o.IMAGE}:void 0,this.videoEmbed=e.videos[0]?{url:e.videos[0].url,type:o.VIDEO}:void 0,this.audioEmbed=e.audios[0]?{url:e.audios[0].url,type:o.AUDIO}:void 0,this.lienEmbed=e.urls[0]?{url:e.urls[0].url,label:e.urls[0].label,displayPreview:e.urls[0].displayPreview,bigPreview:e.urls[0].bigPreview,type:o.LIEN}:void 0,this.exerciseur=e.exerciseurs[0]?{url:e.exerciseurs[0].url,exerciseurType:e.exerciseurs[0].typeExerciseur,type:o.EXERCISEUR}:void 0,t&&(this.document=t),this.meta=e.meta}},function(e){e.LIEN="LIEN",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.FICHIER="FICHIER",e.EXERCISEUR="EXERCISEUR"}(o||(o={})),function(e){e.QUIZLET="QUIZLET",e.LEARNINGAPPS="LEARNINGAPPS",e.GENIALLY="GENIALLY",e.BOOKWIDGETS="BOOKWIDGETS",e.EDUPOOL="EDUPOOL",e.BELIN="BELIN"}(r||(t.ExerciseurType=r={})),function(e){e.ELEMENT="element",e.SECTION="section"}(n||(t.ElementType=n={})),function(e){e.BELIN="https://www.belin-education.com/"}(i||(t.Editeur=i={}))},853:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.PoplabObjectType=void 0,function(e){e.ELEMENT="ELEMENT",e.DOCUMENT="DOCUMENT"}(o||(t.PoplabObjectType=o={}))}},t={};!function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,o),i.exports}(8199)})();