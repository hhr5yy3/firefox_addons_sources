import{a as Ve}from"./chunk-3REBBJSH.js";import{b as ze,d as He}from"./chunk-543EMZFQ.js";import{c as Te}from"./chunk-L4RDDWJP.js";import{a as vt,g as Pe,h as xt,i as Ht,j as Le,k as Ie,m as Ct}from"./chunk-6BB4SG5R.js";import{a as $e,b as dt,c as Nt,e as Be}from"./chunk-6V4PETGI.js";import{b as Oe,g as Ue}from"./chunk-LG525BKV.js";import{a as Me}from"./chunk-WOENBU2A.js";import{a as Fe}from"./chunk-W32UHEZE.js";import{a as mt,b as Fi}from"./chunk-3DLX7NOK.js";import{b as Ne,c as Ae,d as Se,e as Ee,f as De,g as Re}from"./chunk-QCT7FZJD.js";import{a as Ce}from"./chunk-FVPQGETT.js";import{a as tt}from"./chunk-KWDMUJJA.js";import{a as A}from"./chunk-MT4LVDUX.js";import{a as xe}from"./chunk-WN4MFSKN.js";import{a as et}from"./chunk-7S3YJSN5.js";import{M as it,a as g,c as zt,d as ve,e as j,f as p,n as Bi}from"./chunk-LADTODTA.js";import{B as u,c,g as I,r as l,s as ye,v as x,x as M}from"./chunk-WRHUMLYF.js";import{E as Oi,J as Vt,K as Ui,T as $i,q as L}from"./chunk-OEPSEZ5A.js";import{e as a}from"./chunk-3GYLW4KZ.js";Fi();function We(){let e=x(),t=c.get("tabId");return c.get(["couponsDisabledSites",`${e}_${t}`])>mt()||c.get(["couponsDisabledSites",`${e}_all`])>mt()}function Ye(){let e=x(),t=c.get("tabId");return c.get(["cashbackDisabledSites",`${e}_${t}`])>mt()||c.get(["cashbackDisabledSites",`${e}_all`])>mt()}var Ke=a(L());Ui();function Y(){let e=c.get(["session"]);return e&&e.roles&&e.roles.indexOf("shadow")===-1}var qe=e=>M("confirmEmailAddress",e);var Xe=e=>M("emailCreateAccount",e);var Ge=a(L());function Wt(e){let t;if(e&&e.responseText)try{t=Ge.default.get(JSON.parse(e.responseText),"error")}catch{t=null}return t}async function ut(e){try{return await qe(e)}catch(t){return{error:Wt(t)||"There was an error"}}}async function ft(e){try{return await Xe(e)}catch(t){return{error:Wt(t)||"There was an error"}}}var Je=a(p()),Yt,At=1e3*60*60*24,Vi=At*30;async function zi(e,t){switch(e.type){case dt.Destroy:t?.(),c.set("emailCreateAccountVisible",!1);break;case dt.NotificationShow:u("track","extEmailCreateAccount",{action:"seen"});break;case dt.NotificationDismiss:await ft({message:"dismiss"}),u("track","extEmailCreateAccount",{action:"dismissed"}),c.set("emailCreateAccountVisible",!1);break;case dt.Custom:e.eventName==="onCreateAccountClick"?(await ft({message:"clickedCreateAccount"}),u("track","extEmailCreateAccount",{action:"clicked"})):e.eventName==="onSignInClick"&&(await ft({message:"clickedSignIn"}),u("track","extEmailCreateAccount",{action:"signIn"})),c.set("emailCreateAccountVisible",!1),t?.();break}}function Hi(e){let t=e||c.get(["cashback","reward"]);if(!t)return"Rewards";let i=t.categories||t.estimated?"up to ":"";if(t.type==="percentage")return`${i} ${t.amount/100}% Rewards`;let o=t.tiers?.length?t.tiers[t.tiers.length-1].reward.value:t.amount,n=t.tiers?.length?t.tiers[t.tiers.length-1].spend_cents:t.threshold,r=t.type==="threshold"&&n?A(n,{currency:t.currency}):"",s=t.type==="threshold"&&n?` when you spend ${r}`:"",d=A(o,{currency:t.currency});return`${i+d} Rewards${s}`}async function St(e){if(await qt()){Vt(["*** emailCreateAccount: showing notification"]);let i=await Ue(),o=Hi(e),n={rootEl:"div",logLevel:void 0};Yt?.(),Yt=(await it({initialRoute:"/emailCreateAccountNotification",blankSlate:!0,app:(0,Je.jsx)(Nt,{config:n,content:i,data:{rewardsText:o},user:{featureFlags:ye()},onEvent:s=>zi(s,Yt),onRequest:Be}),disableDelay:!0})).unloadApp,c.set("emailCreateAccountVisible",!0)}}async function Wi(){let e=await ft({message:"getEvents"}),t=Ke.default.chain(e).pickBy(d=>new Date().valueOf()-new Date(d).valueOf()<Vi).value(),i="hasClickedEmailSignIn"in t&&new Date().valueOf()-new Date(t.hasClickedEmailSignIn).valueOf()<At;if("hasClickedEmailCreateAccount"in t&&new Date().valueOf()-new Date(t.hasClickedEmailCreateAccount).valueOf()<At||i)return!0;let n="seenEmailCreateAccount1"in t&&"seenEmailCreateAccount2"in t&&"seenEmailCreateAccount3"in t,r=new Date(Math.max(new Date(t.seenEmailCreateAccount1||0).valueOf(),new Date(t.seenEmailCreateAccount2||0).valueOf(),new Date(t.seenEmailCreateAccount3||0).valueOf())),s=r&&new Date().valueOf()-r.valueOf()<At;return!!(n||s)}async function qt(){Vt(["*** emailCreateAccount: evaluating..."]);let e=l("ext_email_create_account_notification_control"),t=c.get("emailCreateAccountVisible");return Y()||e||t||await Wi()?!1:l("ext_email_create_account_notification_enabled")}function Et(e){return e==="amazon.com"||e==="amazon.ca"}var Qe=a(g()),T=a(g()),q=a(L());var Ze=e=>M("getElevatedCashback",e);var Xt=()=>M("setReactivateNotifThrottled",{domain:x()});var w=a(p()),Yi=({children:e})=>(0,w.jsx)("div",{className:"bg-overlay flex justify-center items-center fixed top-0 left-0 w-screen h-screen z-[9999]",children:e}),qi=({children:e})=>(0,w.jsx)("div",{className:"bg-white rounded-lg flex flex-col items-center p-2 w-[400px] h-[240px]",children:e}),Xi=({children:e})=>(0,w.jsx)("div",{className:"mt-2 flex justify-between w-full",children:e}),Gi=({children:e})=>(0,w.jsx)("div",{className:"flex flex-col items-center mt-8 w-full",children:e}),Ki=e=>{let t=c.get("cashback"),[i,o]=(0,T.useState)(e.hasActivatedCompetitor||e.warnAboutStandDown),[n,r]=(0,T.useState)(q.default.get(t,"user.compInactivated")),[s,d]=(0,T.useState)(n&&i),[m,v]=(0,T.useState)(!1),[R,C]=(0,T.useState)(!1),[b,E]=(0,T.useState)("Re-activate Rewards"),[N,Q]=(0,T.useState)(q.default.get(e.view,"reward",{})),pt=q.default.get(e,"view.exclusions"),yt=async()=>{let W=e.tld,z=await Ze({domain:W}),O=q.default.get(z,"reward.amount");O&&q.default.isNumber(O)&&N.amount!==O&&(c.set(["cashback","id"],z.id),Q(z.reward))};(0,T.useEffect)(()=>{l("notif_reactivation_elevated")&&(i||n)&&yt(),Le(e.tld)},[]),(0,T.useEffect)(()=>{s&&u("page","rewardsReactivation",{view:"rewardsReactivation",type:"notification"})},[s]);let $t=async()=>{let W=await xt();c.merge({cashback:W}),r(q.default.get(c.get("cashback"),"user.compInactivated")),o(e.hasActivatedCompetitor||e.warnAboutStandDown)};(0,T.useEffect)(()=>{(e.hasActivatedCompetitor||e.warnAboutStandDown)&&$t()},[e.hasActivatedCompetitor,e.warnAboutStandDown]),(0,T.useEffect)(()=>{n&&i&&d(!0)},[n,i]);let Pi=async()=>{let z=c.get(["couponView","hasDeferredCouponRewards"])?"Activate":"Re-activate",O=`${z} Rewards`;if(l("notif_reactivation_elevated")){let ke=N.type==="percentage"?`${N.amount/100}%`:A(N.amount,{currency:N.currency}),Bt=`${z} ${ke} back`;return N.categories&&(Bt=`${z} up to ${ke} back`),E(Bt),Bt}return E(O),O};(0,T.useEffect)(()=>{Pi()},[N]);let Li=async(W={})=>{v(!0),await Ct({reward:N,view:"cashbackReactivate",label:b}),v(!1),C(!0),Xt(),setTimeout(()=>d(!1),1e3)},Ii=()=>{u("trackClick","viewExclusionDetails","view details"),window.open(`${I}/s/${e.tld}/coupon`,"_blank")},Mi=(W,z=!1)=>{let O=q.default.get(e.view,"reward",{});d(!1),z||(u("trackClick","dismissCashbackNotification",W,{rewardAmount:O.amount,rewardDisplay:O.type}),vt("rewardsReactivation",W,"dismiss","primary",{rewardAmount:O.amount,rewardDisplay:O.type})),Xt()};return(0,w.jsx)(Qe.default.Fragment,{children:s?(0,w.jsx)(Yi,{children:(0,w.jsxs)(qi,{children:[(0,w.jsxs)(Xi,{children:[(0,w.jsx)(et,{greyscale:l("ext_alternative_logo_1"),swoosh:l("ext_alternative_logo_2")}),(0,w.jsx)(tt,{onClick:()=>{Mi(b)}})]}),(0,w.jsxs)(Gi,{children:[(0,w.jsx)("p",{className:"text-2xl leading-9 font-bold text-neutralprimary",children:"Oops! Rewards were disabled."}),(0,w.jsx)("p",{className:"leading-6 text-neutralsecondary",children:"You used another coupon site."}),m?(0,w.jsx)("h5",{className:"bold rewards-only-button red",children:"Activating..."}):R?(0,w.jsx)("h5",{className:"bold rewards-only-button red",children:"Activated!"}):(0,w.jsx)("button",{className:"primary-btn-large red-btn-test",style:{width:"90%",marginTop:"16px"},onClick:Li,children:b}),(m||R)&&(0,w.jsx)("div",{className:`exclusions-wrapper ${m||R?"visible":"invisible"}`,children:(0,w.jsx)("h6",{style:{height:"30px",display:"flex",marginTop:"10px",paddingLeft:"3px",textAlign:"center"},children:(0,w.jsxs)("span",{children:[(0,w.jsx)("div",{children:"* Rewards may vary based on exchange rates."}),pt?(0,w.jsxs)("div",{children:[" ","Terms and exclusions apply,",(0,w.jsxs)("span",{className:"tertiary-link-lighter",onClick:Ii,children:[" ","view details."]})]}):null]})})})]})]})}):null})},je=j({view:["cashbackView"],couponView:["couponView"],offers:["offers"],deweyResult:["deweyResult"],events:["events"],session:["session"],settings:["settings"],tld:["siteAPIData","siteData","tld"],hasActivatedCompetitor:["hasActivatedCompetitor"],warnAboutStandDown:["warnAboutStandDown"],couponsVisible:["couponsVisible"]},Ki);var ti=a(L());var Ji=ti.default.debounce(()=>{u("track","standDownIndicator")},5e3,{leading:!0,trailing:!1}),ei=Ji;var y=a(L()),Ti=a(Oi());var Qr=a(g()),Di=a(g()),Ri=a(Bi()),wt=a(xe()),k=a(L());var ii=e=>M("setSeenCashbackNotification",e);function Dt(){return l("ext_notif_center")}function Zi(e){return Dt()?!1:l("coup_shift_left")?!0:l("n_or_1")&&e}function oi(e){return Dt()?{left:"50%",right:"auto",translateX:"-50%"}:Zi(e)?{left:void 0,right:310,translateX:"initial"}:{left:void 0,right:void 0,translateX:"initial"}}var Ma=a(g());var si=a(L());var va=a(g()),ai=a(g()),ht=a(xe()),ni=a(L());var D=a(p()),Gt=class extends ai.Component{constructor(...t){super(...t),this.state={hideNotification:!1}}componentDidMount(){u("track","extEmailConfirmation",{action:"displayed"})}render(){let{hideNotification:t}=this.state,{email:i}=ni.default.get(this.props,"session");return(0,D.jsx)("div",{className:t?"disabled email-confirmation-page":"email-confirmation-page",style:{top:"0",bottom:"auto",left:"auto",right:"0"},children:(0,D.jsx)(ht.Motion,{style:{opacity:(0,ht.spring)(t?0:1,{stiffness:180,damping:20}),y:(0,ht.spring)(t?!0?-100:100:0,{stiffness:180,damping:20})},children:({opacity:n,y:r})=>(0,D.jsxs)("div",{className:"email-confirmation-notification",style:{transform:`translate3d(0,${r}%,0)`,opacity:`${n}`},children:[(0,D.jsxs)("header",{children:[(0,D.jsx)(et,{}),(0,D.jsx)(tt,{onClick:this.onClosePopup.bind(this)})]}),(0,D.jsxs)("section",{children:[(0,D.jsx)("h5",{style:{fontWeight:"600",color:"black"},children:"Please verify your email address so we can notify you when your rewards are ready to use!"}),(0,D.jsx)("br",{}),(0,D.jsxs)("h5",{children:["The email address associated with your account is"," ",(0,D.jsx)("span",{style:{fontWeight:"bold",color:"black"},children:i})]}),(0,D.jsx)("div",{className:"button-wrapper",children:(0,D.jsx)("button",{className:"primary-btn-large",onClick:this.onConfirm.bind(this),children:"Confirm"})}),(0,D.jsx)("div",{className:"link-wrapper",children:(0,D.jsx)("a",{className:"not-your-email-link",href:"https://capitaloneshopping.com/help",target:"_blank",rel:"noopener noreferrer",onClick:this.onNotYourEmailClicked.bind(this),children:"Not your email?"})})]})]})})})}async onClosePopup(){await ut({message:"dismiss"}),u("track","extEmailConfirmation",{action:"dismiss"}),c.set("emailConfirmationVisible",!1),this.setState({hideNotification:!0})}async onConfirm(){await ut({message:"confirm"}),u("track","extEmailConfirmation",{action:"confirm"}),c.set("emailConfirmationVisible",!1),this.setState({hideNotification:!0})}async onNotYourEmailClicked(){u("track","extEmailConfirmation",{action:"notYourEmail"})}},Kt=j({session:["session"]},Gt);var ri=a(p()),Jt=1e3*60*60*24,Qi=Jt*7,ji=Jt*270;async function Zt(){await to()&&(it({initialRoute:"/emailConfirmation",cssUrl:"cashback.css",route:(0,ri.jsx)(ve,{path:"emailConfirmation",component:Kt}),disableDelay:!0}),c.set("emailConfirmationVisible",!0))}async function to(){if(c.get("emailConfirmationVisible")||!l("email_unengaged"))return!1;let e=await ut({message:"getEvents"}),t=si.default.chain(e).pickBy(s=>new Date-new Date(s)<ji).value();if("hasConfirmedEmail"in t&&new Date-new Date(t.hasConfirmedEmail)<Qi)return!1;let o="seenEmailConfirmation1"in t&&"seenEmailConfirmation2"in t&&"seenEmailConfirmation3"in t,n=new Date(Math.max(new Date(t.seenEmailConfirmation1||0),new Date(t.seenEmailConfirmation2||0),new Date(t.seenEmailConfirmation3||0))),r=n&&new Date-n<Jt;return!(o||r)}var me=a(g()),vi=a(g()),Z=a(L());var ci=a(g()),li=a(g()),bt=a(L());var S=a(p()),Qt=class extends li.Component{constructor(t){super(t),this.state={expanded:!1}}toggleContainerSize(t){t.preventDefault(),this.setState({expanded:!this.state.expanded})}onShowExclusion(){u("trackClick","viewExclusionDetails","view details"),window.open(`${I}/s/${this.props.tld}/coupon`,"_blank")}render(){let{expanded:t}=this.state,{center:i,couponCount:o,displayInModal:n,hasCoupons:r,reward:s,runTimeSeconds:d,showCouponCount:m,showDismiss:v,showReward:R}=this.props,C=R?s.type==="percentage"?`${s.amount/100}%`:A(s.amount,{currency:s.currency}):"",b=s&&bt.default.get(s,"categories.length",0)>5,E=5,N=bt.default.get(s,"categories")||[],Q=t?N:N.slice(0,E);return s.categories?(0,S.jsxs)("div",{className:`simple-section ${i?"center":""} ${n?"display-in-modal":""}`,children:[R&&(0,S.jsxs)("div",{className:"reward-text",children:[(0,S.jsxs)("h2",{children:["Up to ",(0,S.jsx)("span",{className:"palmetto",children:C})," in Rewards Activated"]}),m&&(0,S.jsxs)("h6",{className:"bold center",children:[o," ",o===1?" code ":" best codes "," tested in"," ",d," sec."]}),(0,S.jsxs)("h6",{className:"exclusion-text center",children:["*Rewards may vary based on exchange rates. Terms and exclusions apply",bt.default.get(this.props,"view.exclusions")?(0,S.jsxs)(ci.default.Fragment,{children:[","," ",(0,S.jsx)("span",{className:"tertiary-link-lighter",onClick:this.onShowExclusion.bind(this),children:"view details."})]}):null]})]}),(0,S.jsxs)("div",{className:"reward-categories",children:[(0,S.jsx)("h5",{className:"bold",children:"Rewards by Category"}),(0,S.jsxs)("div",{className:`cashback-category-section ${r&&"show-border"}`,children:[(0,S.jsx)("div",{className:`cashback-category-container ${t&&"expanded"}`,children:bt.default.map(Q,({name:pt,amount:yt,type:$t})=>(0,S.jsxs)("div",{className:"cashback-category-row",children:[(0,S.jsx)("p",{className:"cashback-category-name",children:pt}),(0,S.jsx)("span",{className:"cashback-category-reward",children:$t==="percentage"?`${yt/100}%`:A(yt)})]},pt))}),b&&(0,S.jsxs)("h5",{className:"toggle-container-cta",onClick:this.toggleContainerSize.bind(this),children:["Show ",this.state.expanded?"all":"fewer"," categories"]})]})]}),v&&(0,S.jsx)("div",{className:"dismiss-notif",children:(0,S.jsx)("h4",{className:"primary-link bold",onClick:this.props.onClosePopup.bind(this),children:"Continue to Checkout"})})]}):null}},jt=Qt;var Rt=a(p()),eo={width:40,height:25,color:"#adb9bf",marginTop:0};function pi({style:e,flex:t,width:i,height:o,color:n,onClick:r,marginTop:s,marginRight:d,marginLeft:m}){return(0,Rt.jsx)("div",{style:{...e,display:"flex",flex:t,justifyContent:"right",alignItems:"center",width:i,height:o,color:n,marginTop:s,marginRight:d,marginLeft:m},onClick:r,children:(0,Rt.jsx)("svg",{width:"28",height:"29",viewBox:"0 0 28 29",fill:"none",style:{cursor:"pointer"},"aria-label":"Settings",role:"button",xmlns:"http://www.w3.org/2000/svg",children:(0,Rt.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M25.9952 15.1504L23.019 18.1266V22.3506C23.019 22.9802 22.5039 23.4953 21.8743 23.4953H17.6389L14.6627 26.4715C14.2163 26.9179 13.4951 26.9179 13.0487 26.4715L10.0725 23.4953H5.84855C5.21896 23.4953 4.70385 22.9802 4.70385 22.3506V18.1152L1.72765 15.139C1.28121 14.6926 1.28121 13.9714 1.72765 13.525L4.70385 10.5488V6.32485C4.70385 5.69527 5.21896 5.18015 5.84855 5.18015H10.0725L13.0601 2.20395C13.274 1.9896 13.5643 1.86914 13.8671 1.86914C14.1699 1.86914 14.4603 1.9896 14.6741 2.20395L17.6503 5.18015H21.8743C22.5039 5.18015 23.019 5.69527 23.019 6.32485V10.5488L25.9952 13.5364C26.4416 13.9829 26.4416 14.704 25.9952 15.1504ZM6.99317 14.3379C6.99317 18.1268 10.0724 21.2061 13.8613 21.2061C17.6503 21.2061 20.7295 18.1268 20.7295 14.3379C20.7295 10.549 17.6503 7.46973 13.8613 7.46973C10.0724 7.46973 6.99317 10.549 6.99317 14.3379Z",fill:"#B4BDC2"})})})}pi.defaultProps=eo;var _t=pi;var ot=a(g());var P=a(p());function io(e){let[t,i]=(0,ot.useState)(!1),o=s=>{let d=(0,ot.useRef)();return(0,ot.useEffect)(()=>{let m=()=>{s()};return document.addEventListener("click",m,!0),()=>{document.removeEventListener("click",m,!0)}},[d]),d},n=()=>{setTimeout(()=>{i(!1)})};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{style:{width:48},children:(0,P.jsx)(_t,{onClick:()=>i(!t),style:{position:"fixed",top:14,right:15}})}),t?(0,P.jsx)(()=>(0,P.jsx)("div",{ref:o(n),className:"notification-menu",children:(0,P.jsxs)("ul",{children:[(0,P.jsx)("li",{children:(0,P.jsx)("p",{onClick:e.confirmDismiss,className:"menu-item",children:"Dismiss Notification"})}),(0,P.jsx)("li",{children:(0,P.jsx)("p",{onClick:e.snoozeNotification,className:"menu-item",children:"Snooze for 24 Hours"})})]})}),{}):null]})}var te=io;var mi=e=>M("notificationThrottlingSet",{type:e,value:!0});var di=e=>{e.stopPropagation();let t=`${I}/my-rewards/lifetime-savings`;u("trackClick","showSettingSiteHub","x"),window.open(t,"_blank")},ui=e=>()=>{mi("24_hr_throttle_all"),e("Snooze for 24 Hours")},at=(e,t,i,o,n)=>{e.stopPropagation(),o?(i(t,!0),u("trackClick","dismissCompetitorClickWarning",t,{rewardAmount:n?.amount,rewardDisplay:n?.type})):i(t)};var Tt=a(p()),Pt=({hasActivatedCompetitor:e,onUserClosePopup:t,reward:i})=>l("ext_notif_snooze")&&t?(0,Tt.jsx)(te,{confirmDismiss:()=>t("Dismiss Notification"),snoozeNotification:ui(t)}):e!=null&&l("cb_cta_ui_control")&&!e?(0,Tt.jsx)(_t,{onClick:di,style:{position:"fixed",top:14,right:15}}):t?(0,Tt.jsx)(tt,{onClick:o=>at(o,"x",t,e,i),style:{position:"fixed",top:19,right:15,width:11,height:11}}):null;var F=a(p());function ee({text:e,hoverTitle:t,hoverText:i,side:o="bottom",sideOffset:n=25}){return(0,F.jsx)(Se,{delayDuration:100,skipDelayDuration:100,children:(0,F.jsxs)(Ee,{children:[(0,F.jsx)(De,{asChild:!0,children:(0,F.jsxs)("p",{className:"inline text-xs text-gray-600",children:[e,(0,F.jsx)(Ne,{className:"h-4 w-4"})]})}),(0,F.jsxs)(Re,{className:"w-[305px] p-4",side:o,sideOffset:n,children:[t&&(0,F.jsx)("p",{className:"text-sm font-[Circular-Pro-Black] mb-2",children:t}),(0,F.jsx)("p",{className:"text-xs",children:i})]})]})})}var $=a(p());function oo(){u("trackClick","viewExclusionDetails","view details"),window.open(`${I}/s/${x()}/coupon`,"_blank")}function ie({reward:e,containerStyle:t}){if(e?.type!=="threshold"&&!e?.threshold)return null;let i=c.get(["siteAPIData","siteData","merchantPage","exclusions"]);return(0,$.jsx)("div",{style:t,children:(0,$.jsx)(ee,{side:"left",text:"*Terms and Conditions Apply",hoverTitle:"This limited time offer is available for one use only.",hoverText:(0,$.jsxs)($.Fragment,{children:["The spend requirement must be met in a single transaction, on non-excluded items, after discounts, store credits, and redemption dollars are applied, and before taxes and shipping fees are applied.",i&&(0,$.jsxs)($.Fragment,{children:[" ","Exclusions apply,"," ",(0,$.jsx)("span",{className:"tertiary-link-lighter",onClick:oo,children:"view details"}),"."]})]})})})}var hi=a($i());var Lt=a(g());var ao=["data:image/jpeg;base64,","data:image/png;base64,","data:image/webp;base64,"];async function oe(e){try{let t=await fetch(e).then(o=>o.blob());return await new Promise(o=>{let n=new window.FileReader;n.onload=()=>{let r=n.result,s=!!r&&ao.some(d=>r.startsWith(d));o(s?r:null)},n.readAsDataURL(t)})}catch{return null}}function ae(e){let[t,i]=(0,Lt.useState)("");return(0,Lt.useEffect)(()=>{async function o(){i(await oe(e))}e&&o()},[e]),t}var Vn=a(g()),h=a(p());function no(){return(0,h.jsx)("svg",{width:"129px",height:"128px",viewBox:"0 0 159 158",version:"1.1",xmlns:"http://www.w3.org/2000/svg",style:{height:"100%"},children:(0,h.jsxs)("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:[(0,h.jsxs)("g",{transform:"translate(1.508527, 0.595868)",children:[(0,h.jsx)("mask",{id:"mask-2",fill:"white",children:(0,h.jsx)("polygon",{points:"0.0159903815 0.158395289 156.744206 0.158395289 156.744206 156.886611 0.0159903815 156.886611"})}),(0,h.jsx)("path",{d:"M156.744357,78.5224278 C156.744357,121.802055 121.659046,156.886611 78.3801738,156.886611 C35.1013011,156.886611 0.0159903815,121.802055 0.0159903815,78.5224278 C0.0159903815,35.2435551 35.1013011,0.158244436 78.3801738,0.158244436 C121.659046,0.158244436 156.744357,35.2435551 156.744357,78.5224278",fill:"#E8E9E9",mask:"url(#mask-2)"})]}),(0,h.jsx)("mask",{id:"mask-4",fill:"white",children:(0,h.jsx)("polygon",{points:"0 157.48263 158.252733 157.48263 158.252733 0.754263279 0 0.754263279"})}),(0,h.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 99.6562815 139.51985 99.6562815 139.51985 37.1844254 21.114092 37.1844254"}),(0,h.jsx)("polygon",{stroke:"#177C3E",strokeWidth:"3.852",mask:"url(#mask-4)",points:"27.0803145 94.3138347 133.554382 94.3138347 133.554382 43.1167061 27.0803145 43.1167061"}),(0,h.jsx)("path",{d:"M27.0803145,81.4809501 L27.0803145,94.3139856 L39.9141042,94.3139856 C39.9141042,87.2261735 34.1681266,81.4809501 27.0803145,81.4809501",fill:"#177C3E",mask:"url(#mask-4)"}),(0,h.jsx)("path",{d:"M39.9138779,43.1166307 L27.0800882,43.1166307 L27.0800882,55.9504204 C34.1686545,55.9504204 39.9138779,50.205197 39.9138779,43.1166307",fill:"#177C3E",mask:"url(#mask-4)"}),(0,h.jsx)("path",{d:"M133.554457,55.9501187 L133.554457,43.116329 L120.719913,43.116329 C120.719913,50.204141 126.465891,55.9501187 133.554457,55.9501187",fill:"#177C3E",mask:"url(#mask-4)"}),(0,h.jsx)("path",{d:"M120.720969,94.314061 L133.554005,94.314061 L133.554005,81.4802713 C126.466193,81.4802713 120.720969,87.226249 120.720969,94.314061",fill:"#177C3E",mask:"url(#mask-4)"}),(0,h.jsx)("path",{d:"M96.1528794,68.4205043 C96.1528794,78.3828137 89.0635589,86.4602192 80.3171219,86.4602192 C71.5714392,86.4602192 64.4821186,78.3828137 64.4821186,68.4205043 C64.4821186,58.4574407 71.5714392,50.3807895 80.3171219,50.3807895 C89.0635589,50.3807895 96.1528794,58.4574407 96.1528794,68.4205043",fill:"#177C3E",mask:"url(#mask-4)"}),(0,h.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 102.9856 139.51985 102.9856 139.51985 99.6562815 21.114092 99.6562815"}),(0,h.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 106.314918 139.51985 106.314918 139.51985 102.9856 21.114092 102.9856"}),(0,h.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 109.64499 139.51985 109.64499 139.51985 106.315672 21.114092 106.315672"}),(0,h.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 112.974308 139.51985 112.974308 139.51985 109.64499 21.114092 109.64499"}),(0,h.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 116.303626 139.51985 116.303626 139.51985 112.974308 21.114092 112.974308"}),(0,h.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 119.632944 139.51985 119.632944 139.51985 116.303626 21.114092 116.303626"}),(0,h.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 122.962263 139.51985 122.962263 139.51985 119.63219 21.114092 119.63219"}),(0,h.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 126.291581 139.51985 126.291581 139.51985 122.962263 21.114092 122.962263"}),(0,h.jsx)("polygon",{fill:"#F2F2F2",mask:"url(#mask-4)",points:"73.0526614 99.6562815 87.5812807 99.6562815 87.5812807 37.1844254 73.0526614 37.1844254"}),(0,h.jsx)("polygon",{fill:"#C6C6C5",mask:"url(#mask-4)",points:"73.0526614 126.291581 87.5812807 126.291581 87.5812807 99.6562815 73.0526614 99.6562815"}),(0,h.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"8.87013617 131.013269 38.2011723 131.013269 38.2011723 126.208612 8.87013617 126.208612"}),(0,h.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"2.98235701 126.208612 32.3133932 126.208612 32.3133932 121.4032 2.98235701 121.4032"}),(0,h.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"3.09775929 121.4032 32.4287954 121.4032 32.4287954 116.598543 3.09775929 116.598543"}),(0,h.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"5.92624659 116.598543 35.2572827 116.598543 35.2572827 111.793132 5.92624659 111.793132"}),(0,h.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"2.98235701 111.793886 32.3133932 111.793886 32.3133932 106.988475 2.98235701 106.988475"}),(0,h.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"-0.000754263279 106.988475 29.3302819 106.988475 29.3302819 102.183818 -0.000754263279 102.183818"}),(0,h.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"5.92624659 102.183818 35.2572827 102.183818 35.2572827 97.3784064 5.92624659 97.3784064"}),(0,h.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"2.94388958 97.3784064 32.2749257 97.3784064 32.2749257 92.5737493 2.94388958 92.5737493"})]})})}var fi=no;var nt=a(p()),so="https://images.capitaloneshopping.com/api/v1/logos",ro=({domain:e,width:t=300,height:i=300})=>{let o=ae(`${so}?${hi.default.stringify({domain:e,width:t,height:i})}`);return(0,nt.jsx)("div",{className:"partner-logo-component",children:o===null?(0,nt.jsx)("div",{className:"partner-logo",children:(0,nt.jsx)(fi,{})}):o?(0,nt.jsx)("div",{className:"partner-logo success",style:{backgroundImage:`url("${o}")`}}):(0,nt.jsx)("div",{className:"partner-logo"})})},ne=ro;var B=a(p());function It({reward:e}){if(!e?.tiers?.length)return null;let t={currency:e.currency,truncateIntegers:!0};return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("h3",{className:"bold mt-3",id:"threshold-tiers","aria-hidden":!0,children:"Rewards by Spend"}),(0,B.jsx)("ol",{"aria-labelledby":"threshold-tiers",children:e.tiers.map((i,o)=>{let n=o<e.tiers.length-1,r=`Spend ${A(i.spend_cents,t)?.replace(n?/[ A-Z]/g:"","")}${n?"-"+A(e.tiers[o+1].spend_cents,t):"+"}`,s=i.reward.type==="percentage"?`${i.reward.value/100}% back`:A(i.reward.value,t);return(0,B.jsxs)("li",{className:"flex text-sm bold mt-2","aria-label":`${r}, earn ${s}`,children:[(0,B.jsx)("span",{className:"grow text-neutralsecondary","aria-hidden":!0,children:r}),(0,B.jsx)("span",{className:"shrink-0 whitespace-nowrap text-[#0276b1] pl-4","aria-hidden":!0,children:s})]},o)})})]})}var bi=a(g());var J=a(p()),co=e=>e>160&&e<171?e:160;function lo(e){let[t,i]=(0,bi.useState)(!1),o=co(e.exclusions.length),n=e.exclusions.length,r=e.exclusions.substring(0,o);return(0,J.jsxs)("div",{className:"website-exclusions",children:[(0,J.jsx)("h5",{className:"bold",children:"Exclusions Apply:"}),(0,J.jsx)("p",{children:t?e.exclusions:`${r}${n>o?"...":""}`}),n>o?(0,J.jsx)("div",{className:"exclusion-expand",children:(0,J.jsx)("span",{className:"exclusion-expand-text",onClick:()=>i(!t),children:t?"Collapse":"Expand"})}):null]})}var se=lo;var ki=a(g()),yi=a(g()),ct=a(L());var _i=a(g());function gt(e){return["wayfair.com","wayfair.ca","jossandmain.com","birchlane.com","allmodern.com","trade.wayfair.com","perigold.com"].includes(e)}var H=a(p()),po=({onDetailsClick:e,exclusions:t=!0,...i})=>x()==="quill.com"?(0,H.jsx)("p",{style:{color:"#a2adb4",fontSize:"12px",fontFamily:'"Circular-Pro-Book", "Helvetica Neue", Helvetica, Arial, sans-serif',fontWeight:"normal",marginTop:"10px",lineHeight:"1.25em"},children:"*All HP, Epson, and Samsung products are excluded from coupons, discounts, and rewards offers."}):gt(x())?(0,H.jsx)("p",{style:{color:"#a2adb4",fontSize:"12px",fontFamily:'"Circular-Pro-Book", "Helvetica Neue", Helvetica, Arial, sans-serif',fontWeight:"normal",marginTop:"10px",lineHeight:"1.25em"},children:"*Items in cart prior to rewards activation will not be eligible for rewards."}):(0,H.jsxs)("h6",{...i,children:[(0,H.jsx)("span",{style:{marginRight:"3px"},children:"*"}),(0,H.jsxs)("span",{children:["Rewards may vary based on exchange rates.",t&&(0,H.jsxs)(_i.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,H.jsxs)("span",{className:"tertiary-link-lighter",onClick:e,children:[" ","view details."]})]})]})]}),re=po;var gi=a(g()),wi=a(L());var X=a(p()),ce=class extends gi.default.Component{constructor(...t){super(...t),this.state={}}componentWillMount(){}componentDidMount(){this.props.isCreditsReminderMessage&&setTimeout(()=>{u("page","creditIgnoreTooltip",{view:"cashbackNotification",type:"tooltip"}),chrome.storage.local.set({seenCreditsReminder:Date.now()})},Number(this.props.delay.replace("ms","")))}getCtaButtonText(){let t;try{let i=c.get(["shadowRootsByRoute","/notification"]);if(i){let o=i();o&&(t=o.querySelector(".primary-btn-large").textContent)}}catch{}return t}render(){let{tipLabel:t,message:i,isCreditsReminderMessage:o}=this.props,n=this.props.style||{};if(this.props.delay){let r={animationDelay:this.props.delay};n=wi.default.merge(r,n)}return(0,X.jsx)("div",{style:n,className:`new-tooltip ${this.props.position||""}${o?" credits-reminder":""}`,children:(0,X.jsxs)("div",{style:this.props.innerStyle||{},onClick:this.props.onDismissTooltip.bind(this),className:"new-tooltip-wrapper",children:[(0,X.jsx)("div",{className:"close icon-x"}),o?(0,X.jsx)("div",{className:`triangle ${o?"credits-reminder":""}`}):null,(0,X.jsxs)("h2",{children:[this.props.tip?(0,X.jsx)("span",{className:"bold",children:t||"tip:"}):null,i]})]})})}},st=ce;var rt=a(p());function mo(e,{capitalize:t=!0}={}){return e.type==="threshold"&&e.threshold?t?"Earn ":"earn ":t?"Get ":"get "}function uo(e,{capitalizeUpTo:t=!1,hideUpTo:i=!1}={}){let o=!i&&(e.categories||e.estimated)?t?"Up to ":"up to ":"",n=e.tiers?.length?e.tiers[e.tiers.length-1].reward.type:e.type,r=e.tiers?.length?e.tiers[e.tiers.length-1].reward.value:e.amount,s=n==="percentage"?`${r/100}%`:A(r,{currency:e.currency,truncateIntegers:!0});return o+s}function fo(e){let t="";if(e.type==="threshold"&&e.threshold){let i=e.tiers?.length?e.tiers[e.tiers.length-1].spend_cents:e.threshold;t=` when you spend ${A(i,{currency:e.currency,truncateIntegers:!0})}`}return" back"+t}function Mt(e,{hidePrefix:t=!1,hideSuffix:i=!1}={}){return(0,rt.jsxs)(rt.Fragment,{children:[!t&&mo(e),(0,rt.jsx)("span",{className:"brand",children:uo(e)}),!i&&fo(e)]})}var f=a(p()),le=class extends yi.Component{constructor(t){super(t),this.state={isLoggedIn:Y()},this.ebatesComparisonSiteList=["macys.com","oakley.com","puritanspride.com","ebay.com","walmart.com","marriott.com","sephora.com","zulily.com","tirerack.com","ancestry.com","samsclub.com","samsung.com","nordvpn.com","priceline.com","qvc.com","microsoftstore.com","starwoodhotels.com","discounttire.com","officedepot.com","lifelock.com","omahasteaks.com","woot.com","coursera.org","sixt.com","wsj.com","gilt.com"]}componentWillReceiveProps(t){t.showCreditsReminder!==this.state.showCreditsReminder&&!this.state.didDismiss&&this.setState({showCreditsReminder:t.showCreditsReminder})}renderHeadline(){let{deweyResult:t,reward:i,rewardProof:o}=this.props.view,n=ct.default.get(t,"pageData.order.total"),r;if(i.type==="percentage"?r=ct.default.round(n/100*(i.amount/100),2):r=i.amount,l("ext_rewards_show_estimate")&&n)return(0,f.jsxs)("div",{children:[(0,f.jsxs)("h2",{className:"centered",children:["Get ",i.categories||i.estimated?"up to ":"",(0,f.jsx)("span",{className:"palmetto",children:A(r,{currency:i.currency})})," ","back"]}),(0,f.jsxs)("div",{className:"dashed-border",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{className:"inline-block-table top",children:"Subtotal:"}),(0,f.jsx)("h4",{className:"table-text-end top",children:A(n,{currency:i.currency})})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{className:"inline-block-table palmetto table-bottom",children:"Est. Rewards:"}),(0,f.jsx)("h4",{className:"table-text-end palmetto table-bottom",children:A(r,{currency:i.currency})})]})]})]});if(l("ext_rewards_show_proof")&&o?.avg_conf_time&&o?.avg_rewards){let s=ct.default.round(o.avg_conf_time);return(0,f.jsxs)("div",{children:[(0,f.jsxs)("h2",{className:"centered",children:["Found ",(0,f.jsx)("span",{className:"palmetto",children:"Rewards"})]}),(0,f.jsxs)("div",{className:"dashed-border",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{className:"inline-block-table top",children:"Avg. Confirmation Time:"}),(0,f.jsxs)("h4",{className:"table-text-end top",children:[s," ",s===1?"Day":"Days"]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{className:"inline-block-table palmetto table-bottom",children:"Avg. Earned:"}),(0,f.jsx)("h4",{className:"table-text-end palmetto table-bottom",children:A(o.avg_rewards*100,{currency:i.currency})})]})]})]})}return(0,f.jsx)("h2",{children:Mt(i)})}render(){let t=Et(x()),i=l("ext_red_cta_202305")&&!t,o=this.props.activating&&!this.state.hasClickedToLogin,n=this.props.activated&&!this.state.hasClickedToLogin,{deweyResult:r,reward:s,vendor:d}=this.props.view,m=ct.default.get(r,"pageData.order.total"),v=l("ext_rewards_show_estimate")&&m>0||l("ext_rewards_show_proof"),R=o||n,C=s.amount/100>=5||!!s.categories||v,b="Ok";return(0,f.jsxs)("div",{className:"simple-section",children:[R?(0,f.jsxs)("h2",{children:["Activating ",Mt(s,{hidePrefix:!0})]}):C?this.renderHeadline():(0,f.jsx)("h2",{children:l("ext_found_rewards")?"Found Rewards":l("ext_found_rewards_2")?"Unclaimed Rewards Detected!":"Found 1 offer"}),v?null:(0,f.jsxs)("h4",{className:"bold",children:["at ",d,"."]}),(0,f.jsx)("div",{className:"button-wrapper",children:Y()?(0,f.jsxs)(ki.default.Fragment,{children:[this.renderControl(b),x()==="quill.com"||gt(x())?(0,f.jsx)(re,{}):null,this.state.showCreditsReminder&&!(n||o)?(0,f.jsx)(st,{tip:!0,isCreditsReminderMessage:!0,tipLabel:"Activating Shopping Rewards is completely free.",message:(0,f.jsx)("span",{className:"dismiss-text",children:"Click the \u201COk\u201D button to activate Rewards on your purchases that you can redeem for gift cards at top stores."}),delay:"7000ms",style:{top:"50%",transform:"translateY(-50%)",width:"360px",right:"calc(100% + 16px)"},onDismissTooltip:this.onDismissTooltip.bind(this)}):null]}):(0,f.jsx)("button",{className:`primary-btn-large ${i?"red-btn-test":""}`,onClick:this.onClickSignIn.bind(this),children:b})})]})}renderControl(t){let i=Et(x()),o=l("ext_red_cta_202305")&&!i,n=this.props.activating&&!this.state.hasClickedToLogin;return this.props.activated&&!this.state.hasClickedToLogin?(0,f.jsx)("button",{className:"primary-btn-large",disabled:!0,children:"Activated"}):n?(0,f.jsx)("button",{className:"primary-btn-large",disabled:!0,children:"Activating"}):(0,f.jsx)("button",{className:`primary-btn-large ${o?"red-btn-test":""}`,onClick:s=>{s.stopPropagation(),this.props.onActivate({label:t})},children:t})}async onClickSignIn(t){t.stopPropagation(),this.setState({hasClickedToLogin:!0});let i=ct.default.get(this.props.view,"vendor"),o=await qt();this.props.onActivate({preventHide:!this.state.hasClickedToLogin,shouldLoadEmailCreateAccountNotification:o}),u("track","signinRequired",{vendor:i}),o||window.open(`${I}/sign-in`)}},pe=le;var _=a(p()),de=class extends vi.Component{constructor(t){super(t),this.state={}}onShowExclusion(){u("trackClick","viewExclusionDetails","view details"),window.open(`${I}/s/${Z.default.get(this.props.view,"deweyResult.domain")}/coupon`,"_blank")}onConfirmDismiss(){let t=Z.default.get(this.props,"reward",{});u("trackClick","dismissCreditReminder","",{rewardAmount:t.amount,rewardDisplay:t.type}),this.props.onUserClosePopup("activate later",!0)}onShowNewUserDetails(){u("trackClick","viewNewUserBonusDetails","Details",{view:"cashbackNotificiation"}),window.open("https://help.capitaloneshopping.com/hc/en-us/articles/360047681572-How-do-I-earn-a-New-Member-Bonus-of-10-in-Wikibuy-Credits-on-my-first-purchase-","_blank")}render(){let{activating:t,activated:i}=this.props,o=!!Z.default.get(this.props,"reward.categories"),n=this.props.hasActivatedCompetitor,r=this.props.eligibleForNewUserBonus,s=Z.default.get(this.props.view,"reward"),d=l("rewards_dismissal_1")?"No thanks":l("rewards_dismissal_2")?"No thanks, I don't want rewards":l("rewards_dismissal_3")?"Decline Offer":"Activate Later",m=this.props.view.exclusions;return(0,_.jsxs)("div",{className:"cash-back-resolve",style:this.props.isLandscape?{padding:"20px 24px 0 0"}:void 0,children:[(0,_.jsx)(Pt,{hasActivatedCompetitor:n,onUserClosePopup:this.props.onUserClosePopup,reward:s}),(0,_.jsxs)("div",{className:"credit-prompt",children:[(0,_.jsx)(ne,{domain:x()}),(0,_.jsxs)("div",{children:[l("show_rewards")&&(0,_.jsx)("div",{className:"rewards-activation",children:(0,_.jsx)(pe,{...this.props,onShowExclusion:this.onShowExclusion.bind(this)})}),l("cb_cta_ui_control")&&!t&&!i&&!n?(0,_.jsx)(me.default.Fragment,{children:(0,_.jsx)("h4",{className:"bold activate-later tertiary-link",onClick:v=>at(v,d,this.props.onUserClosePopup,n,s),children:d})}):(i||t)&&(0,_.jsxs)("div",{children:[(0,_.jsxs)("h6",{style:{display:"flex",marginTop:"6px",paddingLeft:"3px",fontSize:"8px",lineHeight:"10px",paddingBottom:"10px",marginBottom:o?"15px":0,borderBottom:o?"1px solid #dedede":0},children:[(0,_.jsx)("span",{style:{marginRight:"3px"},children:"*"}),(0,_.jsxs)("span",{children:["Rewards may vary based on exchange rates.",Z.default.get(this.props,"view.exclusions")?(0,_.jsxs)(me.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,_.jsx)("span",{style:{paddingLeft:"3px"},className:"tertiary-link-lighter",onClick:this.onShowExclusion.bind(this),children:"view details."})]}):null]})]}),o?(0,_.jsx)(jt,{reward:this.props.reward,tld:Z.default.get(this.props.view,"deweyResult.domain")}):null,(0,_.jsx)(It,{reward:this.props.reward}),(i||t)&&l("ext_exclusion_warning")&&m?(0,_.jsx)("div",{style:{paddingTop:"20px"},children:(0,_.jsx)(se,{exclusions:m})}):null]}),(0,_.jsx)(ie,{reward:s,containerStyle:{marginTop:12,textAlign:"left"}}),r&&(0,_.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,_.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,_.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]})]})]})]})}},ue=de;var G=a(g()),Ft=a(L());var fe=a(p());function Ot(){return(0,fe.jsx)("svg",{className:"w-4 h-4 animate-spin",viewBox:"0 0 512 512",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:(0,fe.jsx)("path",{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"})})}var lt=a(g());function xi({baobabBranch:e,contentSlug:t,contentProps:i}){let o=[e,t],[n,r]=(0,lt.useState)(null),[s,d]=(0,lt.useState)(null),[m,v]=(0,lt.useState)(!0),R=async()=>{let C=c.select(o);try{v(!0),C.set({loading:!0,error:null,data:null});let b=await Me({contentSlug:t,contentProps:{domain:x(),...i},context:Oe()});r(b),d(null),C.set(o,{loading:!1,data:b,error:null})}catch(b){let E=b;d(E),C.set(o,{data:null,error:E,loading:!1})}finally{v(!1)}};return(0,lt.useEffect)(()=>{R()},[]),{baobabSelector:o,data:n,error:s,loading:m,retry:R}}var Ni=a(g());var Ci=a(g()),Ut=(0,Ci.createContext)({onUserClosePopup:()=>{},hasActivatedCompetitor:!1,reward:null});var he=a(p()),Ai=({children:e})=>{let{onUserClosePopup:t,hasActivatedCompetitor:i,reward:o}=(0,Ni.useContext)(Ut);return t==null?null:(0,he.jsx)(Ae,{variant:"tertiary",className:"mb-2 w-full",onClick:n=>at(n,e,t,i,o),children:(0,he.jsx)("span",{className:"text-gray-400 cursor-pointer font-semibold",children:e})})};var V=a(p());$e(e=>{e("sp-energy-cashback-dismissal",Ai)});var ho="energy-cashback-notification",Si=(0,G.memo)(({reward:e,onUserClosePopup:t,hasActivatedCompetitor:i,onActivate:o})=>{let[n,r]=(0,G.useState)(!1),[s,d]=(0,G.useState)(!1),[m,v]=(0,G.useState)(!1),R={reward:e},{data:C,error:b,loading:E}=xi({baobabBranch:"mirageCashback",contentSlug:ho,contentProps:R}),N=(0,G.useCallback)((0,Ft.debounce)(async Q=>{if("eventName"in Q&&Q.eventName===C?.events.activationEventName){r(!0);try{await o({label:C.ctaText}),d(!0)}catch{v(!0)}finally{r(!1)}}},350),[C?.events.activationEventName]);return E?(0,V.jsx)("div",{className:"flex p-6 justify-center items-center",children:(0,V.jsx)(Ot,{})}):b||!C?.content?(0,V.jsx)("div",{className:"flex p-6 justify-center items-center",children:(0,V.jsx)("p",{className:"text-critical",children:"Encountered an error retrieving content"})}):(0,V.jsxs)(Ut.Provider,{value:{onUserClosePopup:t,hasActivatedCompetitor:i,reward:e},children:[(0,V.jsx)(Pt,{hasActivatedCompetitor:i,onUserClosePopup:t,reward:e}),(0,V.jsx)(Nt,{data:{isActivating:n,isActivated:s,hasActivationError:m},config:{rootEl:"div",logLevel:void 0},content:C?.content,onEvent:N,children:(0,V.jsx)("style",{children:C?.blockStyle||""})})]})},({reward:e,hasActivatedCompetitor:t},{reward:i,hasActivatedCompetitor:o})=>(0,Ft.isEqual)(e,i)&&t===o);var Ei=e=>(c.get(["energyCashbackDomains"])||[]).includes(e);var Vr=a(g());var K=a(p());function bo(){let e=Dt(),t=l("coup_shift_left"),i;return e?i="100%":t?i="645px":i="320px",{left:"auto",right:i}}function _o({offerSignUp:e,storeName:t,hideNotification:i,onDismissTooltip:o,hasSeenCashbackSignupTip:n,hasSeenCashbackActivateTip:r,wrapperStyle:s={}}){let d=bo();return(0,K.jsxs)("div",{style:s,children:[!n&&e&&!i?(0,K.jsx)(st,{tip:!0,message:(0,K.jsxs)("span",{children:["Capital One Shopping can help you save ",(0,K.jsx)("br",{}),"on ",t," today, just click activate. It's easy and free money."]}),delay:"1500ms",style:{top:"15px",bottom:"auto",width:"461px",left:d.left,right:d.right},onDismissTooltip:o.bind(null,"hasSeenCashbackSignupTip")}):null,!r&&!e&&!i?(0,K.jsx)(st,{tip:!0,tipLabel:"Capital One Shopping tip:",message:(0,K.jsx)("span",{children:"Just click when you see this to get free money, seriously."}),delay:"1500ms",style:{top:"15px",bottom:"auto",width:"468px",left:d.left,right:d.right},onDismissTooltip:o.bind(null,"hasSeenCashbackActivateTip")}):null]})}var be=_o;var U=a(p()),_e=class extends Di.Component{constructor(...t){super(...t),this.state={hideNotification:l("ext_rewards_remove_delay")?this.props.view&&k.default.get(this.props,"view.user.activated"):!0}}async componentWillReceiveProps(t){this.props&&t&&!this.props.warnAboutStandDown&&t.warnAboutStandDown&&this.state.activated&&this.setState({hideNotification:!1,hasSentPageNotification:!1,activated:!1,activating:!1,hasActivated:!0})}async componentDidUpdate(t,i){if(i.hideNotification!==this.state.hideNotification&&this.sendCashbackPageEvent(),t.warnAboutStandDown!==this.props.warnAboutStandDown&&this.props.warnAboutStandDown&&!c.get("throttleCreditsReactivation")){let o=await xt();c.merge({cashback:o}),this.props.router.push("reactivate")}!t.view.autoActivate&&this.props.view.autoActivate&&this.determineRunCashback()}componentDidMount(){let t=this.props.view&&k.default.get(this.props,"view.user.activated");setTimeout(()=>{document.querySelector("#honeyContainer")&&this.setState({compNotifLoaded:!0,rightOffset:"300px"}),(document.querySelector(".ebates-notification")||document.querySelector(".ebates-hover.ebates-hover-top"))&&this.setState({compNotifLoaded:!0,rightOffset:"410px"}),l("ext_rewards_remove_delay")||this.setState({hideNotification:t}),this.sendCashbackPageEvent(),ii()},l("ext_rewards_remove_delay")?0:1e3),this.props.view.autoActivate&&this.determineRunCashback()}async sendCashbackPageEvent(){let t=(0,Ri.findDOMNode)(this),i="",o="";if(t){let n=t.querySelector("button");(l("ext_rewards_show_estimate")||l("ext_rewards_show_proof"))&&(o=Array.from(t.querySelectorAll("h4")).splice(0,4).map(r=>r.textContent.toLowerCase()).join(" ")),n&&n.textContent&&(i=n.textContent.toLowerCase())}!this.state.hideNotification&&!this.state.hasSentPageNotification&&(this.setState({hasSentPageNotification:!0}),u("page","cashbackNotification",{view:"cashbackNotification",type:"notification",source:"cashback",deweyResult:k.default.get(this.props.view,"deweyResult.pageType"),offerSignUp:k.default.get(this.props.view,"offerSignUp"),qualified:k.default.get(this.props.view,"qualified",!1),balance:k.default.get(this.props.view,"balance",0),promotionalRate:void 0,vendorMetaId:k.default.get(this.props.view,"id"),ctaText:i,notificationText:o}))}trackFirstDragEnd=k.default.once((t,i)=>{Ve("cashbackNotification",t,i)});render(){let{hideNotification:t}=this.state,i=k.default.get(this.props.view,"offerSignUp"),o=k.default.get(this.props.view,"vendor");if(this.props.couponsVisible&&!(this.props.couponView&&this.props.couponView.isQuietSavingsMiss)&&!this.props.view.autoActivate)return null;let n=k.default.get(this.props,"view.reward"),r=oi(this.state.compNotifLoaded);return(0,U.jsxs)(Ce,{onClick:()=>this.setState({fullScreen:!1}),className:`${t?"disabled cashback-page":"cashback-page"}`,style:{top:"0",bottom:"auto",left:r.left??"auto",right:r.right??"0",translate:r.translateX},dragSelector:"header",isDraggable:l("ext_notif_drag"),onDragEnd:this.trackFirstDragEnd,children:[(0,U.jsx)(wt.Motion,{style:{opacity:(0,wt.spring)(t?0:1,{stiffness:180,damping:20}),tabOpacity:t?0:1,y:(0,wt.spring)(t?-100:0,{stiffness:180,damping:20}),tabX:t?80:0},children:({opacity:s,y:d})=>(0,U.jsxs)("div",{className:"cashback-notification",style:{transform:`translate3d(0,${d}%,0)`,opacity:`${s}`},children:[(0,U.jsxs)("header",{className:"reward-header",children:[(0,U.jsx)(et,{greyscale:l("ext_alternative_logo_1"),swoosh:l("ext_alternative_logo_2")}),(0,U.jsx)(Te,{})]}),l("ext_energy_cashback_configured")&&Ei(x())?(0,U.jsx)(Si,{reward:n,onUserClosePopup:this.onUserClosePopup.bind(this),hasActivatedCompetitor:this.props.hasActivatedCompetitor,onActivate:this.determineRunCashback.bind(this)}):(0,U.jsx)(ue,{view:this.props.view,hasActivated:this.state.hasActivated,hasActivatedCompetitor:this.props.hasActivatedCompetitor,reward:n,activated:this.state.activated,activating:this.state.activating,hasCoupons:k.default.get(this.props,"view.hasCoupons"),session:this.props.session,showInitialSignup:this.state.showInitialSignup,tld:this.props.tld,activate:this.state.activate,onActivate:this.determineRunCashback.bind(this),dismissNotification:()=>this.setState({hideNotification:!0}),hasSeenFTUX:k.default.get(this.props,"events.hasSeenCashbackFtux",!1),onUserClosePopup:this.onUserClosePopup.bind(this),deweyResult:k.default.get(this.props.view,"deweyResult"),setSeenCashbackFtux:this.setSeenCashbackFtux.bind(this),eligibleForNewUserBonus:this.props.settings.eligibleForNewUserBonus})]})}),(0,U.jsx)(be,{offerSignUp:i,storeName:o,hideNotification:t,onDismissTooltip:this.onDismissTooltip.bind(this),hasSeenCashbackSignupTip:k.default.get(this.props,"events.hasSeenCashbackSignupTip"),hasSeenCashbackActivateTip:k.default.get(this.props,"events.hasSeenCashbackActivateTip")})]})}determineRunCashback(t){return Y()?this.onActivate(t):(t?.shouldLoadEmailCreateAccountNotification&&this.setState({hideNotification:!0},()=>{St()}),Ie())}onDismissTooltip(t){k.default.get(this.props,`events.${t}`)||Ht(t)}async onActivate(t={}){let i=k.default.get(this.props.view,"reward",{}),n=k.default.get(this.props.view,"hasCoupons")?1500:5e3;this.setState({activating:!0}),this.onDismissTooltip("hasSeenCashbackActivateTip");let{isRedirectEnabled:r}=await Ct({reward:i,pageLocation:this.props.view.autoActivate?"shopifyButton":void 0,view:t.view,label:t.label});this.setState({activated:!0}),t.preventHide||setTimeout(()=>{this.setState({hideNotification:!0},()=>{r||St(i)})},n),Zt()}onUserClosePopup(t,i=!1){let o=k.default.get(this.props.view,"reward",{});!(t==="activate later"&&l("no_throttle_activate_later"))&&(k.default.get(this.props.view,"user.hasSeenFirst")||k.default.get(this.props.view,"isCashbackURLMatch"))&&Pe(),this.setState({hideNotification:!0}),k.default.get(this.props.view,"offerSignUp")?this.onDismissTooltip("hasSeenCashbackSignupTip"):this.onDismissTooltip("hasSeenCashbackActivateTip"),i||(u("trackClick","dismissCashbackNotification",t,{rewardAmount:o.amount,rewardDisplay:o.type}),vt("cashbackNotification",t,"dismiss","primary",{rewardAmount:o.amount,rewardDisplay:o.type}))}setSeenCashbackFtux(){Ht("hasSeenCashbackFtux")}},ge=j({view:["cashbackView"],couponView:["couponView"],deweyResult:["deweyResult"],events:["events"],session:["session"],settings:["settings"],tld:["siteAPIData","siteData","tld"],hasActivatedCompetitor:["hasActivatedCompetitor"],warnAboutStandDown:["warnAboutStandDown"],couponsVisible:["couponsVisible"]},_e);function kt(){return c.get("hasActivatedCompetitor")||c.get("warnAboutStandDown")}function we(e="/cashback"){let t={initialRoute:e,cssUrl:"cashback.css",routeConfig:{childRoutes:[{path:"cashback",component:zt(ge)},{path:"reactivate",component:zt(je)}]},disableDelay:!0};it(t),c.set("cashbackVisible",!0),e==="/reactivate"&&c.set("cashbackReactivateVisible",!0)}async function go(e,t={autoActivate:!1,devRewardTest:!1}){let{siteData:i,meta:o}=c.get("siteAPIData")||await Fe(),n=c.get("cashback"),r=c.get("settings"),s=y.default.get(n,"user.compInactivated"),d=l("ext_cashback_notif_preferences")?["cartPage","checkoutPage","reviewPage"]:y.default.get(r,"notificationPreferences.cashbackPrefs"),m,v=y.default.get(e,"pageType"),R=Ti.default.getDomain(location.href);if((We()||Ye())&&!kt())return ei(),!1;if(R.match(/hilton\.com/)&&l("cb_hilton_honors"))return!1;let C=y.default.get(i.cashback,"pageTypesOverride",{})||{};if(C&&C[v]){let b=C[v],E=y.default.get(b,"value",b),N;if(E==="show"?m=!0:E==="hide"?m=!1:E==="conditional"&&b.conditional&&(N=wo(b.conditional),!N||N.hide?m=!1:m=!0),u("track","cashbackNotificationOverride",{show:m,reason:y.default.get(N,"feature","")}),!m)return!1}else if(y.default.get(e,"domain")==="tophatter.com"&&y.default.get(e,"pageType")==="homePage")m=!0;else if(y.default.get(e,"pageType")==="atcPage"&&l("cb_on_atc_page"))m=!0;else if(y.default.get(e,"pageType")==="dealPage"&&l("credit_on_deal"))m=!0;else if(kt()&&s)m=!0;else if(d){if(m=d.indexOf(v)!==-1,kt()&&s&&(m=!0),n&&(y.default.get(n,"user.activated")||kt())&&!m&&!y.default.get(n,"user.dismissed")&&!c.get("cashbackVisible")&&!c.get("couponsVisible")&&!c.get("cashbackReactivateVisible")&&!c.get("throttleCreditsReactivation")){we("/reactivate");return}}else v=y.default.snakeCase(v),m=new Set(i.cashback.minNotificationsPageTypes).has(v);if((t.autoActivate||t.devRewardTest)&&(m=!0),!m&&l("ext_rewards_cart")){let b=Object.keys(i.pageTypesV2||{}),E=b.includes("cartPage"),N=b.includes("checkoutPage");(!E&&new RegExp(/^\/cart(?![\w-~!$&'()*+,;=:@%])/i).test(location.pathname)||!N&&new RegExp(/^\/checkout(?![\w-~!$&'()*+,;=:@%])/i).test(location.pathname))&&(m=!0)}if(n&&m&&!y.default.get(n,"user.dismissed")&&!c.get("cashbackVisible")&&!c.get("cashbackReactivateVisible")){if(!y.default.get(n,"user.activated")){let E=await ze();if(c.get("cashbackVisible")||He(E))return}let b=c.get("cashbackView")||n;if(c.set("cashbackView",{...b,isCashbackURLMatch:!0,deweyResult:e,ebatesReward:i.ebatesReward,exclusions:y.default.get(i,"merchantPage.exclusions"),affiliateLinkCurrentTab:y.default.get(o,"affiliate_link_current_tab"),autoActivate:t.autoActivate}),s&&kt()&&!y.default.get(n,"user.activated")&&!c.get("couponsVisible")&&!c.get("throttleCreditsReactivation")){c.set(["warnAboutStandDown"],!0),we("/reactivate");return}we()}}function wo(e){try{let t=JSON.parse(e),i=y.default.map(t.hide,s=>({hide:l(s),feature:s})),o=y.default.map(t.show,s=>({show:l(s),feature:s})),n=y.default.find(i,{hide:!0}),r=y.default.find(o,{show:!0});return n||r||!1}catch{return!1}}export{Y as a,_t as b,We as c,Ye as d,oi as e,Zt as f,St as g,jt as h,mi as i,ie as j,ae as k,fi as l,ne as m,It as n,se as o,gt as p,re as q,st as r,Et as s,mo as t,uo as u,fo as v,Mt as w,Si as x,Ei as y,je as z,ei as A,kt as B,go as C};
