var me=Object.create;var W=Object.defineProperty;var ge=Object.getOwnPropertyDescriptor;var ue=Object.getOwnPropertyNames;var ce=Object.getPrototypeOf,Ae=Object.prototype.hasOwnProperty;var de=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var pe=(e,r,n,l)=>{if(r&&typeof r=="object"||typeof r=="function")for(let p of ue(r))!Ae.call(e,p)&&p!==n&&W(e,p,{get:()=>r[p],enumerable:!(l=ge(r,p))||l.enumerable});return e};var k=(e,r,n)=>(n=e!=null?me(ce(e)):{},pe(r||!e||!e.__esModule?W(n,"default",{value:e,enumerable:!0}):n,e));var h=de((M,G)=>{(function(e,r){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],r);else if(typeof M<"u")r(G);else{var n={exports:{}};r(n),e.browser=n.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:M,function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let r="The message port closed before a response was received.",n=l=>{let p={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(p).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class L extends WeakMap{constructor(a,o=void 0){super(o),this.createItem=a}get(a){return this.has(a)||this.set(a,this.createItem(a)),super.get(a)}}let N=s=>s&&typeof s=="object"&&typeof s.then=="function",T=(s,a)=>(...o)=>{l.runtime.lastError?s.reject(new Error(l.runtime.lastError.message)):a.singleCallbackArg||o.length<=1&&a.singleCallbackArg!==!1?s.resolve(o[0]):s.resolve(o)},x=s=>s==1?"argument":"arguments",D=(s,a)=>function(i,...c){if(c.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${x(a.minArgs)} for ${s}(), got ${c.length}`);if(c.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${x(a.maxArgs)} for ${s}(), got ${c.length}`);return new Promise((A,b)=>{if(a.fallbackToNoCallback)try{i[s](...c,T({resolve:A,reject:b},a))}catch(t){console.warn(`${s} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,t),i[s](...c),a.fallbackToNoCallback=!1,a.noCallback=!0,A()}else a.noCallback?(i[s](...c),A()):i[s](...c,T({resolve:A,reject:b},a))})},z=(s,a,o)=>new Proxy(a,{apply(i,c,A){return o.call(c,s,...A)}}),V=Function.call.bind(Object.prototype.hasOwnProperty),P=(s,a={},o={})=>{let i=Object.create(null),c={has(b,t){return t in s||t in i},get(b,t,f){if(t in i)return i[t];if(!(t in s))return;let g=s[t];if(typeof g=="function")if(typeof a[t]=="function")g=z(s,s[t],a[t]);else if(V(o,t)){let C=D(t,o[t]);g=z(s,s[t],C)}else g=g.bind(s);else if(typeof g=="object"&&g!==null&&(V(a,t)||V(o,t)))g=P(g,a[t],o[t]);else if(V(o,"*"))g=P(g,a[t],o["*"]);else return Object.defineProperty(i,t,{configurable:!0,enumerable:!0,get(){return s[t]},set(C){s[t]=C}}),g;return i[t]=g,g},set(b,t,f,g){return t in i?i[t]=f:s[t]=f,!0},defineProperty(b,t,f){return Reflect.defineProperty(i,t,f)},deleteProperty(b,t){return Reflect.deleteProperty(i,t)}},A=Object.create(s);return new Proxy(A,c)},u=s=>({addListener(a,o,...i){a.addListener(s.get(o),...i)},hasListener(a,o){return a.hasListener(s.get(o))},removeListener(a,o){a.removeListener(s.get(o))}}),oe=new L(s=>typeof s!="function"?s:function(o){let i=P(o,{},{getContent:{minArgs:0,maxArgs:0}});s(i)}),F=new L(s=>typeof s!="function"?s:function(o,i,c){let A=!1,b,t=new Promise(O=>{b=function(y){A=!0,O(y)}}),f;try{f=s(o,i,b)}catch(O){f=Promise.reject(O)}let g=f!==!0&&N(f);if(f!==!0&&!g&&!A)return!1;let C=O=>{O.then(y=>{c(y)},y=>{let $;y&&(y instanceof Error||typeof y.message=="string")?$=y.message:$="An unexpected error occurred",c({__mozWebExtensionPolyfillReject__:!0,message:$})}).catch(y=>{console.error("Failed to send onMessage rejected reply",y)})};return C(g?f:t),!0}),ie=({reject:s,resolve:a},o)=>{l.runtime.lastError?l.runtime.lastError.message===r?a():s(new Error(l.runtime.lastError.message)):o&&o.__mozWebExtensionPolyfillReject__?s(new Error(o.message)):a(o)},I=(s,a,o,...i)=>{if(i.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${x(a.minArgs)} for ${s}(), got ${i.length}`);if(i.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${x(a.maxArgs)} for ${s}(), got ${i.length}`);return new Promise((c,A)=>{let b=ie.bind(null,{resolve:c,reject:A});i.push(b),o.sendMessage(...i)})},le={devtools:{network:{onRequestFinished:u(oe)}},runtime:{onMessage:u(F),onMessageExternal:u(F),sendMessage:I.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:I.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},E={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return p.privacy={network:{"*":E},services:{"*":E},websites:{"*":E}},P(l,le,p)};e.exports=n(chrome)}else e.exports=globalThis.browser})});var S=k(h(),1);var _=k(h(),1);async function m(e){let r=e.storage??_.default.storage.local,n=(await r.get(e.key))[e.key];return new be({key:e.key,deserialize:e.deserialize,serialize:e.serialize??JSON.stringify,storage:r,value:n===void 0?e.value:e.deserialize(n)})}var be=class{deserialize;key;serialize;storage;inner;constructor(e){this.deserialize=e.deserialize,this.key=e.key,this.serialize=e.serialize,this.storage=e.storage,this.inner=e.value}get value(){return this.inner}set value(e){this.inner=e}async remove(){await this.storage.remove(this.key)}async save(){await this.storage.set({[this.key]:this.serialize(this.inner)})}};var d=k(h(),1);var v=(u=>(u.AnonymizeUsernames="anonymize-usernames",u.Autocomplete="autocomplete",u.BackToTop="back-to-top",u.Debug="debug",u.HideTopics="hide-topics",u.HideVotes="hide-votes",u.JumpToNewComment="jump-to-new-comment",u.MarkdownToolbar="markdown-toolbar",u.Miscellaneous="miscellaneous-features",u.ThemedLogo="themed-logo",u.ThemeSwitcher="theme-switcher",u.UserLabels="user-labels",u.UsernameColors="username-colors",u))(v||{});var J=k(h(),1);async function fe(e){return m({deserialize:r=>JSON.parse(r),serialize:r=>JSON.stringify(r),key:`${"hide-topics"}-${e.id}`,value:e,storage:J.default.storage.sync})}async function q(){let e=await J.default.storage.sync.get(),r=[];for(let[n,l]of Object.entries(e))n.startsWith("hide-topics")&&r.push(await fe(JSON.parse(l)));return r}var K=["~anime","~arts","~books","~comp","~creative","~design","~enviro","~finance","~food","~games","~games.game_design","~games.tabletop","~health","~hobbies","~humanities","~lgbt","~life","~misc","~movies","~music","~news","~science","~space","~sports","~talk","~tech","~test","~tildes","~tildes.official","~tv"];var R=k(h(),1);async function j(e){return m({deserialize:r=>JSON.parse(r),serialize:r=>JSON.stringify(r),key:`${"username-colors"}-${e.id}`,value:e,storage:R.default.storage.sync})}async function Z(){let e=await R.default.storage.sync.get(),r=[];for(let[n,l]of Object.entries(e))n.startsWith("username-colors")&&r.push(await j(JSON.parse(l)));return r}async function X(e){for(let r of e)await r.save()}var H=k(h(),1);async function B(e){return m({deserialize:r=>JSON.parse(r),serialize:r=>JSON.stringify(r),key:`${"user-labels"}-${e.id}`,value:e,storage:H.default.storage.sync})}async function Q(){let e=await H.default.storage.sync.get(),r=[];for(let[n,l]of Object.entries(e))n.startsWith("user-labels")&&r.push(await B(JSON.parse(l)));return r}async function Y(e){for(let r of e)await r.save()}var xe=k(h(),1);var se=(n=>(n.Cursor="<cursor>",n.SelectedCursor="<selected-cursor>",n))(se||{}),{Cursor:w,SelectedCursor:ee}=se,Je=[{enabled:!0,inDropdown:!1,markdown:`[${w}](${ee})`,name:"Link"},{enabled:!0,inDropdown:!1,markdown:`\`\`\`${ee}
${w}
\`\`\``,name:"Code"},{enabled:!0,inDropdown:!1,markdown:`~~${w}~~`,name:"Strikethrough"},{enabled:!0,inDropdown:!1,markdown:`<details>
<summary>Click to expand spoiler.</summary>

${w}
</details>`,name:"Spoilerbox"},{enabled:!0,inDropdown:!0,markdown:`**${w}**`,name:"Bold"},{enabled:!0,inDropdown:!0,markdown:`

---

${w}`,name:"Horizontal Divider"},{enabled:!0,inDropdown:!0,markdown:`\`${w}\``,name:"Inline Code"},{enabled:!0,inDropdown:!0,markdown:`*${w}*`,name:"Italic"},{enabled:!0,inDropdown:!0,markdown:`1. ${w}`,name:"Ordered List"},{enabled:!0,inDropdown:!0,markdown:`<small>${w}</small>`,name:"Small"},{enabled:!0,inDropdown:!0,markdown:`* ${w}`,name:"Unordered List"}].map((e,r)=>({...e,id:r-100,position:r+1}));var we={"enabled-features":m({deserialize:e=>new Set(JSON.parse(e)),serialize:e=>JSON.stringify(Array.from(e)),key:"enabled-features",value:new Set(["back-to-top","jump-to-new-comment","markdown-toolbar","user-labels"]),storage:d.default.storage.sync}),"known-groups":m({deserialize:e=>new Set(JSON.parse(e)),serialize:e=>JSON.stringify(Array.from(e)),key:"known-groups",value:new Set(K),storage:d.default.storage.sync}),"latest-active-feature-tab":m({deserialize:e=>JSON.parse(e),serialize:e=>JSON.stringify(e),key:"latest-active-feature-tab",value:"debug",storage:d.default.storage.sync}),"miscellaneous-enabled-features":m({deserialize:e=>new Set(JSON.parse(e)),serialize:e=>JSON.stringify(Array.from(e)),key:"miscellaneous-enabled-features",value:new Set(["comment-anchor-fix"]),storage:d.default.storage.sync}),"on-site-new-label":m({deserialize:e=>JSON.parse(e),serialize:e=>JSON.stringify(e),key:"on-site-new-label",value:!0,storage:d.default.storage.sync}),"data-version":m({deserialize:e=>JSON.parse(e),serialize:e=>JSON.stringify(e),key:"data-version",value:"2.0.0",storage:d.default.storage.sync}),"randomize-username-colors":m({deserialize:e=>JSON.parse(e),serialize:e=>JSON.stringify(e),key:"randomize-username-colors",value:!1,storage:d.default.storage.sync}),"themes-list":m({deserialize:e=>JSON.parse(e),serialize:e=>JSON.stringify(e),key:"themes-list",value:[["white","White"],["solarized-light","Solarized Light"],["solarized-dark","Solarized Dark"],["dracula","Dracula"],["atom-one-dark","Atom One Dark"],["black","Black"],["zenburn","Zenburn"],["gruvbox-light","Gruvbox Light"],["gruvbox-dark","Gruvbox Dark"],["love-dark","Love Dark"],["love-light","Love Light"]],storage:d.default.storage.local}),"themes-list-updated-date":m({deserialize:e=>new Date(e),serialize:e=>e.toISOString(),key:"themes-list-updated-date",value:new Date("2023-01-01"),storage:d.default.storage.local}),"anonymize-usernames":m({deserialize:e=>JSON.parse(e),serialize:e=>JSON.stringify(e),key:"anonymize-usernames",value:{replacementType:"numerical"},storage:d.default.storage.sync}),"hide-topics":q(),"hide-votes":m({deserialize:e=>JSON.parse(e),serialize:e=>JSON.stringify(e),key:"hide-votes",value:{otherComments:!1,otherTopics:!1,ownComments:!0,ownTopics:!0},storage:d.default.storage.sync}),"theme-switcher":m({deserialize:e=>JSON.parse(e),serialize:e=>JSON.stringify(e),key:"theme-switcher",value:{hourA:"09:00",hourB:"21:00",themeA:"white",themeB:"black"},storage:d.default.storage.sync}),"user-labels":Q(),"username-colors":Z()};async function U(e){return we[e]}function ae(e){let r={userLabels:[],usernameColors:[]};e.data?.userLabels!==void 0&&(r.userLabels=e.data.userLabels),e.data?.usernameColors!==void 0&&(r.usernameColors=e.data.usernameColors);for(let[n,l]of Object.entries(e))n.startsWith("userLabel")?r.userLabels.push(l):n.startsWith("usernameColor")&&r.usernameColors.push(l);return r}var te=[{version:"2.0.0",async migrate(e){let r=ae(e);e.data.userLabels=r.userLabels,e.data.usernameColors=r.usernameColors;let n=[],l=[];for(let x of e.data.usernameColors)n.push(await j(x));for(let x of e.data.userLabels)l.push(await B(x));await X(n),await Y(l);let p=await U("hide-votes");p.value={otherComments:e.data.hideVotes.comments,otherTopics:e.data.hideVotes.topics,ownComments:e.data.hideVotes.ownComments,ownTopics:e.data.hideVotes.ownTopics},await p.save();let L=await U("known-groups");L.value=new Set(e.data.knownGroups),await L.save();let N=await U("data-version");N.value="2.0.0",await N.save();let T=await U("enabled-features");T.value.clear();for(let[x,D]of Object.entries(e.features))if(D){let z=x.replace(/([A-Z])/g,"-$1").toLowerCase();if(Object.values(v).includes(z))T.value.add(z);else throw new Error(`Unknown key: ${x}`)}await T.save()}}];function ne(e,r=!1){let n="",l="[TRX]";r&&(l="%c"+l,n="background-color: #dc322f; margin-right: 9px;"),(window.TildesReExtended?.debug||r)&&(n.length>0?console.debug(l,n,e):console.debug(l,e))}S.default.browserAction.onClicked.addListener(ye);S.default.runtime.onInstalled.addListener(async()=>{let e=await S.default.storage.sync.get();e.version==="1.1.2"&&(ne("Running 1.1.2 to 2.0.0 data migration.",!0),await S.default.storage.local.set({backup:JSON.stringify(e)}),await S.default.storage.sync.clear(),await te[0].migrate(e))});async function ye(){await S.default.runtime.openOptionsPage()}
