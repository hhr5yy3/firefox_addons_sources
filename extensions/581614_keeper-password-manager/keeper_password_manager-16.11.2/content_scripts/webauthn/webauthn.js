(()=>{"use strict";const e="keeper-webauthn-message";const t="undefined"==typeof atob?e=>Buffer.from(e,"base64").toString("binary"):atob,n="undefined"==typeof btoa?e=>Buffer.from(e,"binary").toString("base64"):btoa;function r(e){return function(e,t=!1){for(var n=e.length,r=new Uint8Array(t?4*n:n),a=0,i=0;a<n;a++){var o=e.charCodeAt(a);if(t&&55296<=o&&o<=56319){if(++a>=n)throw new Error("Malformed string, low surrogate expected at position "+a);o=(55296^o)<<10|65536|56320^e.charCodeAt(a)}else if(!t&&o>>>8)throw new Error("Wide characters are not allowed.");!t||o<=127?r[i++]=o:o<=2047?(r[i++]=192|o>>6,r[i++]=128|63&o):o<=65535?(r[i++]=224|o>>12,r[i++]=128|o>>6&63,r[i++]=128|63&o):(r[i++]=240|o>>18,r[i++]=128|o>>12&63,r[i++]=128|o>>6&63,r[i++]=128|63&o)}return r.subarray(0,i)}(t(e))}function a(e){return n(function(e,t=!1){for(var n=e.length,r=new Array(n),a=0,i=0;a<n;a++){var o=e[a];if(!t||o<128)r[i++]=o;else if(o>=192&&o<224&&a+1<n)r[i++]=(31&o)<<6|63&e[++a];else if(o>=224&&o<240&&a+2<n)r[i++]=(15&o)<<12|(63&e[++a])<<6|63&e[++a];else{if(!(o>=240&&o<248&&a+3<n))throw new Error("Malformed UTF8 character at byte offset "+a);var s=(7&o)<<18|(63&e[++a])<<12|(63&e[++a])<<6|63&e[++a];s<=65535?r[i++]=s:(s^=65536,r[i++]=55296|s>>10,r[i++]=56320|1023&s)}}var c="",u=16384;for(a=0;a<i;a+=u)c+=String.fromCharCode.apply(String,r.slice(a,a+u<=i?a+u:i));return c}(e))}function i(e,t){const n=JSON.parse(e);return n?"create"===t?function(e){const t=e.clientExtensionResults,n=f(e.response.authenticatorData).buffer,r=f(e.response.publicKey||"").buffer,a=e.response.publicKeyAlgorithm,i=e.response.transports,s={authenticatorAttachment:e.authenticatorAttachment||null,id:e.id,rawId:f(e.rawId).buffer,response:{attestationObject:f(e.response.attestationObject).buffer,clientDataJSON:f(e.response.clientDataJSON).buffer,getAuthenticatorData:()=>n,getPublicKey:()=>r,getPublicKeyAlgorithm:()=>a,getTransports:()=>i},type:"public-key",getClientExtensionResults:()=>t,toJSON:function(){return o(this)}};return Object.setPrototypeOf(s,PublicKeyCredential.prototype),Object.setPrototypeOf(s.response,AuthenticatorAttestationResponse.prototype),s}(n):function(e){const t=e.clientExtensionResults,n={authenticatorAttachment:e.authenticatorAttachment||null,id:e.id,rawId:f(e.rawId).buffer,response:{authenticatorData:f(e.response.authenticatorData).buffer,clientDataJSON:f(e.response.clientDataJSON).buffer,signature:f(e.response.signature).buffer,userHandle:e.response.userHandle?f(e.response.userHandle).buffer:null},type:"public-key",getClientExtensionResults:()=>t,toJSON:function(){return o(this)}};return Object.setPrototypeOf(n,PublicKeyCredential.prototype),Object.setPrototypeOf(n.response,AuthenticatorAssertionResponse.prototype),n}(n):n}function o(e){const t=e.getClientExtensionResults(),n=e.response,r=e.authenticatorAttachment;if(n instanceof AuthenticatorAttestationResponse){const a=n.getPublicKey(),i=n.getAuthenticatorData(),o=n.getTransports(),s=n.getPublicKeyAlgorithm();return{id:e.id,rawId:p(e.rawId),response:{clientDataJSON:p(n.clientDataJSON),authenticatorData:p(i),transports:o,publicKey:a?p(a):void 0,publicKeyAlgorithm:s,attestationObject:p(n.attestationObject)},authenticatorAttachment:r||void 0,clientExtensionResults:t,type:"public-key"}}if(n instanceof AuthenticatorAssertionResponse){return{id:e.id,rawId:p(e.rawId),response:{clientDataJSON:p(n.clientDataJSON),authenticatorData:p(n.authenticatorData),signature:p(n.signature),userHandle:n.userHandle?p(n.userHandle):void 0},authenticatorAttachment:r||void 0,clientExtensionResults:t,type:"public-key"}}throw new Error("Unknown credential type")}function s(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]}function c(e){return"ArrayBuffer"===s(e)}function u(e){return"Uint8Array"===s(e)}function l(e){return a(e).replace(/=+$/g,"").replace(/\//g,"_").replace(/\+/g,"-")}function f(e){if(!e)return new Uint8Array;let t=e.replace(/_/g,"/").replace(/-/g,"+");for(;t.length%4;)t+="=";return r(t)}function p(e){if(c(e))return l(new Uint8Array(e));if(u(e))return l(e);throw new Error("Unknown or invalid data type "+e)}let d,b=new Promise((e=>{d=e}));async function h(t,n){await b;const r=new CustomEvent(e,{detail:{type:"keeper-webauthn-message-request",cmd:t,data:n}});window.dispatchEvent(r)}window.addEventListener(e,(async t=>{if(!function(t){return t instanceof CustomEvent&&t.type===e}(t))return;const n=t.detail;if("keeper-webauthn-cs-ready"===n.type)return d();if("keeper-webauthn-message-response"===n.type){switch(n.cmd){case"webauthn-create-response":if(y){const e=i(n.data,"create");y(e)}break;case"webauthn-get-response":if(y){const e=i(n.data,"get");y(e)}break;case"webauthn-timed-out":w&&w(new DOMException("The operation timed out","NotAllowedError"))}y=null,w=null}}));let y=null,w=null;const g=CredentialsContainer.prototype.create.bind(navigator.credentials),A=CredentialsContainer.prototype.get.bind(navigator.credentials);!function(t,n){const r={init:function(){t.create=this.create,t.get=this.get,PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable=async()=>!0,function(){const t=new CustomEvent(e,{detail:{type:"keeper-webauthn-override-ready"}});window.dispatchEvent(t)}()},create:async function(e){if(null==e||!e.publicKey)return g(e);const t=e.signal,n=await new Promise(((t,n)=>{y=t,w=n,delete e.signal,h("webauthn-create-request",e)}));if(!n){e.signal=t;return await g(e)}return n},get:async function(e){if(null==e||!e.publicKey)return A(e);const t=e.signal,n=await new Promise(((t,n)=>{y=t,w=n,delete e.signal,h("webauthn-get-request",e)}));if(!n){e.signal=t;return await A(e)}return n}};t&&n&&r.init()}(window.navigator.credentials,window.PublicKeyCredential)})();