(self.webpackChunk=self.webpackChunk||[]).push([[1824],{48821:(e,t,r)=>{r.r(t),r.d(t,{TouchTypistFeatureImpl:()=>st,trackTooltipAppearingAndSkipping:()=>nt});var s=r(90023),n=r(82823),i=r(49144),a=r(65647),o=r(70989),c=r(55446),l=r(34859),p=r(96030),h=r(58303),d=r(72106),g=r(49231),u=r(90049),m=r(64965),v=r(60165),_=r(60841),b=r(20715),y=r(74857),f=r(27628),x=r(36231),E=r(16286),T=r(94936),w=r(57362),R=r(91820),P=r(52526),C=r(82717),S=r(37342),I=(e=>(e.Enter="Enter",e.Escape="Escape",e.Tab="Tab",e.ArrowDown="ArrowDown",e.ArrowUp="ArrowUp",e.Space=" ",e))(I||{});var A=r(60409);var D=r(78862),k=r(61585),O=r(30661),N=r(73507),L=r(9858),M=r(79024);const G=(0,S.o)((e=>{const t=(0,A.Me)(e.id),r=(0,A.Me)(e.id),{children:s,activator:n,accessibilityLabel:i="More",initialOpen:a=!1,...o}=e,[c,l]=(0,g.useState)(a),[p,h]=(0,g.useState)(!1),d=(0,g.useRef)(null),u=(0,g.useRef)(null),m=(0,g.useRef)(null);(0,D.Fc)({ref:u,isDisabled:!c,onInteractOutside:(0,g.useCallback)((({target:e})=>{var t;u.current&&!(null==(t=d.current)?void 0:t.contains(e))&&(l(!1),h(!1))}),[])});const{refs:v,floatingStyles:_}=(0,P.YF)({open:c,onOpenChange:l,strategy:"absolute",placement:"bottom-start",middleware:[(0,k.cv)(4),(0,O.RR)({fallbackAxisSideDirection:"start"}),(0,O.uY)({padding:5})],whileElementsMounted:O.Me});(0,g.useEffect)((()=>{d.current&&v.setReference(d.current),u.current&&v.setFloating(u.current)}),[v,c]),(0,g.useEffect)((()=>{if(c&&p&&m.current){const e=m.current.querySelector(".gds-menu-item");null==e||e.focus({preventScroll:!0})}}),[c,p]);const b=(0,g.useCallback)((e=>{var t,r,s,n,i,a;const o=null==(t=m.current)?void 0:t.getRootNode(),c=Array.from((null==(r=m.current)?void 0:r.querySelectorAll(".gds-menu-item"))||[]);if(!c||0===c.length)return;const p=o.activeElement,h=c.indexOf(p);let g=0;switch(e.key){case I.Enter:case I.Space:{e.preventDefault();const t=c[h];null==t||t.click(),l(!1),null==(s=d.current)||s.focus({preventScroll:!0});break}case I.ArrowDown:e.preventDefault(),g=(h+1)%c.length,null==(n=c[g])||n.focus({preventScroll:!0});break;case I.ArrowUp:e.preventDefault(),g=(h-1+c.length)%c.length,null==(i=c[g])||i.focus({preventScroll:!0});break;case I.Escape:case I.Tab:l(!1),null==(a=d.current)||a.focus({preventScroll:!0})}}),[l]),y=(0,g.useCallback)((()=>c?{open:!c}:{}),[c]),f=(0,g.useCallback)((()=>{const e=()=>{l((e=>!e))},s=e=>{var t;switch(e.key){case I.Enter:case I.Space:h(!0),l((e=>!e));break;case I.Escape:case I.Tab:h(!1),l(!1);break;case I.ArrowDown:if(e.preventDefault(),c){const e=null==(t=m.current)?void 0:t.querySelector(".gds-menu-item");null==e||e.focus()}else h(!0),l(!0)}};return"string"==typeof n?g.createElement(N.h,{id:t,icon:"more-vertical"===n?L.D:M.o,variant:"tertiary",accessibilityLabel:i,onClick:e,ref:d,onKeyDown:s,"aria-haspopup":"true","aria-expanded":c,"aria-controls":r,tooltipProps:y()}):g.isValidElement(n)?g.cloneElement(n,{id:t,onClick:e,ref:d,onKeyDown:s,"aria-label":i,"aria-haspopup":"true","aria-expanded":c,"aria-controls":r,tooltipProps:y()}):null}),[n,c,i]),x=(0,g.useCallback)((()=>c&&g.createElement("div",{className:"gds-menu-dropdown",ref:u,style:_},g.createElement("ul",{ref:m,onKeyDown:b,onClick:()=>{l(!1)},className:(0,C.W)("gds-menu-list",p?"gds-menu-item-pressed":"gds-menu-item-container"),id:r,role:"menu","aria-labelledby":t},g.Children.map(s,(e=>g.isValidElement(e)?g.cloneElement(e):e))))),[c,_,b,p,i,s]);return g.createElement("div",{className:"gds-menu-container",...o},f(),x())}),"Menu",{Item:({children:e,isDisabled:t=!1,icon:r,onClick:s,href:n,target:i})=>g.createElement("li",{className:(0,C.W)("gds-menu-item",t&&"gds-menu-item-disabled"),onClick:e=>{t?e.stopPropagation():null==s||s()},onKeyDown:e=>{e.key!==I.Enter&&e.key!==I.Space||(t?e.stopPropagation():(null==s||s(),n&&self.open(n,i)))},tabIndex:t?-1:0,"aria-disabled":t,role:"menuitem"},r&&g.createElement(T.J,{icon:r,role:"presentation",accessibilityLabel:""}),n?g.createElement("a",{href:n,target:i,className:"gds-menu-item-link"},g.createElement(R.x,{as:"span",variant:"text-small",weight:"medium",marginRight:r?2:0},e)):g.createElement(R.x,{as:"span",variant:"text-small",weight:"medium",marginRight:r?2:0},e)),Separator:({role:e="none"})=>g.createElement("li",{className:"gds-menu-separator",role:e,onClick:e=>{e.stopPropagation()}}),Section:({children:e,label:t,labelDisplay:r="visible"})=>{const s=(0,g.useCallback)((e=>e.stopPropagation()),[]),n=(0,A.Me)();return g.createElement("li",{className:"gds-menu-section",role:"none"},"visible"===r&&t&&g.createElement(R.x,{as:"span",variant:"text-xsmall",color:"base-subdued",className:"gds-menu-section-label",onClick:s,id:n},t),g.createElement("ul",{className:"gds-menu-group",role:"group","aria-labelledby":"visible"===r?n:"","aria-label":"hidden"===r?t:""},e))}}),U={position:"absolute",background:"transparent",border:"none",padding:0,zIndex:2,width:x.ux.px(33),height:x.ux.px(25),$nest:{svg:{width:"100%",height:"100%"}}},Y={backgroundColor:"#F5F5F5",borderRadius:x.ux.px(4),height:x.ux.px(16),zIndex:1,padding:`${x.ux.px(1)} ${x.ux.px(6)}`,position:"absolute"},B={fontFamily:"Inter",fontSize:x.ux.px(9),fontWeight:500,color:"#707070",lineHeight:x.ux.px(9)},F={display:"inline-block",padding:`${x.ux.px(1)} ${x.ux.px(1.5)}`,borderRadius:x.ux.px(2.5),background:"#FFFFFF",border:`${x.ux.px(.5)} solid #707070`,borderBottomWidth:x.ux.px(1.5)},$=x.ux.stylesheet({buttonStyles:[U],menuStyles:[{marginLeft:"20px",marginTop:"6px",$nest:{"& .gds-icon-button-medium":{width:"18px"},"& .gds-button-medium":{height:"12px"}}}],textStyles:[{$nest:{"&:hover":{cursor:"default"}}}],expandedButtonStyles:[Y],hotkeyNameStyles:[B],hotkeyComponentWrapperStyles:[F]}),V=({hotkeyName:e})=>g.createElement("div",{className:$.hotkeyComponentWrapperStyles},g.createElement("div",{className:$.hotkeyNameStyles},e)),W=({top:e,left:t,hotkeyName:r,errorsCount:s,shouldShowSettingsIcon:n})=>{const[i,a]=g.useState(!1),[o,c]=g.useState(!1),l=g.createElement("button",{onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),className:$.buttonStyles,style:{top:e,left:t}},g.createElement(V,{hotkeyName:r}));if(!i&&!o)return l;const p=s?`Fix ${s} ${1===s?"error":"errors"}: Press`:"Fix errors: Press",[h,d]=function(e,t){if(t&&e&&e<10)return[174,130];if(!t&&e&&e<10)return[151,130];if(!t&&e&&e>=10)return[157,134];if(t&&e&&e>=10)return[176,134];if(!t&&!e)return[142,119];if(t&&!e)return[158,118];return[151,130]}(s,n);return g.createElement("div",null,g.createElement("div",{"data-testid":"expanded-button",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1)},g.createElement(E.k,{gap:1,align:"center",className:$.expandedButtonStyles,style:{width:x.ux.px(h),top:e+5,left:t-d}},g.createElement(T.J,{style:{transform:"scale(0.6)"},icon:w.p,accessibilityLabel:"Grammarly logo"}),g.createElement(R.x,{"data-testid":"expanded-text",as:"p",variant:"text-xsmall",className:$.textStyles},p),n&&g.createElement(G,{"data-testid":"options-menu",activator:"more-vertical",accessibilityLabel:"Settings",className:$.menuStyles},g.createElement(G.Item,{key:"turn-off-tt"},"Turn of Quick Fix")))),l)};var z=r(23729);const q=({top:e,left:t})=>g.createElement("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",style:{top:e,left:t,position:"absolute"},className:z.bubble},g.createElement("path",{d:"M0 7.00023C0 3.13372 3.13344 0 7.00035 0C10.8673 0 14 3.13372 14 7.00023C14 10.3829 11.6017 13.2049 8.41204 13.8581C7.95631 13.9515 7.48418 14 7.00246 14H0V7.00023Z",fill:"#027E6F"}),g.createElement("path",{d:"M3.92422 7.57649L5.8528 9.50507L10.3528 5.00507",stroke:"white",strokeWidth:"1.25",className:z.checkmark}));var H=r(82675);const X=({top:e,left:t})=>g.createElement(E.k,{"data-testid":"loading-dots",justify:"center",align:"center",style:{top:e,left:t,position:"absolute"}},g.createElement("div",{className:H.dot}),g.createElement("div",{className:H.dot}),g.createElement("div",{className:H.dot}));var j,J,K,Q=r(21768),Z=r(63843),ee=r(25770),te=r(48246),re=r(74983);!function(e){function t(e,t){const r=e.ops[0];return r&&te.s.isRetain(r)?{...e,ops:[{retain:t+r.retain},...e.ops.slice(1)]}:e}e.rebaseByRemovedPreview=function(e){const r=e.end-e.begin-e.replacement.length;return 0===r?s.yR:s=>s.begin>=e.end?{...s,reverseDelta:t(s.reverseDelta,r),relativeReverseDelta:t(s.relativeReverseDelta,r)}:s},e.rebase=function(e){return t=>{const r=re.SV.rebase({start:t.begin,end:t.end},[...e]),s=re.SV.rebase({start:t.highlight.s,end:t.highlight.e},[...e]);return{...t,begin:r.start,end:r.end,highlight:{s:s.start,e:s.end}}}},e.normalize=function(e){return r=>({...r,begin:e+r.begin,end:e+r.end,delta:t(r.delta,e),highlight:{s:e+r.highlight.s,e:e+r.highlight.e},reverseDelta:t(r.reverseDelta,e)})}}(j||(j={})),function(e){function t(e){return(0,s.ls)((t=>e.find((e=>e.revertId===t.revertId))),h.ij)}e.normalize=function(e){return t=>({...t,highlightBegin:e+t.highlightBegin,highlightEnd:e+t.highlightEnd})},e.findCorrespondingPreview=t,e.hasCorrespondingPreview=function(e){return(0,s.ls)(t(e),h.pC)}}(J||(J={})),function(e){function t(e,t){return e.filter((e=>{const r=e.highlightBegin,s=e.highlightEnd;return r<=t.start&&s>=t.end||r>=t.start&&s<=t.end||r>=t.start&&s>=t.end&&t.end>=r||r<=t.start&&s<=t.end&&s>=t.start}))}function r(e){return function(r,s,n){if(0===r.length||!n)return r;if(n.start>s.end)return r.map(e(s));if(s.start<n.start&&s.end<n.end&&n.start<s.end){const i=t(r,{start:n.start,end:s.end});return r.filter((e=>!i.includes(e))).map(e(s))}if(s.start>n.start&&s.end<n.end){const n=t(r,{start:s.start,end:s.end});return r.filter((e=>!n.includes(e))).map(e(s))}if(n.start<s.start&&n.end<s.end&&n.end>s.start){const e=t(r,{start:s.start,end:n.end});return r.filter((t=>!e.includes(t)))}return n.start>s.start&&n.end<s.end?[]:r}}function n(e){return function(t){const r=t.end-t.start;return s=>{if(t.start>s.highlightEnd)return s;const n="insert"===e?s.highlightBegin+r:s.highlightBegin-r,i="insert"===e?s.highlightEnd+r:s.highlightEnd-r;return{...s,highlightBegin:n,highlightEnd:i}}}}e.rebase=function(e){const t=e.end-e.begin,r=e.replacement.length-t;return 0===r?s.yR:t=>t.correspondingPreview.begin>=e.end?{...t,highlightBegin:t.highlightBegin-r,highlightEnd:t.highlightEnd-r}:t},e.rebaseByRemovedPreview=function(e){const t=e.end-e.begin-e.replacement.length;return 0===t?s.yR:r=>r.correspondingPreview.begin>=e.end?{...r,highlightBegin:r.highlightBegin+t,highlightEnd:r.highlightEnd+t}:r},e.getRevertsRange=function(e){return 0===e.length?null:(e.sort(((e,t)=>e.highlightBegin-t.highlightBegin)),{start:e[0].highlightBegin,end:e[e.length-1].highlightEnd})},e.getAffectedReverts=t,e.rebaseByTextRemove=n("remove"),e.rebaseByTextInsert=n("insert"),e.processTextDeletion=r(e.rebaseByTextRemove),e.processTextInsertion=r(e.rebaseByTextInsert)}(K||(K={}));var se,ne=r(38508),ie=r(70932),ae=r(28710);!function(e){e.IDLE="idle",e.LOADING="loading",e.READY="ready",e.SUCCESS="success"}(se||(se={}));const oe="no_output",ce={type:oe},le={current:{previews:[],reverts:[],replacementInfo:h.YP,hasAppliedPreviewOnce:!1},applied:{reverts:[]}};class pe{constructor(e={state:{state:se.IDLE,context:le}}){this._params=e,this._state=ee.h.create(this._params.state),this._newParagraphsSinceRevert=new WeakMap,this._logger=ie.Y.create("TouchTypistStateManagerImpl"),this.state=this._state.view(),this._interrupted=e=>{const{state:t,context:r}=e,s=ce;return t!==se.IDLE?(this._logger.debug("TouchTypistStateManager state reset to idle"),[{type:ae._.INTERRUPTED},{state:se.IDLE,context:{current:{previews:[],reverts:[],replacementInfo:h.YP,hasAppliedPreviewOnce:!1},applied:{reverts:r.applied.reverts}}}]):[s,e]},this._loading=e=>{const{state:t,context:r}=e,s=ce;return t===se.IDLE?(this._logger.debug("TouchTypistStateManager state changed to loading"),[{type:ae._.LOADING},{state:se.LOADING,context:{current:{previews:[],reverts:[],replacementInfo:h.YP,hasAppliedPreviewOnce:!1},applied:{reverts:r.applied.reverts}}}]):[s,e]},this._responseReceived=e=>t=>{var r;const{state:s,context:n}=t;if(s===se.LOADING){if(this._logger.debug("TouchTypistStateManager state changed to ready"),!(null===(r=e.previews)||void 0===r?void 0:r.length))return this._logger.debug("Response has no previews.",{response:e}),this._interrupted(t);const s=j.normalize(e.textScope.begin),i=e.previews.map((t=>({...s(t),touchTypistId:e.touchTypistId,relativeReverseDelta:t.reverseDelta}))),a=J.findCorrespondingPreview(i),o=J.normalize(e.textScope.begin),c=e.reverts.reduce(((t,r)=>{const s=a(r);return h.pC(s)&&t.push({...o(r),touchTypistId:e.touchTypistId,isRecent:!0,correspondingPreview:s.value}),t}),[]);c.forEach((e=>{this._newParagraphsSinceRevert.set(e,0)}));const l={current:{...n.current,previews:i,reverts:c,replacementInfo:h.G({replacementText:e.text,replacementTextRange:{start:e.textScope.begin,end:e.textScope.end}})},applied:{reverts:n.applied.reverts}};return[{type:ae._.RESPONSE_RECEIVED},{state:se.READY,context:l}]}return[ce,t]},this._responseApplied=e=>{const{state:t,context:r}=e;return t===se.READY&&h.pC(r.current.replacementInfo)?(this._logger.debug("TouchTypistStateManager state changed to success"),[{type:ae._.RESPONSE_APPLIED},{state:se.SUCCESS,context:{...le,current:{...le.current,hasAppliedPreviewOnce:!1},applied:{reverts:[...r.applied.reverts,...r.current.reverts]}}}]):[ce,e]},this._previewApplied=e=>t=>{var r;const n=t.context.current.previews.find((t=>t.id===e));if(!n)return this._logger.warn(`Received a "${ae._.PREVIEW_APPLIED}" event, but the corresponding preview is missing from the state.`,{previewIdInPayload:e,previewsInState:t.context.current.previews}),[{type:ae._.PREVIEW_APPLIED},t];const i=t.context.current.previews.filter((t=>t.id!==e)),a=t.context.current.reverts.filter((t=>t.correspondingPreview.id!==e)),o=(0,s.zG)(t.context.current.replacementInfo,h.UI((e=>{const t=n.end-n.begin,r=n.replacement.length-t;return{...e,replacementTextRange:{...e.replacementTextRange,end:e.replacementTextRange.end+r}}})));return[{type:ae._.PREVIEW_APPLIED},{state:i.length>0?se.READY:se.IDLE,context:{...t.context,current:{...t.context.current,previews:i,reverts:a,replacementInfo:o,hasAppliedPreviewOnce:null!==(r=i.length>0)&&void 0!==r&&r}}}]},this._previewDismissed=e=>t=>{if(t.state!==se.READY)return[ce,t];const r=t.context.current.previews.find((t=>t.id===e));if(!r)return this._logger.warn(`Received a "${ae._.PREVIEW_DISMISSED}" event, but the corresponding preview is missing from the state.`,{previewIdInPayload:e,previewsInState:t.context.current.previews}),[{type:ae._.PREVIEW_DISMISSED},t];const n=t.context.current.previews.filter((e=>e!==r)),i=t.context.current.reverts.find((t=>t.correspondingPreview.id===e)),a=t.context.current.reverts.filter((e=>e!==i)),o=K.rebase(r),c=a.map(o),l=t.context.applied.reverts.map(o),p=j.rebaseByRemovedPreview(r),d=n.map(p),g=(0,s.zG)(t.context.current.replacementInfo,h.UI((e=>{const t=(0,ne.l)(new Q.i([...r.relativeReverseDelta.ops]),e.replacementText);return{...e,replacementText:t}})));return[{type:ae._.PREVIEW_DISMISSED},{state:0===d.length?se.IDLE:se.READY,context:{...t.context,current:{...t.context.current,previews:d,reverts:c,replacementInfo:g},applied:{...t.context.applied,reverts:l}}}]},this._individualRevertApply=e=>t=>{const r=t.context.applied.reverts.find((t=>t.revertId===e)),n=t=>t.filter((t=>t.revertId!==e)),i=n(t.context.applied.reverts),a=r?K.rebaseByRemovedPreview(r.correspondingPreview):s.yR,o=i.map(a);return[{type:ae._.REVERT_APPLIED},{state:se.IDLE,context:{...t.context,current:{...t.context.current,reverts:n(t.context.current.reverts)},applied:{...t.context.applied,reverts:o}}}]},this._replacementTextChangesEmitted=e=>t=>{const r=j.rebase(e.changes),s=t.context.current.previews.map(r);return[ce,{...t,context:{...t.context,current:{...t.context.current,previews:s}}}]},this._userAddedOrRemovedNewlines=e=>{const t=e=>e.filter((e=>{let t=this._newParagraphsSinceRevert.get(e);return void 0===t&&(this._logger.info("Revert has no newParagraphs count, setting to 0",{revert:e}),t=0),t+1!==2&&(this._newParagraphsSinceRevert.set(e,t+1),!0)})),r=t(e.context.current.reverts),s=t(e.context.applied.reverts);return this._logger.debug("_userAddedOrRemovedNewlines",{currentReverts:r,appliedReverts:s}),[{type:ae._.USER_ADDED_OR_REMOVED_NEWLINES},{...e,context:{...e.context,current:{...e.context.current,reverts:r},applied:{...e.context.applied,reverts:s}}}]},this._updateReverts=e=>{const t=e.context.applied.reverts.map((e=>({...e,isRecent:!1})));return[{type:ae._.UPDATE_REVERTS},{...e,context:{...e.context,applied:{...e.context.current,reverts:t}}}]},this._handleRemovalTextChange=e=>t=>{const r=K.processTextDeletion(t.context.applied.reverts,e,K.getRevertsRange(t.context.applied.reverts));return[{type:ae._.HANDLE_TEXT_REMOVAL},{...t,context:{...t.context,applied:{...t.context.applied,reverts:r}}}]},this._handleInsertionTextChange=e=>t=>{const r=K.processTextInsertion(t.context.applied.reverts,e,K.getRevertsRange(t.context.applied.reverts));return[{type:ae._.HANDLE_TEXT_INSERTION},{...t,context:{...t.context,applied:{...t.context.applied,reverts:r}}}]},this._transition=e=>{const t=e.name;switch(t){case ae._.INTERRUPTED:case ae._.RESPONSE_NOT_RECEIVED:return this._interrupted;case ae._.LOADING:return this._loading;case ae._.RESPONSE_RECEIVED:return this._responseReceived(e.payload);case ae._.RESPONSE_APPLIED:return this._responseApplied;case ae._.PREVIEW_APPLIED:return this._previewApplied(e.payload.previewId);case ae._.PREVIEW_DISMISSED:return this._previewDismissed(e.payload.previewId);case ae._.REVERT_APPLIED:return this._individualRevertApply(e.payload.revertId);case ae._.REPLACEMENT_TEXT_CHANGES_EMITTED:return this._replacementTextChangesEmitted(e.payload.changes);case ae._.USER_ADDED_OR_REMOVED_NEWLINES:return this._userAddedOrRemovedNewlines;case ae._.UPDATE_REVERTS:return this._updateReverts;case ae._.HANDLE_TEXT_REMOVAL:return this._handleRemovalTextChange(e.payload.textRange);case ae._.HANDLE_TEXT_INSERTION:return this._handleInsertionTextChange(e.payload.textRange);default:(0,Z.L0)(t)}},this.handleEvent=e=>{const[t,r]=this._transition(e)(this.state.get());return t.type===oe&&this._logger.debug(`Transition [${e.name}] wasn't made because TouchTypistStateManager wasn't in the correct state, current state: [${this.state.get().state}]`),this._state.set(r),t},this.getTouchTypistId=()=>{const e=this.state.get().context.current.previews;return 0===e.length?(this._logger.info("No previews in the state"),null):Number(e[0].touchTypistId)},this.getPreviewsCount=()=>this.state.get().context.current.previews.length,this._logger.debug("TouchTypistStateManager initialized.")}}var he=r(65882),de=r(59833),ge=r(24348),ue=r(8923),me=r(11456);class ve{constructor(e){this._params=e,this._subs=new n.w,this._alerts=new i.X([]),this._alertFilter=this._alerts.pipe(a.U((e=>t=>{if(0===e.length||me.S.isTouchTypistAlert(t))return!0;const r=e.filter((e=>e.kind===ge.y.Preview)).flatMap((e=>e.highlightRanges));return!t.highlightRanges.some((e=>r.some((t=>re.SV.intersects(e,t)))))}))),this.alertFilter=this._alertFilter,[this._createAlertsSubscription(),this._createTouchTypistStateSubscription()].forEach((e=>this._subs.add(e)))}_createAlertsSubscription(){const e={equals:ge.u.equals};return this._alerts.pipe(p.G(),c.h((([e,t])=>e.length>0||t.length>0)),a.U((([t,r])=>({alertsToRemove:de.e5(e)(r)(t),alertsToAdd:de.e5(e)(t)(r)})))).subscribe((({alertsToRemove:e,alertsToAdd:t})=>{e.forEach((e=>this._params.alertProcessor.removeAlert(e.id,{_tag:ue.i.alertUpdate}))),t.forEach((e=>this._params.alertProcessor.addAlert(e)))}))}_createTouchTypistStateSubscription(){const e=this._params.touchTypistState.pipe(a.U((({context:e})=>e)),v.x()),t=this._params.textObserver.contentChanges.async.pipe(a.U((({newText:e})=>e)),v.x());return he.aj([e,t]).pipe(a.U((([e,t])=>{const r=({start:e,end:r})=>t.slice(e,r);return[...e.current.previews.map(ge.u.fromPreview(r)),...e.applied.reverts.map(ge.u.fromRevert(r))]}))).subscribe((e=>{this._alerts.next(e)}))}dispose(){this._subs.unsubscribe()}}var _e=r(14275),be=r(78488),ye=r(14765);function fe(e,t,r){return u.T(t.obs.pipe(l.h(null)),e).pipe(ye.O(null),p.G(),o.M(r),c.h((([[e,t],r])=>!r&&[e,t].every((e=>null!==e)))),a.U((([[,e]])=>e)))}var xe,Ee,Te,we=r(65384);!function(e){e.is=function(e){return 1===e.changes.length&&we.q.isDel(e.changes[0])}}(xe||(xe={})),function(e){e.is=function(e){return 1===e.changes.length&&we.q.isIns(e.changes[0])}}(Ee||(Ee={})),function(e){e.is=function(e){return[Ee.is,xe.is].some((t=>t(e)))}}(Te||(Te={}));var Re=r(73863),Pe=r(12518);function Ce(e,t){return e===(e=>{if(we.q.isIns(e))return e.pos+e.text.length;if(we.q.isDel(e))return e.pos;(0,Z.L0)(e)})(t)}function Se(e,t,r){const n=ie.Y.create(`TouchTypist.${Se.name}`);if(!(t.start===t.end))return n.debug("Selection is not a caret."),h.YP;const i=t;if(!Ce(i.start,e.changes[0]))return n.debug("Caret is not at the end of the text change."),h.YP;const a=e.newText,o=(0,s.zG)(((e,t)=>{if(t<0||t>e.length)return Pe.left(new Error("Caret outside of the text boundaries."));let r=t,s=t;for(;r>0&&"\n"!==e.charAt(r-1);)r--;for(;s<e.length&&"\n"!==e.charAt(s);)s++;return Pe.right({start:r,end:s})})(a,i.start),Pe.fold((e=>(n.error("Failed to get paragraph range containing position.",e,{text:a,position:i.start}),null)),s.yR));if(!o||o.start===o.end)return n.debug("Paragraph containing caret is empty."),h.YP;return o.end===i.start?(r.set(h.G(o)),h.G(o)):(n.debug("Caret is not at the end of its containing paragraph."),n.debug(`Paragraph end: ${o.end}. Caret position: ${i.start}.`),h.YP)}function Ie(e,t,r){return e.pipe(_e.skipBy(h.Eh(re.SV.eq))).pipe(Re.q(1)).pipe(a.U(h.WG),a.U((e=>{const s=e?function(e,t,r){const s=ie.Y.create(`TouchTypist.${Se.name}`),n=h.WG(r.get());if(t.start!==t.end)return s.debug("Selection is not a caret."),h.YP;if(!n||n.start===n.end)return s.debug("Paragraph containing caret is empty."),h.YP;const i=e.newText.length-e.prevText.length;return 0!==i?n?h.G({start:n.start+i,end:n.end+i}):h.YP:h.G(n)}(r,e,t):h.YP;return s})))}class Ae{constructor(e){this._params=e,this._subs=new n.w,this._cachedActiveParagraphRange=ee.h.create(h.YP),this._activeParagraphRange=ee.h.create(h.YP),this._compoundChanges=[],this.activeParagraphRange=this._activeParagraphRange.view();const t=(r=this._params.textChangesAsync,s=this._params.replacementListener,i=this._params.stateManager,l=this._params.isReplacing,fe(r,s,l).pipe(o.M(l),be.b((([,e])=>{if(!e){const e=i.state.get().context.applied.reverts;i.handleEvent({name:ae._.INTERRUPTED}),e.length>0&&i.handleEvent({name:ae._.UPDATE_REVERTS})}})),c.h((([e,t])=>!t&&Te.is(e))),a.U((([e])=>e)),y.b(1e3)));var r,s,i,l;this._subs.add(t.pipe(function(e,t){const r=e.pipe(_e.skipBy(h.Eh(re.SV.eq))).pipe(Re.q(1));return e=>e.pipe(_.w((e=>r.pipe(a.U(h.WG),a.U((r=>r?Se(e,r,t):h.YP))))))}(this._params.selectionOrCaretPosition,this._cachedActiveParagraphRange)).pipe(_e.skipBy(h.Eh(re.SV.eq))).subscribe((e=>{this._activeParagraphRange.set(e)}))),this._subs.add(this._params.stateManager.state.pipe(a.U((e=>e.context.current.hasAppliedPreviewOnce))).subscribe((e=>{e||this._params.isReplacing.next(!1)}))),this._subs.add(he.aj([this._params.textChangesAsync,this._params.isReplacing]).pipe(p.G(),be.b((([[e,t],[r,s]])=>{if(!t&&!s)return;e.newText===r.newText||(this._params.stateManager.handleEvent({name:ae._.REPLACEMENT_TEXT_CHANGES_EMITTED,payload:{changes:r}}),this._compoundChanges.push(r))})),_.w((([[,e],[t,r]])=>{if(!r&&e&&0!==this._compoundChanges.length){const e={...t,prevText:this._compoundChanges[0].prevText};return Ie(this._params.selectionOrCaretPosition,this._cachedActiveParagraphRange,e)}return b.of(null)}))).subscribe((e=>{e&&(this._compoundChanges=[],this._activeParagraphRange.set(e))}))),this._subs.add(u.T(this._params.selectionOrCaretPosition.pipe(o.M(this._params.isReplacing.pipe(ye.O(!1),p.G())),a.U((([e,[t,r]])=>({selectionEmitted:!0,selection:e,isReplacingEmitted:!1,isReplacingP:t,isReplacingC:r})))),this._params.isReplacing.pipe(p.G(),o.M(this._params.selectionOrCaretPosition),a.U((([[e,t],r])=>({selectionEmitted:!1,selection:r,isReplacingEmitted:!0,isReplacingP:e,isReplacingC:t}))))).pipe(o.M(this._activeParagraphRange),be.b((([{selectionEmitted:e,selection:t,isReplacingC:r,isReplacingP:s},n])=>{if(e&&s&&!r)this._params.isReplacing.next(!1);else if((!e||!r)&&e&&!r&&!s){const e=h.WG(t),r=h.WG(n);e&&r&&e.start===r.end||this._params.stateManager.handleEvent({name:ae._.INTERRUPTED})}}))).subscribe()),this._subs.add(function(e,t,r,s){return fe(e,t,s).pipe(c.h((e=>e.changes.length>0&&we.q.isDel(e.changes[0]))),a.U((e=>({start:e.changes[0].pos,end:e.changes[0].pos+e.changes[0].text.length}))),be.b((e=>{r.handleEvent({name:ae._.HANDLE_TEXT_REMOVAL,payload:{textRange:e}})})))}(this._params.textChangesAsync,this._params.replacementListener,this._params.stateManager,this._params.isReplacing).subscribe()),this._subs.add(function(e,t,r,s){return fe(e,t,s).pipe(c.h((e=>e.changes.length>0&&we.q.isIns(e.changes[0]))),a.U((e=>({start:e.changes[0].pos,end:e.changes[0].pos+e.changes[0].text.length}))),be.b((e=>{r.handleEvent({name:ae._.HANDLE_TEXT_INSERTION,payload:{textRange:e}})})))}(this._params.textChangesAsync,this._params.replacementListener,this._params.stateManager,this._params.isReplacing).subscribe())}dispose(){this._subs.unsubscribe()}}var De=r(45818),ke=r(28110),Oe=r(91901),Ne=r(1124);class Le{constructor(e){this._params=e,this._logger=ie.Y.create("TouchTypistGDocsIntegration"),this._logger.info("TouchTypist integration for GDocs")}get eventsTargetElement(){const e=(0,Ne.CI)(document);return e||(this._logger.error("Could not find the target element for text events"),document.body)}getCaretPosition(e){return this._params.caretService.getCaretPositionGdocs(e,Oe.y1)}}class Me{constructor(e){this._params=e,this._logger=ie.Y.create("TouchTypistGenericIntegration"),this._logger.info("TouchTypist integration for non-GDocs")}get eventsTargetElement(){return document.body}getCaretPosition(e){return this._params.caretService.getCaretPositionGeneral(e)}}var Ge=r(4079),Ue=r(67445),Ye=r(10595),Be=r(44424),Fe=r(47344);class $e{constructor(e){this._params=e,this._logger=ie.Y.create("TouchTypistCapiServiceImpl")}triggerTouchTypist(e){const t=this._params.getCheckingService();if(!t)return this._logger.error("Checking service is not available in TouchTypist"),Promise.reject(new Error("Checking service is not available in TouchTypist"));const r={action:"trigger_touch_typist",mode:"GEC_PROGRESSIVE_RECHECK",features:[Ge.zV.individualPreviewReverts],textScope:e,correlationId:"touch-typist",id:1};return this._params.textChangeBuffer.flush(),(0,s.zG)(t.checkingRevisionInfo,y.b(100),Re.q(1),Ye.L(1e3,Be._((()=>{throw this._logger.error("TouchTypist request couldn't be sent because latest revision wasn't emitted"),new Error("TouchTypist request couldn't be sent because latest revision wasn't emitted")}))),be.b((()=>{t.sendTouchTypistCommand(r)})),l.h(void 0)).toPromise()}_sendCommand(e,t=!0){const r=this._params.getCheckingService();if(!r)throw this._logger.error("Checking service is not available in TouchTypist"),new Error("Checking service is not available in TouchTypist");return t?r.sendTouchTypistCommand(e):(0,Fe.Q1)()}sendTouchTypistPreviewAction(e,t,r){try{this._sendCommand({actionType:e,previewId:r,touchTypistId:t,action:"touch_typist_action",id:1})}catch(t){this._logger.error(`Failed to send touch typist preview action: ${e} for preview id: ${r} with error: ${t}`)}}sendTouchTypistRevertAction(e,t){try{this._sendCommand({touchTypistId:e,action:"touch_typist_action",id:1,actionType:Ue.XN.Revert,revertId:t,location:"REVERT_CARD"})}catch(e){this._logger.error(`Failed to send touch typist revert action for revert id: ${t} with an error ${e}`)}}sendTouchTypistApplyAction(e){try{this._sendCommand({touchTypistId:e,action:"touch_typist_action",id:1,actionType:Ue.XN.Apply,location:"HOTKEY",hotkey:"TAB"})}catch(t){this._logger.error(`Failed to send touch typist apply action for touch typist id: ${e} with an error ${t}`)}}sendTouchTypistRevertLookAction(e,t){try{this._sendCommand({action:"touch_typist_action",id:1,actionType:Ue.XN.RevertLook,touchTypistId:e,revertId:t})}catch(e){this._logger.error(`Failed to send touch typist revert look action for revert id: ${t} with an error ${e}`)}}sendTouchTypistAppearAction(e){try{this._sendCommand({action:"touch_typist_action",id:1,actionType:Ue.XN.Appeared,touchTypistId:e})}catch(t){this._logger.error(`Failed to send touch typist appear action for touch typist id: ${e} with an error ${t}`)}}sendTouchTypistSkipAction(e){try{this._sendCommand({touchTypistId:e,action:"touch_typist_action",id:1,actionType:Ue.XN.Skipped})}catch(t){this._logger.error(`Failed to send touch typist skip action for touch typist id: ${e} with an error ${t}`)}}}var Ve=r(8748);class We{constructor(e){this._params=e,this._subs=new n.w}listeningToHotkeyApply(){this._subs.add(this._params.touchTypistStateValue.pipe(_.w((e=>e===se.READY?m.R(this._params.targetElement,"keydown",{capture:!0}):Ve.E)),c.h((e=>"Tab"===e.key)),be.b((e=>{e.stopImmediatePropagation(),e.preventDefault()}))).subscribe((()=>{this._params.applyChanges()})))}dispose(){this._subs.unsubscribe()}}var ze=r(86378);class qe{constructor(e){this._params=e,this._subs=new n.w,this._textChangesObs=new i.X({changes:[],prevText:"",newText:"",deltaChange:ze.RI.delta(new Q.i)}),this.textChangesAsyncObs=this._textChangesObs.asObservable(),this._subs.add(this._params.textObserver.contentChanges.async.subscribe((e=>{0!==e.changes.length&&this._textChangesObs.next(e)})))}dispose(){this._subs.unsubscribe()}}var He=r(12015),Xe=r(60129),je=r(67325);class Je{constructor(e){this._params=e,this._logger=ie.Y.create("TouchTypistCaretPreservingReplacementServiceImpl"),this._subs=new n.w,this._replacementInfo=ee.h.create(null),this._selectionOrCaretPosition=ee.h.create(null),this._subs.add(this._params.stateManager.state.pipe(a.U((e=>e.context.current.replacementInfo)),v.x()).subscribe(He.wW(this._replacementInfo))),this._subs.add(this._params.selectionOrCaretPosition.pipe(c.h(h.pC),a.U(je.MH)).subscribe(He.wW(this._selectionOrCaretPosition)))}_subscribeToTextChanges(e,t,r,s,n){const i=null!==e?((e,t,r,s)=>re.SV.translate(re.SV.rebase(re.SV.translate(e,-s.start),we.k.fromDiff(t,r)),s.start))(e,t,r,s):null,a=this._params.textChangesAsync.pipe(Xe.u(n.pipe(c.h((e=>!0===e)))),Re.q(1)).subscribe((()=>{i?this._params.selectionService.setSelection({start:i.start,end:i.end}):this._logger.info("No initial caret given, not restoring"),this._params.isReplacing.next(!1)}));this._subs.add(a)}canPerformReplacement(e,t){return this._params.replacementService.canPerformReplacement(e,t)}performReplacement(e,t){const{pos:r,value:s}=e,n=this._selectionOrCaretPosition.get(),i=ee.h.create(!1);if(this.canPerformReplacement({pos:r,oldValue:t,value:s}))return this._logger.debug("Perform replacement",{range:r,newText:s,oldText:t,caretPosition:n}),d.Y3((async()=>{this._params.isReplacing.next(!0),this._subscribeToTextChanges(n,t,s,r,i);const a=await this._params.replacementService.performReplacement(e,{preserveFormatting:!0});return i.set(!0),a}),(e=>{throw this._logger.error("Failed to perform a replacement",e),this._params.isReplacing.next(!1),e}));throw this._params.isReplacing.next(!1),new Error("Can't perform replacement at this range")}performBatchReplacements(e,t,r){const s=this._selectionOrCaretPosition.get(),{pos:n,value:i}=t,a=ee.h.create(!1);return this._logger.debug("Perform batch replacements",{newText:i,oldText:r,caretPosition:s}),d.Y3((async()=>{this._subscribeToTextChanges(s,r,i,n,a),this._params.isReplacing.next(!0);const t=await this._params.replacementService.performBatchReplacements(e,{preserveFormatting:!0});return a.set(!0),t}),(e=>{throw this._logger.error("Failed to perform a batch replacement",e),new Error(`Failed to perform a batch replacement, ${String(e)}`)}))}async applyChanges(){this._logger.info("Apply TouchTypist suggestions");const e=(0,s.zG)(this._replacementInfo.get(),h.g_(s.gn,s.yR));if(e){const t=await this.performReplacement({pos:e.replacementTextRange,value:e.replacementText},this._params.textObserver.getCurrentTextMap().getPlainText().slice(e.replacementTextRange.start,e.replacementTextRange.end))();return Pe.isRight(t)?this._params.stateManager.handleEvent({name:ae._.RESPONSE_APPLIED}):this._params.stateManager.handleEvent({name:ae._.INTERRUPTED})}return this._params.stateManager.handleEvent({name:ae._.INTERRUPTED})}dispose(){this._subs.unsubscribe()}}var Ke=r(61228),Qe=r(53710),Ze=r(57291),et=r(10712);const tt=(e,t,r)=>{const n=h.pC(r),i=1===e.changes.length&&h.pC(t);return n?(0,s.zG)(r,h.g_((()=>h.YP),(e=>e.start===e.end?h.G(e):h.YP))):i?(a=e.changes[0],o=t,we.q.isIns(a)?(0,s.zG)(o,h.UI((e=>({start:e.start+a.text.length,end:e.end+a.text.length})))):we.q.isDel(a)?(0,s.zG)(o,h.UI((e=>({start:e.start-a.text.length,end:e.end-a.text.length})))):o):h.YP;var a,o};class rt{constructor(e){this._params=e,this._subs=new n.w,this._caretPosition=ee.h.create(h.YP),this._caretPositionObs=new i.X(h.YP),this._logger=ie.Y.create("TouchTypistCaretService"),this.caretPositionObs=this._caretPositionObs.asObservable();const t=function(e,t,r,s){const n=e.pipe(a.U((e=>({source:"selection",value:e})))),i=t.pipe(a.U((e=>({source:"textChanges",value:e}))));return u.T(n,i).pipe(Ke.e(s),c.h((e=>e.length>0)),Qe.R(((e,t)=>{const s={...e};let n=!1;for(const e of t)"selection"===e.source&&h.pC(e.value.selectionOrCaretPosition)?(s.latestPosition=e.value.selectionOrCaretPosition,s.currentPosition=e.value.selectionOrCaretPosition,n=!0):"textChanges"===e.source&&(n||(s.currentPosition=tt(e.value.textChanges,r.get(),e.value.selectionOrCaretPosition)));return s}),{latestPosition:h.YP,currentPosition:r.get()}),a.U((e=>e.currentPosition)))}(this._params.selectionOrCaretPosition.pipe(a.U((e=>({textChanges:{changes:[],prevText:"",newText:"",deltaChange:ze.RI.delta(new Q.i)},selectionOrCaretPosition:e})))),this._params.textChangesAsync.pipe(a.U((e=>({textChanges:e,selectionOrCaretPosition:h.YP})))),this._caretPosition,200);this._subs.add(t.subscribe((e=>{this._caretPosition.set(e),this._caretPositionObs.next(e)})))}getCaretPositionGdocs(e,t){return(0,s.zG)(e,h.g_(s.gn,(()=>(0,s.zG)(h.ij(document.querySelector(t)),h.UI((e=>e.getBoundingClientRect())),h.UI((({left:e,top:t})=>({top:t+16,left:e-15}))),h.WG))))}getCaretPositionGeneral(e){this._logger.debug("TouchTypistCaretService.getCaretPositionGeneral invoked");const t=(0,s.zG)(e,h.UI((e=>(0,Ze.FN)((()=>this._params.textObserver.getCurrentTextMap()),this._params.geometryProvider,this._params.geometryLayout,s.yR)(e))),h.UI((e=>e.length>0?e[e.length-1]:null)),h.NG((e=>e?{left:e.right,top:e.top,width:e.width,height:e.height}:null)),h.WG);if(!t)return this._logger.debug("Failed to get caret position. Paragraph range:",je.QP(e)),null;const r=(0,et.Z)({...t,kind:"offsetPoint"},this._params.textFieldLayout.rect.getApproximate().client,this._params.textFieldLayout.scroll.getApproximate());this._logger.debug("Caret position:",r);return{left:r.left-15,top:r.top+8}}dispose(){this._subs.unsubscribe()}}class st{constructor(e){this._params=e,this._subs=new n.w,this._disposables=[],this._stateManager=new pe,this._isReplacing=new i.X(!1),this._textChangesService=new qe({geometryLayout:this._params.geometryLayout,geometryProvider:this._params.geometryProvider,textFieldLayout:this._params.textFieldLayout,textObserver:this._params.textObserver,selectionOrCaretPosition:this._params.selectionOrCaretPosition}),this._caretService=new rt({geometryLayout:this._params.geometryLayout,geometryProvider:this._params.geometryProvider,textFieldLayout:this._params.textFieldLayout,textChangesAsync:this._textChangesService.textChangesAsyncObs,selectionOrCaretPosition:this._params.selectionOrCaretPosition,stateManager:this._stateManager,textObserver:this._params.textObserver}),this._integration="gDocsCanvas"===this._params.integrationInfo.integrationName?new Le({caretService:this._caretService}):new Me({caretService:this._caretService}),this._logger=ie.Y.create("TouchTypistFeatureImpl"),this._touchTypistState=this._stateManager.state,this._touchTypistCapiService=new $e({getCheckingService:this._params.getCheckingService,textChangeBuffer:this._params.textChangeBuffer}),this._paragraphService=new Ae({textChangesAsync:this._textChangesService.textChangesAsyncObs,selectionOrCaretPosition:this._caretService.caretPositionObs,replacementListener:this._params.replacementListener,stateManager:this._stateManager,isReplacing:this._isReplacing}),this._replacementService=new Je({replacementService:this._params.replacementService,textObserver:this._params.textObserver,textChangesAsync:this._textChangesService.textChangesAsyncObs,selectionService:this._params.selectionService,activeParagraphRange:this._paragraphService.activeParagraphRange,selectionOrCaretPosition:this._caretService.caretPositionObs,stateManager:this._stateManager,isReplacing:this._isReplacing}),this._touchTypistHotkeyManager=new We({touchTypistStateValue:this._stateManager.state.pipe(a.U((e=>e.state))),targetElement:this._integration.eventsTargetElement,applyChanges:async()=>{const e=this._stateManager.getTouchTypistId();await this._replacementService.applyChanges(),e&&this._touchTypistCapiService.sendTouchTypistApplyAction(e)}}),this._touchTypistAlertService=new ve({alertProcessor:this._params.alertProcessor,touchTypistState:this._touchTypistState,textObserver:this._params.textObserver}),this.alertFilter=this._touchTypistAlertService.alertFilter,this._logger.info("Touch Typist feature is initialized",this._params.integrationInfo),this._disposables.push(this._paragraphService,this._replacementService,this._touchTypistAlertService),this._touchTypistHotkeyManager.listeningToHotkeyApply(),this._disposables.push(this._touchTypistHotkeyManager),this._subs.add(this._paragraphService.activeParagraphRange.pipe(o.M(this._stateManager.state)).pipe(a.U((([e,t])=>{const r=(0,s.zG)(e,h.g_(s.gn,s.yR));r&&t.state===se.IDLE&&(this._logger.info("Send touch typist trigger event",r),this._stateManager.handleEvent({name:ae._.LOADING}),d.Y3((async()=>await this._touchTypistCapiService.triggerTouchTypist({begin:r.start,end:r.end})),(()=>this._stateManager.handleEvent({name:ae._.INTERRUPTED})))())}))).subscribe()),this._subs.add(this._createUserAddedOrRemovedNewlinesSubscription()),this._subs.add(nt(this._touchTypistState,(()=>this._stateManager.getTouchTypistId()),(e=>this._touchTypistCapiService.sendTouchTypistAppearAction(e)),(e=>this._touchTypistCapiService.sendTouchTypistSkipAction(e))))}dispose(){this._disposables.forEach((e=>e.dispose()))}get touchTypistUI(){return function(e,t,r,s,n){const i=u.T(t.scroll.changes,m.R(self,"scroll",{capture:!0})).pipe(l.h(void 0)),o=[se.LOADING,se.READY,se.SUCCESS];return s.pipe(a.U((e=>e.state)),v.x(),_.w((t=>{if(!o.includes(t))return b.of(h.YP);const s=e.activeParagraphRange.pipe(a.U((e=>r.getCaretPosition(e))),a.U((e=>{if(!e)return h.YP;if(t===se.LOADING){const t=5,r=7;return h.G(g.createElement(X,{top:e.top+t,left:e.left+r}))}if(t===se.READY)return h.G(g.createElement(W,{top:e.top,left:e.left,hotkeyName:"Tab",errorsCount:n()}));if(t===se.SUCCESS){const t=10,r=7;return h.G(g.createElement(q,{top:e.top+r,left:e.left+t}))}return h.YP})));return u.T(i.pipe(l.h(h.YP)),i.pipe(y.b(250),f.c(s)),s)})))}(this._paragraphService,this._params.textFieldLayout,this._integration,this._touchTypistState,(()=>this._stateManager.getPreviewsCount()))}onTouchTypistTriggerResponse(e){this._logger.debug("TouchTypist TriggerResponse received.",e),this._stateManager.handleEvent({name:ae._.RESPONSE_RECEIVED,payload:e})}createPreviewInlineCardModel(e){return new ke.p(e,this._replacementService,this._stateManager,this._touchTypistCapiService,this._params.alertProcessor)}createRevertInlineCardModel(e){return new De.I(e,this._replacementService,this._stateManager,this._touchTypistCapiService)}_createUserAddedOrRemovedNewlinesSubscription(){return fe(this._textChangesService.textChangesAsyncObs,this._params.replacementListener,this._isReplacing).pipe(c.h((e=>e.changes.some((e=>e.text.includes("\n"))))),l.h(void 0)).subscribe((()=>{this._stateManager.handleEvent({name:ae._.USER_ADDED_OR_REMOVED_NEWLINES})}))}}function nt(e,t,r,s){let n=null;return e.pipe(p.G()).subscribe((([e,i])=>{const a=t();(a||n)&&(a&&e.state===se.LOADING&&i.state===se.READY&&(n=a,r(a)),n&&e.state===se.READY&&i.state===se.IDLE&&s(n))}))}},91901:(e,t,r)=>{r.d(t,{$x:()=>a,F8:()=>u,Go:()=>n,Kt:()=>x,Lq:()=>l,QR:()=>C,Qy:()=>_,Vk:()=>E,Wp:()=>s,XG:()=>i,_m:()=>d,d0:()=>p,f:()=>c,gH:()=>v,gL:()=>T,gv:()=>m,ij:()=>P,j5:()=>f,jW:()=>g,lO:()=>R,os:()=>y,rx:()=>w,uj:()=>h,y1:()=>o,yw:()=>b});const s=".kix-appview-editor",n=".docos-input",i=".docs-texteventtarget-iframe",a=".kix-cursor",o=".kix-cursor-caret",c="#docs-revisions-sidebar",l='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',p="#docs-toolbar-mode-switcher",h="edit-mode",d="suggest-mode",g="#titlebar-mode-indicator-container .titlebar-request-access-button",u="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",m=".kix-canvas-tile-content",v="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",_=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",b=".kix-page-paginated",y=".kix-page-paginated.canvas-first-page",f=".docs-horizontal-ruler",x=".docs-vertical-ruler",E="#fontSizeSelect input",T=".docs-ruler-background",w=".docs-ruler-background-inner",R=".docs-ruler-indent-first-line",P=".modal-dialog.docs-dialog .fatal-error-message",C='#docs-titlebar-share-client-button div[role="button"]'},82675:e=>{e.exports={dot:"KcZm9","dot-blink":"LxClj"}},23729:e=>{e.exports={bubble:"Z2bAs","bubble-scale":"L_Apf",checkmark:"cRf3w","draw-checkmark":"xcjpV"}},16286:(e,t,r)=>{r.d(t,{k:()=>o});var s=r(49231),n=r(68760),i=r(68022),a=r(82717);const o=s.forwardRef((function(e,t){const{utility:r,other:n}=(0,i.a)(e),{accessibilityLabel:o,align:l,as:p,children:h,className:d,direction:g="row",elevation:u,flex:m,gap:v=0,justify:_,wrap:b=!1,style:y={},...f}=n,x=function({direction:e,wrap:t,elevation:r,className:s}){return(0,a.W)("gds-flex","column"===e&&"gds-flex-direction-column",t&&"gds-flex-wrap",r&&`gds-flex-elevation-${r}`,s)}({direction:g,wrap:b,elevation:u,className:d}),E=(0,i.f)(r),T={...c(v),alignItems:l,justifyContent:_,flex:m,...E,...y},w=null!=p?p:"div";return s.createElement(w,{"aria-label":o,ref:t,className:x,style:T,...f},h)}));function c(e){if(null==e)return{};if("number"==typeof e)return{gap:`var(--space-${(0,n.Jy)(e)})`};return{gap:`${null==e.row?"normal":`var(--space-${(0,n.Jy)(e.row)})`} ${null==e.column?"normal":`var(--space-${(0,n.Jy)(e.column)})`}`}}},73507:(e,t,r)=>{r.d(t,{h:()=>l});var s=r(49231),n=r(12696),i=r(82717),a=r(54698),o=r(22014),c=r(94936);const l=s.forwardRef((function(e,t){var r,l,p;const{buttonProps:h,isPressed:d,ref:g,inProgress:u}=(0,n.zT)(e,t),{isFocusVisible:m,focusProps:v}=(0,a.Fx)();return s.createElement(o.u,{...e.tooltipProps,annotation:e.shortcut},s.createElement(o.aJ,{asChild:!0},s.createElement("button",{className:(0,i.W)((0,n.gj)(e,d,u,m),`gds-icon-button-${e.size||"medium"}`),tabIndex:null!=(r=e.tabIndex)?r:0,ref:g,...h,...v},s.createElement(c.J,{icon:e.icon,accessibilityLabel:"",variant:"inherit",size:e.size||"medium"}))),s.createElement(o._v,{root:null==(l=e.tooltipContentProps)?void 0:l.root},(null==(p=e.tooltipContentProps)?void 0:p.children)||e.accessibilityLabel))}))},52719:(e,t,r)=>{function s(e){if(void 0!==e)return"light-green"===e?"var(--light-green)":"yellow-green"===e?"var(--yellow-green)":/-\d\d?\d?$/.test(e)||"white"===e?`var(--${e})`:`var(--color-${e})`}r.d(t,{y:()=>s})},68022:(e,t,r)=>{r.d(t,{a:()=>i,f:()=>a});var s=r(52719),n=r(68760);function i(e){const{bgColor:t,borderColor:r,borderRadius:s,color:n,margin:i,marginLeft:a,marginRight:o,marginTop:c,marginBottom:l,padding:p,paddingLeft:h,paddingRight:d,paddingTop:g,paddingBottom:u,width:m,height:v,..._}=e;return{utility:{bgColor:t,borderColor:r,borderRadius:s,color:n,margin:i,marginLeft:a,marginRight:o,marginTop:c,marginBottom:l,padding:p,paddingLeft:h,paddingRight:d,paddingTop:g,paddingBottom:u,width:m,height:v},other:_}}function a(e){const{bgColor:t,borderColor:r,borderRadius:i,color:a,margin:o,marginLeft:c,marginRight:l,marginTop:p,marginBottom:h,padding:d,paddingLeft:g,paddingRight:u,paddingTop:m,paddingBottom:v,width:_,height:b}=e;return{backgroundColor:(0,s.y)(t),border:void 0!==r?`1px solid var(--color-border-${r})`:void 0,borderRadius:void 0!==i?`var(--radius-${(0,n.Jy)(i)})`:void 0,color:void 0!==a?`var(--color-text-${a})`:void 0,width:"number"==typeof _?`${_}px`:_,height:"number"==typeof b?`${b}px`:b,...(0,n.AA)({margin:o,marginLeft:c,marginRight:l,marginTop:p,marginBottom:h}),...(0,n.VI)({padding:d,paddingLeft:g,paddingRight:u,paddingTop:m,paddingBottom:v})}}},9858:(e,t,r)=>{r.d(t,{D:()=>n});var s=r(49231);const n=(0,r(97417).I)("color",(({title:e,titleId:t,desc:r,descId:n,...i})=>s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceMoreVertical",stroke:"transparent","aria-labelledby":t,"aria-describedby":n,...i},r?s.createElement("desc",{id:n},r):null,e?s.createElement("title",{id:t},e):null,s.createElement("path",{fill:"#646B81",d:"M9.2 8a1.2 1.2 0 1 1-2.4 0 1.2 1.2 0 0 1 2.4 0M9.2 12.8a1.2 1.2 0 1 1-2.4 0 1.2 1.2 0 0 1 2.4 0M9.2 3.2a1.2 1.2 0 1 1-2.4 0 1.2 1.2 0 0 1 2.4 0"}))))},79024:(e,t,r)=>{r.d(t,{o:()=>n});var s=r(49231);const n=(0,r(97417).I)("color",(({title:e,titleId:t,desc:r,descId:n,...i})=>s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceMore",stroke:"transparent","aria-labelledby":t,"aria-describedby":n,...i},r?s.createElement("desc",{id:n},r):null,e?s.createElement("title",{id:t},e):null,s.createElement("path",{fill:"#646B81",d:"M8.001 6.8a1.2 1.2 0 1 1 0 2.4 1.2 1.2 0 0 1 0-2.4M12.803 6.8a1.2 1.2 0 1 1 0 2.4 1.2 1.2 0 0 1 0-2.4M3.2 6.8a1.2 1.2 0 1 1 0 2.4 1.2 1.2 0 0 1 0-2.4"}))))},57362:(e,t,r)=>{r.d(t,{p:()=>n});var s=r(49231);const n=(0,r(97417).I)("nocolor",(({title:e,titleId:t,desc:r,descId:n,...i})=>s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:32,height:32,fill:"none",viewBox:"0 0 32 32","aria-hidden":"true","data-icon":"LogoLogomarkMonochromeDefault",stroke:"transparent","aria-labelledby":t,"aria-describedby":n,...i},r?s.createElement("desc",{id:n},r):null,e?s.createElement("title",{id:t},e):null,s.createElement("path",{fill:"#1C1C1C",d:"M0 16C0 7.163 7.162 0 16.001 0s16 7.163 16 16c0 7.732-5.482 14.183-12.773 15.676-1.042.213-2.121.324-3.222.324H0z"}),s.createElement("path",{fill:"#fff",d:"m19.876 14.484-1.788 2.94h6.02c-.93 5.116-6.62 8.599-12.304 5.653a6.7 6.7 0 0 1-2.861-2.834c-3.27-6.226 1.197-12.49 7.093-12.49a8.19 8.19 0 0 1 6.2 2.839l1.58-2.6a11.08 11.08 0 0 0-8.566-3.148c-5.562.384-10.071 4.994-10.342 10.56-.309 6.393 4.8 11.688 11.124 11.688s11.14-4.999 11.14-11.14c0-.5-.038-.989-.1-1.468z"}))))}}]);