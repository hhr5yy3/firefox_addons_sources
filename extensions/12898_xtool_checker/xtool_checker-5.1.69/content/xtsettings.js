XTSettings = 
{
	_debug : false,
	_checkActionNames : [],
	_loggedIn : false,
	_query_yp_yl : 2,
	_yapQueryTypes : [],
	_yalQueryTypes : [],
	_gpQueryTypes : [],
	_glQueryTypes : [],
	_gcQueryTypes : [],
	_rQueryTypes : [],
	_yapQueryTypes2 : [],
	_yalQueryTypes2 : [],
	_gpQueryTypes2 : [],
	_glQueryTypes2 : [],
	_gcQueryTypes2 : [],
	_inyQueryTypes : [],
	_inyQueryTypes2 : [],
	_ingQueryTypes : [],
	_ingQueryTypes2 : [],
	_ing1QueryTypes : [],
	_ing1QueryTypes2 : [],
	_rQueryTypes2 : [],
	_rlvQueryTypes : [],
	_rlvQueryTypes2 : [],
	_inyParams : "",
	_ingParams : "",
	_ing1Params : "",
	_yapParams : "",
	_yalParams : "",
	_glParams : "",
	_gpParams : "",
	_gcParams : "",
	_rParams : "",
	_loginAttempt : 0,
	_yalMethod: 1,
	_pauseMulticheck : false,
	_isSplitting : false,
	_loginValue : "",
	_passwordValue : "",

	_checking : false,
	_checkJsForPos : false,
	_show_gl : true,
	_show_gp : true,
	_show_gc : true,
	_show_tic : true,
	_show_yap : true,
	_show_yc : true,
	_show_bc : true,
	_show_lvl : true,
	_show_pos : true,
	_show_yal : true,
	_show_trf : true,
	_show_lin : true,
	_show_lout : true,
	_show_iny : true,
	_show_gbl : false,
	_show_bl : false,
	_show_pr : true,
	_show_ing : true,
	_show_sqi : true,
	_show_r : false,
	_show_rlv : false,
	_end_multicheck_sound : true,
	_capcha_sound : true,
	_show_addressbar_icon: true,
	_check_domain_only: true,
	//_use_gapi : false,
	_show_es : false,
	_pos_domain : false,
	_pos_www : false,
	_check_yl_with_yc: false,
	_ing_type : 0,
	_checkInAllMode : false,
	_auto_gbl_spam : false,
	_auto_gbl_xtd : false,
	_auto_gbl_flt : false,
	_showYCdays : true,
	_dbBusy : false,
	_hide_sape_yap : true,
	_hide_sape_yal : true,
	_use_auto_select_yap : true,
	_use_auto_select_virus : false,
	//_use_auto_select_yal : false,	
	_use_auto_select_pos : false,
	_mark_pos_near : true,
	_use_auto_select_bc : false,
	_use_auto_select_bc_int : false,
	_use_highlight_bc_ext : false,
	_use_auto_select_lvl : false,
	_use_auto_select_lvl_3 : false,
	_use_auto_select_vis : false,
	_use_auto_select_tic : false,
	_use_auto_select_tic_na : false,
	_use_highlight_text : false,
	_use_auto_select_gp : false,
	_use_auto_select_gc : false,
	_use_auto_select_gl : false,
	_use_auto_select_pr : false,
	_use_auto_select_pr_domain : false,
	_use_auto_select_ar : false,
	_use_auto_select_sim : false,
	_use_auto_select_rg : false,
	_use_auto_select_ry : false,
	_use_auto_select_rlv : false,
	_use_highlight_rlv : false,
	_use_auto_select_es : false,
	_use_highlight_es : false,
	
	_use_highlight_trf : false,
	_use_auto_select_nepot : false,
	_use_auto_highlight_nepot : true,
	_use_auto_select_unranked : false,
	_use_auto_select_yc : false,
	_use_auto_select_no_trf : false,
	_use_auto_highlight_tic : false,
	_set_tic_if_no_link : false,
	_use_custom_url_pos : false,
	_use_antigate : false,
	_antigate_no_alerts : false,
	_use_auto_select_bc_error : false,
	_use_bc_url_length : false,
	//_use_new_versions : true,
	_check_on_orders_page : false,
	_posNotCheckErr : true,
	_posCheckErr : true,
	_posCheckTimeout : false,
	_pos_ignore_noindex : true,
	_pos_ignore_nofollow : true,
	_pos_use_yandex_useragent : true,
	
	_skipYal : true,
	_skipXT : true,
	_check_pr_domain : false,
	_capcha_type : "manual",
	_lastUrl : "",
	_mozAccessId : "",
	_mozSecretKey : "",

	_yandex_user : "",
	_yandex_key : "",
	_yandex_url : "",
	_yandex_xml_url : "",
	_pos_url : "",
	//_yap_yal_yandex_only: false,
	_expireYal : true,
	_mode : 1,
	_showHint : true,
	_useCache : true,
	_onlyDomains : false,
	_isCaptureDialog : false,
	_useCache_y : false,
	_useCache_g : false,
	
	_yalExpireDays : 40,
	_cacheExpireDays : 30,
	_cacheExpireDays_y : 30,
	_cacheExpireDays_g : 30,
	_expireCache : true,
	_expireCache_y : true,
	_expireCache_g : true,
//	_skipCached : true,
	_skipChecked : false,
	
	_skipBCNoFollow : false,
	_skipBCNoIndex : false,
	_skipBCImg : false,
	_skipBCBlockImg : false,
	_no_ancors_bc : true,
	_bc_subdomains_internal : true,
	_region_id : 225,
	_timeout_g_min : 2000,
	_timeout_g : 5000,
	_timeout_y_min : 2000,
	_timeout_y : 5000, 
	_timeout_pr_min : 100,
	_timeout_pr : 300, 
	_timeout_cpt : 60,
	_g_time : 0,
	_y_time : 0,
	_y_waitTime : 0,
	_pr_time : 0,
	_pr_waitTime : 0,
	_g_waitTime : 0,
	_cpt_time: 0,
	_posValue : 0.9,
	_posNearValue : 3,
	_highlightValue : 300,
	_bcUrlValue : 200,
	_bcValue : 20,
	_rgValue : -1,
	_ryValue : -1,
	_nepotValue : 60,
	_nepotHValue : 60,
	_bcExtHighlightValue : 20,
	_bcValueInt : 150,
	_visValue : 100000,
	_kvpValue : 2.5,
	_ticValue : 20,
	_rlvValue : 20,
	_rlvHighlightValue : 20,
	_esValue : 20,
	_esHighlightValue : 20,
	_esMinWords : 5000,	
	_trfHighlightValue : 5,

	_timeout : 30,
	_threadCount : 20,
	_threadStartCount : 5,
	_xtThreadCount : 1,
	_bcEncoding : "",
	_useColorBC : true,
	_useBCwords : false,
	_checkBCwords : false,
	_showBCsize : true,
	_useBlock : true,
	_useAutoSelectBlock : true,
	_bcLinkCount : 4,
	_bcLinksTextLength : 100,
	
	_useAutoSelect : false,
	_use_auto_select_cache: false,
	_use_auto_select_cache_y: false,
	_use_auto_select_cache_g: false,
	_auto_select_max_value : 3.0,
	_use_auto_select_iny : false,
	_use_auto_select_ing : false,
	_use_auto_select_spam : false,
	
	_useAutoSelectXT : false,
	_useAutoSelectXTNO : false,
	_useAutoSelectXTDYellow : true,
	//_useAutoSelectAGSOnly : false,
	_filters_codes : "1, 2, 3, 4",
	_useAutoSelectXTDOrange : true,
	_auto_select_XT_max_value : 1.0,
	_spamValue : 3,
	_spamCheckValue : 3,
	_useColorXT : true,
	_tmpList : [],
	
	_inyValue : 30,
	_ingValue : 30,
	_prValue : 2,
	_prDomainValue : 2,
	_arValue : 2000000,
	_simValue : 200,	
	_stopWords : "",
	_stopWordsList : [],
	_keywords : "",
	_keywordsList : [],
	_bcWords : "",
	_bcWordsList : [],
	_bcDomains : "",
	_bcDomainsList : [],
	_antigate_key : "",
	_jsPosValue : "acint.net/aci.js",
	_pos_url_ext: '',
	_mark_on_start : false,
	_check_marked : false,
	_mark_gbl_on_start : false,
	_check_gbl_marked : false,
	_check_yc_days : false,
	_yc_days : 30,
	_check_gc_days : false,
	_gc_days : 30,
	_stabValue : -1,
	_minStab : -1,
	_maxStab : -1,
	_useTextLength : false,
	_text_length_value : 300,
	_stopWait : false,
	_useDomainXTHist : false,
	_thread : 0,
	_processingPft : false,
	_needPft : false,
	_pftStr : "",
	_pftUrl : "",
	_regionName : "",
	_pftCount : 1000000,
	_pftThreadIndex : -1,
	_version : "",
	_newFile : "",
	_custom_yp : false,
	_custom_yl : false,
	_custom_gp : false,
	_custom_gl : false,
	_custom_iny : false,
	_custom_ing : false,
	_custom_ing1 : false,
	_template_yp : "",
	_template_yl : "",
	_template_gp : "",
	_template_gl : "",
	_template_iny : "",
	_template_ing : "",
	_template_ing1 : ""
};

XTSettingsManager = {
	_storage : {},
	
	CheckAndReadSettings : function()
	{
		console.log("Read settings");
		
		browser.storage.local.get().then(
		function(result) {
			try{
				for (var key in XTDefaultSettings)
				{
					XTSettingsManager.ReadCharValue(result, key, XTDefaultSettings[key], XTSettingsRemap[key]);
				}
			}
			catch(e)
			{
				
				console.log("Set defaults error " +e);
			}
			/*
			
			if (!XToolChecker._prefs.prefHasUserValue(XToolChecker._settingsPrefix + 'stop_words_ext')) 
			{
				if (!XToolChecker._prefs.prefHasUserValue(XToolChecker._settingsPrefix + 'stop_words')) 
				{
					XToolChecker._prefs.setCharPref(XToolChecker._settingsPrefix + 'stop_words', "/forum, displayimage, showthread, tag");	
				}
				else
				{
					this._stopWords = XToolChecker._prefs.getCharPref(XToolChecker._settingsPrefix + 'stop_words');	
							
				}	
				var text = Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);
				text.data = this._stopWords;
				XToolChecker._prefs.setComplexValue(XToolChecker._settingsPrefix + 'stop_words_ext', Components.interfaces.nsISupportsString, text);			
			}
			else
			{
				this._stopWords = XToolChecker._prefs.getComplexValue(XToolChecker._settingsPrefix + 'stop_words_ext', Components.interfaces.nsISupportsString).data;
			}*/
			
			
			/*
			
			if (!XToolChecker._prefs.prefHasUserValue(XToolChecker._settingsPrefix + 'keywords_ext')) 
			{
				var text = Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);
				this._keywords = " ";
				text.data = this._keywords;
				XToolChecker._prefs.setComplexValue(XToolChecker._settingsPrefix + 'keywords_ext', Components.interfaces.nsISupportsString, text);
			}
			else
			{
				this._keywords = XToolChecker._prefs.getComplexValue(XToolChecker._settingsPrefix + 'keywords_ext', Components.interfaces.nsISupportsString).data;
			}
			try {
			this._keywordsList = [];
			var tmp = this._keywords.split(",");
			for (var i = 0; i < tmp.length; i++)
			{
				tmp[i] = tmp[i].replace(/^\s+|\s+$/g, '');
				if (tmp[i] != "")
					this._keywordsList.push(tmp[i]);
			}
			}
			catch (e) {}
			
			
			if (!XToolChecker._prefs.prefHasUserValue(XToolChecker._settingsPrefix + 'bc_ignore_domain')) 
			{
				var text = Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);
				text.data = '';
				XToolChecker._prefs.setComplexValue(XToolChecker._settingsPrefix + 'bc_ignore_domain', Components.interfaces.nsISupportsString, text);			
			}
			else
			{
				this._bcDomains = XToolChecker._prefs.getComplexValue(XToolChecker._settingsPrefix + 'bc_ignore_domain', Components.interfaces.nsISupportsString).data;
				// XToolChecker._prefs.getCharPref(XToolChecker._settingsPrefix + 'bc_ignore_domain');	
						
			}
			
			if (!XToolChecker._prefs.prefHasUserValue(XToolChecker._settingsPrefix + 'region_name')) 
			{
				var text = Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);
				text.data = '';
				XToolChecker._prefs.setComplexValue(XToolChecker._settingsPrefix + 'region_name', Components.interfaces.nsISupportsString, text);			
			}
			else
			{
				this._regionName = XToolChecker._prefs.getComplexValue(XToolChecker._settingsPrefix + 'region_name', Components.interfaces.nsISupportsString).data;	
						
			}*/
			
			/*var defaultUrl = '';
			if ((this._yandex_user != "") && (this._yandex_key!="")) 
				defaultUrl = 'http://xmlsearch.yandex.ru/xmlsearch?user='+this._yandex_user+'&key='+this._yandex_key;
			this._yandex_url = XTSettingsManager.ReadCharValue(result, 'yandex_url', defaultUrl);*/
			
			//this._useAutoSelectAGSOnly = XTSettingsManager.ReadBoolValue(result, 'use_auto_select_XTD_ags_only', false);

			XTSettings._keywordsList = [];
			var tmp = XTSettings._keywords.split(",");
			for (var i = 0; i < tmp.length; i++)
			{
				tmp[i] = tmp[i].replace(/^\s+|\s+$/g, '');
				if (tmp[i] != "")
				XTSettings._keywordsList.push(tmp[i]);
			}
	

			XTSettings._stopWordsList = [];
			var tmp = XTSettings._stopWords.split(",");
			for (var i = 0; i < tmp.length; i++)
			{
				tmp[i] = tmp[i].replace(/^\s+|\s+$/g, '');
				if (tmp[i] != "")
					XTSettings._stopWordsList.push(tmp[i]);
			}

			XTSettings._bcWordsList = [];
			var tmp = XTSettings._bcWords.split(",");
			for (var i = 0; i < tmp.length; i++)
			{
				tmp[i] = tmp[i].replace(/^\s+|\s+$/g, '');
				if (tmp[i] != "")
					XTSettings._bcWordsList.push(tmp[i]);
			}
						
			XTSettings._bcDomainsList = [];
			var tmp = XTSettings._bcDomains.split("\n");
			for (var i = 0; i < tmp.length; i++)
			{
				tmp[i] = tmp[i].replace(/^\s+|\s+$/g, '');
				if (tmp[i] != "")
					XTSettings._bcDomainsList.push(tmp[i]);
			}

			XTSettings._yapQueryTypes = [];
			XTSettings._yapQueryTypes.push(XTSettings._query_yp_yl);
			XTSettings._yapQueryTypes2 = [];
			XTSettings._yalQueryTypes = [];
			XTSettings._yalQueryTypes.push(XTSettings._query_yp_yl);
			XTSettings._yalQueryTypes2 = [];
			XTSettings._inyQueryTypes = [];
			XTSettings._inyQueryTypes.push(XTSettings._query_yp_yl);
			XTSettings._inyQueryTypes2 = [];
			if (XTSettings._yandex_xml_url == "")
			{
				XTSettings._yandex_xml_url = "http://xmlsearch.yandex.ru/xmlsearch?user=" + XTSettings._yandex_user +"&key="+ XTSettings._yandex_key + "&lr=213&groupby=attr%3Dd.mode%3Ddeep.groups-on-page%3D99.docs-in-group%3D1&noreask=1&nomisspell=1&query=";
				var obj = {};
				obj["yandex_xml_url"] = XTSettings._yandex_xml_url;
				browser.storage.local.set(obj);
			}
		}, XTSettingsManager.onError);
	},
	
		
	ReadCharValue : function(result, valueName, defaultVal, varName)
	{
		if (!varName)
			varName = "_"+ valueName;
		if (result[valueName] == undefined)
		{
			var obj = {};
			obj[valueName] = defaultVal;
			browser.storage.local.set(obj);
			XTSettings[varName] = defaultVal;
		}
		else
		{			
			XTSettings[varName] = result[valueName];
		}
	},
	
	 onError : function (error) 
	{
		console.log(`XTContentTools Error: ${error}`);
	}
};