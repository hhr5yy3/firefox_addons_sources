var app=function(){"use strict";function e(){}function t(e,t){for(const n in t)e[n]=t[n];return e}function n(e){return e()}function a(){return Object.create(null)}function r(e){e.forEach(n)}function s(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function c(e,n,a,r){return e[1]&&r?t(a.ctx.slice(),e[1](r(n))):a.ctx}function i(e){const t={};for(const n in e)"$"!==n[0]&&(t[n]=e[n]);return t}function h(e,t){const n={};t=new Set(t);for(const a in e)t.has(a)||"$"===a[0]||(n[a]=e[a]);return n}function u(e,t){e.appendChild(t)}function p(e,t,n){e.insertBefore(t,n||null)}function l(e){e.parentNode&&e.parentNode.removeChild(e)}function m(e){return document.createElement(e)}function $(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function f(e){return document.createTextNode(e)}function d(){return f(" ")}function g(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}const b=["width","height"];function w(e,t){const n=Object.getOwnPropertyDescriptors(e.__proto__);for(const a in t)null==t[a]?e.removeAttribute(a):"style"===a?e.style.cssText=t[a]:"__value"===a?e.value=e[a]=t[a]:n[a]&&n[a].set&&-1===b.indexOf(a)?e[a]=t[a]:g(e,a,t[a])}function y(e,t){for(const n in t)g(e,n,t[n])}function v(e,t,n){e.classList[n?"add":"remove"](t)}let x;function k(e){x=e}function P(){if(!x)throw new Error("Function called outside component initialization");return x}function _(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e.call(this,t)))}const I=[],q=[];let C=[];const W=[],L=Promise.resolve();let R=!1;function T(e){C.push(e)}const O=new Set;let S=0;function z(){if(0!==S)return;const e=x;do{try{for(;S<I.length;){const e=I[S];S++,k(e),E(e.$$)}}catch(e){throw I.length=0,S=0,e}for(k(null),I.length=0,S=0;q.length;)q.pop()();for(let e=0;e<C.length;e+=1){const t=C[e];O.has(t)||(O.add(t),t())}C.length=0}while(I.length);for(;W.length;)W.pop()();R=!1,O.clear(),k(e)}function E(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(T)}}const M=new Set;let U;function A(e,t){e&&e.i&&(M.delete(e),e.i(t))}function N(e,t,n,a){if(e&&e.o){if(M.has(e))return;M.add(e),U.c.push((()=>{M.delete(e),a&&(n&&e.d(1),a())})),e.o(t)}else a&&a()}function j(e,t){const n={},a={},r={$$scope:1};let s=e.length;for(;s--;){const o=e[s],c=t[s];if(c){for(const e in o)e in c||(a[e]=1);for(const e in c)r[e]||(n[e]=c[e],r[e]=1);e[s]=c}else for(const e in o)r[e]=1}for(const e in a)e in n||(n[e]=void 0);return n}function D(e){e&&e.c()}function Z(e,t,a,o){const{fragment:c,after_update:i}=e.$$;c&&c.m(t,a),o||T((()=>{const t=e.$$.on_mount.map(n).filter(s);e.$$.on_destroy?e.$$.on_destroy.push(...t):r(t),e.$$.on_mount=[]})),i.forEach(T)}function H(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];C.forEach((a=>-1===e.indexOf(a)?t.push(a):n.push(a))),n.forEach((e=>e())),C=t}(n.after_update),r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function G(e,t){-1===e.$$.dirty[0]&&(I.push(e),R||(R=!0,L.then(z)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function X(t,n,s,o,c,i,h,u=[-1]){const p=x;k(t);const m=t.$$={fragment:null,ctx:[],props:i,update:e,not_equal:c,bound:a(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(p?p.$$.context:[])),callbacks:a(),dirty:u,skip_bound:!1,root:n.target||p.$$.root};h&&h(m.root);let $=!1;if(m.ctx=s?s(t,n.props||{},((e,n,...a)=>{const r=a.length?a[0]:n;return m.ctx&&c(m.ctx[e],m.ctx[e]=r)&&(!m.skip_bound&&m.bound[e]&&m.bound[e](r),$&&G(t,e)),n})):[],m.update(),$=!0,r(m.before_update),m.fragment=!!o&&o(m.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);m.fragment&&m.fragment.l(e),e.forEach(l)}else m.fragment&&m.fragment.c();n.intro&&A(t.$$.fragment),Z(t,n.target,n.anchor,n.customElement),z()}k(p)}class B{$destroy(){H(this,1),this.$destroy=e}$on(t,n){if(!s(n))return e;const a=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return a.push(n),()=>{const e=a.indexOf(n);-1!==e&&a.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function F(e){return e[~~(e.length*Math.random())]}function Y(e){return new Promise((async t=>{let n,a=new XMLHttpRequest;a.timeout=5e3,a.ontimeout=()=>t(5e3),a.onerror=()=>t(),a.onreadystatechange=()=>{if(2==a.readyState)if(200==a.status){let e=(new Date).getTime();a.abort(),t(e-n)}else t(5e3+a.status)},a.open("GET",`${e}?_=${(new Date).getTime()}`,!0),n=(new Date).getTime(),a.send(null)}))}function J(e){return new Promise((async t=>{let n,a=0;for(let r=0;r<3;r++)if(n=await Y(e),0!=r){if(n>=5e3)return void t(n);a+=n}a=parseInt(a/3),t(a)}))}function Q(e,t){let n=[];t>e.length&&(t=e.length);for(let a=0;a<t;a++){const t=e[Math.floor(Math.random()*e.length)];n.push(t)}return n}window.browser=window.browser||window.chrome;var K={getRandomInstance:F,getNextInstance:function(e,t){const n=t.indexOf(e);return-1===n?F(t):t[(n+1)%t.length]},protocolHost:function(e){if(e.pathname=e.pathname.replace(/\/$/,""),e.username&&e.password)return`${e.protocol}//${e.username}:${e.password}@${e.host}${e.pathname}`;if("/TekstoLibre/"==e.pathname&&e.host.endsWith("github.io"))return`${e.protocol}//${e.host}${e.pathname.slice(0,-1)}`;const t="/"!=e.pathname?e.pathname:"";return`${e.protocol}//${e.host}${t}`},getList:function(e){return new Promise((t=>{let n;if("github"==e.fetchInstances)n="https://raw.githubusercontent.com/libredirect/instances/main/data.json";else{if("codeberg"!=e.fetchInstances)return t("disabled");n="https://codeberg.org/LibRedirect/instances/raw/branch/main/data.json"}const a=new XMLHttpRequest;a.open("GET",n,!0),a.onreadystatechange=()=>{if(200===a.status&&a.readyState==XMLHttpRequest.DONE)return t(JSON.parse(a.responseText))},a.onerror=()=>t(),a.ontimeout=()=>t(),a.send(null)}))},getBlacklist:function(e){return new Promise((t=>{let n;if("github"==e.fetchInstances)n="https://raw.githubusercontent.com/libredirect/instances/main/blacklist.json";else{if("codeberg"!=e.fetchInstances)return t("disabled");n="https://codeberg.org/LibRedirect/instances/raw/branch/main/blacklist.json"}const a=new XMLHttpRequest;a.open("GET",n,!0),a.onreadystatechange=()=>{200===a.status&&a.readyState==XMLHttpRequest.DONE&&t(JSON.parse(a.responseText))},a.onerror=()=>t(),a.ontimeout=()=>t(),a.send(null)}))},getConfig:function(){return new Promise((e=>{fetch("/config.json").then((e=>e.text())).then((t=>{e(JSON.parse(t))}))}))},getOptions:function(){return new Promise((e=>browser.storage.local.get("options",(t=>e(t.options)))))},getPingCache:function(){return new Promise((e=>browser.storage.local.get("pingCache",(t=>e(t.pingCache??{})))))},ping:J,addressToLatLng:function(e){const t=new XMLHttpRequest;if(t.open("GET",`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=1`,!1),t.send(),200==t.status){const e=JSON.parse(t.responseText)[0];return e?{coordinate:`${e.lat},${e.lon}`,boundingbox:`${e.boundingbox[2]},${e.boundingbox[1]},${e.boundingbox[3]},${e.boundingbox[0]}`}:{}}},getQuery:function(e){let t="";return e.searchParams.has("q")?t=e.searchParams.get("q"):e.searchParams.has("query")&&(t=e.searchParams.has("query")),t},prefsEncoded:function(e){return new URLSearchParams(e).toString()},convertMapCentre:function(e){let[t,n,a]=[null,null,null];const r=e.pathname.match(/@(-?\d[0-9.]*),(-?\d[0-9.]*),(\d{1,2})[.z]/);return r?[,n,t,a]=r:e.searchParams.has("center")&&([t,n]=e.searchParams.get("center").split(","),a=e.searchParams.get("zoom")??"17"),{zoom:a,lon:n,lat:t}},randomInstances:Q,style:function(e,t){const n=function(e,t){const n={text:"#fff",bgMain:"#121212",bgSecondary:"#202020",active:"#fbc117",danger:"#f04141",lightGrey:"#c3c3c3"},a={text:"black",bgMain:"white",bgSecondary:"#e4e4e4",active:"#fb9817",danger:"#f04141",lightGrey:"#c3c3c3"};return"dark"==e.theme?n:"light"==e.theme?a:t.matchMedia("(prefers-color-scheme: dark)").matches?n:a}(e,t);return`--text: ${n.text};\n  --bg-main: ${n.bgMain};\n  --bg-secondary: ${n.bgSecondary};\n  --active: ${n.active};\n  --danger: ${n.danger};\n  --light-grey: ${n.lightGrey};`},autoPickInstance:async function(e,t){if(t){const n=e.findIndex((e=>t.href.startsWith(e)));n>=0&&e.splice(n,1)}const n=Q(e,5),a=await Promise.all([...n.map((async e=>[e,await J(e)]))]);return a.sort(((e,t)=>e[1]-t[1])),a[0][0]}};const V=void 0===browser.runtime.getBrowserInfo;let ee,te;async function ne(){te=await K.getOptions(),ee=await K.getConfig()}function ae(e,t,n,a){let r=[];if(t)n[t]&&(r=n[t]);else for(const t in a.services[e].frontends)n[t]&&r.push(...n[t]);return r}function re(e,t,n,a,r){let s=n.services[e].targets;r&&"excludeTargets"in n.services[e].frontends[r]&&("search"===e&&a.search.redirectGoogle||(s=s.filter((t=>!n.services[e].frontends[r].excludeTargets.includes(s.indexOf(t))))));for(const e in s){if(new RegExp(s[e]).test(t.href))return!0}return!1}function se(e,t,n,a,r,s){if("main_frame"!=t&&"sub_frame"!=t&&"image"!=t)return;let o,c;if(s||1!=te.redirectOnlyInIncognito||r){for(const i in ee.services){if(!s&&!te[i].enabled)continue;if(!s&&1==te[i].redirectOnlyInIncognito&&!r)continue;if(c=te[i].frontend,ee.services[i].frontends[c].desktopApp&&"main_frame"!=t&&"main_frame"!=te[i].redirectType&&(c=te[i].embedFrontend),!re(i,e,ee,te,c)){c=null;continue}if("main_frame"!=t&&a&&"sub_frame"==te[i].redirectType&&re(i,a,ee,te,c))return;if(ee.services[i].embeddable&&t!=te[i].redirectType&&"both"!=te[i].redirectType)return"block"==te[i].unsupportedUrls?"CANCEL":void 0;let h=te[c];if(void 0===h)break;if(ee.services[i].frontends[c].localhost&&"localhost"==te[i].instance)o=`http://${c}.localhost:8080`;else{if(0===h.length)return`https://no-instance.libredirect.invalid?frontend=${encodeURIComponent(c)}&url=${encodeURIComponent(e.href)}`;o=K.getRandomInstance(h)}if(n&&h.includes(n.origin))return"main_frame"==t?"BYPASSTAB":null;break}if(c)return function(e,t,n,a){switch(n){case"hyperpipe":for(const t of[...e.searchParams.keys()])"q"!==t&&e.searchParams.delete(t);return`${a}${e.pathname}${e.search}`.replace(/\/search\?q=.*/,(e=>e.replace("?q=","/")));case"searx":case"searxng":for(const t of[...e.searchParams.keys()])"q"!==t&&e.searchParams.delete(t);return`${a}/${e.search}`;case"whoogle":for(const t of[...e.searchParams.keys()])"q"!==t&&e.searchParams.delete(t);return`${a}/search${e.search}`;case"4get":{const t=e.searchParams.get("q");return null!==t?`${a}/web?s=${encodeURIComponent(t)}`:a}case"librey":for(const t in e.searchParams.keys())"q"!=t&&e.searchParams.delete(t);return`${a}/search.php${e.search}`;case"yattee":return e.searchParams.delete("si"),e.href.replace(/^https?:\/{2}/,"yattee://");case"freetube":case"freetubePwa":return e.searchParams.delete("si"),"freetube://"+e.href;case"poketube":if(e.searchParams.delete("si"),e.pathname.startsWith("/channel")){const t=/\/channel\/(.*)\/?$/.exec(e.pathname);if(t)return`${a}/channel?id=${t[1]}${e.search}`}return/\/@[a-z]+\//.exec(e.pathname)?a:`${a}${e.pathname}${e.search}`;case"libMedium":case"scribe":{const t=e.hostname.match(/^(link|cdn-images-\d+|.*)\.medium\.com/);if(t&&t.length>1){const n=t[1];if("link"!=n||!n.startsWith("cdn-images"))return`${a}/@${n}${e.pathname}${e.search}`}return`${a}${e.pathname}${e.search}`}case"translite":case"simplyTranslate":return`${a}/${e.search}`;case"send":case"mozhi":return a;case"libreTranslate":return`${a}/${e.search.replace("sl","source").replace("tl","target").replace("text","q")}`;case"osm":{if(t&&"earth.google.com"===t.host)return a;let n={layers:"mapnik"},r="#";const s=K.convertMapCentre(e);if(s.zoom&&s.lon&&s.lat&&(r=`#map=${s.zoom}/${s.lon}/${s.lat}`),e.pathname.includes("/embed")){const t=K.getQuery(e);let{coordinate:r,boundingbox:s}=K.addressToLatLng(t);return n.bbox=s,n.marker=r,`${a}/export/embed.html?${K.prefsEncoded(n)}`}if(e.pathname.includes("/dir")){if(e.searchParams.has("travelmode")){const t={driving:"fossgis_osrm_car",walking:"fossgis_osrm_foot",bicycling:"fossgis_osrm_bike",transit:"fossgis_osrm_car"};n.engine=t[e.searchParams.get("travelmode")]}const t=/\/dir\/([^@/]+)\/([^@/]+)\/@-?\d[0-9.]*,-?\d[0-9.]*,\d{1,2}[.z]/.exec(e.pathname),s=/\/dir\/([^@/]+)\//.exec(e.pathname);if(t){const e=K.addressToLatLng(decodeURIComponent(t[1])).coordinate??"",a=K.addressToLatLng(decodeURIComponent(t[2])).coordinate??"";n.route=`${e};${a}`}else if(s){const e=K.addressToLatLng(decodeURIComponent(s[1])).coordinate??"";n.route=`${e};`}else{const t=K.addressToLatLng(e.searchParams.get("origin")).coordinate??"",a=K.addressToLatLng(e.searchParams.get("destination")).coordinate??"";n.route=`${t};${a}`}return`${a}/directions?${K.prefsEncoded(n)}${r}`}const o=/\/place\/(.*?)\//;if(e.pathname.match(o))return`${a}/search?query=${e.pathname.match(o)[1]}${r}`;if(e.searchParams.has("ll")){const[t,n]=e.searchParams.get("ll").split(",");return`${a}/search?query=${t}%2C${n}`}if(e.searchParams.has("viewpoint")){const[t,n]=e.searchParams.get("viewpoint").split(",");return`${a}/search?query=${t}%2C${n}`}const c=K.getQuery(e);return c?`${a}/search?query="${c}${r}&${K.prefsEncoded(n)}`:`${a}/${r}&${K.prefsEncoded(n)}`}case"breezeWiki":{let t,n="";return e.hostname.match(/^[a-zA-Z0-9-]+\.(?:fandom|wikia)\.com/)?(t=e.hostname.match(/^[a-zA-Z0-9-]+(?=\.(?:fandom|wikia)\.com)/),t="www"!=t&&t?`/${t}`:"",n=e.pathname):(t=e.pathname.match(/(?<=wiki\/w:c:)[a-zA-Z0-9-]+(?=:)/),t?(t="/"+t+"/wiki/",n=e.pathname.match(/(?<=wiki\/w:c:[a-zA-Z0-9-]+:).+/)):t=""),e.href.search(/Special:Search\?query/)>-1?`${a}${t}${n}${e.search}`.replace(/Special:Search\?query/,"search?q").replace(/\/wiki/,""):`${a}${t}${n}${e.search}`}case"rimgo":return e.href.search(/^https?:\/{2}(?:[im]\.)?stack\./)>-1?`${a}/stack${e.pathname}${e.search}`:`${a}${e.pathname}${e.search}`;case"redlib":case"libreddit":{const t=e.hostname.match(/^(?:(?:external-)?preview|i)(?=\.redd\.it)/);if(!t)return`${a}${e.pathname}${e.search}`;switch(t[0]){case"preview":return`${a}/preview/pre${e.pathname}${e.search}`;case"external-preview":return`${a}/preview/external-pre${e.pathname}${e.search}`;case"i":return`${a}/img${e.pathname}`}return a}case"teddit":return/^(?:(?:external-)?preview|i)\.redd\.it/.test(e.hostname)?""==e.search?`${a}${e.pathname}?teddit_proxy=${e.hostname}`:`${a}${e.pathname}${e.search}&teddit_proxy=${e.hostname}`:`${a}${e.pathname}${e.search}`;case"eddrit":return/^(?:(?:external-)?preview|i)\.redd\.it/.test(e.hostname)?a:`${a}${e.pathname}${e.search}`;case"neuters":{const t=e.pathname;return t.startsWith("/article/")||t.startsWith("/pf/")||t.startsWith("/arc/")||t.startsWith("/resizer/")?a:`${a}${t}`}case"dumb":return e.pathname.endsWith("-lyrics")?`${a}${e.pathname}`:`${a}${e.pathname}${e.search}`;case"intellectual":return`${a}${e.pathname}${e.search}`;case"ruralDictionary":return e.pathname.includes("/define.php")||e.pathname.includes("/random.php")||"/"==e.pathname?`${a}${e.pathname}${e.search}`:a;case"anonymousOverflow":{if("stackoverflow.com"==e.hostname){const t=/^\/a\/(\d+)\/?/.exec(e.pathname);return t?`${a}/questions/${t[1]}${e.search}`:`${a}${e.pathname}${e.search}`}if("/"==e.pathname||""==e.pathname)return`${a}${e.pathname}${e.search}`;const t=e.href.match(/https?:\/{2}(?:([a-zA-Z0-9-]+)\.)?stackexchange\.com\//);if(t&&t.length>1)return`${a}/exchange/${t[1]}${e.pathname}${e.search}`;const n=e.hostname.match(/(?:[a-zA-Z]+\.)?(?:askubuntu\.com|mathoverflow\.net|serverfault\.com|stackapps\.com|superuser\.com|stackoverflow\.com)/);return n?`${a}/exchange/${n[0]}${e.pathname}${e.search}`:`${a}${e.pathname}${e.search}`}case"biblioReads":return`${a}${e.pathname}${e.search}`;case"wikiless":{let t=e.host.split(".");return"wikipedia"!=t[0]&&"www"!=t[0]&&("m"==t[0]?e.searchParams.append("mobileaction","toggle_view_mobile"):e.searchParams.append("lang",t[0]),"m"==t[1]&&e.searchParams.append("mobileaction","toggle_view_mobile")),`${a}${e.pathname}${e.search}${e.hash}`}case"proxiTok":return e.pathname.startsWith("/email")?a:`${a}${e.pathname}${e.search}`;case"waybackClassic":{const t=/^\/\web\/(?:[0-9]+)?\*\/(.*)/.exec(e.pathname);if(t){const e=t[1];return`${a}/cgi-bin/history.cgi?utf8=✓&q=${encodeURIComponent(e)}`}const n=/(^\/\web\/([0-9]+)\/.*)/.exec(e.pathname);if(n){let e=n[1];return e=e.replace(n[2],n[2]+"if_"),`https://web.archive.org${e}`}return}case"gothub":return"gist.github.com"==e.hostname?`${a}/gist${e.pathname}${e.search}`:"raw.githubusercontent.com"==e.hostname?`${a}/raw${e.pathname}${e.search}`:`${a}${e.pathname}${e.search}`;case"mikuInvidious":if("bilibili.com"==e.hostname||"www.bilibili.com"==e.hostname||"b23.tv"==e.hostname)return`${a}${e.pathname}${e.search}`;if("space.bilibili.com"==e.hostname)return`${a}/space${e.pathname}${e.search}`;case"tent":if("bandcamp.com"==e.hostname&&"/search"==e.pathname){const t=e.searchParams.get("q");return`${a}/search.php?query=${encodeURIComponent(t)}`}if(e.hostname.endsWith("bandcamp.com")){const t=/^(.*)\.bandcamp\.com/.exec(e.hostname)[1];if("/"==e.pathname||"/music"==e.pathname)return`${a}/artist.php?name=${t}`;{const n=/^\/(.*)\/(.*)/.exec(e.pathname);if(n)return`${a}/release.php?artist=${t}&type=${n[1]}&name=${n[2]}`}}if("f4.bcbits.com"==e.hostname)return`${a}/image.php?file=${/\/img\/(.*)/.exec(e.pathname)[1]}`;if("t4.bcbits.com"==e.hostname){const t=/\/stream\/(.*)\/(.*)\/(.*)/.exec(e.pathname);if(t){const n=t[1],r=t[2],s=t[3],o=e.searchParams.get("token");return`${a}/audio.php/?directory=${n}&format=${r}&file=${s}&token=${encodeURIComponent(o)}`}}case"binternet":return"i.pinimg.com"==e.hostname?`${a}/image_proxy.php?url=${e.href}`:`${a}${e.pathname}${e.search}`;case"laboratory":{let t=e.pathname;return"/"==t&&(t=""),`${a}/${e.hostname}${t}${e.search}`}case"quetre":{const t=/([a-z]+)\.quora\.com/.exec(e.hostname);if(t){const n=t[1];return e.searchParams.append("lang",n),`${a}${e.pathname}${e.search}`}return`${a}${e.pathname}${e.search}`}case"liteXiv":case"pixivFe":{const t=/\/[a-z]{1,3}\/(.*)/.exec(e.pathname);return t?`${a}/${t[1]}${e.search}`:`${a}${e.pathname}${e.search}`}case"invidious":return e.searchParams.delete("si"),"youtu.be"==e.hostname||e.hostname.endsWith("youtube.com")&&e.pathname.startsWith("/live")?`${a}/watch?v=${e.pathname.substring(e.pathname.lastIndexOf("/")+1)}${e.search.replace("?","&")}`:e.hostname.endsWith("youtube.com")&&e.pathname.startsWith("/redirect?")?e.href:`${a}${e.pathname}${e.search}`;case"freetubeMusic":return"youtu.be"==e.hostname||e.hostname.endsWith("youtube.com")&&e.pathname.startsWith("/live")?`freetube://youtube.com/watch?v=${e.pathname.substring(e.pathname.lastIndexOf("/")+1)}`:"freetube://"+e.href;case"invidiousMusic":return"youtu.be"==e.hostname||e.hostname.endsWith("youtube.com")&&e.pathname.startsWith("/live")?`${a}/watch?v=${e.pathname.substring(e.pathname.lastIndexOf("/")+1)}`:`${a}${e.pathname}${e.search}`;case"materialious":if(e.searchParams.delete("si"),"youtu.be"==e.hostname||e.hostname.endsWith("youtube.com")&&e.pathname.startsWith("/live"))return`${a}/watch/${e.pathname.substring(e.pathname.lastIndexOf("/")+1)}${e.search.replace("?","&")}`;if(e.hostname.endsWith("youtube.com")){if(e.pathname.startsWith("/watch")){if(e.searchParams.has("v")){const t=e.searchParams.get("v");return e.searchParams.delete("v"),`${a}/watch/${t}${e.search.replace("?","&")}`}return`${a}/watch/${e.search.replace("?","&")}`}if(e.pathname.startsWith("/results")){if(e.searchParams.has("search_query")){const t=e.searchParams.get("search_query");return e.searchParams.delete("search_query"),`${a}/search/${t}${e.search.replace("?","&")}`}return`${a}/search/${e.search.replace("?","&")}`}if(e.pathname.startsWith("/redirect?"))return e.href}return`${a}${e.pathname}${e.search}`;case"libremdb":if(e.pathname.startsWith("/Name"))for(const[t,n]of e.searchParams.entries())return`${a}/title/${encodeURIComponent(t)}`;return`${a}${e.pathname}${e.search}`;case"tuboYoutube":return e.searchParams.delete("si"),e.pathname.startsWith("/channel")?`${a}/channel?url=${encodeURIComponent(e.href)}`:e.pathname.startsWith("/watch")?`${a}/stream?url=${encodeURIComponent(e.href)}`:a;case"tuboSoundcloud":return"/"==e.pathname?`${a}?kiosk?serviceId=1`:e.pathname.match(/^\/[^\/]+(\/$|$)/)?`${a}/channel?url=${encodeURIComponent(e.href)}`:e.pathname.match(/^\/[^\/]+\/[^\/]+/)?`${a}/stream?url=${encodeURIComponent(e.href)}`:a;case"twineo":case"safetwitch":return e.hostname.startsWith("clips.")?`${a}/clip${e.pathname}${e.search}`:`${a}${e.pathname}${e.search}`;case"tekstoLibre":return`${a}/?${e.pathname.slice(1)}`;case"skyview":return"/"==e.pathname?a:`${a}?url=${encodeURIComponent(e.href)}`;case"nitter":{let t=new URLSearchParams(e.search);if(t.delete("ref_src"),t.delete("ref_url"),t.delete("s"),t.delete("t"),t=t.toString(),""!==t&&(t=`?${t}`),"pbs"===e.host.split(".")[0]||"video"===e.host.split(".")[0])try{const[,n,r,s]=t.match(/(.*)\?format=(.*)&(.*)/),o=encodeURIComponent(`${n}.${r}?${s}`);return`${a}/pic${e.pathname}${o}`}catch{return`${a}/pic${e.pathname}${t}`}return e.pathname.split("/").includes("tweets")?`${a}${e.pathname.replace("/tweets","")}${t}`:"t.co"==e.host?`${a}/t.co${e.pathname}`:`${a}${e.pathname}${t}#m`}case"priviblur":{if("www.tumblr.com"==e.hostname)return`${a}${e.pathname}${e.search}`;if(e.hostname.startsWith("assets"))return`${a}/tblr/assets${e.pathname}${e.search}`;if(e.hostname.startsWith("static"))return`${a}/tblr/static${e.pathname}${e.search}`;const t=/^([0-9]+)\.media\.tumblr\.com/.exec(e.hostname);if(t)return`${a}/tblr/media/${t[1]}${e.pathname}${e.search}`;const n=/^(?:www\.)?([a-z\d-]+)\.tumblr\.com/.exec(e.hostname);if(n){const t=n[1];return e.pathname.startsWith("/post")?`${a}/${t}${e.pathname.slice(5)}${e.search}`:`${a}/${t}${e.pathname}${e.search}`}return`${a}${e.pathname}${e.search}`}case"freetar":if(e.pathname.startsWith("/search.php"))return e.searchParams.set("search_term",e.searchParams.get("value")),e.searchParams.delete("value"),e.searchParams.delete("search_type"),`${a}/search${e.search}`;if(e.pathname.startsWith("/artist"))return;return`${a}${e.pathname}${e.search}`;case"ratAintTieba":return e.searchParams.delete("ie"),`${a}${e.pathname}${e.search}`;case"shoelace":{const t=/^\/(?:(?:(?:[^\/])?\/post)|t)\/([^\/])/.exec(e.pathname);return t?`${a}/t/${t[1]}${e.search}`:`${a}${e.pathname}${e.search}`}case"skunkyArt":{if(e.pathname.startsWith("/search"))return`${a}${e.pathname}${e.search}&type=all`;const t=/^\/(.*?)\/art\/(.*)\/?/.exec(e.pathname);if(t)return`${a}/post/${t[1]}/${t[2]}${e.search}`;const n=/^\/([^\/]+)$/.exec(e.pathname);if(n)return`${a}/group_user?q=${n[1]}&type=about`;const r=/^\/(.*?)\/gallery(\/$|$)$/.exec(e.pathname);return r?`${a}/group_user?q=${r[1]}&type=gallery`:`${a}${e.pathname}${e.search}`}case"ytify":{if(e.pathname.startsWith("/watch"))return`${a}/?s=${encodeURIComponent(e.searchParams.get("v"))}`;const t=/\/channel\/([^\/]+)/.exec(e.pathname);return t?`${a}/list?channel=${t[1]}`:e.pathname.startsWith("/playlist")?`${a}/list?playlists=${encodeURIComponent(e.searchParams.get("list"))}`:`${a}${e.pathname}${e.search}`}case"koub":if(e.pathname.startsWith("/view/")||e.pathname.startsWith("/stories/"))return`${a}${e.pathname}${e.search}`;if(/^\/([^\/]+)\/?$/.exec(e.pathname))return`${a}/account${e.pathname}${e.search}`;case"piped":case"pipedMaterial":case"cloudtube":case"lightTube":case"viewtube":e.searchParams.delete("si");default:return`${a}${e.pathname}${e.search}`}}(e,n,c,o)}}async function oe(e){let t=await K.getOptions(),n=await K.getConfig();for(const a in n.services){let r=t[a].frontend;if(null!=t[r]&&(!(t[r].findIndex((t=>e.href.startsWith(t)))<0)||e.href.startsWith(`http://${r}.localhost:8080`)))switch(a){case"youtube":case"imdb":case"imgur":case"tiktok":case"reddit":case"imdb":case"snopes":case"urbanDictionary":case"quora":case"twitter":case"medium":return`${n.services[a].url}${e.pathname}${e.search}`;case"fandom":{let t=e.pathname.match(/^\/([a-zA-Z0-9-]+)\/wiki\/(.*)/);return t?`https://${t[1]}.fandom.com/wiki/${t[2]}`:void 0}case"wikipedia":{const t=e.searchParams.get("lang");return null!=t?`https://${t}.wikipedia.org${e.pathname}${e.search}${e.hash}`:`https://wikipedia.org${e.pathname}${e.search}${e.hash}`}case"stackOverflow":if(e.pathname.startsWith("/questions/"))return`https://stackoverflow.com${e.pathname}${e.search}`;if(e.pathname.startsWith("/exchange/")){const t=/\/exchange\/(.*?)(\/.*)/.exec(e.pathname);if(t)return`https://${t[1]}.stackexchange.com${t[2]}`}return;case"tekstowo":return`${n.services[a].url}/${e.search.slice(1)}`;case"goodreads":return`https://goodreads.com${e.pathname}${e.search}`;default:return}}}window.browser=window.browser||window.chrome,ne(),browser.storage.onChanged.addListener(ne);const ce={materialious:["https://app.materialio.us"],viewtube:["https://viewtube.io"],piped:["https://pipedapi-libre.kavin.rocks"],pipedMaterial:["https://piped-material.xn--17b.net"],cloudtube:["https://tube.cadence.moe"],lightTube:["https://tube.kuylar.dev"],poketube:["https://poketube.fun"],proxiTok:["https://proxitok.pabloferreiro.es"],redlib:["https://safereddit.com"],eddrit:["https://eddrit.com"],scribe:["https://scribe.rip"],libMedium:["https://md.vern.cc"],quetre:["https://quetre.iket.me"],libremdb:["https://libremdb.iket.me"],simplyTranslate:["https://simplytranslate.org"],translite:["https://tl.bloat.cat"],mozhi:["https://mozhi.aryak.me"],searxng:["https://search.bus-hit.me"],"4get":["https://4get.ca"],rimgo:["https://rimgo.vern.cc"],hyperpipe:["https://hyperpipe.surge.sh"],osm:["https://www.openstreetmap.org"],breezeWiki:["https://breezewiki.com"],neuters:["https://neuters.de"],dumb:["https://dm.vern.cc"],intellectual:["https://intellectual.insprill.net"],ruralDictionary:["https://rd.vern.cc"],anonymousOverflow:["https://code.whatever.social"],suds:["https://sd.vern.cc"],unfunny:["https://uf.vern.cc"],soprano:["https://sp.vern.cc"],meme:["https://mm.vern.cc"],waybackClassic:["https://wayback-classic.net"],tent:["https://tent.sny.sh"],wolfreeAlpha:["https://gqq.gitlab.io","https://uqq.gitlab.io"],laboratory:["https://lab.vern.cc"],binternet:["https://bn.bloat.cat"],pixivFe:["https://pixivfe.exozy.me"],liteXiv:["https://litexiv.exozy.me"],indestructables:["https://indestructables.private.coffee"],destructables:["https://ds.vern.cc"],safetwitch:["https://safetwitch.drgns.space"],twineo:["https://twineo.exozy.me"],proxigram:["https://ig.opnxng.com"],tuboYoutube:["https://tubo.migalmoreno.com"],tuboSoundcloud:["https://tubo.migalmoreno.com"],tekstoLibre:["https://davilarek.github.io/TekstoLibre"],skyview:["https://skyview.social"],priviblur:["https://pb.bloat.cat"],nitter:["https://nitter.privacydev.net"],pasted:["https://pasted.drakeerv.com"],freetar:["https://freetar.de"],ratAintTieba:["https://rat.fis.land"],shoelace:["https://shoelace.mint.lgbt"],skunkyArt:["https://skunky.bloat.cat"],ytify:["https://ytify.netlify.app"],nerdsForNerds:["https://nn.vern.cc"],koub:["https://koub.clovius.club"]};async function ie(){let e=await K.getConfig(),t={};for(const n in e.services){t[n]={};for(const a in e.services[n].options)t[n][a]=e.services[n].options[a];for(const a in e.services[n].frontends)e.services[n].frontends[a].instanceList&&(t[a]=[])}return t.exceptions={url:[],regex:[]},t.theme="detect",t.popupServices=["youtube","tiktok","imgur","reddit","quora","translate","maps"],t.fetchInstances="github",t.redirectOnlyInIncognito=!1,t={...t,...ce},t}var he={redirect:se,redirectAsync:async function(e,t,n,a,r,s){return await ne(),se(e,t,n,a,r,s)},computeServiceFrontend:async function(e){const t=await K.getConfig(),n=await K.getOptions();for(const a in t.services){if(re(a,e,t,n))return{service:a,frontend:null};for(const r in t.services[a].frontends){const s=ae(a,r,n,t).findIndex((t=>e.href.startsWith(t)));if(s>=0)return{service:a,frontend:r}}}},reverse:oe,initDefaults:function(){return new Promise((e=>{browser.storage.local.clear((async()=>{te=await ie(),browser.storage.local.set({options:te},(()=>e()))}))}))},processUpdate:function(e){return new Promise((async t=>{const n=await K.getConfig();let a=e??await K.getOptions();const r=await ie();for(const e in a)if(e in r){if("object"==typeof e&&null!==e)for(const t in a[e])t in r[e]||delete a[e][t]}else delete a[e];a.popupServices=a.popupServices.filter((e=>e in n.services));for(const[e,t]of Object.entries(r))e in a||(a[e]=t);for(const[e,t]of Object.entries(n.services)){a[e].frontend in t.frontends||(a[e]=t.options);for(const n in t.options)n in a[e]||(a[e][n]=t.options[n])}browser.storage.local.clear((()=>{browser.storage.local.set({options:a},(()=>{t(a)}))}))}))},copyRaw:async function(e){const t=await oe(e);if(t)if(V){var n=document.createElement("textarea");n.textContent=t,document.body.appendChild(n),n.select(),document.execCommand("copy"),n.blur(),document.body.removeChild(n)}else navigator.clipboard.writeText(t)},switchInstance:function(e,t){return new Promise((async n=>{let a=await K.getOptions(),r=await K.getConfig();if(K.protocolHost(e),t){const r=a[a[t].frontend];if(void 0!==r){const t=K.getNextInstance(e.origin,r);if(t)return n(`${t}${e.pathname}${e.search}`)}}else for(const t in r.services){let r=a[a[t].frontend];if(void 0===r)continue;const s=r.findIndex((t=>e.href.startsWith(t)));if(s<0)continue;if(r.splice(s,1),0===r.length)return n();const o=K.getNextInstance(e.origin,r);if(o)return n(`${o}${e.pathname}${e.search}`)}n()}))},isException:function(e){if(!te)return!1;if(!te.exceptions)return!1;let t=te.exceptions;if(t&&e){if(t.url)for(let n of t.url)if(n=new URL(n),n=n.href.replace(/^http:\/\//,"https://"),n==e.href)return!0;if(t.regex)for(const n of t.regex)if(new RegExp(n).test(e.href))return!0}return!1}};const ue=[];function pe(t,n=e){let a;const r=new Set;function s(e){if(o(t,e)&&(t=e,a)){const e=!ue.length;for(const e of r)e[1](),ue.push(e,t);if(e){for(let e=0;e<ue.length;e+=2)ue[e][0](ue[e+1]);ue.length=0}}}return{set:s,update:function(e){s(e(t))},subscribe:function(o,c=e){const i=[o,c];return r.add(i),1===r.size&&(a=n(s)||e),o(t),()=>{r.delete(i),0===r.size&&a&&(a(),a=null)}}}}const le=pe(null),me=pe(null),$e=pe("general");function fe(e){let n,a,r,s;const o=e[3].default,i=function(e,t,n,a){if(e){const r=c(e,t,n,a);return e[0](r)}}(o,e,e[2],null);let h=[e[0],e[1]],u={};for(let e=0;e<h.length;e+=1)u=t(u,h[e]);return{c(){n=m("button"),i&&i.c(),w(n,u),v(n,"svelte-efu498",!0)},m(t,o){p(t,n,o),i&&i.m(n,null),n.autofocus&&n.focus(),a=!0,r||(s=function(e,t,n,a){return e.addEventListener(t,n,a),()=>e.removeEventListener(t,n,a)}(n,"click",e[4]),r=!0)},p(e,[t]){i&&i.p&&(!a||4&t)&&function(e,t,n,a,r,s){if(r){const o=c(t,n,a,s);e.p(o,r)}}(i,o,e,e[2],a?function(e,t,n,a){if(e[2]&&a){const r=e[2](a(n));if(void 0===t.dirty)return r;if("object"==typeof r){const e=[],n=Math.max(t.dirty.length,r.length);for(let a=0;a<n;a+=1)e[a]=t.dirty[a]|r[a];return e}return t.dirty|r}return t.dirty}(o,e[2],t,null):function(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}(e[2]),null),w(n,u=j(h,[1&t&&e[0],2&t&&e[1]])),v(n,"svelte-efu498",!0)},i(e){a||(A(i,e),a=!0)},o(e){N(i,e),a=!1},d(e){e&&l(n),i&&i.d(e),r=!1,s()}}}function de(e,n,a){const r=[];let s=h(n,r),{$$slots:o={},$$scope:c}=n;return e.$$set=e=>{a(1,n=t(t({},n),i(e))),a(0,s=h(n,r)),"$$scope"in e&&a(2,c=e.$$scope)},n=i(n),[s,n,c,o,function(t){_.call(this,e,t)}]}class ge extends B{constructor(e){super(),X(this,e,de,fe,o,{})}}function be(n){let a,r,s=[n[0],{xmlns:"http://www.w3.org/2000/svg"},{height:"20px"},{viewBox:"0 -960 960 960"},{width:"20px"},{fill:"currentColor"}],o={};for(let e=0;e<s.length;e+=1)o=t(o,s[e]);return{c(){a=$("svg"),r=$("path"),g(r,"d","M144-144v-178l342-342-54-53 51-51 72 72 110.22-110.22q4.45-4.45 11.11-7.11Q683-816 691-816t15 2.5q7 2.5 12 7.5l87 88q4.55 5.83 7.27 12.64 2.73 6.8 2.73 14.58t-2.66 14.44q-2.67 6.66-7.11 11.1L696-556l72 73-51 51-54-54-341 342H144Zm72-72h76l320-320-75-76-321 320v76Zm424-385 90-91-38-39-91 90 39 40Zm0 0-39-40 39 40Z"),y(a,o)},m(e,t){p(e,a,t),u(a,r)},p(e,[t]){y(a,o=j(s,[1&t&&e[0],{xmlns:"http://www.w3.org/2000/svg"},{height:"20px"},{viewBox:"0 -960 960 960"},{width:"20px"},{fill:"currentColor"}]))},i:e,o:e,d(e){e&&l(a)}}}function we(e,n,a){const r=[];let s=h(n,r);return e.$$set=e=>{n=t(t({},n),i(e)),a(0,s=h(n,r))},[s]}class ye extends B{constructor(e){super(),X(this,e,we,be,o,{})}}function ve(t){let n;return{c(){n=m("p"),n.textContent="Loading..."},m(e,t){p(e,n,t)},p:e,i:e,o:e,d(e){e&&l(n)}}}function xe(e){let t,n,a,r;const s=[Pe,ke],o=[];return~(n=function(e){return"disabled"==e[5].get("message")?0:"no_instance"==e[5].get("message")?1:-1}(e))&&(a=o[n]=s[n](e)),{c(){t=m("div"),a&&a.c(),g(t,"class","main svelte-14zc8ex"),g(t,"dir","auto"),g(t,"style",e[2])},m(e,a){p(e,t,a),~n&&o[n].m(t,null),r=!0},p(e,n){a&&a.p(e,n),(!r||4&n)&&g(t,"style",e[2])},i(e){r||(A(a),r=!0)},o(e){N(a),r=!1},d(e){e&&l(t),~n&&o[n].d()}}}function ke(e){let t,n,a,r,s;return r=new ge({props:{disabled:e[3],$$slots:{default:[_e]},$$scope:{ctx:e}}}),r.$on("click",e[10]),{c(){t=m("div"),n=m("h1"),n.textContent="You have no instance selected for this frontend",a=d(),D(r.$$.fragment)},m(e,o){p(e,t,o),u(t,n),u(t,a),Z(r,t,null),s=!0},p(e,t){const n={};8&t&&(n.disabled=e[3]),16384&t&&(n.$$scope={dirty:t,ctx:e}),r.$set(n)},i(e){s||(A(r.$$.fragment,e),s=!0)},o(e){N(r.$$.fragment,e),s=!1},d(e){e&&l(t),H(r)}}}function Pe(e){let t,n,a,r,s;return r=new ge({props:{$$slots:{default:[Ie]},$$scope:{ctx:e}}}),r.$on("click",e[9]),{c(){t=m("div"),n=m("h1"),n.textContent="You disabled redirections for this service",a=d(),D(r.$$.fragment)},m(e,o){p(e,t,o),u(t,n),u(t,a),Z(r,t,null),s=!0},p(e,t){const n={};16384&t&&(n.$$scope={dirty:t,ctx:e}),r.$set(n)},i(e){s||(A(r.$$.fragment,e),s=!0)},o(e){N(r.$$.fragment,e),s=!1},d(e){e&&l(t),H(r)}}}function _e(t){let n,a,r,s,o=(t[4].i18n.getMessage("autoPickInstance")||"Auto Pick Instance")+"";return n=new ye({props:{class:"margin margin_"+document.body.dir}}),{c(){D(n.$$.fragment),a=d(),r=f(o)},m(e,t){Z(n,e,t),p(e,a,t),p(e,r,t),s=!0},p:e,i(e){s||(A(n.$$.fragment,e),s=!0)},o(e){N(n.$$.fragment,e),s=!1},d(e){H(n,e),e&&l(a),e&&l(r)}}}function Ie(t){let n,a=(t[4].i18n.getMessage("enable")||"Enable")+"";return{c(){n=f(a)},m(e,t){p(e,n,t)},p:e,d(e){e&&l(n)}}}function qe(e){let t,n,a,s;const o=[xe,ve],c=[];function i(e,t){return e[0]&&e[1]?0:1}return t=i(e),n=c[t]=o[t](e),{c(){n.c(),a=f("")},m(e,n){c[t].m(e,n),p(e,a,n),s=!0},p(e,[s]){let h=t;t=i(e),t===h?c[t].p(e,s):(U={r:0,c:[],p:U},N(c[h],1,1,(()=>{c[h]=null})),U.r||r(U.c),U=U.p,n=c[t],n?n.p(e,s):(n=c[t]=o[t](e),n.c()),A(n,1),n.m(a.parentNode,a))},i(e){s||(A(n),s=!0)},o(e){N(n),s=!1},d(e){c[t].d(e),e&&l(a)}}}function Ce(e,t,n){const a=window.browser||window.chrome;let r;const s=le.subscribe((e=>{e&&(n(0,r=e),a.storage.local.set({options:e}))}));let o;const c=me.subscribe((e=>n(1,o=e)));var i;let h;i=()=>{s(),c()},P().$$.on_destroy.push(i),function(e){P().$$.on_mount.push(e)}((async()=>{let e=await K.getOptions();e||(await he.initDefaults(),e=await K.getOptions()),le.set(e),me.set(await K.getConfig())})),$e.subscribe((e=>e));let u=!1;const p=new URLSearchParams(window.location.search),l=new URL(p.get("url"));async function m(){n(3,u=!0);const e=p.get("frontend"),t=(await K.getList(r))[e].clearnet,a=await K.autoPickInstance(t);r[e].push(a),le.set(r),n(3,u=!1)}async function $(){const e=await he.redirectAsync(l,"main_frame",null,null,!1,!0);a.tabs.update({url:e})}return e.$$.update=()=>{1&e.$$.dirty&&r&&n(2,h=K.style(r,window))},[r,o,h,u,a,p,l,m,$,async()=>{const{service:e}=await he.computeServiceFrontend(l);n(0,r[e].enabled=!0,r),le.set(r),await $()},async()=>{await m(),await $()}]}const We=new class extends B{constructor(e){super(),X(this,e,Ce,qe,o,{})}}({target:document.body});return We}();
//# sourceMappingURL=bundle.js.map
