import{a as k,b as R,g as V,h as x}from"../chunks/chunk-YX6UES3I.js";import"../chunks/chunk-UP7HC4SX.js";import"../chunks/chunk-OAYN3TMF.js";import"../chunks/chunk-4GQADNUW.js";import{a as M}from"../chunks/chunk-J5TTZZA2.js";import{a as K}from"../chunks/chunk-5VY5EMKN.js";import{a as z,b as v}from"../chunks/chunk-4DY7Q7SZ.js";import{a as L}from"../chunks/chunk-RIL6IOBV.js";import{a as N,b as h}from"../chunks/chunk-IJLSJJ7U.js";import{a as F}from"../chunks/chunk-W32UHEZE.js";import"../chunks/chunk-HGJD3ZUF.js";import"../chunks/chunk-IQFNOK3G.js";import"../chunks/chunk-FVPQGETT.js";import"../chunks/chunk-Z64FBUPL.js";import"../chunks/chunk-KWDMUJJA.js";import"../chunks/chunk-MT4LVDUX.js";import"../chunks/chunk-WN4MFSKN.js";import"../chunks/chunk-7S3YJSN5.js";import"../chunks/chunk-BODFWMPN.js";import{L as q}from"../chunks/chunk-LADTODTA.js";import{a as Y}from"../chunks/chunk-O4TFJKJQ.js";import{B as S,c as d,d as b,r as g,v as w,w as P,x as D}from"../chunks/chunk-WRHUMLYF.js";import"../chunks/chunk-AC7VHEB5.js";import"../chunks/chunk-HY2GWXPO.js";import"../chunks/chunk-XSKOAVIS.js";import{J as l,K as W,q as E}from"../chunks/chunk-OEPSEZ5A.js";import"../chunks/chunk-XERCZVWP.js";import"../chunks/chunk-AT6M4CEW.js";import{e as C}from"../chunks/chunk-3GYLW4KZ.js";var H=C(Y()),a=C(E()),c=C(z());var s=C(E());W();var U=(e,r)=>D("deweyPriceComparisonWithoutNotif",{priceComparisonKey:e,product:r});var y,T,j=250,$=2500;function G(e){return e.url}async function J(e){let r=e?.pageTypeBehaviors;if(r?.notifPlacementSelectors?.length||r?.deweyPCThreshold){let p=r?.notifPlacementSelectors||[],f=r?.deweyPCThreshold||$;return{runOptions:{input:{}},buttonOptions:p.length&&{insertAfterElement:p.map(({value:t})=>t)},priceThresholdCents:f}}let o=s.default.get(await R({domain:e?.domain}),"config",{}),i=o.CUT_OFF_PRICE_FOR_PRICE_RUN_IN_CENTS;return{...o,priceThresholdCents:i||$}}function Q(e,r){return e.price?k(e.price,r,"disable_universal_price_run")?!1:{priceComparisonKey:G(e)}:(l(["Dewey PC - unable to retrieve the origin product price."]),!1)}function B(e){try{T||(T=s.default.debounce(X,j)),T(e)}catch(r){l([r])}}async function X(e){try{if(!(!M()&&g("dewey_price_comparison")&&s.default.get(e,"pageTypeBehaviors.deweyPC",!1))||s.default.get(e,"domain")==="amazon.com")return;let o=s.default.cloneDeep(s.default.get(e,"pageData.products[0]",{}));o.vendor=s.default.get(e,"domain"),o.price=o.list_price,o.mpn=o.manufacturer_number,delete o.list_price,delete o.manufacturer_number;let i=await J(e),p=Q(o,i?.priceThresholdCents);if(!i||!i?.buttonOptions)return g("dewey_price_comparison_silent")&&p&&U(p.priceComparisonKey,o);if(!p){y="",q(V);return}let{priceComparisonKey:t}=p;if(t===y){l([`*** Skipping dewey price comparison already in progress for request - ${t} ***`]);return}l([`*** Starting dewey price comparison. Request - ${t} ***`]),y=t,b({active:!0}),i.runOptions.input.product=o;let n;s.default.forEach(i.buttonOptions.insertAfterElement,m=>{if(n=document.querySelector(m),n)return!1}),i.buttonOptions.insertAfterElement=n,s.default.set(i.runOptions.input,"meta.conquestOrigin",!0),s.default.set(i.runOptions.input,"meta.simpleOriginPricing",!0),s.default.set(i.runOptions.input,"deweyPC",!0),x({...i.buttonOptions,removeExistingApp:!0},{...i.runOptions,runCompleteCb:()=>{y&&y===t&&(y="",l([`*** Request - ${t} - completed ***`,"*** Active Dewey price comparison was reset. ***"]))}})}catch(r){l([r])}}var A=e=>(B(e),D("deweyResult",e));window.__wb_timing.deweyRequireAt=performance.now();async function Z(){await Promise.all([L(),F()]).then(([e,r])=>{K(e),d.merge({siteAPIData:r})}),g("ext_instant_init_notifs")||document.readyState!=="loading"?O():document.addEventListener("DOMContentLoaded",O)}async function O(){let e=d.get("siteAPIData"),r=a.default.get(e,"tld");P(r),e=await I(e)||e;let o=a.default.cloneDeep(e);o.document=document,o.document.deweyParser=H.default,o.document.html=document.documentElement.innerHTML,a.default.set(o,"siteData.tld",o.tld),h.setDefaultConfig(o);let i=g("log_all_dewey"),p=new Date,f=new Set(a.default.map(a.default.get(e,"siteData.tigger.coupons")||a.default.get(e,"siteData.roo.coupons")||[],"code"));h.emitter.on("result",async t=>{let n=await N(t);if(n.callSource==="internal"&&(d.set(["deweyResult"],n),A(n),n?.pageType||i)){let _=new Date-p,u=a.default.cloneDeep(n);u&&u.pageData&&u.pageData.meta&&(u.pageData.meta=[u.pageData.meta]),S("track","deweyResult",a.default.assign({},u,{url:window.location.href,flags:a.default.get(e,"siteData.flags"),logAllDewey:i,totalTimeElapsed:_,deweyAttempt:h.startAttempt}))}a.default.get(n,"pageData.coupons.length")&&a.default.forEach(n.pageData.coupons,m=>{f.has(m)||(S("track","codeApplied",{code:m,currentLocation:a.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])}),f.add(m))})}),h.start()}async function I(e){let r=a.default.get(e,"siteData.coupons.type"),o=await(0,c.getPlatform)({hasFeature:g,desktop:!0}),i=await v(w()),{separatePlatform:p,separatePlatformDomain:f}=(0,c.getSeparateCheckoutDomain)(w()),t=i?"Shopify":o||p,n=i||f||w();if(t&&n){P(n),d.set(["platform"],t),d.set(["platformDomain"],n),e=a.default.has(e,"siteData.tigger")?e:{...e,siteData:{...e.siteData,tigger:{}}},e.siteData.tigger[`${t.toLowerCase()}`]=!0,e.siteData.pageTypesV2=e.siteData.pageTypesV2||{};let{cartPage:m,checkoutPage:_,confirmationPage:u}=e.siteData.pageTypesV2;return new Set(["Magento","WooCommerce","BigCommerce","Squarespace"]).has(t)?(t==="Magento"&&(e.siteData.pageTypesV2.cartPage=m||(0,c.getSiteData)(t,"cartPage")),e.siteData.pageTypesV2.checkoutPage=_||(0,c.getSiteData)(t,"checkoutPage"),e.siteData.pageTypesV2.confirmationPage=u||(0,c.getSiteData)(t,"confirmationPage")):(e.siteData.pageTypesV2.checkoutPage=(0,c.getSiteData)(t,"checkoutPage"),e.siteData.pageTypesV2.confirmationPage=(0,c.getSiteData)(t,"confirmationPage")),(0,c.getSiteData)(t,"roo")&&r!=="roo"&&(e.siteData.roo=(0,c.getSiteData)(t,"roo")),e}}Z();
