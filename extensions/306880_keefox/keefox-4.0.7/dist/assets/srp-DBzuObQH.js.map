{"version":3,"file":"srp-DBzuObQH.js","sources":["../../../src/dialogs/SRP.ts"],"sourcesContent":["import { configManager } from \"../common/ConfigManager\";\nimport { KeeLog } from \"../common/Logger\";\nimport {setup as i18nSetup } from \"../common/i18n\";\n\nclass SrpDialog {\n    public setupPage() {\n        (document.getElementById(\n            \"pref_sl_server\"\n        ) as HTMLSelectElement).value = configManager.current.connSLServerMin.toString();\n        (document.getElementById(\"pref_sl_client_high\") as HTMLInputElement).checked =\n            configManager.current.connSLClient === 3 ? true : null;\n\n        (document.getElementById(\"password\") as HTMLInputElement).addEventListener(\"keyup\", () => {\n            this.updateButtonState();\n        });\n        (document.getElementById(\"pref_sl_server\") as HTMLSelectElement).addEventListener(\n            \"change\",\n            () => {\n                this.updateButtonState();\n            }\n        );\n        (document.getElementById(\"pref_sl_client_high\") as HTMLInputElement).addEventListener(\n            \"change\",\n            () => {\n                this.updateButtonState();\n            }\n        );\n\n        document\n            .getElementById(\"ok\")\n            .addEventListener(\"click\", this.primaryButtonClicked.bind(this));\n        document.getElementById(\"form\").addEventListener(\n            \"submit\",\n            (event => {\n                event.preventDefault();\n                this.primaryButtonClicked();\n            }).bind(this)\n        );\n\n        window.addEventListener(\"beforeunload\", () =>\n            chrome.runtime.sendMessage({ action: \"SRP_ok\", password: \"\" })\n        );\n    }\n\n    updateButtonState() {\n        const passwordSet =\n            (document.getElementById(\"password\") as HTMLInputElement).value.length > 0;\n        const settingsChanged = this.settingsChanged();\n        if (passwordSet && settingsChanged) {\n            document.getElementById(\"ok\").textContent = $STR(\"srp_save_connect\");\n            (document.getElementById(\"ok\") as HTMLButtonElement).disabled = null;\n        } else if (passwordSet && !settingsChanged) {\n            document.getElementById(\"ok\").textContent = $STR(\"srp_connect\");\n            (document.getElementById(\"ok\") as HTMLButtonElement).disabled = null;\n        } else if (!passwordSet && settingsChanged) {\n            document.getElementById(\"ok\").textContent = $STR(\"save\");\n            (document.getElementById(\"ok\") as HTMLButtonElement).disabled = null;\n        } else {\n            document.getElementById(\"ok\").textContent = $STR(\"srp_connect\");\n            (document.getElementById(\"ok\") as HTMLButtonElement).disabled = true;\n        }\n    }\n\n    primaryButtonClicked() {\n        const password = document.getElementById(\"password\") as HTMLInputElement;\n        if (this.settingsChanged()) {\n            const clientHigh = document.getElementById(\"pref_sl_client_high\") as HTMLInputElement;\n            const serverSL = document.getElementById(\"pref_sl_server\") as HTMLSelectElement;\n            configManager.current.connSLClient = clientHigh.checked ? 3 : 2;\n            configManager.current.connSLServerMin = parseInt(serverSL.value);\n            configManager.save().then(this.continueSRP.bind(this, password.value));\n        } else {\n            this.continueSRP(password.value);\n        }\n    }\n\n    settingsChanged() {\n        const clientHigh = document.getElementById(\"pref_sl_client_high\") as HTMLInputElement;\n        const serverSL = document.getElementById(\"pref_sl_server\") as HTMLSelectElement;\n        const clientHighPrevious = configManager.current.connSLClient === 3;\n        return (\n            clientHigh.checked !== clientHighPrevious ||\n            serverSL.value !== configManager.current.connSLServerMin.toString()\n        );\n    }\n\n    async continueSRP(password: string) {\n        const tab = await chrome.tabs.getCurrent();\n        chrome.runtime.sendMessage({\n            action: \"SRP_ok\",\n            password: password\n        });\n        await chrome.tabs.remove(tab.id);\n    }\n}\n\nlet srp: SrpDialog;\n\nasync function setupPage() {\n    await configManager.load();\n    KeeLog.attachConfig(configManager.current);\n    srp = new SrpDialog();\n    srp.setupPage();\n    document.getElementById(\"i18n_root\").style.display = \"block\";\n}\n\nif (document.readyState === \"loading\") {\n    document.addEventListener(\"DOMContentLoaded\", async () => await setupPage());\n} else {\n    (async () => {\n        await setupPage();\n    })();\n}\n\ni18nSetup();\n"],"names":["i18nSetup"],"mappings":"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"}