class DBmanager{constructor(e,t,s,o){this.dbName=e,this.storeName=t,this.version=s||1,this.index=o,this.currentDB=null,this.indexedDBOnOpen=!1,this.DAY_2_KEEP_LOGS=7}openDB(){var e=self.indexedDB.open(this.dbName,this.version);e.onerror=function(e){console.log(e.currentTarget.error.message)}.bind(this),e.onsuccess=function(e){this.currentDB=e.target.result,console.log(this.currentDB.name+" database is already opened!"),this.indexedDBOnOpen=!0}.bind(this),e.onupgradeneeded=function(e){if(console.log("database version is already upgrade to "+this.version),this.currentDB=e.target.result,!this.currentDB.objectStoreNames.contains(this.storeName)){var t=this.currentDB.createObjectStore(this.storeName,{keyPath:"phoneBookName"});this.index&&this.index.length>0&&this.index.forEach((function(e){t.createIndex(e,e)}))}}.bind(this)}getStoreByName(){var e=null;if(this.currentDB&&this.indexedDBOnOpen)try{e=this.currentDB.transaction(this.storeName,"readwrite").objectStore(this.storeName)}catch(e){console.warn("get objectStore error: ",e.message)}else console.log("indexedDB is not open now...");return e}setItem(e){var t=this.getStoreByName(this.storeName);t&&(t.add(e),t.onsuccess=function(e){console.log("Data write succeeded")},t.onerror=function(e){console.log("Data write failed")})}setItems(e){var t=this.getStoreByName(this.storeName);if(t)for(var s=0;s<e.length;s++)t.put(e[s])}getItem(e,t){var s=this.getStoreByName(this.storeName);if(s){var o=s.index(e).get(t);o.onsuccess=function(e){o.result?console.log(o.result):console.log("未获得数据记录")}}}getAllItems(e){var t=this.getStoreByName(this.storeName);if(t){var s=t.openCursor(),o=[];s.onsuccess=function(t){var s=t.target.result;s?(o.push(s.value),s.continue()):(console.log("没有更多数据了！"),e?.(o))}}}deleteItems(e=this.DAY_2_KEEP_LOGS){var t=this.getStoreByName(this.storeName);t&&(console.log("delete "+this.currentDB.name+" db data within "+e+" days"),t.openCursor().onsuccess=function(s){var o=s.target.result,r=864e5*e,n=(new Date).getTime();o?n-o.value.TS>=r?(t.delete(o.value.id),o.continue()):console.log("Delete complete."):console.log("Delete complete!")})}update(e){var t=this.getStoreByName(this.storeName);t&&(t.put(e),t.onsuccess=function(e){console.log("data update success")},t.onerror=function(e){console.log("data update failed")})}clear(){var e=this.getStoreByName(this.storeName);if(e){var t=e.clear();t.onsuccess=function(e){console.log("clear Success")},t.onerror=function(e){console.log("clear Error")}}}}self&&(self.DBmanager=DBmanager);export{DBmanager};