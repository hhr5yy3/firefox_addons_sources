const HIDDEN_POSITION="-320px",VISIBLE_POSITION="16px",EMAIL_NO_PROTECTION=".wot-mail-not-protected";class MailOffering extends React.Component{constructor(e){super(e),this.selfCloseTimeoutId=void 0}componentDidMount(){this.handleAutoClose()}componentDidUpdate(){this.handleAutoClose()}handleAutoClose(){this.props.showOffering&&(clearTimeout(this.selfCloseTimeoutId),this.selfCloseTimeoutId=setTimeout(()=>{this.setReminder("self close")},PROMO_SELF_CLOSE_TIMEOUT))}setReminder(e){clearTimeout(this.selfCloseTimeoutId),this.closePromo(),e&&GA("Email Protection","popup",e);var t=this.props;const o=t.nextReminder,i=t.setNextReminder,n=t.incrementViews;o&&i&&n&&(i(o),n())}createLabel(e){return`${e} clicked${this.props.link?"_B_LP":""}`}closePromo(){const e=document.querySelector(EMAIL_NO_PROTECTION);e&&(e.style.right="-320px")}takeTheOffer(){const e="email_protection_clicked_"+(this.props.timesShown+1);if(this.setReminder(),!this.props.link)return goUpgrade("Email Protection","popup",e);window.open(`${this.props.link}?${WOT_PRODUCT}=${e}_B_LP`,"_blank")}render(){return this.props.noShow?React.createElement("span",null):React.createElement("div",{className:"wot-mail-not-protected"},React.createElement("img",{className:"wot-mail-not-protected-envelope",src:webextApi.runtime.getURL("/images/serp-offering-envelope.png"),alt:""}),React.createElement("div",{className:"wot-mail-not-protected-icons"},React.createElement(SvgIcon,{svg:"wot-logo",className:"wot-mail-not-protected-logo"}),React.createElement(SvgIcon,{svg:"mail-serp-cross",className:"wot-mail-not-protected-close",onClick:()=>this.setReminder(this.createLabel("x"))})),React.createElement("div",{className:"wot-mail-not-protected-title"},translate("serpMailWarningOfferTitle")),React.createElement("div",{className:"wot-mail-not-protected-text"},translate("serpMailWarningOfferContent")),React.createElement("div",{className:"wot-mail-not-protected-action1",onClick:()=>this.takeTheOffer()},translate("whatsNewWOTLearnMore")),React.createElement("div",{className:"wot-mail-not-protected-action2",onClick:()=>this.setReminder(this.createLabel("btn"))},translate("serpMailWarningOfferAction2")))}}let wotMailTimeoutId=0;function setAdPosition(e){clearTimeout(wotMailTimeoutId),wotMailTimeoutId=0;const t=document.querySelector(EMAIL_NO_PROTECTION);t&&(t.style.right=e?"16px":"-320px",e&&GA("Email Protection","popup","shown"))}function shouldShowAd(e,t,o){return!(e>=t)&&("visible"===document.visibilityState&&!(o&&o>Date.now()))}function mapStateToProps(e){if(!isContentScriptConnected())return{noShow:!0};const t=!e.user.isPremiumUser;var o=e.remoteConfig.features.emailProtection||{},i=o.maxPrompts;const n=void 0===i?3:i;var s=o.options;const r=void 0===s?[{link:""}]:s,a=e.emailProtection.timesShown,l=calculateNextReminder(e.remoteConfig.features.emailProtection.name,e),c=e.reminders[SCHEDULER_TYPES.EMAIL_PROTECTION],m=t&&shouldShowAd(a,n,c);return!wotMailTimeoutId&&(wotMailTimeoutId=setTimeout(setAdPosition,m?500:0,m)),{link:r[0].link||"",nextReminder:l,timesShown:a,showOffering:m}}function mapDispatchToProps(e){return{setNextReminder:t=>e(setReminder(SCHEDULER_TYPES.EMAIL_PROTECTION,t)),incrementViews:()=>e(incrementEmailAdViews())}}MailOffering=ReactRedux.connect(mapStateToProps,mapDispatchToProps)(MailOffering);