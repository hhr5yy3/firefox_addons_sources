"use strict";(self.webpackChunk_dashlane_leeloo=self.webpackChunk_dashlane_leeloo||[]).push([[9903],{82994:(e,t,i)=>{i.d(t,{s:()=>S}),i(96832);var a=i(61468),n=i(8180),s=i(51031),o=i(25792),r=i(88203);let l=function(e){return e.LastAdmin="LastAdmin",e.GroupSharing="GroupSharing",e.CollectionSharing="CollectionSharing",e.Generic="Generic",e}({});var c=i(65580),d=i(68593);const u=({reason:e,translations:t,goToSharingAccess:i,closeCantDeleteDialog:n})=>{const{translate:s}=(0,r.Z)(),o=((e,t)=>{const{groupSharingTitle:i,lastAdminTitle:a,collectionSharingTitle:n,genericErrorTitle:s}=e;switch(t){case l.LastAdmin:return a;case l.GroupSharing:return i;case l.CollectionSharing:return n;case l.Generic:return s;default:return(0,c.U)(t)}})(t,e),u=((e,t)=>{const{groupSharingSubtitle:i,lastAdminSubtitle:a,collectionSharingSubtitle:n,genericErrorSubtitle:s}=e;switch(t){case l.LastAdmin:return a;case l.GroupSharing:return i;case l.CollectionSharing:return n;case l.Generic:return s;default:return(0,c.U)(t)}})(t,e);return(0,d.tZ)(a.Vq,{isOpen:!0,onClose:n,title:null!=o?o:"",closeActionLabel:s("_common_dialog_dismiss_button"),actions:e===l.LastAdmin||l.GroupSharing||l.CollectionSharing?{primary:{children:t.lastAdminActionLabel,onClick:()=>{i(),n()}}}:void 0,children:u})};var m=i(37527);const h=({closeConfirmDeleteDialog:e,onDeleteConfirm:t,translations:i})=>{const{translate:n}=(0,r.Z)(),{confirmDeleteSubtitle:s,confirmDeleteTitle:o,confirmDeleteDismiss:l,confirmDeleteConfirm:c}=i;return(0,d.tZ)(a.Vq,{title:o,onClose:e,isOpen:!0,dialogClassName:m.Ht,closeActionLabel:n("_common_dialog_dismiss_button"),isDestructive:!0,actions:{primary:{children:c,onClick:t,id:"deletion-dialog-confirm-button"},secondary:{children:l,onClick:e,autoFocus:!0,id:"deletion-dialog-dismiss-button"}},children:s})},S=({closeConfirmDeleteDialog:e,goToSharingAccess:t,isVisible:i,itemId:c,onDeletionSuccess:m,sharingStatus:S,translations:g,vaultItemType:p,isShared:_,isSharedViaUserGroup:b,isItemInCollection:C,isLastAdmin:I})=>{const{showToast:D}=(0,a.pm)(),{translate:A}=(0,r.Z)(),{deleteVaultItem:f}=(0,n.u)(o.L);if(!i)return null;let y;return(_||S?.isShared)&&(b&&(y=l.GroupSharing),I&&(y=l.LastAdmin),C&&(y=l.CollectionSharing)),y&&t?(0,d.tZ)(u,{reason:y,translations:g,goToSharingAccess:t,closeCantDeleteDialog:e}):(0,d.tZ)(h,{closeConfirmDeleteDialog:e,onDeleteConfirm:async()=>{try{var e;(await f({id:c,vaultItemType:p})).tag===s.rq.Success?(D({description:null!=(e=g.deleteSuccessToast)?e:A("webapp_personal_info_edition_delete_success_toast")}),m()):D({description:A("_common_generic_error"),mood:"danger",isManualDismiss:!0})}catch(e){D({description:A("_common_generic_error"),mood:"danger",isManualDismiss:!0})}},translations:g})}},64676:(e,t,i)=>{i.r(t),i.d(t,{SecureNotesEdit:()=>X});var a=i(96832),n=i(15192),s=i(24507),o=i(51031),r=i(25792),l=i(39431),c=i(92077),d=i(34557),u=i(89078),m=i(65455),h=i(8180),S=i(48062),g=i(14900),p=i(78346),_=i(5465),b=i(88203),C=i(45272),I=i(77063),D=i(86498),A=i(63520),f=i(82994),y=i(86541),T=i(30743),w=i(32021),v=i(99822),L=i(30894),N=i(73157),E=i(99193),Z=i(20684),U=i(79808),F=i(1639),G=i(85163),O=i(95727),R=i(49199),V=i(68593);const{CONTENT:q,DOCUMENT_STORAGE:P,MORE_OPTIONS:k,SHARED_ACCESS:M}=y.SecureNoteTabs,H=(0,L.DP)((({note:e,isShared:t,canChangeRoles:i,canEdit:n,canShare:s,isSharedViaUserGroup:d,isLastAdmin:u,onClose:m})=>{var L,H;const{translate:B}=(0,b.Z)(),{routes:X}=(0,c.Xo)(),x=(0,c.TH)(),z=(0,a.useRef)(!1),{updateVaultItem:Q}=(0,h.u)(r.L),{showAlert:W}=(0,D.V)(),{shouldShowFrozenStateDialog:K}=(0,I.Ub)(),{addNoteToCollections:Y}=(0,G.Q)(),{allCollections:$}=(0,O.bA)(),[j,J]=(0,a.useState)(q),[ee,te]=(0,a.useState)(!1),[ie]=(0,a.useState)(null),[ae,ne]=(0,a.useState)(!1),[se,oe]=(0,a.useState)(!1),[re,le]=(0,a.useState)(!1),[ce,de]=(0,a.useState)(!1),[ue,me]=(0,a.useState)(e.isSecured),[he,Se]=(0,a.useState)(e.content),[ge,pe]=(0,a.useState)(e.title),[_e,be]=(0,a.useState)(e.color),[Ce,Ie]=(0,a.useState)(e.spaceId),[De,Ae]=(0,a.useState)(!1),[fe,ye]=(0,a.useState)([]),[Te,we]=(0,a.useState)(!1),{data:ve,status:Le}=(0,U.r)(e.id),Ne=()=>W(B("_common_generic_error"),g.BLW.ERROR),Ee=()=>{z.current||(z.current=!0,(0,Z.P)(),x.pathname.includes(X.userSecureNotes)&&(0,C.Nc)(S.PageView.ItemSecureNoteList),m())},Ze=async(t=!0)=>{le(!0);const i=null!=ie?ie:{spaceId:Ce,type:_e,category:e.categoryId,secured:ue};try{var a;const t=await Q({vaultItemType:l.U.SecureNote,content:{content:he,title:ge,id:e.id,attachments:[...null!=(a=e.attachments)?a:[]],...i},id:e.id});Y(e.id,fe),(0,p.hx)(t)&&Ne()}catch(e){Ne()}le(!1),t?Ee():te(!1)},Ue=()=>{de(!0)},Fe=async t=>{de(!1),t.success&&(await _.C.commitSecureFile({secureFileInfo:t.secureFileInfo}),e.attachments?.push((0,E.w)(t.secureFileInfo)),Ze(!1))},Ge=()=>te(!0),Oe=(0,R.vN)(S.ItemType.SecureNote,Ne),Re=$.filter((t=>t.vaultItems.some((t=>t.id===e.id)))),Ve=Re.length||fe.length,qe=!!e.attachments&&e.attachments.length>0,Pe=!Ve,ke=[q];t?ke.push(M):Pe&&ke.push(P);const Me={confirmDeleteConfirm:B("webapp_secure_notes_edition_delete_confirm"),confirmDeleteDismiss:B("webapp_credential_edition_delete_dismiss"),confirmDeleteSubtitle:B("webapp_credential_edition_confirm_delete_subtitle"),confirmDeleteTitle:B("webapp_secure_notes_edition_delete_title"),lastAdminActionLabel:B("webapp_credential_edition_change_permissions"),lastAdminTitle:B("webapp_credential_edition_last_admin_title"),lastAdminSubtitle:B("webapp_credential_edition_last_admin_subtitle"),groupSharingTitle:B("webapp_secure_notes_edition_group_sharing_title"),groupSharingSubtitle:B("webapp_credential_edition_group_sharing_subtitle"),collectionSharingTitle:B("webapp_credential_edition_collection_sharing_title"),collectionSharingSubtitle:B("webapp_credential_edition_collection_sharing_subtitle"),genericErrorTitle:"webapp_account_recovery_generic_error_title",genericErrorSubtitle:"webapp_account_recovery_generic_error_subtitle"},He={attachments:null!=(L=e.attachments)?L:[],category:e.categoryId?e.categoryId:"noCategory",content:e.content,id:e.id,secured:e.isSecured,spaceId:e.spaceId,title:e.title,type:e.color},Be=e=>t=>{Ge(),e(t)},Xe=Be(Ie),xe=Be(be),ze=Be(pe),Qe=Be(Se),We=Be(me),Ke=t&&Le===o.rq.Success&&null!=(Ye=ve?.count)?Ye:0;var Ye;const $e=Re.filter((e=>e.isShared)).length>0;return(0,V.BX)(A.zI,{isViewingExistingItem:!0,submitDisabled:De,itemHasBeenEdited:ee,onSubmit:()=>{Ze()},isUsingNewDesign:!0,submitPending:re,secondaryActions:(()=>{switch(j){case q:return[(a=e,!a||t&&!s||a.attachments?.length?null:(0,V.tZ)(F.Z,{tooltipPlacement:"top-start",sharing:(i=e.id,(0,v.A1)(i)),text:B("webapp_sharing_invite_share"),origin:S.Origin.ItemDetailView},"shareaction"))];case P:return[(0,V.tZ)(N.d,{isQuotaReached:!1,onFileUploadStarted:Ue,onFileUploadDone:Fe,isShared:t,itemId:e.id,dataType:"KWSecureNote",disabled:!!K},"uploadAction")];default:return[]}var i,a})(),onNavigateOut:Ee,onClickDelete:()=>ne(!0),ignoreCloseOnEscape:ae||se,isSomeDialogOpen:ae||Te,formId:"edit_securenote_panel",header:(0,V.tZ)(T.h,{backgroundColor:He.type,displayDocumentStorage:ke.includes(P),displaySharedAccess:ke.includes(M),displayMoreOptions:ke.includes(k),isSecured:ue,recipientsCount:Ke,attachmentsCount:null!=(H=e?.attachments?.length)?H:0,setActiveTab:J,disabled:t&&!n,title:ge,setTitle:ze}),children:[(0,V.tZ)(w.T,{activeTab:j,data:He,content:null!=he?he:"",title:ge,color:_e,spaceId:Ce,isDisabled:!!K,isSecured:ue,onSpaceIdChange:Xe,onColorChange:xe,onTitleChange:ze,onContentChange:Qe,onIsSecuredChange:We,onIsSubmitDisabled:Ae,handleFileInfoDetached:t=>{e.attachments=e.attachments?.filter((e=>e.id!==t)),Ze(!1)},hasAttachment:qe,canEdit:n,canChangeRoles:i,isShared:t,isUploading:ce,onModifyData:Ge,onModalDisplayStateChange:oe,onCollectionsToUpdate:ye,setHasDialogsOpenedByChildren:we}),(0,V.tZ)(f.s,{isVisible:ae,itemId:e.id,closeConfirmDeleteDialog:()=>ne(!1),goToSharingAccess:()=>{J(y.SecureNoteTabs.SHARED_ACCESS)},onDeletionSuccess:async()=>{e.attachments?.forEach((async e=>{const{id:t}=e;Oe(t)})),Ee()},isLastAdmin:u,isShared:t,isSharedViaUserGroup:d,isItemInCollection:$e,translations:Me,vaultItemType:l.U.SecureNote})]})})),B=({note:e,onClose:t})=>{const{getPermissionForItem:i,getSharingStatusForItem:a,getIsLastAdminForItem:n}=(0,u.Y)(m.X,{getPermissionForItem:{queryParam:{itemId:e.id}},getSharingStatusForItem:{queryParam:{itemId:e.id}},getIsLastAdminForItem:{queryParam:{itemId:e.id}}},[]);if(i.status!==o.rq.Success||a.status!==o.rq.Success||n.status!==o.rq.Success)return null;const{isShared:s,isSharedViaUserGroup:r}=a.data,l=i.data?.capabilities.canEdit,c=i.data?.capabilities.canChangeRoles,d=i.data?.capabilities.canShare,{isLastAdmin:h}=n.data;return(0,V.tZ)(H,{onClose:t,note:e,isShared:s,canChangeRoles:c,canEdit:l,canShare:d,isSharedViaUserGroup:r,isLastAdmin:h})},X=e=>{const t=(0,s.k)(r.L,"query",{vaultItemTypes:[l.U.SecureNote],ids:[`{${e.match.params.uuid}}`]}),{routes:i}=(0,c.Xo)();return t.status===o.rq.Loading?null:t.data?.secureNotesResult.items.length?(0,V.tZ)(B,{...e,note:t.data.secureNotesResult.items[0]}):e.location?.state?(0,V.tZ)(n.l_,{to:(0,d.rF)(e.location?.state,i)}):(0,V.tZ)(n.l_,{to:i.userSecureNotes})}}}]);