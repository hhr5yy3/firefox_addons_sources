for(var n,aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},t="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,ba=["Array","prototype","fill"],ca=0;ca<ba.length-1;ca++){var da=ba[ca];da in t||(t[da]={});t=t[da]}
var ea=ba[ba.length-1],fa=t[ea],ha=fa?fa:function(a,b,c){var d=this.length||0;0>b&&(b=Math.max(0,d+b));if(null==c||c>d)c=d;c=Number(c);0>c&&(c=Math.max(0,d+c));for(b=Number(b||0);b<c;b++)this[b]=a;return this};ha!=fa&&null!=ha&&aa(t,ea,{configurable:!0,writable:!0,value:ha});
function ia(){var a=[["edge",/Edge\/([0-9\._]+)/],["chrome",/Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+)\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/iPad\;\sCPU\sOS\s([0-9\._]+)/],["ios",/iPhone\;\sCPU\siPhone\sOS\s([0-9\._]+)/],["safari",/Safari\/([0-9\._]+)/]],b,c=[];
for(b=0;b<a.length;b++){var d=b;var f=a[b];f=f.concat(f[1].exec(navigator.userAgent));a[d]=f;a[b][2]&&c.push(a[b])}for(b=(a=c[0])&&a[3].split(/[._]/).slice(0,3);b&&3>b.length;)b.push("0");c={};c.name=a&&a[0];c.version=b&&b.join(".");c.versionInt=parseInt(c.version,10);return c};function ja(a){function b(){d||(d=$("<div></div>").css({position:"absolute",top:-9999,left:-9999,width:"auto",height:"auto",padding:0,margin:0,webkitTransform:c.css("webkitTransform"),webkitTransformOrigin:c.css("webkitTransformOrigin"),resize:"none"}).appendTo(document.getElementsByTagName("body")[0]));d.css({fontSize:c.css("fontSize"),fontFamily:c.css("fontFamily"),lineHeight:c.css("lineHeight")});var b=a.value.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/$/,"&nbsp;").replace(/\n/g,
"&nbsp;<br/>").replace(/\s/g,"&nbsp;"),e=b.split("<br/>").length-1;d.html(b);c.css({width:d.width()+f+"px"});c.attr("rows",e+2)}var c=$(a),d=null,f=Number.parseInt(c.css("font-size"));c.css({overflow:"hidden"});c.keyup(b).keydown(b).keypress(b).change(b).change()};function w(a,b){this.x=this.y=0;"undefined"!==typeof a&&"undefined"!==typeof b&&(this.x=a,this.y=b)}w.prototype.isEqual=function(a){return this.x===a.x&&this.y===a.y};function y(a,b){this.c=this.b=0;"undefined"!==typeof a&&"undefined"!==typeof b&&(this.c=a,this.b=b)}y.prototype.isEqual=function(a){return this.c===a.c&&this.b===a.b};
function G(a,b){this.x=this.c=this.y=this.b=0;a&&("undefined"!==typeof a.T&&"undefined"!==typeof a.V&&"undefined"!==typeof a.U&&"undefined"!==typeof a.W?(this.x=Math.min(a.T,a.U),this.c=Math.abs(a.U-a.T),this.y=Math.min(a.V,a.W),this.b=Math.abs(a.W-a.V)):"undefined"!==typeof a.x&&"undefined"!==typeof a.y&&"undefined"!==typeof a.c&&"undefined"!==typeof a.b?(this.x=a.x,this.c=a.c,this.y=a.y,this.b=a.b):"undefined"!==typeof a.left&&"undefined"!==typeof a.top&&"undefined"!==typeof a.right&&"undefined"!==
typeof a.bottom?(this.x=a.left,this.c=a.right-a.left,this.y=a.top,this.b=a.top-a.bottom):"undefined"!==typeof a.x&&"undefined"!==typeof a.y&&"undefined"!==typeof b.c&&"undefined"!==typeof b.b&&(this.x=a.x,this.c=b.c,this.y=a.y,this.b=b.b))}function ka(a,b,c){b=null==b?1:b;c=null==c?b:c;a.x-=b;a.y-=c;a.c+=2*b;a.b+=2*c}function H(a,b){return b.x>=a.x&&b.x<=a.x+a.c&&b.y>=a.y&&b.y<=a.y+a.b}function la(a,b){return H(a,ma(b))&&H(a,I(b))&&H(a,K(b))&&H(a,L(b))}
function na(a,b){var c=a.x,d=a.y,f=b.x,m=b.y;var e=c+a.c;a=d+a.b;var g=f+b.c;b=m+b.b;c<f&&(c=f);d<m&&(d=m);e>g&&(e=g);a>b&&(a=b);e-=c;a-=d;return 0<e&&0<a?new G({x:c,y:d,c:e,b:a}):new G}G.prototype.isEqual=function(a){a=new G(a);return this.x===a.x&&this.y===a.y&&this.c===a.c&&this.b===a.b};G.prototype.A=function(){return 0===this.c||0===this.b};function ma(a){return new w(a.x,a.y)}function I(a){return new w(a.x+a.c,a.y)}function K(a){return new w(a.x,a.y+a.b)}
function L(a){return new w(a.x+a.c,a.y+a.b)}G.prototype.size=function(){return new y(this.c,this.b)};function oa(a,b){if(la(b,a)){var c=b.b/2,d=a.b/2;a.x=b.x+b.c/2-a.c/2;a.y=b.y+c-d}}
var M={Ka:function(a,b){return new G({x:Math.min(a.x,b.x),y:Math.min(a.y,b.y),c:Math.abs(a.x-b.x),b:Math.abs(a.y-b.y)})},K:function(a,b){return new G({T:a.x-b,V:a.y-b,U:a.x+b,W:a.y+b})},bb:function(a,b,c){return a.x==b.x?new G({T:Math.min(a.x,c.x),U:Math.max(a.x,c.x),V:Math.min(a.y,b.y),W:Math.max(a.y,b.y)}):new G({T:Math.min(a.x,b.x),U:Math.max(a.x,b.x),V:Math.min(a.y,c.y),W:Math.max(a.y,c.y)})}};var pa={ma:function(a){return a+Math.random()},sb:function(a){for(var b=a.length,c,d;0!==b;)d=Math.floor(Math.random()*b),--b,c=a[b],a[b]=a[d],a[d]=c;return a},rb:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)}},qa={Va:function(a){var b=window.location.href;b=b.substring(b.indexOf("?")+1);-1!=b.indexOf("#")&&(b=b.split("#")[1]);b=b.split("&");for(var c=0;c<b.length;c++){var d=b[c].split("=");if(1<d.length&&d[0]==a)return d[1]}return null}},N={na:function(a){a=/matrix\([^\)]+\)/.exec(window.getComputedStyle(a)["-webkit-transform"]);
var b={x:1,y:1};a&&(a=a[0].replace("matrix(","").replace(")","").split(", "),b.x=parseFloat(a[0]),b.y=parseFloat(a[3]));return b},ra:function(a){1!=window.devicePixelRatio&&(a.style.webkitTransform="scale("+1/window.devicePixelRatio+")",a.style.webkitTransformOrigin="0 0")},Oa:function(a,b){a.style.webkitTransform=b.style.webkitTransform;a.style.webkitTransformOrigin=b.style.webkitTransformOrigin},La:function(a,b,c){a.style.position="absolute";a.style.left=b+"px";a.style.top=c+"px"}},O={extend:function(a,
b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.s=b.prototype}},ra={hb:function(a,b,c){var d=pa.ma(a);a={};a[d]=b;chrome.storage.local.set(a,function(){c&&c(d)})},pb:function(a,b){chrome.storage.local.get(a,function(c){chrome.storage.local.remove(a,function(){b&&b(c[a])})})}},P=function(){var a=[[-12,0],[-12,-4],[0,0],[-12,4]];return{cb:function(a,c,d,f,m,e,g){var b=a.fillStyle,l=a.strokeStyle;a.beginPath();a.fillStyle=g;a.moveTo(c+e,d);a.lineTo(c+f-e,d);a.quadraticCurveTo(c+
f,d,c+f,d+e);a.lineTo(c+f,d+m-e);a.quadraticCurveTo(c+f,d+m,c+f-e,d+m);a.lineTo(c+e,d+m);a.quadraticCurveTo(c,d+m,c,d+m-e);a.lineTo(c,d+e);a.quadraticCurveTo(c,d,c+e,d);a.fill();a.closePath();a.fillStyle=b;a.strokeStyle=l},Qa:function(b,c,d,f,m,e,g){b.strokeStyle=e;b.fillStyle=e;b.lineWidth=g;e=Math.atan2(m-d,f-c);var x=g/2;g=[];for(var l in a)g.push([a[l][0]*x,a[l][1]*x]);if(0==e)var v=g;else{l=[];for(v in g){x=g[v][0];var D=g[v][1];l.push([x*Math.cos(e)-D*Math.sin(e),x*Math.sin(e)+D*Math.cos(e)])}v=
l}e=[];for(var J in v)e.push([v[J][0]+f,v[J][1]+m]);b.beginPath();b.moveTo(e[0][0],e[0][1]);for(var k in e)0<k&&b.lineTo(e[k][0],e[k][1]);b.lineTo(e[0][0],e[0][1]);b.fill();Math.sqrt(Math.pow(f-c,2)+Math.pow(m-d,2))>Math.sqrt(Math.pow(e[0][0]-c,2)+Math.pow(e[0][1]-d,2))&&(b.beginPath(),b.moveTo(c,d),b.lineTo(e[0][0],e[0][1]),b.stroke())},sa:function(a,c,d,f,m){var b=a.lineWidth/2;c=new G({x:c,y:d,c:f,b:m});ka(c,-b,-b);a.strokeRect(c.x,c.y,c.c,c.b)}}}();
function sa(a){function b(){$(window).off("mouseup",b);$(window).off("mousemove",c);return!1}function c(b){N.La(a,b.pageX-d,b.pageY-f);return!1}var d=0,f=0;$(a).on("mousedown",function(m){if(m.target===a){var e=$(a);$(window).on("mouseup",b);e=e.offset();d=m.pageX-e.left;f=m.pageY-e.top;$(window).on("mousemove",c);return!1}return!0})}
var Q={f:function(a){return chrome.i18n.getMessage(a)}},ta=function(){function a(a){var b="unknown";-1!=a.navigator.appVersion.indexOf("Win")?b="windows":-1!=a.navigator.appVersion.indexOf("Mac")?b="macos":-1!=a.navigator.appVersion.indexOf("X11")?b="unix":-1!=a.navigator.appVersion.indexOf("Linux")&&(b="linux");return b}return{ob:a,Da:function(b){var c={id:"ctrl",display:"Ctrl"};"macos"===a(b)&&(c={id:"meta",display:"\u2318"});return c}}}();(function(){function a(){$("#announce_do_not_show").is(":checked")?b(function(){$("#announce").hide()}):$("#announce").hide();return!1}function b(a){chrome.storage.local.get("lightshot_announces",function(b){b.lightshot_announces||(b.lightshot_announces={});b.lightshot_announces["ann_"+null.id]="do_not_show";chrome.storage.local.set(b,function(){a()})})}$(function(){$("#announce_hide").click(a).html(Q.f("screenshot_plugin_close"));$("#announce_close_cross").click(a);$("#announce_do_not_show_label").html(Q.f("screenshot_plugin_announce_do_not_show"))})})();function ua(a){this.a=a;this.Za=this.a.getContext("2d")}ua.prototype.v=function(){return new y(this.a.width,this.a.height)};function R(a,b){var c=a.a.getBoundingClientRect();a=N.na(a.a);return new G({x:b.x*a.x+c.left+$(document).scrollLeft(),y:b.y*a.y+c.top+$(document).scrollTop(),c:b.c*a.x,b:b.b*a.y})}function va(a,b){var c=a.a.getBoundingClientRect();a=N.na(a.a);return new w(Math.round((b.x-c.left-$(document).scrollLeft())/a.x),Math.round((b.y-c.top-$(document).scrollTop())/a.y))}
function S(a,b){return va(a,new w(b.pageX,b.pageY))}function wa(a){var b=document.getElementsByTagName("body")[0].appendChild(document.createElement("canvas"));wa.s.constructor.call(this,b);this.Fa=a;N.Oa(this.a,this.Fa);this.ua()}O.extend(wa,ua);wa.prototype.ua=function(){var a=$(this.Fa);this.a.width=a.width();this.a.height=a.height();this.a.style.position="absolute";this.a.style.left=a.offset().left+"px";this.a.style.top=a.offset().top+"px"};function xa(a){var b={ja:"selectStart",N:"selectEnd",L:"redraw"},c=function(){function a(){d=new G;x=!1}function b(a){d=a;x=!0;a=3*window.devicePixelRatio;var b=Math.floor(d.c/2),c=Math.floor(d.b/2);l.right=M.K(new w(d.x+d.c,d.y+c),a);l.left=M.K(new w(d.x,d.y+c),a);l.top=M.K(new w(d.x+b,d.y),a);l.bottom=M.K(new w(d.x+b,d.y+d.b),a);l.topleft=M.K(new w(d.x,d.y),a);l.topright=M.K(new w(d.x+d.c,d.y),a);l.bottomleft=M.K(new w(d.x,d.y+d.b),a);l.bottomright=M.K(new w(d.x+d.c,d.y+d.b),a);l.move=d}function c(a){if(x)for(var b in l)if(!a(l[b],
b))break}var d=new G,x=!1,l={},v=null;return{set:b,get:function(){return d},clear:a,Ya:function(){return x},oa:function(a){var b="none";x&&c(function(c,d){c=new G(c);ka(c,1);return H(c,a)?(b=d,!1):!0});return b},lb:c,Ba:function(){v=d},restore:function(){v?b(v):a()}}}(),d=function(){function a(a){if(E)return!0;a=S(k,a);"move"===c.oa(a)&&J();return!1}function d(a){1!==a.which&&x();return!1}function e(a){h=a=S(k,a);if(E)return!0;switch(F){case "left":case "right":case "top":case "bottom":c.set(M.bb(z,
B,a));break;case "topleft":case "topright":case "bottomleft":case "bottomright":c.set(M.Ka(z,a));break;case "move":var b=k.v();c.set(new G({T:Math.min(Math.max(a.x-C.left,0),b.c),V:Math.min(Math.max(a.y-C.top,0),b.b),U:Math.max(Math.min(a.x+C.right,b.c),0),W:Math.max(Math.min(a.y+C.bottom,b.b),0)}))}D();v(a);return!1}function g(){x();return!1}function x(){F="none";B=z=C=null;var a=k.a;$(a).off("mouseup",g);$(a).off("mouseenter",d);c.get().A()?(c.restore(),D()):c.Ba();r[b.N].fire({rect:R(k,c.get())})}
function l(a){if(1!=a.which||E)return!0;a=S(k,a);F=c.oa(a);switch(F){case "left":z=I(c.get());B=L(c.get());break;case "right":z=ma(c.get());B=K(c.get());break;case "top":z=K(c.get());B=L(c.get());break;case "bottom":z=ma(c.get());B=I(c.get());break;case "topleft":z=L(c.get());break;case "topright":z=K(c.get());break;case "bottomleft":z=I(c.get());break;case "bottomright":z=ma(c.get());break;case "move":var A=c.get();C={left:a.x-A.x,top:a.y-A.y,right:A.x+A.c-a.x,bottom:A.y+A.b-a.y};break;case "none":z=
a;F="bottomright";break;default:alert("ERROR onMouseDown -> switch -> default")}a=k.a;$(a).on("mouseup",g);$(a).on("mouseenter",d);r[b.ja].fire();return!1}function v(a){var b="none";"none"!==F?b=F:a&&(b=c.oa(a));a=k.a;switch(b){case "left":case "right":a.style.cursor="ew-resize";break;case "top":case "bottom":a.style.cursor="ns-resize";break;case "topright":case "bottomleft":a.style.cursor="nesw-resize";break;case "topleft":case "bottomright":a.style.cursor="nwse-resize";break;case "move":a.style.cursor=
"move";break;default:a.style.cursor="default"}}function D(){r[b.L].fire(null)}function J(){var a=c.get(),d=new G(new w(0,0),k.v());a.isEqual(d)&&p?c.set(p):(p=a,c.set(d));c.Ba();D();r[b.N].fire({rect:R(k,c.get())})}var k=null,z=null,B=null,F="none",C=null,p=null,r={};r[b.ja]=$.Callbacks();r[b.N]=$.Callbacks();r[b.L]=$.Callbacks();var E=!1,h=null,u=Q.f("screenshot_plugin_tooltip");return{pa:function(b){k=new ua(b);D();b=k.a;$(b).on("mousedown",l);$(b).on("mousemove",e);$(b).on("dblclick",a)},clear:function(){c.clear();
D()},H:function(){return c.get()},D:b,attachEvent:function(a,b){"undefined"!==typeof r[a]&&r[a].add(b)},detachEvent:function(a,b){"undefined"!==typeof r[a]&&r[a].remove(b)},lock:function(){E=!0;k.a.style.cursor="default";F="none"},unlock:function(){E=!1;h&&v(h)},ga:function(a,b){if(a&&b)if(c.Ya()){var d=c.get();b.fillStyle="rgba(0, 0, 0, 0.5)";b.fillRect(0,0,a.width,d.y);b.fillRect(0,d.y,d.x,a.height-d.y);b.fillRect(d.x,d.y+d.b,a.width-d.x,a.height-d.y-d.b);b.fillRect(d.x+d.c,d.y,a.width-d.x-d.c,
d.b);b.lineWidth=1*window.devicePixelRatio;b.lineJoin="miter";b.strokeStyle="white";P.sa(b,d.x,d.y,d.c,d.b);b.strokeStyle="black";b.setLineDash([6]);P.sa(b,d.x,d.y,d.c,d.b);b.setLineDash([]);b.fillStyle="black";b.strokeStyle="white";c.lb(function(a,c){"none"!==c&&"move"!==c&&(b.fillRect(a.x,a.y,a.c,a.b),P.sa(b,a.x,a.y,a.c,a.b));return!0});var e=14*window.devicePixelRatio;b.font=e+"px Helvetica";b.fillStyle="white";b.textBaseline="top";a=d.c+"x"+d.b;var A=new y(b.measureText(a).width,e);e=3*window.devicePixelRatio;
A=new y(A.c+2*e,A.b+2*e);var f=null;f=new G(new w(d.x,d.y-5*window.devicePixelRatio-A.b),A);P.cb(b,f.x,f.y,f.c,f.b,3*window.devicePixelRatio,"rgba(0,0,0,0.8)","rgba(0,0,0,0.8)");b.fillText(a,f.x+e,f.y+e-1*window.devicePixelRatio)}else b.fillStyle="rgba(0, 0, 0, 0.5)",b.fillRect(0,0,a.width,a.height),e=50*window.devicePixelRatio,b.font=e+"px Helvetica",b.fillStyle="rgba(255, 255, 255, 0.5)",b.textBaseline="top",A=new y(b.measureText(u).width,e),d=new G(new w,A),oa(d,new G(new w,new y(a.width,a.height))),
b.fillText(u,d.x,d.y)},eb:J,offset:function(a,d){var e=new G(c.get());e.x+=a;e.y+=d;a=new G(new w(0,0),k.v());e=na(e,a);e.size().isEqual(c.get().size())&&(c.set(e),D(),r[b.N].fire({rect:R(k,c.get())}))},da:function(a,d){var e=new G(c.get());e.c+=a;e.b+=d;e.A()||(a=new G(new w(0,0),k.v()),e=na(e,a),c.set(e),D(),r[b.N].fire({rect:R(k,c.get())}))}}}();d.pa(a);return d};function T(a,b){this.g=a;this.ab=b;this.a=null;this.i="default";this.ka()}T.prototype.ka=function(){this.g.id=this.g.id||pa.ma("item_")};T.prototype.la=function(){};T.prototype.getState=function(){return this.i};function ya(a,b){ya.s.constructor.apply(this,arguments);this.a=document.createElement("div");this.a.id=this.g.id;this.a.className="toolbar-separator"}O.extend(ya,T);function U(a,b){U.s.constructor.apply(this,arguments);this.ka();this.za();za(this)}O.extend(U,T);U.prototype.ka=function(){};
U.prototype.za=function(){this.a=document.createElement("img");this.a.id=this.g.id;this.a.alt=this.g.caption;this.a.title=this.g.caption;this.a.className="toolbar-button ";Aa(this)};function za(a){$(a.a).on("click",function(){var b=a.ab;b.O[b.X.C].fire(a.g.id);return!1});$(a.a).on("mousedown",!1);$(a.a).on("mouseover",function(){Ba(a)});$(a.a).on("mouseout",function(){"active"!=a.i&&Aa(a)})}function Aa(a){a.a.src=a.g.j;a.a.srcset=a.g.l+" 2x"}function Ba(a){a.a.src=a.g.m;a.a.srcset=a.g.o+" 2x"}
U.prototype.la=function(){"active"==this.i?Ba(this):Aa(this)};function Ca(a,b){Ca.s.constructor.apply(this,arguments);this.g.u(this)}O.extend(Ca,U);Ca.prototype.za=function(){this.a=document.createElement("canvas");this.a.id=this.g.id;this.a.className="toolbar-button-owner-draw";this.a.title=this.g.caption;this.a.width=26*window.devicePixelRatio;this.a.height=27*window.devicePixelRatio;this.a.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio)};
function Da(a){this.J=a;this.P=[];this.O={};this.O[this.X.C]=$.Callbacks();this.J.id=this.J.id||pa.ma("toolbar_");this.J.layout=this.J.layout||[];this.a=document.createElement("div");this.a.id=this.J.id;this.a.className="toolbar "+this.J.className;document.getElementsByTagName("body")[0].appendChild(this.a);for(a=0;a<this.J.layout.length;a++){var b=this.J.layout[a];var c=null;"button"===b.type?c=new U(b,this):"button_owner_draw"===b.type?c=new Ca(b,this):"separator"===b.type&&(c=new ya(b,this));if(b=
c)this.P.push(b),this.a.appendChild(b.a)}}n=Da.prototype;n.X={C:"buttonClicked"};n.setPosition=function(a,b){null==b&&"undefined"!==typeof a.x&&"undefined"!==typeof a.y?(this.a.style.left=a.x+"px",this.a.style.top=a.y+"px"):(this.a.style.left=a+"px",this.a.style.top=b+"px")};n.v=function(){return new y($(this.a).outerWidth(),$(this.a).outerHeight())};n.H=function(){var a=$(this.a).offset();return new G(new w(a.left,a.top),this.v())};n.hide=function(){$(this.a).hide()};n.show=function(){$(this.a).show()};
n.attachEvent=function(a,b){"undefined"!==typeof this.O[a]&&this.O[a].add(b)};n.detachEvent=function(a,b){"undefined"!==typeof this.O[a]&&this.O[a].remove(b)};function Ea(a){for(var b=0;b<a.P.length;b++){var c=a.P[b];c.i="default";c.la()}}function Fa(a,b){for(var c=0;c<a.P.length;c++)if(a.P[c].g.id===b)return a.P[c];return null};function Ga(){function a(a){if("share"===a)if($(f.a).is(":visible"))f.hide();else{if(f.show(),a=(a=Fa(d,"share"))?a.a.getBoundingClientRect():null){var b=f.v(),m=a.left+(a.right-a.left)/2;a.bottom+6+b.b<window.innerHeight?(f.setPosition(m-b.c/2,a.bottom+6),$(f.a).addClass("drop-down").removeClass("drop-up")):(f.setPosition(m-b.c/2,a.top-8-b.b),$(f.a).addClass("drop-up").removeClass("drop-down"))}}else e[c.C].fire(a)}function b(){d.hide();f.hide();m.hide()}var c={C:"buttonClicked"},d=null,f=null,m=
null,e={};e[c.C]=$.Callbacks();var g=ta.Da(window).display,x={id:"toolbar_actions",className:"toolbar-horizontal",layout:[{id:"upload",type:"button",caption:Q.f("screenshot_plugin_upload")+" ("+g+"+D)",j:"toolbar_res/hor_upload.png",l:"toolbar_res/hor_upload@2x.png",m:"toolbar_res/hor_upload_hover.png",o:"toolbar_res/hor_upload_hover@2x.png"},{id:"share",type:"button",caption:Q.f("screenshot_plugin_share"),j:"toolbar_res/hor_share.png",l:"toolbar_res/hor_share@2x.png",m:"toolbar_res/hor_share_hover.png",
o:"toolbar_res/hor_share_hover@2x.png"},{id:"search_google",type:"button",caption:Q.f("screenshot_plugin_share_googlesearch"),j:"toolbar_res/hor_search.png",l:"toolbar_res/hor_search@2x.png",m:"toolbar_res/hor_search_hover.png",o:"toolbar_res/hor_search_hover@2x.png"},{id:"print",type:"button",caption:Q.f("screenshot_plugin_print")+" ("+g+"+P)",j:"toolbar_res/hor_print.png",l:"toolbar_res/hor_print@2x.png",m:"toolbar_res/hor_print_hover.png",o:"toolbar_res/hor_print_hover@2x.png"},{id:"save",type:"button",
caption:Q.f("screenshot_plugin_save")+" ("+g+"+S)",j:"toolbar_res/hor_save.png",l:"toolbar_res/hor_save@2x.png",m:"toolbar_res/hor_save_hover.png",o:"toolbar_res/hor_save_hover@2x.png"},{type:"separator"},{id:"close",type:"button",caption:Q.f("screenshot_plugin_close")+" ("+g+"+X)",j:"toolbar_res/hor_close.png",l:"toolbar_res/hor_close@2x.png",m:"toolbar_res/hor_close_hover.png",o:"toolbar_res/hor_close_hover@2x.png"}]},l={id:"toolbar_share",className:"subtoolbar-horizontal",layout:[{id:"share_twitter",
type:"button",caption:Q.f("screenshot_plugin_share_twitter"),j:"toolbar_res/share_twitter.png",l:"toolbar_res/share_twitter@2x.png",m:"toolbar_res/share_twitter_hover.png",o:"toolbar_res/share_twitter_hover@2x.png"},{id:"share_facebook",type:"button",caption:Q.f("screenshot_plugin_share_facebook"),j:"toolbar_res/share_facebook.png",l:"toolbar_res/share_facebook@2x.png",m:"toolbar_res/share_facebook_hover.png",o:"toolbar_res/share_facebook_hover@2x.png"},{id:"share_vk",type:"button",caption:Q.f("screenshot_plugin_share_vk"),
j:"toolbar_res/share_vk.png",l:"toolbar_res/share_vk@2x.png",m:"toolbar_res/share_vk_hover.png",o:"toolbar_res/share_vk_hover@2x.png"},{id:"share_pinterest",type:"button",caption:Q.f("screenshot_plugin_share_pinterest"),j:"toolbar_res/share_pinterest.png",l:"toolbar_res/share_pinterest@2x.png",m:"toolbar_res/share_pinterest_hover.png",o:"toolbar_res/share_pinterest_hover@2x.png"}]};g={id:"toolbar_edit",className:"toolbar-vertical",layout:[{id:"pencil",type:"button",caption:Q.f("screenshot_plugin_edit_pencil"),
j:"toolbar_res/draw_pencil.png",l:"toolbar_res/draw_pencil@2x.png",m:"toolbar_res/draw_pencil_hover.png",o:"toolbar_res/draw_pencil_hover@2x.png"},{id:"line",type:"button",caption:Q.f("screenshot_plugin_edit_line"),j:"toolbar_res/draw_line.png",l:"toolbar_res/draw_line@2x.png",m:"toolbar_res/draw_line_hover.png",o:"toolbar_res/draw_line_hover@2x.png"},{id:"arrow",type:"button",caption:Q.f("screenshot_plugin_edit_arrow"),j:"toolbar_res/draw_arrow.png",l:"toolbar_res/draw_arrow@2x.png",m:"toolbar_res/draw_arrow_hover.png",
o:"toolbar_res/draw_arrow_hover@2x.png"},{id:"rectangle",type:"button",caption:Q.f("screenshot_plugin_edit_rect"),j:"toolbar_res/draw_rectangle.png",l:"toolbar_res/draw_rectangle@2x.png",m:"toolbar_res/draw_rectangle_hover.png",o:"toolbar_res/draw_rectangle_hover@2x.png"},{id:"marker",type:"button",caption:Q.f("screenshot_plugin_edit_marker"),j:"toolbar_res/draw_marker.png",l:"toolbar_res/draw_marker@2x.png",m:"toolbar_res/draw_marker_hover.png",o:"toolbar_res/draw_marker_hover@2x.png"},{id:"text",
type:"button",caption:Q.f("screenshot_plugin_edit_text"),j:"toolbar_res/draw_text.png",l:"toolbar_res/draw_text@2x.png",m:"toolbar_res/draw_text_hover.png",o:"toolbar_res/draw_text_hover@2x.png"},{id:"color",type:"button_owner_draw",caption:Q.f("screenshot_plugin_edit_color"),Aa:{color:"#ff0000"},u:function(a){var b=a.a;if(b&&b.getContext){var c=b.getContext("2d");c.clearRect(0,0,b.width,b.height);c.fillStyle=a.g.Aa.color;c.fillRect(6,5,16,17);a=new Image;a.src="data:image/png;base64,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";
c.drawImage(a,.5,.5)}}},{type:"separator"},{id:"undo",type:"button",caption:Q.f("screenshot_plugin_edit_undo")+" ("+g+"+Z)",j:"toolbar_res/draw_undo.png",l:"toolbar_res/draw_undo@2x.png",m:"toolbar_res/draw_undo_hover.png",o:"toolbar_res/draw_undo_hover@2x.png"}]};d=new Da(x);d.attachEvent(d.X.C,a);f=new Da(l);f.attachEvent(f.X.C,a);m=new Da(g);m.attachEvent(m.X.C,a);b();return{ua:function(a){var b=new G({x:0,y:0,c:window.innerWidth,b:window.innerHeight}),c=d.v(),e=[],f=d.v();var g=L(a);e.push(new w(Math.max(g.x-
f.c,0),g.y+5));g=I(a);e.push(new w(Math.max(g.x-f.c,0),g.y-5-f.b));g=K(a);e.push(new w(g.x-5-f.c,g.y-f.b));g=L(a);e.push(new w(g.x+5,g.y-f.b));g=L(a);e.push(new w(g.x-5-f.c,g.y-5-f.b));for(g=0;g<e.length;g++)if(la(b,new G(e[g],c))){d.setPosition(e[g]);break}c=d.H();e=m.v();f=[];g=d.v();var l=m.v(),v=d.H();var p=L(a);f.push(new w(p.x+5,Math.max(p.y-l.b,0)));p=K(a);f.push(new w(p.x-5-l.c,Math.max(p.y-l.b,0)));p=L(a);f.push(new w(p.x-5-l.c,Math.max(p.y-5-l.b,0)));p=L(a);f.push(new w(v.x+v.c+5,Math.max(p.y-
5-l.b,0)));p=K(a);f.push(new w(v.x-5-l.c,Math.max(p.y-l.b,0)));p=L(a);f.push(new w(p.x-l.c,p.y+5+g.b+5));p=I(a);f.push(new w(p.x-l.c,p.y-5-g.b-5-l.b));for(g=0;g<f.length;g++)if(a=new G(f[g],e),la(b,a)&&na(a,c).A()){m.setPosition(f[g]);break}},Ea:b,Ma:function(){d.show();m.show()},D:c,attachEvent:function(a,b){"undefined"!==typeof e[a]&&e[a].add(b)},detachEvent:function(a,b){"undefined"!==typeof e[a]&&e[a].remove(b)},gb:function(a,b){Ea(m);if(a=Fa(m,a))a.i=b,a.la()},Ca:function(){Ea(m)},ta:function(a){var b=
Fa(m,"color");b.g.Aa.color=a;b.g.u(b)}}};function Ha(a){a=a||{};var b=null,c=null,d=a.color||"#ff0000",f=a.width||10,m=a.fontFamily||"Helvetica";c=document.createElement("textarea");c.spellcheck=!1;b=document.createElement("div");b.appendChild(c);b.style.tb="999999";b.style.background="none";b.style.border="dashed black 1px";b.style.padding=2*window.devicePixelRatio+"px";b.style.margin="2px";b.style.cursor="move";c.style.background="none";c.style.border="none";c.style.outline="none";c.style.resize="none";c.style.padding="0";c.style.margin=
"0";c.style.color=d;c.style.font=f+"px "+m;document.getElementsByTagName("body")[0].appendChild(b);N.ra(b);N.La(b,a.Ja.x,a.Ja.y);ja(c);sa(b);c.focus();return{Wa:function(){return c?c.value:null},Ua:function(){return b?$(c).offset():null},Ta:function(){return Number.parseInt(window.getComputedStyle(c).height)/c.rows},fb:function(){b.parentNode.removeChild(b);c=b=null},R:function(a){d=a;c.style.color=d},Z:function(a){f=a;c.style.fontSize=f+"px";$(c).change()}}};function Ia(a){a=a||{};this.$a=a.S||"line";this.F=a.color||"#ff0000";this.w=a.width||10;this.Ia=a.qb||1;this.i="new"}n=Ia.prototype;n.getState=function(){return this.i};n.u=function(){alert("not implemented")};n.setStart=function(){alert("not implemented")};n.setEnd=function(){alert("not implemented")};n.ba=function(){alert("not implemented")};n.A=function(){alert("not implemented")};n.R=function(){};n.Z=function(a){"drawing"==this.i&&(this.w=a)};
function Ja(a){Ja.s.constructor.apply(this,arguments)}O.extend(Ja,Ia);function V(a){V.s.constructor.apply(this,arguments);this.G=this.M=null}O.extend(V,Ja);V.prototype.setStart=function(a){this.G=this.M=a;this.i="drawing"};V.prototype.setEnd=function(a){a&&(this.G=a);this.i="finished"};V.prototype.ba=function(a){"drawing"===this.i&&(this.G=a)};V.prototype.A=function(){return null==this.M||null==this.G};function W(a){W.s.constructor.apply(this,arguments);this.h=[]}O.extend(W,Ja);
W.prototype.setStart=function(a){this.h=[];this.h.push(a);this.i="drawing"};W.prototype.setEnd=function(a){a&&this.h.push(a);this.i="finished"};W.prototype.ba=function(a){if("drawing"===this.i){var b=this.h[this.h.length-1];Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))>=this.w/8&&this.h.push(a)}};W.prototype.A=function(){return 0==this.h.length};function Ka(a){a=a||{};a.S="line";Ka.s.constructor.apply(this,arguments)}O.extend(Ka,V);
Ka.prototype.u=function(a){a.lineJoin="round";a.lineCap="round";a.strokeStyle=this.F;a.lineWidth=this.w*window.devicePixelRatio;a.beginPath();a.moveTo(this.M.x,this.M.y);a.lineTo(this.G.x,this.G.y);a.stroke()};function Ma(a){a=a||{};a.S="arrow";Ma.s.constructor.apply(this,arguments)}O.extend(Ma,V);Ma.prototype.u=function(a){a.lineJoin="round";a.lineCap="round";P.Qa(a,this.M.x,this.M.y,this.G.x,this.G.y,this.F,this.w*window.devicePixelRatio)};
function Na(a){a=a||{};a.S="rectangle";Na.s.constructor.apply(this,arguments)}O.extend(Na,V);Na.prototype.u=function(a){a.lineJoin="round";a.lineCap="round";a.strokeStyle=this.F;a.lineWidth=this.w*window.devicePixelRatio;var b=M.Ka(this.M,this.G);a.strokeRect(b.x,b.y,b.c,b.b)};function X(a){a=a||{};a.S="pencil";X.s.constructor.apply(this,arguments)}O.extend(X,W);
X.prototype.u=function(a){a.lineJoin="round";a.lineCap="round";a.strokeStyle=this.F;a.lineWidth=this.w*window.devicePixelRatio;if(1==this.h.length||2==this.h.length&&this.h[0].isEqual(this.h[1]))a.fillStyle=this.F,a.beginPath(),a.arc(this.h[0].x,this.h[0].y,this.w/2*window.devicePixelRatio,0,2*Math.PI,!1),a.fill();else{a.beginPath();a.moveTo(this.h[0].x,this.h[0].y);for(var b=1;b<this.h.length;b++)a.lineTo(this.h[b].x,this.h[b].y);a.stroke()}};
function Y(a){a=a||{};a.S="marker";Y.s.constructor.apply(this,arguments);this.Ia=.5}O.extend(Y,X);Y.prototype.u=function(a){var b=a.globalAlpha;a.globalAlpha=this.Ia;Y.s.u.apply(this,arguments);a.globalAlpha=b};function Oa(a){a=a||{};a.S="text";Oa.s.constructor.apply(this,arguments);this.Ga=a.canvas;this.B=null;this.qa="";this.I=null;this.Ha="Helvetica";this.fa=0}O.extend(Oa,Ia);n=Oa.prototype;
n.u=function(a){if("drawing"!==this.i&&"finished"===this.i){a.font=this.w*window.devicePixelRatio+"px "+this.Ha;a.fillStyle=this.F;a.textBaseline="top";for(var b=this.qa.split("\n"),c=0;c<b.length;c++)a.fillText(b[c],this.I.x,this.I.y+c*this.fa)}};n.setStart=function(){};
n.setEnd=function(a){if(a){var b=this.Ga;var c=b.a.getBoundingClientRect();b=N.na(b.a);c=new w(a.x*b.x+c.left+$(document).scrollLeft(),a.y*b.y+c.top+$(document).scrollTop());this.B=Ha({Ja:c,color:this.F,width:this.w*window.devicePixelRatio,fontFamily:this.Ha});this.I=a}this.i="drawing"};n.ba=function(){};n.A=function(){return 0==this.qa.length};n.R=function(a){this.F=a;this.B&&this.B.R(this.F)};n.Z=function(a){this.w=a;this.B&&this.B.Z(this.w*window.devicePixelRatio)};function Pa(a){function b(){q=null;l()}function c(a){if(!v()||p===k.Y)return!0;a=S(r,a);h&&h.ba(a);q=a;l();return!1}function d(a){1!=a.which&&m(null);return!1}function f(a){if(1!=a.which)return!0;a=a?S(r,a):null;m(a);return!1}function m(a){var b=r.a;$(b).off("mouseup",f);$(b).off("mouseenter",d);h&&h.setEnd(a);l();u[z.ha].fire()}function e(a){if(1!=a.which||!v())return!0;g();var b={color:B,width:x()};switch(p){case k.wa:h=new Ka(b);break;case k.va:h=new Ma(b);break;case k.ya:h=new Na(b);break;case k.xa:h=
new X(b);break;case k.aa:b.color=F;h=new Y(b);break;case k.Y:b.canvas=r;h=new Oa(b);break;default:console.log("_startNewObject: no such tool")}h&&(a=S(r,a),h.setStart(a));l();a=r.a;$(a).on("mouseup",f);$(a).on("mouseenter",d);u[z.ia].fire();return!1}function g(){if(h){if(h.$a===k.Y){var a=h;a.qa=a.B.Wa();a.fa=a.B.Ta();var b=a.B.Ua();a.I=va(a.Ga,new w(b.left,b.top));"firefox"==ia().name?a.I.y+=Math.round(a.fa/10):"chrome"==ia().name&&(a.I.y+=Math.ceil(a.fa/100));a.B.fb();a.B=null;a.i="finished";l()}h.A()||
E.push(h);h=null}}function x(){var a=0;switch(p){case k.wa:case k.va:case k.ya:case k.xa:a=2*C+3;break;case k.aa:a=2*C+16;break;case k.Y:a=4*C+16}return a}function l(){u[z.L].fire(null)}function v(){return null!==p}function D(){J(null);l()}function J(a){g();p=a}var k={xa:"pencil",wa:"line",va:"arrow",ya:"rectangle",aa:"marker",Y:"text"},z={ia:"selectStart",ha:"selectEnd",L:"redraw"},B=window.localStorage.mainColor||"#ff0000",F=window.localStorage.markerColor||"#ffff00",C=0,p=null,r=new ua(a),E=[],
h=null,u={},q=null;u[z.ia]=$.Callbacks();u[z.ha]=$.Callbacks();u[z.L]=$.Callbacks();(function(){var a=r.a;$(a).on("mousedown",e);$(a).on("mousemove",c);$(a).on("mouseleave",b)})();return{ib:J,R:function(a){p===k.aa?(F=a,window.localStorage.markerColor=F):(B=a,window.localStorage.mainColor=B);h&&h.R(a)},ca:function(){return p===k.aa?F:B},jb:D,ea:v,Sa:function(){return p},ga:function(a,b){if(a&&b){for(a=0;a<E.length;a++)E[a].u(b);h&&h.u(b);v()&&p!==k.Y&&q&&(a=x(),b.lineJoin="round",b.strokeStyle="black",
b.lineWidth=1*window.devicePixelRatio,b.beginPath(),b.arc(q.x,q.y,a/2*window.devicePixelRatio,0,2*Math.PI,!0),b.stroke())}},kb:function(){g();E.pop();0===E.length&&D();l()},Pa:function(){v()&&0<C&&(--C,h&&h.Z(x()),l())},Xa:function(){v()&&10>C&&(C+=1,h&&h.Z(x()),l())},mb:k,D:z,attachEvent:function(a,b){"undefined"!==typeof u[a]&&u[a].add(b)},detachEvent:function(a,b){"undefined"!==typeof u[a]&&u[a].remove(b)}}};function Qa(){function a(a){var b=document.createElement("canvas");b.width=a.c;b.height=a.b;var c=b.getContext("2d"),f=new Image;f.src=d;c.drawImage(f,a.x,a.y,a.c,a.b,0,0,a.c,a.b);return b}function b(a,b){var c=new Image;c.src=a;c.onload=function(){var d=c.width*window.devicePixelRatio,e=c.height*window.devicePixelRatio,f=document.createElement("canvas");f.width=d;f.height=e;f.getContext("2d").drawImage(c,0,0,c.width,c.height,0,0,d,e);a=f.toDataURL();b(a)}}var c=null,d=null;return{load:function(a,
m){c=a;chrome.runtime.sendMessage({name:"load_screenshot",id:c},function(a){"firefox"!=ia().name||1==window.devicePixelRatio?(d=a,m(d)):b(a,function(a){d=a;m(d)})})},nb:function(b){return a(b).toDataURL()},Ra:a}}
var Z=function(){function a(a){chrome.downloads.download({url:a,filename:"Screenshot.png",saveAs:!0},function(a){a?function e(a){chrome.downloads.search({id:a},function(b){b[0]&&("in_progress"===b[0].state?window.setTimeout(function(){e(a)},100):c())})}(a):c()})}function b(a){function b(a){e&&e==a.id&&a.state&&"in_progress"!=a.state.current&&(URL.revokeObjectURL(d),browser.downloads.onChanged.removeListener(b),c())}a=Uint8Array.from(atob(a.split(",")[1]),function(a){return a.charCodeAt(0)});var d=
URL.createObjectURL(new Blob([a],{type:"image/png"})),e;browser.downloads.onChanged.addListener(b);browser.downloads.download({url:d,filename:"Screenshot.png"}).then(function(a){e=a})}function c(){chrome.runtime.sendMessage({name:"close_screenshot_window"},function(){})}return{close:c,upload:function(a){a.dataUrl&&ra.hb("upload_scrn_",a,function(a){chrome.runtime.sendMessage({name:"upload_screenshot",id:a},function(){c()})})},save:function(c){c&&("firefox"==ia().name?b(c):a(c))},Na:function(a){a&&
confirm(Q.f("screenshot_plugin_chrome_bug_copy").replace(/\\n/gi,"\n"))&&chrome.tabs.create({url:"https://code.google.com/p/chromium/issues/detail?id=150835"},function(){})},print:function(a){if(a){var b=document.createElement("iframe");b.style.visibility="hidden";b.style.position="fixed";b.style.width="0";b.style.height="0";b.style.right="0";b.style.bottom="0";b.onload=function(){var c=b.contentWindow.document,d=c.getElementsByTagName("body")[0];d.style.margin="0";d.style.padding="0";d.style.textAlign=
"center";c=c.createElement("img");c.onload=function(){b.contentWindow.print()};c.src=a;N.ra(c);d.appendChild(c)};document.getElementsByTagName("body")[0].appendChild(b)}}}}(),Ra=function(){function a(){$(window).on("mousewheel",function(a){q.ea()&&(0<a.deltaY?c():0>a.deltaY&&d())});$(window).on("contextmenu",!1)}function b(){function a(a,b){$(window).on("keydown",null,a,b)}function b(a,b){$(window).on("keydown",null,a,b);$(document).on("keydown","textarea",a,b)}var g=ta.Da(window).id;b("esc",f);b(g+
"+=",d);b(g+"+-",c);b(g+"+s",function(){e();Z.save(B());return!1});b(g+"+x",function(){e();Z.close();return!1});b(g+"+d",function(){k();return!1});b(g+"+p",function(){e();Z.print(B());return!1});b(g+"+z",function(){J();return!1});a(g+"+a",function(){h.eb();return!1});a("up",function(){h.offset(0,-1);return!1});a("down",function(){h.offset(0,1);return!1});a("left",function(){h.offset(-1,0);return!1});a("right",function(){h.offset(1,0);return!1});a("shift+up",function(){h.da(0,-1);return!1});a("shift+down",
function(){h.da(0,1);return!1});a("shift+left",function(){h.da(-1,0);return!1});a("shift+right",function(){h.da(1,0);return!1})}function c(){q.Pa();return!1}function d(){q.Xa();return!1}function f(){q.ea()?e():Z.close()}function m(a){switch(a){case "close":e();Z.close();break;case "upload":k();break;case "save":e();Z.save(B());break;case "copy":e();Z.Na(B());break;case "print":e();Z.print(B());break;case "search_google":k("search_google");break;case "share_twitter":k("share_twitter");break;case "share_facebook":k("share_facebook");
break;case "share_vk":k("share_vk");break;case "share_pinterest":k("share_pinterest");break;case "pencil":case "line":case "arrow":case "rectangle":case "marker":case "text":q.ea()&&q.Sa()===a?e():(q.ib(a),u.gb(a,"active"),u.ta(q.ca()),h.lock());break;case "undo":J()}}function e(){q.jb();u.Ca();h.unlock()}function g(a){var b=A.a,c=A.Za;b&&c&&(c.clearRect(0,0,b.width,b.height),q.ga(b,c,a),h.ga(b,c,a))}function x(){u.Ma()}function l(){u.Ea()}function v(a){a.rect.A()||(u.Ma(),u.ua(a.rect))}function D(){u.Ea()}
function J(){q.kb();q.ea()||(u.Ca(),h.unlock())}function k(a){e();Z.upload(z(a))}function z(a){var b={dataUrl:B(),size:h.H().size(),dpr:window.devicePixelRatio};a&&(b.cmdAfterUpload=a);return b}function B(){if(h.H().A())return null;var a=E.Ra(h.H()),b=h.H(),c=a.getContext("2d");c.translate(-b.x,-b.y);q.ga(a,c,null);return a.toDataURL()}function F(){$("#color").colpick({colorScheme:"dark",layout:"rgbhex",color:q.ca(),onShow:function(a){$("#color").colpickSetColor(q.ca(),!0);var b=L(R(A,h.H())),c=Math.max(b.x-
3-$(a).width(),0);b=Math.max(b.y-3-$(a).height(),0);$(a).css({left:c+"px",top:b+"px"})},onSubmit:function(a,b,c,d){a="#"+b;u.ta(a);q.R(a);$(d).colpickHide()}});$(A.a).on("mousedown",function(){$("#color").colpickHide()});u.ta(q.ca())}function C(a){if(r.complete)a&&a();else $(r).on("load",function La(){$(r).off("load",La);a&&a()})}function p(a){var b=document.getElementById("content");b&&(r=document.createElement("img"),r.src=a,N.ra(r),b.appendChild(r))}var r=null,E=null,h=null,u=null,q=null,A=null;
return{pa:function(){u=Ga();u.attachEvent(u.D.C,m);E=Qa();E.load(qa.Va("id"),function(c){p(c);C(function(){A=new wa(r);q=Pa(A.a);q.attachEvent(q.D.ia,l);q.attachEvent(q.D.ha,x);q.attachEvent(q.D.L,g);h=xa(A.a);h.attachEvent(h.D.ja,D);h.attachEvent(h.D.N,v);h.attachEvent(h.D.L,g);h.clear();F();b();a()})})}}}();jQuery(function(){Ra.pa()});
