"use strict";(self.webpackChunkbrowser_extension=self.webpackChunkbrowser_extension||[]).push([[701],{50657:(e,t,n)=>{n.d(t,{pR:()=>c});n(97107),n(69375),n(48605);var r=n(56357),s=n(72431),a=n(34975),l=n(51127),i=n.n(l),o=n(20843);const c=!0,u={id:s.P2.BaiDu,name:"百度文字识别",points:!0,secretKeys:{get:()=>i().storage.local.get({baiDuOCRKey:[]}).then((({baiDuOCRKey:e})=>(Array.isArray(e)?e:[e]).map((e=>({id:e.key,key:e.secret}))))),set:e=>i().storage.local.set({baiDuOCRKey:e.map((e=>({key:e.id,secret:e.key})))}),isComplete:e=>(0,o.hP)(e,["id"])},pointsEnable:{get:()=>i().storage.local.get({bdOcrPoints:c}).then((({bdOcrPoints:e})=>e)),set:e=>i().storage.local.set({bdOcrPoints:e})}};class d extends r.m{constructor(){super(u,!0)}callBySecretKey(e,t){return(0,a.l)(e,{image:t.image,paragraph:!0,language_type:"auto_detect"})}transform(e){if(!e.paragraphs_result)throw new Error("百度文字识别服务配置有误，请确认你领取过免费资源包，且密钥填写无误。");return e.paragraphs_result.reduce(((t,{words_result_idx:n})=>(t.push(n.reduce(((t,n)=>t+e.words_result[n].words),"")),t)),[]).join("\n")}}new d},24671:(e,t,n)=>{n.d(t,{HO:()=>d,Zj:()=>c,ql:()=>m,u8:()=>h});n(97107),n(69375),n(10865),n(98376),n(14293);var r=n(20124),s=n.n(r),a=n(72431),l=n(5270);const i=s()("web-speech"),o=window.SpeechRecognition||window.webkitSpeechRecognition,c=!!o;var u=function(e){return e.zh="cnm-Hans-CN",e.enUS="en-US",e.ja="ja-JP",e.ko="ko-KR",e.fr="fr-FR",e.de="de-DE",e.ru="ru-RU",e}(u||{});const d={[u.zh]:"中文(简体)",[u.enUS]:"英语(美国)",[u.ja]:"日语",[u.ko]:"韩语",[u.fr]:"法语",[u.de]:"德语",[u.ru]:"俄语"},v={"audio-capture":"你的电脑没有连接麦克风。","no-speech":"没有检测到语音。","not-allowed":"请在浏览器询问是否允许使用麦克风时选择“允许”。如果你之前选择过“禁止”，请点击浏览器地址栏左侧的锁或感叹号图标，然后将“麦克风”改为“允许”。如果浏览器从未询问过，则说明当前页面由于未知的原因不允许使用麦克风。","service-not-allowed":"你的浏览器当前不允许使用划词翻译的内置语音识别服务。",network:"网络出错，请检查你的网络连接。注意：划词翻译内置的语音转文字服务需要能连接外网才可使用。","language-not-supported":"你的浏览器不支持识别此语种。",aborted:"识别过程被中断了。","bad-grammar":"语法错误。"},x=/\S/;const m={id:a.eA.WebSpeech,name:"划词翻译内置语音转文字",realtime:!0,defaultLang:u.zh};class p extends l.L{constructor(){super(m)}async microphone(e){const{lang:t,options:n}=e;if(!c)throw new Error("划词翻译的内置语音转文字服务不支持在 Firefox 上使用，请选用腾讯云语音转文字服务。");let r=!1,s=!1;const a=new o;a.lang=t,a.interimResults=!!n.onInterim,a.continuous=!n.stopOnFirstSentence,a.addEventListener("error",(e=>{var t;i("error 事件",e),"aborted"===e.error&&r||(r=!0,null===(t=n.onError)||void 0===t||t.call(n,new Error(`${v[e.error]||e.error+". "}${e.message||""}`)))}));const l=[];return a.addEventListener("result",(e=>{const t=e.results[e.resultIndex],r=t[0].transcript;if(t.isFinal){var s;const e=r.replace(x,(function(e){return e.toUpperCase()}));i("识别到一句完整的话：",e),null===(s=n.onSentence)||void 0===s||s.call(n,e),l.push(e)}else{var a;i("识别到一句话的临时结果：",r),null===(a=n.onInterim)||void 0===a||a.call(n,r)}})),a.addEventListener("nomatch",(e=>{var t;i("nomatch 事件",e),s=!0,null===(t=n.onError)||void 0===t||t.call(n,new Error(`${this.service.name}无法准确识别你的语音，请确保在安静的环境中，并吐字清晰。`))})),a.addEventListener("end",(e=>{var t;i("end 事件",e,"识别出来的文本：",l,`是否已经中断：${r}`,`是否已经 nomatch：${s}`),r||s||null===(t=n.onStop)||void 0===t||t.call(n,l)})),a.start(),{stop:()=>{i("调用 stop 方法"),a.stop()},abort:()=>{i("调用 abort 方法"),r=!0,a.abort()}}}mediaStream(e){return Promise.reject(new Error("划词翻译的内置语音转文字服务只支持通过麦克风使用。"))}}const h=new p},74070:(e,t,n)=>{n.d(t,{h:()=>k});n(33873),n(69375),n(47010);var r=n(14041),s=n(19687),a=n(20916),l=n(78220),i=n(61707),o=n(92170),c=n(60244),u=n(12128),d=n(16224),v=n(74874),x=n.n(v),m=n(25148),p=n(24671),h=n(6839),g=n(29842),f=n(72431),j=n(26964),w=n(31085);const y=50,C=new u.y("sttLimit",y),b=x()(d.g2,["tipForSTTClosed"]);function k(e){const{isLarge:t,isSmall:n,iconSize:u,onSelect:d,portalContainer:v}=e,[x,k]=(0,m.A)(b),[S,I]=(0,r.useState)(!1),[A,R]=(0,r.useState)(f.eA.WebSpeech),[$,P]=(0,r.useState)(""),[z,L]=(0,r.useState)(""),[N,T]=(0,r.useState)(""),{serviceImplement:E,langMap:F}=(0,r.useMemo)((()=>{switch(A){case f.eA.TencentRealtime:return{serviceImplement:h.Er,langMap:h.AH};case f.eA.WebSpeech:return{serviceImplement:p.u8,langMap:p.HO}}}),[A]);return(0,r.useEffect)((()=>{switch(A){case f.eA.TencentRealtime:P(h.aN.defaultLang);break;case f.eA.WebSpeech:P(p.ql.defaultLang)}}),[A]),(0,r.useEffect)((()=>{if(!S)return;const e=[];let t,n=!1;const r=e=>{window.alert((0,g.H8)(e).message),I(!1)};return E.microphone({lang:$,options:{stopOnFirstSentence:!0,onError:r,onSentence:t=>{e.push(t),L(e.join(""))},onInterim:t=>{T(e.join("")+t)},onStop:e=>{e.length?(C.addOne(),d(e.join(""))):window.alert("未识别出任何文本，请重试。"),I(!1)}}}).then((e=>{n?null==e||e.abort():t=e}),r),()=>{var e;n=!0,null===(e=t)||void 0===e||e.abort(),L(""),T("")}}),[S,$,d,E]),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(s.$,{icon:(0,w.jsx)(c.x,{iconSize:u}),small:n,large:t,minimal:!0,title:"语音翻译",onClick:p.Zj?()=>{x&&!x.tipForSTTClosed&&(window.alert("语音翻译功能目前只有在你的电脑能访问外网的情况下才能使用。未来的版本中会改善此情况，届时会另行通知。"),k({tipForSTTClosed:!0})),C.isOver().then((e=>{if(e){const e=C.dateEnd;window.alert(`非会员用户每七天只能使用 ${y} 次语音翻译功能，下次重置时间：${e}。成为会员即可解除此限制。`)}else I(!0)}))}:()=>{window.alert("Firefox 暂时不支持语音翻译功能，请在其它浏览器上使用。未来的版本中会添加对 Firefox 浏览器的支持，届时会另行通知。")}}),(0,w.jsxs)(a.l,{isOpen:S,enforceFocus:!1,portalContainer:v,children:[(0,w.jsxs)("div",{className:l.sar,children:[(0,w.jsxs)("div",{style:{marginBottom:10},children:["选择服务：",(0,w.jsx)(i.g,{onChange:e=>{R(e.currentTarget.value)},large:t,value:A,children:j.OR.map((e=>(0,w.jsx)("option",{value:e.id,children:e.name},e.id)))}),"切换语种：",(0,w.jsx)(i.g,{onChange:e=>{P(e.currentTarget.value)},large:t,value:$,children:Object.keys(F).map((e=>(0,w.jsx)("option",{value:e,children:F[e]||e},e)))})]}),(0,w.jsx)(o.M,{value:z||N,readOnly:!0,placeholder:"请讲，我正在听……"})]}),(0,w.jsx)("div",{className:l.DBf,children:(0,w.jsx)("div",{className:l.Nu2,children:(0,w.jsx)(s.$,{large:t,onClick:()=>{I(!1)},children:"取消"})})})]})]})}},98009:(e,t,n)=>{n.d(t,{m:()=>j});n(33873),n(10865),n(47010);var r=n(51127),s=n.n(r),a=n(14041),l=n(19687),i=n(23590),o=n(20916),c=n(78220),u=n(63820),d=n(31085);function v(e){const{fileInputProps:t,initialText:n="请选择",onInputChange:r}=e,[s,l]=(0,a.useState)(!1),[i,o]=(0,a.useState)(n);return(0,d.jsx)(u.z,{text:i,hasSelection:s,buttonText:"浏览",onInputChange:e=>{var t;const s=null===(t=e.target.files)||void 0===t?void 0:t[0];s?(l(!0),o(s.name)):(l(!1),o(n)),null==r||r(e)},...t})}var x=n(41938),m=n(74874),p=n.n(m),h=n(16224),g=n(25148);const f=p()(h.g2,["localOCR","ocrService"]);function j(e){var t;const{isLarge:n,isSmall:r,iconSize:u,onSelect:m,portalContainer:p}=e,[h,j]=(0,g.A)(f),[w,y]=(0,a.useState)(""),[C,b]=(0,a.useState)(!1),k="tesseractocr"===(null==h?void 0:h.ocrService),[S,I]=(0,a.useState)(!1),A=()=>{I(!1),y(""),b(!1)};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(l.$,{icon:(0,d.jsx)(i.I,{icon:"media",size:u}),small:r,large:n,minimal:!0,title:"图片翻译",onClick:()=>{I(!0)}}),(0,d.jsx)(o.l,{isOpen:S,enforceFocus:!1,portalContainer:p,children:(0,d.jsxs)("form",{children:[(0,d.jsxs)("div",{className:c.sar,children:[(0,d.jsx)("p",{children:(0,d.jsx)(v,{initialText:"选择图片",onInputChange:e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];n&&function(e){return new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>t(r.result),r.onerror=()=>n(r.error),r.readAsDataURL(e)}))}(n).then((e=>{k?(y(e),b(!1)):(A(),m(e))}),(e=>{window.alert(`读取图片失败，错误消息：${e.message}`)}))},fileInputProps:{inputProps:{accept:"image/*",required:!0},fill:!0,large:n}})}),(0,d.jsxs)("p",{children:["或者"," ",(0,d.jsx)(l.$,{small:r,large:n,onClick:()=>{s().runtime.sendMessage({action:"read clipboard image"}).then((e=>{e?k?(y(e),b(!0)):(A(),m(e)):window.alert("剪切板内没有图片。")}))},children:"读取剪切板内的图片"}),C&&(0,d.jsx)("span",{style:{marginLeft:5},children:"已读取"})]}),k&&w&&(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{children:["选择语种：",(0,d.jsx)(x._,{value:(null==h||null===(t=h.localOCR)||void 0===t?void 0:t.lang)||f.localOCR.lang,onChange:e=>{j((t=>{t.localOCR.lang=e}))},isLarge:n,isSmall:r,portalContainer:p})]}),(0,d.jsx)(l.$,{small:r,large:n,intent:"primary",onClick:()=>{A(),m(w)},children:"确定"})]})]}),(0,d.jsx)("div",{className:c.DBf,children:(0,d.jsx)("div",{className:c.Nu2,children:(0,d.jsx)(l.$,{small:r,large:n,type:"reset",onClick:A,children:"取消"})})})]})})]})}},91307:(e,t,n)=>{n.d(t,{$:()=>m,A:()=>p});n(27534);var r=n(51127),s=n.n(r),a=n(25812),l=n(18392),i=n(23590),o=n(78107),c=n(78220),u=n(59468),d=n(73345),v=n(31085);const x={small:12,middle:16,large:20};function m(){s().runtime.sendMessage({action:"open options page",suffix:"#/store"}).catch((e=>{window.alert("打开设置页时发生了一个错误。错误消息：："+(null==e?void 0:e.message))}))}function p(e){const{source:t,setSource:n,options:r,setOptions:m,children:p,size:h,portalContainer:g}=e;if(!r)return null;const f="large"===h,j=(e,t)=>{m((n=>{const r=n[t],s=r.indexOf(e);s>=0?r.splice(s,1):4===r.length&&r.pop(),r.unshift(e)}))};return(0,v.jsxs)(l.Z,{className:"quick-settings",children:[(0,v.jsxs)("div",{children:[(0,v.jsx)(a.A,{lang:t,setLang:e=>{n(e),j(e,"recentUseLangFrom")},addAuto:!0,recentUse:r.recentUseLangFrom,size:h,portalContainer:g}),(0,v.jsx)(i.I,{icon:"arrow-right",size:x[h],style:{margin:"0 10px"}}),(0,v.jsx)(a.A,{lang:r.destination,setLang:e=>{m({destination:e}),j(e,"recentUseLangTo")},recentUse:r.recentUseLangTo,size:h,portalContainer:g})]}),(0,v.jsx)("div",{children:(0,v.jsx)(d.f,{useShortName:!0,selectedAPIs:r.selectedAPIs,onChange:e=>{m({selectedAPIs:e})}})}),(0,v.jsxs)("div",{children:[(0,v.jsx)(o.Sc,{inline:!0,label:"自动朗读",large:f,checked:r.autoPlay,onChange:e=>{m({autoPlay:e.target.checked})}}),(0,v.jsx)(o.Sc,{inline:!0,label:"自动复制",checked:r.autoCopy,onChange:e=>{m({autoCopy:e.target.checked})}})]}),(0,v.jsx)(u.y,{value:r.panelSize,onChange:e=>{m({panelSize:e})}}),p&&(0,v.jsx)("div",{children:p}),(0,v.jsx)("a",{onClick:()=>{var e;s().runtime.sendMessage({action:"open options page",suffix:e}).catch((e=>{window.alert("打开设置页时发生了一个错误。错误消息：："+(null==e?void 0:e.message))}))},className:c.KJG,children:"打开完整设置"})]})}},62269:(e,t,n)=>{n.d(t,{A:()=>d});n(62234),n(33873),n(69375),n(47010);var r=n(11234),s=n(25148),a=n(74874),l=n.n(a),i=n(16224),o=n(18785),c=n(31085);const u=l()(i.g2,"selectedAPIs");function d(){const[e,t]=(0,s.A)(u);return(0,c.jsx)(c.Fragment,{children:o.v.map((n=>(0,c.jsx)(r.D,{text:n.name,onClick:()=>(e=>{const n=e.id;t((e=>{const t=e.selectedAPIs;t.indexOf(n)<0&&t.push(n)}))})(n),disabled:!e||e.selectedAPIs.includes(n.id)},n.id)))})}},54449:(e,t,n)=>{n.d(t,{A:()=>F,Z:()=>A});n(33873),n(69375),n(10865),n(98376),n(77846),n(47010);var r=n(51127),s=n.n(r),a=n(14041),l=n(19687),i=n(23590),o=n(18392),c=n(22067),u=n(68802),d=n(16342),v=n(78220),x=n(53373),m=n.n(x),p=n(79071),h=n.n(p),g=n(74874),f=n.n(g),j=n(16224),w=n(25812),y=n(66126),C=n(18785),b=n(12752),k=n(76352),S=n(25148),I=n(31085);async function A(e){s().runtime.sendMessage({action:"audio",url:e}).catch((e=>{window.alert("朗读时出错："+(null==e?void 0:e.message))}))}function R(e){const t=e.uri,n=e.size,r=e.style;return(0,I.jsx)(l.$,{style:r,icon:(0,I.jsx)(i.I,{icon:"volume-up",size:N[n]}),small:"small"===n,large:"large"===n,minimal:!0,disabled:!t,onClick:t?()=>A(t):void 0,title:t?"朗读":"不支持此语种"})}function $(e,t){const n="GoogleWeb"===t,r=[];return!e.phonetic||n&&!e.dict||r.push(e.phonetic.map((e=>`${e.name?e.name+" ":""}/${e.value}/`))),e.dict?r.push(...e.dict.map((e=>`${e.pos?e.pos+(n?": ":" "):""}${e.terms.join(", ")}`))):e.result&&r.push(...e.result),s().runtime.sendMessage({action:"write to clipboard",text:r.join("\n")})}function P(e){e.stopPropagation()}const z=/\b[A-Z\s\-'a-z]+\b/g;function L(e,t){const n=Array.from(e.matchAll(z)),r=e.split(z);return(0,I.jsx)(I.Fragment,{children:r.map(((e,r)=>{const s=n[r];return(0,I.jsxs)(a.Fragment,{children:[e,s?(0,I.jsx)("a",{onClick:()=>t(s[0]),children:s[0]}):""]},r)}))})}const N={small:12,middle:16,large:20};function T(e){switch(e){case"美":return"英语(美国)";case"英":return"英语(英国)";default:return}}const E={...f()(j.g2,"googleHidePhonetic"),...f()(j.Ne,["tipForGoogleTranslateClosed","tipForDeepLLimitClosed"])};function F(e){var t;const{apiId:n,result:{loading:r,result:s}={loading:!1,result:null},queryResult:x,autoCopy:p=!1,autoPlay:g=!1,wordClickable:f=!0,setQuery:j=h(),size:z="small",collapse:F,onCollapseChange:O,portalContainer:_}=e,[U,D]=(0,S.A)(E),M=N[z],q="small"===z,Z="large"===z,[K,W]=(0,a.useState)("duplicate"),[H,G]=(0,a.useState)(),B=C.v.find((e=>e.id===n))||{name:n,id:n},J="GoogleWeb"===n&&!(null==U||!U.googleHidePhonetic),Q=()=>{W("tick"),G("success"),window.setTimeout((()=>{W("duplicate"),G(void 0)}),1e3)};(0,a.useEffect)((()=>{var e;s&&(g&&s.text.length<30&&A({apiId:n,source:s.from,text:s.text,ttsURI:(null===(e=s.phonetic)||void 0===e?void 0:e[0].ttsURI)||s.ttsURI}))}),[n,g,s]),(0,a.useEffect)((()=>{s&&p&&$(s,n).then((e=>{e?Q():window.alert("自动复制翻译结果失败，请稍后重试。")}),(e=>{window.alert(`自动复制翻译结果时发生了一个错误：${null==e?void 0:e.message}`)}))}),[s,p,n]);const V=b.K[n];return(0,I.jsxs)(o.Z,{className:"result-block",onClick:P,children:["GoogleWeb"===n&&!(null!=U&&U.tipForGoogleTranslateClosed)&&(0,I.jsxs)(c.P,{intent:"warning",icon:null,children:[(0,I.jsx)("p",{children:"谷歌翻译可能需要额外配置才能使用。"}),(0,I.jsx)(l.A,{small:!0,style:{visibility:"visible"},intent:"primary",href:"https://hcfy.app/blog/2022/09/28/ggg",target:"_blank",children:"查看详情"}),(0,I.jsx)("a",{style:{marginLeft:15},onClick:()=>{D({tipForGoogleTranslateClosed:!0})},children:"不再提示"})]}),"DeepLWeb"===n&&!(null!=U&&U.tipForDeepLLimitClosed)&&(0,I.jsxs)(c.P,{intent:"warning",icon:null,children:[(0,I.jsx)("p",{children:"DeepL 首次翻译速度较慢，请耐心等待。若遇到问题（报错、翻译结果不全等）请点击下方按钮。"}),(0,I.jsx)(l.A,{small:!0,style:{visibility:"visible"},intent:"primary",href:"https://hcfy.app/docs/services/free/#deepl",target:"_blank",children:"查看解决方案"}),(0,I.jsx)("a",{style:{marginLeft:15},onClick:()=>{D({tipForDeepLLimitClosed:!0})},children:"不再提示"})]}),(0,I.jsxs)("div",{className:"legend",children:[(0,I.jsxs)("div",{className:"legend-left",children:[(0,I.jsx)("span",{className:"api-ico",style:V?{backgroundImage:`url(${V})`}:void 0}),(0,I.jsx)(u.H6,{children:B.name}),s&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(w.A,{lang:s.from,setLang:x,size:"small",maxHeight:212,portalContainer:_,children:(0,I.jsxs)("span",{className:"source",children:[(0,I.jsx)("span",{className:"source-text",children:s.from}),(0,I.jsx)(i.I,{icon:"caret-down",size:12})]})}),(0,I.jsx)(R,{uri:{apiId:n,source:s.from,text:s.text,ttsURI:(null===(t=s.phonetic)||void 0===t?void 0:t[0].ttsURI)||s.ttsURI},size:z})]})]}),(0,I.jsxs)("div",{style:{flexShrink:0},children:[void 0!==F&&(0,I.jsx)(l.$,{minimal:!0,small:q,large:Z,title:F?"展开":"收起",onClick:()=>{O&&O(!F)},icon:(0,I.jsx)(i.I,{icon:F?"chevron-down":"chevron-up",size:M+2})}),(0,I.jsx)(l.$,{onClick:()=>{s&&$(s,n).then((e=>{e?Q():window.alert("复制翻译结果失败，请稍后重试。")}),(e=>{window.alert(`复制翻译结果时发生了一个错误：${null==e?void 0:e.message}`)}))},disabled:!s||!!s.error,icon:(0,I.jsx)(i.I,{icon:K,size:M}),minimal:!0,small:q,large:Z,intent:H,title:"复制翻译结果"}),(0,I.jsx)(l.A,{disabled:!(null!=s&&s.link),target:"_blank",href:(null==s?void 0:s.link)||"",icon:(0,I.jsx)(i.I,{icon:"share",size:M}),minimal:!0,small:q,large:Z,title:"查看详细结果"})]})]}),(0,I.jsxs)(d.S,{isOpen:!F,children:[(0,I.jsxs)("div",{style:{display:r?"block":"none"},children:[(0,I.jsx)("p",{className:m()({[v.w24]:r}),children:"1"}),(0,I.jsx)("p",{className:m()({[v.w24]:r}),style:{width:"150px"},children:"1"})]}),(null==s?void 0:s.error)&&(0,I.jsx)("div",{className:"error",children:(0,I.jsx)(k.Q,{error:s.error,onRetry:()=>x()})}),(null==s?void 0:s.phonetic)&&!J&&(0,I.jsx)("div",{className:"phonetic",children:s.phonetic.map(((e,t)=>(0,I.jsxs)("div",{className:"phonetic-item",style:{maxWidth:"100%"},children:[e.name&&(0,I.jsx)("span",{style:{flexShrink:0,marginRight:5},children:e.name}),e.value&&(0,I.jsxs)(y.A,{children:["/",e.value,"/"]}),e.ttsURI&&(0,I.jsx)(R,{style:{flexShrink:0},uri:{apiId:n,source:T(e.name)||s.from,text:s.text,ttsURI:e.ttsURI},size:z})]},t)))}),s&&(0,I.jsxs)("div",{className:"common-result",children:[s.dict&&(0,I.jsx)("div",{className:"dict",children:s.dict.map(((e,t)=>{const n=e.terms.join(", ");return(0,I.jsxs)("p",{children:[e.pos&&(0,I.jsx)("span",{className:"dict-pos",children:e.pos}),f?L(n,j):n]},t)}))}),!s.dict&&s.result&&(0,I.jsx)("div",{className:"general-result",children:s.result.map(((e,t)=>(0,I.jsxs)("p",{children:[e,(0,I.jsx)(R,{uri:{text:e,apiId:n,source:null==s?void 0:s.to},size:z})]},t)))})]})]})]})}},96072:(e,t,n)=>{n.d(t,{j:()=>y});n(33873),n(47010);var r=n(46313),s=n(22067),a=n(19687),l=n(23590),i=n(14041),o=n(64795),c=n(85746),u=n(23593),d=n(74874),v=n.n(d),x=n(16224),m=n(25148),p=n(51127),h=n.n(p),g=n(31085);const f=location.href.startsWith(h().runtime.getURL("/panel.html")),j=u.c_.ctrl,w={...v()(x.g2,["textAreaShortKey","autoPaste"]),...v()(x.Ne,["tipForPasteTranslateClosed"])},y=(0,i.forwardRef)((function(e,t){const{isSmall:n,isLarge:u,value:d,onChange:v,onTranslate:p,iconSize:y,hideBtn:C,auto:b}=e,[k,S]=(0,m.A)(w),I=(null==k?void 0:k.textAreaShortKey)||w.textAreaShortKey,A=(0,i.useRef)(null),[R,$]=(0,i.useState)(!1),{msg:P,textareaPlaceholder:z}=(0,i.useMemo)((()=>{const e=(I===x.o0.ctrlEnter?"Ctrl / ⌘ + ":"")+"Enter";return{msg:`翻译文本框内的文本(${e})`,textareaPlaceholder:`按下 ${e} 也可以翻译文本框内的文本`}}),[I]),L=(0,c.y)(),N=(0,o.W)(A.current);return(0,i.useEffect)((()=>{if(!b)return;const e=setTimeout(p,1e3);return()=>{clearTimeout(e)}}),[b,p]),(0,i.useImperativeHandle)(t,(()=>({select(){var e;null===(e=A.current)||void 0===e||e.select()}})),[]),(0,g.jsxs)("div",{className:"query-text",children:[(0,g.jsx)(r.f,{fill:!0,small:n,large:u,inputRef:A,value:d,placeholder:z,onChange:e=>{v(e.target.value)},onKeyDown:e=>{if(f||e.stopPropagation(),13===e.keyCode){if(I===x.o0.enter){if(e.preventDefault(),e[j]){const t=e.currentTarget,n=t.selectionStart,r=t.selectionEnd,s=t.value,a=s.substring(0,n)+"\n"+s.substring(r);return v(a),void setTimeout((()=>{t.setSelectionRange(n+1,n+1)}))}return e.preventDefault(),void p()}e[j]&&(e.preventDefault(),p())}},onPaste:null!=k&&k.autoPaste?e=>{e.clipboardData.getData("text").trim()&&($(!0),setTimeout((()=>{p(e.target.value)})))}:void 0}),!(null!=k&&k.tipForPasteTranslateClosed)&&R&&(0,g.jsxs)(s.P,{title:"自 v8.6.5 起，在文本框中粘贴文本后会立刻触发翻译。",children:["你可以在",(0,g.jsx)("a",{onClick:()=>{h().runtime.sendMessage({action:"open options page",suffix:"#/panel"})},children:"“设置” - “翻译面板”"})," ","- “文本框”中关闭此功能。",(0,g.jsx)("a",{onClick:()=>{S({tipForPasteTranslateClosed:!0})},children:"不再提示"})]}),(0,g.jsx)(a.$,{className:"translate-btn",style:{display:C?"none":void 0,right:18+(N.v&&L||0),bottom:8+(N.h&&L||0)},title:P,icon:(0,g.jsx)(l.I,{icon:"search",size:y}),small:n,large:u,intent:"primary",onClick:()=>{var e;p(),null===(e=A.current)||void 0===e||e.focus()}}),(0,g.jsx)(a.$,{className:"clear-btn",style:{position:"absolute",display:d?void 0:"none",right:11+(N.v&&L||0),top:11},minimal:!0,title:"清空文本",icon:(0,g.jsx)(l.I,{icon:"cross",size:y}),small:n,large:u,onClick:()=>{var e;v(""),null===(e=A.current)||void 0===e||e.focus()}})]})}))},20760:(e,t,n)=>{n.d(t,{A:()=>l});n(33873),n(47010);var r=n(51127),s=n.n(r),a=n(14041);function l(e,t,n){const[r,l]=(0,a.useState)(!1);(0,a.useEffect)((()=>{s().runtime.sendMessage({action:"is text in favorites",text:e}).then(l)}),[e]);const i=(0,a.useCallback)((()=>{s().runtime.sendMessage({action:"delete record in favorites",text:e}).catch((e=>{window.alert(`从收藏夹中删除时发生了一个错误：${null==e?void 0:e.message}`)})),l(!1)}),[e]),o=(0,a.useCallback)((()=>{e&&n&&(t({type:"save favorites",text:e,selectedAPIs:n}),l(!0))}),[t,n,e]);return{isInFavorites:r,saveOrDelete:r?i:o}}},81152:(e,t,n)=>{n.d(t,{L:()=>f});n(33873),n(10865),n(47010);var r=n(51127),s=n.n(r),a=n(14041),l=(n(62234),n(83813)),i=n(17546),o=n.n(i),c=n(41263),u=n.n(c);const d={results:{}},v=(e,t)=>(0,l.jM)(e,(e=>{switch(t.type){case"set loading":return void(t.value?e.results[t.apiId]={loading:!0,result:null}:u()(e.results,[t.apiId,"loading"],!1));case"set result":return void u()(e.results,[t.apiId,"result"],t.result);case"clear results":return void(e.results={});case"save favorites":const n=t.selectedAPIs,r={};return o()(e.results,((e,t)=>{if(!e||e.loading)return;const s=e.result;s&&n.includes(t)&&(r[t]=(0,l.c2)(s))})),void s().runtime.sendMessage({action:"save favorite",record:{text:t.text,results:r}}).catch((e=>{window.alert(`保存到收藏夹时发生了一个错误：${null==e?void 0:e.message}`)}))}}));var x=n(5877),m=n(38285),p=n.n(m),h=n(65707),g=n.n(h);function f(e,t,n,r,l){const i=(0,a.useRef)(""),[o,c]=(0,a.useReducer)(v,d),u=(0,a.useRef)();u.current=l;const m=(0,x.A)(e),h=(0,x.A)(n),f=(0,x.A)(t),j=(0,x.A)(r),w=async(e,t,n,r=(()=>!1))=>{let a;c({type:"set loading",apiId:t,value:!0});try{a=await s().runtime.sendMessage({action:"translate",data:{apiCode:t,text:e,source:n}})}catch(n){if(r())return;return c({type:"set loading",apiId:t,value:!1}),void c({type:"set result",apiId:t,result:{text:e,error:{message:(null==n?void 0:n.message)||"未知错误"}}})}if(!r()&&(c({type:"set loading",apiId:t,value:!1}),a)){if("GoogleWeb"===t){const e=a.from;e&&"中文(简体)"!==e&&s().storage.local.set({latestSource:e})}c({type:"set result",apiId:t,result:a})}};return(0,a.useEffect)((()=>{var s;if(!r)return;if(e===m&&n===h&&r===j)return;c({type:"clear results"});const a=p()();if(i.current=a,!e)return;null===(s=u.current)||void 0===s||s.call(u);const l=()=>a!==i.current;null==t||t.forEach((t=>{w(e,t,n,l)}))}),[r,e,t,n]),(0,a.useEffect)((()=>{if(!f||!t)return;const r=g()(t,f);if(!r.length)return;const s=i.current,a=()=>s!==i.current;r.forEach((t=>{o.results[t]||w(e,t,n,a)}))}),[e,o.results,t,n]),{results:o,queryResult:w,dispatchResults:c}}},4225:(e,t,n)=>{n.d(t,{A:()=>v});var r=n(51127),s=n.n(r),a=n(83813),l=n(38285),i=n.n(l),o=n(14041);let c="";const u=document.querySelector('link[rel=icon],link[rel="shortcut icon"]');c=u?u.href:window.location.origin+"/favicon.ico";const d=(0,a.jM)(((e,t)=>{if("save translate record"===t.type){const n=Date.now(),r=i()(n+"-");return e.translateId=r,void s().runtime.sendMessage({action:"save history record",record:{text:t.text,date:n,url:window.location.href,title:document.title,favicon:c}}).catch((e=>{window.alert(`保存历史记录时发生了一个错误：${null==e?void 0:e.message}`)}))}}));function v(){return(0,o.useReducer)(d,{translateId:""})}},74703:(e,t,n)=>{n.d(t,{O:()=>p});n(62234),n(10865);var r=n(51127),s=n.n(r),a=n(74874),l=n.n(a),i=n(16224),o=n(78220),c=n(19687),u=n(14041),d=n(91307),v=n(31085);const x=l()(i.g2,["ocrService"]);function m(){return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{children:"正在从截图中提取文本，请稍候……"}),(0,v.jsx)("div",{className:`${o.E4k} ${o.KJG}`,children:(0,v.jsx)("div",{style:{marginTop:4},children:(0,v.jsx)("a",{href:"https://hcfy.app/docs/guides/screenshot#slow",target:"_blank",rel:"noreferrer",children:"为什么还没有提取成功？"})})})]})}function p(e){return(0,u.useCallback)((async t=>{const{ocrService:n}=await s().storage.local.get(x),r="tesseractocr"===n,a=null==e?void 0:e.show({message:r?(0,v.jsx)(m,{}):"正在从截图中提取文本，请稍候……",timeout:0});return s().runtime.sendMessage({action:"ocr",dataURI:t}).then((t=>(a&&(null==e||e.dismiss(a)),t)),(t=>(null==e||e.show({message:null!=t&&t.message.includes("会员")?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("p",{children:t.message}),(0,v.jsx)(c.$,{onClick:d.$,small:!0,children:"开通会员"})]}):`从图片中提取文字时发生了一个错误：${null==t?void 0:t.message}`,intent:"warning",timeout:0},a),Promise.reject(t))))}),[e])}},41938:(e,t,n)=>{n.d(t,{_:()=>u});var r=n(70041),s=n(11234),a=n(19687);n(69375),n(48605);const l=[],i=[{text:"中文(简体)",value:"chi_sim"},{text:"中文(繁体)",value:"chi_tra"},{text:"英语",value:"eng"},{text:"日语",value:"jpn"},{text:"法语",value:"fra"},{text:"韩语",value:"kor"},{text:"德语",value:"deu"},{text:"俄语",value:"rus"},{text:"泰语",value:"tha"},{text:"南非语",value:"afr"},{text:"阿姆哈拉语",value:"amh"},{text:"阿拉伯语",value:"ara"},{text:"阿萨姆语",value:"asm"},{text:"阿塞拜疆语",value:"aze"},{text:"阿塞拜疆语(西里尔)",value:"aze_cyrl"},{text:"白俄罗斯语",value:"bel"},{text:"孟加拉语",value:"ben"},{text:"藏语",value:"bod"},{text:"波斯尼亚语",value:"bos"},{text:"保加利亚语",value:"bul"},{text:"加泰罗尼亚语(瓦伦西亚)",value:"cat"},{text:"宿务语",value:"ceb"},{text:"捷克语",value:"ces"},{text:"切罗基语",value:"chr"},{text:"威尔士语",value:"cym"},{text:"丹麦语",value:"dan"},{text:"宗喀语",value:"dzo"},{text:"希腊语(现代)",value:"ell"},{text:"中古英语",value:"enm"},{text:"世界语",value:"epo"},{text:"爱沙尼亚语",value:"est"},{text:"巴斯克语",value:"eus"},{text:"波斯语",value:"fas"},{text:"芬兰语",value:"fin"},{text:"德文尖角体",value:"frk"},{text:"中古法语",value:"frm"},{text:"爱尔兰语",value:"gle"},{text:"希腊语(古代)",value:"grc"},{text:"古吉拉特语",value:"guj"},{text:"海地克里奥尔语",value:"hat"},{text:"希伯来语",value:"heb"},{text:"印地语",value:"hin"},{text:"克罗地亚语",value:"hrv"},{text:"匈牙利语",value:"hun"},{text:"因纽特语",value:"iku"},{text:"印度尼西亚语",value:"ind"},{text:"冰岛语",value:"isl"},{text:"意大利语",value:"ita"},{text:"意大利语(古代)",value:"ita_old"},{text:"爪哇语",value:"jav"},{text:"坎纳达语",value:"kan"},{text:"格鲁吉亚语",value:"kat"},{text:"格鲁吉亚语(古代)",value:"kat_old"},{text:"哈萨克语",value:"kaz"},{text:"高棉语",value:"khm"},{text:"吉尔吉斯语",value:"kir"},{text:"库尔德语",value:"kur"},{text:"老挝语",value:"lao"},{text:"拉丁语",value:"lat"},{text:"拉脱维亚语",value:"lav"},{text:"立陶宛语",value:"lit"},{text:"马拉雅拉姆语",value:"mal"},{text:"马拉地语",value:"mar"},{text:"马其顿语",value:"mkd"},{text:"马耳他语",value:"mlt"},{text:"马来语",value:"msa"},{text:"缅甸语",value:"mya"},{text:"尼泊尔语",value:"nep"},{text:"荷兰语(弗拉芒)",value:"nld"},{text:"挪威语",value:"nor"},{text:"奥里亚语",value:"ori"},{text:"旁遮普语",value:"pan"},{text:"波兰语",value:"pol"},{text:"葡萄牙语",value:"por"},{text:"普什图语",value:"pus"},{text:"罗马尼亚语",value:"ron"},{text:"梵语",value:"san"},{text:"僧伽罗语",value:"sin"},{text:"斯洛伐克语",value:"slk"},{text:"斯洛维尼亚语",value:"slv"},{text:"西班牙语",value:"spa"},{text:"西班牙语(古代)",value:"spa_old"},{text:"阿尔巴尼亚语",value:"sqi"},{text:"塞尔维亚语",value:"srq"},{text:"塞尔维亚语(拉丁)",value:"srq_latn"},{text:"斯瓦希里语",value:"swa"},{text:"瑞典语",value:"swe"},{text:"叙利亚语",value:"syr"},{text:"泰米尔语",value:"tam"},{text:"泰卢固语",value:"tel"},{text:"塔吉克",value:"tgk"},{text:"他加禄语",value:"tgl"},{text:"提格里尼亚",value:"tir"},{text:"土耳其语",value:"tur"},{text:"维吾尔语",value:"uig"},{text:"乌克兰语",value:"ukr"},{text:"乌尔都语",value:"urd"},{text:"乌兹别克语",value:"uzb"},{text:"乌兹别克语(西里尔)",value:"uzb_cyrl"},{text:"越南语",value:"vie"},{text:"意第绪语",value:"yid"}].reduce(((e,t)=>(l.push(t.value),e[t.value]=t.text,e)),{});var o=n(31085);const c=(e,{handleClick:t,modifiers:n})=>n.matchesPredicate?(0,o.jsx)(s.D,{onClick:t,active:n.active,text:i[e]},e):null;function u(e){const{value:t,onChange:n,isSmall:s,isLarge:u,portalContainer:d}=e;return(0,o.jsx)(r.l,{filterable:!1,activeItem:t,items:l,itemRenderer:c,onItemSelect:n,popoverProps:{portalContainer:d,targetTagName:"span"},children:(0,o.jsx)(a.$,{rightIcon:"caret-down",small:s,large:u,children:i[t]})})}},81215:(e,t,n)=>{n.d(t,{W:()=>a});n(48605),n(8697),n(8096),n(98376),n(47146),n(14293);const r=/^[A-Z]?[a-z]+([A-Z][a-z]*)+$/,s=/^([A-Za-z]+_)+[A-Za-z]+$/;function a(e,t){let n=e.trim();return t&&(t.sourceTransformNoBr&&(n=n.replace(/\r?\n/g," ")),t.sourceTransformNoComment&&(n=n.replace(/\/\//g," ")),t.sourceTransformRegExps&&(n=t.sourceTransformRegExps.reduce(((e,t)=>{let n;try{n=new RegExp(t.pattern,t.flags)}catch(t){return e}return e.replace(n,t.replaceTo||"")}),n)),t.sourceTransformNCaml&&(r.test(n)?n=n.replace(/[A-Z]/g,((e,t)=>0===t?e.toLowerCase():" "+e.toLowerCase())):s.test(n)&&(n=n.replace(/_/g," "))),t.sourceLower&&(n=n.toLowerCase())),n}},51018:(e,t,n)=>{n.d(t,{$5:()=>l.$,Z5:()=>v,Z4:()=>i.Z,$2:()=>c,qs:()=>s,_:()=>o,fm:()=>a.f});n(33873),n(69375),n(47010);var r=n(17546);function s(e){const t=[];return r(e,((e,n)=>{const r=Array.isArray(e)?e:[e];t.push(...r.map((e=>`${n}=${null==e?"":encodeURIComponent(e)}`)))})),t.join("&")}n(29516);var a=n(64347),l=n(37581),i=n(2643);const o=AbortSignal.timeout?function(e){return AbortSignal.timeout(e)}:function(e){const t=new AbortController;return setTimeout((()=>{t.abort()}),e),t.signal};n(93648),n(10865),n(7212);function c(e){let t=null;return function(){return t||(t=e().finally((()=>{t=null})),t)}}n(12980),n(15400),n(51934),n(97770),n(99687),n(97107);function u(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class d extends Error{constructor(e,t,n){const r=t instanceof Response;var s;super(r?`Request failed with status code ${t.status}.`:(s=t)instanceof Error?s.message:"Unknown error. See `error.cause` for details."),u(this,"request",void 0),u(this,"response",void 0),u(this,"url",void 0),this.request=n,this.url=e,this.name="FetchError",r?this.response=t:this.cause=t}}function v(e,t){return fetch(e,t).then((n=>{if(!n.ok)throw new d(e,n,t);return n}),(n=>{throw new d(e,n,t)}))}},38232:(e,t,n)=>{n(6229),n(67863),n(23810),n(3161)}}]);