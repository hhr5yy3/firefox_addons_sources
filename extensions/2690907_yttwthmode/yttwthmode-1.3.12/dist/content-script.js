(()=>{var e={150:function(e,t){var s,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,s=function(e){"use strict";if("undefined"==typeof browser||Object.getPrototypeOf(browser)!==Object.prototype){const t="The message port closed before a response was received.",s="Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)",r=e=>{const r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(r).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class n extends WeakMap{constructor(e,t){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const a=(t,s)=>(...r)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):s.singleCallbackArg||r.length<=1&&!1!==s.singleCallbackArg?t.resolve(r[0]):t.resolve(r)},g=e=>1==e?"argument":"arguments",i=(e,t,s)=>new Proxy(t,{apply:(t,r,n)=>s.call(r,e,...n)});let m=Function.call.bind(Object.prototype.hasOwnProperty);const o=(e,t={},s={})=>{let r=Object.create(null),n={has:(t,s)=>s in e||s in r,get(n,l,A){if(l in r)return r[l];if(!(l in e))return;let c=e[l];if("function"==typeof c)if("function"==typeof t[l])c=i(e,e[l],t[l]);else if(m(s,l)){let t=((e,t)=>function(s,...r){if(r.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${g(t.minArgs)} for ${e}(), got ${r.length}`);if(r.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${g(t.maxArgs)} for ${e}(), got ${r.length}`);return new Promise(((n,g)=>{if(t.fallbackToNoCallback)try{s[e](...r,a({resolve:n,reject:g},t))}catch(a){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,a),s[e](...r),t.fallbackToNoCallback=!1,t.noCallback=!0,n()}else t.noCallback?(s[e](...r),n()):s[e](...r,a({resolve:n,reject:g},t))}))})(l,s[l]);c=i(e,e[l],t)}else c=c.bind(e);else if("object"==typeof c&&null!==c&&(m(t,l)||m(s,l)))c=o(c,t[l],s[l]);else{if(!m(s,"*"))return Object.defineProperty(r,l,{configurable:!0,enumerable:!0,get:()=>e[l],set(t){e[l]=t}}),c;c=o(c,t[l],s["*"])}return r[l]=c,c},set:(t,s,n,a)=>(s in r?r[s]=n:e[s]=n,!0),defineProperty:(e,t,s)=>Reflect.defineProperty(r,t,s),deleteProperty:(e,t)=>Reflect.deleteProperty(r,t)},l=Object.create(e);return new Proxy(l,n)},l=e=>({addListener(t,s,...r){t.addListener(e.get(s),...r)},hasListener:(t,s)=>t.hasListener(e.get(s)),removeListener(t,s){t.removeListener(e.get(s))}}),A=new n((e=>"function"!=typeof e?e:function(t){const s=o(t,{},{getContent:{minArgs:0,maxArgs:0}});e(s)}));let c=!1;const d=new n((e=>"function"!=typeof e?e:function(t,r,n){let a,g,i=!1,m=new Promise((e=>{a=function(t){c||(console.warn(s,(new Error).stack),c=!0),i=!0,e(t)}}));try{g=e(t,r,a)}catch(e){g=Promise.reject(e)}const o=!0!==g&&((l=g)&&"object"==typeof l&&"function"==typeof l.then);var l;if(!0!==g&&!o&&!i)return!1;return(o?g:m).then((e=>{n(e)}),(e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",n({__mozWebExtensionPolyfillReject__:!0,message:t})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)})),!0})),x=({reject:s,resolve:r},n)=>{e.runtime.lastError?e.runtime.lastError.message===t?r():s(new Error(e.runtime.lastError.message)):n&&n.__mozWebExtensionPolyfillReject__?s(new Error(n.message)):r(n)},y=(e,t,s,...r)=>{if(r.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${g(t.minArgs)} for ${e}(), got ${r.length}`);if(r.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${g(t.maxArgs)} for ${e}(), got ${r.length}`);return new Promise(((e,t)=>{const n=x.bind(null,{resolve:e,reject:t});r.push(n),s.sendMessage(...r)}))},h={devtools:{network:{onRequestFinished:l(A)}},runtime:{onMessage:l(d),onMessageExternal:l(d),sendMessage:y.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:y.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},u={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":u},services:{"*":u},websites:{"*":u}},o(e,h,r)};if("object"!=typeof chrome||!chrome||!chrome.runtime||!chrome.runtime.id)throw new Error("This script should only be loaded in a browser extension.");e.exports=r(chrome)}else e.exports=browser},void 0===(r=s.apply(t,[e]))||(e.exports=r)}},t={};function s(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,s),a.exports}(()=>{"use strict";let e,t,r,n,a,g,i,m,o,l,A,c,d,x,y,h,u,p=s(150),f={chatWidth:400,hideChat:!1,leftChat:!1,headerNav:!1,enabledInArchives:!0},b=!1,w=!1,v=0;const k=56,E=()=>{A=document.getElementById("chat-container"),c=document.getElementById("chat"),d=document.getElementById("chatframe"),x=document.querySelector("#show-hide-button"),y=!(!d||x?.querySelector("button"))},C=()=>{h=!!(c||d||A?.querySelector("#chat")),u=!(!h||!l),(y||u&&null===l.getAttribute("hidden")&&!f.enabledInArchives)&&(h=!1),(h||u)&&console.debug(`[yttwthmode] ${u?"archive":"live"} detected`)},T=()=>{b&&h?(document.documentElement.style.overflow="hidden",e.style.marginTop=`${f.headerNav?k:0}px`,a.style.position="static",r.style.width=`calc(100% - ${f.hideChat||y?0:f.chatWidth}px)`,r.style.height=`calc(100vh - ${f.headerNav?k:0}px)`,r.style.maxHeight="none",n&&(n.style.position="unset"),f.leftChat?r.style.left=`${f.hideChat||y||w?0:f.chatWidth}px`:r.style.left="",w&&B(),v=document.documentElement.scrollTop,scroll(0,0)):(document.documentElement.style.overflow="",e.style.marginTop="",a.style.position="",r.style.width="",r.style.height="",r.style.maxHeight="",r.style.left="",n&&(n.style.position=""),h&&scroll(0,v))},I=(e,t)=>{b&&h?(x&&(x.style.display="none"),c.removeAttribute("collapsed"),e.style.width=`${f.chatWidth}px`,e.style.height=`calc(100vh - ${f.headerNav?k:0}px)`,e.style.position="absolute",e.style.top=t||`${f.headerNav?k:0}px`,f.leftChat?(e.style.left="0px",e.style.right=""):(e.style.right="0px",e.style.left=""),f.hideChat?e.style.zIndex=-1:e.style.zIndex="",window.dispatchEvent(new Event("resize"))):(e.style.zIndex="",e.style.width="",e.style.height="",e.style.position="",e.style.top="",e.style.left="",e.style.right="",x&&(x.style.display=""))},P=()=>{E(),c&&(A?(I(A),I(c,"0px")):(I(c),I(d,"")))},N=()=>{b&&h&&!f.headerNav?(m.style.display="none",o.style.display="none"):(m.style.display="",o.style.display="")},$=()=>{if(E(),C(),h){N(),P(),T();const e=document.getElementsByClassName("video-stream")[0],t=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),s=()=>{e?.style.width!==t-f.chatWidth+"px"&&e?.style.width!==t&&(window.dispatchEvent(new Event("resize")),setTimeout((()=>{s()}),500))};return s(),!0}return N(),T(),!1},B=()=>{const e=document.getElementById("primary-inner")?document.getElementById("primary-inner").parentElement:null;b&&h&&w?(E(),r.style.width="100%",r.style.height="",f.hideChat||(x&&(x.style.display="none"),c.style.marginTop="0px",c.style.right="",c.style.top="",c.style.position="unset",c.style.width="100vw",c.style.height=`min(100vh - var(--ytd-watch-flexy-height-ratio) / var(--ytd-watch-flexy-width-ratio) * 100vw - ${f.headerNav?k:0}px, 100vh - ${window.getComputedStyle(r).minHeight} - ${f.headerNav?k:0}px)`,d.style.width="100%",d.style.height="100%",d.style.right="",d.style.top="",d.style.position="",A.style.width="",A.style.height="",A.style.position="",A.style.right="",A.style.top="",A.style.zIndex="99"),e&&(e.style.marginLeft="0px",e.style.paddingRight="0px"),g.style.display="none",i.style.display="none",u&&(l.style.display="none")):(c.style.marginTop="",c.style.height="",A.style.zIndex="",T(),P(),e&&(e.style.marginLeft="",e.style.paddingRight=""),g.style.display="",i.style.display="",u&&(l.style.display=""),x&&(x.style.display=""))},S=t=>{for(const s of t)if("theater"===s.attributeName)b=!b,$();else if("is-two-columns_"===s.attributeName)w=null==s.target.getAttribute("is-two-columns_"),null==s.target.getAttribute("fullscreen")&&(T(),B());else if("fullscreen"===s.attributeName)null!=s.target.getAttribute("fullscreen")?(d.style.zIndex=-1,c.style.zIndex=-1,r.style.width="100%",r.style.height="100vh",e.style.marginTop=""):(c.style.zIndex="",d.style.zIndex="",C(),N(),T(),P(),B());else if("hidden"===s.attributeName||"video-id"===s.attributeName){let e;h=!1,c=null,d=null;const t=s=>{e=$(),s<1||e||setTimeout((()=>{t(--s)}),500)};t(20),e||$()}},j=s=>{if(console.debug("[yttwthmode] trying to inject player observer - remaining tries: ",s),s<1)return;let A;if(console.debug("[yttwthmode] reloading page elements"),e=document.getElementById("page-manager"),t=document.querySelector("ytd-watch-flexy.ytd-page-manager"),t&&(r=t.querySelector('[id^="player-"][id$="-container"]:not(#player-container)'),n=r,r=r.closest("ytd-watch-flexy.ytd-page-manager > *"),a=document.querySelector("#secondary.ytd-watch-flexy"),g=document.getElementById("meta"),i=document.getElementById("info"),m=document.getElementById("related"),o=document.getElementById("masthead-container"),l=document.getElementById("comments")),r&&t&&(new MutationObserver(S).observe(t,{attributes:!0}),null==t.getAttribute("is-two-columns_")&&(w=!0),null!=t.getAttribute("theater")&&(b=!0,$()),A=!0),A)return console.debug("[yttwthmode] player observer injected"),void console.debug("[yttwthmode] theaterMode "+(b?"enabled":"disabled"));setTimeout((()=>{j(--s)}),500)};(async function(){return p.storage.local.get("yttw_props").then((e=>{if(e.yttw_props){!function(e){for(const t in e)-1===t.indexOf("_")||delete e[t]}(e.yttw_props);for(const t in e.yttw_props)f[t]=e.yttw_props[t]}return Promise.resolve(f)}))})().then((()=>{p.runtime.onMessage.addListener((e=>{if(e.yttw_getTabProperties)return Promise.resolve({data:f})})),p.runtime.onConnect.addListener((e=>{e.onMessage.addListener((e=>{if(e.yttw_layoutChange){let t=!1;const s=e.property;f[s]!==e[s]&&(f[s]=e[s],t=!0),t&&(E(),C(),N(),T(),P(),B(),window.dispatchEvent(new Event("resize")))}}))})),j(20)}))})()})();