(()=>{var e,t,a,r,n,i={269756:(e,t,a)=>{"use strict";a.a(e,(async(e,r)=>{try{a.d(t,{default:()=>h});var n=a(655099),i=a(693150),s=a.n(i),o=a(249840),c=a(222751),p=e([n]);n=(p.then?(await p)():p)[0];class h{constructor(){this.isDeviceConnected=!1,this.app=null,this.hdk=new o,this.init=async e=>{try{const t=()=>{this.maybeClosePopup()},a=await n.Dv(t),r=await a.unlockAndPair(),i=r.getPairingCode();i&&await this.openPopup(`vendor/bitbox02/bitbox02-pairing.html?code=${encodeURIComponent(i)}`),this.app=await r.waitConfirm(),this.maybeClosePopup(),this.isDeviceConnected=!0;const s=await this.app.ethXpub(e);if(this.hdk=o.fromExtendedKey(s),!this.app.ethSupported())throw new Error("Unsupported device")}catch(e){throw console.error(e),this.app&&this.app.close(),e}},this.ethSignTransaction=async(e,t,a)=>{if(!this.app)throw new Error("Device not initialized");const r={nonce:c.toBuffer(a.nonce),gasPrice:c.toBuffer(a.gasPrice),gasLimit:c.toBuffer(a.gasLimit),recipient:c.toBuffer(a.to),value:c.toBuffer(a.value),data:c.toBuffer(a.data)};return this.app.ethSignTransaction(BigInt(e),t,r)},this.ethSign1559Transaction=async(e,t)=>{if(!this.app)throw new Error("Device not initialized");const a={chainId:Number(t.chainId),nonce:c.toBuffer(t.nonce),maxPriorityFeePerGas:c.toBuffer(t.maxPriorityFeePerGas),maxFeePerGas:c.toBuffer(t.maxFeePerGas),gasLimit:c.toBuffer(t.gasLimit),recipient:c.toBuffer(t.to),value:c.toBuffer(t.value),data:c.toBuffer(t.data)};return this.app.ethSign1559Transaction(e,a)},this.ethSignMessage=async(e,t,a)=>{if(!this.app)throw new Error("Device not initialized");return this.app.ethSignMessage(BigInt(e),t,c.toBuffer(a))},this.ethSignTypedMessage=async(e,t,a)=>{if(!this.app)throw new Error("Device not initialized");return this.app.ethSignTypedMessage(BigInt(e),t,a)}}async openPopup(e){await s().windows.create({url:e,type:"popup",width:320,height:175})}maybeClosePopup(){s().runtime.sendMessage({type:"bitbox02",action:"popup-close"})}}r()}catch(e){r(e)}}))},690928:(e,t,a)=>{"use strict";a.a(e,(async(e,r)=>{try{a.d(t,{V:()=>h});var n=a(269756),i=a(219571),s=a(693150),o=a.n(s),c=a(655099),p=e([n,c]);function h(){const e=new n.default;chrome.runtime.onMessage.addListener(((t,a,r)=>{if(t.target!==i.n_.bitbox02Offscreen)return;const n=()=>{o().runtime.sendMessage({target:i.n_.extension,event:i.uB.bitbox02DeviceConnect,payload:{name:"close-popup"}})};switch(t.action){case i.w5.init:(async()=>{try{const a=await c.Dv(n),s=await a.unlockAndPair(),p=s.getPairingCode();p&&await o().runtime.sendMessage({target:i.n_.extension,event:i.uB.bitbox02DeviceConnect,payload:{name:"open-popup",pairingCode:p}}),e.app=await s.waitConfirm(),n(),e.isDeviceConnected=!0;const h=await e.app.ethXpub(t.params[0]);await o().runtime.sendMessage({target:i.n_.extension,event:i.uB.bitbox02DeviceConnect,payload:{name:"pub-key",pubKey:h}}),e.app.ethSupported()||r({error:"Unsupported device"}),r()}catch(t){console.error(t),e.app&&e.app.close(),r({error:t})}})();break;case i.w5.ethSign1559Transaction:e.ethSign1559Transaction(...t.params).then(r).catch((e=>{r({error:e})}));break;case i.w5.ethSignMessage:e.ethSignMessage(...t.params).then(r).catch((e=>{r({error:e})}));break;case i.w5.ethSignTransaction:e.ethSignTransaction(...t.params).then(r).catch((e=>{r({error:e})}));break;case i.w5.ethSignTypedMessage:e.ethSignTypedMessage(...t.params).then(r).catch((e=>{r({error:e})}));break;default:r({success:!1,payload:{error:"BitBox02 action not supported"}})}return!0}))}[n,c]=p.then?(await p)():p,r()}catch(u){r(u)}}))},277951:(e,t,a)=>{"use strict";a.d(t,{k:()=>s});var r=a(587611);class n{constructor(){this.app=null,this.loopCount=0,this.invokeApp=async(e,t)=>{this.app||await this.makeApp();try{return await this.app[e](...t)}catch(a){if(a.message.includes("Cannot read properties of undefined")||a.message.includes("The device was disconnected")){if(this.loopCount++,this.loopCount>5)throw this.loopCount=0,new Error("device disconnected");return await this.cleanUp(),this.invokeApp(e,t)}throw a}}}async makeApp(){const e=await r.ETHSingleton.getInstance();await e.init(),this.app=e}isUnlocked(){return!!this.app}unlock(){return this.isUnlocked()?Promise.resolve("already unlocked"):this.makeApp()}async cleanUp(){try{await(this.app?.close())}catch(e){console.error(e)}this.app=null}}var i=a(219571);function s(){const e=new n;chrome.runtime.onMessage.addListener(((t,a,r)=>{if(t.target===i.n_.imkeyOffscreen){switch(t.action){case i.$t.unlock:e.unlock().then(r).catch((e=>{r({error:e})}));break;case i.$t.cleanUp:e.cleanUp().then(r).catch((e=>{r({error:e})}));break;case i.$t.invokeApp:e.invokeApp(...t.params).then(r).catch((e=>{r({error:e})}));break;default:r({success:!1,payload:{error:"ImKey action not supported"}})}return!0}}))}},578917:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var r=a(219571);function n(){chrome.runtime.onMessage.addListener(((e,t,a)=>{if(e.target===r.n_.latticeOffscreen)return async function(e){const t=window.open(e);if(!t)throw new Error("Failed to open Lattice connector.");return t}(e.params.url).then((e=>{const t=setInterval((()=>{e.closed&&(clearInterval(t),a({error:new Error("Lattice connector closed.")}))}),500);window.addEventListener("message",(n=>{if(n.origin===r.Td.lattice||n.source!==e)try{clearInterval(t);const e=JSON.parse(n.data);e.deviceID&&e.password||a({error:new Error("Invalid credentials returned from Lattice.")}),a({result:e})}catch(e){a({error:e})}}),!1)})),!0}))}},830890:(e,t,a)=>{"use strict";a.d(t,{M:()=>o});var r=a(219571),n=a(714347),i=a(693150),s=a.n(i);function o(){navigator.hid.addEventListener("disconnect",(({device:e})=>{e.vendorId===n.An&&s().runtime.sendMessage({target:r.n_.extension,event:r.We.ledgerDeviceDisconnect})}))}},537233:(e,t,a)=>{"use strict";a.a(e,(async(e,t)=>{try{var r=a(690928),n=a(277951),i=a(578917),s=a(830890),o=a(393279),c=e([r]);r=(c.then?(await c)():c)[0],(0,n.k)(),(0,o.p)(),(0,r.V)(),(0,i.Z)(),(0,s.M)();let p,h=0;const u=()=>{clearTimeout(p),p=setTimeout((()=>{0!==h&&(new Date,chrome.runtime.sendMessage({type:"ping"}),u())}),2e3)};chrome.runtime.onMessage.addListener(((e,t,a)=>{"pageClosed"===e.type?h=Math.max(0,h-1):"pageOpened"===e.type&&(h++,u())})),t()}catch(e){t(e)}}))},393279:(e,t,a)=>{"use strict";a.d(t,{p:()=>p});var r=a(1364),n=a(310959),i=a.n(n);const{HardwareWebSdk:s}=i();class o{constructor(){this.init=async()=>{s.init({debug:!1,connectSrc:"https://jssdk.onekey.so/0.3.48/"}),s.on(r.rF,(e=>{switch(e.type){case r.zG.REQUEST_PIN:s.uiResponse({type:r.Sy.RECEIVE_PIN,payload:"@@ONEKEY_INPUT_PIN_IN_DEVICE"});break;case r.zG.REQUEST_PASSPHRASE:s.uiResponse({type:r.Sy.RECEIVE_PASSPHRASE,payload:{value:"",passphraseOnDevice:!0,save:!0}})}}))},this.evmSignTransaction=s.evmSignTransaction,this.evmSignMessage=s.evmSignMessage,this.evmSignTypedData=s.evmSignTypedData,this.searchDevices=s.searchDevices,this.getPassphraseState=s.getPassphraseState,this.evmGetPublicKey=s.evmGetPublicKey}}var c=a(219571);function p(){const e=new o;chrome.runtime.onMessage.addListener(((t,a,r)=>{if(t.target===c.n_.onekeyOffscreen){switch(t.action){case c.DU.init:e.init().then(r).catch((e=>{r({error:e})}));break;case c.DU.searchDevices:e.searchDevices().then(r).catch((e=>{r({error:e})}));break;case c.DU.evmGetPublicKey:e.evmGetPublicKey(...t.params).then(r).catch((e=>{r({error:e})}));break;case c.DU.getPassphraseState:e.getPassphraseState(...t.params).then(r).catch((e=>{r({error:e})}));break;case c.DU.evmSignMessage:e.evmSignMessage(...t.params).then(r).catch((e=>{r({error:e})}));break;case c.DU.evmSignTransaction:e.evmSignTransaction(...t.params).then(r).catch((e=>{r({error:e})}));break;case c.DU.evmSignTypedData:e.evmSignTypedData(...t.params).then(r).catch((e=>{r({error:e})}));break;default:r({success:!1,payload:{error:"OneKey action not supported"}})}return!0}}))}},446601:()=>{},989214:()=>{},127790:()=>{},752361:()=>{},394616:()=>{}},s={};function o(e){var t=s[e];if(void 0!==t)return t.exports;var a=s[e]={id:e,loaded:!1,exports:{}};return i[e].call(a.exports,a,a.exports,o),a.loaded=!0,a.exports}o.m=i,o.amdO={},e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",a="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",r=e=>{e&&!e.d&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},o.a=(n,i,s)=>{var o;s&&((o=[]).d=1);var c,p,h,u=new Set,d=n.exports,l=new Promise(((e,t)=>{h=t,p=e}));l[t]=d,l[e]=e=>(o&&e(o),u.forEach(e),l.catch((e=>{}))),n.exports=l,i((n=>{var i;c=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[e])return n;if(n.then){var i=[];i.d=0,n.then((e=>{s[t]=e,r(i)}),(e=>{s[a]=e,r(i)}));var s={};return s[e]=e=>e(i),s}}var o={};return o[e]=e=>{},o[t]=n,o})))(n);var s=()=>c.map((e=>{if(e[a])throw e[a];return e[t]})),p=new Promise((t=>{(i=()=>t(s)).r=0;var a=e=>e!==o&&!u.has(e)&&(u.add(e),e&&!e.d&&(i.r++,e.push(i)));c.map((t=>t[e](a)))}));return i.r?p:s()}),(e=>(e?h(l[a]=e):p(d),r(o)))),o&&(o.d=0)},n=[],o.O=(e,t,a,r)=>{if(!t){var i=1/0;for(h=0;h<n.length;h++){for(var[t,a,r]=n[h],s=!0,c=0;c<t.length;c++)(!1&r||i>=r)&&Object.keys(o.O).every((e=>o.O[e](t[c])))?t.splice(c--,1):(s=!1,r<i&&(i=r));if(s){n.splice(h--,1);var p=a();void 0!==p&&(e=p)}}return e}r=r||0;for(var h=n.length;h>0&&n[h-1][2]>r;h--)n[h]=n[h-1];n[h]=[t,a,r]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.e=()=>Promise.resolve(),o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.j=6338,o.v=(e,t,a,r)=>{var n=fetch(o.p+""+a+".module.wasm");return"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(n,r).then((t=>Object.assign(e,t.instance.exports))):n.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,r))).then((t=>Object.assign(e,t.instance.exports)))},o.p="/",(()=>{var e={6338:0};o.O.j=t=>0===e[t];var t=(t,a)=>{var r,n,[i,s,c]=a,p=0;if(i.some((t=>0!==e[t]))){for(r in s)o.o(s,r)&&(o.m[r]=s[r]);if(c)var h=c(o)}for(t&&t(a);p<i.length;p++)n=i[p],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return o.O(h)},a=self.webpackChunkrabby=self.webpackChunkrabby||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})(),o.nc=void 0;var c=o.O(void 0,[330,5449,3946,6928,9595,8384,2827,6510,2983,5187,2506,5849,6996,8825,4926,5045,1535,4279,7411,1680,3420,5655,4634,6006,7715,4347,5844,4388,6949,3917,9104,9842,7206,3454,5257,6066,4517,446,66,3923,2167,488],(()=>o(537233)));c=o.O(c)})();