(self.webpackChunk=self.webpackChunk||[]).push([[5058],{97527:(e,t,n)=>{n.r(t),n.d(t,{ConnectorFieldIntegration:()=>oe,ConnectorFocusFieldManagerImpl:()=>h});var i=n(65882),o=n(14765),r=n(65647),s=n(60165),a=n(70163),c=n(25770),l=n(42100),u=n(91795),d=n(79992);class h{constructor(e){this._params=e,this._fieldRegistry=c.h.create([]),this._textFieldsObservable=l.S.createFocusObservable(this._params.doc,u.x.createFlattenHot(this._params.doc,{childList:!0,subtree:!0})),this._focusedTextField=i.aj([this._fieldRegistry,this._textFieldsObservable.pipe(o.O(null))]).pipe(r.U((([e,t])=>{var n;const[i]=e;if(!t)return i;const o=e.find((e=>{var n;return t.element instanceof HTMLElement&&([e.textField,e.originalTextField].includes(t.element)||e.textField.contains(t.element)||(0,d.fQ)(null===(n=e.originalTextField)||void 0===n?void 0:n.contains(t.element)))}));return null!==(n=null==o?void 0:o.documentID)&&void 0!==n?n:i.documentID})),s.x(),a.B())}createFocusFieldIntegration(e){return this._fieldRegistry.modify((t=>[...t,e])),{isFocused:this._focusedTextField.pipe(r.U((t=>t===e.documentID)),s.x(),o.O(!0)),dispose:()=>this._fieldRegistry.modify((t=>t.filter((t=>t!==e))))}}}var g=n(82823),m=n(58303),p=n(61744),f=n(72779),x=n(68344),_=n(96679),y=n(68485),C=n(70932),b=n(92147),v=n(50443),F=n(21768),D=n(60841),S=n(14275),T=n(34859),w=n(20715),R=n(36880),B=n(57935),O=n(76667);class L{constructor(e,t=C.Y.create("ConnectorApi")){this._params=e,this._log=t,this._subscription=new g.w;const n={id:e.documentID,getDocumentText:this._getDocumentText.bind(this),getDocumentGeometry:this._getDocumentGeometry.bind(this),getBoundingBoxesForTextRanges:this._getBoundingBoxesForTextRanges.bind(this),setDocumentSelectedTextRanges:this._setDocumentSelectedTextRanges.bind(this),applyChangesToDocument:this._applyChangesToDocument.bind(this),dispose:e.disposeConnection,cancel:d.EI};[e.connectorServer.createConnectorSession(e.documentID,n),this._listenDocumentFocuseChange(),this._listenDocumentTextDidChange(),this._listenDocumentTextDidChangeToUpdateVisibleText(),this._listenDocumentSelectedTextRangesDidChange(),this._listenDocumentGeometryChange()].forEach((e=>this._subscription.add(e)))}_getDocumentText(e){const t={...this._documentState,document:this._params.connectorHandler.getDocumentText()};return this._log.trace(`[${this._params.documentID}] handle getDocumentText:`,t),Promise.resolve(t)}_getDocumentGeometry(e){const t={...this._documentState,...this._params.connectorHandler.getDocumentGeometry()};return this._log.trace(`[${this._params.documentID}] handle getDocumentGeometry:`,t),Promise.resolve(t)}_getBoundingBoxesForTextRanges(e){const{ranges:t}=e,n={...this._documentState,boundingBoxes:this._params.connectorHandler.getBoundingBoxesForTextRanges(t)};return this._log.trace(`[${this._params.documentID}] handle getBoundingBoxesForTextRanges:`,{ranges:t,result:n}),Promise.resolve(n)}_setDocumentSelectedTextRanges(e){const[t]=e.ranges;return this._params.connectorHandler.setDocumentSelectedTextRange(t),this._log.trace(`[${this._params.documentID}] handle setDocumentSelectedTextRange:`,{range:t}),Promise.resolve()}_applyChangesToDocument(e){return this._params.connectorHandler.applyChangesToDocument(new F.i(e.changes)).then((t=>{this._log.trace(`[${this._params.documentID}] handle applyChangesToDocument:`,{changes:e.changes,result:t})}))}_listenDocumentFocuseChange(){this._params.connectorListener.focusChangeObs.pipe(D.w((e=>e?S.timer(B.Xd(4)).pipe(T.h(e)):w.of(e))),(0,O.i6)(!1,((e,t)=>t||e))).subscribe(this._emitDocumentFocusMessage.bind(this))}_emitDocumentFocusMessage(e){const t=e?{...this._documentState,documentURL:this._params.documentURL}:null;this._params.connectorServer.client.api.documentDidFocus(t),this._log.trace(`[${this._params.documentID}] documentDidFocus:`,t)}_listenDocumentTextDidChange(){return this._params.connectorListener.textChangeObs.subscribe((e=>{const t={...this._documentState,changes:e};this._params.connectorServer.client.api.documentTextDidChange(t),this._log.trace(`[${this._params.documentID}] documentTextDidChange:`,t)}))}_listenDocumentTextDidChangeToUpdateVisibleText(){return this._params.connectorListener.textChangeObs.pipe(D.w((()=>S.timer(B.E0).pipe(R.R(this._params.connectorListener.geometryChangeObs))))).subscribe(this._emitDocumentFocusMessage.bind(this,!0))}_listenDocumentSelectedTextRangesDidChange(){return this._params.connectorListener.selectionChangeObs.subscribe((e=>{const t={...this._documentState,ranges:e?[e]:[]};this._params.connectorServer.client.api.documentSelectedTextRangesDidChange(t),this._log.trace(`[${this._params.documentID}] documentSelectedTextRangesDidChange:`,t)}))}_listenDocumentGeometryChange(){return this._params.connectorListener.geometryChangeObs.subscribe((e=>{const t={...this._documentState,reasons:e.reasons};this._params.connectorServer.client.api[e.eventName](t),this._log.trace(`[${this._params.documentID}] ${e.eventName}:`,t)}))}get _documentState(){return{documentID:this._params.documentID,revision:this._params.textRevisionManager.getLatestVersionNumber()}}dispose(){this._subscription.unsubscribe()}}var M,G=n(35947),I=n(90023),q=n(99607),P=n(30033),H=n(58454),U=n(78064);!function(e){function t(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}function n(e){const t=e.rect.getCurrent();return{left:t.client.left,top:t.client.top,width:t.size.width,height:t.size.height}}function i(e,n){const i=n.getOffset();return(0,I.zG)(P.UL.shift(e,{top:i.y,left:i.x}),t)}function o(e){const t=e.visibleRect.getCurrent(),n=e.rect.getCurrent(),i=e.scroll.getCurrent(),o=(0,q.jg)(t,n);return o?(0,q.Li)(o,n,i):null}function r(e,t,n,i,o){var r;const s=i.create(e,t);return s?Array.from(null!==(r=i.getClientRects(s))&&void 0!==r?r:[]).filter((e=>e.height>0&&e.width>0)).map((e=>P.UL.setPosition(o.clientToRelative(e),e))).filter((e=>P.UL.contains(e,n))):[]}function s(e,t,n){return[[e.left,e.top+e.height],[e.left+e.width,e.top+e.height]].map((([e,n])=>t.elementFromPoint(e,n))).every((e=>n.some((t=>e===t||t.contains(e)))))}function a(e){return Object.fromEntries(Object.keys(e).map((e=>[e,[]])))}e.getTextFieldBoundingBox=function(e,t,o){const r=n(o),s=(0,H.k6)(t);if(!s)return i(r,e);const a=P.UL.getIntersection(r,s);if(!a)return i(r,e);const c=e.getOffset();return{x:a.left+c.x,y:r.top+c.y,width:a.width,height:r.height}},e.getRelativeVisibleTextFieldRect=o,e.getVisibleRelativeRectsForTextRange=r,e.getVisibleTextRange=function(e,t,n,i){let s=null;const a=e.getPlainText(),c=o(t);if(!c||!a.length)return s;const l=i.getCurrentConversionContext();for(let t=0;t<a.length;t++){if(r({start:t,end:t+1},e,c,n,l).length>0)s={start:null===s?t:s.start,end:t+1};else if(s&&(0,U.qE)(a.substring(t,t+1)))break}return s},e.isRectElementOnDocumentTop=s,e.createEmptyBoundingBoxesForTextField=a,e.getBoundingBoxesForTextRanges=function(e,c,l,u,h,g,m,p,f){const x=o(m);if(!x)return a(e);const _=p.getCurrentConversionContext(),y=n(m),C=i(y,h),b=m.scroll.getCurrent(),v={left:y.left-b.left,top:y.top-b.top},F={left:C.x-b.left,top:C.y-b.top};return Object.fromEntries(Object.entries(e).map((([e,n])=>[e,r(n,g,x,f,_).filter((e=>s(P.UL.shift(e,v),u,[c,l].filter(d.fQ)))).map((e=>(0,I.zG)(P.UL.shift(e,F),t)))])))}}(M||(M={}));class k{constructor(e){this._params=e,this.getDocumentText=()=>this._params.getCurrentTextMap().getRichText(),this.getDocumentGeometry=()=>{var e;return{windowFrame:this._params.windowPositionManager.getBoundingBox(),documentFrame:M.getTextFieldBoundingBox(this._params.windowPositionManager,this._params.textField,this._params.textFieldLayout),visibleTextRange:null!==(e=M.getVisibleTextRange(this._params.getCurrentTextMap(),this._params.textFieldLayout,this._params.geometryProvider,this._params.geometryLayout))&&void 0!==e?e:{start:0,end:this._params.getCurrentTextMap().getPlainText().length}}},this.getBoundingBoxesForTextRanges=e=>M.getBoundingBoxesForTextRanges(e,this._params.textField,this._params.originalTextField,this._params.doc,this._params.windowPositionManager,this._params.getCurrentTextMap(),this._params.textFieldLayout,this._params.geometryLayout,this._params.geometryProvider),this.setDocumentSelectedTextRange=e=>this._params.selectionService.setSelection(e),this.applyChangesToDocument=e=>{const t=(0,G.g)(e,!0);return this._params.replacementService.performBatchReplacements(t).then((t=>({changes:e,status:t})))}}}var W,j=n(64965),E=n(5794),N=n(55446),z=n(53710);!function(e){e.WindowFrameChanged="WindowFrameChanged",e.ViewportFrameChanged="ViewportFrameChanged",e.DocumentFrameChanged="DocumentFrameChanged",e.DocumentFrameScrolled="DocumentFrameScrolled",e.DocumentTextReflow="DocumentTextReflow"}(W||(W={}));var $,V,Q,X=n(70874),A=n(65754);!function(e){function t(e,n=[]){const i=e.parentElement;if(!i)return n;const o=i.scrollWidth>i.clientWidth,r=i.scrollHeight>i.clientHeight;return(o||r)&&n.push(i),t(i,n)}e.getScrollableParents=t,e.getParentsScrollObs=function(e){const n=t(e);return i.aj(n.map((e=>j.R(e,"scroll").pipe(o.O(null))))).pipe(E.J(),N.h((e=>(0,d.fQ)(e))))}}($||($={})),function(e){e.documentGeometryWillChange="documentGeometryWillChange",e.documentGeometryDidChange="documentGeometryDidChange"}(V||(V={})),function(e){function t({willChangeBuffer:e,didChangeBuffer:t}){return{willChangeBuffer:e,didChangeBuffer:t}}e.debounceGeometryUpdateReason=function(e,t=B.E0){return n=>n.pipe(T.h(e),D.w((e=>S.timer(t).pipe(T.h([V.documentGeometryDidChange,e]),o.O([V.documentGeometryWillChange,e])))),s.x((([e],[t])=>e===t)),o.O(null))},e.updateGeometryState=function(e,[n,i]){if(n===V.documentGeometryWillChange)return e.willChangeBuffer.has(i)?t(e):(e.willChangeBuffer.add(i),{...e,event:{eventName:n,reasons:[i]}});if(!(e.willChangeBuffer.size>0))return t(e);if(e.didChangeBuffer.add(i),e.willChangeBuffer.delete(i),e.didChangeBuffer.size>0&&0===e.willChangeBuffer.size){const t=Array.from(e.didChangeBuffer);return e.didChangeBuffer.clear(),{...e,event:{eventName:n,reasons:t}}}return t(e)},e.createInitialGeometryState=function(){return t({willChangeBuffer:new Set,didChangeBuffer:new Set})}}(Q||(Q={}));class J{constructor(e){this._params=e,this.focusChangeObs=i.aj([this._params.isCurrentFieldFocused,j.R(this._params.doc,"visibilitychange",{passive:!0}).pipe(r.U((()=>"visible"===this._params.doc.visibilityState)),s.x(),o.O("visible"===this._params.doc.visibilityState)),A.N.create((()=>this._params.doc.hasFocus()),X.S.hz10,d.fS).changes.pipe(s.x(),o.O(this._params.doc.hasFocus()))]).pipe(r.U((([e,t,n])=>e&&t&&n)),s.x()),this.textChangeObs=(0,O.xy)(this.focusChangeObs,this._params.textRevisionManager.revisionChanges.pipe(r.U((e=>e.deltaChanges.delta)))),this.selectionChangeObs=(0,O.xy)(this.focusChangeObs,this._params.selectionService.selection),this.geometryChangeObs=(0,O.xy)(this.focusChangeObs,i.aj([this._params.windowPositionManager.boundingBoxChangeObs.pipe(Q.debounceGeometryUpdateReason(W.WindowFrameChanged,B.Xd(3))),this._params.textFieldLayout.scroll.changes.pipe(Q.debounceGeometryUpdateReason(W.DocumentFrameScrolled,B.Xd(3))),i.aj([this._params.textFieldLayout.rect.changes.pipe(o.O(null)),this._params.textFieldLayout.scrollSize.changes.pipe(o.O(null)),this._params.windowPositionManager.scrollChangeObs.pipe(o.O(null)),$.getParentsScrollObs(this._params.textField).pipe(o.O(null))]).pipe(E.J(),N.h(d.fQ),Q.debounceGeometryUpdateReason(W.DocumentFrameChanged))]).pipe(E.J(),N.h(d.fQ),z.R(Q.updateGeometryState,Q.createInitialGeometryState()),r.U((e=>e.event)),N.h(d.fQ)))}}var Y,K=n(68857),Z=n(91778);!function(e){e.create=function(e,t=K.n.create){const n=t({getTextSource:()=>e.getTextSource(),getCurrentTextMap:()=>e.getCurrentTextMap(),dispose:()=>e.dispose(),textMapChanged:e.textMapChanged,contentChanges:{async:e.contentChanges.async.pipe(N.h((e=>e.changes.length>0))),immediate:e.contentChanges.immediate.pipe(N.h((e=>e.changes.length>0)))}});return{revisionChanges:n.revisionChanges,getLatestVersionNumber:()=>Z.Q.getRevisionNumber(n.getLatestRevision().id),dispose:()=>n.dispose()}}}(Y||(Y={}));var ee=n(12015),te=n(18300);class ne{constructor(e){this._params=e,this._subscription=new g.w,this._selection=c.h.create(null),this.selection=this._selection.view(),this._subscription.add(e.selectionOrCaretPosition.pipe(r.U((e=>m.WG(e))),r.U((t=>null!=t?t:(0,I.zG)(e.selectionService.getCurrentSelection(),te.Ey)))).subscribe(ee.wW(this._selection)))}setSelection(e){this._params.selectionService.setSelection(e)}dispose(){this._subscription.unsubscribe()}}class ie{constructor(e){this._win=e,this.boundingBoxChangeObs=A.N.create((()=>this.getBoundingBox()),X.S.hz4,d.fS).changes,this.scrollChangeObs=i.aj([j.R(this._win,"scroll").pipe(o.O(null)),this._win.top&&this._win.top!==this._win?j.R(this._win.top,"scroll").pipe(o.O(null)):w.of(null)]).pipe(E.J(),N.h((e=>(0,d.fQ)(e))))}getBoundingBox(){return{x:this._win.screenX,y:this._win.screenY,width:this._win.outerWidth,height:this._win.outerHeight}}getOffset(){const e=(this._win.outerWidth-this._win.innerWidth)/2;return{y:this._win.outerHeight-this._win.innerHeight+e,x:e}}}class oe{constructor(e,t){var n,i,o;this._params=e,this._subscription=new g.w,this._log=C.Y.create("ConnectorFieldIntegration");const r=(0,f.Me)(e.textField),s=r.location.href,a=d.iy.create(),l=null!==(n=e.sessionStatsManager)&&void 0!==n?n:new p.J(e.domain,(()=>c.h.create(null)),(()=>m.YP),e.textObserver,e.gnar,e.productMetricsCSClient,e.felog,e.experimentClient),u=x.L.create(e.createReplacementService,e.textObserver,e.domain,e.integrationName,e.felog,l,null!==(i=e.layout.isIframeHost)&&void 0!==i&&i,e.experimentClient,e.state.view("dynamicConfig").get(),new _.M).create(y.P.connector),h=Y.create(e.textObserver,e.createTextRevisionManager),v=null!==(o=e.geometryLayout)&&void 0!==o?o:e.layout.createGeometryLayout(),F=new ie((0,f.Jj)(e.textField)),D=new ne({selectionService:e.selectionService,selectionOrCaretPosition:e.selectionOrCaretPosition}),S=t.connectorFocusFieldManager.createFocusFieldIntegration({documentID:a,textField:e.textField,originalTextField:e.originalTextField}),T=new J({doc:r,selectionService:D,textRevisionManager:h,windowPositionManager:F,textField:e.textField,textFieldLayout:e.layout.textField,isCurrentFieldFocused:S.isFocused}),w=new k({doc:r,replacementService:u,textRevisionManager:h,geometryLayout:v,windowPositionManager:F,selectionService:D,textField:e.textField,textFieldLayout:e.layout.textField,originalTextField:e.originalTextField,geometryProvider:e.geometryProvider,getCurrentTextMap:()=>e.textObserver.getCurrentTextMap()});[new L({documentID:a,documentURL:s,textRevisionManager:h,connectorListener:T,connectorHandler:w,connectorServer:t.connectorServer,disposeConnection:t.disposeConnection}),l,h,D,S].forEach((e=>this._subscription.add((()=>e.dispose())))),this._registerDevtoolsHelper(w),this._log.debug("Initialized Connector Field Integration!"),this._params.felog.connector.textFieldIntegrated((0,b.Cg)(this._params.domain),this._params.integrationName)}update(e){this._params.state.set(e)}dispose(){try{this._subscription.unsubscribe()}catch(e){this._log.error("fail to dispose",e)}}_registerDevtoolsHelper(e){(0,v.X)("connectorApi",{getDocumentText:e.getDocumentText,getDocumentGeometry:e.getDocumentGeometry,getBoundingBoxesForTextRanges:e.getBoundingBoxesForTextRanges,setDocumentSelectedTextRanges:e.setDocumentSelectedTextRange,applyChangesToDocument:e.applyChangesToDocument})}}},58454:(e,t,n)=>{if(n.d(t,{LJ:()=>_,Nd:()=>a,Ov:()=>x,TW:()=>v,Ur:()=>c,Xs:()=>F,e$:()=>C,eg:()=>b,fN:()=>g,iy:()=>d,k6:()=>p,kh:()=>h,lW:()=>y,lz:()=>m,qg:()=>s,uj:()=>r,uz:()=>f,vc:()=>u}),3075==n.j)var i=n(73104);var o=n(91901);function r(e){const t=(0,i.Cq)(e.querySelector(o.XG),"text buffer iframe");return(0,i.Cq)(t.nodeType===Node.ELEMENT_NODE&&"IFRAME"===t.tagName?t.contentDocument:void 0,"text buffer iframe document")}function s(e){const t=a(e);return{width:t?t.offsetWidth-t.clientWidth:0,height:t?t.offsetHeight-t.clientHeight:0}}function a(e){return e.querySelector(o.Wp)}function c(e,t,n){return t?function(e,t){if(t&&l(t))return t;const n=e.querySelectorAll(o.Qy);for(const e of n)if(l(e))return e;return null}(e,n):e.querySelector(o.Qy)}const l=e=>e.checkVisibility?e.checkVisibility():e.parentElement&&"none"!==e.parentElement.style.display;function u(e){return e.querySelector(o.yw)}function d(e){return e.querySelector(o.gv)}function h(e){return e.querySelectorAll(o.gH)}function g(e){return e.querySelector(o.gH)}function m(e){return Boolean(e.querySelector(o.gH))}function p(e){let t=e.querySelector(o.os);return t||(t=document.querySelector(o.gH)),t?t.getBoundingClientRect():null}const f=e=>!!e.querySelector(o.Lq);function x(e){return e.querySelector(o.$x)}function _(e){return null==e?void 0:e.querySelector(o.y1)}function y(e){const t=e.querySelector(o.f);return!!t&&t.offsetHeight>0}function C(e){return!!e.querySelector(`${o.jW}, ${o.F8}`)}function b(){const e=document.querySelector(o.d0),t=(null==e?void 0:e.classList.contains(o.uj))?"edit":void 0,n=(null==e?void 0:e.classList.contains(o._m))?"suggesting":void 0;return t||n||"other"}function v(e){return e.querySelector(o.QR)}function F(e){return e.querySelector(o.ij)}},91901:(e,t,n)=>{n.d(t,{$x:()=>s,F8:()=>m,Go:()=>o,Kt:()=>b,Lq:()=>l,QR:()=>w,Qy:()=>x,Vk:()=>v,Wp:()=>i,XG:()=>r,_m:()=>h,d0:()=>u,f:()=>c,gH:()=>f,gL:()=>F,gv:()=>p,ij:()=>T,j5:()=>C,jW:()=>g,lO:()=>S,os:()=>y,rx:()=>D,uj:()=>d,y1:()=>a,yw:()=>_});const i=".kix-appview-editor",o=".docos-input",r=".docs-texteventtarget-iframe",s=".kix-cursor",a=".kix-cursor-caret",c="#docs-revisions-sidebar",l='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',u="#docs-toolbar-mode-switcher",d="edit-mode",h="suggest-mode",g="#titlebar-mode-indicator-container .titlebar-request-access-button",m="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",p=".kix-canvas-tile-content",f="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",x=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",_=".kix-page-paginated",y=".kix-page-paginated.canvas-first-page",C=".docs-horizontal-ruler",b=".docs-vertical-ruler",v="#fontSizeSelect input",F=".docs-ruler-background",D=".docs-ruler-background-inner",S=".docs-ruler-indent-first-line",T=".modal-dialog.docs-dialog .fatal-error-message",w='#docs-titlebar-share-client-button div[role="button"]'}}]);