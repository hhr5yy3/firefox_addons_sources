var isV2=!1;function getBrowserExtensionURL(url){return url.substring(url.lastIndexOf("/")+1,url.length)}function logout(){browser.runtime.sendMessage({name:"on_logout_item_click"}),window.close()}function auth(){var mStatusMsg=document.getElementById("statusMessage");mStatusMsg.innerText="Authenticating...",mStatusMsg.style.color="black",browser.storage.local.get("potential_passwordstate_url",(function(result){null!=result.potential_passwordstate_url&&browser.runtime.sendMessage({name:"isRestrictedFeature"},(function(restrictedFeatureResponse){if(1==restrictedFeatureResponse.response)browser.runtime.sendMessage({name:"cbe"},(function(){}));else{var mPass=document.getElementById("mPass");null!=mPass&&(""==mPass.value&&isV2?(mStatusMsg.style.color="red",mStatusMsg.innerText="You must enter your Master Password"):browser.runtime.sendMessage({name:"authenticate",url:result.potential_passwordstate_url,mPass:mPass.value},(function(response){""==response.response?window.close():(mStatusMsg.style.color="red",mStatusMsg.innerText=response.response)})))}}))}))}browser.runtime.onMessage.addListener((function(request,sender,sendResponse){if("close_prefs"==request.name&&(window.close(),sendResponse({response:!0})),"display_msg_prefs"==request.name){var mStatusMsg=document.getElementById("statusMessage");null!=mStatusMsg&&(mStatusMsg.innerText=request.msgToDisplay,mStatusMsg.style.color="red"),sendResponse({response:!0})}return!0})),document.addEventListener("DOMContentLoaded",(function(){var confirm_auth=document.querySelector("#confirm_auth"),logoutBtn=document.getElementById("logout");browser.runtime.sendMessage({name:"lockState"},(function(response){1==response.response?(confirm_auth.innerText="Unlock",logoutBtn.style.display="block",logoutBtn.addEventListener("click",logout)):(confirm_auth.innerText="Login",logoutBtn.style.display="none")})),document.querySelector("#build").appendChild(document.createTextNode(chrome.extension.getBackgroundPage().GetBuild())),browser.storage.local.get("potential_passwordstate_url",(function(result){if(null!=result.potential_passwordstate_url){var togglePasswordImage=document.querySelector("#url_confirm_auth");if(null!=togglePasswordImage){var parser=document.createElement("a");parser.href=result.potential_passwordstate_url,togglePasswordImage.innerText=parser.protocol+"//"+parser.hostname+"/",parser.port&&""!==parser.port&&(togglePasswordImage.innerText=parser.protocol+"//"+parser.hostname+":"+parser.port+"/");var confirmUrlPanel=document.getElementById("confirm_url_panel"),configInfoPanel=document.getElementById("config_info_panel"),confirmMpassPanel=document.getElementById("confirm_mpass_panel"),confirmBlurbV1=document.getElementById("confirm_blurbV1"),confirmBlurbRF=document.getElementById("confirm_blurb_rf");null!=confirmUrlPanel&&null!=configInfoPanel&&(confirmUrlPanel.style.display="block",configInfoPanel.style.display="none",browser.runtime.sendMessage({name:"isRestrictedFeature"},(function(restrictedFeatureResponse){let potential_passwordstate_url_split=getBrowserExtensionURL(result.potential_passwordstate_url).split(":");potential_passwordstate_url_split.length>=3&&0==restrictedFeatureResponse.response?(isV2=!0,confirmMpassPanel.style.display="block",confirmBlurbV1.style.display="none"):potential_passwordstate_url_split.length>=3&&1==restrictedFeatureResponse.response&&(confirmBlurbRF.style.display="block",confirmBlurbV1.style.display="none")})))}}}));var mPassInput=document.getElementById("mPass");null!=confirm_auth&&null!=mPassInput&&(confirm_auth.addEventListener("click",auth),mPassInput.addEventListener("keypress",(function(event){"Enter"===event.key&&(event.preventDefault(),confirm_auth.click())})))}));