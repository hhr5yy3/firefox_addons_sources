(self.webpackChunkbrowser_extension=self.webpackChunkbrowser_extension||[]).push([[861,821],{26964:(e,t,n)=>{"use strict";n.d(t,{B9:()=>a,OR:()=>o,xL:()=>l});var s=n(6839),r=n(24671),i=n(72431);const o=[r.ql,s.aN],a={[i.eA.WebSpeech]:r.u8,[i.eA.TencentRealtime]:s.Er},l={[i.eA.WebSpeech]:r.HO,[i.eA.TencentRealtime]:s.AH}},18861:(e,t,n)=>{"use strict";n.d(t,{A:()=>bn});n(62234),n(33873),n(69375),n(48605),n(10865),n(8697),n(8096),n(98376),n(47010);var s=n(51127),r=n.n(s),i=n(14041),o=n(72531),a=n(53373),l=n.n(a),c=n(78220),u=n(32413),d=n(17088),p=n(46250);const h="static"!==getComputedStyle(document.documentElement).position;var f=n(79859),m=n.n(f);function g(){return{edges:{left:!0,right:!0,bottom:!1,top:!1},modifiers:[m().modifiers.restrictSize({min:{width:250,height:100}})]}}n(14293);function y(e){if(!e||!e.startsWith("translate"))return null;const t=e.startsWith("translate3d"),n=e.replace("translate"+(t?"3d":""),"").match(/-?\d+(\.\d+)?/g);if(!n)return null;const s=Number(n[0]),r=Number(n[1]);return Number.isNaN(s)||Number.isNaN(r)?null:{x:s,y:r,is3d:t}}function v(e){return`translate${e.is3d?"3d":""}(${Math.round(e.x)}px,${Math.round(e.y)}px${e.is3d?",0":""})`}var x=n(25148),b=n(74874),w=n.n(b),T=n(16224),S=n(20124),E=n.n(S);n(97107);function C(e,t){switch(t.type){case"overload":return t.payload;case"incremental":if(!e||!t.payload.placement)return e;const n=y(e.transform);if(!n)throw new Error("未解析到箭头的位置信息");return t.payload.placement.startsWith("bottom")||t.payload.placement.startsWith("top")?n.x=n.x-t.payload.x:(t.payload.placement.startsWith("left")||t.payload.placement.startsWith("right"))&&(n.y=n.y-t.payload.y),{...e,transform:v(n)}}}var j=n(93963),k=n(38792),_=n.n(k),N=n(64795),L=n(68046);function R(e,t){const n=e.pos;switch(t.type){case"setWidth":const s=e.width,r=t.payload;return s===r?e:{...e,width:r};case"readWidth":return t.payload(e.width),e;case"setPosSafe":const{pos:i,containerWidth:o=0,containerHeight:a=0}=t.payload,l=(0,N.D)(document.documentElement),c=(0,L.V)()||0;let u=i.x;const d=u+o-(window.innerWidth-(l.v?c:0));d>0&&(u-=d),u<0&&(u=0);let p=i.y;if(a){const e=p+a-(window.innerHeight-(l.h?c:0));e>0&&(p-=e)}return p<0&&(p=0),u===n.x&&p===n.y?null==e.otherStyles?e:{...e,otherStyles:null}:{...e,pos:{x:u,y:p,is3d:n.is3d},otherStyles:null};case"readPos":return t.payload(e.pos),e;case"importPopperStyles":const f=t.payload,m={pos:y(f.transform)||{x:0,y:0,is3d:!1},otherStyles:f};return _()(m,w()(e,["pos","otherStyles"]))?e:{...e,...m};case"incrementalPos":const{dx:g,dy:v}=t.payload;return 0===g&&0===v?e:{...e,pos:{x:n.x+g,y:n.y+v,is3d:n.is3d}};case"switch2fixed":const{pageXOffset:x,pageYOffset:b}=window,T={...e,otherStyles:null};return h||0===x&&0===b||(T.pos={x:n.x-x,y:n.y-b,is3d:n.is3d}),T;default:return e}}var P=n(31085);const A=E()("popperContainer"),I=w()(T.g2,["width","pinPos","pinAfterDrag"]),O=(0,i.forwardRef)((function(e,t){const{pin:n,setPin:s,range:r,show:o,placement:a,setMaxHeight:f,targetRef:y}=e,[b,T]=(0,i.useState)(!1);(0,i.useEffect)((()=>{o&&T(!1)}),[o]),(0,i.useEffect)((()=>{n||T(!1)}),[n]);const[S,E]=(0,i.useState)(null),k=(0,i.useRef)(null),_=(0,i.useMemo)((()=>o&&!n&&r?r:null),[r,o,n]),[N,L]=(0,i.useReducer)(R,{width:I.width,pos:{x:0,y:0,is3d:!1},otherStyles:null}),[O,z]=(0,x.A)(I),M=O?O.width:I.width,F=e=>{A("保存窗口宽度",e),z({width:e})};(0,i.useEffect)((()=>{A("同步 storage 中的宽度",M),L({type:"setWidth",payload:M})}),[M]);const D=O?O.pinPos:I.pinPos,$=e=>{const t=e&&w()(e,["x","y"]);A("保存窗口位置",t),z({pinPos:t})},B=()=>{n?L({type:"readPos",payload:$}):A("保存窗口位置时由于不是 pin 状态，取消保存")},W=(0,i.useCallback)((()=>{D&&(A("设置窗口位置"),L({type:"setPosSafe",payload:{pos:D,containerWidth:null==S?void 0:S.clientWidth,containerHeight:null==S?void 0:S.clientHeight}}))}),[S,D]);(0,i.useEffect)((()=>{if(n&&o)return W(),window.addEventListener("resize",W),()=>{window.removeEventListener("resize",W)}}),[W,n,o]);const[H,U]=(0,i.useReducer)(C,null),{realtimePlacement:Y,updatePopper:V,popperStyles:K,popperAttrs:q,arrowStyles:X,maxSizeObj:Z}=function(e,t,n,s){const{styles:r,attributes:i,update:o,state:a}=(0,d.E)(e,t,{placement:s,strategy:h?"fixed":void 0,modifiers:[{name:"arrow",options:{element:n}},{name:"computeStyles",options:{adaptive:!1}},{name:"offset",options:{offset:[0,12]}},p.A]});return{realtimePlacement:e&&(null==a?void 0:a.placement)||null,updatePopper:e?o:null,popperStyles:e?r.popper:null,popperAttrs:e?i.popper:null,arrowStyles:e?r.arrow:null,maxSizeObj:e&&(null==a?void 0:a.modifiersData.maxSize)||null}}(_,S,k.current,a);(0,i.useEffect)((()=>{U({type:"overload",payload:X})}),[X]),(0,i.useEffect)((()=>{!n&&Z&&f(Z.height)}),[Z,n,f]),(0,j.A)((()=>{K&&(A("导入 popperjs 的样式",K),L({type:"importPopperStyles",payload:K}))}),[K]);const G=function(e,t,n,s){const[r,o]=(0,i.useState)(null),[a,l]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{if(!e)return;const t=m()(e);return t.resizable({...g(),onstart(){l(!0)}}),o(t),()=>{t.unset(),o(null)}}),[e]),(0,i.useEffect)((()=>{if(!r)return;let e;if(t){const n=t.indexOf("-");switch(e=n>0?t.slice(0,n):t,e){case"top":e="bottom";break;case"bottom":e="top";break;case"left":e="right";break;case"right":e="left"}if("top"===e||"bottom"===e)return}const n=g();e&&(n.edges[e]=!1),r.set({resize:n})}),[t,r]),(0,i.useEffect)((()=>{if(!r)return;const e=function(e){n(e.rect.width,e.deltaRect.left,e.deltaRect.top)};return r.on("resizemove",e),()=>{r.off("resizemove",e)}}),[n,r]),(0,i.useEffect)((()=>{if(!r)return;const e=function(){l(!1),s()};return r.on("resizeend",e),()=>{r.off("resizeend",e)}}),[r,s]),a}(S,Y,((e,t,n)=>{L({type:"setWidth",payload:e}),L({type:"incrementalPos",payload:{dx:t,dy:n}}),U({type:"incremental",payload:{x:t,y:n,placement:Y}})}),(()=>{L({type:"readWidth",payload:F}),B()}));!function(e,t,n,s,r){const[o,a]=(0,i.useState)(null),[l,c]=(0,i.useState)(!1);(0,i.useEffect)((()=>{if(!e)return;const n=e.querySelector(t);if(!n)return void console.warn("未找到 selector “"+t+"”对应的元素，将不会启动拖拽功能。");const s=m()(n);return s.draggable(!0).styleCursor(!1),a(s),()=>{s.unset(),a(null)}}),[e,t]),(0,i.useEffect)((()=>{if(!o)return;const e=()=>{c(!0),n()};return o.on("dragstart",e),()=>{o.off("dragstart",e)}}),[o,n]),(0,i.useEffect)((()=>{if(!o)return;const e=e=>{s(e.dx,e.dy)};return o.on("dragmove",e),()=>{o.off("dragmove",e)}}),[o,s]),(0,i.useEffect)((()=>{if(!o)return;const e=()=>{c(!1),r()};return o.on("dragend",e),()=>{o.off("dragend",e)}}),[o,r])}(S,".drag-block",(0,i.useCallback)((()=>{T(!0),(null==(null==O?void 0:O.pinAfterDrag)?I.pinAfterDrag:O.pinAfterDrag)&&s((e=>(e||(A("拖拽过程中将窗口转为固定模式位置"),L({type:"switch2fixed"})),!0)))}),[s,null==O?void 0:O.pinAfterDrag]),((e,t)=>{L({type:"incrementalPos",payload:{dx:e,dy:t}})}),(()=>{B()})),(0,i.useImperativeHandle)(t,(()=>({switch2pin(){A("主动调用 switch2pin 方法转为固定模式"),L({type:"switch2fixed"}),B()},clearPos(){A("由于转为了非固定模式，所以清空了 storage 里的位置"),$(null),window.setTimeout((()=>{V&&V()}))}})));const J=(0,i.useMemo)((()=>{const e={...N.otherStyles,width:N.width,transform:v(N.pos)};return A("合成 container 样式",e),e}),[N]);return(0,P.jsxs)("div",{id:"popper-container",ref:E,style:J,...q,className:l()({show:o,pin:n},c.Nzu),children:[(0,P.jsx)(u.P,{onResize:()=>{n&&o&&!G&&W()},targetRef:y,children:e.children}),!b&&(0,P.jsx)("div",{className:"arrow",ref:k,style:H||void 0})]})}));var z=n(19687),M=n(23590),F=n(10435),D=n(16342),$=n(3444),B=n(63446),W=n(22067),H=n(54449),U=n(98087),Y=n.n(U),V=n(79071),K=n.n(V),q=n(62269),X=n(4225),Z=n(91307),G=n(81152),J=n(20760),Q=n(83813),ee=n(5877),te=n(3040),ne=n(96072),se=n(74703),re=n(98009),ie=n(74070),oe=n(66690),ae=n(81215);const le=w()(T.g2,"secondDestinationLatestSource","selectedAPIs","collapsedAPIs","selectedExternalLinks","source","destination","autoPlay","autoCopy","recentUseLangFrom","recentUseLangTo","sourceTransformNCaml","sourceTransformNoBr","sourceTransformNoComment","sourceLower","sourceTransformRegExps","tipPanelSettingsClosed","historyEnabled","favoritesEnabled","quickLinks","tipQuickLinksClosed","panelCustomStyle","customAPINames","panelSize","panelButtons","textAreaAuto"),ce=w()(T.Ne,["user","noticesUnreadNum"]),ue={small:14,middle:18,large:22},de=(0,i.forwardRef)((function(e,t){const{toaster:n,headerLeft:s,headerRight:o,extendOptions:a,showTextArea:l=!1,size:u="small",style:d,hasDragTip:p,portalContainer:h,showOptionsTip:f=!0,onTranslate:m,elementRef:g}=e,[y,v,b]=(0,x.A)(le),[T]=(0,x.A)(ce),S=(null==T?void 0:T.user)||null,E=(0,i.useMemo)((()=>{const e=null==y?void 0:y.selectedAPIs,t=null==y?void 0:y.customAPINames;if(e&&t)return[...e,...t]}),[null==y?void 0:y.customAPINames,null==y?void 0:y.selectedAPIs]),C=(0,i.useMemo)((()=>{const e=null==y?void 0:y.collapsedAPIs;return e&&e.length?(0,Q.jM)(E,(t=>{t&&e.forEach((e=>{const n=t.indexOf(e);n>=0&&t.splice(n,1)}))})):E}),[E,null==y?void 0:y.collapsedAPIs]),j=(null==y?void 0:y.quickLinks.filter((e=>e.panel)))||[],k=y||le,_=ue[u],N="small"===u,L="large"===u,R=(null==y?void 0:y.source)||"",A=(0,i.useCallback)((e=>{v({source:e})}),[v]),[I,O]=(0,i.useState)(""),[U,V]=(0,i.useState)(""),de=I===U,pe=(0,i.useRef)(null),[he,fe]=(0,i.useState)(!1),{results:me,queryResult:ge,dispatchResults:ye}=(0,G.L)(U,C,R,null==y?void 0:y.destination,m),[ve,xe]=(0,i.useState)([]),[,be]=(0,X.A)(),{isInFavorites:we,saveOrDelete:Te}=(0,J.A)(U,ye,C),Se=(0,se.O)(n),{sourceTransformNCaml:Ee,sourceTransformNoBr:Ce,sourceTransformNoComment:je,sourceLower:ke,sourceTransformRegExps:_e}=w()(y||le,["sourceTransformNCaml","sourceTransformNoBr","sourceTransformNoComment","sourceLower","sourceTransformRegExps"]),Ne=(0,i.useRef)(""),Le=(0,i.useCallback)((e=>{if(e===Ne.current)return;Ne.current=e,xe((e=>(0,Q.jM)(e,(e=>{e.splice(0)}))));const t=(0,ae.W)(e,{sourceTransformNCaml:Ee,sourceTransformNoBr:Ce,sourceTransformNoComment:je,sourceLower:ke,sourceTransformRegExps:_e});O(t),V(t)}),[Ee,Ce,je,ke,_e]),Re=(0,i.useRef)(Le);Re.current=Le;const Pe=(0,ee.A)(U);(0,i.useEffect)((()=>{k.historyEnabled&&Pe!==U&&U&&be({type:"save translate record",text:U})}),[be,U,k.historyEnabled]),(0,i.useEffect)((()=>{k.secondDestinationLatestSource&&Pe!==U&&U&&(0,oe.o)(U).then((e=>{null!=e&&"中文(简体)"!==e&&r().storage.local.set({latestSource:e})}))}),[U,k.secondDestinationLatestSource]),(0,i.useImperativeHandle)(t,(()=>({select(){var e;null===(e=pe.current)||void 0===e||e.select()},async play(){var e;if(!E)return;const t=E[0],n=null===(e=me.results[t])||void 0===e?void 0:e.result;var s;return t&&(null==n?void 0:n.text)===Ne.current?(0,H.Z)({apiId:t,source:n.from,text:n.text,ttsURI:(null===(s=n.phonetic)||void 0===s?void 0:s[0].ttsURI)||n.ttsURI}):void 0},async setText(e){if(await b,"text"===e.type)O(e.text);else if("image"===e.type)return Se(e.dataURI).then((e=>{O(e)}))},async translate(e,t){if(await b,"text"===e.type)Re.current(e.text),t&&this.select();else if("image"===e.type)return Se(e.dataURI).then((e=>{Re.current(e),t&&this.select()}))}})),[Se,b,me.results,E]);const Ae=(0,i.useMemo)((()=>N?{width:6,height:6,borderRadius:3,right:3,top:1}:L?{width:10,height:10,borderRadius:5,right:8,top:6}:{width:8,height:8,borderRadius:4,right:5,top:3}),[L,N]),Ie=(0,P.jsx)(z.$,{icon:(0,P.jsx)(M.I,{icon:"cog",size:_}),small:N,large:L,minimal:!0,active:he,className:"settings",onClick:()=>{fe((e=>!e))},title:"快捷设置"});return(0,P.jsxs)(P.Fragment,{children:[(null==y?void 0:y.panelCustomStyle)&&(0,P.jsx)("style",{children:y.panelCustomStyle.replace(/bp3/g,"bp4").replace(/bp4/g,"bp5")}),(0,P.jsxs)("div",{id:"translate-panel",className:"size-"+u,style:d,ref:g,children:[(0,P.jsxs)("div",{className:"fixed",children:[(0,P.jsxs)("div",{className:"header",children:[(0,P.jsxs)("div",{className:"left",children:[s,(null==y?void 0:y.panelButtons.includes("media"))&&(0,P.jsx)(re.m,{isSmall:N,isLarge:L,iconSize:_,onSelect:e=>{Se(e).then(Le,K())},portalContainer:h}),(null==y?void 0:y.panelButtons.includes("microphone"))&&(0,P.jsx)(ie.h,{isSmall:N,isLarge:L,iconSize:_,onSelect:Le,portalContainer:h}),(null==y?void 0:y.panelButtons.includes("folder-open"))&&(0,P.jsx)(z.$,{small:N,large:L,minimal:!0,icon:(0,P.jsx)(M.I,{icon:"folder-open",size:_}),onClick:()=>{r().runtime.sendMessage({action:"open options page",suffix:"#/stars"})},title:"打开收藏夹"}),(null==y?void 0:y.panelButtons.includes("history"))&&(0,P.jsx)(z.$,{small:N,large:L,minimal:!0,icon:(0,P.jsx)(M.I,{icon:"history",size:_}),onClick:()=>{r().runtime.sendMessage({action:"open options page",suffix:"#/history"})},title:"打开历史记录"})]}),(0,P.jsx)("div",{className:"drag-block",title:p?"按住不放可以拖动":void 0}),(0,P.jsxs)("div",{className:"right",children:[!!ve.length&&(0,P.jsx)(z.$,{icon:(0,P.jsx)(M.I,{icon:"undo",size:_}),small:N,large:L,minimal:!0,title:"返回上一次翻译",onClick:()=>{const e=Y()(ve);e&&(O(e),V(e)),xe((e=>(0,Q.jM)(e,(e=>{e.pop()}))))}}),!(null==T||!T.noticesUnreadNum)&&(0,P.jsxs)("div",{style:{fontSize:0,position:"relative"},children:[(0,P.jsx)(z.$,{icon:(0,P.jsx)(M.I,{icon:"notifications",size:_}),small:N,large:L,minimal:!0,title:`你有 ${T.noticesUnreadNum} 条未读消息`,onClick:()=>{r().runtime.sendMessage({action:"open options page",suffix:"?notices"})}}),(0,P.jsx)("div",{style:{position:"absolute",background:"rgb(243,1,1)",...Ae}})]}),y&&(0,P.jsxs)(P.Fragment,{children:[y.favoritesEnabled&&(0,P.jsx)(z.$,{icon:(0,P.jsx)(M.I,{icon:we?"star":"star-empty",size:_}),disabled:!U,small:N,large:L,minimal:!0,title:we?"从收藏夹中删除":"添加到收藏夹",onClick:Te}),y.tipPanelSettingsClosed&&Ie,!y.tipPanelSettingsClosed&&(0,P.jsx)(F.A,{enforceFocus:!1,content:(0,P.jsxs)("div",{className:c.KJG,style:{width:"200px",padding:"5px"},children:["添加 / 隐藏翻译源、语种切换、鼠标悬浮取词开关和显示翻译文本开关在这里。",(0,P.jsx)("a",{onClick:()=>{v({tipPanelSettingsClosed:!0})},children:"不再提示"})]}),canEscapeKeyClose:!1,isOpen:!y.tipPanelSettingsClosed&&f,portalContainer:h,children:Ie})]}),o]})]}),(0,P.jsx)(D.S,{isOpen:he,keepChildrenMounted:!0,children:(0,P.jsx)(Z.A,{source:R,setSource:A,options:y,setOptions:v,user:S,size:u,portalContainer:h,children:a})}),l&&(0,P.jsx)(ne.j,{isLarge:L,isSmall:N,iconSize:_,value:I,onChange:O,onTranslate:e=>{Le(null==e?I:e)},ref:pe,hideBtn:de||!I,auto:(null==y?void 0:y.textAreaAuto)||!1})]}),(0,P.jsxs)("div",{className:"body",style:de?void 0:{opacity:.7},children:[!U&&(0,P.jsx)("p",{children:"请输入需要翻译的文本。"}),U&&y&&(null==E?void 0:E.map(((e,t)=>{const n=me.results[e];return(0,P.jsx)(H.A,{portalContainer:h,apiId:e,result:n,size:u,queryResult:t=>{ge(U,e,t||R)},autoPlay:y.autoPlay&&0===t,autoCopy:y.autoCopy&&0===t,setQuery:e=>{xe((e=>(0,Q.jM)(e,(e=>{e.push(U)})))),V(e),O(e)},collapse:y.collapsedAPIs.includes(e),onCollapseChange:()=>{v((t=>{const n=t.collapsedAPIs.indexOf(e);n>=0?t.collapsedAPIs.splice(n,1):t.collapsedAPIs.push(e)}))}},e)}))),E&&!E.length&&(0,P.jsx)($.I,{className:"no-api",title:"你隐藏了所有翻译源",description:"请添加一个翻译源来显示翻译结果。",action:(0,P.jsx)(F.A,{portalContainer:h,content:(0,P.jsx)(B.W,{children:(0,P.jsx)(q.A,{})}),children:(0,P.jsx)(z.$,{icon:"add",small:N,large:L,text:"添加翻译源"})})}),!(null==y||!y.selectedExternalLinks.length)&&(0,P.jsx)("div",{className:"external-translators",children:y.selectedExternalLinks.map((e=>{const t=te.j.find((t=>t.id===e));return t?(0,P.jsx)("div",{children:(0,P.jsx)(z.A,{small:N,large:L,text:t.name,target:"_blank",href:t.generateLink(U,y.destination,R)})},e):null}))}),y&&!y.tipQuickLinksClosed&&U&&(0,P.jsxs)(W.P,{style:{marginBottom:8,fontSize:12},children:["下方是预定义的三个快捷链接，你可以前往",(0,P.jsx)("a",{onClick:()=>{r().runtime.sendMessage({action:"open options page",suffix:"#/panel"})},children:"“设置” - “翻译面板”"})," ","- “快捷链接”中修改或删除它们。",(0,P.jsx)("a",{onClick:()=>{v({tipQuickLinksClosed:!0})},children:"不再提示"})]}),!!j.length&&U&&(0,P.jsx)("div",{className:"quick-links",children:j.map((e=>(0,P.jsx)("a",{href:e.link.replace("%s",encodeURIComponent(U)),target:"_blank",rel:"noreferrer",children:e.name},e.name)))})]})]})]})})),pe=function(e){e.preventDefault()},he=w()(T.g2,["buttonAutoClose","buttonOffsetTop","buttonOffsetLeft"]);function fe(e){const{btnPos:t,setBtnPos:n,onBtnClick:s}=e,r=t?"show":void 0,[o]=(0,x.A)(he),a=(0,i.useRef)(),[l,c]=(0,i.useState)(!1),u=t?{transform:`translate(${t.x+10-((null==o?void 0:o.buttonOffsetLeft)||0)}px,${t.y+10-((null==o?void 0:o.buttonOffsetTop)||0)}px)`}:void 0;return(0,i.useEffect)((()=>{if(null==o||!o.buttonAutoClose)return c(!1),void window.clearTimeout(a.current);t?l?window.clearTimeout(a.current):a.current=window.setTimeout((()=>{n(null)}),2e3):(c(!1),window.clearTimeout(a.current))}),[t,l,n,null==o?void 0:o.buttonAutoClose]),(0,P.jsx)("div",{id:"translate-btn",className:r,style:u,onPointerDown:pe,onPointerEnter:()=>{c(!0)},onPointerLeave:()=>{c(!1)},children:(0,P.jsx)(z.$,{icon:(0,P.jsx)("span",{className:"btn-icon"}),onClick:s})})}var me=n(81100),ge=n(96538);function ye(e){const t=e.match(/^(([^:]+):\/\/)?([^/]+)?(\/.*)?$/);if(!t)return;let n=t[3]||"";const s=n.indexOf(":");s>=0&&(n=n.slice(0,s));let r=t[4]||"";const i=r.indexOf("#");if(i>=0&&(r=r.slice(0,i)),!n.startsWith(".")){if(!r){if(!n)return;r="/"}return{host:n,path:r}}}function ve(e,t){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace("*",".*").replace(/^\.\*\\\./,"(.*\\.)?")+"$").test(t)}function xe(e,t){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".*")+"$").test(t)}function be(e,t,n){let s,r;s="string"==typeof e?ye(e):e;let i=!1,o=!1;if(s){const e=e=>{const t=function(e,t){let n;if(n="string"==typeof t?ye(t):t,n)return ve(e.host,n.host)&&xe(e.path,n.path)}(e,s);return t&&(r=e),t};i=n.some(e),i||(o=t.some(e))}return{urlParts:s,matchedRule:r,whiteListMatched:i,blackListMatched:o}}var we=n(78107),Te=n(95805),Se=n(6747),Ee=n(23593),Ce=n(83657),je=n.n(Ce),ke=n(38285),_e=n.n(ke),Ne=n(16680),Le=n(90274);function Re(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Pe=E()("detector master");function Ae(e){const t=e.selection;let n=null;if(t){const s=t.text,r=t.event;let i,o,a;if("function"==typeof t.rect)i=t.rect(),o={getBoundingClientRect:t.rect},a=r?{x:r.clientX+e.path[0].scrollLeft,y:r.clientY+e.path[0].scrollTop}:null;else{a=r?{x:r.clientX,y:r.clientY}:null;const n=e.path;i=w()(t.rect,["top","left","width","height","right","bottom"]),je()(n,(e=>{if(e.rect&&e.computedStyles){const t=e.rect.left+e.computedStyles.paddingLeft+e.computedStyles.borderLeftWidth,n=e.rect.top+e.computedStyles.paddingTop+e.computedStyles.borderTopWidth;i.left+=t,i.top+=n,a&&(a.x+=t,a.y+=n)}})),i.right=i.left+i.width,i.bottom=i.top+i.height,o={getBoundingClientRect:()=>i};const s=Y()(e.path);a=a?{x:a.x+s.scrollLeft,y:a.y+s.scrollTop}:null}n={text:s,mouseUpEvent:r,isTop:t.isTop,isInTextarea:t.isInTextarea,isInContentEditable:t.isInContentEditable,range:o,btnPos:a}}return{parsedData:n,activeFrameIndex:e.path.map((e=>e.frameIndex))}}var Ie=n(28820),Oe=n.n(Ie),ze=n(41938),Me=n(30819);const Fe=w()(T.g2,["localOCR"]);function De(e){const{imgSrc:t,isShow:n,setIsShow:s,onText:r,isLocalOCR:o,portalContainer:a}=e,[l,c]=(0,x.A)(Fe),u=(0,i.useRef)(null),d=(0,i.useRef)(),p=(0,i.useRef)(null),[h,f]=(0,i.useState)(null);return(0,i.useLayoutEffect)((()=>{if(!n)return;const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}),[n]),(0,i.useLayoutEffect)((()=>{if(!n||!u.current)return;const e=u.current,t=new(Oe())(u.current,{viewMode:1,guides:!1,center:!1,minContainerWidth:e.clientWidth,minContainerHeight:e.clientHeight,autoCrop:!1,movable:!1,rotatable:!1,scalable:!1,zoomable:!1,zoomOnTouch:!1,zoomOnWheel:!1,cropstart(){f(null)},cropend(){const e=t.getCropBoxData();f({left:-9999,top:-9999}),window.setTimeout((()=>{var t;f({left:e.left+e.width-((null===(t=p.current)||void 0===t?void 0:t.clientWidth)||0),top:e.top+e.height+5})}))}});return d.current=t,()=>{f(null),t.destroy(),d.current=void 0}}),[n]),(0,i.useEffect)((()=>{if(!n)return;const e=e=>{27===e.keyCode&&(e.stopPropagation(),s(!1))};return window.addEventListener("keyup",e,!0),()=>{window.removeEventListener("keyup",e,!0)}}),[s,n]),n?(0,P.jsxs)("div",{id:"ocr-container",children:[(0,P.jsxs)("div",{ref:p,className:"toolbar",style:{display:h?"block":"none",left:null==h?void 0:h.left,top:null==h?void 0:h.top},children:[(0,P.jsx)(z.$,{onClick:()=>{var e;if(!window.isSecureContext)return void window.alert("受限于浏览器的安全策略，复制截图只能在 https 网站使用。");if(null===(e=navigator.clipboard)||void 0===e||!e.write)return void window.alert(Me.KA?"复制截图的功能需要在 Chrome 66 / Edge 79 及以上的版本中才能使用。":"Firefox 浏览器暂时不支持复制截图，请在别的浏览器上使用。");const t=d.current;t&&t.getCroppedCanvas({imageSmoothingEnabled:!1}).toBlob((e=>{e&&navigator.clipboard.write([new ClipboardItem({[e.type]:e})]).then((()=>{s(!1)}),(e=>{window.alert("复制失败，错误消息："+e.message)}))}))},children:"复制截图"}),o&&(0,P.jsx)(ze._,{value:(null==l?void 0:l.localOCR.lang)||Fe.localOCR.lang,onChange:e=>{c((t=>{t.localOCR.lang=e}))},portalContainer:a}),(0,P.jsx)(z.$,{onClick:()=>s(!1),children:"取消 (Esc)"}),(0,P.jsx)(z.$,{onClick:()=>{const e=d.current;if(!e)return;const t=e.getCroppedCanvas().toDataURL(),n=e.getCropBoxData();r(t,n),s(!1)},children:"确定"})]}),(0,P.jsx)("img",{ref:u,src:t,alt:"屏幕截图"})]}):null}var $e=n(12128),Be=(n(7212),n(22053)),We=n.n(Be),He=n(18785),Ue=n(27429),Ye=n(72431);function Ve(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Ke=[Ye.VI.ChatGPT,Ye.VI.Claude,Ye.VI.Gemini,Ye.VI.TongYi,Ye.VI.LingYi,Ye.VI.Moonshot,Ye.VI.DeepSeek,Ye.VI.ZhiPu,Ye.VI.MiniMax,Ye.VI.BaiChuan,Ye.VI.DouBao,Ye.VI.WenXin,Ye.VI.HunYuan,Ye.VI.SiliConflow];class qe extends Ue.A{constructor(e,t){super(),Ve(this,"stream",[]),Ve(this,"streamTextLength",0),Ve(this,"queue",[]),Ve(this,"handling",!1),this.apiCode=e,this.options=t}addStream(e){const t=e.text.length;t&&(Ke.includes(this.apiCode)?(this.queue.push([e]),this.handleTask()):(this.streamTextLength+t>3e3&&(this.queue.push(this.stream),this.stream=[],this.streamTextLength=0,this.handleTask()),this.stream.push(e),this.streamTextLength+=t,window.setTimeout((()=>{this.handleTask()}),500)))}handleTask(){if(this.handling)return;let e=this.queue.shift();if(!e){if(!this.stream.length)return;e=this.stream,this.stream=[],this.streamTextLength=0}this.handling=!0;const t=[],n=[];e.forEach((e=>{const s=e.text.split("\n").map((e=>e.trim())).filter(We());n.push({start:t.length,end:t.length+s.length}),t.push(...s)})),this.emit("translate-before"),r().runtime.sendMessage({action:"translate",data:{apiCode:this.apiCode,source:this.options.source,destinations:this.options.dest,text:t.join("\n")}}).finally((()=>{this.emit("translate-after")})).then((t=>{let s;if(t.result)s=t.result;else{var r;const e=null===(r=t.dict)||void 0===r?void 0:r[0].terms[0];e&&(s=[e])}const i=t.error;var o,a;null!=i&&i.message&&(i.message=`【${o=this.apiCode,null===(a=He.v.find((e=>e.id===o)))||void 0===a?void 0:a.name}】${i.message}`),e.forEach(((e,t)=>{if(i)return void e.reject(i);if(!s)return void e.reject(new Error("没有翻译结果"));const r=n[t],o=r.end-r.start,a=s.slice(r.start,r.end);e.resolve(a.length===o?a.join("\n"):null)})),this.handling=!1}),(t=>{e.forEach((e=>{e.reject(t)})),this.handling=!1})).then((()=>{this.handleTask()}))}}var Xe=n(94903);function Ze(){const e=document.body.childNodes;return 1===e.length&&e[0]instanceof HTMLPreElement}class Ge{constructor(e,t=Xe.a.source,n){let s;if(n)s=n;else{if(!Ze())throw new TypeError("当前页面不是 txt 文件。");s=document.body.firstElementChild}this.preElement=s,this.showType=Xe.a.source,this.originText=s.textContent||"",this.originParagraphs=this.originText.split(/\n{2,}/),this.resultParagraphs=[],this.originParagraphs.forEach(((t,n)=>{const s=t.replace(/\n/g," ").trim();s?(this.resultParagraphs[n]="正在翻译，请稍候……",e(s).then((e=>{this.resultParagraphs[n]=e||"",this.renderResult()}))):this.resultParagraphs[n]=""})),this.switchShowType(t)}renderResult(){switch(this.showType){case Xe.a.source:this.preElement.textContent=this.originText;break;case Xe.a.result:this.preElement.textContent=this.resultParagraphs.join("\n\n");break;case Xe.a.both:this.preElement.textContent=this.originParagraphs.reduce(((e,t,n)=>t.trim()?e+t+"\n【译文】"+this.resultParagraphs[n]+"\n\n":e),"")}}switchShowType(e){this.showType!==e&&(this.showType=e,this.renderResult())}destroy(){this.switchShowType(Xe.a.source),this.destroyed=!0}}class Je{constructor(e,t,n,s){this.rootNode=e,this.staticChildNodes=t,this.translateNodes=[],this.translateFn=n,this.options=s}add(e,t){const{rootNode:n,staticChildNodes:s,translateNodes:r,translateFn:i}=this,o=s.slice(e,t+1),a=new Xe.r(n,o,i,this.options);return r.push(a),a}translate(){this.translateNodes.forEach((e=>e.translate()))}setOnlyChild(){var e;null===(e=this.translateNodes[0])||void 0===e||e.setOnlyChild()}switchShowType(e){this.translateNodes.forEach((t=>t.switchShowType(e)))}destroy(){this.translateNodes.forEach((e=>e.destroy()))}}const Qe=["base","head","link","meta","style","body","hr","pre","br","area","audio","img","map","track","video","embed","iframe","object","param","picture","portal","source","svg","math","canvas","noscript","script","input","meter","progress","textarea","select"],et=["article","aside","footer","header","h1","h2","h3","h4","h5","h6","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","li","ol","p","ul","details","dialog","menu","summary","form","table","thead","tbody","tr","th","td","center","label"].concat(Qe);function tt(e){return e.nodeType===Node.ELEMENT_NODE}function nt(e){const t=e.tagName.toLowerCase();return et.includes(t)||t.includes("-")&&"g-emoji"!==t}function st(e){const t=e.tagName.toLowerCase();return"button"===e.getAttribute("role")?!Qe.includes(t):"button"===t||"a"===t}function rt(e,t,n=(()=>!1),s){const r={element:e,paragraphs:[],children:[]};if(e instanceof Element&&n(e))return r;if(e instanceof Element){const i=e.shadowRoot;if(i){const e=rt(i,t,n,s);r.children.push(e)}}let i;const o=Array.from(e.childNodes);let a=!1;const l=o.filter((e=>{if(e.nodeType===Node.TEXT_NODE){var t;const n=!(null===(t=e.nodeValue)||void 0===t||!t.trim());return n&&(a=!0),n}return e.nodeType===Node.ELEMENT_NODE})),c=e=>o.indexOf(l[e]);if(l.forEach(((u,d)=>{if(null==i&&(i=d),tt(u)&&(nt(u)||function(e,t,n){const s=e[t];if(!tt(s))return!1;const r=e[t-1],i=e[t+1];if(st(s)&&!n){if(r&&tt(r)&&st(r))return!0;if(i&&tt(i)&&st(i))return!0}return r?tt(r)&&nt(r):!i||tt(i)&&nt(i)}(l,d,a))){const a=d-1;if(a>=i){const n=c(i),s=c(a);r.paragraphs.push([n,s]),null==t||t(e,o,n,s)}if(i=void 0,!function(e){if(st(e))return!1;const t=e.tagName.toLowerCase();return Qe.includes(t)}(u)&&!n(u)){const e=rt(u,t,n,s);r.children.push(e)}}})),null!=i){const n=l.length-1,s=c(i),a=c(n);r.paragraphs.push([s,a]),null==t||t(e,o,s,a)}return 1===r.paragraphs.length&&0===r.children.length&&(null==s||s(r)),r}function it(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ot{constructor(e){it(this,"text",document.title),it(this,"translateResult",""),it(this,"translating",!1),it(this,"translated",!1),it(this,"showType",Xe.a.source),it(this,"destroyed",!1),this.translateFn=e}destroy(){document.title=this.text,this.destroyed=!0}switchShowType(e){if(!this.destroyed){switch(e){case Xe.a.both:document.title=`${this.text} ~ ${this.translateResult}`;break;case Xe.a.source:document.title=this.text;break;case Xe.a.result:document.title=this.translateResult}this.showType=e}}async translate(){if(this.destroyed||!this.text||this.translating||this.translated)return;let e;this.translating=!0,this.translateResult="正在翻译……",this.switchShowType(this.showType);try{e=await this.translateFn(this.text)}catch(e){return this.translating=!1,this.translated=!0,this.translateResult="翻译出错："+e.message,void this.switchShowType(this.showType)}if(this.translating=!1,null==e)return this.translate();this.translated=!0,this.translateResult=e,this.switchShowType(this.showType)}}var at=n(62337),lt=n(69675);const ct={STYLE_NONE:at.P9,STYLE_DOTTED_CLASSIC:at.O,STYLE_DOTTED:at.pb,STYLE_WAVY:at.UU,STYLE_LINE:at.Zi,STYLE_BACKGROUND:at.dd,STYLE_QUOTE:at.PD};let ut;function dt(){if(ut)return;ut=document.createElement("style"),ut.dataset.title="这是由划词翻译创建的节点，用于控制全文翻译的译文样式。",document.head.appendChild(ut);const e=w()(T.g2,["pageTrsResultStyleId","pageTrsResultStyleMainColor","pageTrsResultStyleTextColor","pageTrsResultStyleTextSize","pageTrsResultStyleTextWeight","pageTrsResultStyleCustom"]);(0,lt.A)(e,(t=>{t.pageTrsResultStyleId&&(e.pageTrsResultStyleId=t.pageTrsResultStyleId),void 0!==t.pageTrsResultStyleCustom&&(e.pageTrsResultStyleCustom=t.pageTrsResultStyleCustom),void 0!==t.pageTrsResultStyleMainColor&&(e.pageTrsResultStyleMainColor=t.pageTrsResultStyleMainColor),void 0!==t.pageTrsResultStyleTextColor&&(e.pageTrsResultStyleTextColor=t.pageTrsResultStyleTextColor),void 0!==t.pageTrsResultStyleTextSize&&(e.pageTrsResultStyleTextSize=t.pageTrsResultStyleTextSize),void 0!==t.pageTrsResultStyleTextWeight&&(e.pageTrsResultStyleTextWeight=t.pageTrsResultStyleTextWeight),function(){if(!ut)return;let t="hcfy-result{";e.pageTrsResultStyleMainColor&&(t+=`--hcfy-result-main-color:${e.pageTrsResultStyleMainColor};`),e.pageTrsResultStyleTextColor&&(t+=`--hcfy-result-text-color:${e.pageTrsResultStyleTextColor};`),e.pageTrsResultStyleTextSize&&(t+=`--hcfy-result-text-size:${e.pageTrsResultStyleTextSize}em;`),e.pageTrsResultStyleTextWeight&&(t+=`--hcfy-result-text-weight:${e.pageTrsResultStyleTextWeight};`),t+="}","STYLE_CUSTOM"===e.pageTrsResultStyleId?t+=e.pageTrsResultStyleCustom:t+=ct[e.pageTrsResultStyleId]||"",ut.textContent=t}()}))}function pt(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ht(e){const t=e.nodeName.toLowerCase();return"body"!==t&&"html"!==t}function ft(e){return Array.prototype.some.call(e.childNodes,(e=>"hcfy-result"===e.nodeName.toLowerCase()))}class mt{constructor(e,t=Xe.a.both,n=document.body,s){pt(this,"groups",new Map),pt(this,"mutationObserver",new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{tt(e)&&!function(e,t){let n=e;do{if(t(n))return!0;n=n.parentElement}while(n&&ht(n));return!1}(e,(e=>{const t=e.tagName.toLowerCase();return"pre"===t||"hcfy-result"===t||(!!ft(e)||void 0)}))&&this.analysis(e)})),e.removedNodes.forEach((e=>{if(tt(e)){const t=e=>{this.groups.delete(e),Array.prototype.forEach.call(e.children,t)};t(e)}}))}))}))),pt(this,"intersectionObserver",new IntersectionObserver((e=>{e.forEach((e=>{if(0===e.intersectionRatio)return;const t=this.groups.get(e.target);t&&t.translate()}))}),{rootMargin:`${window.screen.availHeight*window.devicePixelRatio}px ${window.screen.availWidth*window.devicePixelRatio}px`})),dt(),this.options=s,this.translateFn=e,this.showType=t,this.titleNode=new ot(e),this.titleNode.switchShowType(t),this.titleNode.translate(),this.analysis(n);const r=document.getElementsByTagName("sr-read")[0];r&&this.analysis(r),this.mutationObserver.observe(n,{childList:!0,subtree:!0})}analysis(e){const{groups:t,translateFn:n}=this;rt(e,((e,s,r,i)=>{let o=t.get(e);o||(o=new Je(e,s,n,this.options),t.set(e,o),e instanceof Element&&this.intersectionObserver.observe(e));o.add(r,i).switchShowType(this.showType)}),(e=>"hcfy-result"===e.tagName.toLowerCase()||ft(e)),(e=>{const n=t.get(e.element);n&&n.setOnlyChild()}))}switchShowType(e){this.showType=e,this.titleNode.switchShowType(e);for(const t of this.groups.values())t.switchShowType(e)}destroy(){this.intersectionObserver.disconnect(),this.mutationObserver.disconnect(),this.titleNode.destroy();for(const e of this.groups.values())e.destroy()}}const gt=w()(T.g2,["pageTrsEditable"]);var yt=n(59596),vt=n(61707),xt=n(20269);const bt=E()("useHoverShow"),wt=Me.UP?2e3:500;function Tt(e,t){(0,i.useEffect)((()=>{if(!e)return;let n=!1;const s=e.clientWidth;let r;bt("第一次读取面板的宽度为 %dpx",s),e.style.transform=`translateX(${t.includes("left")?"-":""}${s}px)`,e.style.transition="none",setTimeout((()=>{if(!n){if(e.style.transform){const n=e.clientWidth;bt("第二次读取面板的宽度为 %dpx",n),e.style.transform=`translateX(${t.includes("left")?"-":""}${n}px)`}setTimeout((()=>{n||(e.style.transition="transform 0.2s")}),0)}}),16);const i=()=>{null!=r&&clearTimeout(r)},o=()=>{i(),e.style.transform=""},a=()=>{var n;n=wt,i(),r=setTimeout((()=>{e.style.transform=`translateX(${t.includes("left")?"-":""}${e.clientWidth}px)`}),n)};return e.addEventListener("mouseenter",o),e.addEventListener("mouseleave",a),()=>{n=!0,i(),e.style.transform="",e.style.transition="",e.removeEventListener("mouseenter",o),e.removeEventListener("mouseleave",a)}}),[e,t])}var St=n(22221);function Et(e){const{children:t,portalContainer:n,showTip:s,clearTip:r}=e;return s?(0,P.jsx)(St.m,{isOpen:!0,portalContainer:n,placement:"left",content:(0,P.jsxs)("div",{style:{width:180},children:["可以在这里切换翻译服务和双语 / 原文 / 译文。",(0,P.jsx)("a",{onClick:r,children:"不再提示"})]}),children:t}):(0,P.jsx)(P.Fragment,{children:t})}var Ct=n(25812);const jt=w()(T.Ne,"tipForSaveSourceSelectClosed");function kt(){const[e,t]=(0,x.A)(jt);return null==e||e.tipForSaveSourceSelectClosed?null:(0,P.jsxs)(W.P,{children:["从现在起，划词翻译会记住你选择的“源语种”，在下次开启全文翻译时会自动使用你之前选择的源语种。",(0,P.jsx)("a",{onClick:()=>{t({tipForSaveSourceSelectClosed:!0})},children:"不再提示"})]})}const _t=[{label:"关闭",value:"close"},{label:"当前标签页",value:"tab"},{label:"当前窗口",value:"window"}];function Nt(e){return(0,P.jsx)(vt.g,{options:_t,value:e.value,onChange:t=>{const n=t.currentTarget.value;e.setValue(n)}})}const Lt=[{name:"双语",value:Xe.a.both},{name:"原文",value:Xe.a.source},{name:"译文",value:Xe.a.result}],Rt=r().runtime.getURL("/logodark.png");function Pt(){r().runtime.sendMessage({action:"open options page",suffix:"#/fulltext"})}const At={...w()(T.g2,["pageTrsApiOptions","customAPINames","tipForSlowDeepLPageTrsClosed","tipForPageTrsClosed"]),...w()(T.Ne,["tipForShortKeyForPageTrsTypeClosed","tipForAddJumpTwoClosed"])};function It(e){const{apiCode:t,source:n,onSourceChange:s,target:o,onTargetChange:a,showType:l,onShowTypeChange:u,onAPIChange:d,auto:p,onAutoChange:h,loading:f,portalContainer:m,pos:g}=e,[y,v]=(0,x.A)(At),b=(0,i.useMemo)((()=>{let e=(null==y?void 0:y.pageTrsApiOptions)||At.pageTrsApiOptions;e.includes(t)||(e=e.concat(t));const n=He.B.filter((t=>e.includes(t.id))),s=((null==y?void 0:y.customAPINames)||At.customAPINames).map((e=>({id:e,name:e})));return s.length?[...n,...s]:n}),[null==y?void 0:y.pageTrsApiOptions,null==y?void 0:y.customAPINames,t]),[w,T]=(0,i.useState)(null),[S,E]=(0,i.useState)(null);(0,i.useEffect)((()=>{if(w)return E(w.closest("."+c._Y0)),()=>{E(null)}}),[w]),Tt(S,g);const C=!!y&&!y.tipForPageTrsClosed,j={position:"absolute",width:30,top:0,bottom:0,padding:"0 3px",...g.includes("right")?{left:-30}:{right:-30}};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(z.$,{ref:T,loading:f,style:j,children:(0,P.jsx)(Et,{portalContainer:m,showTip:C,clearTip:C?()=>{v({tipForPageTrsClosed:!0})}:void 0,children:(0,P.jsx)("img",{src:Rt,style:{width:"100%"},alt:"展开"})})}),(0,P.jsxs)(yt.g,{label:"翻译服务：",inline:!0,className:"page-trs-form-group",style:{margin:"0 0 5px 0"},children:[(0,P.jsx)(vt.g,{value:t,onChange:e=>{const t=e.currentTarget.value;d(t)},children:b.map((e=>"BingDictWeb"===e.id?null:(0,P.jsx)("option",{value:e.id,children:e.name},e.id)))}),"DeepLWeb"===t&&y&&!y.tipForSlowDeepLPageTrsClosed&&(0,P.jsxs)(W.P,{intent:"warning",icon:null,style:{width:200},children:[(0,P.jsxs)("p",{children:["DeepL 首次翻译速度较慢，请耐心等待。若遇到问题（报错、翻译结果不全等）请",(0,P.jsx)("a",{href:"https://hcfy.app/docs/services/free/#deepl",target:"_blank",rel:"noreferrer",children:"点击查看解决方案"}),"。"]}),(0,P.jsx)(z.$,{small:!0,intent:"primary",onClick:()=>{v({tipForSlowDeepLPageTrsClosed:!0})},children:"不再提示"})]})]}),(0,P.jsxs)(yt.g,{label:"模式：",inline:!0,className:"page-trs-form-group",children:[(0,P.jsx)(xt.e,{style:{padding:0},children:Lt.map((e=>(0,P.jsx)(z.$,{active:l===e.value,onClick:()=>{e.value!==l&&u(e.value)},text:e.name},e.value)))}),y&&!y.tipForShortKeyForPageTrsTypeClosed&&(0,P.jsxs)(W.P,{style:{width:160},children:["你可以用快捷键来切换双语 / 原文 / 译文。",(0,P.jsxs)("div",{children:[(0,P.jsx)("a",{onClick:()=>{r().runtime.sendMessage({action:"open options page"})},style:{marginRight:15},children:"前往设置"}),(0,P.jsx)("a",{onClick:()=>{v({tipForShortKeyForPageTrsTypeClosed:!0})},children:"不再提示"})]})]}),y&&!y.tipForAddJumpTwoClosed&&(0,P.jsxs)(W.P,{style:{width:160},children:["切换双语 / 原文 / 译文的快捷键现在可以选择【跳过双语】了。",(0,P.jsxs)("div",{children:[(0,P.jsx)("a",{onClick:()=>{r().runtime.sendMessage({action:"open options page"})},style:{marginRight:15},children:"前往设置"}),(0,P.jsx)("a",{onClick:()=>{v({tipForAddJumpTwoClosed:!0})},children:"不再提示"})]})]})]}),(0,P.jsx)(yt.g,{label:"自动开启：",inline:!0,className:"page-trs-form-group",children:(0,P.jsx)(Nt,{value:p,setValue:h})}),(0,P.jsxs)(yt.g,{label:"源语种：",inline:!0,className:"page-trs-form-group",children:[(0,P.jsx)(Ct.A,{lang:n,setLang:s,addAuto:!0,portalContainer:m}),(0,P.jsx)(kt,{})]}),(0,P.jsx)(yt.g,{label:"目标语种：",inline:!0,className:"page-trs-form-group",children:(0,P.jsx)(Ct.A,{lang:o,setLang:a,portalContainer:m})}),(0,P.jsx)("div",{children:(0,P.jsx)("a",{onClick:Pt,children:"打开设置"})})]})}var Ot=n(20916);const zt=w()(T.Ne,"tipForFullTextClosed");function Mt(e){const{fullTextOpen:t,portalContainer:n}=e,[s,r]=(0,i.useState)(!1),[o,a]=(0,i.useState)(!1),[l,u]=(0,x.A)(zt),d=null==l?void 0:l.tipForFullTextClosed;return(0,i.useEffect)((()=>{!1===d&&t&&r(!0)}),[t,d]),!0===d?null:(0,P.jsxs)(Ot.l,{isOpen:s,title:"全文翻译功能的重要提示",portalContainer:n,canEscapeKeyClose:!1,canOutsideClickClose:!1,isCloseButtonShown:!1,children:[(0,P.jsxs)("div",{className:c.sar,children:[(0,P.jsxs)("p",{children:["全文翻译功能默认使用谷歌翻译，但",(0,P.jsx)("a",{href:"https://hcfy.app/blog/2022/09/28/ggg",target:"_blank",rel:"noreferrer",children:"谷歌翻译可能需要额外配置才能使用"}),"。"]}),(0,P.jsxs)("p",{children:["你还可以切换为别的翻译服务，如 DeepL、Yandex 等，",(0,P.jsx)("b",{children:"将鼠标移动至右下角的划词翻译图标上，在弹出来的面板里即可切换"}),"。"]}),(0,P.jsxs)("p",{children:[(0,P.jsx)("b",{children:"DeepL 和 Yandex 是可以直接使用的"}),"，其它翻译服务需要自行申请后才能使用。"]}),(0,P.jsx)("div",{style:{textAlign:"right"},children:(0,P.jsx)(we.Sc,{inline:!0,style:{margin:0},checked:o,onChange:e=>{a(e.currentTarget.checked)},label:"不再提示"})})]}),(0,P.jsx)("div",{className:c.DBf,style:{marginTop:0},children:(0,P.jsx)("div",{className:c.Nu2,children:(0,P.jsx)(z.$,{intent:"primary",text:"我知道了",onClick:()=>{r(!1),o&&u({tipForFullTextClosed:!0})}})})})]})}var Ft=n(46172),Dt=n(51018);const $t=S("@hcfyapp/aftr");class Bt extends Ue.b{constructor(){super(),chrome.runtime.onMessage.addListener((e=>{var t;if((t=e,(0,Dt.Z4)(t)&&"__aftrMessage__"in t)&&($t("收到消息 %o",e),"setMode"===e.__aftrAction__))this.emit("change",e.__aftrPayload__)}))}getMode(){return(0,Ft.Ye)({__aftrMessage__:!0,__aftrAction__:"getMode"})}setMode(e){return(0,Ft.Ye)({__aftrMessage__:!0,__aftrAction__:"setMode",__aftrPayload__:e})}}const Wt=new Bt;const Ht=50,Ut=new $e.y("pageTranslateLimit",Ht);const Yt={...w()(T.g2,["pageTrsApi","pageTrsSource","pageTrsDest"]),...w()(T.Ne,["pageTrsType"])},Vt=w()(T.g2,["pageTrsJumpTwo"]);function Kt(e){const{open:t,setOpen:n,portalContainer:s,pos:o="bottom-right"}=e,{mode:a,setMode:l}=function(e){const[t,n]=(0,i.useState)(null),s=(0,i.useRef)(e);return(0,i.useEffect)((()=>{s.current=e}),[e]),(0,i.useEffect)((()=>{Wt.getMode().then((e=>{var t;n(e),null===(t=s.current)||void 0===t||t.call(s,e)}))}),[]),(0,i.useEffect)((()=>(Wt.on("change",n),()=>{Wt.off("change",n)})),[]),{mode:t,setMode:(0,i.useCallback)((e=>{n(e),Wt.setMode(e)}),[])}}((e=>{"close"!==e&&n(!0)})),[c,u]=(0,i.useState)(null),d=(0,i.useRef)(),p=(0,i.useRef)(""),[h,f]=(0,i.useState)(Xe.a.both),[m,g]=(0,i.useState)(""),y=(0,i.useCallback)((e=>{r().storage.local.set({pageTrsType:e}),f(e),d.current?d.current.switchShowType(e):console.warn("不应该在未开启全文翻译时切换显示类型。")}),[]),[v,x]=(0,i.useState)(Yt.pageTrsSource),[b,w]=(0,i.useState)(Yt.pageTrsDest[0]),[T,S]=(0,i.useState)(!1),E=(0,i.useCallback)((async()=>{d.current&&(d.current.destroy(),d.current=void 0);if(await Ut.isOver(!0)){if(n(!1),l("close"),!c)throw new Error("toaster 不应该为空。");!function(e){e.show({action:{text:"开通会员",onClick:Z.$},message:`非会员每七天只能使用 ${Ht} 次网页全文翻译功能，下次重置时间：${Ut.dateEnd}。成为会员即可解除此限制。`,intent:"primary",timeout:0})}(c)}else d.current=await async function(){const{pageTrsType:e,pageTrsApi:t,pageTrsDest:n,pageTrsSource:s}=await r().storage.local.get(Yt);f(e),g(t),w(n[0]),x(s);const i=new qe(t,{dest:n,source:s});return i.on("translate-before",(()=>{S(!0)})),i.on("translate-after",(()=>{S(!1)})),async function(e,t=Xe.a.both){if(Ze())return new Ge(e,t);{const n=await r().storage.local.get(gt);return new mt(e,t,document.body,{editable:n.pageTrsEditable})}}((e=>new Promise(((t,n)=>i.addStream({text:e,resolve:t,reject:n})))),e)}()}),[n,l,c]);return(0,i.useEffect)((()=>{if(!c||!t)return;const e={message:(0,P.jsx)(It,{loading:T,source:v,onSourceChange:e=>{r().storage.local.set({pageTrsSource:e}).then((()=>{E()}))},target:b,onTargetChange:e=>{r().storage.local.set({pageTrsDest:[e]}).then((()=>{E()}))},showType:h,onShowTypeChange:y,auto:a||"close",onAutoChange:e=>{l(e)},apiCode:m,onAPIChange:e=>{r().storage.local.set({pageTrsApi:e}),g(e),E()},portalContainer:s,pos:o}),timeout:0,onDismiss(){p.current="",n(!1)}};p.current?c.show(e,p.current):p.current=c.show(e)}),[T,t,E,m,a,h,s,o,n,l,v,y,b,c]),(0,i.useEffect)((()=>{t&&E()}),[t,E]),(0,i.useEffect)((()=>{c&&!t&&(d.current&&(d.current.destroy(),d.current=void 0),p.current&&(c.dismiss(p.current),p.current=""))}),[t,c]),(0,i.useEffect)((()=>{if(t)return r().runtime.onMessage.addListener(e),()=>{r().runtime.onMessage.removeListener(e)};function e(e){if("page translate switch mode"===e){const e=Lt.findIndex((e=>e.value===h));if(e<0)return;let t=e+1;t>=Lt.length?r().storage.local.get(Vt).then((({pageTrsJumpTwo:e})=>{t=e?1:0,y(Lt[t].value)})):y(Lt[t].value)}}}),[t,h,y]),(0,P.jsxs)("div",{id:"web-trs-panel",children:[(0,P.jsx)(Mt,{fullTextOpen:t,portalContainer:s}),(0,P.jsx)(Te.V,{position:o,ref:u,className:"app-toaster-container",usePortal:!1})]})}var qt=n(86234),Xt=n(29842);function Zt(e){const{mediaElement:t,serviceImplement:n,lang:s,onStart:r,onStop:o}=e,[a,l]=(0,i.useState)(!1),[c,u]=(0,i.useState)([]),[d,p]=(0,i.useState)(""),h=t instanceof HTMLAudioElement?"音频":"视频",f=(0,i.useRef)(!1),m=(0,i.useRef)(),g=()=>{u([]),p("")},y=(0,i.useCallback)((()=>{if(!t)return;if(a)throw new Error("识别服务正在运行，在停止前无法直接开始。");f.current=!1,l(!0),t.pause();const e=e=>{const t=(0,Xt.H8)(e);window.alert(t.message),g(),l(!1),o()};n.mediaStream({mediaStream:t,lang:s,options:{onInterim:e=>{f.current||p(e)},onSentence:e=>{f.current||(p(""),u((t=>(0,Q.jM)(t,(t=>{t.push(e)})))))},onStop:e=>{if(f.current)return;g();const t=e.join("\n");t.length?o(t):o()},onError:t=>{f.current||e(t)}}}).then((e=>{f.current?e.abort():(m.current=e,t.play(),r())}),e)}),[s,t,r,o,a,n]),v=(0,i.useCallback)((()=>{var e;l(!1),null===(e=m.current)||void 0===e||e.stop(),m.current=void 0,null==t||t.pause()}),[t]),x=(0,i.useCallback)((()=>{var e;f.current=!0,l(!1),null===(e=m.current)||void 0===e||e.abort(),m.current=void 0}),[]);return(0,i.useEffect)((()=>x),[x]),{start:y,stop:v,abort:x,running:a,mediaText:h,allSentences:c,interimSentence:d}}const Gt=new $e.y("videoLimit",1/0);let Jt="";function Qt(e){e.show({action:{text:"开通会员",onClick:Z.$},message:`非会员每七天只能翻译 ${Gt.max} 个音视频，下次重置时间：${Gt.dateEnd}。成为会员即可解除此限制。`,intent:"primary",timeout:0})}function en(e){const{disabled:t,toaster:n}=e,{start:s,stop:r,running:i,mediaText:o,allSentences:a,interimSentence:l}=Zt(e);return(0,P.jsxs)("div",{children:[(0,P.jsxs)("div",{children:[i&&(0,P.jsx)(z.$,{disabled:t,icon:"stop",intent:"primary",onClick:r,children:"停止识别并翻译"}),!i&&(0,P.jsxs)(z.$,{disabled:t,icon:"play",intent:"primary",onClick:()=>{Gt.isOver().then((e=>{e?Qt(n):s()}))},children:["播放",o,"并开始识别"]})]}),(0,P.jsxs)("div",{children:[a.map(((e,t)=>(0,P.jsx)("div",{children:e},t))),(0,P.jsx)("span",{style:{opacity:.6},children:l})]})]})}var tn=n(26964);function nn(e){const{disabled:t,serviceImplement:n,onStop:s,toaster:o}=e,{start:a,abort:l,running:c,mediaText:u,allSentences:d,interimSentence:p}=Zt(e),h=!n.service.realtime,f=t||h,m=d[d.length-1],[g,y]=(0,i.useState)({text:"正在等待识别出一个完整的句子……",result:""});return(0,i.useEffect)((()=>{if(!m)return;let e=!1;return y({text:m,result:"正在翻译，请稍候……"}),r().runtime.sendMessage({action:"translate",data:{apiCode:"GoogleWeb",text:m}}).then((t=>{var n;if(e)return;const s=t.error?t.error.message:(null===(n=t.result)||void 0===n?void 0:n.join(""))||"没有翻译结果";y({text:m,result:s})}),(t=>{e||y({text:m,result:t.message})})),()=>{e=!0}}),[m]),(0,P.jsxs)("div",{children:[h&&(0,P.jsxs)(W.P,{intent:"primary",children:[n.service.name,"不支持实时翻译功能，请选择名称中带有“实时语音识别”的服务。"]}),!c&&(0,P.jsxs)(z.$,{intent:"primary",icon:"play",disabled:f,onClick:()=>{Gt.isOver().then((e=>{e?Qt(o):a()}))},children:["播放",u,"并开始实时翻译"]}),c&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(z.$,{intent:"primary",icon:"stop",onClick:()=>{l(),s()},children:"停止实时翻译"}),(0,P.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",textAlign:"center",color:"white"},children:(0,P.jsxs)("div",{style:{width:"80%",margin:"0 auto"},children:[(0,P.jsx)("div",{style:{marginBottom:10,fontSize:18},children:(0,P.jsx)("span",{style:{backgroundColor:"rgba(0,0,0,0.8)"},children:g.text})}),(0,P.jsx)("div",{style:{fontSize:24},children:(0,P.jsx)("span",{style:{backgroundColor:"rgba(0,0,0,0.8)"},children:g.result})})]})})]}),(0,P.jsx)("div",{style:{opacity:.6},children:p})]})}var sn=n(6839),rn=function(e){return e.PerSentence="0",e.Realtime="1",e}(rn||{});const on={[rn.PerSentence]:"逐句翻译",[rn.Realtime]:"实时翻译"};function an(e){const{onText:t}=e,[n]=(0,i.useState)((()=>Array.from(document.querySelectorAll("video,audio")))),[s,r]=(0,i.useState)(0),[o,a]=(0,i.useState)(rn.PerSentence),[l,c]=(0,i.useState)(Ye.eA.TencentRealtime),[u,d]=(0,i.useState)(sn.AH),[p,h]=(0,i.useState)(sn.aN.defaultLang),[f,m]=(0,i.useState)(!1),g=tn.B9[l];(0,i.useEffect)((()=>{d(tn.xL[g.service.id]),h(g.service.defaultLang)}),[g]);const y=(0,i.useCallback)((()=>{m(!0),function(){const e=window.location.href;Jt!==e&&(Jt=e,Gt.addOne())}()}),[]),v=(0,i.useCallback)((e=>{m(!1),e&&t(e)}),[t]),x=n[s],b=!x,w=l===Ye.eA.WebSpeech,T=b||w;(0,i.useEffect)((()=>{null==x||x.pause()}),[x]);const S=x instanceof HTMLAudioElement?"音频":"视频";return(0,P.jsxs)(P.Fragment,{children:[b&&(0,P.jsx)(W.P,{intent:"primary",style:{marginBottom:10},children:"当前页面没有视频或音频。"}),w&&(0,P.jsxs)(W.P,{intent:"primary",style:{marginBottom:10},children:[g.service.name,"不支持音视频翻译功能，请选择其它语音服务。"]}),n.length>1&&(0,P.jsxs)("div",{children:["选择要翻译的音 / 视频：",(0,P.jsx)(vt.g,{disabled:f,value:s,onChange:e=>{const t=Number(e.currentTarget.value);r(t)},children:n.map(((e,t)=>(0,P.jsx)("option",{value:t,children:t},t)))})]}),(0,P.jsxs)(qt.z,{inline:!0,className:"translate-type-selector",label:"翻译方式：",selectedValue:o,onChange:e=>{a(e.currentTarget.value)},disabled:f||T,children:[Object.keys(on).map((e=>(0,P.jsx)(we.sx,{value:e,children:on[e]},e))),(0,P.jsx)("a",{href:"https://hcfy.app/docs/guides/video/",target:"_blank",rel:"noreferrer",children:"查看使用说明"})]}),(0,P.jsxs)("div",{children:["选择要使用的语音识别服务：",(0,P.jsx)(vt.g,{disabled:f||T,value:l,onChange:e=>{c(e.currentTarget.value)},children:tn.OR.map((e=>(0,P.jsx)("option",{value:e.id,children:e.name},e.id)))})]}),(0,P.jsxs)("div",{children:["选择",S,"的语种：",(0,P.jsx)(vt.g,{disabled:f||T,value:p,onChange:e=>{h(e.currentTarget.value)},children:Object.keys(u).map((e=>(0,P.jsx)("option",{value:e,children:u[e]},e)))})]}),o===rn.PerSentence&&(0,P.jsx)(en,{toaster:e.toaster,disabled:T,mediaElement:x,serviceImplement:g,lang:p,onStart:y,onStop:v}),o===rn.Realtime&&(0,P.jsx)(nn,{toaster:e.toaster,disabled:T,mediaElement:x,serviceImplement:g,lang:p,onStart:y,onStop:v})]})}function ln(e){const{show:t,onClose:n,onText:s}=e,[r,o]=(0,i.useState)(null),a=(0,i.useRef)();return(0,i.useEffect)((()=>{r&&(t?Gt.isOver().then((e=>{e?(n(),Qt(r)):a.current=r.show({message:(0,P.jsx)(an,{onText:s,toaster:r}),timeout:0,onDismiss:()=>{a.current=void 0,n()}},a.current)})):a.current&&r.dismiss(a.current))}),[n,s,t,r]),(0,P.jsx)(Te.V,{position:"bottom-right",ref:o,className:"app-toaster-container",usePortal:!1})}const cn=3e3,un=new $e.y("crossTranslateLimit",cn);function dn(e){const[t,n]=(0,i.useState)(null),[s,r]=(0,i.useState)(""),o=async e=>{const t=await un.isOver(e);n(t),r(un.dateEnd)};return(0,i.useEffect)((()=>{o()}),[]),t?(0,P.jsxs)("div",{style:{textAlign:"center",padding:15},children:[(0,P.jsxs)("p",{children:["非会员用户每七天只能使用 ",cn," ","次网页划词功能，下次重置时间：",s,"。成为会员即可解除此次数限制。"]}),(0,P.jsx)("p",{children:(0,P.jsx)(z.$,{onClick:Z.$,intent:"primary",text:"开通会员"})}),(0,P.jsx)("p",{className:`${c.E4k} ${c.KJG}`,children:"开通会员或到达重置时间后，点击下方按钮即可恢复使用。"}),(0,P.jsx)(z.$,{onClick:()=>{o()},children:"确认开通 / 重置状态"})]}):e.children((()=>{o(!0)}))}const pn={...w()(T.g2,["button","closeAfterMove","disableInTextarea","domainBlackList","domainWhiteList","textList","placement","pin","pinPos","pinIgnoreDomainList","showTextArea","panelSize","modifierKeys","modifierKeyPressedAction","modifierKeyTranslate","modifierKeyLink","ocrService","panelButtons","charsLimit","pageTrsPanelPos","pinEnhance"]),...w()(T.Ne,["hoverTranslate"])};function hn(e,t,n,s){return!(!e&&!n)&&!(null!=s&&s.some((e=>e.test(t))))}function fn(e){const{pin:t,onClick:n,size:s}=e;return(0,P.jsx)("div",{className:"switch-pin",children:(0,P.jsx)(z.$,{icon:(0,P.jsx)(M.I,{icon:"pin",size:ue[s]}),small:"small"===s,large:"large"===s,minimal:!0,active:t,onClick:n})})}const mn=new class{constructor(){Re(this,"topParsedData",null),Re(this,"activeFrameIndex",null),Re(this,"msgMap",new Map),Re(this,"listeners",null),this.topWorker=new Ne.Z((e=>{Pe("收到来自顶层 worker 发送的消息",e),this.sendMsg(e)})),this.messagePassingBetweenFrames=new Le.B,this.messagePassingBetweenFrames.on("message",(e=>{const t=e;t&&(Pe("收到来自 iframe worker 发送的消息",t),this.sendMsg(t))}))}sendMsg(e){var t,n,s,r,i;switch(e.type){case"HCFY_SELECTION_EVENT_MOUSEDOWN":this.clearSelectionData(),null===(t=this.listeners)||void 0===t||t.onMouseDown(e.event);break;case"HCFY_SELECTION_EVENT_RECEIVE_SELECTION_INFO":const{parsedData:u,activeFrameIndex:d}=Ae(e.data);this.topParsedData=null!=u&&u.isTop?u:null,this.activeFrameIndex=d;const{reason:p}=e.meta;var o;if("mouseup"===p)u&&(null===(o=this.listeners)||void 0===o||o.onMouseUp(u,u.mouseUpEvent));else if("hover"===p){var a;u&&(null===(a=this.listeners)||void 0===a||a.onHoverSelection(u))}else if("proactive"===p){const t=e.meta.mid;if(t){const e=this.msgMap.get(t);e&&(this.msgMap.delete(t),e(u||void 0))}}break;case"HCFY_SELECTION_EVENT_SCROLL":var l;if(this.topParsedData)null===(l=this.listeners)||void 0===l||l.onScroll(this.topParsedData,e.event);else if(this.isTopFrameActivated()){var c;const t=this.getInfoSync();t&&(null===(c=this.listeners)||void 0===c||c.onScroll(t,e.event))}else this.getInfo().then((t=>{var n;t&&(null===(n=this.listeners)||void 0===n||n.onScroll(t,e.event))}));break;case"HCFY_SELECTION_EVENT_ESC_KEY":this.clearSelectionData(),null===(n=this.listeners)||void 0===n||n.onEsc();break;case"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_ACTIVE":null===(s=this.listeners)||void 0===s||s.onModifierKeysActive();break;case"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_RELEASED":null===(r=this.listeners)||void 0===r||r.onModifierKeysReleased();break;case"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_INTERRUPTED":null===(i=this.listeners)||void 0===i||i.onModifierKeysInterrupted()}}isTopFrameActivated(){var e;return-1===(null===(e=this.activeFrameIndex)||void 0===e?void 0:e[0])}getInfoSync(){const e=this.topWorker.sendMsg({type:"HCFY_SELECTION_EVENT_REPORT_INFO_PROACTIVE",mid:"sync"});if(e)return Ae(e.data).parsedData}getInfo(){return new Promise((e=>{if(!this.activeFrameIndex)return void e(void 0);if(this.isTopFrameActivated())return void e(this.getInfoSync());const t=_e()();this.msgMap.set(t,e),this.messagePassingBetweenFrames.tell({type:"HCFY_SELECTION_EVENT_REPORT_INFO_PROACTIVE",mid:t},this.isTopFrameActivated()?"top":this.activeFrameIndex.reverse().slice(1))}))}clearSelectionData(){this.topParsedData=null}sendToAllFrames(e){this.topWorker.sendMsg(e),this.messagePassingBetweenFrames.tell(e,"all")}disableLink(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_DISABLE_LINK"})}enableLink(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_ENABLE_LINK"})}enableHoverTranslate(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_ENABLE_HOVER_TRANSLATE"})}disableHoverTranslate(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_DISABLE_HOVER_TRANSLATE"})}};function gn(e){const{portalContainer:t}=e,[n,s]=(0,x.A)(pn),a="tesseractocr"===(null==n?void 0:n.ocrService),l=null==n?void 0:n.button,u=(null==n?void 0:n.closeAfterMove)||pn.closeAfterMove,d=null==n?void 0:n.domainBlackList,p=null==n?void 0:n.domainWhiteList,h=null==n?void 0:n.textList,f=(null==n?void 0:n.placement)||pn.placement,m=n?n.pin:pn.pin,g=n?n.pinIgnoreDomainList:pn.pinIgnoreDomainList,y=n?n.pinEnhance:pn.pinEnhance,v=(null==n?void 0:n.panelSize)||pn.panelSize,b="small"===v,w="large"===v,T=(0,i.useMemo)((()=>null==h?void 0:h.reduce(((e,t)=>(t.enabled&&e.push(new RegExp(t.value)),e)),[])),[h]),S=(0,i.useCallback)((e=>{s("function"==typeof e?t=>{t.pin=e(t.pin)}:{pin:e})}),[s]),[E,C]=(0,i.useState)(null),[j,k]=(0,i.useState)(!1),_=(0,i.useRef)(null),[N,L]=(0,i.useState)(),R=n?n.hoverTranslate:pn.hoverTranslate,[A,I]=(0,i.useState)(void 0),F=(()=>{const e=window.location.href;return!!(0,Se.Ay)(e)||(!!(m&&g&&j)||(void 0!==p&&void 0!==d?function(e,t,n){const s=be(e,t,n);return!s.urlParts||s.whiteListMatched||!s.blackListMatched}(e,d,p):void 0))})();(0,i.useEffect)((()=>{if(m){function e(){I(window.innerHeight)}return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}I(void 0)}),[m]);const D=(0,i.useRef)(null);(0,ge.A)(t),(0,ge.A)(D.current);const[$,B]=(0,i.useState)(!1),[W,H]=(0,i.useState)(""),[U,Y]=(0,i.useState)(null);async function V(){const e=await mn.getInfo();var t;e&&(L(e.range),null===(t=X.current)||void 0===t||t.translate({type:"text",text:e.text}),k(!0))}(0,i.useEffect)((()=>{if(!t)return;const e=new o.y(t,c.iYh);return e.start(),()=>{e.stop()}}),[t]);const q=(0,i.useRef)(j),X=(0,i.useRef)(null);async function Z(){H(await r().runtime.sendMessage({action:"take screenshot"})),B(!0)}(0,i.useEffect)((()=>(j&&!q.current&&r().storage.local.get("autoPlay").then((({autoPlay:e})=>{var t;e&&(null===(t=X.current)||void 0===t||t.play())})),()=>{q.current=j})),[j]);const G=(0,i.useCallback)((()=>{C(null),V()}),[]);(0,i.useEffect)((()=>{r().runtime.onMessage.addListener((e=>{var t;switch(e){case"translate":return void G();case"getSelectionText":return mn.getInfo().then((e=>(null==e?void 0:e.text)||""));case"screenshot translate":Z();break;case"hover translate":s((e=>{e.hoverTranslate=!e.hoverTranslate}));break;case"page translate":ne((e=>!e));break;case"video translate":ie((e=>!e));break;case"play":null===(t=X.current)||void 0===t||t.play()}}))}),[G,s]),(0,i.useEffect)((()=>{function e(){mn.enableLink(),"hover"===(null==n?void 0:n.modifierKeyPressedAction)&&s({hoverTranslate:!1})}void 0!==F&&void 0!==l&&T&&(mn.listeners={onMouseUp(e,t){if(null!=n&&n.disableInTextarea&&(e.isInTextarea||e.isInContentEditable))return;if(null!=n&&n.charsLimit&&e.text.length>n.charsLimit)return;const s=t&&"selection"===(null==n?void 0:n.modifierKeyPressedAction)&&(0,Ee.dw)(t,n.modifierKeys);hn(F,e.text,s||!1,T)&&(j||!l||s?V():C(e.btnPos))},onMouseDown(){C(null),m&&y||k(!1)},onScroll(e,t){e.isTop&&(null==t?void 0:t.target)===document||L(e.isTop?Object.assign({},e.range):e.range)},onEsc(){C(null),k(!1)},onModifierKeysActive(){null!=n&&n.modifierKeyLink&&mn.disableLink(),"hover"===(null==n?void 0:n.modifierKeyPressedAction)&&s({hoverTranslate:!0})},onModifierKeysReleased(){e(),null!=n&&n.modifierKeyTranslate&&G()},onModifierKeysInterrupted(){e()},onHoverSelection(e){hn(!0,e.text,!1,T)&&V()}})}),[l,F,T,j,null==n?void 0:n.modifierKeyLink,null==n?void 0:n.modifierKeyPressedAction,null==n?void 0:n.modifierKeyTranslate,null==n?void 0:n.modifierKeys,null==n?void 0:n.disableInTextarea,null==n?void 0:n.charsLimit,m,G,s,y]),(0,i.useEffect)((()=>{me.F||(R?mn.enableHoverTranslate():mn.disableHoverTranslate())}),[R]),(0,i.useEffect)((()=>{if(!j)return;if(!u)return;const e=()=>{k(!1)};return document.addEventListener("mousemove",e),()=>{document.removeEventListener("mousemove",e)}}),[j,u]);const J=()=>{k(!1)},Q=()=>{s((e=>{const t=!e.pin;e.pin=t,window.setTimeout((()=>{var e,n;t?null===(e=_.current)||void 0===e||e.switch2pin():null===(n=_.current)||void 0===n||n.clearPos()}))}))},ee=(0,P.jsx)(z.$,{className:"cut-btn",onClick:Z,icon:(0,P.jsx)(M.I,{icon:"cut",size:ue[v]}),small:"small"===v,large:"large"===v,minimal:!0,title:"截图翻译"}),[te,ne]=(0,i.useState)(!1),se=(0,P.jsx)(z.$,{className:"cut-btn",onClick:()=>ne(!0),icon:(0,P.jsx)(M.I,{icon:"translate",size:ue[v]}),small:"small"===v,large:"large"===v,minimal:!0,title:"网页全文翻译"}),[re,ie]=(0,i.useState)(!1),oe=(0,P.jsx)(z.$,{className:"cut-btn",onClick:()=>ie(!0),icon:(0,P.jsx)(M.I,{icon:"video",size:ue[v]}),small:"small"===v,large:"large"===v,minimal:!0,title:"音视频翻译",style:{marginRight:2}}),ae=(0,i.useRef)(null);return(0,P.jsxs)("div",{id:"app",ref:D,children:[n&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(fe,{btnPos:E,setBtnPos:C,onBtnClick:G}),(0,P.jsx)(O,{show:j,pin:m,setMaxHeight:I,setPin:S,range:N,placement:f,ref:_,targetRef:ae,children:(0,P.jsx)(dn,{children:e=>(0,P.jsx)(de,{onTranslate:e,hasDragTip:!0,ref:X,elementRef:ae,style:{maxHeight:A},showOptionsTip:j,headerLeft:(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(fn,{pin:m,onClick:Q,size:v}),(null==n?void 0:n.panelButtons.includes("cut"))&&ee,(null==n?void 0:n.panelButtons.includes("translate"))&&se,(null==n?void 0:n.panelButtons.includes("video"))&&oe]}),headerRight:(0,P.jsx)(z.$,{icon:(0,P.jsx)(M.I,{icon:"cross",size:ue[v]+4}),onClick:J,small:b,large:w,minimal:!0,title:"关闭(Esc)"}),extendOptions:(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(we.Sc,{inline:!0,large:w,label:"显示文本框",checked:n.showTextArea,onChange:e=>{s({showTextArea:e.target.checked})}}),(0,P.jsx)(we.Sc,{large:w,style:{marginRight:"0"},disabled:me.F,label:"鼠标悬浮取词",inline:!0,checked:R,onChange:()=>s((e=>{e.hoverTranslate=!e.hoverTranslate}))})]}),showTextArea:n.showTextArea,toaster:U||void 0,size:v,portalContainer:t})})})]}),(0,P.jsx)(Te.V,{position:"top",ref:Y,className:"app-toaster-container",usePortal:!1}),(0,P.jsx)(Kt,{open:te,setOpen:ne,portalContainer:t,pos:n?n.pageTrsPanelPos:pn.pageTrsPanelPos}),(0,P.jsx)(De,{isShow:$,setIsShow:B,isLocalOCR:a,imgSrc:W,portalContainer:t,onText:(e,t)=>{var n;null===(n=X.current)||void 0===n||n.translate({type:"image",dataURI:e}).then((()=>{const e=window.pageXOffset,n=window.pageYOffset;L({getBoundingClientRect(){const s=t.top-(window.pageYOffset-n),r=t.left-(window.pageXOffset-e);return{top:s,left:r,width:t.width,height:t.height,right:r+t.width,bottom:s+t.height}}}),k(!0)}),K())}}),(0,P.jsx)(ln,{show:re,onClose:()=>ie(!1),onText:e=>{var t;null===(t=X.current)||void 0===t||t.translate({type:"text",text:e}),k(!0)}})]})}var yn=n(69791),vn=n.n(yn);var xn=n(42631);function bn(){return(0,P.jsx)(xn.A,{id:"__hcfy__",stylesheetURLs:["blueprint-select.css","cropper.css"],cssText:(e=vn(),e.replace(/url\((["']?)(.*?)\1\)/g,(function(e,t,n){return n.startsWith("data:")?e:`url(${r().runtime.getURL(n)})`}))),children:e=>(0,P.jsx)(gn,{portalContainer:e||void 0})});var e}},81100:(e,t,n)=>{"use strict";n.d(t,{A:()=>a,F:()=>o});var s=n(12784),r=n.n(s);const i=document.caretPositionFromPoint?function(e,t){const n=document.caretPositionFromPoint(e,t);return n&&{offsetNode:n.offsetNode,offset:n.offset}}:document.caretRangeFromPoint?function(e,t){const n=document.caretRangeFromPoint(e,t);return n&&{offsetNode:n.startContainer,offset:n.startOffset}}:void 0;const o=!i;class a{constructor(e,t=1e3,n,s=document.body){this.destroyed=!1,this.context=s,this.onMouseMove=r()((t=>{n&&!t[n]||(!function(e,t){if(!i)return null;const n=window.getSelection();if(!n)return null;const s=i(e,t);if(!s)return null;const{offset:r,offsetNode:o}=s;if(o.nodeType!==Node.TEXT_NODE)return null;const a=n.rangeCount>0?n.getRangeAt(0):void 0;n.removeAllRanges();const l=document.createRange();l.setStart(o,r),l.setEnd(o,r),n.addRange(l),n.modify("move","backward","word"),n.modify("extend","forward","word");const c=n.getRangeAt(0).getBoundingClientRect();(c.left>e||c.left+c.width<e||c.top>t||c.top+c.height<t)&&(n.removeAllRanges(),a&&n.addRange(a))}(t.clientX,t.clientY),e(t))}),t),s.addEventListener("pointermove",this.onMouseMove)}destroy(){this.destroyed=!0,this.context.removeEventListener("pointermove",this.onMouseMove)}}},23593:(e,t,n)=>{"use strict";n.d(t,{c_:()=>o,dw:()=>l,ot:()=>c});n(62234),n(33873),n(85100),n(27162),n(66403),n(94154),n(64777),n(38846),n(62896),n(47010);var s=n(30819),r=n(20124);const i=n.n(r)()("hotkeys"),o={ctrl:s.U0?"metaKey":"ctrlKey",alt:"altKey",shift:"shiftKey"},a={ctrl:s.U0?s.gm?[224]:[91,93]:[17],alt:[18],shift:[16]};function l(e,t){return!(!t||!t.length)&&t.every((t=>e[o[t]]))}function c(e,t,n,s){const r=new Set;let o=!1;function l(){r.clear(),o?(o=!1,i("辅助键处于激活状态，执行中断回调"),s()):i("辅助键未处于激活状态")}function c(){i("页面失去了焦点，执行中断操作"),l()}function u(n){const s=n.keyCode,c=r.size;if(!e.some((e=>{if(a[e].includes(s))return r.add(e),!0})))return i("按下了不是辅助键的其它键，执行中断操作"),void l();c!==r.size&&(i("按下了新的辅助键，当前已经按下的辅助键：",[...r]),r.size===e.length&&(i("全部辅助键已按下，将辅助键改为激活状态，并执行辅助键按下回调"),o=!0,t()))}function d(t){const s=t.keyCode,l=r.size;if(!l)return;e.some((e=>{if(a[e].includes(s))return r.delete(e),!0}))&&l!==r.size&&(i("松开了新的辅助键，当前已经按下的辅助键：",[...r]),o=!1,e.length-r.size==1&&(i("一个辅助键已松开，执行辅助键松开回调"),n()))}return window.addEventListener("keydown",u),window.addEventListener("blur",c),window.addEventListener("keyup",d),()=>{window.removeEventListener("keydown",u),window.removeEventListener("blur",c),window.removeEventListener("keyup",d)}}},30819:(e,t,n)=>{"use strict";n.d(t,{KA:()=>a,U0:()=>o,UP:()=>l,gm:()=>c});n(62234);var s=n(51127),r=n.n(s);const i=window.navigator.userAgent,o=i.includes("Mac"),a=i.includes("Chrome"),l=i.includes("Edg"),c=i.includes("Firefox");function u(e){return e.split(".").map((e=>Number(e)))}u(r().runtime.getManifest().version)},42631:(e,t,n)=>{"use strict";n.d(t,{A:()=>u});n(33873),n(47010);var s=n(51127),r=n.n(s),i=n(16089),o=n(79482),a=n.n(o),l=n(14041),c=n(31085);function u(e){const{children:t,id:n,stylesheetURLs:s,cssText:o}=e,[u,d]=(0,l.useState)(null),p=(0,l.useRef)(null);return(0,l.useEffect)((()=>{const e=document.getElementById("dark-mode");if(!e)return;const t=()=>{if(e.getAttribute("href")){var t;const e=null===(t=p.current)||void 0===t?void 0:t.shadowRoot;e&&setTimeout((()=>{e.adoptedStyleSheets=[]}),800)}};t();const n=new MutationObserver(t);return n.observe(e,{attributeFilter:["href"]}),()=>{n.disconnect()}}),[]),(0,c.jsxs)(i.Ay.div,{style:{all:"initial"},id:n,ref:p,children:[(0,c.jsx)("style",{children:a()}),(0,c.jsx)("link",{rel:"stylesheet",href:r().runtime.getURL("normalize.css")}),(0,c.jsx)("link",{rel:"stylesheet",href:r().runtime.getURL("blueprint.css")}),null==s?void 0:s.map((e=>(0,c.jsx)("link",{rel:"stylesheet",href:r().runtime.getURL(e)},e))),o&&(0,c.jsx)("style",{children:o}),(0,c.jsx)("div",{id:"root",ref:d,dir:"ltr",children:t(u)})]})}},64795:(e,t,n)=>{"use strict";n.d(t,{D:()=>r,W:()=>i});n(33873),n(47010);var s=n(14041);function r(e){return{h:e.scrollWidth>e.clientWidth,v:e.scrollHeight>e.clientHeight}}function i(e){const[t,n]=(0,s.useState)({v:!1,h:!1});return(0,s.useEffect)((()=>{if(!e)return;const t=()=>{n(r(e))};t();const s=new ResizeObserver(t);return s.observe(e),()=>{s.unobserve(e)}}),[e]),t}},94903:(e,t,n)=>{"use strict";n.d(t,{a:()=>u,r:()=>h});n(97107),n(33873),n(10865),n(98376),n(47010);var s=n(71651),r=n(62337);function i(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return e.get(c(e,t))}function l(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}let u=function(e){return e.both="both",e.source="source",e.result="result",e}({});var d=new WeakMap,p=new WeakMap;class h{constructor(e,t,n,s){o(this,"inited",!1),o(this,"valid",!0),o(this,"isOnlyChild",!1),o(this,"destroyed",!1),o(this,"innerText",""),o(this,"translating",!1),o(this,"translated",!1),o(this,"inline",!1),o(this,"showType",u.source),i(this,d,void 0),i(this,p,void 0),this.rootNode=e,this.sourceNodes=t,this.translateFn=n,l(d,this,new r.HT),a(d,this).props.editable=null!=(null==s?void 0:s.editable)&&s.editable,a(d,this).props.onRetry=()=>this.retry(),function(e,t,n){const s=n.nextSibling;s?e.insertBefore(t,s):e.appendChild(t)}(e,a(d,this).container,t[t.length-1])}init(){this.destroyed||this.inited||(this.calcInnerText(),this.valid=function(e){const t=e.trim();return!!t&&!/^[0-9\s.\-_#:()!•+~@$%^&*\n\/`]+$/.test(t)}(this.innerText),this.valid||this.destroy(),this.inited=!0)}calcInnerText(){const{sourceNodes:e,rootNode:t}=this;let n;if(this.isOnlyChild){const e=this.showType;this.switchShowType(u.source),n=function(e){if(e instanceof HTMLElement)return e.innerText;const t=document.createElement("hcfy-result");Array.from(e.childNodes).forEach((e=>{t.appendChild(e)})),e.appendChild(t);const n=t.innerText;return e.removeChild(t),Array.from(t.childNodes).forEach((t=>{e.appendChild(t)})),n}(t).trim(),this.switchShowType(e)}else{const t=document.createElement("span");e.forEach((e=>{t.appendChild(e)})),document.documentElement.appendChild(t),n=t.innerText.trim(),document.documentElement.removeChild(t),this.showType!==u.result&&this.appendSourceNodes()}this.innerText=n}setOnlyChild(){if(this.destroyed)return;const{rootNode:e}=this;this.isOnlyChild=!0,this.inited&&this.calcInnerText(),e instanceof Element&&("span"===e.nodeName.toLowerCase()||function(e,t,n=3){let s=e,r=0;do{if(r+=1,s.matches(t))return s;if(r===n)return null;s=s.parentElement}while(s);return null}(e,"a, button, [role=button], h1,h2,h3,h4,h5,h6"))&&(this.inline=!0,this.inited&&this.renderResult())}destroy(){this.switchShowType(u.source),this.removeResult(),a(d,this).destroy(),this.destroyed=!0}renderResult(e){this.translating?a(d,this).props.mode="hide":this.showType===u.both?a(d,this).props.mode="comparison":this.showType===u.result?a(d,this).props.mode="plain":a(d,this).props.mode="hide",a(d,this).props.comparison.newLine=!this.inline,e&&(a(d,this).props.content=e),a(d,this).render()}async translate(){if(this.inited||this.init(),this.destroyed||!this.innerText)return;if(this.translating||this.translated)return;let e;this.translating=!0;try{e=await this.translateFn(this.innerText)}catch(e){if(this.destroyed)return;if(this.translating=!1,this.translated=!0,this.renderResult({error:(0,s.sanitize)(e.message+(e.link?`<a target='_blank' href='${e.link.url}'>${e.link.name}</a>`:""),{ALLOWED_TAGS:["a","#text","b","i"],ALLOWED_ATTR:["target","rel","href","class"]}),type:"html"}),a(p,this)){const e=a(p,this);l(p,this,void 0),this.switchShowType(e)}return}if(!this.destroyed){if(this.translating=!1,null==e)return this.translate();if(this.translated=!0,this.renderResult({value:e,type:"text"}),a(p,this)){const e=a(p,this);l(p,this,void 0),this.switchShowType(e)}}}retry(){if(!this.translated)throw new Error("未翻译过");l(p,this,this.showType),this.switchShowType(u.source),a(d,this).props.content=void 0,a(d,this).renderInner(),this.translated=!1,this.translate()}removeSourceNodes(){const{rootNode:e,sourceNodes:t}=this;t.forEach((t=>{try{e.removeChild(t)}catch(e){}}))}appendSourceNodes(){const{rootNode:e}=this,t=a(d,this).container;this.sourceNodes.forEach((n=>{try{e.insertBefore(n,t)}catch(e){}}))}removeResult(){try{this.rootNode.removeChild(a(d,this).container)}catch(e){}}switchShowType(e){if(this.destroyed||e===this.showType)return;if(!this.translated)return void l(p,this,e);const t=this.showType;switch(this.showType=e,e){case u.source:t===u.result&&this.appendSourceNodes(),a(d,this).props.mode="hide",this.renderResult();break;case u.result:a(d,this).props.mode="plain",this.renderResult(),this.removeSourceNodes();break;case u.both:a(d,this).props.mode="comparison",this.renderResult(),t===u.result&&this.appendSourceNodes();break;default:throw this.showType=t,new TypeError(`不支持的显示类型：${e}`)}}}},65838:(e,t,n)=>{var s=n(36758),r=n(40935),i=n(20062),o=n(13974),a=n(23724),l=r(s),c=i(o),u=i(a);l.push([e.id,`#translate-panel{background-color:#f6f7f9;display:flex;flex-direction:column;padding-bottom:8px}.bp5-dark #translate-panel{background-color:#252a31}#translate-panel .fixed{flex-shrink:0;margin-bottom:10px}#translate-panel .body{flex-grow:1;overflow:auto;overscroll-behavior:contain}#translate-panel .body::-webkit-scrollbar{width:8px;background-color:rgba(0,0,0,0);-webkit-border-radius:100px}#translate-panel .body::-webkit-scrollbar:hover{background-color:rgba(0,0,0,.09)}#translate-panel .body::-webkit-scrollbar-thumb:vertical{background:rgba(0,0,0,.5);-webkit-border-radius:100px}#translate-panel .body::-webkit-scrollbar-thumb:vertical:active{background:rgba(0,0,0,.61);-webkit-border-radius:100px}#translate-panel.size-small,#translate-panel.size-small h6.bp5-heading,#translate-panel.size-small .bp5-control.bp5-large,#translate-panel.size-small textarea.bp5-input.bp5-small{font-size:14px}#translate-panel.size-small .phonetic-item,#translate-panel.size-small .quick-settings a{font-size:12px}#translate-panel.size-middle,#translate-panel.size-middle h6.bp5-heading,#translate-panel.size-middle .bp5-control.bp5-large,#translate-panel.size-middle textarea.bp5-input{font-size:18px}#translate-panel.size-middle .phonetic-item,#translate-panel.size-middle .quick-settings a{font-size:14px}#translate-panel.size-large,#translate-panel.size-large h6.bp5-heading,#translate-panel.size-large .bp5-control.bp5-large,#translate-panel.size-large textarea.bp5-input.bp5-large{font-size:22px}#translate-panel.size-large .source,#translate-panel.size-large .phonetic-item,#translate-panel.size-large .quick-settings a{font-size:18px}#translate-panel .bp5-button.bp5-small,#translate-panel .bp5-small .bp5-button{min-height:20px;min-width:20px}#translate-panel .header{display:flex;align-items:center;padding:4px 6px 4px 10px;border-bottom:1px solid #d1d1d1}.bp5-dark #translate-panel .header{border-bottom-color:rgba(17,20,24,.4)}#translate-panel .header .drag-block{min-width:5px;flex-shrink:0;flex-grow:1;align-self:stretch}#translate-panel .header .left{flex-shrink:0;display:flex}#translate-panel .header .right{flex-shrink:0;display:flex;align-items:center}#translate-panel .header .right .bp5-icon-arrow-right{flex-shrink:0;margin:0 5px}#translate-panel .header .right>.bp5-button{flex-shrink:0;margin:0 1px}#translate-panel .header .right>.bp5-button:last-child{margin-right:0}#translate-panel .quick-settings{padding:4px 9px;margin:0 1px}#translate-panel .quick-settings>div{margin-bottom:5px}#translate-panel .quick-settings .bp5-control{margin-bottom:0}#translate-panel .query-text{position:relative;padding:10px 10px 2px 10px}#translate-panel .query-text textarea.bp5-input{min-height:44px;font-family:system-ui,-apple-system,"Segoe UI","Roboto","Ubuntu","Cantarell","Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";overscroll-behavior:contain}#translate-panel .query-text .translate-btn{position:absolute;opacity:.6}#translate-panel .query-text .translate-btn:hover{opacity:1}#translate-panel .body{padding:0 10px}#translate-panel .body .bp5-card:first-child{margin-top:1px}#translate-panel .body .bp5-card:last-child{margin-bottom:1px}#translate-panel .body .no-api{margin:20px 0}.result-block{margin:8px 0;padding:2px 5px}.result-block .bp5-button{visibility:hidden}.result-block .error .bp5-button,.result-block:hover .bp5-button{visibility:visible}.result-block .legend{display:flex;align-items:center;justify-content:space-between}.result-block .legend .legend-left{display:flex;align-items:center}.result-block .legend .api-ico,.result-block .legend .bp5-heading{flex-shrink:0;white-space:nowrap}.result-block .legend .api-ico{display:inline-block;width:14px;height:14px;background-size:contain;margin-right:3px}.result-block .legend .bp5-heading{margin-bottom:0;margin-right:10px}.result-block .legend .source{cursor:pointer;font-size:12px;display:inline-flex;align-items:center}.result-block .legend .source .source-text{overflow:hidden}.result-block .legend .source .bp5-icon{position:relative;top:-1px;margin-left:1px}.result-block .phonetic{display:flex;flex-wrap:wrap}.result-block .phonetic .phonetic-item{display:flex;align-items:center;font-size:12px}.result-block .phonetic .phonetic-item:not(:last-child){margin-right:12px}.result-block .common-result p{line-height:1.3;margin:2px 0;overflow-wrap:break-word}.result-block .common-result .dict a{text-decoration:underline}.result-block .error{font-size:12px;padding:5px 10px}.result-block .dict-pos{margin-right:5px}.external-translators{margin-bottom:3px;padding:0;display:flex;flex-wrap:wrap}.external-translators>div{margin:0 5px 5px 0}.quick-links a{margin:0 5px 5px 0}#popper-container{width:250px;max-width:100%;position:absolute;left:0;top:0;z-index:9999999998;touch-action:none;transition:opacity .2s;background-color:#f6f7f9}.bp5-dark #popper-container{background-color:#252a31}#popper-container.show{opacity:1;pointer-events:auto;-moz-user-select:auto;user-select:auto}#popper-container,#popper-container[data-popper-reference-hidden=true]{opacity:0;pointer-events:none;-moz-user-select:none;user-select:none}#popper-container .drag-block{cursor:-webkit-grab;cursor:grab}#popper-container.pin{position:fixed}#popper-container.pin .arrow{display:none}#popper-container .arrow,#popper-container .arrow::before{position:absolute;width:8px;height:8px;z-index:-1}#popper-container .arrow::before{content:"";transform:rotate(45deg);background:#f6f7f9}.bp5-dark #popper-container .arrow::before{background-color:#252a31}#popper-container .arrow{display:none}#popper-container.show[data-popper-placement]:not([data-popper-reference-hidden=true]) .arrow{display:block}#popper-container[data-popper-placement^=top] .arrow{bottom:-5px}#popper-container[data-popper-placement^=top] .arrow::before{border-right:1px solid #d1d1d1;border-bottom:1px solid #d1d1d1}#popper-container[data-popper-placement^=bottom] .arrow{top:-5px}#popper-container[data-popper-placement^=bottom] .arrow::before{border-left:1px solid #d1d1d1;border-top:1px solid #d1d1d1}#popper-container[data-popper-placement^=left] .arrow{right:-5px}#popper-container[data-popper-placement^=left] .arrow::before{border-right:1px solid #d1d1d1;border-top:1px solid #d1d1d1}#popper-container[data-popper-placement^=right] .arrow{left:-5px}#popper-container[data-popper-placement^=right] .arrow::before{border-left:1px solid #d1d1d1;border-bottom:1px solid #d1d1d1}#translate-btn{display:none;position:absolute;z-index:9999999999;left:0;top:0}#translate-btn .bp5-button{padding:2px;min-width:0;min-height:0}#translate-btn .btn-icon{width:18px;height:18px;background-image:url(${c});background-size:contain}.bp5-dark #translate-btn .btn-icon{background-image:url(${u})}#translate-btn.show{display:block}.translate-type-selector .bp5-label{display:inline}.translate-type-selector .bp5-radio{margin-bottom:0}#ocr-container{position:fixed;z-index:99999999999999;left:0;top:0;right:0;bottom:0}#ocr-container .toolbar{display:none;position:absolute;z-index:1}#ocr-container img{max-width:100%}#app{cursor:default}.switch-pin{flex-shrink:0;cursor:pointer}.switch-pin .bp5-icon-pin{transition:transform .2s,color .2s;transform:rotate(-45deg)}.pin .switch-pin .bp5-icon-pin{transform:rotate(-70deg)}.cut-btn{margin-left:2px}.app-toaster-container{position:fixed !important;z-index:9999999999 !important}.app-toaster-container .bp5-toast{min-width:auto}#web-trs-panel .app-toaster-container{padding-right:0;padding-left:0}#web-trs-panel .page-trs-form-group{margin:0 0 0 0;align-items:center}#web-trs-panel .page-trs-form-group>label{width:70px}`,""]),e.exports=l},77239:(e,t,n)=>{var s=n(36758),r=n(40935)(s);r.push([e.id,'#root{-webkit-text-size-adjust:100%;box-sizing:border-box;font-size:14px;font-weight:400;letter-spacing:0;line-height:1.28581;text-transform:none;color:#182026;font-family:-apple-system,"BlinkMacSystemFont","Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Open Sans","Helvetica Neue","Icons16",sans-serif;touch-action:manipulation}#root>.bp5-portal{z-index:9999999999}',""]),e.exports=r},13974:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});const s=n.p+"logo.png"},23724:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});const s=n.p+"logowhite36.png"},69791:(e,t,n)=>{var s=n(65838);s&&s.__esModule&&(s=s.default),e.exports="string"==typeof s?s:s.toString()},79482:(e,t,n)=>{var s=n(77239);s&&s.__esModule&&(s=s.default),e.exports="string"==typeof s?s:s.toString()},96959:(e,t,n)=>{"use strict";n.d(t,{H:()=>f});n(97107),n(33873),n(47010);var s=n(31085),r=n(14041);n(60807),n(1729);function i(e,t,n,s="text"){const[i,o]=(0,r.useState)(!1);return function(e,t){const n=(0,r.useRef)(null),s=(0,r.useRef)(t);(0,r.useEffect)((()=>{s.current=t}),[t]),(0,r.useEffect)((()=>{if(!e)return;const t=t=>{n.current={x:t.pageX,y:t.pageY},e.addEventListener("pointerup",r)},r=t=>{e.removeEventListener("pointerup",r);const i=n.current;i&&(n.current=null,i.x===t.pageX&&i.y===t.pageY&&s.current())};return e.addEventListener("pointerdown",t),()=>{e.removeEventListener("pointerdown",t),e.removeEventListener("pointerup",r)}}),[e])}(t?e:null,(()=>{o(!0)})),(0,r.useEffect)((()=>{t||o(!1)}),[t]),(0,r.useEffect)((()=>{i&&e&&e.focus()}),[e,i]),(0,r.useEffect)((()=>{if(!i||!e)return;const t=t=>{const n=t.target;e.contains(n)||o(!1)};return document.addEventListener("pointerup",t),()=>{document.removeEventListener("pointerup",t)}}),[i,e]),(0,r.useEffect)((()=>{if(!i||!e||!n)return;const t=e=>{const t=e.target;n({value:"html"===s?t.innerHTML:t.innerText,type:s})};return e.addEventListener("input",t),()=>{e.removeEventListener("input",t)}}),[e,i,n,s]),t?{isEditing:i,props:{contentEditable:i?"true":void 0}}:{isEditing:i}}const o={visibility:"visible"};function a(e){const{content:t,onRetry:n,editable:a,onEdit:l}=e,[c,u]=(0,r.useState)(null),{isEditing:d,props:p}=i(c,a&&!!t&&"value"in t,l,null==t?void 0:t.type);return(0,r.useEffect)((()=>{if(d&&c)return c.closest("hcfy-result").classList.add("__hcfy-result-editing__"),()=>{c.closest("hcfy-result").classList.remove("__hcfy-result-editing__")}}),[c,d]),t?(0,s.jsxs)(s.Fragment,{children:["html"===t.type?(0,s.jsx)("hcfy-result-content",{style:o,ref:u,...p,dangerouslySetInnerHTML:{__html:"value"in t?t.value:t.error}}):(0,s.jsx)("hcfy-result-content",{style:o,ref:u,...p,children:"value"in t?t.value:t.error}),(0,s.jsx)("hcfy-result-actions",{style:o,children:"error"in t&&(0,s.jsx)("button",{onClick:n,children:"点击重试"})})]}):null}var l=n(25873);function c(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function u(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){return e.get(p(e,t))}function p(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var h=new WeakMap;class f{constructor(){u(this,"container",void 0),c(this,h,void 0),u(this,"props",void 0);const e=document.createElement("hcfy-result");e.style.display="none";const t=(0,l.H)(e);var n,s,r;this.container=e,s=this,r=t,(n=h).set(p(n,s),r),this.props={mode:"hide",comparison:{newLine:!0},editable:!1}}renderContainer(){switch(this.props.mode){case"hide":this.container.style.display="none",this.container.className="";break;case"plain":this.container.style.display="inline-block",this.container.className="";break;case"comparison":this.container.style.display=this.props.comparison.newLine?"block":"inline-block",this.container.className="__hcfy-result-comparison__ "+(this.props.comparison.newLine?"__hcfy-result-comparison-block__":"__hcfy-result-comparison-inline__")}}renderInner(){d(h,this).render((0,s.jsx)(a,{content:this.props.content,editable:this.props.editable,onEdit:e=>{var t,n;null===(t=(n=this.props).onEdit)||void 0===t||t.call(n,e),this.props.content=e},onRetry:this.props.onRetry}))}render(){this.renderContainer(),this.renderInner()}destroy(){d(h,this).unmount()}}},54493:(e,t,n)=>{"use strict";n.d(t,{O:()=>r,P9:()=>s,PD:()=>c,UU:()=>o,Zi:()=>a,dd:()=>l,pb:()=>i});const s="",r=".__hcfy-result-comparison__ {\n  outline: 1px dotted;\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}",i=".__hcfy-result-comparison__ {\n  outline: 1px dotted var(--hcfy-result-main-color, #008B45);\n}\n\n.__hcfy-result-comparison__ hcfy-result-content {\n  color: var(--hcfy-result-text-color, unset);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}\n\n.__hcfy-result-comparison-inline__ {\n  margin-left: 0.4em;\n}",o=".__hcfy-result-comparison__ hcfy-result-content {\n  text-decoration: var(--hcfy-result-main-color, #008B45) wavy underline;\n  text-underline-offset: 0.2em;\n  color: var(--hcfy-result-text-color, unset);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-editing__ hcfy-result-content {\n  text-decoration: none;\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}\n\n.__hcfy-result-comparison-inline__ hcfy-result-content {\n  margin-left: 0.4em;\n}",a=".__hcfy-result-comparison__ hcfy-result-content {\n  text-decoration: var(--hcfy-result-main-color, #008B45) underline;\n  text-underline-offset: 0.2em;\n  color: var(--hcfy-result-text-color, unset);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-editing__ hcfy-result-content {\n  text-decoration: none;\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}\n\n.__hcfy-result-comparison-inline__ hcfy-result-content {\n  margin-left: 0.4em;\n}",l=".__hcfy-result-comparison__ hcfy-result-content {\n  background-color: var(--hcfy-result-main-color, #008B45);\n  color: var(--hcfy-result-text-color, white);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-editing__ hcfy-result-content {\n  background: unset;\n  color: unset;\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}\n\n.__hcfy-result-comparison-inline__ hcfy-result-content {\n  margin-left: 0.4em;\n}",c=".__hcfy-result-comparison__ {\n  border-left: 3px solid var(--hcfy-result-main-color, #008B45);\n  padding-left: 6px;\n}\n\n.__hcfy-result-comparison__ hcfy-result-content {\n  color: var(--hcfy-result-text-color, unset);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-comparison-block__ {\n  padding: 6px 0 6px 12px;\n}\n\n.__hcfy-result-comparison-inline__ {\n  margin-left: 0.4em;\n}\n\n.__hcfy-result-editing__ {\n  border-left-color: transparent;\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}"},62337:(e,t,n)=>{"use strict";n.d(t,{HT:()=>s.H,dd:()=>r.dd,pb:()=>r.pb,O:()=>r.O,Zi:()=>r.Zi,P9:()=>r.P9,PD:()=>r.PD,UU:()=>r.UU});var s=n(96959),r=n(54493)}}]);