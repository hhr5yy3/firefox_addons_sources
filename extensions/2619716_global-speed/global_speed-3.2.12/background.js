(()=>{var e={5739:(e,t,a)=>{"use strict";a.d(t,{$:()=>n});const n=globalThis.gvar??{}},181:(e,t,a)=>{var n=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,o=/^0o[0-7]+$/i,s=parseInt,l="object"==typeof a.g&&a.g&&a.g.Object===Object&&a.g,d="object"==typeof self&&self&&self.Object===Object&&self,c=l||d||Function("return this")(),u=Object.prototype.toString,f=Math.max,m=Math.min,p=function(){return c.Date.now()};function h(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function b(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==u.call(e)}(e))return NaN;if(h(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=h(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(n,"");var a=i.test(e);return a||o.test(e)?s(e.slice(2),a?2:8):r.test(e)?NaN:+e}e.exports=function(e,t,a){var n,r,i,o,s,l,d=0,c=!1,u=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var a=n,i=r;return n=r=void 0,d=t,o=e.apply(i,a)}function v(e){var a=e-l;return void 0===l||a>=t||a<0||u&&e-d>=i}function w(){var e=p();if(v(e))return S(e);s=setTimeout(w,function(e){var a=t-(e-l);return u?m(a,i-(e-d)):a}(e))}function S(e){return s=void 0,g&&n?y(e):(n=r=void 0,o)}function I(){var e=p(),a=v(e);if(n=arguments,r=this,l=e,a){if(void 0===s)return function(e){return d=e,s=setTimeout(w,t),c?y(e):o}(l);if(u)return s=setTimeout(w,t),y(l)}return void 0===s&&(s=setTimeout(w,t)),o}return t=b(t)||0,h(a)&&(c=!!a.leading,i=(u="maxWait"in a)?f(b(a.maxWait)||0,t):i,g="trailing"in a?!!a.trailing:g),I.cancel=function(){void 0!==s&&clearTimeout(s),d=0,n=l=r=s=void 0},I.flush=function(){return void 0===s?o:S(p())},I}}},t={};function a(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,a),i.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=a(5739).$;function t(e,t,a){let n=a;return null!=e&&(n=Math.max(e,n)),null!=t&&(n=Math.min(t,n)),n}function n(e,t,a){const n=t-e+1e-11;return t<e&&([e,t]=[t,e]),a<e?r(t-(e-a)%n,6):a>t?r(e+(a-t)%n,6):a}function r(e,t){const a=10**t;return Math.round(e*a)/a}function i(){return Math.ceil(1e10*Math.random()).toString()}let o,s;function l(){return o=o??navigator.userAgent.includes("Firefox/"),o}function d(){if(null!=s)return s;let e=navigator.userAgentData;return e?(s=e.mobile,s):(s=/Mobi|Android|iPhone|iPad|Tablet/i.test(navigator.userAgent),s)}function c(e,t){let a=e<0?"-":t?"+":"";const n=(e=Math.abs(e))/60,r=n/60;return r>=100?"":r>1?`${a}${Math.floor(r)}:${Math.floor(n%60).toString().padStart(2,"0")}:${Math.floor(e%60).toString().padStart(2,"0")}`:`${a}${Math.floor(n).toString().padStart(1,"0")}:${Math.floor(e%60).toString().padStart(2,"0")}`}function u(e){return new Promise(((t,a)=>{setTimeout((()=>t(!0)),e)}))}function f(e,t){return Object.fromEntries(e.map((e=>[e,t])))}function m(){if(!screen)return{width:1e3,height:800,left:200,top:200};const e=Math.min(screen.width-100,1e3),t=Math.min(screen.height-100,800);return{width:e,height:t,left:screenLeft+(screen.width-e)/2,top:screenTop+(screen.height-t)/2}}e.sess=new class{installCbs=new Set;safeCbs=new Set;safeStartupCbs=new Set;#e=!1;constructor(){chrome.runtime.onInstalled.addListener(this.handleInstall),chrome.runtime.onStartup.addListener(this.handleStartup)}handleInstall=async()=>{this.#e||(this.#e=!0,this.installCbs.forEach((e=>e())),this.handleCommon())};handleStartup=async()=>{this.#e||(this.#e=!0,this.handleCommon())};handleCommon=async()=>{await e.installPromise,this.safeCbs.forEach((e=>e())),this.safeStartupCbs.forEach((e=>e()))}},a(5739).$;var p=a(5739).$;p.es=new class{watchers=[];processedChangeIds=new Set;released=!1;constructor(){chrome.storage.local.onChanged.addListener(this.handleChange)}init=async()=>{if(this.rawMap||(await p.installPromise,this.rawMap=await chrome.storage.local.get()),!this.rawMap)throw Error("Raw map could not be loaded")};addWatcher=(e,t)=>{this.watchers.push([e,t])};removeWatcher=e=>{const t=this.watchers.findIndex((t=>t[1]===e));t>=0&&this.watchers.splice(t,1)};handleChange=async e=>{await this.init(),e=e??{};const t=e.changeId?.newValue;if(t){if(this.processedChangeIds.has(t))return void this.processedChangeIds.delete(t);this.processedChangeIds.add(t)}for(let t in e)Object.hasOwn(e[t],"newValue")?this.rawMap[t]=e[t].newValue:delete this.rawMap[t];if(!this.rawMap["g:version"])return;const a=Object.keys(e),n=new Set(a);this.watchers.forEach((([t,r])=>{this.testWatcher(a,n,t)&&r(e)}))};testWatcher=(e,t,a)=>{if(0===a.length)return!0;for(let n of a)if("function"==typeof n||"function"==typeof n?.test){let t=n.test?.bind(n)??n;if(e.some((e=>t(e))))return!0}else if("string"==typeof n&&t.has(n))return!0;return!1};getAllUnsafe=async()=>(await this.init(),this.rawMap);get=async e=>{if(await this.init(),null==e)return{...this.rawMap};let t={};"string"==typeof e?e=[e]:Array.isArray(e)||"object"==typeof e&&(t={...e},e=Object.keys(t));for(let a of e)Object.hasOwn(this.rawMap,a)&&(t[a]=this.rawMap[a]);return t};set=async e=>{await this.init(),e.changeId=i();const t={};for(let a in e)void 0!==e[a]&&(t[a]={newValue:e[a],oldValue:this.rawMap[a]});await Promise.all([this.handleChange(t),chrome.storage.local.set(e)])}};let h=function(e){return e[e.PREVIOUS=1]="PREVIOUS",e[e.GLOBAL=2]="GLOBAL",e[e.NEW=3]="NEW",e[e.CUSTOM=4]="CUSTOM",e}({});const b=["speed","lastSpeed","enabled","latestViaShortcut","elementFx","backdropFx","monoOutput","audioFx","audioFxAlt","audioPan"],g=new Set(b),y=[["speed"],["elementFx","backdropFx"],["enabled","latestViaShortcut"]],v=y.flat(1),w=new Set(v),S=Object.fromEntries(v.map((e=>[e,y.find((t=>t.includes(e)))]))),I=["enabled","monoOutput","audioFx","audioFxAlt","audioPan"];new Set(I);let M=function(e){return e[e.SET=1]="SET",e[e.ADD=2]="ADD",e[e.CYCLE=3]="CYCLE",e[e.ITC=4]="ITC",e[e.ITC_REL=5]="ITC_REL",e}({}),x=function(e){return e[e.SECS=1]="SECS",e[e.FRAMES=2]="FRAMES",e[e.PERCENT=3]="PERCENT",e}({}),k=function(e){return e[e.LOCAL=0]="LOCAL",e[e.GLOBAL=1]="GLOBAL",e[e.CONTEXT=2]="CONTEXT",e}({}),E=function(e){return e[e.FX=1]="FX",e[e.AUDIO_FX=2]="AUDIO_FX",e[e.MEDIA=3]="MEDIA",e[e.MISC=4]="MISC",e}({}),T=function(e){return e[e.FIRST_TIME=1]="FIRST_TIME",e[e.DIFFERENT_HOST=2]="DIFFERENT_HOST",e[e.EVERY_COMMIT=3]="EVERY_COMMIT",e[e.EVERY_NAVIGATION=4]="EVERY_NAVIGATION",e}({});var C=a(5739).$;function _(e){const t={};return"backdrop"!==e&&"both"!==e||(t.backdrop=!0),"element"!==e&&"both"!==e||(t.element=!0),t}function F(e,t,a,n){C?.tabInfo?.tabId===a&&C.tabInfo.frameId,chrome.tabs.sendMessage(a,{type:"APPLY_MEDIA_EVENT",event:e,key:t},null==n?void 0:{frameId:n})}function A(e,t,a){chrome.tabs.sendMessage(t,e,null==a?void 0:{frameId:a})}function P(e,t,a){const n=t?.parts.filter((e=>!e.disabled))||[];if(!n.length)return a;const r=n.some((t=>function(e,t){if("STARTS_WITH"===t.type)return e.startsWith(t.valueStartsWith);if("CONTAINS"===t.type)return e.includes(t.valueContains);if("REGEX"===t.type)try{return new RegExp(t.valueRegex).test(e)}catch(e){}}(e,t)));return t.block?!r:r}var O=a(181),D=a.n(O);async function R(e){if(!chrome.contextMenus)return;let t=new Set;await new Promise(((e,t)=>{chrome.contextMenus.removeAll((()=>{chrome.runtime.lastError&&t(chrome.runtime.lastError),e()}))})),(e=(e=(await G(["keybinds"])).keybinds).filter((e=>e.trigger===k.CONTEXT&&e.enabled))).length&&(await j({id:"parent",title:"Global Speed",contexts:["all"],documentUrlPatterns:["https://*/*","http://*/*"]}),await Promise.all(e.map((async e=>{await N(t,e),e.allowAlt&&e.adjustMode===M.CYCLE&&await N(t,e,!0)}))),e.forEach((e=>{$(t,e),e.allowAlt&&e.adjustMode===M.CYCLE&&$(t,e,!0)})))}function N(e,t,a){const n=(a?t.contextLabelAlt:t.contextLabel)||"";if(!n.includes("::"))return;const r=n.split("::")[0].trim();if(!r)return;const i=`fold_${r.toLowerCase()}`;return e.has(i)?void 0:(e.add(i),j({id:i,title:r,contexts:["all"],parentId:"parent",documentUrlPatterns:["https://*/*","http://*/*"]}))}function $(e,t,a){let n="parent",r=(a?t.contextLabelAlt:t.contextLabel)||"";if(r.includes("::")){let[t,a]=r.split("::");t=`fold_${t.trim().toLowerCase()}`,e.has(t)&&(n=t,r=a.trim())}return j({id:a?`ALT_${t.id}`:t.id,title:r?.trim()||"---",type:"normal",contexts:["all"],parentId:n,documentUrlPatterns:["https://*/*","http://*/*"]})}const L=D()(R,1e3,{trailing:!0});function j(e){return new Promise(((t,a)=>{chrome.contextMenus.create(e,(()=>{chrome.runtime.lastError&&a(chrome.runtime.lastError),t()}))}))}var U=a(5739).$;async function G(e,t,a=!1){return t=t??0,function(e,t,a){t={...t};let n="g:";a>0&&t[`t:${a}:isPinned`]&&(n=`t:${a}:`);const r=`r:${a}:`;let i={};for(let a in e)"isPinned"===a?i[a]=t[n.concat(a)]:"hasOrl"===a?i[a]=v.some((e=>null!=t[r.concat(e)])):g.has(a)?i[a]=t[r.concat(a)]??t[n.concat(a)]:i[a]=t[`g:${a}`];return i}(e=Array.isArray(e)?f(e,!0):e,await async function(e){return U.es?U.es.get(e):chrome.storage.local.get(e)}(function(e,t,a=!1,n=!1){let r=new Set;n&&t>0&&r.add(`t:${t}:isPinned`);for(let n in e)"isPinned"===n?t>0&&r.add(`t:${t}:isPinned`):"hasOrl"===n?t>0&&v.forEach((e=>{r.add(`r:${t}:${e}`)})):g.has(n)?(r.add(`g:${n}`),t>0&&(r.add(`t:${t}:${n}`),r.add(`t:${t}:isPinned`),!a&&w.has(n)&&r.add(`r:${t}:${n}`))):r.add(`g:${n}`);return[...r]}(e,t,a)),t)}async function B(e){return async function(e){return U.es?U.es.set(e):chrome.storage.local.set(e)}(await async function(e){e.tabId=e.tabId??0,e.override={...e.override};const t={};let a=Object.entries(e.override).filter((([a,n])=>{if("isPinned"!==a){if(g.has(a))return!0;if("hasOrl"===a){if(1==n||0===e.tabId)return;v.forEach((a=>{t[`r:${e.tabId}:${a}`]=null}))}else t[`g:${a}`]=n}})),n=a.length||null!=e.override.isPinned,{base:r,isPinned:i}=n?await async function(e,t){const a=t.override;if(null!=a.isPinned&&0===t.tabId)throw Error("Setting isPinned requires a non-zero tabId");let n=!1;return t.tabId>0&&(n=t.knownPinStatus??(await G(["isPinned"],t.tabId)).isPinned??!1,null!=a.isPinned&&(!0===a.isPinned&&!1===n?(e=await async function(e,t,a){b.forEach((a=>{e[`t:${t}:${a}`]=null})),e[`t:${t}:isPinned`]=!0;const n=await G(b,a,!0);for(let a in n)e[`t:${t}:${a}`]=n[a];return v.forEach((a=>{e[`r:${t}:${a}`]=null})),e}(e,t.tabId,t.inheritContextFromTabId||0),n=!0):!1===a.isPinned&&!0===n&&(e=function(e,t){return[...b,"isPinned"].forEach((a=>{e[`t:${t}:${a}`]=null})),v.forEach((a=>{e[`r:${t}:${a}`]=null})),e}(e,t.tabId),n=!1))),delete a.isPinned,{base:e,isPinned:n}}({},e):{base:{},isPinned:!1};if(Object.assign(r,t),a.length){const t=i?`t:${e.tabId}:`:"g:",n=`r:${e.tabId}:`;a.forEach((([e,a])=>{r[`${t}${e}`]=a,w.has(e)&&S[e].forEach((e=>{r[`${n}${e}`]=null}))}))}if(e.overrideRaw)for(let t in e.overrideRaw)r[t]=e.overrideRaw[t];return r}(e))}const V=["s:","r:","t:"],W=["g:"];async function X(e,t){return t=t??await chrome.storage.local.get(),Object.keys(t).filter((t=>e.some((e=>t.startsWith(e)))))}var K=a(5739).$;let q;const z={128:"icons/128.png"},H={128:"icons/128g.png"};async function Y(e){q||(q=await Q(0)),Z(q,void 0),async function(e){Promise.all(e.map((e=>async function(e){Z(await Q(e.id),e.id)}(e))))}(e??await chrome.tabs.query({active:!0}))}const J=D()(Y,100,{leading:!0,trailing:!0,maxWait:1e3});async function Q(e){const{isPinned:t,speed:a,enabled:n,hasOrl:r,superDisable:i,hideBadge:o}=await G({hideBadge:!0,superDisable:!0,isPinned:!0,speed:!0,enabled:!0,hasOrl:!0},e),s=n&&!i;let d=s&&!o,c=s?z:H,u=d?function(e){return function(e,t=!1){let a=e.toFixed(2);return t&&"0"===a.at(-1)&&(a=a.slice(0,-1)),a}(e).slice(0,l()?3:4)}(a??1):"",f="#000";return!r||s||o||(d=!0,u="OFF"),d&&(f=r?"#7fffd4":t?"#44a":"#a64646"),{badgeText:u,badgeColor:f,badgeIcons:c}}async function Z(e,t){chrome.action.setBadgeText({text:e.badgeText,tabId:t}),chrome.action.setBadgeBackgroundColor({color:e.badgeColor,tabId:t}),chrome.action.setIcon({path:e.badgeIcons,tabId:t})}K.es.addWatcher([/^g:(speed|enabled|superDisable|hideBadge)/,/^[rt]:[\d\w]+:(speed|isPinned|enabled)/,/^[r]:[\d\w]+:(elementFx|backdropFx|latestViaShortcut|)/],(e=>{J()})),K.sess.safeCbs.add((()=>Y())),chrome.webNavigation.onCommitted.addListener((()=>Y())),chrome.tabs.onActivated.addListener((()=>Y()));const ee={sepia:{ref:{min:0,max:1,step:.1,sliderMin:0,sliderMax:1,default:0,itcStep:.5,wrappable:!0},format:e=>`sepia(${e})`},hueRotate:{ref:{step:8,sliderMin:-180,sliderMax:180,sliderStep:1,default:0,itcStep:180},format:e=>`hue-rotate(${e}deg)`},grayscale:{ref:{min:0,max:1,step:.1,sliderMin:0,sliderMax:1,default:0,itcStep:.5,wrappable:!0},format:e=>`grayscale(${e})`},contrast:{ref:{min:0,step:.1,sliderMin:0,sliderMax:5,default:1,itcStep:2.5},format:e=>`contrast(${e})`},brightness:{ref:{min:0,step:.1,sliderMin:0,sliderMax:5,sliderStep:.05,default:1,itcStep:2.5},format:e=>`brightness(${e})`},saturate:{ref:{min:0,step:.1,sliderMin:0,sliderMax:5,sliderStep:.05,default:1,itcStep:2.5},format:e=>`saturate(${e})`},invert:{ref:{min:0,max:1,step:.1,sliderMin:0,sliderMax:1,default:0,itcStep:.5,wrappable:!0},format:e=>`invert(${e})`},blur:{ref:{min:0,step:.1,sliderMin:0,sliderMax:10,sliderStep:.1,default:0,itcStep:5},format:e=>`blur(${e}px)`},opacity:{ref:{min:0,max:1,step:.1,sliderMin:0,sliderMax:1,default:1,itcStep:.5,wrappable:!0},format:e=>`opacity(${e})`},scaleX:{isTransform:!0,ref:{step:.1,sliderMin:-1,sliderMax:3,sliderStep:.04,default:1,itcStep:2},format:e=>`scaleX(${e})`},scaleY:{isTransform:!0,ref:{step:.1,sliderMin:-1,sliderMax:3,sliderStep:.04,default:1,itcStep:2},format:e=>`scaleY(${e})`},translateX:{isTransform:!0,ref:{step:1,sliderMin:-300,sliderMax:300,sliderStep:5,default:0,itcStep:300},format:e=>`translateX(${e}px)`},translateY:{isTransform:!0,ref:{step:1,sliderMin:-300,sliderMax:300,sliderStep:5,default:0,itcStep:300},format:e=>`translateY(${e}px)`},rotateX:{isTransform:!0,ref:{step:1,sliderMin:-180,sliderMax:180,sliderStep:1,default:0,itcStep:180},format:e=>`rotateX(${e}deg)`},rotateY:{isTransform:!0,ref:{step:1,sliderMin:-180,sliderMax:180,sliderStep:1,default:0,itcStep:180},format:e=>`rotateY(${e}deg)`},rotateZ:{isTransform:!0,ref:{step:1,sliderMin:-180,sliderMax:180,sliderStep:1,default:0,itcStep:180},format:e=>`rotateZ(${e}deg)`}};let te={nothing:{group:E.MISC,valueType:"number",ref:{default:0,min:0,max:600},generate:()=>({id:i(),command:"nothing",enabled:!0,greedy:!0})},runCode:{group:E.MISC,valueType:"modalString",generate:()=>({id:i(),command:"runCode",enabled:!0,greedy:!0,valueString:"// code here"})},openUrl:{group:E.MISC,valueType:"string",generate:()=>({id:i(),command:"openUrl",enabled:!0,greedy:!0,valueString:"https://example.com"})},intoPopup:{group:E.MISC,generate:()=>({id:i(),command:"intoPopup",enabled:!0,greedy:!0,valuePopupRect:m()})},speed:{valueType:"adjustMode",hasFeedback:!0,ref:{min:.07,max:16,step:.1,default:1,sliderMin:.5,sliderMax:1.5,itcStep:1,wrappable:!0},generate:()=>({id:i(),command:"speed",enabled:!0,greedy:!0})},speedChangesPitch:{valueType:"state",hasFeedback:!0,requiresMedia:!0,generate:()=>({id:i(),command:"speedChangesPitch",enabled:!0,greedy:!0,valueState:"toggle"})},pin:{valueType:"state",hasFeedback:!0,generate:()=>({id:i(),command:"pin",enabled:!0,greedy:!0,valueState:"toggle"})},state:{valueType:"state",hasFeedback:!0,generate:()=>({id:i(),command:"state",enabled:!0,greedy:!0,valueState:"toggle"})},seek:{group:E.MEDIA,withDuration:!0,valueType:"adjustMode",requiresMedia:!0,hasFeedback:!0,getRef:(e,t)=>{const a=t.duration||x.SECS;return a===x.SECS?{min:0,default:300,itcStep:60,step:10,sliderMin:0,sliderMax:600,wrappable:!0}:a===x.PERCENT?{min:0,max:100,default:50,step:10,itcStep:50,sliderMin:0,sliderMax:100,wrappable:!0}:a===x.FRAMES?{min:0,default:240,step:1,itcStep:2400,sliderMin:0,sliderMax:14e3,wrappable:!0}:void 0},generate:()=>({id:i(),adjustMode:M.ADD,command:"seek",enabled:!0,greedy:!0,valueNumber:10})},pause:{group:E.MEDIA,valueType:"state",requiresMedia:!0,hasFeedback:!0,generate:()=>({id:i(),command:"pause",enabled:!0,greedy:!0,valueState:"toggle"})},mute:{group:E.MEDIA,hasFeedback:!0,valueType:"state",requiresMedia:!0,generate:()=>({id:i(),command:"mute",enabled:!0,greedy:!0,valueState:"toggle"})},muteTab:{group:E.MEDIA,hasFeedback:!0,valueType:"state",requiresMedia:!0,generate:()=>({id:i(),command:"muteTab",enabled:!0,greedy:!0,valueState:"toggle"})},volume:{group:E.MEDIA,hasFeedback:!0,valueType:"adjustMode",requiresMedia:!0,ref:{min:0,max:1,step:.05,default:.5,sliderMin:0,sliderMax:1,itcStep:.5,wrappable:!0},generate:()=>({id:i(),adjustMode:M.ADD,command:"volume",enabled:!0,greedy:!0})},setMark:{group:E.MEDIA,hasFeedback:!0,valueType:"string",requiresMedia:!0,generate:()=>({id:i(),command:"setMark",enabled:!0,greedy:!0,valueString:"mark1"})},seekMark:{group:E.MEDIA,hasFeedback:!0,valueType:"string",requiresMedia:!0,generate:()=>({id:i(),command:"seekMark",enabled:!0,greedy:!0,valueString:"mark1"})},loop:{group:E.MEDIA,hasFeedback:!0,valueType:"string",requiresMedia:!0,generate:()=>({id:i(),command:"loop",enabled:!0,greedy:!0,valueString:"mark1"})},skip:{group:E.MEDIA,hasFeedback:!0,valueType:"string",requiresMedia:!0,generate:()=>({id:i(),command:"skip",enabled:!0,greedy:!0,valueString:"mark1"})},fullscreen:{group:E.MEDIA,requiresVideo:!0,generate:()=>({id:i(),command:"fullscreen",enabled:!0,greedy:!0})},PiP:{group:E.MEDIA,valueType:"state",requiresVideo:!0,requiresPiPApi:!0,generate:()=>({id:i(),command:"PiP",enabled:!0,greedy:!0,valueState:"toggle"})},cinema:{group:E.MEDIA,valueType:"state",requiresVideo:!0,generate:()=>({id:i(),command:"cinema",enabled:!0,greedy:!0,valueState:"toggle"})},mediaInfo:{group:E.MEDIA,requiresMedia:!0,generate:()=>({id:i(),command:"mediaInfo",enabled:!0,greedy:!0})},fxState:{group:E.FX,hasFeedback:!0,withFilterTarget:!0,valueType:"state",generate:()=>({id:i(),command:"fxState",enabled:!0,greedy:!0,valueState:"toggle",filterTarget:"element"})},fxReset:{group:E.FX,hasFeedback:!0,withFilterTarget:!0,generate:()=>({id:i(),command:"fxReset",enabled:!0,greedy:!0,filterTarget:"element"})},fxSwap:{group:E.FX,hasFeedback:!0,generate:()=>({id:i(),command:"fxSwap",enabled:!0,greedy:!0})},fxFilter:{group:E.FX,hasFeedback:!0,valueType:"adjustMode",withFilterOption:!0,withFilterTarget:!0,getRef:(e,t)=>e.withFilterOption&&ee[t.filterOption]?.ref,generate:()=>({id:i(),command:"fxFilter",filterOption:"hueRotate",enabled:!0,greedy:!0,filterTarget:"element",adjustMode:M.ADD})},drawPage:{group:E.FX,generate:()=>({id:i(),command:"drawPage",enabled:!0,greedy:!0})},afxGain:{group:E.AUDIO_FX,hasFeedback:!0,valueType:"adjustMode",requiresTabCapture:!0,ref:{min:0,max:16,step:.05,default:1,sliderMin:0,sliderMax:3,itcStep:1.5},generate:()=>({id:i(),command:"afxGain",enabled:!0,greedy:!0,adjustMode:M.ADD})},afxPitch:{group:E.AUDIO_FX,hasFeedback:!0,valueType:"adjustMode",requiresTabCapture:!0,ref:{min:-100,max:100,step:1,default:0,sliderMin:-6,sliderMax:6,itcStep:3},generate:()=>({id:i(),command:"afxPitch",enabled:!0,greedy:!0,adjustMode:M.ADD})},afxDelay:{group:E.AUDIO_FX,hasFeedback:!0,valueType:"adjustMode",requiresTabCapture:!0,ref:{min:0,max:60,step:.05,default:0,sliderMin:0,sliderMax:5,itcStep:2.5},generate:()=>({id:i(),command:"afxDelay",enabled:!0,greedy:!0,adjustMode:M.ADD})},afxPan:{group:E.AUDIO_FX,hasFeedback:!0,valueType:"adjustMode",requiresTabCapture:!0,ref:{min:-1,max:1,step:.05,default:0,sliderMin:-1,sliderMax:1,itcStep:1,wrappable:!0},generate:()=>({id:i(),command:"afxPan",enabled:!0,greedy:!0,adjustMode:M.ADD})},afxMono:{group:E.AUDIO_FX,hasFeedback:!0,valueType:"state",requiresTabCapture:!0,generate:()=>({id:i(),command:"afxMono",enabled:!0,greedy:!0,valueState:"toggle"})},afxCapture:{group:E.AUDIO_FX,hasFeedback:!0,valueType:"state",requiresTabCapture:!0,generate:()=>({id:i(),command:"afxCapture",enabled:!0,greedy:!0,valueState:"toggle",trigger:k.GLOBAL})},afxReset:{group:E.AUDIO_FX,hasFeedback:!0,requiresTabCapture:!0,generate:()=>({id:i(),command:"afxReset",enabled:!0,greedy:!0})}};function ae(){if(d())return[];let e=[{...te.speed.generate(),key:"KeyA",adjustMode:M.ADD,valueNumber:-.1},{...te.speed.generate(),key:"KeyS",valueNumber:1},{...te.speed.generate(),key:"KeyD",adjustMode:M.ADD,valueNumber:.1,spacing:1},{...te.pin.generate(),key:"KeyQ"},{...te.state.generate(),key:{code:"KeyQ",shiftKey:!0},spacing:2},{...te.seek.generate(),key:"KeyZ",adjustMode:M.ADD,valueNumber:-5},{...te.seek.generate(),key:"KeyX",adjustMode:M.ADD,spacing:1},{...te.seek.generate(),key:{shiftKey:!0,code:"KeyZ"},adjustMode:M.ADD,duration:x.FRAMES,valueNumber:-1},{...te.seek.generate(),key:{shiftKey:!0,code:"KeyX"},adjustMode:M.ADD,duration:x.FRAMES,valueNumber:1,spacing:1},{...te.fullscreen.generate(),key:{shiftKey:!0,code:"KeyF"},direct:!0},{...te.seek.generate(),key:{code:"Backquote"},adjustMode:M.ITC,duration:x.PERCENT,spacing:1},{...te.setMark.generate(),key:{shiftKey:!0,code:"KeyW"},valueString:"mark1"},{...te.seekMark.generate(),key:"KeyW",valueString:"mark1"},{...te.loop.generate(),key:"KeyR",valueString:"mark1",spacing:2},{...te.drawPage.generate(),trigger:k.CONTEXT,contextLabel:"- draw on page",replaceWithGsm:4},{...te.cinema.generate(),trigger:k.CONTEXT,contextLabel:"- darken background",replaceWithGsm:10},{...te.fxFilter.generate(),trigger:k.CONTEXT,replaceWithGsm:6,contextLabel:"- fx :: invert page",filterOption:"invert",filterTarget:"both",adjustMode:M.CYCLE,valueCycle:[0,1]},{...te.fxFilter.generate(),trigger:k.CONTEXT,replaceWithGsm:7,contextLabel:"- fx :: grayscale page",filterOption:"grayscale",filterTarget:"backdrop",adjustMode:M.ITC,valueItcMin:0,valueItcMax:1},{...te.fxFilter.generate(),trigger:k.CONTEXT,replaceWithGsm:8,contextLabel:"- fx :: video brightness",filterOption:"brightness",adjustMode:M.ITC,valueItcMin:.5,valueItcMax:2},{...te.fxFilter.generate(),trigger:k.CONTEXT,replaceWithGsm:9,contextLabel:"- fx :: video contrast",filterOption:"contrast",adjustMode:M.ITC,valueItcMin:.75,valueItcMax:1.25},{...te.fxReset.generate(),trigger:k.CONTEXT,filterTarget:"both",contextLabel:"- fx :: reset",replaceWithGsm:5}];return chrome.tabCapture&&chrome.offscreen&&e.push({...te.afxPitch.generate(),trigger:k.CONTEXT,contextLabel:"- pitch",adjustMode:M.ITC,replaceWithGsm:1},{...te.afxGain.generate(),trigger:k.CONTEXT,contextLabel:"- gain",adjustMode:M.ITC,replaceWithGsm:2},{...te.afxReset.generate(),trigger:k.CONTEXT,contextLabel:"- audio reset",replaceWithGsm:3,spacing:2}),e}const ne=function(e,t){let a=[],n=!1;for(let t of e)n&&(a.push(null),n=!1),a=[...a,...t],n=!0;return a}(function(e,t){let a=new Map;for(let t of e){const e=t[1],n=a.get(e)??[];n.push(t),a.set(e,n)}const n=[];return a.forEach((e=>{n.push(e)})),n}(Object.entries(te).filter((e=>!e[1].requiresTabCapture||chrome.tabCapture&&chrome.offscreen)).filter((e=>!e[1].requiresPiPApi||!l())).filter((e=>"runCode"!==e[0]||l())).map((([e,t])=>[e,t.group]))).map((e=>e.map((e=>e[0])))));function re(){return{version:12,firstUse:Date.now(),keybinds:ae(),freshKeybinds:!0,...ie()}}function ie(e){const t={speed:1,enabled:!0,audioFx:se()};return e&&b.forEach((e=>{t[e]=t[e]??null})),t}function oe(){const[e,t]=function(e,t){let a=[],n=[];return e.forEach((e=>{(([e,t])=>t.isTransform)(e)?a.push(e):n.push(e)})),[a,n]}(Object.entries(ee));return{filters:t.map((([e,t])=>({name:e,value:t.ref.default}))),transforms:e.map((([e,t])=>({name:e,value:t.ref.default})))}}function se(){return{pitch:0,volume:1,delay:0,eq:{enabled:!1,factor:1,values:Array(10).fill(0)}}}function le(e){if(e)return{tabId:e.id,frameId:0,windowId:e.windowId}}function de(){try{if(chrome.userScripts)return!0}catch{return!1}}Object.freeze([{name:"1965",values:[-6,-17.2,-6,0,-3.6,9.2,1.2,9.2,3.6,-5.2]},{name:"1965 - Part 2",values:[-18,-14.4,0,0,-3.6,9.2,1.2,9.2,3.6,-5.2]},{name:"Lo-Fidelity",values:[-15.1,-9.4,0,2.3,-2,4.3,4.3,-2.3,-4.6,-8.9]},{name:"Musical Presence",values:[0,0,0,0,0,2.5,5,2.5,0,0]},{name:"Notch Every Two Octaves",values:[-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99]},{name:"Rattle The Trunk",values:[17.99,17.99,9,0,0,0,0,0,0,0]},{name:"Simple Bass Cut",values:[-4,-3,-2,-2,-2,0,0,0,0,0]},{name:"Simple Bass Lift",values:[6,6,3,3,3,0,0,0,0,0]},{name:"Simple High Cut",values:[0,0,0,0,0,-2,-2,-3,-3,-3]},{name:"Simple High Lift",values:[0,0,0,0,0,1,2,2,3,4]},{name:"Vocal Presence - Boost",values:[0,0,0,0,0,0,6.5,0,0,0]},{name:"Vocal Presence - Cut",values:[0,0,0,0,0,0,-6.5,0,0,0]}]),Object.freeze([{name:"20 Band Classic V",values:[5,6,3.54,.59,-.48,-2.5,-5,-7,-8,-8,-7,-5,-3,-2.5,-1,2,3,4,5,4.02]},{name:"Bowed String",values:[0,0,-1.2,-1.6,-2.4,-2.8,-1.6,-1.6,-1.6,0,0,0,0,0,2.4,3.6,5.6,0,0,0]},{name:"Bright and Punchy",values:[-3,3,6,4.5,3,1.5,0,0,0,0,0,0,0,1,2,3,4,4,4,4]},{name:"Cymbal Shimmer",values:[0,0,0,0,0,0,0,0,0,0,0,-.1,-.3,-.5,-.4,.2,1.3,2.6,3.6,4]},{name:"Dark and Dull",values:[-6,-4,-2,0,0,0,0,0,0,0,0,0,0,-3,-6,-9,-12,-15,-18,-18]},{name:"Destination - Car Stereo",values:[-4,-2,0,3,4,3,1.5,0,-1,-2,-2,-1,0,1,2,3,4,2,0,-3]},{name:"Heavy Guitar",values:[0,-.2,-.1,1,1.9,1.6,.4,-.5,-1.1,-2.2,-3.6,-3.9,-2.9,-1.6,-.5,.1,.1,0,0,0]},{name:"Liven up dead samples",values:[0,0,0,0,0,0,0,0,0,0,0,.1,.1,-.2,-.6,.5,3,3.9,1.5,-.4]},{name:"Notch Every Octave",values:[-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99]},{name:"Possible Bass",values:[0,0,5.2,6,3.2,0,-11.6,-5.2,-4,-4,0,3.2,4.8,0,0,0,-3.2,-7.2,-10.8,-14]},{name:"Sloping High End Boost",values:[0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,6,7,8,8]},{name:"Sloping Low End Boost",values:[8,8,8,8,7,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0]},{name:"Tinny and Brittle",values:[-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,0,0,0,1,3.52,6,6,3,1]},{name:"Vocal Magic (breath)",values:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,.1,-.1,-.5,2,2.5,1]}]),Object.freeze([{name:"Bass - Increased Clarity",values:[-4,-3.4,-1.9,-.3,.6,.6,.2,-.3,-1.2,-1.5,1.4,2.9,.7,.2,.8,.5,0,-2,-.5,-.5,-.4,-.2,0,0,-.2,-.4,-.4,-.3,-.1,0]},{name:"Background Vocal",values:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-.2,-.3,-.4,-.4,-3,-6,-3,0,0,-.1,0,0,0]},{name:"Classic V",values:[3,2.5,1.3,.2,-.4,-.5,-.2,.2,.4,.3,-.3,-1.6,-3.4,-5.7,-8.2,-10.2,-10.9,-9.8,-7.4,-4.5,-2.3,-.9,-.1,0,-.2,-.3,.2,1.3,2.5,3]},{name:"Destination - Home Theater",values:[4.5,6,7.5,7.5,5,3,1.5,.5,0,-.5,-1.5,-3,-5,-3,-1.5,0,1.5,3,3,3,1.5,0,0,3,6,7.5,7.5,6,3,0]},{name:"Drums",values:[0,0,0,0,0,0,0,-.1,.3,.4,-2,-2.8,0,.6,-.2,-.1,0,-.2,-.3,-.5,-.4,-.1,0,0,.2,-.3,-.1,2.5,2.1,0]},{name:"Generic Attack Booster",values:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,-.1,-.1,-.1,.2,.6,1.3,2,2.8,3.1,2.7,1.8,.6,-.2,-.3,-.1,0]},{name:"Generic Mud Removal",values:[0,0,0,0,-.1,-.3,-.7,-1.5,-2.4,-3,-2.8,-2,-.8,0,.4,.3,0,-.1,-.1,0,0,0,0,0,0,0,0,0,0,0]},{name:"Gentle Hi Boost",values:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.5,1.5,3,5,5,3,1.5,.5]},{name:"Gentle Hi Cut",values:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-.5,-1.5,-3,-5,-5,-3,-1.5,-.5]},{name:"Gentle Low Boost",values:[0,.5,1.5,3,5,3,1.5,.5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{name:"Gentle Low Cut",values:[0,-.5,-1.5,-3,-5,-3,-1.5,-.5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{name:"Gentle Mid Boost",values:[0,0,0,0,0,0,0,0,0,0,0,0,0,.5,1.5,3,5,5,3,1.5,.5,0,0,0,0,0,0,0,0,0]},{name:"Gentle Mid Cut",values:[0,0,0,0,0,0,0,0,0,0,0,0,0,-.5,-1.5,-3,-5,-5,-3,-1.5,-.5,0,0,0,0,0,0,0,0,0]},{name:"Guitar - Increases Attack",values:[0,0,0,0,-1.5,-4,-2,0,0,0,0,0,0,0,0,0,0,-.2,-.3,-.4,2,0,-.1,0,0,0,-.1,0,0,0]},{name:"Keyboards - Bright and Clear",values:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-.2,-.3,-.4,-.4,2,5,2.5,0,0,-.1,0,0,0]},{name:"Kick - Less Boxy, more Attack",values:[0,0,0,0,0,0,0,0,0,0,-2.5,-6,-2.5,0,0,0,0,0,0,0,0,2,5,2,0,0,0,0,0,0]},{name:"Lead Vocal - Clarity",values:[0,0,0,0,0,0,0,0,-3,0,0,0,0,0,0,0,0,-.2,-.3,-.4,-.4,0,2,0,0,4,-.1,0,0,0]},{name:"Notch Every 2/3 Octave",values:[-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99,-18,17.99]},{name:"RIAA De-Emphasis",values:[18.3,17.6,16.7,15.6,14.2,12.8,11.3,9.6,8,6.5,5,3.7,2.6,1.6,.7,0,-.7,-1.6,-2.6,-3.7,-5.1,-6.6,-8.2,-10,-11.9,-13.8,-15.7,-17.7,-19.7,-20]},{name:"Snare - Increase Snap",values:[0,-.1,-.2,-.1,.5,1.3,1.9,1.9,1.3,.4,-.1,-.3,-.2,0,.1,0,0,-.1,-.2,-.4,-.6,-.7,-.5,1.5,2,0,0,0,.9,0]},{name:"cymbals sans gong",values:[-8,-6.5,-3.3,-.4,.4,-.5,-2.3,-3.7,-4.5,-4.4,-3.7,-2.3,-.9,.1,.5,.3,0,-.3,-.5,-.5,-.4,-.2,0,.1,0,0,-.1,0,0,0]}]);var ce=a(5739).$;const ue=[[["ON","OFF"],(e,t,a,n)=>{n[`r:${t}:enabled`]="ON"===a.type,n[`r:${t}:latestViaShortcut`]=!1}],[["SPEED"],(e,t,a,n)=>{n[`r:${t}:speed`]=a.overrideSpeed??1}],[["FX"],(e,t,a,n)=>{n[`r:${t}:elementFx`]=a.overrideFx?.elementFx||oe(),n[`r:${t}:backdropFx`]=a.overrideFx?.backdropFx||oe()}],[["JS"],async(e,t,a,n,r)=>{l()&&!e&&setTimeout((()=>{chrome.tabs.sendMessage(r.tabId,{type:"RUN_JS",value:a.overrideJs},{frameId:0})}),500)}]];async function fe(e,t){de()&&(await chrome.userScripts.unregister(),t||e.filter((e=>e.condition)).forEach((e=>{const t=(e.condition.parts??[]).filter((e=>!e.disabled&&"REGEX"!==e.type));if(!(e.enabled&&"JS"===e.type&&t.length&&e.overrideJs?.trim()))return;const a=t.map((e=>"CONTAINS"===e.type?`*${e.valueContains}*`:`*${e.valueStartsWith}`));chrome.userScripts.register([{id:e.id,matches:["https://test.invalid/"],[e.condition.block?"excludeGlobs":"includeGlobs"]:a,js:[{code:e.overrideJs}],world:"MAIN"}])})))}async function me(e,t){if(e.frameId||!e.tabId||!e.url?.startsWith("http"))return;const a=await ce.es.getAllUnsafe(),n=function(e){return e["g:superDisable"]?[]:(e["g:rules"]||[]).filter((e=>e.enabled&&e.condition?.parts.some((e=>!e.disabled))))}(a);if(!n.length)return;let r={},i={};const o=new Set(b.map((t=>`r:${e.tabId}:${t}`)));let s;for(let l of n){const n=`s:ro:${e.tabId}:${l.id}`,d=a[n];let c=P(e.url,l.condition,!1);if(c&&l.titleRestrict&&!e.frameId&&(void 0===s&&(await u(2500),s=(await chrome.tabs.get(e.tabId)).title||null),s&&pe(s.toLowerCase(),l.titleRestrict)||(c=!1)),c){r[n]=new URL(e.url).hostname;let a=!d||he("JS"===l.type?T.EVERY_COMMIT:l.strictness||T.DIFFERENT_HOST,d,r[n],t)?r:i;ue.find((([e])=>e.includes(l.type)))?.[1](a===i,e.tabId,l,a,e)}else a[n]&&o.add(n)}const l=Object.keys(r);[...l,...Object.keys(i)].forEach((e=>o.delete(e))),o.size&&ce.es.set(f([...o],null)),l.length&&ce.es.set(r)}function pe(e,t){return!t||t.toLowerCase().split(/,+\s+/).some((t=>e.includes(t)))}function he(e,t,a,n){return e===T.DIFFERENT_HOST?n&&a!==t:e===T.EVERY_COMMIT?n:e===T.EVERY_NAVIGATION}chrome.webNavigation.onCommitted.addListener((e=>me(e,!0))),chrome.webNavigation.onHistoryStateUpdated.addListener((e=>me(e))),ce.es.addWatcher([],(async function(e){if(!e["g:rules"]&&!e["g:superDisable"])return;const t=await ce.es.getAllUnsafe();fe(t["g:rules"]||[],t["g:superDisable"])})),ce.sess.safeCbs.add((async()=>{const e=await ce.es.getAllUnsafe();fe(e["g:rules"]||[],e["g:superDisable"])}));var be=a(5739).$;let ge=[...I,"isPinned"];const ye=D()((async function(e){let t=await be.es.getAllUnsafe();if(t["g:superDisable"])return void chrome.runtime.sendMessage({type:"OFFSCREEN_PUSH",superDisable:!0});const a=t["s:captured"]||[];if(0==a.length)return;const n=function(e,t,a){let n=[];for(let r of a)(ge.some((t=>e[`t:${r}:${t}`]||e[`r:${r}:${t}`]))||!t[`t:${r}:isPinned`]&&I.some((t=>e[`g:${t}`])))&&n.push(r);return n}(e,t,a);if(n.length){const e=await Promise.all(n.map((e=>G(I,e).then((t=>({view:t,tabId:e}))))));chrome.runtime.sendMessage({type:"OFFSCREEN_PUSH",updates:e})}}),500,{maxWait:500,leading:!0,trailing:!0});chrome.tabCapture&&chrome.offscreen&&be.es.addWatcher([],ye);var ve=Symbol.for("immer-nothing"),we=Symbol.for("immer-draftable"),Se=Symbol.for("immer-state");function Ie(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var Me=Object.getPrototypeOf;function xe(e){return!!e&&!!e[Se]}function ke(e){return!!e&&(Te(e)||Array.isArray(e)||!!e[we]||!!e.constructor?.[we]||Pe(e)||Oe(e))}var Ee=Object.prototype.constructor.toString();function Te(e){if(!e||"object"!=typeof e)return!1;const t=Me(e);if(null===t)return!0;const a=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return a===Object||"function"==typeof a&&Function.toString.call(a)===Ee}function Ce(e,t){0===_e(e)?Reflect.ownKeys(e).forEach((a=>{t(a,e[a],e)})):e.forEach(((a,n)=>t(n,a,e)))}function _e(e){const t=e[Se];return t?t.type_:Array.isArray(e)?1:Pe(e)?2:Oe(e)?3:0}function Fe(e,t){return 2===_e(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Ae(e,t,a){const n=_e(e);2===n?e.set(t,a):3===n?e.add(a):e[t]=a}function Pe(e){return e instanceof Map}function Oe(e){return e instanceof Set}function De(e){return e.copy_||e.base_}function Re(e,t){if(Pe(e))return new Map(e);if(Oe(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const a=Te(e);if(!0===t||"class_only"===t&&!a){const t=Object.getOwnPropertyDescriptors(e);delete t[Se];let a=Reflect.ownKeys(t);for(let n=0;n<a.length;n++){const r=a[n],i=t[r];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[r]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[r]})}return Object.create(Me(e),t)}{const t=Me(e);if(null!==t&&a)return{...e};const n=Object.create(t);return Object.assign(n,e)}}function Ne(e,t=!1){return Le(e)||xe(e)||!ke(e)||(_e(e)>1&&(e.set=e.add=e.clear=e.delete=$e),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>Ne(t,!0)))),e}function $e(){Ie(2)}function Le(e){return Object.isFrozen(e)}var je,Ue={};function Ge(e){const t=Ue[e];return t||Ie(0),t}function Be(){return je}function Ve(e,t){t&&(Ge("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function We(e){Xe(e),e.drafts_.forEach(qe),e.drafts_=null}function Xe(e){e===je&&(je=e.parent_)}function Ke(e){return je={drafts_:[],parent_:je,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function qe(e){const t=e[Se];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function ze(e,t){t.unfinalizedDrafts_=t.drafts_.length;const a=t.drafts_[0];return void 0!==e&&e!==a?(a[Se].modified_&&(We(t),Ie(4)),ke(e)&&(e=He(t,e),t.parent_||Je(t,e)),t.patches_&&Ge("Patches").generateReplacementPatches_(a[Se].base_,e,t.patches_,t.inversePatches_)):e=He(t,a,[]),We(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==ve?e:void 0}function He(e,t,a){if(Le(t))return t;const n=t[Se];if(!n)return Ce(t,((r,i)=>Ye(e,n,t,r,i,a))),t;if(n.scope_!==e)return t;if(!n.modified_)return Je(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const t=n.copy_;let r=t,i=!1;3===n.type_&&(r=new Set(t),t.clear(),i=!0),Ce(r,((r,o)=>Ye(e,n,t,r,o,a,i))),Je(e,t,!1),a&&e.patches_&&Ge("Patches").generatePatches_(n,a,e.patches_,e.inversePatches_)}return n.copy_}function Ye(e,t,a,n,r,i,o){if(xe(r)){const o=He(e,r,i&&t&&3!==t.type_&&!Fe(t.assigned_,n)?i.concat(n):void 0);if(Ae(a,n,o),!xe(o))return;e.canAutoFreeze_=!1}else o&&a.add(r);if(ke(r)&&!Le(r)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;He(e,r),t&&t.scope_.parent_||"symbol"==typeof n||!Object.prototype.propertyIsEnumerable.call(a,n)||Je(e,r)}}function Je(e,t,a=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Ne(t,a)}var Qe={get(e,t){if(t===Se)return e;const a=De(e);if(!Fe(a,t))return function(e,t,a){const n=tt(t,a);return n?"value"in n?n.value:n.get?.call(e.draft_):void 0}(e,a,t);const n=a[t];return e.finalized_||!ke(n)?n:n===et(e.base_,t)?(nt(e),e.copy_[t]=rt(n,e)):n},has:(e,t)=>t in De(e),ownKeys:e=>Reflect.ownKeys(De(e)),set(e,t,a){const n=tt(De(e),t);if(n?.set)return n.set.call(e.draft_,a),!0;if(!e.modified_){const n=et(De(e),t),o=n?.[Se];if(o&&o.base_===a)return e.copy_[t]=a,e.assigned_[t]=!1,!0;if(((r=a)===(i=n)?0!==r||1/r==1/i:r!=r&&i!=i)&&(void 0!==a||Fe(e.base_,t)))return!0;nt(e),at(e)}var r,i;return e.copy_[t]===a&&(void 0!==a||t in e.copy_)||Number.isNaN(a)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=a,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==et(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,nt(e),at(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const a=De(e),n=Reflect.getOwnPropertyDescriptor(a,t);return n?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:n.enumerable,value:a[t]}:n},defineProperty(){Ie(11)},getPrototypeOf:e=>Me(e.base_),setPrototypeOf(){Ie(12)}},Ze={};function et(e,t){const a=e[Se];return(a?De(a):e)[t]}function tt(e,t){if(!(t in e))return;let a=Me(e);for(;a;){const e=Object.getOwnPropertyDescriptor(a,t);if(e)return e;a=Me(a)}}function at(e){e.modified_||(e.modified_=!0,e.parent_&&at(e.parent_))}function nt(e){e.copy_||(e.copy_=Re(e.base_,e.scope_.immer_.useStrictShallowCopy_))}function rt(e,t){const a=Pe(e)?Ge("MapSet").proxyMap_(e,t):Oe(e)?Ge("MapSet").proxySet_(e,t):function(e,t){const a=Array.isArray(e),n={type_:a?1:0,scope_:t?t.scope_:Be(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let r=n,i=Qe;a&&(r=[n],i=Ze);const{revoke:o,proxy:s}=Proxy.revocable(r,i);return n.draft_=s,n.revoke_=o,s}(e,t);return(t?t.scope_:Be()).drafts_.push(a),a}function it(e){if(!ke(e)||Le(e))return e;const t=e[Se];let a;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,a=Re(e,t.scope_.immer_.useStrictShallowCopy_)}else a=Re(e,!0);return Ce(a,((e,t)=>{Ae(a,e,it(t))})),t&&(t.finalized_=!1),a}Ce(Qe,((e,t)=>{Ze[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),Ze.deleteProperty=function(e,t){return Ze.set.call(this,e,t,void 0)},Ze.set=function(e,t,a){return Qe.set.call(this,e[0],t,a,e[0])};var ot=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,a)=>{if("function"==typeof e&&"function"!=typeof t){const a=t;t=e;const n=this;return function(e=a,...r){return n.produce(e,(e=>t.call(this,e,...r)))}}let n;if("function"!=typeof t&&Ie(6),void 0!==a&&"function"!=typeof a&&Ie(7),ke(e)){const r=Ke(this),i=rt(e,void 0);let o=!0;try{n=t(i),o=!1}finally{o?We(r):Xe(r)}return Ve(r,a),ze(n,r)}if(!e||"object"!=typeof e){if(n=t(e),void 0===n&&(n=e),n===ve&&(n=void 0),this.autoFreeze_&&Ne(n,!0),a){const t=[],r=[];Ge("Patches").generateReplacementPatches_(e,n,t,r),a(t,r)}return n}Ie(1)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...a)=>this.produceWithPatches(t,(t=>e(t,...a)));let a,n;return[this.produce(e,t,((e,t)=>{a=e,n=t})),a,n]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){var t;ke(e)||Ie(8),xe(e)&&(xe(t=e)||Ie(10),e=it(t));const a=Ke(this),n=rt(e,void 0);return n[Se].isManual_=!0,Xe(a),n}finishDraft(e,t){const a=e&&e[Se];a&&a.isManual_||Ie(9);const{scope_:n}=a;return Ve(n,t),ze(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let a;for(a=t.length-1;a>=0;a--){const n=t[a];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}a>-1&&(t=t.slice(a+1));const n=Ge("Patches").applyPatches_;return xe(e)?n(e,t):this.produce(e,(e=>n(e,t)))}},st=ot.produce;function lt(e){const t=[];return e?.forEach((e=>{e.media?.forEach((a=>{t.push({...a,...e})}))})),t}async function dt(){const e=await async function(){const e=await chrome.storage.session.get();let t,a=[];for(let n in e)n.startsWith("m:")&&(n.startsWith("m:pin")?t=e[n]:n.startsWith("m:scope:")&&a.push(e[n]));return{pinned:t,scopes:a}}();return{pinned:e.pinned,infos:lt(e.scopes)}}async function ct(e,t){let[{ignorePiP:a},{infos:n,pinned:r}]=await Promise.all([G({ignorePiP:!0}),dt()]);n=n.filter((e=>e.readyState)),n=t?n.filter((e=>e.videoSize)):n;const i=n.find((e=>e.key===r?.key));if(i&&await async function(e,t){try{return await chrome.tabs.sendMessage(e,{type:"CS_ALIVE"},{frameId:t||0}),!0}catch(e){}}(i.tabInfo.tabId,i.tabInfo.frameId))return i;n.sort(((e,t)=>t.creationTime-e.creationTime));const o=n.find((e=>e.pipMode));if(!a&&o)return o;if(!e)return o||void 0;if(n=n.filter((t=>t.tabInfo.tabId===e.tabId)),!n.length)return o||void 0;let s,l=n.filter((e=>null!=e.intersectionRatio)).sort(((e,t)=>t.intersectionRatio-e.intersectionRatio))[0]?.intersectionRatio;return n.forEach((t=>{let a=0;var n,r;n=t.tabInfo,r=e,n?.tabId===r?.tabId&&(n?.frameId??null)===(r?.frameId??null)&&0!==e.frameId&&(a+=32),t.intersectionRatio>.05&&t.intersectionRatio===l?a+=16:t.intersectionRatio>.9?a+=8:t.intersectionRatio>.5?a+=4:t.intersectionRatio>.1&&(a+=2),t.isVisible&&(a+=16),t.elementSize&&t.elementSize.w>200&&t.elementSize.h>200&&(a+=8),(t.infinity||t.duration>=1800)&&(a+=8),t.duration>=600&&(a+=4),t.duration>=180&&(a+=2),t.duration>=60&&(a+=1),t.isVideo&&"www.spotify.com"!==location.hostname&&!t.isConnected&&(a=-1),(!s||a>s.score||a===s.score&&(t.infinity?60:t.duration)>s.info.duration)&&(s={info:t,score:a})})),s?.info}ot.produceWithPatches.bind(ot),ot.setAutoFreeze.bind(ot),ot.setUseStrictShallowCopy.bind(ot),ot.applyPatches.bind(ot),ot.createDraft.bind(ot),ot.finishDraft.bind(ot);const ut=chrome.runtime.getURL("offscreen.html");async function ft(){return!!(await chrome.runtime.getContexts({contextTypes:["OFFSCREEN_DOCUMENT"],documentUrls:[ut]})).length}async function mt(e){await async function(){await ft()||await chrome.offscreen.createDocument({url:ut,reasons:[chrome.offscreen.Reason.USER_MEDIA],justification:"For audio effects like volume gain, pitch shift, etc."})}();try{const[t,a]=await Promise.all([chrome.tabCapture.getMediaStreamId({targetTabId:e}),G(I,e)]);return chrome.runtime.sendMessage({type:"CAPTURE",streamId:t,tabId:e,view:a})}catch(e){return!e?.message?.includes("invoked")}}async function pt(e){await ft()&&chrome.runtime.sendMessage({type:"CAPTURE",tabId:e})}async function ht(e){return!!await ft()&&chrome.runtime.sendMessage({type:"REQUEST_CAPTURE_STATUS",tabId:e})}let bt;class gt{started=Date.now();softMax=Date.now()+6e5;constructor(e){this.softMax=this.started+6e4*e,this.intervalId=setInterval(this.handleInterval,2e4)}release=()=>{clearInterval(this.intervalId)};handleInterval=async()=>{const e=Date.now();(e>this.softMax||e>this.hardMax)&&this.release(),await chrome.storage.local.get("g:version")};static start(e){if(gt.keepAlive){if(gt.keepAlive.softMax-Date.now()>6e4*e)return;gt.keepAlive.release(),delete gt.keepAlive}gt.keepAlive=new gt(e)}static clear(){gt.keepAlive?.release(),delete gt.keepAlive}}var yt=a(5739).$;let vt;class wt{shortcutHideIndicator=!1;stopped=!1;itcList=[];immediateItc=!1;constructor(e,t){this.matches=e,this.tabInfo=t,this.init()}stop=()=>{this.stopped=!0};init=async()=>{this.globalHideIndicator=(await yt.es.getAllUnsafe())["g:hideIndicator"],this.immediateItc=this.matches.some((e=>"nothing"===e.kb.command&&null!=e.kb.valueNumber));for(let e of this.matches){if(this.stopped)return;await this.processKeybindMatch(e)}this.flushItcList()};fetch=async e=>G(e,this.tabInfo?.tabId);push=async(e,t)=>B({override:e,tabId:this.tabInfo?.tabId,...t??null});show=async e=>{this.tabInfo&&(this.shortcutHideIndicator||A({type:"SHOW_INDICATOR",opts:e,requiresFocus:null==this.tabInfo.frameId},this.tabInfo.tabId,this.tabInfo.frameId))};processItc=e=>{this.immediateItc?this.sendItcs([e]):this.itcList.push(e)};flushItcList=()=>{this.itcList.length&&(this.sendItcs(this.itcList),this.itcList=[])};sendItcs=e=>{chrome.tabs.sendMessage(this.tabInfo.tabId,{type:"ITC",inits:e})};applyToMedia=async(e,t=!1)=>{const a=await this.getMediaAny(t);a&&F(e,a.key,a.tabInfo.tabId,a.tabInfo.frameId)};getMediaAny=async(e=!1)=>(this.loadedMedia||(this.loadedMedia={value:await ct(this.tabInfo,e)}),this.loadedMedia.value);getMediaVideo=async()=>(this.loadedMediaVideo||(this.loadedMediaVideo={value:await ct(this.tabInfo,!0)}),this.loadedMediaVideo.value);autoCaptureWithCheck=(e,t)=>{"adjustMode"===e.valueType&&t?.toFixed(6)!==e.ref.default.toFixed(6)&&this.autoCapture()};autoCapture=()=>{null!=this.tabInfo?.tabId&&mt(this.tabInfo.tabId)};processKeybindMatch=async e=>{let t,a=e.kb,n=te[a.command];if(n.requiresVideo){if(t=await this.getMediaVideo(),!t)return}else if(n.requiresMedia&&(t=await this.getMediaAny(),!t))return;let r={};this.shortcutHideIndicator=a.invertIndicator?!this.globalHideIndicator:this.globalHideIndicator,await Mt[a.command]({media:t,override:r,commandInfo:n,kb:a,isAlt:e.alt,...this}),Object.keys(r).length&&await B({override:r,tabId:this.tabInfo?.tabId})}}let St={},It={};const Mt={nothing:async e=>{if(!(e.kb.valueNumber>0))return;const t=Date.now();let a=e.kb.valueNumber;if(a<.35){let n=t-It[e.kb.id];(n>300||isNaN(n))&&(a=.35),It[e.kb.id]=t}let n=Symbol();St[e.kb.id]=n,a>10&&gt.start(a/60+.5),await u(1e3*a),St[e.kb.id]!==n&&e.stop()},runCode:async e=>{if(!l())return;const{kb:t,tabInfo:a}=e;a&&chrome.tabs.sendMessage(a.tabId,{type:"RUN_JS",value:t.valueString},{frameId:0})},openUrl:async e=>{const{kb:t,tabInfo:a}=e;let n=t.valueString;if("sameTab"===t.valueUrlMode){if(!a)return;return void chrome.tabs.update(a.tabId,{url:n})}let r="fgTab"===(t.valueUrlMode||"fgTab");if(r||"bgTab"===t.valueUrlMode){let e=a?.tabId?(await chrome.tabs.get(a.tabId)).index+1:void 0;return void chrome.tabs.create({url:n,index:e,active:r})}let i="newPopup"===t.valueUrlMode;(i||"newWindow"===t.valueUrlMode)&&chrome.windows.create({url:n,type:i?"popup":"normal",...t.valuePopupRect||{}})},intoPopup:async e=>{const{kb:t,tabInfo:a}=e;if(!a.tabId)return;const n=await chrome.tabs.get(a.tabId),r=await chrome.windows.get(n.windowId),i=`s:popup:${n.id}`;if("popup"===r.type){let e=(await chrome.storage.session.get(i))[i];if(await chrome.windows.create({tabId:n.id,type:"normal",state:"normal",...e?{width:50,height:50}:{}}),!e)return;try{await chrome.windows.get(e.windowId)}catch(e){return}return await chrome.tabs.move(n.id,{windowId:e.windowId,index:e.index}),void chrome.tabs.update(n.id,{active:!0})}chrome.storage.session.set({[i]:{windowId:r.id,index:n.index,state:r.state}}),await chrome.windows.create({type:"popup",tabId:n.id,...t.valuePopupRect||{}})},muteTab:async e=>{if(!e.tabInfo?.tabId)return;let t=e.tabInfo.tabId;const a=await chrome.tabs.get(t);chrome.tabs.update(t,{muted:!a.mutedInfo?.muted})},state:async e=>{const{kb:t,show:a,override:n,fetch:r}=e,i=await r({enabled:!0,latestViaShortcut:!0});n.latestViaShortcut=!0,"off"===t.valueState||"toggle"===t.valueState&&i.enabled?n.enabled=!1:n.enabled=!0,a({text:" "+(n.enabled?"on":"off"),icons:["power"]})},pin:async e=>{const{kb:t,tabInfo:a,override:n,show:r,fetch:i}=e;if(!a)return;const o=await i({isPinned:!0});"off"===t.valueState||"toggle"===t.valueState&&o.isPinned?n.isPinned=!1:n.isPinned=!0,r({text:n.isPinned?"local":"global",small:!0})},speed:async e=>xt(e),speedChangesPitch:async e=>{const{kb:t,show:a,override:n,fetch:r}=e,i=await r({freePitch:!0});"off"===t.valueState||"toggle"===t.valueState&&i.freePitch?n.freePitch=!1:n.freePitch=!0,a({text:" "+(n.freePitch?"on":"off"),icons:["speedChangesPitch"]})},seek:async e=>xt(e),pause:async e=>{const{kb:t,media:a,applyToMedia:n,show:r}=e;"off"===t.valueState||"toggle"===t.valueState&&a.paused?r({icons:["play"]}):r({icons:["pause"]}),n({type:"PAUSE",state:t.valueState})},mute:async e=>{const{kb:t,media:a,applyToMedia:n,show:r}=e;"off"===t.valueState||"toggle"===t.valueState&&a.muted?r({text:`${Math.round(100*a.volume)}%`}):r({text:"0%"}),n({type:"MUTE",state:t.valueState})},volume:async e=>xt(e),setMark:async e=>{const{kb:t,applyToMedia:a,show:n}=e;let r=` ${t.valueString}`,i=["bookmark"];switch(t.valueString?.toLowerCase()){case"::nameless":r=" nameless";break;case"::nameless-prev":r=" prev",i=["arrowLeft"];break;case"::nameless-next":r=" next",i=["arrowRight"]}n({icons:i,text:r,small:!0}),a({type:"SET_MARK",key:t.valueString})},seekMark:async e=>{const{media:t,kb:a,applyToMedia:n,show:r}=e;let i,o=t.marks.includes(a.valueString);if(!o){let e=`s:mark:${a.valueString}:${await async function(e,t=6){return(await async function(e,t){return bt=bt??new TextEncoder,e=`${e}:${t}`,a=await crypto.subtle.digest("sha-1",bt.encode(e)),Array.from(new Uint8Array(a)).map((e=>e.toString(16).padStart(2,"0"))).join("");var a}(e,await async function(){let e=(await chrome.storage.local.get("f:salt"))["f:salt"];return e||(e=crypto.randomUUID().slice(0,18).replaceAll("-",""),await chrome.storage.local.set({"f:salt":e})),e}())).slice(0,t??99)}(t.domain,6)}`;const n=(await chrome.storage.session.get(e))[e];n&&Math.abs(t.duration-n.duration)<2&&(i=n.current,o=!0)}r({icons:o?["arrowRight"]:["bookmark"],text:` ${a.valueString}`,small:!0}),n({type:"SEEK_MARK",key:i??a.valueString,fast:a.fastSeek})},loop:async e=>{const{media:t,kb:a,applyToMedia:n,show:r}=e;if(t.marks.includes(a.valueString))return r({icons:["loop"],text:" "+(t.inLoop?"off":"on"),small:!0}),void n({type:"TOGGLE_LOOP",key:a.valueString,indicator:!e.shortcutHideIndicator,ignoreNavigate:a.ignoreNavigate});r({icons:["loop"],text:` ${a.valueString}???`,small:!0})},skip:async e=>{const{media:t,kb:a,applyToMedia:n,show:r}=e;if(t.marks.includes(a.valueString))return r({icons:["skip"],text:" "+(t.inSkip?"off":"on"),small:!0}),void n({type:"TOGGLE_LOOP",key:a.valueString,skipMode:!0,indicator:!e.shortcutHideIndicator,ignoreNavigate:a.ignoreNavigate});r({icons:["skip"],text:` ${a.valueString}???`,small:!0})},fullscreen:async e=>{const{kb:t,applyToMedia:a,media:n,tabInfo:r,fetch:i}=e;a({type:"FULLSCREEN",direct:t.direct})},PiP:async e=>{const{kb:t,applyToMedia:a}=e;a({type:"PIP",state:t.valueState})},cinema:async e=>{const{kb:t,applyToMedia:a,media:n}=e,r={type:"CINEMA",state:t.valueState,color:t.valueString,opacity:t.valueNumber,roundness:t.valueNumberAlt};n.tabInfo.frameId>0&&await chrome.tabs.sendMessage(n.tabInfo.tabId,{type:"CINEMA",event:r},{frameId:0}),a(r)},mediaInfo:async({applyToMedia:e})=>{e({type:"MEDIA_INFO"})},fxState:async e=>{const{kb:t,fetch:a,override:n,show:r}=e;let i=await a({elementFx:!0,backdropFx:!0});const o=_(t.filterTarget);if(o.element){i.elementFx=i.elementFx??oe();const e="on"===t.valueState||"toggle"===t.valueState&&!i.elementFx.enabled;n.elementFx={...i.elementFx,enabled:e}}if(o.backdrop){i.backdropFx=i.backdropFx??oe();const e="on"===t.valueState||"toggle"===t.valueState&&!i.backdropFx.enabled;n.backdropFx={...i.backdropFx,enabled:e}}r({icons:["power"]})},fxReset:async e=>{const{kb:t,show:a,override:n}=e,r=_(t.filterTarget);r.element&&(n.elementFx=null),r.backdrop&&(n.backdropFx=null)},fxSwap:async e=>{const{fetch:t,show:a,override:n}=e,r=await t({backdropFx:!0,elementFx:!0});n.elementFx=r.backdropFx,n.backdropFx=r.elementFx,a({icons:["swap"]})},fxFilter:async e=>xt(e),drawPage:async e=>{const{tabInfo:t}=e;t&&chrome.scripting.executeScript({target:{tabId:t.tabId,allFrames:!1},files:["pageDraw.js"]})},afxPitch:async e=>xt(e),afxGain:async e=>xt(e),afxDelay:async e=>xt(e),afxPan:async e=>xt(e),afxMono:async e=>{const{kb:t,fetch:a,show:n,override:r,autoCapture:i}=e,o=await a({monoOutput:!0});"off"===t.valueState||"toggle"===t.valueState&&o.monoOutput?r.monoOutput=!1:r.monoOutput=!0,r.monoOutput&&i(),n({text:" "+(r.monoOutput?"on":"off")})},afxCapture:async e=>{const{kb:t,show:a,tabInfo:n}=e;if(!n)return;let r="off";const i=await ht(n.tabId);try{"off"===t.valueState?pt(n.tabId):"on"===t.valueState?(mt(n.tabId),r="on"):(i?pt(n.tabId):mt(n.tabId),r=i?"off":"on")}catch(e){return}a({text:r})},afxReset:async e=>{const{show:t,tabInfo:a,override:n}=e;a&&(await ht(a.tabId)?pt(a.tabId):mt(a.tabId),n.audioFx=se(),n.audioFxAlt=n.audioPan=null,t({icons:["reset"]}))}};async function xt(e){const{fetch:a,override:n,kb:i,commandInfo:o,show:s,media:l,applyToMedia:d,tabInfo:u}=e,f=i.adjustMode||M.SET;if(f===M.ITC||f===M.ITC_REL){let t=await async function(e){const{kb:t,commandInfo:a,tabInfo:n,media:r}=e,i=a.ref||a.getRef(a,t);let o={relative:t.adjustMode===M.ITC_REL,seekOnce:t.seekOnce,resetTo:i.reset??i.default,min:i.min,max:i.max,sliderMin:t.valueItcMin??i.sliderMin,sliderMax:t.valueItcMax??i.sliderMax,step:t.valueNumber??i.itcStep,shouldShow:!e.shortcutHideIndicator,dontReleaseKeyUp:(t.trigger||k.LOCAL)===k.LOCAL?t.noHold:void 0,kb:t};if("seek"===t.command||"volume"===t.command){if(!n||!r.duration)return;delete o.resetTo;let e=await chrome.tabs.sendMessage(r.tabInfo.tabId,{type:"MEDIA_PROBE",key:r.key},{frameId:r.tabInfo.frameId||0});if(!e)return;if(o.mediaKey=r.key,o.mediaTabInfo=r.tabInfo,o.mediaDuration=e.duration,"seek"===t.command){if(o.min=0,delete o.max,o.original=e.currentTime,o.wasPaused=e.paused,t.duration===x.PERCENT)o.sliderMin=o.sliderMin/100*e.duration,o.sliderMax=o.sliderMax/100*e.duration,o.step=o.step/100*e.duration;else if(t.duration===x.FRAMES){let t=1/(e.fps??24);o.sliderMin=o.sliderMin*t,o.sliderMax=o.sliderMax*t,o.step=o.step*t}o.relative&&t.relativeToSpeed&&(o.step=o.step*(r.playbackRate||1))}else o.original=e.volume}else{let t=await Tt(e);if(!t)return;null!=t.main&&(o.original=t.main),null!=t.secondary&&(o.originalAlt=t.secondary)}return o}(e);if(!t)return;return void chrome.tabs.sendMessage(u.tabId,{type:"ITC",inits:[t]})}const m=o.ref||o.getRef(o,i);let p,h=!1;if(f===M.SET){if(p=i.valueNumber??m.default,"speed"===i.command){let e=await a({speed:!0,lastSpeed:!0});i.skipToggleSpeed||e.speed?.toFixed(2)!==p.toFixed(2)||null==e.lastSpeed||(p=e.lastSpeed)}}else i.adjustMode===M.ADD?(p=i.valueNumber??m.step,h=!0):i.adjustMode===M.CYCLE&&(p=await async function(e){const{fetch:a,override:n,kb:r,isAlt:i}=e;let o=(await a({keybinds:!0})).keybinds||[];if(!r.valueCycle?.length)return null;const s=r.valueCycle.length;let l=(r.cycleIncrement??0)+(i?-1:1);return r.cycleNoWrap||(l<0?l=s-1:l>=s&&(l=0)),l=t(0,s-1,l),n.keybinds=st(o,(e=>{e.find((e=>e.id===r.id)).cycleIncrement=l})),r.valueCycle?.[l]}(e));if(null==p||isNaN(p))throw Error("Value not NULL or NaN.");let b,g,y="",v="",w=[];if("seek"===i.command){let e=h?Math.abs(p):p;h?w.push(p<0?"arrowLeft":"arrowRight"):y="=";const t=1/(l.fps??24),a=l.duration/100;let n=p,o=function(e,t){if(e.adjustMode===M.ADD){let a=e.valueNumber??t?.step;if((e.duration||x.SECS)===x.SECS)return Math.abs(a)<.5;if(e.duration===x.FRAMES)return Math.abs(a)<14}}(i,m);if(i.duration===x.FRAMES?(n=p*t,v=` ${r(e,2)}f`):i.duration===x.PERCENT?(n=p*a,v=` ${r(e,0)}%`):v=` ${r(e,2)}`,h&&i.relativeToSpeed&&(n*=l.playbackRate),i.showNetDuration){const e=Date.now();let t=0;vt&&vt.key===l.key&&vt.time+750>e&&(t=vt.net),t+=n,vt={key:l.key,time:e,net:t},v=c(t,!0),w=[]}return d({type:"SEEK",relative:h,value:n,fast:i.fastSeek,autoPause:o?!i.skipPauseSmall:i.autoPause,wraparound:i.wraparound}),void s({text:v||"",icons:w||[],preText:y||""})}if(h){let t=await Tt(e);if(!t)return;null!=(t.secondary??t.main)&&(b=p+(t.main??t.secondary),g=p+(t.secondary??t.main))}else b=g=p;await Ct({kb:i,mediaKey:l?.key,mediaTabInfo:l?.tabInfo,tabInfo:u,value:b,valueAlt:g,shouldShow:!e.shortcutHideIndicator,ref:m,wasDirect:!0})}const kt=new Set(["afxPitch","afxGain","afxDelay","afxPan"]),Et={afxPitch:"pitch",afxGain:"volume",afxDelay:"delay"};async function Tt(e){const{kb:t,media:a,fetch:n,commandInfo:r}=e;if("volume"===t.command)return{main:a.volume};if("speed"===t.command)return{main:(await n({speed:!0})).speed};if("fxFilter"===t.command){const e=await n({elementFx:!0,backdropFx:!0}),a=ee[t.filterOption];return{main:(e.elementFx||oe())[a.isTransform?"transforms":"filters"].find((e=>e.name===t.filterOption)).value,secondary:(e.backdropFx||oe())[a.isTransform?"transforms":"filters"].find((e=>e.name===t.filterOption)).value}}if(kt.has(t.command)){const e=await n({audioFx:!0,audioFxAlt:!0,audioPan:!0});if("afxPan"===t.command)return{main:e.audioPan??r.ref.default};let a=Et[t.command];return{main:e.audioFx?e.audioFx[a]??r.ref.default:void 0,secondary:e.audioFxAlt?e.audioFxAlt[a]??r.ref.default:void 0}}}async function Ct(e){let{tabInfo:a,kb:i,mediaKey:o,mediaTabInfo:s,value:l,valueAlt:d,ref:u}=e;if(null==l&&null==d)return;const f=te[i.command];u=u||f.ref||f.getRef?.(f,"seek"===i.command?{duration:x.SECS}:i);let m="seek"===i.command?e.mediaDuration:u.max,p=e.wasDirect?i.wraparound:i.itcWraparound;null!=l&&(l=u.wrappable&&e.wasRelative&&p&&null!=m&&null!=u.min?n(u.min,m,l):t(u.min,u.max,l)),null!=d&&(d=u.wrappable&&e.wasRelative&&p?n(u.min,u.max,d):t(u.min,u.max,d));let h={};if("speed"===i.command)h.lastSpeed=(await G({speed:!0},a.tabId)).speed,h.lastSpeed===l&&delete h.lastSpeed,h.speed=l;else if("volume"===i.command)e.dry||F({type:"SET_VOLUME",value:l,relative:!1},o,s.tabId,s.frameId);else if("seek"===i.command)e.dry||F({type:"SEEK",value:l,fast:i.fastSeek},o,s.tabId,s.frameId);else if("fxFilter"===i.command){const t=await G({elementFx:!0,backdropFx:!0},e.tabInfo?.tabId),{element:a,backdrop:n}=_(i.filterTarget),r=ee[i.filterOption].isTransform?"transforms":"filters";a&&null!=l&&(h.elementFx=st(t.elementFx||oe(),(e=>{e[r].find((e=>e.name===i.filterOption)).value=l,l.toFixed(6)!==u.default.toFixed(6)&&(e.enabled=!0)}))),n&&null!=d&&(h.backdropFx=st(t.backdropFx||oe(),(e=>{e[r].find((e=>e.name===i.filterOption)).value=d,d.toFixed(6)!==u.default.toFixed(6)&&(e.enabled=!0)})))}else if("afxPan"===i.command){h.audioPan=l;let e=te[i.command];l?.toFixed(6)!==e.ref.default.toFixed(6)&&mt(a.tabId)}else if(kt.has(i.command)){const t=await G({audioFx:!0,audioFxAlt:!0},a?.tabId);let n=te[i.command];(null!=l&&l?.toFixed(6)!==n.ref.default.toFixed(6)||null!=d&&d.toFixed(6)!==n.ref.default.toFixed(6))&&(e.dry||mt(a.tabId)),t.audioFx&&null!=l&&(h.audioFx=st(t.audioFx,(e=>{e[Et[i.command]]=l}))),t.audioFxAlt&&null!=d&&(h.audioFxAlt=st(t.audioFxAlt,(e=>{e[Et[i.command]]=d})))}!e.dry&&Object.keys(h)&&await B({override:h,tabId:a.tabId}),l=l??d;let b=`${r(l,2)}`,g=[];var y,v;"volume"===i.command||"afxGain"===i.command?b=`${r(100*l,0)}%`:"seek"===i.command?b=`${c(l)}`:"speed"===i.command&&(b.includes(".")||(b=`${b}.0`)),e.shouldShow&&b.length+g.length&&(y={text:b||"",icons:g||[],preText:""},v=a.tabId,A({type:"SHOW_INDICATOR",opts:y,showAlt:e.showAlt},v,0))}const _t=new Set(["ar","de","en","es","fr","id","it","ja","ko","ms","pl","pt_BR","ru","th","tr","uk","vi","zh_CN","zh_TW"]);var Ft=a(5739).$;async function At(){let e;try{let t=await async function(){const e=Object.entries(await chrome.storage.local.get());return{...Object.fromEntries(e.filter((([e])=>e.startsWith("g:"))).map((([e,t])=>[e.slice(2),t])))}}();t.version||(t=(await chrome.storage.local.get("config")).config),e=function(e){const t=e?.version,a=re();return!e||e.version<7?a:(7===e.version&&(e=function(e){return e.version=8,e.rules?.forEach((e=>{e.condition={parts:[{type:e.matchType||"CONTAINS",id:i(),value:e.match||""}]},delete e.matchType,delete e.match})),e}(e)),8===e.version&&(e=function(e){return e.version=9,e.keybinds?.forEach((e=>{"seek"===e.command&&(e.valueBool2=!0)})),e}(e)),9===e.version&&(e=function(e){return e.version=10,e.keybinds?.forEach((e=>{"preservePitch"===e.command&&(e.command="speedChangesPitch",e.valueState="on"===e.valueState?"off":"off"===e.valueState?"on":"toggle")})),e}(e)),10===e.version&&(e=function(e){const t={adjustSpeed:"speed",setPin:"pin",setState:"state",setPause:"pause",setMute:"mute",adjustVolume:"volume",toggleLoop:"loop",setFx:"fxState",resetFx:"fxReset",flipFx:"fxSwap",adjustFilter:"fxFilter",adjustGain:"afxGain",adjustPitch:"afxPitch",adjustDelay:"afxDelay",adjustPan:"afxPan",tabCapture:"afxCapture"},a=(e,t,a)=>{t&&!l()&&(e.parts="JS"===t.type?e.parts.filter((e=>"REGEX"!==e.type)):e.parts),e.parts.forEach((e=>{e.valueContains="CONTAINS"===e.type?e.value:String.raw`example.com`,e.valueStartsWith="STARTS_WITH"===e.type?e.value:String.raw`https://example.com`,e.valueRegex="REGEX"===e.type?e.value:String.raw`example\.com`,delete e.value})),e.matchAll&&e.parts.every((e=>e.inverse))?e.block=!0:!e.matchAll&&e.parts.every((e=>!e.inverse))||(t?t.enabled=!1:e.parts=[]),e.parts.forEach((e=>{delete e.inverse})),delete e.matchAll};e.version=11,e.rules?.forEach((e=>{"STATE"===e.type&&(e.type=e.overrideEnabled?"ON":"OFF"),"JS"===e.type&&(l()||de()||(e.enabled=!1)),e.condition&&a(e.condition,e),delete e.overrideEnabled,delete e.strict,delete e.initialLoadOnly})),e.common.latestViaShortcut=!e.common.enabledLatestViaPopup,delete e.common.enabledLatestViaPopup,e.keybinds=e.keybinds??[],e.keybinds.forEach((e=>{Object.hasOwn(t,e.command)&&(e.command=t[e.command])})),e.keybindsUrlCondition&&a(e.keybindsUrlCondition),e.keybinds.forEach((e=>{e.global&&(e.trigger=k.GLOBAL),e.condition&&(e.condition.parts?.length?a(e.condition):delete e.condition),e.adjustMode===M.ADD&&(e.valueNumber=e.valueNumberAlt),"seek"===e.command&&(e.valueBool&&(e.relativeToSpeed=!0),e.valueBool2&&(e.fastSeek=!0),e.valueBool3&&(e.autoPause=!0),e.adjustMode=M.ADD,e.valueBool4?(e.adjustMode=M.SET,e.duration=x.PERCENT,e.valueNumber=e.valueNumberAlt):Math.abs(e.valueNumber)<.05&&(e.duration=x.FRAMES,e.valueNumber=e.valueNumber<0?-1:1),delete e.valueBool,delete e.valueBool2,delete e.valueBool3,delete e.valueBool4),"volume"===e.command?e.adjustMode=M.ADD:"seekMark"===e.command?(e.valueBool2&&(e.fastSeek=!0),delete e.valueBool2):"fullscreen"===e.command&&(e.valueBool&&(e.direct=!0),delete e.valueBool),delete e.valueNumberAlt})),e.initialContext=e.inheritPreviousContext?1:2,delete e.staticOverlay;const n=e.common;return delete e.common,Object.assign(e,n),e}(e)),11===e.version&&(e=function(e,t){if(e.version=12,11===t){if(e.keybinds.some((e=>"speed"===e.command&&"KeyD"===e.key&&.1===e.valueNumber&&e.adjustMode===M.ADD))){let t=e.keybinds.find((e=>"speed"===e.command&&e.adjustMode===M.ADD&&"KeyA"===e.key&&null==e.valueNumber));t&&(t.valueNumber=-.1)}e.keybinds.filter((e=>"speed"===e.command&&0===e.valueNumber&&e.adjustMode===M.ADD)).forEach((e=>{e.command="nothing"}))}return e}(e,t)),e?.version!==a.version?a:e=l()?function(e){return e.keybinds=e.keybinds.filter((e=>ne.includes(e.command))),e}(e):function(e){return e.keybinds.forEach((e=>{"runCode"===e.command&&(e.enabled=!1)})),e}(e))}(t)}catch(e){console.log("ERROR",e)}e=e||re(),await async function(e,t=!0){const a=t?Object.fromEntries((await X(W)).map((e=>[e,null]))):{};for(let t in e)a[`g:${t}`]=e[t];return setTimeout((()=>{R(e.keybinds)}),100),chrome.storage.local.set(a)}(e),delete Ft.installPromise}async function Pt(e,t,a){if(!(t=t||await G({pinByDefault:!0,initialContext:!0,customContext:!0})).pinByDefault)return;let n=a?null:e.openerTabId,r=t.initialContext??h.PREVIOUS,i=ie(!0);r===h.NEW||(i=r===h.CUSTOM?t.customContext??i:await G(b,r===h.PREVIOUS?n??0:0)),B({override:{...i,isPinned:!0},tabId:e.id})}globalThis.gvar=Ft,Ft.sess.installCbs.add((()=>{Ft.installPromise=At()})),Ft.sess.safeCbs.add((async()=>{const e=await chrome.storage.local.get();let t=Object.keys(e).filter((t=>null==e[t]));t=[...t,...await X(V,e)],t.length&&await chrome.storage.local.remove(t),l()||async function(){const e=await chrome.tabs.query({url:["https://*/*","http://*/*"]});if(e)for(let t of e)if(t.url)try{await chrome.scripting.executeScript({target:{tabId:t.id,allFrames:!0},files:["isolated.js"]})}catch(e){}}(),chrome.storage.session?.setAccessLevel?.({accessLevel:chrome.storage.AccessLevel.TRUSTED_AND_UNTRUSTED_CONTEXTS})})),Ft.sess.safeStartupCbs.add((async()=>{let e=await chrome.tabs.query({});const t=await G({pinByDefault:!0,initialContext:!0,customContext:!0});t.pinByDefault&&e.forEach((e=>Pt(e,t,!0)))})),chrome.tabs.onRemoved.addListener((async e=>{const t=(await G(["rules"])).rules||[];chrome.storage.local.remove([...[...b,"isPinned"].map((t=>`t:${e}:${t}`)),...b.map((t=>`r:${e}:${t}`)),...t.map((t=>`s:ro:${e}:${t.id}`))]),chrome.storage.session.remove(`m:scope:${e}:0`),Math.random()>.95&&async function(){const[e,t]=await Promise.all([chrome.tabs.query({}),chrome.storage.session.get()]),a=new Set(e.map((e=>e.id))),n=[];for(let e in t){if(!e.startsWith("m:scope:"))return;if(a.has(t[e]?.tabInfo.tabId))return;n.push(e)}chrome.storage.session.remove(n)}()})),chrome.tabs.onCreated.addListener(Pt),!l()&&!d()&&chrome.commands?.onCommand.addListener((async(e,t)=>{const a=await G({enabled:!0,superDisable:!0,keybinds:!0,keybindsUrlCondition:!0,latestViaShortcut:!0});if(a.superDisable)return;let n=a.keybinds||[];if(!a.enabled&&(n=n.filter((e=>"state"===e.command&&e.enabled&&e.trigger===k.GLOBAL&&(a.latestViaShortcut||e.alwaysOn))),!n.length))return;let r=(i=e,n.filter((e=>e.enabled&&e.trigger===k.GLOBAL)).map((e=>(e.globalKey||"commandA")===i?{kb:e}:e.allowAlt&&e.adjustMode===M.CYCLE&&(e.globalKeyAlt||"commandA")===i?{kb:e,alt:!0}:void 0)).filter((e=>e)));var i;if(!r.length)return;let o=t?le(t):await async function(){let e=await chrome.tabs.query({active:!0,lastFocusedWindow:!0});const[t]=e;if(t)return{tabId:t.id,windowId:t.windowId,url:t.url}}();const s=o?.url||"";a.keybindsUrlCondition&&!P(s,a.keybindsUrlCondition,!0)||(r=r.filter((e=>!(e.kb.condition?.parts.length>0)||P(s,e.kb.condition,!0))),new wt(r,o))})),chrome.contextMenus?.onClicked.addListener((async(e,t)=>{const a=(n=(await G({keybinds:!0})).keybinds,r=e.menuItemId,n.filter((e=>e.enabled&&e.trigger===k.CONTEXT)).map((e=>e.id===r?{kb:e}:e.allowAlt&&e.adjustMode===M.CYCLE&&`ALT_${e.id}`===r?{kb:e,alt:!0}:void 0)).filter((e=>e)));var n,r;1===a.length&&new wt([a[0]],le(t))})),chrome.runtime.onMessage.addListener(((e,t,a)=>{if("REQUEST_TAB_INFO"===e.type)a({tabId:t.tab.id,frameId:t.frameId});else{if("REQUEST_GSM"===e.type)return async function(){return async function(e){const t=await fetch(chrome.runtime.getURL(`locales/${e}.json`)),a=await t.json();return a._lang=e.replace("_","-"),a}(function(e){if(e&&_t.has(e))return e;const t=new Set;for(let e of navigator.languages.map((e=>e.replace("-","_"))))t.add(e),t.add(e.split("_")[0]);return t.add("en"),[...t].find((e=>_t.has(e)))}((await chrome.storage.local.get("g:language"))["g:language"]))}().then((e=>a(e)),(e=>a(null))),!0;if("REQUEST_CREATE_TAB"===e.type)chrome.tabs.create({url:e.url}),a(!0);else{if("REQUEST_PANE"===e.type)return chrome.scripting.executeScript({target:{tabId:t.tab.id},files:["pane.js"],injectImmediately:!0}).finally((()=>a(!0))),!0;if("TRIGGER_KEYBINDS"===e.type)G({keybinds:!0}).then((({keybinds:a})=>{let n=e.ids.map((e=>{let t=a.find((t=>t.id===e.id));return t?{kb:t,alt:e.alt}:null}));new wt(n,{tabId:t.tab.id,frameId:t.frameId,windowId:t.tab.windowId})})),a(!0);else if("SET_SESSION"===e.type)chrome.storage.session.set(e.override);else{if("GET_SESSION"===e.type)return chrome.storage.session.get(e.keys).then((e=>a(e)),(e=>a(null))),!0;if("SET_LOCAL"===e.type)Ft.es.set(e.override);else{if("GET_LOCAL"===e.type)return Ft.es.get(e.keys).then((e=>a(e)),(e=>a(null))),!0;"INSERT_CSS"===e.type?chrome.scripting.insertCSS({css:e.value,target:{tabId:t.tab.id,frameIds:[t.frameId]}}):"SYNC_CONTEXT_MENUS"===e.type?e.direct?R():L():"SEND_MEDIA_EVENT_TO"===e.type?(a(!0),chrome.tabs.sendMessage(e.tabId,{type:"APPLY_MEDIA_EVENT",event:e.event,key:e.key},{frameId:e.frameId||0})):"SET_STATEFUL"===e.type&&(a(!0),Ct(e.init))}}}}}));const Ot=["g:speed","g:freePitch","g:enabled","g:superDisable"];Ft.es.addWatcher([],(async e=>{if(!Ot.some((t=>e[t])))return;const t=await Ft.es.getAllUnsafe();let a={speed:t["g:speed"],freePitch:t["g:freePitch"]};!t["g:superDisable"]&&t["g:enabled"]||(a=null),(await chrome.tabs.query({audible:!0,active:!1})).forEach((e=>{t[`t:${e.id}:isPinned`]||t[`r:${e.id}:speed`]||!1===t[`r:${e.id}:enabled`]||chrome.tabs.sendMessage(e.id,{type:"BG_SPEED_OVERRIDE",value:a})}))}))})()})();