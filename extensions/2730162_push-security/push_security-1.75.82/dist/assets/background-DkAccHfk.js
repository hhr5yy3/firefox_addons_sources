import{b as e}from"./browser-polyfill-BfqLb55p.js";import{i as t,u as a,a as r,g as o,b as n,c as i,w as s,p as c,d as l,n as m,l as u,e as p,t as d,f,h as g,j as E,E as I,r as h,k as A,m as O,o as x,q as w,s as C,S as R,v as _,x as T,y,z as P,A as S,B as N,C as b,G as M,D,F as v,H as U,I as G,W as L,J as F,K as k,L as B,M as W,N as H,O as $,P as K,Q as z,R as j,T as Y,U as q,V,X as Z,Y as X,Z as J,_ as Q,$ as ee,a0 as te,a1 as ae,a2 as re,a3 as oe,a4 as ne,a5 as ie,a6 as se,a7 as ce,a8 as le,a9 as me,aa as ue,ab as pe,ac as de,ad as fe,ae as ge,af as Ee,ag as Ie,ah as he,ai as Ae,aj as Oe,ak as xe,al as we,am as Ce,an as Re,ao as _e,ap as Te,aq as ye,ar as Pe,as as Se,at as Ne,au as be,av as Me,aw as De,ax as ve,ay as Ue,az as Ge,aA as Le,aB as Fe,aC as ke,aD as Be,aE as We,aF as He,aG as $e,aH as Ke,aI as ze,aJ as je,aK as Ye,aL as qe}from"./enrolment-DD7Q7GNl.js";import{l as Ve,g as Ze,w as Xe,P as Je,s as Qe,a as et,b as tt,c as at,d as rt,e as ot,f as nt,r as it,h as st,i as ct,j as lt,k as mt,m as ut,n as pt,o as dt,p as ft}from"./settings-CkiztfCI.js";async function gt(o,n,i){t(i)&&i.pathname.startsWith("/app/")&&await Promise.all([e.scripting.executeScript({target:{tabId:o,frameIds:[n]},args:[e.runtime.id],func:e=>{(window.wrappedJSObject||window).__push_ext_id=e}}).catch(a),r(o,n,"PushWebApp/BootstrapMessageListeners")])}var Et=(e=>(e[e.INITIALISING=0]="INITIALISING",e[e.RUNNING=1]="RUNNING",e))(Et||{});let It=0;var ht={},At={},Ot={};Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.presets=Ot.defaultOptions=void 0;const xt={chrome:{supportedSchemes:["http","https","file","ftp"],schemeStarMatchesWs:!1},firefox:{supportedSchemes:["http","https","ws","wss","ftp","file"],schemeStarMatchesWs:!0}};Ot.presets=xt;const wt=Object.assign(Object.assign({},xt.chrome),{strict:!0});Ot.defaultOptions=wt;var Ct,Rt,_t={},Tt={},yt={},Pt={},St={};function Nt(){if(Ct)return St;Ct=1,Object.defineProperty(St,"__esModule",{value:!0}),St.regexEscape=function(t,a="u"){const o=r(a),n=Object.values(o);return new e.RegexFragment((i=t,i.replace(new RegExp(`[${n.join("")}]`,[...new Set([...a,..."g"])].join("")),(e=>o[e]))));var i},St.exact=function(t,a){return(0,e.regex)(a)`${t}`},St.regexLength=function(e){return e.replace(/\\(?:\w\{[^}]+\}|u[0-9a-f]{4}|x[0-9a-f]{2}|[0-8]{3}|c[A-Z]|.)/gi,".").length},St.getContextAgnosticMap=void 0;var e=bt();const t=Array.from({length:128},((e,t)=>String.fromCodePoint(t))),a=new Map,r=e=>{const r=a.get(e);if(r)return r;const o=Object.fromEntries((e=>{const a=new Set(e);return a.delete("i"),e=[...a].join(""),t.map((a=>{const r=`\\x${a.codePointAt(0).toString(16).padStart(2,"0")}`;let o=r,n=r,i=r;try{const r=new RegExp(`[${a}]`,e);new RegExp(`[${a}${a}]`,e),new RegExp(`[${a}${a}\0]`,e),r.test(a)&&!t.filter((e=>e!==a)).some((e=>r.test(e)))?o=a:(new RegExp(`[\\${a}]`,e),o=`\\${a}`)}catch(s){try{new RegExp(`[\\${a}]`,e),o=`\\${a}`}catch(c){}}try{const r=new RegExp(`^${a}$`,e);r.test(a)&&!t.filter((e=>e!==a)).some((e=>r.test(e)))?n=a:(new RegExp(`\\${a}`,e),n=`\\${a}`)}catch(l){try{new RegExp(`\\${a}`,e),n=`\\${a}`}catch(m){}}if(o!==n)try{new RegExp(`\\${a}`,e),new RegExp(`\\${a}`,e),i=`\\${a}`}catch(u){}else i=[o,n].sort(((e,t)=>t.length-e.length))[0];return{ch:a,agnostic:i,inClass:o,outsideClass:n}})).filter((e=>e.inClass!==e.ch||e.outsideClass!==e.ch))})(e).map((e=>[e.ch,e.agnostic])));return a.set(e,o),o};return St.getContextAgnosticMap=r,St}function bt(){if(Rt)return Pt;Rt=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.regex=function(...e){if(Array.isArray(e[0])){const[t,...a]=e;return s("")(t,...a)}{const[t]=e;return s(t)}},Pt.LazyAlternation=Pt.RegexFragment=void 0;var e=Nt();Pt.RegexFragment=class extends String{};class t extends Array{constructor(...e){super(...Array.isArray(e[0])?e[0]:e)}}Pt.LazyAlternation=t;const a={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"},r=/(\\*)#(.*)/g,o=e=>!1!==e&&null!=e,n=(e,t,a)=>t.length%2?t.slice(1)+"#"+a.replace(r,n):t,i=t=>a=>{if(a instanceof RegExp){if(a.flags===t)return a.source;{const r=(0,e.getContextAgnosticMap)(a.flags),o=(0,e.getContextAgnosticMap)(t),n=[];for(const e of Object.keys(r))r[e]!==o[e]&&n.push(r[e]);for(const e of Object.keys(o))r[e]!==o[e]&&n.push(e);const i=new RegExp(`(?:${n.map((t=>(0,e.regexEscape)(t,"i"))).join("|")})`,"gi");return n.length?a.source.replace(i,(e=>{var t;return null!==(t=o[e.startsWith("\\")?e.slice(1):e])&&void 0!==t?t:e})):a.source}}return"string"==typeof a?(0,e.regexEscape)(a,t):String(o(a)?a:"")},s=(s={})=>(c,...l)=>{let m="",u=[];"string"==typeof s?u=[...s]:Object.entries(a).forEach((([e,t])=>{s[e]&&u.push(t)}));const p=u.sort(((e,t)=>e.localeCompare(t))).join("");return c.raw.forEach(((a,s)=>{m+=a.replace(r,n).replace(/\\`/g,"`").replace(/(\\*)(\s+)/g,((e,t,a)=>" "===a[0]&&t.length%2?t.slice(1)+a[0]:t));const c=l[s];if(Array.isArray(c)){const a=c instanceof t?-1:1;m+=`(?:${[...new Set([...c.filter(o).map((e=>String(i(p)(e))))])].sort(((t,r)=>a*((0,e.regexLength)(r)-(0,e.regexLength)(t)))).join("|")})`}else m+=i(p)(c)})),new RegExp(m,p)};return Pt}var Mt={};Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.unwrap=function(e,t){const a=e.source.replace(/^\^?([\s\S]*?)\$?$/,"$1");return(0,Dt.regex)(null!=t?t:e.flags)`${new Dt.RegexFragment(a)}`};var Dt=bt();var vt={};Object.defineProperty(vt,"__esModule",{value:!0}),vt.proxy=void 0;var Ut=bt();const Gt=new Proxy(Ut.regex,{get:(e,t)=>e("_"===t?"":t),apply:(e,t,a)=>e(...a)});vt.proxy=Gt,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"regex",{enumerable:!0,get:function(){return t.regex}}),Object.defineProperty(e,"RegexFragment",{enumerable:!0,get:function(){return t.RegexFragment}}),Object.defineProperty(e,"LazyAlternation",{enumerable:!0,get:function(){return t.LazyAlternation}}),Object.defineProperty(e,"exact",{enumerable:!0,get:function(){return a.exact}}),Object.defineProperty(e,"regexEscape",{enumerable:!0,get:function(){return a.regexEscape}}),Object.defineProperty(e,"unwrap",{enumerable:!0,get:function(){return r.unwrap}}),Object.defineProperty(e,"proxy",{enumerable:!0,get:function(){return o.proxy}});var t=bt(),a=Nt(),r=Mt,o=vt}(yt),Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.getDummyUrl=function(e,t={}){const{rawHost:a,rawPathAndQuery:r}=e,{defaultScheme:o="https",subdomain:n="",pathAndQueryReplacer:i="",rootDomain:s="example.com",strict:c=!0}=t;let l;const m="*"===e.scheme?o:e.scheme;l="file"===m?"":"*"===a?[n,s].filter(Boolean).join("."):a.replace(/^\*./,n?`${n}.`:"");const u=(c?r:"/*").replace(/\*/g,`-${i}-`).replace((0,Lt.regex)("g")`-+(${Ft})`,"$1").replace((0,Lt.regex)("g")`(${Ft})-+`,"$1").replace(/\/+/g,"/");try{return new URL(`${m}://${l}${u}`)}catch(p){return null}};var Lt=yt;const Ft=/^|$|[/?=&\-]/;var kt={},Bt={};Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.ALL_URLS=void 0;Bt.ALL_URLS="<all_urls>",Object.defineProperty(kt,"__esModule",{value:!0}),kt.getPatternSegments=function(e){if(e===Wt.ALL_URLS)return{pattern:e,scheme:"*",rawHost:"*",rawPathAndQuery:"/*"};const t=e.match(Ht);if(!t)return null;const[,a,r,o]=t;return{pattern:e,scheme:a,rawHost:r,rawPathAndQuery:o}};var Wt=Bt;const Ht=(0,yt.regex)()`
	^
		(\*|\w+)      # scheme
		://
		(
			\*     |  # Any host
			[^/\#]*     # Only the given host (optional only if scheme is file)
		)
		(/[^\r\n\#]*) # path
	$
`;Object.defineProperty(_t,"__esModule",{value:!0}),_t.getExampleUrls=function(e,t){const a=(0,Kt.getPatternSegments)(e),{supportedSchemes:r,strict:o}=t,n=["","www","foo.bar"],i=["example.com"],s=["","foo","/bar/baz/"],c=r.flatMap((e=>n.flatMap((t=>i.flatMap((r=>s.flatMap((n=>(0,$t.getDummyUrl)(a,{defaultScheme:e,subdomain:t,rootDomain:r,pathAndQueryReplacer:n,strict:o})))))))));return[...new Set(c.filter(Boolean).map((e=>e.href)))]};var $t=Tt,Kt=kt;var zt={},jt={};Object.defineProperty(jt,"__esModule",{value:!0}),jt.getHostRegex=function(e){const{pattern:t,scheme:a,rawHost:r}=e;if(!r&&"file"!==a)return new TypeError('Host is optional only if the scheme is "file".');const o=r.includes("*");if(o){const e=r.split("*.");if(r.length>1&&(2!==e.length||e[0]||!e[1]))return new TypeError('Host can contain only one wildcard at the start, in the form "*.<host segments>"')}const n=(0,qt.getDummyUrl)(e,{subdomain:""});if(!n)return new TypeError(`Pattern "${t}" cannot be used to construct a valid URL.`);const i=n.host;if(/:\d+$/.test(i))return new TypeError(`Host "${r}" cannot include a port number. All ports are matched by default.`);if(/[^.a-z0-9\-]/.test(i))return new TypeError(`Host "${r}" contains invalid characters.`);const s=o?"*."+i:i;return"*"===r?/.+/:s.startsWith("*.")?(0,Yt.regex)()`
			^
				(?:[^.]+\.)*     # any number of dot-terminated segments
				${s.slice(2)}   # rest after leading *.
			$
		`:(0,Yt.regex)()`^${s}$`};var Yt=yt,qt=Tt;var Vt={};Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.createMatchFn=function(e){return t=>{let a;try{const e=t instanceof URL?t.href:t;a=new URL(e);const r=Zt(a.pathname),o=Zt(a.search);if(r instanceof Error||o instanceof Error)return!1;a.pathname=r,a.href.endsWith("?")||(a.search=o)}catch(r){return!1}return e(a)}},Vt.normalizeUrlFragment=void 0;const Zt=e=>{try{return encodeURI(decodeURI(e))}catch(t){return t}};Vt.normalizeUrlFragment=Zt,Object.defineProperty(zt,"__esModule",{value:!0}),zt.toMatchFnOrError=function(e,t){var a;const{supportedSchemes:r,schemeStarMatchesWs:o,strict:n}=t;if(e===Jt.ALL_URLS)return(0,ta.createMatchFn)((e=>(0,Xt.regex)()`
				^
					(?:${r})
					:
				$
			`.test(e.protocol)));const i=null===(a=e.match(/^(urn|data):/))||void 0===a?void 0:a[1];if(i)return new TypeError(`browser-extension-url-match does not currently support scheme "${i}"`);const s=(0,ea.getPatternSegments)(e);if(!s){try{const t=new URL(e);if(t.hash||t.href.endsWith("#"))return new TypeError(`Pattern cannot contain a hash: "${e}" contains hash "${t.hash||"#"}"`);if(!e.slice(t.origin.length).startsWith("/"))return new TypeError(`Pattern "${e}" does not contain a path. Use "${e}/*" to match any paths with that origin or "${e}/" to match that URL alone`)}catch(f){}return new TypeError(`Pattern "${e}" is invalid`)}const{scheme:c,rawPathAndQuery:l}=s;if("*"!==c&&!r.includes(c))return new TypeError(`Scheme "${c}" is not supported`);const m=(0,Xt.regex)()`${"*"===c?new Xt.RegexFragment(["https?",o&&"wss?"].filter(Boolean).join("|")):c}:`,u=(0,Qt.getHostRegex)(s);if(u instanceof Error)return u;const p=n?(0,ta.normalizeUrlFragment)(l):"/*";if(p instanceof Error)return p;const d=(0,Xt.regex)()`^${new Xt.RegexFragment(p.split("*").map((e=>(0,Xt.regexEscape)(e))).join(".*"))}$`;return(0,ta.createMatchFn)((e=>{const t=e.pathname+(e.href.endsWith("?")?"?":e.search);return m.test(e.protocol)&&u.test(e.hostname)&&d.test(t)}))};var Xt=yt,Jt=Bt,Qt=jt,ea=kt,ta=Vt;Object.defineProperty(At,"__esModule",{value:!0}),At.matchPattern=function(e,t={}){const a="string"==typeof e?[e]:[...new Set(e)];if(1===a.length)return ia(t)(a[0]);const r=a.map(ia(t));if(function(e){return e.every((e=>e.valid))}(r))return{valid:!0,get examples(){return[...new Set(r.flatMap((e=>e.examples)))]},match:e=>r.some((t=>t.match(e))),patterns:a,config:t,assertValid:na};return{valid:!1,error:r.find((e=>!e.valid)).error,assertValid:na}};var aa=Ot,ra=_t,oa=zt;function na(){if(!this.valid)throw new TypeError(this.error.message);return this}function ia(e){return t=>{const a=Object.assign(Object.assign({},aa.defaultOptions),e),r=(0,oa.toMatchFnOrError)(t,a);return r instanceof Error?{valid:!1,error:r,assertValid:na}:{valid:!0,match:r,get examples(){return(0,ra.getExampleUrls)(t,a).filter((e=>r(e))).slice(0,100)},patterns:[t],config:a,assertValid:na}}}async function sa({tabId:t,frameId:a=0,thisFrameOnly:r,resultOnIgnoredTabError:s}){const c=await o(t,a);if(!c)return[];const l=await n(),m=[],u=i([{frameId:a,result:s}]);for(let o=0;o<l.length;++o){const n=l[o],i={tabId:t},s=ht.matchPattern(n.matches||[]);s.valid&&!s.match(c.url)||(!r&&n.allFrames?i.allFrames=!0:void 0!==a&&(i.frameIds=[a]),m.push(e.scripting.executeScript({target:i,files:n.js||[]}).catch(u)))}return Promise.allSettled(m)}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"matchPattern",{enumerable:!0,get:function(){return t.matchPattern}}),Object.defineProperty(e,"presets",{enumerable:!0,get:function(){return a.presets}});var t=At,a=Ot}(ht);function ca(e){return s((()=>It>=e),12e4,100)}async function la(t){try{const a=e.runtime.getURL(t);return(await fetch(a,{method:"HEAD"})).ok}catch{return!1}}const{createFeatureScriptError:ma}=P("DETECT_SOCIAL_LOGIN",{platform:"MICROSOFT_365"}),ua=S("DETECT_SOCIAL_LOGIN","MICROSOFT_365"),pa=["https://login.microsoftonline"],da=["https://login.live.com"],fa=["/oauth2/authorize","/oauth2/v2.0/authorize"],ga=["/oauth20_authorize.srf"],Ea=["/ppsecure/post.srf"];function Ia(e){for(let t=0;t<da.length;t++){const a=da[t];if(e.origin.startsWith(a))return!0}return!1}function ha(e){for(let t=0;t<pa.length;t++){const a=pa[t];if(e.origin.startsWith(a))return!0}return!1}async function Aa(){try{const e=await Ve("microsoftUserEmailLookup"),t=await Ze(),a=e.map.size;for(const[r,o]of e.map.entries()){const a=o.split("@").pop();a&&!t.includes(a)&&e.map.delete(r)}e.map.size!==a&&await Xe(e)}catch(e){ua(e)}}async function Oa(e,t){const a=await Ve("microsoftUserEmailLookup");a.map.set(t,e.emailAddress),await Xe(a)}async function xa(e,t){const a=await Ve("microsoftUserEmailLookup");return a.map.has(e)||await async function(e){var t;const a=await fetch(`https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=${e}&prompt=select_account&scope=openid`,{credentials:"include"});if(!a.ok)return void u("SOCIAL_LOGIN_DATA_GATHER_ERROR",ma(`Failed to fetch user sessions. (${a.status} ${a.statusText})`));const r=await a.text(),o=JSON.parse((null==(t=r.match(/"arrSessions":(\[\{.+\}\]),/))?void 0:t.at(1))||"[]");if(0===o.length)return await N({key:"SOCIAL_LOGIN_DATA_GATHER_EMPTY_SESSIONS",type:"SOCIAL_LOGIN_DATA_GATHER_EMPTY_SESSIONS",error:ma("Could not find any sessions in page",{},[{filename:"page.html",contentType:"text/html",data:r}])},90);const n=await Ve("microsoftUserEmailLookup");for(const i of n.map.keys())o.some((e=>e.id===i))||n.map.delete(i);for(const i of o)if(!n.map.has(i.id)){const e=await E([i.name]);void 0!==e&&n.map.set(i.id,e.emailAddress)}await Xe(n)}(t),a.map.get(e)}function wa(e){const t=y(e);return"1.0"===t.ver?t.email||t.upn:t.preferred_username||t.upn}const Ca={inspectOutgoingRequestDetails:async function(e){var t;try{const{requestBody:a,method:r}=e,o=p(e),n=d(o),i=d(e.url);if(!i)return;const s=f(i).href,c=g(s);if(n&&c&&"POST"===r&&(null==(t=null==a?void 0:a.formData)?void 0:t.id_token)&&(ha(n)||Ia(n))){const e=wa(a.formData.id_token[0]);if(!e)return void u("SOCIAL_LOGIN_EXPECTATION_ERROR",ma("Unable to extract email from OAuth `id_token` response",{},[{contentType:"application/json",filename:"formdata.json",data:JSON.stringify({formData:a.formData}).replaceAll(new RegExp(I,"g"),"[redacted]")}]));{const t=await E([e]);if(c.loginEmail=t,!c.loginEmail&&I.test(e))return void h(s)}await A(c)}}catch(a){ua(a)}},inspectOutgoingRequestHeaders:async function(e){try{const{tabId:t,frameId:a,url:r,requestId:o}=e;if(!p(e))return;const n=d(r);if(!n)return;if(function(e){if(ha(e))for(let t=0;t<fa.length;t++){const a=fa[t];if(e.pathname.endsWith(a))return!0}return!1}(n)){if(n.searchParams.has("client_id")&&n.searchParams.has("redirect_uri")){const e=n.searchParams.get("client_id"),r=f(new URL(n.searchParams.get("redirect_uri")));if("localhost"===r.hostname)return;if(!O(r.href)){const{platform:n}=await x(r,!0);if("MICROSOFT_365"===n)return;const{platform:i,loginUrl:s,loginTabId:c}=await w(r);s&&c&&C({tabId:t,frameId:a,platform:i,loginUrl:s,loginTabId:c,loginId:r.href,ssoProvider:R.MICROSOFT_365,oidcClientId:e,initiatorRequestId:o})}}}else if(function(e){if(Ia(e))for(let t=0;t<ga.length;t++){const a=ga[t];if(e.pathname.endsWith(a))return!0}return!1}(n)&&n.searchParams.has("client_id")&&n.searchParams.has("redirect_uri")){const t=n.searchParams.get("client_id"),a=f(new URL(n.searchParams.get("redirect_uri")));if("localhost"===a.hostname)return;const r=g(a.href);if(r&&t===r.oidcClientId){if(e.requestHeaders){const t=await async function(e){for(let t=0;t<e.length;t++){const a=e[t];if("Cookie"===a.name&&a.value){const e=a.value.split("; ");for(let t=0;t<e.length;t++){const a=e[t];if(a.startsWith("JSH=")){const e=a.substring(4).split("$"),t=await E([e[1]]),r=e[8];return!!t&&(await Oa(t,r),t)}}}}}(e.requestHeaders);if(t)r.loginEmail=t;else if(!1===t)return void h(a.href)}if(!r.loginEmail&&(n.searchParams.has("username")||n.searchParams.has("login_hint"))){const e=n.searchParams.get("username")??"",t=n.searchParams.get("login_hint")??"",o=await E([e,t]);if(!o&&(I.test(e)||I.test(t)))return void h(a.href);r.loginEmail=o}}}}catch(t){ua(t)}},inspectIncomingResponseDetails:async function(e){var t;try{const a=d(e.url);if(!a)return;const r=f(a).href;if(function(e){if(Ia(e))for(let t=0;t<Ea.length;t++){const a=Ea[t];if(e.pathname.endsWith(a))return!0}return!1}(a)&&e.responseHeaders&&a.searchParams.has("client_id")){const r=a.searchParams.get("client_id"),o=_(r);if(o)for(let a=0;a<e.responseHeaders.length;a++){const n=e.responseHeaders[a];if("Set-Cookie"===n.name&&(null==(t=n.value)?void 0:t.startsWith("JSH="))){const e=n.value.substring(4).split("$"),t=await E([e[1]]),a=e[8];if(t)o.loginEmail=t,await Oa(t,a);else try{const t=decodeURIComponent(e[1]);I.test(t)&&T(r)}catch{}}}}const o=g(r);if(o){if(a.searchParams.has("code")){if(a.searchParams.has("session_state")){const e=a.searchParams.get("session_state"),t=await xa(e,o.oidcClientId);if(t&&(o.loginEmail=await E([t]),I.test(t)&&!o.loginEmail))return void h(r)}else if(a.searchParams.has("client_info")){const{preferred_username:e=""}=y(a.searchParams.get("client_info"));if(o.loginEmail=await E([e]),I.test(e)&&!o.loginEmail)return void h(r)}o.loginEmail||(a.searchParams.set("code","REDACTED"),u("SOCIAL_LOGIN_EXPECTATION_ERROR",ma("Unable to extract email from OAuth `code` response"),{urlSearchParams:a.search}))}else if(a.searchParams.has("id_token")||a.hash.includes("id_token=")){const e=a.searchParams.get("id_token")||function(e){const t=e.hash.substring(1).split("&");for(let a=0;a<t.length;a++){const e=t[a];if(e.startsWith("id_token="))return e.substring(9)}}(a);if(e){const t=wa(e);if(t){const e=await E([t]);if(e)o.loginEmail=e;else{if(I.test(t))return void h(r);u("SOCIAL_LOGIN_EXPECTATION_ERROR",ma("Unable to extract email from OAuth `id_token` response"),{urlSearchParams:a.search,hash:a.hash})}}else u("SOCIAL_LOGIN_EXPECTATION_ERROR",ma("Unable to extract email from OAuth `id_token` response"),{urlSearchParams:a.search,hash:a.hash})}else u("SOCIAL_LOGIN_EXPECTATION_ERROR",ma("Unable to extract id_token from OAuth `id_token` response"),{urlSearchParams:a.search,hash:a.hash})}await A(o)}}catch(a){ua(a)}}};const Ra=Object.freeze(Object.defineProperty({__proto__:null,handleGoogleUserEmailMappingDetected:D,handleTabClosure:v,init:async function(){await Promise.all([b(),Aa()])},inspectIncomingResponseDetails:function(e){M.inspectIncomingResponseDetails(e),Ca.inspectIncomingResponseDetails(e)},inspectOutgoingRequestDetails:function(e){Ca.inspectOutgoingRequestDetails(e)},inspectOutgoingRequestHeaders:function(e){M.inspectOutgoingRequestHeaders(e),Ca.inspectOutgoingRequestHeaders(e)}},Symbol.toStringTag,{value:"Module"})),_a=G("DETECT_SOCIAL_LOGIN");async function Ta(e,t,a){a.href.startsWith("https://ogs.google.com/u/0/widget/app")&&await _a({platform:"GOOGLE_WORKSPACE",executionContext:"PAGE",world:"MAIN",scriptId:"login/social/GOOGLE_WORKSPACE/resolveUserIdEmailMapping"},e,t,a)}const ya={password:U,social:Ra},Pa=new Je,Sa={onMfaDetails:Pa.export},Na=[{platform:L.ADOBE,rule:"(?:account|www)\\.adobe\\.com/(?!devnet-docs|content)",regex:!0,scriptId:"mfa/ADOBE",executionContext:"BACKGROUND",rootFrameTriggerOnly:!0,delay_ms:5e3},{platform:L.ADOBE_ACROBAT,rule:"acrobat\\.adobe\\.com(?!/dcpreviewdropin|/proxy/pricing|/proxy/pdfverbs-web)",regex:!0,scriptId:"mfa/ADOBE/Acrobat",executionContext:"BACKGROUND",delay_ms:2e3,rootFrameTriggerOnly:!0},{platform:L.AIRTABLE,rule:"airtable\\.com(?!/(?:login|2fa))",regex:!0,scriptId:"mfa/AIRTABLE",executionContext:"PAGE",world:"MAIN"},{platform:L.APPLE,rule:"(?:mysupport|account)\\.apple\\.com",regex:!0,scriptId:"mfa/APPLE",executionContext:"BACKGROUND"},{platform:L.ASANA,rule:"app.asana.com/0/",regex:!1,scriptId:"mfa/ASANA",executionContext:"PAGE",world:"MAIN"},{platform:L.ATLASSIAN_CLOUD,rule:"(?:id\\.atlassian\\.com/login/authorize|home\\.atlassian\\.com)",regex:!0,scriptId:"mfa/ATLASSIAN_CLOUD",executionContext:"BACKGROUND"},{platform:L.AUTH0,rule:"manage.auth0.com",regex:!1,scriptId:"mfa/AUTH0",executionContext:"PAGE"},{platform:L.BAMBOOHR,rule:"(?!www|help|documentation\\.)[a-zA-Z0-9]+\\.bamboohr\\.com/(?!auth|anytime|careers|login|logged_out|multi_factor_authentication|.+/expired.php$)",regex:!0,scriptId:"mfa/BAMBOOHR",executionContext:"PAGE",world:"MAIN",rootFrameTriggerOnly:!0},{platform:L.BOX,rule:"app\\.box\\.com/(?!index\\.php|login|signup)",regex:!0,scriptId:"mfa/BOX",executionContext:"PAGE"},{platform:L.BITDEFENDER,rule:"cloudgz.gravityzone.bitdefender.com",regex:!1,scriptId:"mfa/BITDEFENDER",executionContext:"PAGE",world:"MAIN"},{platform:L.BITWARDEN,rule:"vault\\.bitwarden\\.(?:com|eu)",regex:!0,scriptId:"mfa/BITWARDEN",executionContext:"PAGE"},{platform:L.BUFFER,rule:"publish.buffer.com",regex:!1,scriptId:"mfa/BUFFER",executionContext:"PAGE"},{platform:L.CANVA,rule:"www\\.canva\\.com(?!.+/(?:login|signup))",regex:!0,scriptId:"mfa/CANVA",executionContext:"PAGE",world:"MAIN",short_retry_ms:3e5},{platform:L.CONTENTFUL,rule:"app.contentful.com/",regex:!1,scriptId:"mfa/CONTENTFUL",executionContext:"PAGE"},{platform:L.CLOUDFLARE,rule:"dash\\.cloudflare\\.com(?!/login|/sign-up|/forgot-password|/forgot-email)",regex:!0,scriptId:"mfa/CLOUDFLARE",executionContext:"PAGE",short_retry_ms:3e5},{platform:L.CODA,rule:"(?!community|help\\.)coda\\.io/(?!developers)",regex:!0,scriptId:"mfa/CODA",executionContext:"PAGE"},{platform:L.CRONOFY,rule:"app(?:-(?:uk|au|ca|de|sg))?\\.cronofy\\.com(?!/session/new|/session_mfa_otps)",regex:!0,scriptId:"mfa/CRONOFY",executionContext:"BACKGROUND"},{platform:L.CROWDSTRIKE_FALCON,rule:"falcon\\.[a-zA-Z0-9-]+\\.crowdstrike\\.com/(?!login|api2/saml/bind)",regex:!0,scriptId:"mfa/CROWDSTRIKE_FALCON",executionContext:"PAGE"},{platform:L.CUSTOMERIO,rule:"fly\\.customer\\.io/(?:workspaces|settings)",regex:!0,scriptId:"mfa/CUSTOMERIO",executionContext:"BACKGROUND"},{platform:L.DATADOG,rule:"(?:app|ap1|us3|us5)\\.datadoghq\\.(?:com|eu)/(?!signup|account)",regex:!0,scriptId:"mfa/DATADOG",executionContext:"PAGE"},{platform:L.DEEL,rule:"app\\.deel\\.com(?!/login|/signup)",regex:!0,scriptId:"mfa/DEEL",executionContext:"BACKGROUND"},{platform:L.DIGITALOCEAN,rule:"cloud\\.digitalocean\\.com/(?!login|registrations)",regex:!0,scriptId:"mfa/DIGITALOCEAN",executionContext:"PAGE"},{platform:L.DOCKER,rule:"(?:app|hub)\\.docker\\.com/(?!auth)",regex:!0,scriptId:"mfa/DOCKER",executionContext:"BACKGROUND"},{platform:L.DOCUSIGN,rule:"account\\.docusign\\.com/me(?!/login)",regex:!0,scriptId:"mfa/DOCUSIGN/Account",executionContext:"PAGE"},{platform:L.DOCUSIGN,rule:"admin\\.docusign\\.com/(?!auth|oauth|logout)",regex:!0,scriptId:"mfa/DOCUSIGN/Admin",executionContext:"BACKGROUND"},{platform:L.DOCUSIGN,rule:"apps\\.docusign\\.com/send/(?:home|documents|templates|prepare|reports)",regex:!0,scriptId:"mfa/DOCUSIGN",executionContext:"BACKGROUND"},{platform:L.DROPBOX,rule:"www\\.dropbox\\.com/(?:account|automations|deleted_files|h/?$|home|manage|photos|recents|share|signatures|starred|requests|backup|transfer)",regex:!0,scriptId:"mfa/DROPBOX",executionContext:"PAGE"},{platform:L.DROPBOX,rule:"www\\.dropbox\\.com/paper(?!/start)",regex:!0,scriptId:"mfa/DROPBOX/Paper",executionContext:"PAGE",short_retry_ms:3e5},{platform:L.DUO_SECURITY,rule:"(?:api-[A-Za-z0-9]+)\\.duosecurity\\.com",regex:!0,scriptId:"mfa/DUO_SECURITY",executionContext:"BACKGROUND",delay_ms:3e3},{platform:L.DUO_SECURITY,rule:"[a-zA-Z0-9]+\\.devicemanagement\\.duosecurity\\.com",regex:!0,scriptId:"mfa/DUO_SECURITY/DeviceManagement",executionContext:"BACKGROUND",delay_ms:1e3},{platform:L.ELASTICSEARCH,rule:"(?:cloud\\.elastic\\.co|.+?\\.elastic-cloud\\.com|.+?.elastic.cloud)(?!/login|/logout|/set-up-mfa)",regex:!0,scriptId:"mfa/ELASTICSEARCH",executionContext:"BACKGROUND"},{platform:L.FIGMA,rule:"www\\.figma\\.com/files?/",regex:!0,scriptId:"mfa/FIGMA",executionContext:"PAGE",world:"MAIN"},{platform:L.FRESHWORKS,rule:"[\\w-]+\\.myfreshworks\\.com(?!/login)",regex:!0,scriptId:"mfa/FRESHWORKS",executionContext:"BACKGROUND"},{platform:L.FRESHDESK,rule:"[\\w-]+\\.freshdesk\\.com/a/",regex:!0,scriptId:"mfa/FRESHWORKS/Freshdesk",executionContext:"BACKGROUND",delay_ms:1e3},{platform:L.GOOGLE_WORKSPACE,rule:"(?:admin|myaccount|calendar|docs|drive|mail|meet)\\.google\\.com",regex:!0,scriptId:"mfa/GOOGLE_WORKSPACE",executionContext:"BACKGROUND"},{platform:L.GOOGLE_WORKSPACE,rule:"accounts\\.google\\.com/signin/v2/challenge/(?:dp|ipp|ootp|sk|skotp|totp)",regex:!0,scriptId:"mfa/GOOGLE_WORKSPACE/MFAChallengePage",executionContext:"PAGE"},{platform:L.GOOGLE_WORKSPACE,rule:"accounts.google.com/signin/v2/challenge/selection",regex:!1,scriptId:"mfa/GOOGLE_WORKSPACE/MFASelectionPage",executionContext:"PAGE"},{platform:L.GITHUB,rule:"github\\.com/(?!login|signup)",regex:!0,scriptId:"mfa/GITHUB",executionContext:"PAGE"},{platform:L.GITLAB,rule:"gitlab\\.com/(?!users/sign_in)",regex:!0,scriptId:"mfa/GITLAB",executionContext:"PAGE"},{platform:L.GRAMMARLY,rule:"(?:account|app)\\.grammarly\\.com",regex:!0,scriptId:"mfa/GRAMMARLY",executionContext:"PAGE"},{platform:L.HOOTSUITE,rule:"hootsuite.com/dashboard",regex:!1,scriptId:"mfa/HOOTSUITE",executionContext:"PAGE",world:"MAIN"},{platform:L.HUBSPOT,rule:"app[a-zA-Z0-9-]*\\.hubspot\\.com/(?!conversations-visitor/)[a-zA-Z0-9-_]+/\\d+[\\/?]?",regex:!0,scriptId:"mfa/HUBSPOT",executionContext:"PAGE",delay_ms:1e3,strictPathCheckPostDelay:!0},{platform:L.INTERCOM,rule:"app.intercom.com/a/apps/",regex:!1,scriptId:"mfa/INTERCOM",executionContext:"PAGE"},{platform:L.INTUIT,rule:"(?:accounts|accounts-tax)\\.intuit\\.com(?!/app/sign-in)",regex:!0,scriptId:"mfa/INTUIT",executionContext:"PAGE",world:"MAIN"},{platform:L.INTUIT_QUICKBOOKS,rule:"qbo.intuit.com",regex:!1,scriptId:"mfa/INTUIT/QuickBooks",executionContext:"PAGE",world:"MAIN"},{platform:L.INTUIT_TURBOTAX,rule:"[\\w-]+\\.turbotaxonline\\.intuit\\.com",regex:!0,scriptId:"mfa/INTUIT/TurboTax",executionContext:"PAGE",world:"MAIN"},{platform:L.JAMF,rule:"(?:account|www)\\.jamf\\.com",regex:!0,scriptId:"mfa/JAMF",executionContext:"BACKGROUND"},{platform:L.JUMPCLOUD,rule:"console.jumpcloud.com/userconsole",regex:!1,scriptId:"mfa/JUMPCLOUD",executionContext:"PAGE"},{platform:L.JUMPCLOUD_ADMIN,rule:"console.jumpcloud.com",regex:!1,scriptId:"mfa/JUMPCLOUD/Admin",executionContext:"PAGE",delay_ms:2e3},{platform:L.LASTPASS,rule:"lastpass.com/vault",regex:!1,scriptId:"mfa/LASTPASS",executionContext:"PAGE",delay_ms:2e3,strictPathCheckPostDelay:!0,rootFrameTriggerOnly:!0},{platform:L.LINKEDIN,rule:"www\\.linkedin\\.com/(?:feed|mynetwork|jobs|messaging|notifications|mypreferences|in)",regex:!0,scriptId:"mfa/LINKEDIN",executionContext:"PAGE",short_retry_ms:3e5},{platform:L.MAILCHIMP,rule:"[a-zA-Z0-9-]+\\.admin\\.mailchimp\\.com(?!/login|/signup)",regex:!0,scriptId:"mfa/MAILCHIMP",executionContext:"BACKGROUND"},{platform:L.MERCURY,rule:"app\\.mercury\\.com/(?!login|logout|signup)",regex:!0,scriptId:"mfa/MERCURY",executionContext:"PAGE"},{platform:L.MIRO,rule:"miro.com/app",regex:!1,scriptId:"mfa/MIRO",executionContext:"PAGE"},{platform:L.MICROSOFT_365,rule:"(?:admin\\.microsoft|(?!www\\.office|substrate|whiteboard)[\\w-]+\\.(?:office|office365|sharepoint))\\.com(?!/owa/auth/logoff.aspx|.+/SignOut.aspx)",regex:!0,scriptId:"mfa/MICROSOFT_365",executionContext:"BACKGROUND",short_retry_ms:9e5,delay_ms:1e3,strictPathCheckPostDelay:!0,rootFrameTriggerOnly:!0},{platform:L.MICROSOFT_365,rule:"teams\\.microsoft\\.com/(?:_|v2)",regex:!0,scriptId:"mfa/MICROSOFT_365/Teams",executionContext:"BACKGROUND",delay_ms:1e4},{platform:L.MICROSOFT_365,rule:"login\\.microsoftonline\\.com/(?:common|organizations|[a-zA-Z0-9-]+)/login",regex:!0,scriptId:"mfa/MICROSOFT_365/ConvergedTFAPage",executionContext:"PAGE",world:"MAIN"},{platform:L.MIXPANEL,rule:"(?:eu\\.)?mixpanel\\.com/project/",regex:!0,scriptId:"mfa/MIXPANEL",executionContext:"PAGE"},{platform:L.MONDAYCOM,rule:"(?!support|forms|onedrive|dl|view|community|developer|elevate24)[a-zA-Z0-9_-]+\\.monday\\.com/(?!auth|users/signin)",regex:!0,scriptId:"mfa/MONDAY",executionContext:"PAGE"},{platform:L.MONGODB,rule:"cloud.mongodb.com",regex:!1,scriptId:"mfa/MONGODB",executionContext:"BACKGROUND"},{platform:L.MONGODB,rule:"www.mongodb.com/developer",regex:!1,scriptId:"mfa/MONGODB",executionContext:"BACKGROUND"},{platform:L.NOTION,rule:"www\\.notion\\.so(?!/(login|logout))",regex:!0,scriptId:"mfa/NOTION",executionContext:"PAGE"},{platform:L.OKTA,rule:"[a-zA-Z0-9_-]+(?<!www)\\.okta\\.com/(?:admin|enduser|app/(?![\\w/-]+/(?:sso/saml)))",regex:!0,scriptId:"mfa/OKTA",executionContext:"PAGE"},{platform:L.OPENAI,rule:"platform\\.openai\\.com(?!/loggedout|/auth)",regex:!0,scriptId:"mfa/OPENAI",executionContext:"PAGE"},{platform:L.OPENAI,rule:"chatgpt\\.com(?!/auth|/invite)",regex:!0,scriptId:"mfa/OPENAI/ChatGPT",executionContext:"PAGE",world:"MAIN",rootFrameTriggerOnly:!0},{platform:L.OTTER,rule:"otter\\.ai/(?!signin|signup|start-for-free|two-factor|password|$)",regex:!0,scriptId:"mfa/OTTER",executionContext:"PAGE"},{platform:L.PANDADOC,rule:"app\\.pandadoc\\.com(?!/login|/password-reset|/sso-login|/p/)",regex:!0,scriptId:"mfa/PANDADOC",executionContext:"BACKGROUND",delay_ms:1e3},{platform:L.PAYPAL,rule:"www\\.paypal\\.com/(?!authflow|auth|signin|workingcapital)",regex:!0,scriptId:"mfa/PAYPAL",executionContext:"PAGE"},{platform:L.PING_IDENTITY,rule:"apps\\.pingone\\.com/[a-zA-Z0-9-]+/myaccount",regex:!0,scriptId:"mfa/PING_IDENTITY",executionContext:"BACKGROUND"},{platform:L.POSTMAN,rule:"(?!learning)[\\w-]+\\.postman\\.(?:com|co)",regex:!0,scriptId:"mfa/POSTMAN",executionContext:"PAGE",world:"MAIN"},{platform:L.PULLEY,rule:"pulley\\.com/(?!user/(?:login|validate))",regex:!0,scriptId:"mfa/PULLEY",executionContext:"BACKGROUND"},{platform:L.PUSH_SECURITY,rule:"pushsecurity.com/app/",regex:!1,scriptId:"mfa/PUSH_SECURITY",executionContext:"PAGE"},{platform:L.RAMP,rule:"app\\.ramp\\.com/(?!sign-in|sign-out)",regex:!0,scriptId:"mfa/RAMP",executionContext:"BACKGROUND"},{platform:L.REACHDESK,rule:"app\\.reachdesk\\.com(?!/users/\\w)",regex:!0,scriptId:"mfa/REACHDESK",executionContext:"PAGE"},{platform:L.RETOOL,rule:"[a-zA-Z0-9-]+\\.retool\\.com(?:$|/(?!auth|signup|two-factor-challenge))",regex:!0,scriptId:"mfa/RETOOL",executionContext:"PAGE",world:"MAIN",delay_ms:1e3},{platform:L.RUNZERO,rule:"console\\.runzero\\.com(?!/settings|/login|/user/webauthn/login|/sso/login|/user/reset/request)",regex:!0,scriptId:"mfa/RUNZERO",executionContext:"PAGE",world:"MAIN"},{platform:L.RUNZERO,rule:"console.runzero.com/settings",regex:!1,scriptId:"mfa/RUNZERO/Settings",executionContext:"PAGE",world:"MAIN"},{platform:L.SALESFORCE,rule:"[\\w-]+(?:\\.develop)?\\.lightning\\.force\\.com/(?!(?:content|visualforce)/(?:rec)?session|email/htmlbody|secur/logout|sfc/servlet)",regex:!0,scriptId:"mfa/SALESFORCE",executionContext:"BACKGROUND"},{platform:L.SALESFORCE,rule:"[\\w-]+(?:\\.develop)?\\.my\\.salesforce\\.com/(?!_ui/identity|loginFlow|secur|jslibrary|img|.*\\.gif|visualforce/session|embeddedservice|_nc_external/identity).+",regex:!0,scriptId:"mfa/SALESFORCE/Classic",executionContext:"PAGE"},{platform:L.SAP_SYSTEMS,rule:"www\\.sap\\.com(?!/registration|/silent)",regex:!0,scriptId:"mfa/SAP",executionContext:"BACKGROUND"},{platform:L.SENTRY,rule:"sentry\\.io/(?:organizations|settings)",regex:!0,scriptId:"mfa/SENTRY",executionContext:"PAGE"},{platform:L.SENTRY,rule:"[\\w-]+\\.sentry\\.io/(?!auth)",regex:!0,scriptId:"mfa/SENTRY",executionContext:"PAGE"},{platform:L.SEGMENT,rule:"app\\.segment\\.com/(?!login)",regex:!0,scriptId:"mfa/SEGMENT",executionContext:"PAGE"},{platform:L.SERVICENOW,rule:"www\\.servicenow\\.com/(?!sso|content/dam/servicenow-assets)",regex:!0,scriptId:"mfa/SERVICENOW",executionContext:"PAGE",rootFrameTriggerOnly:!0,delay_ms:2e3},{platform:L.SERVICENOW,rule:"signon.service-now.com/sso",regex:!1,scriptId:"mfa/SERVICENOW/ManageMFA",world:"MAIN",executionContext:"PAGE"},{platform:L.SERVICENOW_TENANT,rule:"(?!signon|devd+)[\\w-]+\\.service-now\\.com/(?!navpage|logout_success|validate_multifactor_auth_code|x_snc_sso_auth|login|login_redirect|ui_page)",regex:!0,scriptId:"mfa/SERVICENOW/Tenant",world:"MAIN",executionContext:"PAGE"},{platform:L.SHAREFILE,rule:"(?!support|www|secure)[\\w-]+\\.sharefile\\.(?:eu|com)/(?!login|logout)",regex:!0,scriptId:"mfa/SHAREFILE",executionContext:"PAGE",world:"MAIN",delay_ms:2e3,strictPathCheckPostDelay:!0},{platform:L.SHORTCUT,rule:"app\\.shortcut\\.com/(?!login|[w-]+/login|recovery|signup)",regex:!0,scriptId:"mfa/SHORTCUT",executionContext:"PAGE"},{platform:L.SIMPLEMDM,rule:"a\\.simplemdm\\.com/admin/(?!auth)",regex:!0,scriptId:"mfa/SIMPLEMDM",executionContext:"PAGE"},{platform:L.SLACK,rule:"app.slack.com/client",regex:!1,scriptId:"mfa/SLACK",executionContext:"PAGE"},{platform:L.SLACK,rule:"[\\w-]+(?<!app|files)\\.slack\\.com/",regex:!0,scriptId:"mfa/SLACK/General",executionContext:"PAGE",world:"MAIN",delay_ms:2e3,strictPathCheckPostDelay:!0},{platform:L.SNOWFLAKE,rule:"app.snowflake.com",regex:!1,scriptId:"mfa/SNOWFLAKE",executionContext:"PAGE",world:"MAIN"},{platform:L.SOPHOS,rule:"(?:cloud|central)\\.sophos\\.com/(?!manage/self-service|idp|manage/central-login|manage/check-auth|manage/login|manage/partner)",regex:!0,scriptId:"mfa/SOPHOS",executionContext:"PAGE",world:"MAIN"},{platform:L.SOPHOS,rule:"(?:cloud|central)\\.sophos\\.com/manage/self-service",regex:!0,scriptId:"mfa/SOPHOS/SelfService",executionContext:"PAGE",world:"MAIN"},{platform:L.SQUARESPACE,rule:"(?:www|support|account|es|fr|de|pt|it|ja)\\.squarespace\\.com",regex:!0,scriptId:"mfa/SQUARESPACE",executionContext:"BACKGROUND"},{platform:L.STRIPE,rule:"dashboard\\.stripe\\.com/(?!login|register)",regex:!0,scriptId:"mfa/STRIPE",executionContext:"PAGE"},{platform:L.TODOIST,rule:"app.todoist.com/app/",regex:!1,scriptId:"mfa/TODOIST",executionContext:"PAGE",world:"MAIN"},{platform:L.TEAMVIEWER,rule:"login\\.teamviewer\\.com/(?!LogOn)",regex:!0,scriptId:"mfa/TEAMVIEWER",executionContext:"PAGE",world:"MAIN"},{platform:L.TWITTER,rule:"x\\.com",regex:!0,scriptId:"mfa/TWITTER",executionContext:"PAGE",world:"MAIN"},{platform:L.VIRUSTOTAL,rule:"www\\.virustotal\\.com/gui/(?!sign-in|logout|sso|join-us|graph-overview|intelligence-overview)",regex:!0,scriptId:"mfa/VIRUSTOTAL",executionContext:"PAGE"},{platform:L.WEBFLOW,rule:"webflow\\.com(?!/dashboard/(?:login|logout|signup))",regex:!0,scriptId:"mfa/WEBFLOW",executionContext:"BACKGROUND"},{platform:L.WEBFLOW,rule:"(?:developers|experts|university)\\.webflow\\.com",regex:!0,scriptId:"mfa/WEBFLOW",executionContext:"BACKGROUND"},{platform:L.WETRANSFER,rule:"wetransfer\\.com(?!/log-in|/explore)",regex:!0,scriptId:"mfa/WETRANSFER",executionContext:"BACKGROUND",delay_ms:1e3},{platform:L.WETRANSFER,rule:"(?:myaccount|collect|portals)\\.wetransfer\\.com",regex:!0,scriptId:"mfa/WETRANSFER",executionContext:"BACKGROUND",delay_ms:1e3},{platform:L.WISEDOTCOM,rule:"wise\\.com/(?!(?:[a-z]{2}/)?(?:login|register|onboarding|platform|business|pricing|help|send-money))",regex:!0,scriptId:"mfa/WISEDOTCOM",executionContext:"PAGE"},{platform:L.XERO,rule:"(?:go|my)\\.xero\\.com/",regex:!0,scriptId:"mfa/XERO",executionContext:"BACKGROUND"},{platform:L.XERO,rule:"identity.xero.com/account",regex:!1,scriptId:"mfa/XERO/Account",executionContext:"PAGE"},{platform:L.ZAPIER,rule:"zapier\\.com/app/(?!login)",regex:!0,scriptId:"mfa/ZAPIER",executionContext:"PAGE"},{platform:L.ZENDESK,rule:"[a-zA-Z0-9-]+\\.zendesk\\.com/(?:admin|agent)",regex:!0,scriptId:"mfa/ZENDESK",executionContext:"PAGE",world:"MAIN",short_retry_ms:3e5},{platform:L.ZOHO,rule:"(?!www|help|blog|community|marketplace)[a-zA-Z0-9-]+\\.(?:zoho|zohocloud)\\.(?:uk|com.au|com|eu|in|jp|ca|sa)(?!/signin|/showerrorpage)",regex:!0,scriptId:"mfa/ZOHO",executionContext:"BACKGROUND"},{platform:L.ZOOM,rule:"(?:[a-z0-9]+.)?zoom\\.us/(?:join|meeting(?!/register)|myhome|wb(?!/embed)|wc)/?",regex:!0,scriptId:"mfa/ZOOM",executionContext:"PAGE",world:"MAIN"},{platform:L.ZOOM,rule:"zoom\\.us/profile$",regex:!0,scriptId:"mfa/ZOOM/ProfilePage",executionContext:"PAGE",world:"MAIN"}];let ba;function Ma(e){var t;void 0===ba&&(ba=k(Na));for(const a of Na)if(a.regex){if(null==(t=a.compiledRegex)?void 0:t.test(e))return a}else if(a.rule&&e.includes(a.rule))return a}async function Da({tabId:e,frameId:t,frameUrl:a,message:r}){const o=await E([r.email]);void 0!==o&&(Pa.dispatch({tabId:e,frameId:t,frameUrl:a,platform:r.platform,emailAddress:o.emailAddress,mfaRegistered:r.mfaRegistered,mfaFactors:r.mfaFactors}),await F({emailAddress:o.emailAddress,platform:r.platform,currentUrl:a,mfaRegistered:r.mfaRegistered,mfaFactors:r.mfaFactors,logInClickedAt:r.lastLogin}))}const va=G("DETECT_MFA",Da);async function Ua(e,t,a){const r=Ma(f(a).href);r&&await va(r,e,t,a)}e.webNavigation.onCommitted.addListener((function(e){!async function(e,t){const a=d(t);a&&/https:\/\/chrome\.google\.com\/webstore\/devconsole\/(?!register)/.test(a.href)&&await Ba(e,0,a)}(e.tabId,e.url)}),{url:[{urlMatches:"^https://chrome.google.com/webstore/devconsole/*"}]});const Ga=[{platform:L.ADDEVENTCOM,rule:"app\\.addevent\\.com/(?!forgot-password|signin|signout|signup)",regex:!0,scriptId:"activity/ADDEVENTCOM",executionContext:"PAGE"},{platform:L.ADOBE,rule:"www\\.adobe\\.com/(?!devnet-docs|content)",regex:!0,scriptId:"activity/ADOBE",world:"MAIN",executionContext:"PAGE",rootFrameTriggerOnly:!0,delay_ms:5e3},{platform:L.ADOBE_ACROBAT,rule:"acrobat\\.adobe\\.com(?!/dcpreviewdropin|/proxy/pricing|/proxy/pdfverbs-web)",regex:!0,scriptId:"activity/ADOBE/Acrobat",world:"MAIN",executionContext:"PAGE",delay_ms:2e3,rootFrameTriggerOnly:!0},{platform:L.ANTHROPIC,rule:"console\\.anthropic\\.com(?!/login|/logout|/magic-link)",regex:!0,scriptId:"activity/ANTHROPIC",executionContext:"PAGE",delay_ms:2e3,strictPathCheckPostDelay:!0},{platform:L.APOLLO,rule:"app.apollo.io",regex:!1,scriptId:"activity/APOLLO",executionContext:"PAGE"},{platform:L.APPLE_DEVELOPER,rule:"appstoreconnect\\.apple\\.com/(?!login)",regex:!0,scriptId:"activity/APPLE_DEVELOPER",executionContext:"BACKGROUND"},{platform:L.APPLE_DEVELOPER,rule:"developer.apple.com/account",regex:!1,scriptId:"activity/APPLE_DEVELOPER/Account",executionContext:"BACKGROUND"},{platform:L.AWS,rule:"[a-z]{2}-[a-z]+-[0-9]+\\.console\\.aws\\.amazon\\.com",regex:!0,scriptId:"activity/AWS/ConsolePage",executionContext:"PAGE"},{platform:L.AWS,rule:"[a-z0-9-_]+\\.awsapps\\.com/start",regex:!0,scriptId:"activity/AWS/SSOLoginPage",executionContext:"PAGE",delay_ms:2e3},{platform:L.AZURE,rule:"portal.azure.com",regex:!1,scriptId:"activity/AZURE",executionContext:"PAGE",delay_ms:2e3},{platform:L.AZURE,rule:"adf\\.azure\\.com/[a-z]+/(?:authoring|datafactories|home|learn|management|monitoring)",regex:!0,scriptId:"activity/AZURE/DataFactories",executionContext:"PAGE",delay_ms:2e3},{platform:L.AZURE,rule:"dev\\.azure\\.com/[a-zA-Z0-9-]+",regex:!0,scriptId:"activity/AZURE/Devops",executionContext:"PAGE",delay_ms:2e3},{platform:L.AZURE,rule:"(?:app\\.vsaex|my)\\.visualstudio\\.com(?!/_signedin)",regex:!0,scriptId:"activity/AZURE/VisualStudio",executionContext:"PAGE",world:"MAIN",delay_ms:3e3},{platform:L.AZURE_VIRTUAL_DESKTOP,rule:"ai.azure.com",regex:!1,scriptId:"activity/AZURE_AI_STUDIO",executionContext:"PAGE",delay_ms:5e3},{platform:L.AZURE_VIRTUAL_DESKTOP,rule:"client.wvd.microsoft.com/arm/webclient",regex:!1,scriptId:"activity/AZURE_VIRTUAL_DESKTOP",executionContext:"PAGE",delay_ms:5e3},{platform:L.CALENDLY,rule:"calendly\\.com/(?:account|app/(?!login|signup)|event_types|integrations)",regex:!0,scriptId:"activity/CALENDLY",executionContext:"PAGE"},{platform:L.CRATEDB,rule:"console.cratedb.cloud",regex:!1,scriptId:"activity/CRATEDB",executionContext:"PAGE"},{platform:L.CRIBL_CLOUD,rule:"(?!login)[\\w-]+\\.cribl\\.cloud(?!/logout|/auth0|/callback)",regex:!0,scriptId:"activity/CRIBL_CLOUD",executionContext:"PAGE"},{platform:L.CHROME_WEB_STORE_DEVELOPER_DASHBOARD,rule:"chrome\\.google\\.com/webstore/devconsole/(?!register)",regex:!0,scriptId:"activity/CHROME_WEB_STORE",executionContext:"BACKGROUND"},{platform:L.DATADOG,rule:"app\\.ddog-gov\\.com/(?!signup|account)",regex:!0,scriptId:"activity/DATADOG",executionContext:"PAGE"},{platform:L.DOCUSIGN,rule:"apps\\.docusign\\.com/send/(?:home|documents|templates|prepare|reports)",regex:!0,scriptId:"activity/DOCUSIGN",executionContext:"PAGE"},{platform:L.DOCUSIGN,rule:"account\\.docusign\\.com/me(?!/login)",regex:!0,scriptId:"activity/DOCUSIGN/Account",executionContext:"PAGE"},{platform:L.DOCUSIGN,rule:"admin\\.docusign\\.com/(?!auth|oauth|logout)",regex:!0,scriptId:"activity/DOCUSIGN/Admin",executionContext:"BACKGROUND"},{platform:L.DUO_SECURITY,rule:"[a-zA-Z0-9-]+\\.sso\\.duosecurity\\.com/central",regex:!0,scriptId:"activity/DUO_SECURITY",executionContext:"PAGE"},{platform:L.FIREFOX_ADD_ONS_DEVELOPER_HUB,rule:"addons\\.mozilla\\.org/[a-zA-Z-]+/developers",regex:!0,scriptId:"activity/FIREFOX_DEVELOPER_HUB",executionContext:"PAGE"},{platform:L.GCP,rule:"console\\.cloud\\.google\\.com(?!/pangolin|/p/bscframe)",regex:!0,scriptId:"activity/GCP",executionContext:"PAGE",world:"MAIN"},{platform:L.GONGIO,rule:"[a-zA-Z0-9-]+\\.app\\.gong\\.io/",regex:!0,scriptId:"activity/GONGIO",executionContext:"PAGE",world:"MAIN"},{platform:L.GOOGLE_ADS,rule:"ads.google.com/aw",regex:!1,scriptId:"activity/GOOGLE_ADS",executionContext:"PAGE",world:"MAIN"},{platform:L.GOOGLE_ANALYTICS,rule:"analytics.google.com/analytics",regex:!1,scriptId:"activity/GOOGLE_ANALYTICS",executionContext:"PAGE",world:"MAIN",delay_ms:2e3},{platform:L.GOOGLE_CLOUD_COMMUNITIES,rule:"www.googlecloudcommunity.com/gc/",regex:!1,scriptId:"activity/GOOGLE_CLOUD_COMMUNITY",executionContext:"PAGE",world:"MAIN"},{platform:L.GOOGLE_GEMINI,rule:"gemini\\.google\\.com/(?:u/\\d+/)?app",regex:!0,scriptId:"activity/GOOGLE_GEMINI",executionContext:"PAGE",world:"MAIN",delay_ms:2e3,strictPathCheckPostDelay:!0},{platform:L.GOOGLE_TAG_MANAGER,rule:"tagmanager.google.com",regex:!1,scriptId:"activity/GOOGLE_TAG_MANAGER",executionContext:"PAGE",world:"MAIN"},{platform:L.GOOGLE_WORKSPACE,rule:"developer.android.com",regex:!1,scriptId:"activity/GOOGLE_WORKSPACE/Android",executionContext:"PAGE"},{platform:L.GRAFANA,rule:"[\\w-]+\\.grafana\\.net(?!/login)",regex:!0,scriptId:"activity/GRAFANA",executionContext:"PAGE"},{platform:L.HEX,rule:"app\\.hex\\.tech(?!/login|/signup)",regex:!0,scriptId:"activity/HEX",executionContext:"PAGE",world:"MAIN"},{platform:L.JIRA_CLOUD,rule:"[\\w-]+\\.atlassian\\.net/jira",regex:!0,scriptId:"activity/JIRA_CLOUD",executionContext:"PAGE"},{platform:L.KEEPER_SECURITY,rule:"(?:govcloud\\.)?keepersecurity\\.(?:com\\.au|eu|com|ca|jp|us)/vault",regex:!0,scriptId:"activity/KEEPER_SECURITY",executionContext:"PAGE"},{platform:L.KUDOBOARD,rule:"[a-zA-Z0-9-]+\\.kudoboard\\.com/(?:boards|account|admin)",regex:!0,scriptId:"activity/KUDOBOARD",executionContext:"PAGE",world:"MAIN"},{platform:L.LINEAR,rule:"linear\\.app/(?!login)",regex:!0,scriptId:"activity/LINEAR",executionContext:"PAGE"},{platform:L.LOOM,rule:"www\\.loom\\.com/(history|home|incentives|looms|notifications|profile|settings|share|spaces|watch-later)",regex:!0,scriptId:"activity/LOOM",executionContext:"PAGE",world:"MAIN"},{platform:L.LUCID,rule:"lucid\\.app(?!/(?:ac/confluence|users/login|pricing))",regex:!0,scriptId:"activity/LUCID",executionContext:"BACKGROUND"},{platform:L.MEDIUM,rule:"medium\\.com(?!/m/(?:signin|callback))",regex:!0,scriptId:"activity/MEDIUM",executionContext:"PAGE"},{platform:L.MICROSOFT_365,rule:"(?:(?:www|outlook)\\.office|www\\.microsoft365)\\.com/(?!logout|embed|launch/.+/officeunihost|.+/SignOut.aspx|mail/deeplink|mail/oobe)",regex:!0,scriptId:"activity/MICROSOFT_365",executionContext:"PAGE",delay_ms:2e3,rootFrameTriggerOnly:!0,world:"MAIN"},{platform:L.MICROSOFT_365,rule:"admin.cloud.microsoft",regex:!1,scriptId:"activity/MICROSOFT_365/AdminCloud",executionContext:"PAGE",delay_ms:2e3},{platform:L.MICROSOFT_365,rule:"appsource\\.microsoft\\.com/[a-z-]+",regex:!0,scriptId:"activity/MICROSOFT_365/AppSource",executionContext:"PAGE",delay_ms:2e3},{platform:L.MICROSOFT_365,rule:"azuremarketplace\\.microsoft\\.com/[a-z-]+",regex:!0,scriptId:"activity/MICROSOFT_365/AzureMarketplace",executionContext:"PAGE",delay_ms:2e3},{platform:L.MICROSOFT_365,rule:"entra.microsoft.com",regex:!1,scriptId:"activity/MICROSOFT_365/Entra",executionContext:"PAGE",delay_ms:2e3},{platform:L.MICROSOFT_365,rule:"forms\\.office\\.com(?!/logout|/oidcLogin)",regex:!0,scriptId:"activity/MICROSOFT_365/Forms",executionContext:"PAGE",world:"MAIN",delay_ms:2e3,rootFrameTriggerOnly:!0},{platform:L.MICROSOFT_365,rule:"intune.microsoft.com",regex:!1,scriptId:"activity/MICROSOFT_365/Intune",executionContext:"PAGE",delay_ms:2e3},{platform:L.MICROSOFT_365,rule:"(?:myapps|myapplications)\\.microsoft\\.com(?!/logout)",regex:!0,scriptId:"activity/MICROSOFT_365/MyApps",executionContext:"PAGE",delay_ms:5e3,strictPathCheckPostDelay:!0},{platform:L.MICROSOFT_365,rule:"[\\w-]+-my\\.sharepoint\\.com/(?!.+/guestaccess.aspx)",regex:!0,scriptId:"activity/MICROSOFT_365/Onedrive",executionContext:"PAGE",world:"MAIN",delay_ms:2e3,rootFrameTriggerOnly:!0},{platform:L.MICROSOFT_365,rule:"(?![\\w-]+-my)[\\w-]+\\.sharepoint\\.com/(?!.+/SignOut.aspx|.+/guestaccess.aspx)",regex:!0,scriptId:"activity/MICROSOFT_365/Sharepoint",executionContext:"PAGE",world:"MAIN",delay_ms:2e3},{platform:L.MICROSOFT_365,rule:"security\\.microsoft\\.com/.+",regex:!0,scriptId:"activity/MICROSOFT_365/Security",executionContext:"PAGE",world:"MAIN",delay_ms:2e3},{platform:L.MICROSOFT_365,rule:"support\\.microsoft\\.com/[a-z-]+",regex:!0,scriptId:"activity/MICROSOFT_365/Support",executionContext:"PAGE",delay_ms:2e3},{platform:L.MICROSOFT_365,rule:"techcommunity.microsoft.com",regex:!1,scriptId:"activity/MICROSOFT_365/TechCommunity",executionContext:"PAGE",world:"MAIN",delay_ms:5e3},{platform:L.MICROSOFT_365,rule:"windows365.microsoft.com",regex:!1,scriptId:"activity/MICROSOFT_365/Windows365",executionContext:"PAGE",delay_ms:5e3},{platform:L.MICROSOFT_COPILOT,rule:"copilot.microsoft.com",regex:!1,scriptId:"activity/MICROSOFT_COPILOT",executionContext:"PAGE"},{platform:L.MICROSOFT_WHITEBOARD,rule:"whiteboard.office.com",regex:!1,scriptId:"activity/MICROSOFT_WHITEBOARD",executionContext:"PAGE",delay_ms:1e4},{platform:L.NEWRELIC,rule:"one\\.(?:eu\\.)?newrelic\\.com/(?!login)",regex:!0,scriptId:"activity/NEWRELIC",executionContext:"PAGE",world:"MAIN"},{platform:L.NOTEBOOKLM,rule:"notebooklm.google.com",regex:!1,scriptId:"activity/NOTEBOOKLM",executionContext:"PAGE",world:"MAIN"},{platform:L.ONEPASSWORD,rule:"[a-zA-Z-]+\\.1password\\.com/(?!signin|support|sign-up)",regex:!0,scriptId:"activity/ONEPASSWORD",executionContext:"PAGE",delay_ms:1e3,strictPathCheckPostDelay:!0},{platform:L.PAGERDUTY,rule:"(?!app|identity|www|community|customerpdu|developer|support)[\\w-]+\\.(?:eu\\.)?pagerduty\\.com/(?!embedded_web_ui|sign_up|.*login|global/authn|oauth)",regex:!0,scriptId:"activity/PAGERDUTY",executionContext:"PAGE",world:"MAIN",rootFrameTriggerOnly:!0},{platform:L.PINECONE,rule:"app.pinecone.io",regex:!1,scriptId:"activity/PINECONE",executionContext:"PAGE",delay_ms:2e3,strictPathCheckPostDelay:!0},{platform:L.PING_IDENTITY,rule:"apps\\.pingone\\.com/[a-zA-Z0-9-]+/myapps",regex:!0,scriptId:"activity/PING_IDENTITY",executionContext:"BACKGROUND"},{platform:L.POWER_AUTOMATE,rule:"make.powerautomate.com",regex:!1,scriptId:"activity/POWER_AUTOMATE",executionContext:"PAGE",delay_ms:1e4,strictPathCheckPostDelay:!0,rootFrameTriggerOnly:!0},{platform:L.POWER_BI,rule:"app\\.powerbi\\.com(?!/reportEmbed|/singleSignOn|/signin|/ErrorPage|/view|/.+cvSandboxPack.cshtml)",regex:!0,scriptId:"activity/POWER_BI",executionContext:"PAGE",world:"MAIN",delay_ms:2e3,strictPathCheckPostDelay:!0,rootFrameTriggerOnly:!0},{platform:L.PRODUCTBOARD,rule:"(?!academy|app|portal|developer|info|www|roadmap|support|api|trust)[a-zA-Z0-9-]+\\.productboard\\.com/(?!users/(?:sign_in|sign_up))",regex:!0,scriptId:"activity/PRODUCTBOARD",executionContext:"PAGE",world:"MAIN"},{platform:L.PRODUCTPLAN,rule:"app\\.productplan\\.com/(?!users/(?:sign_in|sign_up))",regex:!0,scriptId:"activity/PRODUCTPLAN",executionContext:"PAGE",world:"MAIN"},{platform:L.SAGE,rule:"app\\.sbc\\.sage\\.com(?!/logout)",regex:!0,scriptId:"activity/SAGE/BusinessCloud",executionContext:"BACKGROUND",delay_ms:1e3,strictPathCheckPostDelay:!0,rootFrameTriggerOnly:!0},{platform:L.SAGE,rule:"\\w+\\.sage\\.hr(?!/signin)",regex:!0,scriptId:"activity/SAGE/Hr",executionContext:"PAGE",world:"MAIN"},{platform:L.SAGE,rule:"payroll.sageone.com",regex:!1,scriptId:"activity/SAGE/Payroll",executionContext:"PAGE",world:"MAIN"},{platform:L.SAP_ARIBA,rule:"portal.us.bn.cloud.ariba.com",regex:!1,scriptId:"activity/SAP_ARIBA",executionContext:"PAGE",delay_ms:2e3,strictPathCheckPostDelay:!0},{platform:L.SLIDO,rule:"admin\\.sli\\.do(?!/oauth-callback)",regex:!0,scriptId:"activity/SLIDO",executionContext:"PAGE",delay_ms:1e3},{platform:L.SMART_PENSION,rule:"(?!id\\.)[a-zA-Z0-9-_]+\\.autoenrolment\\.co\\.uk",regex:!0,scriptId:"activity/SMART_PENSION",executionContext:"PAGE",world:"MAIN",delay_ms:1e3},{platform:L.SMARTSHEET,rule:"app\\.smartsheet\\.(?:com|eu)/(?!b/(?:azure|blank|form/[a-z0-9]+|orgsso|publish|signup))",regex:!0,scriptId:"activity/SMARTSHEET",executionContext:"BACKGROUND",delay_ms:2e3},{platform:L.SMARTSHEET,rule:"workapps\\.smartsheet\\.(?:com|eu)/(?!apps/logout)",regex:!0,scriptId:"activity/SMARTSHEET/Workapps",executionContext:"PAGE",world:"MAIN"},{platform:L.SNYK,rule:"app.snyk.io(?!/login)",regex:!0,scriptId:"activity/SNYK",executionContext:"PAGE"},{platform:L.SPLUNK_CLOUD,rule:"[\\w-]+\\.splunkcloud\\.com/(?!.+login|.+logout)",regex:!0,scriptId:"activity/SPLUNK_CLOUD",executionContext:"PAGE",world:"MAIN"},{platform:L.TABLEAU,rule:"(?!sso)[\\w-]+\\.online\\.tableau\\.com/(?!vizportal/api/saml/login)",regex:!0,scriptId:"activity/TABLEAU",executionContext:"PAGE"},{platform:L.TAILSCALE,rule:"login.tailscale.com/welcome",regex:!1,scriptId:"activity/TAILSCALE",executionContext:"PAGE"},{platform:L.TAILSCALE,rule:"login.tailscale.com/admin",regex:!1,scriptId:"activity/TAILSCALE/Admin",executionContext:"PAGE"},{platform:L.TINES,rule:"[a-zA-Z0-9-]+(?<!www|login)\\.tines\\.com(?!/sso_signed_out)",regex:!0,scriptId:"activity/TINES",executionContext:"PAGE"},{platform:L.TRELLO,rule:"trello.com",regex:!1,scriptId:"activity/TRELLO",executionContext:"PAGE"},{platform:L.VISUAL_STUDIO_APP_CENTER,rule:"appcenter\\.ms/(?:apps|users)",regex:!0,scriptId:"activity/VISUAL_STUDIO_APP_CENTER",executionContext:"PAGE",world:"MAIN",delay_ms:5e3},{platform:L.VISUAL_STUDIO_MARKETPLACE,rule:"marketplace.visualstudio.com",regex:!1,scriptId:"activity/VISUAL_STUDIO_MARKETPLACE",executionContext:"PAGE",world:"MAIN",delay_ms:3e3}];let La;async function Fa({frameUrl:e,message:t}){const a=await E([t.email]);void 0!==a&&await B({email:a,platform:t.platform,currentUrl:e})}const ka=G("DETECT_ACTIVITY",(({frameUrl:e,message:t})=>Fa({frameUrl:e,message:t})));async function Ba(e,t,a){const r=function(e){var t;void 0===La&&(La=k(Ga));for(const a of Ga)if(a.regex){if(null==(t=a.compiledRegex)?void 0:t.test(e))return a}else if(a.rule&&e.includes(a.rule))return a}(f(a).href);r&&await ka(r,e,t,a)}const Wa=new Map;const Ha=new Map;function $a(e){return Ha.get(e)}function Ka(e){return Ha.set(e.integrationId,e),e}async function za(e,t){const a=await W(e);if(a&&l(a))return H({target:{tabId:e,frameIds:[t]},func:()=>document.referrer||void 0})}async function ja(e,t){var a;!function(e){const t=Ha.get(e);Ha.delete(e)}(e.integrationId),"DISCARDED"!==t&&"UNKNOWN"!==t&&await $({platform:e.platform,clientId:e.clientId,responseType:e.responseType,redirectUri:e.redirectUrl,scopes:null==(a=e.scope)?void 0:a.split(/[ +]/),tenant:e.tenant,referrer:e.referrerUrl,outcome:t})}const Ya=S("INTEGRATION_MONITOR","GOOGLE_WORKSPACE"),qa=["https://accounts.google"],Va=["/_/signin/oauth","/signin/oauth/consent","/signin/oauth/consent/approval","/signin/oauth/error"];function Za(e){return function(e){return qa.some((t=>e.origin.startsWith(t)))}(e)&&Va.some((t=>e.pathname.startsWith(t)))}const Xa={inspectOutgoingRequestDetails:async function(e){try{const{tabId:t,url:a,method:r,requestBody:o,frameId:n}=e,i=new URL(a);if(Za(i)){if(i.pathname.endsWith("/signin/oauth")&&"POST"===r&&o&&o.formData)Ka({tabId:t,platform:"GOOGLE_WORKSPACE",integrationId:`GOOGLE_WORKSPACE:${t}`,confirmed:!0,clientId:o.formData.client_id[0],responseType:o.formData.response_type[0],redirectUrl:o.formData.redirect_uri[0],scope:o.formData.scope[0],referrerUrl:await za(t,n)??void 0});else if(i.pathname.endsWith("/consent/approval")&&"POST"===r&&o&&o.formData){const e=$a(`GOOGLE_WORKSPACE:${t}`);if(e){const t=JSON.parse(o.formData["f.req"][0]);1===t[0]?await ja(e,"ALLOWED"):0===t[0]&&await ja(e,"ABANDONED")}}else if(i.pathname.endsWith("/error")){const e=$a(`GOOGLE_WORKSPACE:${t}`);if(e){const t=i.searchParams.get("authError");t&&"admin_policy_enforced"===function(e){let t=0;const a=atob(e),r=a.charCodeAt(t++),o=r>>3,n=7&r;if(1!==o||2!==n)throw new Error(`Expected field number "1" to be wire type "2". Got field number "${o}" and wire type "${n}".`);const i=a.charCodeAt(t++);return a.substring(2,2+i)}(t)?await ja(e,"DENIED"):await ja(e,"ERROR")}}}else{const e=$a(`GOOGLE_WORKSPACE:${t}`);e&&i.href.startsWith(e.redirectUrl)&&await ja(e,"DISCARDED")}}catch(t){Ya(t)}},inspectIncomingResponseDetails:async function(e){try{const{tabId:t,url:a,statusCode:r,frameId:o}=e,n=$a(`GOOGLE_WORKSPACE:${t}`),i=new URL(a);if(n&&Za(i)&&i.pathname.endsWith("/consent")&&200===r){const e=await W(t);if(e&&l(e)){await H({target:{tabId:t,frameIds:[o]},func:()=>document.title})||await ja(n,"DISCARDED")}else await ja(n,"DISCARDED")}}catch(t){Ya(t)}},handleNavigationStart:async function(e){try{const{tabId:t,url:a}=e,r=$a(`GOOGLE_WORKSPACE:${t}`),o=new URL(a);r&&!Za(o)&&await ja(r,"ABANDONED")}catch(t){Ya(t)}},handleTabClosure:async function(e){try{const t=$a(`GOOGLE_WORKSPACE:${e}`);t&&await ja(t,"ABANDONED")}catch(t){Ya(t)}}},Ja=S("INTEGRATION_MONITOR","MICROSOFT_365"),Qa=["https://login.microsoftonline.com","https://login.live.com"],er=[/[a-z0-9-]+\/oauth2\/v2\.0\/authorize$/i,/[a-z0-9-]+\/(?:v2.0\/)?adminConsent$/i,/[a-z0-9-]+\/Consent\/Set$/i,/[a-z0-9-]+\/reprocess$/i],tr=[50105,90094,90095,7000112],ar=/^\/((?!common|organizations)[a-z0-9-]+)\/oauth2\//;function rr(e){return Qa.some((t=>e.origin.includes(t)))}function or(e){return rr(e)&&er.some((t=>t.test(e.pathname)))}const nr={inspectOutgoingRequestDetails:async function(e){var t;try{const{tabId:a,url:r,method:o,requestBody:n,frameId:i}=e,s=new URL(r);if(or(s)){if(s.pathname.endsWith("/authorize")&&"GET"===o&&s.searchParams.has("client_id")&&s.searchParams.has("response_type")&&s.searchParams.has("redirect_uri")&&s.searchParams.has("scope"))Ka({tabId:a,platform:"MICROSOFT_365",integrationId:`MICROSOFT_365:${a}`,confirmed:!1,clientId:s.searchParams.get("client_id"),responseType:s.searchParams.get("response_type"),redirectUrl:s.searchParams.get("redirect_uri"),scope:s.searchParams.get("scope"),tenant:null==(t=s.pathname.match(ar))?void 0:t[1],referrerUrl:await za(a,i)??void 0});else if(s.pathname.endsWith("/Consent/Set")&&"POST"===o&&n&&n.formData){const e=$a(`MICROSOFT_365:${a}`);if(e){"true"===n.formData.acceptConsent[0]?await ja(e,"ALLOWED"):await ja(e,"ABANDONED")}}}else{const e=$a(`MICROSOFT_365:${a}`);e&&s.href.startsWith(e.redirectUrl)&&await ja(e,"DISCARDED")}}catch(a){Ja(a)}},inspectIncomingResponseDetails:async function(e){try{const{tabId:t,url:a,statusCode:r,frameId:o}=e,n=$a(`MICROSOFT_365:${t}`),i=new URL(a);if(n&&or(i))if(i.pathname.endsWith("/authorize"))302===r&&await ja(n,"DISCARDED");else if(i.pathname.endsWith("/reprocess")){const e=await W(t);if(e&&l(e)){const e=await H({target:{tabId:t,frameIds:[o]},isWorldMain:!0,func:()=>{const{$Config:e}=window.wrappedJSObject||window;return{pageId:e.pgid,errorCode:e.iErrorCode}}});e&&"ConvergedError"===e.pageId&&(tr.includes(e.errorCode)?await ja(n,"DENIED"):await ja(n,"ERROR"))}else await ja(n,"DISCARDED")}}catch(t){Ja(t)}},handleNavigationStart:async function(e){try{const{tabId:t,url:a}=e,r=$a(`MICROSOFT_365:${t}`),o=new URL(a);r&&!rr(o)&&await ja(r,r.confirmed?"ABANDONED":"DISCARDED")}catch(t){Ja(t)}},handleTabClosure:async function(e){try{const t=$a(`MICROSOFT_365:${e}`);t&&await ja(t,"ABANDONED")}catch(t){Ja(t)}}};function ir({tabId:e,message:t}){if("MICROSOFT_365"===t.platform)!function(e){const t=$a(`MICROSOFT_365:${e}`);t&&(t.confirmed=!0)}(e)}const sr={inspectOutgoingRequestDetails:function(e){Xa.inspectOutgoingRequestDetails(e),nr.inspectOutgoingRequestDetails(e)},inspectIncomingResponseDetails:function(e){Xa.inspectIncomingResponseDetails(e),nr.inspectIncomingResponseDetails(e)},handleNavigationStart:function(e){Xa.handleNavigationStart(e),nr.handleNavigationStart(e)},handleTabClosure:function(e){Xa.handleTabClosure(e),nr.handleTabClosure(e)}};async function cr(e){return await s((async()=>{const t=await W(e);return t&&"complete"===t.status&&l(t)}))}const lr=G("APP_BANNER");async function mr(t,a){const r=await Ve("appBannerThrottleMap"),o=t.toString(),n=r.map.get(o)||[];n.includes(a)||(n.push(a),r.map.has(o)||r.map.set(o,n),await Xe(r),await e.alarms.get("appBannerThrottleMapCleanup")||e.alarms.create("appBannerThrottleMapCleanup",{periodInMinutes:5}))}async function ur({tabId:t,frameId:a,frameUrl:o,appBanner:n,platform:i,platformType:s,isPreview:c=!1}){await r(t,a,"AppBanner"),"INFORM"!==n.mode&&await lr({scriptId:"AppBanner/scripts/hideGoogleOneTap",executionContext:"PAGE",world:"MAIN"},t,a,o),await e.tabs.sendMessage(t,{id:"SHOW_APP_BANNER",banner:n,platform:i,platformType:s,isPreview:c}),"INFORM"===n.mode&&await mr(t,i)}async function pr(e,t,a){const r=await async function(e){const t=await tt();if(t)for(const a in t)if(new RegExp(a.replaceAll(".","\\.").replaceAll("*",".*")).test(e.href))return{banner:t[a],key:a}}(a);let o,n=null==r?void 0:r.banner;if(!n){if(o=await j(a),!o)return;n=await et(o)??await et("NOT_REVIEWED")}if((!n||n.title)&&n){if(await async function(e,t){const a=await Ve("appBannerThrottleMap"),r=e.toString();return(a.map.get(r)||[]).includes(t)}(e,(null==r?void 0:r.key)||o))return;await ur({tabId:e,frameId:t,frameUrl:a,appBanner:n,platformType:(null==r?void 0:r.key)?"URL":"ID",platform:(null==r?void 0:r.key)||o})}}function dr(e){return e.toString(2).padStart(8,"0")}function fr(e){const t=e.split(".");let a=dr(Number.parseInt(t[0]));for(let r=1;r<t.length;++r)a+=`.${dr(Number.parseInt(t[r]))}`;return a}function gr(e,t){const[a,r]=e.split("/"),o=fr(a),n=fr(t),i=Number.parseInt(r,10),s=o.substring(0,i);return n.substring(0,i)===s}function Er(e){if("localhost"===e.hostname)return!0;const t=e.hostname;return!!Y.test(t)&&("127.0.0.1"===t||"0.0.0.0"===t||(gr("10.0.0.0/8",t)||gr("172.16.0.0/12",t)||gr("192.168.0.0/16",t)))}async function Ir(e){const t=await Ze();for(const a of t)if(e.host.includes(a))return!0;return!1}async function hr(t,a){await q(t,5e3,200),await e.tabs.sendMessage(t,a)}async function Ar(t,r){await s((async()=>{await e.tabs.update(t,{active:!0,...r}).catch(a);const o=await W(t);return null==o?void 0:o.active}))||u("UPDATE_TAB_ERROR","Could not update tab",{tabId:t,updateProperties:JSON.stringify(r)})}function Or(e){if(!e.hostname.includes("."))return!0;return/(?:localhost|\.(?:anaconda|badger|bat|challah|ftw|inc|internal|local|otter|private|region|sigma|sophos|snake|test|tiger|tron))$/.test(e.hostname)}Qe.onPropertyChanged.addListener((async t=>{"appBanner"!==t&&"appBannerUrls"!==t||await async function(){const t=await Ve("appBannerThrottleMap");t.map.clear(),await Xe(t),e.alarms.clear("appBannerThrottleMapCleanup")}()})),e.alarms.onAlarm.addListener((async({name:t})=>{if("appBannerThrottleMapCleanup"===t)await async function(){const t=await Ve("appBannerThrottleMap");for(const e of t.map.keys()){const a=Number.parseInt(e,10);void 0===await W(a)&&t.map.delete(e)}await Xe(t),0===t.map.size&&e.alarms.clear("appBannerThrottleMapCleanup")}()}));const xr=new Set(["DUO_SECURITY","GOOGLE_WORKSPACE","JUMPCLOUD","JUMPCLOUD_ADMIN","MICROSOFT_365","MICROSOFT_TEAMS","OKTA","PING_IDENTITY","DEMO_IDP"]),wr=new Map(Object.entries({duosecurity:L.DUO_SECURITY,google:L.GOOGLE_WORKSPACE,jumpcloud:L.JUMPCLOUD,azure:L.MICROSOFT_365,live:L.MICROSOFT_365,microsoft:L.MICROSOFT_365,microsoftonline:L.MICROSOFT_365,okta:L.OKTA,pingone:L.PING_IDENTITY,pingidentity:L.PING_IDENTITY,pushdemos:L.DEMO_IDP})),Cr=new Map(Object.entries({pushdemos:["evilginx","evilnovnc","sso-phishing"]}));function Rr(e,t){const a=Cr.get(e);if(a)for(const r of a)if(t.includes(r))return!0;return!1}const _r=re((async function({tabId:t,frameId:a,frameUrl:r,username:o,platform:n,mode:i}){if(await oe()){if("MONITOR"===i){const a=t.toString(),o=`${r.hostname}:${n}`,i=await Ve("phishingThrottleMap"),s=i.map.get(a)||[];if(s.includes(o))return;s.push(o),i.map.has(a)||i.map.set(a,s),await Xe(i),await e.alarms.get("phishingThrottleMapCleanup")||e.alarms.create("phishingThrottleMapCleanup",{periodInMinutes:5})}const s=await H({target:{tabId:t,frameIds:[a]},func:()=>document.referrer}),c=s?V(s):void 0;if("BLOCK"===i||"WARN"===i){const a=new URL(e.runtime.getURL("dist/phishingBlock/index.html")),i=`${r.origin}${r.pathname}`;await Ar(t,{url:a.href}),await hr(t,{id:"PHISHING_BLOCK_PAGE_ARGS",platform:n,url:i,email:o,referrerUrl:c})}J({action:"DISPLAYED",email:o,mode:i,platformType:n,referrerUrl:c,url:V(r)})}}),200);async function Tr({tabId:e,frameId:t,frameUrl:a,message:r}){const o=await at();if("OFF"===o.mode)return;if(!r.isPasswordInputVisible)return;if(Er(a)||Or(a)||await Ir(a)||await async function(e){const t=(await at()).ignored_domains||[];for(const a of t)if(e.host.includes(a.replace(/^\*\./,".")))return!0;return!1}(a)||await async function(e,t){const a=(await Ve("tempPhishingBlockIgnoreMap")).map.get(e.toString())||[],r=Z(t.hostname);return r.type===X.Listed&&r.domain?a.includes(r.domain):a.includes(t.hostname)}(e,a)||o.ignore_work_apps&&await async function(e){const{platformDomains:t}=await ae(),a=Z(e.hostname);if(a.type===X.Listed&&a.domain){if(Rr(a.domain,a.subDomains))return!1;const{domain:e,topLevelDomains:r}=a;return void 0!==t[`${e}.${r.join(".")}`]}return!1}(a)||void 0===V(a))return;const n=await async function(e){const t=await ee.getSalt(),a=await ee.getTeamSalt(),r=new ee(t,e,a),o=await Ze(),n=await te();for(const i of n.map.values())if(xr.has(i.platform)&&o.includes(i.username.split("@")[1])){if(i.fingerprintV2&&i.fingerprintV2===r.fingerprintV2)return i;if(i.fingerprint===r.fingerprint)return i}}(r.password);n&&!function(e,t){const a=Z(e.hostname);return!(a.type!==X.Listed||!a.domain||Rr(a.domain,a.subDomains)||wr.get(a.domain)!==t)}(a,n.platform)&&_r({tabId:e,frameId:t,frameUrl:a,username:n.username,platform:n.platform,mode:o.mode})}Qe.onPropertyChanged.addListener((async t=>{"phishing"===t&&await async function(){const t=await Ve("phishingThrottleMap");t.map.clear(),await Xe(t),e.alarms.clear("phishingThrottleMapCleanup")}()})),e.alarms.onAlarm.addListener((async({name:t})=>{switch(t){case"tempPhishingBlockIgnoreMapCleanup":await async function(){const t=await Ve("tempPhishingBlockIgnoreMap");for(const e of t.map.keys()){const a=Number.parseInt(e,10);void 0===await W(a)&&t.map.delete(e)}await Xe(t),0===t.map.size&&e.alarms.clear("tempPhishingBlockIgnoreMapCleanup")}();break;case"phishingThrottleMapCleanup":await async function(){const t=await Ve("phishingThrottleMap");for(const e of t.map.keys()){const a=Number.parseInt(e,10);void 0===await W(a)&&t.map.delete(e)}await Xe(t),0===t.map.size&&e.alarms.clear("phishingThrottleMapCleanup")}()}}));const yr=S("DETECT_PHISHING_TOOLS");async function Pr(e,t){const a=await H({target:{tabId:e,frameIds:[t]},func:()=>({url:window.location.href,referrerUrl:document.referrer||void 0})});if(!a)throw new Error("Failed to get page URL and referrer");const r=d(a.url);if(!r)throw new Error(`Failed to parse URL: ${a.url}`);return{url:r,referrerUrl:d(a.referrerUrl)}}async function Sr(e){!async function({tabId:e,frameId:t,url:a,statusCode:r}){try{if(200===r&&a.endsWith("core/rfb.js")){const r=await fetch(a).then((e=>e.text())).catch((()=>{}));if(null==r?void 0:r.includes("class RFB")){const{url:a,referrerUrl:r}=await Pr(e,t);await Dr({tabId:e,url:a,referrerUrl:r,indicator:"BITM_TOOL_NOVNC_03"})}}}catch(o){yr(o)}}(e)}function Nr(e){!async function({responseHeaders:e,tabId:t,frameId:a}){try{if(e&&e.filter((e=>"If-Range"===e.name||"X-If-Range"===e.name||"X-If-Landing-Redirect"===e.name||"X-Whatveryouwant-Header"===e.name||"X-Whatveryouwant-Landing-Header"===e.name)).length>0){const{url:e,referrerUrl:r}=await Pr(t,a);await Dr({tabId:t,url:e,referrerUrl:r,indicator:"AITM_TOOL_MURAENA_01"})}}catch(r){yr(r)}}(e),async function(e){var t;try{let a=!1;if(e.responseHeaders)for(let r=0;r<e.responseHeaders.length;++r){const o=e.responseHeaders[r];if("set-cookie"===o.name.toLowerCase()&&(null==(t=o.value)?void 0:t.includes("Expires=Wed, 30 Aug 2029 00:00:00 GMT"))){a=!0;break}}if(a){const{url:t,referrerUrl:a}=await Pr(e.tabId,e.frameId);await Dr({tabId:e.tabId,url:t,referrerUrl:a,indicator:"AITM_TOOL_MURAENA_02"})}}catch(a){yr(a)}}(e)}function br(e){!async function(e){var t;try{let a=!1;if(e.responseHeaders)for(let r=0;r<e.responseHeaders.length;++r){const o=e.responseHeaders[r];if("set-cookie"===o.name.toLowerCase()&&(null==(t=o.value)?void 0:t.includes("Expires=Sat, 26-Oct-2025 18:54:56 GMT"))){a=!0;break}}if(a){const{url:t,referrerUrl:a}=await Pr(e.tabId,e.frameId).catch((()=>{const t=d(e.url);if(!t)throw new Error(`Failed to parse URL: ${e.url}`);return{url:t,referrerUrl:d(e.initiator||e.originUrl)}}));await Dr({tabId:e.tabId,url:t,referrerUrl:a,indicator:"AITM_TOOL_MODLISHKA_02"})}}catch(a){yr(a)}}(e)}const Mr=["aihr.com","augmend.com","browser.lol","hackthebox.com","htb-cloud.com","joesandbox.com","joesecurity.org","mpanel.io","novnc.com","ovh.net","quran.com","sqrx.com","tryhackme.tech","urlquery.net","vmray.com"];async function Dr({tabId:t,url:a,referrerUrl:r,indicator:o}){const{mode:n}=await rt();if(!("OFF"===n||Er(a)||Or(a)||await async function(e){const t=(await rt()).ignored_domains||[];for(let a=0;a<t.length;a++){const r=t[a];if(e.host.includes(r.replace(/^\*\./,".")))return!0}for(let a=0;a<Mr.length;a++){const t=Mr[a];if(e.host.includes(t))return!0}return!1}(a)||await Ir(a)||void 0===V(a))){if("MONITOR"===n){const r=t.toString(),n=`${a.hostname}:${o}`,i=await Ve("detectionThrottleMap"),s=i.map.get(r)||[];if(s.includes(n))return;s.push(n),i.map.has(r)||i.map.set(r,s),await Xe(i),await e.alarms.get("detectionThrottleMapCleanup")||e.alarms.create("detectionThrottleMapCleanup",{periodInMinutes:5})}if("BLOCK"===n||"WARN"===n){if("WARN"===n){const e=(await Ve("tempPhishingToolsBlockIgnoreMap")).map.get(t.toString())||[],r=Z(a.hostname);if(r.type===X.Listed&&r.domain&&e.includes(r.domain)||e.includes(a.hostname))return}const i=e.runtime.getURL("dist/phishingToolsBlock/index.html");await Ar(t,{url:i}),await hr(t,{id:"PHISHING_TOOLS_BLOCK_PAGE_ARGS",url:`${a.origin}${a.pathname}`,indicator:o,referrerUrl:null==r?void 0:r.href})}ne({action:"DISPLAYED",mode:n,url:a,referrerUrl:r,indicator:o})}}async function vr(){const{mode:t}=await rt();"OFF"!==t&&(e.webRequest.onHeadersReceived.addListener(br,{urls:["http://*/*","https://*/*"],types:["main_frame","sub_frame","xmlhttprequest"]},["responseHeaders"]),e.webRequest.onHeadersReceived.addListener(Nr,{urls:["http://*/*","https://*/*"],types:["main_frame","sub_frame","xmlhttprequest"]},["responseHeaders"]),e.webRequest.onCompleted.addListener(Sr,{urls:["http://*/*","https://*/*"],types:["script"]}))}function Ur(){e.webRequest.onHeadersReceived.removeListener(br),e.webRequest.onHeadersReceived.removeListener(Nr),e.webRequest.onCompleted.removeListener(Sr)}function Gr(e,t){if(t.length<e.length)return!1;for(let a=0;a<=t.length-e.length;++a)if(t[a]===e[0]){let r=!0;for(let o=1;o<e.length;++o)if(t[a+o]!==e[o]){r=!1;break}if(r)return!0}return!1}function Lr(e,t){let a=0;return function(...r){return new Promise(((o,n)=>{Date.now()-a>=t&&(a=Date.now(),Promise.resolve(e.apply(this,r)).then(o).catch(n))}))}}Qe.onPropertyChanged.addListener((async(t,a,r)=>{var o,n,i,s;"phishing_tool_detection"===t&&(await async function(){const t=await Ve("detectionThrottleMap");t.map.clear(),await Xe(t),e.alarms.clear("detectionThrottleMapCleanup")}(),(null==(o=a.phishing_tool_detection)?void 0:o.mode)!==(null==(n=r.phishing_tool_detection)?void 0:n.mode)&&("OFF"===(null==(i=r.phishing_tool_detection)?void 0:i.mode)?vr():"OFF"===(null==(s=a.phishing_tool_detection)?void 0:s.mode)&&Ur()))})),e.alarms.onAlarm.addListener((async({name:t})=>{switch(t){case"detectionThrottleMapCleanup":await async function(){const t=await Ve("detectionThrottleMap");for(const e of t.map.keys()){const a=Number.parseInt(e,10);void 0===await W(a)&&t.map.delete(e)}await Xe(t),0===t.map.size&&e.alarms.clear("detectionThrottleMapCleanup")}();break;case"tempPhishingToolsBlockIgnoreMapCleanup":await async function(){const t=await Ve("tempPhishingToolsBlockIgnoreMap");for(const e of t.map.keys()){const a=Number.parseInt(e,10);void 0===await W(a)&&t.map.delete(e)}await Xe(t),0===t.map.size&&e.alarms.clear("tempPhishingToolsBlockIgnoreMapCleanup")}()}}));const Fr=S("DETECT_CLONED_LOGIN_PAGES"),kr="clonedLoginPageThrottleMapCleanup",Br=new Set(["AWS","DUO_SECURITY","GITHUB","GOOGLE_WORKSPACE","IBM","JUMPCLOUD","MICROSOFT_365","OKTA","PING_IDENTITY","SAP_SYSTEMS"]);async function Wr(t,a){const r=await Ve("clonedLoginPageThrottleMap"),o=t.toString(),n=r.map.get(o)||[];n.includes(a.href)||(n.push(a.href),r.map.has(o)||r.map.set(o,n),await Xe(r),await e.alarms.get(kr)||e.alarms.create(kr,{periodInMinutes:5}))}async function Hr(e,t){const a=await Ve("clonedLoginPageThrottleMap"),r=e.toString();return(a.map.get(r)||[]).includes(t.href)}function $r(e,t){return H({target:{tabId:e,frameIds:[t]},func:()=>{const e=performance.now(),t=[],a=document.body.querySelectorAll(":not(script, svg, svg *)");for(let c=0;c<a.length;++c){const e=a[c];e.tagName.includes("-")||t.push(e.tagName.toLowerCase())}const r=[],o=document.getElementsByTagName("script");for(let c=0;c<o.length;++c){const e=o[c].getAttribute("src");e&&r.push(new URL(e,window.location.href).pathname)}const n=document.getElementsByTagName("img");for(let c=0;c<n.length;++c){const e=n[c].getAttribute("src");e&&r.push(new URL(e,window.location.href).pathname)}const i=document.getElementsByTagName("link");for(let c=0;c<i.length;++c){if("stylesheet"===i[c].getAttribute("rel")){const e=i[c].getAttribute("href");e&&e.startsWith("http")&&r.push(new URL(e,window.location.href).pathname)}}const s=performance.now()-e;return{tagNames:t,resourcePaths:r,referrer:document.referrer||void 0,msRunTime:s}}})}async function Kr(e){const t=(new TextEncoder).encode(e),a=await crypto.subtle.digest("SHA-256",t);return function(e){const t=new Uint8Array(2*e.length),a="a".charCodeAt(0)-10,r="0".charCodeAt(0);let o=0;for(let n=0;n<e.length;++n){const i=e[n],s=i>>>4;t[o++]=s+(s<10?r:a);const c=15&i;t[o++]=c+(c<10?r:a)}return String.fromCharCode.apply(null,t)}(new Uint8Array(a))}async function zr(e,t){const a=performance.now(),r={indicator:e,data:t,hash:await Kr(t.join(",")),length:t.length,msRunTime:0},o=performance.now();return r.msRunTime=o-a,r}const jr=Lr((async function({tabId:e,frameId:t,frameUrl:a}){try{const{mode:r}=await ot();if("OFF"===r)return;const o=await j(a,ie.Login);if(!o||!Br.has(o))return;const n=f(a);if(await Hr(e,n))return;const i=await $r(e,t);if(i){await Wr(e,n);const t=await zr("DOM_STRUCTURE",i.tagNames),a=await zr("RESOURCE_PATHS",i.resourcePaths);if(t.length>=10||a.length>=1){const e=await Ve("clonedLoginPageFingerprint");t.length>=10&&e.map.set(t.hash,{url:n.href,referrer:i.referrer,data:t.data,hash:t.hash,length:t.length,platform:o,msRunTime:i.msRunTime+t.msRunTime,lastObserved:Date.now(),type:"DOM"}),a.length>=1&&e.map.set(a.hash,{url:n.href,referrer:i.referrer,data:a.data,hash:a.hash,length:a.length,platform:o,msRunTime:i.msRunTime+a.msRunTime,lastObserved:Date.now(),type:"RESOURCES"}),await Xe(e),console.log(`Stored login page fingerprint for ${o} at ${n}`)}}}catch(r){Fr(r)}}),500);async function Yr(){await ot()}async function qr(t){await s((async()=>{await e.tabs.update(t,{active:!0}).catch(a);const r=await W(t);return null==r?void 0:r.active}))||u("FOCUS_TAB_ERROR","Could not focus tab",{tabId:t,tab:JSON.stringify(await W(t))})}Qe.onPropertyChanged.addListener((async(e,t,a)=>{var r,o,n,i;"cloned_login_page_detection"===e&&(null==(r=t.cloned_login_page_detection)?void 0:r.mode)!==(null==(o=a.cloned_login_page_detection)?void 0:o.mode)&&("OFF"===(null==(n=a.cloned_login_page_detection)?void 0:n.mode)?Yr():null==(i=t.cloned_login_page_detection)||i.mode)})),e.alarms.onAlarm.addListener((async({name:t})=>{if(t===kr)await async function(){const t=await Ve("clonedLoginPageThrottleMap");for(const e of t.map.keys()){const a=Number.parseInt(e,10);void 0===await W(a)&&t.map.delete(e)}await Xe(t),0===t.map.size&&e.alarms.clear(kr)}()}));const Vr=G("MFA_ENFORCEMENT",Da),Zr=S("MFA_ENFORCEMENT");async function Xr(e){const t=await Ve("mfaEnforcementContextWorkingStore");for(const a of t.map.values())for(let t=0;t<a.tabs.length;++t)if(a.tabs[t].tabId===e)return{context:a,tabIndex:t}}async function Jr(e){const t=await ue(),a=`mfa/${e}`;for(const r of t.map.keys())r.startsWith(a)&&t.map.delete(r);await Xe(t)}function Qr(e){if(e.nextRecheckTime){const t=Math.ceil((e.nextRecheckTime-Date.now())/1e3);return Math.max(t-1,0)}return 0}async function eo(e){var t,a;for(let r=0;r<e.tabs.length;++r){const o=e.tabs[r],n=await W(o.tabId);if(!n||!(null==(t=n.url)?void 0:t.includes(e.hostname))){if(e.mfaUrl&&(null==(a=null==n?void 0:n.url)?void 0:a.startsWith(e.mfaUrl)))continue;e.tabs.splice(r,1),--r}}}async function to(t,a){for(let r=0;r<t.tabs.length;++r){const o=t.tabs[r];o.isMfaPage||await e.tabs.sendMessage(o.tabId,a)}}async function ao(e){e.checkMfaTimeoutHandle=void 0;for(let t=0;t<e.tabs.length;++t){const a=e.tabs[t],r=Ma(a.normalisedUrl),o=d(a.url);if(r&&o){return(await ue()).map.delete(r.scriptId),void(await Vr(r,a.tabId,0,o))}}}async function ro(e,t){clearTimeout(e.checkMfaTimeoutHandle),e.initialRecheckTime||(e.initialRecheckTime=Date.now()),Date.now()-e.initialRecheckTime>3e5?console.log(`Skipping MFA status recheck scheduling for ${e.emailAddress} on ${e.platform} - timeout reached.`):(e.checkMfaTimeoutHandle=void 0,e.nextRecheckTime=Date.now()+t,e.checkMfaTimeoutHandle=setTimeout(ao,t,e))}const oo=Lr((async function(e){const t=await Ve("mfaEnforcementContextWorkingStore"),a=await ct();t.map.get(e.platform)&&a&&await pe({action:"DISPLAYED",platform:e.platform,title:a.title,subtext:a.subtext_markdown,buttonText:a.button_text})}),1e3);async function no(t,a,o){if(0===a)try{const a=await Ve("mfaEnforcementContextWorkingStore"),n=await ct();if(0===a.map.size)return;const i=await Xr(t);let s=!1;i&&(s=i.context.tabs[i.tabIndex].isMfaPage,i.context.tabs.splice(i.tabIndex,1));const c=await async function(e){const t=await Ve("mfaEnforcementContextWorkingStore");for(const a of t.map.values())if(e.href.includes(a.hostname)||a.mfaUrl&&e.href.startsWith(a.mfaUrl))return a}(o);if(c){const a=c.tabs.some((e=>e.isMfaPage))||void 0!==c.checkMfaTimeoutHandle;c.tabs.push({tabId:t,url:o.href,normalisedUrl:f(o).href,isMfaPage:void 0!==c.mfaUrl&&o.href.startsWith(c.mfaUrl)});const i=c.tabs[c.tabs.length-1];c.bannerAcknowledged||i.isMfaPage?a||await ro(c,31e3):n&&(await r(i.tabId,0,"MfaEnforcement"),await e.tabs.sendMessage(i.tabId,{id:"MFA_ENFORCEMENT_BANNER_SHOW",platform:c.platform,title:n.title,subtext:n.subtext,subtextMarkdown:n.subtext,buttonText:n.button_text}))}i&&(0===i.context.tabs.length?(a.map.delete(i.context.platform),clearTimeout(i.context.checkMfaTimeoutHandle),i.context.checkMfaTimeoutHandle=void 0,await Jr(i.context.platform)):s&&!i.context.tabs.some((e=>e.isMfaPage))&&Qr(i.context)+1>3&&await ro(i.context,3e3)),await Xe(a)}catch(n){Zr(n)}}async function io({frameUrl:t,platform:a,emailAddress:o,mfaRegistered:n}){try{const i=await ct();if(i&&i.platforms.includes(a)){const s=await Ve("mfaEnforcementContextWorkingStore"),c=`${o}:${a}`;if(n)if(s.map.has(a)){const e=s.map.get(a);await eo(e),await to(e,{id:"MFA_ENFORCEMENT_BANNER_HIDE",platform:e.platform}),s.map.delete(a),console.log(`MFA was registered for ${e.emailAddress} on ${a}, stopping MFA enforcement`)}else await async function(t){const a=await e.tabs.query({status:"complete"});for(const r of a)r.id&&l(r)&&await e.tabs.sendMessage(r.id,t)}({id:"MFA_ENFORCEMENT_BANNER_HIDE",platform:a});else if(s.map.has(a)){const e=s.map.get(a);e&&(await eo(e),void 0===e.checkMfaTimeoutHandle&&await ro(e,6e4))}else{if(await async function(e){const t=(await te()).map.get(e);if(t&&Date.now()-1e3*t.firstSeen<9e5)return!0;return!1}(c))return void console.log(`Skipping MFA enforcement for ${o} on ${a}. Newly tracked account.`);if(await async function(e){const t=(await Ve("mfaEnforcementAcknowledgements")).map.get(e);if(void 0!==t&&Date.now()-t<432e5)return!0;return!1}(c))return void console.log(`Skipping MFA enforcement for ${o} on ${a}. Acknowledged cooldown.`);const n=(await ae()).platformMfaUrls[a];let l;if(n)if("RELATIVE_PATH"===n.mode){const e=n.url.startsWith("/")?n.url:`/${n.url}`;l=new URL(e,t).href}else l=n.url;if(!(await async function(e,t,a){const r=(await te()).map.get(e);if(r&&Date.now()-1e3*r.lastLogin<=6e5)return!0;const o=await ge(),{data:n}=await Ee.query({query:Ie,variables:{input:{browserId:o,platform:a,email:t}}});return n.accountUsesPasswordOnly.usesPasswordOnly}(c,o,a)))return void console.log(`Skipping MFA enforcement for ${o} on ${a}. Not using password login.`);console.log(`Starting MFA enforcement on ${a}`);const m={emailAddress:o,platform:a,hostname:t.hostname,bannerAcknowledged:!1,mfaUrl:l,tabs:[]};s.map.set(a,m);const u=[`*://*.${m.hostname}/*`];l&&u.push(l);const p=await fe((async()=>{const t=await e.tabs.query({url:u});if(t.every((e=>"complete"===e.status)))return t}));if(!p)return;for(let e=0;e<p.length;++e){const t=p[e];if(t.id&&t.url){const e=d(t.url);e&&m.tabs.push({tabId:t.id,url:t.url,normalisedUrl:f(e).href,isMfaPage:void 0!==m.mfaUrl&&e.href.startsWith(m.mfaUrl)})}}for(let e=0;e<m.tabs.length;++e){const t=m.tabs[e];t.isMfaPage||await r(t.tabId,0,"MfaEnforcement")}await ro(m,6e4),await to(m,{id:"MFA_ENFORCEMENT_BANNER_SHOW",platform:a,title:i.title,subtext:i.subtext,subtextMarkdown:i.subtext,buttonText:i.button_text})}await Xe(s)}}catch(i){Zr(i)}}async function so({feature:e,platform:t}){if("MFA_ENFORCEMENT"===e&&t){const e=await Ve("mfaEnforcementContextWorkingStore"),a=e.map.get(t);a&&(await eo(a),await to(a,{id:"MFA_ENFORCEMENT_BANNER_HIDE",platform:a.platform}),e.map.delete(t),await Jr(t))}}async function co(){await async function(){const e=await Ve("mfaEnforcementContextWorkingStore"),t=e.map.size;for(const[a,r]of e.map)await eo(r),0===r.tabs.length&&(e.map.delete(a),await Jr(r.platform));e.map.size!==t&&await Xe(e)}(),Sa.onMfaDetails.addListener(io),de.onNoResult.addListener(so)}function lo(e){const t=/(?:localhost|\.(?:local|test))$/,a=["chrome:","edge:","about:","favorites:"];try{const r=new URL(e);if(a.includes(r.protocol))return;if(t.test(r.hostname))return;return r}catch{return}}let mo;e.tabs.onRemoved.addListener((async function(e){const t=await Ve("mfaEnforcementContextWorkingStore");if(0===t.map.size)return;const a=await Xr(e);if(a){const e=a.context.tabs[a.tabIndex].isMfaPage;a.context.tabs.splice(a.tabIndex,1),0===a.context.tabs.length?(t.map.delete(a.context.platform),clearTimeout(a.context.checkMfaTimeoutHandle),a.context.checkMfaTimeoutHandle=void 0,await Jr(a.context.platform)):e&&!a.context.tabs.some((e=>e.isMfaPage))&&Qr(a.context)+1>3&&await ro(a.context,3e3)}await Xe(t)}));let uo=!1;async function po(t,a){var r;if(null==(r=t.tab)?void 0:r.id)try{const r={id:"CHANGE_STATE_ENROLMENT",step:a};await e.tabs.sendMessage(t.tab.id,r)}catch(o){console.log("[changeEnrolmentState error]:",o)}uo=!1}async function fo({tabId:e,frameId:t,frameUrl:a}){await async function({tabId:e,frameId:t,frameUrl:a}){if(!(await oe())&&await ft.managed.hasManagedStorage())try{await ft.managed.getTeamToken()&&(Re.isGmailPage(a)?await Re.attemptGmailAutoEnrolment(e,a):Re.isOktaPage(a)?await Re.attemptOktaAutoEnrolment(e,t,a):Re.isOutlookPage(a)&&await Re.attemptOutlookAutoEnrolment(e,t,a))}catch(r){u("Auto-enrolment error",r,{tabUrl:f(a)})}else if(await le())try{await Promise.all([Ta(e,t,a),Ua(e,t,a),Ba(e,t,a),pr(e,t,a),gt(e,t,a),no(e,t,a)])}catch(r){u("Feature injection error",r,{tabUrl:f(a)})}}({tabId:e,frameId:t,frameUrl:a})}async function go({tabId:e,frameId:t,frameUrl:a,message:{errorMessage:r,stackTrace:o,feature:n,platform:i,scriptId:s,attachments:c,metadata:l={}}}){const m=new Ye({message:r,feature:n,platform:i,scriptId:s,attachments:c});if(m.stack=o,l.frameUrl=f(a).toString(),l.framePath=a.href.substring(a.origin.length),t>0){const t=await W(e);if(t&&t.url){const e=new URL(t.url);l.tabUrl=f(e).toString(),l.tabPath=e.href.substring(e.origin.length)}}u(`${n}_ERROR`,m,l)}async function Eo(e){const t=function(e){if(0===Wa.size){for(const e of Na)Wa.set(e.scriptId,e);for(const e of Ga)Wa.set(e.scriptId,e)}return Wa.get(e)}(e.scriptId);t&&await qe(e.result,e.feature,t)}!async function(){var t;await Pe(),await Se(),await Ne(),await ya.social.init(),await be(),await lt(),await Me(),await De(),await async function(){await e.storage.local.remove("clonedLoginPageFingerprints");const t=await nt("migrationVersions");void 0===t.obj.clonedLoginPageDetection&&(t.obj.clonedLoginPageDetection=0),t.obj.clonedLoginPageDetection<1&&t.obj.clonedLoginPageDetection<1&&(await it("clonedLoginPageFingerprint"),t.obj.clonedLoginPageDetection=1,await st(t));let a=!1;const r=await Ve("clonedLoginPageFingerprint");for(const[e,o]of r.map.entries())Br.has(o.platform)||(r.map.delete(e),a=!0);a&&await Xe(r)}(),await ve(),await async function(){console.log("Checking if script injection caches need to be reset");const{lastScriptInjectionCacheReset:e}=await mt("lastScriptInjectionCacheReset");if(e.value=e.value||0,Date.now()-e.value>864e5){console.log("Resetting script injection caches");const t=await ue();t.map.clear(),await Xe(t),e.value=Date.now(),await ut(e)}}(),await Ue(),await Ge(),await he(),await Le(),await co(),await vr(),await Yr(),t=Et.RUNNING,It=t}(),e.runtime.onInstalled.addListener((async function(t){var a;if(await ca(Et.RUNNING),"install"===t.reason&&await c(),"install"===t.reason||"update"===t.reason){const t=await e.tabs.query({});for(let e=0;e<t.length;++e){const o=t[e];try{if(o.id&&l(o)){const e=await sa({tabId:o.id,frameId:0,resultOnIgnoredTabError:m.ERROR}),t=/Could not load file: '([\w/.-]+)'/;for(const r of e)if("rejected"===r.status){let e,n;if(o.url){const t=o.url.search(/\w\//)+1||o.url.length,a=Math.max(o.url.search(/[?#]/)??-1,0)||o.url.length;e=o.url.substring(0,a),n=o.url.substring(t)}const i=JSON.stringify({...o,url:void 0,favIconUrl:void 0});if(r.reason instanceof Error&&t.test(r.reason.message)){const o=null==(a=r.reason.message.match(t))?void 0:a.at(1);if(o&&!(await la(o))){u("INSTALLATION_HANDLER_ERROR",r.reason,{distPath:o,tabUrl:e,tabPath:n,tab:i});continue}}u("INSTALLATION_HANDLER_ERROR",r.reason,{tabUrl:e,tabPath:n,tab:i})}}}catch(r){console.log("[Execute script error]:",r)}}}})),e.runtime.onMessage.addListener((function(a,o,n){if(void 0===o.tab||void 0===o.tab.id||void 0===o.tab.url||void 0===o.frameId||void 0===o.url)return;const i=o.tab.id,s=o.frameId,p=lo(0===s?o.tab.url:o.url);if(p)switch(a.id){case"GENERIC_PAGE_LOADED":fo({tabId:i,frameId:s,frameUrl:p});break;case"PASSWORD_FIELD_CHANGED":_e({tabId:i,frameId:s,frameUrl:p,message:a}),Tr({tabId:i,frameId:s,frameUrl:p,message:a}),Te({tabId:i,frameId:s,frameUrl:p,message:a}),jr({tabId:i,frameId:s,frameUrl:p,message:a});break;case"PASSWORD_FIELD_DETECTED":!async function({tabId:e,frameId:t,frameUrl:a}){void 0!==await j(a)&&await We(He.INLINE_PASSWORD_PROMPTS)&&await r(e,t,"PasswordMonitor")}({tabId:i,frameId:s,frameUrl:p,message:a}),async function({tabId:e,frameId:t,frameUrl:a}){try{const{mode:r}=await ot();if("OFF"===r)return;const o=await Ve("clonedLoginPageFingerprint");if(0===o.map.size)return;if(await j(a,ie.Login)||(await se(a)).length>0)return;const n=f(a);if(await Hr(e,n))return;const i=await $r(e,t);if(i){const t=ce(a.hostname),s=await zr("DOM_STRUCTURE",i.tagNames),c=await zr("RESOURCE_PATHS",i.resourcePaths),l=new Map,m=new Map,u=new Map;for(const[e,a]of o.map.entries())if(!new URL(a.url).hostname.endsWith(t))if("DOM"===a.type&&s.length>=10){if(e===s.hash){const{platform:e,url:t}=a;l.has(e)||l.set(e,[]),l.get(e).push(t)}else if(Gr(a.data,s.data)){const{platform:e,url:t}=a;m.has(e)||m.set(e,[]),m.get(e).push(t)}}else if("RESOURCES"===a.type&&c.length>=1&&e===c.hash){const{platform:e,url:t}=a;u.has(e)||u.set(e,[]),u.get(e).push(t)}if((l.size>0||m.size>0||u.size>0)&&await Wr(e,n),await le()){for(const[e,t]of l)me({indicator:"DOM_STRUCTURE",url:n,clonedPlatform:e,clonedUrls:t,referrerUrl:i.referrer,mode:r});for(const[e,t]of m)me({indicator:"DOM_STRUCTURE_SUBSET",url:n,clonedPlatform:e,clonedUrls:t,referrerUrl:i.referrer,mode:r});for(const[e,t]of u)me({indicator:"RESOURCE_PATHS",url:n,clonedPlatform:e,clonedUrls:t,referrerUrl:i.referrer,mode:r})}}}catch(r){Fr(r)}}({tabId:i,frameId:s,frameUrl:p,message:a});break;case"REQUEST_ASSESS_PASSWORD":!async function({tabId:t,frameUrl:a,message:r}){const{emails:o,password:n}=r,i=await j(a),s=o?await E(o):void 0;let c;if(i&&s&&n&&n.length>0&&(c=$e(n,await pt()),!c)){const e=await te(),t=[];for(const a of e.map.values())a.username===s.emailAddress&&a.platform===i||t.push({platform:a.platform,fingerprint:a.fingerprint,fingerprintV2:a.fingerprintV2});t.length>0&&await Ke({input:{password:n,platform:i},accountFingerprints:t,ignoreGroups:await dt()})&&(c=ze.REUSED_PASSWORD)}await e.tabs.sendMessage(t,{id:"RESPONSE_ASSESS_PASSWORD",weakPasswordReason:c}),void 0!==c&&i&&await je(i,c)}({tabId:i,frameUrl:p,message:a});break;case"REQUEST_GET_WORK_PLATFORM_FROM_URL":{const e=a.url?new URL(a.url):p;return x(e).then((({platform:e})=>{n(e)})),!0}case"MFA_DETAILS_FOUND":Da({tabId:i,frameId:s,frameUrl:p,message:a});break;case"ENROLMENT_PAGE_LOADED":!async function({frameUrl:e,sender:t}){var a,r;if(await ca(Et.RUNNING),mo&&mo!==(null==(a=t.tab)?void 0:a.id)){const e=await W(mo);if(e&&e.url){const t=d(e.url);t&&function(e){return function(e){return[..."pushsecurity.com".split(",")??[],..."app.stg.pushsecurity.com".split(",")??[],..."localhost:8080,app.dev.pushsecurity.com".split(",")??[]].includes(e.host)&&("/app/setup/browser"===e.pathname||"/integration/setup/browser"===e.pathname)}(e)}(t)||(mo=void 0)}else mo=void 0}try{if((null==(r=t.tab)?void 0:r.id)&&!uo&&(!mo||mo===t.tab.id)){uo=!0,mo=t.tab.id;const a=e.searchParams.get("step");if(a===Fe.DONE||a===Fe.INVALID||a===Fe.UNINSTALL)return uo=!1,void(mo=void 0);a===Fe.AWAITING_ENROLMENT?await ke(e)?(po(t,Fe.DONE),await qr(t.tab.id)):po(t,Fe.INVALID):await oe()?await Be()?po(t,Fe.AWAITING_ENROLMENT):po(t,Fe.INVALID):(po(t,Fe.AWAITING_ENROLMENT),await qr(t.tab.id))}}catch(o){o.message.includes("No tab with id")||u("Enrolment page handler error",o)}}({frameUrl:p,sender:o});break;case"ERROR_IN_CONTENT_SCRIPT":go({tabId:i,frameId:s,frameUrl:p,message:a});break;case"USER_ACTIVITY_DETECTED":Fa({frameUrl:p,message:a});break;case"CONTENT_SCRIPT_COMPLETED":Eo(a);break;case"AUTO_ENROLMENT_DATA_FOUND":Re.handleAutoEnrolmentDataFound(a);break;case"GOOGLE_USER_EMAIL_MAPPING_DETECTED":ya.social.handleGoogleUserEmailMappingDetected(a);break;case"REQUEST_APP_BANNER_PREVIEW":!async function({tabId:e,frameId:a,frameUrl:r,message:o}){t(r)&&r.pathname.startsWith("/app/")&&await ur({tabId:e,frameId:a,frameUrl:r,appBanner:o.banner,platform:"PUSH_SECURITY",platformType:"ID",isPreview:!0})}({frameId:s,tabId:i,frameUrl:p,message:a});break;case"REQUEST_URL_BLOCK_PREVIEW":Ce({frameUrl:p,message:a});break;case"BACKEND_SETTINGS_CHANGED":!async function(){await c("FORCED");const t=await e.tabs.query({}),a=[];for(let e=0;e<t.length;++e){const r=t[e];r.id&&l(r)&&a.push(sa({tabId:r.id,resultOnIgnoredTabError:m.ERROR}))}await Promise.allSettled(a)}();break;case"PHISHING_TOOL_DETECTED":!async function({tabId:e,frameUrl:t,message:a}){await Dr({tabId:e,url:t,referrerUrl:d(a.referrerUrl),indicator:a.indicator})}({tabId:i,frameUrl:p,message:a});break;case"APP_BANNER_DISPLAYED":we({action:"DISPLAYED",banner:a.banner,platform:a.platform,platformType:a.platformType});break;case"APP_BANNER_ACKNOWLEDGED":we({action:"ACKNOWLEDGED",banner:a.banner,platform:a.platform,platformType:a.platformType}),mr(i,a.platform);break;case"APP_BANNER_SUBMIT_REASON":case"APP_BANNER_BLOCK_SUBMIT_REASON":we({action:"SUBMITTED_REASON",banner:a.banner,reason:a.reason,platform:a.platform,platformType:a.platformType}),mr(i,a.platform);break;case"REQUEST_PHISHING_BLOCK_PREVIEW":!async function(t){const a=new URL(e.runtime.getURL("dist/phishingBlock/index.html")),r=await Q(a.href);(null==r?void 0:r.id)&&await hr(r.id,{id:"PHISHING_BLOCK_PAGE_ARGS",view:"preview",ignoreButtonText:t.phishingBlock.ignoreButtonText,mode:t.phishingBlock.mode,subtext:t.phishingBlock.subtext,title:t.phishingBlock.title,url:""})}(a);break;case"SWA_1CLICK_LOGIN_INITIATED":xe({tabId:i,frameId:s,frameUrl:p});break;case"REQUEST_PHISHING_TOOLS_BLOCK_PREVIEW":!async function(t){const a=e.runtime.getURL("dist/phishingToolsBlock/index.html"),r=await Q(a);(null==r?void 0:r.id)&&await hr(r.id,{id:"PHISHING_TOOLS_BLOCK_PAGE_ARGS",view:"preview",ignoreButtonText:t.phishingToolsBlock.ignoreButtonText,mode:t.phishingToolsBlock.mode,subtext:t.phishingToolsBlock.subtext,title:t.phishingToolsBlock.title})}(a);break;case"ARC_BROWSER_DETECTED":Oe(a);break;case"MFA_ENFORCEMENT_DISPLAYED":oo(a);break;case"MFA_ENFORCEMENT_SETUP_MFA":!async function({tabId:e,message:t}){const a=await Ve("mfaEnforcementContextWorkingStore"),r=await ct(),o=a.map.get(t.platform);if(o&&r){await eo(o),o.bannerAcknowledged=!0,await Xe(a);const n=o.tabs.find((e=>e.isMfaPage));n?await qr(n.tabId):o.mfaUrl&&await Q(o.mfaUrl,{openerTabId:e}),await to(o,{id:"MFA_ENFORCEMENT_BANNER_HIDE",platform:o.platform});const i=`${o.emailAddress}:${t.platform}`,s=await Ve("mfaEnforcementAcknowledgements");s.map.set(i,Date.now()),await Xe(s),await pe({action:"ACKNOWLEDGED",platform:t.platform,title:r.title,subtext:r.subtext_markdown,buttonText:r.button_text})}}({tabId:i,message:a});break;case"REQUEST_MFA_ENFORCEMENT_PREVIEW":!async function({tabId:a,frameUrl:o,message:{mfaEnforcement:n}}){t(o)&&o.pathname.startsWith("/app/")&&(await r(a,0,"MfaEnforcement"),await e.tabs.sendMessage(a,{id:"MFA_ENFORCEMENT_BANNER_SHOW",platform:n.platform,title:n.title,subtext:n.subtext,subtextMarkdown:n.subtext,isPreview:!0,buttonText:n.buttonText}))}({tabId:i,frameUrl:p,message:a});break;case"INTEGRATION_CONSENT_PAGE_OBSERVED":ir({tabId:i,message:a});break;case"FEDCM_LOGIN_DETECTED":Ae({tabId:i,frameId:s,frameUrl:p,message:a})}})),e.runtime.onMessage.addListener((function(t,a,r){var o;if(a.id===e.runtime.id){if("REQUEST_FORCED_CHECKIN"===t.id)c("FORCED");if(null==(o=a.tab)?void 0:o.id)switch(t.id){case"REQUEST_TEMP_PHISHING_BLOCK_IGNORE":!async function(t,a){const{email:r,platform:o,referrerUrl:n,url:i,mode:s}=a,c=t.toString(),l=d(i);if(l&&V(l)){console.log(`Temporarily ignoring phishing block checks for ${l.hostname} in tab ${c}`);const t=await Ve("tempPhishingBlockIgnoreMap"),a=t.map.get(c)||[],i=Z(l.hostname);i.type===X.Listed&&i.domain?a.push(i.domain):a.push(l.hostname),t.map.has(c)||t.map.set(c,a),await Xe(t),await e.alarms.get("tempPhishingBlockIgnoreMapCleanup")||e.alarms.create("tempPhishingBlockIgnoreMapCleanup",{periodInMinutes:1}),await J({action:"IGNORED",email:r,mode:s,platformType:o,referrerUrl:n,url:V(l)})}}(a.tab.id,t);break;case"REQUEST_TEMP_PHISHING_TOOLS_BLOCK_IGNORE":!async function(t,a){const{mode:r,indicator:o,referrerUrl:n,url:i}=a,s=t.toString(),c=d(i);if(c&&V(c)){console.log(`Temporarily ignoring phishing tool block checks for ${c.hostname} in tab ${s}`);const t=await Ve("tempPhishingToolsBlockIgnoreMap"),a=t.map.get(s)||[],i=Z(c.hostname);i.type===X.Listed&&i.domain?a.push(i.domain):a.push(c.hostname),t.map.has(s)||t.map.set(s,a),await Xe(t),await e.alarms.get("tempPhishingToolsBlockIgnoreMapCleanup")||e.alarms.create("tempPhishingToolsBlockIgnoreMapCleanup",{periodInMinutes:5}),ne({action:"IGNORED",mode:r,indicator:o,referrerUrl:d(n),url:c})}}(a.tab.id,t)}}})),e.runtime.onMessageExternal.addListener((function(e,t,a){if(void 0===t.tab||void 0===t.tab.id||void 0===t.tab.url||void 0===t.frameId||void 0===t.url)return;const r=t.tab.id,o=t.frameId,n=lo(0===o?t.tab.url:t.url);if(n)switch(e.id){case"MFA_DETAILS_FOUND":Da({tabId:r,frameId:o,frameUrl:n,message:e});break;case"ERROR_IN_CONTENT_SCRIPT":go({tabId:r,frameId:o,frameUrl:n,message:e});break;case"USER_ACTIVITY_DETECTED":Fa({frameUrl:n,message:e});break;case"CONTENT_SCRIPT_COMPLETED":Eo(e);break;case"AUTO_ENROLMENT_DATA_FOUND":Re.handleAutoEnrolmentDataFound(e);break;case"GOOGLE_USER_EMAIL_MAPPING_DETECTED":ya.social.handleGoogleUserEmailMappingDetected(e);break;case"FEDCM_LOGIN_DETECTED":Ae({tabId:r,frameId:o,frameUrl:n,message:e})}a(void 0)})),e.tabs.onRemoved.addListener((function(e){e===mo&&(mo=void 0),sr.handleTabClosure(e),ya.password.handleTabClosure(e),ya.social.handleTabClosure(e)}));const Io={url:[{urlMatches:"^(?:https?://|.+-extension://)"}]};e.webNavigation.onBeforeNavigate.addListener((function(e){sr.handleNavigationStart(e),ya.password.handleNavigationStart(e)}),Io),e.webNavigation.onCommitted.addListener((function(e){ya.password.handleNavigationCommitted(e)}),Io),e.webNavigation.onDOMContentLoaded.addListener((function(e){!async function(e,t){if(!(await cr(e)))return;!1===await K(2500).then((async()=>{if(await cr(e))return H({target:{tabId:e,frameIds:[t]},args:[z],func:e=>Boolean(document.getElementById(e))})}))&&await sa({tabId:e,frameId:t,thisFrameOnly:!0})}(e.tabId,e.frameId)}),Io),e.webNavigation.onHistoryStateUpdated.addListener((function(e){ya.password.handleNavigationCommitted(e)}),Io);const ho={urls:["https://*/*","http://*/*",e.runtime.getURL("dist/urlBlocking/*")],types:["main_frame","xmlhttprequest","sub_frame","other"]};e.webRequest.onBeforeRequest.addListener((function(e){sr.inspectOutgoingRequestDetails(e),ya.password.inspectOutgoingRequestDetails(e),ya.social.inspectOutgoingRequestDetails(e)}),ho,["requestBody"]),e.webRequest.onSendHeaders.addListener((function(e){ya.social.inspectOutgoingRequestHeaders(e)}),ho,["requestHeaders"]),e.webRequest.onBeforeRedirect.addListener((function(e){sr.inspectIncomingResponseDetails(e),ya.password.inspectIncomingResponseDetails(e),ya.social.inspectIncomingResponseDetails(e),ye(e)}),ho,["responseHeaders"]),e.webRequest.onResponseStarted.addListener((function(e){sr.inspectIncomingResponseDetails(e),ya.password.inspectIncomingResponseDetails(e),ya.social.inspectIncomingResponseDetails(e)}),ho,["responseHeaders"]),e.alarms.onAlarm.addListener((async({name:e})=>{switch(e){case"checkin":await c();break;case"clearTempDisabledSite":await it("tempDisabledSite","tempDisabledSiteExpiry"),await he()}})),async function(){await e.alarms.get("checkin")||await e.alarms.create("checkin",{delayInMinutes:.5,periodInMinutes:15})}();
