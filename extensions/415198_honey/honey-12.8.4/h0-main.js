!function(e){function t(t){for(var n,u,i=t[0],s=t[1],c=t[2],l=0,f=[];l<i.length;l++)u=i[l],Object.prototype.hasOwnProperty.call(a,u)&&a[u]&&f.push(a[u][0]),a[u]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);for(d&&d(t);f.length;)f.shift()();return o.push.apply(o,c||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],n=!0,i=1;i<r.length;i++){var s=r[i];0!==a[s]&&(n=!1)}n&&(o.splice(t--,1),e=u(u.s=r[0]))}return e}var n={},a={0:0},o=[];function u(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,u),r.l=!0,r.exports}u.m=e,u.c=n,u.d=function(e,t,r){u.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},u.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.t=function(e,t){if(1&t&&(e=u(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(u.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)u.d(r,n,function(t){return e[t]}.bind(null,n));return r},u.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return u.d(t,"a",t),t},u.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},u.p="";var i=window.webpackJsonp=window.webpackJsonp||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var d=s;o.push([702,1]),r()}({1029:function(e,t,r){"use strict";var n,a=r(5);((n=a)&&n.__esModule?n:{default:n}).default.config({longStackTraces:!1,cancellation:!0,warnings:!1})},1031:function(e){e.exports=JSON.parse('["AlreadyExistsError","BadAmazonStateError","BlacklistError","CancellationError","CapacityExceededError","ConfigError","DataError","DatabaseError","DomainBlacklistedError","EmailLockedError","EventIgnoredError","EventNotSupportedError","ExpiredError","FacebookNoEmailError","FatalError","InsufficientBalanceError","InsufficientResourcesError","InvalidConfigurationError","InvalidCredentialsError","InvalidDataError","InvalidMappingError","InvalidParametersError","InvalidResponseError","MessageListenerError","MissingParametersError","NoMessageListenersError","NotFoundError","NotImplementedError","NotStartedError","NotSupportedError","NothingToUpdateError","OperationSkippedError","ProfanityError","RequestThrottledError","RequestThrottledError","ResourceLockedError","ServerError","StorageError","TimeoutError","UnauthorizedError","UnavailableError","UpToDateError"]')},1041:function(e,t,r){var n={"./af":444,"./af.js":444,"./ar":445,"./ar-dz":446,"./ar-dz.js":446,"./ar-kw":447,"./ar-kw.js":447,"./ar-ly":448,"./ar-ly.js":448,"./ar-ma":449,"./ar-ma.js":449,"./ar-sa":450,"./ar-sa.js":450,"./ar-tn":451,"./ar-tn.js":451,"./ar.js":445,"./az":452,"./az.js":452,"./be":453,"./be.js":453,"./bg":454,"./bg.js":454,"./bm":455,"./bm.js":455,"./bn":456,"./bn.js":456,"./bo":457,"./bo.js":457,"./br":458,"./br.js":458,"./bs":459,"./bs.js":459,"./ca":460,"./ca.js":460,"./cs":461,"./cs.js":461,"./cv":462,"./cv.js":462,"./cy":463,"./cy.js":463,"./da":464,"./da.js":464,"./de":465,"./de-at":466,"./de-at.js":466,"./de-ch":467,"./de-ch.js":467,"./de.js":465,"./dv":468,"./dv.js":468,"./el":469,"./el.js":469,"./en-SG":470,"./en-SG.js":470,"./en-au":471,"./en-au.js":471,"./en-ca":472,"./en-ca.js":472,"./en-gb":473,"./en-gb.js":473,"./en-ie":474,"./en-ie.js":474,"./en-il":475,"./en-il.js":475,"./en-nz":476,"./en-nz.js":476,"./eo":477,"./eo.js":477,"./es":478,"./es-do":479,"./es-do.js":479,"./es-us":480,"./es-us.js":480,"./es.js":478,"./et":481,"./et.js":481,"./eu":482,"./eu.js":482,"./fa":483,"./fa.js":483,"./fi":484,"./fi.js":484,"./fo":485,"./fo.js":485,"./fr":486,"./fr-ca":487,"./fr-ca.js":487,"./fr-ch":488,"./fr-ch.js":488,"./fr.js":486,"./fy":489,"./fy.js":489,"./ga":490,"./ga.js":490,"./gd":491,"./gd.js":491,"./gl":492,"./gl.js":492,"./gom-latn":493,"./gom-latn.js":493,"./gu":494,"./gu.js":494,"./he":495,"./he.js":495,"./hi":496,"./hi.js":496,"./hr":497,"./hr.js":497,"./hu":498,"./hu.js":498,"./hy-am":499,"./hy-am.js":499,"./id":500,"./id.js":500,"./is":501,"./is.js":501,"./it":502,"./it-ch":503,"./it-ch.js":503,"./it.js":502,"./ja":504,"./ja.js":504,"./jv":505,"./jv.js":505,"./ka":506,"./ka.js":506,"./kk":507,"./kk.js":507,"./km":508,"./km.js":508,"./kn":509,"./kn.js":509,"./ko":510,"./ko.js":510,"./ku":511,"./ku.js":511,"./ky":512,"./ky.js":512,"./lb":513,"./lb.js":513,"./lo":514,"./lo.js":514,"./lt":515,"./lt.js":515,"./lv":516,"./lv.js":516,"./me":517,"./me.js":517,"./mi":518,"./mi.js":518,"./mk":519,"./mk.js":519,"./ml":520,"./ml.js":520,"./mn":521,"./mn.js":521,"./mr":522,"./mr.js":522,"./ms":523,"./ms-my":524,"./ms-my.js":524,"./ms.js":523,"./mt":525,"./mt.js":525,"./my":526,"./my.js":526,"./nb":527,"./nb.js":527,"./ne":528,"./ne.js":528,"./nl":529,"./nl-be":530,"./nl-be.js":530,"./nl.js":529,"./nn":531,"./nn.js":531,"./pa-in":532,"./pa-in.js":532,"./pl":533,"./pl.js":533,"./pt":534,"./pt-br":535,"./pt-br.js":535,"./pt.js":534,"./ro":536,"./ro.js":536,"./ru":537,"./ru.js":537,"./sd":538,"./sd.js":538,"./se":539,"./se.js":539,"./si":540,"./si.js":540,"./sk":541,"./sk.js":541,"./sl":542,"./sl.js":542,"./sq":543,"./sq.js":543,"./sr":544,"./sr-cyrl":545,"./sr-cyrl.js":545,"./sr.js":544,"./ss":546,"./ss.js":546,"./sv":547,"./sv.js":547,"./sw":548,"./sw.js":548,"./ta":549,"./ta.js":549,"./te":550,"./te.js":550,"./tet":551,"./tet.js":551,"./tg":552,"./tg.js":552,"./th":553,"./th.js":553,"./tl-ph":554,"./tl-ph.js":554,"./tlh":555,"./tlh.js":555,"./tr":556,"./tr.js":556,"./tzl":557,"./tzl.js":557,"./tzm":558,"./tzm-latn":559,"./tzm-latn.js":559,"./tzm.js":558,"./ug-cn":560,"./ug-cn.js":560,"./uk":561,"./uk.js":561,"./ur":562,"./ur.js":562,"./uz":563,"./uz-latn":564,"./uz-latn.js":564,"./uz.js":563,"./vi":565,"./vi.js":565,"./x-pseudo":566,"./x-pseudo.js":566,"./yo":567,"./yo.js":567,"./zh-cn":568,"./zh-cn.js":568,"./zh-hk":569,"./zh-hk.js":569,"./zh-tw":570,"./zh-tw.js":570};function a(e){var t=o(e);return r(t)}function o(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}a.keys=function(){return Object.keys(n)},a.resolve=o,e.exports=a,a.id=1041},1058:function(e){e.exports=JSON.parse('{"AC":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"en"},"AD":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"it"},"AF":{"currencyCode":"AFN","currencySymbol":"\u060b","currencyName":"Afghanistan Afghani","currencyLanguage":"fa"},"AG":{"currencyCode":"XCD","currencySymbol":"$","currencyName":"East Caribbean Dollar","currencyLanguage":"ag"},"AI":{"currencyCode":"XCD","currencySymbol":"$","currencyName":"East Caribbean Dollar","currencyLanguage":"ai"},"AL":{"currencyCode":"ALL","currencySymbol":"Lek","currencyName":"Albania Lek","currencyLanguage":"sq"},"AR":{"currencyCode":"ARS","currencySymbol":"$","currencyName":"Argentina Peso","currencyLanguage":"es"},"AS":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"en"},"AT":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"of"},"AU":{"currencyCode":"AUD","currencySymbol":"$","currencyName":"Australia Dollar","currencyLanguage":"en"},"AW":{"currencyCode":"AWG","currencySymbol":"\u0192","currencyName":"Aruba Guilder","currencyLanguage":"nl"},"AZ":{"currencyCode":"AZN","currencySymbol":"\u043c\u0430\u043d","currencyName":"Azerbaijan New Manat","currencyLanguage":"az"},"BA":{"currencyCode":"BAM","currencySymbol":"KM","currencyName":"Bosnia and Herzegovina Convertible Marka","currencyLanguage":"bs"},"BB":{"currencyCode":"BBD","currencySymbol":"$","currencyName":"Barbados Dollar","currencyLanguage":"en"},"BE":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"nl"},"BG":{"currencyCode":"BGN","currencySymbol":"\u043b\u0432","currencyName":"Bulgaria Lev","currencyLanguage":"bg"},"BL":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"fr"},"BM":{"currencyCode":"BMD","currencySymbol":"$","currencyName":"Bermuda Dollar","currencyLanguage":"en"},"BN":{"currencyCode":"BND","currencySymbol":"$","currencyName":"Brunei Darussalam Dollar","currencyLanguage":"ms"},"BO":{"currencyCode":"BOB","currencySymbol":"$b","currencyName":"Bolivia Boliviano","currencyLanguage":"es"},"BQ":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"nl"},"BR":{"currencyCode":"BRL","currencySymbol":"R$","currencyName":"Brazil Real","currencyLanguage":"pt"},"BS":{"currencyCode":"BSD","currencySymbol":"$","currencyName":"Bahamas Dollar","currencyLanguage":"en"},"BT":{"currencyCode":"INR","currencySymbol":"\u20b9","currencyName":"India Rupee","currencyLanguage":"dz"},"BV":{"currencyCode":"NOK","currencySymbol":"kr","currencyName":"Norway Krone","currencyLanguage":"no"},"BW":{"currencyCode":"BWP","currencySymbol":"P","currencyName":"Botswana Pula","currencyLanguage":"bw"},"BY":{"currencyCode":"BYR","currencySymbol":"p.","currencyName":"Belarus Ruble","currencyLanguage":"be"},"BZ":{"currencyCode":"BZD","currencySymbol":"BZ$","currencyName":"Belize Dollar","currencyLanguage":"bzj"},"CA":{"currencyCode":"CAD","currencySymbol":"$","currencyName":"Canada Dollar","currencyLanguage":"en"},"CC":{"currencyCode":"AUD","currencySymbol":"$","currencyName":"Australia Dollar","currencyLanguage":"en"},"CH":{"currencyCode":"CHF","currencySymbol":"CHF","currencyName":"Switzerland Franc","currencyLanguage":"de"},"CK":{"currencyCode":"NZD","currencySymbol":"$","currencyName":"New Zealand Dollar","currencyLanguage":"nz"},"CL":{"currencyCode":"CLP","currencySymbol":"$","currencyName":"Chile Peso","currencyLanguage":"es"},"CN":{"currencyCode":"CNY","currencySymbol":"\xa5","currencyName":"China Yuan Renminbi","currencyLanguage":"zh-hans"},"CO":{"currencyCode":"COP","currencySymbol":"$","currencyName":"Colombia Peso","currencyLanguage":"es"},"CP":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"fr"},"CR":{"currencyCode":"CRC","currencySymbol":"\u20a1","currencyName":"Costa Rica Colon","currencyLanguage":"es"},"CU":{"currencyCode":"CUP","currencySymbol":"\u20b1","currencyName":"Cuba Peso","currencyLanguage":"es"},"CW":{"currencyCode":"ANG","currencySymbol":"\u0192","currencyName":"Netherlands Antilles Guilder","currencyLanguage":"nl"},"CX":{"currencyCode":"AUD","currencySymbol":"$","currencyName":"Australia Dollar","currencyLanguage":"en"},"CY":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"el"},"CZ":{"currencyCode":"CZK","currencySymbol":"K\u010d","currencyName":"Czech Republic Koruna","currencyLanguage":"cs"},"DE":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"de"},"DG":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"en"},"DK":{"currencyCode":"DKK","currencySymbol":"kr","currencyName":"Denmark Krone","currencyLanguage":"da"},"DM":{"currencyCode":"XCD","currencySymbol":"$","currencyName":"East Caribbean Dollar","currencyLanguage":"en"},"DO":{"currencyCode":"DOP","currencySymbol":"RD$","currencyName":"Dominican Republic Peso","currencyLanguage":"es"},"EA":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"es"},"EC":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"es"},"EE":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"and"},"EG":{"currencyCode":"EGP","currencySymbol":"\xa3","currencyName":"Egypt Pound","currencyLanguage":"ar"},"ES":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"ast"},"EU":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"in"},"FI":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"fi"},"FJ":{"currencyCode":"FJD","currencySymbol":"$","currencyName":"Fiji Dollar","currencyLanguage":"fj"},"FK":{"currencyCode":"FKP","currencySymbol":"\xa3","currencyName":"Falkland Islands (Malvinas) Pound","currencyLanguage":"fkp"},"FM":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"en"},"FO":{"currencyCode":"DKK","currencySymbol":"kr","currencyName":"Denmark Krone","currencyLanguage":"fo"},"FR":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"fr"},"FX":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"fr"},"GB":{"currencyCode":"GBP","currencySymbol":"\xa3","currencyName":"United Kingdom Pound","currencyLanguage":"en-GB"},"GD":{"currencyCode":"XCD","currencySymbol":"$","currencyName":"East Caribbean Dollar","currencyLanguage":"en"},"GF":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"fr"},"GG":{"currencyCode":"GBP","currencySymbol":"\xa3","currencyName":"United Kingdom Pound","currencyLanguage":"en-GB"},"GI":{"currencyCode":"GIP","currencySymbol":"\xa3","currencyName":"Gibraltar Pound","currencyLanguage":"en"},"GL":{"currencyCode":"DKK","currencySymbol":"kr","currencyName":"Denmark Krone","currencyLanguage":"kl"},"GP":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"fr"},"GR":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"el"},"GS":{"currencyCode":"GBP","currencySymbol":"\xa3","currencyName":"United Kingdom Pound","currencyLanguage":"en-GB"},"GT":{"currencyCode":"GTQ","currencySymbol":"Q","currencyName":"Guatemala Quetzal","currencyLanguage":"es"},"GU":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"ch"},"GY":{"currencyCode":"GYD","currencySymbol":"$","currencyName":"Guyana Dollar","currencyLanguage":"en"},"HK":{"currencyCode":"HKD","currencySymbol":"$","currencyName":"Hong Kong Dollar","currencyLanguage":"zh-hant"},"HM":{"currencyCode":"AUD","currencySymbol":"$","currencyName":"Australia Dollar","currencyLanguage":"en"},"HN":{"currencyCode":"HNL","currencySymbol":"L","currencyName":"Honduras Lempira","currencyLanguage":"es"},"HR":{"currencyCode":"HRK","currencySymbol":"kn","currencyName":"Croatia Kuna","currencyLanguage":"hr"},"HU":{"currencyCode":"HUF","currencySymbol":"Ft","currencyName":"Hungary Forint","currencyLanguage":"hu"},"IC":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"es"},"ID":{"currencyCode":"IDR","currencySymbol":"Rp","currencyName":"Indonesia Rupiah","currencyLanguage":"id"},"IE":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"en"},"IL":{"currencyCode":"ILS","currencySymbol":"\u20aa","currencyName":"Israel Shekel","currencyLanguage":"he"},"IM":{"currencyCode":"GBP","currencySymbol":"\xa3","currencyName":"United Kingdom Pound","currencyLanguage":"en-GB"},"IN":{"currencyCode":"INR","currencySymbol":"\u20b9","currencyName":"India Rupee","currencyLanguage":"hi"},"IO":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"en"},"IR":{"currencyCode":"IRR","currencySymbol":"\ufdfc","currencyName":"Iran Rial","currencyLanguage":"fa"},"IS":{"currencyCode":"ISK","currencySymbol":"kr","currencyName":"Iceland Krona","currencyLanguage":"is"},"IT":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"it"},"JE":{"currencyCode":"GBP","currencySymbol":"\xa3","currencyName":"United Kingdom Pound","currencyLanguage":"fr"},"JM":{"currencyCode":"JMD","currencySymbol":"J$","currencyName":"Jamaica Dollar","currencyLanguage":"jam"},"JP":{"currencyCode":"JPY","currencySymbol":"\xa5","currencyName":"Japan Yen","currencyLanguage":"ja"},"KG":{"currencyCode":"KGS","currencySymbol":"\u043b\u0432","currencyName":"Kyrgyzstan Som","currencyLanguage":"ky"},"KH":{"currencyCode":"KHR","currencySymbol":"\u17db","currencyName":"Cambodia Riel","currencyLanguage":"km"},"KI":{"currencyCode":"AUD","currencySymbol":"$","currencyName":"Australia Dollar","currencyLanguage":"en"},"KN":{"currencyCode":"XCD","currencySymbol":"$","currencyName":"East Caribbean Dollar","currencyLanguage":"en"},"KP":{"currencyCode":"KPW","currencySymbol":"\u20a9","currencyName":"Korea (North) Won","currencyLanguage":"ko"},"KR":{"currencyCode":"KRW","currencySymbol":"\u20a9","currencyName":"Korea (South) Won","currencyLanguage":"ko"},"KY":{"currencyCode":"KYD","currencySymbol":"$","currencyName":"Cayman Islands Dollar","currencyLanguage":"en"},"KZ":{"currencyCode":"KZT","currencySymbol":"\u043b\u0432","currencyName":"Kazakhstan Tenge","currencyLanguage":"kk"},"LA":{"currencyCode":"LAK","currencySymbol":"\u20ad","currencyName":"Laos Kip","currencyLanguage":"lo"},"LB":{"currencyCode":"LBP","currencySymbol":"\xa3","currencyName":"Lebanon Pound","currencyLanguage":"ar"},"LC":{"currencyCode":"XCD","currencySymbol":"$","currencyName":"East Caribbean Dollar","currencyLanguage":"en"},"LI":{"currencyCode":"CHF","currencySymbol":"CHF","currencyName":"Switzerland Franc","currencyLanguage":"of"},"LK":{"currencyCode":"LKR","currencySymbol":"\u20a8","currencyName":"Sri Lanka Rupee","currencyLanguage":"if"},"LR":{"currencyCode":"LRD","currencySymbol":"$","currencyName":"Liberia Dollar","currencyLanguage":"en"},"LT":{"currencyCode":"LTL","currencySymbol":"Lt","currencyName":"Lithuania Litas","currencyLanguage":"lt"},"LU":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"de-lu"},"LV":{"currencyCode":"LVL","currencySymbol":"Ls","currencyName":"Latvia Lat","currencyLanguage":"lv"},"MC":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"fr"},"ME":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"srp"},"MF":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"fr"},"MH":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"en"},"MK":{"currencyCode":"MKD","currencySymbol":"\u0434\u0435\u043d","currencyName":"Macedonia Denar","currencyLanguage":"mk"},"MN":{"currencyCode":"MNT","currencySymbol":"\u20ae","currencyName":"Mongolia Tughrik","currencyLanguage":"mn"},"MP":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"en"},"MQ":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"fr"},"MS":{"currencyCode":"XCD","currencySymbol":"$","currencyName":"East Caribbean Dollar","currencyLanguage":"en"},"MT":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"mt"},"MU":{"currencyCode":"MUR","currencySymbol":"\u20a8","currencyName":"Mauritius Rupee","currencyLanguage":"mfe"},"MX":{"currencyCode":"MXN","currencySymbol":"$","currencyName":"Mexico Peso","currencyLanguage":"mx"},"MY":{"currencyCode":"MYR","currencySymbol":"RM","currencyName":"Malaysia Ringgit","currencyLanguage":"ms"},"MZ":{"currencyCode":"MZN","currencySymbol":"MT","currencyName":"Mozambique Metical","currencyLanguage":"pt"},"NA":{"currencyCode":"NAD","currencySymbol":"$","currencyName":"Namibia Dollar","currencyLanguage":"en"},"NF":{"currencyCode":"AUD","currencySymbol":"$","currencyName":"Australia Dollar","currencyLanguage":"en"},"NG":{"currencyCode":"NGN","currencySymbol":"\u20a6","currencyName":"Nigeria Naira","currencyLanguage":"ngn"},"NI":{"currencyCode":"NIO","currencySymbol":"C$","currencyName":"Nicaragua Cordoba","currencyLanguage":"es"},"NL":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"nl"},"NO":{"currencyCode":"NOK","currencySymbol":"kr","currencyName":"Norway Krone","currencyLanguage":"nb"},"NP":{"currencyCode":"NPR","currencySymbol":"\u20a8","currencyName":"Nepal Rupee","currencyLanguage":"ne"},"NR":{"currencyCode":"AUD","currencySymbol":"$","currencyName":"Australia Dollar","currencyLanguage":"na"},"NU":{"currencyCode":"NZD","currencySymbol":"$","currencyName":"New Zealand Dollar","currencyLanguage":"niu"},"NZ":{"currencyCode":"NZD","currencySymbol":"$","currencyName":"New Zealand Dollar","currencyLanguage":"mi"},"OM":{"currencyCode":"OMR","currencySymbol":"\ufdfc","currencyName":"Oman Rial","currencyLanguage":"ar"},"PA":{"currencyCode":"PAB","currencySymbol":"B/.","currencyName":"Panama Balboa","currencyLanguage":"es"},"PE":{"currencyCode":"PEN","currencySymbol":"S/.","currencyName":"Peru Nuevo Sol","currencyLanguage":"es"},"PH":{"currencyCode":"PHP","currencySymbol":"\u20b1","currencyName":"Philippines Peso","currencyLanguage":"php"},"PK":{"currencyCode":"PKR","currencySymbol":"\u20a8","currencyName":"Pakistan Rupee","currencyLanguage":"pkr"},"PL":{"currencyCode":"PLN","currencySymbol":"z\u0142","currencyName":"Poland Zloty","currencyLanguage":"pl"},"PM":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"fr"},"PN":{"currencyCode":"NZD","currencySymbol":"$","currencyName":"New Zealand Dollar","currencyLanguage":"nzd"},"PR":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"es"},"PT":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"pt"},"PW":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"en"},"PY":{"currencyCode":"PYG","currencySymbol":"Gs","currencyName":"Paraguay Guarani","currencyLanguage":"es"},"QA":{"currencyCode":"QAR","currencySymbol":"\ufdfc","currencyName":"Qatar Riyal","currencyLanguage":"ar"},"RE":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"fr"},"RO":{"currencyCode":"RON","currencySymbol":"lei","currencyName":"Romania New Leu","currencyLanguage":"ro"},"RS":{"currencyCode":"RSD","currencySymbol":"\u0414\u0438\u043d.","currencyName":"Serbia Dinar","currencyLanguage":"sr"},"RU":{"currencyCode":"RUB","currencySymbol":"\u0440\u0443\u0431","currencyName":"Russia Ruble","currencyLanguage":"ru"},"SA":{"currencyCode":"SAR","currencySymbol":"\ufdfc","currencyName":"Saudi Arabia Riyal","currencyLanguage":"ar"},"SB":{"currencyCode":"SBD","currencySymbol":"$","currencyName":"Solomon Islands Dollar","currencyLanguage":"sbd"},"SC":{"currencyCode":"SCR","currencySymbol":"\u20a8","currencyName":"Seychelles Rupee","currencyLanguage":"fr"},"SE":{"currencyCode":"SEK","currencySymbol":"kr","currencyName":"Sweden Krona","currencyLanguage":"sv"},"SG":{"currencyCode":"SGD","currencySymbol":"$","currencyName":"Singapore Dollar","currencyLanguage":"zh-hans"},"SH":{"currencyCode":"SHP","currencySymbol":"\xa3","currencyName":"Saint Helena Pound","currencyLanguage":"shp"},"SI":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"sl"},"SJ":{"currencyCode":"NOK","currencySymbol":"kr","currencyName":"Norway Krone","currencyLanguage":"no"},"SK":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"sk"},"SM":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"it"},"SO":{"currencyCode":"SOS","currencySymbol":"S","currencyName":"Somalia Shilling","currencyLanguage":"so"},"SR":{"currencyCode":"SRD","currencySymbol":"$","currencyName":"Suriname Dollar","currencyLanguage":"nl"},"SU":{"currencyCode":"RUB","currencySymbol":"\u0440\u0443\u0431","currencyName":"Russia Ruble","currencyLanguage":"ru"},"SV":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"es"},"SX":{"currencyCode":"ANG","currencySymbol":"\u0192","currencyName":"Netherlands Antilles Guilder","currencyLanguage":"nl"},"SY":{"currencyCode":"SYP","currencySymbol":"\xa3","currencyName":"Syria Pound","currencyLanguage":"ar"},"TA":{"currencyCode":"GBP","currencySymbol":"\xa3","currencyName":"United Kingdom Pound","currencyLanguage":"en-GB"},"TC":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"en"},"TF":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"fr"},"TH":{"currencyCode":"THB","currencySymbol":"\u0e3f","currencyName":"Thailand Baht","currencyLanguage":"th"},"TK":{"currencyCode":"NZD","currencySymbol":"$","currencyName":"New Zealand Dollar","currencyLanguage":"tkl"},"TL":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"pt"},"TR":{"currencyCode":"TRY","currencySymbol":"\u20ba","currencyName":"Turkey Lira","currencyLanguage":"tr"},"TT":{"currencyCode":"TTD","currencySymbol":"TT$","currencyName":"Trinidad and Tobago Dollar","currencyLanguage":"ttd"},"TV":{"currencyCode":"AUD","currencySymbol":"$","currencyName":"Australia Dollar","currencyLanguage":"en"},"TW":{"currencyCode":"TWD","currencySymbol":"NT$","currencyName":"Taiwan New Dollar","currencyLanguage":"zh-hant"},"UA":{"currencyCode":"UAH","currencySymbol":"\u20b4","currencyName":"Ukraine Hryvnia","currencyLanguage":"uk"},"UK":{"currencyCode":"GBP","currencySymbol":"\xa3","currencyName":"United Kingdom Pound","currencyLanguage":"en-GB"},"UM":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"en"},"US":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"en"},"UY":{"currencyCode":"UYU","currencySymbol":"$U","currencyName":"Uruguay Peso","currencyLanguage":"es"},"UZ":{"currencyCode":"UZS","currencySymbol":"\u043b\u0432","currencyName":"Uzbekistan Som","currencyLanguage":"uz"},"VA":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"en"},"VC":{"currencyCode":"XCD","currencySymbol":"$","currencyName":"East Caribbean Dollar","currencyLanguage":"xcd"},"VE":{"currencyCode":"VEF","currencySymbol":"Bs","currencyName":"Venezuela Bolivar","currencyLanguage":"es"},"VG":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"en"},"VI":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"en"},"VN":{"currencyCode":"VND","currencySymbol":"\u20ab","currencyName":"Viet Nam Dong","currencyLanguage":"vi"},"YE":{"currencyCode":"YER","currencySymbol":"\ufdfc","currencyName":"Yemen Rial","currencyLanguage":"ar"},"YT":{"currencyCode":"EUR","currencySymbol":"\u20ac","currencyName":"Euro","currencyLanguage":"fr"},"ZA":{"currencyCode":"ZAR","currencySymbol":"R","currencyName":"South Africa Rand","currencyLanguage":"zar"},"ZW":{"currencyCode":"USD","currencySymbol":"$","currencyName":"United States Dollar","currencyLanguage":"en"}}')},1059:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(5)),a=c(r(1060)),o=c(r(0)),u=c(r(15)),i=c(r(4)),s=c(r(35));function c(e){return e&&e.__esModule?e:{default:e}}var d=o.default.duration(30,"minutes").asSeconds(),l=o.default.duration(6,"hours").asSeconds(),f={},p={},g=(0,s.default)({max:3,maxAge:18e5});function h(){return u.default.get("https://d.joinhoney.com/v2/stores/modules/list").then((function(e){return(p=Object.assign({},e.body)).lastUpdated=o.default.unix(),p}))}function y(e,t){return u.default.get("https://d.joinhoney.com/v2/stores/module/"+t+"/"+e).then((function(r){var n={acorn:JSON.parse(a.default.decode(r.body.acorn)),options:r.body.options,lastChecked:(0,o.default)().unix()},u=e+":"+t;return g.set(u,n),n}))}function v(e,t){if(!e)return n.default.reject(new InvalidParametersError("storeId"));if(!t)return n.default.reject(new InvalidParametersError("type"));var r=e+":"+t;return f[r]||(f[r]=n.default.resolve().then((function(){return n.default.resolve().then((function(){if(!p.lastUpdated||(0,o.default)().unix()-p.lastUpdated>l)throw new NotFoundError;return(0,o.default)().unix()-p.lastUpdated>d&&h().reflect(),p})).catch((function(){return h()})).catch((function(){return h()})).catch((function(){return n.default.delay(2e3).then((function(){return h()}))})).then((function(r){if(!r[e]||!r[e][t])throw new OperationSkippedError("Store "+e+" has no associated acorn of type "+t)}))})).then((function(){var a=g.get(r);return a||y(e,t).catch((function(){return y(e,t)})).catch((function(){return n.default.delay(2e3).then((function(){return y(e,t)}))}))})).catch(OperationSkippedError,(function(){return{acorn:null}})).finally((function(){delete f[r]}))),f[r]}setInterval((function(){return g.prune()}),3e5),i.default.addListener("acorns:action",(function(e,t){var r=t&&t.data||{};switch(t&&t.action){case"getStoreAcorn":return v(r.storeId,r.type);default:throw new InvalidParametersError("Invalid store action")}})),t.default={getStoreDacAcorn:function(e){return v(e,"dac")},getStoreProdAcorn:function(e){return v(e,"prod")}}},1073:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(73),t.default={addBeforeRequestListener:function(e,t){var r=["requestBody"];t&&t.blocking&&r.unshift("blocking"),browser.webRequest.onBeforeRequest.addListener(e,{urls:t&&t.urls||["<all_urls>"],types:t&&t.types,tabId:t&&t.tabId},r)},removeBeforeRequestListener:function(e){browser.webRequest.onBeforeRequest.removeListener(e)},addBeforeSendHeadersListener:function(e,t){var r=["requestHeaders"];t&&t.blocking&&r.unshift("blocking"),browser.webRequest.onBeforeSendHeaders.addListener(e,{urls:t&&t.urls||["<all_urls>"],types:t&&t.types,tabId:t&&t.tabId},r)},removeBeforeSendHeadersListener:function(e){browser.webRequest.onBeforeSendHeaders.removeListener(e)},addSendHeadersListener:function(e,t){browser.webRequest.onSendHeaders.addListener(e,{urls:t&&t.urls||["<all_urls>"],types:t&&t.types,tabId:t&&t.tabId},["requestHeaders"])},removeSendHeadersListener:function(e){browser.webRequest.onSendHeaders.removeListener(e)},addHeadersReceivedListener:function(e,t){var r=["responseHeaders"];t&&t.blocking&&r.unshift("blocking"),browser.webRequest.onHeadersReceived.addListener(e,{urls:t&&t.urls||["<all_urls>"],types:t&&t.types,tabId:t&&t.tabId},r)},removeHeadersReceivedListener:function(e){browser.webRequest.onHeadersReceived.removeListener(e)},addAuthRequiredListener:function(e,t){var r=["responseHeaders"];t&&t.blocking&&r.unshift("blocking"),browser.webRequest.onAuthRequired.addListener(e,{urls:t&&t.urls||["<all_urls>"],types:t&&t.types,tabId:t&&t.tabId},r)},removeAuthRequiredListener:function(e){browser.webRequest.onAuthRequired.removeListener(e)},addBeforeRedirectListener:function(e,t){browser.webRequest.onBeforeRedirect.addListener(e,{urls:t&&t.urls||["<all_urls>"],types:t&&t.types,tabId:t&&t.tabId},["responseHeaders"])},removeBeforeRedirectListener:function(e){browser.webRequest.onBeforeRedirect.removeListener(e)},addResponseStartedListener:function(e,t){browser.webRequest.onResponseStarted.addListener(e,{urls:t&&t.urls||["<all_urls>"],types:t&&t.types,tabId:t&&t.tabId},["responseHeaders"])},removeResponseStartedListener:function(e){browser.webRequest.onResponseStarted.removeListener(e)},addCompleteListener:function(e,t){browser.webRequest.onCompleted.addListener(e,{urls:t&&t.urls||["<all_urls>"],types:t&&t.types,tabId:t&&t.tabId},["responseHeaders"])},removeCompleteListener:function(e){browser.webRequest.onCompleted.removeListener(e)},addErrorOccurredListener:function(e,t){browser.webRequest.onErrorOccurred.addListener(e,{urls:t&&t.urls||["<all_urls>"],types:t&&t.types,tabId:t&&t.tabId})},removeErrorOccurredListener:function(e){browser.webRequest.onErrorOccurred.removeListener(e)}}},1074:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(0)),a=s(r(191)),o=s(r(129)),u=s(r(3)),i=s(r(20));function s(e){return e&&e.__esModule?e:{default:e}}var c=n.default.duration(20,"minutes").asMilliseconds(),d=n.default.duration(6,"hours").asMilliseconds(),l=n.default.duration(1,"day").asMilliseconds(),f=0;function p(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];f>Date.now()-d&&!e||(f=Date.now(),i.default.sendEvent("ext000001",null,{immediate:!0}).catch((function(e){return u.default.error("Failed to send heartbeat",e)})).then((function(){try{window.localStorage.setItem("device:lastHeartbeat",f)}catch(e){}var e=void 0;try{e=f===parseInt(window.localStorage.getItem("device:lastHeartbeat"),10)}catch(t){e=!1}var t=0,r={};try{Object.keys(window.localStorage).forEach((function(e){var n=window.localStorage.getItem(e),a="string"==typeof n&&n.length||0;r[e]=a,t+=a}))}catch(e){}i.default.sendEvent("ext000005",{storage:{healthy:e,used:t,keys:JSON.stringify(r)}}).reflect()})).catch((function(e){return u.default.error("Failed to perform post-heartbeat actions",e)})))}var g=0;function h(){g>Date.now()-l||(g=Date.now(),o.default.getFeatureFlag("ext_paypal_heartbeat",{ttl:288e5}).then((function(e){e&&a.default.get("https://history.paypal.com/targeting/set-plugin?src=honey").then().catch((function(){}))})))}try{var y=parseInt(window.localStorage.getItem("device:lastHeartbeat"),10);if(y>0&&y<(0,n.default)().subtract(3,"weeks").unix()){var v=n.default.unix(y);i.default.sendEvent("ext000004",{local_last_seen:1e3*y,local_time_now:(0,n.default)().valueOf(),dormant_sec:(0,n.default)().diff(v,"seconds"),dormant_days:(0,n.default)().diff(v,"days")})}}catch(e){}setTimeout(p,0),setInterval(p,c),setTimeout(h,0),setInterval(h,c),t.default={sendHeartbeat:p,sendPaypalHeartbeat:h}},1075:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});"function"==typeof Symbol&&Symbol.iterator;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r(73);var a={trace:100,debug:200,info:300,warn:400,error:500};function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(""+(e||"")).trim()||t}var u=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level="error",this.levelNum=a[this.level],Object.keys(a).forEach((function(e){var n=a[e];r[e]=function(u,i){try{if(n<r.levelNum)return null;var s=i||{};if(n>=a.error){var c={curLevel:e,level_num:n,name:"Error"};if(u instanceof Error)c.name=o(u.name,"Error"),c.stack=o(u.stack),c.message=o(u.message),Object.getOwnPropertyNames(u).forEach((function(e){var t=u[e];"function"!=typeof t&&"name"!==e&&"message"!==e&&"stack"!==e&&(s[e]=t)}));else if("string"==typeof u)c.message=u;else try{c.message=JSON.stringify(u)}catch(e){}try{Object.keys(s).length>0&&(c.xtra=JSON.stringify(s))}catch(e){}"function"==typeof t&&t({exception:c,referrer_url:"background"})}}catch(e){}return null}}))}return n(e,[{key:"getLevel",value:function(){return this.level}},{key:"setLevel",value:function(e){if(!e)throw new InvalidParametersError("level");var t=a[e];if(!t)throw new InvalidParametersError("level");this.level=e,this.levelNum=t}}]),e}();t.default=u},1076:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(73);var n=u(r(5)),a=u(r(15)),o=u(r(192));function u(e){return e&&e.__esModule?e:{default:e}}function i(){return n.default.reject(new NotImplementedError)}function s(){return n.default.reject(new NotImplementedError)}function c(){return n.default.reject(new NotImplementedError)}function d(e){return new n.default((function(t,r){"joinhoney.com"===e?a.default.get("https://d.joinhoney.com/extdata/ckdata").then((function(e){var r,n;t((r=e.body,n=[],Object.keys(r).forEach((function(e){n.push({name:e,value:r[e]})})),n))})):r(new NotImplementedError)}))}browser.runtime.onMessage.addListener((function(e,t,r){return!(!e||"cookies:cs"!==e.service)&&(n.default.try((function(){switch(e.type){case"get":return s(e.cookieDetails);case"set":return i(e.cookieDetails);case"remove":return c(e.cookieDetails);case"getAllForDomain":return d(e.domain);default:throw new InvalidParametersError("type")}})).then((function(e){try{r({success:!0,data:e})}catch(e){}})).catch((function(e){try{r({success:!1,error:e&&(e.message||e.name)})}catch(e){}})),!0)})),o.default.addListener("open:options",(function(){browser.runtime.openOptionsPage()})),t.default={set:i,get:s,remove:c,getAllForDomain:d}},1077:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={addOnConnectListener:function(e){return browser.runtime.onConnect.addListener(e)},getManifest:function(){return browser.runtime.getManifest()},removeOnConnnectListener:function(e){return browser.runtime.onConnect.removeListener(e)}}},1078:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=r(1079),o=(n=a)&&n.__esModule?n:{default:n};t.default={local:new o.default("local"),sync:new o.default("sync"),bundled:{isAvailable:function(){return!0},getAssetURL:function(e){return browser.runtime.getURL(e)}}}},1079:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(5),u=(n=o)&&n.__esModule?n:{default:n};var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.chromeStorage=browser.storage[t]}return a(e,[{key:"isAvailable",value:function(){return!!this.chromeStorage}},{key:"get",value:function(e,t){var r=this;return new u.default((function(n,a){r.chromeStorage.get(e,(function(r){var o=browser.runtime.lastError;if(o)return o.message+=": GET ERROR",void a(new StorageError(JSON.stringify(o.message)));var u=r&&r[e];void 0!==u?n(t&&t.raw?u:JSON.parse(u)):a(new NotFoundError)}))}))}},{key:"set",value:function(e,t){var r=this;return new u.default((function(n,a){r.chromeStorage.set(function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},e,JSON.stringify(t)),(function(){var e=browser.runtime.lastError;if(e)return e.message+=": SET ERROR",void a(new StorageError(JSON.stringify(e.message)));n(t)}))}))}},{key:"del",value:function(e){var t=this;return new u.default((function(r,n){t.chromeStorage.remove(e,(function(){var e=browser.runtime.lastError;if(e)return e.message+=": DEL ERROR",void n(new StorageError(JSON.stringify(e.message)));r()}))}))}},{key:"clear",value:function(){var e=this;return new u.default((function(t,r){e.chromeStorage.clear((function(){var e=browser.runtime.lastError;if(e)return e.message+=": CLEAR ERROR",void r(new StorageError(JSON.stringify(e.message)));t()}))}))}},{key:"getAll",value:function(){var e=this;return new u.default((function(t,r){e.chromeStorage.get(null,(function(e){var n=browser.runtime.lastError;if(n)return n.message+=": GET ALL ERROR",void r(new StorageError(JSON.stringify(n.message)));t(e)}))}))}},{key:"getBytesInUse",value:function(e){var t=this;return new u.default((function(r,n){t.chromeStorage.getBytesInUse(e,(function(e){var t=browser.runtime.lastError;if(t)return t.message+=": GETBYTESINUSE ERROR",void n(new StorageError(JSON.stringify(t.message)));r(e)}))}))}}]),e}();t.default=i},1080:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r(73);var a=u(r(5)),o=u(r(19));function u(e){return e&&e.__esModule?e:{default:e}}var i=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.nativeStorage=r}return n(e,[{key:"isAvailable",value:function(){return this.nativeStorage.isAvailable()}},{key:"get",value:function(e,t){var r=this;return a.default.try((function(){if(!r.isAvailable())throw new UnavailableError(r.type+" storage unavailable");var n=o.default.cleanString(e);if(!n)throw new InvalidParametersError("key");return r.nativeStorage.get(n,t)})).catch(StorageError,(function(){if(e.match(/user:id|user:device-id/))return"0";throw new NotFoundError}))}},{key:"set",value:function(e,t,r){var n=this;return a.default.try((function(){if(!n.isAvailable())throw new UnavailableError(n.type+" storage unavailable");var a=o.default.cleanString(e);if(!a)throw new InvalidParametersError("key");return void 0===t?n.nativeStorage.del(a,r):n.nativeStorage.set(a,t,r)}))}},{key:"del",value:function(e,t){var r=this;return a.default.try((function(){if(!r.isAvailable())throw new UnavailableError(r.type+" storage unavailable");var n=o.default.cleanString(e);if(!n)throw new InvalidParametersError("key");return r.nativeStorage.del(n,t)})).catch(StorageError,(function(){}))}},{key:"getAll",value:function(){return a.default.resolve()}},{key:"getBytesInUse",value:function(e){return a.default.resolve()}},{key:"prefixed",value:function(e){var t=this;return{isAvailable:function(){return t.isAvailable()},del:function(r,n){return t.del(e+":"+r,n)},get:function(r,n){return t.get(e+":"+r,n)},set:function(r,n,a){return t.set(e+":"+r,n,a)}}}},{key:"_getStorageToSave",value:function(){var e=[/^user:.*/,/^amazon-optimus/,/^install:synced/,/^reviewed/,/^stores:session/,/^storage:lastWiped/];return this.nativeStorage.getAll().then((function(t){var r={};return Object.keys(t).forEach((function(n){var a=t[n];if(a.opts&&a.opts.persist||e.some((function(e){return e.test(n)}))){try{a=JSON.parse(a)}catch(e){}r[n]=a}})),r}))}},{key:"clearUnimportant",value:function(){var e=this;return this._getStorageToSave().then((function(t){return e.nativeStorage.clear().then((function(){return e.set("storage:lastWiped",Date.now()),a.default.map(Object.keys(t),(function(r){var n=t[r];return e.nativeStorage.set(r,n)}))}))}))}}]),e}();t.default=i},1081:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(1082)),a=u(r(4)),o=u(r(579));function u(e){return e&&e.__esModule?e:{default:e}}var i={get:function(e){return window.localStorage.getItem(e)},set:function(e,t){return window.localStorage.setItem(e,t)},del:function(e){return window.localStorage.removeItem(e)}};var s=(0,n.default)({localStorage:i,loginRedirect:function(){a.default.send("ui:action",{action:"open",data:{path:"main/profile/auth",force:!0}},{ignoreResponse:!0}).catch()},fetchOverride:o.default,customRefreshUri:"https://d.joinhoney.com/v3"});t.default=s},1091:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=(n=l(regeneratorRuntime.mark((function e(t){var r,n,o,d,f,p=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.default.query("ext_getUserFollow",{userId:t,type:"STORE"});case 2:return r=e.sent,e.prev=3,e.next=6,u.default.query("ext_getStoresByIds",{storeIds:r.data.getUserFollow.values});case 6:return n=e.sent,o=n.data,e.next=10,Promise.all(o.getStoresByIds.map(function(){var e=l(regeneratorRuntime.mark((function e(t){var r,n,o,u,i,d,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.default.send("stores:action",{action:"getCouponStats",data:{storeId:t.storeId}},{background:!0});case 2:return r=e.sent,n=r.map((function(e){return parseFloat(e.successRate)})),o=(f=n).reduce((function(e,t){return e+t}))/f.length*100,u=t.gold&&t.gold.active,i=u?t.gold.max:0,d=u?t.gold:a({},t.gold,{max:0,min:0,maxFlatFee:0,minFlatFee:0}),l=c.default.calculateRankingScore(o,i,t.coupons.length),e.abrupt("return",a({},t,{id:t.storeId,numCoupons:t.coupons.count,couponSuccessRate:o,rankingScore:l,gold:d}));case 10:case"end":return e.stop()}var f}),e,p)})));return function(t){return e.apply(this,arguments)}}()));case 10:return d=e.sent,f=d.sort((function(e,t){return t.rankingScore-e.rankingScore})),e.abrupt("return",f.length>50?d.slice(0,49):d);case 15:return e.prev=15,e.t0=e.catch(3),i.default.error(e.t0),e.abrupt("return",[]);case 19:case"end":return e.stop()}}),e,this,[[3,15]])}))),function(e){return n.apply(this,arguments)}),u=d(r(8)),i=d(r(3)),s=d(r(4)),c=d(r(580));function d(e){return e&&e.__esModule?e:{default:e}}function l(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}t.default={fetchFollowedStats:o}},1094:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r(73);var a=u(r(5)),o=u(r(192));function u(e){return e&&e.__esModule?e:{default:e}}var i={};function s(e){return i[e]}function c(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return new a.default((function(n){browser.browserAction.setIcon({path:{16:"icons/"+e+"-16.png",24:"icons/"+e+"-24.png",32:"icons/"+e+"-32.png",48:"icons/"+e+"-48.png"},tabId:t||void 0},(function(){browser.runtime.lastError?n(r>0&&c(e,t,r-1)):(i[t]=e,n(!0))}))}))}function d(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return a.default.try((function(){return browser.browserAction.setTitle({title:e,tabId:t}),!0})).catch((function(){return r>0&&d(e,t,r-1)}))}function l(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return a.default.try((function(){return browser.browserAction.setBadgeText({text:""+e,tabId:t}),!0})).catch((function(){return r>0&&l(e,t,r-1)}))}function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return a.default.try((function(){return browser.browserAction.setBadgeBackgroundColor({color:e,tabId:t||void 0}),!0})).catch((function(){return r>0&&f(e,t,r-1)}))}function p(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return a.default.try((function(){if(!e||!e.icon)throw new InvalidParametersError("button info must be provided with at least an icon");return c(e.icon,t,r)})).then((function(){var n=[];e.title&&n.push(d(e.title,t,r).reflect()),e.badgeColor&&n.push(f(e.badgeColor,t,r).reflect());var o=e.badgeText||"";return n.push(l(o,t,r).reflect()),a.default.all(n)})).then((function(){return!0}))}browser.browserAction.onClicked.addListener((function(e){"object"===(void 0===e?"undefined":n(e))&&e.id&&o.default.send("button:bg:clicked",{},{tab:e.id,ignoreResponse:!0})})),browser.runtime.onMessage.addListener((function(e,t,r){if(!e||"button:cs"!==e.service)return!1;var n=t&&t.tab&&t.tab.id;return n?(a.default.try((function(){switch(e.type){case"getLastSetIcon":return s(n);case"setButtonInfo":return p(e.info,n);default:throw new InvalidParametersError("type")}})).then((function(e){try{r({success:!0,result:e})}catch(e){}})).catch((function(e){try{r({success:!1,error:e&&(e.message||e.name)})}catch(e){}})),!0):r({success:!1,error:"invalid_tab"})})),t.default={animateIcon:function(){return a.default.resolve()},getLastSetIcon:s,setButtonInfo:p}},1095:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n,a=r(15),o=(n=a)&&n.__esModule?n:{default:n};t.default={getHpid:function(t,r){var n=e.from(JSON.stringify({store_id:t.id,canonical_url:r.url})).toString("base64");return o.default.get("https://d.joinhoney.com/hpid").query({q:n}).then((function(e){return e.body}))}}}).call(this,r(56).Buffer)},1096:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},s=(n=regeneratorRuntime.mark((function e(t){var r,n,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.assign({},t),e.next=3,c.default.all([(d="gold_incrementality",h.default.send("experiments:bg",{action:"getVariant",data:{name:d}},{background:!0})),y.default.getUserABGroup("goldIncrementality_v2")]);case 3:return n=e.sent,a=i(n,2),o=a[0],s=a[1],"control"!==o&&s&&s.stores&&s.stores[t.id]&&(S("gold_incrementality"),"on"===o&&"on"===s.group?(r.gold=u({},t.gold,{min:s.stores[t.id].min,max:s.stores[t.id].max,description:"Some exclusions may apply."}),r.metadata=u({},t.metadata,{goldIncrementality:!0})):"off"===o&&(r.standDown="nopopup",r.standDownMethod="nopopup",r.standDownValue=3,r.gold={},r.coupons=[])),e.abrupt("return",r);case 9:case"end":return e.stop()}var d}),e,this)})),a=function(){var e=n.apply(this,arguments);return new c.default((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return c.default.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return a.apply(this,arguments)}),c=v(r(5)),d=v(r(0)),l=v(r(571)),f=v(r(35)),p=v(r(15)),g=v(r(3)),h=v(r(4)),y=v(r(21));function v(e){return e&&e.__esModule?e:{default:e}}function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var b=(0,f.default)({max:5,maxAge:18e5});setInterval((function(){return b.prune()}),3e5);var w={};var I=!1;function S(e){return h.default.send("experiments:bg",{action:"trackImpression",data:{name:e}},{background:!0,ignoreResponse:!0})}h.default.addListener("si:on",(function(e,t){t&&t.si_ext&&(I=!0)})),window.overrideStoreMetadata=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=b.get(e);r&&(Object.assign(r.metadata,t),b.set(e,r))};var _=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"getStoreInfo",value:function(e){var t=this;if(I)return c.default.try((function(){return t.fetchStoreInfoFromServer(e)})).then(s).catch(NotFoundError,(function(){return{id:e,supported:!1}})).then((function(e){var t=Object.assign({},e);return delete t.expiresSoft,t}));if(w[e])return w[e];var r=b.get(e);if(r){var n=(0,d.default)().unix();return r.expiresSoft>n||(w[e]=this.fetchStoreInfoFromServer(e).finally((function(){return delete w[e]}))),c.default.resolve(r)}return w[e]=c.default.try((function(){return t.fetchStoreInfoFromServer(e)})).then(s).catch(NotFoundError,(function(){return{id:e,supported:!1}})).then((function(t){var r=Object.assign({},t);return b.set(e,t),delete r.expiresSoft,r})).finally((function(){delete w[e]})),w[e]}},{key:"fetchStoreInfoFromServer",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return c.default.try((function(){if(t.serverFetchBackoff&&t.serverFetchBackoff.nextTs>(0,d.default)().unix())throw new UnavailableError;return delete t.serverFetchBackoff,I?p.default.get("https://d.joinhoney.com/stores/"+e).query({coupons:1,stats:1,ugc:1,gold:1,max_ugcs:3,nocache:1,success_count:1}):p.default.get("https://d.joinhoney.com/stores/"+e).query({coupons:1,stats:1,ugc:1,gold:1,max_ugcs:3,success_count:1})})).then((function(e){var t=e.body;if(!t||!t.id)throw new NotFoundError;var r=Object.keys(t).reduce((function(e,r){return Object.assign({},e,m({},l.default.camel(r),t[r]))}),{});return r.expiresSoft=(0,d.default)().add(10,"minutes").unix(),r})).catch(NotFoundError,(function(){return{id:e,supported:!1,expiresSoft:(0,d.default)().add(10,"minutes").unix()}})).catch((function(){if(r>0)return g.default.debug("Failed to fetch information for store "+e+" from the server ("+r+" retries left)"),c.default.delay(500).then((function(){return t.fetchStoreInfoFromServer(e,r-1)}));throw t.serverFetchBackoff=t.serverFetchBackoff||{},t.serverFetchBackoff.delay=Math.min(2*t.serverFetchBackoff.delay,30)||4,t.serverFetchBackoff.nextTs=(0,d.default)().unix()+t.serverFetchBackoff.delay,g.default.debug("Failed to fetch information for store "+e+" from the server: backing off for "+t.serverFetchBackoff.delay+" seconds"),new UnavailableError}))}}]),e}());t.default=_},1097:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o,u=(n=regeneratorRuntime.mark((function e(t){var r,n,a,o=t.currentStoreId,u=void 0===o?null:o,i=t.currency,c=void 0===i?"USD":i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.default.query("ext_getPayoutStores",{currency:c});case 2:return r=e.sent,n=r.data,a=n.getPayoutStores,e.abrupt("return",a.filter((function(e){return e.active&&!e.hidden&&e.store&&e.store.name})).sort((function(e){return e.storeId===u?-1:e.viewPosition})));case 6:case"end":return e.stop()}}),e,this)})),a=function(){var e=n.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return a.apply(this,arguments)}),i=r(8),s=(o=i)&&o.__esModule?o:{default:o};t.default={getActivePayoutStores:u}},1098:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(5)),a=s(r(194)),o=s(r(0)),u=s(r(15)),i=s(r(47));function s(e){return e&&e.__esModule?e:{default:e}}function c(){return u.default.get("https://d.joinhoney.com/csbk/offers?mode=popular").then((function(e){var t=e.body,r={offers:t,expires:(0,o.default)().add(1,"hour").unix()};return i.default.set("popularOffers",r).reflect(),(0,a.default)(t)}))}var d=void 0;t.default={getPopularOffers:function(){return d||(d=n.default.try((function(){return i.default.get("popularOffers")})).then((function(e){return e&&e.expires>(0,o.default)().unix()?e.offers:c()})).catch(NotFoundError,(function(){return c()})).finally((function(){d=null})))}}},1099:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=u(r(5)),o=u(r(276));function u(e){return e&&e.__esModule?e:{default:e}}var i={};t.default={fetchStorePdpRegex:function(e){return!i.stores||!i.expires||i.expires<Date.now()?a.default.try((function(){return o.default.get("https://cdn.honey.io/pdpengine-stores.json")})).then((function(t){var r=t.body;return r&&"object"===n(r.stores)&&(i.stores=r.stores,i.expires=Date.now()+3*r.ttl*1e3,e in r.stores)?r.stores[e]:[]})).timeout(4e3).catch((function(){return i.stores={},i.expires=Date.now()+6e4,[]})):e in i.stores?i.stores[e]:[]}}},1100:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=r(15),o=(n=a)&&n.__esModule?n:{default:n};var u={};t.default={searchStores:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=(""+(e||"")).trim();if(!n)throw new InvalidParametersError("stores search query");return u[n]||(u[n]=o.default.get("https://d.joinhoney.com/stores/search").query({search:n}).query({limit:r}).query({stats:t?1:0}).query({gold:1}).then((function(e){return e.body&&Array.isArray(e.body.stores)&&e.body.stores.length?e.body.stores:[]})).finally((function(){delete u[n]}))),u[n]}}},1101:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=p(r(5)),o=p(r(194)),u=p(r(0)),i=r(586),s=p(r(193)),c=p(r(3)),d=p(r(4)),l=p(r(20)),f=p(r(19));function p(e){return e&&e.__esModule?e:{default:e}}var g={tagged:!0,activated:!0,applyCodesDuration:!0,applyCodesShown:!0,applyCodesComplete:!0,applyCodesCancelled:!0,applyCodesClick:!0,userInitiated:!0,userHBC:!0,startPrice:!0,finalPrice:!0,applyCodesData:!0,taggedTs:!0,standUpTs:!0,standDownTs:!0,standDownMethod:!0,standUpTabId:!0,standDownValue:!0,hasStoodUp:!0,manualCoupon:!0,cleantag:!0,isBlockingCDN:!0},h=new(function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sessions={},setInterval(this.cleanup.bind(this),6e4),null}return n(e,[{key:"destroySessions",value:function(){this.sessions={}}},{key:"getStoreSessionId",value:function(e){return this.sessions[e]}},{key:"getSession",value:function(e){var t=this,r=f.default.cleanString(e),n=this.sessions[r];return a.default.try((function(){var e=(0,u.default)().add(3,"hours").unix();if(n&&n.expires>(0,u.default)().unix())n.expires=e;else{var a=s.default.getState();n={id:(0,u.default)().valueOf(),expires:e,attributes:{adblockState:a},tagged:!1},t.sessions[r]=n,d.default.send("stores:session:started",{storeId:r,sessionId:n.id},{allTabs:!0,background:!0,ignoreResponse:!0}).reflect(),(0,i.countSessions)(r),l.default.sendEvent("ext004001",{store:{id:r,session_id:n.id}}).reflect(),c.default.debug("Started session "+n.id+" for store "+r)}return n})).then((function(){return(0,o.default)(n)}))}},{key:"activateSession",value:function(e){var t=this.sessions[e];return!(!(t&&t.expires>(0,u.default)().unix())||t.activated)&&(t.activated=(0,u.default)().unix(),l.default.sendEvent("ext004002",{store:{id:e,sessionId:t.id}}).reflect(),!0)}},{key:"setSessionAttribute",value:function(e,t,r){if(!g[t])throw new InvalidParametersError("Invalid session attribute");var n=this.sessions[e];n&&n.expires>(0,u.default)().unix()&&(n.attributes[t]=r)}},{key:"cleanup",value:function(){var e=this,t=(0,u.default)().unix();return Object.keys(this.sessions).forEach((function(r){var n=e.sessions[r];n&&n.expires>t||delete e.sessions[r]})),null}}]),e}());t.default=h,window.sessions=h},1102:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o,u,i,s,c,d=(n=_(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.default.query("ext_getcouponSuccessData",{storeId:t});case 2:if(r=e.sent,(n=r.data)&&n.getCouponSuccessData.length){e.next=6;break}return e.abrupt("return",[{dateTime:"2020-03-20T17:00:00",successRate:"0.00",averageSavings:"0.00",storeId:"7361286992124265772"}]);case 6:return e.abrupt("return",n.getCouponSuccessData);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)}),l=(a=_(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.default.query("ext_getAvgGoldEarnedByStoreId",{storeId:t});case 2:if(r=e.sent,(n=r.data)&&n.getStoreById&&n.getStoreById.avgGoldEarned){e.next=7;break}return m.default.debug("ext_getAvgGoldEarnedByStoreId is returning bad data."),e.abrupt("return",0);case 7:return e.abrupt("return",n.getStoreById.avgGoldEarned);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)}),f=(o=_(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(R>Date.now()-E)){e.next=2;break}return e.abrupt("return",x);case 2:return e.next=4,v.default.query("ext_storeSales",{});case 4:if(t=e.sent,r=t.data,R=Date.now(),r&&r.getStoreSales){e.next=10;break}return m.default.debug("ext_storeSales is returning bad data."),e.abrupt("return",x);case 10:return x=r.getStoreSales.map((function(e){return e.storeId})),e.abrupt("return",x);case 12:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)}),p=(u=_(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.default.getUserId();case 2:if(r=e.sent,t&&r){e.next=5;break}return e.abrupt("return",!1);case 5:return e.abrupt("return",w.default.get("storeDoubleGold:"+r+":"+t).then((function(e){return e})).catch((function(){return v.default.query("growth_isValueInSegmentationList",{listName:"DOUBLE_GOLD_STORE_IDS",value:t}).then((function(e){var n=e.data;return n&&n.isValueInList?v.default.query("growth_isValueInSegmentationList",{listName:"DOUBLE_GOLD_USER_IDS",value:r}).then((function(e){var n=e.data;return b.default.sendEvent("exp000003",{variant_name:n&&n.isValueInList?"double_gold":"control",experiment_name:"growth_double_gold_test",bucketing_id:r,sub_src:t,store:{id:t}}).reflect(),n&&n.isValueInList?w.default.set("storeDoubleGold:"+r+":"+t,n.isValueInList,P).then((function(){return n.isValueInList})):w.default.set("storeDoubleGold:"+r+":"+t,!1,P).then((function(){return!1}))})).catch((function(){return m.default.debug("growth_isValueInSegmentationList with listName DOUBLE_GOLD_USER_IDS is erroring."),w.default.set("storeDoubleGold:"+r+":"+t,!1,P).then((function(){return!1}))})):w.default.set("storeDoubleGold:"+r+":"+t,!1,P).then((function(){return!1}))})).catch((function(){return m.default.debug("growth_isValueInSegmentationList with listName DOUBLE_GOLD_STORE_IDS is erroring."),w.default.set("storeDoubleGold:"+r+":"+t,!1,P).then((function(){return!1}))}))})));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)}),g=(i=_(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.default.getUserId();case 2:if(r=e.sent,t&&r){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",w.default.get("storeNNA:"+r+":"+t).then((function(e){return e})).catch((function(){return v.default.query("ext_getNnaStoreByStoreId",{storeId:t}).then((function(e){var n=e.data;return n&&n.getNnaStoreByStoreId?v.default.query("ext_getNnaUserByUserId",{userId:r}).then((function(e){var a=e.data;return b.default.sendEvent("exp000003",{variant_name:a&&a.getNnaUserByUserId&&1===a.getNnaUserByUserId.eligibility?"nna_gold":"control",experiment_name:"nna_gold_test",bucketing_id:r,sub_src:t,store:{id:t}}).reflect(),a&&a.getNnaUserByUserId&&1===a.getNnaUserByUserId.eligibility?w.default.set("storeNNA:"+r+":"+t,n.getNnaStoreByStoreId,O).then((function(){return n.getNnaStoreByStoreId})):w.default.set("storeNNA:"+r+":"+t,null,O).then((function(){return null}))})).catch((function(){return m.default.debug("ext_getNnaUserByUserId is erroring."),w.default.set("storeNNA:"+r+":"+t,null,O).then((function(){return null}))})):w.default.set("storeNNA:"+r+":"+t,null,O).then((function(){return null}))})).catch((function(){return m.default.debug("ext_getNnaStoreByStoreId is erroring."),w.default.set("storeNNA:"+r+":"+t,null,O).then((function(){return null}))}))})));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)}),h=(s=_(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(t);case 2:return r=e.sent,e.abrupt("return",r?2:1);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)}),y=(c=_(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.default.query("ext_getCouponStatsByProduct",{storeId:t,parentId:r});case 2:return n=e.sent,a=n.data,e.abrupt("return",a.getCouponsProductStats.couponStats);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)}),v=S(r(8)),m=S(r(3)),b=S(r(20)),w=S(r(47)),I=S(r(21));function S(e){return e&&e.__esModule?e:{default:e}}function _(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var E=864e5,x=[],R=0,P=864e5,O=864e5;t.default={getAverageGoldEarned:l,getCouponStats:d,getCouponStatsByProduct:y,getGoldMultiplier:h,getStoreDoubleGold:p,getStoreNNA:g,getStoreSales:f}},1103:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=f(r(5)),o=f(r(0)),u=f(r(15)),i=f(r(3)),s=f(r(47)),c=f(r(580)),d=f(r(8)),l=f(r(4));function f(e){return e&&e.__esModule?e:{default:e}}function p(e){return function(){var t=e.apply(this,arguments);return new a.default((function(e,r){return function n(o,u){try{var i=t[o](u),s=i.value}catch(e){return void r(e)}if(!i.done)return a.default.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(s)}("next")}))}}function g(e){return e.reduce((function(e,t){return e+t}))/e.length}function h(e,t){return u.default.get("https://d.joinhoney.com/storesstats/trending").query(t).then((function(r){var n,a,o,u=r.body;return s.default.set("trendingStores",Object.assign({},e,(n={},a=t.page,o=u,a in n?Object.defineProperty(n,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[a]=o,n))).reflect(),u.stores}))}var y={};t.default={getTrendingStores:function(e){var t=e.page;if(!(t>=0&&t<=9))throw new InvalidParametersError("Invalid trending stores page");return y[t]||(y[t]=a.default.try((function(){return s.default.get("trendingStores")})).then((function(r){return r&&r[t]&&r[t].expires>(0,o.default)().unix()?r[t].stores:h(r,e)})).catch(NotFoundError,(function(){return h({},e)})).finally((function(){delete y[t]}))),y[t]},fetchTrendingStoresByGMV:function(){var e,t=this;return u.default.get("https://cdn.honey.io/extension/data/trending-stores.json").accept("application/json").then((e=p(regeneratorRuntime.mark((function e(r){var o,u,s,f,h=r.body.data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.default.query("ext_getStoresByIds",{storeIds:h});case 3:return o=e.sent,u=o.data,e.next=7,a.default.all(u.getStoresByIds.map(function(){var e=p(regeneratorRuntime.mark((function e(r){var a,o,u,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.default.send("stores:action",{action:"getCouponStats",data:{storeId:r.storeId}},{background:!0});case 2:return a=e.sent,o=a.map((function(e){return parseFloat(e.successRate)})),u=100*g(o),i=r.gold&&r.gold.max,s=c.default.calculateRankingScore(u,i,r.coupons.length),e.abrupt("return",n({},r,{id:r.storeId,numCoupons:r.coupons.count,couponSuccessRate:u,rankingScore:s}));case 8:case"end":return e.stop()}}),e,t)})));return function(t){return e.apply(this,arguments)}}()));case 7:return s=e.sent,f=s.sort((function(e,t){return t.rankingScore-e.rankingScore})),e.abrupt("return",f);case 12:return e.prev=12,e.t0=e.catch(0),i.default.error(e.t0),e.abrupt("return",[]);case 16:case"end":return e.stop()}}),e,t,[[0,12]])}))),function(t){return e.apply(this,arguments)}))},fetchTrendingStoresByCountryByGMV:function(e){var t,r=this;return u.default.get("https://cdn.honey.io/extension/data/trending-stores-by-country.json").accept("application/json").then((t=p(regeneratorRuntime.mark((function t(o){var u,s,f,h,y,v=o.body.data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,u=v[e],t.next=4,d.default.query("ext_getStoresByIds",{storeIds:u});case 4:return s=t.sent,f=s.data,t.next=8,a.default.all(f.getStoresByIds.map(function(){var e=p(regeneratorRuntime.mark((function e(t){var a,o,u,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.default.send("stores:action",{action:"getCouponStats",data:{storeId:t.storeId}},{background:!0});case 2:return a=e.sent,o=a.map((function(e){return parseFloat(e.successRate)})),u=100*g(o),i=t.gold&&t.gold.max,s=c.default.calculateRankingScore(u,i,t.coupons.length),e.abrupt("return",n({},t,{id:t.storeId,numCoupons:t.coupons.count,couponSuccessRate:u,rankingScore:s}));case 8:case"end":return e.stop()}}),e,r)})));return function(t){return e.apply(this,arguments)}}()));case 8:return h=t.sent,y=h.sort((function(e,t){return t.rankingScore-e.rankingScore})),t.abrupt("return",y);case 13:return t.prev=13,t.t0=t.catch(0),i.default.error(t.t0),t.abrupt("return",[]);case 17:case"end":return t.stop()}}),t,r,[[0,13]])}))),function(e){return t.apply(this,arguments)}))}}},1104:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=d(r(5)),o=d(r(0)),u=d(r(575)),i=d(r(190)),s=d(r(35)),c=d(r(8));function d(e){return e&&e.__esModule?e:{default:e}}var l=void 0,f=(0,s.default)({max:10,maxAge:6e5});setInterval((function(){return f.prune()}),6e4);var p=void 0;function g(){return p||(p=c.default.query("ext_getSupportedDomains",{}).then((function(e){var t={};e.data.getAllPartialURLDomains.forEach((function(e){t[e]=!0}));var r={domains:t,expiresSoft:(0,o.default)().add(1,"hour").unix(),expiresHard:(0,o.default)().add(3,"hours").unix()};return(l=r).domains})).finally((function(){p=null}))),p}function h(e){return a.default.try((function(){var e=l,t=(0,o.default)().unix();if(!(e&&e.domains&&e.expiresHard>t))throw new NotFoundError;return e.expiresSoft>t||g().reflect(),e.domains})).catch((function(){return g().catch((function(){return a.default.delay(200).then((function(){return g()}))})).catch((function(){return a.default.delay(2e3).then((function(){return g()}))}))})).then((function(t){return t[e]})).catch((function(){return!1}))}var y={};function v(e){return y[e]||(y[e]=a.default.try((function(){var t=f.get(e);return t&&"object"===(void 0===t?"undefined":n(t))?t:h(e).then((function(t){if(!t)throw new OperationSkippedError;return c.default.query("ext_getStorePartialsByDomain",{domain:e}).then((function(t){var r={};return t.data.getPartialURLsByDomain.forEach((function(e){var t=e.storeId,n=e.partialURL;r[n]=t})),f.set(e,r),r}))}))})).finally((function(){delete y[e]}))),y[e]}function m(e){var t=e.pathname,r=e.hash,n=t;return"/"===t&&r&&(n="/"+r),n.endsWith("/")?n:n+"/"}t.default={findStoreIdForUrl:function(e){return a.default.resolve().then((function(){if(!e)throw new NotFoundError("No store URL provided");var t=i.default.parse(e.toLowerCase())||{},r=t.protocol,n=t.hostname,o=t.pathname,s=t.hash;if(!n||!o||"http:"!==r&&"https:"!==r)throw new NotFoundError("Invalid store URL");var c=(0,u.default)(n);if(!c)throw new NotFoundError("Invalid store URL");var d=c.domain,l=c.tld;if(!d||!l)throw new NotFoundError("Invalid store URL");var f={host:"."+n,path:m({pathname:o,hash:s}),domain:d+"."+l};return v(f.domain).catch(OperationSkippedError,(function(){return{}})).catch((function(){return v(f.domain)})).catch((function(){return a.default.delay(2e3).then((function(){return v(f.domain)}))})).then((function(e){if(e.storeId)throw new NotFoundError;var t=Object.keys(e).reduce((function(t,r){var n=r.toLowerCase(),a=void 0,o=void 0,u=n.indexOf("/");return u>=0?(a="."+n.substr(0,u),o=n.substr(u)+"/"):(a="."+n,o="/"),t.lengthHost>a.length||t.lengthHost===a.length&&t.lengthPath>o.length||!f.host.endsWith(a)||!f.path.startsWith(o)?t:{storeId:e[r],lengthHost:a.length,lengthPath:o.length}}),{});if(!t.storeId)throw new NotFoundError;return t.storeId}))}))}}},1105:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=u(r(5)),o=u(r(3));function u(e){return e&&e.__esModule?e:{default:e}}var i=void 0;function s(e){var t=e&&e.forceRefresh;if(!i||t)try{i=JSON.parse(window.localStorage.getItem("device:settings"))}catch(e){o.default.error(e)}if(!i||"object"!==(void 0===i?"undefined":n(i))){i={};try{window.localStorage.setItem("device:settings",JSON.stringify(i))}catch(e){o.default.error(e)}}return a.default.resolve(Object.assign({},i))}window.addEventListener("storage",(function(){s({forceRefresh:!0})})),t.default={getSettings:s,getSetting:function(e,t){return s(t).then((function(t){return t[e]}))},updateSetting:function(e,t){return s().then((function(r){void 0===t?delete(i=Object.assign({},r))[e]:i=Object.assign({},r,function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},e,t));try{window.localStorage.setItem("device:settings",JSON.stringify(i))}catch(e){o.default.error(e)}return i}))}}},1106:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u=(n=regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,I.get(""+t);case 4:if(!(r=e.sent)){e.next=7;break}return e.abrupt("return",r.id);case 7:return e.abrupt("return",x());case 8:case"end":return e.stop()}}),e,this)})),a=function(){var e=n.apply(this,arguments);return new i.default((function(t,r){return function n(a,o){try{var u=e[a](o),s=u.value}catch(e){return void r(e)}if(!u.done)return i.default.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(s)}("next")}))},function(e){return a.apply(this,arguments)}),i=b(r(5)),s=b(r(0)),c=b(r(15)),d=b(r(3)),l=b(r(4)),f=b(r(20)),p=b(r(130)),g=b(r(21)),h=b(r(19)),y=b(r(193)),v=b(r(191)),m=b(r(35));function b(e){return e&&e.__esModule?e:{default:e}}var w=(0,m.default)({max:10,maxAge:36e4}),I=(0,m.default)({max:30,maxAge:108e5});setInterval((function(){return w.prune()}),3e5);var S=s.default.duration(3,"hours"),_=void 0;function E(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return i.default.try((function(){return!_||_.expires.isBefore()?(_={id:(0,s.default)().valueOf(),expires:(0,s.default)().add(S)},i.default.try((function(){return l.default.send("user:session:started",{sessionId:_.id},{allTabs:!0,background:!0,ignoreResponse:!0})})).reflect(),i.default.try((function(){return f.default.sendEvent("ext005001")})).reflect()):e&&(_.expires=(0,s.default)().add(S)),_.id}))}function x(e){var t={id:h.default.createId(),expires:(0,s.default)().add(S)};return I.set(""+e,t),t.id}var R=void 0,P=void 0,O=void 0;var T={};function C(){return c.default.get("https://cdn.honey.io/ab/ssd.json").then((function(e){T=e.body&&e.body.ssd?e.body:{ssd:{}}})).catch((function(e){return d.default.debug("Failed to fetch ssd package: "+(e&&e.message),e)}))}var A=0,k={};function L(){if(Date.now()-A<3e5)return k;k={},g.default.getInfo().then((function(e){e.email&&e.email.match("test")&&(k.bl=0),k.uL=e.isLoggedIn?1:0,k.uP=e.earnedPoints,k.uA=Date.now()-e.created})),i.default.try((function(){return O&&(O.next>Date.now()||"alive"===O.body.is)?O.body:v.default.get("https://s.joinhoney.com/ck/alive").then((function(e){return O={body:e.body,next:Date.now()+72e5},e.body})).catch((function(){}))})).then((function(e){e&&"alive"===e.is&&(k.bl=0)})),y.default.getAdbTab(R)?k.adb=Date.now():k.adb=Date.now()-y.default.getState().resourceLastBlockedAt;var e=-1,t=T.ex&&T.ex.GA||[];return(T.ssd&&T.ssd.affiliates).forEach((function(r){return e+=1,p.default.get({name:t[e],url:r}).then((function(e){e&&(k.gca=0)}))})),A=Date.now(),!0}setTimeout((function(){C().then((function(){L()}))}),100),setInterval((function(){return C()}),216e5),l.default.addListener("page:load",(function(e,t,r){return E().reflect(),x(r.tabId),null})),t.default={determineSsdState:function(e,t,r){R=r;var n=w.get(r);return n||i.default.try((function(){var n=function(e,t,r){var n=Object.assign({},T.ssd&&T.ssd.base);return void 0!==T.ssd[e]&&Object.assign(n,T.ssd[e]),"SF"===r&&n.SF&&(n=n.SF),void 0!==T.ex[t]&&Object.assign(n,T.ex[t]),n}(e,t,"ff");L();var a=function(e,t){var r="ssd";return Object.entries(t).forEach((function(t){var n=o(t,2),a=n[0],u=n[1];void 0!==e[a]&&e[a]<u&&(r=a+":"+u)})),r}(k,n);return P=a,w.set(r,a),a}))},getSessionId:E,getCurrentSsd:function(e){var t=w.get(e);return void 0===t&&(t=P),t},getScreenViewId:u}},1107:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(0)),a=o(r(1108));function o(e){return e&&e.__esModule?e:{default:e}}var u=[],i={},s=[];a.default.setNewContextListener((function(e){var t={context:e,expires:(0,n.default)().add(6,"hours").unix()};e.onMessage((function(t,r){var n=i[t];"function"==typeof n&&n(t,r,e)})),e.onDisconnect((function(){u=u.filter((function(e){return e===t}))})),u.push(t),s.forEach((function(t){try{t(e)}catch(e){}}))})),setInterval((function(){var e=(0,n.default)().unix();u=u.filter((function(t){return t.expires>=e}))}),n.default.duration(1,"minute").asMilliseconds()),t.default={addNewContextListener:function(e){if("function"!=typeof e)throw new InvalidParametersError("New context listener is not a function");s.push(e)},getActiveContexts:function(){return u.map((function(e){return e.context}))},setMessageListenerForType:function(e,t){if("function"!=typeof t)throw new InvalidParametersError("Message listener is not a function");i[e]=t}}},1108:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r(73);var o,u=r(5),i=(o=u)&&o.__esModule?o:{default:o};var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.port=t}return a(e,[{key:"onDisconnect",value:function(e){if("function"!=typeof e)throw new InvalidParametersError("AdbBpContext disconnect listener is not a function");this.port.onDisconnect.addListener(e)}},{key:"onMessage",value:function(e){if("function"!=typeof e)throw new InvalidParametersError("AdbBpContext message listener is not a function");this.port.onMessage.addListener((function(t){"object"===(void 0===t?"undefined":n(t))&&t.type&&e(t.type,t.content)}))}},{key:"sendMessage",value:function(e,t){var r=this;return i.default.try((function(){var n={type:e,content:t};r.port.postMessage(n)}))}}]),e}(),c=void 0;browser.runtime.onConnect.addListener((function(e){if("adbbp:cs"!==e.name);else if(parseInt(e.sender&&e.sender.tab&&e.sender.tab.id,10)>=0||"function"!=typeof c)e.disconnect();else try{c(new s(e))}catch(e){}return null})),t.default={setNewContextListener:function(e){c=e}}},1109:function(e,t,r){"use strict";var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=g(r(196)),o=g(r(0)),u=g(r(190)),i=g(r(5)),s=g(r(63)),c=g(r(15)),d=g(r(3)),l=g(r(4)),f=g(r(94)),p=g(r(83));function g(e){return e&&e.__esModule?e:{default:e}}var h=[],y={},v={};function m(e){var t=e.requestId,r=e.method,n=e.url,a=e.requestBody;v[t]={method:r,url:n,requestBody:a,expires:(0,o.default)().add(1,"minute").unix()}}function b(e){var t=e.requestId;delete v[t]}function w(e){var t=e.tabId,r=e.requestId,n=e.error,a=v[r];if(a){if("net::ERR_BLOCKED_BY_CLIENT"===n||"NS_ERROR_ABORT"===n){var o={method:a.method,url:a.url};a.requestBody&&(a.requestBody.raw?(o.processData=!1,o.data=a.requestBody.raw):a.requestBody.formData&&(o.processData=!0,o.data=a.requestBody.formData)),function(e){return parseInt(e,10)>=0?f.default.get(e).then((function(e){var t=e.url,r=u.default.parse(t);return{"X-Honey-AdbBp-Origin":r.protocol+"//"+r.host,"X-Honey-AdbBp-Referer":t}})).catch((function(){return{}})):i.default.resolve({})}(t).then((function(e){return o.headers=e,s.default.ajax(o).then((function(){}),(function(){}))}))}delete v[r]}return null}var I=void 0;function S(){var e=h.slice();Object.values(y).forEach((function(t){return e.push.apply(e,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(t.urls))})),e.sort();var t=(0,a.default)(JSON.stringify(e));I!==t&&(p.default.removeBeforeRequestListener(m),p.default.removeCompleteListener(b),p.default.removeErrorOccurredListener(w),e.length>0&&(p.default.addBeforeRequestListener(m,{urls:e}),p.default.addCompleteListener(b,{urls:e}),p.default.addErrorOccurredListener(w,{urls:e})),I=t)}function _(){c.default.get("https://d.joinhoney.com/adb/filter").then((function(e){h=Array.isArray(e.body&&e.body.urls)?e.body.urls:[],S()})).catch((function(e){return d.default.debug("Failed to fetch AdbBp scrRep filter URLs: "+(e&&e.message),e)}))}l.default.addListener("stores:tag",(function(e,t){var r=t&&t.store;r&&r.id&&Array.isArray(r.partialUrls)&&(y[r.id]={urls:r.partialUrls.map((function(e){return"*://*."+e+"/*"})),expires:(0,o.default)().add(12,"hours").unix()},S())})),setTimeout(_,0),setInterval(_,o.default.duration(6,"hours").asMilliseconds()),setInterval((function(){var e=!1,t=(0,o.default)().unix();Object.entries(y).forEach((function(r){var a=n(r,2),o=a[0];a[1].expires>t||(delete y[o],e=!0)})),e&&S()}),o.default.duration(1,"minute").asMilliseconds())},1111:function(e,t,r){"use strict";var n=a(r(63));function a(e){return e&&e.__esModule?e:{default:e}}a(r(4)).default.addListener("utils:action",(function(e,t){switch(t&&t.action){case"ajaxAsync":return n.default.ajax(t.data);default:throw new InvalidParametersError("action")}}))},1112:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o=(n=v(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.default.getFeatureFlag("checkout_observation_enabled");case 2:if(e.sent){e.next=6;break}return c.default.warn("[CheckoutObservation] Disabled for all users."),e.abrupt("return",!1);case 6:return e.next=8,f.default.getFeatureFlag("checkout_observation_honey_employees_only");case 8:if(!e.sent){e.next=22;break}return e.next=12,d.default.getInfo();case 12:if((t=e.sent).isLoggedIn){e.next=16;break}return c.default.warn("[CheckoutObservation] Enabled for Honey and Paypal email addresses only. User is not logged in."),e.abrupt("return",!1);case 16:if(t.email.match(/(joinhoney\.com|paypal\.com)$/)){e.next=19;break}return c.default.warn("[CheckoutObservation] Enabled for Honey and Paypal email addresses only. User email "+t.email+" does not match."),e.abrupt("return",!1);case 19:c.default.warn("[CheckoutObservation] Enabled for Honey and Paypal email addresses only. User email "+t.email+" is allowed."),e.next=32;break;case 22:if(e.t0=b,e.t0){e.next=27;break}return e.next=26,p.default.getVariant("checkout_observation");case 26:e.t0=e.sent;case 27:if("on"===e.t0){e.next=31;break}return c.default.warn("[CheckoutObservation] Disabled: User is in experiment CONTROL group."),e.abrupt("return",!1);case 31:c.default.warn("[CheckoutObservation] Enabled: User is in experiment ON group.");case 32:return e.abrupt("return",!0);case 33:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),u=(a=v(regeneratorRuntime.mark((function e(){var t,r,n,a,u,l,f,p,y=(t=v(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.default.debug("[CheckoutObservation] Begin update remote configuration"),e.next=3,u.getCachedConfiguration();case 3:if(!e.sent){e.next=7;break}return c.default.debug("[CheckoutObservation] Remote Configuration is cached, nothing to do."),e.abrupt("return");case 7:return c.default.debug("[CheckoutObservation] Fetching Remote Configuration from server"),e.next=10,u.refreshRemoteConfiguration();case 10:if(t=e.sent,l){e.next=14;break}return c.default.debug("[CheckoutObservation] No Remote Configuration found."),e.abrupt("return");case 14:c.default.debug("[CheckoutObservation] Configuraing URL Observation Service with new Remote Configuration"),r=I(t),w.setUrlObservationService(r);case 17:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)}),b=(r=v(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.refreshRemoteConfiguration();case 2:if(t=e.sent,l){e.next=5;break}return e.abrupt("return");case 5:r=I(t),w.start({userId:a,urlObservationService:r});case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)}),S=(n=v(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!w.isRunning()){e.next=3;break}return e.next=3,y();case 3:return e.next=5,o();case 5:e.sent?w.isRunning()||b():p();case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)});return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=function(){w.stop()},a=null,!w){e.next=4;break}throw new Error("[CheckoutObservation] Feature already initialized.");case 4:return e.prev=4,e.next=7,d.default.getUserId();case 7:a=e.sent,e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(4),c.default.error("[CheckoutObservation] failed to obtain user id; unable to initialize request observation"),e.abrupt("return");case 14:return u=void 0,m?(c.default.warn("[CheckoutObservation] FORCING EMBEDDED REPOSITORIES"),u=new g.default(new i.RemoteConfigService({repository:new i.EmbeddedRemoteConfigRepository({config:{remoteRepository:"internal-api"}})}))):u=new g.default(new i.RemoteConfigService({repository:new i.GraphQLRemoteConfigRepository({client:s.default})})),e.next=18,u.refreshRemoteConfiguration();case 18:if(l=e.sent){e.next=22;break}return c.default.error("[CheckoutObservation] failed to obtain remote configuration; unable to initialize request observation"),e.abrupt("return");case 22:if(f=I(l)){e.next=26;break}return c.default.error("[CheckoutObservation] failed to configure url observation service; unable to initialize request observation"),e.abrupt("return");case 26:(w=new h.default).start({userId:a,urlObservationService:f}),w.nextStoreObserver.subscribe(S),c.default.debug("[CheckoutObservation] Honey Checkout Request Observation Coordinator Initialized");case 30:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(){return a.apply(this,arguments)}),i=r(591),s=y(r(8)),c=y(r(3)),d=y(r(21)),l=y(r(15)),f=y(r(129)),p=y(r(602)),g=y(r(1169)),h=y(r(1170));function y(e){return e&&e.__esModule?e:{default:e}}function v(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var m=!1,b=null;var w=void 0;function I(e){return"internal-api"===e.remoteRepository?(c.default.debug("[CheckoutObservation] Configuring internal-api URLObservationService"),m?(c.default.warn("[CheckoutObservation] FORCING EMBEDDED REPOSITORIES"),new i.URLObservationService({repository:new i.EmbeddedURLObservationRepository})):new i.URLObservationService({repository:new i.GraphQLURLObservationRepository({client:s.default})})):"external-api"===e.remoteRepository?(c.default.debug("[CheckoutObservation] Configuring external-api URLObservationService"),m?(c.default.warn("[CheckoutObservation] FORCING EMBEDDED REPOSITORIES"),new i.URLObservationService({repository:new i.HybridURLObservationRepository({getPatternsRepository:new i.EmbeddedURLObservationRepository,saveObservationRepository:new i.EmbeddedURLObservationRepository})})):new i.URLObservationService({repository:new i.HybridURLObservationRepository({getPatternsRepository:new i.GraphQLURLObservationRepository({client:s.default}),saveObservationRepository:new i.RESTURLObservationRepository({endpoint:e.externalApiEndpoint,request:l.default})})})):void 0}t.default={initialize:u}},1169:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(47),u=(n=o)&&n.__esModule?n:{default:n};function i(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.service=t}var t,r;return a(e,[{key:"getCachedConfiguration",value:(r=i(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.default.get("checkout_urlObservationRemoteConfiguration");case 3:return t=e.sent,e.abrupt("return",t);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",void 0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return r.apply(this,arguments)})},{key:"refreshRemoteConfiguration",value:(t=i(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.service.getRemoteConfiguration();case 3:return t=e.sent,e.next=6,this.setRemoteConfiguration(t);case 6:return e.abrupt("return",t);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",void 0);case 12:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(){return t.apply(this,arguments)})},{key:"setRemoteConfiguration",value:function(e){try{return u.default.set("checkout_urlObservationRemoteConfiguration",e,432e5)}catch(e){return Promise.resolve()}}}]),e}();t.default=s},1170:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(284),o=r(591),u=l(r(3)),i=l(r(4)),s=l(r(39)),c=l(r(94)),d=l(r(1171));function l(e){return e&&e.__esModule?e:{default:e}}function f(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}function p(e){var t=new URL(e);return t.protocol+"//"+t.hostname}var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=new d.default,r=new o.RequestObserver({platform:t}),n=new a.Observable({value:""}),u=new a.Observable({value:""});this.requestObserver=r,this.urlObserver=n,this.nextStoreObserver=u,this.activeTabId=null,this.currentUrlValue="",this._isRunning=!1,this.registerSubscriptions()}var t,r;return n(e,[{key:"start",value:function(e){var t=e.userId,r=e.urlObservationService,n=new o.RequestObservationCoordinator({urlObservationService:r,requestObserver:this.requestObserver,userId:t});this.requestObservationCoordinator=n,this._setIsRunning(!0),this.currentUrlValue&&this.updateStoreId(this.currentUrlValue)}},{key:"_setIsRunning",value:function(e){this._isRunning=e}},{key:"isRunning",value:function(){return this._isRunning}},{key:"stop",value:function(){this._setIsRunning(!1),this.requestObservationCoordinator.stop()}},{key:"registerSubscriptions",value:function(){this.tabsActivatedSubscription=this.registerOnTabsActivated(),this.tabsUpdatedSubscription=this.registerOnTabsUpdated(),this.urlObserverSubscription=this.registerUrlObserver()}},{key:"registerUrlObserver",value:function(){var e=this;return this.urlObserver.subscribe((function(t){t!==e.currentUrlValue&&(e.requestObservationCoordinator.stop(),e.currentUrlValue=t,e.nextStore(t))}))}},{key:"setUrlObservationService",value:function(e){this.requestObservationCoordinator.setUrlObservationService(e)}},{key:"nextStore",value:(r=f(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRunning()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.updateStoreId(t);case 4:e.sent&&this.nextStoreObserver.next(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"updateStoreId",value:(t=f(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRunning()){e.next=2;break}return e.abrupt("return",!1);case 2:return u.default.debug("[CheckoutObservation] Fetching storeId for "+t+" ("+this.activeTabId+")"),e.prev=3,e.next=6,s.default.getStoreByUrl(t,this.activeTabId);case 6:if(r=e.sent,n=r.id,a=r.supported,u.default.debug("[CheckoutObservation] Fetching patterns for storeId for "+n+" ("+this.activeTabId+")"),a){e.next=12;break}return e.abrupt("return",!1);case 12:this.requestObservationCoordinator.setStoreId(n),e.next=20;break;case 15:return e.prev=15,e.t0=e.catch(3),u.default.debug("[CheckoutObservation] No storeId found for "+t),this.requestObservationCoordinator.stop(),e.abrupt("return",!1);case 20:return e.abrupt("return",!0);case 21:case"end":return e.stop()}}),e,this,[[3,15]])}))),function(e){return t.apply(this,arguments)})},{key:"registerOnTabsActivated",value:function(){var e,t=this,r=(e=f(regeneratorRuntime.mark((function e(r,n){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.activeTabId=n.tabId,e.next=3,c.default.get(t.activeTabId);case 3:a=e.sent,o=p(a.url),t.urlObserver.next(o);case 6:case"end":return e.stop()}}),e,t)}))),function(t,r){return e.apply(this,arguments)});return i.default.addListener("tabs:activated",r),{dispose:function(){i.default.removeListener("tabs:activated",r)}}}},{key:"registerOnTabsUpdated",value:function(){var e,t=this,r=(e=f(regeneratorRuntime.mark((function e(r,n){var a,o=n.tabId,u=n.url;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o===t.activeTabId){e.next=2;break}return e.abrupt("return");case 2:a=p(u),t.urlObserver.next(a);case 4:case"end":return e.stop()}}),e,t)}))),function(t,r){return e.apply(this,arguments)});return i.default.addListener("tabs:updated",r),{dispose:function(){i.default.removeListener("tabs:updated",r)}}}}]),e}();t.default=g},1171:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(83),u=(n=o)&&n.__esModule?n:{default:n};var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return a(e,[{key:"beforeRequestSubscribe",value:function(e,t){return u.default.addBeforeRequestListener(e,t),{dispose:function(){u.default.removeBeforeRequestListener(e)}}}},{key:"beforeSendHeadersSubscribe",value:function(e,t){return u.default.addBeforeSendHeadersListener(e,t),{dispose:function(){u.default.removeBeforeSendHeadersListener(e)}}}}]),e}();t.default=i},1172:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(5)),a=o(r(154));function o(e){return e&&e.__esModule?e:{default:e}}var u=a.default.local.prefixed("config"),i=a.default.sync.prefixed("config");t.default={get:function(e){return n.default.try((function(){return u.get(e)})).catch(NotFoundError,(function(){return i.get(e)}))},set:function(e,t,r){return(r&&r.local?this.storageLocal:i).set(e,t)}}},1173:function(e,t,r){"use strict";var n=a(r(63));function a(e){return e&&e.__esModule?e:{default:e}}a(r(4)).default.addListener("confirmation:action",(function(e,t){switch(t&&t.action){case"replay":return r=t.data&&t.data.url,a=(0,n.default)('<iframe src="'+r+'" />').appendTo("body"),void setTimeout((function(){return a.remove()}),9e4);default:throw new InvalidParametersError("action")}var r,a}))},1174:function(e,t,r){"use strict";var n=g(r(4)),a=g(r(286)),o=g(r(607)),u=g(r(1175)),i=g(r(1176)),s=g(r(1177)),c=g(r(1178)),d=g(r(1179)),l=g(r(609)),f=g(r(1180)),p=r(1181);function g(e){return e&&e.__esModule?e:{default:e}}n.default.addListener("droplist:product:v3",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t&&t.action){case a.default.ADD_DROPLIST:return(0,o.default)(t);case a.default.DESYNC_DROPLIST:return(0,p.desyncItems)();case a.default.GET_CACHED_DROPLIST_ITEMS:return(0,u.default)(t.storeId);case a.default.GET_CART_PRODUCT:return(0,p.getCartProduct)(t);case a.default.GET_DROPLIST:return(0,i.default)(t);case a.default.GET_PRODUCT:return(0,s.default)(t);case a.default.GET_PRODUCT_WITH_OFFER:return(0,c.default)(t);case a.default.GET_PRICE_HISTORY:return(0,d.default)(t);case a.default.GET_CART_PRICE_HISTORY:return(0,p.getProductPriceHistoryByStoreIdVariantId)(t);case a.default.GET_SAVED_FOR_LATER_ITEMS:return(0,p.getSFLItems)();case a.default.REMOVE_DROPLIST:return(0,l.default)(t.data);case a.default.SYNC_DROPLIST:return(0,p.syncItems)(t.isFromToggle);case a.default.UPDATE_DROPLIST:return(0,f.default)(t);default:throw new InvalidParametersError("action")}}))},1175:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u=c(r(39)),i=r(608),s=c(i);function c(e){return e&&e.__esModule?e:{default:e}}function d(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}t.default=(n=regeneratorRuntime.mark((function e(t){var r,n,a,c,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),e.next=3,u.default.getStoreById(t);case 3:return n=e.sent,a=n.metadata,c=(a||{}).droplist_maxProdObservations,l=void 0===c?3:c,f=s.default.getAllProducts().reduce((function(e,n){return n.storeId===t&&n.lastCheckedTime+i.PRODUCT_FETCH_TTL<=r?[].concat(d(e),[o({},n,{lastCheckedTime:r})]):e}),[]),e.abrupt("return",f.slice(0,l));case 8:case"end":return e.stop()}}),e,this)})),a=function(){var e=n.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return a.apply(this,arguments)})},1176:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(8)),a=u(r(3)),o=u(r(95));function u(e){return e&&e.__esModule?e:{default:e}}var i,s;t.default=(i=regeneratorRuntime.mark((function e(t){var r,u,i,s,c,d,l,f,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.storeId,u=t.variantId,i=t.merchId,s={status:"ACTIVE"},r&&(s.storeIds=[r]),i&&(s.parentIds=[i]),u&&(s.variantIds=[u]),e.next=7,n.default.query("ext_getDroplistByUserId",{meta:s});case 7:return c=e.sent,d=c.data,l=c.errors,f=(d||{}).getDroplistByUserId||[],p=f.map((function(e){return o.default.formatDroplist(e)})),l&&a.default.warn("GraphQL error(s) from ext_getDroplistByUserId",{params:t,errors:l}),e.abrupt("return",p);case 14:case"end":return e.stop()}}),e,this)})),s=function(){var e=i.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return s.apply(this,arguments)})},1177:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=i(r(8)),o=i(r(3)),u=i(r(95));function i(e){return e&&e.__esModule?e:{default:e}}var s,c;t.default=(s=regeneratorRuntime.mark((function e(t){var r,i,s,c,d,l,f,p,g,h,y,v,m,b,w,I;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.productId,e.next=3,Promise.all([a.default.query("getProductByIds",{productIds:r}),a.default.query("getProductByIdSecondaryDetails",{productId:r,meta:{relatedLimit:0}})]);case 3:return i=e.sent,s=n(i,2),c=s[0],d=s[1],l=c.data,f=c.errors,p=d.data,g=d.errors,f&&o.default.warn("GraphQL error(s) from getProductByIds",{params:t,primaryErrors:f}),g&&o.default.warn("GraphQL error(s) from getProductByIdSecondaryDetails",{params:t,secondaryErrors:g}),void 0===l&&o.default.error("Graphql getProductByIds response did not include data",{params:t,response:c}),void 0===p&&o.default.error("Graphql getProductByIdSecondaryDetails response did not include data",{params:t,response:d}),h=(l||{}).getProductByIds,y=n(h=void 0===h?[]:h,1),v=y[0],m=void 0===v?{primaryDetailsMissing:!0}:v,b=(p||{}).getProductByIdSecondaryDetails,w=void 0===b?{}:b,I=Object.assign({},m,w),e.abrupt("return",u.default.formatProduct(I));case 19:case"end":return e.stop()}}),e,this)})),c=function(){var e=s.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return c.apply(this,arguments)})},1178:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=i(r(8)),o=i(r(3)),u=i(r(95));function i(e){return e&&e.__esModule?e:{default:e}}var s,c,d="ext_getProductByIdsWithOffer";t.default=(s=regeneratorRuntime.mark((function e(t){var r,i,s,c,l,f,p,g,h,y,v,m,b,w,I,S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.productId,e.next=3,Promise.all([a.default.query(d,{productIds:r}),a.default.query("getProductByIdSecondaryDetails",{productId:r,meta:{relatedLimit:0}})]);case 3:return i=e.sent,s=n(i,2),c=s[0],l=s[1],f=c.data,p=c.errors,g=l.data,h=l.errors,p&&o.default.warn("GraphQL error(s) from "+d,{params:t,primaryErrors:p}),h&&o.default.warn("GraphQL error(s) from getProductByIdSecondaryDetails",{params:t,secondaryErrors:h}),void 0===f&&o.default.error("Graphql "+d+" response did not include data",{params:t,response:c}),void 0===g&&o.default.error("Graphql getProductByIdSecondaryDetails response did not include data",{params:t,response:l}),y=(f||{}).getProductByIds,v=n(y=void 0===y?[]:y,1),m=v[0],b=void 0===m?{primaryDetailsMissing:!0}:m,w=(g||{}).getProductByIdSecondaryDetails,I=void 0===w?{}:w,S=Object.assign({},b,I),e.abrupt("return",u.default.formatProduct(S));case 19:case"end":return e.stop()}}),e,this)})),c=function(){var e=s.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return c.apply(this,arguments)})},1179:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(196)),a=u(r(8)),o=u(r(3));function u(e){return e&&e.__esModule?e:{default:e}}var i,s;t.default=(i=regeneratorRuntime.mark((function e(t){var r,u,i,s,c,d,l,f,p,g,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.storeId,u=t.merchId,i=t.productId,s=t.variantId,c=t.timeframe,(d=i)||(l=(0,n.default)(u),d=s?r+"_"+l+"_"+(0,n.default)(s):r+"_"+l+"_"+l),e.next=5,a.default.query("ext_getProductPriceHistory",{productId:d,timeframe:c});case 5:return f=e.sent,p=f.data,(g=f.errors)&&o.default.warn("GraphQL error(s) from ext_getProductPriceHistory",{params:t,errors:g}),h=(p||{}).getProductPriceHistory||{},e.abrupt("return",h);case 11:case"end":return e.stop()}}),e,this)})),s=function(){var e=i.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return s.apply(this,arguments)})},1180:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(0)),a=s(r(19)),o=s(r(8)),u=s(r(3)),i=s(r(95));function s(e){return e&&e.__esModule?e:{default:e}}var c,d;t.default=(c=regeneratorRuntime.mark((function e(t){var r,s,c,d,l,f,p,g,h,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.updatedItems,s=void 0===r?[]:r,c=t.fullDroplistedItems,d=void 0===c?[]:c,l=t.productData,f=void 0===l?{}:l,e.prev=1,e.next=4,o.default.mutate("ext_updateDroplist",{meta:s});case 4:if(p=e.sent,g=p.data,h=p.errors,!(g||{}).updateDroplist){e.next=11;break}return y=s.map((function(e,t){var r=Object.assign({},d[t]),o=r.storeId,u=r.productId,s=r.merchId,c=r.variantId,l=e.watchLength,p=e.notifyAtPrice,g=e.priceCurrent,h=e.tags;if(l){var y=f.oldWatchForLength;i.default.sendEventWithGroup("droplist501",{store:{id:o},productId:u,merchId:s,variantId:c,watchForLength:l,oldWatchForLength:y}),r.watchLength=l,r.expires=(0,n.default)().endOf("day").add(l,"days").valueOf()}if(p&&(i.default.sendEventWithGroup("droplist500",{store:{id:o},productId:u,merchId:s,variantId:c,originalPrice:a.default.cleanPrice(r.originalPrice/100),currentPrice:a.default.cleanPrice(g/100),notifyAtPrice:a.default.cleanPrice(p/100),oldNotifyPriceAt:a.default.cleanPrice(r.notifyAtPrice/100)}),r.notifyAtPrice=p),h){var v=r.tags||[],m=f.defaultTags||[],b=h.filter((function(e){return!v.some((function(t){return t===e}))}))[0]||"",w=v.filter((function(e){return!h.some((function(t){return t===e}))}))[0]||"",I=b.length>0,S=I?b:w,_=m.includes(S),E=I?"droplist600":"droplist601";i.default.sendEventWithGroup(E,{store:{id:o},userId:r.userId,productId:u,merchId:s,variantId:c,tag:S,default:_}),r.tags=h}return r})),e.abrupt("return",y);case 11:return h&&u.default.warn("GraphQL error(s) from ext_updateDroplist",{params:t,errors:h}),e.abrupt("return",d);case 15:throw e.prev=15,e.t0=e.catch(1),e.t0;case 18:case"end":return e.stop()}}),e,this,[[1,15]])})),d=function(){var e=c.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return d.apply(this,arguments)})},1181:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1182);Object.defineProperty(t,"desyncItems",{enumerable:!0,get:function(){return s(n).default}});var a=r(1183);Object.defineProperty(t,"getSFLItems",{enumerable:!0,get:function(){return s(a).default}});var o=r(1184);Object.defineProperty(t,"syncItems",{enumerable:!0,get:function(){return s(o).default}});var u=r(1185);Object.defineProperty(t,"getCartProduct",{enumerable:!0,get:function(){return s(u).default}});var i=r(1186);function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"getProductPriceHistoryByStoreIdVariantId",{enumerable:!0,get:function(){return s(i).default}})},1182:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=[],f=!1;return i.default.post(c.LOAD_CART_URL).send({listType:"saved-for-later",listId:"saved-for-later",pageAction:"load-infinite-sfl",hasPantryBundleAlready:!1,page:t}).set({"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8;","X-AUI-View":"Desktop",Accept:"json"}).then((function(e){var t=e.text,i=void 0===t?null:t,c={};try{c=JSON.parse(i).features["desktop/saved-cart"]}catch(e){return[]}var p=c.items;if(f=!!parseInt(c.hasMoreItems,10),p.length>0){var g=p.reduce((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(0,n.default)(t.html),o=""+a.data("asin");return r[o]||(r[o]=1,e.push(o)),e}),[]),h=[];return(0,d.default)(g,!1).filter((function(e){return e.expires&&-1!==e.expires})).then((function(e){if(e.length>0){l=e,h=e.map((function(e){return e.variantId}));var t=e.map((function(e){var t=e.expires,r=e.notifyAtPrice,n=e.originalPrice,o=e.productId,u=e.merchId,i=e.variantId,s=e.lastPrice,c=e.title,d=e.storeId,l=e.imageUrl;return{productId:o,merchId:u,variantId:i,notifyAtPrice:r/100,currentPrice:s,originalPrice:n/100,watchLength:(0,a.default)(t).diff((0,a.default)(),"days"),title:c,storeId:d,imageUrl:l}}));return(0,s.default)({products:t,syncedFrom:"save_for_later"})}return l})).each((function(e){return h.splice(h.indexOf(e.variantId),1)})).then((function(){var e=l.map((function(e){return Object.assign(e,{expires:-1})}));if(e.length>0||h.length>0){var t=o.default.keyArrayBy(e,"productId");u.default.send("droplist:product",{action:"productsSynced",success:t,error:h},{allTabs:!0,ignoreResponse:!0})}return Promise.resolve()}))}return Promise.resolve()})).then((function(){return f?e(t+1,r):Promise.resolve()}))};var n=l(r(63)),a=l(r(0)),o=l(r(19)),u=l(r(4)),i=l(r(15)),s=l(r(609)),c=r(288),d=l(c);function l(e){return e&&e.__esModule?e:{default:e}}},1183:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o=(n=regeneratorRuntime.mark((function e(t){var r,n,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={storeIds:[h],variantIds:t},e.next=3,d.default.query(y,{meta:r});case 3:return n=e.sent,a=n.data,o=n.errors,u=(a||{}).getDroplistByUserId||[],o&&l.default.warn("GraphQL error(s) from "+y,{errors:o}),e.abrupt("return",u.map((function(e){var t=e.expires,r=e.product,n=e.productId,a=r||{},o=a.canonicalUrl,u=a.variantId;return{canonicalUrl:o,expires:t,productId:n,storeId:(a.store||{}).storeId,variantId:u}})));case 9:case"end":return e.stop()}}),e,this)})),a=function(){var e=n.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return a.apply(this,arguments)});t.default=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a={listType:"saved-for-later",listId:"saved-for-later",pageAction:"load-infinite-sfl",hasPantryBundleAlready:!1,page:t},d=!1;return i.default.post(p.LOAD_CART_URL).send(a).set({"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8;","X-AUI-View":"Desktop",Accept:"json"}).then((function(e){var t=e.text,a=void 0===t?null:t,i={};try{i=JSON.parse(a).features["desktop/saved-cart"]}catch(e){return Promise.resolve()}var c=i.items;if(d=!!parseInt(i.hasMoreItems,10),c.length>0){var l=c.reduce((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,u.default)(t.html),a=""+n.data("asin"),o=s.default.cleanPrice(n.data("price")),i=(n.find(".sc-product-availability").text()||"").trim(),c=/unavailable|no longer available/i,d=c.test(i);return d||void 0!==r[a]||(r[a]=o,e.push(a)),e}),[]);return o(l).then((function(e){var t={},r=e.map((function(e){return{productId:e.productId,canonicalUrl:e.canonicalUrl,storeId:e.storeId}}));e.forEach((function(e){var n=e.expires,a=e.productId,o=e.variantId;(0,f.default)(r,a),t[o]=n}));var a=l.filter((function(e){var r=t[e];return void 0===r||-1===r||r<=Date.now()}));return n=n.concat(a),Promise.resolve()}))}return Promise.resolve()})).then((function(){return d&&n.length<25?e(t+1,r,n):c.default.send("droplist:product",{action:"getItemsHasFinished",items:n},{allTabs:!0})}))};var u=g(r(63)),i=g(r(15)),s=g(r(19)),c=g(r(4)),d=g(r(8)),l=g(r(3)),f=g(r(287)),p=r(288);function g(e){return e&&e.__esModule?e:{default:e}}var h="1",y="ext_savedForLater_getDroplistByUserId"},1184:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=!1;return u.default.post(s.LOAD_CART_URL).send({listType:"saved-for-later",listId:"saved-for-later",pageAction:"load-infinite-sfl",hasPantryBundleAlready:!1,page:r}).set({"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8;","X-AUI-View":"Desktop",Accept:"json"}).then((function(e){var r=e.text,u=void 0===r?null:r,s={};try{s=JSON.parse(u).features["desktop/saved-cart"]}catch(e){return Promise.resolve()}var f=s.items;if(l=!!parseInt(s.hasMoreItems,10),f.length>0){var p=f.reduce((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(0,n.default)(t.html),a=""+r.data("asin"),o=Number(r.data("price")),u=(r.find(".sc-product-availability").text()||"").trim(),i=/unavailable|no longer available/i,s=i.test(u),c=o>3e5;return s||c||void 0!==d[a]||(d[a]=o,e.push(a)),e}),[]),g=[];return(0,c.default)(p,!0).filter((function(e){var r=e.expires;return void 0===r||-1===r&&t||r<=Date.now()})).map((function(e){var t=d[e.variantId],r=t>0?parseInt((100*t).toFixed(),10):e.lastPrice,n=parseInt((.95*r).toFixed(),10);return Object.assign({},e,{originalPrice:r,watchLength:60,notifyAtPrice:n})})).then((function(e){if(e.length>0){var t=e.map((function(e){var t=e.variantId,r=e.watchLength,n=e.title,a=e.storeId,o=e.notifyAtPrice;return{merchId:e.merchId,notifyAtPrice:o,originalPrice:e.originalPrice,storeId:a,title:n,variantId:t,watchLength:r}}));return g=e.map((function(e){return e.variantId})),(0,i.default)({droplistItems:t,syncedFrom:"save_for_later",source:"SYNC"})}return e})).each((function(e){return g.splice(g.indexOf(e.variantId),1)})).then((function(e){if(e.length>0||g.length>0){var t=a.default.keyArrayBy(e,"productId");o.default.send("droplist:product",{action:"productsSynced",success:t,error:g},{allTabs:!0,ignoreResponse:!0})}return Promise.resolve()}))}return Promise.resolve()})).then((function(){return l?e(t,r+1,d):Promise.resolve()}))};var n=d(r(63)),a=d(r(19)),o=d(r(4)),u=d(r(15)),i=d(r(607)),s=r(288),c=d(s);function d(e){return e&&e.__esModule?e:{default:e}}},1185:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=s(r(8)),u=s(r(3)),i=s(r(95));function s(e){return e&&e.__esModule?e:{default:e}}var c,d;t.default=(c=regeneratorRuntime.mark((function e(t){var r,s,c,d,l,f,p,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.storeId,s=t.variantId,e.next=3,o.default.query("getProductByStoreIdVariantIds",{storeId:r,variantIds:[s]});case 3:return c=e.sent,d=c.data,(l=c.errors)&&u.default.warn("GraphQL error(s) from getProductByStoreIdVariantIds",{params:t,errors:l}),f=(d||{}).getProductByStoreIdVariantIds,p=a(f=void 0===f?[]:f,1),g=p[0],e.abrupt("return",n({},i.default.formatProduct(g),{variantId:g.variantId}));case 11:case"end":return e.stop()}}),e,this)})),d=function(){var e=c.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return d.apply(this,arguments)})},1186:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(8)),a=o(r(3));function o(e){return e&&e.__esModule?e:{default:e}}var u,i;t.default=(u=regeneratorRuntime.mark((function e(t){var r,o,u,i,s,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.storeId,o=t.variantId,u=t.timeframe,e.next=3,n.default.query("getProductPriceHistoryByStoreIdVariantId",{storeId:r,variantId:o,timeframe:u});case 3:return i=e.sent,s=i.data,(c=i.errors)&&a.default.warn("GraphQL error(s) from getProductPriceHistoryByStoreIdVariantId",{params:t,errors:c}),d=(s||{}).getProductPriceHistory||{},e.abrupt("return",d);case 9:case"end":return e.stop()}}),e,this)})),i=function(){var e=u.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return i.apply(this,arguments)})},1187:function(e,t,r){"use strict";var n=S(r(4)),a=S(r(286)),o=r(1188),u=S(o),i=r(1189),s=S(r(1191)),c=S(r(1192)),d=S(r(1193)),l=S(r(1195)),f=S(r(1196)),p=S(r(1197)),g=r(1198),h=r(1199),y=r(1200),v=r(1201),m=r(1202),b=r(1203),w=r(1204),I=r(1205);function S(e){return e&&e.__esModule?e:{default:e}}n.default.addListener("honeyTips:tips",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t&&t.action){case a.default.GET_STORE_DEALS:return(0,s.default)(t);case a.default.GET_STORE_SALES:return(0,c.default)(t);case a.default.GET_PRODUCT:return(0,d.default)(t);case a.default.GET_PRODUCTS:return(0,l.default)(t);case a.default.GET_TIPS_SHOWN_BY_STORE:return(0,g.getTipsShownByStore)(t);case a.default.GET_TIPS_SHOWN_BY_STORE_AND_CATEGORY:return(0,g.getTipsShownByStoreAndCategory)(t);case a.default.GET_TIPS_SHOWN_BY_PRODUCT:return(0,g.getTipsShownByProduct)(t);case a.default.INCREMENT_TIP_SHOWN:return(0,o.tryUpdateSessionCount)(t),(0,g.incrementTipsShown)(t);case a.default.INCREMENT_MINI_TEASER_SHOWN_PER_CATEGORY:return(0,h.incrementTeaserShownQuantityPerCategory)(t);case a.default.GET_MINI_TEASER_SHOWN_PER_CATEGORY:return(0,h.getTeaserShownQuantityPerCategory)(t);case a.default.GET_AUTOPOP_PRODUCT_QUANTITY:return(0,y.getAutoPopProductQuantity)(t);case a.default.INCREMENT_AUTOPOP_PRODUCT_QUANTITY:return(0,y.incrementAutoPopProductQuantity)(t);case a.default.GET_LAUNCHPAD_TIP_SHOWN_BY_STORE:return(0,v.getLaunchpadTipShownByStore)(t);case a.default.INCREMENT_LAUNCHPAD_TIP_SHOWN_BY_STORE:return(0,v.incrementLaunchpadTipShownByStore)(t);case a.default.GET_REGISTRATION_TIP_SHOWN_QUANTITY:return(0,m.getRegistrationTipShownQuantity)(t);case a.default.INCREMENT_REGISTRATION_TIP_SHOWN_QUANTITY:return(0,m.incrementRegistrationTipShownQuantity)(t);case a.default.GET_TIPS_SHOW_REGISTRATION_PROMPT:return(0,f.default)(t);case a.default.GET_SESSION_COUNT:return(0,u.default)(t);case a.default.INITIALIZE_TIP_NOTIFICATIONS_STATUS:return p.default.initialize(t);case a.default.UPDATE_TIP_NOTIFICATIONS_STATUS:return p.default.update(t);case a.default.GET_TIP_NOTIFICATIONS_STATUS:return p.default.getStatus(t);case a.default.TIPS_INCREMENT_SESSION_COUNT:return(0,o.tryUpdateSessionCount)(t);case a.default.TIPS_GET_SETTINGS_PROMPT_STATE:return(0,i.getState)(t.sessionNumber,t.noUpdate||!1);case a.default.TIPS_INCREMENT_SETTINGS_PROMPT_HOVER:return(0,i.incrementHover)(t.sessionNumber);case a.default.TIPS_SETTINGS_PROMPT_PERFORM_ACTION:return(0,i.performAction)(t.sessionNumber);case a.default.TIPS_RESET_SETTINGS_PROMPT_STATE:return(0,i.resetState)();case a.default.TIPS_SETTINGS_PROMPT_DISABLE:return(0,i.disablePrompt)(t.sessionNumber);case a.default.GET_TEASER_CLOSED_SHOULD_SHOW_PROMPT:return(0,b.getTeaserClosedShouldShowPrompt)();case a.default.INCREMENT_TEASER_CLOSED_WITHOUT_CTA_COUNT:return(0,b.incrementTeaserClosedWithoutCtaCount)();case a.default.RESET_TEASER_CLOSED_WITHOUT_CTA_COUNT:return(0,b.resetTeaserClosedWithoutCtaCount)();case a.default.SET_TEASER_CLOSED_PROMPT_SHOWN:return(0,b.setTeaserClosedPromptShown)();case a.default.TIPS_GET_PDP_COUPON_AUTOPOP:return(0,w.hasAutopopped)(t);case a.default.TIPS_SET_PDP_COUPON_AUTOPOP:return(0,w.setAutopopped)(t);case a.default.TIPS_GET_PI_AUTOPOP:return(0,I.getAutopopCount)(t);case a.default.TIPS_INCREMENT_PI_AUTOPOP:return(0,I.incrementAutopopCount)(t);default:throw new InvalidParametersError("action")}}))},1188:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tryUpdateSessionCount=void 0;var n=o(r(55)),a=o(r(3));function o(e){return e&&e.__esModule?e:{default:e}}function u(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var i={count:1,hasUpdatedThisSession:!1};u(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.default.getSetting("TIPS_SESSION_COUNT").catch((function(){return 0}));case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=0;case 5:t=e.t0,i.count=t,r=t+1,a.default.debug("TIPS_SESSION_COUNT "+r);case 9:case"end":return e.stop()}}),e,void 0)})))();t.tryUpdateSessionCount=(s=u(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.hasUpdatedThisSession||(i.hasUpdatedThisSession=!0,t=i.count+1,n.default.updateSetting("TIPS_SESSION_COUNT",t));case 1:case"end":return e.stop()}}),e,void 0)}))),function(){return s.apply(this,arguments)});var s,c,d=(c=u(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.default.getSetting("TIPS_SESSION_COUNT").catch((function(){return 0}));case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=0;case 5:return t=e.t0,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,void 0)}))),function(){return c.apply(this,arguments)});t.default=d},1189:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.performAction=t.disablePrompt=t.getPromptDisabled=t.incrementHover=t.resetState=t.getState=void 0;t.getState=(n=p(regeneratorRuntime.mark((function e(t,r){var n,a,o,u,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||0===t){e.next=2;break}return e.abrupt("return",null);case 2:return n=t.toString(),d.default.debug("tips:settingsPrompt:getState: Retrieving session state",n),e.next=6,c.default.getSetting(v);case 6:if(e.t0=e.sent,e.t0){e.next=9;break}e.t0=!1;case 9:if(!(a=e.t0)){e.next=13;break}return d.default.debug("tips:settingsPrompt:getState: Breaking early userDisabledPrompt."),e.abrupt("return",{session:w().next().value,userDisabledPrompt:a});case 13:return e.next=15,c.default.getSetting(m);case 15:if(e.t1=e.sent,e.t1){e.next=18;break}e.t1="0";case 18:return o=e.t1,u=parseInt(o,10),e.t3=l.default,e.next=23,c.default.getSetting(y);case 23:if(e.t4=e.sent,e.t2=e.t3.deserialize.call(e.t3,e.t4),e.t2){e.next=27;break}e.t2=b().next().value;case 27:if(i=e.t2,d.default.debug("tips:settingsPrompt:getState: Retrieved sessions.",i),!i.has(n)){e.next=34;break}return d.default.debug("tips:settingsPrompt:getState: Found current session: ",i.get(n)),e.abrupt("return",{session:i.get(n),userDisabledPrompt:a,totalHovers:u});case 34:if(!r){e.next=36;break}return e.abrupt("return",null);case 36:return s=w().next().value,i.set(n,s),e.next=40,c.default.updateSetting(y,l.default.serialize(i));case 40:return d.default.debug("tips:settingsPrompt:getState: Made new session: ",i.get(n)),e.abrupt("return",{session:s,userDisabledPrompt:a,totalHovers:u});case 42:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)}),t.resetState=(a=p(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.default.debug("tips:settingsPrompt:resetState: Resetting session state"),e.next=3,c.default.updateSetting(y,l.default.serialize(b().next().value));case 3:return e.next=5,c.default.updateSetting(v,!1);case 5:return e.next=7,c.default.updateSetting(m,0);case 7:return e.abrupt("return",{session:w().next().value,userDisabledPrompt:!1,totalHovers:0});case 8:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)}),t.incrementHover=(o=p(regeneratorRuntime.mark((function e(t){var r,n,a,o,u,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||0===t){e.next=2;break}return e.abrupt("return",null);case 2:return r=t.toString(),d.default.debug("tips:settingsPrompt:incrementHover: Fetching states"),e.next=6,c.default.getSetting(v);case 6:if(e.t0=e.sent,e.t0){e.next=9;break}e.t0=!1;case 9:return n=e.t0,e.next=12,c.default.getSetting(m);case 12:if(e.t1=e.sent,e.t1){e.next=15;break}e.t1="0";case 15:return a=e.t1,o=parseInt(a,10)+1,e.t3=l.default,e.next=20,c.default.getSetting(y);case 20:if(e.t4=e.sent,e.t2=e.t3.deserialize.call(e.t3,e.t4),e.t2){e.next=24;break}e.t2=b().next().value;case 24:if(u=e.t2,d.default.debug("tips:settingsPrompt:incrementHover: Serialized sessions: ",u,u.get(r)),!u.has(r)){e.next=38;break}return d.default.debug("tips:settingsPrompt:incrementHover: Found current session",u.get(r)),i=u.get(r).hoverCount+1||1,u.set(r,Object.assign({},u.get(r)||w().next().value,{hoverCount:i})),e.next=32,c.default.updateSetting(y,l.default.serialize(u));case 32:return e.next=34,c.default.updateSetting(m,o);case 34:return d.default.debug("tips:settingsPrompt:incrementHover: Updated hover: ",i),e.abrupt("return",{session:u.get(r),userDisabledPrompt:n,totalHovers:o});case 38:return s=Object.assign({},w().next().value,{hoverCount:1}),u.set(r,s),d.default.debug("tips:settingsPrompt:incrementHover: Making new session",s,u),e.next=43,c.default.updateSetting(y,l.default.serialize(u));case 43:return e.next=45,c.default.updateSetting(m,o);case 45:return d.default.debug("tips:settingsPrompt:incrementHover: Updated hover: ",1),e.abrupt("return",{session:s,userDisabledPrompt:n,totalHovers:o});case 47:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)}),t.getPromptDisabled=(u=p(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.default.getSetting(v);case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=!1;case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)}),t.disablePrompt=(i=p(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.default.debug("tips:settingsPrompt:disablePrompt: Disabling the prompt."),e.prev=1,e.next=4,c.default.updateSetting(v,!0);case 4:return e.abrupt("return",!0);case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return i.apply(this,arguments)}),t.performAction=(s=p(regeneratorRuntime.mark((function e(t){var r,n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||0===t){e.next=2;break}return e.abrupt("return",null);case 2:return r=t.toString(),d.default.debug("tips:settingsPrompt:performAction: Fetching states"),e.next=6,c.default.getSetting(v);case 6:if(e.t0=e.sent,e.t0){e.next=9;break}e.t0=!1;case 9:return n=e.t0,e.t2=l.default,e.next=13,c.default.getSetting(y);case 13:if(e.t3=e.sent,e.t1=e.t2.deserialize.call(e.t2,e.t3),e.t1){e.next=17;break}e.t1=b().next().value;case 17:if(a=e.t1,d.default.debug("tips:settingsPrompt:performAction: Serialized sessions: ",a,a.get(r)),!a.has(r)){e.next=30;break}return d.default.debug("tips:settingsPrompt:performAction: Found current session",a.get(r)),a.set(r,Object.assign({},a.get(r)||w().next().value,{userPerformedAction:!0})),e.next=24,c.default.updateSetting(y,l.default.serialize(a));case 24:return e.next=26,c.default.updateSetting(m,0);case 26:return d.default.debug("tips:settingsPrompt:performAction: performed action and reset hovers"),e.abrupt("return",{session:a.get(r),userDisabledPrompt:n,totalHovers:0});case 30:return o=Object.assign({},w().next().value,{userPerformedAction:!0}),a.set(r,o),d.default.debug("tips:settingsPrompt:performAction: Making new session",o,a),e.next=35,c.default.updateSetting(y,l.default.serialize(a));case 35:return e.next=37,c.default.updateSetting(m,0);case 37:return d.default.debug("tips:settingsPrompt:performAction: performed action and reset hovers"),e.abrupt("return",{session:o,userDisabledPrompt:n,totalHovers:0});case 39:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)});var n,a,o,u,i,s,c=f(r(55)),d=f(r(3)),l=f(r(1190));function f(e){return e&&e.__esModule?e:{default:e}}function p(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var g=regeneratorRuntime.mark(b),h=regeneratorRuntime.mark(w),y="TIP_SETTINGS_PROMPT_STATES",v="TIP_SETTINGS_PROMPT_DISABLED",m="TIP_SETTINGS_PROMPT_HOVERS";function b(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,new l.default(2);case 3:e.next=0;break;case 5:case"end":return e.stop()}}),g,this)}function w(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,{hoverCount:0,userPerformedAction:!1};case 3:e.next=0;break;case 5:case"end":return e.stop()}}),h,this)}},1190:function(e,t,r){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{cachePolicy:"fifo",cleanOnGet:!0,cleanOnSet:!0,cleanOnHas:!0};this.capacity=e,this.cachePolicy=void 0===t.cachePolicy?"fifo":t.cachePolicy,this.cleanOnGet=void 0===t.cleanOnGet||t.cleanOnGet,this.cleanOnSet=void 0===t.cleanOnSet||t.cleanOnSet,this.cleanOnHas=void 0===t.cleanOnHas||t.cleanOnHas,this.memory=new Map}function a(){var e=this.memory.size,t=this.capacity;if(!(e<=t)&&"fifo"===this.cachePolicy)for(var r=e-t,n=0;n<r;n+=1)this.memory.delete(this.memory.keys().next().value)}n.deserialize=function(e){try{var t=e;"string"==typeof e&&(t=JSON.parse(e));var r=new n;return r.capacity=t.capacity,r.cachePolicy=t.cachePolicy,r.cleanOnGet=t.cleanOnGet,r.cleanOnSet=t.cleanOnSet,r.memory=new Map(JSON.parse(t.memory)),r}catch(e){return null}},n.serialize=function(e){try{var t=Object.assign({},e,{memory:JSON.stringify(Array.from(e.memory.entries()))});return JSON.stringify(t)}catch(e){return null}},n.prototype.get=function(e){return this.cleanOnGet&&this.memory.size>this.capacity&&a.call(this),this.memory.get(e)||null},n.prototype.set=function(e,t){return this.memory.set(e,t),this.cleanOnSet&&this.memory.size>this.capacity&&a.call(this),this.memory.get(t)||null},n.prototype.has=function(e){return this.cleanOnHas&&this.memory.size>this.capacity&&a.call(this),this.memory.has(e)},n.prototype.delete=function(e){return this.memory.delete(e)},e.exports=n},1191:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(8)),a=o(r(3));function o(e){return e&&e.__esModule?e:{default:e}}var u,i;t.default=(u=regeneratorRuntime.mark((function e(t){var r,o,u,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.storeId,e.next=3,n.default.query("tips_getSortedDealsPublic",{storeId:r});case 3:return o=e.sent,u=o.data,(i=o.errors)&&a.default.warn("GraphQL error(s) from tips_getSortedDealsPublic",{params:t,errors:i}),s=(u||{}).getSortedDealsPublic,e.abrupt("return",s);case 9:case"end":return e.stop()}}),e,this)})),i=function(){var e=u.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return i.apply(this,arguments)})},1192:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(8)),a=o(r(3));function o(e){return e&&e.__esModule?e:{default:e}}var u,i;t.default=(u=regeneratorRuntime.mark((function e(t){var r,o,u,i,s=t.storeId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.default.query("tips_getStoreSaleCategoriesByStoreId",{storeId:s,noLimit:!0});case 2:return r=e.sent,o=r.data,(u=r.errors)&&a.default.error("GraphQL error(s) from tips_getStoreSaleCategoriesByStoreId",{storeId:s,errors:u}),i=(o||{}).getStoreSaleCategoriesByStoreId,e.abrupt("return",{categories:i.categories||[]});case 8:case"end":return e.stop()}}),e,this)})),i=function(){var e=u.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return i.apply(this,arguments)})},1193:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=i(r(8)),o=i(r(3)),u=i(r(1194));function i(e){return e&&e.__esModule?e:{default:e}}var s,c;t.default=(s=regeneratorRuntime.mark((function e(t){var r,i,s,c,d,l,f,p,g,h,y,v,m,b,w,I;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.productId,e.next=3,Promise.all([a.default.query("tips_getProductByIds",{productId:r}),a.default.query("getProductByIdSecondaryDetails",{productId:r,meta:{relatedLimit:0}})]);case 3:return i=e.sent,s=n(i,2),c=s[0],d=s[1],l=c.data,f=c.errors,p=d.data,g=d.errors,f&&o.default.warn("GraphQL error(s) from tips_getProductByIds",{params:t,primaryErrors:f}),g&&o.default.warn("GraphQL error(s) from getProductByIdSecondaryDetails",{params:t,secondaryErrors:g}),void 0===l&&o.default.error("Graphql tips_getProductByIds response did not include data",{params:t,response:c}),void 0===p&&o.default.error("Graphql getProductByIdSecondaryDetails response did not include data",{params:t,response:d}),h=(l||{}).getProductByIds,y=n(h=void 0===h?[]:h,1),v=y[0],m=void 0===v?{primaryDetailsMissing:!0}:v,b=(p||{}).getProductByIdSecondaryDetails,w=void 0===b?{}:b,I=Object.assign({},m,w),e.abrupt("return",u.default.formatProduct(I));case 19:case"end":return e.stop()}}),e,this)})),c=function(){var e=s.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return c.apply(this,arguments)})},1194:function(e,t,r){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.primaryDetailsMissing,r=e.brand,n=e.canonicalUrl,a=e.dealScore,o=e.description,u=e.store,i=(u=void 0===u?{}:u).storeId,s=e.imageUrlPrimary,c=e.imageUrlSecondary,d=e.offer,l=e.parentId,f=e.priceCurrent,p=e.priceHistory,g=void 0===p?{}:p,h=e.productDetails,y=e.title,v=e.variations,m=void 0===v?{}:v,b=e.defaultTags,w=e.variantId,I=e.productId,S=e.dealInsightHeadline,_=void 0===S?{}:S;return{primaryDetailsMissing:t,brand:r,canonicalUrl:n,dealScore:a,defaultTags:b,description:o,imageUrl:s,images:c,lastPrice:f,offer:d,priceHistory:g,productDetails:h,merchId:l,variantId:w,productId:I,storeId:i,title:y,variations:m,dealInsightHeadline:_}}Object.defineProperty(t,"__esModule",{value:!0}),t.default={formatProduct:n,formatProducts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e||!e.length)return[];try{return e.map(n)}catch(e){return[]}}}},1195:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(8)),a=u(r(3)),o=u(r(95));function u(e){return e&&e.__esModule?e:{default:e}}var i,s;t.default=(i=regeneratorRuntime.mark((function e(t){var r,u,i,s,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.productIds,e.next=3,n.default.query("getProductByIds",{productIds:r});case 3:return u=e.sent,i=u.data,(s=u.errors)&&a.default.warn("GraphQL error(s) from getProductByIds",{params:t,errors:s}),i&&void 0!==i||a.default.error("Graphql getProductByIds response did not include data",{params:t,response:u}),c=i.getProductByIds,d=void 0===c?[]:c,e.abrupt("return",o.default.formatProducts(d));case 9:case"end":return e.stop()}}),e,this)})),s=function(){var e=i.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return s.apply(this,arguments)})},1196:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(8)),a=o(r(3));function o(e){return e&&e.__esModule?e:{default:e}}var u,i;t.default=(u=regeneratorRuntime.mark((function e(t){var r,o,u,i,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.userId,e.prev=1,e.next=4,n.default.query("tips_showUserRegistrationPrompt",{guestUserId:r});case 4:return o=e.sent,u=o.data,(i=o.errors)&&a.default.warn("GraphQL error(s) from tips_showUserRegistrationPrompt",{params:t,errors:i}),s=(u||{}).getShowUserRegistrationPrompt,c=(s||{}).showRegistrationPrompt,e.abrupt("return",c);case 13:return e.prev=13,e.t0=e.catch(1),a.default.error(e.t0),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,this,[[1,13]])})),i=function(){var e=u.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return i.apply(this,arguments)})},1197:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=r(3),o=(n=a)&&n.__esModule?n:{default:n};var u={},i=function(e){o.default.info("honeyTips: Getting tip notifications",t);var t=u,r=e&&e[r];return r?function(e,t){return e.reduce((function(e,r){return e[r]=t[r]?t[r]:void 0,e}),{})}(r,t):t},s=function(e){var t=e.tipNotificationId,r=e.status;o.default.info("honeyTips: Updating tip notification "+t+" with status "+r);var n=i();return n[t]=r,n};t.default={initialize:function(e){var t=e.uniqueTipNotificationIds;o.default.info("honeyTips: Initializing tip notifications",t);var r=i();return("string"==typeof uniqueTipNotifications?[t]:t).filter((function(e){return void 0===r[e]})).forEach((function(e){return s({tipNotificationId:e,status:"unread"})})),r},update:s,getStatus:i,getStatusById:function(e){var t=e.tipNotificationId;return o.default.info("honeyTips: Getting tip notification by id "+t),u[t]}}},1198:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.incrementTipsShown=t.incrementTipsShownByProduct=t.getTipsShownByProduct=t.incrementTipsShownByStore=t.getTipsShownByStoreAndCategory=t.getTipsShownByStore=void 0;var n,a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(3),u=(n=o)&&n.__esModule?n:{default:n};function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s={},c={},d=(t.getTipsShownByStore=function(e){var t=e.storeId;return s[t]},t.getTipsShownByStoreAndCategory=function(e){var t=e.storeId,r=e.categoryId,n=s[t]||{};return(Object.values(n)||[]).filter((function(e){return e.categoryId===r})).reduce((function(e,t){return a({},e,i({},t.tipId,t))}),{})},t.incrementTipsShownByStore=function(e){var t=e.storeId,r=e.categoryId,n=e.tipId;try{var o=s[t]||{},c=(o[n]||{}).count||0,d=a({},o,i({},n,{tipId:n,storeId:t,count:c+1,categoryId:r})),l=a({},s,i({},t,d));s=l}catch(e){u.default.error(e)}}),l=(t.getTipsShownByProduct=function(e){var t=e.productId;return c[t]},t.incrementTipsShownByProduct=function(e){var t=e.productId,r=e.categoryId,n=e.tipId,o=e.storeId;try{var s=c[t]||{},d=(s[n]||{}).count||0,l=a({},s,i({},n,{tipId:n,storeId:o,productId:t,count:d+1,categoryId:r})),f=a({},c,i({},t,l));c=f}catch(e){u.default.error(e)}});t.incrementTipsShown=function(e){l(e),d(e)}},1199:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTeaserShownQuantityPerCategory=t.incrementTeaserShownQuantityPerCategory=void 0;var n,a=r(3),o=(n=a)&&n.__esModule?n:{default:n};var u={};t.incrementTeaserShownQuantityPerCategory=function(e){var t=e.storeId,r=e.categoryId;return u[t]=u[t]||{},u[t][r]=(u[t][r]||0)+1,o.default.debug("honeyTips:tips:teaserShown: incrementing teaser shown quantity for "+r+": "+u[t][r]),u[t][r]},t.getTeaserShownQuantityPerCategory=function(e){var t=e.storeId,r=e.categoryId;return u[t]=u[t]||{},u[t][r]=u[t][r]||0,o.default.debug("honeyTips:tips:teaserShown: retrieved teaser shown quantity for "+r+": "+u[t][r]),u[t][r]}},1200:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.incrementAutoPopProductQuantity=t.getAutoPopProductQuantity=void 0;var n,a=r(3),o=(n=a)&&n.__esModule?n:{default:n};var u={};t.getAutoPopProductQuantity=function(e){var t=e.productId,r=u[t];return o.default.debug("honeyTips: AutopopByProduct: getting autopop per product shown quantity "+t+": "+r),u[t]||0},t.incrementAutoPopProductQuantity=function(e){var t=e.productId;u[t]=(u[t]||0)+1,o.default.debug("honeyTips: AutopopByProduct: incremented autopop per product shown quantity "+t+": "+u[t])}},1201:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLaunchpadTipShownByStore=t.incrementLaunchpadTipShownByStore=void 0;var n,a=r(3),o=(n=a)&&n.__esModule?n:{default:n};var u={};t.incrementLaunchpadTipShownByStore=function(e){var t=e.storeId;u[t]=(u[t]||0)+1,o.default.debug("honeyTips: incremented launchpad shown quantity",u[t])},t.getLaunchpadTipShownByStore=function(e){var t=e.storeId;return o.default.debug("honeyTips: getting launchpad shown quantity",u),u[t]||0}},1202:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.incrementRegistrationTipShownQuantity=t.getRegistrationTipShownQuantity=void 0;var n,a=r(3),o=(n=a)&&n.__esModule?n:{default:n};var u={};t.getRegistrationTipShownQuantity=function(e){var t=e.storeId;return o.default.debug("honeyTips: getting registration tip shown quantity: "+u[t]),u[t]||0},t.incrementRegistrationTipShownQuantity=function(e){var t=e.storeId;u[t]=(u[t]||0)+1,o.default.debug("honeyTips: incremented registration tip shown quantity: "+u[t])}},1203:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setTeaserClosedPromptShown=t.resetTeaserClosedWithoutCtaCount=t.incrementTeaserClosedWithoutCtaCount=t.getTeaserClosedShouldShowPrompt=void 0;var n,a=(n=l(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!y){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,c.default.getUserABGroup("honeyTipsConfiguration_v4");case 4:t=e.sent,r=t.engagementPrompts,(n=(void 0===r?{}:r).promptThresholds)&&"number"===n.autopopPrompt&&(v=n.autopopPrompt,y=!0);case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),o=d(r(4)),u=d(r(55)),i=d(r(286)),s=d(r(3)),c=d(r(21));function d(e){return e&&e.__esModule?e:{default:e}}function l(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var f,p,g,h=!1,y=!1,v=3;t.getTeaserClosedShouldShowPrompt=(f=l(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y){e.next=3;break}return e.next=3,a();case 3:if(!h){e.next=6;break}return s.default.debug("teaserClosedWithoutCta:getTeaserClosedShouldShowPrompt: prompt already shown"),e.abrupt("return",!1);case 6:return e.next=8,u.default.getSetting("teaserClosedWithoutCtaCount");case 8:if(e.t0=e.sent,e.t0){e.next=11;break}e.t0=0;case 11:return t=e.t0,s.default.debug("teaserClosedWithoutCta:getTeaserClosedShouldShowPrompt: "+t),e.abrupt("return",t>=v);case 14:case"end":return e.stop()}}),e,void 0)}))),function(){return f.apply(this,arguments)}),t.incrementTeaserClosedWithoutCtaCount=(p=l(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.default.getSetting("teaserClosedWithoutCtaCount");case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=0;case 5:return t=e.t0,e.next=8,u.default.updateSetting("teaserClosedWithoutCtaCount",t+1);case 8:s.default.debug("teaserClosedWithoutCta:incrementTeaserClosedWithoutCtaCount: "+(t+1));case 9:case"end":return e.stop()}}),e,void 0)}))),function(){return p.apply(this,arguments)}),t.resetTeaserClosedWithoutCtaCount=(g=l(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.default.updateSetting("teaserClosedWithoutCtaCount",0);case 2:s.default.debug("teaserClosedWithoutCta:resetTeaserClosedWithoutCtaCount reset to 0"),o.default.send("honeyTips:tips",{action:i.default.RESET_TEASER_CLOSED_WITHOUT_CTA_COUNT_DONE},{allTabs:!0,ignoreResponse:!0});case 4:case"end":return e.stop()}}),e,void 0)}))),function(){return g.apply(this,arguments)}),t.setTeaserClosedPromptShown=function(){h=!0,s.default.debug("teaserClosedWithoutCta:setTeaserClosedPromptShown: "+h)}},1204:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setAutopopped=t.hasAutopopped=void 0;t.hasAutopopped=(n=s(regeneratorRuntime.mark((function e(t){var r=t.productId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.default.debug("honeyTips:coupons:hasAutopopped: Checking if product: "+r+" has autopopped this session"),e.abrupt("return",c.get(r)||!1);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)}),t.setAutopopped=(a=s(regeneratorRuntime.mark((function e(t){var r=t.productId,n=t.autopopped;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.default.debug("honeyTips:coupons:setAutopopped: Set if product: "+r+" has autopopped this session to: "+!!n),c.set(r,!!n);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)});var n,a,o,u=r(3),i=(o=u)&&o.__esModule?o:{default:o};function s(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var c=new Map},1205:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a;t.getAutopopCount=(n=o(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",u);case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),t.incrementAutopopCount=(a=o(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u+=1,e.abrupt("return",u);case 2:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)});function o(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var u=0},1206:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(5)),a=u(r(191)),o=u(r(4));function u(e){return e&&e.__esModule?e:{default:e}}var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function s(e){return n.default.try((function(){if("string"!=typeof e)throw new InvalidParametersError("path");var t=void 0;switch(e.split(".").pop()){case"jpg":case"jpeg":t="jpg";break;case"png":t="png";break;case"svg":t="svg+xml";break;default:throw new InvalidParametersError("file_type")}return n.default.try((function(){return a.default.get("https://cdn.honey.io/images/"+e)})).then((function(e){return"data:image/"+t+";base64,"+function(e){for(var t=0,r="";t<e.length;){var n=255&e.charCodeAt(t);if((t+=1)===e.length){r+=i.charAt(n>>2),r+=i.charAt((3&n)<<4),r+="==";break}var a=e.charCodeAt(t);if((t+=1)===e.length){r+=i.charAt(n>>2),r+=i.charAt((3&n)<<4|(240&a)>>4),r+=i.charAt((15&a)<<2),r+="=";break}var o=e.charCodeAt(t);t+=1,r+=i.charAt(n>>2),r+=i.charAt((3&n)<<4|(240&a)>>4),r+=i.charAt((15&a)<<2|(192&o)>>6),r+=i.charAt(63&o)}return r}(e.body)}))}))}o.default.addListener("imageloader:action",(function(e,t){switch(t&&t.action){case"getB64FromCDN":return s(t.path);default:throw new InvalidParametersError("action")}})),t.default={getB64FromCDN:s}},1207:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){a.default.isAvailable?i||((i=(0,n.default)("ws://localhost:35729/livereload")).on("connect",(function(){return o.default.debug("Live reload websocket is listening")})),i.on("error",(function(e){return o.default.error("Live reload websocket error: "+e)})),i.on("reload",(function(){console.clear(),o.default.debug("Live reload signal received: reloading the extension"),a.default.reload()}))):o.default.debug("Live reload is not available for this platform")};var n=u(r(1208)),a=u(r(1233)),o=u(r(3));function u(e){return e&&e.__esModule?e:{default:e}}var i=void 0},1230:function(e,t){},1233:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={isAvailable:!0,reload:function(){browser.runtime.reload()}}},1234:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(15)),a=o(r(4));function o(e){return e&&e.__esModule?e:{default:e}}function u(){return n.default.post("https://d.joinhoney.com/onboarding").then((function(e){return e.body}))}function i(){return n.default.get("https://d.joinhoney.com/onboarding").then((function(e){var t=e.body;return a.default.send("onboarding:updated",{status:t},{allTabs:!0,ignoreResponse:!0}).reflect(),t}))}function s(e){return n.default.patch("https://d.joinhoney.com/onboarding?step="+e).then((function(e){var t=e.body;return a.default.send("onboarding:updated",{status:t},{allTabs:!0,ignoreResponse:!0}).reflect(),t}))}a.default.addListener("onboarding:action",(function(e,t){var r=t&&t.data||{};switch(t&&t.action){case"init":return u();case"updateStatus":return s(r.step);case"getStatus":return i();default:throw new InvalidParametersError("action")}})),t.default={init:u,getStatus:i,updateStatus:s}},1235:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(4)),a=u(r(1236)),o=u(r(8));function u(e){return e&&e.__esModule?e:{default:e}}n.default.addListener("optimus:fetch:product:priceChanges",(function(e,t){return t.productId?o.default.query("getProductPriceHistory",{productId:t.productId,timeframe:30}).then((function(e){return e.data&&e.data.getProductPriceHistory&&e.data.getProductPriceHistory.numChanges})).catch((function(){return null})):o.default.query("getProductPriceHistoryByStoreIdVariantId",{storeId:"1",variantId:t.variantId,timeframe:30}).then((function(e){return e.data&&e.data.getProductPriceHistoryByStoreIdVariantId&&e.data.getProductPriceHistoryByStoreIdVariantId.numChanges})).catch((function(){return null}))}));var i={lru:a.default};t.default=i},1236:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(4)),a=u(r(35)),o=u(r(5));function u(e){return e&&e.__esModule?e:{default:e}}var i=(0,a.default)({max:10,length:function(){return 1},maxAge:108e5});function s(e){return o.default.try((function(){var t=i.get(e);if(t)return t;throw new NotFoundError}))}function c(e,t,r){return o.default.try((function(){return i.set(e,t,r)}))}function d(e){return o.default.try((function(){return i.del(e)}))}setInterval((function(){return i.prune()}),3e5),n.default.addListener("optimuslru:access",(function(e,t){var r=t&&t.data||{};switch(t&&t.action){case"get":return s(r.key);case"set":return c(r.key,r.val,r.options);case"del":return d(r.key);default:throw new InvalidParametersError("Not a supported action")}})),t.default={get:s,set:c,del:d,prefixed:function(e){return{del:function(t){return d(e+":"+t)},get:function(t){return s(e+":"+t)},set:function(t,r){return c(e+":"+t,r)}}},lru:i},window.optimusLru=i},1237:function(e,t,r){"use strict";var n=u(r(3)),a=u(r(155)),o=r(1238);function u(e){return e&&e.__esModule?e:{default:e}}var i,s,c=(i=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.default.isPayNowEnabled();case 2:e.sent&&((0,o.createPayNowConfigListener)(),(0,o.createPayNowEligibilityListener)(),(0,o.createPayNowUIListener)(),(0,o.createWalletSuppressionListener)(),(0,o.createPayNowPaymentsListener)());case 4:case"end":return e.stop()}}),e,void 0)})),s=function(){var e=i.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(){return s.apply(this,arguments)});try{c()}catch(e){n.default.error("Error initializing Honey Pay Now/Wallet listeners: "+e)}},1238:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1239);Object.defineProperty(t,"createPayNowConfigListener",{enumerable:!0,get:function(){return s(n).default}});var a=r(1240);Object.defineProperty(t,"createPayNowEligibilityListener",{enumerable:!0,get:function(){return s(a).default}});var o=r(1242);Object.defineProperty(t,"createPayNowUIListener",{enumerable:!0,get:function(){return s(o).default}});var u=r(1243);Object.defineProperty(t,"createWalletSuppressionListener",{enumerable:!0,get:function(){return s(u).default}});var i=r(1244);function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"createPayNowPaymentsListener",{enumerable:!0,get:function(){return s(i).default}})},1239:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(4)),a=r(156),o=u(r(155));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){n.default.addListener("honey-pay-now:action:config",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t&&t.action){case a.HONEY_PAY_NOW_MESSAGES.CHECK_PAY_NOW_FEATURE_FLAG:return o.default.isPayNowEnabled();case a.HONEY_PAY_NOW_MESSAGES.PAY_NOW_GET_CONFIG:return o.default.getConfig();case a.HONEY_PAY_NOW_MESSAGES.GET_ENABLED_PAY_NOW_ADDRESS_SUBDIVISIONS:return o.default.getEnabledAddressSubdivisions();default:throw new InvalidParametersError("Invalid action received by Honey Wallet Config Listener")}}))}},1240:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=l(r(1241)),o=l(r(3)),u=l(r(39)),i=l(r(21)),s=l(r(4)),c=r(156),d=l(r(155));function l(e){return e&&e.__esModule?e:{default:e}}function f(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var p,g=null,h={},y=void 0,v=null,m=null,b=function(){return n({},h,{savings:h.savings.toFixed(2),finalCost:h.finalCost.toFixed(2),productConfigurationId:y,viewTerms:v,storeProTip:m,currentStore:g})},w=(p=f(regeneratorRuntime.mark((function e(t,r){var s,c,l,f,p,w,I,S,_,E,x,R,P,O,T,C;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.default.getStoreByTabId(r);case 2:return s=e.sent,c=(0,a.default)(),l={eventId:c,isGiftCardsEnabled:null,isDeviceEnabled:null,isStoreEnabled:null,isGenerallyEligible:null,isEligible:!1},f=d.default.promiseTimeout,e.prev=6,e.next=9,f(i.default.getInfo(),1e3);case 9:if(p=e.sent,w=p.isLoggedIn,I=p.honeyWallet,l.isGiftCardsEnabled=1===I,w){e.next=14;break}return e.abrupt("return",l);case 14:if(I){e.next=16;break}return e.abrupt("return",l);case 16:return e.next=18,f(d.default.getDeviceEnabled("ff","12.8.4"));case 18:if(S=e.sent,l.isDeviceEnabled=S,S){e.next=22;break}return e.abrupt("return",l);case 22:return e.next=24,f(d.default.getStoreEligibility(s.id));case 24:if(_=e.sent,E=_.enabled,x=_.defaultProductId,R=_.termsAndConditions,l.isStoreEnabled=E,E){e.next=31;break}return e.abrupt("return",l);case 31:return e.next=33,f(d.default.getGeneralEligibility(c,t,s.id));case 33:if(P=e.sent,O=P.isUserEligible,T=P.storeSavings,C=P.proTip,l.isGenerallyEligible=O,O){e.next=40;break}return e.abrupt("return",l);case 40:v=R,y=x,h=T,m=C,g=s,e.next=51;break;case 47:return e.prev=47,e.t0=e.catch(6),o.default.error("There was an error determining overall eligibility."),e.abrupt("return",!1);case 51:return e.abrupt("return",n({},l,{isEligible:!0,storeSavings:b()}));case 52:case"end":return e.stop()}}),e,void 0,[[6,47]])}))),function(e,t){return p.apply(this,arguments)});t.default=function(){var e;s.default.addListener("honey-pay-now:action:eligibility",(e=f(regeneratorRuntime.mark((function e(t){var r,n,o,i,s,l,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments[2];return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.default.getStoreByTabId(p.tabId);case 2:r=e.sent,e.t0=f&&f.action,e.next=e.t0===c.HONEY_PAY_NOW_MESSAGES.DETERMINE_INITIAL_PAY_NOW_PAYMENTS_PAGE_ELIGIBILITY?6:e.t0===c.HONEY_PAY_NOW_MESSAGES.GET_PAY_NOW_STORE_ELIGIBILITY?8:e.t0===c.HONEY_PAY_NOW_MESSAGES.GET_PAY_NOW_GENERAL_ELIGIBILITY?9:e.t0===c.HONEY_PAY_NOW_MESSAGES.GET_PAY_NOW_GENERAL_ELIGIBILITY_LOGGED_OUT?12:e.t0===c.HONEY_PAY_NOW_MESSAGES.GET_STORE_SAVINGS?15:e.t0===c.HONEY_PAY_NOW_MESSAGES.GET_PAY_NOW_DEVICE_ENABLED?16:17;break;case 6:return n=f.data.cartPrice,e.abrupt("return",w(n,p.tabId));case 8:return e.abrupt("return",d.default.getStoreEligibility(r.id));case 9:return o=f.data.cartPrice,i=(0,a.default)(),e.abrupt("return",d.default.getGeneralEligibility(i,o,r.id));case 12:return s=f.data.cartPrice,l=(0,a.default)(),e.abrupt("return",d.default.getGeneralEligibilityLoggedOut(l,s,r.id));case 15:return e.abrupt("return",b());case 16:return e.abrupt("return",d.default.getDeviceEnabled());case 17:throw new InvalidParametersError("Invalid action received by Honey Wallet Eligibility Listener");case 18:case"end":return e.stop()}}),e,void 0)}))),function(t){return e.apply(this,arguments)}))}},1242:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=s(r(4)),o=r(156),u=s(r(19)),i=s(r(155));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(e,t){return a.default.send("honey-pay-now:action:ui",{action:o.HONEY_PAY_NOW_MESSAGES.SET_PAY_NOW_CARD_VISIBILITY,data:e},{tab:t})},d=function(e,t){return a.default.send("honey-pay-now:action:ui",{action:o.HONEY_PAY_NOW_MESSAGES.SET_PAY_NOW_MODAL_VISIBILITY,data:e},{tab:t})},l=function(e,t){return a.default.send("honey-pay-now:action:ui",{action:o.HONEY_PAY_NOW_MESSAGES.SHIFT_PAY_NOW_MODAL,data:e},{tab:t})},f=function(e){return a.default.send("honey-pay-now:action:ui",{action:o.HONEY_PAY_NOW_MESSAGES.REMOVE_PAY_NOW_IFRAME},{tab:e})},p=function(e,t){return a.default.send("honey-pay-now:action:ui",{action:o.HONEY_PAY_NOW_MESSAGES.OPEN_PAY_NOW_AUTOPOP,data:e},{tab:t})},g=function(e){var t,r,a,o=JSON.parse(localStorage.getItem("giftcardsReminderMap"));localStorage.setItem("giftcardsReminderMap",JSON.stringify(n({},o,(t={},r=e.storeId,a=e.enabled,r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t))))},h=function(e){var t=JSON.parse(localStorage.getItem("giftcardsReminderMap"));return t&&t[e]},y=function(){var e,t;a.default.addListener("honey-pay-now:action:ui",(e=regeneratorRuntime.mark((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2];return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=r&&r.action,e.next=e.t0===o.HONEY_PAY_NOW_MESSAGES.REMOVE_PAY_NOW_IFRAME?3:e.t0===o.HONEY_PAY_NOW_MESSAGES.GOOGLE_PLACES_API_GET_ADDRESS_SUGGESTIONS?4:e.t0===o.HONEY_PAY_NOW_MESSAGES.OPEN_PAY_NOW_AUTOPOP?7:e.t0===o.HONEY_PAY_NOW_MESSAGES.SET_PAY_NOW_MODAL_VISIBILITY?8:e.t0===o.HONEY_PAY_NOW_MESSAGES.SHIFT_PAY_NOW_MODAL?9:e.t0===o.HONEY_PAY_NOW_MESSAGES.SET_PAY_NOW_CARD_VISIBILITY?10:e.t0===o.HONEY_PAY_NOW_MESSAGES.SET_REMINDER?11:e.t0===o.HONEY_PAY_NOW_MESSAGES.GET_REMINDER?12:13;break;case 3:return e.abrupt("return",f(n.tabId));case 4:return e.next=6,u.default.sleep(100);case 6:return e.abrupt("return",i.default.getAddressSuggestions(r.term));case 7:return e.abrupt("return",p(r.data,n.tabId));case 8:return e.abrupt("return",d(r.data,n.tabId));case 9:return e.abrupt("return",l(r.data,n.tabId));case 10:return e.abrupt("return",c(r.data,n.tabId));case 11:return e.abrupt("return",g(r.data));case 12:return e.abrupt("return",h(r.data));case 13:throw new InvalidParametersError("Invalid action received by Honey Wallet UI Listener");case 14:case"end":return e.stop()}}),e,void 0)})),t=function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))},function(e){return t.apply(this,arguments)}))};t.default=function(){y()}},1243:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(4)),a=r(156),o=u(r(21));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){n.default.addListener("honey-pay-now:action:suppression",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t&&t.action){case a.HONEY_PAY_NOW_MESSAGES.SUPPRESS_HONEY_PAY_NOW_PROMPT:var r=t.data.checked;return o.default.updateSetting("honeyWallet",r?0:1);default:throw new InvalidParametersError("Invalid action received by Suppression Listener")}}))}},1244:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(4)),a=r(156),o=u(r(155));function u(e){return e&&e.__esModule?e:{default:e}}var i=function(){var e,t;n.default.addListener("honey-pay-now:action:payments",(e=regeneratorRuntime.mark((function e(t){var r,n,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=u&&u.action,e.next=e.t0===a.HONEY_PAY_NOW_MESSAGES.GET_BRAINTREE_CLIENT_TOKEN?3:e.t0===a.HONEY_PAY_NOW_MESSAGES.SUBMIT_PAYMENT_METHOD_NONCE?4:e.t0===a.HONEY_PAY_NOW_MESSAGES.DELETE_WALLET_PAYMENT_METHOD?6:e.t0===a.HONEY_PAY_NOW_MESSAGES.GET_WALLET_PAYMENT_METHODS?7:e.t0===a.HONEY_PAY_NOW_MESSAGES.UPDATE_WALLET_ADDRESS?8:e.t0===a.HONEY_PAY_NOW_MESSAGES.REQUEST_GIFT_CARD?9:10;break;case 3:return e.abrupt("return",o.default.getBraintreeClientToken());case 4:return r=o.default.createWalletPaymentMethod,n=o.default.promiseTimeout,e.abrupt("return",n(r(u.data.nonce)));case 6:return e.abrupt("return",o.default.deleteWalletPaymentMethod(u.data.token));case 7:return e.abrupt("return",o.default.getPaymentMethods());case 8:return e.abrupt("return",o.default.updateWalletAddress(u.data));case 9:return e.abrupt("return",o.default.requestGiftCard(u.data));case 10:throw new InvalidParametersError("Invalid action received by Suppression Listener");case 11:case"end":return e.stop()}}),e,void 0)})),t=function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))},function(e){return t.apply(this,arguments)}))};t.default=function(){i()}},1245:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o=(n=h(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.default)("https://www.paypal.com/credit-presentment/honey");case 2:return t=e.sent,e.next=5,t.json();case 5:return r=e.sent,n=r.ts,e.abrupt("return","vr="+n.vr+";vt="+n.vt+";vreXpYrS="+n.vreXpYrS+";vteXpYrS="+n.vteXpYrS+";");case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),u=(a=h(regeneratorRuntime.mark((function e(t){var r,n,a,u,s,p,h,y,v,m,b=t.countryCode,w=t.locale,I=t.touchpointCode,S=t.flow,_=t.merchantUrl,E=t.applicationContext,x=void 0===E?[]:E;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.default.getInfo();case 3:if(e.sent.isLoggedIn){e.next=6;break}return e.abrupt("return",null);case 6:return e.next=8,d.default.getDeviceId();case 8:return r=e.sent,e.next=11,l.default.getSessionId();case 11:return n=e.sent,e.next=14,o();case 14:return a=e.sent,u=2===w.length?w+"-"+b:w,s=new URL(_),p=s.hostname.split(".").slice(-2).join("."),e.next=20,i.default.mutate("ext_getPayPalMessaging",{input:{country_code:b,language:u,identity_context:[{type:"MERCHANT_ORIGIN",value:p},{type:"COOKIES",value:"ts="+encodeURIComponent(a)}],recommendation_context:{touchpoint_details:[{code:I,message_count:2}]},application_context:[].concat(g(x),[{name:"honey_device_id",value:r},{name:"honey_session_id",value:""+n},{name:"TENANT_FLOW",value:S}])}});case 20:if(h=e.sent,y=h.errors,!(!(v=h.data)||y&&y.length)){e.next=25;break}throw new InvalidResponseError("PayPal message could not be generated");case 25:return m=v.createPayPalPersonalizationMessaging.touchpoint_messages,e.abrupt("return",{touchpointMessages:m});case 29:return e.prev=29,e.t0=e.catch(0),c.default.error("Error getting personalization message",e.t0),e.abrupt("return",null);case 33:case"end":return e.stop()}}),e,this,[[0,29]])}))),function(e){return a.apply(this,arguments)}),i=p(r(8)),s=p(r(579)),c=p(r(3)),d=p(r(153)),l=p(r(55)),f=p(r(21));function p(e){return e&&e.__esModule?e:{default:e}}function g(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function h(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}p(r(4)).default.addListener("paypal:action",(function(e,t){var r=t.action,n=t.data;switch(r){case"getMessage":return u(n);default:return null}})),t.default={getMessage:u}},1246:function(e,t,r){"use strict";var n,a,o=(n=p(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.default.getStoreByTabId(t);case 2:(r=e.sent)&&r.id&&c.default.setSessionAttribute(r.id,"userHBC",(0,l.default)().unix()),n={store:r},r&&"1"===r.id&&(n.illustration_shown=window.sessionStorage.getItem("honeyCornerIllustration")),s.default.sendEvent("ext002001",n);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)}),u=(a=p(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.default.query("ext_getUserTransactions",t);case 2:return r=e.sent,n=r.data.getTransactionsByUserId,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)}),i=f(r(4)),s=f(r(20)),c=f(r(39)),d=f(r(8)),l=f(r(0));function f(e){return e&&e.__esModule?e:{default:e}}function p(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}i.default.addListener("popover:bg",(function(e,t){switch(t&&t.action){case"getPagesDetected":return r=t.data.tabId,i.default.send("popover:cs",{action:"getPagesDetected"},{tab:r,ignoreResponse:!1}).catch((function(){}));case"getStore":return function(e){return i.default.send("popover:cs",{action:"getStore"},{tab:e,ignoreResponse:!1}).catch((function(){}))}(t.data.tabId);case"runFindSavings":return function(e){return i.default.send("popover:cs",{action:"runFindSavings"},{tab:e,ignoreResponse:!1}).catch((function(){}))}(t.data.tabId);case"sendClickData":return o(t.data.tabId);case"getGoldTransactions":return u(t.data);default:throw new InvalidParametersError("Invalid popover action")}var r}))},129:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o=(n=regeneratorRuntime.mark((function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.ttl,o=void 0===a?d:a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=l[t])){e.next=3;break}return e.abrupt("return",r);case 3:return l[t]=i.default.get("featureFlags:"+t).then((function(e){return e})).catch((function(){return u.default.get("https://d.joinhoney.com/features/"+t).query({serviceName:"honey-extension",serviceVersion:"12.8.4"}).then((function(e){var r=JSON.parse(e.text).active;return i.default.set("featureFlags:"+t,r,o),r}))})).catch((function(){return i.default.set("featureFlags:"+t,!1,o),!1})).then((function(e){return delete l[t],e})),e.abrupt("return",l[t]);case 5:case"end":return e.stop()}}),e,this)})),a=function(){var e=n.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return a.apply(this,arguments)}),u=c(r(15)),i=c(r(47)),s=c(r(4));function c(e){return e&&e.__esModule?e:{default:e}}var d=9e5,l={};s.default.addListener("feature:flag",(function(e,t){switch(t&&t.action){case"getFeatureFlag":return o(t.featureName,{ttl:t.ttl});default:throw new InvalidParametersError("action")}})),t.default={getFeatureFlag:o,setFeatureFlagOverride:function(e,t){i.default.set("featureFlags:"+e,t,3e5)}}},130:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=r(1076),o=(n=a)&&n.__esModule?n:{default:n};t.default={set:function(e){return o.default.set(e)},get:function(e){return o.default.get(e)},remove:function(e){return o.default.remove(e)},getAllForDomain:function(e){return o.default.getAllForDomain(e)}}},1329:function(e,t){},1341:function(e,t){},1343:function(e,t){},15:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAuthenticated=function(){return d&&c};var n=u(r(5)),a=u(r(276)),o=u(r(73));function u(e){return e&&e.__esModule?e:{default:e}}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}try{n.default.config({cancellation:!0})}catch(e){}function s(e){var t=e.response&&e.response.body||{},r=(""+(t.message||"")).trim()||""+(e.status||"network_failure"),n=new(t.error&&"string"==typeof t.error&&o.default[t.error+"Error"]||Error)(r);return n.status=e.status,n.response=e.response,n}var c="",d="";function l(e,t){try{c=e,d=t,window.localStorage.setItem("honey-refresh-audiences",JSON.stringify(i({},"d.joinhoney.com",e))),window.localStorage.setItem("honey-access-audiences",JSON.stringify(i({},"d.joinhoney.com",t)))}catch(e){}}try{if(c=(JSON.parse(window.localStorage.getItem("honey-refresh-audiences"))||{})["d.joinhoney.com"],d=(JSON.parse(window.localStorage.getItem("honey-access-audiences"))||{})["d.joinhoney.com"],!c||!d){var f=JSON.parse(window.localStorage.getItem("user:auth_tokens")||"{}");c=f.refreshToken;var p=JSON.parse(window.localStorage.getItem("user:auth_tokens")||"{}");d=p.accessToken,l(c,d)}}catch(e){}var g={};["get","post","put","patch","delete"].forEach((function(e){g[e]=function(){var t=a.default[e].apply(a.default,arguments);t.set("x-honey-auth-at",d),t.set("x-honey-auth-rt",c),t.retry(3);var r=t.end;return t.end=function(e){r.call(t,(function(t,r){"function"==typeof e&&(t?e(s(t),null):e(null,r))}))},t.promise=function(){return new n.default((function(e,r,n){t.end((function(t,n){t?r(t):(n.header&&n.header["x-honey-auth-rt"]&&n.header["x-honey-auth-at"]&&l(n.header["x-honey-auth-rt"],n.header["x-honey-auth-at"]),e(n))})),"function"==typeof n&&n((function(){return t.abort()}))}))},t.then=function(){var e;return(e=t.promise()).then.apply(e,arguments)},t.catch=function(){var e;return(e=t.promise()).catch.apply(e,arguments)},t}})),g.setRefreshAndAccessTokens=l,t.default=g},153:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(5)),a=d(r(130)),o=d(r(279)),u=d(r(154)),i=d(r(21)),s=d(r(19)),c=(d(r(3)),d(r(0)));function d(e){return e&&e.__esModule?e:{default:e}}c.default.duration(10,"minutes"),c.default.duration(5,"minutes");var l=/^[1-9]\d+$/,f={name:"honeyExtDeviceId",url:"https://extension.joinhoney.com/",domain:"extension.joinhoney.com",expires:2524608e6};function p(e){return e&&"string"==typeof e&&l.test(e)}var g=!1,h=!0,y=void 0,v=void 0;function m(e){var t=e&&e.forceRefresh;return y&&!t?n.default.resolve(y):(v||(v=n.default.try((function(){return n.default.try((function(){return window.localStorage.getItem("device:deviceId")})).catch((function(){return null})).then((function(e){return p(e)?e:u.default.local.get("device:deviceId")})).catch((function(){return null})).then((function(e){return p(e)?e:a.default.get(Object.assign({},f)).then((function(e){return e.value}))})).catch((function(){return null})).then((function(e){return p(e)?e:u.default.local.get("user:device-id")})).catch((function(){return null})).then((function(e){return p(e)?e:null}))})).then((function(e){return h&&(g=!!p(e),h=!1),function(e){try{window.localStorage.setItem("device:deviceId",e)}catch(e){}try{u.default.local.set("device:deviceId",e).reflect()}catch(e){}try{a.default.set(Object.assign({},f,{value:e})).reflect()}catch(e){}}(y=p(e)?e:s.default.createId()),y})).finally((function(){v=null}))),v)}function b(e){return n.default.props({userId:i.default.getUserId(),deviceId:m(e)}).then((function(e){return"ff.12.8.4."+e.userId+"."+e.deviceId}))}t.default={getDeviceId:m,getExv:b,getManifest:function(){return o.default.getManifest()},isExistingDevice:function(){return m().then((function(){return g}))}}},154:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function e(t,r,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in a)return a.value;var u=a.get;return void 0!==u?u.call(n):void 0},o=c(r(1078)),u=c(r(1080)),i=c(r(47)),s=c(r(19));function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=new(function(e){function t(){return d(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"get",value:function(e,r){var n=this,o=s.default.cleanString(e);return i.default.get(o).catch((function(){return a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"get",n).call(n,o,r)}))}},{key:"set",value:function(e,r,n){var o=s.default.cleanString(e);return i.default.set(o,r,n),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,o,r,n).catch(StorageError,(function(){}))}},{key:"del",value:function(e,r){var n=s.default.cleanString(e);return i.default.del(n),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"del",this).call(this,n,r)}}]),t}(u.default))("local",o.default.local),p=new u.default("sync",o.default.sync),g={isAvailable:function(){return o.default.bundled.isAvailable()},getAssetURL:function(e){return o.default.bundled.getAssetURL(e)}};f.get("storage:lastWiped").catch((function(){return f.clearUnimportant()})),t.default={local:f,sync:p,bundled:g}},155:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o,u,i,s,c,d,l,f,p,g,h,y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},v=(n=F(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=k.default.getFeatureFlag("pay_now_enabled"),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),m=(a=F(regeneratorRuntime.mark((function e(){var t,r,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ff",o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"12.8.4";return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0,r="DEVICE-ENABLED:"+a+"-"+o,e.prev=2,e.next=5,W.request(r,H)((function(){return D.default.query("giftcards_getGiftcardsDeviceEnabled",{browser:a,extVersion:o})}));case 5:t=e.sent,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(2),new Error("Error requesting Pay Now device enabled flag");case 11:return n=t.data.getGiftcardsDeviceEnabled.enabled,e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(){return a.apply(this,arguments)}),b=(o=F(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,n="STORE-ENABLED:"+t,e.prev=2,e.next=5,W.request(n)((function(){return D.default.query("giftcards_getGiftcardsStoreEligibility",{storeId:t})}));case 5:r=e.sent,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(2),new Error("Error requesting Pay Now store enabled flag");case 11:return a=r.data.getGiftcardsStoreEligibility,e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(e){return o.apply(this,arguments)}),w=(u=F(regeneratorRuntime.mark((function e(t,r,n){var a,o,u,i,s,c,d,l,f,p,g,h,y,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.default.getDeviceId();case 2:return a=e.sent,o=void 0,e.prev=4,e.next=7,D.default.query("giftcards_getGiftcardsGeneralEligibility",{eventId:t,storeId:n,cartTotal:""+r},{headers:B({},q.HEADER_DEVICE_ID,a)});case 7:o=e.sent,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(4),new Error("Error requesting user eligibility");case 13:return u=o.data.getGiftcardsGeneralEligibility,i=u.eligible,s=u.finalCost,c=u.goldAward,d=u.goldBack,l=u.instantSavings,f=u.isRepeatPurchaser,p=u.savings,g={finalCost:s,goldAward:c,goldBack:d,instantSavings:l,isRepeatPurchaser:f,savings:p},e.next=17,L.default.getInfo();case 17:return h=e.sent,y=r+":"+h.id+":"+n,v=Y.get(y),e.abrupt("return",{isUserEligible:i&&!v,storeSavings:g});case 21:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(e,t,r){return u.apply(this,arguments)}),I=(i=F(regeneratorRuntime.mark((function e(t,r,n){var a,o,u,i,s,c,d,l,f,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.default.getDeviceId();case 2:return a=e.sent,o=void 0,e.prev=4,e.next=7,D.default.query("giftcards_getGiftcardsGeneralEligibilityLoggedOut",{eventId:t,storeId:n,cartTotal:""+r,transactionSource:"GIFT_CARD_EXTENSION"},{headers:B({},q.HEADER_DEVICE_ID,a)});case 7:o=e.sent,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(4),new Error("Error requesting user eligibility for unauthed user");case 13:return u=o.data.getGiftcardsGeneralEligibilityLoggedOut,i=u.eligible,s=u.finalCost,c=u.goldAward,d=u.goldBack,l=u.instantSavings,f=u.savings,p={finalCost:s,goldAward:c,goldBack:d,instantSavings:l,savings:f},e.abrupt("return",{isUserEligible:i,storeSavings:p});case 16:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(e,t,r){return i.apply(this,arguments)}),S=(s=F(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0,e.prev=2,e.next=5,W.request("ENABLED_SUBDIVISIONS")((function(){return D.default.query("giftcards_getGiftcardsEnabledSubdivisions",{})}));case 5:t=e.sent,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(2),new Error("Error requesting enabled address subdivisions");case 11:return r=t.data.giftCardsEnabledSubdivisions,e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(){return s.apply(this,arguments)}),_=(c=F(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0,e.prev=1,e.next=4,D.default.query("wallet_getWalletClientToken",{});case 4:t=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),new Error("Error requesting Braintree client token");case 10:return r=t.data.getWalletClientToken.clientToken,e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return c.apply(this,arguments)}),E=(d=F(regeneratorRuntime.mark((function e(){var t,r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.default.getInfo();case 2:return t=e.sent,r=void 0,e.prev=4,e.next=7,D.default.query("wallet_getUserPaymentMethods",{userId:t.id});case 7:r=e.sent,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(4),new Error("Error requesting wallet payment methods");case 13:return n=r.data.getUserById.walletPaymentMethods,a=[].concat(M(n.creditCards),M(n.paypal)),e.abrupt("return",a);case 16:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(){return d.apply(this,arguments)}),x=(l=F(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,e.next=3,N.default.getDeviceId();case 3:return n=e.sent,e.prev=4,e.next=7,D.default.mutate("wallet_createWalletPaymentMethod",{nonce:t,deviceData:n});case 7:r=e.sent,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(4),new Error("Error creating payment method");case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(e){return l.apply(this,arguments)}),R=(f=F(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,e.prev=1,e.next=4,D.default.mutate("wallet_deleteWalletPaymentMethod",{token:t});case 4:r=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),new Error("Error deleting wallet payment method");case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return f.apply(this,arguments)}),P=(p=F(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,e.prev=1,e.next=4,D.default.mutate("wallet_updateWalletAddress",y({},t));case 4:r=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),new Error("Error updating wallet address");case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return p.apply(this,arguments)}),O=(g=F(regeneratorRuntime.mark((function e(t){var r,n,a,o=this,u=t.fn,i=t.test,s=t.iterations,c=t.waitDuration,d=void 0===c?1e3:c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=void 0,n=function(){var e=F(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout((function(){e()}),d)}));case 2:case"end":return e.stop()}}),e,o)})));return function(){return e.apply(this,arguments)}}(),a=0;case 3:if(!(a<s)){e.next=14;break}return e.next=6,u();case 6:if(r=e.sent,!i(r)){e.next=9;break}return e.abrupt("break",14);case 9:return e.next=11,n();case 11:a+=1,e.next=3;break;case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)}),T=(h=F(regeneratorRuntime.mark((function e(t){var r,n,a,o,u,i,s,c,d=this,l=t.cartPrice,f=t.token,p=t.userId,g=t.storeName,h=t.productConfigurationId,y=t.storeId,v=t.deviceData;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,e.next=3,N.default.getDeviceId();case 3:return n=e.sent,e.prev=4,e.next=7,D.default.mutate("giftcards_createGiftcardRequest",{amount:Math.round(100*parseFloat(l)),userId:p,token:f,merchantName:g,productConfigurationId:h,deviceData:v,storeId:y},{headers:B({},q.HEADER_DEVICE_ID,n)});case 7:return a=e.sent,o=a.data.createGiftcardRequest.requestId,u=function(){var e=F(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.default.query("giftcards_getGiftcardRequest",{requestId:o});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,d)})));return function(){return e.apply(this,arguments)}}(),i=function(e){return e.data},e.next=13,O({fn:u,test:i,iterations:20,waitDuration:3e3});case 13:if((r=e.sent).data){e.next=16;break}throw new Error("Error requesting gift card");case 16:s=l+":"+p+":"+y,Y.set(s,!0),e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(4),new Error("Error requesting gift card");case 23:return c=r.data.getGiftcardRequest,e.abrupt("return",c);case 25:case"end":return e.stop()}}),e,this,[[4,20]])}))),function(e){return h.apply(this,arguments)}),C=j(r(35)),A=j(r(282)),k=j(r(129)),L=j(r(21)),N=j(r(153)),D=j(r(8)),U=j(r(3));function j(e){return e&&e.__esModule?e:{default:e}}function M(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function B(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function F(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var G,q=A.default.HEADER_NAMES,H=6e5,W=function(e){var t=e.max,r=void 0===t?50:t,n=e.maxAge,a=void 0===n?36e5:n,o=e.description,u=new C.default({max:r,maxAge:a});return{request:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36e5;return t=F(regeneratorRuntime.mark((function t(n){var a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.get(e);case 2:if(!(a=t.sent)||!a.data||a.errors){t.next=6;break}return U.default.info("["+o+": CACHE HIT]: "+e),t.abrupt("return",a);case 6:return U.default.info("["+o+": CACHE MISS]: "+e),i=n(),u.set(e,i,r),t.abrupt("return",i);case 10:case"end":return t.stop()}}),t,void 0)}))),function(e){return t.apply(this,arguments)}},delete:function(e){return u.del(e)}}}({description:"Honey Pay Now"}),Y=new C.default({max:1/0,maxAge:3e5}),V=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,r=void 0,n=new Promise((function(e,n){r=setTimeout(F(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.default.getUserId();case 2:r=e.sent,G&&G({userId:r,ms:t}),n(new Error("Timed out"));case 5:case"end":return e.stop()}}),e,void 0)}))),t)}));return Promise.race([n,e]).then((function(e){return clearTimeout(r),e})).catch((function(e){return clearTimeout(r),U.default.error(e),Promise.reject(e)}))};t.default={createWalletPaymentMethod:x,deleteWalletPaymentMethod:R,requestGiftCard:T,getGeneralEligibility:w,getGeneralEligibilityLoggedOut:I,getDeviceEnabled:m,getStoreEligibility:b,getEnabledAddressSubdivisions:S,getBraintreeClientToken:_,getPaymentMethods:E,isPayNowEnabled:v,updateWalletAddress:P,promiseTimeout:V}},156:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={CONTROL:"control",ON:"on"},a={HOW_IT_WORKS:{CONTROL:n.CONTROL,ON:n.ON},START_ADD_PAYMENT_METHOD_SCREEN:{CONTROL:n.CONTROL,ON:n.ON}};t.AB_TEST_GROUP_NAMES=n,t.AB_TEST_GROUPS=a,t.AB_TEST_NAMES={HOW_IT_WORKS:"giftcards_how_it_works",START_ADD_PAYMENT_METHOD_SCREEN:"start_add_payment_method_screen"},t.GIFTCARDS_SDATA_SUB_SOURCES={GIFTCARDS_HOW_IT_WORKS:"honey-pay-now-how-it-works",ADD_PAYMENT_METHOD_START:"honey-pay-now-add-payment-method-start",ADD_PAYMENT_METHOD_SELECT:"honey-pay-now-add-payment-method-select",ADD_PAYMENT_METHOD_SUCCESS:"honey-pay-now-add-payment-method-success"},t.HONEY_PAY_NOW_MESSAGES={GET_PAY_NOW_GENERAL_ELIGIBILITY:"get-pay-now-general-eligibility",GET_PAY_NOW_GENERAL_ELIGIBILITY_LOGGED_OUT:"get-pay-now-general-eligibility-logged-out",GET_ENABLED_PAY_NOW_ADDRESS_SUBDIVISIONS:"get-enabled-pay-now-address-subdivisions",GET_PAY_NOW_STORE_ELIGIBILITY:"get-pay-now-store-eligibility",GET_PAY_NOW_DEVICE_ENABLED:"get-pay-now-device-enabled",UPDATE_IN_PAY_NOW_ELIGIBILITY_STATUS:"update-in-pay-now-eligibility-status",DETERMINE_INITIAL_PAY_NOW_PAYMENTS_PAGE_ELIGIBILITY:"determine-initial-pay-now-payments-page-eligibility",CHECK_PAY_NOW_CURRENT_ELIGIBILITY:"check-pay-now-current-eligibility",GET_STORE_SAVINGS:"get-store-savings",GET_BRAINTREE_CLIENT_TOKEN:"get-braintree-client-token",RECEIVE_CLIENT_TOKEN:"receive-client-token",SUBMIT_PAYMENT_METHOD_NONCE:"submit-payment-method-nonce",GET_WALLET_PAYMENT_METHODS:"get-wallet-payment-methods",DELETE_WALLET_PAYMENT_METHOD:"delete-wallet-payment-method",UPDATE_WALLET_ADDRESS:"update-wallet-address",REQUEST_GIFT_CARD:"request-gift-card",SUPPRESS_HONEY_PAY_NOW_PROMPT:"suppression-honey-pay-now-prompt",REMOVE_PAY_NOW_IFRAME:"remove-pay-now-iframe",SET_PAY_NOW_MODAL_VISIBILITY:"set-pay-now-modal-visibility",SHIFT_PAY_NOW_MODAL:"shift-pay-now-modal",SET_PAY_NOW_CARD_VISIBILITY:"set-pay-now-card-visibility",SET_CART_PRICE:"set-pay-now-cart-price",PAY_NOW_GET_CONFIG:"pay-now-get-config",CHECK_PAY_NOW_FEATURE_FLAG:"check-pay-now-feature-flag",GET_REMINDER:"get-reminder",SET_REMINDER:"set-reminder",OPEN_PAY_NOW_AUTOPOP:"open-honey-pay-now-autopop"},t.IMAGE_SRCS={GIFTCARDS_HOW_IT_WORKS_01:"https://cdn.honey.io/images/finance/giftcards-how-it-works_01.gif",GIFTCARDS_HOW_IT_WORKS_02:"https://cdn.honey.io/images/finance/giftcards-how-it-works_02.gif",GIFTCARDS_HOW_IT_WORKS_03:"https://cdn.honey.io/images/finance/giftcards-how-it-works_03.gif",HONEY_LOGO_BLACK:"https://cdn.honey.io/images/finance/logo-black.svg",HONEY_ICON_BLACK:"https://cdn.honey.io/images/finance/logo-icon-black.svg",HONEY_LOGO_GRAY:"https://cdn.honey.io/images/finance/logo-gray.svg",HONEY_PAY_LOGO:"https://cdn.honey.io/images/finance/honey-pay-logo-orange.svg",HONEY_PAY_LOGO_PAY:"https://cdn.honey.io/images/finance/honey-pay-logo-pay.svg",HONEY_SQUARE_LOGO:"https://cdn.honey.io/images/honey-logo-square.svg",HONEY_WALLET_LOGO:"https://cdn.honey.io/images/finance/wallet-logo.svg",HONEY_WALLET_LOGO_WHITE:"https://cdn.honey.io/images/finance/wallet-logo-white.svg",HONEY_WALLET_LOGO_WHITE_GRAY:"https://cdn.honey.io/images/finance/wallet-logo-white-gray.svg",HONEY_WALLET_LOGO_GRAY_WHITE_BG:"https://cdn.honey.io/images/finance/wallet-logo-gray-white-bg.svg",STEP_GRAPHIC:"https://cdn.honey.io/images/finance/step_graphic.png",EXTENSION_IMAGE:"https://cdn.honey.io/images/finance/extension.svg",COINY_SPLIT_CONFETTI:"https://cdn.honey.io/images/finance/coiny-split-confetti.gif",MASTERCARD:"https://cdn.honey.io/images/finance/mastercard.svg",VISA:"https://cdn.honey.io/images/finance/visa-card.svg",MAP:"https://cdn.honey.io/images/finance/128-map.svg",SHOPPING_CART:"https://cdn.honey.io/images/finance/wallet-cart.svg",PAY_PAL_LOGO:"https://cdn.honey.io/images/finance/paypal-logo.svg",PAY_PAL_LOGO_HORIZONTAL:"https://cdn.honey.io/images/finance/paypal-logo-horizontal.svg",CREDIT_CARD_ICON:"https://cdn.honey.io/images/finance/payment-method-credit-card-icon.svg",PAYMENT_OPTION_ARROW:"https://cdn.honey.io/images/finance/payment-option-right-arrow-icon.svg",NEXT_ARROW:"https://cdn.honey.io/images/finance/next-narrow.svg",STEP_GRAPHIC_FS:"https://cdn.honey.io/images/finance/chart.png",ORANGE_WALLET:"https://cdn.honey.io/images/finance/orange-wallet.svg",HAND_MONEY:"https://cdn.honey.io/images/finance/hand-money.svg",CREDIT_CARD_LOCK:"https://cdn.honey.io/images/finance/credit-card-lock.svg",ADD_PAYMENT_METHOD_ICON:"https://cdn.honey.io/images/finance/add-payment-method-icon.svg",ADD_DEBIT_CARD_ICON:"https://cdn.honey.io/images/finance/add-debit-card.svg",EDIT_DEBIT_CARD_ICON:"https://cdn.honey.io/images/finance/edit-debit-card.svg",SUCCESS_CHECK_GREEN:"https://cdn.honey.io/images/finance/success-check-green.svg",UNLINK_PAYMENT_METHOD:"https://cdn.honey.io/images/finance/unlink-payment-method.svg"}},1584:function(e,t,r){"use strict";var n=s(r(5)),a=s(r(15)),o=s(r(4)),u=s(r(3)),i=s(r(20));function s(e){return e&&e.__esModule?e:{default:e}}var c=void 0,d={};function l(e,t){var r=void 0;d[t]&&(r=d[t].timeFocused,delete d[t]),void 0!==r&&0===r||i.default.sendFullProduct(Object.assign({focus_time:r},e))}var f={};o.default.addListener("product_fetcher:action",(function(e,t,r){switch(t&&t.data&&t.action){case"getDesiredProducts":var o=t.data;return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],i=arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"";return e&&Array.isArray(o)?a.default.post("https://s.joinhoney.com/pe").send({brand:c,canonicalUrl:s,storeId:e,parentId:t,variantId:r,limit:2,categories:u,productId:i,relatedUrls:o}).then((function(e){return e.body&&Array.isArray(e.body.desiredProducts)?e.body.desiredProducts:[]})).catch((function(){return[]})):n.default.resolve([])}(o.storeId,o.parentId,o.variantId,o.urls,o.categories,o.productId,o.canonicalUrl,o.brand);case"monitorProduct":return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];c||(c=t),i.default.sendFullProduct(e);var r=d[t]||{};Object.keys(r).length>0&&l(r.data,t),d[t]={data:Object.assign({},e),start:c===t?Date.now():null,expires:Date.now()+6e4,timeFocused:0}}(t.data,r.tabId);case"makeRequest":return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch(e.type){case"POST":return a.default.post(e.url).send(e.data||{}).set(e.headers||{});default:return a.default.get(e.url)}}(t.data);case"sendFullProduct":return i.default.sendFullProduct(t.data);case"sendPriceUpdate":return s=t.data,void u.default.debug("Product update event bypassed (production)",s);case"sendProductViewSdata":return function(e){var t=null,r="",n=e.store.metadata.search_regex;if(n){var a=n.split("field-")[1];if(a){var o=e.url.match(a);o&&(t=o[1].replace(/\+/g," "))}}e.merchId instanceof String&&(r=e.merchId),i.default.sendEvent("ext009005",{productId:r,previousProduct:f,previousPageUrl:f.url,terms:t,referrerUrl:e.url,store:e.store}),f={productId:r,storeId:e.store.id,storeName:e.store.name,url:e.url}}(t.data);default:throw new InvalidParametersError("action")}var s})),o.default.addListener("tabs:activated",(function(e,t){var r=d[c];r&&(r.timeFocused+=Date.now()-r.start),c=t.tabId;var n=d[t.tabId];n&&(n.start=Date.now())})),o.default.addListener("tabs:updated",(function(e,t){if("loading"===t.status){var r=d[t.tabId];r&&(c===t.tabId&&(r.timeFocused+=Date.now()-r.start),l(r.data,t.tabId))}})),setInterval((function(){Object.keys(d).forEach((function(e){var t=d[e];parseInt(e,10)===c&&(t.timeFocused+=Date.now()-t.start),t.expires<Date.now()&&l(t.data,e)}))}),3e4)},1585:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=d(r(5)),u=d(r(4)),i=d(r(20)),s=d(r(83)),c=d(r(3));function d(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._watchUGCRequest=this._watchUGCRequest.bind(this),this._compareUgcAndFindSavingsRequests=this._compareUgcAndFindSavingsRequests.bind(this),this._checkRequestForCoupon=this._checkRequestForCoupon.bind(this),this._checkUgcCoupon=this._checkUgcCoupon.bind(this),this._sawPossibleUgcRequest=this._sawPossibleUgcRequest.bind(this),this._startWatchingListener=this._startWatchingListener.bind(this),this._stopWatchingListener=this._stopWatchingListener.bind(this),this._finish=this._finish.bind(this),this._onBeforeRequest=this._onBeforeRequest.bind(this),this._sawStoreRequestStarted=this._sawStoreRequestStarted.bind(this),this._onRequestFinished=this._onRequestFinished.bind(this),this._sawStoreRequest=this._sawStoreRequest.bind(this),this._removeListener=this._removeListener.bind(this),this._createListener=this._createListener.bind(this),this._resetFilters=this._resetFilters.bind(this),["sf","ed"].includes("ff")||(this._coupons=[],this._currentTabId=null,this._currentlyRunningTabs={},this._setupDAC=!0,this._currentUgcTab={},this._seenUgcRequests={},this._seenFsRequests={},u.default.addListener("site_support:startWatching",this._startWatchingListener),u.default.addListener("site_support:stopWatching",this._stopWatchingListener),u.default.addListener("site_support:watchUGCRequest",this._watchUGCRequest),u.default.addListener("site_support:checkUGCCoupon",this._checkUgcCoupon))}return a(e,[{key:"_watchUGCRequest",value:function(e,t,r){var a=this,o=void 0;this._currentUgcTab={tabId:r.tabId,storeId:t.store.id,hasDac:t.hasDac,requests:[],timeStarted:Date.now()},Array.isArray(t.store.partialUrls)&&(o=t.store.partialUrls.map((function(e){return"*://*."+e+"/*"})));var u={urls:o,types:["main_frame","sub_frame","xmlhttprequest","other"]};try{s.default.removeBeforeRequestListener(this._sawPossibleUgcRequest)}catch(e){}s.default.addBeforeRequestListener(this._sawPossibleUgcRequest,u),setTimeout((function(){(!a._currentUgcTab.timeStarted||a._currentUgcTab.timeStarted<Date.now()-3e4)&&s.default.removeBeforeRequestListener(a._sawPossibleUgcRequest)}),31e3);var i=function(e){Object.entries(e).forEach((function(t){var r=n(t,2),a=r[0];r[1].timeSeen+18e4<Date.now()&&delete e[a]}))};setInterval((function(){i(a._seenFsRequests),i(a._seenUgcRequests)}),18e4)}},{key:"_compareUgcAndFindSavingsRequests",value:function(e){var t=this._seenUgcRequests[e],r=this._seenFsRequests[e];if(t&&r&&t.method===r.method){var n=function(e){return e.substring(0,e.indexOf("?")>=0?e.indexOf("?"):e.length)};n(t.url)!==n(r.url)&&i.default.sendEvent("ext003020",{ugcUrl:n(t.url),fsUrl:n(r.url),store:{id:e}})}}},{key:"_checkRequestForCoupon",value:function(e,t,r){var n=t.toLowerCase(),a=!0,o=!1,u=void 0;try{for(var i,d=Array.from(e)[Symbol.iterator]();!(a=(i=d.next()).done);a=!0){var l=i.value,f=void 0;(l.url.toLowerCase().includes(n)||l.body&&l.body.toLowerCase().includes(n))&&(f=!0),f&&Date.now()-l.timeSeen<2e3&&(this._seenUgcRequests[r]={url:l.url,method:l.method,body:l.body,timeSeen:Date.now()},c.default.debug("Found probable manual coupon application route"),s.default.removeBeforeRequestListener(this._sawPossibleUgcRequest),this._compareUgcAndFindSavingsRequests(r),this._currentUgcTab={})}}catch(e){o=!0,u=e}finally{try{!a&&d.return&&d.return()}finally{if(o)throw u}}}},{key:"_checkUgcCoupon",value:function(e,t){var r=this._currentUgcTab;r&&r.storeId===t.store.id&&(this._currentUgcTab.code=t.code,this._currentUgcTab.codeSeenTs=Date.now(),this._checkRequestForCoupon(r.requests,t.code,r.storeId))}},{key:"_sawPossibleUgcRequest",value:function(e){if(this._currentUgcTab.tabId===e.tabId){var t=void 0;e.requestBody&&e.requestBody.raw&&e.requestBody.raw[0]&&e.requestBody.raw[0].bytes?(t="",e.requestBody.raw.forEach((function(e){t+=String.fromCharCode.apply(null,new Uint8Array(e.bytes))}))):t=JSON.stringify(e.requestBody);var r={body:t,url:e.url,method:e.method,timeSeen:Date.now()};this._currentUgcTab.code&&this._checkRequestForCoupon([r],this._currentUgcTab.code,this._currentUgcTab.storeId),this._currentUgcTab.storeId&&this._currentUgcTab.requests.push(r)}}},{key:"_startWatchingListener",value:function(e,t,r){var n=this;if(this._currentlyRunningTabs[r.tabId]=!0,this._startTime=Date.now(),this._currentTabId=r.tabId,this._store=t&&t.store,this._hasDac=t&&t.hasDac,this._coupons=t&&t.coupons&&t.coupons.map((function(e){return{code:e.code,tested:!1}})),this._requestIdsByCoupon={},this._listenersActive=!1,Array.isArray(t&&t.store&&t.store.partialUrls)&&this._coupons&&this._coupons.length){var a=t.store.partialUrls.map((function(e){return"*://*."+e+"/*"}));this._resetFilters(a),this._timeOut=o.default.delay(3e5).then((function(){n._finish("timed_out")})).catch((function(){}))}}},{key:"_stopWatchingListener",value:function(e,t,r){this._currentlyRunningTabs[r.tabId]&&(t.cancelled?this._finish("cancelled"):(this._timeOut&&this._timeOut.cancel(),this._finish("complete")))}},{key:"_finish",value:function(e){null==e&&(e="complete"),this._removeListener(),this._currentTabId=null,this._requestIdsByCoupon={};var t=0;this._coupons.forEach((function(e){e.tested&&(t+=1)})),i.default.sendEvent("ext003012",{total_codes:this._coupons.length,codes_seen:t,status:e,duration_sec:(Date.now()-this._startTime)/1e3,coupons:this._coupons,store:{id:this._store.id},dac:this._hasDac,incompatible_store:this._store.metadata.apply_codes_complete_test_incompatible}),this._compareUgcAndFindSavingsRequests(this._store.id)}},{key:"_onBeforeRequest",value:function(e){if(this._currentlyRunningTabs[e.tabId]||e.tabId<0){var t=void 0;e.requestBody&&e.requestBody.raw&&e.requestBody.raw[0]&&e.requestBody.raw[0].bytes?(t="",e.requestBody.raw.forEach((function(e){t+=String.fromCharCode.apply(null,new Uint8Array(e.bytes))}))):t=JSON.stringify(e.requestBody),this._sawStoreRequestStarted(e);var r=!0,n=!1,a=void 0;try{for(var o,u=Array.from(this._coupons)[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var i=o.value,s=(i.code||"").toLowerCase();if(e.url.toLowerCase().includes(s)||t&&t.toLowerCase().includes(s))i.tested=!0,null==i.method&&(i.method=e.method),this._seenFsRequests[this._store.id]||(this._seenFsRequests[this._store.id]={body:t,url:e.url,method:e.method,timeSeen:Date.now()}),this._requestIdsByCoupon[e.requestId]?this._requestIdsByCoupon[e.requestId].push(i):this._requestIdsByCoupon[e.requestId]=[i];else if(!i.tested&&"PATCH"===e.method){i.tested=!0,null==i.method&&(i.method=e.method),this._requestIdsByCoupon[e.requestId]=[i];break}}}catch(e){n=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(n)throw a}}}}},{key:"_sawStoreRequestStarted",value:function(e){this._currentlyRunningTabs[e.tabId]&&u.default.send("site_support:sawStoreRequestStarted",{requestId:e.requestId},{tab:e.tabId,ignoreResponse:!0})}},{key:"_onRequestFinished",value:function(e){u.default.send("site_support:sawStoreRequestFinished",{requestId:e.requestId,statusCode:e.statusCode},{tab:e.tabId,ignoreResponse:!0}),this._requestIdsByCoupon[e.requestId]&&this._requestIdsByCoupon[e.requestId].forEach((function(t){t.statusCode=e.statusCode}))}},{key:"_sawStoreRequest",value:function(e,t,r){return u.default.send("site_support:sawStoreRequestFinished",{url:e||"",body:t||"",method:r},{tab:this._currentTabId,ignoreResponse:!0})}},{key:"_removeListener",value:function(){try{s.default.removeBeforeRequestListener(this._onBeforeRequest),s.default.removeCompleteListener(this._onRequestFinished),s.default.removeErrorOccurredListener(this._onRequestFinished)}catch(e){}}},{key:"_createListener",value:function(e){this._listenersActive=!0;var t={urls:e,types:["main_frame","sub_frame","xmlhttprequest","other"]};s.default.addBeforeRequestListener(this._onBeforeRequest,t),s.default.addCompleteListener(this._onRequestFinished,t),s.default.addErrorOccurredListener(this._onRequestFinished,t)}},{key:"_resetFilters",value:function(e){return this._removeListener(),this._createListener(e)}}]),e}();t.default=new l},1586:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u=(n=w(regeneratorRuntime.mark((function e(t,r,n){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.default.get(r).catch((function(){return l.default.debug("Getting retail quotes JSON object failed")}));case 2:a=e.sent,o=_(v.default[t].quoteMappings,a),l.default.debug("Retail Quotes: ("+Object.keys(o).length+")",o),y.default.sendCarRentalEvent("extcar100",{page:"vehicles",action:"rates",result:Object.values(o).length},{url:n.tabUrl,tabId:n.tabId}),I.set(n.tabId,{retailQuotes:o});case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)}),i=(a=w(regeneratorRuntime.mark((function e(t,r){var n,a,o,u,i,d,g,h,m,w,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.default.debug("Testing OTA coupons"),n=(new Date).getTime(),a=Object.keys(S).length>0,e.next=5,O();case 5:return o=e.sent,u=o.budgetStackCpn,i=o.avisStackCpn,d=y.default.getKey(S.tabUrl),e.next=11,f.default.get("carrental:"+d+":allStoresCoupons").catch((function(e){return l.default.debug("Error getting allStoresCoupons from LRU cache",e)}));case 11:g=e.sent,h=g.length,a&&y.default.sendCouponTestingProgress(h,0,"",S.tabId),m=[],w=0,c.default.all(g.map((function(e,n){var o=e.vendorCode,c=e.coupon,d=T({coupon:c,budgetStackCpn:u,avisStackCpn:i,vendorCode:o,siteKey:t}),f=d.couponCode,p=d.couponType,g=d.couponCode2,I=d.couponType2,E=void 0;return E=g?r+"&"+v.default[t].params.vendor+"="+o+"&"+v.default[t].params[p]+"="+f+"&"+I+"="+g:r+"&"+v.default[t].params.vendor+"="+o+"&"+v.default[t].params[p]+"="+f,a&&y.default.sendCarRentalEvent("extcar100",{page:"vehicles",action:"applyCpn",result:"start"},{url:S.tabUrl,tabId:S.tabId}),s.default.get(E).then((function(e){var u=(new DOMParser).parseFromString(e,"text/html").querySelector(v.default[t].offersSelector),i="https://"+y.default.getKey(r)+"/"+v.default[t].offersUrlCreator(u);return s.default.get(i).then((function(e){var r=Object.values(_(v.default[t].quoteMappings,e,c));if(m=[].concat(b(m),b(r)),a){if(g){var n=f+" / "+g;y.default.sendCouponTestingProgress(h,w,n,S.tabId)}else y.default.sendCouponTestingProgress(h,w,f,S.tabId);w+=1,y.default.sendCarRentalEvent("extcar100",{page:"vehicles",action:"applyCpn",result:"success"},{url:S.tabUrl,tabId:S.tabId})}})).catch((function(){l.default.debug("\ud83d\udccdDeep-link coupon GET:offersCall request failed: "+n),l.default.debug(JSON.stringify({vendorCode:o,coupon:c})),a&&y.default.sendCarRentalEvent("extcar100",{page:"vehicles",action:"applyCpn",result:"fail"},{url:S.tabUrl,tabId:S.tabId})}))})).catch((function(){l.default.debug("\ud83d\udccdDeep-link coupon GET:deeplinkCall request failed: "+n),l.default.debug(JSON.stringify({vendorCode:o,coupon:c})),a&&y.default.sendCarRentalEvent("extcar100",{page:"vehicles",action:"applyCpn",result:"fail"},{url:S.tabUrl,tabId:S.tabId})}))}))).then((function(){if(l.default.debug("\u2705 Promise.all has completed:"),a){var e=I.get(S.tabId).retailQuotes,t=E(m),r=P(e,t,h);y.default.sendCarRentalEvent("extcar100",{page:"fs",action:"done",result:JSON.stringify({tested:h,total:h,time:(new Date).getTime()-n})},{url:S.tabUrl,tabId:S.tabId}),y.default.sendCarRentalEvent("extcar100",{page:"vehicles",action:"honeyBtnCount",result:r.numVehicles},{url:S.tabUrl,tabId:S.tabId}),p.default.send("car_rental:action",{action:"showHoneyQuotes",honeyQuotesSummary:r,winningQuotes:t,isNewSearch:!0},{tab:S.tabId})}})).catch((function(){return l.default.debug("\ud83d\udeab Promise.all errored")}));case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)}),s=m(r(63)),c=m(r(5)),d=m(r(130)),l=m(r(3)),f=m(r(47)),p=m(r(4)),g=m(r(39)),h=m(r(19)),y=m(r(1587)),v=m(r(1588));function m(e){return e&&e.__esModule?e:{default:e}}function b(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function w(e){return function(){var t=e.apply(this,arguments);return new c.default((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return c.default.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var I=new Map;function S(e,t,r){return e+"-"+t+"-"+r}function _(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={};return t.offers&&(n=t.offers.reduce((function(t,n){var a=h.default.getProperty(n,e.currencySymbol,"").match(/\D*/)[0].trim();a=a.substring(a.length-1);var o=h.default.getProperty(n,e.vehCode,""),u={cd:o,name:h.default.getProperty(n,e.vehName,"")},i={currency:{code:h.default.getProperty(n,e.currencyCode,""),symbol:a},total:h.default.getProperty(n,e.pricingTotal,0)},s=h.default.getProperty(n,e.vendorCode,""),c={code:s,name:h.default.getProperty(n,e.vendorName,"")},d=n,l=h.default.getProperty(n,e.prepaid,!1)?1:0,f=S(s,o,l);return t[f]={coupon:r,id:f,prepaid:l,pricing:i,rawData:d,veh:u,vendor:c},t}),{})),n}function E(e){var t={};return e.forEach((function(e){if(Object.prototype.hasOwnProperty.call(t,e.id)){var r=t[e.id];e.pricing.total<r.pricing.total&&(t[e.id]=e)}else null!=e.pricing.total&&(t[e.id]=e)})),l.default.debug("Winning quotes: ("+Object.keys(t).length+")",t),t}function x(e,t){var r=e.data,n=e.status;l.default.debug("addQuotes(): ("+r.length+")");var a=I.get(t.tabId);null!=a&&(a.quotes=a.quotes.concat(r),"complete"===n&&"pending"===a.status&&(l.default.debug("Got all quotes -> "+a.quotes.length),a.status=n,function(e,t){var r=I.get(e);if(null!=r&&null!=r.quotes){var n=E(r.quotes);p.default.send("car_rental:action",{action:"showHoneyQuotes",rsp:n,isNewSearch:t},{tab:e})}}(t.tabId,!0),p.default.send("car_rental:action",{action:"reset"},{tab:t.tabId})))}function R(e){var t,r=I.get(e);if(null!=r&&r.quotes.length>0&&(t=r.time,l.default.debug((new Date).getTime()-t+" < 300000"),(new Date).getTime()-t<3e5)){var n=E(r.quotes);p.default.send("car_rental:action",{action:"checkCache",rsp:n},{tab:e})}else I.set(e,{status:"new",quotes:[]}),p.default.send("car_rental:action",{action:"checkCache"},{tab:e})}function P(e,t,r){return Object.values(e).reduce((function(e,r){var n=t[r.id];if(n&&Math.round(n.pricing.total)<Math.round(r.pricing.total)){e.numVehicles+=1,n.pricing.total<e.cheapestTotal&&(e.cheapestTotal=n.pricing.total,e.currency=n.pricing.currency.symbol||"$");var a=Math.round(r.pricing.total)-n.pricing.total;a>e.maxSavings&&(e.maxSavings=a),a<e.lowSavings&&(e.lowSavings=a)}return e}),{numCoupons:r,numVehicles:0,totalVehicles:Object.keys(e).length,lowSavings:Number.MAX_VALUE,maxSavings:0,cheapestTotal:Number.MAX_VALUE,currency:"$"})}function O(){var e,t=this;return new c.default((e=w(regeneratorRuntime.mark((function e(r,n){var a,o,u,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.default.getStoreByUrl("https://www.budget.com").catch((function(e){return n(e)}));case 2:return a=e.sent,e.next=5,g.default.getStoreByUrl("https://www.avis.com").catch((function(e){return n(e)}));case 5:o=e.sent,u=a.metadata.stackCpn||"",i=o.metadata.stackCpn||"",r({budgetStackCpn:u,avisStackCpn:i});case 9:case"end":return e.stop()}}),e,t)}))),function(t,r){return e.apply(this,arguments)}))}function T(e){var t=e.coupon,r=e.budgetStackCpn,n=e.avisStackCpn,a=e.vendorCode,u=e.siteKey,i=void 0,s=void 0;Object.entries(t).forEach((function(e){var t=o(e,2),r=t[0],n=t[1];""!==n&&(i=n,s=r)}));var c="",d="";return a===v.default[u].params["avis-rent-a-car"]&&"pc"===s&&(c=n,d=v.default[u].params.ac),a===v.default[u].params["budget-rent-a-car"]&&"pc"===s&&(c=r,d=v.default[u].params.ac),{couponCode:i,couponType:s,couponCode2:c,couponType2:d}}p.default.addListener("car_rental:action",(function(e,t,r){switch(t.action){case"extractRetailQuotes":u(t.siteKey,t.quotesCall,r);break;case"checkCache":R(r.tabId);break;case"cleanup":!function(e,t){var r=(new Date).getTime();d.default.getAllForDomain(e.domain).then((function(e){l.default.debug("Cookies cleanup init: number of cookies["+e.length+"]"),e.forEach((function(e){d.default.remove({url:"https://"+e.domain+e.path,name:e.name})}))})),localStorage.clear(),sessionStorage.clear();var n=setInterval((function(){d.default.getAllForDomain(e.domain).then((function(a){var o=(new Date).getTime()-r;(0===a.length||o>1e3)&&(l.default.debug("Cookies cleanup complete: total time["+o+"]"),p.default.send("car_rental:action",{action:"cleanup",data:e.data},{tab:t}),clearInterval(n))}))}),200)}(t,r.tabId);break;case"quotes":x(t,r);break;case"setCache":!function(e,t){if(l.default.debug("Cache status: "+t),"new"===t)I.set(e,{status:"new",quotes:[]}),l.default.debug("\ud83c\udd95 Made new cache entry");else if("pending"===t){var r=I.get(e);null!=r&&(r.status=t,r.time=(new Date).getTime(),l.default.debug("updated status to pending"))}}(r.tabId,t.status);break;case"tag":!function(e,t){var r=e.url,n=e.domain,a=e.name,o=e.forceHidden,u=e.data,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"offer_claim",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];o&&(c=o);var f=(new Date).getTime();n?d.default.remove({url:r,name:a}).done((function(e){l.default.debug("Tag:remove",e),g.default.getStoreByUrl(r).then((function(e){e.gold&&g.default.updateGoldStatus(e),g.default.tag(e.id,i,s,{forceHidden:c,src:"CarRental"},t.tabId);var o=setInterval((function(){d.default.get({url:r,name:a}).done((function(e){var r=(new Date).getTime()-f;l.default.debug("Tag:checkCookie ["+r+"], "+JSON.stringify(e)),null!==e?(l.default.debug("Tag:complete"),p.default.send("car_rental:action",{action:"tag",data:u},{tab:t.tabId}),clearInterval(o),y.default.sendCarRentalEvent("extcar100",{page:"vehicles",action:"tagging",result:JSON.stringify({time:r,status:null!=e?"success":"fail"})},{url:t.tabUrl,tabId:t.tabId})):r>1e4&&d.default.getAllForDomain(n).then((function(e){for(var r=void 0,n=0;n<e.length;n+=1)e[n].name===a&&(r=""+e[n].domain+e[n].path,l.default.debug("Tag:fail, "+JSON.stringify(e[n])));clearInterval(o),y.default.sendCarRentalEvent("extcar100",{page:r,action:"tagging",result:"fail"},{url:t.tabUrl,tabId:t.tabId})}))}))}),200)}))})):g.default.getStoreByUrl(r).then((function(e){e.gold&&g.default.updateGoldStatus(e),g.default.tag(e.id,i,s,{forceHidden:c,src:"CarRental"},t.tabId),y.default.sendCarRentalEvent("extcar100",{page:"vehicles",action:"tagging",result:"success"},{url:t.tabUrl,tabId:t.tabId})}))}(t,r,t.type,t.targetUrl,t.forceHidden);break;case"testOTACoupons":i(t.siteKey,t.searchUrl,r);break;default:l.default.debug("No msg found.")}})),t.default={testOTACoupons:i}},1587:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=s(r(47)),o=s(r(4)),u=s(r(20)),i=s(r(39));function s(e){return e&&e.__esModule?e:{default:e}}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=/[^(https?://)]?([\da-z.-]+)\.([a-z.]{2,6})/,r=void 0;return e&&(r=e.match(t)[0]),r}t.default={getKey:c,sendCarRentalEvent:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=c(r.url);a.default.get("carrental:"+o+":path").then((function(a){i.default.getStoreByUrl(r.url,r.tabId).then((function(o){var i=n({},t,{path:a,store:{id:o.id}});u.default.sendEvent(e,i,r)}))})).catch((function(){return u.default.sendEvent(e,t,r)}))},sendCouponTestingProgress:function(e,t,r,n){var a=(e-(e-t-1))/e*100;o.default.send("car_rental:action",{action:"showCouponTestingProgress",coupon:r,percentTestingDone:a},{tab:n})}}},1588:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={expedia:{offersSelector:'script[src*="/pickup/"]',params:{siteUrl:"https://www.expedia.com",ac:"cdnu",pc:"cpcd",vendor:"vend","alamo-rent-a-car":"AL","avis-rent-a-car":"ZI","budget-rent-a-car":"ZD","dollar-rent-a-car":"ZR","enterprise-rent-a-car":"ET","fox-rent-a-car":"FX",hertz:"ZE","national-car-rental":"ZL","thrifty-rent-a-car":"ZT"},quoteMappings:{vehCode:"vehicle.classification.code",vehName:"vehicle.classification.name",currencyCode:"fare.currencyCode",currencySymbol:"fare.total.formattedValue",pricingTotal:"fare.total.value",vendorCode:"vendor.code",vendorName:"vendor.name",prepaid:"prepaid"},offersUrlCreator:function(e){var t=/(.*?)cars\//.exec(e.src)[1];return e.src.replace(t,"").replace("/script","")}}}},1589:function(e,t,r){"use strict";var n=a(r(15));function a(e){return e&&e.__esModule?e:{default:e}}a(r(4)).default.addListener("yelp:action",(function(e,t){switch(t&&t.action){case"makeGrouponRequest":return n.default.get(t.data.reqUrl).then((function(e){return e.body}));default:throw new InvalidParametersError("action")}}))},1590:function(e,t,r){"use strict";var n,a,o=(n=regeneratorRuntime.mark((function e(t,r,n){var a,o,u,s,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("Missing storeId")));case 2:return e.next=4,c.default.getUserABGroup("activeHoneyTips");case 4:if(e.t1=e.sent,e.t1){e.next=7;break}e.t1={};case 7:if(e.t0=e.t1.tips,e.t0){e.next=10;break}e.t0={};case 10:if(a=e.t0,o=void 0,a.billFixers&&a.billFixers[t]&&"auto_pop"===r&&(o="billfixers"),u="getCreditCardOffersForUser:"+n+"-"+t+"-"+o,!(s=h.get(u)||v.get(u))){e.next=19;break}return i.default.info("[CACHE HIT]: "+u),l.length>0&&0===s.length&&m(t,r,l),e.abrupt("return",s);case 19:return v.set(u,d.default.query(p.GET_CREDIT_CARD_OFFERS_FOR_USER,{storeId:t,filter:o}).then((function(e){if(e.errors&&e.errors.length>0)return i.default.error("Received error response for GraphQL action: getCreditCardOffersForUser"),[];var n=e.data.getCreditCardOffersForUser,a=void 0===n?[]:n;return h.set(u,a,g),l.length>0&&0===a.length&&m(t,r,l),a})).catch((function(e){return i.default.error("Failed to send GraphQL query: "+p.GET_CREDIT_CARD_OFFERS_FOR_USER,e),[]})).finally((function(){v.delete(u)}))),e.abrupt("return",v.get(u));case 21:case"end":return e.stop()}}),e,this)})),a=function(){var e=n.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e,t,r){return a.apply(this,arguments)}),u=f(r(4)),i=f(r(3)),s=f(r(20)),c=f(r(21)),d=f(r(8)),l=f(r(35));function f(e){return e&&e.__esModule?e:{default:e}}var p={GET_CREDIT_CARD_OFFERS_SUMMARY_BY_STORE_ID:"tips_getCreditCardOffersSummaryByStoreId",GET_CREDIT_CARD_OFFERS_FOR_USER:"tips_getCreditCardOffersForUser",SUPPRESS_LOADER_FOR_CREDIT_CARD:"suppressLoaderForCreditCard",IS_LOADER_SUPPRESSED_FOR_CREDIT_CARD:"isLoaderSuppressedForCreditCard"},g=9e5,h=(0,l.default)({max:5,maxAge:g}),y=new Map,v=new Map;function m(e,t,r){s.default.sendEvent("tip003024",{card_offer_ids:r,sub_src:t,store:{id:e}})}u.default.addListener("honey-tip:credit-card-offers",(function(e,t){var r=t.data,n=r.storeId,a=r.subSrc,u=r.creditCardOfferId,s=r.offerIds,c=r.userId;switch(t.action){case p.GET_CREDIT_CARD_OFFERS_SUMMARY_BY_STORE_ID:return function(e){if(!e)return Promise.reject(new Error("Missing storeId"));var t="getCreditCardOffersSummaryByStoreId:"+e,r=h.get(t);return r||(v.has(t)?(i.default.info("[CACHE HIT]: "+t),v.get(t)):(v.set(t,d.default.query(p.GET_CREDIT_CARD_OFFERS_SUMMARY_BY_STORE_ID,{storeId:e}).then((function(e){if(e.errors&&e.errors.length>0)return i.default.error("Received error response for GraphQL action: getCreditCardOffersSummaryByStoreId"),[];var r=e.data.getCreditCardOffersSummaryByStoreId;return h.set(t,r,g),r})).catch((function(e){return i.default.error("Failed to send GraphQL query: "+p.GET_CREDIT_CARD_OFFERS_SUMMARY_BY_STORE_ID,e),[]})).finally((function(){v.delete(t)}))),v.get(t)))}(n);case p.GET_CREDIT_CARD_OFFERS_FOR_USER:return o(n,a,c,s);case p.SUPPRESS_LOADER_FOR_CREDIT_CARD:return function(e){y.set(e,!0)}(u);case p.IS_LOADER_SUPPRESSED_FOR_CREDIT_CARD:return function(e){return y.get(e)}(u);default:return Promise.resolve({})}}))},1591:function(e,t,r){"use strict";var n,a,o=(n=regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.default.getInfo();case 3:if(!e.sent.isLoggedIn){e.next=9;break}return e.next=7,i.default.updateSetting("smartDroplistOptedIn",t);case 7:return r=e.sent,e.abrupt("return",(r.droplistUserPreferences||{}).smartDroplistOptedIn===t);case 9:return e.abrupt("return",!1);case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})),a=function(){var e=n.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return a.apply(this,arguments)}),u=d(r(4)),i=d(r(21)),s=d(r(20)),c=d(r(35));function d(e){return e&&e.__esModule?e:{default:e}}var l=(0,c.default)({max:100,maxAge:6048e5});function f(e){var t=e.productId,r=e.storeId,n=(l.peek(t)||0)+1;return l.set(t,n),function(e,t,r){s.default.sendEvent("droplist703",{store:{id:r},productId:e,count:t,cacheMax:100,cacheMaxAge:6048e5})}(t,n,r),n}setInterval((function(){return l.prune()}),36e5),u.default.addListener("honey-tip:smart-droplist",(function(e,t){switch(t.action){case"updateSmartDroplistPreference":return o(t.value);case"incrementNumTimesSeenForProduct":return f(t.data);case"resetCache":return void l.reset();default:throw new InvalidParametersError("Unsupported action received by honey-tip:smart-droplist")}}))},1592:function(e,t,r){"use strict";var n=o(r(4)),a=o(r(55));function o(e){return e&&e.__esModule?e:{default:e}}var u=(0,o(r(35)).default)({max:100,maxAge:12096e5});function i(e,t){return"teaserSeen_"+e+"_"+t}setInterval((function(){return u.prune()}),36e5),n.default.addListener("honey-tip:badge-experiments",(function(e,t){switch(t.action){case"badgeSeen":return r=t.data,n=r.productId,u.get(n);case"badgeHovered":return function(e){var t=e.productId;return u.set(t,!0)}(t.data);case"getTeaserSeen":return function(e){var t=i(e.storeId,a.default.getSessionId(!1));return u.get(t)}(t.data);case"incrementTeaserSeen":return function(e){var t=i(e.storeId,a.default.getSessionId(!1)),r=(u.get(t)||0)+1;return u.set(t,r)}(t.data);default:throw new InvalidParametersError("Unsupported action received by honey-tip:badge-experiments")}var r,n}))},1593:function(e,t,r){"use strict";var n=u(r(63)),a=u(r(4)),o=u(r(20));function u(e){return e&&e.__esModule?e:{default:e}}var i=!1;a.default.addListener("bg:createImg",(function(e,t){if(t.imgUrl&&!i){i=!0;var r=(0,n.default)('<img style="text-decoration:none;border:0;padding:0;margin:0;"\n    src="'+t.imgUrl+'" />').appendTo("body");setTimeout((function(){r.remove()}),2e4)}}));var s=!1;a.default.addListener("bg:fireExtLoginStateEvent",(function(e,t){s||(s=!0,o.default.sendEvent("ext000006",t))})),setInterval((function(){i=!1,s=!1}),288e5)},19:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=p(r(5)),u=p(r(443)),i=p(r(0)),s=p(r(1042)),c=p(r(63)),d=p(r(571)),l=p(r(73)),f=p(r(1058));function p(e){return e&&e.__esModule?e:{default:e}}var g=Math.floor(256*Math.random()),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",y=/(^-?\.?[\d+]?[,.\s\d+]+)/,v=/([,.\s\d]+)(\.(?:\d{1,2})|,(?:\d{1,2}))\b/,m={},b=!1,w=void 0;function I(e){if(e&&"string"==typeof e){var t=f.default[e.toUpperCase()];if(t)return t.currencyCode}return"USD"}function S(e){if(e&&"string"==typeof e){var t=f.default[e.toUpperCase()];if(t)return t.currencyLanguage}return"en-US"}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return parseInt(e,10)||t}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return parseFloat(e,10)||t}function x(e){var t="number"==typeof e?e:parseInt(e,10);return Number.isNaN(t)?NaN:e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function R(e){return e>=1e4?Math.round(e/1e3)+"k":x(e)}function P(e){return e.toFixed(2)}function O(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=n.format,o=void 0===a||a,u=Math.round(e*t*.9/r);return o?R(u):u}t.default={addCommas:x,buildTargetUrl:function(e,t,r){var n=e;try{(r||[]).forEach((function(t){var r=e.match("[?&;]("+t+"=[^&#]*?(?=([#&;]|$).*?))");r&&r.length>1&&(n=r[0].indexOf("?")>=0?n.replace(r[1],""):n.replace(r[0],""))})),(t||[]).forEach((function(t){if(t.includes("=")){var r=t.split("="),o=a(r,1)[0],u=e.match("[?&;]("+o+"=[^&#]*?(?=([#&;]|$).*?))");u&&u.length?n=n.replace(u[1],t):n.indexOf("?")>0?n+="&"+t:n+="?"+t}}))}catch(e){return n}return n},calculateGold:O,calculateGoldValue:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=n.format,o=void 0===a||a,u=e*t*.9/100,i=1/r,s=Math.ceil(10*i)/10,c=u*i/s;return o?P(c):c},calculateGoldBonusValue:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.format,a=void 0===n||n,o=e/100/t;return a?P(o):o},camelifyObject:function e(t){if(!t||"object"!==(void 0===t?"undefined":n(t)))return t;if(Array.isArray(t))return t.map(e);var r=Object.keys(t);if(0===r.length)return t;var a={};return r.forEach((function(r){a[d.default.camelCase(r)]=e(t[r])})),a},checkGoldStatus:function(e){var t=!1,r=!1,n=!1;return e&&0!==Object.keys(e).length?(e.isFlatFee?e.maxFlatFee>0&&(t=!0,r=!0):e.max>0&&(t=!0,n=!0),{active:t,flatFee:r,percent:n}):{active:t,flatFee:r,percent:n}},cleanPrice:function(e){var t=this.cleanString(e);t.length>=3&&"("===t[0]&&")"===t.substr(-1)&&(t="-"+t.substr(1,t.length-2));var r=t.search(/\d/),n=t.substr(0,r);t=t.substr(r),n.includes("-")&&(t="-"+t),t.split(".").length>1&&t.split(",").length-1==0&&(t.match(v)||(t+=",00"));var a=t.match(y);return a&&(t=a[1].trim()),Number(u.default.unformat(t,this.decimalSeparator(t)))},cleanString:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(""+(e||"")).trim()||t},cleanStringLower:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(""+(e||"")).trim().toLowerCase()||t},cleanStringUpper:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(""+(e||"")).trim().toUpperCase()||t},cleanUp:function(e){try{var t=(0,c.default)("#undefined")[0];t&&document.body.removeChild(t);var r=(0,c.default)("#"+e)[0];r&&document.body.removeChild(r)}catch(e){}},createId:function(){return(new s.default).add(10*(0,i.default)().valueOf()).shiftLeft(11).and(new s.default(4294965248,4294967295)).add(Math.floor(2048*Math.random())).shiftLeft(8).and(new s.default(4294967280,4294967295)).add(g).toString(10)},decimalSeparator:function(e){var t=e.match(v);return t?t[2].substring(0,1)||".":e.split(".").length>1?",":e.split(" ").length>1?",":"."},execTopFrameJS:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,a=this.randomString(32),u=(0,c.default)("<div id='"+a+"' />");(0,c.default)("body").append(u);var i=document.createElement("script");return i.textContent="javascript:(\n    function () {\n      var value = null;\n      try {\n        value = JSON.stringify(function(){"+e+"}());\n      } catch(e) {\n        e.error = true;\n        value = JSON.stringify(e, ['message', 'name', 'error']);\n      }\n      document.getElementById('"+a+"').setAttribute('value', value);\n    }()\n  )",new o.default((function(e,o){var s=void 0,c=new MutationObserver((function(r){var n=void 0,u=r&&r[0]&&r[0].target;if(u&&"function"==typeof u.getAttribute&&(n=u.getAttribute("value")),n=n&&"undefined"!==n?JSON.parse(n):null,c.disconnect(),clearTimeout(s),t.cleanUp(a),n&&n.error){var i=new Error(n.message);n.name&&(i.name=n.name),o(i)}else e(n)}));c.observe(u[0],{attributes:!0}),s=setTimeout((function(){c.disconnect(),t.cleanUp(a),o(new Error("timeout"))}),r);var d=document.head||document.documentElement;"object"===(void 0===d?"undefined":n(d))&&"function"==typeof d.appendChild&&d.appendChild(i),i.remove()}))},formatPrice:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.precision,a=void 0===n?2:n,o={};if(t&&t.country)return o.currency=I(t.country),o.language=S(t.country),new Intl.NumberFormat(o.language,{style:"currency",currency:o.currency}).format(e);var i=void 0;i=t&&t.currency?t.currency:"$";var s=Object.assign({currency:i,thousandsSeparator:",",decimalSeparator:"."},o,t);return u.default.formatMoney(e,s.currency,a,s.thousandsSeparator,s.decimalSeparator)},formatGold:R,formatGoldValue:P,getCountryCurrency:function(e){if(e&&"string"==typeof e){var t=f.default[e.toUpperCase()];if(t)return t.currencySymbol}return"$"},getCountryCurrencyCode:I,getCountryLanguage:S,getCurrentPageHtml:function(){return document.documentElement.innerHTML},getLocalStorageWithExpiry:function(e){var t=window.localStorage.getItem(e);if(!t)return null;var r=JSON.parse(t);return(new Date).getTime()>r.expiry?(window.localStorage.removeItem(e),null):r.value},getGoldRange:function(e){var t=e.gold,r=e.cartPrice,n=e.currencyExchangeRate,a=t.min,o=t.max,u="percent";return t.min&&t.max&&0!==r&&n&&(a=O(t.min,r,n),o=O(t.max,r,n),u="gold"),!0===t.isFlatFee&&(a=t.minFlatFee,o=t.maxFlatFee,u="gold"),{type:u,minValue:a,maxValue:o}},getGoldProgress:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=100,a=10,o=Math.ceil(a/e.currencyExchangeRate)*n,u=Math.ceil(t/o)*o;t+r>=u;)u+=o;var i=u/o*a,s=t/u*100,c=(t+r)/u*100;return{targetValue:i,targetGold:u,progressWithGoldReward:c,progress:s}},getProperty:function(e,t,r){return t.split(".").reduce((function(e,t){return e&&e[t]?e&&e[t]:r}),e)},getTitleCase:function(e){return e.split(" ").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(" ")},injectAbsentHoneyCSS:function(){["https://cdn.honey.io/css/honey-font.min.css?v2"].forEach((function(e){document.querySelector("link[href='"+e+"']")||(0,c.default)("head").append('<link href="'+e+'" rel="stylesheet" type="text/css"/>')}))},isEmptyObject:function(e){return"object"===(void 0===e?"undefined":n(e))&&e.constructor===Object&&0===Object.entries(e).length},keyArrayBy:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r={};return Array.isArray(e)&&e.length>0&&"string"==typeof t&&t.length>0?(e.forEach((function(e){r[e[t]]=e})),r):e},locallyScopeErrors:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.default;Object.keys(e).forEach((function(t){window[t]=e[t]}))},lowerClone:function(e){var t=this,r={};return e&&"object"===(void 0===e?"undefined":n(e))?(Object.keys(e).forEach((function(n){r[n]=t.lowerClone(e[n])})),r):e},parseFloat:E,parseInt:_,parsePositiveFloat:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.max(0,E(e,0))||t},parsePositiveInt:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.max(0,_(e,0))||t},randomString:function(e){return Array(e).fill(0).map((function(){return h.charAt(Math.floor(Math.random()*h.length))})).join("")},replaceAll:function(e,t,r){var n=t instanceof RegExp?t:new RegExp(t.replace(/([.*+?^=!:${}()|[]\/\\])/g,"\\$1"),"g");return e.replace(n,r)},retainFocus:function(e){var t=e||window.event,r=t.path||t.composedPath&&t.composedPath();return r&&r[0]?(r[0].focus(),t.stopPropagation(),t):null},round:function(e,t){var r=Math.pow(10,Math.max(0,t)||0);return Math.round(e*r)/r},setLocalStorageWithExpiry:function(e,t,r){var n={value:t,expiry:(new Date).getTime()+r};window.localStorage.setItem(e,JSON.stringify(n))},sleep:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;return new o.default((function(t){return setTimeout(t,e)}))},snakeifyObject:function e(t){if(!t||"object"!==(void 0===t?"undefined":n(t)))return t;if(Array.isArray(t))return t.map(e);var r=Object.keys(t);if(0===r.length)return t;var a={};return r.forEach((function(r){a[d.default.snakeCase(r)]=e(t[r])})),a},waitForElement:function(e){if(m[e])return m[e].promise;w=200;var t={};if(t.promise=new o.default((function(e){t.resolve=e})),m[e]=t,!b){setTimeout((function e(){var t=!0,r=!1,n=void 0;try{for(var o,u=Object.entries(m)[Symbol.iterator]();!(t=(o=u.next()).done);t=!0){var i=o.value,s=a(i,2),d=s[0],l=s[1],f=(0,c.default)(d);if(f.length>0){var p=l.resolve;p&&p(f),delete m[d]}}}catch(e){r=!0,n=e}finally{try{!t&&u.return&&u.return()}finally{if(r)throw n}}0!==Object.keys(m).length?(w<2500&&(w+=200),setTimeout(e,w)):b=!1}),w),b=!0}return t.promise},waitForEvent:function(e){var t=e.container,r=e.selector,n=e.event;return new o.default((function(e,a){"string"==typeof r&&"string"==typeof n?"string"==typeof t?(0,c.default)(t).on(n,r,(function(t){e(t)})):(0,c.default)(r).on(n,(function(t){e(t)})):a(new Error("Selector and Event are required and should be strings, received selector: "+r+" and event: "+n))}))}}},192:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(5)),a=u(r(19)),o=u(r(574));function u(e){return e&&e.__esModule?e:{default:e}}var i={};function s(e,t,r,o,u,i,s){return new n.default((function(n,c){var d={service:"messages:bg",type:e,allFrames:i,content:JSON.stringify(t),src:r&&"tab"===r.type&&r.tabId===o?null:r};u?(browser.tabs.sendMessage(o,d,{frameId:s}).catch((function(){})),n()):browser.tabs.sendMessage(o,d,{frameId:s},(function(t){if(browser.runtime.lastError){var r=new MessageListenerError("Firefox messaging error in background.dispatchToTab(): "+browser.runtime.lastError.message);r.sentMessage=d,c(r)}else if(!t||t.noListeners){var o=new NoMessageListenersError("No listeners for message of type "+e+" in background.dispatchToTab()");o.sentMessage=d,c(o)}else if(t.success)n(t.data);else{var u=t&&t.error;a.default.locallyScopeErrors();var i=new(window[u&&u.name]||MessageListenerError||Error)(u&&u.message);i.sentMessage=d,u&&(i.data=u.data,i.stack=""+(i.stack||"")+(u.stack||"")),c(i)}}))}))}function c(e,t,r,a,o,u){return!Array.isArray(a)||a.length<1?n.default.resolve(null):n.default.try((function(){var i=a.map((function(n){return s(e,t,r,n,o,u)}));return n.default.any(i)})).catch((function(e){var t=e&&e[0];throw t instanceof Error||(t=new MessageListenerError(t&&(t.message||t.name)||"listener_failure")),t}))}function d(e,t,r,o){return n.default.try((function(){var u=[],d=o||{};if(d.allTabs?u.push(function(e,t,r,a,o){return new n.default((function(n,u){browser.tabs.query({},(function(i){if(browser.runtime.lastError)u(new Error(browser.runtime.lastError.message));else{var s=i.map((function(e){return e.id}));n(c(e,t,r,s,a,o))}}))}))}(e,t,r,!!d.ignoreResponse,!!d.allFrames)):Array.isArray(d.tabs)&&d.tabs.length>0?u.push(c(e,t,r,d.tabs,!!d.ignoreResponse,!!d.allFrames)):d.tab&&u.push(s(e,t,r,d.tab,!!d.ignoreResponse,!!d.allFrames,d.frameId)),d.background||u.length<1){var l=r&&"bg"===r.type?null:r;u.push(function(e,t,r){return n.default.try((function(){a.default.locallyScopeErrors();var o=i[e];if(!Array.isArray(o)||o.length<1)throw new window.NoMessageListenersError("No listeners for message of type "+e+" in background.deliver()");var u=o.slice(0).map((function(n){return n(e,t,r)})).filter((function(e){return void 0!==e}));return u.length?n.default.any(u):void 0})).catch(n.default.AggregateError,(function(e){var t=e&&e[0];throw t instanceof Error||(t=new window.MessageListenerError(t&&(t.message||t.name))),t}))}(e,t,l))}return n.default.any(u)})).catch(n.default.AggregateError,(function(e){var t=e&&e[0];throw t instanceof Error||(t=new MessageListenerError(t&&(t.message||t.name)||"listener failure on dispatch")),t})).catch((function(e){if(!o||!o.ignoreResponse)throw e}))}browser.runtime.onMessage.addListener((function(e,t,r){if(!e||"messages:cs"!==e.service)return!1;var a=t&&t.tab&&t.tab.id;return!!a&&(n.default.try((function(){var r={type:"tab",tabId:a,tabUrl:t.tab.url},n=e.dest||{};return n.background||n.tab||n.tabs&&n.tabs.length||(n.currentTab=!0),n.currentTab&&(n.tabs=n.tabs||[],n.tabs.push(a)),d(e.type,JSON.parse(e.content),r,n)})).then((function(e){try{r({success:!0,data:e})}catch(e){}})).catch(NoMessageListenersError,(function(){try{r({success:!1,noListeners:!0})}catch(e){}})).catch((function(e){try{r({success:!1,error:{name:e&&e.name,message:e&&e.message,stack:e&&e.stack,data:e&&e.data}})}catch(e){}})),!0)})),browser.runtime.onMessage.addListener((function(e,t,r){if(!e||"messages:popover"!==e.service)return!1;var n=JSON.parse(e.content),a=n&&n.data&&n.data.tabId;return!!a&&(o.default.get(a).then((function(t){var r={type:"tab",tabId:t.id,tabUrl:t.url},n=e.dest||{};return n.background||n.tab||n.tabs&&n.tabs.length||(n.currentTab=!0),n.currentTab&&(n.tabs=n.tabs||[],n.tabs.push(t.id)),d(e.type,JSON.parse(e.content),r,n)})).then((function(e){try{r({success:!0,data:e})}catch(e){}})).catch(NoMessageListenersError,(function(){try{r({success:!1,noListeners:!0})}catch(e){}})).catch((function(e){try{r({success:!1,error:{name:e&&e.name,message:e&&e.message,stack:e&&e.stack,data:e&&e.data}})}catch(e){}})),!0)})),t.default={addListener:function(e,t){if("string"!=typeof e||!e.trim())throw new InvalidParametersError("type");if("function"!=typeof t)throw new InvalidParametersError("listener");var r=i[e];return r||(r=[],i[e]=r),!(r.indexOf(t)>=0)&&(r.push(t),!0)},removeListener:function(e,t){var r=i[e];if(!r)return!1;var n=r.indexOf(t);return!(n<0)&&(r.splice(n,1),0===r.length&&delete i[e],!0)},send:function(e,t,r){return n.default.try((function(){return d(e,t,{type:"bg"},r)})).catch((function(e){if(!r||!r.ignoreResponse)throw e}))}}},193:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u=(n=regeneratorRuntime.mark((function e(t){var r,n,a,o,u=t.error,i=t.tabId,s=t.url;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x(u)){e.next=3;break}return e.abrupt("return");case 3:if(r=Date.now()-w>h,n=S(s),a=E(n),o=_(n),a){e.next=9;break}return e.abrupt("return");case 9:v=Date.now(),p.set(i,Date.now()),o&&(b=!0,m=Date.now()),r&&(w=Date.now(),c.default.sendEvent("ext200201",{has:!0,ab:"true",isTaggingBlocked:b}));case 13:case"end":return e.stop()}}),e,this)})),a=function(){var e=n.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return a.apply(this,arguments)}),i=f(r(575)),s=f(r(83)),c=f(r(20)),d=f(r(4)),l=f(r(35));function f(e){return e&&e.__esModule?e:{default:e}}r(1107),r(1109);var p=(0,l.default)({max:10,maxAge:3e5});setInterval((function(){return p.prune()}),3e5);var g=/^X-Honey-AdbBp-([\w-]+)$/i,h=864e5,y=7*h,v=0,m=0,b=null,w=0;function I(){var e=Date.now()-v<y;return{resourceLastBlockedAt:v,mayNeedWhitelist:e&&!(m&&!b)}}function S(e){var t=(0,i.default)(e)||{domain:"",tld:""};return t.domain+"."+t.tld}function _(e){return["linksynergy.com","cj.com","anrdoezrs.net","emjcd.com","joinhoney.com","honey.io","linkconnector.com","dotomi.com","tkqlhce.com","dpbolvw.net","kqzyfj.com","qksrv.net","jdoqocy.com"].includes(e)}function E(e){return _(e)||["doubleclick.net"].includes(e)}function x(e){return["net::ERR_BLOCKED_BY_CLIENT","NS_ERROR_ABORT"].includes(e)}s.default.addBeforeSendHeadersListener((function(e){var t=e.requestHeaders,r={},n=t.filter((function(e){var t=e.name,n=e.value,a=t.match(g);return!a||(r[a[1]]=n,!1)}));return Object.keys(r).length>0?{requestHeaders:n=n.filter((function(e){var t=e.name;return!r[t]})).concat(Object.entries(r).map((function(e){var t=o(e,2);return{name:t[0],value:t[1]}})))}:null}),{types:["xmlhttprequest"],blocking:!0}),d.default.addListener("adbBp:action",(function(e,t){switch(t.action){case"whitelistDetected":return b=!1,m=Date.now(),null;case"getState":return I();default:throw InvalidParametersError("action")}})),s.default.addErrorOccurredListener(u,{urls:["<all_urls>"],blocking:!1}),t.default={getState:I,getAdbTab:function(e){return p.get(e)}}},195:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=r(0),o=(n=a)&&n.__esModule?n:{default:n};var u={};t.default={cacheHasItem:function(e){return void 0!==u[e]},getCacheItem:function(e){var t=u[e];if(void 0!==t){if(!(t.expires>0&&t.expires<(0,o.default)().unix()))return t.value;delete u[e]}},setCacheItem:function(e,t,r){if(void 0===t)delete u[e];else{var n=r&&r.ttl>0?(0,o.default)().unix()+r.ttl:null;u[e]={value:t,expires:n}}},removeCacheItem:function(e){delete u[e]},clearCache:function(){u={}}}},20:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=(n=regeneratorRuntime.mark((function e(t,r,n){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.default.getSetting("dataShare");case 2:if("off"!==e.sent){e.next=6;break}return f.default.debug("User has disabled data sharing"),e.abrupt("return",s.default.reject());case 6:if(t){e.next=10;break}return e.abrupt("return",s.default.reject(new InvalidParametersError("code")));case 10:if("ext000010"!==t){e.next=12;break}return e.abrupt("return",O(r));case 12:return a=!["ext000001","ext000005"].includes(t),e.abrupt("return",s.default.try((function(){return s.default.props({store:T(r),sessionId:l.default.getSessionId(a),screenviewId:l.default.getScreenViewId(r&&r.tabId),user:y.default.getInfo()})})).then((function(e){var a=e.store,o=e.sessionId,i=e.screenviewId,s=e.user,c=(h.default.SDATA_REASONS[t]?h.default.SDATA_REASONS[t]:"")+" For more information, please visit www.joinhoney.com/data-and-privacy.",f=v.default.snakeifyObject(Object.assign({},r,{clientTs:Date.now(),code:t,extension:{screenviewId:i},isLoggedIn:s&&s.isLoggedIn,reason:c,sessionId:o,store:a}));if(f.referrer_url){var g=f.referrer_url.match(/.*:\/\/?([^/]+)/);g&&S.domains.forEach((function(e){if(g[1].match(e))throw new OperationSkippedError}))}var y=u({},f,{time:(new Date).toLocaleTimeString()});return window.sdata.events.push(y),p.default.send("sdata:event",y,{tabs:window.sdata.testSuiteTabs||[],ignoreResponse:!0}),n&&n.immediate?l.default.getExv().then((function(e){return d.default.post("https://s.joinhoney.com/ev/"+f.code).set("X-Referer",f.referrer_url||"").send({src:"extension",exv:e,event:Object.assign({},f,{referrer_url:void 0})}).then((function(){return!0}))})).catch((function(){_.push(f)>b&&_.shift(),R()})):(_.push(f)>b&&_.shift(),R(),null)})).then((function(){return!0})).catch((function(){return!1})));case 14:case"end":return e.stop()}}),e,this)})),a=function(){var e=n.apply(this,arguments);return new s.default((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return s.default.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e,t,r){return a.apply(this,arguments)}),s=m(r(5)),c=m(r(35)),d=m(r(15)),l=m(r(55)),f=m(r(3)),p=m(r(4)),g=m(r(39)),h=m(r(282)),y=m(r(21)),v=m(r(19));function m(e){return e&&e.__esModule?e:{default:e}}var b=20,w=[/^current\sstore\sis\snot\sfound$/i,/^failed\sto\ssend\sto\ssdata/i,/^computer\sis\soffline$/i,/chromemethodbfe/i],I=(0,c.default)({max:50,maxAge:72e5}),S={domains:["tdbank.com","wellsfargo.com","bankofamerica.com","chase.com","citi.com","mail.aol.com","outlook.com","mail.yahoo.com","gmail.com","capitalone.com","facebook.com","twitter.com","reddit.com","instagram.com","tumblr.com","imgur.com","linkedin.com","quora.com","pinterest.com"],urls:[]},_=[],E=Date.now(),x=3;function R(){if(_.length>0&&(E<Date.now()||_.length>=b)){var e=_;return _=[],E=Date.now()+15e3,l.default.getExv().then((function(t){return d.default.post("https://s.joinhoney.com/evs").send({src:"extension",exv:t,events:e}).then((function(){return!0}))})).catch((function(){_=e.concat(_).slice(-b),(x-=1)<=0&&(_=[],E=Date.now(),x=3)}))}return null}var P=Date.now();function O(e){return s.default.try((function(){var t=e&&e.exception;return!(!t||!t.name||w.some((function(e){return e.test(t.message)})))&&(P<Date.now()&&(P=Date.now()+6e4,l.default.getExv().then((function(t){return d.default.post("https://err.joinhoney.com/ev/ext000010").set("X-Referer",e.referrer_url||"").send({src:"extension",exv:t,event:v.default.snakeifyObject(e)}).then((function(){return!0}))}))))})).catch((function(){return!1}))}function T(e){var t=e&&e.store||{};return s.default.try((function(){return t.id&&t.sessionId?t:t.id?{id:t.id,sessionId:(g.default.getStoreSessionId(t.id)||{}).id}:e&&e.referrer_url?g.default.getStoreByUrl(e.referrer_url):null})).catch((function(){return null})).then((function(e){return{id:e&&e.id,sessionId:e&&e.sessionId,subid1:t.subid1,subid2:t.subid2,subid3:t.subid3}}))}function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter((function(e){return null!==e}))}function A(e){var t=e.migrationVariants||[],r=void 0;!t.length&&Array.isArray(e.variants)&&e.variants.length>1&&(t=e.variants.map((function(t){t.imprint&&(r=Object.assign(e.common,t));var n=void 0;try{n=JSON.parse(t.product_details)}catch(e){n={}}return{details:n,image_url:t.image_url_primary||e.common.image_url_primary,merch_id:e.common.parent_id,offer_id:t.original_id&&t.original_id.split("#").slice(-1)[0]||t.variant_id,price:t.price_current||e.common.price_current,description:t.description||e.common.description,title:t.title||e.common.title,brand:t.brand||e.common.brand}}))),e.variants?r||(r=Object.assign(e.common,e.variants[0])):r=e.common;var n={method:"generic_1",store:{id:r.store.id,session_id:r.store.sessionId},product:{availability:r.in_stock,brand:r.brand,categories:C(r.categories),currency:r.currency,description:r.description,image_url:r.image_url_primary,imprint:r.imprint,merch_id:r.parent_id,price:{list:r.price_list||r.price_current,sale:r.price_current},rating:r.rating_value,rating_count:r.rating_count,sub_images:C(r.image_url_secondaries),title:r.title,related:r.related_products&&C(r.related_products.map((function(e){return e.parent_id}))),similar:r.similar_products&&C(r.similar_products.map((function(e){return e.parent_id}))),url:r.canonical_url,vim_version:r.vim_version,seller:{id:r.seller_id,name:r.seller_name}}};t.length>0&&(n.product.offers=t),"1"===e.common.store.id&&(n.method="amazon_1",n.product.amazon_extra={related:n.product.related,similar:n.product.similar,sub_images:n.product.sub_images,parent_asin:r.parent_id,categories:n.product.categories},n.product.merch_id=r.variant_id),i("prd001001",n,{immediate:!0})}var k=0;var L=void 0;function N(e,t){var r,n=e.variantId,a=e.imageUrl,o=e.isPrimaryImg,u=e.storeId,i=e.parentId;return r=t.length,k+=r,d.default.post("http://i.joinhoney.com/im").send({variantId:n,imageUrl:a,isPrimaryImg:o,imageData:t,storeId:u,parentId:i}).then((function(){return!0}))}function D(e){return"string"==typeof e.imageUrl&&function(e){var t=e.storeId+":"+e.variantId;return I.get(t)?s.default.resolve(!1):(I.set(t,!0),l.default.getSessionId().then((function(e){return L?L!==e&&(I.reset(),k=0):L=e,k<1e7})))}(e).then((function(t){var r;t&&(r=e.imageUrl,new s.default((function(e){var t=new Image;t.crossOrigin="Anonymous",t.onload=function(){var r=document.createElement("canvas"),n=t.naturalWidth,a=t.naturalHeight,o=n/a;(n>6e3||a>6e3)&&(n>=a?a=(n=6e3)/o:n=(a=6e3)*o),r.width=n,r.height=a,r.getContext("2d").drawImage(t,0,0,r.width,r.height);var u=r.toDataURL("image/jpeg");if(u.length>1e6){var i=1e6/u.length,s=Math.sqrt(i);r.width*=s,r.height*=s,r.getContext("2d").drawImage(t,0,0,r.width,r.height),u=r.toDataURL("image/jpeg")}e(u),r=null},t.src=r}))).then((function(t){return N(e,t)}))}))}function U(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments[2];return s.default.try((function(){return s.default.props({store:T(t?r:e.common),sessionId:l.default.getSessionId(),exv:l.default.getExv()})})).then((function(r){var n=r.store,a=r.sessionId,o=r.exv,u=Object.assign({},e),i=n.id,s=n.sessionId;u.common=Object.assign(u.common||{},{session_id:a,store:{id:i,session_id:s},exv:o}),u.src="extension",u=v.default.snakeifyObject(u);var c="https://s.joinhoney.com/"+(t?"ext_obs":"pr");return d.default.post(c).set("X-Referer",u.referrer_url||"").send(u).then((function(e){if(Array.isArray(e.body)){var t=0;e.body.forEach((function(e){setTimeout((function(){D(e)}),5e3*(t+=1))}))}})),A(u),u=null,!0})).then((function(){return!0})).catch((function(){return!1}))}var j={};function M(){Object.entries(j).forEach((function(e){var t=o(e,2),r=t[0],n=t[1];Object.keys(n).forEach((function(e){U(function(e){if(!e.length)return{common:{},variants:[]};var t=Object.assign({},e[0]);e.forEach((function(e){Object.keys(t).forEach((function(r){JSON.stringify(t[r])!==JSON.stringify(e[r])&&delete t[r]}))}));var r=e.map((function(e){return Object.keys(t).forEach((function(t){delete e[t]})),e}));return 0===(r=r.filter((function(e){return Object.keys(e).length&&!(1===Object.keys(e).length&&e.client_ts)}))).length&&r.push({}),{common:t,variants:r}}(j[r][e]))})),delete j[r]})),j={}}var B=void 0;p.default.addListener("stats:action",(function(e,t){var r=t&&t.data||{};switch(t&&t.action){case"sendException":return O(r.data);case"sendEvent":return i(r.code,r.data,r.options);default:throw new InvalidParametersError("action")}})),p.default.addListener("sdata:testSuiteInit",(function(e,t){return window.sdata.testSuiteTabs=window.sdata.testSuiteTabs||[],window.sdata.testSuiteTabs.push(t),window.sdata.events})),setInterval(R,15e3),t.default={sendException:O,sendFullProduct:function(e){f.default.debug("Product observed:",e);var t=e.parent_id,r=e.store.id;t?(j[r]||(j[r]={}),j[r][t]||(j[r][t]=[]),j[r][t].push(e),clearTimeout(B),B=setTimeout((function(){M(),B=null}),3e3)):U({variants:[e]})},sendProdObservation:U,sendEvent:i}},21:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(8)),a=d(r(4)),o=d(r(1091)),u=d(r(581)),i=d(r(195)),s=d(r(283)),c=d(r(588));function d(e){return e&&e.__esModule?e:{default:e}}a.default.addListener("user:action",(function(e,t){var r,a=t&&t.data||{};switch(t&&t.action){case"openEmailAuth":return u.default.openEmailAuth(a.mode,a.src,a.showSocialBtns,a.isOptOut);case"registerPassword":return u.default.registerPassword(a.email,a.password);case"registerApple":return u.default.registerApple(a.isOptOut);case"registerFacebook":return u.default.registerFacebook(a.isOptOut);case"registerGoogle":return u.default.registerGoogle(a.isOptOut);case"registerPaypal":return u.default.registerPaypal(a.isOptOut);case"loadAuthTokens":return u.default.loadAuthTokens();case"loginPassword":return u.default.loginPassword(a.email,a.password);case"loginApple":return u.default.loginApple();case"loginFacebook":return u.default.loginFacebook(a.isOptOut);case"loginGoogle":return u.default.loginGoogle();case"loginPaypal":return u.default.loginPaypal();case"logout":return u.default.logout();case"requestPasswordResetEmail":return u.default.requestPasswordResetEmail(a.email);case"getInfo":return s.default.getInfo(a.options);case"getUserId":return s.default.getUserId(a.options);case"getUserABGroup":return s.default.getUserABGroup(a.experiment);case"updateProfileImage":return s.default.updateProfileImage(a.image);case"deleteUser":return s.default.deleteUser();case"getSetting":return c.default.getSetting(a.key,a.options);case"getSettings":return c.default.getSettings(a.options);case"updateSetting":return c.default.updateSetting(a.key,a.value,a.options);case"setCacheItem":return i.default.setCacheItem(a.key,a.value,a.options);case"getUserFollow":return r=a.userId,n.default.query("ext_getUserFollow",{userId:r,type:"STORE"}).then((function(e){return e.data.getUserFollow.values})).catch((function(){return[]}));case"updateUserFollow":return function(e,t,r){return n.default.query("ext_updateUserFollow",{userId:t,info:{action:r,type:"STORE",values:[e]}}).then((function(e){return e.data.updateUserFollow.values})).catch((function(){return[]}))}(a.storeId,a.userId,a.action);case"getFollowedStats":return o.default.fetchFollowedStats(a.userId);case"getStoreSessionCount":return s.default.getStoreSessionCount(a.storeId);default:throw new InvalidParametersError("action")}})),t.default={cacheHasItem:i.default.cacheHasItem,getCacheItem:i.default.getCacheItem,getFullOffers:function(e){return n.default.query("ext_getFullOffersByUserId",{userId:e}).then((function(e){return e.data.getFullOffersByUserId})).catch((function(){return[]}))},setCacheItem:i.default.setCacheItem,removeCacheItem:i.default.removeCacheItem,registerPassword:u.default.registerPassword,registerApple:u.default.registerApple,registerGoogle:u.default.registerGoogle,registerPaypal:u.default.registerPaypal,loginPassword:u.default.loginPassword,loginApple:u.default.loginApple,loginGoogle:u.default.loginGoogle,loginFacebook:u.default.loginFacebook,loginPaypal:u.default.loginPaypal,logout:u.default.logout,requestPasswordResetEmail:u.default.requestPasswordResetEmail,getInfo:s.default.getInfo,isExistingUser:s.default.isExistingUser,getUserId:s.default.getUserId,hasAccount:s.default.hasAccount,updateProfileImage:s.default.updateProfileImage,getSettings:c.default.getSettings,getSetting:c.default.getSetting,getUserABGroup:s.default.getUserABGroup,setAbGroupOverride:s.default.setAbGroupOverride,deleteUser:s.default.deleteUser,updateSetting:c.default.updateSetting}},276:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=r(191),o=(n=a)&&n.__esModule?n:{default:n};t.default=o.default},278:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.default={addOnInstallListener:function(e){browser.runtime.onInstalled.addListener((function(t){var r=!1,a=!1;("install"===t.reason&&(r=!0),"update"===t.reason)&&(null===window.localStorage.getItem("device:firstUpdate")&&(a=!0,window.localStorage.setItem("device:firstUpdate","true")));e(n({},t,{firefoxInstall:r,firefoxFirstUpdate:a}))}))},setUninstallURL:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;browser.runtime.setUninstallURL(t,(function(){browser.runtime.lastError&&r>0&&e(t,r-1)}))}}},279:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=r(1077),o=(n=a)&&n.__esModule?n:{default:n};var u=[];t.default={addOnConnectListener:function(e){if("function"!=typeof e)throw new InvalidParametersError("listener");return-1===u.indexOf(e)&&(u.push(e),o.default.addOnConnectListener(e))},getManifest:function(){try{return o.default.getManifest()}catch(e){throw new OperationSkippedError("Function not supported for this browser. Error: "+e.message)}},removeOnConnnectListener:function(e){if("function"!=typeof e)throw new InvalidParametersError("listener");return u=u.filter((function(t){return t!==e})),o.default.removeOnConnnectListener(e)}}},281:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(5)),a=d(r(1094)),o=d(r(129)),u=d(r(4)),i=d(r(39)),s=d(r(21)),c=d(r(582));function d(e){return e&&e.__esModule?e:{default:e}}var l={icon:"default",badgeText:""},f={icon:"active",badgeText:""};function p(e,t){return a.default.setButtonInfo(e,t)}u.default.addListener("page:load",(function(e,t,r){r&&r.tabId>=0&&n.default.try((function(){return i.default.getStoreByUrl(t&&t.url,r.tabId)})).then((function(e){if(!e||!e.supported||"nopopup"===e.standDown)return p(l,r.tabId);if("suspend"===e.standDown)return p(f,r.tabId);var t=e.hadGold||e.gold,a="";e.numCoupons>0?a=e.numCoupons:t&&(a=1);var u,i,d={icon:"active",badgeColor:"#88c987",badgeText:a},g=o.default.getFeatureFlag("gold_activated_badge_animation",{ttl:288e5});return s.default.getUserId().then((function(t){return c.default.getStoreGoldActivated(e.id,t)})).then((u=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g;case 2:e.sent&&t&&(d.icon="gold-active");case 4:case"end":return e.stop()}}),e,void 0)})),i=function(){var e=u.apply(this,arguments);return new n.default((function(t,r){return function a(o,u){try{var i=e[o](u),s=i.value}catch(e){return void r(e)}if(!i.done)return n.default.resolve(s).then((function(e){a("next",e)}),(function(e){a("throw",e)}));t(s)}("next")}))},function(e){return i.apply(this,arguments)})).catch((function(){})).then((function(){return p(d,r.tabId)}))})).catch((function(){return p(l,r.tabId)}))})),t.default={animateGoldActivatedBadge:function(e){if(!e)return n.default.resolve();for(var t=[],r=0;r<=133;r+=1)t.push("icons/gold-activated-frames/32/"+r+".png");return a.default.animateIcon({frames:t,framerate:30},e)},getLastSetIcon:function(e){return a.default.getLastSetIcon(e)},setButtonInfo:p,setButtonInactive:function(e){return p(l,e)},setButtonStoodUp:function(e,t){var r=e.hadGold||e.gold,n="";return e.numCoupons>0?n=e.numCoupons:r&&(n=1),p({icon:"active",badgeColor:"#88c987",badgeText:n},t)}}},282:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={AMAZON_STORES:["1","2","143839615565492452","7360555217192209452","7352899832704027180"],COUPON_TYPES:["c1_g0","c1_g1"],GOLD_TYPES:["c0_g1","c1_g1"],HEADER_NAMES:{HEADER_DEVICE_ID:"device-id",HEADER_SESSION_ID:"session-id"},SDATA_REASONS:{ext000001:"Health check to ensure extension is behaving normally.",ext000005:"General health monitoring to identify performance improvement opportunities.",ext001001:"Look up page context to determine appropriate Honey behavior.",ext001002:"Report store page type to verify Honey is performing as expected.",ext002001:"Report Honey manually opened for product analytics.",ext002002:"Report code manually copied for product analytics.",ext002004:"Report Honey manually closed for product analytics.",ext003001:"Report Honey popped up for product analytics.",ext003002:"Report Honey button click for product analytics.",ext003003:"Report Honey pop up suppressed for product analytics.",ext003010:"Update coupon application stats to improve subsequent attempts.",ext003011:"Report action taken after coupon application for product analytics.",ext003012:"Report coupon test metrics to determine whether coupons were successfully applied.",ext003014:"Report UI shown after coupon application for product analytics.",ext003015:"Report UI find savings notification closed for product analytics.",ext003025:"Report url trace to help debug cart price increase error.",ext004001:"Report session start time on supported store for product analytics.",ext004002:"Report first interaction with Honey for product analytics.",ext004014:"Update mapping between search terms and products on a supported store to power Honey's tagging system.",ext004500:"Note manually entered coupon so it can be applied later if Honey doesn't apply a better coupon.",ext004501:"Identify working coupons that we can ask users to share, helping improve coupon inventory for other users.",ext004502:"Identify when user codeshare prompt appears, and how the user responded.",ext005001:"Report session start time for product analytics.",ext008002:"Report Honey Gold successfully claimed for product analytics.",ext009001:"Log checkout on supported store to ensure accurate payout of Honey Gold.",ext009004:"Log url trace to help debug a checkout event where Honey did not show.",ext009005:"Report search data to provide a better search and discovery experience for users.",ext011002:"Report best price check / price history badge shown for product analytics.",ext011003:"Report best price check / price history badge opened for product analytics.",ext011004:"Report best price check / price history interaction for product analytics.",ext011005:"Report best price check suggestion added to cart for product analytics.",ext012000:"Report comparison results between v4 & v5 VIM implementations for system integrity analytics",ext012001:"Report VIM runtime errors for system integrity analytics",ext012002:"Report VIM run info for integrity analytics",ext050111:"Report product offer debugging info",ext300002:"Report affiliate tagging attempted to measure tagging results.",ext300004:"Report when Honey deactivates because of another publisher's affiliate tag.",ext300005:"Report when user opens Honey in a standing down state.",ext300006:"Report when user re-enables Honey after opening Honey in a standing down state.",ext300010:"Report affiliate tagging completed to measure tagging results.",ext300011:"Report affiliate tagging failed to measure tagging results.",ext300012:"Report affiliate tagging redirected to measure tagging results.",ext300013:"Report affiliate tagging timed out to measure tagging results.",ext300103:"Log affiliate conversion pixel fired to ensure accurate payout of Honey Gold.",ext300501:"Report Honey Pay eligibility check timed out and the timeout length.",extcar100:"Check user journey to identify Honey interaction and attribution.",extcar120:"Log retail rates to compare discounted rates to after applying coupons.",extcar220:"Report car rental discounts and vehicles being reserved for product analytics.",droplist001:"Report Droplist badge shown for product analytics.",droplist002:"Report Droplist product saved for product analytics.",droplist003:"Report Droplist product removed for product analytics.",droplist005:"Report Droplist badge hover for product analytics.",droplist099:"Report Droplist error for product analytics.",droplist300:"Report Droplist sync on for product analytics.",droplist301:"Report Droplist sync off for product analytics.",droplist400:"Report Droplist tooltip shown for product analytics.",droplist500:"Report Droplist price to notify at for product analytics.",droplist600:"Report Droplist tag added for product analytics.",droplist601:"Report Droplist tag removed for product analytics.",ext500000:"Detect other coupon applications to prevent transmitting inaccurate coupon success data."},WHITELIST_REFERRER_URL:"https://www.joinhoney.com/adblock/whitelist",OFFER_COLLECTION_PREFIX:"E9DXCzE8d"}},283:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o,u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=(n=T(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.default.query("ext_getUserInfo",{});case 2:if(t=e.sent,r=t.error,n=t.data.getUserById,!r){e.next=7;break}throw new UnauthorizedError;case 7:return e.abrupt("return",j(n));case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),s=(a=T(regeneratorRuntime.mark((function e(t,r){var n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H();case 2:if(!(n=e.sent)||!n[t]){e.next=16;break}a=0;case 5:if(!(a<n[t].length)){e.next=13;break}if(!(o=n[t][a]).data||o.data.group!==r){e.next=10;break}return W.set(t,o.data),e.abrupt("return");case 10:a+=1,e.next=5;break;case 13:b.default.error("Unable to setABGroupOverride: Invalid experiment group"),e.next=17;break;case 16:b.default.error("Unable to setABGroupOverride: Invalid experiment name");case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)}),c=(o=T(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=0,e.next=3,S.default.get("user:storeSessions:"+t);case 3:return(n=e.sent)&&(r=JSON.parse(n).length),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)}),d=O(r(5)),l=O(r(276)),f=O(r(278)),p=O(r(35)),g=O(r(0)),h=O(r(8)),y=O(r(19)),v=O(r(15)),m=O(r(130)),b=O(r(3)),w=O(r(4)),I=O(r(154)),S=O(r(586)),_=O(r(83)),E=O(r(20)),x=O(r(581)),R=O(r(195)),P=O(r(588));function O(e){return e&&e.__esModule?e:{default:e}}function T(e){return function(){var t=e.apply(this,arguments);return new d.default((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return d.default.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var C=/^[1-9]\d+$/,A={name:"honeyExtUserId",url:"https://extension.joinhoney.com/",domain:"extension.joinhoney.com",expires:2524608e6},k={},L=void 0;function N(e){return e&&"string"==typeof e&&C.test(e)}function D(e){try{I.default.sync.set("user:userId",e).reflect()}catch(e){}try{window.localStorage.setItem("user:userId",e)}catch(e){}try{I.default.local.set("user:userId",e).reflect()}catch(e){}try{m.default.set(Object.assign({},A,{value:e})).reflect()}catch(e){}}var U=new d.default((function(e){f.default.addOnStartedListener?f.default.addOnStartedListener(e):e()}));function j(e){var t=e.fullOffers.filter((function(e){var t=e.used,r=e.created+g.default.duration(24,"hours").asMilliseconds();return!t&&r>Date.now()})).map((function(e){var t=e.storeId,r=e.offerId,n=e.campaignId,a=e.used,o=e.value,u=e.minimumOrderValue,i=e.type,s=e.created,c=e.storeName,d=(o/100).toFixed(2),l=Math.floor(s/1e3);return{id:r,exclusiveId:r,campaignId:n,value:d,storeId:t,storeName:c,status:a?"USED":"ACTIVATED",campaignType:i,campaignMinOrderValue:u,created:l,nextExpiration:l+g.default.duration(24,"hours").asSeconds()}}));return{isLoggedIn:!0,id:e.userId,created:e.created,availablePoints:e.points.pointsAvailable,pendingPoints:e.points.pointsPendingDeposit,earnedPoints:e.points.pointsPendingDeposit+e.points.pointsAvailable+e.points.pointsPendingWithdrawal+e.points.pointsRedeemed,email:e.email,hasImage:e.hasImage,imageUrl:e.imageUrl,name:e.name,firstName:e.firstName,lastName:e.lastName,bio:e.bio,countryCode:e.countryCode,countryName:e.countryName,referralToken:e.referralToken,exclusives:t,honeyPay:e.honeyPay,honeyWallet:e.honeyWallet}}var M=!0,B=!1,F=void 0;function G(e){var t,r=this;if(!(e&&e.forceRefresh)){var n=R.default.getCacheItem("user:info");if(n)return d.default.resolve(n)}return F||(F=U.then(i).catch((function(e){return e instanceof UnauthorizedError?(v.default.setRefreshAndAccessTokens("",""),null):R.default.getCacheItem("user:info")})).then((function(e){return d.default.props({userInfo:e,userId:N(e&&e.id)?e.id:U.then((function(){return I.default.sync.get("user:userId")})).catch((function(){return null})).then((function(e){return N(e)?e:window.localStorage.getItem("user:userId")})).catch((function(){return null})).then((function(e){return N(e)?e:I.default.local.get("user:userId")})).catch((function(){return null})).then((function(e){return N(e)?e:m.default.get(Object.assign({},A)).then((function(e){return e.value}))})).catch((function(){return null})).then((function(e){return N(e)?e:I.default.local.get("user:id")})).catch((function(){return null})).then((function(e){return N(e)?e:null}))})})).then((t=T(regeneratorRuntime.mark((function e(t){var n,a,o=t.userId,u=t.userInfo;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M&&(B=!!N(o),M=!1),e.next=3,x.default.loadAuthTokens();case 3:return n=N(o)?o:y.default.createId(),a=Object.assign({isLoggedIn:!1},u,{id:n}),R.default.clearCache(),D(a.id),R.default.setCacheItem("user:info",a),w.default.send("user:current:update",{user:Object.assign({},a)},{allTabs:!0,ignoreResponse:!0,background:!0}).catch((function(){})),e.abrupt("return",Object.assign({},a));case 10:case"end":return e.stop()}}),e,r)}))),function(e){return t.apply(this,arguments)})).finally((function(){F=null}))),F}function q(e){return G(e).then((function(e){return e.id}))}function H(){return!k.experiments||!k.expires||k.expires<Date.now()?d.default.try((function(){return l.default.get("https://cdn.honey.io/experiments.json")})).then((function(e){var t=e.body;if(!t&&e.text)try{t=JSON.parse(e.text)}catch(e){return[]}return t&&"object"===u(t.experiments)?(k.experiments=t.experiments,k.expires=Date.now()+1e3*t.ttl,k.experiments):[]})).timeout(4e3).catch((function(){return k.experiments={},k.expires=Date.now()+6e4,[]})):k.experiments}var W=(0,p.default)({max:10,maxAge:36e5});_.default.addCompleteListener((function(e){var t=e.method,r=e.tabId,n=e.statusCode;return"GET"!==t&&r>=0&&200===n&&(G({forceRefresh:!0}).reflect(),P.default.getSettings({forceRefresh:!0}).reflect()),null}),{urls:["https://id.joinhoney.com/user","https://id.joinhoney.com/user/*","https://id.joinhoney.com/auth/*","https://d.joinhoney.com/login","https://d.joinhoney.com/login*","https://d.joinhoney.com/logout","https://d.joinhoney.com/logout*","https://d.joinhoney.com/extusers*","https://d.joinhoney.com/users*","https://d.joinhoney.com/campaign/reward*"]}),t.default={getInfo:G,fetchUserInfo:i,getUserId:q,hasAccount:function(){return G().then((function(e){if(e.isLoggedIn)return!0;var t=R.default.getCacheItem("hasAccount");return void 0!==t?t:v.default.get("https://d.joinhoney.com/users/heartbeat").then((function(e){return!0===e.body?(R.default.setCacheItem("hasAccount",!0),!0):(R.default.setCacheItem("hasAccount",!1),!1)}))})).catch((function(){return!1}))},isExistingUser:function(){return G().then((function(){return B}))},setAbGroupOverride:s,getUserABGroup:function(e){var t=W.get(e);return t?d.default.resolve(t):d.default.try((function(){return L||(L=d.default.all([q(),H()]).finally((function(){L=null})))})).spread((function(t,r){for(var n=y.default.parseInt(t.slice(-4)),a=0,o=0;o<r[e].length;o+=1)a+=r[e][o].weight;for(var u=n%a,i=void 0,s=0;s<r[e].length;s+=1)if((u-=r[e][s].weight)<0){i=r[e][s].data;break}return i?(W.set(e,i),E.default.sendEvent("exp00001",{experiment:e,group:i.group,group_meta:i.group_meta}).reflect(),i):{}})).catch((function(){return{}}))},updateProfileImage:function(){throw new NotImplementedError},persistUserId:D,convertApiUserToCacheUser:j,deleteUser:function(){var e=y.default.createId();if(!N(e))throw new ServerError("Invalid generated id");return R.default.clearCache(),D(e),e},getStoreSessionCount:c}},286:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={ADD_DROPLIST:"addDroplist",DESYNC_DROPLIST:"desyncItemsToDroplist",GET_CACHED_DROPLIST_ITEMS:"getCachedItemsByStore",GET_CART_PRICE_HISTORY:"getProductPriceHistoryByStoreIdVariantId",GET_CART_PRODUCT:"getProductByStoreIdVariantIds",GET_DROPLIST:"getDroplistItems",GET_PRICE_HISTORY:"getProductPriceHistory",GET_PRODUCT:"getProduct",GET_PRODUCTS:"getProducts",GET_PRODUCT_WITH_OFFER:"getProductWithOffer",GET_SAVED_FOR_LATER_ITEMS:"getAmazonSavedForLaterItems",GET_STORE_DEALS:"getStoreDeals",GET_STORE_SALES:"getStoreSales",REMOVE_DROPLIST:"removeDroplist",SYNC_DROPLIST:"syncItemsToDroplist",UPDATE_DROPLIST:"updateDroplist",GET_TIPS_SHOWN_BY_STORE:"getTipsShownByStore",INCREMENT_TIP_SHOWN:"incrementTipShown",INCREMENT_TIP_SHOWN_BY_STORE:"incrementTipShownByStore",GET_LAUNCHPAD_TIP_SHOWN_BY_STORE:"getLaunchpadTipShownByStore",INCREMENT_LAUNCHPAD_TIP_SHOWN_BY_STORE:"incrementLaunchpadTipShownByStore",GET_TIPS_SHOWN_BY_STORE_AND_CATEGORY:"getTipsShownByStoreAndCateogry",INCREMENT_MINI_TEASER_SHOWN_PER_CATEGORY:"incrementMiniTeasierShownPerCategory",GET_MINI_TEASER_SHOWN_PER_CATEGORY:"getMiniTeaserShownPerCategory",GET_TIPS_SHOWN_BY_PRODUCT:"getTipsShownByProduct",GET_REGISTRATION_TIP_SHOWN_QUANTITY:"getRegistrationTipShownQuantity",INCREMENT_REGISTRATION_TIP_SHOWN_QUANTITY:"incrementRegistrationTipShownQuantity",GET_AUTOPOP_PRODUCT_QUANTITY:"getAutoPopProductQuantity",INCREMENT_AUTOPOP_PRODUCT_QUANTITY:"incrementAutoPopProductQuantity",GET_TIPS_SHOW_REGISTRATION_PROMPT:"getTipsShowRegistrationPrompt",GET_SESSION_COUNT:"getSessionCount",INITIALIZE_TIP_NOTIFICATIONS_STATUS:"initializeTipNotificationStatus",UPDATE_TIP_NOTIFICATIONS_STATUS:"updateTipNotificationStatus",GET_TIP_NOTIFICATIONS_STATUS:"getTipNotificationStatus",TIPS_INCREMENT_SESSION_COUNT:"tips_incrementSessionCount",TIPS_GET_SETTINGS_PROMPT_STATE:"tips_getSettingsPromptState",TIPS_RESET_SETTINGS_PROMPT_STATE:"tips_resetSettingsPromptState",TIPS_INCREMENT_SETTINGS_PROMPT_HOVER:"tips_incrementSettingsPromptHover",TIPS_SETTINGS_PROMPT_PERFORM_ACTION:"tips_settingsPromptPerformAction",TIPS_SETTINGS_PROMPT_DISABLE:"tips_settingsPromptDisable",GET_TEASER_CLOSED_SHOULD_SHOW_PROMPT:"getTeaserClosedWithoutCtaCount",INCREMENT_TEASER_CLOSED_WITHOUT_CTA_COUNT:"incrementTeaserClosedWithoutCtaCount",RESET_TEASER_CLOSED_WITHOUT_CTA_COUNT:"resetTeaserClosedWithoutCtaCount",RESET_TEASER_CLOSED_WITHOUT_CTA_COUNT_DONE:"resetTeaserClosedWithoutCtaCountDone",SET_TEASER_CLOSED_PROMPT_SHOWN:"setTeaserClosedPromptShown",TIPS_GET_PDP_COUPON_AUTOPOP:"tips_getPDPCouponAutopop",TIPS_SET_PDP_COUPON_AUTOPOP:"tips_setPDPCouponAutopop",TIPS_INCREMENT_PI_AUTOPOP:"tips_incrementPIAutopop",TIPS_GET_PI_AUTOPOP:"tips_getPIAutopop"}},287:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=Date.now(),n=e.reduce((function(e,n){var u=o.default.getProductInfoById(n.productId);return e[n.productId]=n,e[n.productId].lastCheckedTime=u?n.productId===t?r:u.lastCheckedTime:r-a.PRODUCT_FETCH_TTL,e}),{});o.default.updateCacheWithProducts(n)};var n,a=r(608),o=(n=a)&&n.__esModule?n:{default:n}},288:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LOAD_CART_URL=void 0;var n,a,o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u=(n=h(regeneratorRuntime.mark((function e(t){var r,n,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={storeId:v,variantIds:t},e.next=3,l.default.query(m,r);case 3:return n=e.sent,a=n.data,o=n.errors,u=(a||{}).getProductByStoreIdVariantIds||[],o&&f.default.warn("GraphQL error(s) from "+m,{params:r,errors:o}),e.abrupt("return",u);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)}),i=(a=h(regeneratorRuntime.mark((function e(t,r){var n,a,o,u,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r?b:w,e.next=3,l.default.query(n,{meta:{storeIds:[v],variantIds:t}});case 3:return a=e.sent,o=a.data,u=a.errors,i=(o||{}).getDroplistByUserId||[],u&&f.default.warn("GraphQL error(s) from "+n,{errors:u}),e.abrupt("return",i.map((function(e){var t=e.expires,r=e.originalPrice,n=e.notifyAtPrice,a=e.product,o=e.productId,u=a||{},i=u.variantId;return{canonicalUrl:u.canonicalUrl,expires:t,originalPrice:r,notifyAtPrice:n,productId:o,storeId:(u.store||{}).storeId,variantId:i}})));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)}),s=g(r(5)),c=g(r(19)),d=g(r(21)),l=g(r(8)),f=g(r(3)),p=g(r(287));function g(e){return e&&e.__esModule?e:{default:e}}function h(e){return function(){var t=e.apply(this,arguments);return new s.default((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return s.default.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var y,v="1",m="getProductByStoreIdVariantIds",b="ext_savedForLater_getDroplistByUserId",w="ext_droplistDesync_getDroplistByUserId";t.LOAD_CART_URL="https://www.amazon.com/gp/cart/ajax-load-list.html";function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.canonicalUrl,r=e.store,n=(r=void 0===r?{}:r).storeId,a=e.imageUrlPrimary,o=e.parentId,u=e.priceCurrent,i=e.title,s=e.variantId;return n&&o?{canonicalUrl:t,imageUrl:a,lastPrice:u,merchId:o,storeId:n,title:i,variantId:s}:{}}t.default=(y=h(regeneratorRuntime.mark((function e(t,r){var n,a,l,f,g,h,y,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.default.getInfo();case 2:if(e.sent.isLoggedIn){e.next=6;break}return e.abrupt("return",[]);case 6:return e.next=8,s.default.all([u(t),i(t,r)]);case 8:return n=e.sent,a=o(n,2),l=a[0],f=a[1],g=c.default.keyArrayBy(l,"variantId"),h=c.default.keyArrayBy(f,"variantId"),y=f.map((function(e){return{productId:e.productId,canonicalUrl:e.canonicalUrl,storeId:e.storeId}})),v=[],t.forEach((function(e){var t=I(g[e]),r=h[e];r&&(0,p.default)(y,r.productId);var n=Object.keys(t||{}).length>0,a=Object.keys(r||{}).length>0;n&&a?v.push(Object.assign({},t,r)):n&&v.push(Object.assign({},t))})),e.abrupt("return",v);case 18:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},3:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(20)),a=o(r(1075));function o(e){return e&&e.__esModule?e:{default:e}}t.default=new a.default((function(e){return n.default.sendException(e)}))},39:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o,u,i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=(n=F(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.default.get(t);case 2:return r=e.sent,e.abrupt("return",J(r.url,r.id));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)}),l=(a=F(regeneratorRuntime.mark((function e(){var t,r,n,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.default.get("topStoresByDomain").catch((function(){return null}));case 2:if(t=e.sent,r=6048e5,n=36e5,!t){e.next=7;break}return e.abrupt("return",t);case 7:return e.prev=7,e.next=10,v.default.query("ext_getTopStores",{});case 10:return a=e.sent,o=a.data.getTopStores,u=o.reduce((function(e,t){var r=t.partialUrls&&t.partialUrls[0]&&t.partialUrls[0].domain;return s({},e,B({},r,t))}),{}),w.default.set("topStoresByDomain",u,r),e.abrupt("return",u);case 17:return e.prev=17,e.t0=e.catch(7),w.default.set("topStoresByDomain",{},n),e.abrupt("return",{});case 21:case"end":return e.stop()}}),e,this,[[7,17]])}))),function(){return a.apply(this,arguments)}),f=(o=F(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.default.fetchStorePdpRegex(t);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)}),p=(u=F(regeneratorRuntime.mark((function e(t,r,n){var a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={urlTimestamp:(0,h.default)().unix(),referrerUrl:n},o=t+":"+r,e.next=4,H.get(o);case 4:(u=e.sent)?(u.length>14&&u.shift(),H.set(o,u.concat(a))):H.set(o,new Array(a));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return u.apply(this,arguments)}),g=M(r(5)),h=M(r(0)),y=M(r(35)),v=M(r(8)),m=M(r(15)),b=M(r(3)),w=M(r(47)),I=M(r(4)),S=M(r(20)),_=M(r(94)),E=M(r(21)),x=M(r(19)),R=M(r(582)),P=M(r(1095)),O=M(r(1096)),T=M(r(1097)),C=M(r(1098)),A=M(r(1099)),k=M(r(1100)),L=M(r(1101)),N=M(r(585)),D=M(r(1102)),U=M(r(1103)),j=M(r(1104));function M(e){return e&&e.__esModule?e:{default:e}}function B(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function F(e){return function(){var t=e.apply(this,arguments);return new g.default((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return g.default.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var G=new Map,q=new Map,H=new y.default({max:90,maxAge:108e5,length:function(e){return e.length}}),W={};function Y(){return!W.data||!W.expires||W.expires<Date.now()?g.default.try((function(){return m.default.get("https://d.joinhoney.com/v2/currency-exchange/rates")})).then((function(e){var t=e.body;if(!t&&e.text)try{t=JSON.parse(e.text)}catch(e){return{}}return t&&"object"===(void 0===t?"undefined":c(t))?(W.data=t,W.expires=Date.now()+36e5,W.data):{}})).timeout(3e3).catch((function(){return W.data={},W.expires=Date.now()+6e4,{}})):W.data}var V={};function z(e,t){q.has(t)&&"101709169697708349"===e&&(e=q.get(t).id);var r=e+":"+t;return V[r]?V[r]:(V[r]=g.default.all([O.default.getStoreInfo(e),L.default.getSession(e),R.default.getStoreGoldActivated(e),E.default.getUserABGroup("stores"),Y(),D.default.getStoreNNA(e)]).spread((function(r,n,a,o,u,i){var s=Object.assign({},r);if(n&&(s.sessionId=n.id,s.tagged=n.tagged,Object.keys(n.attributes).forEach((function(e){s[e]=n.attributes[e]}))),i&&(s.gold={activateTTL:10800,expires:Math.floor(Date.now()/1e3)+86400,description:i.exclusions,min:i.minPercent,max:i.maxPercent,isFlatFee:i.isFlatFee,minFlatFee:i.minFlatFee,maxFlatFee:i.maxFlatFee}),x.default.checkGoldStatus(s.gold).active&&(s.gold.activated=a),o&&o[e]){var c=o[e];s=Object.assign(s,c),c.extraCoupons&&Array.isArray(s.coupons)&&(s.coupons=s.coupons.concat(c.extraCoupons))}if(t>=0&&void 0===s.standDown&&(s.standDown=N.default.getStoreTabStandDownStatus(e,t),s.standDownValue=N.default.getStoreTabStandDownValue(e,t),s.standDownValue>1)){var d=s.gold;delete s.gold,s.hadGold=d||s.hadGold}try{s.currencyCode=x.default.getCountryCurrencyCode(s.country),s.currencySymbol=x.default.getCountryCurrency(s.country),s.currencyExchangeRate=u[s.currencyCode]}catch(e){}return s})).catch((function(){return{id:e,supported:!1}})).finally((function(){setTimeout((function(){return delete V[r]}),500)})),V[r])}var K={};function J(e,t){G.get(t)&&(e=G.get(t));var r=e+":"+t;return K[r]?K[r]:(K[r]=j.default.findStoreIdForUrl(e).then((function(e){return z(e,t)})).catch(NotFoundError,(function(){})).finally((function(){setTimeout((function(){return delete K[r]}),500)})),K[r])}function Q(e){return U.default.getTrendingStores(e).map((function(e){return e.gold&&e.gold.min>0?R.default.getStoreGoldActivated(e.id).then((function(t){var r=Object.assign({},e.gold,{activated:t});return Object.assign({},e,{gold:r})})):e}))}function $(){return U.default.fetchTrendingStoresByGMV()}function X(e){return U.default.fetchTrendingStoresByCountryByGMV(e)}function Z(e,t,r){return k.default.searchStores(e,t,r).map((function(e){return e.gold&&e.gold.min>0?R.default.getStoreGoldActivated(e.id).then((function(t){var r=Object.assign({},e.gold,{activated:t});return Object.assign({},e,{gold:r})})):e}))}function ee(e,t,r,n,a){var o=N.default.getStoreTabStandDownValue(e,a);if(o>1)throw new UnauthorizedError("Cannot tag: stand down is set to "+o);return R.default.tag(e,t,r,n,a)}function te(e,t,r,n){var a=N.default.getStoreTabStandDownValue(e,r);if(!t.inPopover&&a>1&&!t.standUp)throw new UnauthorizedError("Cannot activate Gold: stand down is set to "+a);return z(e).then((function(e){var a=x.default.checkGoldStatus(e.gold);if(!e||!a.active)throw new InvalidParametersError("Cannot activate Gold: offer not available");return R.default.activateStoreGold(e,t,r,n)}))}function re(e){return e?R.default.deactivateStoreGold(e):g.default.resolve()}function ne(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return g.default.filter(t,(function(e){return R.default.getStoreGoldActivated(e)}))}function ae(){return C.default.getPopularOffers()}function oe(e,t,r){L.default.setSessionAttribute(e,t,r)}function ue(e){return L.default.getStoreSessionId(e)}function ie(e,t){return N.default.getStoreTabStandDownStatus(e,t)}function se(e,t,r,n){return N.default.setStoreTabStandDownStatus(e,t,r,n)}I.default.addListener("page:load",(function(e,t,r){return t&&t.url&&r&&r.tabId>=0?(t.shopifyPayOverride?G.set(r.tabId,t.url):(G.delete(r.tabId),q.delete(r.tabId)),g.default.try((function(){return J(t.url)})).then((function(e){return g.default.all([e,L.default.getSession(e.id),I.default.send("stores:action",{action:"getSubIds"},{tab:r.tabId}).catch((function(){return[]})),E.default.getUserABGroup("extPageViewSdata")])})).spread((function(e,n,a,o){if(e&&e.id){t.shopifyPayOverride&&q.set(r.tabId,e);var u=Array.isArray(a)?a:[],s=i(u,3),c=s[0],d=s[1],l=s[2];o&&"off"!==o.group&&("on"===o.group||e.metadata.pns_pageViews)&&S.default.sendEvent("ext001001",{referrerUrl:t.url,store:{id:e.id,sessionId:n.id,subid1:c,subid2:d,subid3:l}},{immediate:!0}),e&&e.id&&n&&n.id&&p(e.id,n.id,t.url)}})).reflect(),null):null})),I.default.addListener("ui:interaction",(function(e,t){return t&&t.store&&t.store.id&&L.default.activateSession(t.store.id),null})),I.default.addListener("stores:action",(function(e,t,r){var n,a=t&&t.data||{};switch(t&&t.action){case"activateStoreGold":return te(a.storeId,a.taggingOptions,r.tabId,a.cleanTargetUrl);case"deactivateStoreGold":return re(a.storeId);case"deleteStoreTabSession":return L.default.deleteStoreTabSession(a.storeId,a.tabId);case"getActivePayoutStores":return T.default.getActivePayoutStores(a);case"getAverageGoldEarned":return D.default.getAverageGoldEarned(a.storeId);case"getClaimedOffers":return ne(a.userId,a.stores);case"getCouponStats":return D.default.getCouponStats(a.storeId);case"getCurrencyExchangeRates":return Y();case"getGoldMultiplier":return D.default.getGoldMultiplier(a.storeId);case"getHpid":return P.default.getHpid(a.store,a.product);case"getPopularOffers":return ae();case"getStoreById":return z(a.storeId,r.tabId);case"getStoreByTabId":return d(r.tabId);case"getStoreByUrl":return J(a.storeUrl,r.tabId);case"getStoreSessionId":return ue(a.storeId);case"getSession":return n=a.storeId,L.default.getSession(n);case"getStoreSales":return D.default.getStoreSales();case"getStoreDoubleGold":return D.default.getStoreDoubleGold(a.storeId);case"getStoreTabStandDownStatus":return ie(a.storeId,r.tabId);case"getStoreUrlTrace":return function(e,t){return H.get(e+":"+t)}(a.storeId,a.sessionId);case"getTopStoresByDomain":return l(a);case"getTrending":return Q(a);case"getTrendingByCountryByGMV":return X(a.country);case"getTrendingByGMV":return $();case"getPdpRegex":return f(a.storeId);case"search":return Z(a.query,a.stats,a.limit);case"setSessionAttribute":return oe(a.storeId,a.attribute,a.value);case"setStoreTabStandDownStatus":return se(a.storeId,r.tabId,a.standDownStatus,a.ttlSeconds);case"submitCoupon":return function(e){var t=e.code,r=e.description,n=e.sourceUserId,a=e.storeId,o=e.expires,u=e.markSuccessful;v.default.mutate("ext_insertStoreUGC",{storeId:a,ugcDef:{code:t,description:r,sourceUserId:n,expires:o}}).then((function(){u&&v.default.mutate("external_v2_incrementUGCSuccess",{storeId:a,code:t,userId:n})})).catch((function(e){e.graphQLErrors&&e.graphQLErrors.length&&"NotFound"===e.graphQLErrors[0].error||b.default.error("V3 failed to insert store UGC",e)}))}(a);case"markUserSubmittedCode":return function(e){var t=e.storeId,r=e.code,n=e.userId,a=e.discount;x.default.round(a,2)>0?v.default.mutate("external_v2_incrementUGCSuccess",{storeId:t,code:r,userId:n}).catch((function(e){e.graphQLErrors&&e.graphQLErrors.length&&"NotFound"===e.graphQLErrors[0].error||b.default.error("V3 failed to mark ugc successful",e)})):v.default.mutate("external_v2_incrementUGCFailure",{storeId:t,code:r,userId:n}).timeout(5e3,"mark ugc fail").catch((function(e){e.graphQLErrors&&e.graphQLErrors.length&&"NotFound"===e.graphQLErrors[0].error||b.default.error("V3 failed to mark ugc unsuccessful",e)}))}(a);case"tag":return ee(a.storeId,a.type,a.cleanTargetUrl,a.options,r.tabId);default:throw new InvalidParametersError("Invalid store action")}})),t.default={activateStoreGold:te,deactivateStoreGold:re,getClaimedOffers:ne,getCurrencyExchangeRates:Y,getPopularOffers:ae,getStoreById:z,getStoreByTabId:d,getStoreByUrl:J,getStoreSessionId:ue,getStoreTabStandDownStatus:ie,getTopStoresByDomain:l,getTrending:Q,getTrendingByCountryByGMV:X,getTrendingByGMV:$,getPdpRegex:f,search:Z,setSessionAttribute:oe,setStoreTabStandDownStatus:se,storeStats:D.default,tag:ee,updateGoldStatus:function(e){return R.default.updateGoldStatus(e)}}},4:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(5)),a=u(r(192)),o=u(r(19));function u(e){return e&&e.__esModule?e:{default:e}}var i={};t.default={send:function(e,t,r){return n.default.try((function(){return a.default.send(o.default.cleanStringLower(e),t,r)})).timeout(6e4)},addListener:function(e,t){var r=o.default.cleanStringLower(e);if(!r)throw new InvalidParametersError("type");if("function"!=typeof t)throw new InvalidParametersError("listener");var n=i[r];if(n){if(-1!==n.indexOf(t))return!1;n.push(t)}else i[r]=[t];return a.default.addListener(r,t)},addCoreListener:function(e,t){var r=o.default.cleanStringLower(e);if(!r)throw new InvalidParametersError("type");if("function"!=typeof t)throw new InvalidParametersError("listener");return a.default.addListener(r,t)},removeListener:function(e,t){var r=o.default.cleanStringLower(e);if(!r)throw new InvalidParametersError("type");if("function"!=typeof t)throw new InvalidParametersError("listener");var n=i[r];return n&&((n=n.filter((function(e){return e!==t}))).length>0?i[r]=n:delete i[r]),a.default.removeListener(r,t)},removeCoreListener:function(e,t){var r=o.default.cleanStringLower(e);if(!r)throw new InvalidParametersError("type");if("function"!=typeof t)throw new InvalidParametersError("listener");return a.default.removeListener(r,t)},removeAllNonCoreListeners:function(){Object.keys(i).forEach((function(e){i[e].forEach((function(t){return a.default.removeListener(e,t)}))})),i={}}}},47:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(4)),a=u(r(35)),o=u(r(5));function u(e){return e&&e.__esModule?e:{default:e}}var i=(0,a.default)({max:1048576,length:function(e){return JSON.stringify(e||{}).length},maxAge:108e5});function s(e){return o.default.try((function(){var t=i.get(e);if(void 0!==t)return t;throw new NotFoundError}))}function c(e,t,r){return o.default.try((function(){return i.set(e,t,r)}))}function d(e){return o.default.try((function(){return i.del(e)}))}setInterval((function(){return i.prune()}),3e5),n.default.addListener("lru:access",(function(e,t){var r=t&&t.data||{};switch(t&&t.action){case"get":return s(r.key);case"set":return c(r.key,r.val,r.options);case"del":return d(r.key);default:throw new InvalidParametersError("Not a supported action")}})),t.default={get:s,set:c,del:d,prefixed:function(e){return{del:function(t){return d(e+":"+t)},get:function(t){return s(e+":"+t)},set:function(t,r){return c(e+":"+t,r)}}},lru:i}},55:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(4)),a=c(r(1074)),o=c(r(153)),u=c(r(587)),i=c(r(1105)),s=c(r(1106));function c(e){return e&&e.__esModule?e:{default:e}}n.default.addListener("device:action",(function(e,t){var r=t&&t.data||{};switch(t&&t.action){case"getDeviceId":return o.default.getDeviceId(r.options);case"getExv":return o.default.getExv(r.options);case"getManifest":return o.default.getManifest();case"getSessionId":return s.default.getSessionId();case"getScreenViewId":return s.default.getScreenViewId();case"getSetting":return i.default.getSetting(r.key,r.options);case"getSettings":return i.default.getSettings(r.options);case"updateSetting":return i.default.updateSetting(r.key,r.value);case"isFirstTime":return u.default.get("device:firstTime");case"isFirstTimeFS":return u.default.get("device:firstTimeFS");case"clearFirstTimeFS":return u.default.del("device:firstTimeFS");case"isFirstTimeHG":return u.default.get("device:firstTimeHG");case"clearFirstTimeHG":return u.default.del("device:firstTimeHG");case"isFirstTimeFSHG":return u.default.get("device:firstTimeFSHG");case"clearFirstTimeFSHG":return u.default.del("device:firstTimeFSHG");case"isFirstTimeLaunchpad":return u.default.get("device:firstTimeLaunchpad");case"clearFirstTimeLaunchpad":return u.default.del("device:firstTimeLaunchpad");case"sendHeartbeat":return a.default.sendHeartbeat(r.force);case"sendPaypalHeartbeat":return a.default.sendPaypalHeartbeat();default:throw new InvalidParametersError("action")}})),t.default={determineSsdState:s.default.determineSsdState,getCurrentSsd:s.default.getCurrentSsd,getCurrentSsr:s.default.getCurrentSsr,getDeviceId:o.default.getDeviceId,getExv:o.default.getExv,getSessionId:s.default.getSessionId,getScreenViewId:s.default.getScreenViewId,getSettings:i.default.getSettings,getSetting:i.default.getSetting,updateSetting:i.default.updateSetting,sendHeartbeat:a.default.sendHeartbeat,sendPaypalHeartbeat:a.default.sendPaypalHeartbeat}},574:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r(73);var a=s(r(5)),o=s(r(0)),u=s(r(192)),i=s(r(278));function s(e){return e&&e.__esModule?e:{default:e}}var c=void 0,d=a.default.resolve(),l=[],f={},p={};function g(e){return f[e]}function h(e){return e&&e.url?new a.default((function(t,r){e.srcTabId?browser.tabs.get(e.srcTabId,(function(n){browser.tabs.create({url:e.url,active:void 0===e.active||!!e.active,windowId:n.windowId},(function(e){browser.runtime.lastError?r(new Error(browser.runtime.lastError.message)):t(e&&e.id)}))})):browser.tabs.create({url:e.url,active:void 0===e.active||!!e.active},(function(e){browser.runtime.lastError?r(new Error(browser.runtime.lastError.message)):t(e&&e.id)}))})):a.default.reject(new InvalidParametersError("url"))}function y(e){return new a.default((function(t,r){browser.tabs.remove(e,(function(){browser.runtime.lastError?r(new Error(browser.runtime.lastError.message)):t()}))}))}function v(e){return new a.default((function(t,r){-1!==e?browser.tabs.get(e,(function(e){browser.runtime.lastError?r(new Error(browser.runtime.lastError.message)):e?(Object.assign(e,{url:g(e.id)}),t(e)):r(new NotFoundError)})):r(new NotFoundError)}))}function m(e,t){return a.default.try((function(){return function e(t,r){return!(!t||t!==r)||!(!r||!t)&&e(t,p[r])}(t,e)}))}function b(){return new a.default((function(e,t){browser.windows.getAll({populate:!0},(function(r){if(browser.runtime.lastError)t(new Error(browser.runtime.lastError.message));else if(Array.isArray(r)){var n=[];r.forEach((function(e){n=n.concat(e.tabs)})),n.forEach((function(e){Object.assign(e,{url:g(e.id)})})),e(n)}else e([])}))}))}function w(){return new a.default((function(e,t){browser.tabs.query({},(function(r){browser.runtime.lastError?t(new Error(browser.runtime.lastError.message)):Array.isArray(r)?e(r.map((function(e){return e.id}))):e([])}))}))}function I(e){return a.default.try((function(){var t=e&&e.id;if(!(t>=0))throw new InvalidParametersError("tab id");return e.index>=0||new a.default((function(e,r){var n=(0,o.default)().add(6,"hours").unix();if(l.push({id:t,resolve:e,reject:r,expires:n})>2e4)try{l.shift().reject(new CancellationError)}catch(e){}}))}))}function S(e){return f[e]?a.default.resolve():new a.default((function(t){try{browser.tabs.executeScript(e,{file:"h1-check.js"},(function(e){browser.runtime.lastError?t():t(e)}))}catch(e){t()}}))}function _(){return d.then((function(){return v(c)}))}browser.tabs.onActivated.addListener((function(e){if(e){var t=e.tabId;c=t,u.default.send("tabs:activated",{tabId:t},{background:!0,allTabs:!0,ignoreResponse:!0}).reflect()}})),browser.windows.onFocusChanged.addListener((function(e){-1!==e&&(d=new a.default((function(t){try{browser.windows.get(e,{populate:!0},(function(e){var r=e.tabs.filter((function(e){return!0===e.active}));c=r[0].id,t(),u.default.send("tabs:activated",{tabId:c},{background:!0,allTabs:!0,ignoreResponse:!0}).reflect()}))}catch(e){t()}})))})),i.default.addOnInstallListener((function(){browser.windows.getCurrent({populate:!0},(function(e){var t=e.tabs.filter((function(e){return!0===e.active}));c=t[0].id}))})),browser.tabs.onRemoved.addListener((function(e){e&&(delete f[e],u.default.send("tabs:removed",{tabId:e},{background:!0,allTabs:!0,ignoreResponse:!0}).reflect())})),browser.tabs.onReplaced.addListener((function(e,t){p[e]=t,l=l.filter((function(t){if(t.id!==e)return!0;try{t.resolve(!0)}catch(e){}return!1}))})),browser.runtime.onMessage.addListener((function(e,t,r){return!(!e||"tabs:cs"!==e.service)&&(a.default.try((function(){switch(e.type){case"open":return h(e.params);case"close":return y(e.tabId);case"closeCurrent":return y(t&&t.tab&&t.tab.id);case"get":return v(e.tabId);case"getCurrent":return v(t&&t.tab&&t.tab.id);case"getSelectedTab":return _();case"getAll":return b();case"getAllIds":return w();case"waitReady":return I(t&&t.tab);case"isCurrentTabId":return m(t&&t.tab&&t.tab.id,e.tabId);default:throw new InvalidParametersError("type")}})).then((function(e){try{r({success:!0,data:e})}catch(e){}})).catch((function(e){try{r({success:!1,error:e&&(e.message||e.name)})}catch(e){}})),!0)})),setInterval((function(){var e=(0,o.default)().unix();l=l.filter((function(t){if(!((t&&t.expires)>e)){try{t.reject(new CancellationError)}catch(e){}return!1}return!0}))}),6e4),t.default={checkForWebstore:function(){return b().then((function(e){return e.some((function(e){return!(!e||!e.url)&&e.url.indexOf("addons.mozilla.org/en-US/firefox/addon/honey/")>1}))}))},openEmailAuthWindow:function(e,t,r,n){return new a.default((function(a){var o="https://www.joinhoney.com/auth?mode="+e+(t?"&from="+t:"")+(r?"":"&social=hs")+(n?"&optOut=true":""),u=520;r&&(u=560),browser.windows.create({url:o,titlePreface:"Honey | ",height:u,width:350,allowScriptsToClose:!0,type:"popup"}).then((function(e){var t=setInterval((function(){var r=!1;browser.windows.getAll().then((function(t){return t.forEach((function(t){t.id===e.id&&(r=!0)})),r})).then((function(r){browser.windows.get(e.id,{populate:!0},(function(n){r?n.tabs[0].id&&["https://www.joinhoney.com/","https://www.joinhoney.com/?error_uri=https%3A%2F%2Fwww.joinhoney.com%2F&error_description=Consent%20denied&error=access_denied"].includes(g(n.tabs[0].id))?browser.windows.remove(e.id,(function(){a(),clearInterval(t)})):g(n.tabs[0].id).startsWith("https://www.joinhoney.com/?code=")&&setTimeout((function(){browser.windows.remove(e.id,(function(){a(),clearInterval(t)}))}),2e3):(clearInterval(t),a(e))}))}))}),300)}))}))},openAppleAuthWindow:function(e){return new a.default((function(t){browser.windows.create({url:e,titlePreface:"Honey | ",height:640,width:680,allowScriptsToClose:!0,type:"popup"}).then((function(e){var r=setInterval((function(){var n=!1;browser.windows.getAll().then((function(t){return t.forEach((function(t){t.id===e.id&&(n=!0)})),n})).then((function(n){browser.windows.get(e.id,{populate:!0},(function(a){var o=g(a.tabs[0].id);n?a.tabs[0].id&&("https://www.joinhoney.com"===o||o.includes("https://www.joinhoney.com/auth/apple?error=user_cancelled_authorize"))&&browser.windows.remove(e.id,(function(){t(),clearInterval(r)})):(clearInterval(r),t(e))}))}))}),300)}))}))},openGoogleAuthWindow:function(e){return new a.default((function(t){browser.windows.create({url:e,titlePreface:"Honey | ",height:360,width:440,allowScriptsToClose:!0,type:"popup"}).then((function(e){var r=setInterval((function(){var n=!1;browser.windows.getAll().then((function(t){return t.forEach((function(t){t.id===e.id&&(n=!0)})),n})).then((function(n){browser.windows.get(e.id,{populate:!0},(function(a){n?a.tabs[0].id&&"https://www.joinhoney.com/"===g(a.tabs[0].id)&&browser.windows.remove(e.id,(function(){t(),clearInterval(r)})):(clearInterval(r),t(e))}))}))}),300)}))}))},openFBAuthWindow:function(e){return new a.default((function(t){browser.windows.create({url:e,titlePreface:"Honey | ",height:360,width:440,allowScriptsToClose:!0,type:"popup"}).then((function(e){var r=setInterval((function(){var n=!1;browser.windows.getAll().then((function(t){return t.forEach((function(t){t.id===e.id&&(n=!0)})),n})).then((function(n){n||(clearInterval(r),t(e))}))}),300)}))}))},openPaypalAuthWindow:function(e){return new a.default((function(t){browser.windows.create({url:e,titlePreface:"Honey | ",height:640,width:550,allowScriptsToClose:!0,type:"popup"}).then((function(e){var r=setInterval((function(){var n=!1;browser.windows.getAll().then((function(t){return t.forEach((function(t){t.id===e.id&&(n=!0)})),n})).then((function(n){browser.windows.get(e.id,{populate:!0},(function(a){n?a.tabs[0].id&&["https://www.joinhoney.com/","https://www.joinhoney.com/?error_uri=https%3A%2F%2Fwww.joinhoney.com%2F&error_description=Consent%20denied&error=access_denied"].includes(g(a.tabs[0].id))?browser.windows.remove(e.id,(function(){t(),clearInterval(r)})):g(a.tabs[0].id).startsWith("https://www.joinhoney.com/?code=")&&setTimeout((function(){browser.windows.remove(e.id,(function(){t(),clearInterval(r)}))}),2e3):(clearInterval(r),t(e))}))}))}),300)}))}))},open:h,close:y,get:v,getSelectedTab:_,initializeHoneyOnTab:S,initializeHoneyOnStoreTab:function(e){return new a.default((function(t){try{!function(e,t){var r=function(e,t,r){return function(){browser.tabs.executeScript(e,t,r)}},n=null,a=!0,o=!1,u=void 0;try{for(var i,s=t.reverse()[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){n=r(e,i.value,n)}}catch(e){o=!0,u=e}finally{try{!a&&s.return&&s.return()}finally{if(o)throw u}}null!==n&&n()}(e,[{file:"h1-main.js"},{file:"h1-honeyscience-main-popover-wallet.js"},{file:"h1-vendors-main-popover-wallet.js"}])}catch(e){t()}}))},initializeHoneyOnAllTabs:function(){return b().then((function(e){return a.default.map(e,(function(e){return S(e.id)}))}))},isCurrentTabId:m,getAll:b,getAllIds:w,waitReady:I,trackTab:function(e,t){var r,n,a=e.url.includes(browser.runtime.getURL("/"));t&&t.tabId>=0&&!a&&(e.url.match(/^https:\/\/d.joinhoney\.com\/login\/fb/)&&browser.tabs.remove(t.tabId),r=t.tabId,n=e.url,f[r]=n)},update:function(e,t){return new a.default((function(r){if("number"!=typeof e||"object"!==(void 0===t?"undefined":n(t)))throw new InvalidParametersError("no damn params");browser.tabs.update(e,{url:t.url},(function(e){r(e)}))}))}}},579:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.fetch},580:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={calculateRankingScore:function(e,t,r){return.5*e+.3*t+.2*r}}},581:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=(n=y(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.default.get("https://d.joinhoney.com/extdata/ckdata");case 3:t=e.sent,r=t.body,i.default.setRefreshAndAccessTokens(r[m],r[v]),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),new UnauthorizedError;case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return n.apply(this,arguments)}),o=h(r(5)),u=h(r(8)),i=h(r(15)),s=h(r(130)),c=h(r(55)),d=h(r(4)),l=h(r(20)),f=h(r(94)),p=h(r(195)),g=h(r(283));function h(e){return e&&e.__esModule?e:{default:e}}function y(e){return function(){var t=e.apply(this,arguments);return new o.default((function(e,r){return function n(a,u){try{var i=t[a](u),s=i.value}catch(e){return void r(e)}if(!i.done)return o.default.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(s)}("next")}))}}var v="honey-token-access",m="honey-token-refresh";function b(e){p.default.clearCache(),g.default.persistUserId(e.id),p.default.setCacheItem("user:info",e),d.default.send("user:current:update",{user:e},{allTabs:!0,ignoreResponse:!0}).catch((function(){})),c.default.sendHeartbeat(!0)}function w(){var e,t=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return f.default.openAppleAuthWindow(r,n).timeout(6e5).delay(500).then(a).then(g.default.fetchUserInfo).catch((function(){return o.default.delay(500).then(g.default.fetchUserInfo)})).then((e=y(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Math.floor(Date.now()/1e3)-r.created<30?l.default.sendEvent("usr001001",{registration_source:"apple"}):l.default.sendEvent("usr001002",{login_source:"apple"}),b(r),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,t)}))),function(t){return e.apply(this,arguments)})).catch((function(){throw new Error("Apple's being fussy. Please try again or join with your email below :)")}))}function I(){var e,t=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return f.default.openFBAuthWindow(r,n).timeout(6e5).delay(500).then(a).then(g.default.fetchUserInfo).catch((function(){return o.default.delay(500).then(g.default.fetchUserInfo)})).then((e=y(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Math.floor(Date.now()/1e3)-r.created<30?l.default.sendEvent("usr001001",{registration_source:"facebook"}):l.default.sendEvent("usr001002",{login_source:"facebook"}),b(r),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,t)}))),function(t){return e.apply(this,arguments)})).catch((function(){throw new Error("Facebook's being fussy. If you created your Facebook account with a phone number, add your email and try again. Or join with your email below :)")}))}function S(){var e,t=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return f.default.openGoogleAuthWindow(r,n).timeout(6e5).delay(500).then(a).then(g.default.fetchUserInfo).catch((function(){return o.default.delay(500).then(g.default.fetchUserInfo)})).then((e=y(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Math.floor(Date.now()/1e3)-r.created<30?l.default.sendEvent("usr001001",{registration_source:"google"}):l.default.sendEvent("usr001002",{login_source:"google"}),b(r),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,t)}))),function(t){return e.apply(this,arguments)})).catch((function(){throw new Error("Google's being fussy. Please try again or join with your email below :)")}))}function _(){var e,t=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return f.default.openPaypalAuthWindow(r,n).timeout(6e5).delay(500).then(a).then(g.default.fetchUserInfo).catch((function(){return o.default.delay(500).then(g.default.fetchUserInfo)})).then((e=y(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Math.floor(Date.now()/1e3)-r.created<30?l.default.sendEvent("usr001001",{registration_source:"paypal"}):l.default.sendEvent("usr001002",{login_source:"paypal"}),b(r),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,t)}))),function(t){return e.apply(this,arguments)})).catch((function(){throw new Error("Paypal's being fussy. Please try again or join with your email below :)")}))}t.default={openEmailAuth:function(e,t,r,n){var o,u=this;return f.default.openEmailAuthWindow(e,t,r,n).then(a).then(g.default.fetchUserInfo).then((o=y(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(t),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e,u)}))),function(e){return o.apply(this,arguments)}))},registerApple:w,registerFacebook:I,registerGoogle:S,registerPaypal:_,loadAuthTokens:a,loginApple:function(){return w(!1,!0)},loginFacebook:function(){return I(!1,!0)},loginGoogle:function(){return S(!1,!0)},loginPaypal:function(){return _(!1,!0)},logout:function(){var e=window.localStorage.getItem("honey-token-refresh");return o.default.try(f.default.logoutOfWebsite).then((function(){return u.default.mutate("users_logUserOut",{refreshToken:e})})).then((function(){p.default.clearCache(),i.default.setRefreshAndAccessTokens("","");try{s.default.remove({name:"honey-token-refresh",url:"https://www.joinhoney.com/"}),s.default.remove({name:"honey-token-access",url:"https://www.joinhoney.com/"})}catch(e){}return l.default.sendEvent("usr001003"),g.default.getInfo({forceRefresh:!0})}))},requestPasswordResetEmail:function(e){return i.default.post("https://d.joinhoney.com/request").send({type:"send_password_reset_email",email:e}).then((function(){return!0}))}}},582:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=E(r(5)),u=E(r(0)),i=E(r(194)),s=E(r(63)),c=E(r(281)),d=E(r(19)),l=E(r(55)),f=E(r(3)),p=E(r(4)),g=E(r(129)),h=E(r(584)),y=E(r(21)),v=E(r(20)),m=E(r(39)),b=E(r(94)),w=E(r(83)),I=E(r(193)),S=E(r(585)),_=E(r(190));function E(e){return e&&e.__esModule?e:{default:e}}var x=["*://*.emjcd.com/*","*://*.kdukvh.com/*","*://track.linksynergy.com/*","*://t.pepperjamnetwork.com/*"],R=["https://o.honey.io/*","https://o.joinhoney.com/*","https://out.joinhoney.com/*"],P={},O=[],T={},C=["utm_ad_group","utm_source","utm_medium","utm_campaign","utm_term","utm_content","cjevent","cm_mmc","cm_ven","cm_cat","cm_sp","cm_re","cm_pla","cm_ite","cvosrc"];function A(e){var t=e.match(/^https?:\/\/(?:www\.)?([^/?#]+)(?:[/?#]|$)/i);return t&&t[1]}var k={},L={},N=[];var D=!0,U=["OID","CID"];w.default.addBeforeRequestListener((function(e){var t=e.url,r=e.tabUrl;if(D&&r){var n=A(r);if(k[n]&&!t.match(/[?&]cjevent=(?!undefined)/gi)){var a=_.default.parse(t,!0);if(!U.every((function(e){return a.query&&a.query[e]})))return null;var o=k[n].extraParam;return{redirectUrl:t.match(/\?\w+=/)?t+"&"+o:t+"?"+o}}}return null}),{urls:["*://*.emjcd.com/*"]}),w.default.addHeadersReceivedListener((function(e){var t=e.tabId,r=e.url,n=r.match("https://o.honey.io/store/(\\w+)");if(n&&n[1]&&N.indexOf(n[1])<0&&(L[t]=Date.now()),r.toLowerCase().match(/([&?]cjevent=|[&?]stpcjid=)/gi)&&L[t]&&L[t]-Date.now()<6e4){delete L[t];var a=_.default.parse(r,!0),o=a.query&&(a.query.cjevent||a.query.stpcjid),u=A(r);k[u]={tabId:t,time:Date.now(),extraParam:o?"CJEVENT="+o:""}}}),{types:["main_frame"]});var j=void 0,M={};function B(){y.default.getUserABGroup("sfcjtp").then((function(e){e&&"off"===e.group?D=!1:"on"===e.group&&Array.isArray(e.reqParams)&&(U=e.reqParams||["OID","CID"],N=e.storeIds||[])})),y.default.getUserABGroup("joinhoneyRef").then((function(e){M={},j=null,e&&"on"===e.group&&(Array.isArray(e.whitelistStores)&&e.whitelistStores.length&&e.whitelistStores.forEach((function(e){M[e]=!0})),j=e.baseUrl||"https://o.joinhoney.com/store")}))}function F(e){var t=e.requestId,r=e.tabId,n=e.url;try{var a=_.default.parse(n,!0),o=_.default.parse(n).hostname,u=P[o];if(u)if(u.appendParams){if(u.tabs[r]&&u.tabId!==r&&u.lastRequestId!==t){var i=n;return u.lastRequestId=t,u.appendParams.forEach((function(e){e&&(e.key&&a.query[e.key]?i=i.replace(e.key+"="+a.query[e.key],e.key+"="+e.value):i.indexOf("?")>0?i+="&"+e.full:i+="?"+e.full)})),u.persist||delete u.tabs[r],{redirectUrl:i}}}else u.tabId=r,u.appendParams=(u.params||[]).map((function(e){if(e.indexOf("=")>0)return{full:e};if(!a.query[e])return null;var t=encodeURIComponent(a.query[e]);return{full:e+"="+t,key:e,value:t}})).filter((function(e){return e}))}catch(e){}return{}}function G(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=/^https?:\/\/(?:www\d?\.)?([^/?#]+)(?:[/?#]|$)/i,n=t.match(r);if(null===n)return!1;var a=n[1];return void 0!==a&&e.some((function(e){var t=e.indexOf("/"),r=t>-1?e.slice(0,t):e;return a.startsWith(r)||a.endsWith(r)}))}setTimeout(B,5e3),setInterval(B,72e5);var q={},H=[],W=null;function Y(e){var t=e.tabId,r=e.url,n=e.method;t>0&&b.default.get(t).then((function(e){v.default.sendEvent("ext300103",{referrer_url:e.url,ar:[{url:r,method:n}]})})).catch((function(){}))}function V(e){var t={affUrl:e.affUrl,finalUrl:e.finalUrl,requestId:e.requestId,timeTakenMs:e.timeTakenMs,store:{id:e.storeId},type:e.tagType,userAffiliateLinkId:e.userAffiliateLinkId};return v.default.sendEvent("ext300010",t).reflect()}function z(e){var t=e.affUrl,r=e.finalUrl,n=e.reason,a=e.requestId,o=e.timeTakenMs,u=e.statusCode,i=e.storeId,s={affUrl:t,finalUrl:r,failReason:n,requestId:a,statusCode:u,tagLocation:e.tagLocation,timeTakenMs:o,store:{id:i},userAffiliateLinkId:e.userAffiliateLinkId};return v.default.sendEvent("ext300011",s).reflect()}function K(e){var t={affUrl:e.affUrl,redirectUrl:e.redirectUrl,requestId:e.requestId,statusCode:e.statusCode,store:{id:e.storeId},userAffiliateLinkId:e.userAffiliateLinkId};return v.default.sendEvent("ext300012",t).reflect()}function J(){return!1}function Q(e){return e<0?"frame":"tab"}w.default.addHeadersReceivedListener((function(e){var t=e.tabId,r=e.url;if(!q[t])if(r.indexOf("aid=898409")>=0&&r.indexOf("label=affnetawin-index_pub-214459")>=0)H=["label","aid","awc"].map((function(e){var t=r.match("[?&;]("+e+"=[^&#]*?(?=([#&;]|$).*?))");return t?t[1]:null})).filter((function(e){return e})),W=Date.now()+36e5,q[t]=!0;else if(W)return S.default.getStoreTabStandDownValue("7394089402903213168",t)>0?(W=null,null):(q[t]=!0,{redirectUrl:d.default.buildTargetUrl(r,H)});return null}),{blocking:!0,types:["main_frame"],urls:["*://*.booking.com/*"]});var $=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pendingRequests={},this.pendingTags={},this.pendingIFrameTags={},this.tagsFailed={},this.allowRetries=!1,this.possiblyIncompleteRedirects={},this.incompleteTagRedirectWebhooks={},this.honeyFrameIds={},this.goldActivations={},this.onBeforeRequestSetPendingInfo=this.onBeforeRequestSetPendingInfo.bind(this),this.onBeforeRequestFromIncompleteRedirect=this.onBeforeRequestFromIncompleteRedirect.bind(this),this.onWebsiteAffiliateTag=this.onWebsiteAffiliateTag.bind(this),this.onBeforeSendHeadersModifyHeaders=this.onBeforeSendHeadersModifyHeaders.bind(this),this.onHeadersReceivedRemoveFrameOptions=this.onHeadersReceivedRemoveFrameOptions.bind(this),this.onBeforeRedirectMapToPendingTag=this.onBeforeRedirectMapToPendingTag.bind(this),this.onBeforeRedirectFromIncompleteRedirect=this.onBeforeRedirectFromIncompleteRedirect.bind(this),this.onCompletedCheckIfRequestWasTag=this.onCompletedCheckIfRequestWasTag.bind(this),this.onCompletedCheckIfCompletedRedirect=this.onCompletedCheckIfCompletedRedirect.bind(this),this.onErrorOccurredCheckIfTagPending=this.onErrorOccurredCheckIfTagPending.bind(this),this.onErrorOccurredCheckIfCompletedRedirect=this.onErrorOccurredCheckIfCompletedRedirect.bind(this),w.default.addBeforeRequestListener(this.onBeforeRequestSetPendingInfo,{urls:R,blocking:!1}),w.default.addBeforeRedirectListener(this.onWebsiteAffiliateTag,{types:["main_frame"],urls:R,blocking:!1}),w.default.addBeforeSendHeadersListener(this.onBeforeSendHeadersModifyHeaders,{types:["main_frame","sub_frame"],blocking:!0,extraHeaders:!0}),w.default.addHeadersReceivedListener(this.onHeadersReceivedRemoveFrameOptions,{types:["sub_frame"],blocking:!0,extraHeaders:!0}),w.default.addBeforeSendHeadersListener(Y,{blocking:!1,urls:x}),w.default.addBeforeRedirectListener(this.onBeforeRedirectMapToPendingTag,{types:["main_frame","sub_frame"],blocking:!1}),w.default.addCompleteListener(this.onCompletedCheckIfRequestWasTag,{types:["main_frame","sub_frame"],blocking:!1}),w.default.addErrorOccurredListener(this.onErrorOccurredCheckIfTagPending,{types:["main_frame","sub_frame"],blocking:!1}),setInterval(this.cleanup.bind(this),12e4)}return a(e,[{key:"setupTempBeforeRequestForIncompleteRedir",value:function(e){var t=this;w.default.addBeforeRequestListener(this.onBeforeRequestFromIncompleteRedirect,{types:["main_frame","sub_frame","other"],tabId:e,blocking:!1}),setTimeout((function(){w.default.removeBeforeRequestListener(t.onBeforeRequestFromIncompleteRedirect)}),4e3)}},{key:"setupTempWebhooksForUrl",value:function(e){var t=this,r=["main_frame","sub_frame","other"],n=[e];w.default.addBeforeRedirectListener(this.onBeforeRedirectFromIncompleteRedirect,{types:r,urls:n,blocking:!1}),w.default.addCompleteListener(this.onCompletedCheckIfCompletedRedirect,{types:r,urls:n,blocking:!1}),w.default.addErrorOccurredListener(this.onErrorOccurredCheckIfCompletedRedirect,{types:r,urls:n,blocking:!1}),setTimeout((function(){w.default.removeBeforeRedirectListener(t.onBeforeRedirectFromIncompleteRedirect),w.default.removeCompleteListener(t.onCompletedCheckIfCompletedRedirect),w.default.removeCompleteListener(t.onErrorOccurredCheckIfCompletedRedirect)}),4e3)}},{key:"onWebsiteAffiliateTag",value:function(e){var t,r,n=this,a=e.tabId,u=e.url,i=u.match(/\/store\/(.*)\/offer_claim/),s=u.match(/\/store\/(?<storeId>.*)\/website.*offer_id=(?<offerId>[^&\s]*)/),c=i&&i[1],d=s&&s.groups&&s.groups.storeId,l=s&&s.groups&&s.groups.offerId;d&&l&&y.default.getUserId().then((t=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h.default.activateProductOffer({offer:{offerId:l},userId:t,storeId:d},a),v.default.sendEvent("ext007003",{action_type:"click",product_offer:{offer_id:l},store:{id:d},sub_src:"auto_activate_web"});case 2:case"end":return e.stop()}}),e,n)})),r=function(){var e=t.apply(this,arguments);return new o.default((function(t,r){return function n(a,u){try{var i=e[a](u),s=i.value}catch(e){return void r(e)}if(!i.done)return o.default.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(s)}("next")}))},function(e){return r.apply(this,arguments)})),i&&!this.pendingTags[u]&&m.default.getStoreById(c).then((function(e){n.updateGoldStatus(e),b.default.showUI(a)}))}},{key:"onBeforeRequestFromIncompleteRedirect",value:function(e){var t=e.tabId,r=e.url,n=e.timeStamp,a=this.possiblyIncompleteRedirects[t];if(void 0!==a){var o=a.expires,u=a.statusCode,i=a.storePartialUrls,s=a.requestId,c=this.pendingRequests[s];if(void 0!==c)if(o>n/1e3){G(i,r)&&this.setupTempWebhooksForUrl(r)}else{var d=c.affUrl,l=c.storeId,f=c.lastTerminatingRedirect,p=c.ts,g=c.userAffiliateLinkId,h=Math.round(n-p),y=Q(t);delete this.possiblyIncompleteRedirects[t],delete this.pendingRequests[s],z({affUrl:d,finalUrl:f,statusCode:u,timeTakenMs:h,storeId:l,tagLocation:y,reason:"bad_redirect",requestId:s,userAffiliateLinkId:g})}}}},{key:"onBeforeRedirectFromIncompleteRedirect",value:function(e){var t=e.redirectUrl,r=e.statusCode,n=e.tabId,a=this.possiblyIncompleteRedirects[n];if(void 0!==a){var o=a.requestId,u=this.pendingRequests[o];if(void 0!==u){var i=u.storeId,s=u.redirects,c=u.userAffiliateLinkId;s.push(t),K({affUrl:s[0],redirectUrl:t,statusCode:r,storeId:i,requestId:o,userAffiliateLinkId:c})}}}},{key:"onErrorOccurredCheckIfCompletedRedirect",value:function(e){var t=e.error,r=e.tabId,n=e.timeStamp,a=e.url,o=this.possiblyIncompleteRedirects[r];if(void 0!==o){var u=o.requestId,i=this.pendingRequests[u];if(delete this.possiblyIncompleteRedirects[r],void 0!==i){var s=i.storeId,c=i.redirects,d=i.ts,l=i.userAffiliateLinkId,f=c[0];delete this.pendingRequests[u],z({affUrl:f,finalUrl:a,storeId:s,tagLocation:Q(r),timeTakenMs:Math.round(n-d),reason:t,requestId:u,userAffiliateLinkId:l})}}}},{key:"onCompletedCheckIfCompletedRedirect",value:function(e){var t=e.requestId,r=e.tabId,n=e.statusCode,a=e.timeStamp,o=e.url,u=this.possiblyIncompleteRedirects[r];if(void 0!==u){var i=u.requestId,s=[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(u.storePartialUrls)),c=this.pendingRequests[i];if(delete this.possiblyIncompleteRedirects[r],void 0!==c){var d=c.storeId,l=c.redirects,f=c.tagType,p=c.ts,g=c.userAffiliateLinkId,h=l[0],y=Math.round(a-p),v=Q(r);if(delete this.pendingRequests[t],n>=200&&n<302)G(s,o)?V({affUrl:h,finalUrl:o,storeId:d,tagType:f,timeTakenMs:y,requestId:i,userAffiliateLinkId:g}):z({affUrl:h,finalUrl:o,statusCode:n,storeId:d,tagLocation:v,timeTakenMs:y,reason:"bad_redirect",requestId:i,userAffiliateLinkId:g});else z({affUrl:h,finalUrl:o,statusCode:n,storeId:d,tagLocation:v,timeTakenMs:y,reason:"bad_request",requestId:i,userAffiliateLinkId:g})}}}},{key:"onBeforeRequestSetPendingInfo",value:function(e){var t=e.tabId,r=e.frameId,n=e.requestId,a=e.timeStamp,o=e.url,i=o.match(/^https?:\/\/(?:o|out)\.honey\.io\/store\/(\d+)\/([^/?]+).*[?&](?:turl=([^&#]*))?/);if(null!==i){var s=i[1],c=i[2];this.pendingRequests[n]={storeId:s,tabId:t,tagType:c,redirects:[],expires:(0,u.default)().add(3,"minutes").unix(),ts:a,url:decodeURIComponent(i[3]||"").trim(),outboundUrl:o},r>0&&(this.honeyFrameIds[r]={expires:(0,u.default)().add(1,"minute").unix()})}}},{key:"onBeforeSendHeadersModifyHeaders",value:function(e){var t=e.requestId,r=e.requestHeaders,n=this.pendingRequests[t];if(void 0!==n&&"website"!==n.tagType&&j){var a=n.url;j&&(Object.keys(M).length?M[n.storeId]&&(a=j+"/"+n.storeId+"/"+n.tagType):a=j+"/"+n.storeId+"/"+n.tagType);var o=!1,u=r.reduce((function(e,t){var r=d.default.cleanStringLower(t&&t.name);if("referer"===r){var n=Object.assign({},t);n.value=a,o=!0,e.push(n)}else"x-requested-with"!==r&&e.push(t);return e}),[]);return o||u.push({name:"Referer",value:a}),{requestHeaders:u}}return null}},{key:"onHeadersReceivedRemoveFrameOptions",value:function(e){var t=e.tabId,r=e.responseHeaders,n=e.frameId;if(t<0&&this.honeyFrameIds[n]){var a=r.filter((function(e){return"x-frame-options"!==d.default.cleanStringLower(e&&e.name)}));if(r.length!==a.length)return{responseHeaders:a}}}},{key:"onBeforeRedirectMapToPendingTag",value:function(e){var t=e.requestId,r=e.redirectUrl,n=e.statusCode,a=e.tabId,o=e.timeStamp,u=e.url,i=this.pendingRequests[t];if(void 0!==i){var s=i.storeId,c=i.redirects;0===c.length&&(i.userAffiliateLinkId=/[-=]a(\d{19})/g.exec(r)&&/[-=]a(\d{19})/g.exec(r)[1]),c.push(r),K({affUrl:c[0],requestId:t,redirectUrl:r,statusCode:n,storeId:s,userAffiliateLinkId:i.userAffiliateLinkId}),301===n&&this.onCompletedCheckIfRequestWasTag({requestId:t,statusCode:n,tabId:a,timeStamp:o,url:u})}}},{key:"onErrorOccurredCheckIfTagPending",value:function(e){var t=this,r=e.error,n=e.requestId,a=e.timeStamp,u=e.url,i=this.pendingRequests[n];if(void 0!==i){var c=i.storeId,d=i.redirects,l=i.tabId,p=i.ts,g=i.outboundUrl,h=i.userAffiliateLinkId,y=d[0];delete this.pendingRequests[n];var v=Q(l),m=Math.round(a-p);if(z({affUrl:y,finalUrl:u,requestId:n,storeId:c,tagLocation:v,timeTakenMs:m,reason:r,userAffiliateLinkId:h}),"tab"===v&&"net::ERR_BLOCKED_BY_CLIENT"!==r&&this.allowRetries){this.tagsFailed[g]||(this.tagsFailed[g]={retries:3});var w=this.tagsFailed[g];o.default.delay(2e3*(3-w.retries+1)).then((function(){return b.default.update(l,{url:g})})),w.retries-=1,w.retries<=0&&delete this.tagsFailed[g]}else if("tab"===v&&"net::ERR_BLOCKED_BY_CLIENT"===r){var I=new XMLHttpRequest,S={method:"get",url:u,xhr:function(){return I}};s.default.ajax(S).then((function(){try{if(!t.pendingIFrameTags[y]&&Object.keys(t.pendingIFrameTags).length<3){t.pendingIFrameTags[y]=!0;var e=(0,s.default)('<iframe sandbox="allow-forms allow-same-origin allow-scripts" src="'+I.responseURL+'" />').appendTo("body");setTimeout((function(){e.remove(),delete t.pendingIFrameTags[y]}),6e4)}}catch(e){f.default.debug("Failed to load iframe with blocked url: "+(e&&e.message),e)}}))}}}},{key:"onCompletedCheckIfRequestWasTag",value:function(e){var t=this,r=e.requestId,n=e.statusCode,a=e.tabId,o=e.timeStamp,i=e.url,s=this.pendingRequests[r];if(void 0!==s){var c=s.storeId,d=s.redirects,l=s.tagType,f=s.ts,p=s.userAffiliateLinkId,g=d[0],h=Math.round(o-f),y=a<0?"frame":"tab";n>=200&&n<302?m.default.getStoreById(c).then((function(e){var o=e.partialUrls;G(o,i)?(delete t.pendingRequests[r],V({affUrl:g,requestId:r,finalUrl:i,storeId:c,tagType:l,timeTakenMs:h,userAffiliateLinkId:p})):(s.lastTerminatingRedirect=i,void 0===t.possiblyIncompleteRedirects[a]&&(t.setupTempBeforeRequestForIncompleteRedir(a),t.possiblyIncompleteRedirects[a]={statusCode:n,requestId:r,storePartialUrls:o,expires:(0,u.default)().unix()+4}))})):(delete this.pendingRequests[r],z({affUrl:g,finalUrl:i,requestId:r,statusCode:n,storeId:c,tagLocation:y,timeTakenMs:h,reason:"bad_request",userAffiliateLinkId:p}))}}},{key:"updateGoldStatus",value:function(e){var t=this;return y.default.getUserId().then((function(r){var n=(0,u.default)().unix(),a=(0,i.default)(e),o={ttl:e.gold&&e.gold.activateTTL||10800,timestamp:n};return a.gold.activated=o,t.goldActivations[e.id+":"+r]=o,a}))}},{key:"activateStoreGold",value:function(e,t,r,a){var i=this;return g.default.getFeatureFlag("gold_activated_badge_animation",{ttl:288e5}).then((function(e){e&&c.default.animateGoldActivatedBadge(r)})),y.default.getUserId().then((function(n){var s=Object.assign({},t||{},{userId:n,src:(t.src||"")+"GoldActivation"}),c=e.gold,d=c.isFlatFee,l=c.max,f=c.maxFlatFee,p=c.min,g=c.minFlatFee,h={store:e,cashback_claim:{succeeded:!0},cashback_offer:{claimed:(0,u.default)().unix()}};return d?h.cashback_flat_fee_range={min:g,max:f}:h.cashback_percent_range={min:p,max:l},s.standUp&&(h.stand_up=!0),o.default.all([i.updateGoldStatus(e),i.tag(e.id,"offer_claim",a,s,r),v.default.sendEvent("ext008002",h).reflect()])})).then((function(e){return n(e,1)[0]}))}},{key:"deactivateStoreGold",value:function(e){var t=this;return y.default.getUserId().then((function(r){delete t.goldActivations[e+":"+r]}))}},{key:"getStoreGoldActivated",value:function(e,t){var r=this;return o.default.try((function(){return t||y.default.getUserId()})).then((function(t){var n=r.goldActivations[e+":"+t];return n&&n.timestamp+n.ttl>(0,u.default)().unix()?{ttl:n.ttl,timestamp:n.timestamp}:null}))}},{key:"tag",value:function(e,t,r,n,a){var i=this;if(["hbc","offer_claim","extension_links"].indexOf(t)<0)throw new InvalidParametersError("Invalid tag type: "+t);var s=r,c=Object.assign({},n);return o.default.props({store:m.default.getStoreById(e),userId:c.userId||y.default.getUserId(),exv:l.default.getExv()}).then((function(r){var n=r.store,g=r.userId,h=r.exv;if(c.expTag&&("ssd"!==l.default.getCurrentSsd(a)||"suspend"===n.standDownMethod||n.tagged))throw f.default.info("Invalid expTag for srcTabId: "+a),new OperationSkippedError;p.default.send("stores:tag",{store:n},{background:!0,allTabs:!0,ignoreResponse:!0}).reflect();try{m.default.setSessionAttribute(e,"tagged",!0);var y=(0,u.default)().unix();c.standUp&&m.default.setSessionAttribute(e,"standUpTs",y),m.default.setSessionAttribute(e,"taggedTs",y)}catch(e){}if(!(Object.keys(n.affiliate).length>0))throw new OperationSkippedError("Cannot tag: store does not have affiliate relationship");n.metadata.queryAppendParams&&function(e){o.default.try((function(){var t=C,r=e&&e.metadata&&e.metadata.queryAppendParams;Array.isArray(r)&&(t=t.concat(r));var n=e.partialUrls.map((function(e){return"*://*."+e+"/*"}));O=O.concat(n);var a=_.default.parse(e.url).hostname;P[a]={params:t,tabs:{},encode:e.metadata.encodeQueryParams,persist:e.metadata.persistAppendParams,expires:(0,u.default)().unix()+3600},b.default.getAll().then((function(t){t.forEach((function(t){!t.url||t.id<=0||m.default.getStoreByUrl(t.url).then((function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r.id===e.id&&(P[a].tabs[t.id]=!0)}))}))})),w.default.removeHeadersReceivedListener(F),w.default.addHeadersReceivedListener(F,{blocking:!0,types:["main_frame"],urls:O})})).catch((function(){}))}(n),n&&n.metadata&&(n.metadata.tagInSameTab&&(c.tagInSameTab=!0),n.metadata.tagInNewTab&&(c.openNewTab=!0,c.closeCurrent=!0,c.focusNewTabDelay=n.metadata.focusNewTabDelay));var v=t;(c.tagInSameTab||n.metadata.tagInNewTab)&&(v="extension_links",(n.metadata.queryAppendParams||n.metadata.removeQueryParams)&&(s=d.default.buildTargetUrl(s,n.metadata.queryAppendParams,n.metadata.removeQueryParams)));var I=encodeURIComponent(d.default.cleanString(s)),S="https://o.honey.io/store/"+n.id+"/"+v,E={exv:h,param0:c.expTag?"":"g"+g,turl:I,afsrc:"1",af0:n.sessionId,af8:c.src||"Unspecified",af9:"stores-affManager",src:"ext"},x=n.affiliateLink?n.affiliateLink:S+"?"+Object.keys(E).map((function(e){return e+"="+E[e]})).join("&");if(i.pendingTags[x]&&i.pendingTags[x].expires>(0,u.default)().unix())throw new OperationSkippedError;var R=void 0;return R=!c.forceHidden&&!c.tagInSameTab&&!(!n.metadata.pns_tagInTab&&!c.openNewTab),o.default.all([x,R,n])})).spread((function(r,n,o){var u=void 0;(o.metadata.redirectToOriginal||c.redirectToOriginal)&&(u=s),c.tagInSameTab&&a&&!c.forceHidden&&i.tagInSameTab(r,e,a,u,o.metadata.redirectDelay);var d=void 0;d=n?c.openNewTab?i.tagInNewTab(r,e,a,c.closeCurrent,c.focusNewTabDelay,u,o.metadata.redirectDelay):i.tagInTab(r,e,a,c.openNewTab):i.tagInTabAndFrame(r,e,a,c.tagInSameTab||c.forceHidden,o.metadata.disableFrameTag);var l=I.default.getState();return d.then((function(n){v.default.sendEvent("ext300002",{store:{id:e},aff_url:r,adblock_last_detected_at:l.resourceLastBlockedAt,adblock_whitelist_activated:!l.mayNeedWhitelist,type:t,method:n})})).catch((function(){}))})).catch(OperationSkippedError,(function(){}))}},{key:"tagInNewTab",value:function(e,t,r,n,a,i,s){var c=this;return this.allowRetries=!1,b.default.open({url:e,active:!0,delayedOpen:!i}).then((function(d){n&&setTimeout((function(){return b.default.close(r)}),a||1500),T[d]=!0,c.pendingTags[e]={storeId:t,tabId:d,expires:(0,u.default)().add(5,"seconds").unix(),ts:(0,u.default)().unix()};var l=(0,u.default)().add(2,"minutes");return i&&function t(r){return o.default.delay(r).then((function(){return b.default.get(d)})).then((function(r){var n=void 0;return!r||"complete"!==r.readyState&&"complete"!==r.status?l.isAfter()&&(n=t(1500)):n=o.default.delay(500).then((function(){delete c.pendingTags[e],b.default.load(i,d)})),n})).catch((function(){return!0})).reflect().finally((function(){delete c.pendingTags[e]}))}(parseInt(s,10)||3500),"tab"}))}},{key:"tagInTab",value:function(e,t,r,n){var a=this;return this.allowRetries=!0,b.default.open({url:e,active:!0===n,srcTabId:r}).then((function(r){T[r]=!0,a.pendingTags[e]={storeId:t,tabId:r,expires:(0,u.default)().add(5,"seconds").unix(),ts:(0,u.default)().unix()};var n=(0,u.default)().add(2,"minutes");return function t(u){return o.default.delay(u).then((function(){return b.default.get(r)})).then((function(u){var i=void 0;return!u||"complete"!==u.readyState&&"complete"!==u.status||a.tagsFailed[e]?n.isAfter()&&(i=t(2e3)):(a.allowRetries=!1,i=o.default.delay(5e3).then((function(){delete a.pendingTags[e],b.default.close(r)}))),i})).catch((function(){return!0})).reflect().finally((function(){delete a.pendingTags[e]}))}(5e3),"tab"}))}},{key:"tagInSameTab",value:function(e,t,r,n,a){var o=this;return this.allowRetries=!1,this.pendingTags[e]={storeId:t,tabId:r,expires:(0,u.default)().add(5,"seconds").unix(),ts:(0,u.default)().unix()},b.default.load(e,r).delay(d.default.parseInt(a,1e3)).then((function(){return n?b.default.load(n,r):"sameTab"})).finally((function(){return delete o.pendingTags[e]}))}},{key:"tagInTabAndFrame",value:function(e,t,r,n,a){var i=this;return o.default.try((function(){if(n||i.tagInTab(e,t,r),a)return"tab";var o=(0,s.default)('<iframe sandbox="allow-forms allow-same-origin allow-scripts" src="'+e+'" />').appendTo("body");return i.pendingTags[e]={storeId:t,expires:(0,u.default)().add(5,"seconds").unix(),ts:(0,u.default)().unix()},setTimeout((function(){delete i.pendingTags[e],o.remove(),console.clear()}),9e4),"frame"})).catch(OperationSkippedError,(function(){return null})).catch((function(){return v.default.sendEvent("ext000011",{store:{id:t},aff_url:e}).reflect(),null}))}},{key:"cleanup",value:function(){var e=this,t=(0,u.default)().unix();Object.keys(this.honeyFrameIds).forEach((function(r){e.honeyFrameIds[r]>t||delete e.honeyFrameIds[r]})),Object.keys(this.goldActivations).forEach((function(r){var n=e.goldActivations[r];n&&n.timestamp+n.ttl>t||delete e.goldActivations[r]}));var r=!1;Object.keys(P).forEach((function(e){r=!0,P[e].expires>t||delete P[e]})),Object.keys(this.pendingRequests).forEach((function(r){var n=e.pendingRequests[r];if(n.expires<t){var a=n.redirects,o=n.storeId,i=n.tabId,s=n.ts,c=a[0],d=a.pop();delete e.pendingRequests[r],function(e){var t=e.affUrl,r=e.lastRedirectUrl,n=e.requestId,a=e.timeTakenMs,o=e.storeId,u={affUrl:t,lastRedirectUrl:r,requestId:n,tagLocation:e.tagLocation,timeTakenMs:a,store:{id:o},userAffiliateLinkId:e.userAffiliateLinkId};v.default.sendEvent("ext300013",u).reflect()}({affUrl:c,lastRedirectUrl:d,requestId:r,storeId:o,tagLocation:Q(i),timeTakenMs:Math.round((0,u.default)().valueOf()-s)})}})),Object.entries(this.possiblyIncompleteRedirects).forEach((function(r){var a=n(r,2),o=a[0];a[1].expires<t&&delete e.possiblyIncompleteRedirects[o]})),0===Object.keys(P).length&&r&&w.default.removeHeadersReceivedListener(F);Object.entries(k).forEach((function(e){var t=n(e,2),r=t[0],a=t[1];a&&a.time<Date.now()-108e5&&delete k[r]})),W<Date.now()&&(q={},H=[],W=null)}}]),e}();$.shouldTagInTab=J;var X=new $;t.default=X,window.affManager=X},584:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o,u,i,s,c,d,l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},f=(n=C(regeneratorRuntime.mark((function e(t){var r,n,a=t.storeId,o=t.parentId,u=t.priceCurrent;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=I.default,e.t1={storeId:a,parentId:o,priceCurrent:u},e.t2=l,e.t3={},e.next=6,L();case 6:return e.t4=e.sent,e.t5=(0,e.t2)(e.t3,e.t4),e.t6={headers:e.t5},e.next=11,e.t0.mutate.call(e.t0,"ext_getProductOffer",e.t1,e.t6);case 11:if(r=e.sent,n=r.data){e.next=15;break}return e.abrupt("return",null);case 15:return e.abrupt("return",n.getOrCreateProductOffer);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)}),p=(a=C(regeneratorRuntime.mark((function e(t){var r,n,a=t.userId,o=t.storeId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=I.default,e.t1={userId:a,storeId:o,isActive:!0},e.t2=l,e.t3={},e.next=6,L();case 6:return e.t4=e.sent,e.t5=(0,e.t2)(e.t3,e.t4),e.t6={headers:e.t5},e.next=11,e.t0.query.call(e.t0,"offers_getProductOfferActivations",e.t1,e.t6);case 11:if(r=e.sent,n=r.data){e.next=15;break}return e.abrupt("return",[]);case 15:return e.abrupt("return",n.getProductOfferActivations||[]);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)}),g=(o=C(regeneratorRuntime.mark((function e(t){var r=t.userId,n=t.storeId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p({userId:r,storeId:n});case 2:e.sent.forEach(N);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)}),h=(u=C(regeneratorRuntime.mark((function e(t,r){var n,a,o,u=t.userId,i=t.offer,s=i.offerId,c=i.endDate,d=t.storeId,f=t.exemptionCode,p=void 0===f?void 0:f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=I.default,e.t1={userId:u,offerId:s,exemptionCode:p},e.t2=l,e.t3={},e.next=6,L();case 6:return e.t4=e.sent,e.t5=(0,e.t2)(e.t3,e.t4),e.t6={headers:e.t5},e.next=11,e.t0.mutate.call(e.t0,"offers_activateProductOffer",e.t1,e.t6);case 11:if(n=e.sent,a=n&&n.errors,o=a&&a.some((function(e){return e.message.includes("ALREADY_EXISTS")})),!a||o){e.next=16;break}throw new InvalidResponseError("Error in Offers response: "+JSON.stringify(a));case 16:if(!o){e.next=21;break}return e.next=19,g({userId:u,storeId:d});case 19:e.next=23;break;case 21:return e.next=23,N({userId:u,offerId:s,endDate:c});case 23:return e.next=25,P.default.getStoreById(d);case 25:if(!e.sent.gold){e.next=35;break}return e.prev=27,e.next=30,P.default.activateStoreGold(d,{src:"productOffer"},r);case 30:e.next=35;break;case 32:e.prev=32,e.t7=e.catch(27),S.default.error("Failed to activate gold",{message:e.t7.message});case 35:case"end":return e.stop()}}),e,this,[[27,32]])}))),function(e,t){return u.apply(this,arguments)}),y=(i=C(regeneratorRuntime.mark((function e(t){var r,n=t.offerId,a=t.userId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,e.prev=1,e.next=4,w.default.get("offers:"+a+":"+n+":activated");case 4:r=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),r=null;case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return i.apply(this,arguments)}),v=(s=C(regeneratorRuntime.mark((function e(t){var r,n,a=t.userId,o=t.storeId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=I.default,e.t1={userId:a,storeId:o},e.t2=l,e.t3={},e.next=6,L();case 6:return e.t4=e.sent,e.t5=(0,e.t2)(e.t3,e.t4),e.t6={headers:e.t5},e.next=11,e.t0.query.call(e.t0,"ext_getProductOfferActivationsForList",e.t1,e.t6);case 11:if(r=e.sent,n=r.data){e.next=15;break}return e.abrupt("return",[]);case 15:return e.abrupt("return",n.getProductOfferActivations||[]);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)}),m=(c=C(regeneratorRuntime.mark((function e(t){var r,n,a=t.storeId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=I.default,e.t1={collectionId:E.default.OFFER_COLLECTION_PREFIX+"_"+a},e.t2=l,e.t3={},e.next=6,L();case 6:return e.t4=e.sent,e.t5=(0,e.t2)(e.t3,e.t4),e.t6={headers:e.t5},e.next=11,e.t0.query.call(e.t0,"ext_getStoreProductOffers",e.t1,e.t6);case 11:if(r=e.sent,n=r.data){e.next=15;break}return e.abrupt("return",[]);case 15:return e.abrupt("return",n.getCollectionObjects||[]);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)}),b=(d=C(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=I.default,e.t1={},e.t2=l,e.t3={},e.next=6,L();case 6:return e.t4=e.sent,e.t5=(0,e.t2)(e.t3,e.t4),e.t6={headers:e.t5},e.next=11,e.t0.query.call(e.t0,"ext_getUserEligibilityForOffers",e.t1,e.t6);case 11:if(t=e.sent,r=t.data){e.next=15;break}return e.abrupt("return",!1);case 15:return e.abrupt("return",r.getUserEligibilityForOffers||!1);case 16:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)}),w=O(r(47)),I=O(r(8)),S=O(r(3)),_=O(r(4)),E=O(r(282)),x=O(r(153)),R=O(r(55)),P=O(r(39));function O(e){return e&&e.__esModule?e:{default:e}}function T(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function C(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var A,k=E.default.HEADER_NAMES,L=(A=C(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.default.getDeviceId();case 2:return r=e.sent,e.next=5,R.default.getSessionId();case 5:return n=e.sent,e.abrupt("return",(T(t={},k.HEADER_DEVICE_ID,r),T(t,k.HEADER_SESSION_ID,n),t));case 7:case"end":return e.stop()}}),e,void 0)}))),function(){return A.apply(this,arguments)});function N(e){var t=e.offerId,r=e.endDate,n=e.userId,a=r-Date.now();w.default.set("offers:"+n+":"+t+":activated",!0,a),_.default.send("offers:action",{action:"offerActivated",success:{userId:n,offerId:t}},{allTabs:!0,ignoreResponse:!0})}function D(e){e.forEach((function(e){var t=e.userId,r=e.offerId;w.default.del("offers:"+t+":"+r+":activated")}))}_.default.addListener("offers:action",(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};switch(t.action){case"getEligibility":return b();case"fetchProductOffer":return f(t.data);case"getProductOfferActivations":return p(t.data);case"getProductOfferActivationsWithProductDetails":return v(t.data);case"activateProductOffer":return h(t.data,r.tabId);case"getProductOfferActivationById":return y(t.data);case"getStoreOffers":return m(t.data);case"removeOfferActivations":return D(t.data);default:return null}})),t.default={activateProductOffer:h}},585:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=y(r(5)),o=y(r(0)),u=y(r(15)),i=y(r(281)),s=y(r(3)),c=y(r(4)),d=y(r(20)),l=y(r(39)),f=y(r(94)),p=y(r(21)),g=y(r(83)),h=y(r(55));function y(e){return e&&e.__esModule?e:{default:e}}function v(e,t){return new a.default((function(r){p.default.getUserId().then((function(n){l.default.getClaimedOffers(n,[e]).then((function(n){n.length<=0&&r(!1),f.default.getAll().then((function(n){a.default.filter(n,(function(r){return!(!r||!r.url||r.id===t)&&l.default.getStoreByUrl(r.url).then((function(t){return t&&t.id===e})).catch((function(){return!1}))})).then((function(e){r(!!e.length)}))}))}))})).catch((function(){return r(!1)}))}))}var m=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.standDownTypes={base:1,stdn:2,nopopup:3,suspend:4},this.standownBlacklistRegexes=[/^https?:\/\/(?:o)\.honey\.io\//i,/^https?:\/\/(?:o|out)\.joinhoney\.com\//i,/^https?:\/\/(?:www\.)?google\.com\//i,/^https?:\/\/(?:www\.)?yahoo\.com\//i,/^https?:\/\/(?:www\.)?bing\.com\//i,/^https?:\/\/(?:www\.)?ask\.com\//i,/^https?:\/\/(?:www\.)?duckduckgo\.com\//i,/^https?:\/\/(?:www\.)?baidu\.com\//i],this.standDownRules={},this.standDownStatus={},this.pendingRequests={},this.currentRequestIds={},this.originalTabUrls={},g.default.addHeadersReceivedListener(this.checkRequestForStanddown.bind(this),{blocking:!1,types:["main_frame"]}),c.default.addListener("page:load",(function(e,r,n){(r.hasServiceWorkers||r.url.includes("ebay"))&&t.checkRequestForStanddown({tabId:n.tabId,url:r.url,statusCode:200})})),g.default.addBeforeRequestListener(this.onBeforeRequestNonBlocking.bind(this),{blocking:!0,types:["main_frame"]}),this.checkForRulesUpdates(),setInterval(this.cleanup.bind(this),12e5),setInterval(this.checkForRulesUpdates.bind(this),12e5)}return n(e,[{key:"getStoreTabStandDownStatus",value:function(e,t){if(!(e&&t>=0))return!1;var r=this.standDownStatus[e+":"+t];return!!(r&&r.expires>(0,o.default)().unix())&&r.status}},{key:"getStoreTabStandDownValue",value:function(e,t){return this.standDownTypes[this.getStoreTabStandDownStatus(e,t)]}},{key:"setStoreTabStandDownStatus",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.default.duration(1,"hour").asSeconds();if(!(parseInt(e,10)>0))throw new InvalidParametersError("Invalid store identifier");if(!(parseInt(t,10)>0))throw new InvalidParametersError("Invalid tab identifier");if(!(n>0))throw new InvalidParametersError("Invalid TTL");if(!1!==r&&!this.standDownTypes[r])throw new InvalidParametersError("Invalid stand down status: "+r);r?(this.standDownStatus[e+":"+t]={status:r,expires:(0,o.default)().add(n,"seconds").unix()},l.default.setSessionAttribute(e,"tagged",!1),l.default.setSessionAttribute(e,"standDownTs",(0,o.default)().unix()),l.default.setSessionAttribute(e,"standDownMethod",r),l.default.setSessionAttribute(e,"standDownValue",this.standDownTypes[r]),l.default.setSessionAttribute(e,"hasStoodUp",!1),"suspend"===r&&(i.default.setButtonInactive(t),setTimeout((function(){i.default.setButtonInactive(t)}),500))):(l.default.setSessionAttribute(e,"tagged",!0),l.default.setSessionAttribute(e,"standDownTs",null),l.default.setSessionAttribute(e,"standDownMethod",!1),l.default.setSessionAttribute(e,"standDownValue",null),l.default.setSessionAttribute(e,"hasStoodUp",!0),delete this.standDownStatus[e+":"+t])}},{key:"checkForRulesUpdates",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=(0,o.default)().unix();return!t&&this.standDownRules.expires>r?a.default.resolve():(this.checkingForRulesUpdates||(this.checkingForRulesUpdates=u.default.get("https://cdn.honey.io/standdown-rules.json").then((function(t){var r=t.body;if(!r||!r.rules)throw new InvalidDataError("stand down rule set");var n=Math.max(o.default.duration(30,"minutes").asSeconds(),Math.min(o.default.duration(6,"hours").asSeconds(),parseInt(r.ttl,10)))||o.default.duration(30,"minutes").asSeconds(),a={rules:[],expires:(0,o.default)().add(n,"seconds").unix()};Object.keys(e.standDownTypes).forEach((function(e){(r.rules[e]||[]).forEach((function(t){if(!t||"string"!=typeof t.regex)throw new InvalidDataError("stand down rule regex");var r=t.regex.trim();if(!r)throw new InvalidDataError("stand down rule regex");a.rules.push({type:e,provider:t.provider||null,regex:new RegExp(r,"i"),overrideBlacklist:t.overrideBl||!1,ttl:Math.max(1,Math.min(o.default.duration(1,"day").asSeconds(),parseInt(t.ttl,10)))||null})}))})),e.standDownRules=a})).catch((function(t){e.standDownRules.rules=e.standDownRules.rules||[],e.standDownRules.expires=(0,o.default)().add(5,"minutes").unix(),s.default.debug(t)})).finally((function(){delete e.checkingForRulesUpdates}))),this.checkingForRulesUpdates)}},{key:"onBeforeRequestNonBlocking",value:function(e){var t=this,r=e.requestId,n=e.tabId;f.default.get(n).then((function(e){t.originalTabUrls[r]=e.url})).catch((function(){}))}},{key:"checkRequestForStanddown",value:function(e){var t=this,r=e.tabId,n=e.statusCode,a=e.url,u=e.requestId;if(r>=0&&n>0&&this.standDownRules.rules&&this.standDownRules.rules.length>0){var i=(0,o.default)().unix(),s=this.pendingRequests[r];if(n>=300&&n<=399&&!this.currentRequestIds[u]&&(this.currentRequestIds[u]=a),n>=300&&n<=399&&this.standownBlacklistRegexes.some((function(e){return e.test(a)})))s&&s.expires>=i||(s={},this.pendingRequests[r]=s),s.isHoney=!0,s.expires=i+15;else if((!s||!(s.expires>=i&&s.isHoney)||s.url!==a)&&(this.standDownRules.rules.forEach((function(e){a.match(e.regex)&&(s&&s.expires>=i||(s={},t.pendingRequests[r]=s),s.rulesFound||(s.rulesFound=[]),s.rulesFound.push(e),t.standDownTypes[s.standDownType]>t.standDownTypes[e.type]||(s.rule=e.regex.toString(),s.standDownType=e.type,s.standDownTtl=e.ttl,s.provider=e.provider,s.overrideBlacklist=e.overrideBlacklist,s.expires=i+15,s.url=a,s.originalRedirect=t.currentRequestIds[u]))})),n<300||n>399)){s=this.pendingRequests[r];var c=this.originalTabUrls[u];delete this.originalTabUrls[u],delete this.currentRequestIds[u],s&&s.standDownType&&(!s.isHoney||s.overrideBlacklist)&&s.expires>=(0,o.default)().unix()&&l.default.getStoreByUrl(a).then((function(e){if(!Object.keys(e.affiliate).length)return e;var n=e.affiliate[Object.keys(e.affiliate)[0]],o=Array.isArray(n)&&Array.isArray(n[0].providers)&&n[0].providers[0];if(s.provider&&o!==s.provider){var u=s.rulesFound.filter((function(e){return!e.provider||o===e.provider})).sort((function(e,r){return t.standDownTypes[e.type]<t.standDownTypes[r.type]}));if(!u.length)return e;var i=u[0];s=Object.assign(s,{standDownType:i.type,standDownTtl:i.ttl,rule:i.regex.toString(),provider:i.provider})}var l=t.getStoreTabStandDownStatus(e.id,r);return t.standDownTypes[l]>t.standDownTypes[s.standDownType]?e:h.default.determineSsdState(s.provider,e.id,r).catch().then((function(n){return d.default.sendEvent("ext200203",{state:n,store:e}).reflect(),"ssd"!==n||/ebay/.test(a)?(t.setStoreTabStandDownStatus(e.id,r,s.standDownType,s.standDownTtl),s.standDownType&&v(e.id,r).then((function(t){d.default.sendEvent("ext300004",{method:s.standDownType,store:{id:e.id},honey_tab_open:t,tagged:e.tagged,rule:s.rule,referral_url:s.url,tab_url:c,provider:s.provider,original_redirect:s.originalRedirect})})),e):e}))})).finally((function(e){delete t.pendingRequests[r],(n<200||n>399)&&d.default.sendEvent("ext300404",{url:a,status_code:n,store:{id:e?e.id:void 0}})})).reflect()}}}},{key:"cleanup",value:function(){var e=this,t=(0,o.default)().unix();Object.keys(this.standDownStatus).forEach((function(r){var n=e.standDownStatus[r];n&&n.expires>t||delete e.standDownStatus[r]})),Object.keys(this.pendingRequests).forEach((function(r){var n=e.pendingRequests[r];n&&n.expires>t||delete e.pendingRequests[r]}))}}]),e}();m.isStoreActiveInOtherTabs=v;var b=new m;t.default=b},586:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.countSessions=void 0;var n,a,o=(n=regeneratorRuntime.mark((function e(t){var r,n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Date,e.next=3,c.get("user:storeSessions:"+t);case 3:(n=e.sent)?(a=JSON.parse(n),o=a[a.length-1],(0,i.default)(r).isAfter((0,i.default)(o).add(3,"hours"))&&a.push(r),c.set("user:storeSessions:"+t,JSON.stringify(a))):c.set("user:storeSessions:"+t,JSON.stringify([r]));case 5:case"end":return e.stop()}}),e,this)})),a=function(){var e=n.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return a.apply(this,arguments)}),u=s(r(35)),i=s(r(0));function s(e){return e&&e.__esModule?e:{default:e}}var c=(0,u.default)({max:30,maxAge:6048e5});setInterval((function(){return c.prune()}),36e5),t.default=c,t.countSessions=o},587:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=h(r(5)),a=h(r(0)),o=h(r(278)),u=h(r(15)),i=h(r(3)),s=h(r(20)),c=h(r(154)),d=h(r(55)),l=h(r(94)),f=h(r(21)),p=h(r(283)),g=h(r(153));function h(e){return e&&e.__esModule?e:{default:e}}var y=a.default.duration(5,"seconds").asMilliseconds(),v=a.default.duration(30,"minutes").asMilliseconds(),m={};try{m={"device:firstTime":window.localStorage.getItem("device:firstTime"),"device:firstTimeFS":window.localStorage.getItem("device:firstTimeFS"),"device:firstTimeHG":window.localStorage.getItem("device:firstTimeHG"),"device:firstTimeFSHG":window.localStorage.getItem("device:firstTimeFSHG"),"device:firstTimeLaunchpad":window.localStorage.getItem("device:firstTimeLaunchpad")}}catch(e){}var b=void 0;function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y;return!b&&e&&e.expires>(0,a.default)().unix()?(b=!0,u.default.post("https://d.joinhoney.com/extusers/install").send({exv:e.exv,synced:e.isSynced,webstore:e.webstore,existing_user:e.existingUser,existing_device:e.existingDevice}).then((function(){try{window.localStorage.removeItem("device:pendingInstallReport")}catch(e){}})).catch((function(){window.localStorage.setItem("device:pendingInstallReport",e),setTimeout(w,t,e,Math.min(v,2*t))})).catch((function(e){return i.default.error("Failed to send install report",e)})).finally((function(){b=!1})),null):null}try{var I=window.localStorage.getItem("device:pendingInstallReport");I&&w(I)}catch(e){i.default.error("Failed to check for pending install report",e)}var S=void 0;function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y;return!S&&e&&e.expires>(0,a.default)().unix()?(S=!0,n.default.try((function(){return s.default.sendEvent("ext000102",{previous_version:e.previousVersion})})).then((function(){try{window.localStorage.removeItem("device:pendingUpdateReport")}catch(e){}})).catch((function(){window.localStorage.setItem("device:pendingUpdateReport",e),setTimeout(_,t,e,Math.min(v,2*t))})).catch((function(e){return i.default.error("Failed to send update report",e)})).finally((function(){S=!1})),null):null}try{var E=window.localStorage.getItem("device:pendingUpdateReport");E&&_(E)}catch(e){i.default.error("Failed to check for pending update report",e)}try{o.default.setUninstallURL("https://www.joinhoney.com/uninstall")}catch(e){i.default.error("Failed to set uninstall URL",e)}o.default.addOnInstallListener((function(e){var t=e.reason,r=e.previousVersion,o=e.userId,u=e.safariAppExtensionUpgrade,s=void 0!==u&&u,h=e.firefoxInstall,y=void 0!==h&&h,v=e.firefoxFirstUpdate,b=void 0!==v&&v;if("install"===t){m={"device:firstTime":"true","device:firstTimeFS":"true","device:firstTimeHG":"true","device:firstTimeFSHG":"true","device:firstTimeLaunchpad":"true"};try{window.localStorage.setItem("device:firstTime",!0),window.localStorage.setItem("device:firstTimeFS",!0),window.localStorage.setItem("device:firstTimeHG",!0),window.localStorage.setItem("device:firstTimeFSHG",!0),window.localStorage.setItem("device:firstTimeLaunchpad",!0)}catch(e){}return n.default.props({exv:g.default.getExv(),isRepeat:void c.default.local.get("device:repeatInstall").catch((function(){return!1})).then((function(e){return n.default.try((function(){return c.default.local.set("device:repeatInstall",!0)})).reflect(),e})),expires:(0,a.default)().add(2,"days").unix(),existingDevice:g.default.isExistingDevice(),existingUser:f.default.isExistingUser(),webstore:l.default.checkForWebstore()}).then((function(e){var t=e.exv,r=e.isRepeat,a=e.expires,o=e.existingDevice,u=e.existingUser,i=e.webstore;return n.default.props({deviceId:g.default.getDeviceId(),primaryDeviceId:c.default.sync.get("device:primaryDeviceId").catch((function(){return null}))}).then((function(e){var t=e.deviceId,r=e.primaryDeviceId;return r?r!==t:(c.default.sync.set("device:primaryDeviceId",t).reflect(),!1)})).then((function(e){return e||r||(y?l.default.open({url:"https://www.joinhoney.com/welcome?onInstall=true"}):l.default.open({url:"https://www.joinhoney.com/welcome"})),d.default.updateSetting("installedAt",Date.now()),w({exv:t,expires:a,isRepeat:r,isSynced:e,webstore:i,existingDevice:o,existingUser:u})}))})).catch((function(e){return i.default.error("Failed to build install report",e)}))}return"update"===t?(o&&p.default.persistUserId(o),s&&l.default.open({url:"https://www.joinhoney.com/welcome"}),b&&l.default.open({url:"https://www.joinhoney.com/explore?onUpdate=true",active:!1}),_({previousVersion:r,expires:(0,a.default)().add(2,"days").unix()})):null})),t.default={get:function(e){return m[e]},del:function(e){try{delete m[e],window.localStorage.removeItem(e)}catch(e){}}}},588:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u=(n=f(regeneratorRuntime.mark((function e(t){var r,n,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.forceRefresh){e.next=5;break}if(!(r=c.default.getCacheItem("user:settings"))){e.next=5;break}return e.abrupt("return",r);case 5:return e.next=7,s.default.query("ext_getUserSettings",{});case 7:if(n=e.sent,a=n.errors,o=n.data,!a&&o&&o.getUserById){e.next=12;break}return e.abrupt("return",{});case 12:return u=o.getUserById,c.default.setCacheItem("user:settings",u,{ttl:86400}),e.abrupt("return",Object.assign({},u));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)}),i=(a=f(regeneratorRuntime.mark((function e(t,r,n){var a,i,d,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.default.mutate("users_updateUserInfo",{info:l({},t,r)});case 2:return a=e.sent,i=a.errors,e.next=6,u(n);case 6:if(d=e.sent,!i){e.next=9;break}throw new InvalidResponseError('Failed to update setting "'+t+'" to "'+r+'": '+JSON.stringify(i));case 9:return f=o({},d,l({},t,r)),c.default.setCacheItem("user:settings",f,{ttl:86400}),e.abrupt("return",f);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return a.apply(this,arguments)}),s=d(r(8)),c=d(r(195));function d(e){return e&&e.__esModule?e:{default:e}}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}t.default={getSettings:u,getSetting:function(e,t){return u(t).then((function(t){return t[e]}))},updateSetting:i}},589:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(194)),a=c(r(0)),o=c(r(15)),u=c(r(4)),i=c(r(21)),s=c(r(19));function c(e){return e&&e.__esModule?e:{default:e}}function d(e){var t=e&&e.forceRefresh;return Promise.try((function(){if(!t){var e=i.default.getCacheItem("exclusives:list");if(e)return e}return i.default.getFullOffers().then((function(e){return e.filter((function(e){var t=e.used,r=e.created+a.default.duration(24,"hours").asMilliseconds();return!t&&r>Date.now()})).map((function(e){var t=e.storeId,r=e.offerId,n=e.campaignId,o=e.used,u=e.value,i=e.minimumOrderValue,c=e.type,d=e.created,l=e.storeName,f=function(e){var t=e/100;return s.default.formatPrice(t).replace(".00","")}(u),p=Math.floor(d/1e3);return{id:r,exclusiveId:r,campaignId:n,value:f,storeId:t,storeName:l,status:o?"USED":"ACTIVATED",campaignType:c,campaignMinOrderValue:i,created:p,nextExpiration:p+a.default.duration(24,"hours").asSeconds()}}))})).then((function(e){return i.default.setCacheItem("exclusives:list",e,{ttl:60}),(0,n.default)(e)})).catch((function(){return[]}))}))}function l(e,t){return d(t).then((function(t){return t.find((function(t){return t.storeId===e}))||null}))}function f(e,t){return o.default.post("https://d.joinhoney.com/gift/"+t).send({storeId:e}).then((function(e){return e.body})).catch((function(){return null}))}function p(e){var t=e.exclusiveId,r=e.campaignId;return o.default.post("https://d.joinhoney.com/campaign/reward").send({data:{exclusiveId:t,campaignId:r}}).then((function(e){return e.body})).catch((function(){return null}))}function g(e){return o.default.post("https://d.joinhoney.com/gift/"+e).then((function(e){return e.body})).catch((function(){return null}))}function h(e){return e&&e.id&&!e.standDown&&(void 0===e.haveOffer||e.haveOffer)?i.default.getInfo().then((function(t){if(!t||!t.isLoggedIn)return null;var r=i.default.getCacheItem("exclusives:directPendingExclusive:"+e.id);return void 0!==r?(0,n.default)(r):o.default.get("https://d.joinhoney.com/campaign/direct-offer/"+e.id).then((function(e){return e.body})).catch((function(){return null})).then((function(t){var r=t&&t.directPendingExclusive||null,o=(0,a.default)().add(24,"hours").unix();r&&r.exclusivesNextExpiration>0&&(o=Math.min(o,r.exclusivesNextExpiration));var u=o-(0,a.default)().unix();return i.default.setCacheItem("exclusives:directPendingExclusive:"+e.id,r,{ttl:u}),(0,n.default)(r)}))})):null}function y(){return i.default.getInfo().then((function(e){if(!e||!e.isLoggedIn)return!1;var t=i.default.getCacheItem("campaign:campaignEligibility:starbucksgroupon11012017");return void 0!==t?(0,n.default)(t):o.default.get("https://d.joinhoney.com/v2/userfeed/announcements?type=Starbucks-Groupon-November-2017").buffer(!1).catch((function(){return!1})).then((function(e){var t=void 0;try{t=JSON.parse(e.text)}catch(e){return!1}var r=(0,a.default)().add(60,"minutes").unix()-(0,a.default)().unix();return i.default.setCacheItem("campaign:campaignEligibility:starbucksgroupon11012017",t,{ttl:r}),(0,n.default)(t)}))}))}u.default.addListener("exclusives:action",(function(e,t){var r=t&&t.data||{};switch(t&&t.action){case"claimOffer":return g(r.exclusiveId);case"getExclusives":return d(r.options);case"getExclusiveForStore":return l(r.storeId,r.options);case"rewardExclusive":return f(r.storeId);case"engageExclusive":return p(r.exclusive);case"getDirectPendingExclusive":return h(r.store);case"getCampaignEligibility":return y();default:throw new InvalidParametersError("action")}})),t.default={claimOffer:g,getExclusives:d,getExclusiveForStore:l,rewardExclusive:f,engageExclusive:p,getDirectPendingExclusive:h,getCampaignEligibility:y}},602:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o,u,i=(n=b(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.default.query("ext_getDebugUIExperiments",{});case 2:return t=e.sent,r=t.data,e.abrupt("return",r.getExperiments);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),s=(a=b(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.default.getInfo();case 2:return r=e.sent,e.abrupt("return",w.getVariant(t,r.id));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)}),c=(o=b(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.default.getInfo();case 2:return r=e.sent,e.abrupt("return",w.trackImpression(t,r.id));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)}),d=(u=b(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.default.getInfo();case 2:return r=e.sent,e.abrupt("return",w.getIsInExperimentPopulation(t,r.id));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)}),l=m(r(1148)),f=m(r(0)),p=m(r(3)),g=m(r(4)),h=m(r(21)),y=m(r(20)),v=m(r(8));function m(e){return e&&e.__esModule?e:{default:e}}function b(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var w=new l.default({client:v.default,sendEvent:y.default.sendEvent,logger:p.default});function I(e){var t=e.countryCode,r=e.created,n=(0,f.default)().diff(1e3*r,"days");w.loadExperiments({platform:"ext",browser:"ff",country:t,extensionVersion:"12.8.4",accountAge:n})}function S(){return w.overrides}function _(e){w.setOverrides(e),localStorage.experimentOverrides=JSON.stringify(e)}h.default.getInfo().then(I),g.default.addListener("user:current:update",(function(e,t){I(t.user)})),g.default.addListener("experiments:bg",(function(e,t){switch(t.action){case"getDebugUIExperiments":return i(t.data);case"getVariant":return s(t.data.name);case"trackImpression":return c(t.data.name);case"setOverrides":return _(t.data);case"getOverrides":return S();case"getIsInExperimentPopulation":return d(t.data.name);default:throw new InvalidParametersError("action")}})),t.default={getVariant:s,setOverrides:_,getOverrides:S}},607:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(196)),a=s(r(19)),o=s(r(3)),u=s(r(8)),i=s(r(95));function s(e){return e&&e.__esModule?e:{default:e}}var c,d;t.default=(c=regeneratorRuntime.mark((function e(t){var r,s,c,d,l,f,p,g,h,y,v,m,b,w,I;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.droplistItems,s=void 0===r?[]:r,c=t.syncedFrom,d=t.isUpdatingVariants,l=t.source,f=void 0===l?"MANUAL":l,p=t.src,g=void 0===p?"extension":p,h=s.map((function(e){var t=e.productId,r=e.variantId||e.merchId;return t||(t=e.storeId+"_"+(0,n.default)(e.merchId)+"_"+(0,n.default)(r)),{productId:t,variantId:r,parentId:e.merchId||e.parentId,priceToNotify:parseInt(a.default.cleanPrice(e.notifyAtPrice).toFixed(2),10),priceWhenDroplisted:parseInt(a.default.cleanPrice(e.originalPrice).toFixed(2),10),watchLength:e.watchLength,tags:e.tags||[],title:e.title,source:f}})),e.prev=2,e.next=5,u.default.mutate("ext_addToDroplist",{meta:h});case 5:return y=e.sent,v=y.data,m=y.errors,b=(v||{}).addToDroplist||[],m&&o.default.warn("GraphQL error(s) from ext_addToDroplist",{params:t,errors:m}),w=s[0].watchLength,b.forEach((function(e){var t=e.productId,r=e.notifyAtPrice,n=e.originalPrice,o=e.product||{},u=o.imageUrlPrimary,s=o.title,l=o.parentId,f=o.priceCurrent,p=o.store,h=(p=void 0===p?{}:p).storeId,y=o.variantId,v=parseFloat((r/100).toFixed(2)),m=parseFloat((n/100).toFixed(2)),b=parseFloat((f/100).toFixed(2))||m;i.default.sendEventWithGroup("droplist002",{dropListProduct:{productId:t,imageUrl:u,currentPrice:b,originalPrice:m,title:s,merchId:l,variantId:y},subSrc:g||"",store:{id:h},syncedFrom:c,isUpdatingVariants:d});var I=parseFloat((.95*b).toFixed(2));v!==I&&i.default.sendEventWithGroup("droplist500",{productId:t,store:{id:h},merchId:l,variantId:y,currentPrice:b,originalPrice:m,notifyAtPrice:v,oldNotifyPriceAt:a.default.cleanPrice(I)}),60!==w&&i.default.sendEventWithGroup("droplist501",{productId:t,store:{id:h},merchId:l,variantId:y,watchForLength:w,oldWatchForLength:60})})),I=b.map((function(e){return i.default.formatDroplist(e)})),e.abrupt("return",I);case 16:throw e.prev=16,e.t0=e.catch(2),s.forEach((function(e){var t=e.imageUrl,r=e.merchId,a=e.variantId,o=e.title,u=e.originalPrice,s=e.storeId,l=e.productId;l||(l=s+"_"+(0,n.default)(r)+"_"+(0,n.default)(a)),i.default.sendEventWithGroup("droplist006",{dropListProduct:{currentPrice:u,imageUrl:t,merchId:r,productId:l,title:o,variantId:a},subSrc:g||"",store:{id:s},syncedFrom:c,isUpdatingVariants:d})})),e.t0;case 20:case"end":return e.stop()}}),e,this,[[2,16]])})),d=function(){var e=c.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return d.apply(this,arguments)})},608:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.productIdToInfoMap={}}return n(e,[{key:"getAllProducts",value:function(){return Object.values(this.productIdToInfoMap)}},{key:"getProductInfoById",value:function(e){return this.productIdToInfoMap[e]}},{key:"updateCacheWithProducts",value:function(e){Object.assign(this.productIdToInfoMap,e)}}]),e}());t.PRODUCT_FETCH_TTL=36e5;t.default=a},609:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(196)),a=i(r(8)),o=i(r(3)),u=i(r(95));function i(e){return e&&e.__esModule?e:{default:e}}var s,c;t.default=(s=regeneratorRuntime.mark((function e(t){var r,i,s,c,d,l,f,p,g,h,y,v,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.products,i=void 0===r?[]:r,s=t.isUpdatingVariants,c=void 0!==s&&s,d=t.syncedFrom,l=void 0===d?"":d,f=i.reduce((function(e,t){var r=t.productId;if(!r){var a=t.variantId||t.merchId;r=t.storeId+"_"+(0,n.default)(t.merchId)+"_"+(0,n.default)(a)}return e.meta.push({productId:r}),e.removedDroplist.push(Object.assign({},t,{productId:r})),e}),{meta:[],removedDroplist:[]}),p=f.meta,g=f.removedDroplist,e.next=4,a.default.mutate("ext_removeDroplist",{meta:p});case 4:return h=e.sent,y=h.data,v=h.errors,m=(y||{}).removeDroplist||[],v&&o.default.warn("GraphQL error(s) from ext_removeDroplist",{params:t,errors:v}),m.length>0&&g.forEach((function(e){var t=e.productId,r=e.merchId,n=e.variantId,a=e.notifyAtPrice,o=e.watchLength,i=e.originalPrice,s=e.currentPrice,d=e.imageUrl,f=e.storeId,p={dropListProduct:{productId:t,merchId:r,variantId:n,notifyAtPrice:a,priceWatchLength:o,currentPrice:s,originalPrice:i,imageUrl:d,title:e.title},store:{id:f},syncedFrom:l,isUpdatingVariants:c};u.default.sendEventWithGroup("droplist003",p)})),e.abrupt("return",m.map((function(e){return e.productId})));case 11:case"end":return e.stop()}}),e,this)})),c=function(){var e=s.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(i)}("next")}))},function(e){return c.apply(this,arguments)})},625:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o,u,i,s,c,d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l=(n=O(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(C){e.next=7;break}return e.next=3,_.default.getUserABGroup("honeyTipsConfiguration_v4");case 3:t=e.sent,r=t.pdpCoupons,C=d({hoursSinceLastSuccess:24,hoursBeforeNow:24,successRate:.8,successesCount:10,avgAmountSaved:0,avgSavedPercent:0,totalAmountSaved:0},(void 0===r?{}:r).couponThresholds||{});case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),f=(a=O(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.default.query("ext_getProductByIds",{productIds:[t]});case 3:return r=e.sent,n=r.data,e.abrupt("return",n.getProductByIds[0]);case 8:e.prev=8,e.t0=e.catch(0),b.default.debug("Could not retrieve productId:"+t+" from product catalog.");case 11:return e.abrupt("return",{});case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return a.apply(this,arguments)}),p=(o=O(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(C){e.next=3;break}return e.next=3,l();case 3:return b.default.debug("background:productCoupons:getProductCoupons: PDPCouponThresholds: "+C),e.prev=4,e.next=7,m.default.query("ext_getCouponStatsByProduct",{storeId:t,parentId:r,startTs:(o=void 0,o=new Date,Math.floor(o.setHours(o.getHours()-C.hoursBeforeNow)/1e3)),endTs:Math.ceil((new Date).getTime()/1e3)});case 7:return n=e.sent,a=n.data,e.abrupt("return",a.getCouponsProductStats.couponStats);case 12:e.prev=12,e.t0=e.catch(4),b.default.debug("Could not retrieve product coupons for parentId:"+r+" from BigTable.");case 15:return e.abrupt("return",[]);case 16:case"end":return e.stop()}var o}),e,this,[[4,12]])}))),function(e,t){return o.apply(this,arguments)}),g=(u=O(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w.default.get("visitedProducts:"+t);case 3:n=e.sent,w.default.set("visitedProducts:"+t,d({},n,P({},r.parentId,r))),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),w.default.set("visitedProducts:"+t,P({},r.parentId,r));case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e,t){return u.apply(this,arguments)}),h=(i=O(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w.default.get("visitedProducts:"+t);case 3:return r=e.sent,e.abrupt("return",r);case 7:e.prev=7,e.t0=e.catch(0),b.default.debug("No visited products cache. May not have visited any PDPs.");case 10:return e.abrupt("return",{});case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e){return i.apply(this,arguments)}),y=(s=O(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w.default.get("visitedProducts:"+t);case 3:return n=e.sent,b.default.debug("productCoupons: Found visited product "+JSON.stringify(n)),e.abrupt("return",n[r]||null);case 8:e.prev=8,e.t0=e.catch(0),b.default.debug("productCoupons: could not find current product coupons");case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e,t){return s.apply(this,arguments)}),v=(c=O(regeneratorRuntime.mark((function e(t,r,n){var a,o,u,i,s,c,d,h,y,v,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.parentId,o=r.price,u=r.productId,i=r.title,s={},e.prev=2,e.next=5,f(u);case 5:s=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),b.default.error("Product catalog request failed. "+e.t0),e.abrupt("return");case 12:if(0!==Object.keys(s).length){e.next=14;break}return e.abrupt("return");case 14:return c=[],e.prev=15,e.next=18,p(t,a);case 18:c=e.sent,e.next=25;break;case 21:return e.prev=21,e.t1=e.catch(15),b.default.error("Product coupon request failed. "+e.t1),e.abrupt("return");case 25:if(0!==c.length){e.next=27;break}return e.abrupt("return");case 27:if(C){e.next=30;break}return e.next=30,l();case 30:if(b.default.debug("background:productCoupons:init: PDPCouponThresholds: "+JSON.stringify(C)),0!==(d=c.reduce((function(e,t){return t.successesCount>=C.successesCount&&t.successRate>e.successRate&&(e=t),e}),{successRate:0})).successRate){e.next=34;break}return e.abrupt("return");case 34:return b.default.debug("background:productCoupons:init: Saving productCoupon: "+d),y=(h=s).imageUrlPrimary,v=h.imageUrlSecondary,m={coupon:d,images:[y].concat(R(v)),name:i,parentId:a,price:parseInt(E.default.cleanPrice(o).toFixed(2),10),productId:u},e.next=39,g(t,m);case 39:if("function"==typeof n&&n(),T){e.next=44;break}return T=!0,e.next=44,S.default.getAndRunV5Vim(void 0,t,"cppf",void 0,!1,void 0);case 44:case"end":return e.stop()}}),e,this,[[2,8],[15,21]])}))),function(e,t,r){return c.apply(this,arguments)}),m=x(r(8)),b=x(r(3)),w=x(r(47)),I=x(r(4)),S=x(r(626)),_=x(r(21)),E=x(r(19));function x(e){return e&&e.__esModule?e:{default:e}}function R(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}var T=!1,C=null;I.default.addListener("product:coupons",(function(e,t){var r=t&&t.data||{};switch(t&&t.action){case"getVisitedProducts":return h(r.storeId);case"getVisitedProduct":return y(r.storeId,r.parentId);default:throw new InvalidParametersError("action")}})),t.default={getProductFromId:f,initProductCoupon:v}},626:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n,a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u=(n=P(regeneratorRuntime.mark((function e(t,r,n,a,o,i,s){var c,d,l,p,y,v,b,w,_,E,x,R,P,C,A,L,N,U,F,K;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=!1,setTimeout((function(){c||(V[n]-=1)}),8e3),!o){e.next=4;break}return e.abrupt("return",null);case 4:if(d=(0,f.default)(),l=void 0,p={auditLog:[]},e.prev=7,V[n]=V[n]?V[n]+1:1,y=k[n],!(V[n]&&y&&V[n]>y)){e.next=13;break}return g.default.debug("Skipping VIM of type: "+n+" due to being at the concurrency limit."),e.abrupt("return",null);case 13:return Y[d]=p,e.next=16,ne(r,n,null,!1);case 16:return v=e.sent,b=void 0,o&&((b=document.createElement("iframe")).name=d,b.id=d,b.width="1225",b.height="818",document.body.append(b)),M[d]=v.subVims,w={maxMarshalDepth:100},O&&Object.assign(w,{console:{logger:{}}}),_=performance.now(),e.prev=23,p.vimCreationOptions=w,E=v.mainVim,R=(x="string"==typeof E)?(0,S.default)(E):E,D&&x&&(P=r+":"+n+":false",(C=D.get(P)).mainVim=R,D.set(P,C,T)),l=new I.default(R,w),A={vim:l,type:n,runId:d},W[a]?W[a].push(A):W[a]=[A],L=ee(u,a,d,o,n,r,i,s),H[d]=L,p.startTime=Date.now(),g.default.debug("Starting vim "+n),"pfp"===n&&X("pfp started",a,{storeId:r}),e.next=39,l.run(t,L);case 39:e.next=45;break;case 41:e.prev=41,e.t0=e.catch(23),g.default.debug("VIM error: "+e.t0.message),p.cancelled||m.default.sendEvent("ext012001",{store:{id:r},vim_type:"v5_"+n+"_"+(o?"bg":"fg"),sub_vim:"main",input_data:JSON.stringify(t),error_message:e.t0.message,error_stack:e.t0.stack});case 45:N=performance.now(),g.default.debug("v5 vim:"+n+" took "+(N-_)+" milliseconds."),g.default.debug("VIM finished running: "+n),h.default.send("vims:action",{action:"resetLastInst",runId:d},{tab:a,ignoreResponse:!0}),e.next=55;break;case 51:throw e.prev=51,e.t1=e.catch(7),g.default.error(e.t1),e.t1;case 55:return e.prev=55,p.endTime=Date.now(),U=p.auditLog.map((function(e){return{sub_event:e.subEvent,happened_at:e.happenedAt,additional:e.additional}})),m.default.sendEvent("ext012002",{store:{id:r},vim_type:n,creation_options:JSON.stringify(p.vimCreationOptions),input_data:JSON.stringify(t),referrer_url:i,tab_id:""+a,bg_frame:o,native_action_audit_log:U,start_time:p.startTime,end_time:p.endTime,cancelled:p.cancelled||!1}),c=!0,V[n]-=1,F=G[d],B.delete(F),delete z[d],delete G[d],delete M[d],delete j[d],delete H[d],l&&(W[a].length>1?W[a]=W[a].filter((function(e){return e.vim!==l})):delete W[a]),o&&((K=document.getElementById(d))&&K.remove(),q[d].disconnect(),delete q[d]),e.finish(55);case 71:return e.abrupt("return",d);case 72:case"end":return e.stop()}}),e,this,[[7,51,55,71],[23,41]])}))),function(e,t,r,a,o,u,i){return n.apply(this,arguments)}),i=R(r(5)),s=R(r(35)),c=R(r(1247)),d=R(r(1248)),l=R(r(0)),f=R(r(1252)),p=R(r(15)),g=R(r(3)),h=R(r(4)),y=R(r(625)),v=R(r(279)),m=R(r(20)),b=R(r(39)),w=R(r(19)),I=R(r(1253)),S=R(r(1557)),_=R(r(83)),E=R(r(701)),x=R(r(8));function R(e){return e&&e.__esModule?e:{default:e}}function P(e){return function(){var t=e.apply(this,arguments);return new i.default((function(e,r){return function n(a,o){try{var u=t[a](o),s=u.value}catch(e){return void r(e)}if(!u.done)return i.default.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(s)}("next")}))}}var O=!0,T=l.default.duration(30,"minutes").asMilliseconds(),C=l.default.duration(1,"hour").asMilliseconds(),A=l.default.duration(5,"minutes").asMilliseconds(),k={pff:1,cppf:1},L=new Set(["pfp","pff","pd","cki","cppf","sol"]),N={pd:"pageDetector",pfp:"productFetcherPartial",pff:"productFetcherFull",cki:"checkoutInfo",cppf:"cartProductPageFetcher",sol:"submitOrderListener"},D=new s.default({max:20,maxAge:12e5,length:function(){return 1}});setInterval((function(){D&&D.prune()}),18e5);var U={},j={},M={},B=new Set([]),F={},G={},q={},H={},W={},Y={},V={},z={},K={},J={},Q={},$={};function X(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.isLoggedIn,a=r.storeId;try{if("pdp detect"!==e||$[t]||($[t]=Date.now(),setTimeout((function(){delete $[t]}),12e4)),!$[t])return;["tab url changed","tab closed"].indexOf(e)>=0&&delete $[t],g.default.debug("saw pdp event initiated: "+e+", at "+Date.now()),m.default.sendEvent("ext050111",{eventName:e,tabId:t,isLoggedIn:n,clientTs:Date.now(),store:{id:a}})}catch(e){}}var Z=void 0,ee=function(e,t,r,n,a,s,l,f){return function(e,v){g.default.debug("VIM nativeAction: "+e+", runId: "+r,{vimPayload:v,tabId:t,runId:r,useBgFrame:n,mainVimName:a,storeId:s,currentPageUrl:l,silenceReportedValues:f});var w=void 0;switch(e){case"result":U[r]&&U[r](v),delete U[r];break;case"reportCleanedProduct":var I=Object.assign({},v);return I.src="ext",h.default.send("vims:action",{action:"getLastVariantChangeTimestamp",runId:r},{tab:t,ignoreResponse:!1}).then((function(e){if(e>z[r])return"Product details changed during fetch";var i="partialProduct"===I.observationType;if(!I)return m.default.sendEvent("ext012001",{store:{id:s},vim_type:"v5_"+a+"_"+(n?"bg":"fg"),sub_vim:"main",error_message:"cleanedProductDoesNotExistInStore"}),null;var f,v=Object.assign({},I);if(delete v.userSelected,(0,c.default)(Z,v)?(g.default.debug("Duplicate product observation (skip send)",I),Z=null,setTimeout((function(){g.default.debug("Retrying product observation"),"function"==typeof U[r]&&(U[r](),delete U[r])}),5e3)):(Z=v,m.default.sendProdObservation(I,!0,{store:{id:s}})),X("pfp complete",t),i){var b=I.requiredFieldNames.reduce((function(e,t){var r=I[t]||[],n=r.find((function(e){return e.selected}));return!n&&r[0]&&(n=r[0].value?r[0]:{value:r[0]}),e[t]=n&&n.text,e}),{}),w={partial_obs:I,store_id:s,title:I.title,product_details:(0,d.default)(b),canonical_url:l},S=(0,d.default)(w);if(S!==J[t])J[t]=S,p.default.post("https://d.joinhoney.com/hpid").send(w).then((f=P(regeneratorRuntime.mark((function e(r){var n,a,i,c,f,p,v,m,b,w;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.body,a=n.productId,i=n.parentId,c=n.variantId,f=n.newProduct,y.default.initProductCoupon(s,o({},I,{parentId:i,productId:a}),(function(){h.default.send("honeyTips:pdpCoupons:honeyProductCoupons:init",null,{tab:t,ignoreResponse:!0})})),f&&u({startProductUrl:l},s,"pff",t,!0,l),!a){e.next=24;break}if(p=K[t],v={},i!==p||!Q[t]){e.next=11;break}try{v=JSON.parse(Q[t]).variantsById}catch(e){g.default.debug(e,"Failed to parse last hpid call for variations")}e.next=21;break;case 11:return K[t]=i,e.next=14,x.default.query("ext_getInventoryByProductId",{productId:a});case 14:if((m=e.sent).data){e.next=17;break}throw new Error("Error from ext_getInventoryByProductId: "+m.message);case 17:b=m.data.getInventoryByProductId,v=b.inventory,w=o({},n,{variantsById:v}),Q[t]=(0,d.default)(w);case 21:(0,E.default)(I,n,v),X("hpid complete",t,i),h.default.send("current:product",{data:{variantId:c,variations:v,partialObservation:I,productId:a,parentId:i,storeId:s,newProduct:f}},{tab:t,ignoreResponse:!0});case 24:return e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,void 0)}))),function(e){return f.apply(this,arguments)})).catch((function(e){404!==e.status&&g.default.error(e)}));else if(null!==Q[t]){var _={};try{_=JSON.parse(Q[t])}catch(e){return g.default.debug(e,"Could not parse last hpid call results."),null}h.default.send("current:product",{data:{variantId:_.variantId,variations:_.variantsById,partialObservation:I,productId:_.productId,parentId:_.parentId,storeId:_.storeId,newProduct:_.newProduct}},{tab:t,ignoreResponse:!0})}}return null})).catch((function(e){g.default.error(e)}));case"announceAsEvent":if("string"!=typeof v.event){g.default.error("VIM reported result with invalid event: "+v.event);break}var _="vim_event:"+v.event;g.default.debug("VIM announceAsEvent: "+_),h.default.send(_,{data:v.data},{tab:t,ignoreResponse:!0});break;case"runVimInContext":var R=v.subVim;w&&(w.additional=R);var O=M[r][R],C="string"==typeof O,A=C?(0,S.default)(O):O;if(D&&C){var k=s+":"+a+":false",L=D.get(k);L.subVims[R]=A,M[r]=L.subVims,D.set(k,L,T)}if(n){var N=G[r];q[r].postMessage({vim:A,vimType:a,subVim:R,options:v.options,toFrame:r,action:e,runId:r,frameId:N})}else h.default.send("vims:action",{data:{vim:A,options:v.options,vimType:a,subVim:R},action:e,runId:r},{tab:t,ignoreResponse:!0});return new i.default((function(e){U[r]=e}));case"registerSetupSubVims":j[r]=v;var B=j[r];return w&&(w.additional=B.map((function(e){return e.name})).join(", ")),i.default.mapSeries(B,(function(e){return H[r]("runVimInContext",{subVim:e.name,options:e.params})}));case"page.goto":var W=v.url;return F[W]=r,document.getElementById(r).src=W,new i.default((function(e){U[r]=e}));case"reportPageTypes":var Y=v.types;w&&(w.additional=Object.keys(Y).join(", ")),v.types.PRODUCT&&X("pdp detect",t,{storeId:s}),h.default.send("vims:reportPageTypes",{types:Y,ignoreForFeatures:f,storeId:s},{tab:t,ignoreResponse:!0});break;case"watchVariants":return h.default.send("vims:action",{data:v,action:"watchVariants",runId:r},{tab:t,ignoreResponse:!0});case"waitForVariantChange":return h.default.send("vims:action",{data:v,action:"waitForVariantChange",runId:r},{tab:t,ignoreResponse:!0}),new i.default((function(e){U[r]=e}));case"waitForPageUpdate":return h.default.send("vims:waitForPageUpdate",{vimPayload:v,runId:r},{tab:t,ignoreResponse:!0}),new i.default((function(e){U[r]=e}));case"reportOrderId":if(f)return null;h.default.send("reportOrderId",v,{tab:t,ignoreResponse:!0});break;case"reportSubmitOrderClick":b.default.getStoreById(s).then((function(e){m.default.sendEvent("ext009006",{store:e})}));break;default:g.default.warn("Unhandled native action: "+e,v)}return null}};function te(t,r){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=t+":"+r+":"+n;if(D){var u=D.get(o);if(void 0!==u)return i.default.resolve(u)}var s=void 0;if(n)s="https://v.joinhoney.com/stores/"+t+"/"+r+"?engine=4.1.2";else if(e.env.VIM_GENERATOR_SERVER_URL){var c=N[r];s=e.env.VIM_GENERATOR_SERVER_URL+"/vim/stores/"+t+"/platform/extension/"+c+"?engine=4.1.2"}else s="https://v.joinhoney.com/v5/stores/"+t+"/platform/extension/"+r+"?engine=4.1.2";var d=i.default.delay(0).then((function(){return p.default.get(s).then((function(e){return e.body}))})).then((function(e){var t=void 0;if(n){if(!e||!e.vims||0===Object.keys(e.vims).length)throw new NotFoundError;t={meta:e.meta||{},vims:{}},Object.entries(e.vims).forEach((function(e){var r=a(e,2),n=r[0],o=r[1];t.vims[n]=(0,S.default)(o)}))}else{if(!e||!e.mainVim)throw new NotFoundError;t={mainVim:e.mainVim,subVims:e.subVims}}if(!t)throw new NotFoundError;return D&&D.set(o,t,T),t})).catch(NotFoundError,(function(){return D&&D.set(o,null,C),null})).catch((function(){return D&&D.set(o,null,A),null}));return D&&D.set(o,d,T),d}function re(e,t,r){return te(e,t,r).then((function(e){if(!e)throw new NotFoundError;return e.meta}))}function ne(e,t,r,n){return te(e,t,n).then((function(e){if(!n){if(!e)throw new NotFoundError;return e}if(!e||!e.vims[r])throw new NotFoundError;return e.vims[r]}))}function ae(e,t){if("error"===e.type)return g.default.error(e.error),!1;if(!e.vimFrameId)return!1;if("vim_error_event"===e.type)return b.default.getStoreByUrl(e.url).then((function(t){m.default.sendEvent("ext012001",Object.assign(e.errorEventPayload,{store:t}))})),!1;if(t.tab&&void 0!==t.tab.id)return!1;var r=e.vimFrameId;switch(e.action){case"result":var n=e.vimPayload;U[r](n),delete U[r];break;default:g.default.warn("Unhandled nativeAction from bg iFrame VIM: "+e.action,e)}return!1}function oe(e,t,r){var n=void 0;"page:detect_store"===e?n=r.tabId:"tabs:removed"===e&&(n=t.tabId),"tabs:removed"===e&&(X("tab closed",n),delete K[n],delete J[n],delete Q[n]);var a=W[n];a&&a.forEach((function(e){if(L.has(e.type)){var t=e.runId;e.vim.cancel(),Y[t].cancelled=!0;var r=U[t];r&&r()}}))}h.default.addListener("vims:action",(function(e,t,r){var n=t&&t.data||{};switch(t&&t.action){case"getStoreVimMeta":return re(n.storeId,n.type,n.v4);case"getStoreVimData":return ne(n.storeId,n.type,n.name,n.v4);case"nativeAction":return H[n.runId](n.vimRequest,n.vimPayload);case"getAndRunV5Vim":var a=n.type,o="pff"===a;return u(n.options,n.storeId,a,r.tabId,o,n.currentPageUrl);case"pageChange":var i=n.runId;0,U[i](),delete U[i];break;case"productVariantClicked":var s=n.event,c=n.runId;"function"==typeof U[c]&&(U[c](s),delete U[c]);break;default:throw new InvalidParametersError("action: "+(t&&t.action))}return null})),v.default.addOnConnectListener((function(e){if(0!==e.name.indexOf("vim-frame:"))return e.disconnect(),null;var t=e.name.split("vim-frame:")[1];return t&&U[t]?(q[t]=e,e.onMessage.addListener(ae),U[t](),delete U[t],null):(e.disconnect(),null)})),_.default.addHeadersReceivedListener((function(e){var t=e.responseHeaders,r=e.frameId;if(B.has(r))return{responseHeaders:t.map((function(e){var t=w.default.cleanStringLower(e&&e.name);return"x-frame-options"===t?null:"content-security-policy"===t&&e.value&&e.value.match("frame-ancestors")?Object.assign(e,{value:e.value.replace(/frame-ancestors(.*?)(;|$)/,"")}):e})).filter((function(e){return e}))}}),{types:["sub_frame"],tabId:-1,blocking:!0}),_.default.addBeforeRequestListener((function(e){var t=e.frameId,r=e.url;if(F[r]){var n=F[r];G[n]=t,B.add(t)}}),{types:["sub_frame"],tabId:-1,blocking:!1}),h.default.addListener("page:detect_store",oe),h.default.addListener("tabs:removed",oe),h.default.addListener("tabs:updated",(function(e,t){t.url&&"loading"===t.status&&X("tab url changed",t.tabId)})),h.default.addListener("pdp:debug",(function(e,t,r){return X(t.eventName,(r||{}).tabId,t)})),t.default={getStoreVimMeta:re,getStoreVimData:ne,getAndRunV5Vim:u,logDebugEvent:X}}).call(this,r(54))},701:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=u(r(19)),o=u(r(20));function u(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=[];return Object.keys(e).forEach((function(r){var a=e[r],o=n({},a,{product_id:r,product_details:JSON.stringify(a.productDetails)});t.push(o)})),t}t.default=function(e,t,r){var u=!1,s=void 0;if(r?e&&t?t.newProduct||0!==Object.keys(r).length?t.newProduct||t.productId in r||(u=!0,s="Not a newProduct but the product is not contained in the inventory returned from the product catalog."):(u=!0,s="Not a newProduct but empty inventory returned from the product catalog."):(u=!0,s=e?"Hpid response failed.":"Partial observation failed."):(u=!0,s="Null inventory returned from the product catalog (via the `getInventoryByProductId`)."),u||!(!t.newProduct&&t.productId in r||t.newProduct)){var c={partial_fetcher:e,hpid_response:t,inventory:r?i(r):void 0,error_message:s||"Unknown error occurred.",product_fetcher_version:"v5"};!function(e){o.default.sendEvent("ext009007",n({},e,{product_fetcher_version:"v5"}))}(a.default.snakeifyObject(c))}}},702:function(e,t,r){r(336),e.exports=r(904)},73:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=r(1031),o=(n=a)&&n.__esModule?n:{default:n};function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,r){return Object.defineProperty(e,t,{value:r,configurable:!0,enumerable:!1,writable:!0})}var s=function e(t,r){u(this,e),i(this,"name","HoneyError"),i(this,"message",t||"HoneyError"),i(this,"extra",r),"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error(t).stack};s.prototype=Object.create(Error.prototype);try{window.HoneyError=s}catch(e){}var c={HoneyError:s};o.default.forEach((function(e){var t=function(e){var t=function t(r,n){u(this,t),i(this,"name",e),i(this,"message",r||e),i(this,"extra",n),"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new s(r).stack};return t.prototype=Object.create(s.prototype),t}(e);try{window[e]=t}catch(e){}c[e]=t})),t.default=c},8:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=u(r(1081)),o=u(r(3));function u(e){return e&&e.__esModule?e:{default:e}}var i=function(e,t){return"https://d.joinhoney.com/v3?operationName="+e+"&variables="+function(e){return encodeURIComponent(JSON.stringify(e))}(t)};function s(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4,n=void 0,a=new Promise((function(e,t){n=setTimeout((function(){t(new Error("Timed out"))}),r)}));return Promise.race([a,e]).then((function(e){return clearTimeout(n),e})).catch((function(e){return clearTimeout(n),o.default.error(t+": "+e),Promise.reject(e)}))}var c={query:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s((0,a.default)(i(e,t),{method:"GET",headers:n({},r.headers,{"Content-Type":"application/json","Service-Name":"honey-extension","Service-Version":"12.8.4"})}).then((function(e){return e.json()})),"Timeout during query operation: "+e,r.timeoutDeadline||1e4)},mutate:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s((0,a.default)("https://d.joinhoney.com/v3",{method:"POST",headers:n({},r.headers,{"Content-Type":"application/json","Service-Name":"honey-extension","Service-Version":"12.8.4"}),body:JSON.stringify({operationName:e,variables:t})}).then((function(e){return e.json()})),"Timeout during mutation operation: "+e,r.timeoutDeadline||1e4)}};t.default=c},83:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=r(1073),o=(n=a)&&n.__esModule?n:{default:n};var u={},i={};["BeforeRequest","BeforeSendHeaders","SendHeaders","HeadersReceived","AuthRequired","BeforeRedirect","ResponseStarted","Complete","ErrorOccurred"].forEach((function(e){i[e]=[],u["add"+e+"Listener"]=function(t,r){if("function"!=typeof t)throw new InvalidParametersError("listener");o.default["add"+e+"Listener"](t,r);var n=i[e];-1===n.indexOf(t)&&n.push(t)},u["add"+e+"CoreListener"]=function(t,r){if("function"!=typeof t)throw new InvalidParametersError("listener");o.default["add"+e+"Listener"](t,r)},u["remove"+e+"Listener"]=function(t){if("function"!=typeof t)throw new InvalidParametersError("listener");o.default["remove"+e+"Listener"](t),i[e]=i[e].filter((function(e){return e!==t}))}})),u.removeAllNonCoreListeners=function(){var e=0;return Object.keys(i).forEach((function(t){i[t].forEach((function(r){o.default["remove"+t+"Listener"](r),e+=1})),i[t]=[]})),e},t.default=u},904:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};r(905),r(911),r(918),r(926),r(929),r(937),r(958),r(960),r(971),r(989),r(993),r(994),r(996),r(998),r(1e3),r(1002),r(1014),r(1029),r(73);var a=Q(r(5)),o=Q(r(190)),u=Q(r(63)),i=Q(r(15)),s=Q(r(19)),c=Q(r(1059)),d=Q(r(193)),l=Q(r(1111)),f=Q(r(281)),p=Q(r(1112)),g=Q(r(1172)),h=Q(r(1173)),y=Q(r(130)),v=Q(r(55)),m=Q(r(1174)),b=Q(r(1187)),w=Q(r(589)),I=Q(r(602)),S=Q(r(129)),_=Q(r(1206)),E=(Q(r(1207)),Q(r(3))),x=Q(r(47)),R=Q(r(4)),P=Q(r(584)),O=Q(r(1234)),T=Q(r(1235)),C=Q(r(1237)),A=Q(r(1245)),k=Q(r(1246)),L=Q(r(625)),N=Q(r(701)),D=Q(r(1584)),U=Q(r(279)),j=Q(r(20)),M=Q(r(154)),B=Q(r(1585)),F=Q(r(39)),G=Q(r(94)),q=Q(r(1586)),H=Q(r(21)),W=Q(r(626)),Y=Q(r(83)),V=Q(r(1589)),z=Q(r(1590)),K=Q(r(1591)),J=Q(r(1592));function Q(e){return e&&e.__esModule?e:{default:e}}r(1593),a.default.onPossiblyUnhandledRejection((function(e){return E.default.error(e)})),Y.default.addBeforeSendHeadersListener((function(e){return{requestHeaders:e.requestHeaders.concat({name:"X-Honey",value:"12.8.4"})}}),{blocking:!0,urls:["https://*.joinhoney.com/*","http://*.joinhoney.com/*"]}),R.default.send("background:started",{},{background:!0,allTabs:!0,ignoreResponse:!0}).catch((function(e){return E.default.error(e)})).then((function(){return E.default.debug("Honey 12.8.4 background script is ready. Environment is production")})).then((function(){return p.default.initialize()})).catch((function(e){return E.default.error(e)}));var $={$:u.default,acorns:c.default,adbBp:d.default,ajax:l.default,apiRequest:i.default,button:f.default,checkoutObservation:p.default,config:g.default,confirmation:h.default,cookies:y.default,device:v.default,droplist:m.default,honeyTips:b.default,experiments:I.default,exclusives:w.default,featureFlag:S.default,imageLoader:_.default,honeyPayNow:C.default,honeyPayPal:A.default,honeyProductCoupons:L.default,logger:E.default,lru:x.default,messages:R.default,offers:P.default,onboarding:O.default,optimus:T.default,popover:k.default,productDataIntegrity:N.default,productFetcher:D.default,runtime:U.default,sdata:[],stats:j.default,storage:M.default,storeSupport:B.default,stores:F.default,tabs:G.default,carRental:q.default,user:H.default,util:s.default,vims:W.default,webHooks:Y.default,yelp:V.default,honeyTipsCreditCardOffers:z.default,honeyTipsSmartDroplist:K.default,honeyTipsBadgeExperiments:J.default};window.sdata={events:[]},R.default.addListener("page:load",(function(e,t,r){try{t.url.startsWith("https://www.joinhoney.com/extension-debug")?o.default.parse(t.url).query.split("&").some((function(e){var t=e.split("=",2),r=n(t,2),a=r[0],o=r[1];if(a.startsWith("abGroup-")){var u=a.split("-")[1];H.default.setAbGroupOverride(u,o)}if(a.startsWith("featureFlag-")){var i=a.split("-")[1];S.default.setFeatureFlagOverride(i,"true"===o)}return"active"===a&&(parseInt(o,10)>0?window.honey=$:delete window.honey,R.default.send("debug:change",{active:!!window.honey},{allTabs:!0,ignoreResponse:!0}).reflect(),!0)})):window.honey&&r.tabId>=0&&R.default.send("debug:change",{active:!0},{tab:r.tabId,ignoreResponse:!0}).reflect()}catch(e){}})),t.default=$},94:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(5)),a=f(r(574)),o=f(r(20)),u=f(r(39)),i=f(r(587)),s=f(r(4)),c=f(r(589)),d=f(r(21)),l=f(r(47));function f(e){return e&&e.__esModule?e:{default:e}}var p="?optOut=true",g={};function h(e){var t=e&&e.url;if(!t||"string"!=typeof t)throw new InvalidParametersError("url");var r=void 0===e.active||!!e.active;return a.default.open({url:t,active:r,srcTabId:e.srcTabId}).then((function(t){return e.delayedOpen&&(g[t]=e.delayedOpen),t}))}function y(e){if(!e)throw new InvalidParametersError("tabId");return a.default.get(e)}function v(){return a.default.getAll()}s.default.addListener("tabs:action",(function(e,t){switch(t&&t.action){case"open":return h(t.data);default:throw new InvalidParametersError("action")}}));var m=void 0;s.default.addListener("page:load",(function(e,t,r){var a=r&&r.tabId;g[a]&&(delete g[a],n.default.all([u.default.getStoreByUrl(t.url),d.default.getInfo()]).spread((function(e,t){e&&e.metadata&&(e.metadata.tagInSameTab||e.metadata.tagInNewTab)&&e.metadata.pns_codeTopFunnel?s.default.send("findsavings:apply_code_top_funnel",{},{tab:a,ignoreResponse:!0}):e&&(e.metadata.tagInSameTab||e.metadata.tagInNewTab)&&e.gold.activated&&!t.isLoggedIn?s.default.send("ui:action",{action:"open",data:{path:"/fs/applying/codesComplete",query:{goldActive:!0,isFlatFee:e.gold.isFlatFee,max:e.gold.max,maxFlatFee:e.gold.maxFlatFee,min:e.gold.min,minFlatFee:e.gold.minFlatFee}}},{tab:a,ignoreResponse:!0}):e.gold.activated&&t.isLoggedIn&&s.default.send("ui:action",{action:"open",data:{path:"/goldactivated",query:{cartPrice:0,currencyExchangeRate:e.currencyExchangeRate||1,exclusionText:e.gold.description,goldActive:!0,honeyGoldBonus:0,isFlatFee:e.gold.isFlatFee,max:e.gold.max,maxFlatFee:e.gold.maxFlatFee,min:e.gold.min,minFlatFee:e.gold.minFlatFee}}},{tab:a,ignoreResponse:!0})}))),setTimeout((function(){!function(e,t){if(void 0===m&&(m=i.default.get("device:firstTime")),"true"===m){var r=/honeydemo=true/.test(t),a=/honeywelcome=true/.test(t)||/honeywelcome%3Dtrue/.test(t)||/www.amazon.com\/ap\/signin/.test(t)||/ebay/.test(t);r||a||y(e).then((function(e){if(e&&e.active)return u.default.getStoreByUrl(e.url);throw new OperationSkippedError("Not active tab")})).then((function(e){if(!e||!e.id||(r=(t=e).coupons,a=t.metadata,o=[a.pns_siteSelCartCodeBox,a.pns_siteSelCartCodeSubmit,a.pns_siteSelCartTotalPrice].every((function(e){return!!e})),u=r.some((function(e){return e.applied_acc_count>0})),!o||!u)||e.standDown)throw new OperationSkippedError("Shouldn't show coupons for this store");var t,r,a,o,u;return n.default.all([c.default.getDirectPendingExclusive(e),c.default.getExclusiveForStore(e.id)])})).spread((function(t,r){t||r||(i.default.del("device:firstTime"),m=!1,s.default.send("ui:action",{action:"ftue",data:{}},{tab:e,ignoreResponse:!0}))})).catch((function(){}))}}(a,r.tabUrl)}),5e3)})),s.default.addListener("page:detect_store",(function(e,t,r){a.default.trackTab(t,r);var n=t&&t.url,i=new URL(n).hostname;return"www.google.com"===i&&a.default.initializeSearchEngineIntegrationOnTab?a.default.initializeSearchEngineIntegrationOnTab(r.tabId):u.default.getStoreByUrl(n).then((function(e){return e&&e.id?a.default.initializeHoneyOnStoreTab(r.tabId):t&&t.isShopify&&!0!==l.default.lru.get("sentShopifyMessage:"+i)&&(l.default.set("sentShopifyMessage:"+i,!0),o.default.sendEvent("ext100201",{hostname:i,referrer_url:n})),e}))})),t.default={open:h,openEmailAuthWindow:function(e,t,r,n){return a.default.openEmailAuthWindow(e,t,r,n)},openAppleAuthWindow:function(e,t){if(t)return a.default.openAppleAuthWindow("https://www.joinhoney.com/apple/login");var r=e?"https://www.joinhoney.com/apple/join"+p:"https://www.joinhoney.com/apple/join";return a.default.openAppleAuthWindow(r)},openGoogleAuthWindow:function(e,t){if(t)return a.default.openGoogleAuthWindow("https://www.joinhoney.com/google/login");var r=e?"https://www.joinhoney.com/google/join"+p:"https://www.joinhoney.com/google/join";return a.default.openGoogleAuthWindow(r)},openFBAuthWindow:function(e,t){if(t)return a.default.openGoogleAuthWindow("https://www.joinhoney.com/fb/login");var r=e?"https://www.joinhoney.com/fb/join"+p:"https://www.joinhoney.com/fb/join";return a.default.openFBAuthWindow(r)},openPaypalAuthWindow:function(e,t){if(t)return a.default.openPaypalAuthWindow("https://www.joinhoney.com/paypal/login");var r=e?"https://www.joinhoney.com/paypal/join"+p:"https://www.joinhoney.com/paypal/join";return a.default.openPaypalAuthWindow(r)},logoutOfWebsite:function(){return a.default.logoutOfWebsite?a.default.logoutOfWebsite():null},checkForWebstore:function(){try{return a.default.checkForWebstore()}catch(e){return!1}},close:function(e){if(!e)throw new InvalidParametersError("tabId");return a.default.close(e)},loginOnWebsite:function(e){return a.default.loginOnWebsite?a.default.loginOnWebsite(e):null},get:y,getAll:v,getAllIds:function(){return a.default.getAllIds()},initializeHoneyOnAllTabs:function(){try{return v().then((function(e){return e[0].url?n.default.map(e,(function(e){return u.default.getStoreByUrl(e.url).then((function(t){return!!t.id&&a.default.initializeHoneyOnTab(e.id)}))})):a.default.initializeHoneyOnAllTabs()}))}catch(e){return n.default.resolve()}},showUI:function(e){if(!e)throw new InvalidParametersError("tabId");return g[e]=!0,e},load:function(e,t){if(!e||!t)return n.default.reject(new InvalidParametersError("invalid args"));var r=void 0,a=new n.default((function(e){r=e}));function o(e,n,a){a.tabId===t&&setTimeout((function(){return r()}),800)}return s.default.addListener("tabs:ready",o),n.default.delay(2e4).then((function(){s.default.removeListener("tabs:ready",o)})),g[t]=!0,s.default.send("tabs:action",{action:"load",url:e},{tab:t}).then((function(){return a})).catch((function(){}))},update:function(e,t){return a.default.update(e,t)}}},95:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o=(n=p(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,d.default.getUserABGroup("newUserThreshold");case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0={};case 7:return r=e.t0.days,n=r||30,e.abrupt("return",i.default.unix(t).isAfter((0,i.default)().subtract(n,"days")));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)}),u=(a=p(regeneratorRuntime.mark((function e(t,r){var n,a,u,i,s,l,f,p,g,h,y,v,m,b,w;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.default.getUserABGroup("activeBadgeExperiments");case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={};case 5:return n=e.t0,e.next=8,d.default.getInfo();case 8:return a=e.sent,e.next=11,o(a&&a.created);case 11:if(u=e.sent,i=r&&r.store&&r.store.id,s=void 0,l=void 0,f=n.group,p=n.storeIds,g=void 0===p?[]:p,h=n.existingUsersOff,y=n.newUsersOff,v=h&&!u,m=y&&u,b=u?"new":"existing","on"!==f||!g.includes(i)){e.next=30;break}if(v||m){e.next=30;break}return e.next=23,d.default.getUserABGroup("badgeExperimentsAB");case 23:if(e.t2=e.sent,e.t2){e.next=26;break}e.t2={};case 26:if(e.t1=e.t2.group,e.t1){e.next=29;break}e.t1="";case 29:l=e.t1;case 30:l&&(s="pdp_badge_experiments_v"+l+"_"+b),w=Object.assign({},r,{group:s}),c.default.sendEvent(t,w);case 33:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)}),i=f(r(0)),s=f(r(19)),c=f(r(20)),d=f(r(21)),l=f(r(287));function f(e){return e&&e.__esModule?e:{default:e}}function p(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var u=t[a](o),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(i)}("next")}))}}function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.primaryDetailsMissing,r=e.brand,n=e.canonicalUrl,a=e.dealScore,o=e.description,u=e.store,i=(u=void 0===u?{}:u).storeId,s=e.imageUrlPrimary,c=e.imageUrlSecondary,d=e.offer,l=e.parentId,f=e.priceCurrent,p=e.priceHistory,g=void 0===p?{}:p,h=e.productDetails,y=e.title,v=e.variations,m=void 0===v?{}:v,b=e.defaultTags,w=e.variantId,I=e.productId,S=e.availability,_=void 0!==S&&S;return{primaryDetailsMissing:t,brand:r,canonicalUrl:n,dealScore:a,defaultTags:b,description:o,imageUrl:s,images:c,lastPrice:f,offer:d,priceHistory:g,productDetails:h,merchId:l,variantId:w,productId:I,storeId:i,title:y,variations:m,availability:_}}t.default={cacheDroplistItems:l.default,formatDroplist:function(e){var t=e.productId,r=e.expires,n=e.notifyAtPrice,a=e.originalPrice,o=e.product,u=e.source,i=e.isSmartDroplisted,c=e.tags,d=e.userId,l=o||{},f=l.imageUrlPrimary,p=l.priceCurrent,g=l.store,h=l.parentId,y=l.productDetails,v=l.variantId,m=(g||{}).storeId;return{expires:r,imageUrlPrimary:f,notifyAtPrice:n,merchId:h,originalPrice:a,currentPrice:s.default.cleanPrice(p),productId:t,productDetails:y,source:u,isSmartDroplisted:i,storeId:m,tags:c,userId:d,variantId:v}},formatProduct:g,formatProducts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e||!e.length)return[];try{return e.map(g)}catch(e){return[]}},sendEventWithGroup:u}}});