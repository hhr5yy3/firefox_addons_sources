(()=>{var dr=Object.defineProperty;var B=(Mi,Pi)=>dr(Mi,"name",{value:Pi,configurable:!0});var Ks=[];(()=>{var Mi={22923:(me,te)=>{"use strict";const S=/\s/,K={OPEN:"{",CLOSE:"}",TAG_OPEN:"<",TAG_CLOSE:">",TAG_CLOSING:"/",SEP:",",SUB_VAR:"#",ESCAPE:"'"},M="subnumeric_types",I="submessage_types",O=Object.keys(K),W=Symbol("C"),x=te=me.exports=B(function r(b){if(!(this instanceof r))return new r(b);this.opts=Object.assign({OFFSET:"offset:",[M]:["plural","selectordinal"],[I]:["plural","selectordinal","select"],allowTags:!0,requireOther:!0},K,b);for(let u=0;u<O.length;u++){const v=O[u],A=this.opts[v];if(typeof A!="string"||A.length!==1)throw new Error(`Option ${v} must be a 1-length string`);for(let C=u+1;C<O.length;C++){const y=O[C];if(this.opts[y]===A)throw new Error(`Option ${v} and ${y} cannot match`)}}},"Parser2"),p=x.prototype;p.parse=function(r){return this.parseAST({msg:String(r),i:0},null)},p.parseAST=function(r,b){const u=r.msg,v=this.opts,A=u.length,C=b&&v[M].includes(b.t),y=[];for(;r.i<A;){const a=r.i,w=u[a];if(w===v.CLOSE)if(!b)f(y,"}"),r.i++;else break;else if(w===v.OPEN||C&&w===v.SUB_VAR)f(y,this.parseElement(r,b));else if(v.allowTags&&w===v.TAG_OPEN&&!S.test(u[a+1])){const F=this.parseTag(r,b);if(F===W){b.closed=!0;break}else f(y,F)}else f(y,this.parseText(r,b));if(r.i===a)throw l(w,r.i)}return y},p.parseText=function(r,b,u=!0,v=!0,A=!1){const C=r.msg,y=this.opts,a=y.allowTags,w=C.length,F=b&&y[M].includes(b.t);let D="";for(;r.i<w;){const z=C[r.i];if(z===y.OPEN||z===y.CLOSE||a&&(z===y.TAG_OPEN||A&&(z===y.TAG_CLOSE||z===y.TAG_CLOSING))||!u&&z===y.SEP||!v&&S.test(z)||F&&z===y.SUB_VAR)break;if(z===y.ESCAPE){let $=C[++r.i];if($===y.ESCAPE)D+=$,r.i++;else if($===y.OPEN||$===y.CLOSE||a&&($===y.TAG_OPEN||A&&($===y.TAG_CLOSE||$===y.TAG_CLOSING))||F&&$===y.SUB_VAR||!v||!u)for(D+=$;++r.i<w;)if($=C[r.i],$===y.ESCAPE)if($=C[r.i+1],$===y.ESCAPE)D+=$,r.i++;else{r.i++;break}else D+=$;else D+=z}else r.i++,D+=z}return D},p.parseTag=function(r,b){const u=r.msg,v=r.i,A=this.opts;r.i++;let C=u[r.i],y=!1;if(C===A.TAG_CLOSING){if(!b||!b.n)throw l(C,r.i);y=!0,r.i++,d(r)}const a=this.parseText(r,null,!1,!1,!0);if(!a)return u.slice(v,r.i);if(d(r),C=u[r.i],y){if(C!==A.TAG_CLOSE)throw _(A.TAG_CLOSE,C,r.i);if(a!==b.n)throw l("tag mismatch",v);return r.i++,W}if(y=!1,C===A.TAG_CLOSING&&(y=!0,r.i++,C=u[r.i]),C!==A.TAG_CLOSE)return u.slice(v,r.i);r.i++;const w={n:a};if(y)return w;const F=this.parseAST(r,w);if(F&&F.length&&(w.c=F),!w.closed&&r.i>=u.length)throw _("closing tag",r);return delete w.closed,w},p.parseElement=function(r,b){const u=r.msg,v=this.opts,A=b&&v[M].includes(b.t);let C=u[r.i];if(A&&C===v.SUB_VAR)return r.i++,{v:b.v,t:"number"};r.i++,d(r);const y=this.parseText(r,null,!1,!1);if(!y)throw _("placeholder id",C,r.i);const a={v:y};if(d(r),C=u[r.i],C===v.CLOSE)return r.i++,a;if(C!==v.SEP)throw _(`${v.SEP} or ${v.CLOSE}`,C,r.i);r.i++,d(r);const w=this.parseText(r,null,!1,!1);if(!w)throw _("type",r);if(a.t=w,d(r),C=u[r.i],C===v.CLOSE){if(v[I].includes(a.t))throw _("sub-messages",r);return r.i++,a}else if(C!==v.SEP)throw _(`${v.SEP} or ${v.CLOSE}`,C,r.i);if(r.i++,d(r),v[M].includes(a.t)){const F=this.parseOffset(r);F&&(a.f=F,d(r))}if(v[I].includes(a.t)){const F=this.parseSubmessages(r,a),D=v.requireOther;if((Array.isArray(D)?D.includes(a.t):D)&&!F.other)throw _("other sub-message",r);a.o=F}else{const F=this.parseText(r,null,!0,!0);if(!F)throw _("format",r);a.f=F.trimRight()}if(d(r),C=u[r.i],C!==v.CLOSE)throw _(v.CLOSE,C,r.i);return r.i++,a},p.parseSubmessages=function(r,b){const u=r.msg,v=u.length,A={};for(;r.i<v&&u[r.i]!==this.opts.CLOSE;){const y=this.parseText(r,null,!0,!1);if(!y)throw _("sub-message selector",r);d(r),A[y]=this.parseSubmessage(r,b),d(r)}return A},p.parseSubmessage=function(r,b){const u=r.msg,v=this.opts;if(u[r.i]!==v.OPEN)throw _(v.OPEN,r);r.i++;const A=this.parseAST(r,b);if(u[r.i]!==v.CLOSE)throw _(v.CLOSE,r);return r.i++,A},p.parseOffset=function(r){const b=r.msg,u=this.opts.OFFSET,v=b.length;if(b.slice(r.i,r.i+u.length)!==u)return;r.i+=u.length,d(r);const A=r.i;for(;r.i<v&&/[-\d]/.test(b[r.i]);)r.i++;if(A===r.i)throw _("number",r);return+b.slice(A,r.i)};function _(r,b,u){return typeof b=="object"&&(u=b.i,b=b.msg[u]),new SyntaxError(`expected ${r} at position ${u} but found ${b||"eof"}`)}B(_,"expected");function l(r,b){return new SyntaxError(`unexpected ${r} at position ${b}`)}B(l,"unexpected");function d(r){const b=r.msg,u=b.length;for(;r.i<u&&S.test(b[r.i]);)r.i++}B(d,"skipSpace");function f(r,b){const u=r.length-1;typeof b=="string"&&typeof r[u]=="string"?r[u]+=b:r.push(b)}B(f,"mergePush")},5926:(me,te,S)=>{"use strict";S.d(te,{fi:()=>J,kZ:()=>$});var K=S(57845),M=S(23111),I=S(61378),O=S(52319);function W(Z){return{scrollLeft:Z.scrollLeft,scrollTop:Z.scrollTop}}B(W,"getHTMLElementScroll");function x(Z){return Z===(0,I.Z)(Z)||!(0,O.Re)(Z)?(0,M.Z)(Z):W(Z)}B(x,"getNodeScroll");var p=S(43332),_=S(61300),l=S(4377),d=S(10710),f=S(62079);function r(Z){var G=Z.getBoundingClientRect(),Q=(0,f.NM)(G.width)/Z.offsetWidth||1,se=(0,f.NM)(G.height)/Z.offsetHeight||1;return Q!==1||se!==1}B(r,"isElementScaled");function b(Z,G,Q){Q===void 0&&(Q=!1);var se=(0,O.Re)(G),ce=(0,O.Re)(G)&&r(G),be=(0,l.Z)(G),ve=(0,K.Z)(Z,ce,Q),Re={scrollLeft:0,scrollTop:0},oe={x:0,y:0};return(se||!se&&!Q)&&(((0,p.Z)(G)!=="body"||(0,d.Z)(be))&&(Re=x(G)),(0,O.Re)(G)?(oe=(0,K.Z)(G,!0),oe.x+=G.clientLeft,oe.y+=G.clientTop):be&&(oe.x=(0,_.Z)(be))),{x:ve.left+Re.scrollLeft-oe.x,y:ve.top+Re.scrollTop-oe.y,width:ve.width,height:ve.height}}B(b,"getCompositeRect");var u=S(5618),v=S(26857),A=S(52839),C=S(49880);function y(Z){var G=new Map,Q=new Set,se=[];Z.forEach(function(be){G.set(be.name,be)});function ce(be){Q.add(be.name);var ve=[].concat(be.requires||[],be.requiresIfExists||[]);ve.forEach(function(Re){if(!Q.has(Re)){var oe=G.get(Re);oe&&ce(oe)}}),se.push(be)}return B(ce,"sort"),Z.forEach(function(be){Q.has(be.name)||ce(be)}),se}B(y,"order");function a(Z){var G=y(Z);return C.xs.reduce(function(Q,se){return Q.concat(G.filter(function(ce){return ce.phase===se}))},[])}B(a,"orderModifiers");function w(Z){var G;return function(){return G||(G=new Promise(function(Q){Promise.resolve().then(function(){G=void 0,Q(Z())})})),G}}B(w,"debounce");function F(Z){var G=Z.reduce(function(Q,se){var ce=Q[se.name];return Q[se.name]=ce?Object.assign({},ce,se,{options:Object.assign({},ce.options,se.options),data:Object.assign({},ce.data,se.data)}):se,Q},{});return Object.keys(G).map(function(Q){return G[Q]})}B(F,"mergeByName");var D={placement:"bottom",modifiers:[],strategy:"absolute"};function z(){for(var Z=arguments.length,G=new Array(Z),Q=0;Q<Z;Q++)G[Q]=arguments[Q];return!G.some(function(se){return!(se&&typeof se.getBoundingClientRect=="function")})}B(z,"areValidElements");function $(Z){Z===void 0&&(Z={});var G=Z,Q=G.defaultModifiers,se=Q===void 0?[]:Q,ce=G.defaultOptions,be=ce===void 0?D:ce;return B(function(Re,oe,ie){ie===void 0&&(ie=be);var ae={placement:"bottom",orderedModifiers:[],options:Object.assign({},D,be),modifiersData:{},elements:{reference:Re,popper:oe},attributes:{},styles:{}},xe=[],ne=!1,we={state:ae,setOptions:B(function(Le){var Ge=typeof Le=="function"?Le(ae.options):Le;Me(),ae.options=Object.assign({},be,ae.options,Ge),ae.scrollParents={reference:(0,O.kK)(Re)?(0,v.Z)(Re):Re.contextElement?(0,v.Z)(Re.contextElement):[],popper:(0,v.Z)(oe)};var Ye=a(F([].concat(se,ae.options.modifiers)));return ae.orderedModifiers=Ye.filter(function(Ke){return Ke.enabled}),ze(),we.update()},"setOptions"),forceUpdate:B(function(){if(!ne){var Le=ae.elements,Ge=Le.reference,Ye=Le.popper;if(z(Ge,Ye)){ae.rects={reference:b(Ge,(0,A.Z)(Ye),ae.options.strategy==="fixed"),popper:(0,u.Z)(Ye)},ae.reset=!1,ae.placement=ae.options.placement,ae.orderedModifiers.forEach(function(_e){return ae.modifiersData[_e.name]=Object.assign({},_e.data)});for(var Ke=0;Ke<ae.orderedModifiers.length;Ke++){if(ae.reset===!0){ae.reset=!1,Ke=-1;continue}var ht=ae.orderedModifiers[Ke],wt=ht.fn,zt=ht.options,Ht=zt===void 0?{}:zt,Wt=ht.name;typeof wt=="function"&&(ae=wt({state:ae,options:Ht,name:Wt,instance:we})||ae)}}}},"forceUpdate"),update:w(function(){return new Promise(function(Pe){we.forceUpdate(),Pe(ae)})}),destroy:B(function(){Me(),ne=!0},"destroy")};if(!z(Re,oe))return we;we.setOptions(ie).then(function(Pe){!ne&&ie.onFirstUpdate&&ie.onFirstUpdate(Pe)});function ze(){ae.orderedModifiers.forEach(function(Pe){var Le=Pe.name,Ge=Pe.options,Ye=Ge===void 0?{}:Ge,Ke=Pe.effect;if(typeof Ke=="function"){var ht=Ke({state:ae,name:Le,instance:we,options:Ye}),wt=B(function(){},"noopFn2");xe.push(ht||wt)}})}B(ze,"runModifierEffects");function Me(){xe.forEach(function(Pe){return Pe()}),xe=[]}return B(Me,"cleanupModifierEffects"),we},"createPopper2")}B($,"popperGenerator");var J=$()},75865:(me,te,S)=>{"use strict";S.d(te,{Z:()=>M});var K=S(52319);function M(I,O){var W=O.getRootNode&&O.getRootNode();if(I.contains(O))return!0;if(W&&(0,K.Zq)(W)){var x=O;do{if(x&&I.isSameNode(x))return!0;x=x.parentNode||x.host}while(x)}return!1}B(M,"contains")},57845:(me,te,S)=>{"use strict";S.d(te,{Z:()=>W});var K=S(52319),M=S(62079),I=S(61378),O=S(16182);function W(x,p,_){p===void 0&&(p=!1),_===void 0&&(_=!1);var l=x.getBoundingClientRect(),d=1,f=1;p&&(0,K.Re)(x)&&(d=x.offsetWidth>0&&(0,M.NM)(l.width)/x.offsetWidth||1,f=x.offsetHeight>0&&(0,M.NM)(l.height)/x.offsetHeight||1);var r=(0,K.kK)(x)?(0,I.Z)(x):window,b=r.visualViewport,u=!(0,O.Z)()&&_,v=(l.left+(u&&b?b.offsetLeft:0))/d,A=(l.top+(u&&b?b.offsetTop:0))/f,C=l.width/d,y=l.height/f;return{width:C,height:y,top:A,right:v+C,bottom:A+y,left:v,x:v,y:A}}B(W,"getBoundingClientRect")},26302:(me,te,S)=>{"use strict";S.d(te,{Z:()=>M});var K=S(61378);function M(I){return(0,K.Z)(I).getComputedStyle(I)}B(M,"getComputedStyle2")},4377:(me,te,S)=>{"use strict";S.d(te,{Z:()=>M});var K=S(52319);function M(I){return(((0,K.kK)(I)?I.ownerDocument:I.document)||window.document).documentElement}B(M,"getDocumentElement")},5618:(me,te,S)=>{"use strict";S.d(te,{Z:()=>M});var K=S(57845);function M(I){var O=(0,K.Z)(I),W=I.offsetWidth,x=I.offsetHeight;return Math.abs(O.width-W)<=1&&(W=O.width),Math.abs(O.height-x)<=1&&(x=O.height),{x:I.offsetLeft,y:I.offsetTop,width:W,height:x}}B(M,"getLayoutRect")},43332:(me,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(M){return M?(M.nodeName||"").toLowerCase():null}B(K,"getNodeName")},52839:(me,te,S)=>{"use strict";S.d(te,{Z:()=>d});var K=S(61378),M=S(43332),I=S(26302),O=S(52319);function W(f){return["table","td","th"].indexOf((0,M.Z)(f))>=0}B(W,"isTableElement");var x=S(85564),p=S(3518);function _(f){return!(0,O.Re)(f)||(0,I.Z)(f).position==="fixed"?null:f.offsetParent}B(_,"getTrueOffsetParent");function l(f){var r=/firefox/i.test((0,p.Z)()),b=/Trident/i.test((0,p.Z)());if(b&&(0,O.Re)(f)){var u=(0,I.Z)(f);if(u.position==="fixed")return null}var v=(0,x.Z)(f);for((0,O.Zq)(v)&&(v=v.host);(0,O.Re)(v)&&["html","body"].indexOf((0,M.Z)(v))<0;){var A=(0,I.Z)(v);if(A.transform!=="none"||A.perspective!=="none"||A.contain==="paint"||["transform","perspective"].indexOf(A.willChange)!==-1||r&&A.willChange==="filter"||r&&A.filter&&A.filter!=="none")return v;v=v.parentNode}return null}B(l,"getContainingBlock");function d(f){for(var r=(0,K.Z)(f),b=_(f);b&&W(b)&&(0,I.Z)(b).position==="static";)b=_(b);return b&&((0,M.Z)(b)==="html"||(0,M.Z)(b)==="body"&&(0,I.Z)(b).position==="static")?r:b||l(f)||r}B(d,"getOffsetParent")},85564:(me,te,S)=>{"use strict";S.d(te,{Z:()=>O});var K=S(43332),M=S(4377),I=S(52319);function O(W){return(0,K.Z)(W)==="html"?W:W.assignedSlot||W.parentNode||((0,I.Zq)(W)?W.host:null)||(0,M.Z)(W)}B(O,"getParentNode")},61378:(me,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(M){if(M==null)return window;if(M.toString()!=="[object Window]"){var I=M.ownerDocument;return I&&I.defaultView||window}return M}B(K,"getWindow")},23111:(me,te,S)=>{"use strict";S.d(te,{Z:()=>M});var K=S(61378);function M(I){var O=(0,K.Z)(I),W=O.pageXOffset,x=O.pageYOffset;return{scrollLeft:W,scrollTop:x}}B(M,"getWindowScroll")},61300:(me,te,S)=>{"use strict";S.d(te,{Z:()=>O});var K=S(57845),M=S(4377),I=S(23111);function O(W){return(0,K.Z)((0,M.Z)(W)).left+(0,I.Z)(W).scrollLeft}B(O,"getWindowScrollBarX")},52319:(me,te,S)=>{"use strict";S.d(te,{Re:()=>I,Zq:()=>O,kK:()=>M});var K=S(61378);function M(W){var x=(0,K.Z)(W).Element;return W instanceof x||W instanceof Element}B(M,"isElement");function I(W){var x=(0,K.Z)(W).HTMLElement;return W instanceof x||W instanceof HTMLElement}B(I,"isHTMLElement");function O(W){if(typeof ShadowRoot>"u")return!1;var x=(0,K.Z)(W).ShadowRoot;return W instanceof x||W instanceof ShadowRoot}B(O,"isShadowRoot")},16182:(me,te,S)=>{"use strict";S.d(te,{Z:()=>M});var K=S(3518);function M(){return!/^((?!chrome|android).)*safari/i.test((0,K.Z)())}B(M,"isLayoutViewport")},10710:(me,te,S)=>{"use strict";S.d(te,{Z:()=>M});var K=S(26302);function M(I){var O=(0,K.Z)(I),W=O.overflow,x=O.overflowX,p=O.overflowY;return/auto|scroll|overlay|hidden/.test(W+p+x)}B(M,"isScrollParent")},26857:(me,te,S)=>{"use strict";S.d(te,{Z:()=>p});var K=S(85564),M=S(10710),I=S(43332),O=S(52319);function W(_){return["html","body","#document"].indexOf((0,I.Z)(_))>=0?_.ownerDocument.body:(0,O.Re)(_)&&(0,M.Z)(_)?_:W((0,K.Z)(_))}B(W,"getScrollParent");var x=S(61378);function p(_,l){var d;l===void 0&&(l=[]);var f=W(_),r=f===((d=_.ownerDocument)==null?void 0:d.body),b=(0,x.Z)(f),u=r?[b].concat(b.visualViewport||[],(0,M.Z)(f)?f:[]):f,v=l.concat(u);return r?v:v.concat(p((0,K.Z)(u)))}B(p,"listScrollParents")},49880:(me,te,S)=>{"use strict";S.d(te,{BL:()=>p,Ct:()=>u,DH:()=>a,F2:()=>I,I:()=>M,MS:()=>z,N7:()=>v,Pj:()=>d,XM:()=>y,YP:()=>r,bw:()=>b,cW:()=>D,d7:()=>W,ij:()=>A,iv:()=>F,k5:()=>f,mv:()=>x,r5:()=>C,t$:()=>O,ut:()=>_,wX:()=>w,we:()=>K,xs:()=>$,zV:()=>l});var K="top",M="bottom",I="right",O="left",W="auto",x=[K,M,I,O],p="start",_="end",l="clippingParents",d="viewport",f="popper",r="reference",b=x.reduce(function(J,Z){return J.concat([Z+"-"+p,Z+"-"+_])},[]),u=[].concat(x,[W]).reduce(function(J,Z){return J.concat([Z,Z+"-"+p,Z+"-"+_])},[]),v="beforeRead",A="read",C="afterRead",y="beforeMain",a="main",w="afterMain",F="beforeWrite",D="write",z="afterWrite",$=[v,A,C,y,a,w,F,D,z]},16572:(me,te,S)=>{"use strict";S.r(te),S.d(te,{afterMain:()=>K.wX,afterRead:()=>K.r5,afterWrite:()=>K.MS,applyStyles:()=>M.Z,arrow:()=>I.Z,auto:()=>K.d7,basePlacements:()=>K.mv,beforeMain:()=>K.XM,beforeRead:()=>K.N7,beforeWrite:()=>K.iv,bottom:()=>K.I,clippingParents:()=>K.zV,computeStyles:()=>O.Z,createPopper:()=>b.fi,createPopperBase:()=>f.fi,createPopperLite:()=>v,detectOverflow:()=>r.Z,end:()=>K.ut,eventListeners:()=>W.Z,flip:()=>x.Z,hide:()=>p.Z,left:()=>K.t$,main:()=>K.DH,modifierPhases:()=>K.xs,offset:()=>_.Z,placements:()=>K.Ct,popper:()=>K.k5,popperGenerator:()=>f.kZ,popperOffsets:()=>l.Z,preventOverflow:()=>d.Z,read:()=>K.ij,reference:()=>K.YP,right:()=>K.F2,start:()=>K.BL,top:()=>K.we,variationPlacements:()=>K.bw,viewport:()=>K.Pj,write:()=>K.cW});var K=S(49880),M=S(32898),I=S(63454),O=S(24502),W=S(72582),x=S(16087),p=S(48051),_=S(61150),l=S(35772),d=S(29228),f=S(5926),r=S(24041),b=S(78224),u=[W.Z,l.Z,O.Z,M.Z],v=(0,f.kZ)({defaultModifiers:u})},32898:(me,te,S)=>{"use strict";S.d(te,{Z:()=>W});var K=S(43332),M=S(52319);function I(x){var p=x.state;Object.keys(p.elements).forEach(function(_){var l=p.styles[_]||{},d=p.attributes[_]||{},f=p.elements[_];!(0,M.Re)(f)||!(0,K.Z)(f)||(Object.assign(f.style,l),Object.keys(d).forEach(function(r){var b=d[r];b===!1?f.removeAttribute(r):f.setAttribute(r,b===!0?"":b)}))})}B(I,"applyStyles");function O(x){var p=x.state,_={popper:{position:p.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(p.elements.popper.style,_.popper),p.styles=_,p.elements.arrow&&Object.assign(p.elements.arrow.style,_.arrow),function(){Object.keys(p.elements).forEach(function(l){var d=p.elements[l],f=p.attributes[l]||{},r=Object.keys(p.styles.hasOwnProperty(l)?p.styles[l]:_[l]),b=r.reduce(function(u,v){return u[v]="",u},{});!(0,M.Re)(d)||!(0,K.Z)(d)||(Object.assign(d.style,b),Object.keys(f).forEach(function(u){d.removeAttribute(u)}))})}}B(O,"effect");const W={name:"applyStyles",enabled:!0,phase:"write",fn:I,effect:O,requires:["computeStyles"]}},63454:(me,te,S)=>{"use strict";S.d(te,{Z:()=>b});var K=S(65352),M=S(5618),I=S(75865),O=S(52839),W=S(61919),x=S(72907),p=S(49534),_=S(62219),l=S(49880),d=B(function(v,A){return v=typeof v=="function"?v(Object.assign({},A.rects,{placement:A.placement})):v,(0,p.Z)(typeof v!="number"?v:(0,_.Z)(v,l.mv))},"toPaddingObject2");function f(u){var v,A=u.state,C=u.name,y=u.options,a=A.elements.arrow,w=A.modifiersData.popperOffsets,F=(0,K.Z)(A.placement),D=(0,W.Z)(F),z=[l.t$,l.F2].indexOf(F)>=0,$=z?"height":"width";if(!(!a||!w)){var J=d(y.padding,A),Z=(0,M.Z)(a),G=D==="y"?l.we:l.t$,Q=D==="y"?l.I:l.F2,se=A.rects.reference[$]+A.rects.reference[D]-w[D]-A.rects.popper[$],ce=w[D]-A.rects.reference[D],be=(0,O.Z)(a),ve=be?D==="y"?be.clientHeight||0:be.clientWidth||0:0,Re=se/2-ce/2,oe=J[G],ie=ve-Z[$]-J[Q],ae=ve/2-Z[$]/2+Re,xe=(0,x.u)(oe,ae,ie),ne=D;A.modifiersData[C]=(v={},v[ne]=xe,v.centerOffset=xe-ae,v)}}B(f,"arrow");function r(u){var v=u.state,A=u.options,C=A.element,y=C===void 0?"[data-popper-arrow]":C;y!=null&&(typeof y=="string"&&(y=v.elements.popper.querySelector(y),!y)||(0,I.Z)(v.elements.popper,y)&&(v.elements.arrow=y))}B(r,"effect");const b={name:"arrow",enabled:!0,phase:"main",fn:f,effect:r,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]}},24502:(me,te,S)=>{"use strict";S.d(te,{Z:()=>b});var K=S(49880),M=S(52839),I=S(61378),O=S(4377),W=S(26302),x=S(65352),p=S(47408),_=S(62079),l={top:"auto",right:"auto",bottom:"auto",left:"auto"};function d(u,v){var A=u.x,C=u.y,y=v.devicePixelRatio||1;return{x:(0,_.NM)(A*y)/y||0,y:(0,_.NM)(C*y)/y||0}}B(d,"roundOffsetsByDPR");function f(u){var v,A=u.popper,C=u.popperRect,y=u.placement,a=u.variation,w=u.offsets,F=u.position,D=u.gpuAcceleration,z=u.adaptive,$=u.roundOffsets,J=u.isFixed,Z=w.x,G=Z===void 0?0:Z,Q=w.y,se=Q===void 0?0:Q,ce=typeof $=="function"?$({x:G,y:se}):{x:G,y:se};G=ce.x,se=ce.y;var be=w.hasOwnProperty("x"),ve=w.hasOwnProperty("y"),Re=K.t$,oe=K.we,ie=window;if(z){var ae=(0,M.Z)(A),xe="clientHeight",ne="clientWidth";if(ae===(0,I.Z)(A)&&(ae=(0,O.Z)(A),(0,W.Z)(ae).position!=="static"&&F==="absolute"&&(xe="scrollHeight",ne="scrollWidth")),ae=ae,y===K.we||(y===K.t$||y===K.F2)&&a===K.ut){oe=K.I;var we=J&&ae===ie&&ie.visualViewport?ie.visualViewport.height:ae[xe];se-=we-C.height,se*=D?1:-1}if(y===K.t$||(y===K.we||y===K.I)&&a===K.ut){Re=K.F2;var ze=J&&ae===ie&&ie.visualViewport?ie.visualViewport.width:ae[ne];G-=ze-C.width,G*=D?1:-1}}var Me=Object.assign({position:F},z&&l),Pe=$===!0?d({x:G,y:se},(0,I.Z)(A)):{x:G,y:se};if(G=Pe.x,se=Pe.y,D){var Le;return Object.assign({},Me,(Le={},Le[oe]=ve?"0":"",Le[Re]=be?"0":"",Le.transform=(ie.devicePixelRatio||1)<=1?"translate("+G+"px, "+se+"px)":"translate3d("+G+"px, "+se+"px, 0)",Le))}return Object.assign({},Me,(v={},v[oe]=ve?se+"px":"",v[Re]=be?G+"px":"",v.transform="",v))}B(f,"mapToStyles");function r(u){var v=u.state,A=u.options,C=A.gpuAcceleration,y=C===void 0?!0:C,a=A.adaptive,w=a===void 0?!0:a,F=A.roundOffsets,D=F===void 0?!0:F,z={placement:(0,x.Z)(v.placement),variation:(0,p.Z)(v.placement),popper:v.elements.popper,popperRect:v.rects.popper,gpuAcceleration:y,isFixed:v.options.strategy==="fixed"};v.modifiersData.popperOffsets!=null&&(v.styles.popper=Object.assign({},v.styles.popper,f(Object.assign({},z,{offsets:v.modifiersData.popperOffsets,position:v.options.strategy,adaptive:w,roundOffsets:D})))),v.modifiersData.arrow!=null&&(v.styles.arrow=Object.assign({},v.styles.arrow,f(Object.assign({},z,{offsets:v.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:D})))),v.attributes.popper=Object.assign({},v.attributes.popper,{"data-popper-placement":v.placement})}B(r,"computeStyles");const b={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:r,data:{}}},72582:(me,te,S)=>{"use strict";S.d(te,{Z:()=>O});var K=S(61378),M={passive:!0};function I(W){var x=W.state,p=W.instance,_=W.options,l=_.scroll,d=l===void 0?!0:l,f=_.resize,r=f===void 0?!0:f,b=(0,K.Z)(x.elements.popper),u=[].concat(x.scrollParents.reference,x.scrollParents.popper);return d&&u.forEach(function(v){v.addEventListener("scroll",p.update,M)}),r&&b.addEventListener("resize",p.update,M),function(){d&&u.forEach(function(v){v.removeEventListener("scroll",p.update,M)}),r&&b.removeEventListener("resize",p.update,M)}}B(I,"effect");const O={name:"eventListeners",enabled:!0,phase:"write",fn:B(function(){},"fn"),effect:I,data:{}}},16087:(me,te,S)=>{"use strict";S.d(te,{Z:()=>r});var K={left:"right",right:"left",bottom:"top",top:"bottom"};function M(b){return b.replace(/left|right|bottom|top/g,function(u){return K[u]})}B(M,"getOppositePlacement");var I=S(65352),O={start:"end",end:"start"};function W(b){return b.replace(/start|end/g,function(u){return O[u]})}B(W,"getOppositeVariationPlacement");var x=S(24041),p=S(47408),_=S(49880);function l(b,u){u===void 0&&(u={});var v=u,A=v.placement,C=v.boundary,y=v.rootBoundary,a=v.padding,w=v.flipVariations,F=v.allowedAutoPlacements,D=F===void 0?_.Ct:F,z=(0,p.Z)(A),$=z?w?_.bw:_.bw.filter(function(G){return(0,p.Z)(G)===z}):_.mv,J=$.filter(function(G){return D.indexOf(G)>=0});J.length===0&&(J=$);var Z=J.reduce(function(G,Q){return G[Q]=(0,x.Z)(b,{placement:Q,boundary:C,rootBoundary:y,padding:a})[(0,I.Z)(Q)],G},{});return Object.keys(Z).sort(function(G,Q){return Z[G]-Z[Q]})}B(l,"computeAutoPlacement");function d(b){if((0,I.Z)(b)===_.d7)return[];var u=M(b);return[W(b),u,W(u)]}B(d,"getExpandedFallbackPlacements");function f(b){var u=b.state,v=b.options,A=b.name;if(!u.modifiersData[A]._skip){for(var C=v.mainAxis,y=C===void 0?!0:C,a=v.altAxis,w=a===void 0?!0:a,F=v.fallbackPlacements,D=v.padding,z=v.boundary,$=v.rootBoundary,J=v.altBoundary,Z=v.flipVariations,G=Z===void 0?!0:Z,Q=v.allowedAutoPlacements,se=u.options.placement,ce=(0,I.Z)(se),be=ce===se,ve=F||(be||!G?[M(se)]:d(se)),Re=[se].concat(ve).reduce(function(ue,Ee){return ue.concat((0,I.Z)(Ee)===_.d7?l(u,{placement:Ee,boundary:z,rootBoundary:$,padding:D,flipVariations:G,allowedAutoPlacements:Q}):Ee)},[]),oe=u.rects.reference,ie=u.rects.popper,ae=new Map,xe=!0,ne=Re[0],we=0;we<Re.length;we++){var ze=Re[we],Me=(0,I.Z)(ze),Pe=(0,p.Z)(ze)===_.BL,Le=[_.we,_.I].indexOf(Me)>=0,Ge=Le?"width":"height",Ye=(0,x.Z)(u,{placement:ze,boundary:z,rootBoundary:$,altBoundary:J,padding:D}),Ke=Le?Pe?_.F2:_.t$:Pe?_.I:_.we;oe[Ge]>ie[Ge]&&(Ke=M(Ke));var ht=M(Ke),wt=[];if(y&&wt.push(Ye[Me]<=0),w&&wt.push(Ye[Ke]<=0,Ye[ht]<=0),wt.every(function(ue){return ue})){ne=ze,xe=!1;break}ae.set(ze,wt)}if(xe)for(var zt=G?3:1,Ht=B(function(Ee){var $e=Re.find(function(He){var Ze=ae.get(He);if(Ze)return Ze.slice(0,Ee).every(function(qe){return qe})});if($e)return ne=$e,"break"},"_loop2"),Wt=zt;Wt>0;Wt--){var _e=Ht(Wt);if(_e==="break")break}u.placement!==ne&&(u.modifiersData[A]._skip=!0,u.placement=ne,u.reset=!0)}}B(f,"flip");const r={name:"flip",enabled:!0,phase:"main",fn:f,requiresIfExists:["offset"],data:{_skip:!1}}},48051:(me,te,S)=>{"use strict";S.d(te,{Z:()=>x});var K=S(49880),M=S(24041);function I(p,_,l){return l===void 0&&(l={x:0,y:0}),{top:p.top-_.height-l.y,right:p.right-_.width+l.x,bottom:p.bottom-_.height+l.y,left:p.left-_.width-l.x}}B(I,"getSideOffsets");function O(p){return[K.we,K.F2,K.I,K.t$].some(function(_){return p[_]>=0})}B(O,"isAnySideFullyClipped");function W(p){var _=p.state,l=p.name,d=_.rects.reference,f=_.rects.popper,r=_.modifiersData.preventOverflow,b=(0,M.Z)(_,{elementContext:"reference"}),u=(0,M.Z)(_,{altBoundary:!0}),v=I(b,d),A=I(u,f,r),C=O(v),y=O(A);_.modifiersData[l]={referenceClippingOffsets:v,popperEscapeOffsets:A,isReferenceHidden:C,hasPopperEscaped:y},_.attributes.popper=Object.assign({},_.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":y})}B(W,"hide");const x={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:W}},61150:(me,te,S)=>{"use strict";S.d(te,{Z:()=>W});var K=S(65352),M=S(49880);function I(x,p,_){var l=(0,K.Z)(x),d=[M.t$,M.we].indexOf(l)>=0?-1:1,f=typeof _=="function"?_(Object.assign({},p,{placement:x})):_,r=f[0],b=f[1];return r=r||0,b=(b||0)*d,[M.t$,M.F2].indexOf(l)>=0?{x:b,y:r}:{x:r,y:b}}B(I,"distanceAndSkiddingToXY");function O(x){var p=x.state,_=x.options,l=x.name,d=_.offset,f=d===void 0?[0,0]:d,r=M.Ct.reduce(function(A,C){return A[C]=I(C,p.rects,f),A},{}),b=r[p.placement],u=b.x,v=b.y;p.modifiersData.popperOffsets!=null&&(p.modifiersData.popperOffsets.x+=u,p.modifiersData.popperOffsets.y+=v),p.modifiersData[l]=r}B(O,"offset");const W={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:O}},35772:(me,te,S)=>{"use strict";S.d(te,{Z:()=>I});var K=S(47840);function M(O){var W=O.state,x=O.name;W.modifiersData[x]=(0,K.Z)({reference:W.rects.reference,element:W.rects.popper,strategy:"absolute",placement:W.placement})}B(M,"popperOffsets");const I={name:"popperOffsets",enabled:!0,phase:"read",fn:M,data:{}}},29228:(me,te,S)=>{"use strict";S.d(te,{Z:()=>b});var K=S(49880),M=S(65352),I=S(61919);function O(u){return u==="x"?"y":"x"}B(O,"getAltAxis");var W=S(72907),x=S(5618),p=S(52839),_=S(24041),l=S(47408),d=S(29852),f=S(62079);function r(u){var v=u.state,A=u.options,C=u.name,y=A.mainAxis,a=y===void 0?!0:y,w=A.altAxis,F=w===void 0?!1:w,D=A.boundary,z=A.rootBoundary,$=A.altBoundary,J=A.padding,Z=A.tether,G=Z===void 0?!0:Z,Q=A.tetherOffset,se=Q===void 0?0:Q,ce=(0,_.Z)(v,{boundary:D,rootBoundary:z,padding:J,altBoundary:$}),be=(0,M.Z)(v.placement),ve=(0,l.Z)(v.placement),Re=!ve,oe=(0,I.Z)(be),ie=O(oe),ae=v.modifiersData.popperOffsets,xe=v.rects.reference,ne=v.rects.popper,we=typeof se=="function"?se(Object.assign({},v.rects,{placement:v.placement})):se,ze=typeof we=="number"?{mainAxis:we,altAxis:we}:Object.assign({mainAxis:0,altAxis:0},we),Me=v.modifiersData.offset?v.modifiersData.offset[v.placement]:null,Pe={x:0,y:0};if(ae){if(a){var Le,Ge=oe==="y"?K.we:K.t$,Ye=oe==="y"?K.I:K.F2,Ke=oe==="y"?"height":"width",ht=ae[oe],wt=ht+ce[Ge],zt=ht-ce[Ye],Ht=G?-ne[Ke]/2:0,Wt=ve===K.BL?xe[Ke]:ne[Ke],_e=ve===K.BL?-ne[Ke]:-xe[Ke],ue=v.elements.arrow,Ee=G&&ue?(0,x.Z)(ue):{width:0,height:0},$e=v.modifiersData["arrow#persistent"]?v.modifiersData["arrow#persistent"].padding:(0,d.Z)(),He=$e[Ge],Ze=$e[Ye],qe=(0,W.u)(0,xe[Ke],Ee[Ke]),it=Re?xe[Ke]/2-Ht-qe-He-ze.mainAxis:Wt-qe-He-ze.mainAxis,xt=Re?-xe[Ke]/2+Ht+qe+Ze+ze.mainAxis:_e+qe+Ze+ze.mainAxis,Kt=v.elements.arrow&&(0,p.Z)(v.elements.arrow),st=Kt?oe==="y"?Kt.clientTop||0:Kt.clientLeft||0:0,c=(Le=Me?.[oe])!=null?Le:0,m=ht+it-c-st,N=ht+xt-c,P=(0,W.u)(G?(0,f.VV)(wt,m):wt,ht,G?(0,f.Fp)(zt,N):zt);ae[oe]=P,Pe[oe]=P-ht}if(F){var V,H=oe==="x"?K.we:K.t$,j=oe==="x"?K.I:K.F2,U=ae[ie],ee=ie==="y"?"height":"width",he=U+ce[H],Se=U-ce[j],Te=[K.we,K.t$].indexOf(be)!==-1,Be=(V=Me?.[ie])!=null?V:0,Y=Te?he:U-xe[ee]-ne[ee]-Be+ze.altAxis,ge=Te?U+xe[ee]+ne[ee]-Be-ze.altAxis:Se,re=G&&Te?(0,W.q)(Y,U,ge):(0,W.u)(G?Y:he,U,G?ge:Se);ae[ie]=re,Pe[ie]=re-U}v.modifiersData[C]=Pe}}B(r,"preventOverflow");const b={name:"preventOverflow",enabled:!0,phase:"main",fn:r,requiresIfExists:["offset"]}},78224:(me,te,S)=>{"use strict";S.d(te,{fi:()=>r});var K=S(5926),M=S(72582),I=S(35772),O=S(24502),W=S(32898),x=S(61150),p=S(16087),_=S(29228),l=S(63454),d=S(48051),f=[M.Z,I.Z,O.Z,W.Z,x.Z,p.Z,_.Z,l.Z,d.Z],r=(0,K.kZ)({defaultModifiers:f})},47840:(me,te,S)=>{"use strict";S.d(te,{Z:()=>W});var K=S(65352),M=S(47408),I=S(61919),O=S(49880);function W(x){var p=x.reference,_=x.element,l=x.placement,d=l?(0,K.Z)(l):null,f=l?(0,M.Z)(l):null,r=p.x+p.width/2-_.width/2,b=p.y+p.height/2-_.height/2,u;switch(d){case O.we:u={x:r,y:p.y-_.height};break;case O.I:u={x:r,y:p.y+p.height};break;case O.F2:u={x:p.x+p.width,y:b};break;case O.t$:u={x:p.x-_.width,y:b};break;default:u={x:p.x,y:p.y}}var v=d?(0,I.Z)(d):null;if(v!=null){var A=v==="y"?"height":"width";switch(f){case O.BL:u[v]=u[v]-(p[A]/2-_[A]/2);break;case O.ut:u[v]=u[v]+(p[A]/2-_[A]/2);break;default:}}return u}B(W,"computeOffsets")},24041:(me,te,S)=>{"use strict";S.d(te,{Z:()=>Z});var K=S(49880),M=S(61378),I=S(4377),O=S(61300),W=S(16182);function x(G,Q){var se=(0,M.Z)(G),ce=(0,I.Z)(G),be=se.visualViewport,ve=ce.clientWidth,Re=ce.clientHeight,oe=0,ie=0;if(be){ve=be.width,Re=be.height;var ae=(0,W.Z)();(ae||!ae&&Q==="fixed")&&(oe=be.offsetLeft,ie=be.offsetTop)}return{width:ve,height:Re,x:oe+(0,O.Z)(G),y:ie}}B(x,"getViewportRect");var p=S(26302),_=S(23111),l=S(62079);function d(G){var Q,se=(0,I.Z)(G),ce=(0,_.Z)(G),be=(Q=G.ownerDocument)==null?void 0:Q.body,ve=(0,l.Fp)(se.scrollWidth,se.clientWidth,be?be.scrollWidth:0,be?be.clientWidth:0),Re=(0,l.Fp)(se.scrollHeight,se.clientHeight,be?be.scrollHeight:0,be?be.clientHeight:0),oe=-ce.scrollLeft+(0,O.Z)(G),ie=-ce.scrollTop;return(0,p.Z)(be||se).direction==="rtl"&&(oe+=(0,l.Fp)(se.clientWidth,be?be.clientWidth:0)-ve),{width:ve,height:Re,x:oe,y:ie}}B(d,"getDocumentRect");var f=S(26857),r=S(52839),b=S(52319),u=S(57845),v=S(85564),A=S(75865),C=S(43332);function y(G){return Object.assign({},G,{left:G.x,top:G.y,right:G.x+G.width,bottom:G.y+G.height})}B(y,"rectToClientRect");function a(G,Q){var se=(0,u.Z)(G,!1,Q==="fixed");return se.top=se.top+G.clientTop,se.left=se.left+G.clientLeft,se.bottom=se.top+G.clientHeight,se.right=se.left+G.clientWidth,se.width=G.clientWidth,se.height=G.clientHeight,se.x=se.left,se.y=se.top,se}B(a,"getInnerBoundingClientRect");function w(G,Q,se){return Q===K.Pj?y(x(G,se)):(0,b.kK)(Q)?a(Q,se):y(d((0,I.Z)(G)))}B(w,"getClientRectFromMixedType");function F(G){var Q=(0,f.Z)((0,v.Z)(G)),se=["absolute","fixed"].indexOf((0,p.Z)(G).position)>=0,ce=se&&(0,b.Re)(G)?(0,r.Z)(G):G;return(0,b.kK)(ce)?Q.filter(function(be){return(0,b.kK)(be)&&(0,A.Z)(be,ce)&&(0,C.Z)(be)!=="body"}):[]}B(F,"getClippingParents");function D(G,Q,se,ce){var be=Q==="clippingParents"?F(G):[].concat(Q),ve=[].concat(be,[se]),Re=ve[0],oe=ve.reduce(function(ie,ae){var xe=w(G,ae,ce);return ie.top=(0,l.Fp)(xe.top,ie.top),ie.right=(0,l.VV)(xe.right,ie.right),ie.bottom=(0,l.VV)(xe.bottom,ie.bottom),ie.left=(0,l.Fp)(xe.left,ie.left),ie},w(G,Re,ce));return oe.width=oe.right-oe.left,oe.height=oe.bottom-oe.top,oe.x=oe.left,oe.y=oe.top,oe}B(D,"getClippingRect");var z=S(47840),$=S(49534),J=S(62219);function Z(G,Q){Q===void 0&&(Q={});var se=Q,ce=se.placement,be=ce===void 0?G.placement:ce,ve=se.strategy,Re=ve===void 0?G.strategy:ve,oe=se.boundary,ie=oe===void 0?K.zV:oe,ae=se.rootBoundary,xe=ae===void 0?K.Pj:ae,ne=se.elementContext,we=ne===void 0?K.k5:ne,ze=se.altBoundary,Me=ze===void 0?!1:ze,Pe=se.padding,Le=Pe===void 0?0:Pe,Ge=(0,$.Z)(typeof Le!="number"?Le:(0,J.Z)(Le,K.mv)),Ye=we===K.k5?K.YP:K.k5,Ke=G.rects.popper,ht=G.elements[Me?Ye:we],wt=D((0,b.kK)(ht)?ht:ht.contextElement||(0,I.Z)(G.elements.popper),ie,xe,Re),zt=(0,u.Z)(G.elements.reference),Ht=(0,z.Z)({reference:zt,element:Ke,strategy:"absolute",placement:be}),Wt=y(Object.assign({},Ke,Ht)),_e=we===K.k5?Wt:zt,ue={top:wt.top-_e.top+Ge.top,bottom:_e.bottom-wt.bottom+Ge.bottom,left:wt.left-_e.left+Ge.left,right:_e.right-wt.right+Ge.right},Ee=G.modifiersData.offset;if(we===K.k5&&Ee){var $e=Ee[be];Object.keys(ue).forEach(function(He){var Ze=[K.F2,K.I].indexOf(He)>=0?1:-1,qe=[K.we,K.I].indexOf(He)>=0?"y":"x";ue[He]+=$e[qe]*Ze})}return ue}B(Z,"detectOverflow")},62219:(me,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(M,I){return I.reduce(function(O,W){return O[W]=M,O},{})}B(K,"expandToHashMap")},65352:(me,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(M){return M.split("-")[0]}B(K,"getBasePlacement")},29852:(me,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(){return{top:0,right:0,bottom:0,left:0}}B(K,"getFreshSideObject")},61919:(me,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(M){return["top","bottom"].indexOf(M)>=0?"x":"y"}B(K,"getMainAxisFromPlacement")},47408:(me,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(M){return M.split("-")[1]}B(K,"getVariation")},62079:(me,te,S)=>{"use strict";S.d(te,{Fp:()=>K,NM:()=>I,VV:()=>M});var K=Math.max,M=Math.min,I=Math.round},49534:(me,te,S)=>{"use strict";S.d(te,{Z:()=>M});var K=S(29852);function M(I){return Object.assign({},(0,K.Z)(),I)}B(M,"mergePaddingObject")},3518:(me,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(){var M=navigator.userAgentData;return M!=null&&M.brands&&Array.isArray(M.brands)?M.brands.map(function(I){return I.brand+"/"+I.version}).join(" "):navigator.userAgent}B(K,"getUAString")},72907:(me,te,S)=>{"use strict";S.d(te,{q:()=>I,u:()=>M});var K=S(62079);function M(O,W,x){return(0,K.Fp)(O,(0,K.VV)(W,x))}B(M,"within");function I(O,W,x){var p=M(O,W,x);return p>x?x:p}B(I,"withinMaxClamp")},41182:function(me,te,S){(function(K,M){me.exports=te=M()})(this,function(){var K=K||function(M,I){var O;if(typeof window<"u"&&window.crypto&&(O=window.crypto),typeof self<"u"&&self.crypto&&(O=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(O=globalThis.crypto),!O&&typeof window<"u"&&window.msCrypto&&(O=window.msCrypto),!O&&typeof global<"u"&&global.crypto&&(O=global.crypto),!O)try{O=S(91054)}catch{}var W=B(function(){if(O){if(typeof O.getRandomValues=="function")try{return O.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof O.randomBytes=="function")try{return O.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},"cryptoSecureRandomInt"),x=Object.create||function(){function y(){}return B(y,"F"),function(a){var w;return y.prototype=a,w=new y,y.prototype=null,w}}(),p={},_=p.lib={},l=_.Base=function(){return{extend:function(y){var a=x(this);return y&&a.mixIn(y),(!a.hasOwnProperty("init")||this.init===a.init)&&(a.init=function(){a.$super.init.apply(this,arguments)}),a.init.prototype=a,a.$super=this,a},create:function(){var y=this.extend();return y.init.apply(y,arguments),y},init:function(){},mixIn:function(y){for(var a in y)y.hasOwnProperty(a)&&(this[a]=y[a]);y.hasOwnProperty("toString")&&(this.toString=y.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=_.WordArray=l.extend({init:function(y,a){y=this.words=y||[],a!=I?this.sigBytes=a:this.sigBytes=y.length*4},toString:function(y){return(y||r).stringify(this)},concat:function(y){var a=this.words,w=y.words,F=this.sigBytes,D=y.sigBytes;if(this.clamp(),F%4)for(var z=0;z<D;z++){var $=w[z>>>2]>>>24-z%4*8&255;a[F+z>>>2]|=$<<24-(F+z)%4*8}else for(var J=0;J<D;J+=4)a[F+J>>>2]=w[J>>>2];return this.sigBytes+=D,this},clamp:function(){var y=this.words,a=this.sigBytes;y[a>>>2]&=4294967295<<32-a%4*8,y.length=M.ceil(a/4)},clone:function(){var y=l.clone.call(this);return y.words=this.words.slice(0),y},random:function(y){for(var a=[],w=0;w<y;w+=4)a.push(W());return new d.init(a,y)}}),f=p.enc={},r=f.Hex={stringify:function(y){for(var a=y.words,w=y.sigBytes,F=[],D=0;D<w;D++){var z=a[D>>>2]>>>24-D%4*8&255;F.push((z>>>4).toString(16)),F.push((z&15).toString(16))}return F.join("")},parse:function(y){for(var a=y.length,w=[],F=0;F<a;F+=2)w[F>>>3]|=parseInt(y.substr(F,2),16)<<24-F%8*4;return new d.init(w,a/2)}},b=f.Latin1={stringify:function(y){for(var a=y.words,w=y.sigBytes,F=[],D=0;D<w;D++){var z=a[D>>>2]>>>24-D%4*8&255;F.push(String.fromCharCode(z))}return F.join("")},parse:function(y){for(var a=y.length,w=[],F=0;F<a;F++)w[F>>>2]|=(y.charCodeAt(F)&255)<<24-F%4*8;return new d.init(w,a)}},u=f.Utf8={stringify:function(y){try{return decodeURIComponent(escape(b.stringify(y)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(y){return b.parse(unescape(encodeURIComponent(y)))}},v=_.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(y){typeof y=="string"&&(y=u.parse(y)),this._data.concat(y),this._nDataBytes+=y.sigBytes},_process:function(y){var a,w=this._data,F=w.words,D=w.sigBytes,z=this.blockSize,$=z*4,J=D/$;y?J=M.ceil(J):J=M.max((J|0)-this._minBufferSize,0);var Z=J*z,G=M.min(Z*4,D);if(Z){for(var Q=0;Q<Z;Q+=z)this._doProcessBlock(F,Q);a=F.splice(0,Z),w.sigBytes-=G}return new d.init(a,G)},clone:function(){var y=l.clone.call(this);return y._data=this._data.clone(),y},_minBufferSize:0}),A=_.Hasher=v.extend({cfg:l.extend(),init:function(y){this.cfg=this.cfg.extend(y),this.reset()},reset:function(){v.reset.call(this),this._doReset()},update:function(y){return this._append(y),this._process(),this},finalize:function(y){y&&this._append(y);var a=this._doFinalize();return a},blockSize:512/32,_createHelper:function(y){return function(a,w){return new y.init(w).finalize(a)}},_createHmacHelper:function(y){return function(a,w){return new C.HMAC.init(y,w).finalize(a)}}}),C=p.algo={};return p}(Math);return K})},99968:function(me,te,S){(function(K,M){me.exports=te=M(S(41182))})(this,function(K){return function(){var M=K,I=M.lib,O=I.WordArray,W=I.Hasher,x=M.algo,p=[],_=x.SHA1=W.extend({_doReset:function(){this._hash=new O.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(l,d){for(var f=this._hash.words,r=f[0],b=f[1],u=f[2],v=f[3],A=f[4],C=0;C<80;C++){if(C<16)p[C]=l[d+C]|0;else{var y=p[C-3]^p[C-8]^p[C-14]^p[C-16];p[C]=y<<1|y>>>31}var a=(r<<5|r>>>27)+A+p[C];C<20?a+=(b&u|~b&v)+1518500249:C<40?a+=(b^u^v)+1859775393:C<60?a+=(b&u|b&v|u&v)-1894007588:a+=(b^u^v)-899497514,A=v,v=u,u=b<<30|b>>>2,b=r,r=a}f[0]=f[0]+r|0,f[1]=f[1]+b|0,f[2]=f[2]+u|0,f[3]=f[3]+v|0,f[4]=f[4]+A|0},_doFinalize:function(){var l=this._data,d=l.words,f=this._nDataBytes*8,r=l.sigBytes*8;return d[r>>>5]|=128<<24-r%32,d[(r+64>>>9<<4)+14]=Math.floor(f/4294967296),d[(r+64>>>9<<4)+15]=f,l.sigBytes=d.length*4,this._process(),this._hash},clone:function(){var l=W.clone.call(this);return l._hash=this._hash.clone(),l}});M.SHA1=W._createHelper(_),M.HmacSHA1=W._createHmacHelper(_)}(),K.SHA1})},51722:function(me){(function(te,S){me.exports=S()})(this,function(){"use strict";var te=1e3,S=6e4,K=36e5,M="millisecond",I="second",O="minute",W="hour",x="day",p="week",_="month",l="quarter",d="year",f="date",r="Invalid Date",b=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,u=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},A=B(function(Z,G,Q){var se=String(Z);return!se||se.length>=G?Z:""+Array(G+1-se.length).join(Q)+Z},"m"),C={s:A,z:function(Z){var G=-Z.utcOffset(),Q=Math.abs(G),se=Math.floor(Q/60),ce=Q%60;return(G<=0?"+":"-")+A(se,2,"0")+":"+A(ce,2,"0")},m:B(function Z(G,Q){if(G.date()<Q.date())return-Z(Q,G);var se=12*(Q.year()-G.year())+(Q.month()-G.month()),ce=G.clone().add(se,_),be=Q-ce<0,ve=G.clone().add(se+(be?-1:1),_);return+(-(se+(Q-ce)/(be?ce-ve:ve-ce))||0)},"t3"),a:function(Z){return Z<0?Math.ceil(Z)||0:Math.floor(Z)},p:function(Z){return{M:_,y:d,w:p,d:x,D:f,h:W,m:O,s:I,ms:M,Q:l}[Z]||String(Z||"").toLowerCase().replace(/s$/,"")},u:function(Z){return Z===void 0}},y="en",a={};a[y]=v;var w=B(function(Z){return Z instanceof $},"p"),F=B(function(Z,G,Q){var se;if(!Z)return y;if(typeof Z=="string")a[Z]&&(se=Z),G&&(a[Z]=G,se=Z);else{var ce=Z.name;a[ce]=Z,se=ce}return!Q&&se&&(y=se),se||!Q&&y},"S"),D=B(function(Z,G){if(w(Z))return Z.clone();var Q=typeof G=="object"?G:{};return Q.date=Z,Q.args=arguments,new $(Q)},"w"),z=C;z.l=F,z.i=w,z.w=function(Z,G){return D(Z,{locale:G.$L,utc:G.$u,x:G.$x,$offset:G.$offset})};var $=function(){function Z(Q){this.$L=F(Q.locale,null,!0),this.parse(Q)}B(Z,"M2");var G=Z.prototype;return G.parse=function(Q){this.$d=function(se){var ce=se.date,be=se.utc;if(ce===null)return new Date(NaN);if(z.u(ce))return new Date;if(ce instanceof Date)return new Date(ce);if(typeof ce=="string"&&!/Z$/i.test(ce)){var ve=ce.match(b);if(ve){var Re=ve[2]-1||0,oe=(ve[7]||"0").substring(0,3);return be?new Date(Date.UTC(ve[1],Re,ve[3]||1,ve[4]||0,ve[5]||0,ve[6]||0,oe)):new Date(ve[1],Re,ve[3]||1,ve[4]||0,ve[5]||0,ve[6]||0,oe)}}return new Date(ce)}(Q),this.$x=Q.x||{},this.init()},G.init=function(){var Q=this.$d;this.$y=Q.getFullYear(),this.$M=Q.getMonth(),this.$D=Q.getDate(),this.$W=Q.getDay(),this.$H=Q.getHours(),this.$m=Q.getMinutes(),this.$s=Q.getSeconds(),this.$ms=Q.getMilliseconds()},G.$utils=function(){return z},G.isValid=function(){return this.$d.toString()!==r},G.isSame=function(Q,se){var ce=D(Q);return this.startOf(se)<=ce&&ce<=this.endOf(se)},G.isAfter=function(Q,se){return D(Q)<this.startOf(se)},G.isBefore=function(Q,se){return this.endOf(se)<D(Q)},G.$g=function(Q,se,ce){return z.u(Q)?this[se]:this.set(ce,Q)},G.unix=function(){return Math.floor(this.valueOf()/1e3)},G.valueOf=function(){return this.$d.getTime()},G.startOf=function(Q,se){var ce=this,be=!!z.u(se)||se,ve=z.p(Q),Re=B(function(Me,Pe){var Le=z.w(ce.$u?Date.UTC(ce.$y,Pe,Me):new Date(ce.$y,Pe,Me),ce);return be?Le:Le.endOf(x)},"$2"),oe=B(function(Me,Pe){return z.w(ce.toDate()[Me].apply(ce.toDate("s"),(be?[0,0,0,0]:[23,59,59,999]).slice(Pe)),ce)},"l2"),ie=this.$W,ae=this.$M,xe=this.$D,ne="set"+(this.$u?"UTC":"");switch(ve){case d:return be?Re(1,0):Re(31,11);case _:return be?Re(1,ae):Re(0,ae+1);case p:var we=this.$locale().weekStart||0,ze=(ie<we?ie+7:ie)-we;return Re(be?xe-ze:xe+(6-ze),ae);case x:case f:return oe(ne+"Hours",0);case W:return oe(ne+"Minutes",1);case O:return oe(ne+"Seconds",2);case I:return oe(ne+"Milliseconds",3);default:return this.clone()}},G.endOf=function(Q){return this.startOf(Q,!1)},G.$set=function(Q,se){var ce,be=z.p(Q),ve="set"+(this.$u?"UTC":""),Re=(ce={},ce[x]=ve+"Date",ce[f]=ve+"Date",ce[_]=ve+"Month",ce[d]=ve+"FullYear",ce[W]=ve+"Hours",ce[O]=ve+"Minutes",ce[I]=ve+"Seconds",ce[M]=ve+"Milliseconds",ce)[be],oe=be===x?this.$D+(se-this.$W):se;if(be===_||be===d){var ie=this.clone().set(f,1);ie.$d[Re](oe),ie.init(),this.$d=ie.set(f,Math.min(this.$D,ie.daysInMonth())).$d}else Re&&this.$d[Re](oe);return this.init(),this},G.set=function(Q,se){return this.clone().$set(Q,se)},G.get=function(Q){return this[z.p(Q)]()},G.add=function(Q,se){var ce,be=this;Q=Number(Q);var ve=z.p(se),Re=B(function(ae){var xe=D(be);return z.w(xe.date(xe.date()+Math.round(ae*Q)),be)},"y2");if(ve===_)return this.set(_,this.$M+Q);if(ve===d)return this.set(d,this.$y+Q);if(ve===x)return Re(1);if(ve===p)return Re(7);var oe=(ce={},ce[O]=S,ce[W]=K,ce[I]=te,ce)[ve]||1,ie=this.$d.getTime()+Q*oe;return z.w(ie,this)},G.subtract=function(Q,se){return this.add(-1*Q,se)},G.format=function(Q){var se=this,ce=this.$locale();if(!this.isValid())return ce.invalidDate||r;var be=Q||"YYYY-MM-DDTHH:mm:ssZ",ve=z.z(this),Re=this.$H,oe=this.$m,ie=this.$M,ae=ce.weekdays,xe=ce.months,ne=B(function(Pe,Le,Ge,Ye){return Pe&&(Pe[Le]||Pe(se,be))||Ge[Le].substr(0,Ye)},"h2"),we=B(function(Pe){return z.s(Re%12||12,Pe,"0")},"c2"),ze=ce.meridiem||function(Pe,Le,Ge){var Ye=Pe<12?"AM":"PM";return Ge?Ye.toLowerCase():Ye},Me={YY:String(this.$y).slice(-2),YYYY:this.$y,M:ie+1,MM:z.s(ie+1,2,"0"),MMM:ne(ce.monthsShort,ie,xe,3),MMMM:ne(xe,ie),D:this.$D,DD:z.s(this.$D,2,"0"),d:String(this.$W),dd:ne(ce.weekdaysMin,this.$W,ae,2),ddd:ne(ce.weekdaysShort,this.$W,ae,3),dddd:ae[this.$W],H:String(Re),HH:z.s(Re,2,"0"),h:we(1),hh:we(2),a:ze(Re,oe,!0),A:ze(Re,oe,!1),m:String(oe),mm:z.s(oe,2,"0"),s:String(this.$s),ss:z.s(this.$s,2,"0"),SSS:z.s(this.$ms,3,"0"),Z:ve};return be.replace(u,function(Pe,Le){return Le||Me[Pe]||ve.replace(":","")})},G.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},G.diff=function(Q,se,ce){var be,ve=z.p(se),Re=D(Q),oe=(Re.utcOffset()-this.utcOffset())*S,ie=this-Re,ae=z.m(this,Re);return ae=(be={},be[d]=ae/12,be[_]=ae,be[l]=ae/3,be[p]=(ie-oe)/6048e5,be[x]=(ie-oe)/864e5,be[W]=ie/K,be[O]=ie/S,be[I]=ie/te,be)[ve]||ie,ce?ae:z.a(ae)},G.daysInMonth=function(){return this.endOf(_).$D},G.$locale=function(){return a[this.$L]},G.locale=function(Q,se){if(!Q)return this.$L;var ce=this.clone(),be=F(Q,se,!0);return be&&(ce.$L=be),ce},G.clone=function(){return z.w(this.$d,this)},G.toDate=function(){return new Date(this.valueOf())},G.toJSON=function(){return this.isValid()?this.toISOString():null},G.toISOString=function(){return this.$d.toISOString()},G.toString=function(){return this.$d.toUTCString()},Z}(),J=$.prototype;return D.prototype=J,[["$ms",M],["$s",I],["$m",O],["$H",W],["$W",x],["$M",_],["$y",d],["$D",f]].forEach(function(Z){J[Z[1]]=function(G){return this.$g(G,Z[0],Z[1])}}),D.extend=function(Z,G){return Z.$i||(Z(G,$,D),Z.$i=!0),D},D.locale=F,D.isDayjs=w,D.unix=function(Z){return D(1e3*Z)},D.en=a[y],D.Ls=a,D.p={},D})},92045:function(me){(function(te,S){me.exports=S()})(this,function(){"use strict";return function(te,S,K){te=te||{};var M=S.prototype,I={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function O(x,p,_,l){return M.fromToBase(x,p,_,l)}B(O,"i"),K.en.relativeTime=I,M.fromToBase=function(x,p,_,l,d){for(var f,r,b,u=_.$locale().relativeTime||I,v=te.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],A=v.length,C=0;C<A;C+=1){var y=v[C];y.d&&(f=l?K(x).diff(_,y.d,!0):_.diff(x,y.d,!0));var a=(te.rounding||Math.round)(Math.abs(f));if(b=f>0,a<=y.r||!y.r){a<=1&&C>0&&(y=v[C-1]);var w=u[y.l];d&&(a=d(""+a)),r=typeof w=="string"?w.replace("%d",a):w(a,p,y.l,b);break}}if(p)return r;var F=b?u.future:u.past;return typeof F=="function"?F(r):F.replace("%s",r)},M.to=function(x,p){return O(x,p,this,!0)},M.from=function(x,p){return O(x,p,this)};var W=B(function(x){return x.$u?K.utc():K()},"d");M.toNow=function(x){return this.to(W(this),x)},M.fromNow=function(x){return this.from(W(this),x)}}})},5199:me=>{"use strict";me.exports=()=>/\u{1F3F4}\u{E0067}\u{E0062}(?:\u{E0077}\u{E006C}\u{E0073}|\u{E0073}\u{E0063}\u{E0074}|\u{E0065}\u{E006E}\u{E0067})\u{E007F}|(?:\u{1F9D1}\u{1F3FF}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FF}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}-\u{1F3FE}]|(?:\u{1F9D1}\u{1F3FE}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FE}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}-\u{1F3FD}\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FD}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FD}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}\u{1F3FC}\u{1F3FE}\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FC}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FC}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}\u{1F3FD}-\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FB}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FB}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FC}-\u{1F3FF}]|\u{1F468}(?:\u{1F3FB}(?:\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FF}]|\u{1F468}[\u{1F3FB}-\u{1F3FF}])|\u{1F91D}\u200D\u{1F468}[\u{1F3FC}-\u{1F3FF}]|[\u2695\u2696\u2708]\uFE0F|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]))?|[\u{1F3FC}-\u{1F3FF}]\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FF}]|\u{1F468}[\u{1F3FB}-\u{1F3FF}])|\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F468}|[\u{1F468}\u{1F469}]\u200D(?:\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}])|\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FE}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FE}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FD}\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FD}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}\u{1F3FC}\u{1F3FE}\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FC}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}\u{1F3FD}-\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])\uFE0F|\u200D(?:[\u{1F468}\u{1F469}]\u200D[\u{1F466}\u{1F467}]|[\u{1F466}\u{1F467}])|\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC})?|(?:\u{1F469}(?:\u{1F3FB}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}])|[\u{1F3FC}-\u{1F3FF}]\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}]))|\u{1F9D1}[\u{1F3FB}-\u{1F3FF}]\u200D\u{1F91D}\u200D\u{1F9D1})[\u{1F3FB}-\u{1F3FF}]|\u{1F469}\u200D\u{1F469}\u200D(?:\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}])|\u{1F469}(?:\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}])|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FE}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FD}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FC}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FB}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F9D1}(?:\u200D(?:\u{1F91D}\u200D\u{1F9D1}|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FE}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FD}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FC}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FB}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F469}\u200D\u{1F466}\u200D\u{1F466}|\u{1F469}\u200D\u{1F469}\u200D[\u{1F466}\u{1F467}]|\u{1F469}\u200D\u{1F467}\u200D[\u{1F466}\u{1F467}]|(?:\u{1F441}\uFE0F\u200D\u{1F5E8}|\u{1F9D1}(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u{1F3FB}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|\u{1F469}(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u{1F3FB}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|\u{1F636}\u200D\u{1F32B}|\u{1F3F3}\uFE0F\u200D\u26A7|\u{1F43B}\u200D\u2744|(?:[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}][\u{1F3FB}-\u{1F3FF}]|[\u{1F46F}\u{1F93C}\u{1F9DE}\u{1F9DF}])\u200D[\u2640\u2642]|[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}][\uFE0F\u{1F3FB}-\u{1F3FF}]\u200D[\u2640\u2642]|\u{1F3F4}\u200D\u2620|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}]\u200D[\u2640\u2642]|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u2600-\u2604\u260E\u2611\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26B0\u26B1\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0\u26F1\u26F4\u26F7\u26F8\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u3030\u303D\u3297\u3299\u{1F170}\u{1F171}\u{1F17E}\u{1F17F}\u{1F202}\u{1F237}\u{1F321}\u{1F324}-\u{1F32C}\u{1F336}\u{1F37D}\u{1F396}\u{1F397}\u{1F399}-\u{1F39B}\u{1F39E}\u{1F39F}\u{1F3CD}\u{1F3CE}\u{1F3D4}-\u{1F3DF}\u{1F3F5}\u{1F3F7}\u{1F43F}\u{1F4FD}\u{1F549}\u{1F54A}\u{1F56F}\u{1F570}\u{1F573}\u{1F576}-\u{1F579}\u{1F587}\u{1F58A}-\u{1F58D}\u{1F5A5}\u{1F5A8}\u{1F5B1}\u{1F5B2}\u{1F5BC}\u{1F5C2}-\u{1F5C4}\u{1F5D1}-\u{1F5D3}\u{1F5DC}-\u{1F5DE}\u{1F5E1}\u{1F5E3}\u{1F5E8}\u{1F5EF}\u{1F5F3}\u{1F5FA}\u{1F6CB}\u{1F6CD}-\u{1F6CF}\u{1F6E0}-\u{1F6E5}\u{1F6E9}\u{1F6F0}\u{1F6F3}])\uFE0F|\u{1F3F3}\uFE0F\u200D\u{1F308}|\u{1F469}\u200D\u{1F467}|\u{1F469}\u200D\u{1F466}|\u{1F635}\u200D\u{1F4AB}|\u{1F62E}\u200D\u{1F4A8}|\u{1F415}\u200D\u{1F9BA}|\u{1F9D1}(?:\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC}|\u{1F3FB})?|\u{1F469}(?:\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC}|\u{1F3FB})?|\u{1F1FD}\u{1F1F0}|\u{1F1F6}\u{1F1E6}|\u{1F1F4}\u{1F1F2}|\u{1F408}\u200D\u2B1B|\u2764\uFE0F\u200D[\u{1F525}\u{1FA79}]|\u{1F441}\uFE0F|\u{1F3F3}\uFE0F|\u{1F1FF}[\u{1F1E6}\u{1F1F2}\u{1F1FC}]|\u{1F1FE}[\u{1F1EA}\u{1F1F9}]|\u{1F1FC}[\u{1F1EB}\u{1F1F8}]|\u{1F1FB}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1EE}\u{1F1F3}\u{1F1FA}]|\u{1F1FA}[\u{1F1E6}\u{1F1EC}\u{1F1F2}\u{1F1F3}\u{1F1F8}\u{1F1FE}\u{1F1FF}]|\u{1F1F9}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1ED}\u{1F1EF}-\u{1F1F4}\u{1F1F7}\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FF}]|\u{1F1F8}[\u{1F1E6}-\u{1F1EA}\u{1F1EC}-\u{1F1F4}\u{1F1F7}-\u{1F1F9}\u{1F1FB}\u{1F1FD}-\u{1F1FF}]|\u{1F1F7}[\u{1F1EA}\u{1F1F4}\u{1F1F8}\u{1F1FA}\u{1F1FC}]|\u{1F1F5}[\u{1F1E6}\u{1F1EA}-\u{1F1ED}\u{1F1F0}-\u{1F1F3}\u{1F1F7}-\u{1F1F9}\u{1F1FC}\u{1F1FE}]|\u{1F1F3}[\u{1F1E6}\u{1F1E8}\u{1F1EA}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F4}\u{1F1F5}\u{1F1F7}\u{1F1FA}\u{1F1FF}]|\u{1F1F2}[\u{1F1E6}\u{1F1E8}-\u{1F1ED}\u{1F1F0}-\u{1F1FF}]|\u{1F1F1}[\u{1F1E6}-\u{1F1E8}\u{1F1EE}\u{1F1F0}\u{1F1F7}-\u{1F1FB}\u{1F1FE}]|\u{1F1F0}[\u{1F1EA}\u{1F1EC}-\u{1F1EE}\u{1F1F2}\u{1F1F3}\u{1F1F5}\u{1F1F7}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1EF}[\u{1F1EA}\u{1F1F2}\u{1F1F4}\u{1F1F5}]|\u{1F1EE}[\u{1F1E8}-\u{1F1EA}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}]|\u{1F1ED}[\u{1F1F0}\u{1F1F2}\u{1F1F3}\u{1F1F7}\u{1F1F9}\u{1F1FA}]|\u{1F1EC}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EE}\u{1F1F1}-\u{1F1F3}\u{1F1F5}-\u{1F1FA}\u{1F1FC}\u{1F1FE}]|\u{1F1EB}[\u{1F1EE}-\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1F7}]|\u{1F1EA}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1ED}\u{1F1F7}-\u{1F1FA}]|\u{1F1E9}[\u{1F1EA}\u{1F1EC}\u{1F1EF}\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1FF}]|\u{1F1E8}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1EE}\u{1F1F0}-\u{1F1F5}\u{1F1F7}\u{1F1FA}-\u{1F1FF}]|\u{1F1E7}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EF}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1E6}[\u{1F1E8}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F2}\u{1F1F4}\u{1F1F6}-\u{1F1FA}\u{1F1FC}\u{1F1FD}\u{1F1FF}]|[#\*0-9]\uFE0F\u20E3|\u2764\uFE0F|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}][\u{1F3FB}-\u{1F3FF}]|[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}][\uFE0F\u{1F3FB}-\u{1F3FF}]|\u{1F3F4}|[\u270A\u270B\u{1F385}\u{1F3C2}\u{1F3C7}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}\u{1F467}\u{1F46B}-\u{1F46D}\u{1F472}\u{1F474}-\u{1F476}\u{1F478}\u{1F47C}\u{1F483}\u{1F485}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F57A}\u{1F595}\u{1F596}\u{1F64C}\u{1F64F}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F930}-\u{1F934}\u{1F936}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9BB}\u{1F9D2}\u{1F9D3}\u{1F9D5}][\u{1F3FB}-\u{1F3FF}]|[\u261D\u270C\u270D\u{1F574}\u{1F590}][\uFE0F\u{1F3FB}-\u{1F3FF}]|[\u270A\u270B\u{1F385}\u{1F3C2}\u{1F3C7}\u{1F408}\u{1F415}\u{1F43B}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}\u{1F467}\u{1F46B}-\u{1F46D}\u{1F472}\u{1F474}-\u{1F476}\u{1F478}\u{1F47C}\u{1F483}\u{1F485}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F57A}\u{1F595}\u{1F596}\u{1F62E}\u{1F635}\u{1F636}\u{1F64C}\u{1F64F}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F930}-\u{1F934}\u{1F936}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9BB}\u{1F9D2}\u{1F9D3}\u{1F9D5}]|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}]|[\u{1F46F}\u{1F93C}\u{1F9DE}\u{1F9DF}]|[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55\u{1F004}\u{1F0CF}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F201}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F236}\u{1F238}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F320}\u{1F32D}-\u{1F335}\u{1F337}-\u{1F37C}\u{1F37E}-\u{1F384}\u{1F386}-\u{1F393}\u{1F3A0}-\u{1F3C1}\u{1F3C5}\u{1F3C6}\u{1F3C8}\u{1F3C9}\u{1F3CF}-\u{1F3D3}\u{1F3E0}-\u{1F3F0}\u{1F3F8}-\u{1F407}\u{1F409}-\u{1F414}\u{1F416}-\u{1F43A}\u{1F43C}-\u{1F43E}\u{1F440}\u{1F444}\u{1F445}\u{1F451}-\u{1F465}\u{1F46A}\u{1F479}-\u{1F47B}\u{1F47D}-\u{1F480}\u{1F484}\u{1F488}-\u{1F48E}\u{1F490}\u{1F492}-\u{1F4A9}\u{1F4AB}-\u{1F4FC}\u{1F4FF}-\u{1F53D}\u{1F54B}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F5A4}\u{1F5FB}-\u{1F62D}\u{1F62F}-\u{1F634}\u{1F637}-\u{1F644}\u{1F648}-\u{1F64A}\u{1F680}-\u{1F6A2}\u{1F6A4}-\u{1F6B3}\u{1F6B7}-\u{1F6BF}\u{1F6C1}-\u{1F6C5}\u{1F6D0}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6EB}\u{1F6EC}\u{1F6F4}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90D}\u{1F90E}\u{1F910}-\u{1F917}\u{1F91D}\u{1F920}-\u{1F925}\u{1F927}-\u{1F92F}\u{1F93A}\u{1F93F}-\u{1F945}\u{1F947}-\u{1F976}\u{1F978}\u{1F97A}-\u{1F9B4}\u{1F9B7}\u{1F9BA}\u{1F9BC}-\u{1F9CB}\u{1F9D0}\u{1F9E0}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]|[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55\u{1F004}\u{1F0CF}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F236}\u{1F238}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F320}\u{1F32D}-\u{1F335}\u{1F337}-\u{1F37C}\u{1F37E}-\u{1F393}\u{1F3A0}-\u{1F3CA}\u{1F3CF}-\u{1F3D3}\u{1F3E0}-\u{1F3F0}\u{1F3F4}\u{1F3F8}-\u{1F43E}\u{1F440}\u{1F442}-\u{1F4FC}\u{1F4FF}-\u{1F53D}\u{1F54B}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F57A}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5FB}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CC}\u{1F6D0}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6EB}\u{1F6EC}\u{1F6F4}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90C}-\u{1F93A}\u{1F93C}-\u{1F945}\u{1F947}-\u{1F978}\u{1F97A}-\u{1F9CB}\u{1F9CD}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]|[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299\u{1F004}\u{1F0CF}\u{1F170}\u{1F171}\u{1F17E}\u{1F17F}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F202}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F321}\u{1F324}-\u{1F393}\u{1F396}\u{1F397}\u{1F399}-\u{1F39B}\u{1F39E}-\u{1F3F0}\u{1F3F3}-\u{1F3F5}\u{1F3F7}-\u{1F4FD}\u{1F4FF}-\u{1F53D}\u{1F549}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F56F}\u{1F570}\u{1F573}-\u{1F57A}\u{1F587}\u{1F58A}-\u{1F58D}\u{1F590}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5A5}\u{1F5A8}\u{1F5B1}\u{1F5B2}\u{1F5BC}\u{1F5C2}-\u{1F5C4}\u{1F5D1}-\u{1F5D3}\u{1F5DC}-\u{1F5DE}\u{1F5E1}\u{1F5E3}\u{1F5E8}\u{1F5EF}\u{1F5F3}\u{1F5FA}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CB}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6E0}-\u{1F6E5}\u{1F6E9}\u{1F6EB}\u{1F6EC}\u{1F6F0}\u{1F6F3}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90C}-\u{1F93A}\u{1F93C}-\u{1F945}\u{1F947}-\u{1F978}\u{1F97A}-\u{1F9CB}\u{1F9CD}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]\uFE0F|[\u261D\u26F9\u270A-\u270D\u{1F385}\u{1F3C2}-\u{1F3C4}\u{1F3C7}\u{1F3CA}-\u{1F3CC}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}-\u{1F478}\u{1F47C}\u{1F481}-\u{1F483}\u{1F485}-\u{1F487}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F574}\u{1F575}\u{1F57A}\u{1F590}\u{1F595}\u{1F596}\u{1F645}-\u{1F647}\u{1F64B}-\u{1F64F}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91F}\u{1F926}\u{1F930}-\u{1F939}\u{1F93C}-\u{1F93E}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9B8}\u{1F9B9}\u{1F9BB}\u{1F9CD}-\u{1F9CF}\u{1F9D1}-\u{1F9DD}]/gu},49276:(me,te,S)=>{"use strict";S.d(te,{D3:()=>p,Dk:()=>b,Vf:()=>A,ZP:()=>y,aA:()=>_,of:()=>l});var K=S(22527),M=S(24431),I=S(46949),O=S(83269),W=S(5199),x=S.n(W);const p=["component"],_={"smileys-emotion":"Smileys & Emotions","people-body":"People",component:"Components","animals-nature":"Animals & Nature","food-drink":"Food & Drink","travel-places":"Travel & Places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"},l=Object.keys(_),d={1:"1f3fb",2:"1f3fc",3:"1f3fd",4:"1f3fe",5:"1f3ff"};let f=!0,r;try{r=new RegExp("(?<!\\u{E0002})\\u{E0002}","gu")}catch{f=!1,r=null}const b=r,u=/\u{200D}/gu,v="\u{E0002}",A={google:"noto",twitter:"twemoji",open:"openmoji",blob:"blob"};function C(F){let D=typeof F=="number"?F:parseInt(F,16);return D<65536?String.fromCharCode(D):(D-=65536,String.fromCharCode(55296+(D>>10),56320+(D&1023)))}B(C,"codepoint_to_emoji");const w=class w extends K.default{constructor(...D){super(...D),this.inject("..emotes"),this.inject("settings"),f?this.settings.add("chat.emoji.replace-joiner",{default:1,process(z,$){return $===2?1:$},ui:{path:"Chat > Behavior >> Emoji",title:"Emoji Joiner Workaround",description:"This feature is intended to allow the use of combined emoji in supported clients. This is required due to a bug in TMI that strips ZWJ characters from chat messages. [Visit the original issue](https://github.com/FrankerFaceZ/FrankerFaceZ/issues/1147) for more details.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Display Only"},{value:3,title:"Display and Send"}]}}):(this.log.warn('This browser does not support regexp lookbehind. The "Emoji Joiner Workaround" feature will be disabled.'),this.settings.add("chat.emoji.replace-joiner",{process(){return 0}})),this.settings.add("chat.emoji.style",{default:"twitter",process(z,$){return $!=0&&!A[$]?"twitter":$},ui:{path:"Chat > Appearance >> Emoji",title:"Emoji Style",component:"setting-select-box",data:[{value:"twitter",title:"Twitter (Twemoji)"},{value:"google",title:"Google (Noto)"},{value:"blob",title:"Blob"},{value:"open",title:"OpenMoji"},{value:0,title:"Native"}]}}),this.splitter=x()(),this.categories=_,this.emoji={},this.names={},this.chars=new Map}onEnable(){this.on("chat:pre-send-message",D=>{D.context.get("chat.emoji.replace-joiner")<2||(D.message=D.message.replace(u,v))}),this.loadEmojiData()}async loadEmojiData(D=0){let z;try{z=await fetch(`${M.SERVER}/script/emoji/v3.2.json?_${(0,O.getBuster)(60)}`).then(Q=>Q.ok?Q.json():null)}catch(Q){return D++,D<10?setTimeout(()=>this.loadEmojiData(D),500*D):(this.log.error("Error loading emoji data.",Q),!1)}if(!z)return!1;const $=z.c,J={},Z={},G=new Map;for(const Q of z.e){const se=Object.assign(a(Q.slice(4)),{category:$[Q[0]],sort:Q[1],names:Q[2],name:Q[3]});Array.isArray(se.names)||(se.names=[se.names]),se.name||(se.name=se.names[0].replace(/_/g," ")),J[se.code]=se,G.set(se.raw,[se.code,null]);for(const ce of se.names)Z[ce]=se.code;if(Q[7]){const ce=se.variants={};for(const be of Q[7]){if(Array.isArray(be[3])||!be[3]){const oe=Object.assign(a(be),{category:$[Q[0]],sort:Q[1],names:be[5],hidden:!0});Array.isArray(oe.names)||(oe.names=[oe.names]),oe.name=oe.names[0].replace(/_/g," "),J[oe.code]=oe,G.set(oe.raw,[oe.code,null]);for(const ie of oe.names)Z[ie]=oe.code;continue}const ve=d[be[3]];if(!ve){console.warn("Unknown tone:",be[3],be,se);continue}const Re=Object.assign(a(be),{key:ve});ce[ve]=Re,G.set(Re.raw,[se.code,Re.key])}}}return this.emoji=J,this.names=Z,this.chars=G,this.log.info(`Loaded data about ${Object.keys(J).length} emoji.`),this.emit(":populated"),!0}getFullImage(D,z){return z||(z=this.parent.context.get("chat.emoji.style")),(0,I.has)(A,z)||(z="twitter"),`${M.SERVER}/static/emoji/images/${A[z]}/${D}`}getFullImageSet(D,z){return z||(z=this.parent.context.get("chat.emoji.style")),(0,I.has)(A,z)||(z="twitter"),`${M.SERVER}/static/emoji/images/${A[z]}/${D} 72w`}};B(w,"Emoji");let y=w;function a(F){let D=F[0];return F[4]===0&&(D=`${D}-fe0f`),{code:D,image:`${F[0]}.png`,raw:D.split("-").map(C).join(""),sheet_x:F[1][0],sheet_y:F[1][1],has:{google:!!(8&F[2]),blob:!!(4&F[2])||!!(8&F[2]),twitter:!!(2&F[2]),open:!!(1&F[2])}}}B(a,"hydrate_emoji")},33612:(me,te,S)=>{"use strict";S.d(te,{Z:()=>O});var K=S(22527);let M=0,I=0;const W=class W extends K.default{constructor(p,_){super(p,_),this._id=`_ffz$${M++}`,this.log.info(`Using: ${this.constructor.name}`)}getReact(){if(this._react)return this._react;let p;try{p=this.getCore?.()?.intl?.react}catch{}if(p?.Component&&p.createElement)return this._react=p;if(p=this.resolve("site.web_munch")?.getModule?.("react"),p?.Component&&p.createElement)return this._react=p}getReactDom(){if(this._reactDom)return this._reactDom;let p=this.resolve("site.web_munch")?.getModule?.("react-dom");if(p?.createPortal)return this._reactDom=p}findReact(){const p=this.getReact();if(p)return Promise.resolve(p);const _=this.resolve("site.web_munch");return _?_.findModule("react"):this.waitFor("site.web_munch:registered").then(()=>this.findReact())}awaitElement(p,_,l=6e4){_||(_=document.documentElement);const d=_.querySelector(p);return d?Promise.resolve(d):new Promise((f,r)=>{const b=`${this._id}$observer`,u=_[b],v=I++,A=l&&setTimeout(()=>{const y=_[b];if(!y)return;const[a,w]=y;for(let F=0;F<w.length;F++){const D=w[F];if(D[0]===v){w.splice(F,1),D[3]("Timed out");break}}w.length||(a.disconnect(),_[b]=null)},l);if(u){u[1].push([v,p,f,r,A]);return}const C=new MutationObserver(()=>{const y=_[b];if(!y){C.disconnect();return}const a=y[1];for(let w=0;w<a.length;w++){const F=a[w],D=_.querySelector(F[1]);D&&(a.splice(w,1),w--,F[4]&&clearTimeout(F[4]),F[2](D))}a.length||(C.disconnect(),_[b]=null)});_[b]=[C,[[v,p,f,r,A]]],C.observe(_,{childList:!0,attributes:!0,characterData:!0,subtree:!0})})}};B(W,"BaseSite");let O=W},10789:(me,te,S)=>{"use strict";S.d(te,{Z:()=>A});var K=S(22527),M=S(44589),I=S(46949),O=S(83342);const W=(0,M.createElement)("span"),x=".video-player__default-player .player-controls__left-control-group",p=".video-player__default-player .player-controls__right-control-group",_=window.AudioContext&&window.DynamicsCompressorNode!=null,l=_&&window.GainNode!=null,d="setting.entry.player.volume-scroll.values",f=[{value:!1,title:"Disabled",i18n_key:`${d}.false`},{value:!0,title:"Enabled",i18n_key:`${d}.true`},{value:2,title:"Enabled with Right-Click",i18n_key:`${d}.2`},{value:3,title:"Enabled with Alt",i18n_key:`${d}.3`},{value:4,title:"Enabled with Alt + Right-Click",i18n_key:`${d}.4`},{value:5,title:"Enabled with Shift",i18n_key:`${d}.5`},{value:6,title:"Enabled with Shift + Right-Click",i18n_key:`${d}.6`},{value:7,title:"Enabled with Ctrl",i18n_key:`${d}.7`},{value:8,title:"Enabled with Ctrl + Right-Click",i18n_key:`${d}.8`}];function r(y){return y.querySelector('button[aria-label*="alt+x"]')??y.querySelector('button[aria-label]:has(path[d="M8 9H6v2h2V9zm1 0h2v2H9V9zm5 0h-2v2h2V9z"]')}B(r,"getNativeClipButton");function b(y){return y===2||y===4||y===6||y===8}B(b,"wantsRMB");function u(y,a,w){return!(b(y)&&a.button!==2&&!w||!a.altKey&&(y===3||y===4)||!a.shiftKey&&(y===5||y===6)||!a.ctrlKey&&(y===7||y===8))}B(u,"matchesEvent");function v(y){const a=y.currentTarget,w=a&&a.querySelector("figure");!w||w.classList.contains("ffz-i-t-reset-clicked")||(w.classList.toggle("ffz-i-t-reset",!1),w.classList.toggle("ffz-i-t-reset-clicked",!0),setTimeout(()=>{w.classList.toggle("ffz-i-t-reset",!0),w.classList.toggle("ffz-i-t-reset-clicked",!1)},500))}B(v,"rotateButton");const C=class C extends K.default{constructor(...a){super(...a),this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.onShortcut=this.onShortcut.bind(this),this.LEFT_CONTROLS=x,this.RIGHT_CONTROLS=p,this.registerSettings()}registerSettings(){this.settings.add("player.embed-metadata",{default:!0,ui:{path:"Player > General >> Embed and Popout",title:"Show metadata when mousing over the player.",component:"setting-check-box"}}),this.settings.add("player.cast-button.hide",{default:!1,ui:{path:"Player > General >> Appearance",component:"setting-check-box",title:"Hide the Cast button."},changed:a=>this.css_tweaks.toggleHide("player-cast",a)}),this.settings.add("player.clip-button.hide-native",{default:null,requires:["player.clip-button.custom"],process:(a,w)=>w??a.get("player.clip-button.custom"),ui:{path:"Player > General >> Appearance",component:"setting-check-box",title:"Hide the native Clip button.",description:"By default, this is enabled when using the setting to add a custom Clip button."},changed:a=>this.css_tweaks.toggle("player-hide-native-clip",a)}),this.settings.add("player.clip-button.custom",{default:!1,ui:{path:"Player > General >> Appearance",component:"setting-check-box",title:"Display a custom Clip button.",description:"Add a custom Clip button to the player that better fits the style of the other buttons."},changed:()=>{for(const a of this.Player.instances)this.addClipButton(a)}}),this.settings.add("player.fade-pause-buffer",{default:!1,ui:{path:"Player > General >> Playback",title:"Fade the player when paused or buffering to make the UI easier to see.",component:"setting-check-box"},changed:a=>this.css_tweaks.toggle("player-fade-paused",a)}),this.settings.add("player.disable-content-warnings",{default:!1,ui:{path:"Player > General >> General",title:"Do not display content warnings.",description:"When this is enabled, FFZ will automatically skip content warnings. This feature is intended for use by adults only.",component:"setting-check-box"},changed:()=>{for(const a of this.Player.instances)this.skipContentWarnings(a)}}),_&&(this.settings.add("player.compressor.enable",{default:!0,ui:{path:'Player > Compressor @{"description": "These settings control optional dynamic range compression for the player, a form of audio processing that reduces the volume of loud sounds and amplifies quiet sounds, thus normalizing or compressing the volume. This uses a [DynamicsCompressorNode](https://developer.mozilla.org/en-US/docs/Web/API/DynamicsCompressorNode) from the Web Audio API behind the scenes if you want to learn more."} >> General',title:"Enable the audio compressor and add an `Audio Compressor` button to the player controls.",sort:-1e3,component:"setting-check-box"},changed:()=>{for(const a of this.Player.instances)this.addCompressorButton(a)}}),this.settings.add("player.compressor.default",{default:!1,ui:{path:"Player > Compressor >> General",title:"Enable the compressor by default.",component:"setting-check-box"},changed:()=>{for(const a of this.Player.instances)this.compressPlayer(a)}}),this.settings.add("player.compressor.force-legacy",{default:!1,ui:{path:"Player > Compressor >> Advanced",title:"Force use of legacy browser API.",description:"This setting forces FrankerFaceZ to attempt to use an older browser API to create the compressor. Please reset your player after changing this setting.",component:"setting-check-box",force_seen:!0}}),this.settings.add("player.compressor.shortcut",{default:null,requires:["player.compressor.enable"],process(a,w){return a.get("player.compressor.enable")?w:null},ui:{path:"Player > Compressor >> General",title:"Shortcut Key",description:"This key sequence can be used to toggle the compressor.",component:"setting-hotkey"},changed:()=>{this.updateShortcut();for(const a of this.Player.instances)this.addCompressorButton(a)}}),l&&(this.settings.add("player.gain.enable",{default:!1,ui:{sort:-1,path:'Player > Compressor >> Gain Control @{"sort": 50, "description": "Gain Control gives you extra control over the output volume when using the Compressor by letting you adjust the volume after the compressor runs, while the built-in volume slider takes affect before the compressor. This uses a simple [GainNode](https://developer.mozilla.org/en-US/docs/Web/API/GainNode) from the Web Audio API, connected in sequence after the DynamicsCompressorNode the Compressor uses."}',title:"Enable gain control when the audio compressor is enabled.",component:"setting-check-box"},changed:()=>{for(const a of this.Player.instances)this.compressPlayer(a)}}),this.settings.add("player.gain.no-volume",{default:!1,requires:["player.gain.enable"],process(a,w){return a.get("player.gain.enable")?w:!1},ui:{path:"Player > Compressor >> Gain Control",title:"Force built-in volume to 100% when the audio compressor is enabled.",description:"With this enabled, the built-in volume will be hidden and the Gain Control will be the only way to change volume.",component:"setting-check-box"},changed:a=>{this.css_tweaks.toggleHide("player-gain-volume",a);for(const w of this.Player.instances)this.updateGainVolume(w)}}),this.settings.add("player.gain.scroll",{default:!1,ui:{path:"Player > Compressor >> Gain Control",title:"Scroll Adjust",description:"Adjust the gain by scrolling with the mouse wheel. This setting takes precedence over adjusting the volume by scrolling. *This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*",component:"setting-select-box",data:f}}),this.settings.add("player.gain.default",{default:100,requires:["player.gain.min","player.gain.max"],process(a,w){const F=a.get("player.gain.min"),D=a.get("player.gain.max");return w/=100,w<F&&(w=F),w>D&&(w=D),w},ui:{path:"Player > Compressor >> Gain Control",title:"Default Value",component:"setting-text-box",description:"The default value for gain control, when gain control is enabled. 100% means no change in volume.",process:"to_int",bounds:[0,!0]},changed:()=>this.updateGains()}),this.settings.add("player.gain.min",{default:0,process:(a,w)=>w/100,ui:{path:"Player > Compressor >> Gain Control",title:"Minimum",component:"setting-text-box",description:`**Range:** 0 ~ 100

The minimum allowed value for gain control. 0% is effectively muted.`,process:"to_int",bounds:[0,!0,100,!0]},changed:()=>this.updateGains()}),this.settings.add("player.gain.max",{default:200,process:(a,w)=>w/100,ui:{path:"Player > Compressor >> Gain Control",title:"Maximum",component:"setting-text-box",description:`**Range:** 100 ~ 1000

The maximum allowed value for gain control. 100% is no change. 200% is double the volume.`,process:"to_int",bounds:[100,!0,1e3,!0]},changed:()=>this.updateGains()})),this.settings.add("player.compressor.threshold",{default:-50,ui:{path:'Player > Compressor >> Advanced @{"sort": 1000}',title:"Threshold",sort:0,description:`**Range:** -100 ~ 0

The decibel value above which the compression will start taking effect.`,component:"setting-text-box",process:"to_int",bounds:[-100,!0,0,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.knee",{default:40,ui:{path:"Player > Compressor >> Advanced",title:"Knee",sort:5,description:`**Range:** 0 ~ 40

A decibel value representing the range above the threshold where the curve smoothly transitions to the compressed portion.`,component:"setting-text-box",process:"to_int",bounds:[0,!0,40,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.ratio",{default:12,ui:{path:"Player > Compressor >> Advanced",title:"Ratio",sort:10,description:`**Range:** 0 ~ 20

The amount of change, in dB, needed in the input for a 1 dB change in the output.`,component:"setting-text-box",process:"to_int",bounds:[0,!0,20,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.attack",{default:0,ui:{path:"Player > Compressor >> Advanced",title:"Attack",sort:15,description:`**Range:** 0 ~ 1

The amount of time, in seconds, required to reduce the gain by 10 dB.`,component:"setting-text-box",process:"to_float",bounds:[0,!0,1,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.release",{default:.25,ui:{path:"Player > Compressor >> Advanced",title:"Release",sort:20,description:`**Range:** 0 ~ 1
The amount of time, in seconds, required to increase the gain by 10 dB.`,component:"setting-text-box",process:"to_float",bounds:[0,!0,1,!0]},changed:()=>this.updateCompressors()})),this.settings.add("player.allow-catchup",{default:!0,ui:{path:'Player > General @{"sort": -1000} >> General',title:"Allow the player to speed up to reduce delay.",description:"Twitch, by default, will apply a minor speed up to live video when you have a large delay to the broadcaster in order to catch back up with the live broadcast. This may result in audio distortion. Disable this to prevent the automatic speed changes.",component:"setting-check-box"},changed:()=>this.updatePlaybackRates()}),this.settings.add("player.mute-click",{default:!1,ui:{path:"Player > General >> Volume",title:"Mute or unmute the player by middle-clicking.",component:"setting-check-box"}}),this.settings.add("player.volume-scroll",{default:!1,ui:{path:"Player > General >> Volume",title:"Adjust volume by scrolling with the mouse wheel.",description:"*This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*",component:"setting-select-box",data:f}}),this.settings.add("player.button.reset",{default:!0,ui:{path:"Player > General >> General",title:"Add a `Reset Player` button to the player controls.",description:"Double-clicking the Reset Player button attempts to reset the Twitch player's internal state, fixing playback issues without a full page refresh.",component:"setting-check-box"},changed:()=>{for(const a of this.Player.instances)this.addResetButton(a)}}),document.pictureInPictureEnabled&&this.settings.add("player.button.pip",{default:!0,ui:{path:"Player > General >> General",title:"Add a `Picture-in-Picture` button to the player controls.",description:"Clicking the PiP button attempts to toggle Picture-in-Picture mode for the player's video.",component:"setting-check-box"},changed:()=>{for(const a of this.Player.instances)this.addPiPButton(a)}}),this.settings.add("player.volume-scroll-steps",{default:.1,ui:{path:"Player > General >> Volume",title:"Volume scroll amount",description:"How much the volume level is changed per individual scroll input.",component:"setting-select-box",data:[{value:.1,title:"10%"},{value:.05,title:"5%"},{value:.02,title:"2%"},{value:.01,title:"1%"}]}}),this.settings.add("player.captions.font-size",{default:"",ui:{path:"Player > Closed Captioning >> Font",title:"Font Size",description:"How large should captions be. This can be a percentage, such as `10%`, or a pixel value, such as `50px`.",component:"setting-text-box"},changed:()=>this.updateCaptionsCSS()}),this.settings.add("player.captions.font-family",{default:"",ui:{path:"Player > Closed Captioning >> Font",title:"Font Family",description:"Override the font used for displaying Closed Captions.",component:"setting-combo-box",data:()=>(0,O.R7)()},changed:()=>this.updateCaptionsCSS()}),this.settings.add("player.ext-hide",{default:0,ui:{path:"Player > General >> Extensions",title:"Show Overlay Extensions",description:"**Note**: This feature does not prevent extensions from loading. Hidden extensions are merely invisible. Hiding extensions with this feature will not improve your security. To prevent extensions from loading entirely, we recommend using the [Disable Twitch Extensions browser extension](https://twitch-tools.rootonline.de/disable_twitch_extensions.php) by CommanderRoot.",component:"setting-select-box",data:[{value:2,title:"Never"},{value:1,title:"With Controls"},{value:0,title:"Always"}]},changed:a=>this.updateHideExtensions(a)}),this.settings.add("player.ext-interaction",{default:!0,ui:{path:"Player > General >> Extensions",title:"Allow mouse interaction with overlay extensions.",component:"setting-check-box"},changed:a=>this.css_tweaks.toggle("player-ext-mouse",!a)}),this.settings.add("player.no-autoplay",{default:!1,ui:{path:"Player > General >> Playback",title:"Do not automatically start playing videos or streams.",description:"Note: This feature does not apply when navigating directly from channel to channel.",component:"setting-check-box"}}),this.settings.add("player.vod.autoplay",{default:!0,ui:{path:"Player > General >> Playback",title:"Auto-play the next recommended video after a video finishes.",component:"setting-check-box"}}),this.settings.add("player.volume-always-shown",{default:!1,ui:{path:"Player > General >> Volume",title:"Keep the volume slider expanded at all times.",component:"setting-check-box"},changed:a=>this.css_tweaks.toggle("player-volume",a)}),this.settings.add("player.hide-mouse",{default:!0,ui:{path:"Player > General >> General",title:"Hide mouse when controls aren't visible.",component:"setting-check-box"},changed:a=>this.css_tweaks.toggle("player-hide-mouse",a)}),this.settings.add("player.single-click-pause",{default:!1,ui:{path:"Player > General >> Playback",title:"Pause/Unpause the player by clicking.",component:"setting-check-box"}})}async onEnable(){await this.settings.awaitProvider(),await this.settings.provider.awaitReady(),this.css_tweaks.toggleHide("player-cast",this.settings.get("player.cast-button.hide")),this.css_tweaks.toggleHide("player-gain-volume",this.settings.get("player.gain.no-volume")),this.css_tweaks.toggle("player-hide-native-clip",this.settings.get("player.clip-button.hide-native")),this.css_tweaks.toggle("player-volume",this.settings.get("player.volume-always-shown")),this.css_tweaks.toggle("player-ext-mouse",!this.settings.get("player.ext-interaction")),this.css_tweaks.toggle("player-hide-mouse",this.settings.get("player.hide-mouse")),this.css_tweaks.toggle("player-fade-paused",this.settings.get("player.fade-pause-buffer")),this.installVisibilityHook(),this.updateHideExtensions(),this.updateCaptionsCSS(),this.updateShortcut(),this.on(":reset",this.resetAllPlayers,this),this.Player.ready((a,w)=>{this.modifyPlayerClass(a);for(const F of w){const D=F.props?.playerEvents;D&&((0,M.off)(D,"Playing",F.setPlayerActive),(0,M.off)(D,"PlayerSeekCompleted",F.setPlayerActive)),F.ffzMaybeRemoveNativeListeners(),F.maybeAttachDomEventListeners(),F.ffzScheduleState(),D&&((0,M.on)(D,"Playing",F.setPlayerActive),(0,M.on)(D,"PlayerSeekCompleted",F.setPlayerActive)),this.updateGUI(F),this.compressPlayer(F),this.updatePlaybackRate(F)}}),this.Player.on("mount",a=>{this.updateGUI(a),this.compressPlayer(a),this.updatePlaybackRate(a)}),this.Player.on("update",a=>{this.updateGUI(a),this.compressPlayer(a),this.updatePlaybackRate(a)}),this.Player.on("unmount",a=>{a.ffzUninstall()}),this.on("i18n:update",()=>{for(const a of this.Player.instances)this.updateGUI(a)})}updateShortcut(){const a=this.Mousetrap=this.Mousetrap||this.resolve("site.web_munch")?.getModule?.("mousetrap")||window.Mousetrap;if(!a||!a.bind)return;this._shortcut_bound&&(a.unbind(this._shortcut_bound),this._shortcut_bound=null);const w=this.settings.get("player.compressor.shortcut");_&&w&&(0,I.isValidShortcut)(w)&&(a.bind(w,this.onShortcut),this._shortcut_bound=w)}onShortcut(a){for(const w of this.Player.instances)this.compressPlayer(w,a)}modifyPlayerClass(a){const w=this,F=a.prototype.maybeAttachDomEventListeners;a.prototype.ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0,this._ffzUpdateState||(this._ffzUpdateState=this.ffzUpdateState.bind(this)),this._ffzErrorReset||(this._ffzErrorReset=w.addErrorResetButton.bind(w,this)),this._ffzReady||(this._ffzReady=this.ffzReady.bind(this));const D=this,z=this.setPlayerActive,$=this.setPlayerInactive;this.setPlayerActive=function(){return D.ffzScheduleState(),z.call(D)},this.setPlayerInactive=function(){return D.ffzScheduleState(),$.call(D)},this.ffzOnEnded=()=>{w.settings.get("player.vod.autoplay")||w.parent.awaitElement(".autoplay-vod__content-container button",this.props.containerRef||w.fine.getChildNode(this),1e3).then(Z=>Z.click())};const J=this.props.playerEvents;J&&((0,M.on)(J,"Buffering",this._ffzUpdateState),(0,M.on)(J,"Playing",this._ffzUpdateState),(0,M.on)(J,"PlayerError",this._ffzUpdateState),(0,M.on)(J,"PlayerError",this._ffzErrorReset),(0,M.on)(J,"Ended",this._ffzUpdateState),(0,M.on)(J,"Ended",this.ffzOnEnded),(0,M.on)(J,"Ready",this._ffzReady),(0,M.on)(J,"Idle",this._ffzUpdateState)),this.ffzStopAutoplay()},a.prototype.ffzUninstall=function(){this._ffz_state_raf&&cancelAnimationFrame(this._ffz_state_raf);const D=this.props.playerEvents;D&&this._ffzUpdateState&&((0,M.off)(D,"Playing",this._ffzUpdateState),(0,M.off)(D,"PlayerError",this._ffzUpdateState),(0,M.off)(D,"PlayerError",this._ffzErrorReset),(0,M.off)(D,"Ended",this._ffzUpdateState),(0,M.off)(D,"Ended",this.ffzOnEnded),(0,M.off)(D,"Ready",this._ffzReady),(0,M.off)(D,"Idle",this._ffzUpdateState)),this.ffzRemoveListeners(),this._ffz_state_raf=null,this._ffzUpdateState=null,this._ffzErrorReset=null,this._ffzReady=null,this.ffzOnEnded=null},a.prototype.ffzReady=function(){const D=this.props.containerRef;D&&requestAnimationFrame(()=>{const z=D.querySelectorAll(".ffz--player-reset figure");for(const $ of z)$._ffz_unspin&&clearTimeout($._ffz_unspin),$.classList.toggle("loading",!1)})},a.prototype.ffzStopAutoplay=function(){w.shouldStopAutoplay(this)&&w.stopPlayer(this.props.mediaPlayerInstance,this.props.playerEvents,this)},a.prototype.ffzScheduleState=function(){this._ffzUpdateState||(this._ffzUpdateState=this.ffzUpdateState.bind(this)),this._ffz_state_raf||(this._ffz_state_raf=requestAnimationFrame(this._ffzUpdateState))},a.prototype.ffzUpdateState=function(){this._ffz_state_raf=null;const D=this.props.containerRef;if(!D)return;const z=D.dataset;z.controls=this.state?.active||!1;let $=this.props.mediaPlayerInstance;if(!$)return;$.core&&($=$.core);const J=$.state?.state,Z=$.mediaSinkManager?.video;J==="Playing"&&Z?._ffz_maybe_compress&&(Z._ffz_maybe_compress=!1,w.compressPlayer(this)),Z&&Z._ffz_compressed!=null&&(z.compressed=Z._ffz_compressed),z.ended=J==="Ended",z.paused=J==="Idle",z.buffering=J==="Buffering"},a.prototype.ffzAttachListeners=function(){const D=this.props.containerRef;!D||this._ffz_listeners||(this._ffz_listeners=!0,this._ffz_scroll_handler||(this._ffz_scroll_handler=this.ffzScrollHandler.bind(this)),this._ffz_click_handler||(this._ffz_click_handler=this.ffzClickHandler.bind(this)),this._ffz_dblclick_handler||(this._ffz_dblclick_handler=this.ffzDblClickHandler.bind(this)),this._ffz_menu_handler||(this._ffz_menu_handler=this.ffzMenuHandler.bind(this)),(0,M.on)(D,"wheel",this._ffz_scroll_handler),(0,M.on)(D,"dblclick",this._ffz_dblclick_handler),(0,M.on)(D,"mousedown",this._ffz_click_handler),(0,M.on)(D,"contextmenu",this._ffz_menu_handler))},a.prototype.ffzRemoveListeners=function(){const D=this.props.containerRef;!D||!this._ffz_listeners||(this._ffz_scroll_handler&&((0,M.off)(D,"wheel",this._ffz_scroll_handler),this._ffz_scroll_handler=null),this._ffz_click_handler&&((0,M.off)(D,"mousedown",this._ffz_click_handler),this._ffz_click_handler=null),this._ffz_menu_handler&&((0,M.off)(D,"contextmenu",this._ffz_menu_handler),this._ffz_menu_handler=null),this._ffz_dblclick_handler&&((0,M.off)(D,"dblclick",this._ffz_dblclick_handler),this._ffz_dblclick_handler=null),this._ffz_listeners=!1)},a.prototype.ffzDelayPause=function(){this._ffz_pause_timer&&clearTimeout(this._ffz_pause_timer),(this.props?.mediaPlayerInstance).isPaused()||(this._ffz_pause_timer=setTimeout(()=>{const z=this.props?.mediaPlayerInstance;z.isPaused()||z.pause()},500))},a.prototype.ffzDblClickHandler=function(D){D&&this._ffz_pause_timer&&clearTimeout(this._ffz_pause_timer)},a.prototype.ffzClickHandler=function(D){if(!D)return;const z=w.settings.get("player.volume-scroll"),$=w.settings.get("player.gain.scroll"),J=w.settings.get("player.single-click-pause"),Z=b(z)||b($);if(J&&D.button===0){if(!D.target||!D.target.classList.contains("click-handler"))return;this.ffzDelayPause()}if(Z&&D.button===2&&(this.ffz_rmb=!0,this.ffz_scrolled=!1),!w.settings.get("player.mute-click")||D.button!==1)return;const G=this.props?.mediaPlayerInstance;if(!G?.isMuted)return;const Q=!G.isMuted();return G.setMuted(Q),localStorage.setItem("video-muted",JSON.stringify({default:Q})),D.preventDefault(),!1},a.prototype.ffzMenuHandler=function(D){this.ffz_rmb=!1,this.ffz_scrolled&&(D.preventDefault(),D.stopPropagation())},a.prototype.ffzScrollHandler=function(D){const z=w.settings.get("player.volume-scroll"),$=w.settings.get("player.gain.scroll"),J=w.settings.get("player.gain.no-volume"),Z=$&&u($,D,this.ffz_rmb),G=z&&u(z,D,this.ffz_rmb);if(!Z&&!G)return;const Q=D.wheelDelta||-(D.deltaY||D.detail||0),se=this.props?.mediaPlayerInstance,ce=se?.mediaSinkManager?.video||se?.core?.mediaSinkManager?.video,be=ce?._ffz_compressed&&ce?._ffz_gain!=null,ve=be&&Z;if(!se?.getVolume)return;b(ve?$:z)&&(this.ffz_scrolled=!0);const Re=w.settings.get("player.volume-scroll-steps");if(ve){let oe=ce._ffz_gain_value;oe==null&&(oe=w.settings.get("player.gain.default"));const ie=w.settings.get("player.gain.min"),ae=w.settings.get("player.gain.max");Q>0?oe+=Re:oe-=Re,oe<ie&&(oe=ie),oe>ae&&(oe=ae),ce._ffz_gain_value=oe,J&&oe!==0&&(se.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1}))),w.updateGain(this)}else if(G&&!(ce._ffz_compressed&&J)){const oe=ce?.volume??se.getVolume(),ie=Math.max(0,Math.min(1,oe+(Q>0?Re:-Re)));se.setVolume(ie),localStorage.volume=ie,ie!==0&&(se.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1})))}return D.preventDefault(),!1},a.prototype.ffzMaybeRemoveNativeListeners=function(){const D=this.props.containerRef;D&&this.listenersAttached&&((0,M.off)(D,"mouseleave",this.setPlayerInactive),(0,M.off)(D,"mouseenter",this.setPlayerActive),(0,M.off)(D,"mousemove",this.onMouseMove),this.listenersAttached=!1)},a.prototype.maybeAttachDomEventListeners=function(){try{this.ffzInstall(),this.ffzAttachListeners()}catch(D){w.log.error("Error attaching event listener.",D)}return F.call(this)}}shouldStopAutoplay(){return!1}installVisibilityHook(){if(!document.pictureInPictureEnabled){this.log.info("Skipping visibility hooks. Picture-in-Picture is not available.");return}const a=this;document.addEventListener("fullscreenchange",()=>{const w=document.fullscreenElement,F=document.pictureInPictureElement;w&&F&&(w===F||w.contains(F))&&document.exitPictureInPicture();for(const D of this.Player.instances)this.addPiPButton(D)});try{Object.defineProperty(document,"hidden",{configurable:!0,get(){return document.pictureInPictureElement!=null||a.settings.get("player.force-visible")?!1:document.visibilityState==="hidden"}})}catch(w){this.log.warn("Unable to install document visibility hook.",w)}}stopPlayer(a,w,F){if(a&&a.pause&&(a.getState?.()||a.core?.getState?.())==="Playing")a.pause();else if(w&&!w._ffz_stopping){w._ffz_stopping=!0;const D=B(()=>{F.props.mediaPlayerInstance?.pause&&(F.props.mediaPlayerInstance.pause(),(0,M.off)(w,"Playing",D),w._ffz_stopping=!1)},"immediatePause");this.log.info("Unable to immediately pause. Listening for playing event."),(0,M.on)(w,"Playing",D)}}updateCaptionsCSS(){const a=[],w=this.settings.get("player.captions.font-size");let F=this.settings.get("player.captions.font-family");if(F&&F.length){const[D,z]=(0,O.jo)(F);F=D,this._font_unloader&&this._font_unloader(),this._font_unloader=z,F.indexOf(" ")!==-1&&F.indexOf(",")===-1&&F.indexOf('"')===-1&&F.indexOf("'")===-1&&(F=`"${F}"`),W.style.fontFamily="",W.style.fontFamily=F,W.style.fontFamily&&a.push(`font-family: ${W.style.fontFamily} !important;`)}W.style.fontSize="",W.style.fontSize=w,W.style.fontSize&&a.push(`font-size: ${W.style.fontSize} !important;`),a.length?this.css_tweaks.set("captions-font",`.player-captions-container__caption-line {
	${a.join(`
	`)}
}`):this.css_tweaks.delete("captions-font")}updateHideExtensions(a){a===void 0&&(a=this.settings.get("player.ext-hide")),this.css_tweaks.toggleHide("player-ext-hover",a===1),this.css_tweaks.toggleHide("player-ext",a===2)}skipContentWarnings(a){if(!this.settings.get("player.disable-content-warnings"))return;const w=this.fine.getHostNode(a),F=w&&w.querySelector('button[data-a-target="content-classification-gate-overlay-start-watching-button"]');F&&F.click()}updateGUI(a){this.skipContentWarnings(a),this.addPiPButton(a),this.addResetButton(a),this.addClipButton(a),this.addCompressorButton(a,!1),this.addGainSlider(a,!1),this.addMetadata(a),this.emit(":update-gui",a)}areControlsDisabled(a){return a._ffz_control_state||this.findControlState(a),a._ffz_control_state?a._ffz_control_state.props.disableControls:!1}findControlState(a){a._ffz_control_state||(a._ffz_control_state=this.fine.searchTree(a,w=>w.props&&(0,I.has)(w.props,"disableControls"),200))}addGainSlider(a,w,F=0){const D=a.props.containerRef||this.fine.getChildNode(a),z=a.props.mediaPlayerInstance?.mediaSinkManager?.video||a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,$=D&&D.querySelector(x);let J=z!=null&&z._ffz_compressed&&z._ffz_gain;if(this.areControlsDisabled(a)&&(J=null),!$)return z&&!J?void 0:F<5?setTimeout(this.addGainSlider.bind(this,a,w,(F||0)+1),250):void 0;const Z=this.settings.get("player.gain.min"),G=this.settings.get("player.gain.max");(Z>=G||G<=Z)&&(J=null);let Q,se,ce,be,ve,Re=$.querySelector(".ffz--player-gain");if(!J){Re&&Re.remove();return}if(Re){if(w)return;ce=Re.querySelector("input"),ve=Re.querySelector(".ffz--gain-value"),se=Re.querySelector(".ffz-il-tooltip"),Q=Re.querySelector(".ffz-il-tooltip .ffz--p-tip"),be=Re.querySelector(".ffz-il-tooltip .ffz--p-value")}else{const xe=B(()=>{let ne=ce.value/100;const we=this.settings.get("player.gain.min"),ze=this.settings.get("player.gain.max");if(ne<we&&(ne=we),ne>ze&&(ne=ze),ne==z._ffz_gain_value)return;const Me=a.props.mediaPlayerInstance,Pe=Me.core||Me;!this.areControlsDisabled(a)&&ne>0&&this.settings.get("player.gain.no-volume")&&Pe?.isMuted?.()&&(Pe.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1}))),z._ffz_gain_value=ne,J.gain.value=ne;const Le=ze-we,Ge=(ne-we)/Le;ve.style.width=`${Ge*100}%`,be.textContent=`${Math.round(ne*100)}%`},"on_change");Re=(0,M.createElement)("div",{class:"ffz--player-gain volume-slider__slider-container tw-relative ffz-il-tooltip__container"},(0,M.createElement)("div",{class:"tw-align-items-center tw-flex tw-full-height"},(0,M.createElement)("label",{class:"tw-hide-accessible"},this.i18n.t("player.gain.label","Gain Control")),(0,M.createElement)("div",{class:"tw-flex tw-full-width tw-relative tw-z-above"},ce=(0,M.createElement)("input",{class:"ffz-range ffz-range--overlay",type:"range",min:"0",max:"100",step:"1","data-a-target":"player-gain-slider",value:"100"}),(0,M.createElement)("div",{class:"tw-absolute tw-border-radius-large tw-bottom-0 tw-flex tw-flex-column tw-full-width tw-justify-content-center ffz-range__fill ffz-range__fill--overlay tw-top-0 tw-z-below"},(0,M.createElement)("div",{class:"tw-border-radius-large ffz-range__fill-container"},ve=(0,M.createElement)("div",{class:"tw-border-radius-large ffz-range__fill-value ffz--gain-value","data-test-selector":"ffz-range__fill-value-selector"}))))),se=(0,M.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-center ffz-il-tooltip--up",role:"tooltip"},(0,M.createElement)("div",null,Q=(0,M.createElement)("div",{class:"ffz--p-tip"}),be=(0,M.createElement)("div",{class:"tw-regular ffz--p-value"})))),ce.addEventListener("input",xe),$.appendChild(Re)}let oe=z._ffz_gain_value;oe==null&&(oe=this.settings.get("player.gain.default")),ce.min=Z*100,ce.max=G*100,ce.value=oe*100;const ie=G-Z,ae=(oe-Z)/ie;ve.style.width=`${ae*100}%`,Q.textContent=this.i18n.t("player.gain.label","Gain Control"),be.textContent=`${Math.round(oe*100)}%`}addCompressorButton(a,w,F=0){const D=a.props.containerRef||this.fine.getChildNode(a),z=a.props.mediaPlayerInstance?.mediaSinkManager?.video||a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,$=D&&D.querySelector(x),J=_&&z!=null&&this.settings.get("player.compressor.enable");if(!$)return J&&F<5?setTimeout(this.addCompressorButton.bind(this,a,w,(F||0)+1),250):void 0;let Z,G,Q,se,ce=$.querySelector(".ffz--player-comp");if(!J||this.areControlsDisabled(a)){ce&&ce.remove();return}if(!ce)ce=(0,M.createElement)("div",{class:"ffz--player-comp tw-inline-flex tw-relative ffz-il-tooltip__container"},se=(0,M.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-comp-button",onClick:this.compressPlayer.bind(this,a)},(0,M.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,M.createElement)("div",{class:"tw-button-icon__icon"},Z=(0,M.createElement)("figure",{class:"ffz-player-icon"})))),(0,M.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-left ffz-il-tooltip--up",role:"tooltip"},(0,M.createElement)("div",null,G=(0,M.createElement)("div",{class:"ffz--p-tip"}),Q=(0,M.createElement)("div",{class:"ffz--p-extra tw-pd-t-05 ffz--tooltip-explain"})))),$.appendChild(ce);else{if(w)return;Z=ce.querySelector("figure"),se=ce.querySelector("button"),G=ce.querySelector(".ffz-il-tooltip .ffz--p-tip"),Q=ce.querySelector(".ffz-il-tooltip .ffz--p-extra")}const be=z._ffz_compressed,ve=this.canCompress(a);let Re=ve?be?this.i18n.t("player.comp_button.off","Disable Audio Compressor"):this.i18n.t("player.comp_button.on","Audio Compressor"):this.i18n.t("player.comp_button.disabled","Audio Compressor cannot be enabled when viewing Clips.");Q.textContent=this.i18n.t("player.comp_button.help","See the FFZ Control Center for details. If audio breaks, please reset the player."),ve&&this._shortcut_bound&&(Re=`${Re} (${this._shortcut_bound})`),Z.classList.toggle("ffz-i-comp-on",be),Z.classList.toggle("ffz-i-comp-off",!be),se.disabled=!ve,se.setAttribute("aria-label",Re),G.textContent=Re}replaceVideoElement(a,w){const F=(0,M.createElement)("video"),D=w?._ffz_pregain_volume??w?.volume??a.getVolume(),z=a.isMuted();return F._ffz_gain_value=w._ffz_gain_value,F._ffz_state=w._ffz_state,F._ffz_toggled=w._ffz_toggled,F._ffz_maybe_compress=w._ffz_compressed,F.volume=D,z&&(F.muted=!0),F.playsInline=!0,this.installPlaybackRate(F),w.replaceWith(F),a.attachHTMLVideoElement(F),F}hookPlayerLoad(a){!a||a._ffz_load||(a._ffz_load=a.load,a.load=(...w)=>{try{const F=a.getHTMLVideoElement();F?._ffz_compressor&&a.attachHTMLVideoElement&&(this.log.info("Recreating video element due to player load with compressor installed."),this.replaceVideoElement(a,F))}catch(F){t.log.error("Error while handling player load.",F)}return a._ffz_load(...w)})}compressPlayer(a,w){const F=a.props.mediaPlayerInstance,D=F.core||F,z=D?.mediaSinkManager?.video;if(!z||!_)return;this.hookPlayerLoad(F),a._ffz_setSrc||(a._ffz_setSrc=a.setSrc,a.setSrc=async function(...ve){console.log("setSrc",ve);const Re=a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;return Re&&Re._ffz_compressor&&await this.resetPlayer(a),a._ffz_setSrc(...ve)}),D._ffz_setVolume||(D._ffz_setVolume=D.setVolume,D._ffz_fakeVolume=()=>{}),z._ffz_maybe_compress=!1;const $=z._ffz_compressed||!1;let J=z._ffz_toggled?z._ffz_state:this.settings.get("player.compressor.default");if(w!=null&&(w.preventDefault(),z._ffz_toggled=!0,J=!z._ffz_compressed,z._ffz_state=J),z._ffz_compressor){if(!z._ffz_comp_reset&&!this.canCompress(a)){z._ffz_comp_reset=!0,this.resetPlayer(a);return}}else{if(!J)return;this.createCompressor(a,z)}let Z=z._ffz_gain;const G=l&&this.settings.get("player.gain.enable"),Q=Z!=null;if((J==$||w==null&&z._ffz_toggled)&&Q==G)return;const se=z._ffz_context,ce=z._ffz_compressor,be=z._ffz_source;if(!(!se||!ce||!be)){if(G&&!Z){let ve=z._ffz_gain_value;ve==null&&(ve=this.settings.get("player.gain.default"));try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;Z=z._ffz_gain=new GainNode(se,{gain:ve})}catch{this.log.info("Unable to use new GainNode. Falling back to old method."),Z=z._ffz_gain=se.createGain(),Z.gain.value=ve}ce.connect(Z),$&&(ce.disconnect(se.destination),Z.connect(se.destination))}else!G&&Z&&(ce.disconnect(Z),$&&(Z.disconnect(se.destination),ce.connect(se.destination)),Z=z._ffz_gain=null);J!=$&&(J?(be.disconnect(se.destination),be.connect(ce),Z?(Z.connect(se.destination),this.settings.get("player.gain.no-volume")&&(z._ffz_pregain_volume=D.getVolume(),D._ffz_setVolume(1),D.setVolume=D._ffz_fakeVolume)):ce.connect(se.destination)):(be.disconnect(ce),Z?(Z.disconnect(se.destination),z._ffz_pregain_volume!=null&&(D._ffz_setVolume(z._ffz_pregain_volume),D.setVolume=D._ffz_setVolume,z._ffz_pregain_volume=null)):ce.disconnect(se.destination),be.connect(se.destination))),a.props.containerRef&&(a.props.containerRef.dataset.compressed=J),z._ffz_compressed=J,this.addCompressorButton(a),this.addGainSlider(a)}}updateGainVolume(a){const w=a.props.mediaPlayerInstance,F=w.core||w,D=F?.mediaSinkManager?.video;if(!D||!D._ffz_compressed)return;const z=this.settings.get("player.gain.no-volume");z&&D._ffz_pregain_volume==null?(D._ffz_pregain_volume=F.getVolume(),F._ffz_setVolume(1),F.setVolume=F._ffz_fakeVolume):!z&&D._ffz_pregain_volume!=null&&(F._ffz_setVolume(D._ffz_pregain_volume),F.setVolume=F._ffz_setVolume,D._ffz_pregain_volume=null)}canCompress(a){if(!_)return!1;const w=a.props?.mediaPlayerInstance;if(w==null)return!1;const F=w.mediaSinkManager?.video||w.core?.mediaSinkManager?.video;return!(!F||!F.src&&!F.srcObject||F.src&&new URL(F.src).protocol!=="blob:")}createCompressor(a,w,F){if(!this.canCompress(a))return;let D=w._ffz_compressor;if(!D){if(F=F||new AudioContext,F.state==="suspended"){let $;const J=B(()=>{if(clearTimeout($),F.removeEventListener("statechange",J),F.state==="suspended"){this.log.debug("Aborting due to browser auto-play policy.");return}this.createCompressor(a,w,F)},"evt");this.log.debug("Attempting to resume suspended AudioContext."),$=setTimeout(J,100);try{F.addEventListener("statechange",J),F.resume()}catch{}return}w._ffz_context=F;let z;try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;z=w._ffz_source=new MediaElementAudioSourceNode(F,{mediaElement:w})}catch{this.log.info("Unable to use new MediaElementAudioSourceNode. Falling back to old method."),z=w._ffz_source=F.createMediaElementSource(w)}z.connect(F.destination);try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;D=w._ffz_compressor=new DynamicsCompressorNode(F)}catch{this.log.info("Unable to use new DynamicsCompressorNode. Falling back to old method."),D=w._ffz_compressor=F.createDynamicsCompressor()}if(this.settings.get("player.gain.enable")){let $,J=w._ffz_gain_value;J==null&&(J=this.settings.get("player.gain.default"));try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;$=w._ffz_gain=new GainNode(F,{gain:J})}catch{this.log.info("Unable to use new GainNode. Falling back to old method."),$=w._ffz_gain=F.createGain(),$.gain.value=J}D.connect($)}w._ffz_compressed=!1}this.updateCompressor(null,D)}updateGains(){for(const a of this.Player.instances)this.updateGain(a)}updateGain(a,w,F,D=!0){if(F||(F=a.props.mediaPlayerInstance?.mediaSinkManager?.video||a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video),w==null&&(w=F?._ffz_gain),!F||!w)return;let z=F._ffz_gain_value;z==null&&(z=this.settings.get("player.gain.default")),w.gain.value=z,D&&this.addGainSlider(a)}updateCompressors(){for(const a of this.Player.instances)this.updateCompressor(a)}updateCompressor(a,w){w==null&&(w=(a.props.mediaPlayerInstance?.mediaSinkManager?.video||a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video)?._ffz_compressor),w&&(w.threshold.value=this.settings.get("player.compressor.threshold"),w.knee.value=this.settings.get("player.compressor.knee"),w.ratio.value=this.settings.get("player.compressor.ratio"),w.attack.value=this.settings.get("player.compressor.attack"),w.release.value=this.settings.get("player.compressor.release"))}updatePlaybackRates(){for(const a of this.Player.instances)this.updatePlaybackRate(a)}updatePlaybackRate(a){const w=a.props.mediaPlayerInstance?.mediaSinkManager?.video||a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;w.setFFZPlaybackRate||this.installPlaybackRate(w),w.setFFZPlaybackRate(w.playbackRate)}installPlaybackRate(a){if(a.setFFZPlaybackRate)return;let w=a.playbackRate;const F=this,D=B(()=>{F.settings.get("player.allow-catchup")||Object.defineProperty(a,"playbackRate",{configurable:!0,get(){return w},set(z){(z===1||z<1||z>=1.1)&&a.setFFZPlaybackRate(z)}})},"installProperty");a.setFFZPlaybackRate=z=>{delete a.playbackRate,w=z,a.playbackRate=z,D()}}addPiPButton(a,w=0){const F=a.props.containerRef||this.fine.getChildNode(a),D=a.props.mediaPlayerInstance?.mediaSinkManager?.video||a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,z=D&&document.fullscreenElement&&document.fullscreenElement.contains(D),$=F&&F.querySelector(p),J=document.pictureInPictureEnabled&&this.settings.get("player.button.pip");if(!$)return J&&w<5?setTimeout(this.addPiPButton.bind(this,a,(w||0)+1),250):void 0;let Z,G,Q,se=$.querySelector(".ffz--player-pip");if(!J){se&&se.remove();return}if(se)Z=se.querySelector("figure"),Q=se.querySelector("button"),G=se.querySelector(".ffz-il-tooltip");else{se=(0,M.createElement)("div",{class:"ffz--player-pip tw-inline-flex tw-relative ffz-il-tooltip__container"},Q=(0,M.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-pip-button",onClick:this.pipPlayer.bind(this,a)},(0,M.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,M.createElement)("div",{class:"tw-button-icon__icon"},Z=(0,M.createElement)("figure",{class:"ffz-player-icon"})))),G=(0,M.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));const Re=$.querySelector('button[data-a-target="player-theatre-mode-button"]')||$.querySelector('button[aria-label*="Theat"]')||$.querySelector('button[data-a-target="player-fullscreen-button"]');Re?$.insertBefore(se,Re.parentElement):$.appendChild(se)}const ce=!!document.pictureInPictureElement,be=!1,ve=z?this.i18n.t("player.pip_button.fs","Cannot use Picture-in-Picture when Fullscreen"):be?this.i18n.t("player.pip_button.swap","Switch Picture-in-Picture"):ce?this.i18n.t("player.pip_button.off","Exit Picture-in-Picture"):this.i18n.t("player.pip_button","Picture-in-Picture");Z.classList.toggle("ffz-i-t-pip-inactive",!ce||be),Z.classList.toggle("ffz-i-t-pip-active",ce&&!be),Q.setAttribute("aria-label",ve),G.textContent=ve}pipPlayer(a,w){const F=a.props.mediaPlayerInstance?.mediaSinkManager?.video||a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;!F||!document.pictureInPictureEnabled||(w&&w.preventDefault(),!(document.fullscreenElement&&document.fullscreenElement.contains(F))&&(F._ffz_pip_enter||(F.addEventListener("enterpictureinpicture",F._ffz_pip_enter=()=>{this.addPiPButton(a)}),F.addEventListener("leavepictureinpicture",F._ffz_pip_exit=()=>{this.addPiPButton(a)})),document.pictureInPictureElement?document.exitPictureInPicture():F.requestPictureInPicture()))}addClipButton(a,w=0){const F=a.props.containerRef||this.fine.getChildNode(a),D=F&&F.querySelector(p),z=this.settings.get("player.clip-button.custom");if(!D)return z&&w<5?setTimeout(this.addClipButton.bind(this,a,(w||0)+1),250):void 0;let $,J,Z=D.querySelector(".ffz--player-clip");if(!z){Z&&Z.remove();return}if((!D.ffz_native_clip||!D.contains(D.ffz_native_clip))&&(D.ffz_native_clip=r(D)),Z)J=Z.querySelector("button"),$=Z.querySelector(".ffz-il-tooltip");else{const se=B(be=>{const ve=r(D);ve&&ve.click()},"on_click");Z=(0,M.createElement)("div",{class:"ffz--player-clip tw-inline-flex tw-relative ffz-il-tooltip__container"},J=(0,M.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-clip-button",onClick:se},(0,M.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,M.createElement)("div",{class:"tw-button-icon__icon"},(0,M.createElement)("figure",{class:"ffz-player-icon ffz-i-clip"})))),$=(0,M.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));const ce=D.querySelector(".ffz--player-reset button")||D.querySelector(".ffz--player-pip button")||D.querySelector('button[data-a-target="player-theatre-mode-button"]')||D.querySelector('button[aria-label*="Theat"]')||D.querySelector('button[data-a-target="player-fullscreen-button"]');ce?D.insertBefore(Z,ce.parentElement):D.appendChild(Z)}const G=D.ffz_native_clip,Q=G?G.disabled||G.ariaDisabled==="true":!1;J.disabled=Q,J.setAttribute("aria-label",$.textContent=Q?G.ariaLabel||this.i18n.t("player.clip-button.disabled","Clips are Disabled"):this.i18n.t("player.clip-button","Clip (Alt+X)"))}clickClip(a,w){console.log("clicked clip",a,w)}addResetButton(a,w=0){const F=a.props.containerRef||this.fine.getChildNode(a),D=F&&F.querySelector(p),z=this.settings.get("player.button.reset");if(!D)return z&&w<5?setTimeout(this.addResetButton.bind(this,a,(w||0)+1),250):void 0;let $,J,Z=D.querySelector(".ffz--player-reset");if(!z){Z&&Z.remove();return}if(Z)J=Z.querySelector("button"),$=Z.querySelector(".ffz-il-tooltip");else{Z=(0,M.createElement)("div",{class:"ffz--player-reset tw-inline-flex tw-relative ffz-il-tooltip__container"},J=(0,M.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-reset-button",onClick:v,onDblClick:this.resetPlayer.bind(this,a)},(0,M.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,M.createElement)("div",{class:"tw-button-icon__icon"},(0,M.createElement)("figure",{class:"ffz-player-icon ffz-i-t-reset"})))),$=(0,M.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));const G=D.querySelector(".ffz--player-pip button")||D.querySelector('button[data-a-target="player-theatre-mode-button"]')||D.querySelector('button[aria-label*="Theat"]')||D.querySelector('button[data-a-target="player-fullscreen-button"]');G?D.insertBefore(Z,G.parentElement):D.appendChild(Z)}J.setAttribute("aria-label",$.textContent=this.i18n.t("player.reset_button","Reset Player (Double-Click)"))}addErrorResetButton(a,w=0){const F=a.props.containerRef||this.fine.getChildNode(a),D=F&&F.querySelector(".content-overlay-gate"),z=this.settings.get("player.button.reset");if(!D){if(!z)return;w<2&&this.parent.awaitElement(".autoplay-vod__content-container button",this.props.containerRef||t.fine.getChildNode(this),1e3).then(()=>{this.addErrorResetButton(a,(w||0)+1)}).catch(()=>{this.log.warn("Unable to find container element for Error Reset button.")});return}let $,J,Z=D.querySelector(".ffz--player-reset");if(!z){Z&&Z.remove();return}Z?(J=Z.querySelector("button"),$=Z.querySelector(".ffz-il-tooltip")):(Z=(0,M.createElement)("div",{class:"ffz--player-reset tw-absolute tw-bottom-0 tw-right-0 ffz-il-tooltip__container tw-mg-1"},J=(0,M.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-reset-button",onClick:v,onDblClick:this.resetPlayer.bind(this,a)},(0,M.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,M.createElement)("div",{class:"tw-button-icon__icon"},(0,M.createElement)("figure",{class:"ffz-player-icon ffz-i-t-reset"})))),$=(0,M.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"})),D.appendChild(Z)),J.setAttribute("aria-label",$.textContent=this.i18n.t("player.reset_button","Double-Click to Reset Player"))}resetAllPlayers(){for(const a of this.Player.instances)this.resetPlayer(a)}async resetPlayer(a,w){const F=a?a.mediaSinkManager||a.core?.mediaSinkManager?a:a?.props?.mediaPlayerInstance:null;if(w){w.preventDefault();const Z=w.currentTarget,G=Z&&Z.querySelector("figure");if(G){if(G.classList.contains("loading"))return;G.classList.toggle("ffz-i-t-reset",!0),G.classList.toggle("ffz-i-t-reset-clicked",!1),G.classList.toggle("loading",!0),G._ffz_unspin=setTimeout(()=>{G._ffz_unspin=null,G.classList.toggle("loading",!1)},1e4)}}const D=F.getDuration?.()??1/0;let z=-1;const $=F.core||F;$._ffz_setVolume&&($.setVolume=$._ffz_setVolume),isFinite(D)&&!isNaN(D)&&D>0&&(z=F.getPosition());const J=F.mediaSinkManager?.video||F.core?.mediaSinkManager?.video;if(J?._ffz_compressor&&F.attachHTMLVideoElement){const Z=this.replaceVideoElement(F,J);Z._ffz_maybe_compress=!0}this.PlayerSource.check();for(const Z of this.PlayerSource.instances)(!F||F===Z.props?.mediaPlayerInstance)&&await Z.setSrc({isNewMediaPlayerInstance:!1});z>0&&setTimeout(()=>F.seekTo(z),250)}addMetadata(a){this.metadata&&(a._ffz_md_update||(a._ffz_md_update=(0,I.debounce)(()=>requestAnimationFrame(()=>this._updateMetadata(a)),1e3,2)),a._ffz_md_update())}wantsMetadata(){return!1}_updateMetadata(a){a._ffz_cont&&!document.contains(a._ffz_cont)&&(a._ffz_cont=null);const w=this.wantsMetadata(a);if(!a._ffz_cont){if(!w)return;const F=a.props.containerRef||this.fine.getChildNode(a),D=F&&F.querySelector(p);if(!D)return;a._ffz_cont=(0,M.createElement)("div",{class:"ffz--player-meta-tray"}),D.insertBefore(a._ffz_cont,D.firstElementChild)}if(!w){a._ffz_cont.remove(),a._ffz_cont=null;return}this.updateMetadata(a)}updateMetadata(a,w){const F=a._ffz_cont;if(!F||!document.contains(F))return;w?Array.isArray(w)||(w=[w]):w=this.metadata.keys;const D=this.getData(),z=D?.props?.data?.user,$=a._ffz_meta_timers=a._ffz_meta_timers||{},J=B(G=>this.updateMetadata(a,G),"refresh_fn"),Z={channel:{id:z?.id,login:D?.props?.channelLogin,display_name:z?.displayName,live:z?.stream?.id!=null,live_since:z?.stream?.createdAt},inst:a,source:D,getViewerCount:()=>0,getUserSelfImmediate:()=>null,getUserSelf:()=>null,getBroadcastID:()=>z?.id?this.getBroadcastID(a,z.id):null};for(const G of w)this.metadata.renderPlayer(G,Z,F,$,J)}getUptime(a){let D=this.getData()?.props?.data?.user?.stream?.createdAt;return D?(D instanceof Date||(D=new Date(D)),(Date.now()-D.getTime())/1e3):null}getBroadcastID(a,w){if(!this.twitch_data)return Promise.resolve(null);const F=a._ffz_bcast_cache=a._ffz_bcast_cache||{};return w===F.channel_id&&Date.now()-F.saved<6e4?Promise.resolve(F.broadcast_id):new Promise(async(D,z)=>{if(F.updating){F.updating.push([D,z]);return}F.channel_id=w,F.updating=[[D,z]];let $,J;try{$=await this.twitch_data.getBroadcastID(w)}catch(G){$=null,J=G}const Z=F.updating;if(F.updating=null,F.channel_id!==w){J=new Error("Outdated"),F.channel_id=null,F.broadcast_id=null,F.saved=0;for(const G of Z)G[1](J);return}F.broadcast_id=$,F.saved=Date.now();for(const G of Z)J?G[1](J):G[0]($)})}get playerUI(){return this.fine.searchTree(this.Player.first,w=>w.props&&w.props.uiContext,150)?.props?.uiContext}get current(){for(const a of this.Player.instances)if(a?.props?.mediaPlayerInstance)return a.props.mediaPlayerInstance;return null}};B(C,"PlayerBase");let A=C},89196:(me,te,S)=>{"use strict";S.d(te,{Z:()=>$});var K=S(33612),M=S(22527),I=S(46949),O=S(24431);const W=Symbol("FFZRequires"),x={};function p(oe){return x[oe]||(x[oe]=new RegExp(`\\b(?<!\\.)${oe}\\(([0-9e_+]+)\\)`,"g")),x[oe]}B(p,"getRequireRegex");const _=["webpackJsonp","webpackChunktwitch_twilight","webpackChunktwitch_sunlight","webpackJsonp_N_E"],l=[[0,"vendor"],[1,"core"]];let d=0;const Q=class Q extends M.default{constructor(...ie){super(...ie),this._id=`_ffz$${d++}`,this._rid=0,this._original_loader=null,this._known_rules={},this._require=null,this._chunk_names={},this._mod_cache={},this._checked_module={},this._required_ids=new Set,this._known_ids=new Set,this.Requires=W,this.v4=null,this.hookLoader(),this.hookRequire()}waitForLoader(){if(this._original_loader)return Promise.resolve();const ie=this._load_waiters=this._load_waiters||[];return new Promise((ae,xe)=>ie.push([ae,xe]))}_resolveLoadWait(ie){const ae=this._load_waiters;if(this._load_waiters=null,ae)for(const xe of ae)xe[ie?1:0]()}hookLoader(ie=0){if(this._original_loader)return this.log.warn("Attempted to call hookLoader twice.");let ae;for(const ne of _)if(window[ne]){ae=ne;break}if(!ae){if(ie>240){this.log.error("Unable to find webpack's loader after one minute.");try{const ne=[];for(const we of Object.keys(window))(0,I.has)(window,we)&&typeof we=="string"&&/webpack/i.test(we)&&!/ffz/i.test(we)&&ne.push(we);ne.length?this.log.info("Possible Matches: ",ne.join(", ")):this.log.info("No possible matches found.")}catch{}this._resolveLoadWait(!0);return}return setTimeout(this.hookLoader.bind(this,ie+1),250)}const xe=window[ae];if(typeof xe=="function"){this.v4=!1,this._original_loader=xe;try{window[ae]=this.webpackJsonpv3.bind(this)}catch{this.log.warn("Unable to wrap webpackJsonp due to write protection."),this._resolveLoadWait(!0);return}}else if(Array.isArray(xe)){this.v4=!0,this._original_store=xe,this._original_loader=xe.push;for(const ne of xe)ne&&ne[1]&&this.processModulesV4(ne[1],!0);try{xe.push=this.webpackJsonpv4.bind(this)}catch{this.log.warn("Unable to wrap webpackJsonp (v4) due to write protection."),this._resolveLoadWait(!0);return}}else{this.log.error("webpackJsonp is of an unknown value. Unable to wrap."),this._resolveLoadWait(!0);return}this._resolveLoadWait(),this.log.info(`Found and wrapped webpack's loader after ${(ie||0)*250}ms.`)}webpackJsonpv3(ie,ae){const xe=ie.map(we=>this._chunk_names[we]||we).join(", ");this.log.verbose(`Twitch Chunk Loaded: ${ie} (${xe})`),this.log.verbose(`Modules: ${Object.keys(ae)}`);const ne=this._original_loader.apply(window,arguments);return this.emit(":loaded",ie,xe,ae),ne}_resolveRequire(ie){if(!this._require&&(this._require=ie,this._resolve_require)){for(const ae of this._resolve_require)ae(ie);this._resolve_require=null}}processModulesV4(ie){const ae=this;for(const[xe,ne]of Object.entries(ie))this._known_ids.add(xe)}webpackJsonpv4(ie){const ae=ie[0],xe=ie[1],ne=Array.isArray(ae)&&ae.map(ze=>this._chunk_names[ze]||ze);this.log.verbose(`Twitch Chunk Loaded: ${ae} (${ne.join(", ")})`),this.log.verbose(`Modules: ${Object.keys(xe)}`),xe&&this.processModulesV4(xe,!1);for(const[ze,Me]of Object.entries(this._checked_module))Me==!0&&(this._checked_module[ze]=null);const we=this._original_loader.apply(this._original_store,arguments);return this.emit(":loaded",ae,ne,xe),we}known(ie,ae){if(typeof ie=="object"){for(const xe in ie)(0,I.has)(ie,xe)&&this.known(xe,ie[xe]);return}this._known_rules[ie]=ae}async findModule(ie,ae){return this._require||await this.getRequire(),this.getModule(ie,ae)}findDeep(ie,ae,xe=!0){if(ie&&!Array.isArray(ie)&&(ie=[ie]),!this._require||!this.v4||!this._original_store)return new Error("We do not have webpack");const ne=[],we=this._chunk_names;for(const[ze,Me]of this._original_store){if(ie){let Pe=!1;for(const Le of ze)if(ie.includes(Le)||ie.includes(`${Le}`)||we[Le]&&ie.includes(we[Le])){Pe=!0;break}if(!Pe)continue}for(const Pe of Object.keys(Me))try{const Le=this._require(Pe);for(const Ge in Le)if(Le[Ge]&&ae(Le[Ge],Le,Ge)){if(this.log.info(`Found in key "${Ge}" of module "${Pe}" (${this.chunkNameForModule(Pe)})`),!xe)return Le;ne.push(Le);break}}catch(Le){this.log.warn("Exception while deep scanning webpack.",Le)}}return ne.length?ne:(this.log.info("Unable to find deep scan target."),null)}getModule(ie,ae){if(typeof ie=="function"&&(ae=ie,ie=null),ie&&this._mod_cache[ie])return this._mod_cache[ie];const xe=this._require;if(!xe)return null;if(ae||(ae=this._known_rules[ie]),!ae)throw new Error(`no known predicate for locating ${ie}`);if(xe.c)return this._oldGetModule(ie,ae,xe);if(xe.m)return this._newGetModule(ie,ae,xe)}_chunksForModule(ie){if(!this.v4||!this._original_store)return null;const ae=new Set;for(const[xe,ne]of this._original_store)if(ne[ie])for(const we of xe)ae.add(we);return[...ae]}chunkNameForModule(ie){const ae=this._chunksForModule(ie);if(!ae)return null;for(const xe of ae){const ne=this._chunk_names[xe];if(ne)return ne}return null}chunkNamesForModule(ie){const ae=this._chunksForModule(ie);return ae?ae.map(xe=>this._chunk_names[xe]||xe):null}_oldGetModule(ie,ae,xe){if(!xe||!xe.c)return null;let ne;if(this._original_store&&ae.chunks&&this._chunk_names&&Object.keys(this._chunk_names).length){const ze=typeof ae.chunks=="function";!ze&&!Array.isArray(ae.chunks)&&(ae.chunks=[ae.chunks]);const Me=ae.chunks,Pe=this._chunk_names;ne=[];for(const[Le,Ge]of this._original_store){let Ye=!1;for(const Ke of Le)if(ze?Me(Pe[Ke],Ke):Me.includes(Ke)||Me.includes(String(Ke))||Pe[Ke]&&Me.includes(Pe[Ke])){Ye=!0;break}Ye&&(ne=[...ne,...Object.keys(Ge)])}ne=new Set(ne)}else ne=Object.keys(xe.c);let we=0;for(const ze of ne)if((0,I.has)(xe.c,ze)){we++;const Me=xe.c[ze],Pe=Me&&Me.exports;if(Pe){const Le=ae(Pe);if(Le){this.log.debug(`[Old] Located module "${ie}" in module ${ze}${O.DEBUG?` (${this.chunkNameForModule(ze)})`:""} after ${we} tries`);const Ge=ae.use_result?Le:Pe;return ie&&(this._mod_cache[ie]=Ge),Ge}}}return this.log.debug(`[Old] Unable to locate module "${ie}" despite checking ${we} modules`),null}_newGetModule(ie,ae,xe){if(!xe)return null;let ne=this._known_ids;if(this._original_store&&ae.chunks&&this._chunk_names&&Object.keys(this._chunk_names).length){const ze=typeof ae.chunks=="function";!ze&&!Array.isArray(ae.chunks)&&(ae.chunks=[ae.chunks]);const Me=ae.chunks,Pe=this._chunk_names;ne=[];for(const[Le,Ge]of this._original_store){let Ye=!1;for(const Ke of Le)if(ze?Me(Pe[Ke],Ke):Me.includes(Ke)||Me.includes(String(Ke))||Pe[Ke]&&Me.includes(Pe[Ke])){Ye=!0;break}Ye&&(ne=[...ne,...Object.keys(Ge)])}ne=new Set(ne)}let we=0;for(const ze of ne)try{if(we++,!this._required_ids.has(ze)){let Pe=this._checked_module[ze];if(Pe==null&&(Pe=this._checkModule(ze)),Pe)continue}this._required_ids.add(ze),xe.m[ze]||this.log.warn("Tried requiring module that isn't loaded",ze);const Me=xe(ze);if(Me){const Pe=ae(Me);if(Pe){this.log.debug(`Located module "${ie}" in module ${ze}${O.DEBUG?` (${this.chunkNameForModule(ze)})`:""} after ${we} tries`);const Le=ae.use_result?Pe:Me;return ie&&(this._mod_cache[ie]=Le),Le}}}catch(Me){this.log.warn("Unexpected error trying to find module",Me)}return this.log.debug(`Unable to locate module "${ie}" despite checking ${we} modules`),null}_checkModule(ie,ae=null){if(ae){if(ae.has(ie))return this._checked_module[ie]??!1;ae.add(ie)}let xe=this._require?.m?.[ie];if(xe){xe.original&&(xe=xe.original);let ne=xe[W],we=!1;if(ne==null){const ze=xe.toString(),Me=/^function\([^,)]+,[^,)]+,([^,)]+)/.exec(ze);if(Me){const Pe=p(Me[1]);ne=xe[W]=new Set,Pe.lastIndex=0;let Le;for(;Le=Pe.exec(ze);){let Ge=Le[1];if(Ge!=="e"){if(/^\d+e\d+$/.test(Ge)){const Ye=Ge.split("e");Ge=`${parseInt(Ye[0],10)*10**parseInt(Ye[1],10)}`}ne.add(Ge),!we&&!this._require.m[Ge]&&(this.log.verbose(`Unable to load module ${ie} due to missing dependency ${Ge}`),we=!0)}}}else xe[W]=!1}else if(ne){for(const ze of ne)if(!this._require.m[ze]){we=!0;break}}if(!we&&ne){ae||(ae=new Set,ae.add(ie));for(const ze of ne){let Me=this._checked_module[ze];if(Me==null&&!ae.has(ze))try{Me=this._checkModule(ze,ae)}catch{this.log.verbose(`Recursion error checking module ${ie} (${ze})`),Me=!0}if(Me){this.log.verbose(`Unable to load module ${ie} due to unable to load dependency ${ze}`),we=!0;break}}}return this._checked_module[ie]=we}return this._checked_module[ie]=!0}getRequire(ie=0){return this._require?Promise.resolve(this._require):new Promise((ae,xe)=>{let ne=this._original_loader;if(!ne)return ie>500&&xe(new Error("unable to find webpackJsonp")),setTimeout(()=>this.getRequire(ie++).then(ae),250);this.v4&&(ne=ne.bind(this._original_store));const we=`ffz-loader$${(0,I.generateUUID)()}`;ne([[we],{[we]:(ze,Me,Pe)=>{ae(this._require=Pe)}},ze=>ze(we)])})}async hookRequire(){const ie=performance.now(),ae=await this.getRequire(),xe=performance.now()-ie;this.log.info(`require() grabbed in ${xe.toFixed(5)}ms.`);const ne=ae.e&&ae.e.toString();let we;if(ne&&ne.indexOf("Loading chunk")!==-1){const ze=this.v4?/assets\/"\+\(?({1:.*?})/.exec(ne):/({0:.*?})/.exec(ne);if(ze)try{we=JSON.parse(ze[1].replace(/(\d+):/g,'"$1":'))}catch{}}else if(ae.u){const ze=ae.u.toString(),Me=/assets\/"\+\(?({\d+:.*?})/.exec(ze),Pe=Me?Me[1].replace(/([\de]+):/g,(Le,Ge)=>{if(/^\d+e\d+$/.test(Ge)){const Ye=Ge.split("e");Ge=parseInt(Ye[0],10)*10**parseInt(Ye[1],10)}return`"${Ge}":`}):null;if(Pe)try{we=JSON.parse(Pe)}catch(Le){console.log(Pe),console.log(Le)}}if(we){if(this._original_store)for(const[ze,Me]of l){const Pe=this._original_store[ze]?.[0];if(Array.isArray(Pe))for(const Le of Pe)typeof Le!="object"&&!we[Le]&&(we[Le]=Me)}this._chunk_names=we,this.log.debug(`Loaded names for ${Object.keys(we).length} chunks from require().`)}else this.log.warn("Unable to find chunk names in require().")}};B(Q,"WebMunch");let f=Q;f.Requires=W;var r=S(17159);const se=class se extends M.default{constructor(ie,ae){super(ie,ae),this._pruneLive=this._pruneLive.bind(this),this._wrappers=new Map,this._observer=null,this._watching=new Set,this._live_watching=null}onDisable(){this._stopWatching()}define(ie,ae,xe,ne=null,we=0,ze=5e3,Me=!0){if(this._wrappers.has(ie))return this._wrappers.get(ie);if(!ae||typeof ae!="string"||!ae.length)throw new Error("cannot find definition and no selector provided");const Pe=new v(ie,ae,xe,ne,we,ze,Me,this);return this._wrappers.set(ie,Pe),Pe}route(ie){this._route=ie,this._timer=Date.now(),this._updateLiveWatching(),this.checkAll(),this.cleanAll()}cleanAll(){this._clean_all&&cancelAnimationFrame(this._clean_all),this._clean_all=requestAnimationFrame(()=>{this._clean_all=null;for(const ie of this._wrappers.values())ie.clean()})}checkAll(){if(this._watching)for(const ie of this._watching)ie.check()}updateTimeout(){this._timer=Date.now(),this._updateLiveWatching(),this.checkAll()}_isActive(ie,ae){return!(ie.routes===!1||this._route&&ie.routes.length&&!ie.routes.includes(this._route)||ie.timeout>0&&ae-this._timer>ie.timeout)}_updateLiveWatching(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null);const ie=this._live_watching=[],ae=Date.now();let xe=Number.POSITIVE_INFINITY;if(this._watching)for(const ne of this._watching)this._isActive(ne,ae)&&(ne.timeout>0&&ne.timeout<xe&&(xe=ne.timeout),ie.push(ne));isFinite(xe)&&(this._timeout=setTimeout(this._pruneLive,xe)),ie.length?this._observer||this._startWatching():this._stopWatching()}_pruneLive(){this._updateLiveWatching()}_checkWatchers(ie){if(this._live_watching)for(const ae of this._live_watching)ae.checkElements(ie)}_startWatching(){!this._observer&&this._live_watching&&this._live_watching.length&&(this.log.info("Installing MutationObserver."),this._observer=new MutationObserver(ie=>this._checkWatchers(ie.map(ae=>ae.target))),this._observer.observe(document.body,{childList:!0,subtree:!0}))}_stopWatching(){this._observer&&(this.log.info("Stopping MutationObserver."),this._observer.disconnect()),this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this._live_watching=null,this._observer=null}listen(ie,ae=!0){this._watching.has(ie)||(ae&&(this._timer=Date.now()),this._watching.add(ie),this._updateLiveWatching())}unlisten(ie){this._watching.has(ie)&&(this._watching.delete(ie),this._updateLiveWatching())}};B(se,"Elemental");let b=se,u=0;const ce=class ce extends r.EventEmitter{constructor(ie,ae,xe,ne,we,ze,Me,Pe){super(),this.id=u++,this.param=`_ffz$elemental$${this.id}`,this.remove_param=`_ffz$elemental_remove$${this.id}`,this._schedule=this._schedule.bind(this),this.name=ie,this.selector=ae,this.routes=xe??[],this.opts=ne,this.limit=we,this.timeout=ze,this.check_removal=Me,this.opts&&!this.opts.childList&&!this.opts.attributes&&!this.opts.characterData&&(this.opts.attributes=!0),this.count=0,this.instances=new Set,this.elemental=Pe,this.check(),this.schedule()}get atLimit(){return this.limit>0&&this.count>=this.limit}clean(){const ie=Array.from(this.instances);for(const ae of ie)document.contains(ae)||this.remove(ae)}schedule(){this._stimer||(this._stimer=setTimeout(this._schedule,0))}_schedule(){this._stimer&&clearTimeout(this._stimer),this._stimer=null,this.limit===0||this.count<this.limit?this.elemental.listen(this):this.elemental.unlisten(this)}check(){const ie=document.querySelectorAll(this.selector);for(const ae of ie)this.add(ae)}checkElements(ie){if(this.atLimit)return this.schedule();for(const ae of ie){const xe=ae.querySelectorAll(this.selector);for(const ne of xe)this.add(ne);if(this.atLimit)return}}get first(){for(const ie of this.instances)return ie;return null}toArray(){return Array.from(this.instances)}each(ie){for(const ae of this.instances)ie(ae)}add(ie){if(!this.instances.has(ie)){if(this.instances.add(ie),this.count++,this.check_removal&&ie.parentNode){const ae=new MutationObserver(()=>{requestAnimationFrame(()=>{document.contains(ie)||this.remove(ie)})});ae.observe(ie.parentNode,{childList:!0}),ie[this.remove_param]=ae}if(this.opts){const ae=new MutationObserver(xe=>{document.contains(ie)?this.__running.size||this.emit("mutate",ie,xe):this.remove(ie)});ae.observe(ie,this.opts),ie[this.param]=ae}this.schedule(),this.emit("mount",ie)}}remove(ie){const ae=ie[this.param];ae&&(ae.disconnect(),ie[this.param]=null);const xe=ie[this.remove_param];xe&&(xe.disconnect(),ie[this.remove_param]=null),this.instances.has(ie)&&(this.instances.delete(ie),this.count--,this.schedule(),this.emit("unmount",ie))}};B(ce,"ElementalWrapper");let v=ce;var A=S(98247),C=S(45866),y=S(29632),a=S(27040);const be=class be extends r.FFZEvent{constructor(ie){super(ie),this._obj=void 0,this._changed=!1}markChanged(){this._changed=!0}get topic(){return this.event.topic}get message(){return this._obj===void 0&&(this._obj=JSON.parse(this.event.message)??null),this._obj}set message(ie){this._obj=ie,this._changed=!0}};B(be,"PubSubEvent");let w=be;const ve=class ve extends M.default{constructor(ie,ae){super(ie,ae),this.instance=null}onEnable(ie=0){const ae=window.__twitch_pubsub_client;if(!ae){ie>10?this.log.warn("Unable to find PubSub."):new Promise(xe=>setTimeout(xe,50)).then(()=>this.onEnable(ie+1));return}ae&&(this.instance=ae,this.hookClient(ae)),this.instance||this.log.warn("Unable to find a PubSub instance.")}handleMessage(ie){try{if(ie.type==="MESSAGE"&&ie.data?.topic){const ae=ie.data.topic,xe=ae.indexOf("."),ne=xe===-1?ae:ae.slice(0,xe),we=xe===-1?"":ae.slice(xe+1),ze=new w({prefix:ne,trail:we,event:ie.data});if(this.emit(":pubsub-message",ze),ze.defaultPrevented)return!0;ze._changed&&(ie.data.message=JSON.stringify(ze._obj))}}catch(ae){this.log.error("Error processing PubSub event.",ae)}return!1}hookClient(ie){const ae=this,xe=ie.onMessage;ie.connection.removeAllListeners("message"),ie.onMessage=function(ze){if(!ae.handleMessage(ze))return xe.call(this,ze)},ie.connection.addListener("message",ie.onMessage);const ne=ie.listen,we=ie.unlisten;ie.ffz_original_listen=ne,ie.ffz_original_unlisten=we,ie.listen=function(ze,Me,...Pe){const Le=ze.topic,Ge=Le&&!!ie.topicListeners?._events?.[Le],Ye=ne.call(this,ze,Me,...Pe);return Le&&!Ge&&ae.emit(":add-topic",Le),Ye},ie.unlisten=function(ze,Me,...Pe){const Le=!!ie.topicListeners?._events?.[ze],Ge=we.call(this,ze,Me,...Pe);return Le&&!ie.topicListeners?._events?.[ze]&&ae.emit(":remove-topic",ze),Ge}}simulateMessage(ie,ae){if(!this.instance)throw new Error("No PubSub instance available");this.instance.simulateMessage(ie,JSON.stringify(ae))}get topics(){const ie=this.instance?.topicListeners?._events;return ie?Object.keys(ie):[]}};B(ve,"Subpump");let F=ve;var D=S(44589);const z=S.p+"main.css",Re=class Re extends K.Z{constructor(...ie){super(...ie),this.inject(f),this.inject(A.Z),this.inject(b),this.inject("router",C.Z),this.inject(y.default,!1),this.inject(a.default),this.inject(F),this._dom_updates=[]}async populateModules(){const ie=await S(41152),ae=await this.loadFromContext(ie,this.log);this.log.info(`Loaded descriptions of ${Object.keys(ae).length} modules.`)}async onLoad(){await this.populateModules(),this.web_munch.known(Re.KNOWN_MODULES),this.router.route(Re.ROUTES),this.router.routeName(Re.ROUTE_NAMES),this.router.route("user","/:userName",null,ie=>ie?.channelView!=="Home"),this.router.route("user-home","/:userName",null,ie=>ie?.channelView==="Home"),this.router.route(Re.DASH_ROUTES,"dashboard.twitch.tv"),this.router.route(Re.PLAYER_ROUTES,"player.twitch.tv"),this.router.route(Re.CLIP_ROUTES,"clips.twitch.tv")}onEnable(){this.settings=this.resolve("settings"),this.web_munch.findModule("simplebar").then(Me=>{!window.ffzSimplebar&&Me&&(window.ffzSimplebar=Me)}).catch(()=>{});const ie=this.fine.searchNode(null,Me=>Me?.pendingProps?.store?.getState),ae=this.store=ie?.pendingProps?.store;if(!ae)return new Promise(Me=>setTimeout(Me,50)).then(()=>this.onEnable());this.on(":dom-update",(...Me)=>{this._dom_updates.push(Me),this._dom_frame||(this._dom_frame=requestAnimationFrame(()=>{const Pe=this._dom_updates,Le=this.resolve("core");this._dom_updates=[],this._dom_frame=null;for(const[Ge,Ye]of Pe){const Ke=this.fine.getChildNode(Ye);Le.emit("core:dom-update",Ge,Ke,Ye)}}))});const xe=B(()=>this.settings.updateContext({size:{height:window.innerHeight,width:window.innerWidth}}),"update_size");window.addEventListener("resize",xe),xe();const ne=B(()=>{this.settings.updateContext({fullscreen:!!document.fullscreenElement}),this.emit(":fullscreen")},"update_fullscreen");document.addEventListener("fullscreenchange",ne),this.settings.updateContext({fullscreen:!!document.fullscreenElement}),ae.subscribe(()=>this.updateContext()),this.updateContext(),this.router.on(":route",(Me,Pe)=>{this.log.info("Navigation",Me&&Me.name,Pe&&Pe[0]),this.fine.route(Me&&Me.name),this.elemental.route(Me&&Me.name),this.settings.updateContext({route:Me,route_data:Pe})});const we=this.router.current;this.fine.route(we&&we.name),this.elemental.route(we&&we.name),this.settings.updateContext({route:we,route_data:this.router.match}),document.head.appendChild((0,D.createElement)("link",{href:z,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"}));const ze=new URL(window.location).searchParams;if(ze&&(ze.has("ffz-settings")&&this.resolve("main_menu").openExclusive(),ze.has("ffz-translate"))){const Me=this.resolve("translation_ui");Me.dialog.exclusive=!0,Me.enable()}}updateContext(){try{const ie=this.store.getState(),ae=this.router&&this.router.history;this.settings.updateContext({location:ae&&ae.location,ui:ie&&ie.ui,session:ie&&ie.session,chat:ie&&ie.chat})}catch(ie){this.log.error("Error updating context.",ie)}}getSession(){const ie=this.store&&this.store.getState();return ie&&ie.session}getUser(){if(this._user)return this._user;const ie=this.getSession();return this._user=ie&&ie.user}getCore(){return this._core||(this._core=this.web_munch.getModule("core")),this._core}};B(Re,"Twilight");let $=Re;const J="_calculateChangedBits";$.KNOWN_MODULES={simplebar:oe=>oe.globalObserver&&oe.initDOMLoadedElements,react:oe=>oe.Component&&oe.createElement,"react-dom":oe=>oe.createRoot&&oe.createPortal,core:oe=>{if(oe.x2?.experiments&&oe.x2.intl)return oe.x2;if(oe.$6?.experiments)return oe.$6;if(oe.p?.experiments)return oe.p;if(oe.o?.experiments)return oe.o;if(oe.q?.experiments)return oe.q},cookie:oe=>oe&&oe.set&&oe.get&&oe.getJSON&&oe.withConverter,"extension-service":oe=>oe.extensionService,"callout-types":oe=>{if(oe.o?.ClipLiveNudge&&oe.o?.Drop&&oe.o?.ShareResub)return oe.o},"chat-types":oe=>{if((0,I.has)(oe.ZW,"Message")&&(0,I.has)(oe.ZW,"RoomMods"))return{automod:oe.sq,chat:oe.ZW,message:oe.IF,mod:oe.RB};if((0,I.has)(oe.b,"Message")&&(0,I.has)(oe.b,"RoomMods"))return{automod:oe.a,chat:oe.b,message:oe.c,mod:oe.e};if((0,I.has)(oe.SJ,"Message")&&(0,I.has)(oe.SJ,"RoomMods"))return{automod:oe.mT,chat:oe.SJ,message:oe.Ay,mod:oe.Aw}},"gql-printer":oe=>{if(oe!==window){if(oe.print&&oe.print.toString().includes(".visit"))return oe.print;if(oe.S&&oe.S.toString().includes(".visit"))return oe.S}},"user-report":oe=>oe.Z?.displayName==="Loadable(ReportUserModal)"&&oe.Z,"sub-form":oe=>typeof oe.T=="function"&&String(oe.T).includes("CheckoutModal")&&oe.T,mousetrap:oe=>oe.bindGlobal&&oe.unbind&&oe.handleKey,"algolia-search":oe=>{if(oe.a?.prototype?.queryTopResults&&oe.a.prototype.queryForType)return oe.a;if(oe.w9?.prototype?.queryTopResults&&oe.w9.prototype.queryForType)return oe.w9},calloutstack:oe=>{if((0,I.has)(oe.at?._currentValue,"callouts")&&typeof oe.at._currentValue.pinCallout=="function")return{stack:oe.at}},highlightstack:oe=>{if((0,I.has)(oe.g$?._currentValue,"highlights")&&typeof oe.SP?._currentValue=="function")return{stack:oe.g$,dispatch:oe.SP};if((0,I.has)(oe.b,J)&&(0,I.has)(oe.c,J))return{stack:oe.b,dispatch:oe.c};if((0,I.has)(oe.fQ,J)&&(0,I.has)(oe.vJ,J))return{stack:oe.fQ,dispatch:oe.vJ};if((0,I.has)(oe.fQ?._currentValue,"highlights")&&typeof oe.vJ?._currentValue=="function")return{stack:oe.fQ,dispatch:oe.vJ}}};const Z=B(oe=>!oe||oe.includes("vendor")||oe.includes("core"),"VEND_CORE");$.KNOWN_MODULES.core.use_result=!0,$.KNOWN_MODULES.core.skip_cache=!0,$.KNOWN_MODULES.simplebar.chunks=Z,$.KNOWN_MODULES.react.chunks=Z,$.KNOWN_MODULES.cookie.chunks=Z,$.KNOWN_MODULES["gql-printer"].use_result=!0,$.KNOWN_MODULES["gql-printer"].chunks=Z,$.KNOWN_MODULES.mousetrap.chunks=Z;const G=B(oe=>!oe||oe.includes("chat"),"CHAT_CHUNK");$.KNOWN_MODULES["callout-types"].use_result=!0,$.KNOWN_MODULES["chat-types"].use_result=!0,$.KNOWN_MODULES["chat-types"].chunks=G,$.KNOWN_MODULES.calloutstack.use_result=!0,$.KNOWN_MODULES.highlightstack.use_result=!0,$.KNOWN_MODULES.highlightstack.chunks=G,$.KNOWN_MODULES["algolia-search"].use_result=!0,$.KNOWN_MODULES["algolia-search"].chunks="core",$.KNOWN_MODULES["user-report"].use_result=!0,$.KNOWN_MODULES["user-report"].chunks=oe=>!oe||oe.includes("core")||oe.includes("common"),$.KNOWN_MODULES["sub-form"].use_result=!0,$.KNOWN_MODULES["sub-form"].chunks="core",$.POPOUT_ROUTES=["embed-chat","popout","dash-popout-chat","mod-popout-chat"],$.CHAT_ROUTES=["collection","popout","dash-chat","video","user-video","user-home","user-clip","user-videos","user-clips","user-events","user-followers","user-following","user","dash","embed-chat","squad","command-center","dash-stream-manager","dash-popout-chat","mod-view","mod-popout-chat"],$.ROUTE_NAMES={dir:"Browse","dir-following":"Following","dir-all":"Browse Live Channels",dash:"Dashboard",popout:"Popout Chat","dash-popout-chat":"Dashboard Popout Chat","user-video":"Channel Video","popout-player":"Popout/Embed Player"},$.SUNLIGHT_ROUTES=["dash-stream-manager","dash-channel-analytics","dash-stream-summary","dash-achievements","dash-roles","dash-activity","dash-channel-points","dash-video-producer","dash-edit-video","dash-collections","dash-edit-collection","dash-clips","dash-settings-moderation","dash-settings-channel","dash-settings-revenue","dash-extensions","dash-streaming-tools"],$.PLAYER_ROUTES={"popout-player":"/"},$.CLIP_ROUTES={"clip-page":"/:slug"},$.DASH_ROUTES={"dash-stream-manager":"/u/:userName/stream-manager","dash-channel-analytics":"/u/:userName/channel-analytics","dash-stream-summary":"/u/:userName/stream-summary","dash-achievements":"/u/:userName/achievements","dash-roles":"/u/:userName/community/roles","dash-activity":"/u/:userName/community/activity","dash-channel-points":"/u/:userName/community/channel-points","dash-video-producer":"/u/:userName/content/video-producer","dash-edit-video":"/u/:userName/content/video-producer/edit/:videoID","dash-collections":"/u/:userName/content/collections","dash-edit-collection":"/u/:userName/content/collections/:collectionID","dash-clips":"/u/:userName/content/clips","dash-settings-moderation":"/u/:userName/settings/moderation","dash-settings-channel":"/u/:userName/settings/channel","dash-settings-revenue":"/u/:userName/settings/revenue","dash-extensions":"/u/:userName/extensions","dash-streaming-tools":"/u/:userName/broadcast","dash-popout-chat":"/popout/u/:userName/stream-manager/chat"},$.ROUTES={"front-page":"/",collection:"/directory/collection/:collectionID",dir:"/directory","dir-gaming":"/directory/gaming","dir-irl":"/directory/irl","dir-music":"/directory/music","dir-creative":"/directory/creative","dir-esports":"/directory/esports","dir-following":"/directory/following/:category?","dir-game-index":"/directory/category/:gameName","dir-game-clips":"/directory/category/:gameName/clips","dir-game-videos":"/directory/category/:gameName/videos/:filter","dir-all":"/directory/all/:filter?",dash:"/:userName/dashboard/:live?",event:"/event/:eventName",popout:"/popout/:userName/chat",video:"/videos/:videoID","user-video":"/:userName/video/:videoID","user-videos":"/:userName/videos/:filter?","user-clips":"/:userName/clips","user-clip":"/:userName/clip/:clipID","user-collections":"/:userName/collections","user-events":"/:userName/events","user-followers":"/:userName/followers","user-following":"/:userName/following",product:"/products/:productName",prime:"/prime",turbo:"/turbo",search:"/search",squad:"/:userName/squad","command-center":"/:userName/commandcenter","embed-chat":"/embed/:userName/chat","mod-view":"/moderator/:userName","mod-popout-chat":"/popout/moderator/:userName/chat"},$.DIALOG_EXCLUSIVE=".moderation-root,.sunlight-root,.twilight-main,.twilight-minimal-root>div,#root>div>.tw-full-height,.clips-root,#root",$.DIALOG_MAXIMIZED='.moderation-view-page > div[data-highlight-selector="main-grid"],.sunlight-page,.twilight-main,.twilight-minimal-root,#root .dashboard-side-nav+.tw-full-height,.clips-root>.tw-full-height .scrollable-area,.teams-page-body__outer-container .scrollable-area',$.DIALOG_SELECTOR=".moderation-root,.sunlight-root,#root,.twilight-minimal-root>.tw-full-height,.clips-root>.tw-full-height .scrollable-area"},24531:(me,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>M});var K=S(22527);const I=class I extends K.default{constructor(...W){super(...W),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.settings.add("layout.display-bits-button",{requires:["chat.bits.show"],default:null,process(x,p){return p??x.get("chat.bits.show")},ui:{path:"Appearance > Layout >> Top Navigation",title:"Show the Get Bits button.",description:"By default, this inherits its value from [Chat > Bits and Cheering > Display Bits](~chat.bits_and_cheering)",component:"setting-check-box"},changed:()=>this.BitsButton.forceUpdate()}),this.BitsButton=this.fine.define("bits-button",x=>x.toggleBalloon&&x.toggleShowTutorial)}onEnable(){this.BitsButton.ready(W=>{const x=this,p=W.prototype.render;W.prototype.render=function(){return x.settings.get("layout.display-bits-button")?p.call(this):null},this.BitsButton.forceUpdate()})}};B(I,"BitsButton");let M=I},11746:(me,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>O});var K=S(46949),M=S(22527);const I=["chat-input"],W=class W extends M.default{constructor(...p){super(...p),this.inject("settings"),this.should_enable=!0}onEnable(){this.on("core:dom-update",this.handleDomUpdate,this),this.hookSettings()}awaitSettings(p=0){return window.BetterTTV?.settings?window.BetterTTV.settings:p>100?Promise.reject():(0,K.sleep)(50).then(()=>this.awaitSettings(p+1))}async hookSettings(){const p=await this.awaitSettings(),_=B(()=>this.updateContext(p),"waiter");if(p.on("changed.clickTwitchEmotes",_),p.on("changed.bttvGIFEmotes",_),_(),p.get("ffzEmotes")){if(this.settings.provider.get("bttv-ffz-notice"))return;const l=this.resolve("site.menu_button");l&&(l.addToast({icon:"ffz-i-zreknarf",text_i18n:"compat.bttv.emotes-on",text:`You have "FrankerFaceZ Emotes" turned on in BetterTTV's settings, but you also have FrankerFaceZ installed. Please disable "FrankerFaceZ Emotes" in BetterTTV's settings. It isn't necessary.`}),this.settings.provider.set("bttv-ffz-notice",!0))}}updateContext(p){this.settings.updateContext({bttv:{loaded:!0,emote_menu:p.get("clickTwitchEmotes"),gifs:p.get("bttvGIFEmotes")}})}handleDomUpdate(p){if(window.BetterTTV?.watcher?.emitLoad&&I.includes(p)){this.log.info("Sending chat reload event to BetterTTV.");try{window.BetterTTV.watcher.emitLoad("chat")}catch(_){this.log.error("An error occurred with BetterTTV:",_)}}}};B(W,"BTTVCompat");let O=W},74756:(me,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>x});var K=S(22527),M=S(14873),I=S(46949),O=S(44589);const W=["user","user-home","user-about","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following"],p=class p extends K.default{constructor(...l){super(...l),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site.apollo"),this.inject("site.css_tweaks"),this.inject("site.elemental"),this.inject("site.subpump"),this.inject("site.fine"),this.inject("site.router"),this.inject("site.twitch_data"),this.inject("metadata"),this.inject("socket"),this.inject("pubsub"),this.settings.add("channel.auto-click-off-featured",{default:!1,ui:{path:"Channel > Behavior >> General",title:`Automatically un-check "Featured Clips Only" when viewing a channel's clips.`,component:"setting-check-box"}}),this.settings.add("channel.panel-tips",{default:!1,ui:{path:"Channel > Behavior >> Panels",title:"Display rich tool-tips for links in channel panels.",component:"setting-check-box"},changed:d=>{this.updatePanelTips(),this.css_tweaks.toggle("panel-links",d)}}),this.settings.add("channel.auto-skip-trailer",{default:!1,ui:{path:"Channel > Behavior >> General",title:"Automatically skip channel trailers.",component:"setting-check-box"},changed:d=>{d&&this.ChannelTrailer.each(f=>this.maybeSkipTrailer(f))}}),this.settings.add("channel.auto-click-chat",{default:!1,ui:{path:"Channel > Behavior >> General",title:"Automatically open chat when opening an offline channel page.",component:"setting-check-box"}}),this.settings.add("channel.extra-links",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Add extra links to live channel pages, next to the streamer's name.",component:"setting-check-box"},changed:()=>this.updateLinks()}),this.ChannelPanels=this.fine.define("channel-panels",d=>d.layoutMasonry&&d.updatePanelOrder&&d.onExtensionPoppedOut,W),this.ChannelTrailer=this.elemental.define("channel-trailer",".channel-trailer-player__wrapper",W,{attributes:!0},1),this.ChannelRoot=this.elemental.define("channel-root",".channel-root",W,{attributes:!0},1),this.InfoBar=this.elemental.define("channel-info-bar","#live-channel-stream-information",W,{childNodes:!0,subtree:!0},1)}onEnable(){this.updateChannelColor(),this.css_tweaks.toggle("panel-links",this.settings.get("channel.panel-tips")),this.on("i18n:update",this.updateLinks,this),this.ChannelTrailer.on("mount",this.maybeSkipTrailer,this),this.ChannelTrailer.on("update",this.maybeSkipTrailer,this),this.ChannelTrailer.each(l=>this.maybeSkipTrailer(l)),this.ChannelPanels.on("mount",this.updatePanelTips,this),this.ChannelPanels.on("update",this.updatePanelTips,this),this.ChannelPanels.on("unmount",this.removePanelTips,this),this.ChannelPanels.ready((l,d)=>{for(const f of d)this.updatePanelTips(f)}),this.ChannelRoot.on("mount",this.updateRoot,this),this.ChannelRoot.on("mutate",this.updateRoot,this),this.ChannelRoot.on("unmount",this.removeRoot,this),this.ChannelRoot.each(l=>this.updateRoot(l)),this.InfoBar.on("mount",this.updateBar,this),this.InfoBar.on("mutate",this.updateBar,this),this.InfoBar.on("unmount",this.removeBar,this),this.InfoBar.each(l=>this.updateBar(l)),this.router.on(":route",this.checkNavigation,this),this.checkNavigation()}maybeSkipTrailer(l){if(!this.settings.get("channel.auto-skip-trailer"))return;const d=this.fine.searchParent(l,f=>f.props&&f.props.onDismiss);d&&(this.log.info("Automatically skipping channel trailer."),d.props.onDismiss())}updatePanelTips(l){if(!l){for(const f of this.ChannelPanels.instances)f&&this.updatePanelTips(f);return}const d=this.fine.getChildNode(l);if(!d||!this.settings.get("channel.panel-tips"))return this.removePanelTips(l);if(l._ffz_tips&&l._ffz_tip_el!==d&&this.removePanelTips(l),!l._ffz_tips){const f=this.resolve("tooltips");f&&(l._ffz_tips=f._createInstance(d,"tw-link","link",f.getRoot()),l._ffz_tip_el=d)}}removePanelTips(l){l?._ffz_tips&&(l._ffz_tips.destroy(),l._ffz_tips=null,l._ffz_tip_el=null)}checkFeaturedClips(){this.router.current_name!=="user-clips"&&this.router.current_name!=="user-videos"||this._featured_waiting||!this.settings.get("channel.auto-click-off-featured")||(this._featured_waiting=this.parent.awaitElement("input#featured-clips-toggle").then(l=>{l.checked&&l.click(),this._featured_waiting=!1}).catch(()=>{this._featured_waiting=!1}))}checkNavigation(){this.checkFeaturedClips(),!(!this.settings.get("channel.auto-click-chat")||this.router.current_name!=="user-home")&&this.router.old_location!==this.router.location&&this.router.history.replace(this.router.location,{channelView:"Watch"})}updateLinks(){for(const l of this.InfoBar.instances)l._ffz_link_login=null,this.updateBar(l)}updateSubscription(l,d){this._subbed_login===d&&this._subbed_id===l||(this._subbed_id&&(this.pubsub.unsubscribe(this,`twitch/${this._subbed_id}`),this._subbed_id=null),this._subbed_login&&(this.socket.unsubscribe(this,`channel.${this._subbed_login}`),this._subbed_login=null),l&&(this.pubsub.subscribe(this,`twitch/${l}`),this._subbed_id=l),d&&(this.socket.subscribe(this,`channel.${d}`),this._subbed_login=d))}updateBar(l){l._ffz_update||(l._ffz_update=(0,I.debounce)(()=>requestAnimationFrame(()=>this._updateBar(l)),1e3,2)),l._ffz_update()}_updateBar(l){l._ffz_cont&&!document.contains(l._ffz_cont)&&(l._ffz_cont.classList.remove("ffz--meta-tray"),l._ffz_cont=null);const d=this.settings.get("channel.extra-links");l._ffz_links&&(!document.contains(l._ffz_links)||!d)&&(l._ffz_links.remove(),l._ffz_links=null,l._ffz_link_login=null);let f=l.querySelector(".ffz--native-viewers-container");if(!f){let y=0,a=l.querySelector('p[data-a-target="animated-channel-viewers-count"]');for(;a&&a!=l&&y<5;){if(a.querySelector("svg")){a.classList.add("ffz--native-viewers-container"),f=a;break}a=a.parentElement,y++}}if(!l._ffz_cont){let y=l.querySelector('.report-button,button[data-test-selector="video-options-button"],button[data-test-selector="clip-options-button"],button[data-a-target="report-button-more-button"]');!y&&f&&(y=f.parentElement);let a=y&&(y.closest(".tw-flex-wrap.tw-justify-content-end")||y.closest(".tw-justify-content-end"));!a&&y&&(a=y.parentElement?.parentElement,a&&a.parentElement?.childElementCount===2&&y.dataset.aTarget!=="report-button-more-button"&&(a=a.parentElement.firstElementChild)),a&&l.contains(a)?(l._ffz_cont=a,a.classList.add("ffz--meta-tray")):l._ffz_cont=null}if(!l._ffz_links&&d){const y=l.querySelector("a .tw-title"),a=y&&y.closest("a"),w=a&&a.closest("div");w&&l.contains(w)&&(l._ffz_links=(0,O.createElement)("div",{class:"ffz--links tw-mg-l-1"}),w.appendChild(l._ffz_links))}const r=this.fine.getReactInstance(l);let b=r?.child?.memoizedProps;b?.channelLogin||(b=b?.children?.props);const u=b?.watchPartyProps?.isShowingWatchPartyInMain;if(this.settings.updateContext({isWatchParty:u}),!l._ffz_cont||!b?.channelID){this.updateSubscription(null,null);return}if(l._ffz_links&&b.channelLogin!==l._ffz_link_login){const y=l._ffz_link_login=b.channelLogin;if(y){const a=B((w,F)=>{const D=(0,O.createElement)("a",{href:w,class:"tw-c-text-alt-2 tw-interactive tw-pd-x-1 tw-font-size-5"},F);return D.addEventListener("click",z=>{if(z.ctrlKey||z.shiftKey||z.altKey)return;const $=this.router.history;$&&(z.preventDefault(),$.push(w))}),D},"make_link");l._ffz_links.closest(".home-header-sticky")?l._ffz_links.innerHTML="":(0,O.setChildren)(l._ffz_links,[a(`/${y}/schedule`,this.i18n.t("channel.links.schedule","Schedule")),a(`/${y}/videos`,this.i18n.t("channel.links.videos","Videos")),a(`/${y}/clips`,this.i18n.t("channel.links.clips","Clips"))])}else l._ffz_links.innerHTML=""}let v=null;this.fine.searchNode(r,y=>{let a=y?.memoizedState,w=0;for(;a!=null&&v==null&&w<50;)v=a?.memoizedState?.current?.result?.data?.user??a?.memoizedState?.current?.previousData?.user,v?.lastBroadcast?.game||(v=null),v||(a=a?.next),w++;return v!=null});const A=v?.lastBroadcast?.game,C=v?.lastBroadcast?.title;(A?.id!==l._ffz_game_cache||C!==l._ffz_title_cache)&&this.settings.updateContext({category:A?.displayName,categoryID:A?.id,title:C}),this.updateSubscription(b.channelID,b.channelLogin),this.updateMetadata(l),this.emit(":update-bar",l,b,v)}removeBar(l){if(this.updateSubscription(null,null),l._ffz_cont&&l._ffz_cont.classList.remove("ffz--meta-tray"),l._ffz_cont=null,l._ffz_meta_timers){for(const d of Object.values(l._ffz_meta_timers))clearTimeout(d);l._ffz_meta_timers=null}l._ffz_update=null}updateMetadata(l,d){const f=l._ffz_cont;let b=this.fine.getReactInstance(l)?.memoizedProps?.children?.props;if(b&&!b.channelID&&(b=b.children?.props),!f||!document.contains(f)||!b||!b.channelID)return;d?Array.isArray(d)||(d=[d]):d=this.metadata.keys;const u=l._ffz_meta_timers=l._ffz_meta_timers||{},v=B(C=>this.updateMetadata(l,C),"refresh_fn"),A={channel:{id:b.channelID,login:b.channelLogin,display_name:b.displayName,live:b.isLive&&!b.videoID&&!b.clipSlug,video:!!(b.videoID||b.clipSlug),live_since:b.liveSince},props:b,el:l,getViewerCount:()=>{const C=f.querySelector('p[data-a-target="animated-channel-viewers-count"]'),y=C&&this.fine.getReactInstance(C),a=y?.memoizedProps?.children;if(typeof a=="string"&&/^[0-9,.]+$/.test(a))try{const F=parseInt(a.replace(/,/,""),10);if(!isNaN(F)&&isFinite(F)&&F>0)return F}catch{}const w=a?.props;return w&&w.value!=null?w.value:0},getUserSelfImmediate:C=>{const y=this.getUserSelf(l,b.channelID,!0);return y&&y.then?(y.then(C),null):y},getUserSelf:()=>this.getUserSelf(l,b.channelID),getBroadcastID:()=>this.getBroadcastID(l,b.channelID)};for(const C of d)this.metadata.renderLegacy(C,A,f,u,v)}updateRoot(l){const d=this.fine.getReactInstance(l);let f=null,r=d,b=0,u=0;for(;r!=null&&f==null&&b<10;){let v=r?.memoizedState;for(u=0;v!=null&&f==null&&u<50;)f=v?.memoizedState?.current?.result?.data?.userOrError??v?.memoizedState?.current?.previousData?.userOrError,f||(v=v?.next),u++;r=r?.return,b++}f&&f.id?(this.updateChannelColor(f.primaryColorHex),this.settings.updateContext({channel:f.login,channelID:f.id,channelColor:f.primaryColorHex})):this.removeRoot()}removeRoot(){this.updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})}updateChannelColor(l){let d=l&&M.Color.RGBA.fromHex(l);d||(d=M.Color.RGBA.fromHex("9147FF")),d?(this.css_tweaks.setVariable("channel-color",d.toCSS()),this.css_tweaks.setVariable("channel-color-20",d._a(.2).toCSS()),this.css_tweaks.setVariable("channel-color-30",d._a(.3).toCSS())):(this.css_tweaks.deleteVariable("channel-color"),this.css_tweaks.deleteVariable("channel-color-20"),this.css_tweaks.deleteVariable("channel-color-30"))}getUserSelf(l,d,f){const r=l._ffz_self_cache=l._ffz_self_cache||{};return d===r.channel_id&&Date.now()-r.saved<6e4?f?r.data:Promise.resolve(r.data):new Promise(async(b,u)=>{if(r.updating){r.updating.push([b,u]);return}r.channel_id=d,r.updating=[[b,u]];let v,A;try{v=await this.twitch_data.getUserSelf(d)}catch(y){v=null,A=y}const C=r.updating;if(r.updating=null,r.channel_id!==d){A=new Error("Outdated"),r.channel_id=null,r.data=null,r.saved=0;for(const y of C)y[1](A);return}r.data=v,r.saved=Date.now();for(const y of C)A?y[1](A):y[0](v)})}getBroadcastID(l,d){const f=l._ffz_bcast_cache=l._ffz_bcast_cache||{};return d===f.channel_id&&Date.now()-f.saved<6e4?Promise.resolve(f.broadcast_id):new Promise(async(r,b)=>{if(f.updating){f.updating.push([r,b]);return}f.channel_id=d,f.updating=[[r,b]];let u,v;try{u=await this.twitch_data.getBroadcastID(d)}catch(C){u=null,v=C}const A=f.updating;if(f.updating=null,f.channel_id!==d){v=new Error("Outdated"),f.channel_id=null,f.broadcast_id=null,f.saved=0;for(const C of A)C[1](v);return}f.broadcast_id=u,f.saved=Date.now();for(const C of A)v?C[1](v):C[0](u)})}};B(p,"Channel");let x=p},6172:(me,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>_e,formatBitsConfig:()=>ue});var K=S(14873),M=S(46949),I=S(24431),O=S(83342),W=S(6170),x=S(22527),p=S(89196);const _=["touchmove","scroll","wheel","mousewheel","DOMMouseScroll"];let l=0;const Ee=class Ee extends x.default{constructor(...c){super(...c),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("site"),this.inject("site.fine"),this.inject("site.web_munch"),this.ChatScroller=this.fine.define("chat-scroller",m=>m.saveScrollRef&&m.handleScrollEvent&&!m.renderLines&&m.resume,p.Z.CHAT_ROUTES),this.settings.add("chat.scroller.freeze",{default:0,ui:{path:"Chat > Behavior >> Scrolling",title:"Pause Chat Scrolling",description:`Automatically stop chat from scrolling when moving the mouse over it or holding a key.

**Note:** Scrolling up in chat will always prevent automatic scrolling, regardless of this setting.`,component:"setting-select-box",data:[{value:0,title:"Use Twitch Setting"},{value:1,title:"On Hover"},{value:2,title:"When Ctrl is Held"},{value:3,title:"When Meta is Held"},{value:4,title:"When Alt is Held"},{value:5,title:"When Shift is Held"},{value:6,title:"Ctrl or Hover"},{value:7,title:"Meta or Hover"},{value:8,title:"Alt or Hover"},{value:9,title:"Shift or Hover"}]}}),this.settings.add("chat.scroller.freeze-requires-hover",{default:!0,ui:{path:"Chat > Behavior >> Scrolling",title:"Require the mouse to be over chat to freeze with a hotkey.",component:"setting-check-box"}}),this.settings.add("chat.scroller.hover-delay",{default:750,ui:{path:"Chat > Behavior >> Scrolling",title:"Hover Timeout",description:"Chat will only remain frozen due to mouse hovering for this long after the mouse stops moving.",component:"setting-combo-box",data:[{value:250,title:"0.25 Seconds"},{value:500,title:"0.50 Seconds"},{value:750,title:"0.75 Seconds"},{value:1e3,title:"1 Second"},{value:2500,title:"2.5 Seconds"},{value:5e3,title:"5 Seconds"}]}}),this.settings.add("chat.scroller.smooth-scroll",{default:0,ui:{path:"Chat > Behavior >> Scrolling",title:"Smooth Scrolling",description:`**Note:** This may not behave well depending on your browser. Disable this if you encounter issues.

Smoothly slide new chat messages into view. Speed will increase as necessary to keep up with chat.`,component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Slow"},{value:2,title:"Medium"},{value:3,title:"Fast"},{value:4,title:"Very Fast"}]}})}updateUseKeys(){const c=this.use_keys;this.use_keys=!1;for(const m of this.chat.context.get("chat.actions.inline"))if(m&&m.display&&m.display.keys){this.use_keys=!0;break}for(const m of this.chat.context.get("chat.actions.hover"))if(m&&m.display&&m.display.keys){this.use_keys=!0;break}if(this.use_keys!==c)for(const m of this.ChatScroller.instances)m&&m.ffzUpdateKeys&&m.ffzUpdateKeys()}async onEnable(){this.on("i18n:update",()=>this.ChatScroller.forceUpdate()),this.chat.context.on("changed:chat.actions.inline",this.updateUseKeys,this),this.updateUseKeys(),this.pause_hover=this.chat.context.get("chat.scroller.freeze-requires-hover"),this.chat.context.on("changed:chat.scroller.freeze-requires-hover",P=>{this.pause_hover=P;for(const V of this.ChatScroller.instances)V.ffzMaybeUnpause()}),this.pause_delay=this.chat.context.get("chat.scroller.hover-delay"),this.chat.context.on("changed:chat.scroller.hover-delay",P=>{this.pause_delay=P;for(const V of this.ChatScroller.instances)V.ffzMaybeUnpause()}),this.pause=this.chat.context.get("chat.scroller.freeze"),this.chat.context.on("changed:chat.scroller.freeze",P=>{this.pause=P;for(const V of this.ChatScroller.instances)V.ffzMaybeUnpause()}),this.smooth_scroll=this.chat.context.get("chat.scroller.smooth-scroll"),this.chat.context.on("changed:chat.scroller.smooth-scroll",P=>{this.smooth_scroll=P;for(const V of this.ChatScroller.instances)V.ffzSetSmoothScroll(P)});const c=this,m=await this.site.findReact(),N=m?.createElement;if(!N)return c.log.warn("Unable to get React.");this.ChatScroller.ready((P,V)=>{const H=P.prototype.componentDidCatch,j=P.prototype.render;P.prototype.componentDidCatch=function(U,ee){const he=this.state.ffz_errors||0;if(he<100&&(this.setState({ffz_errors:he+1,ffz_total_errors:(this.state.ffz_total_errors||0)+1}),c.log.capture(U,{extra:ee}),c.log.info("Error within Chat",U,ee,he)),H)return H.call(this,U,ee)},P.prototype.ffzZeroErrors=function(){this.setState({ffz_errors:0})},P.prototype.render=function(){if(this.state.ffz_errors>0){let U;const ee=this.state.ffz_total_errors<10,he=B(()=>{clearTimeout(U),this.ffzZeroErrors()},"handler");return ee&&(U=setTimeout(he,250)),N?N("div",{className:"tw-border-l tw-c-background-alt-2 tw-c-text-base tw-full-width tw-full-height tw-align-items-center tw-flex tw-flex-column tw-justify-content-center tw-relative"},[N("div",{className:"tw-mg-b-1"},"There was an error displaying chat."),!ee&&N("button",{className:"tw-button",onClick:he},N("span",{className:"tw-button__text"},"Try Again"))]):null}else{const U=j.call(this);try{const ee=U?.props?.children?.props?.children;ee?.[2]?.type?.displayName==="ChatPausedFooter"&&(ee[2]=this.ffzRenderFooter())}catch{}return U}},P.prototype.ffzInstallCleaner=function(){this._ffz_cleaner||(this._ffz_cleaner=this.ffzOnClean.bind(this),this._ffz_clean_timer=setInterval(this._ffz_cleaner,6e4))},P.prototype.ffzOnClean=function(){const U=c.fine.getChildNode(this);if(!U)return this.ffzRemoveCleaner();requestAnimationFrame(()=>c.cleanMessages(U.querySelector(".chat-scrollable-area__message-container")))},P.prototype.ffzRemoveCleaner=function(){this._ffz_clean_timer&&clearInterval(this._ffz_clean_timer),this._ffz_clean_timer=this._ffz_cleaner=null},P.prototype.ffzInstallHandler=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const U=this;U.ffz_oldScrollEvent=U.handleScrollEvent,U.ffz_oldScroll=U.scrollToBottom,U.ffz_acting=!1,U.ffz_outside=!0,U._ffz_accessor=`_ffz_contains_${l++}`,c.on("tooltips:hover",this.ffzTooltipHover,this),c.on("tooltips:leave",this.ffzTooltipLeave,this),U.scrollToBottom=function(){U._ffz_scroll_request||(U._ffz_scroll_request=requestAnimationFrame(U._scrollToBottom))},U._scrollToBottom=function(){U._ffz_scroll_request=null,U.state.isPaused||(U.ffz_smooth_scroll&&!U._ffz_one_fast_scroll?U.ffzSmoothScroll():(U._ffz_one_fast_scroll=!1,U.ffz_oldScroll()))},U.handleScrollEvent=function(Be){if(!U.scrollRef?.scrollContent||!(Be.which>0||Be.type==="mousewheel"||Be.type==="wheel"||Be.type==="touchmove"))return;const Y=U.scrollRef.scrollContent,ge=Y.scrollHeight-Y.scrollTop-Y.offsetHeight,re=ge>10;re!==U.state.ffz_scrolled_up&&U.setState({ffz_scrolled_up:re}),U.state.isPaused&&re&&U.setLoadMoreEnabled(!0),U.state.isPaused&&!re?U.ffzMaybeUnpause():!U.state.isPaused&&re&&U.pause()};const ee=U.resume;U.ffzFastResume=function(){U._ffz_one_fast_scroll=!0,U.resume()},U.resume=function(){U.setState({ffz_scrolled_up:!1}),ee.call(this)};const he=c.web_munch.getModule("mousetrap")||window.Mousetrap;he!=null&&(he.unbind("alt","keydown"),he.unbind("alt","keyup")),U.ffzHandleKey=U.ffzHandleKey.bind(U),window.addEventListener("keydown",U.ffzHandleKey),window.addEventListener("keyup",U.ffzHandleKey),U.hoverPause=U.ffzMouseMove.bind(U),U.hoverResume=U.ffzMouseLeave.bind(U);const Se=c.fine.getChildNode(U);Se&&Se.addEventListener("mousemove",U.hoverPause);const Te=this.scrollRef?.scrollContent;if(Te)for(const Be of _)Te.removeEventListener(Be,U.ffz_oldScrollEvent),Te.addEventListener(Be,U.handleScrollEvent);U.forceUpdate(),c.emit("site:dom-update","chat-scroller",U)},P.prototype.ffzSmoothScroll=function(){this._ffz_smooth_animation&&cancelAnimationFrame(this._ffz_smooth_animation),this.ffz_is_smooth_scrolling=!0;let U=this.ffz_smooth_scroll,ee=performance.now();const he=this.scrollRef?.scrollContent;if(!he)return;const Se=he.scrollHeight-he.clientHeight,Te=Se-he.scrollTop;Te>he.clientHeight?U=Te:Te>200&&(U+=U*Math.floor(Te/200));const Be=B(()=>{if(this.state.isPaused)return this.ffz_is_smooth_scrolling=!1;const Y=performance.now(),ge=Y-ee,re=U*(ge/10);if(re>=1){const Ce=he.scrollTop,Ne=Ce+re,We=he.scrollHeight-he.clientHeight;ee=Y,Ne<We?(he.scrollTop=Ce+re,this._ffz_smooth_animation=requestAnimationFrame(Be)):(he.scrollTop=We,this.ffz_is_smooth_scrolling=!1)}else this._ffz_smooth_animation=requestAnimationFrame(Be)},"smoothAnimation");Be()},P.prototype.ffzSetSmoothScroll=function(U){this.ffz_smooth_scroll=U,this.ffzMaybeUnpause()},P.prototype.ffzReadKeysFromEvent=function(U){return U.altKey===this.ffz_alt&&U.shiftKey===this.ffz_shift&&U.ctrlKey===this.ffz_ctrl&&U.metaKey===this.ffz_meta?!1:(this.ffz_alt=U.altKey,this.ffz_shift=U.shiftKey,this.ffz_ctrl=U.ctrlKey,this.ffz_meta=U.metaKey,!0)},P.prototype.ffzHandleKey=function(U){if(!this.ffzReadKeysFromEvent(U)||(this.ffzUpdateKeyTags(),c.pause_hover&&this.ffz_outside||this.ffzGetMode()<2))return;const ee=this.ffzShouldBePaused();ee!==this.state.isPaused&&(ee?(this.pause(),this.state.ffz_scrolled_up||this.setLoadMoreEnabled(!1)):this.resume())},P.prototype.ffzInstallHoverTimer=function(){this._ffz_hover_timer||(this._ffz_hover_timer=setInterval(()=>{this.state.isPaused&&this.ffzShouldBePaused()||this.ffzMaybeUnpause()},50))},P.prototype.ffzMouseMove=function(U){this.ffz_last_move=Date.now();const ee=this.ffz_outside;this.ffz_outside=!1,this._ffz_outside_timer&&(clearTimeout(this._ffz_outside_timer),this._ffz_outside_timer=null);const he=this.ffzReadKeysFromEvent(U);if(!he&&U.screenX===this.ffz_sx&&U.screenY===this.ffz_sy){ee&&this.ffzUpdateKeyTags();return}this.ffz_sx=U.screenX,this.ffz_sy=U.screenY,(he||ee)&&this.ffzUpdateKeyTags();const Se=this.ffzShouldBePaused();Se!==this.state.isPaused&&(Se?(this.pause(),this.ffzInstallHoverTimer(),this.state.ffz_scrolled_up||this.setLoadMoreEnabled(!1)):this.resume())},P.prototype.ffzMouseLeave=function(){this.ffz_outside=!0,this._ffz_outside_timer&&clearTimeout(this._ffz_outside_timer),this._ffz_outside_timer=setTimeout(()=>this.ffzMaybeUnpause(),64),this.ffzUpdateKeyTags()},P.prototype.ffzTooltipHover=function(U,ee,he){if(U[this._ffz_accessor]==null){const Se=this.scrollRef?.scrollContent;U[this._ffz_accessor]=Se?Se.contains(U):!1}U[this._ffz_accessor]&&this.ffzMouseMove(he)},P.prototype.ffzTooltipLeave=function(U){if(!this.ffz_outside){if(U[this._ffz_accessor]==null){const ee=this.scrollRef?.scrollContent;U[this._ffz_accessor]=ee?ee.contains(U):!1}U[this._ffz_accessor]&&this.ffzMouseLeave()}},P.prototype.ffzUpdateActing=function(){this._ffz_key_frame_acting||(this._ffz_key_frame_acting=requestAnimationFrame(()=>this.ffz_updateActing()))},P.prototype.ffz_updateActing=function(){this._ffz_key_frame_acting=null,this.scrollRef?.root&&(this.scrollRef.root.dataset.acting=this.ffz_acting)},P.prototype.ffzUpdateKeyTags=function(){this._ffz_key_frame||(this._ffz_key_frame=requestAnimationFrame(()=>this.ffz_updateKeyTags()))},P.prototype.ffz_updateKeyTags=function(){if(this._ffz_key_frame=null,!c.use_keys&&this.ffz_use_keys===c.use_keys||!this.scrollRef?.root)return;this.ffz_use_keys=c.use_keys,this.scrollRef.root.classList.toggle("ffz--keys",c.use_keys);const U=this.scrollRef.root.dataset;c.use_keys?(U.alt=!this.ffz_outside&&this.ffz_alt,U.ctrl=!this.ffz_outside&&this.ffz_ctrl,U.shift=!this.ffz_outside&&this.ffz_shift,U.meta=!this.ffz_outside&&this.ffz_meta):(delete U.alt,delete U.ctrl,delete U.shift,delete U.meta)},P.prototype.ffzShouldBePaused=function(U){if(U==null&&(U=Date.now()-(this.ffz_last_move??Date.now())),this.state.ffz_scrolled_up)return!0;const ee=this.ffzGetMode();return(!c.pause_hover||!this.ffz_outside)&&(this.ffz_acting||this.ffz_ctrl&&(ee===2||ee===6)||this.ffz_meta&&(ee===3||ee===7)||this.ffz_alt&&(ee===4||ee===8)||this.ffz_shift&&(ee===5||ee===9)||!this.ffz_outside&&U<c.pause_delay&&(ee===1||ee>5))},P.prototype.ffzGetMode=function(){let U=c.pause;if(U===0&&!this.props.mouseoverPausingDisabled){const ee=this.props.pauseSetting;ee==="MOUSEOVER_ALTKEY"?U=8:ee==="MOUSEOVER"?U=1:ee==="ALTKEY"&&(U=4)}return U},P.prototype.ffzMaybeUnpause=function(){this.state.isPaused&&!this._ffz_unpause_frame&&(this._ffz_unpause_frame=requestAnimationFrame(()=>{this._ffz_unpause_frame=null,this.state.isPaused&&!this.ffzShouldBePaused()&&this.resume()}))},P.prototype.ffzRenderFooter=function(){let U,ee="";if(this.state.ffz_scrolled_up)U=c.i18n.t("chat.messages-below","Chat Paused Due to Scroll");else if(this.state.isPaused){const he=this.ffzGetMode(),Se=this.ffz_acting?c.i18n.t("chat.acting","Taking Action"):he===2?c.i18n.t("key.ctrl","Ctrl Key"):he===3?c.i18n.t("key.meta","Meta Key"):he===4?c.i18n.t("key.alt","Alt Key"):he===5?c.i18n.t("key.shift","Shift Key"):he===6?c.i18n.t("key.ctrl_mouse","Ctrl or Mouse"):he===7?c.i18n.t("key.meta_mouse","Meta or Mouse"):he===8?c.i18n.t("key.alt_mouse","Alt or Mouse"):he===9?c.i18n.t("key.shift_mouse","Shift or Mouse"):c.i18n.t("key.mouse","Mouse Movement");U=c.i18n.t("chat.paused","Chat Paused Due to {reason}",{reason:Se}),ee="ffz--freeze-indicator"}else return N("div",{className:`chat-scroll-footer__placeholder tw-flex tw-justify-content-center tw-relative ${ee}`},null);return N("div",{className:`chat-scroll-footer__placeholder tw-flex tw-justify-content-center tw-relative ${ee}`},N("div",{className:"tw-absolute tw-border-radius-medium tw-bottom-0 tw-c-background-overlay tw-c-text-overlay tw-mg-b-1"},N("button",{className:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--overlay ffz-core-button--text tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative","data-a-target":"chat-list-footer",onClick:this.ffzFastResume},N("div",{className:"tw-align-items-center ffz-core-button-label tw-flex tw-flex-grow-0"},N("div",{className:"tw-flex-grow-0"},U)))))};for(const U of V)this.onMount(U)}),this.ChatScroller.on("mount",this.onMount,this),this.ChatScroller.on("unmount",this.onUnmount,this)}onMount(c){c.ffzSetSmoothScroll(this.smooth_scroll),c.ffzInstallHandler(),c.ffzInstallCleaner()}onUnmount(c){this.off("tooltips:hover",c.ffzTooltipHover,c),this.off("tooltips:leave",c.ffzTooltipLeave,c),c._ffz_hover_timer&&(clearInterval(c._ffz_hover_timer),c._ffz_hover_timer=null),c._ffz_outside_timer&&(clearTimeout(c._ffz_outside_timer),c._ffz_outside_timer=null),c.ffzRemoveCleaner(),window.removeEventListener("keydown",c.ffzHandleKey),window.removeEventListener("keyup",c.ffzHandleKey)}cleanMessages(c){const m=ffz.site.fine.getReactInstance(c);if(!m||!Array.isArray(m.child?.memoizedProps))return;let N=null,P=m.child,V=0;for(;P&&V<10;){if(P.stateNode instanceof HTMLDivElement){N=P.stateNode;break}P=P.child,V++}if(!N||N.parentElement!==c)return;let H=N.previousElementSibling;for(V=0;H;){const j=H;H=H.previousElementSibling,j.remove(),V++}V>0&&this.log.debug(`Removed ${V} dead chat lines from`,c)}};B(Ee,"Scroller");let d=Ee;const f="https://static-cdn.jtvnw.net/emoticons/v1/58765/2.0",$e=class $e extends x.default{constructor(...c){super(...c),this.inject("chat"),this.inject("i18n"),this.inject("site"),this.RichContent=null,this.has_tokenizer=!1}async loadTokenizer(){if(!this.has_tokenizer)return this.tokenizer=await Promise.all([S.e(2009),S.e(208)]).then(S.bind(S,30642)),this.has_tokenizer=!0,this.tokenizer}async onEnable(){var P;const c=this,m=await this.site.findReact();if(!m)return;const N=m.createElement;this.RichContent=(P=class extends m.Component{constructor(H){super(H),this.state={loaded:!1,error:!1,has_tokenizer:c.has_tokenizer},c.has_tokenizer||c.loadTokenizer().then(()=>this.setState({...this.state,has_tokenizer:!0}))}async load(H=!1){this.clearRefresh();try{let j=this.props.getData(H);if(j instanceof Promise){const U=(0,M.has)(this.props,"timeout")?this.props.timeout:1e3;U?j=await(0,M.timeout)(j,U):j=await j}if(j||(j={error:{type:"i18n",key:"card.empty",phrase:"No data was returned."}}),j.error&&(j={short:{type:"header",image:{type:"image",url:f},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:j.error}}),j.refresh)try{this.clearRefresh();const U=new Date(j.refresh).getTime(),ee=U-Date.now();ee>0&&(this._refresh_timer=setTimeout(()=>this.load(!0),ee+100*Math.floor(Math.random()*100)))}catch{}this.setState(Object.assign({loaded:!0,url:this.props.url},j))}catch(j){j.message!=="timeout"&&c.log.capture(j),this.setState({has_tokenizer:c.has_tokenizer,loaded:!0,url:this.props.url,short:{type:"header",image:{type:"image",url:f},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:String(j)}})}}clearRefresh(){this._refresh_timer&&(clearTimeout(this._refresh_timer),this._refresh_timer=null)}checkReload(H){(!H||H&&this.props.url===H)&&this.reload()}reload(H=!1){this.clearRefresh(),this.setState({loaded:!1,error:!1,has_tokenizer:c.has_tokenizer},()=>this.load(H))}componentDidMount(){c.on("chat:update-link-resolver",this.checkReload,this),this.load()}componentWillUnmount(){c.off("chat:update-link-resolver",this.checkReload,this),this.clearRefresh()}renderCard(){return this.props.renderBody?this.props.renderBody(this.state,this,N):[this.renderUnsafe(),this.renderBody()]}renderUnsafe(){if(!this.state.unsafe)return null;const H=Array.from(new Set(this.state.urls.map(j=>j.flags).flat())).join(", ").toLowerCase();return N("div",{class:"ffz--corner-flag ffz--corner-flag__warn ffz-tooltip ffz-tooltip--no-mouse","data-title":c.i18n.t("tooltip.link-unsafe","Caution: This URL is has been flagged as potentially harmful by: {reasons}",{reasons:H})},N("figure",{class:"ffz-i-attention"}))}renderBody(){let H;return(this.props.force_full===!0||this.props.force_full!==!1&&this.props.want_full&&this.state.full)&&(H=this.state.full),this.props.force_mid===!0||this.props.force_mid!==!1&&this.props.want_mid&&this.state.mid?H=this.state.mid:H=this.state.short,c.has_tokenizer&&this.state.v&&this.state.v>c.tokenizer.VERSION&&(H=null),c.has_tokenizer&&this.state.loaded&&H?N("div",{class:"ffz-card-rich tw-full-width tw-overflow-hidden tw-flex tw-flex-column"},c.tokenizer.renderTokens(H,N,{vue:!1,tList:(...j)=>c.i18n.tList(...j),i18n:c.i18n,last_player:0,player_state:this.state.player_state,togglePlayer:j=>{const U=this.state.player_state??{};U[j]=!U[j],this.setState({player_state:U})},link_click_handler:c.chat.handleLinkClick,fragments:this.state.fragments,i18n_prefix:this.state.i18n_prefix,allow_media:c.chat.context.get("tooltip.link-images"),allow_unsafe:c.chat.context.get("tooltip.link-nsfw-images")})):this.renderBasic()}renderBasic(){let H,j;return this.state.error?(H=c.i18n.t("card.error","An error occurred."),j=this.state.error):this.state.loaded&&this.state.has_tokenizer?(H=this.state.title,j=this.state.description):j=c.i18n.t("card.loading","Loading..."),!H&&!j&&(j=c.i18n.t("card.empty","No data was returned.")),j=j?j.split(/\n+/).slice(0,2).map(U=>N("div",{class:"tw-c-text-alt-2 tw-ellipsis tw-mg-x-05",title:U},U)):[],[N("div",{class:"ffz--header-image"}),N("div",{class:"ffz--card-text tw-full-width tw-overflow-hidden tw-flex tw-flex-column tw-justify-content-center"},H&&N("div",{class:"chat-card__title tw-ellipsis tw-mg-x-05"},N("span",{class:"tw-strong",title:H},H)),j)]}render(){let H=N("div",{class:"tw-flex tw-flex-nowrap tw-pd-05"},this.renderCard());const j=this.props.card_tooltip&&this.state.full&&!this.props.force_full;return this.state.url&&(H=N("a",{class:`${j?"ffz-tooltip ":""}${this.state.accent?"ffz-accent-card ":""}${this.state.error?"":"ffz-interactable--hover-enabled "}tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--default tw-interactive`,"data-tooltip-type":"link","data-url":this.state.url,"data-is-mail":!1,target:"_blank",rel:"noreferrer noopener",href:this.state.url,onClick:c.chat.handleLinkClick},H)),N("div",{class:`tw-border-radius-medium tw-elevation-1 ffz--chat-card tw-relative${this.state.unsafe?" ffz--unsafe":""}`,style:{"--ffz-color-accent":this.state.accent||null}},N("div",{class:"tw-border-radius-medium tw-c-background-alt tw-flex tw-full-width"},H))}},B(P,"RichContent"),P)}};B($e,"RichContent");let r=$e;var b=S(83269),u=S(44615);const v={1e3:1,2e3:2,3e3:3},He=class He extends x.default{constructor(...c){super(...c),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("site"),this.inject("site.fine"),this.inject(r),this.inject("experiments"),this.inject("chat.actions"),this.inject("chat.overrides"),this.inject("chat.emotes"),this.line_types={},this.line_types.unknown={renderNotice:(m,N,P,V,H)=>`Unknown message type: ${m.ffz_type}`},this.line_types.notice={renderNotice:(m,N,P,V,H)=>{const j=m.ffz_data;let U=this.line_types.notice.renderContent(m,N,P,V,H);if(!j.icon)return U;if(typeof U=="string"&&(U=H("span",{},U)),typeof j.icon=="function")try{U.ffz_icon=j.icon(j,V,H)}catch(ee){this.log.capture(ee),this.log.error("Error using custom renderer for notice:",ee)}else j.icon instanceof URL?U.ffz_icon=H("img",{className:"ffz-notice-icon tw-mg-r-05",src:j.icon.toString()}):U.ffz_icon=H("span",{className:`${j.icon} tw-mg-r-05`});return U},renderContent:(m,N,P,V,H)=>{const j=m.ffz_data;if(j.renderer)try{return j.renderer(j,V,H)}catch(ee){return this.log.capture(ee),this.log.error("Error using custom renderer for notice:",ee),"Error rendering notice."}const U=j.i18n?this.i18n.t(j.i18n,j.messgae,j):j.message;if(j.markdown)return(0,W.e)()?H("span",{dangerouslySetInnerHTML:{__html:(0,W.e)().renderInline(U)}}):((0,W.Z)().then(()=>V.forceUpdate()),"Loading...");if(j.tokenize){const ee=j.ffz_tokens=j.ffz_tokens||this.chat.tokenizeMessage({badges:{},message:U,id:m.id,user:m.user,roomLogin:m.roomLogin,roomID:m.roomID});return this.chat.renderTokens(ee,H)}return U}},this.line_types.hype={renderNotice:(m,N,P,V,H)=>{if(this.chat.context.get("chat.hype.message-style")===0)return null;const U=m.user,ee=m.ffz_tokens=m.ffz_tokens||this.chat.tokenizeMessage(m,N),he=ee.length>0;let Se=m.hype_amount;const Te=m.hype_exponent??0;Te>0&&(Se/=Math.pow(10,Te));try{Se=new Intl.NumberFormat(navigator.languages,{style:"currency",currency:m.hype_currency,compactDisplay:"short",minimumFractionDigits:Te,maximumFractionDigits:Te}).format(Se)}catch{Se=`${m.hype_currency} ${Se}`}return he?this.i18n.tList("chat.hype-chat","Sent a Hype Chat for {amount}!",{amount:Se}):this.i18n.tList("chat.hype-chat.user","{user} sent a Hype Chat for {amount}!",{amount:Se,user:H("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},H("span",{className:"tw-c-text-base tw-strong"},U.displayName))})}},this.line_types.cheer={renderNotice:(m,N,P,V,H)=>this.i18n.tList("chat.bits-message","Cheered {count, plural, one {# Bit} other {# Bits}}",{count:m.bits||0})},this.line_types.points={getClass:m=>`ffz--points-line tw-pd-l-1 tw-pd-r-2 ${m.ffz_reward_highlight&&this.chat.context.get("chat.points.allow-highlight")===2?"ffz-custom-color ffz--points-highlight":""}`,renderNotice:(m,N,P,V,H)=>{if(!m.ffz_reward)return null;const j=m.user,U=(0,u.KC)(m.ffz_reward),ee=m.ffz_tokens=m.ffz_tokens||this.chat.tokenizeMessage(m,N),he=ee.length>0,Se=H("span",{className:"ffz--points-reward"},(0,u.yg)(m.ffz_reward,this.i18n)),Te=H("span",{className:"ffz--points-cost"},[H("span",{className:U?"ffz-i-bits":"ffz--points-icon"}),this.i18n.formatNumber((0,u.at)(m.ffz_reward))]);return he?this.i18n.tList("chat.points.redeemed","Redeemed {reward} {cost}",{reward:Se,cost:Te}):this.i18n.tList("chat.points.user-redeemed","{user} redeemed {reward} {cost}",{reward:Se,cost:Te,user:H("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},H("span",{className:"tw-c-text-base tw-strong"},j.displayName))})}},this.line_types.resub={getClass:()=>"ffz--subscribe-line tw-pd-r-2",renderNotice:(m,N,P,V,H)=>{const j=m.sub_cumulative||m.sub_months,U=this.chat.context.get("chat.subs.show");let ee;if(U===1&&j>1&&(ee=(m.ffz_tokens=m.ffz_tokens||this.chat.tokenizeMessage(m,N)).length>0),!(U===3||U===1&&ee&&j>1||U===2&&j>1))return null;const he=m.user,Se=m.sub_plan||{},Te=v[Se.plan]||1,Be=m.sub_multi,Y=(Be?.count??0)>1&&Be.tenure===0,ge=this.i18n.tList(`chat.sub.main${Y?"-multi":""}`,`{user} subscribed {plan}${Y?" for {multi, plural, one {# month} other {# months}} in advance":""}. `,{user:H("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},H("span",{className:"tw-c-text-base tw-strong"},he.displayName)),plan:Se.prime?this.i18n.t("chat.sub.twitch-prime","with Prime Gaming"):this.i18n.t("chat.sub.plan","at Tier {tier}",{tier:Te}),multi:Y?Be.count:1});return m.sub_share_streak&&m.sub_streak>1?ge.push(this.i18n.t("chat.sub.cumulative-months","They've subscribed for {cumulative,number} months, currently on a {streak,number} month streak!",{cumulative:m.sub_cumulative,streak:m.sub_streak})):j>1&&ge.push(this.i18n.t("chat.sub.months","They've subscribed for {count,number} months!",{count:j})),this.chat.context.get("chat.subs.compact")||(ge.ffz_icon=H("span",{className:`ffz-i-${Se.prime?"crown":"star"} tw-mg-r-05`})),ge}},this.line_types.ritual={getClass:()=>"ffz--ritual-line tw-pd-r-2",renderNotice:(m,N,P,V,H)=>{const j=m.user;if(m.ritual==="new_chatter")return this.i18n.tList("chat.ritual","{user} is new here. Say hello!",{user:H("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},H("span",{className:"tw-c-text-base tw-strong"},j.displayName))})}},this.line_types.sub_gift={getClass:()=>"ffz--subscribe-line",renderNotice:(m,N,P,V,H)=>{const j=m.user,U=m.sub_plan||{},ee=m.sub_months||1,he=v[U.plan]||1;let Se;const Te={months:ee,user:m.sub_anon||j.username==="ananonymousgifter"?this.i18n.t("chat.sub.anonymous-gifter","An anonymous gifter"):H("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},H("span",{className:"tw-c-text-base tw-strong"},j.displayName)),plan:U.plan==="custom"?"":this.i18n.t("chat.sub.gift-plan","Tier {tier}",{tier:he}),recipient:H("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,"data-user":JSON.stringify(m.sub_recipient)},H("span",{className:"tw-c-text-base tw-strong"},m.sub_recipient.displayName))};return ee<=1?Se=this.i18n.tList("chat.sub.mystery","{user} gifted a {plan} Sub to {recipient}! ",Te):Se=this.i18n.tList("chat.sub.gift-months","{user} gifted {months, plural, one {# month} other {# months}} of {plan} Sub to {recipient}!",Te),m.sub_total===1?Se.push(this.i18n.t("chat.sub.gift-first","It's their first time gifting a Sub in the channel!")):m.sub_total>1&&Se.push(this.i18n.t("chat.sub.gift-total","They've gifted {count,number} Subs in the channel!",{count:m.sub_total})),this.chat.context.get("chat.subs.compact")||(Se.ffz_icon=H("span",{className:`ffz-i-${U.prime?"crown":"star"} tw-mg-r-05`})),Se}},this.line_types.sub_mystery={getClass:()=>"ffz--subscribe-line",renderNotice:(m,N,P,V,H)=>{const j=m.mystery;j&&(j.line=V);const U=this.i18n.tList("chat.sub.gift","{user} is gifting {count, plural, one {# Tier {tier} Sub} other {# Tier {tier} Subs}} to {channel}'s community! ",{user:m.sub_anon||m.user.username==="ananonymousgifter"?this.i18n.t("chat.sub.anonymous-gifter","An anonymous gifter"):H("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},H("span",{className:"tw-c-text-base tw-strong"},m.user.displayName)),count:m.sub_count,tier:v[m.sub_plan]||1,channel:m.roomLogin});m.sub_total===1?U.push(this.i18n.t("chat.sub.gift-first","It's their first time gifting a Sub in the channel!")):m.sub_total>1&&U.push(this.i18n.t("chat.sub.gift-total","They've gifted {count} Subs in the channel!",{count:m.sub_total})),V.ffz_click_expand||(V.ffz_click_expand=()=>{V.setState({ffz_expanded:!V.state.ffz_expanded})});const ee=this.chat.context.get("chat.subs.merge-gifts-visibility")?!V.state.ffz_expanded:V.state.ffz_expanded;let he=null;if(ee&&j&&j.recipients&&j.recipients.length>0){const Be=[];for(const Y of j.recipients)Be.length&&Be.push(", "),Be.push(H("span",{role:"button",className:"ffz--giftee-name",onClick:V.ffz_user_click_handler,"data-user":JSON.stringify(Y)},H("span",{className:"tw-c-text-base tw-strong"},Y.displayName)));he=H("div",{className:"tw-mg-t-05 tw-border-t tw-pd-t-05 tw-c-text-alt-2"},Be)}const Se=[U];j&&Se.push(H("span",{className:`tw-pd-l-05 tw-font-size-4 ffz-i-${ee?"down":"right"}-dir`}));const Te=[H("div",{className:"tw-full-width tw-c-text-alt-2",onClick:V.ffz_click_expand},Se),he];return this.chat.context.get("chat.subs.compact")||(Te.ffz_icon=H("span",{className:`ffz-i-star${m.sub_anon?"-empty":""} tw-mg-r-05`})),Te.ffz_target=Se,Te}},this.ChatLine=this.fine.define("chat-line",m=>m.renderMessageBody&&m.props&&!m.onExtensionNameClick&&!(0,M.has)(m.props,"hasModPermissions"),p.Z.CHAT_ROUTES),this.ExtensionLine=this.fine.define("extension-line",m=>m.renderMessageBody&&m.onExtensionNameClick,p.Z.CHAT_ROUTES),this.WhisperLine=this.fine.define("whisper-line",m=>m.props&&m.props.message&&(0,M.has)(m.props,"reportOutgoingWhisperRendered"))}async onEnable(){this.on("chat.overrides:changed",V=>this.updateLinesByUser(V,null,!1,!1),this),this.on("chat:update-lines-by-user",this.updateLinesByUser,this),this.on("chat:update-line",this.updateLineById,this),this.on("chat:update-lines",this.updateLines,this),this.on("chat:rerender-lines",this.rerenderLines,this),this.on("chat:update-line-tokens",this.updateLineTokens,this),this.on("chat:update-line-badges",this.updateLineBadges,this),this.on("i18n:update",this.rerenderLines,this),this.on("chat.emotes:update-effects",this.checkEffects,this),this.can_reprocess=!0,this.on("chat:reload-data",()=>this.can_reprocess=!0),this.on("chat:room-add",()=>this.can_reprocess=!0),this.on("load_tracker:complete:chat-data",()=>{!this.chat.context.get("chat.update-when-loaded")||!this.can_reprocess||(this.can_reprocess=!1,this.log.info("Reprocessing chat lines due to data loads."),this.updateLines())});for(const V of I.RERENDER_SETTINGS)this.chat.context.on(`changed:${V}`,this.rerenderLines,this);for(const V of I.UPDATE_TOKEN_SETTINGS)this.chat.context.on(`changed:${V}`,this.updateLineTokens,this);for(const V of I.UPDATE_BADGE_SETTINGS)this.chat.context.on(`changed:${V}`,this.updateLineBadges,this);this.chat.context.on("changed:tooltip.link-images",this.maybeUpdateLines,this),this.chat.context.on("changed:tooltip.link-nsfw-images",this.maybeUpdateLines,this),this.on("chat:get-messages",(V,H,j,U)=>{if(V){for(const ee of this.ChatLine.instances){const he=ee.props.message;he&&U.push({message:he,_instance:ee,update:()=>ee.forceUpdate()})}for(const ee of this.ExtensionLine.instances){const he=ee.props.message;he&&U.push({message:he,_instance:ee,update:()=>ee.forceUpdate()})}}if(H)for(const ee of this.WhisperLine.instances){const he=ee.props.message;he&&he._ffz_message&&U.push({message:he._ffz_message,_instance:ee,update:()=>ee.forceUpdate()})}}),this.on("chat:get-tab-commands",V=>{this.experiments.getTwitchAssignmentByName("chat_replies")!=="control"&&V.commands.push({name:"reply",description:"Reply to a user's last message.",permissionLevel:0,ffz_group:"FrankerFaceZ",commandArgs:[{name:"username",isRequired:!0},{name:"message",isRequired:!1}]})}),this.on("chat:pre-send-message",V=>{if(this.experiments.getTwitchAssignmentByName("chat_replies")==="control")return;const H=V.message,j=this.parent.chat_types||{};let U,ee;if(/^\/reply ?/i.test(H))U=H.slice(7).trim();else return;V.preventDefault();const he=U.indexOf(" ");if(he!==-1&&(ee=U.slice(he+1),U=U.slice(0,he)),U.startsWith("@")&&(U=U.slice(1)),U&&U.length){U=U.toLowerCase();const Se=Array.from(this.ChatLine.instances);let Te=Se.length;for(;Te--;){const Be=Se[Te],Y=Be?.props?.message,ge=Y?.user;if(ge&&(ge.login===U||ge.displayName?.toLowerCase?.()===U)){ee?V.sendMessage(ee,{reply:{parentDeleted:Y.deleted||!1,parentDisplayName:ge.displayName,parentMessageBody:Y.message,parentMsgId:Y.id,parentUid:ge.id,parentUserLogin:ge.login}}):requestAnimationFrame(()=>Be.ffzOpenReply());return}}}V.addMessage({type:j.Notice,message:this.i18n.t("chat.reply.bad-user","Invalid user or no known message to reply to.")})});const c=this,m=await this.site.findReact();if(!m)return;const N=m.createElement,P=this.rich_content&&this.rich_content.RichContent;this.WhisperLine.ready(V=>{const H=V.prototype.render;V.prototype.render=function(){if(this._ffz_no_scan=!0,!this.props.message||!this.props.message.content||!this.props.message.from)return H.call(this);try{const j=c.chat.standardizeWhisper(this.props.message),U=j.is_action,ee=U?c.chat.context.get("chat.me-style"):0,he=ee>=2,Se=ee===1||ee===3,Te=j.user,Be=c.overrides.getColor(Te.id)||Te.color,Y=c.parent.colors.process(Be),ge=j.ffz_tokens=j.ffz_tokens||c.chat.tokenizeMessage(j,null),re=c.chat.renderTokens(ge,N),Ce=c.overrides.getName(Te.id);return N("div",{className:"thread-message__message"},N("div",{className:"tw-pd-x-1 tw-pd-y-05"},[N("span",{className:`thread-message__message--user-name notranslate${Ce?" ffz--name-override":""}`,style:{color:Y}},Ce||Te.displayName),N("span",null,U?" ":": "),N("span",{className:`message${he?" chat-line__message-body--italicized":""}`,style:{color:Se&&Y}},re)]))}catch(j){return c.log.error(j),c.log.capture(j,{extra:{props:this.props}}),H.call(this)}},setTimeout(()=>this.WhisperLine.forceUpdate())}),this.ChatLine.ready(V=>{const H=V.prototype.render;V.prototype.shouldComponentUpdate=function(j,U){const ee=U&&U.alwaysShowMessage||!j.message.deleted,he=this._ffz_show;return this._ffz_show=ee,ee!==he||U&&this.state&&U.ffz_expanded!==this.state.ffz_expanded||j.deletedMessageDisplay!==this.props.deletedMessageDisplay||j.deletedCount!==this.props.deletedCount||j.message!==this.props.message||j.isCurrentUserModerator!==this.props.isCurrentUserModerator||j.showModerationIcons!==this.props.showModerationIcons||j.showTimestamps!==this.props.showTimestamps||j.pinnedMessage?.message?.id===j.message?.id!=(this.props.pinnedMessage?.message?.id===this.props.message?.id)},V.prototype.ffzOpenReply=function(){if(this.onMessageClick)return this.onMessageClick();if(this.props.reply){this.setOPCardTray(this.props.reply);return}if(this.props.hasReply){const ee=this.props.message;if(ee?.user){this.setOPCardTray({parentMsgId:ee.id,parentUid:ee.user.userID,parentUserLogin:ee.user.userLogin,parentDeleted:ee.deleted,parentDisplayName:ee.user.userDisplayName,parentMessageBody:ee.messageBody});return}}const j=this.renderMessageAuthor;this.renderMessageAuthor=()=>this.ffzReplyAuthor();const U=this.props.message?.ffz_tokens;U&&(this.setMessageTray(this.props.message,c.chat.renderTokens(U,N)),this.renderMessageAuthor=j)},V.prototype.ffzReplyAuthor=function(){const j=c.chat.standardizeMessage(this.props.message),U=j.user,ee=c.overrides.getColor(U.id)||U.color,he=c.parent.colors.process(ee);let Se=j.roomLogin?j.roomLogin:j.channel?j.channel.slice(1):void 0,Te=j.roomId?j.roomId:this.props.channelID;if(!Se&&Te){const ge=c.chat.getRoom(Te,null,!0);ge&&ge.login&&(Se=j.roomLogin=ge.login)}if(!Te&&Se){const ge=c.chat.getRoom(null,Te,!0);ge&&ge.id&&(Te=j.roomId=ge.id)}const Be=c.chat.formatUser(U,N),Y=c.overrides.getName(U.id);return N("span",{"data-room-id":Te,"data-room":Se,"data-user-id":U.userID,"data-user":U.userLogin&&U.userLogin.toLowerCase()},[N("span",{className:"chat-line__message--badges"},c.chat.badges.render(j,N)),N("span",{className:`chat-line__username notranslate${Y?" ffz--name-override tw-relative ffz-il-tooltip__container":""}`,role:"button",style:{color:he},onClick:this.ffz_user_click_handler,onContextMenu:c.actions.handleUserContext},Y?[N("span",{className:"chat-author__display-name"},Y),N("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},Be)]:Be)])},V.prototype.ffzRenderSharedChatPill=function(){let j=c.chat.context.get("chat.shared-chat.style");if(j==null&&(j=this.props.isCurrentUserModerator?2:0),j===0)return null;const U=this.props.message,ee=U.sourceRoomID,he=ee&&this.props.sharedChatDataByChannelID?.get(ee),Se=!he||ee===(U.roomId??this.props.channelID);if(!he)return null;const Te=c.i18n.t("chat.sent-from-source","Sent from {source}",{source:he.displayName??he.login});return j===1?N("span",{className:`ffz-pill ffz-tooltip tw-mg-r-05 ${Se?"ffz-pill--brand":""}`,"data-title":Te},`${he.displayName??he.login}`):j===2?N("figure",{className:`ffz-tooltip ffz-tooltip--no-mouse ffz-shared-chat-badge ffz-avatar tw-border-radius-rounded ${Se?"ffz-shared-chat-badge--active":""} tw-mg-r-05`,"data-title":c.i18n.t("chat.sent-from-source","Sent from {source}",{source:he.displayName})},N("img",{className:"tw-block tw-border-radius-rounded tw-image",src:he.profileImageURL,alt:he.displayName})):null},V.prototype.ffzNewRender=function(){try{this._ffz_no_scan=!0;const j=c.chat.standardizeMessage(this.props.message),U=c.chat.context.get("chat.filtering.display-deleted");let ee=this.props.deletedMessageDisplay;if(U?ee=U:!this.props.isCurrentUserModerator&&ee==="DETAILED"&&(ee="LEGACY"),ee==="BRIEF"&&j.deleted){const dt=this.props.deletedCount;return dt==null?null:N("div",{className:"chat-line__status"},c.i18n.t("chat.deleted-messages",`{count,plural,
one {One message was deleted by a moderator.}
other {# messages were deleted by a moderator.}
}`,{count:dt}))}const he=j.sourceRoomID,Se=he&&this.props.sharedChatDataByChannelID?.get(he);let Te=j.roomLogin?j.roomLogin:j.channel?j.channel.slice(1):void 0,Be=j.roomId?j.roomId:this.props.channelID;if(!Te&&Be){const dt=c.chat.getRoom(Be,null,!0);dt&&dt.login&&(Te=j.roomLogin=dt.login)}if(!Be&&Te){const dt=c.chat.getRoom(null,Te,!0);dt&&dt.id&&(Be=j.roomId=dt.id)}const Y=c.site.getUser(),ge={id:Be,login:Te},re=!Se||he===Be,Ce=re?ge:{id:he,login:Se.login},Ne=c.chat.context.get("chat.replies.style"),We=this.props&&!!(this.props.hasReply||this.props.reply||!this.props.replyRestrictedReason),Xe=We&&j.message&&!j.deleted&&!this.props.disableReplyClick,de=Xe&&(We||Y&&Y.login!==j.user?.login);Y&&(Y.moderator=this.props.isCurrentUserModerator,Y.staff=this.props.isCurrentUserStaff,Y.reply_mode=Ne,Y.can_reply=de),this.ffz_open_reply||(this.ffz_open_reply=this.ffzOpenReply.bind(this)),this.ffz_user_click_handler||(this.props.onUsernameClick?this.ffz_user_click_handler=dt=>{if(this.isKeyboardEvent(dt)&&dt.keyCode!==I.KEYS.Space&&dt.keyCode!==I.KEYS.Enter)return;const mt=dt.currentTarget,Tt=mt&&mt.dataset;let Rt=j.user;if(Tt&&Tt.user)try{Rt=JSON.parse(Tt.user)}catch{}const ei=c.makeEvent({inst:this,event:dt,message:j,user:Rt,room:ge,source:Ce});c.emit("chat:user-click",ei),!ei.defaultPrevented&&this.props.onUsernameClick(Rt.login,"chat_message",j.id,mt.getBoundingClientRect().bottom)}:this.ffz_user_click_handler=this.openViewerCard||this.usernameClickHandler);let ke,Oe,Ve=null,nt=j.ffz_type&&c.line_types[j.ffz_type];if(!nt&&j.bits>0&&c.chat.context.get("chat.bits.cheer-notice")&&(nt=c.line_types.cheer),!nt&&j.ffz_type&&(nt=c.line_types.unknown),nt){if(nt.render)return nt.render(j,Y,ge,this,N);nt.renderNotice&&(ke=nt.renderNotice(j,Y,ge,this,N)),nt.getClass&&(Oe=nt.getClass(j,Y,ge,this,N))}const ot=j.user,At=c.chat.context.get("chat.emotes.animated")===2;ot&&!ot.lowerLogin&&ot.userLogin&&(ot.lowerLogin=ot.userLogin.toLowerCase()),Oe=Oe||"";let kt,It,Bt=null;if(ee==="BRIEF"?(kt=!0,It=!1):ee==="DETAILED"?(kt=!0,It=j.deleted):(kt=this.state?.alwaysShowMessage||!j.deleted,It=!1),j.deleted){const dt=c.chat.context.get("chat.filtering.display-mod-action");if(dt===2||dt===1&&ee==="DETAILED"){const mt=j.modActionType;mt==="timeout"?Bt=c.i18n.t("chat.mod-action.timeout","{duration} Timeout",{duration:(0,b.print_duration)(j.duration||1)}):mt==="ban"?Bt=c.i18n.t("chat.mod-action.ban","Banned"):(mt==="delete"||!mt)&&(Bt=c.i18n.t("chat.mod-action.delete","Deleted")),Bt&&j.modLogin&&(Bt=c.i18n.t("chat.mod-action.by","{action} by {login}",{login:j.modLogin,action:Bt})),Bt&&(Bt=N("span",{className:"tw-pd-l-05","data-test-selector":"chat-deleted-message-attribution"},`(${Bt})`))}}let Et=null;const Lt=c.chat.context.get("chat.filtering.show-reasons");if(j.highlights?.size&&Lt){Et=[];for(const dt of j.highlights){const mt=c.chat._hl_reasons[dt];let Tt,Rt;mt&&(Rt=mt.i18n_key?c.i18n.t(mt.i18n_key,mt.title):mt.title,Tt=mt.i18n_label?c.i18n.t(mt.i18n_label,mt.label):mt.label,Tt===Rt&&(Rt=null)),Tt||(Tt=dt),Et.push(N("span",{className:`ffz-pill ffz-highlight-tag${mt?" ffz-tooltip":""}`,"data-title":Rt},Tt))}Et.length>0?Et=N("span",{className:`ffz-highlight-tags ${Lt===1?"ffz-highlight-tags__above":"tw-mg-r-05"}`},Et):Et=null}const Dt=j.ffz_tokens=j.ffz_tokens||c.chat.tokenizeMessage(j,Y),Qt=Dt.length>0||!ke;let Nt;if(Qt){const dt=Ne===2||Ne===1&&this.props.repliesAppearancePreference&&this.props.repliesAppearancePreference!=="expanded"?j.ffz_reply=j.ffz_reply||c.chat.tokenizeReply(this.props.reply):null,mt=c.parent.message_types&&c.parent.message_types.Action===j.messageType,Tt=this.props.isLastEmoteGigantified||(0,u._x)(j.ffz_reward),Rt=mt?c.chat.context.get("chat.me-style"):0,ei=Rt>=2,Jt=Rt===1||Rt===3,hi=c.overrides.getColor(ot.id)||ot.color,lt=c.parent.colors.process(hi),tt=kt&&P&&c.chat.pluckRichContent(Dt,j),$t=Tt&&c.chat.pluckLastEmote(Dt,j),Ot=c.chat.formatUser(ot,N),St=c.overrides.getName(ot.id);let Ft=j.ffz_user_class;Ft instanceof Set?Ft=[...Ft].join(" "):Array.isArray(Ft)&&(Ft=Ft.join(" "));const pt=Se&&c.chat.context.get("chat.shared-chat.username-tooltip"),et={className:`chat-line__username notranslate${St?" ffz--name-override":""}${St||pt?" tw-relative ffz-il-tooltip__container":""} ${Ft??""}`,role:"button",style:{color:lt},onClick:this.ffz_user_click_handler,onContextMenu:c.actions.handleUserContext};j.ffz_user_props&&Object.assign(et,j.ffz_user_props),j.ffz_user_style&&Object.assign(et.style,j.ffz_user_style);const at=N("span",et,St?[N("span",{className:"chat-author__display-name"},St),N("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},[Ot,pt?N("div",{className:"tw-font-size-8 tw-mg-t-05"},c.i18n.t("chat.sent-from-source","Sent from {source}",{source:Se.displayName??Se.login})):null])]:pt?[Ot,N("span",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},c.i18n.t("chat.sent-from-source","Sent from {source}",{source:Se.displayName??Se.login}))]:Ot),gt=this.props.showTimestamps||this.props.isHistorical?N("span",{className:"chat-line__timestamp"},c.chat.formatTime(j.timestamp)):null,ft=kt&&We&&dt?c.chat.renderTokens(dt,N):null,rt=j.ffz_reward_highlight&&c.chat.context.get("chat.points.allow-highlight")===1;Nt=[Ne===1&&this.props.reply&&this.props.repliesAppearancePreference&&this.props.repliesAppearancePreference==="expanded"?this.renderReplyLine():null,Se?this.ffzRenderSharedChatPill():null,gt,j.ffz_no_actions?null:c.actions.renderInline(j,this.props.showModerationIcons,Y,ge,N,this),this.renderInlineHighlight?this.renderInlineHighlight():null,Lt===2?Et:null,N("span",{className:"chat-line__message--badges"},c.chat.badges.render(j,N)),at,N("span",{"aria-hidden":!0},mt?" ":": "),ft,kt?N("span",{className:`message ${ei?"chat-line__message-body--italicized":""} ${rt?"chat-line__message-body--highlighted":""}`,style:Jt?{color:lt}:null},c.chat.renderTokens(Dt,N,Ne!==0&&We?this.props.reply:null)):N("span",{className:"chat-line__message--deleted"},N("a",{href:"",onClick:this.alwaysShowMessage},c.i18n.t("chat.message-deleted","<message deleted>"))),Bt,tt?N(P,tt):null,$t?N("div",{className:"chat-line__message--ffz-giant-emote"},c.chat.renderGiantEmote($t,N)):null]}let jt;if(ke){const dt=Array.isArray(ke.ffz_target);if(Nt)dt?ke.ffz_icon&&ke.ffz_target.unshift(ke.ffz_icon):ke.ffz_icon&&(ke=[ke.ffz_icon,ke]),Nt=N("div",{className:"chat-line--inline chat-line__message","data-room-id":Ce?.id??j.roomId??ge.id,"data-room":Ce?.login??j.roomLogin,"data-user-id":ot?.userID,"data-user":ot?.lowerLogin},Nt);else{const mt=c.chat.context.get("chat.extra-timestamps"),Tt=mt&&(this.props.showTimestamps||this.props.isHistorical)?N("span",{className:"chat-line__timestamp"},c.chat.formatTime(j.timestamp)):null,Rt=j.ffz_no_actions?null:c.actions.renderInline(j,this.props.showModerationIcons,Y,ge,N,this);dt?ke.ffz_target.unshift(Se?this.ffzRenderSharedChatPill():null,ke.ffz_icon??null,Tt,Rt,Lt===2?Et:null):ke=[Se?this.ffzRenderSharedChatPill():null,ke.ffz_icon??null,Tt,Rt,Lt===2?Et:null,ke]}Oe=`${Oe} ffz-notice-line user-notice-line tw-pd-y-05`,dt||(ke=N("div",{className:"tw-c-text-alt-2"},ke)),Et&&Lt===1?jt=[Et,ke,Nt??null]:Nt?jt=[ke,Nt]:jt=ke}else Oe=`${Oe} chat-line__message`,Et&&Lt===1?jt=[Et,Nt]:jt=Nt;const ut=ot&&j.id&&!j.ffz_no_actions?c.actions.renderHover(j,this.props.showModerationIcons,Y,ge,N,this):null;return ut&&(Oe=`${Oe} tw-relative`,jt=[N("div",{className:"chat-line__message-highlight tw-absolute tw-border-radius-medium tw-top-0 tw-bottom-0 tw-right-0 tw-left-0","data-test-selector":"chat-message-highlight"}),N("div",{className:"chat-line__message-container tw-relative"},jt),ut]),Ve==null&&(Ve=j.mentioned&&j.mention_color?c.parent.inverse_colors.process(j.mention_color):null),N("div",{className:`${Oe}${It?" ffz--deleted-message":""}${j.mentioned?" ffz-mentioned":""}${Ve?" ffz-custom-color":""}`,style:{backgroundColor:Ve},"data-room-id":Ce?.id??j.roomId??ge.id,"data-room":Ce?.login??j.roomLogin,"data-user-id":ot?.userID,"data-user":ot?.lowerLogin,onMouseOver:At?c.chat.emotes.animHover:null,onMouseOut:At?c.chat.emotes.animLeave:null},jt)}catch(j){c.log.error(j),c.log.capture(j,{extra:{props:this.props}});try{return console.log("trying old 1"),H.call(this)}catch(U){return c.log.error("An error in Twitch shit.",U),c.log.capture(U,{extra:{props:this.props}}),"An error occurred rendering this chat line."}}},V.prototype.render=V.prototype.ffzNewRender,setTimeout(()=>this.ChatLine.forceUpdate())}),this.ExtensionLine.ready(V=>{const H=V.prototype.render;V.prototype.render=function(){try{if(this._ffz_no_scan=!0,!this.props.installedExtensions)return null;const j=c.chat.standardizeMessage(this.props.message),U=j&&j.extension;if(!U||!this.props.installedExtensions.some(re=>{const Ce=re.extension;return Ce&&(Ce.clientId||Ce.clientID)===(U.clientId||U.clientID)&&Ce.version===U.version}))return null;const ee=c.parent.colors.process(U.chatColor);let he=j.roomLogin?j.roomLogin:j.channel?j.channel.slice(1):void 0;if(!he&&this.props.channelID){const re=c.chat.getRoom(this.props.channelID,null,!0);re&&re.login&&(he=j.roomLogin=re.login)}const Se=c.site.getUser(),Te={id:this.props.channelID,login:he},Be=j.ffz_tokens=j.ffz_tokens||c.chat.tokenizeMessage(j,Se),Y=P&&c.chat.pluckRichContent(Be,j),ge=j.mentioned&&j.mention_color?c.parent.inverse_colors.process(j.mention_color):null;return Be.length?N("div",{className:`chat-line__message${j.mentioned?" ffz-mentioned":""}${ge?" ffz-custom-color":""}`,style:{backgroundColor:ge},"data-room-id":Te.id,"data-room":Te.login,"data-extension":U.clientID},[this.props.showTimestamps&&N("span",{className:"chat-line__timestamp"},c.chat.formatTime(j.timestamp)),N("span",{className:"chat-line__message--badges"},c.chat.badges.render(j,N)),N("span",{className:"chat-line__username notranslate",role:"button",style:{color:ee},onClick:this.onExtensionNameClick},N("span",{className:"chat-author__display-name"},U.displayName)),N("span",null,": "),N("span",{className:"message"},c.chat.renderTokens(Be,N)),Y&&N(P,Y)]):null}catch(j){return c.log.info(j),c.log.capture(j,{extra:{props:this.props}}),H.call(this)}},setTimeout(()=>this.ExtensionLine.forceUpdate())})}checkEffects(){for(const c of this.ChatLine.instances){const m=c.props.message,N=m?.ffz_tokens;if(N)for(const P of N)P.type==="emote"&&P.modifier_flags&&this.emotes.ensureEffect(P.modifier_flags)}for(const c of this.WhisperLine.instances){const m=c.props.message?._ffz_message,N=m?.ffz_tokens;if(N)for(const P of N)P.type==="emote"&&P.modifier_flags&&this.emotes.ensureEffect(P.modifier_flags)}}updateLineById(c,m=!0,N=null){N==null&&(N=m);for(const P of this.ChatLine.instances){const V=P.props.message;if(V?.id===c){N&&(V.ffz_badges=V.ffz_badge_cache=null),m&&(V.ffz_tokens=null,V.ffz_reply=null,V.highlights=V.mentioned=V.mention_color=V.color_priority=null),P.forceUpdate();return}}for(const P of this.WhisperLine.instances){const V=P.props.message?._ffz_message;if(V?.id===c){(N||m)&&(V._ffz_message=null),P.forceUpdate();return}}}updateLinesByUser(c,m,N=!0,P=!0){for(const V of this.ChatLine.instances){const H=V.props.message,j=H?.user;j&&(c&&c==j.id||m&&m==j.login)&&(P&&(H.ffz_badges=H.ffz_badge_cache=null),N&&(H.ffz_tokens=null,H.ffz_reply=null,H.highlights=H.mentioned=H.mention_color=H.color_priority=null),V.forceUpdate())}for(const V of this.WhisperLine.instances){const H=V.props.message?._ffz_message,j=H?.user;j&&(c&&c==j.id||m&&m==j.login)&&(H._ffz_message=null,V.forceUpdate())}}maybeUpdateLines(){this.chat.context.get("chat.rich.all-links")&&this.updateLines()}updateLines(){return this._updateLines()}rerenderLines(){return this._updateLines(!1,!1)}updateLineTokens(){return this._updateLines(!0,!1)}updateLineBadges(){return this._updateLines(!1,!0)}_updateLines(c=!0,m=!0){for(const N of this.ChatLine.instances){const P=N.props.message;P&&(m&&(P.ffz_badge_cache=P.ffz_badges=null),c&&(P.ffz_tokens=null,P.ffz_reply=null,P.highlights=P.mentioned=P.mention_color=P.mention_priority=P.clear_priority=null))}for(const N of this.ExtensionLine.instances){const P=N.props.message;P&&(m&&(P.ffz_badge_cache=P.ffz_badges=null),c&&(P.ffz_tokens=null,P.ffz_reply=null,P.highlights=P.mentioned=P.mention_color=P.mention_priority=P.clear_priority=null))}for(const N of this.WhisperLine.instances){const P=N.props.message;P&&P._ffz_message&&(P._ffz_message=null)}this.ChatLine.forceUpdate(),this.ExtensionLine.forceUpdate(),this.WhisperLine.forceUpdate(),this.emit("chat:updated-lines")}};B(He,"ChatLine");let A=He;var C=S(44589),y=S(17159);const Ze=class Ze extends x.default{constructor(...c){super(...c),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("chat.badges"),this.inject("site.fine"),this.inject("site"),this.inject("site.css_tweaks"),this.settings.add("chat.input.hide-identity",{default:!1,ui:{path:"Chat > Input >> Appearance",title:'Display "Chat Identity" in the chat settings menu rather than the input box.',component:"setting-check-box"}}),this.SettingsMenu=this.fine.define("chat-settings",m=>m.renderUniversalOptions&&m.onBadgesChanged,p.Z.CHAT_ROUTES)}async onEnable(){this.on("i18n:update",()=>this.SettingsMenu.forceUpdate()),this.chat.context.on("changed:chat.scroller.freeze",()=>this.SettingsMenu.forceUpdate()),this.chat.context.on("changed:chat.input.hide-identity",P=>{this.css_tweaks.toggle("hide-chat-identity",P),this.SettingsMenu.forceUpdate()}),this.css_tweaks.toggle("hide-chat-identity",this.chat.context.get("chat.input.hide-identity"));const c=this,m=await this.site.findReact();if(!m)return;const N=m.createElement;this.SettingsMenu.ready(P=>{const V=P.prototype.render,H=P.prototype.renderUniversalOptions;P.prototype.renderUniversalOptions=function(){const j=H.call(this);return this.ffzSettingsClick||(this.ffzSettingsClick=U=>c.click(this,U)),this.ffzPauseClick||(this.ffzPauseClick=()=>this.setState({ffzPauseMenu:!this.state.ffzPauseMenu})),j.props.children.push(N("div",{class:"tw-full-width tw-relative"},N("button",{class:"tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this.ffzSettingsClick},N("div",{class:"tw-align-items-center tw-flex tw-pd-05 tw-relative"},N("div",{class:"tw-flex-grow-1"},c.i18n.t("site.menu_button","FrankerFaceZ Control Center")))),c.cant_window&&N("div",{class:"tw-mg-t-05 tw-c-text-alt-2"},N("span",{class:"ffz-i-attention"},c.i18n.t("popup.error","We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch."))))),j},P.prototype.ffzRenderIdentity=function(){if(!this.state||!this.props||this.state.moderatorMode||this.state.chatAppearance||this.state.chatPause||this.state.followerMode||this.state.recentRaids||this.state.repliesAppearance||this.state.slowMode||this.props.isShowingChatFilterSettings||this.props.isShowingDeletedMessageDisplaySettings||!this.props.isLoggedIn||!c.chat.context.get("chat.input.hide-identity"))return null;const j=this.props.data?.currentUser,U=this.props.data?.user?.self?.displayBadges;if(!j||!j.login||!Array.isArray(U))return null;const ee=j.login&&j.displayName&&j.displayName.trim().toLowerCase()!==j.login,he=c.parent.colors.process(j.chatColor),Se={};for(const Be of U)Be?.setID&&Be.version&&(Se[Be.setID]=Be.version);this._ffzIdentityClick||(this._ffzIdentityClick=()=>{document.querySelector('button[data-a-target="chat-badge-carousel-badge-icon"]').click(),this.props.onCloseSettings()});const Te={user:j,badges:Se,ffz_badges:c.badges.getBadges(j.id,j.login,this.props.channelID,this.props.channelLogin),roomID:this.props.channelID,roomLogin:this.props.channelLogin};return this._ffzIdentityMsg=Te,N("div",{class:"ffz-identity"},N("div",{class:"tw-mg-y-05 tw-pd-x-05"},N("p",{class:"tw-c-text-alt-2 tw-font-size-6 tw-strong tw-upcase"},c.i18n.t("chat.identity-menu","Chat Identity"))),N("div",{class:"tw-full-width tw-relative"},N("button",{class:"tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this._ffzIdentityClick},N("div",{class:"tw-align-items-center tw-flex tw-pd-05 tw-relative"},N("div",{class:"tw-flex-grow-1"},N("span",{class:"ffz--editor-name"},N("span",{class:"ffz--editor-badges","data-room-id":this.props.channelID,"data-room":this.props.channelLogin},c.badges.render(Te,N,!0,!0)),N("span",{class:"tw-strong notranslate",style:{color:he}},N("span",{class:"name-display__name"},j.displayName||j.login),ee&&N("span",{class:"intl-name"}," (",j.login,") ")))),N("div",{class:"tw-align-items-center tw-flex tw-flex-shrink-0 tw-mg-l-05"},N("figure",{class:"ffz-i-right-open"}))))))},P.prototype.render=function(){const j=V.call(this);try{const U=j?.props?.children?.props?.children?.props?.children?.[1]?.props?.children?.props?.children;if(Array.isArray(U)){const ee=this.ffzRenderIdentity();ee&&U.unshift(ee)}}catch(U){c.log.error("Error rendering chat settings menu.",U)}return j},this.SettingsMenu.forceUpdate()}),this.SettingsMenu.on("update",this.updateSettingsMenu,this),this.SettingsMenu.on("unmount",P=>{P.ffzSettingsClick=null})}updateSettingsMenu(c){const m=this.fine.getChildNode(c);if(!m||!document.contains(m))return;let N;if(c.props?.editAppearance){this.registerBadgePicker();const ee=m.querySelector('span[data-a-target="edit-display-name"]');N=ee&&ee.closest(".tw-mg-t-1")}else N=m.querySelector('.name-display > div:not([data-test-selector="edit-appearance-button"])');if(!N||!m.contains(N))return;const P=c.props?.data?.currentUser,V=c.props?.data?.user?.self?.displayBadges;if(!P||!P.login||!Array.isArray(V))return;const H=P.login&&P.displayName&&P.displayName.trim().toLowerCase()!==P.login,j=this.parent.colors.process(P.chatColor),U={};for(const ee of N.children)ee?.classList&&(ee.classList.contains("ffz--editor-name")?ee.remove():ee.classList.add("tw-hide"));for(const ee of V)ee?.setID&&ee.version&&(U[ee.setID]=ee.version);N.appendChild((0,C.createElement)("span",{className:"ffz--editor-name"},[(0,C.createElement)("span",{className:"ffz--editor-badges","data-room-id":c.props.channelID,"data-room-login":c.props.channelLogin},this.badges.render({user:P,badges:U,ffz_badges:this.badges.getBadges(P.id,P.login,c.props.channelID,c.props.channelLogin),roomID:c.props.channelID,roomLogin:c.props.channelLogin},C.createElement,!0,!0)),(0,C.createElement)("span",{class:"tw-strong notranslate",style:{color:j}},(0,C.createElement)("span",{class:"name-display__name"},P.displayName||P.login),H&&(0,C.createElement)("span",{class:"intl-name"}," (",P.login,")"))]))}registerBadgePicker(){this.BadgePicker||(this.BadgePicker=this.fine.define("badge-picker",c=>c.onGlobalBadgeClicked&&c.onGlobalBadgeKeyPress,p.Z.CHAT_ROUTES),this.BadgePicker.on("mount",this.updateBadgePicker,this),this.BadgePicker.on("update",this.updateBadgePicker,this),this.BadgePicker.ready((c,m)=>{for(const N of m)this.updateBadgePicker(N)}))}updateBadgePicker(c){const m=this.fine.getChildNode(c);if(!m){c.props?.data?.loading===!1&&!c._ffz_try_again&&(c._ffz_try_again=requestAnimationFrame(()=>this.updateBadgePicker(c)));return}const N=m.querySelector(".tw-flex-column");if(!N)return;const P=this.badges.getBadges(c.props.userID,c.props.userLogin);let V;for(const ee of P){const he=this.badges.badges[ee?.id];he&&!he.addon&&(V=he)}const H=N.querySelector(".ffz--badge-selector");if(H){V||H.remove();return}else if(!V)return;const j=(0,C.createElement)("div",{class:"ffz--badge-selector tw-border-b tw-mg-b-1"},(0,C.createElement)("div",{class:"tw-mg-y-05 tw-pd-x-05"},(0,C.createElement)("p",{class:"tw-c-text-alt-2 tw-font-size-6 tw-strong tw-upcase"},this.i18n.t("chat.ffz-badge.title","FrankerFaceZ Badge"))),(0,C.createElement)("div",null,(0,C.createElement)("p",{class:"tw-mg-b-05 tw-pd-x-05"},this.i18n.tList("chat.ffz-badge.about","This badge appears globally for users with FrankerFaceZ. Please visit the {website} to change this badge.",{website:(0,C.createElement)("a",{href:"https://www.frankerfacez.com/subscribe",class:"ffz-link",rel:"noopener noreferrer",target:"_blank"},this.i18n.t("chat.ffz-badge.site-link","FrankerFaceZ website"))}))),(0,C.createElement)("div",{role:"radiogroup",class:"tw-align-items-center tw-flex tw-flex-wrap tw-mg-b-05 tw-mg-t-05 tw-pd-x-05"},(0,C.createElement)("div",{class:"tw-mg-r-1 tw-mg-y-05"},(0,C.createElement)("div",{class:"tw-inline-flex"},(0,C.createElement)("div",{class:"edit-appearance__badge-chooser edit-appearance__badge-chooser--selected tw-border-radius-small"},(0,C.createElement)("img",{alt:V.title,src:V.urls[2],srcset:`${V.urls[2]} 1x, ${V.urls[4]} 2x`,style:{backgroundColor:V.color||"transparent"},role:"radio","aria-checked":"true",class:"tw-full-height tw-full-width"})))))),U=N.querySelector('[data-test-selector="global-badges-test-selector"]')?.nextElementSibling;U?N.insertBefore(j,U):N.appendChild(j)}closeMenu(c){const m=this.fine.searchParent(c,P=>P.setChatInputRef&&P.setAutocompleteInputRef,100),N=m&&this.fine.searchTree(m,P=>P.props&&P.props.isSettingsOpen&&P.onClickSettings);N&&N.onClickSettings()}click(c,m){const N=m.currentTarget,P=N&&N.dataset&&N.dataset.page,V=new y.FFZEvent({item:P,event:m,errored:!1});if(this.emit("main_menu:open",V),V.errored){this.cant_window=!0,this.SettingsMenu.forceUpdate();return}this.closeMenu(c)}};B(Ze,"SettingsMenu");let a=Ze;var w=S(49276),F=S(90424),D=S.n(F);const z={1e3:"Tier 1",2e3:"Tier 2",3e3:"Tier 3"},$=["the_horns","raised_back_of_hand","ok_hand","+1","clap","fist","pinched_fingers","wave","pinch","victory","love_you_gesture"];function J(st,c){c||(c=st.closest(".simplebar-scroll-content")??st.parentElement);const m=c.offsetHeight,N=st.offsetHeight,P=st.offsetTop;if(N>=m){c.scrollTop=P;return}const V=P+N/2-m/2;c.scrollTop=V}B(J,"scrollIntoView");function Z(st){if(!st)return st;try{return new Date(st)}catch{return null}}B(Z,"maybe_date");const G=window?.Intl?.Collator&&new Intl.Collator(void 0,{numeric:!0}),Q=[B(function(c,m){return G?G.compare(c.id,m.id):c.id<m.id?-1:c.id>m.id?1:0},"id_asc"),B(function(c,m){return G?G.compare(m.id,c.id):c.id>m.id?-1:c.id<m.id?1:0},"id_desc"),B(function(c,m){const N=c.name.toLowerCase(),P=m.name.toLowerCase();return N<P?-1:N>P?1:G?G.compare(c.id,m.id):c.id<m.id?-1:c.id>m.id?1:0},"name_asc"),B(function(c,m){const N=c.name.toLowerCase(),P=m.name.toLowerCase();return N>P?-1:N<P?1:G?G.compare(m.id,c.id):c.id>m.id?-1:c.id<m.id?1:0},"name_desc"),B(function(c,m){if(c.order!=null||m.order!=null){if(c.order&&m.order==null)return-1;if(m.order&&c.order==null)return 1;if(c.order<m.order)return-1;if(c.order>m.order)return 1}return G?G.compare(c.id,m.id):c.id<m.id?-1:c.id>m.id?1:0},"native_asc"),B(function(c,m){if(c.order!=null||m.order!=null){if(c.order&&m.order==null)return 1;if(m.order&&c.order==null)return-1;if(c.order<m.order)return 1;if(c.order>m.order)return-1}return G?G.compare(c.id,m.id):c.id<m.id?1:c.id>m.id?-1:0},"native_desc")];function se(st,c){const m=st.sort_key,N=c.sort_key;if(m<N)return-1;if(N<m)return 1;const P=st.title.toLowerCase(),V=c.title.toLowerCase();return P<V?-1:V<P?1:0}B(se,"sort_sets");const qe=class qe extends x.default{constructor(...c){super(...c),this.inject("staging"),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("chat.badges"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("site"),this.inject("site.fine"),this.inject("site.apollo"),this.inject("site.css_tweaks"),this.SUB_STATUS=D(),this.settings.add("chat.emote-menu.shortcut",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Use Ctrl+E to open the Emote Menu.",description:"When enabled and you press Ctrl+E with the chat input focused, the emote menu will open.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.modifiers",{default:0,ui:{path:"Chat > Emote Menu >> General",title:"Emote Modifiers",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"In-Line"}]}}),this.settings.add("chat.emote-menu.clear-search",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Reset search when closing the Emote Menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.enabled",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Use the FrankerFaceZ Emote Menu.",description:"The FFZ emote menu replaces the built-in Twitch emote menu and provides enhanced functionality.",component:"setting-check-box"},changed:()=>this.EmoteMenu.forceUpdate()}),this.settings.add("chat.emote-menu.icon",{requires:["chat.emote-menu.enabled","context.bttv.emote_menu"],default:!1,process(m,N){return m.get("chat.emote-menu.enabled")?m.get("context.bttv.emote_menu")||N:!1},ui:{path:"Chat > Emote Menu >> Appearance",title:"Replace the emote menu icon with the FFZ icon for that classic feel.",description:"**Note:** This setting may be forcibly enabled if other emote menus are detected, to ensure you can visually identify the FFZ Emote Menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.show-quick-nav",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show a quick navigation bar along the side of the menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.tall",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Use extra height for the emote menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.show-heading",{default:1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show Headers",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Not Searching"}]}}),this.settings.add("chat.emote-menu.show-search",{default:!0,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show the search box.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.reduced-padding",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Use reduced padding.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.default-tab",{default:"channel",ui:{path:"Chat > Emote Menu >> General",title:"Default Tab",component:"setting-select-box",data:[{value:"fav",title:"Favorites"},{value:"channel",title:"Channel"},{value:"effect",title:"Emote Effects"},{value:"all",title:"My Emotes"},{value:"emoji",title:"Emoji"}]}}),this.settings.add("chat.emote-menu.effect-tab",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Display Emote Effects in their own tab.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.tooltips",{default:!0,ui:{path:"Chat > Emote Menu >> Appearance",title:"Display emote preview tool-tips in the FFZ Emote Menu.",component:"setting-check-box",description:"You may wish to disable this for performance reasons."}}),this.settings.add("chat.emote-menu.show-emoji",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Display emoji in the emote menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.combine-tabs",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Display all emotes on one tab.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.stay-loaded",{requires:["chat.emote-menu.combine-tabs"],default:null,process(m,N){return N==null&&(N=m.get("chat.emote-menu.combine-tabs")),N},ui:{path:"Chat > Emote Menu >> General",title:"Stay loaded after opening.",component:"setting-check-box",description:"This causes the emote menu to stay in the DOM even when it's not visible. Enabling this may help the site perform better when opening the menu if it's slow. By default, this setting is enabled when using `Display all emotes on one tab.`"}}),this.settings.add("chat.emote-menu.sort-emotes",{default:4,ui:{path:"Chat > Emote Menu >> Sorting",title:"Sort Emotes By",component:"setting-select-box",data:[{value:4,title:"Native Order, Ascending"},{value:5,title:"Native Order, Descending"},{value:0,title:"Order Added (ID), Ascending"},{value:1,title:"Order Added (ID), Descending"},{value:2,title:"Name, Ascending"},{value:3,title:"Name, Descending"}]}}),this.settings.add("chat.emote-menu.sort-tiers-last",{default:!0,ui:{path:"Chat > Emote Menu >> Sorting",title:"List emotes from higher sub tiers last.",component:"setting-check-box"}}),this.EmoteMenu=this.fine.define("chat-emote-menu",m=>m.getAllEmoteSets&&m.getSortedChannelEmotes&&m.props?.emotePickerSource,p.Z.CHAT_ROUTES),this.MenuWrapper=this.fine.wrap("ffz-emote-menu")}async onEnable(){this.on("i18n:update",()=>this.EmoteMenu.forceUpdate()),this.on("chat.emotes:update-default-sets",this.maybeUpdate,this),this.on("chat.emotes:update-user-sets",this.maybeUpdate,this),this.on("chat.emotes:update-room-sets",this.maybeUpdate,this),this.on("chat.emotes:loaded",this.maybeUpdate,this),this.on("chat.emotes:change-favorite",this.maybeUpdate,this),this.on("chat.emotes:change-hidden",this.maybeUpdate,this),this.on("chat.emoji:populated",this.maybeUpdate,this),this.chat.context.on("changed:chat.emote-menu.enabled",()=>this.EmoteMenu.forceUpdate());const c=B(()=>{for(const V of this.MenuWrapper.instances)V.rebuildData()},"rebuild");this.chat.context.on("changed:chat.emotes.enabled",c),this.chat.context.on("changed:chat.emote-menu.modifiers",c),this.chat.context.on("changed:chat.emote-menu.show-emoji",c),this.chat.context.on("changed:chat.emote-menu.tooltips",c),this.chat.context.on("changed:chat.fix-bad-emotes",c),this.chat.context.on("changed:chat.emote-menu.effect-tab",c),this.chat.context.on("changed:chat.emote-menu.sort-emotes",c),this.chat.context.on("changed:chat.emote-menu.sort-tiers-last",c),this.chat.context.on("changed:chat.emoji.style",this.updateEmojiVariables,this),this.chat.context.getChanges("chat.emote-menu.icon",V=>this.css_tweaks.toggle("emote-menu",V)),this.updateEmojiVariables(),this.css_tweaks.setVariable("emoji-menu--sheet","//cdn.frankerfacez.com/static/emoji/images/sheet-twemoji-36.png"),this.css_tweaks.setVariable("emoji-menu--count",58),this.css_tweaks.setVariable("emoji-menu--size",36);const m=this,N=await this.site.findReact(),P=N&&N.createElement;if(!P)return m.log.warn("Unable to get React.");this.defineClasses(),this.EmoteMenu.ready(V=>{const H=V.prototype.render;V.prototype.render=function(){return this._ffz_no_scan=!1,!this.props||this.props.emotePickerSource==="bits-rewards"||!(0,M.has)(this.props,"channelID")||!m.chat.context.get("chat.emote-menu.enabled")?H.call(this):P(m.MenuErrorWrapper,{visible:this.props.visible},P(m.MenuComponent,{source:this.props.emotePickerSource,visible:this.props.visible,toggleVisibility:this.props.toggleVisibility,channel_data:this.props.channelData,emote_data:this.props.emoteSetsData,user_id:this.props.currentUserID,channel_id:this.props.channelID,loading:this.props.channelData?.loading||this.props.emoteSetsData?.loading,error:this.props.channelData?.error||this.props.emoteSetsData?.error,onClickToken:this.props.onClickToken}))},this.EmoteMenu.forceUpdate()})}updateEmojiVariables(){const c=this.chat.context.get("chat.emoji.style")||"twitter",m=`//cdn.frankerfacez.com/static/emoji/images/sheet-${w.Vf[c]||"twemoji"}-`,N=this.emoji_size=36,P=this.emoji_sheet_count=58,V=this.emoji_sheet_size=P*(N+2),H=this.emoji_sheet_pct=100*V/N;this.emoji_sheet_remain=V-N,this.css_tweaks.set("emoji-menu",`.ffz--emoji-tone-picker__emoji,.emote-picker__emoji .emote-picker__emote-figure {
	background-size: ${H}% ${H}%;
	background-image: url("${m}36.png");
	background-image: ${I.WEBKIT_CSS}image-set(
		url("${m}18.png") 0.5x,
		url("${m}36.png") 1x,
		url("${m}72.png") 2x
	);
}`)}maybeUpdate(){if(this.chat.context.get("chat.emote-menu.enabled"))for(const c of this.MenuWrapper.instances)c.rebuildData()}defineClasses(){var U,ee,he,Se,Te;const c=this,m=this.settings.provider,N=this.site.getReact(),P=N&&N.createElement;this.EmojiTonePicker=(U=class extends N.Component{constructor(Y){super(Y),this.onClick=()=>this.setState({open:!this.state.open}),this.onMouseEnter=()=>this.state.open||this.setState({emoji:this.pickRandomEmoji()}),this.onClickOutside=()=>this.state.open&&this.setState({open:!1}),this.clickTone=ge=>{this.props.pickTone(ge.currentTarget.dataset.tone),this.setState({open:!1})},this.element=null,this.saveRef=ge=>this.element=ge,this.state={open:!1,emoji:this.pickRandomEmoji(),tone:null}}componentDidMount(){this.element&&(this._clicker=new C.ClickOutside(this.element,this.onClickOutside))}componentWillUnmount(){this._clicker&&(this._clicker.destroy(),this._clicker=null)}pickRandomEmoji(){const Y=this.props.choices,ge=Math.floor(Math.random()*Y.length);return Y[ge]}renderTone(Y,ge){return Y?P("button",{key:Y.code,"data-tone":ge,class:"tw-interactive tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-y-05 tw-pd-x-2",onClick:this.clickTone},this.renderEmoji(Y)):null}renderToneMenu(){if(!this.state.open)return null;const Y=this.state.emoji;if(!Y||!Y.variants)return null;const ge=Object.entries(Y.variants).map(([re,Ce])=>this.renderTone(Ce,re));return P("div",{class:"tw-absolute ffz-balloon ffz-il-tooltip--up ffz-il-tooltip--align-right ffz-balloon tw-block"},P("div",{class:"tw-border-b tw-border-l tw-border-r tw-border-t tw-border-radius-medium tw-c-background-base tw-elevation-1"},this.renderTone(Y,null),ge))}renderEmoji(Y){if(!Y)return null;const ge=Y.sheet_x*(c.emoji_size+2)+1,re=Y.sheet_y*(c.emoji_size+2)+1,Ce=100*ge/c.emoji_sheet_remain,Ne=100*re/c.emoji_sheet_remain;return P("figure",{class:"ffz--emoji-tone-picker__emoji",style:{backgroundPosition:`${Ce}% ${Ne}%`}})}render(){const Y=this.state.emoji,ge=this.props.tone,re=ge&&Y.variants[ge];return P("div",{ref:this.saveRef,class:"ffz--emoji-tone-picker tw-relative tw-mg-l-1"},P("button",{class:"tw-interactive tw-button tw-button--dropmenu ffz-button--hollow",onClick:this.onClick,onMouseEnter:this.onMouseEnter},P("span",{class:"tw-button__text"},this.renderEmoji(re||Y)),P("span",{class:"tw-button__icon tw-button__icon--right"},P("figure",{class:"ffz-i-down-dir"}))),this.renderToneMenu())}},B(U,"FFZEmojiTonePicker"),U),this.MenuSection=(ee=class extends N.Component{constructor(Y){super(Y),this.ref=null,this.saveRef=Ce=>{this.ref&&this.props.stopObserving(this.ref),this.ref=Ce,Ce&&this.props.startObserving(this.ref,this)};const ge=m.get("emote-menu.collapsed"),re=m.get("emote-menu.hidden-sets");this.state={active:!1,activeEmote:-1,hidden:re&&Y.data&&re.includes(Y.data.hide_key||Y.data.key),collapsed:ge&&Y.data&&ge.includes(Y.data.key),intersecting:!window.IntersectionObserver},this.keyHeading=this.keyHeading.bind(this),this.clickHeading=this.clickHeading.bind(this),this.clickEmote=this.clickEmote.bind(this),this.mouseEnter=()=>this.state.intersecting||this.setState({intersecting:!0}),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this)}componentDidMount(){this.props.addSection(this),this.ref&&this.props.startObserving(this.ref,this)}componentWillUnmount(){this.props.removeSection(this),this.ref&&this.props.stopObserving(this.ref)}keyInteract(Y){}clickEmote(Y){if(this.props.visibility_control){const We=Y.currentTarget.dataset;let Xe,de=We.id;if(We.provider==="twitch")Xe="twitch";else if(We.provider==="ffz"){const ke=c.emotes.emote_sets[We.set],Oe=ke&&ke.emotes[de];if(!Oe)return;Xe=ke.source||"ffz",de=Oe.id}else return;c.emotes.toggleHidden(Xe,de);return}if(c.emotes.handleClick(Y,!0))return;let ge="",re="";const Ce=Y.currentTarget.dataset.effects,Ne=Y.currentTarget.dataset.effectPrefix==="true";Ce?.length>0&&Ce!="0"&&c.emotes.target_emote&&(Ne?re=` ${c.emotes.target_emote.name}`:ge=`${c.emotes.target_emote.name} `),this.props.onClickToken(`${ge}${Y.currentTarget.dataset.name}${re}`)}keyHeading(Y){(Y.keyCode===I.KEYS.Enter||Y.keyCode===I.KEYS.Space)&&this.clickHeading()}clickHeading(){if(this.props.visibility_control){const Ne=m.get("emote-menu.hidden-sets")||[],We=this.props.data.hide_key||this.props.data.key,Xe=Ne.indexOf(We);if(We==="twitch-current-channel")return;Xe===-1?(Ne.push(We),this.setState({hidden:!0})):(Ne.splice(Xe,1),this.setState({hidden:!1})),m.set("emote-menu.hidden-sets",Ne),c.emit("chat.emotes:change-set-hidden",We);return}if(this.props.filtered)return;const Y=m.get("emote-menu.collapsed")||[],ge=!this.state.collapsed,re=this.props.data.key,Ce=Y.indexOf(re);if(this.setState({collapsed:ge}),ge&&Ce===-1)Y.push(re);else if(!ge&&Ce!==-1)Y.splice(Ce,1);else return;m.set("emote-menu.collapsed",Y)}onMouseEnter(Y){const ge=Y.currentTarget.dataset.setId;this.setState({unlocked:ge})}onMouseLeave(){this.setState({unlocked:null})}render(){const Y=this.props.data,ge=this.props.filtered,re=this.props.visibility_control;let Ce=!(Y.is_favorites&&!this.props.combineTabs)&&this.props.showHeading;Ce===2?Ce=!ge:Ce=!!Ce,re&&(Ce=!0);const Ne=re?this.state.hidden:!1,We=re?Ne:Ce&&!ge&&this.state.collapsed;if(!Y)return null;let Xe;Y.image?Xe=P("img",{class:`ffz--menu-badge${Y.image_large?" ffz--menu-badge__large":""}`,src:Y.image,srcSet:Y.image_set}):Xe=P("figure",{class:`ffz--menu-badge ffz-i-${Y.icon||"zreknarf"}`});let de;const ke=Y.renews&&Y.renews.getTime(),Oe=Y.ends&&Y.ends.getTime();ke>0?de={icon:"calendar",message:c.i18n.t("emote-menu.sub-renews","This sub renews {seconds,humantime}.",{seconds:ke})}:Oe&&(Y.prime?de={icon:"crown",message:c.i18n.t("emote-menu.sub-prime",`This is your free sub with Prime Gaming.
It ends {seconds,humantime}.`,{seconds:Oe})}:Y.gift?de={icon:"gift",message:c.i18n.t("emote-menu.sub-gift-ends","This gifted sub ends {seconds,humantime}.",{seconds:Oe})}:de={icon:"calendar-empty",message:c.i18n.t("emote-menu.sub-ends","This sub ends {seconds,humantime}.",{seconds:Oe})});let Ve=Y.source_i18n?c.i18n.t(Y.source_i18n,Y.source):Y.source;return Ve==null&&(Ve="FFZ"),P("section",{ref:this.saveRef,"data-key":Y.key,class:ge?"filtered":"",onMouseEnter:this.mouseEnter},Ce?P("heading",{tabindex:"0",class:"tw-pd-1 tw-border-b tw-flex tw-flex-nowrap",onKeyDown:this.keyHeading,onClick:this.clickHeading},Xe,P("div",{class:"tw-pd-l-05"},(Y.i18n?c.i18n.t(Y.i18n,Y.title):Y.title)||c.i18n.t("emote-menu.unknown","Unknown Source"),!re&&de&&P("span",{class:`tw-mg-x-05 ffz--expiry-info ffz-tooltip ffz-i-${de.icon}`,"data-tooltip-type":"html","data-title":de.message})),P("div",{class:"tw-flex-grow-1"}),P("span",{class:!re&&Y.channel_source?"ffz-tooltip":"","data-title":Y.channel_source},re?Ne?c.i18n.t("emote-menu.visibility.hidden","Hidden"):c.i18n.t("emote-menu.visibility.visible","Visible"):Ve),!re&&ge?"":P("figure",{class:`tw-pd-l-05 ffz-i-${We?"left":"down"}-dir`})):null,We||this.renderBody(Ce))}renderBody(Y){const ge=this.props.data,re=this.props.filtered,Ce=ge.locks&&ge.locks[this.state.unlocked],Ne=ge.filtered_emotes&&ge.filtered_emotes.map(We=>{if(re&&We.locked)return;const Xe=We.locked&&(!Ce||!Ce.emotes.has(We.id)),de=Xe&&ge.locks&&ge.locks[We.set_id];let ke="";return de&&(de.id==="subwoofer"?ke=c.i18n.t("emote-menu.emote-subwoofer","Become an FFZ Subwoofer to unlock this emote."):de.id==="cheer"?ke=c.i18n.t("emote-menu.emote-cheer","Cheer an additional {bits_remaining, plural, one {# bit} other {# bits}} to unlock this emote.",de):de.id==="follower"?ke=c.i18n.t("emote-menu.emote-follower","Follow {user} to unlock this emote in their channel.",de):ge.all_locked?ke=c.i18n.t("emote-menu.emote-sub","Subscribe for {price} to unlock this emote.",de):ke=c.i18n.t("emote-menu.emote-up","Upgrade your sub to {price} to unlock this emote.",de)),this.renderEmote(We,Xe,Y,ke)});return P("div",{class:"tw-pd-1 tw-border-b tw-c-background-alt tw-align-center"},Ne,!this.props.visibility_control&&!re&&this.renderSellout())}renderEmote(Y,ge,re,Ce){if(!this.state.intersecting)return P("span",{key:Y.id,class:"emote-picker__placeholder",style:{width:`${Y.width||28}px`,height:`${Y.height||28}px`}});const Ne=this.props.visibility_control,We=this.props.emote_modifiers[Y.id],Xe=Array.isArray(We)&&We.length>0,de=this.props.animated,ke=Ne&&Y.hidden,Oe=c.chat.context.get("chat.emote-menu.tooltips");let Ve,nt;return de&&Y.animSrc?(Ve=Y.animSrc,nt=Y.animSrcSet):(Ve=Y.src,nt=Y.srcSet),P("button",{key:Y.id,class:`${Oe?"ffz-tooltip ":""}emote-picker__emote-link${!Ne&&ge?" locked":""}${ke?" emote-hidden":""}`,"data-tooltip-type":"emote","data-provider":Y.provider,"data-id":Y.id,"data-set":Y.set_id,"data-code":Y.code,"data-modifiers":We,"data-effects":Y.effects,"data-effect-prefix":Y.effect_prefix,"data-variant":Y.variant,"data-no-source":re,"data-name":Y.name,"aria-label":Y.name,"data-locked":Y.locked,"data-sellout":Ce,onClick:(this.props.visibility_control||!Y.locked)&&this.clickEmote},P("figure",{class:"emote-picker__emote-figure"},P("img",{class:`emote-picker__emote-image${Y.emoji?" ffz-emoji":""}`,src:Ve,srcSet:nt,alt:Y.name,height:Y.height?`${Y.height}px`:null,width:Y.width?`${Y.width}px`:null})),!Ne&&Xe&&P("div",{class:"emote-button__options"}),!Ne&&Y.favorite&&P("figure",{class:"ffz--favorite ffz-i-star"}),!Ne&&ge&&P("figure",{class:`ffz-i-${Y.lock_icon||"lock"}`}),ke&&P("figure",{class:"ffz-i-eye-off"}))}renderSellout(){const Y=this.props.data;if(!Y.all_locked||!Y.locks)return null;let ge=Y.locks[this.state.unlocked],re=Object.values(Y.locks).filter(Ne=>Ne.id!=="cheer"),Ce=re.filter(Ne=>Ne.is_ffz).length>0;return!ge&&Y.locks.length===1&&(ge=Y.locks[0]),re.length?P("div",{class:"tw-mg-1 tw-border-t tw-pd-t-1 tw-mg-b-0"},Ce?c.i18n.t("emote-menu.ffz-unlock","This feature is available to FFZ Subwoofers."):ge?c.i18n.t("emote-menu.sub-unlock","Subscribe for {price} to unlock {count, plural, one {# emote} other {# emotes}}",{price:ge.price,count:ge.emotes.size}):c.i18n.t("emote-menu.sub-basic","Subscribe to unlock some emotes"),Ce&&this.props.ffz_sub_data?.has_free_sub?P("div",{class:"tw-pd-y-1"},c.i18n.t("emote-menu.free-sub.about","As thanks for supporting us in the past, you can get one month of FFZ Subwoofer for free.")):null,P("div",{class:"ffz--sub-buttons tw-mg-t-05"},re.map(Ne=>Ne.hide_button?null:P("a",{key:Ne.price,class:"tw-button tw-border-radius-none",href:Ne.url,target:"_blank",rel:"noopener noreferrer","data-set-id":Ne.set_id,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},P("span",{class:"tw-button__text"},Ce&&this.props.ffz_sub_data?.has_free_sub?c.i18n.t("emote-menu.free-sub","Use My Free Month"):Ne.price))))):null}},B(ee,"FFZMenuSection"),ee),this.fine.wrap("ffz-menu-section",this.MenuSection),this.EmojiSection=(he=class extends this.MenuSection{renderEmote(Y,ge,re,Ce){const Ne=Y.x*(c.emoji_size+2)+1,We=Y.y*(c.emoji_size+2)+1,Xe=100*Ne/c.emoji_sheet_remain,de=100*We/c.emoji_sheet_remain,ke=c.chat.context.get("chat.emote-menu.tooltips");return P("button",{key:Y.id,class:`${ke?"ffz-tooltip ":""}emote-picker__emote-link${ge?" locked":""}${Y.emoji?" emote-picker__emoji":""}`,"data-tooltip-type":"emote","data-provider":Y.provider,"data-id":Y.id,"data-set":Y.set_id,"data-code":Y.code,"data-variant":Y.variant,"data-no-source":re,"data-name":Y.name,"aria-label":Y.name,"data-locked":Y.locked,"data-sellout":Ce,onClick:!Y.locked&&this.clickEmote},P("figure",{class:"emote-picker__emote-figure",style:{backgroundPosition:`${Xe}% ${de}%`}}),Y.favorite&&P("figure",{class:"ffz--favorite ffz-i-star"}),ge&&P("figure",{class:`ffz-i-${Y.lock_icon||"lock"}`}))}},B(he,"FFZMenuEmojiSection"),he);let V;const H=B(()=>requestAnimationFrame(()=>this.emit("tooltips:cleanup")),"doClear"),j=B(()=>{clearTimeout(V),setTimeout(H,100)},"clearTooltips");this.MenuErrorWrapper=(Se=class extends N.Component{constructor(Y){super(Y),this.state={errored:!1,error:null}}static getDerivedStateFromError(Y){return{errored:!0,error:Y}}componentDidCatch(Y){c.log.capture(Y),c.log.error("Error rendering the FFZ Emote Menu."),this.setState({errored:!0,error:Y})}render(){if(this.state.errored){if(!this.props.visible)return null;const Y=c.chat.context.get("chat.emote-menu.reduced-padding");return P("div",{class:`ffz-balloon ffz-balloon--md ffz-il-tooltip--up ffz-il-tooltip--align-right tw-block tw-absolute ffz--emote-picker${Y?" reduced-padding":""}`,"data-a-target":"emote-picker"},P("div",{class:"tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base"},P("div",{class:"emote-picker__tab-content scrollable-area","data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},P("div",{class:"tw-align-center tw-pd-1"},P("div",{class:"tw-mg-b-1"},P("div",{class:"tw-mg-2"},P("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),c.i18n.t("emote-menu.error","There was an error rendering this menu."),P("br",null),c.settings.get("reports.error.enable")?c.i18n.t("emote-menu.error-report","An error report has been automatically submitted."):"",P("div",{class:"tw-mg-t-05 tw-border-t-1 tw-pd-t-05"},c.i18n.t("emote-menu.disable","As a temporary workaround, try disabling the FFZ Emote Menu in the FFZ Control Center.")))))))}return this.props.children}},B(Se,"FFZEmoteMenuErrorWrapper"),Se),this.MenuComponent=(Te=class extends N.Component{constructor(Y){super(Y),this.nav_ref=null,this.saveNavRef=ge=>{this.nav_ref=ge},this.ref=null,this.saveScrollRef=ge=>{this.ref=ge,this.createObserver()},this.sections=[],this.activeSection=-1,this.state={tab:null,active_nav:null,stayLoaded:c.chat.context.get("chat.emote-menu.stay-loaded"),quickNav:c.chat.context.get("chat.emote-menu.show-quick-nav"),animated:c.chat.context.get("chat.emotes.animated"),showHeading:c.chat.context.get("chat.emote-menu.show-heading"),tall:c.chat.context.get("chat.emote-menu.tall"),reducedPadding:c.chat.context.get("chat.emote-menu.reduced-padding"),combineTabs:c.chat.context.get("chat.emote-menu.combine-tabs"),showSearch:c.chat.context.get("chat.emote-menu.show-search"),clearSearch:c.chat.context.get("chat.emote-menu.clear-search"),hasNewEffects:!1,unlockedEffects:c.settings.provider.get("unlocked-effects",[]),tone:c.settings.provider.get("emoji-tone",null)},Y.visible&&(this.loadData(),this.state.wants_plan_info&&this.loadFFZPlanData(),this.state.wants_resub_info&&this.loadFFZSubData()),this.rebuildData(),this.observing=new Map,this.addSection=ge=>{this.sections.includes(ge)||this.sections.push(ge)},this.removeSection=ge=>{const re=this.sections.indexOf(ge);re!==-1&&(this.sections.splice(re),re===this.activeSection?this.activeSection=-1:re<this.activeSection&&this.activeSection--)},this.startObserving=this.startObserving.bind(this),this.stopObserving=this.stopObserving.bind(this),this.handleObserve=this.handleObserve.bind(this),this.pickTone=this.pickTone.bind(this),this.clickTab=this.clickTab.bind(this),this.clickSideNav=this.clickSideNav.bind(this),this.handleFilterChange=this.handleFilterChange.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.toggleVisibilityControl=this.toggleVisibilityControl.bind(this)}createObserver(){if(this.observer){if(this._observed===this.ref)return;this.observer.disconnect(),this.observer=this._observed=null}if(!(!this.ref||!window.IntersectionObserver)){this._observed=this.ref,this.observer=new IntersectionObserver(this.handleObserve,{root:this.ref,rootMargin:"50px 0px",threshold:.01});for(const Y of this.observing.keys())this.observer.observe(Y);this.observeSoon()}}observeSoon(){requestAnimationFrame(()=>{this.observer&&this.handleObserve(this.observer.takeRecords())})}destroyObserver(){this.observer&&(this.observer.disconnect(),this.observer=this._observed=null)}scrollNavIntoView(){requestAnimationFrame(()=>{const Y=this.nav_ref?.querySelector?.(`button[data-key="${this.state.active_nav}"]`);Y&&J(Y)})}handleObserve(Y){let ge=!1,re=this.state.active_nav;for(const Ce of Y){const Ne=this.observing.get(Ce.target),We=Ce.isIntersecting;!Ne||Ne.state.intersecting===We||(ge=!0,Ne.setState({intersecting:We}),We&&(re=Ne.props?.data?.key))}ge&&(requestAnimationFrame(j),!this.lock_active&&re!==this.state.active_nav&&this.setState({active_nav:re},()=>this.scrollNavIntoView()))}startObserving(Y,ge){const re=this.observing.get(Y);ge!==re&&(re&&this.stopObserving(Y),this.observing.set(Y,ge),this.observer&&this.observer.observe(Y),this.observeSoon())}stopObserving(Y){this.observing.has(Y)&&(this.observing.delete(Y),this.observer&&this.observer.unobserve(Y))}componentDidMount(){this.ref&&this.createObserver(),c.chat.context.on("changed:chat.emotes.animated",this.updateSettingState,this),c.chat.context.on("changed:chat.emote-menu.stay-loaded",this.updateSettingState,this),c.chat.context.on("changed:chat.emote-menu.show-quick-nav",this.updateSettingState,this),c.chat.context.on("changed:chat.emote-menu.reduced-padding",this.updateSettingState,this),c.chat.context.on("changed:chat.emote-menu.show-heading",this.updateSettingState,this),c.chat.context.on("changed:chat.emote-menu.combine-tabs",this.updateSettingState,this),c.chat.context.on("changed:chat.emote-menu.show-search",this.updateSettingState,this),c.chat.context.on("changed:chat.emote-menu.clear-search",this.updateSettingState,this),c.chat.context.on("changed:chat.emote-menu.tall",this.updateSettingState,this),window.ffz_menu=this}componentWillUnmount(){this.destroyObserver(),c.chat.context.off("changed:chat.emotes.animated",this.updateSettingState,this),c.chat.context.off("changed:chat.emote-menu.stay-loaded",this.updateSettingState,this),c.chat.context.off("changed:chat.emote-menu.show-quick-nav",this.updateSettingState,this),c.chat.context.off("changed:chat.emote-menu.show-heading",this.updateSettingState,this),c.chat.context.off("changed:chat.emote-menu.reduced-padding",this.updateSettingState,this),c.chat.context.off("changed:chat.emote-menu.combine-tabs",this.updateSettingState,this),c.chat.context.off("changed:chat.emote-menu.show-search",this.updateSettingState,this),c.chat.context.off("changed:chat.emote-menu.clear-search",this.updateSettingState,this),c.chat.context.off("changed:chat.emote-menu.tall",this.updateSettingState,this),window.ffz_menu===this&&(window.ffz_menu=null)}updateSettingState(){this.setState({stayLoaded:c.chat.context.get("chat.emote-menu.stay-loaded"),quickNav:c.chat.context.get("chat.emote-menu.show-quick-nav"),animated:c.chat.context.get("chat.emotes.animated"),showHeading:c.chat.context.get("chat.emote-menu.show-heading"),reducedPadding:c.chat.context.get("chat.emote-menu.reduced-padding"),combineTabs:c.chat.context.get("chat.emote-menu.combine-tabs"),showSearch:c.chat.context.get("chat.emote-menu.show-search"),clearSearch:c.chat.context.get("chat.emote-menu.clear-search"),tall:c.chat.context.get("chat.emote-menu.tall")})}seeEffects(){this.state.hasNewEffects&&(c.settings.provider.set("unlocked-effects",this.state.unlockedEffects),this.setState({hasNewEffects:!1}))}pickTone(Y){Y=Y||null,c.settings.provider.set("emoji-tone",Y),this.setState(this.filterState(this.state.filter,this.buildEmoji(Object.assign({},this.state,{tone:Y}))))}clickSideNav(Y){const ge=Y.currentTarget.dataset.key,re=this.ref?.querySelector?.(`section[data-key="${ge}"]`);re&&(this.lock_active=!0,J(re),this.setState({active_nav:ge}),setTimeout(()=>this.lock_active=!1,250))}clickTab(Y){const ge=Y.currentTarget.dataset.tab;if(ge==="effect"&&this.seeEffects(),this.state.combineTabs){let re;switch(ge){case"fav":re=this.state.filtered_fav_sets;break;case"channel":re=this.state.filtered_channel_sets;break;case"effect":re=this.state.filtered_effect_sets;break;case"emoji":re=this.state.filtered_emoji_sets;break;case"all":default:re=this.state.filtered_all_sets;break}const Ce=re&&re[0],Ne=Ce&&this.ref?.querySelector?.(`section[data-key="${Ce.key}"]`);Ne&&J(Ne);return}this.setState({tab:ge})}clickSettings(Y){const ge=new y.FFZEvent({item:"chat.emote_menu",event:Y,errored:!1});c.emit("main_menu:open",ge)}toggleVisibilityControl(){this.setState(this.filterState(this.state.filter,this.state,!this.state.visibility_control))}handleFilterChange(Y){this.setState(this.filterState(Y.target.value,this.state))}handleKeyDown(Y){if(Y.keyCode===I.KEYS.Escape)this.props.toggleVisibility();else return;Y.preventDefault()}loadData(Y=!1,ge,re){if(re=re||this.state,!re)return!1;ge=ge||this.props;const Ce=ge.emote_data&&ge.emote_data.emoteSets,Ne=Array.isArray(Ce)?new Set(Ce.map(We=>We.id)):new Set;return Y=Y||re.set_data&&!(0,M.set_equals)(re.set_sets,Ne),re.set_data&&!Y?!1:(this.setState({loading:!0},()=>{c.getData(Ne,Y).then(We=>{this.setState(this.filterState(this.state.filter,this.buildState(this.props,Object.assign({},this.state,{set_sets:Ne,set_data:We,loading:!1}))))})}),!0)}loadFFZPlanData(Y=!1,ge,re){return re=re||this.state,!re||re.ffz_plan_loading||re.ffz_sub_data&&!Y?!1:(this.setState({ffz_plan_loading:!0},()=>{c.getFFZSubPrices().then(Ce=>{this.setState(this.filterState(this.state.filter,this.buildState(this.props,Object.assign({},this.state,{ffz_plan_data:Ce,ffz_plan_loading:!1}))))})}),!0)}loadFFZSubData(Y=!1,ge,re){return re=re||this.state,!re||re.ffz_loading||re.ffz_sub_data&&!Y?!1:(this.setState({ffz_loading:!0},()=>{c.getFFZSubData().then(Ce=>{this.setState(this.filterState(this.state.filter,this.buildState(this.props,Object.assign({},this.state,{ffz_sub_data:Ce,ffz_loading:!1}))))})}),!0)}filterState(Y,ge,re){const Ce=Object.assign({},ge);return re!=null?Ce.visibility_control=re:re=Ce.visibility_control,Ce.filter=Y,Ce.filtered=Y&&Y.length>0&&Y!==":"||!1,Ce.filtered_channel_sets=this.filterSets(Y,Ce.channel_sets,re),Ce.filtered_effect_sets=this.filterSets(Y,Ce.effect_sets,re),Ce.filtered_all_sets=this.filterSets(Y,Ce.all_sets,re),Ce.filtered_fav_sets=this.filterSets(Y,Ce.fav_sets,re),Ce.filtered_emoji_sets=this.filterSets(Y,Ce.emoji_sets,re),Ce.has_effect_tab=Ce.filtered_effect_sets.length>0,Ce}filterSets(Y,ge,re){const Ce=[];if(!ge||!ge.length)return Ce;const Ne=Y&&Y.length>0&&Y!==":",We=m.get("emote-menu.hidden-sets")||[];for(const Xe of ge){if(!re&&We.includes(Xe.key))continue;(Xe.filtered_emotes=Xe.emotes.filter(ke=>!re&&ke.hidden?!1:!Ne||!ke.locked&&this.doesEmoteMatch(Y,ke))).length&&Ce.push(Xe)}return Ce}doesEmoteMatch(Y,ge){if(!Y||!Y.length)return!0;const re=ge.search||ge.name,Ce=re.toLowerCase(),Ne=Y.toLowerCase(),We=Y.startsWith(":"),Xe=Ne.slice(1);if(Array.isArray(ge.extra)){let ke=ge.extra.length;for(;ke--;){if(!We&&ge.extra[ke].includes(Ne))return!0;if(We&&ge.extra[ke].startsWith(Xe))return!0}}if(!We)return Ce.includes(Ne);if(Ce.startsWith(Xe))return!0;const de=re.indexOf(Y.charAt(1).toUpperCase());return de!==-1?Ce.slice(de+1).startsWith(Ne.slice(2)):!1}buildEmoji(Y){const ge=Object.assign({},Y),re=ge.emoji_sets=[],Ce=c.emotes.getFavorites("emoji"),Ne=ge.favorites=(ge.favorites||[]).filter(ke=>!ke.emoji),We=ge.tone=ge.tone||null,Xe=ge.tone_emoji=[],de={};if(c.chat.context.get("chat.emote-menu.show-emoji")){let ke=c.chat.context.get("chat.emoji.style")||"twitter";w.Vf[ke]||(ke="twitter");for(const Oe of Object.values(c.emoji.emoji)){if(!Oe||!Oe.has[ke]||w.D3.includes(Oe.category))continue;if(Oe.variants){for(const Bt of Oe.names)if($.includes(Bt)){Xe.push(Oe);break}}const Ve=Ce.includes(Oe.code),nt=Oe.variants&&Oe.variants[We],ot=nt&&nt.has[ke],At=ot?nt:Oe;let kt=de[Oe.category];kt||(kt=de[Oe.category]=[],re.push({key:`emoji-${Oe.category}`,sort_key:w.of.indexOf(Oe.category),emoji:!0,image:c.emoji.getFullImage(At.image),i18n:`emoji.category.${Oe.category.toSnakeCase()}`,title:w.aA[Oe.category]||Oe.category,src:"emoji",source:"Emoji",source_i18n:"emote-menu.emoji",emotes:kt}));const It={provider:"emoji",id:Oe.sort,emoji:!0,code:Oe.code,name:At.raw,variant:ot&&We,hidden:Oe.hidden,search:Oe.names[0],extra:Oe.names.length>1?Oe.names.map(Bt=>Bt.toLowerCase()):null,height:18,width:18,x:At.sheet_x,y:At.sheet_y,favorite:Ve,src:c.emoji.getFullImage(At.image),srcSet:c.emoji.getFullImageSet(At.image)};kt.push(It),Ve&&Ne.push(It)}}return ge.has_emoji_tab=re.length>0,ge.fav_sets=[{key:"favorites",title:"Favorites",i18n:"emote-menu.favorites",icon:"star",source:"",is_favorites:!0,emotes:Ne}],Ne.sort(this.getSorter()),re.sort(se),ge}getAllSets(){return[...this.state.channel_sets||[],...this.state.effect_sets||[],...this.state.all_sets||[]]}getSorter(){return Q[c.chat.context.get("chat.emote-menu.sort-emotes")]||Q[0]||(()=>0)}buildState(Y,ge){const re=Object.assign({},ge),Ce=re.set_data||{},Ne=re.emote_modifiers={},We=re.channel_sets=[],Xe=re.all_sets=[],de=re.effect_sets=[],ke=re.favorites=[];if(Y.loading||Y.error||re.loading||re.set_data&&this.loadData(!1,Y,re))return re;const Oe=this.getSorter(),Ve=c.chat.context.get("chat.emote-menu.sort-tiers-last"),nt=B((lt,tt)=>{if(lt.misc||tt.misc)return Oe(lt,tt);if(!lt.locked&&tt.locked)return-1;if(lt.locked&&!tt.locked)return 1;if(Ve||lt.locked||tt.locked)if(lt.bits||tt.bits){if(tt.bits){if(!lt.bits)return-1}else return 1;const $t=lt.bit_value||0,Ot=tt.bit_value||0;if(G){const St=G.compare($t,Ot);if(St!=0)return St}else{if($t<Ot)return-1;if($t>Ot)return 1}}else if(G){const $t=G.compare(lt.set_id,tt.set_id);if($t!=0)return $t}else{if(lt.set_id<tt.set_id)return-1;if(lt.set_id>tt.set_id)return 1}return Oe(lt,tt)},"sort_emotes"),ot=Y.channel_data&&Y.channel_data.user,At=ot&&ot.subscriptionProducts,kt=ot&&Y.channel_data?.channel?.localEmoteSets,It=ot&&ot.self?.follower!=null,Bt=!It&&Y.user_id&&ot?.id!=Y.user_id,Et=ot?.cheer?.badgeTierEmotes,Lt=new Set;if(Array.isArray(kt))for(const lt of kt)lt?.id&&Lt.add(lt.id);const Dt=Y.emote_data&&Y.emote_data.emoteSets,Qt=Y.emote_data&&Y.emote_data.emoteMap,Nt=c.emotes.getFavorites("twitch"),jt=c.emotes.getHidden("twitch"),ut=new Set,dt=[],mt={},Tt=new Set;if(Array.isArray(Dt))for(const lt of Dt){if(!lt||!Array.isArray(lt.emotes))continue;const tt=lt.id,$t=parseInt(tt,10),Ot=lt.owner,St=Lt.has(tt),Ft=!St&&$t>5e8,pt=I.TWITCH_POINTS_SETS.includes($t)||Ot?.login==="channel_points",et=St?ot:pt?null:Ot,at=Ce[tt],gt=Ft&&Ot&&Ot.id==ot?.id;Tt.add(tt);let ft=`twitch-set-${tt}`,rt=0,_t="twitch",vt=et&&(et.displayName||et.login);if(vt?(ft=`twitch-${et?.id}`,St?c.emotes.setTwitchSetChannel(tt,{id:tt,type:I.EmoteTypes.Follower,owner:{id:et.id,login:et.login,displayName:et.displayName}}):Ft?c.emotes.setTwitchSetChannel(tt,{id:tt,type:I.EmoteTypes.BitsTier,owner:{id:et.id,login:et.login,displayName:et.displayName}}):c.emotes.setTwitchSetChannel(tt,{id:tt,type:I.EmoteTypes.Subscription,owner:{id:et.id,login:et.login,displayName:et.displayName}})):et?vt=c.i18n.t("emote-menu.unknown-set","Set #{set_id}",{set_id:tt}):pt?(vt=c.i18n.t("emote-menu.points","Unlocked with Points"),ft="twitch-points",_t="channel-points",rt=45):I.TWITCH_GLOBAL_SETS.includes($t)?(vt=c.i18n.t("emote-menu.global","Global Emotes"),ft="twitch-global",rt=100,c.emotes.setTwitchSetChannel(tt,{id:tt,type:I.EmoteTypes.Global,owner:null})):I.TWITCH_PRIME_SETS.includes($t)?(vt=c.i18n.t("emote_menu.prime","Prime"),ft="twitch-prime",_t="crown",rt=75,c.emotes.setTwitchSetChannel(tt,{id:tt,type:I.EmoteTypes.Prime,owner:null})):(vt=c.i18n.t("emote-menu.misc","Miscellaneous"),ft="twitch-misc",_t="inventory",rt=50),St)continue;let Ut,Gt;mt[ft]?(Ut=mt[ft],Gt=Ut.emotes,at&&Ut.bad&&(Ut.bad=!1,Ut.renews=at.renews,Ut.ends=at.ends,Ut.prime=at.prime,Ut.gift=at.gift)):(Gt=[],Ut=mt[ft]={sort_key:rt,key:ft,image:et?.profileImageURL,image_large:!0,icon:_t,title:vt,source:c.i18n.t("emote-menu.twitch","Twitch"),emotes:Gt,renews:at?.renews,ends:at?.ends,prime:at?.prime,gift:at?.gift},at||(Ut.bad=!0));let gi=0;for(const Vt of lt.emotes){if(!Vt||!Vt.id||!Vt.token)continue;const Mt=Vt.id,Ci=I.KNOWN_CODES[Vt.token]||Vt.token,qt=Qt&&Qt[Ci];pt||c.emotes.setTwitchEmoteSet(Mt,tt);const _i=[""];if(Array.isArray(Vt.modifiers)&&Vt.modifiers.length&&c.chat.context.get("chat.emote-menu.modifiers")===1)for(const si of Vt.modifiers)_i.push(`_${si.code}`);for(const si of _i){const Xt=`${Mt}${si}`,ti=`${Ci}${si}`,bi=Nt.includes(Xt),Vi=qt&&qt.id!=Xt,ni=I.REPLACEMENTS[Xt];let ui,Bi,ri,xi;ni&&c.chat.context.get("chat.fix-bad-emotes")?ui=`${I.REPLACEMENT_BASE}${ni}`:(ui=(0,M.getTwitchEmoteURL)(Xt,1,!1),Bi=(0,M.getTwitchEmoteSrcSet)(Xt,!1),ri=(0,M.getTwitchEmoteURL)(Xt,1,!0),xi=(0,M.getTwitchEmoteSrcSet)(Xt,!0));const di={provider:"twitch",id:Xt,set_id:tt,name:ti,src:ui,srcSet:Bi,animSrc:ri,animSrcSet:xi,order:gi++,overridden:Vi?qt.id:null,misc:!et,bits:Ft,hidden:jt.includes(Xt),favorite:bi};Gt.push(di),gt&&dt.push(di),bi&&!ut.has(Xt)&&ke.push(di),ut.add(Xt)}}Gt.length&&(Gt.sort(nt),Xe.includes(Ut)||Xe.push(Ut))}if(Array.isArray(kt)||Array.isArray(At)||Array.isArray(Et)){const lt=c.badges.getTwitchBadge("subscriber","0",ot.id,ot.login),tt=[],$t=new Set,Ot={},St={sort_key:-10,key:"twitch-current-channel",hide_key:`twitch-${ot.id}`,image:lt&&lt.image1x,image_set:lt&&`${lt.image1x} 1x, ${lt.image2x} 2x, ${lt.image4x} 4x`,icon:"twitch",title:c.i18n.t("emote-menu.main-set","Channel Emotes"),source:c.i18n.t("emote-menu.twitch","Twitch"),emotes:tt,locks:Ot,all_locked:!0};if(Array.isArray(kt))for(const pt of kt){if(!pt||!Array.isArray(pt.emotes))continue;const et=pt.id;let at;Bt&&(Ot[et]={set_id:et,id:"follower",user:ot?.displayName||ot?.login,hide_button:!0,emotes:at=new Set});let gt=0;for(const ft of pt.emotes){if(!ft||!ft.id||!ft.token)continue;const rt=ft.id,_t=I.KNOWN_CODES[ft.token]||ft.token,vt=ut.has(rt),Ut=Nt.includes(rt),Gt={provider:"twitch",id:rt,set_id:et,name:_t,order:gt++,src:(0,M.getTwitchEmoteURL)(rt,1,!1),srcSet:(0,M.getTwitchEmoteSrcSet)(rt,!1),animSrc:(0,M.getTwitchEmoteURL)(rt,1,!0),animSrcSet:(0,M.getTwitchEmoteSrcSet)(rt,!0),favorite:Ut,hidden:jt.includes(rt),locked:Bt,lock_icon:"heart"};tt.push(Gt),Ut&&!vt&&ke.push(Gt),ut.add(rt),at&&at.add(rt)}}if(Array.isArray(At))for(const pt of At){if(!pt||!Array.isArray(pt.emotes))continue;const et=pt.emoteSetID,at=Ce[et],gt=!Tt.has(et);let ft;at&&(St.renews=at.renews,St.ends=at.ends,St.prime=at.prime,St.gift=at.gift&&at.gift.isGift),gt?Ot[et]={set_id:et,id:pt.id,price:pt.price||z[pt.tier],url:pt.url,emotes:ft=new Set($t)}:St.all_locked=!1;let rt=0;for(const _t of pt.emotes){if(!_t||!_t.id||!_t.token)continue;const vt=_t.id,Ut=I.KNOWN_CODES[_t.token]||_t.token,Gt=ut.has(vt),gi=Nt.includes(vt),Vt={provider:"twitch",id:vt,set_id:et,name:Ut,order:rt++,locked:gt&&!Gt,src:(0,M.getTwitchEmoteURL)(vt,1,!1),srcSet:(0,M.getTwitchEmoteSrcSet)(vt,!1),animSrc:(0,M.getTwitchEmoteURL)(vt,1,!0),animSrcSet:(0,M.getTwitchEmoteSrcSet)(vt,!0),favorite:gi,hidden:jt.includes(vt)};tt.push(Vt),!gt&&gi&&!Gt&&ke.push(Vt),ut.add(vt),ft&&($t.add(vt),ft.add(vt))}}const Ft=new Set;if(Array.isArray(Et)){let pt;for(const et of Et){if(!et||!et.id||!et.bitsBadgeTierSummary)continue;const at=et.id,gt=et.setID,ft=et.bitsBadgeTierSummary,rt=!ut.has(at)&&!ft.self?.isUnlocked;rt&&(Ot[gt]={set_id:gt,id:"cheer",price:null,bits:ft.threshold,bits_remaining:ft.self?.numberOfBitsUntilUnlock??ft.threshold,emotes:new Set([et.id])});const _t=Nt.includes(at),vt={provider:"twitch",id:at,set_id:gt,name:et.token,locked:rt,order:pt++,src:(0,M.getTwitchEmoteURL)(at,1,!1),srcSet:(0,M.getTwitchEmoteSrcSet)(at,!1),animSrc:(0,M.getTwitchEmoteURL)(at,1,!0),animSrcSet:(0,M.getTwitchEmoteSrcSet)(at,!0),bits:!0,bit_value:ft.threshold,favorite:_t,hidden:jt.includes(at)};tt.push(vt),!rt&&_t&&!ut.has(at)&&ke.push(vt),Ft.add(at),ut.add(at)}}if(dt.length)for(const pt of dt)Ft.has(pt.id)||tt.push(pt);tt.length&&(tt.sort(nt),We.push(St))}let Rt=!1,ei=!1,Jt=!1;const hi=[...c.settings.provider.get("unlocked-effects",[])];if(c.chat.context.get("chat.emotes.enabled")>1){const lt=c.site.getUser(),tt=c.chat.context.get("chat.emote-menu.effect-tab"),$t=c.emotes.getRoomSetsWithSources(lt?.id,lt?.login,Y.channel_id,null),Ot=c.emotes.getSubSetsWithSources(),St=c.emotes.getGlobalSetsWithSources(lt?.id,lt?.login),Ft=new Set,pt={};let et={};for(const[gt,ft,rt]of $t){if(Ft.has(gt))continue;Ft.add(gt);const _t=this.processFFZSet(gt,ft,ke,pt,et,!1,void 0,rt,Y.channel_id);_t&&(_t.emotes.sort(nt),We.includes(_t)||We.push(_t))}et={};const at=St.map(gt=>gt?.[0]?.id);for(const[gt,ft]of Ot){if(Ft.has(gt))continue;Ft.add(gt);const rt=!at.includes(gt.id);Rt=!0;const _t=this.processFFZSet(gt,ft,ke,pt,et,rt,re);_t&&(_t.emotes.sort(nt),tt&&!de.includes(_t)&&_t.has_effects?(Jt=this.checkNewEffects(_t.emotes,hi)||Jt,de.push(_t)):Xe.includes(_t)||Xe.push(_t))}et={};for(const[gt,ft]of St){if(Ft.has(gt))continue;Ft.add(gt);const rt=this.processFFZSet(gt,ft,ke,pt,et);rt&&(rt.emotes.sort(nt),tt&&!de.includes(rt)&&rt.has_effects?(Jt=this.checkNewEffects(rt.emotes,hi)||Jt,de.push(rt)):Xe.includes(rt)||Xe.push(rt),!We.includes(rt)&&(0,M.maybe_call)(rt.force_global,this,gt,Y.channel_data&&Y.channel_data.user,lt)&&We.push(rt))}}return re.wants_resub_info=Rt,re.wants_plan_info=ei,this.props.visible&&(re.tab==="effects"&&(Jt=!1),ei&&this.loadFFZPlanData(),Rt&&this.loadFFZSubData()),We.sort(se),de.sort(se),Xe.sort(se),re.has_channel_tab=We.length>0,re.has_effect_tab=de.length>0,re.hasNewEffects=de.length>0&&Jt,re.unlockedEffects=hi,this.buildEmoji(re)}checkNewEffects(Y,ge){let re=!1;for(const Ce of Y)Ce&&!Ce.locked&&Ce.id&&Ce.provider==="ffz"&&!ge.includes(Ce.id)&&(re=!0,ge.push(Ce.id));return re}processFFZSet(Y,ge,re,Ce,Ne,We=!1,Xe,de,ke=null){if(!Y||!Y.emotes)return null;let Oe;if(de){const ut=c.parent.shared_room_data?.get(de);Oe=ut?.displayName??ut?.login}const Ve=Y.source||"ffz",nt=c.emotes.getFavorites(Ve),ot=c.emotes.getHidden(Ve),At=Ce[Ve]=Ce[Ve]||new Set,kt=`${Y.merge_source||Ve}-${Y.merge_id||Y.id}`,It=c.emotes.providers.get(ge),Bt=It&&It.menu_name?It.menu_i18n_key?c.i18n.t(It.menu_i18n_key,It.menu_name,It):It.menu_name:Y.source||"FFZ",Et=ge==="ffz-main"||Y.title_is_channel?Oe?c.i18n.t("emote-menu.source-set","{channel}'s Emotes",{channel:Oe}):c.i18n.t("emote-menu.main-set","Channel Emotes"):Y.title||c.i18n.t("emote-menu.unknown-set","Set #{set_id}",{set_id:Y.id});let Lt=It&&It.sort_key||Y.sort;Lt==null&&(Lt=Y.title.toLowerCase().includes("global")?100:0),de&&de!==ke&&(Lt+=50);let Dt,Qt,Nt;Ne[kt]?(Dt=Ne[kt],Qt=Dt.emotes,kt===`${Ve}-${Y.id}`&&Object.assign(Dt,{sort_key:Lt,image:Y.icon,title:Et,source:Bt,channel_source:Oe,force_global:Y.force_global})):(Qt=[],Dt=Ne[kt]={sort_key:Lt,key:kt,image:Y.icon,icon:"zreknarf",title:Et,source:Bt,channel_source:Oe,emotes:Qt,force_global:Y.force_global,all_locked:!0});const jt=(Xe||this.state)?.ffz_sub_data?.sets?.[Y.id];jt&&(Dt.renews=jt.next_bill_date,Dt.ends=jt.expires_at),We?(Dt.locks=Dt.locks||{},Dt.locks[Y.id]={set_id:Y.id,id:"subwoofer",is_ffz:!0,price:"More Info",url:"https://www.frankerfacez.com/subscribe",emotes:Nt=new Set}):Dt.all_locked=!1;for(const ut of Object.values(Y.emotes))if(!ut.hidden){const dt=nt.includes(ut.id),mt={provider:"ffz",id:ut.id,set_id:Y.id,src:ut.src,srcSet:ut.srcSet,animSrc:ut.animSrc,animSrcSet:ut.animSrcSet,effects:ut.modifier?ut.modifier_flags:0,effect_prefix:ut.modifier?ut.modifier_prefix:!1,name:ut.name,favorite:dt,locked:We,hidden:ot.includes(ut.id),height:ut.height,width:ut.width};Qt.push(mt),!We&&dt&&!At.has(ut.id)&&(re.push(mt),At.add(ut.id)),We&&Nt.add(ut.id),ut.modifier&&ut.modifier_flags&&(Dt.has_effects=!0)}if(Qt.length)return Dt}rebuildData(){const Y=this.buildState(this.props,this.state);this.setState(this.filterState(Y.filter,Y))}componentDidUpdate(Y){if(this.props.visible&&!Y.visible&&(this.loadData(),this.state.wants_plan_info&&this.loadFFZPlanData(),this.state.wants_resub_info&&this.loadFFZSubData()),!this.props.visible&&Y.visible&&this.state.clearSearch){this.setState(this.filterState("",this.state));return}const ge=this.props.channel_data,re=Y.channel_data,Ce=ge?.user!==re?.user||ge?.channel!==re?.channel,Ne=this.props.emote_data,We=Y.emote_data,Xe=!(0,M.deep_equals)(Ne?.emoteSets,We?.emoteSets)||!(0,M.deep_equals)(Ne?.emoteMap,We?.emoteMap);(Ce||Xe||this.props.user_id!==Y.user_id||this.props.channel_id!==Y.channel_id||this.props.loading!==Y.loading||this.props.error!==Y.error)&&(c.log.debug("Updating emote menu data. cd",Ce,", ed",Xe),this.rebuildData())}renderError(){return P("div",{class:"tw-align-center tw-pd-1"},P("div",{class:"tw-mg-b-1"},P("div",{class:"tw-mg-2"},P("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),c.i18n.t("emote-menu.error","There was an error rendering this menu.")),P("button",{class:"tw-button",onClick:this.forceUpdate},P("span",{class:"tw-button__text"},c.i18n.t("error.try-again","Try Again"))))}renderEmpty(){return P("div",{class:"tw-align-center tw-pd-1"},P("div",{class:"tw-mg-2"},P("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),this.state.filtered?c.i18n.t("emote-menu.empty-search","There are no matching emotes."):this.state.tab==="fav"?c.i18n.t("emote-menu.empty-favs","You don't have any favorite emotes. To favorite an emote, find it and {hotkey}-Click it.",{hotkey:I.IS_OSX?"\u2318":"Ctrl"}):c.i18n.t("emote-menu.empty","There's nothing here."))}renderLoading(){return P("div",{class:"tw-align-center tw-pd-1"},P("h1",{class:"tw-mg-5 ffz-i-zreknarf loading"}),c.i18n.t("emote-menu.loading","Loading..."))}render(){if(!this.props.visible&&(!this.state.stayLoaded||!this.loadedOnce))return null;const Y=this.state.loading||this.props.loading,ge=this.state.reducedPadding,re=this.state.combineTabs;Y||(this.loadedOnce=!0);let Ce,Ne,We,Xe,de;if(re)Ne=[this.state.filtered_fav_sets,this.state.filtered_channel_sets,this.state.filtered_effect_sets,this.state.filtered_all_sets,this.state.filtered_emoji_sets].flat();else switch(Ce=this.state.tab||c.chat.context.get("chat.emote-menu.default-tab"),(Ce==="effect"&&!this.state.has_effect_tab||Ce==="channel"&&!this.state.has_channel_tab||Ce==="emoji"&&!this.state.has_emoji_tab)&&(Ce="all"),We=Ce==="emoji",Xe=Ce==="fav",de=Ce==="effect",Ce){case"fav":Ne=this.state.filtered_fav_sets;break;case"channel":Ne=this.state.filtered_channel_sets;break;case"effect":Ne=this.state.filtered_effect_sets;break;case"emoji":Ne=this.state.filtered_emoji_sets;break;case"all":default:Ne=this.state.filtered_all_sets;break}const ke=this.state.visibility_control,Oe=this.props.source==="whisper";return P("div",{class:`tw-block${this.props.visible?"":" tw-hide"}`,style:{display:this.props.visible?null:"none !important"}},P("div",{class:"tw-absolute ffz-attached ffz-attached--right ffz-attached--up"},P("div",{class:`ffz-balloon ffz-balloon--auto tw-inline-block tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-2 ffz--emote-picker${this.state.tall?" ffz--emote-picker__tall":""}${ge?" reduced-padding":""}`,"data-a-target":"emote-picker",role:"dialog"},P("div",{class:`emote-picker${Oe?"__whisper":""}`},P("div",{class:"tw-flex"},P("div",{class:`emote-picker__tab-content${Oe?"-whisper":""} tw-full-width scrollable-area scrollable-area--suppress-scroll-x`,"data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},P("div",{ref:this.saveScrollRef,class:"simplebar-scroll-content"},P("div",{class:"simplebar-content"},Y&&this.renderLoading(),!Y&&Ne&&Ne.map((Ve,nt)=>Ve&&(!ke||!Ve.emoji&&!Ve.is_favorites)&&P(Ve.emoji?c.EmojiSection:c.MenuSection,{key:Ve.key,idx:nt,data:Ve,ffz_sub_data:this.state.ffz_sub_data,emote_modifiers:this.state.emote_modifiers,animated:this.state.animated,combineTabs:this.state.combineTabs,showHeading:this.state.showHeading,filtered:this.state.filtered,visibility_control:ke,onClickToken:this.props.onClickToken,addSection:this.addSection,removeSection:this.removeSection,startObserving:this.startObserving,stopObserving:this.stopObserving})),!Y&&(!Ne||!Ne.length)&&this.renderEmpty()))),!Y&&this.state.quickNav&&!Xe&&P("div",{class:`emote-picker__nav_content${Oe?"-whisper":""} tw-block tw-border-radius-none tw-c-background-alt-2`},P("div",{class:`emote-picker__nav-content-overflow${Oe?"-whisper":""} scrollable-area scrollable-area--suppress-scroll-x`,"data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},P("div",{ref:this.saveNavRef,class:"simplebar-scroll-content"},P("div",{class:"simplebar-content"},!Y&&Ne&&Ne.map(Ve=>{if(!Ve||ke&&(Ve.is_favorites||Ve.emoji))return null;const nt=this.state.active_nav===Ve.key;return P("button",{key:Ve.key,class:`${nt?"emote-picker-tab-item-wrapper__active ":""}${ge?"tw-mg-y-05":"tw-mg-y-1"} tw-c-text-inherit tw-interactable ffz-interactive ffz-interactable--hover-enabled ffz-interactable--default tw-block tw-full-width ffz-tooltip ffz-tooltip--no-mouse`,"data-key":Ve.key,"data-title":`${Ve.i18n?c.i18n.t(Ve.i18n,Ve.title):Ve.title}
${Ve.source_i18n?c.i18n.t(Ve.source_i18n,Ve.source):Ve.source}${Ve.channel_source?` (${Ve.channel_source})`:""}`,"data-tooltip-side":"left",onClick:this.clickSideNav},P("div",{class:`tw-align-items-center tw-flex tw-justify-content-center ${ge?"":"tw-pd-x-05 "}tw-pd-y-05${nt?" emote-picker-tab-item-avatar__active tw-c-text-link":""}`},Ve.image?P("figure",{class:"ffz-avatar ffz-avatar--size-20"},P("img",{class:"tw-block tw-border-radius-rounded tw-img tw-image-avatar",src:Ve.image,srcSet:Ve.image_set})):P("figure",{class:`ffz-emote-picker--nav-icon ffz-i-${Ve.icon||"zreknarf"}`})))}),re&&P("div",{class:"tw-mg-y-1 tw-mg-x-05 tw-border-t"}),re&&P("button",{class:"tw-mg-y-1 tw-c-text-inherit tw-interactable ffz-interactive ffz-interactable--hover-enabled ffz-interactable--default tw-block tw-full-width ffz-tooltip ffz-tooltip--no-mouse","data-title":c.i18n.t("emote-menu.settings","Open Settings"),"data-tooltip-side":"left",onClick:this.clickSettings},P("div",{class:`tw-align-items-center tw-flex tw-justify-content-center ${ge?"":"tw-pd-x-05 "}tw-pd-y-05`},P("figure",{class:"ffz-emote-picker--nav-icon ffz-i-cog"})))))))),P("div",{class:"emote-picker__controls-container tw-relative"},(We||this.state.showSearch)&&P("div",{class:"tw-border-t tw-pd-1"},P("div",{class:"tw-flex"},P("input",{type:"text",class:"tw-block tw-border-radius-medium tw-font-size-6 tw-full-width ffz-input tw-pd-x-1 tw-pd-y-05",placeholder:We?c.i18n.t("emote-menu.search-emoji","Search for Emoji"):c.i18n.t("emote-menu.search","Search for Emotes"),value:this.state.filter,autoFocus:!0,autoCapitalize:"off",autoCorrect:"off",onChange:this.handleFilterChange,onKeyDown:this.handleKeyDown}),(re||We)&&!ke&&this.state.has_emoji_tab&&P(c.EmojiTonePicker,{tone:this.state.tone,choices:this.state.tone_emoji,pickTone:this.pickTone}),(re||!We)&&P("div",{class:"tw-relative ffz-il-tooltip__container tw-mg-l-1"},P("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon--primary ffz-core-button tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative${this.state.visibility_control?" ffz-core-button--primary":" tw-button-icon"}`,onClick:this.toggleVisibilityControl},P("span",{class:"tw-button-icon__icon tw-mg-x-05"},P("figure",{class:this.state.visibility_control?"ffz-i-eye-off":"ffz-i-eye"}))),P("div",{class:"ffz-il-tooltip ffz-il-tooltip--up ffz-il-tooltip--align-right"},this.state.visibility_control?c.i18n.t("emote-menu.toggle-hide.on","Exit Emote Visibility Control"):c.i18n.t("emote-menu.toggle-hide.off","Emote Visibility Control"),P("div",{class:"tw-mg-t-1 ffz--tooltip-explain"},c.i18n.t("emote-menu.toggle-hide.info","Emote Visibility Control allows you to hide emotes from your emote menu, either individually or by set. With Emote Visibility Control enabled, just click an emote to hide or unhide it. Please note that you will still see the emotes in chat if someone uses them, but they won't appear in your emote menu.")))))),re&&this.state.quickNav?null:P("div",{class:"emote-picker__tab-nav-container tw-flex tw-border-t tw-c-background-alt"},!ke&&P("div",{class:`emote-picker-tab-item${Ce==="fav"?" emote-picker-tab-item--active":""} tw-relative`},P("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${Ce==="fav"?" ffz-interactable--selected":""}`,id:"emote-picker__fav","data-tab":"fav","data-tooltip-type":"html","data-title":c.i18n.t("emote-menu.favorites","Favorites"),onClick:this.clickTab},P("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},P("figure",{class:"ffz-i-star"})))),this.state.has_channel_tab&&P("div",{class:`emote-picker-tab-item${Ce==="channel"?" emote-picker-tab-item--active":""} tw-relative`},P("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${Ce==="channel"?" ffz-interactable--selected":""}`,id:"emote-picker__channel","data-tab":"channel","data-tooltip-type":"html","data-title":c.i18n.t("emote-menu.channel","Channel"),onClick:this.clickTab},P("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},P("figure",{class:"ffz-i-camera"})))),this.state.has_effect_tab&&P("div",{class:`emote-picker-tab-item${Ce==="effect"?" emote-picker-tab-item--active":""} tw-relative`},P("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${Ce==="effect"?" ffz-interactable--selected":""}`,id:"emote-picker__effect","data-tab":"effect","data-tooltip-type":"html","data-title":c.i18n.t("emote-menu.effects","Emote Effects"),onClick:this.clickTab},this.state.hasNewEffects&&P("div",{class:"ffz-new-indicator"}),P("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},P("figure",{class:"ffz-i-fx"})))),P("div",{class:`emote-picker-tab-item${Ce==="all"?" emote-picker-tab-item--active":""} tw-relative`},P("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${Ce==="all"?" ffz-interactable--selected":""}`,id:"emote-picker__all","data-tab":"all","data-tooltip-type":"html","data-title":c.i18n.t("emote-menu.my-emotes","My Emotes"),onClick:this.clickTab},P("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},P("figure",{class:"ffz-i-channels"})))),!ke&&this.state.has_emoji_tab&&P("div",{class:`emote-picker-tab-item${Ce==="emoji"?" emote-picker-tab-item--active":""} tw-relative`},P("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${Ce==="emoji"?" ffz-interactable--selected":""}`,id:"emote-picker__emoji","data-tab":"emoji","data-tooltip-type":"html","data-title":c.i18n.t("emote-menu.emoji","Emoji"),onClick:this.clickTab},P("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},P("figure",{class:"ffz-i-smile"})))),P("div",{class:"tw-flex-grow-1"}),P("div",{class:"emote-picker-tab-item tw-relative"},P("button",{class:"ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive","data-tooltip-type":"html","data-title":c.i18n.t("emote-menu.settings","Open Settings"),onClick:this.clickSettings},P("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},P("figure",{class:"ffz-i-cog"}))))))))))}},B(Te,"FFZEmoteMenuComponent"),Te),this.fine.wrap("ffz-emote-menu",this.MenuComponent)}async getFFZSubPrices(){let c;try{c=await fetch(`${this.staging.api}/payment/plans`).then(N=>N.ok?N.json():null)}catch(N){this.log.error("Unable to load subscription prices from server.",N),c=null}const m={sets:{}};for(const N of Object.values(c.plans)){if(!Array.isArray(N.temporary_collections))continue;let P;for(const V of Object.values(c.gateway_plans))if(V.plan_id===N.id&&V.months===1){P=V.prices;break}if(P)for(const V of N.temporary_collections)m.sets[V]={plan_id:N.id,prices:P}}return m}async getFFZSubData(){if(!this.resolve("site").getUser())return null;const m=await this.resolve("socket").getBareAPIToken();if(!m)return null;let N;try{N=await fetch(`${this.staging.api}/v2/subscription/status?include=plan`,{headers:{Authorization:`Bearer ${m}`}}).then(V=>V.ok?V.json():null)}catch(V){this.log.error("Unable to load subscription status from server.",V),N=null}if(!N)return{error:!0};const P={has_free_sub:N.user?.bonus_month_eligible??!1,sets:{}};if(N.user?.active_subs)for(const V of Object.values(N.user.active_subs)){const H=N.plans?.[V.id];if(Array.isArray(H?.temporary_collections))for(const j of H.temporary_collections)P.sets[j]={plan_id:V.id,expires_at:V.expires_at?new Date(V.expires_at):null,next_bill_date:V.next_bill_date?new Date(V.next_bill_date):null}}return P}async getData(c,m,N=null,P=[]){if(this._data){if(!m&&(0,M.set_equals)(c,this._data_sets))return this._data;this._data=null,this._data_sets=null}let V;try{V=await this.apollo.client.query({query:D(),variables:{first:75,after:N,criteria:{filter:"ALL"}},fetchPolicy:m?"network-only":"cache-first"})}catch(he){return this.log.warn("Error fetching additional emote menu data.",he),this._data=null}const H={},j=(0,M.get)("data.currentUser.subscriptionBenefits.edges.@each.node",V),U=(0,M.get)("data.currentUser.subscriptionBenefits.pageInfo.hasNextPage",V),ee=(0,M.get)("data.currentUser.subscriptionBenefits.edges.@last.cursor",V);if(P=P.concat(j),U)return this.getData(c,m,ee,P);if(P&&P.length)for(const he of P){const Se=he&&he.product,Te=Se&&Se.emoteSetID;Te&&(H[Te]={ends:Z(he.endsAt),renews:Z(he.renewsAt),prime:he.purchasedWithPrime,set_id:Te,type:Se.type,gift:he.gift?.isGift})}return this._data_sets=c,this._data=H}};B(qe,"EmoteMenu");let ce=qe;ce.getData=(0,M.once)(ce.getData),ce.getFFZSubData=(0,M.once)(ce.getFFZSubData),ce.getFFZSubPrices=(0,M.once)(ce.getFFZSubPrices);const be=Intl.Collator(),ve=Intl.Collator(void 0,{sensitivity:"accent"}),Re=0,oe=1,ie=2,ae=3,xe=4;function ne(st){return st?st.type==="emote"?st.emoteName:st.type==="text"?st.text:Array.isArray(st.children)?st.children.map(ne).join(""):"":""}B(ne,"getNodeText");function we(st,c){let m=0,N=0,P=st;for(;N<c.length;){const V=c[N];for(let H=0;H<V;H++)m+=ne(P[H]).length;P=Array.isArray(P[V])?P[V]:P[V]?.children,N++}return m}B(we,"getNodeOffset");const it=class it extends x.default{constructor(...c){super(...c),this.inject("chat"),this.inject("chat.actions"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.inject("site"),this.settings.add("chat.hype.display-input",{default:!0,ui:{path:"Chat > Hype Chat >> Input",title:"Allow the Hype Chat button to appear in the chat input element.",component:"setting-check-box"}}),this.settings.add("chat.inline-preview.enabled",{default:!0,ui:{path:"Chat > Input >> Appearance",title:"Display in-line previews of FrankerFaceZ emotes when entering a chat message.",description:"**Note:** This feature is temperamental. It may not display all emotes, and emote effects and overlay emotes are not displayed correctly. Once this setting has been enabled, it cannot be reasonably disabled and will remain active until you refresh the page.",component:"setting-check-box"}}),this.settings.add("chat.mru.enabled",{default:!0,ui:{path:"Chat > Input >> Recent Messages",title:"Allow pressing up and down to recall previously sent chat messages.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.ffz-emotes",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of FrankerFaceZ emotes.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.emoji",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of emoji.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.emotes-without-colon",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of emotes without typing a colon. (:)",description:"This will prevent the tab-completion of usernames without the @ prefix.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.limit-results",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Limit tab-completion results to 25.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.prioritize-favorites",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Prioritize favorite emotes at the top.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.prioritize-prefix-matches",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Prioritize emotes that start with user input.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.matching",{default:1,ui:{path:"Chat > Input >> Tab Completion",title:"Emote Matching Type",description:"1: `ppa` would match `Kappa`\n\n2: `sip` would match `cohhSip` but not `Gossip`\n\n3: `pasta` would match `pastaThat` but not `HoldThat`",component:"setting-select-box",data:[{value:1,title:"1: Anything (Twitch style)"},{value:2,title:"2: Non-Prefix (Old FFZ style)"},{value:3,title:"3: Exact (Case-Insensitive)"}]}}),this.ChatInput=this.fine.define("chat-input",m=>m&&m.setLocalChatInputRef&&m.setLocalAutocompleteInputRef,p.Z.CHAT_ROUTES),this.EmoteSuggestions=this.fine.define("tab-emote-suggestions",m=>m&&m.getMatches&&m.autocompleteType==="emote",p.Z.CHAT_ROUTES),this.MentionSuggestions=this.fine.define("tab-mention-suggestions",m=>m&&m.getMentions&&m.renderMention,p.Z.CHAT_ROUTES),this.CommandSuggestions=this.fine.define("tab-cmd-suggestions",m=>m&&m.getMatches&&m.doesCommandMatchTerm,p.Z.CHAT_ROUTES),this.EmoteUsageCount={TriHard:196568036,Kappa:192158118,"4Head":155758710,PogChamp:151485090,cmonBruh:146352878,BibleThump:56472964,WutFace:45069031,Kreygasm:41387580,DansGame:38097659,SMOrc:34734484,KappaPride:34262839,VoHiYo:27886434,SwiftRage:24561900,ResidentSleeper:24438298,EleGiggle:19891526,FailFish:19118343,NotLikeThis:18802905,Keepo:18351415,BabyRage:18220906,MingLee:18026207,HeyGuys:14851569,ANELE:14648986,PJSalt:14438861}}async onEnable(){this.chat.context.on("changed:chat.hype.display-input",()=>this.ChatInput.forceUpdate()),this.chat.context.on("changed:chat.actions.room",()=>this.ChatInput.forceUpdate()),this.chat.context.on("changed:chat.actions.room-above",()=>this.ChatInput.forceUpdate()),this.chat.context.on("changed:chat.tab-complete.emotes-without-colon",P=>{for(const V of this.EmoteSuggestions.instances)V.canBeTriggeredByTab=P;for(const V of this.MentionSuggestions.instances)V.canBeTriggeredByTab=!P}),this.use_previews=this.chat.context.get("chat.inline-preview.enabled"),this.chat.context.on("changed:chat.inline-preview.enabled",P=>{if(!this.use_previews&&(this.use_previews=P,P))for(const V of this.ChatInput.instances)this.installPreviewObserver(V),V.ffzInjectEmotes(),V.forceUpdate(),this.emit("site:dom-update","chat-input",V)});const c=await this.site.findReact(),m=c&&c.createElement;if(!m)return this.log.warn("Unable to get React.");const N=this;this.ChatInput.ready((P,V)=>{const H=P.prototype.render;P.prototype.render=function(){const j=H.call(this);try{if(!N.chat.context.get("chat.hype.display-input")){const re=(0,C.findReactFragment)(j,Ce=>Ce.key==="paidPinnedMessage");re&&(re.type=()=>null)}const ee=N.chat.context.get("chat.actions.room-above"),he=N.chat.context.get("context.chat_state")||{},Se=ee?(0,C.findReactFragment)(j,re=>re.props&&Array.isArray(re.props.children)):(0,C.findReactFragment)(j,re=>re.props&&re.props.className==="chat-input__buttons-container");if(!Se||!Se.props||!Se.props.children)return j;const Te=this.props;if(!Te||!Te.channelID)return j;const Be=Te.sessionUser?{id:Te.sessionUser.id,login:Te.sessionUser.login,displayName:Te.sessionUser.displayName,mod:Te.isCurrentUserModerator,staff:Te.isStaff}:null,Y={id:Te.channelID,login:Te.channelLogin,displayName:Te.channelDisplayName,emoteOnly:Te.emoteOnlyMode,slowMode:Te.slowMode,slowDuration:Te.slowModeDuration,subsMode:Te.subsOnlyMode,r9kMode:he.r9k,followersOnly:he.followersOnly,followersDuration:he.followersOnlyRequirement},ge=N.actions.renderRoom(N.chat.context.get("context.chat.showModIcons"),Be,Y,ee,m);ee?Se.props.children.unshift(ge||null):Se.props.children.splice(1,0,ge||null)}catch(U){N.log.error(U),N.log.capture(U)}return j};for(const j of V)j.forceUpdate(),this.emit("site:dom-update","chat-input",j),this.updateEmoteCompletion(j),this.overrideChatInput(j),j.ffzInjectEmotes(),this.installPreviewObserver(j)}),this.EmoteSuggestions.ready((P,V)=>{for(const H of V)this.overrideEmoteMatcher(H)}),this.MentionSuggestions.ready((P,V)=>{for(const H of V)this.overrideMentionMatcher(H)}),this.CommandSuggestions.ready((P,V)=>{for(const H of V)this.overrideCommandMatcher(H)}),this.ChatInput.on("update",this.updateEmoteCompletion,this),this.ChatInput.on("mount",this.overrideChatInput,this),this.ChatInput.on("mount",this.installPreviewObserver,this),this.ChatInput.on("unmount",this.removePreviewObserver,this),this.EmoteSuggestions.on("mount",this.overrideEmoteMatcher,this),this.MentionSuggestions.on("mount",this.overrideMentionMatcher,this),this.CommandSuggestions.on("mount",this.overrideCommandMatcher,this),this.chat.context.on("changed:chat.emotes.animated",this.uncacheTabCompletion,this),this.chat.context.on("changed:chat.emotes.enabled",this.uncacheTabCompletion,this),this.chat.context.on("changed:chat.tab-complete.matching",this.uncacheTabCompletion,this),this.on("chat.emotes:change-hidden",this.uncacheTabCompletion,this),this.on("chat.emotes:change-set-hidden",this.uncacheTabCompletion,this),this.on("chat.emotes:change-favorite",this.uncacheTabCompletion,this),this.on("chat.emotes:update-default-sets",this.uncacheTabCompletion,this),this.on("chat.emotes:update-user-sets",this.uncacheTabCompletion,this),this.on("chat.emotes:update-room-sets",this.uncacheTabCompletion,this),this.on("site.css_tweaks:update-chat-css",this.resizeInput,this)}uncacheTabCompletion(){for(const c of this.EmoteSuggestions.instances)c.ffz_ffz_cache=null,c.ffz_twitch_cache=null;if(this.use_previews)for(const c of this.ChatInput.instances)c.ffzInjectEmotes(),c.forceUpdate(),this.emit("site:dom-update","chat-input",c)}updateInput(){for(const c of this.ChatInput.instances)c&&(c.forceUpdate(),this.emit("site:dom-update","chat-input",c))}resizeInput(){this._resize_waiter&&cancelAnimationFrame(this._resize_waiter),this._resize_waiter=requestAnimationFrame(()=>this._resizeInput())}_resizeInput(){this._resize_waiter=null;for(const c of this.ChatInput.instances)c.resizeInput()}installPreviewObserver(c){if(c._ffz_preview_observer||!window.MutationObserver||!this.use_previews)return;const m=this.fine.getHostNode(c),N=m&&m.querySelector(".chat-input__textarea");N&&(c._ffz_preview_observer=new MutationObserver(P=>{for(const V of P)for(const H of V.addedNodes)H instanceof Element&&this.checkForPreviews(c,H)}),c._ffz_preview_observer.observe(N,{childList:!0,subtree:!0}))}checkForPreviews(c,m){if(m.querySelector?.('span[data-a-target="chat-input-emote-preview"]'))for(const N of document.querySelectorAll(".tw-tooltip-layer img.chat-line__message--emote"))N&&N.src.startsWith("https://static-cdn.jtvnw.net/emoticons/v2/__FFZ__")&&this.updatePreview(c,N);for(const N of m.querySelectorAll?.("img.chat-line__message--emote"))N&&(N.dataset.ffzId||N.src.startsWith("https://static-cdn.jtvnw.net/emoticons/v2/__FFZ__"))&&this.updatePreview(c,N)}updatePreview(c,m){let N=m.dataset.ffzSet,P=m.dataset.ffzId;if(!P){const Se=m.src.indexOf("__FFZ__",49),Te=m.src.slice(49,Se),Be=Te.indexOf("::");if(Be===-1)return;N=Te.slice(0,Be),P=Te.slice(Be+2),m.dataset.ffzSet=N,m.dataset.ffzId=P}const V=this.emotes.emote_sets[N],H=V?.emotes?.[P];if(!H)return;const j=this.chat.context.get("chat.emotes.animated")>0;m.src=(j?H.animSrc:null)??H.src,m.srcset=(j?H.animSrcSet:null)??H.srcSet;const U=`${H.width}px`,ee=`${H.height}px`;m.style.width=U,m.style.height=ee;const he=m.closest(".chat-image__container");if(he){he.style.width=U,he.style.height=ee;const Se=he.closest(".chat-line__message--emote-button");Se&&(Se.style.width=U,Se.style.height=ee,Se._ffz_click_handler||(Se._ffz_click_handler=this.previewClick.bind(this,H.id,V.id,H.name),Se.addEventListener("click",Se._ffz_click_handler)))}}previewClick(c,m,N,P){const V=this.makeEvent({provider:"ffz",id:c,set:m,name:N,source:P});this.emit("chat.emotes:click",V),V.defaultPrevented&&(P.preventDefault(),P.stopImmediatePropagation())}removePreviewObserver(c){c._ffz_preview_observer&&(c._ffz_preview_observer.disconnect(),c._ffz_preview_observer=null)}updateEmoteCompletion(c,m){m||(m=this.fine.searchTree(c,"tab-emote-suggestions",50)),m&&(m._ffz_user=c.props.sessionUser,m._ffz_channel_id=c.props.channelID,m._ffz_channel_login=c.props.channelLogin)}overrideChatInput(c){if(c._ffz_override)return;const m=this,N=c.onKeyDown,P=c.onMessageSend,V=c.resizeInput,H=c.componentDidUpdate;c.ffzInjectEmotes=function(){const j=this.props.emotes.findIndex(ee=>ee?.id==="FrankerFaceZWasHere"),U=m.createFakeEmoteSet(c);if(j===-1&&U)this.props.emotes.push(U);else if(j!==-1&&U)this.props.emotes.splice(j,1,U);else if(j!==-1&&!U)this.props.emotes.splice(j,1);else return},c.componentDidUpdate=function(j,...U){try{j.emotes!==this.props.emotes&&Array.isArray(this.props.emotes)&&c.ffzInjectEmotes()}catch(ee){m.log.error("Error updating emote autocompletion data.",ee)}H&&H.call(this,j,...U)},c.resizeInput=function(j,...U){try{if(j){if(c.chatInputRef instanceof Element){const ee=getComputedStyle(c.chatInputRef),he=ee&&parseFloat(ee.lineHeight||18)||18,Se=he*1+20.5,Te=Math.ceil((c.chatInputRef.scrollHeight-Se)/he),Be=Math.min(1+Te,4);c.setState({numInputRows:Be})}}else c.setState({numInputRows:1})}catch(ee){return m.log.error("Error in resizeInput",ee),V.call(this,j,...U)}},c.messageHistory=[],c.tempInput="",c.messageHistoryPos=-1,c.ffzGetValue=function(){return c.chatInputRef&&typeof c.chatInputRef.value=="string"?c.chatInputRef.value:c.state.value&&typeof c.state.value=="string"?c.state.value:""},c.ffzGetSelection=function(){if(typeof c.chatInputRef?.selectionEnd=="number")return[c.chatInputRef.selectionStart,c.chatInputRef.selectionEnd];if(c.chatInputRef?.state?.slateEditor){const j=c.chatInputRef.state.slateEditor,U=j.selection,ee=j.children;if(!U?.anchor?.path||!U?.focus?.path)return[0,0];const he=we(ee,U.anchor.path)+U.anchor.offset,Se=we(ee,U.focus.path)+U.focus.offset;return he<Se?[he,Se]:[Se,he]}return[0,0]},c.ffzSetSelection=function(j,U){c.chatInputRef?.setSelectionRange&&c.chatInputRef.setSelectionRange(j,U)},c.onKeyDown=function(j){try{const U=j.charCode||j.keyCode;if(c.onEmotePickerToggle&&m.chat.context.get("chat.emote-menu.shortcut")&&j.key==="e"&&j.ctrlKey&&!j.altKey&&!j.shiftKey){c.onEmotePickerToggle(),j.preventDefault();return}const ee=c.ffzGetValue();if(c.autocompleteInputRef&&c.chatInputRef&&m.chat.context.get("chat.mru.enabled")&&!j.shiftKey&&!j.ctrlKey&&!j.altKey){const he=c.ffzGetSelection();if(U===38&&he[0]===0&&he[1]===0){if(!c.messageHistory.length)return;ee&&c.messageHistoryPos===-1&&(c.tempInput=ee),c.messageHistoryPos<c.messageHistory.length-1&&(c.messageHistoryPos++,c.autocompleteInputRef.setValue(c.messageHistory[c.messageHistoryPos]),c.ffzSetSelection(0));return}else if(U===40&&he[0]>=ee.length&&he[1]===he[0]){if(!c.messageHistory.length)return;c.messageHistoryPos>0?(c.messageHistoryPos--,c.autocompleteInputRef.setValue(c.messageHistory[c.messageHistoryPos]),c.ffzSetSelection(c.messageHistory[c.messageHistoryPos].length)):c.messageHistoryPos===0&&(c.autocompleteInputRef.setValue(c.tempInput),c.ffzSetSelection(c.tempInput.length),c.messageHistoryPos=-1);return}}U===I.KEYS.Escape&&!j.shiftKey&&!j.ctrlKey&&!j.altKey&&(c.props.isShowingEmotePicker?c.props.closeEmotePicker():c.props.tray&&(!c.state.value||!c.state.value.length)&&c.props.clearTray())}catch(U){m.log.capture(U),m.log.error(U)}N.call(this,j)},c.onMessageSend=function(j){try{if(m.chat.context.get("chat.mru.enabled")){const U=c.ffzGetValue();U&&U.length&&(!c.messageHistory.length||c.messageHistory[0]!==U)&&(c.messageHistory.unshift(U),c.messageHistory=c.messageHistory.slice(0,20)),c.messageHistoryPos=-1,c.tempInput=""}}catch(U){m.log.capture(U),m.log.error(U)}P.call(this,j)}}overrideMentionMatcher(c){c.canBeTriggeredByTab=!this.chat.context.get("chat.tab-complete.emotes-without-colon")}overrideCommandMatcher(c){if(c._ffz_override)return;c._ffz_override=!0,c.oldCommands=c.getCommands,c.oldMatches=c.getMatches,c.oldReplacement=c.determineReplacement;const m=this;c.getMatches=function(V,H,j){try{return j===0&&m.chat.CommandPrefixes.includes(V[0])?c.getCommands(V):null}catch(U){return m.log.error("Error getting matches from command handler.",U),c.oldCommands(V,H,j)}},c.getCommands=function(V){try{const H=c.props.getCommands(c.props.permissionLevel,{isEditor:c.props.isCurrentUserEditor}),j=m.fine.searchParent(c,Be=>Be?.props?.channelID&&Be?.props?.setTray,50),U=m.makeEvent({input:V,permissionLevel:c.props.permissionLevel,isEditor:c.props.isCurrentUserEditor,commands:H,__input:j,channel:j?{id:j.props.channelID,login:j.props.channelLogin}:null});if(m.emit("chat:get-tab-commands",U),!H||!H.length)return null;const ee=V[0],he=V.slice(1),Se=H.filter(Be=>ee===(Be.prefix??"/")&&c.doesCommandMatchTerm(Be,he)).sort(c.sortCommands),Te=[];for(const Be of Se){const Y=Be.commandArgs?.[0];let ge;Y?.isRequired&&(ge=`[${Y.name}]`),Te.push({current:V,replacement:c.determineReplacement(Be),description:Be.description,element:c.renderCommandSuggestion(Be,he),group:Be.ffz_group?Array.isArray(Be.ffz_group)?m.i18n.t(...Be.ffz_group):Be.ffz_group:c.determineGroup(Be),selection:ge})}return ee!=="/"&&!Te.length?null:Te}catch(H){return console.error(H),c.oldCommands(V)}},c.determineReplacement=function(V){const H=c.oldReplacement(V);return(V.prefix??"/")!=="/"&&H.startsWith("/")?V.prefix+H.slice(1):H};const N=this.site.getReact(),P=N?.createElement;P&&(c.renderCommandSuggestion=function(V,H){const j=Array.isArray(V?.commandArgs)?V.commandArgs.map(U=>P("div",{class:`tw-mg-r-05${U.isRequired?"":" tw-c-text-alt"}`},"[",U.name,"]")):null;return P("div",{class:"tw-pd-05"},P("div",{class:"tw-flex"},P("div",{class:"tw-mg-r-05"},P("span",null,V.prefix??"/"),P("span",{class:"tw-semibold"},V.name)),j),P("p",{class:"tw-c-text-alt-2 tw-font-size-7"},V.description))})}createFakeEmoteSet(c){if(!this.use_previews)return null;if(!c._ffz_channel_login){const U=this.fine.searchParent(c,"chat-input",50);U&&this.updateEmoteCompletion(U,c)}const m=c._ffz_user,N=c._ffz_channel_id,P=c._ffz_channel_login;if(!P)return null;const V=this.emotes.getSets(m?.id,m?.login,N,P);if(!V||!V.length)return null;const H=[],j=new Set;for(const U of V){if(!U||!U.emotes)continue;const ee=U.source||"ffz";for(const he of Object.values(U.emotes))!he||!he.id||!he.name||j.has(he.name)||(j.add(he.name),H.push({id:`__FFZ__${U.id}::${he.id}__FFZ__`,modifiers:null,setID:"FrankerFaceZWasHere",token:he.name}))}return{__typename:"EmoteSet",emotes:H,id:"FrankerFaceZWasHere",owner:null}}overrideEmoteMatcher(c){if(c._ffz_override)return;const m=this;c.canBeTriggeredByTab=this.chat.context.get("chat.tab-complete.emotes-without-colon"),c.getMatches=function(V,H){return H?V.length<2?null:c.getMatchedEmotes(V):V.startsWith(":")?V.length<3?null:c.getMatchedEmotes(V):null},c.doesEmoteMatchTerm=function(V,H){const j=V.name||V.token;if(!j)return Re;if(j.startsWith(H))return xe;let U=V.tokenLower;U||(U=j.toLowerCase());const ee=H.toLowerCase();if(U.startsWith(ee))return ae;const he=j.indexOf(H.charAt(0).toUpperCase());return he!==-1&&U.slice(he+1).startsWith(ee.slice(1))?ie:U.includes(ee)?oe:Re},c.getMatchedEmotes=function(V){const H=m.chat.context.get("chat.emotes.enabled"),j=m.chat.context.get("chat.tab-complete.limit-results");let U=H?m.getTwitchEmoteSuggestions(V,this):[];if(H>1&&m.chat.context.get("chat.tab-complete.ffz-emotes")){const ee=m.getEmoteSuggestions(V,this);Array.isArray(ee)&&ee.length&&(U=U.concat(ee))}if(m.chat.context.get("chat.tab-complete.emoji")){const ee=m.getEmojiSuggestions(V,this);Array.isArray(ee)&&ee.length&&(U=Array.isArray(U)?U.concat(ee):ee)}return U=m.sortEmotes(U),j&&U.length>25?U.slice(0,25):U};const N=this.site.getReact(),P=N?.createElement;c.renderFFZEmojiSuggestion=function(V){return P(N.Fragment,null,P("div",{class:"tw-relative tw-flex-shrink-0 tw-pd-05",title:V.token,favorite:V.favorite},P("img",{class:"emote-autocomplete-provider__image ffz-emoji",src:V.src,srcSet:V.srcset}),V.favorite&&P("figure",{class:"ffz--favorite ffz-i-star"})),P("div",{class:"tw-ellipsis",title:V.token},V.token))},c.renderEmoteSuggestion=function(V){return P(N.Fragment,null,P("div",{class:"tw-relative tw-flex-shrink-0 tw-pd-05",title:V.token,favorite:V.favorite},P("img",{class:"emote-autocomplete-provider__image",srcSet:V.srcSet}),V.favorite&&P("figure",{class:"ffz--favorite ffz-i-star"})),P("div",{class:"tw-ellipsis",title:V.token},V.token))}}sortEmotes(c){const m=this.chat.context.get("chat.tab-complete.prioritize-favorites"),N=this.chat.context.get("chat.tab-complete.emotes-without-colon"),P=this.chat.context.get("chat.tab-complete.prioritize-prefix-matches");return c.sort((V,H)=>{const j=V.matched||V.replacement,U=H.matched||H.replacement;if(m&&V.favorite^H.favorite)return 0-V.favorite+H.favorite;if(P){const ee=!!V.matched,he=!!H.matched;if(ee^he)return N?0-ee+he:0-he+ee;const Se=V.match_type===xe,Te=H.match_type===xe;if(Se&&Te)return be.compare(j,U);if(Se)return-1;if(Te)return 1;const Be=V.match_type===ae,Y=H.match_type===ae;return Be&&Y?ve.compare(j,U):Be?-1:Y?1:be.compare(j,U)}return 0})}buildTwitchCache(c){if(!Array.isArray(c))return{emotes:[],length:0};const m=[],N=new Set,P=this.chat.context.get("chat.emotes.animated")>0,V=this.settings.provider.get("emote-menu.hidden-sets"),H=Array.isArray(V)&&V.length>0,j=this.emotes.getHidden("twitch"),U=this.emotes.getFavorites("twitch");for(const ee of c){const he=parseInt(ee.id,10),Se=ee.owner,Te=I.TWITCH_POINTS_SETS.includes(he)||Se?.login==="channel_points",Be=Te?null:Se;if(ee.id==="FrankerFaceZWasHere")continue;let Y=`twitch-set-${ee.id}`,ge=null;if(Be?.login?(Y=`twitch-${Be.id}`,ge=Be.displayName||Be.login):Te?Y="twitch-points":I.TWITCH_GLOBAL_SETS.includes(he)?Y="twitch-global":I.TWITCH_PRIME_SETS.includes(he)?Y="twitch-prime":Y="twitch-misc",!(H&&V.includes(Y)))for(const re of ee.emotes){if(!re||!re.id||j.includes(re.id))continue;const Ce=re.id,Ne=I.KNOWN_CODES[re.token]||re.token;if(!Ne||N.has(Ne))continue;N.add(Ne);const We=I.REPLACEMENTS[Ce];let Xe;We&&this.chat.context.get("chat.fix-bad-emotes")?Xe=`${I.REPLACEMENT_BASE}${We} 1x`:Xe=(0,M.getTwitchEmoteSrcSet)(Ce,P),m.push({id:Ce,source:Y,extra:ge,setID:ee.id,token:Ne,tokenLower:Ne.toLowerCase(),srcSet:Xe,favorite:U.includes(Ce)})}}return{emotes:m,length:c.length}}getTwitchEmoteSuggestions(c,m){m.ffz_twitch_cache?.length!==m.props.emotes?.length&&(m.ffz_twitch_cache=this.buildTwitchCache(m.props.emotes));const N=this.chat.context.get("chat.tab-complete.matching"),P=m.ffz_twitch_cache.emotes;if(!P.length)return[];const V=[],H=[],j=[],U=c.startsWith(":")?c.slice(1):c;for(const ee of P){const he=m.doesEmoteMatchTerm(ee,U);if(he<N)continue;const Se={current:c,emote:ee,replacement:ee.token,element:m.renderEmoteSuggestion(ee),favorite:ee.favorite,count:this.EmoteUsageCount[ee.token]||0,match_type:he};he<N||(Se.count>0?V.push(Se):he>ie?H.push(Se):j.push(Se))}return V.sort((ee,he)=>he.count-ee.count),H.sort((ee,he)=>be.compare(ee.replacement,he.replacement)),j.sort((ee,he)=>be.compare(ee.replacement,he.replacement)),V.concat(H).concat(j)}getEmojiSuggestions(c,m){if(!c.startsWith(":"))return[];let N=c.slice(1).toLowerCase();const P=this.chat.context.get("chat.emoji.style"),V=this.settings.provider.get("emoji-tone",null),H=this.emotes.getFavorites("emoji"),j=[],U=N.endsWith(":");U&&(N=N.slice(0,-1));const ee=new Set;for(const he in this.emoji.names)if(U?he===N:he.startsWith(N)){const Se=this.emoji.emoji[this.emoji.names[he]],Te=Se.variants&&Se.variants[V],Be=Te||Se;if(Se&&(P===0||Be.has[P])&&!ee.has(Be.raw)){ee.add(Be.raw);const Y=this.emoji.getFullImageSet(Be.image,P),ge=`:${he}:`,re=H.includes(Se.code);j.push({current:c,emoji:Be,matched:ge,srcSet:Y,replacement:Be.raw,element:m.renderFFZEmojiSuggestion({token:ge,id:`emoji-${Se.code}`,src:this.emoji.getFullImage(Be.image,P),srcSet:Y,favorite:re}),favorite:re})}}return j}buildFFZCache(c,m,N,P){const V=this.emotes.getSets(c,m,N,P);if(!V||!V.length)return{emotes:[],length:0,user_id:c,user_login:m,channel_id:N,channel_login:P};const H=[],j=this.chat.context.get("chat.emotes.animated")>0,U=this.settings.provider.get("emote-menu.hidden-sets"),ee=Array.isArray(U)&&U.length>0,he=new Set;for(const Se of V){if(!Se||!Se.emotes)continue;const Te=Se.source||"ffz",Be=Se.source_line||`${Se.source||"FFZ"} ${Se.title||"Global"}`,Y=`${Se.merge_source||Te}-${Se.merge_id||Se.id}`;if(ee&&U.includes(Y))continue;const ge=this.emotes.getHidden(Te),re=this.emotes.getFavorites(Te);for(const Ce of Object.values(Se.emotes))!Ce||!Ce.id||Ce.hidden||ge.includes(Ce.id)||he.has(Ce.name)||Ce.name&&(he.add(Ce.name),H.push({id:`${Te}-${Ce.id}`,source:Te,extra:Be,token:Ce.name,tokenLower:Ce.name.toLowerCase(),srcSet:j&&Ce.animSrcSet||Ce.srcSet,favorite:re.includes(Ce.id)}))}return{emotes:H,length:V.length}}getEmoteSuggestions(c,m){if(!m._ffz_channel_login){const Se=this.fine.searchParent(m,"chat-input",50);Se&&this.updateEmoteCompletion(Se,m)}const N=this.chat.context.get("chat.tab-complete.matching"),P=m._ffz_user,V=m._ffz_channel_id,H=m._ffz_channel_login;if(!H)return[];let j=m.ffz_ffz_cache;(!j||j.user_id!==P?.id||j.user_login!==P?.login||j.channel_id!==V||j.channel_login!==H)&&(j=m.ffz_ffz_cache=this.buildFFZCache(P?.id,P?.login,V,H));const U=j.emotes;if(!U.length)return[];const ee=c.startsWith(":")?c.slice(1):c,he=[];for(const Se of U){const Te=m.doesEmoteMatchTerm(Se,ee);Te<N||he.push({current:c,emote:Se,replacement:Se.token,element:m.renderEmoteSuggestion(Se),favorite:Se.favorite,count:0,match_type:Te})}return he}getInput(){for(const c of this.ChatInput.instances)if(!(!c.autocompleteInputRef||!c.state)&&c.state.value)return c.state.value;return null}pasteMessage(c,m){for(const N of this.ChatInput.instances)if(N?.props?.channelLogin===c){if(!N.autocompleteInputRef||!N.state)return;N.state.value&&(m=`${N.state.value} ${m}`),N.autocompleteInputRef.setValue(m),N.autocompleteInputRef.componentRef?.focus?.()}}};B(it,"Input");let ze=it;const xt=class xt extends x.default{constructor(...c){super(...c),this.inject("chat"),this.inject("settings"),this.inject("site.css_tweaks"),this.inject("site.fine"),this.last_login=null,this.settings.add("chat.viewer-cards.highlight-chat",{default:!1,ui:{path:"Chat > Viewer Cards >> Appearance",title:"Highlight messages from users with open viewer cards.",component:"setting-check-box"}}),this.settings.add("chat.viewer-cards.color",{default:"",ui:{path:"Chat > Viewer Cards >> Appearance",title:"Highlight Color",component:"setting-color-box"}}),this.settings.add("chat.viewer-cards.use-color",{requires:["chat.viewer-cards.highlight-chat","chat.viewer-cards.color"],process(m){if(m.get("chat.viewer-cards.highlight-chat"))return m.get("chat.viewer-cards.color")}}),this.ViewerCard=this.fine.define("chat-viewer-card",m=>m.props?.targetLogin&&m.props?.hideViewerCard)}onEnable(){this.chat.context.on("changed:chat.viewer-cards.highlight-chat",this.refreshStyle,this),this.chat.context.on("changed:chat.viewer-cards.color",this.refreshStyle,this),this.on("..:update-colors",this.refreshStyle,this),this.ViewerCard.on("mount",this.updateCard,this),this.ViewerCard.on("update",this.updateCard,this),this.ViewerCard.on("unmount",this.unmountCard,this)}refreshStyle(){this.updateStyle(this.last_login)}updateStyle(c){if(typeof c=="string"&&(c=c.toLowerCase()),this.last_login=c,c&&this.chat.context.get("chat.viewer-cards.highlight-chat")){let m=this.chat.context.get("chat.viewer-cards.color");m&&m.length?m=this.parent.inverse_colors.process(m):this.chat.context.get("theme.is-dark")?m="rgba(0,80,255,0.2)":m="rgba(128,170,255,0.2)",this.css_tweaks.set("viewer-card-highlight",`
body .chat-room .chat-scrollable-area__message-container > div:nth-child(1n+0) > .chat-line__message:not(.chat-line--inline):not(.something-nonexistent)[data-user="${c}"],
body .chat-room .chat-line__message:not(.chat-line--inline):nth-child(1n+0)[data-user="${c}"] {
	background-color: ${m} !important;
}`)}else this.css_tweaks.delete("viewer-card-highlight")}updateCard(c){this.updateStyle(c.props&&c.props.targetLogin)}unmountCard(){this.updateStyle()}};B(xt,"ViewerCards");let Me=xt;const Pe=(0,M.make_enum)("Post","Action"),Le=(0,M.make_enum)("Ban","Timeout","Delete"),Ge=(0,M.make_enum)("MessageRejectedPrompt","CheerMessageRejectedPrompt","MessageRejected","MessageAllowed","MessageDenied","CheerMessageDenied","CheerMessageTimeout","MessageModApproved","MessageModDenied"),Ye=["Message","Notice","Moderation","ModerationAction","TargetedModerationAction","AutoMod","SubscriberOnlyMode","FollowerOnlyMode","SlowMode","EmoteOnlyMode","R9KMode","Connected","Disconnected","Reconnect","RoomMods","RoomState","BadgesUpdated"],Ke=(0,M.make_enum)("Message","ExtensionMessage","Moderation","ModerationAction","TargetedModerationAction","AutoMod","SubscriberOnlyMode","FollowerOnlyMode","SlowMode","EmoteOnlyMode","R9KMode","Connected","Disconnected","Reconnect","Subscription","Resubscription","GiftPaidUpgrade","AnonGiftPaidUpgrade","PrimePaidUpgrade","PrimeCommunityGiftReceivedEvent","ExtendSubscription","SubGift","AnonSubGift","Clear","RoomMods","RoomState","Raid","Unraid","Notice","Info","BadgesUpdated","Purchase","BitsCharity","CrateGift","RewardGift","SubMysteryGift","AnonSubMysteryGift","StandardPayForward","CommunityPayForward","FirstCheerMessage","FirstMessageHighlight","BitsBadgeTierMessage","InlinePrivateCallout","ChannelPointsReward","CommunityChallengeContribution","LiveMessageSeparator","RestrictedLowTrustUserMessage","CommunityIntroduction","Shoutout","AnnouncementMessage","CharityDonation","MessageIdUpdate","ViewerMilestone","GigantifiedEmote"),ht=["Reconnect","RoomState","BadgesUpdated","Clear"],wt={pinned_re_sub:"share-resub",community_points_reward:"community-points-rewards",clip_live_nudge_chat_trigger:"clip-live-nudge",cheer_badge_grant:"bits-badge-tier"},zt={AppointedModerator:"appointed-moderator",BitsBadgeTier:"bits-badge-tier",BitsPowerUps:"bits-power-ups",ClipLiveNudge:"clip-live-nudge",CommunityMoment:"community-moment",CommunityPointsRewards:"community-points-rewards",CosmicAbyss:"cosmic-abyss",CreatorAnniversaries:"creator-anniversaries",Drop:"drop",EarnedSubBadge:"earned-sub-badge",FavoritedGuestCollab:"favorited-guest-collab",GiftBadgeExpiration:"gift-badge-expiration",GiftBadgeRestored:"gift-badge-restored",GiftBundleUpSell:"gift-bundle-up-sell",HypeTrainRewards:"hype-train-rewards",LapsedBitsUser:"lapsed-bits-user",PartnerPlusUpSellNudge:"partner-plus-up-sell-nudge",ReplyByKeyboard:"reply-by-keyboard",RequestToJoinAccepted:"request-to-join-accepted",STPromo:"st-promo",ShareResub:"share-resub",SubtemberPromoBits:"subtember-promo-bits",ThankSubGifter:"thank-sub-gifter",TurnOffAnimatedEmotes:"turn-off-animated-emotes",WalletDrop:"wallet-drop"},Ht=[],Wt=["onBadgesUpdatedEvent"],Kt=class Kt extends x.default{constructor(...c){super(...c),this.should_enable=!0,this.shared_room_data=new Map,this.shared_rooms={},this.colors=new K.ColorAdjuster,this.inverse_colors=new K.ColorAdjuster,this.inject("settings"),this.inject("i18n"),this.inject("experiments"),this.inject("site"),this.inject("site.router"),this.inject("site.fine"),this.inject("site.web_munch"),this.inject("site.css_tweaks"),this.inject("site.subpump"),this.inject("chat"),this.inject(d),this.inject(A),this.inject(a),this.inject(ce),this.inject(ze),this.inject(Me),this.ChatLeaderboard=this.fine.define("chat-leaderboard",m=>m.props?.topItems&&(0,M.has)(m.props,"forceMiniView")&&(0,M.has)(m.props,"leaderboardType"),p.Z.CHAT_ROUTES),this.ChatService=this.fine.define("chat-service",m=>m.join&&m.client&&m.props.setChatConnectionAPI,p.Z.CHAT_ROUTES),this.ChatBuffer=this.fine.define("chat-buffer",m=>m.updateHandlers&&m.delayedMessageBuffer&&m.handleMessage,p.Z.CHAT_ROUTES),this.ChatController=this.fine.define("chat-controller",m=>m.parseOutgoingMessage&&m.onRoomStateUpdated&&m.renderNotifications,p.Z.CHAT_ROUTES),this.ChatRenderer=this.fine.define("chat-renderer",m=>m.mapMessagesToChatLines&&m.reportChatRenderSent,p.Z.CHAT_ROUTES),this.ChatContainer=this.fine.define("chat-container",m=>m.closeViewersList&&m.onChatInputFocus,p.Z.CHAT_ROUTES),this.ChatBufferConnector=this.fine.define("chat-buffer-connector",m=>m.clearBufferHandle&&m.syncBufferedMessages,p.Z.CHAT_ROUTES),this.joined_raids=new Set,this.RaidController=this.fine.define("raid-controller",m=>m.handleLeaveRaid&&m.handleJoinRaid,p.Z.CHAT_ROUTES),this.InlineCallout=this.fine.define("inline-callout",m=>m.showCTA&&m.toggleContextMenu&&m.actionClick,p.Z.CHAT_ROUTES),this.PinnedCallout=this.fine.define("pinned-callout",m=>m.getCalloutTitle&&m.buildCalloutProps&&m.pin,p.Z.CHAT_ROUTES),this.CalloutSelector=this.fine.define("callout-selector",m=>m.selectCalloutComponent&&m.props&&(0,M.has)(m.props,"callouts"),p.Z.CHAT_ROUTES),this.PointsButton=this.fine.define("points-button",m=>m.renderIcon&&m.renderFlame&&m.handleIconAnimationComplete,p.Z.CHAT_ROUTES),this.PointsClaimButton=this.fine.define("points-claim-button",m=>m.getClaim&&m.onClick&&m.props&&m.props.claimCommunityPoints,p.Z.CHAT_ROUTES),this.CommunityChestBanner=this.fine.define("community-chest-banner",m=>m.getLastGifterText&&m.getBannerText&&(0,M.has)(m,"finalCount"),p.Z.CHAT_ROUTES),this.PointsInfo=this.fine.define("points-info",m=>m.pointIcon!==void 0&&m.pointName!==void 0,p.Z.CHAT_ROUTES),this.GiftBanner=this.fine.define("gift-banner",m=>m.getBannerText&&m.onGiftMoreClick,p.Z.CHAT_ROUTES),this.settings.add("chat.subs.native",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display subscription notices using Twitch's native UI.",component:"setting-check-box"}}),this.settings.add("chat.filtering.show-reasons",{default:!1,ui:{path:"Chat > Filtering > General >> Appearance",title:"Display Reasons",description:"If this is enabled, the reasons a given message was highlighted will be displayed alongside the message. This is a simple display. Enable the debugging option below in Behavior for more details, but be aware that the debugging option has a slight performance impact compared to this.",component:"setting-select-box",data:[{value:!1,title:"Disabled"},{value:1,title:"Above Message"},{value:2,title:"Inline"}]}}),this.settings.add("chat.disable-handling",{default:null,requires:["context.disable-chat-processing"],process(m,N){return N!=null?!N:!!m.get("context.disable-chat-processing")},ui:{path:"Debugging > Chat >> Processing",title:"Enable processing of chat messages.",component:"setting-check-box",force_seen:!0}}),this.settings.addUI("debug.chat-test",{path:"Debugging > Chat >> Chat",component:"chat-tester",getChat:()=>this,force_seen:!0}),this.settings.add("chat.filtering.blocked-callouts",{default:[],type:"array_merge",always_inherit:!0,process:(m,N)=>{const P=new Set,V=this.callout_types??zt;for(const H of N)H?.v&&V[H.v]&&!Ht.includes(H.v)&&P.add(V[H.v]);return P},ui:{path:'Chat > Filtering > Block >> Callout Types @{"description":"This filter allows you to remove callouts of specific types from Twitch chat. Callouts are special messages that can be pinned to the bottom of chat and often have associated actions, like claiming a drop or sharing your resubscription."}',component:"blocked-types",data:()=>Object.keys(this.callout_types).filter(m=>!Ht.includes(m)).sort()}}),this.settings.add("chat.filtering.blocked-types",{default:[],type:"array_merge",always_inherit:!0,process(m,N){const P=new Set;for(const V of N)V?.v&&!Ye.includes(V.v)&&P.add(V.v);return P},ui:{path:'Chat > Filtering > Block >> Message Types @{"description":"This filter allows you to remove all messages of a certain type from Twitch chat. It can be used to filter system messages, such as Hosts or Raids. Some types, such as moderation actions, cannot be blocked to prevent chat functionality from breaking."}',component:"blocked-types",data:()=>Object.keys(this.chat_types).filter(m=>!Ye.includes(m)&&!/^\d+$/.test(m)).sort()}}),this.settings.add("chat.replies.style",{default:1,ui:{path:"Chat > Appearance >> Replies",title:"Style",description:"Twitch's default style adds a floating button to the right and displays a notice above messages that are replies. FrankerFaceZ uses an In-Line Chat Action (that can be removed in [Chat > Actions > In-Line](~chat.actions.in_line)) and uses an in-line mention to denote replies.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch (Default)"},{value:2,title:"FrankerFaceZ"}]}}),this.settings.add("channel.raids.no-autojoin",{default:!1,ui:{path:"Channel > Behavior >> Raids",title:"Do not automatically join raids.",component:"setting-check-box"}}),this.settings.add("chat.powerup.effects",{default:!0,ui:{path:"Chat > Appearance >> Community",title:'Allow "Message Effects" messages to appear in chat.',component:"setting-check-box",description:"*Note*: Only affects messages sent after you change this setting. You can use your own chat for testing."}}),this.settings.add("channel.raids.blocked-channels",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Channel > Behavior >> Raids: Blocked Channels @{"description": "You will not automatically join raids to channels listed here."}',component:"basic-terms",words:!1}}),this.settings.add("__filter:channel.raids.blocked-channels",{requires:["channel.raids.blocked-channels"],equals:"requirements",process(m){const N=m.get("channel.raids.blocked-channels");if(!N||!N.length)return null;const P=[];for(const V of N){const H=V.t;let j=V.v;H==="glob"?j=(0,M.glob_to_regex)(j):H!=="raw"&&(j=(0,M.escape_regex)(j)),!(!j||!j.length)&&P.push(j)}return P.length?new RegExp(`^(?:${P.join("|")})$`,"gi"):null}}),this.settings.add("chat.hide-community-highlights",{default:!1,ui:{path:"Chat > Appearance >> Community",title:"Hide all Community Highlights from the top of chat.",component:"setting-check-box",description:"Community Highlights are polls, community gift subs, etc. that float over the top of chat temporarily with no way to close them."}}),this.settings.add("chat.subs.gift-banner",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Display a banner at the top of chat when a mass gift sub happens.",component:"setting-check-box"}}),this.settings.add("chat.banners.last-events",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow the Support Activity Feed to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.charity",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow the charity fundraiser progress to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.hide-appleplus",{default:!1,ui:{path:"Chat > Appearance >> Community",title:"Hide the drop notification for getting AppleTV+ when you buy a subscription.",component:"setting-check-box",description:`**Note:** Normally, I wouldn't add something that directly affects an advertisement like this, but Twitch broke the "Don't show again" checkbox, so it's up to us to fix it.`}}),this.settings.add("chat.banners.hype-train",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow the Hype Train to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.shared-chat",{default:!0,ui:{path:"Chat > Shared Chat >> Behavior",title:"Allow the Shared Chat notice to be displayed in chat when a Shared Chat is enabled.",component:"setting-check-box"}}),this.settings.add("chat.banners.pinned-message",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow Pinned Messages to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.drops",{default:!0,ui:{path:"Chat > Drops >> Appearance",title:"Allow messages about Drops to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.polls",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow Polls to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.prediction",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow Predictions to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.callouts.clip",{default:!0,ui:{path:"Chat > Appearance >> Community",title:'Allow the "Chat seems active." clip suggestion to be displayed in chat.',component:"setting-check-box"}}),this.settings.add("chat.community-chest.show",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Display the Community Gift Chest banner.",component:"setting-check-box"}}),this.settings.add("chat.points.allow-highlight",{default:2,ui:{path:"Chat > Channel Points >> Appearance",title:"Highlight the message in chat when someone redeems Highlight My Message.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch Style"},{value:2,title:"FFZ Style"}]}}),this.settings.add("chat.points.show-callouts",{default:!0,ui:{path:"Chat > Channel Points >> General",title:"Display messages in chat about Channel Points rewards.",component:"setting-check-box"}}),this.settings.add("chat.points.show-button",{default:!0,ui:{path:"Chat > Channel Points >> General",title:"Display Channel Points button beneath chat.",component:"setting-check-box"}}),this.settings.add("chat.points.show-rewards",{default:!0,requires:["layout.portrait-min-chat"],process(m,N){return m.get("layout.portrait-min-chat")?!1:N},ui:{path:"Chat > Channel Points >> Behavior",title:"Allow available rewards to appear next to the Channel Points button.",component:"setting-check-box"}}),this.settings.add("chat.points.auto-rewards",{default:!1,ui:{path:"Chat > Channel Points >> Behavior",title:"Automatically claim bonus rewards.",component:"setting-check-box",force_seen:!0}}),this.settings.add("chat.drops.auto-rewards",{default:!1,ui:{path:"Chat > Drops >> Behavior",title:"Automatically claim drops.",component:"setting-check-box"}}),this.settings.add("chat.pin-resubs",{default:!1,ui:{path:"Chat > Behavior >> General",title:"Automatically pin re-subscription messages in chat.",component:"setting-check-box"}}),this.settings.add("chat.shared-chat.style",{default:null,ui:{path:"Chat > Shared Chat >> Appearance",title:"Pill Style",component:"setting-select-box",description:"This controls the appearance of the pill at the left-side of chat messages when a message is part of a Shared Chat. By default, this is Avatar for moderators and broadcasters and Hidden for everyone else.",data:[{value:null,title:"Automatic"},{value:0,title:"Hidden"},{value:1,title:"Channel Name"},{value:2,title:"Avatar"}]}}),this.settings.add("chat.shared-chat.username-tooltip",{default:!0,ui:{path:"Chat > Shared Chat >> Appearance",component:"setting-check-box",title:"Display the source channel of a chat message when hovering over the poster's username."}}),this.settings.add("chat.width",{default:null,ui:{path:'Chat > Appearance >> General @{"sort": -1}',title:"Width",description:"How wide chat should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process(m){return m=parseInt(m,10),isNaN(m)||!isFinite(m)||m<=0?null:m}}}),this.settings.add("chat.effective-width",{requires:["chat.width","context.ui.rightColumnWidth"],process(m){const N=m.get("chat.width");return N??(m.get("context.ui.rightColumnWidth")||340)}}),this.settings.add("chat.use-width",{requires:["chat.width","context.ui.rightColumnExpanded","context.isWatchParty"],process(m){return!m.get("context.ui.rightColumnExpanded")||m.get("context.isWatchParty")?!1:m.get("chat.width")!=null}}),this.settings.add("chat.bits.show-pinned",{requires:["chat.bits.show"],default:null,process(m,N){return N??m.get("chat.bits.show")},ui:{path:"Chat > Appearance >> Community",title:"Display Leaderboard",description:`The leaderboard shows the top cheerers and sub gifters in a channel.

By default due to a previous implementation, this inherits its value from [Chat > Bits and Cheering > Display Bits](~chat.bits_and_cheering).`,component:"setting-check-box"}}),this.settings.add("chat.bits.show-rewards",{requires:["chat.bits.show"],default:null,process(m,N){return N??m.get("chat.bits.show")},ui:{path:"Chat > Bits and Cheering >> Behavior",title:"Display messages when a cheer shares rewards to people in chat.",description:"By default, this inherits its value from Display Bits. This setting only affects newly arrived messages.",component:"setting-check-box"}}),this.settings.add("chat.bits.cheer-notice",{default:!0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Display a notice on chat messages that include cheers.",description:"This feature is intended to prevent possible confusion from chatters using emotes to fake cheers in messages. When enabled, messages that contain real cheers will display a message above them, similar to how resubscription messages or point redemptions with messages function.",component:"setting-check-box"}}),this.settings.add("chat.rituals.show",{default:!0,ui:{path:"Chat > Filtering > General >> Rituals",title:'Display ritual messages such as "User is new here! Say Hello!".',component:"setting-check-box"}}),this.settings.add("chat.extra-timestamps",{default:!0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Display timestamps on notices.",description:"When enabled, timestamps will be displayed on point redemptions, subscriptions, etc.",component:"setting-check-box"}}),this.settings.add("chat.hype.message-style",{default:1,ui:{path:"Chat > Hype Chat >> Appearance",title:"Hype Chat Style",component:"setting-select-box",description:"**Note**: Hype Chats that include messages will always have their messages displayed, regardless of setting. Changes made to this setting may not affect existing chat messages.",data:[{value:0,title:"Do Not Display"},{value:1,title:"Standard Twitch (Large, Colored, Limited FFZ Support)"},{value:2,title:"Minimal (Marked with System Message, No Colors)"}]}}),this.settings.add("chat.subs.show",{default:3,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display Subs in Chat",component:"setting-select-box",description:'**Note**: Messages sent with re-subs will always be displayed. This only controls the special "X subscribed!" message.',data:[{value:0,title:"Do Not Display"},{value:1,title:"Re-Subs with Messages Only"},{value:2,title:"Re-Subs Only"},{value:3,title:"Display All"}]}}),this.settings.add("chat.subs.compact",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display subscription notices in a more compact (classic style) form.",component:"setting-check-box"}}),this.settings.add("chat.subs.merge-gifts",{default:1e3,ui:{path:"Chat > Appearance >> Subscriptions",title:"Merge Mass Sub Gifts",component:"setting-select-box",data:[{value:1e3,title:"Disabled"},{value:50,title:"More than 50"},{value:20,title:"More than 20"},{value:10,title:"More than 10"},{value:5,title:"More than 5"},{value:0,title:"Always"}],description:`Merge mass gift subscriptions into a single message, depending on the quantity.
**Note:** Only affects newly gifted subs.`}}),this.settings.add("chat.subs.merge-gifts-visibility",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Expand merged mass sub gift messages by default.",component:"setting-check-box"}}),this.settings.add("chat.lines.alternate",{default:!1,ui:{path:"Chat > Appearance >> Chat Lines",title:"Display lines with alternating background colors.",component:"setting-check-box"}}),this.settings.add("chat.lines.padding",{default:!1,ui:{path:"Chat > Appearance >> Chat Lines",title:"Reduce padding around lines.",component:"setting-check-box"}}),this.settings.add("chat.lines.borders",{default:0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Separators",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Basic Line (1px Solid)"},{value:2,title:"3D Line (2px Groove)"},{value:3,title:"3D Line (2px Groove Inset)"},{value:4,title:"Wide Line (2px Solid)"}]}}),this.settings.add("chat.input.show-mod-view",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Mod View" button to appear in relevant channels.',component:"setting-check-box"}}),this.settings.add("chat.input.show-highlight",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Chat Highlight Settings" button to appear in relevant channels.',component:"setting-check-box"}}),this.settings.add("chat.input.show-shield",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Shield Mode" button to appear in relevant channels.',component:"setting-check-box"}}),this.settings.add("chat.input.show-elevate-your-message",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Elevate Your Message" button to be displayed.',component:"setting-check-box"}})}get currentChat(){for(const c of this.ChatController.instances)if(c&&c.chatService)return c;return null}updateColors(){const c=this.chat.context.get("theme.is-dark"),m=this.chat.context.get("chat.adjustment-mode"),N=this.chat.context.get("chat.adjustment-contrast"),P=this.colors,V=this.inverse_colors;let H=c,j=K.Color.RGBA.fromCSS(this.chat.context.get("theme.color.chat-background")||this.chat.context.get("theme.color.background"));j&&(H=j.toHSLA().l<.5),j=H?"#191919":"#E0E0E0";let U=!H,ee=K.Color.RGBA.fromCSS(this.chat.context.get("theme.color.chat-text")||this.chat.context.get("theme.color.text"));ee&&(U=ee.toHSLA().l<.5),ee=U?"#19171c":"#dad8de",P._base=j,P.mode=m,P.contrast=N,V._base=ee,V.mode=m,V.contrast=N,this.chat_line.rerenderLines(),this.updateMentionCSS(),this.emit(":update-colors")}updateChatCSS(){this._update_css_waiter||(this._update_css_waiter=requestAnimationFrame(()=>this._updateChatCSS()))}_updateChatCSS(){cancelAnimationFrame(this._update_css_waiter),this._update_css_waiter=null;const c=this.chat.context.get("chat.effective-width"),m=this.chat.context.get("chat.actions.size"),N=this.chat.context.get("chat.actions.hover-size"),P=this.chat.context.get("chat.timestamp-size"),V=this.chat.context.get("chat.font-size"),H=this.chat.context.get("chat.lines.emote-alignment"),j=Math.round(20/12*V),U=Math.round(N*(2/3)),ee=N-U;let he=this.chat.context.get("chat.font-family")||"inherit";const[Se,Te]=(0,O.jo)(he);he=Se,this._font_unloader&&this._font_unloader(),this._font_unloader=Te,he.indexOf(" ")!==-1&&he.indexOf(",")===-1&&he.indexOf('"')===-1&&he.indexOf("'")===-1&&(he=`"${he}"`),P?this.css_tweaks.set("ts-size",`.chat-line__timestamp{font-size:${P/10}rem}`):this.css_tweaks.delete("ts-size"),this.css_tweaks.setVariable("chat-actions-size",`${m/10}rem`),this.css_tweaks.setVariable("chat-actions-hover-size",`${U/10}rem`),this.css_tweaks.setVariable("chat-actions-hover-padding",`${ee/20}rem`),this.css_tweaks.setVariable("chat-font-size",`${V/10}rem`),this.css_tweaks.setVariable("chat-line-height",`${j/10}rem`),this.css_tweaks.setVariable("chat-font-family",he),this.css_tweaks.setVariable("chat-width",`${c/10}rem`),this.css_tweaks.setVariable("negative-chat-width",`${-c/10}rem`),this.css_tweaks.toggle("chat-font",V!==13||he!=="inherit"),this.css_tweaks.toggle("chat-width",this.settings.get("chat.use-width")),this.css_tweaks.toggle("chat-fix--watch-party",this.settings.get("context.isWatchParty")),this.css_tweaks.toggle("emote-alignment-padded",H===1),this.css_tweaks.toggle("emote-alignment-baseline",H===2),this.emit(":update-chat-css"),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}updateLineBorders(){const c=this.chat.context.get("chat.lines.borders");this.css_tweaks.toggle("chat-borders",c>0),this.css_tweaks.toggle("chat-borders-3d",c===2),this.css_tweaks.toggle("chat-borders-3d-inset",c===3),this.css_tweaks.toggle("chat-borders-wide",c===4)}updateMentionCSS(){const c=this.chat.context.get("chat.filtering.highlight-mentions");this.css_tweaks.toggle("chat-mention-token",this.chat.context.get("chat.filtering.highlight-tokens"));const m=this.chat.context.get("chat.filtering.mention-color");m?(this.css_tweaks.toggle("chat-mention-bg",!1),this.css_tweaks.toggle("chat-mention-bg-alt",!1),this.css_tweaks.toggle("chat-mention-bg-custom",!0),this.css_tweaks.setVariable("chat-mention-color",this.inverse_colors.process(m))):(this.css_tweaks.toggle("chat-mention-bg-custom",!1),this.css_tweaks.toggle("chat-mention-bg",c),this.css_tweaks.toggle("chat-mention-bg-alt",c&&this.chat.context.get("chat.lines.alternate")))}updatePointsInfo(c){const m=c?.pointIcon,N=c?.pointName;m?this.css_tweaks.set("points-icon",`.ffz--points-icon:before { display: none }
.ffz--points-icon:after {
	display: inline-block;
	margin: 0 0.5rem -0.6rem;
	background-image: url("${m.url}");
	background-image: ${I.WEBKIT_CSS}image-set(url("${m.url}") 1x, url("${m.url2x}") 2x, url("${m.url4x}") 4x);
}`):this.css_tweaks.delete("points-icon"),this.point_name=N||null}async grabTypes(){if(this.types_loaded)return;const c=await this.web_munch.findModule("chat-types"),m=await this.web_munch.findModule("callout-types");if(this.callout_types=m||zt,this.automod_types=c?.automod||Ge,this.chat_types=c?.chat||Ke,this.message_types=c?.message||Pe,this.mod_types=c?.mod||Le,!c)return;m&&this.chat.context.update("chat.filtering.blocked-callouts"),this.types_loaded=!0;const N=[];(0,M.shallow_object_equals)(this.callout_types,zt)||N.push("CALLOUT_TYPES"),(0,M.shallow_object_equals)(this.automod_types,Ge)||N.push("AUTOMOD_TYPES"),(0,M.shallow_object_equals)(this.chat_types,Ke)||N.push("CHAT_TYPES"),(0,M.shallow_object_equals)(this.message_types,Pe)||N.push("MESSAGE_TYPES"),(0,M.shallow_object_equals)(this.mod_types,Le)||N.push("MOD_TYPES"),N.length&&this.log.info("Chat Types have changed from static mappings for categories:",N.join(" "))}updateDisableHandling(){this.disable_handling=this.chat.context.get("chat.disable-handling")}onEnable(){this.on("site.web_munch:loaded",this.grabTypes),this.on("site.web_munch:loaded",this.defineClasses),this.grabTypes(),this.defineClasses(),this.chat.context.on("changed:chat.callouts.clip",this.updateCallouts,this),this.chat.context.on("changed:chat.filtering.blocked-callouts",this.updateCallouts,this),this.chat.context.on("changed:chat.points.show-callouts",this.updateCallouts,this),this.chat.context.on("changed:chat.points.show-button",()=>this.PointsButton.forceUpdate()),this.chat.context.on("changed:chat.points.show-rewards",()=>{this.PointsButton.forceUpdate(),this.PointsClaimButton.forceUpdate()}),this.chat.context.on("changed:chat.bits.show",()=>{this.PointsButton.forceUpdate()}),this.chat.context.on("changed:chat.banners.hype-train",this.cleanHighlights,this),this.chat.context.on("changed:chat.subs.gift-banner",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.polls",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.prediction",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.drops",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.pinned-message",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.hide-appleplus",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.shared-chat",this.cleanHighlights,this),this.chat.context.on("changed:chat.disable-handling",this.updateDisableHandling,this),this.chat.context.on("changed:chat.banners.charity",()=>{this.ChatContainer.forceUpdate()}),this.chat.context.on("changed:chat.subs.gift-banner",()=>this.GiftBanner.forceUpdate(),this),this.chat.context.on("changed:chat.effective-width",this.updateChatCSS,this),this.settings.main_context.on("changed:chat.use-width",this.updateChatCSS,this),this.chat.context.on("changed:chat.actions.size",this.updateChatCSS,this),this.chat.context.on("changed:chat.actions.hover-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.font-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.timestamp-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.font-family",this.updateChatCSS,this),this.chat.context.on("changed:chat.lines.emote-alignment",this.updateChatCSS,this),this.chat.context.on("changed:chat.adjustment-mode",this.updateColors,this),this.chat.context.on("changed:chat.adjustment-contrast",this.updateColors,this),this.chat.context.on("changed:theme.is-dark",this.updateColors,this),this.chat.context.on("changed:theme.color.background",this.updateColors,this),this.chat.context.on("changed:theme.color.chat-background",this.updateColors,this),this.chat.context.on("changed:theme.color.text",this.updateColors,this),this.chat.context.on("changed:theme.color.chat-text",this.updateColors,this),this.chat.context.on("changed:chat.lines.borders",this.updateLineBorders,this),this.chat.context.on("changed:chat.filtering.highlight-mentions",this.updateMentionCSS,this),this.chat.context.on("changed:chat.filtering.highlight-tokens",this.updateMentionCSS,this),this.chat.context.on("changed:chat.filtering.mention-color",this.updateMentionCSS,this),this.chat.context.on("changed:chat.pin-resubs",m=>{m&&(this.updateInlineCallouts(),this.updatePinnedCallouts())},this),this.chat.context.on("changed:chat.community-chest.show",()=>{this.CommunityChestBanner.forceUpdate(),this.updateCallouts()},this),this.chat.context.getChanges("chat.emotes.2x",m=>{this.css_tweaks.toggle("big-emoji",m>1),this.toggleEmoteJail()}),this.chat.context.getChanges("chat.emotes.limit-size",()=>this.toggleEmoteJail()),this.chat.context.getChanges("chat.banners.last-events",m=>this.css_tweaks.toggleHide("last-x-events",!m)),this.chat.context.getChanges("chat.input.show-mod-view",m=>this.css_tweaks.toggleHide("ci-mod-view",!m)),this.chat.context.getChanges("chat.input.show-highlight",m=>this.css_tweaks.toggleHide("ci-highlight-settings",!m)),this.chat.context.getChanges("chat.input.show-shield",m=>this.css_tweaks.toggleHide("ci-shield-mode",!m)),this.chat.context.getChanges("chat.lines.padding",m=>this.css_tweaks.toggle("chat-padding",m)),this.chat.context.getChanges("chat.bits.show",m=>this.css_tweaks.toggle("hide-bits",!m)),this.chat.context.on("changed:chat.bits.show-pinned",()=>this.ChatLeaderboard.forceUpdate()),this.chat.context.getChanges("chat.filtering.deleted-style",m=>{this.css_tweaks.toggle("chat-deleted-strike",m===1||m===2),this.css_tweaks.toggle("chat-deleted-fade",m<2)}),this.chat.context.getChanges("chat.filtering.clickable-mentions",m=>this.css_tweaks.toggle("clickable-mentions",m)),this.chat.context.getChanges("chat.filtering.bold-mentions",m=>this.css_tweaks.toggle("chat-mention-no-bold",!m)),this.chat.context.getChanges("chat.hide-community-highlights",m=>this.css_tweaks.toggleHide("community-highlights",m)),this.chat.context.getChanges("chat.lines.alternate",m=>{this.css_tweaks.toggle("chat-rows",m),this.updateMentionCSS()}),this.chat.context.getChanges("chat.input.show-elevate-your-message",m=>this.css_tweaks.toggleHide("elevate-your-message",!m)),this.updateDisableHandling(),this.updateChatCSS(),this.updateColors(),this.updateLineBorders(),this.on("chat:get-messages-late",(m,N,P,V)=>{if(!m)return;const H=new Set(V.map(j=>j.message?.id));for(const j of this.ChatBuffer.instances){for(const U of j.buffer){const ee=U?.id;!ee||H.has(ee)||!U.ffz_standardized||(H.add(ee),V.push({message:U,_instance:null,update:()=>null}))}for(const U of j.delayedMessageBuffer){const ee=U?.event,he=ee?.id;!he||H.has(he)||!ee.ffz_standardized||(H.add(he),V.push({message:ee,_instance:null,update:()=>null}))}}}),this.on("chat:get-tab-commands",m=>{m.commands.push({name:"reconnect",description:"Force chat to reconnect.",permissionLevel:0,ffz_group:"FrankerFaceZ"})}),this.on("chat:pre-send-message",m=>{const N=m.message,P=m._inst;/^\/reconnect ?/i.test(N)&&(m.preventDefault(),P.client?.reconnect?(P.addMessage({type:c.chat_types.Notice,message:c.i18n.t("chat.reconnect","FFZ is forcing chat to reconnect...")}),P.client.reconnect()):P.addMessage({type:c.chat_types.Notice,message:c.i18n.t("chat.reconnect.unable","FFZ is unable to force chat to reconnect.")}))}),this.RaidController.on("mount",this.wrapRaidController,this),this.RaidController.on("update",this.noAutoRaids,this),this.RaidController.ready((m,N)=>{for(const P of N)this.wrapRaidController(P)}),this.InlineCallout.on("mount",this.onInlineCallout,this),this.InlineCallout.on("update",this.onInlineCallout,this),this.InlineCallout.ready(()=>this.updateInlineCallouts()),this.PinnedCallout.on("mount",this.onPinnedCallout,this),this.PinnedCallout.on("update",this.onPinnedCallout,this),this.PinnedCallout.ready(()=>this.updatePinnedCallouts());const c=this;this.PointsInfo.on("mount",this.updatePointsInfo,this),this.PointsInfo.on("update",this.updatePointsInfo,this),this.PointsInfo.on("unmount",()=>this.updatePointsInfo(null)),this.PointsInfo.ready(()=>this.updatePointsInfo(this.PointsInfo.first)),this.ChatLeaderboard.ready(m=>{const N=m.prototype.render;m.prototype.render=function(){return c.chat.context.get("chat.bits.show-pinned")?N.call(this):null},this.ChatLeaderboard.forceUpdate()}),this.GiftBanner.ready(m=>{const N=m.prototype.render;m.prototype.render=function(){return c.chat.context.get("chat.subs.gift-banner")?N.call(this):null},this.GiftBanner.forceUpdate()}),this.CommunityChestBanner.ready(m=>{const N=m.prototype.render;m.prototype.render=function(){try{if(!c.chat.context.get("chat.community-chest.show"))return null}catch(P){c.log.capture(P),c.log.error(P)}return N.call(this)},this.CommunityChestBanner.forceUpdate()}),this.PointsButton.ready(m=>{const N=m.prototype.render;m.prototype.render=function(){try{if(!c.chat.context.get("chat.points.show-button"))return null;const P=this.state.animationQueue,V=this.props.bitsEnabled;c.chat.context.get("chat.points.show-rewards")||(this.state.animationQueue=[]),c.chat.context.get("chat.bits.show")||(this.props.bitsEnabled=!1);const H=N.call(this);return this.state.animationQueue=P,this.props.bitsEnabled=V,H}catch(P){c.log.capture(P),c.log.error(P)}return N.call(this)},this.PointsButton.forceUpdate()}),this.PointsClaimButton.ready(m=>{m.prototype.ffzHasOffer=function(){return!this.props.hidden&&!this.state?.error&&this.getClaim()!=null};const N=m.prototype.render;m.prototype.render=function(){try{if(this.ffzHasOffer()&&!this._ffz_timer&&c.chat.context.get("chat.points.auto-rewards")&&(this._ffz_timer=setTimeout(()=>{this._ffz_timer=null,this.onClick&&this.ffzHasOffer()&&this.onClick()},1e3+Math.floor(Math.random()*5e3))),!c.chat.context.get("chat.points.show-rewards"))return null}catch(P){c.log.capture(P),c.log.error(P)}return N.call(this)},this.PointsClaimButton.forceUpdate()}),this.ChatController.on("mount",this.chatMounted,this),this.ChatController.on("unmount",this.chatUnmounted,this),this.ChatController.on("update",this.chatUpdated,this),this.ChatService.ready((m,N)=>{this.wrapChatService(m);for(const P of N){P.client.events.removeAll(),P._ffzInstall();const V=P.joinedChannel,H=P.client?.session?.channelstate?.[`#${V}`]?.roomState;H&&this.updateChatState(H),P.addEventListeners(),P.props.setChatConnectionAPI({sendMessage:P.sendMessage,_ffz_inst:P})}}),this.ChatBuffer.ready((m,N)=>{this.wrapChatBuffer(m);for(const P of N){const V=P.props.messageHandlerAPI;V&&V.removeMessageHandler(P.handleMessage),P._ffzInstall(),V&&V.addMessageHandler(P.handleMessage),P.props.setMessageBufferAPI({addUpdateHandler:P.addUpdateHandler,removeUpdateHandler:P.removeUpdateHandler,getUnreadCount:P.getUnreadCount,getMessages:P.getMessages,getMessagesForHighlight:P.getMessagesForHighlight,getMessagesForAllHighlights:P.getMessagesForAllHighlights,isPaused:P.isPaused,setPaused:P.setPaused,hasNewerLeft:P.hasNewerLeft,loadNewer:P.loadNewer,loadNewest:P.loadNewest,_ffz_inst:P})}}),this.ChatBufferConnector.on("mount",this.connectorMounted,this),this.ChatBufferConnector.on("update",this.connectorUpdated,this),this.ChatBufferConnector.on("unmount",this.connectorUnmounted,this),this.ChatBufferConnector.ready((m,N)=>{for(const P of N)this.connectorMounted(P)}),this.ChatController.ready((m,N)=>{const P=this,V=m.prototype.componentDidCatch,H=m.prototype.render;m.prototype.componentDidCatch=function(j,U){const ee=this.state.ffz_errors||0;if(ee<100&&(this.setState({ffz_errors:ee+1}),P.log.info("Error within Chat",j,U,ee)),V)return V.call(this,j,U)},m.prototype.render=function(){if(this.state.ffz_errors>0){const j=P.site.getReact(),U=j&&j.createElement;return U?U("div",{className:"tw-border-l tw-c-background-alt-2 tw-c-text-base tw-full-width tw-full-height tw-align-items-center tw-flex tw-flex-column tw-justify-content-center tw-relative"},"There was an error displaying chat."):null}return H.call(this)};for(const j of N)this.chatMounted(j)}),this.ChatRenderer.on("mount",this.rendererMounted,this),this.ChatRenderer.on("unmount",this.rendererUnmounted,this),this.ChatRenderer.on("update",this.rendererUpdated,this),this.ChatRenderer.ready((m,N)=>{for(const P of N)this.rendererMounted(P)}),this.ChatContainer.on("mount",this.containerMounted,this),this.ChatContainer.on("unmount",this.containerUnmounted,this),this.ChatContainer.on("update",this.containerUpdated,this),this.CalloutSelector.ready((m,N)=>{const P=this,V=m.prototype.render;m.prototype.render=function(){try{if(P.CalloutStackHandler){const H=P.site.getReact(),j=V.call(this),U=j?.props?.children;return Array.isArray(U)&&U.push(H.createElement(P.CalloutStackHandler)),j}}catch{}return V.call(this)};for(const H of N)H.forceUpdate()}),this.ChatContainer.ready((m,N)=>{const P=this,V=m.prototype.render,H=m.prototype.componentDidCatch;m.prototype.ffzRender=function(){if(P.chat.context.get("chat.banners.charity"))return V.call(this);const j=this.props.campaignData;this.props.campaignData=null;let U;try{U=V.call(this)}catch(ee){throw this.props.campaignData=j,ee}return this.props.campaignData=j,U},m.prototype.render=function(){try{if(P.CommunityStackHandler){const j=P.site.getReact(),U=this.ffzRender(),ee=U?.props?.children?.props?.children;return j&&Array.isArray(ee)&&ee.push(j.createElement(P.CommunityStackHandler)),U}}catch{}return this.ffzRender()},m.prototype.componentDidCatch=function(j,U){const ee=this.state.ffz_errors||0;if(ee<100&&(this.setState({ffz_errors:ee+1}),P.log.info("Error within Chat Container",j,U,ee)),H)return H.call(this,j,U)};for(const j of N)this.containerMounted(j)}),this.subpump.on(":pubsub-message",m=>{if(m.prefix!=="community-points-channel-v1"||this.disable_handling)return;if(m.prefix==="pinned-chat-updates-v1"){this.log.debug("Pinned Chat",m);return}const N=this.ChatService.first,P=m.message,V=P?.data?.redemption;if(!P||!N||P.type!=="reward-redeemed"||N.props.channelID!=V?.channel_id||V.user_input)return;const H=V.reward?.id&&(0,M.get)(V.reward.id,N.props.rewardMap);if(H&&!this.chat.context.get("chat.filtering.blocked-types").has("ChannelPointsReward")){const j={id:V.id,type:this.chat_types.Message,ffz_type:"points",ffz_reward:H,ffz_reward_highlight:(0,u.ZH)(H),messageParts:[],user:{id:V.user.id,login:V.user.login,displayName:V.user.display_name},timestamp:new Date(P.data.timestamp||V.redeemed_at).getTime()};N.postMessageToCurrentChannel({},j)}})}shouldHideCallout(c){if(!c)return;c=wt[c]??c.replace(/_/g,"-");const m=this.callout_types??zt,N=this.chat.context.get("chat.filtering.blocked-callouts");return!!(N&&N.has(c)||c===m.CommunityPointsRewards&&!this.chat.context.get("chat.points.show-callouts")||c===m.ClipLiveNudge&&!this.chat.context.get("chat.callouts.clip")||c==="prime_gift_bomb"&&!this.chat.context.get("chat.community-chest.show")||c==="megacheer_emote_recipient"&&!t.chat.context.get("chat.bits.show-rewards"))}updateCallouts(){this.updatePinnedCallouts(),this.updateInlineCallouts()}updatePinnedCallouts(){for(const c of this.PinnedCallout.instances)this.onPinnedCallout(c)}onPinnedCallout(c){const m=c.props,N=m?.event,P=N?.type;this.shouldHideCallout(P)&&(c.props.pinned?c.unpin():c.hide()),P==="share-resub"&&!m.pinned&&this.chat.context.get("chat.pin-resubs")&&!c._ffz_pinned&&(this.log.info("Automatically pinning re-sub notice."),c._ffz_pinned=!0,c.pin()),P==="drop"&&this.autoClickDrop(c)}updateInlineCallouts(){for(const c of this.InlineCallout.instances)this.onInlineCallout(c)}onInlineCallout(c){if(c.state.isHidden)return;const m=c.props?.event?.callout?.contextMenuProps,N=m?.event??c.props?.event,P=N?.type;if(this.shouldHideCallout(P)||this.shouldHideCallout(c.props?.event?.trackingType)){c.setState({isHidden:!0});return}if(P==="share-resub"&&this.chat.context.get("chat.pin-resubs")&&!c._ffz_pinned){const V=m?.onPin;V&&(this.log.info("Automatically pinning re-sub notice."),c._ffz_pinned=!0,c.hideOnContextMenuAction?c.hideOnContextMenuAction(V)():V())}P==="drop"&&this.autoClickDrop(c)}autoClickDrop(c){if((c.props?.event?.callout?.contextMenuProps?.event??c.props?.event)?.type!=="drop"||c._ffz_clicking||!this.chat.context.get("chat.drops.auto-rewards"))return;c._ffz_clicking=!0,this.resolve("site").awaitElement('button[data-a-target="chat-private-callout__primary-button"]',this.fine.getHostNode(c),1e4).then(V=>{c._ffz_clicking=!1,!((c.props?.event?.callout?.contextMenuProps?.event??c.props?.event)?.type!=="drop"||!this.chat.context.get("chat.drops.auto-rewards"))&&V.click()}).catch(()=>{c._ffz_clicking=!1})}wrapRaidController(c){if(c._ffz_wrapped)return this.noAutoRaids(c);c._ffz_wrapped=!0;const m=this,N=c.handleJoinRaid;c.handleJoinRaid=function(P,...V){const H=c.props&&c.props.raid&&c.props.raid.id;return P&&P.type&&H&&m.joined_raids.add(H),N.call(this,P,...V)},this.noAutoRaids(c)}noAutoRaids(c){c._ffz_no_raid||(c._ffz_no_raid=setTimeout(()=>{if(c._ffz_no_raid=null,c.props&&c.props.raid&&!c.isRaidCreator&&c.hasJoinedCurrentRaid){const m=c.props.raid.id;if(this.joined_raids.has(m))return;let N=this.settings.get("channel.raids.no-autojoin");if(!N){const P=this.settings.get("__filter:channel.raids.blocked-channels");if(P&&(c.props.raid.targetLogin&&P.test(c.props.raid.targetLogin)||c.props.raid.targetDisplayName&&P.test(c.props.raid.targetDisplayName))&&(N=!0),!N)return}this.log.info("Automatically leaving raid:",m),c.handleLeaveRaid()}}))}toggleEmoteJail(){const c=this.chat.context.get("chat.emotes.2x"),m=this.chat.context.get("chat.emotes.limit-size");this.css_tweaks.toggle("big-emote-jail",m&&!c),this.css_tweaks.toggle("bigger-emote-jail",m&&c)}cleanHighlights(){const c={community_sub_gift:this.chat.context.get("chat.subs.gift-banner"),megacheer:this.chat.context.get("chat.bits.show"),hype_train:this.chat.context.get("chat.banners.hype-train"),prediction:this.chat.context.get("chat.banners.prediction"),poll:this.chat.context.get("chat.banners.polls"),pinned_chat:this.chat.context.get("chat.banners.pinned-message"),"mw-drop-available":this.chat.context.get("chat.banners.drops"),shared_chat:this.chat.context.get("chat.banners.shared-chat")},m=this.community_stack?.highlights;if(Array.isArray(m))for(const N of m){if(!N||!N.event||!N.id)continue;const P=N.event.type;P&&(0,M.has)(c,P)&&!c[P]&&(this.log.info("Removing community highlight: ",P,"#",N.id),this.community_dispatch({type:"remove-highlight",id:N.id})),P==="mw-drop-available"&&N.event.detailsURL==="https://blog.twitch.tv/2024/07/26/sub-and-get-apple-tv/"&&this.chat.context.get("chat.banners.hide-appleplus")&&(this.log.info("Removing community highlight: ",P,"#",N.id),this.community_dispatch({type:"remove-highlight",id:N.id}))}}cleanCallouts(){const c=this.callout_stack;c?.pinnedCallout?.event?.type&&this.shouldHideCallout(c.pinnedCallout.event.type)&&c.unpinCallout(),c?.callouts?.[0]?.event?.type&&this.shouldHideCallout(c.callouts[0].event.type)&&c.clearCalloutType(c.callouts[0].event.type)}defineClasses(){if(this.CommunityStackHandler&&this.CalloutStackHandler)return!0;const c=this,m=this.site.getReact(),N=m?.createElement,P=this.web_munch.getModule("highlightstack"),V=this.web_munch.getModule("calloutstack");return N?(!this.CalloutStackHandler&&V&&(this.CalloutStackHandler=function(){const H=m.useContext(V.stack);return c.callout_stack=H,c.cleanCallouts(),null},this.CalloutSelector.forceUpdate()),!this.CommunityStackHandler&&P&&(this.CommunityStackHandler=function(){const H=m.useContext(P.stack),j=m.useContext(P.dispatch);return c.community_stack=H,c.community_dispatch=j,c.cleanHighlights(),null},this.ChatContainer.forceUpdate()),!0):!1}updateChatState(c){const m=this.chat.context.get("context.chat_state")||{};(0,M.deep_equals)(c,m)||(this.chat.context.updateContext({chat_state:c}),this.input.updateInput())}tryUpdateBadges(){this._badge_timer||(this._badge_timer=setTimeout(()=>this._tryUpdateBadges(),0))}_tryUpdateBadges(){this._badge_timer&&clearTimeout(this._badge_timer),this._badge_timer=null,this.log.info("Trying to update badge data from the chat container.");const c=this.ChatContainer.first;c&&this.containerUpdated(c,c.props)}wrapChatBuffer(c){if(c.prototype._ffz_was_here)return;const m=this,N=c.prototype.clear,P=c.prototype.flushRawMessages,V=c.prototype.componentDidMount;c.prototype._ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const H=this,j=H.handleMessage,U=H.props.setMessageBufferAPI;H.props.setMessageBufferAPI=function(ee){return ee&&(ee._ffz_inst=H),U(ee)},H.handleMessage=function(ee){if(ee)try{const he=m.chat_types||{},Se=m.mod_types||{};if(m.chat.context.get("chat.filtering.blocked-types").has(he[ee.type])||ee.type===he.ChannelPointsReward&&!(0,u.zZ)(ee.reward)||ee.type===he.RewardGift&&!m.chat.context.get("chat.bits.show-rewards"))return;if(ee.type===he.Message){const Be=m.chat.standardizeMessage(ee),Y=H._ffz_connector??H.ffzGetConnector();let ge=Be.roomID=Be.roomID?Be.roomID:Y?.props?.channelID,re=Be.roomLogin=Be.roomLogin?Be.roomLogin:Be.channel?Be.channel.slice(1):Y?.props?.channelLogin;if(!re&&ge){const Ne=m.chat.getRoom(ge,null,!0);Ne&&Ne.login&&(re=Be.roomLogin=Ne.login)}if(!ge&&re){const Ne=m.chat.getRoom(null,re,!0);Ne&&Ne.id&&(ge=Be.roomID=Ne.id)}const Ce=m.site.getUser();if(Ce&&Y&&(Ce.moderator=Y.props.isCurrentUserModerator,Ce.staff=Y.props.isStaff),Be.ffz_tokens=Be.ffz_tokens||m.chat.tokenizeMessage(Be,Ce,!0),Be.ffz_removed)return;if(m.hasListeners("chat:receive-message")){const Ne=m.makeEvent({message:Be,inst:H,channel:re,channelID:ge});if(m.emit("chat:receive-message",Ne),Ne.defaultPrevented||Be.ffz_removed)return}}else if(ee.type===he.Moderation){if(m.emit("chat:mod-user",ee.moderationType,ee.userLogin,ee.targetMessageID,ee),!H.props.isCurrentUserModerator){const Be=ee.moderationType,Y=ee.userLogin;let ge;if(Be===Se.Ban?ge="ban":Be===Se.Timeout?ge="timeout":Be===Se.Delete&&(ge="delete"),ge&&(ee.moderationActionType=ge),!H.moderatedUsers.has(Y)&&Be!==Se.Delete){H.moderateBuffers([H.buffer,H.delayedMessageBuffer.map(re=>re.event)],Y,ee),H.delayedMessageBuffer.push({event:ee,time:Date.now(),shouldDelay:!1});return}}}else ee.type===he.Clear&&(m.chat.context.get("chat.filtering.ignore-clear")?ee={type:he.Info,message:m.i18n.t("chat.ignore-clear","An attempt by a moderator to clear chat was ignored.")}:m.emit("chat:clear-chat",ee))}catch(he){m.log.error("Error processing chat event.",he),m.log.capture(he,{extra:{msg:ee}})}return j.call(H,ee)},H.setPaused=function(ee){H.paused!==ee&&(H.paused=ee,ee||(H.slidingWindowEnd=Math.min(H.buffer.length,m.chat.context.get("chat.scrollback-length")),H.props.isBackground||H.notifySubscribers()))},H.loadNewer=function(){if(!H.hasNewerLeft())return;const ee=Math.min(H.buffer.length,H.slidingWindowEnd+40),he=Math.max(0,ee-m.chat.context.get("chat.scrollback-length"));H.clear(H.buffer.length-he),H.slidingWindowEnd=ee-he,H.props.isBackground||H.notifySubscribers()},H.loadNewest=function(){if(!H.hasNewerLeft())return;const ee=m.chat.context.get("chat.scrollback-length");H.clear(ee),H.slidingWindowEnd=Math.min(ee,H.buffer.length),H.props.isBackground||H.notifySubscribers()},H.getMessages=function(){return H.buffer.slice(0,H.slidingWindowEnd+(H.ffz_extra||0))}},c.prototype.componentDidMount=function(){try{this._ffzInstall()}catch(H){m.log.error("Error installing FFZ features onto chat buffer.",H)}return V.call(this)},c.prototype.clear=function(H){try{H==null&&(H=0);const j=m.chat.context.get("chat.scrollback-length");if(!this.isPaused()&&H>j&&(H=j),H<=0)this.ffz_extra=0,this.buffer=[],this.delayedMessageBuffer=[],this.paused=!1;else{const U=this.buffer,ee=m.chat_types||Ke,he=U.length-H;if(he>0){let Se=0,Te;for(let Be=0;Be<he;Be++)U[Be]&&!ht.includes(ee[U[Be].type])&&(Se++,Te=Be);this.buffer=U.slice(Se%2!==0?Math.max(he-4,Te):he),this.ffz_extra=U.length-H}else this.ffz_extra=0,this.buffer=this.buffer.slice(0);this.paused&&this.buffer.length>=900&&this.setPaused(!1)}}catch(j){return m.log.error("Error running clear",j),N.call(this,H)}},c.prototype.ffzGetConnector=function(){if(this._ffz_connector)return this._ffz_connector;const H=Date.now();if(H-(this._ffz_connect_tried||0)>5e3){this._ffz_connect_tried=H;const j=m.ChatBufferConnector.first;if(j?.props?.messageBufferAPI?._ffz_inst===this)return this._ffz_connector=j}},c.prototype.flushRawMessages=function(){try{const H=[],j=m.chat_types||Ke,U=Date.now(),ee=m.chat.context.get("chat.delay"),he=ee===-1?this.delayDuration:ee,Se=U-he,Te=this.shouldSeeBlockedAndDeletedMessages||this.props&&this.props.shouldSeeBlockedAndDeletedMessages,Be=this.hasNewerLeft(),Y=this.isPaused(),ge=m.chat.context.get("chat.scrollback-length"),re=m.chat.context.get("chat.filtering.remove-deleted"),Ce=m.hasListeners("chat:buffer-message");let Ne=0,We=this.slidingWindowEnd,Xe=!1,de;for(const ke of this.delayedMessageBuffer)if(ke.time<=Se||!ke.shouldDelay){if(re!==0&&(re>1||!Te)&&this.isDeletable(ke.event)&&ke.event.deleted)continue;if(Ce){if(de)de._reset();else{de=m.makeEvent({inst:this,channel:void 0,channelID:void 0,message:void 0});const nt=this._ffz_connector??this.ffzGetConnector(),ot=nt&&nt.props.channelID;if(de.channelID=ot,ot){const At=m.chat.getRoom(ot,null,!0);At&&At.login&&(de.channel=At.login)}}if(de.message=ke.event,m.emit("chat:buffer-message",de),de.defaultPrevented||ke.event.ffz_removed)continue}const Oe=this.buffer[this.buffer.length-1],Ve=Oe?.type;!this.props.isLoadingHistoricalMessages&&!this.props.historicalMessages||Ve!==j.Connected||ke.event.type===j.Connected||this.buffer.find(nt=>nt.type===j.LiveMessageSeparator)||this.buffer.push({type:j.LiveMessageSeparator,id:"live-message-separator"}),this.buffer.push(ke.event),Xe=!0,this.paused||(this.buffer.length>ge?Ne++:We++)}else H.push(ke);this.delayedMessageBuffer=H,Xe&&(this.clear(Math.min(900,this.buffer.length-Ne)),Ne===0&&We===this.slidingWindowEnd&&Be===this.hasNewerLeft()&&Y===this.isPaused()||(this.slidingWindowEnd=We,this.props.isBackground||this.notifySubscribers())),this.flushHighlightsBuffer&&this.flushHighlightsBuffer()}catch(H){return m.log.error("Error running flush.",H),P.call(this)}}}addNotice(c,m){if(!c)return!1;c.startsWith("#")&&(c=c.slice(1)),c=c.toLowerCase();for(const N of this.ChatService.instances)if(c==="*"||N.props.channelLogin.toLowerCase()===c){if(typeof m=="string")N.addMessage({type:(this.chat_types??Ke).Notice,message:m});else{const P=N.props,V=P.channelLogin,H=P.channelID;m.markdown&&((0,W.e)()||(0,W.Z)()),N.addMessage({type:(this.chat_types??Ke).Message,channel:`#${V}`,roomID:H,roomLogin:V,id:`ffz_notice_${(0,M.generateUUID)()}`,ffz_type:"notice",ffz_no_actions:!0,ffz_data:m,message:null,messageParts:[],timestamp:Date.now(),user:{userID:H,userLogin:V}})}return!0}return!1}sendMessage(c,m){const N=this.ChatService.first;if(!N||!c)return null;if(c.startsWith("#")&&(c=c.slice(1)),c.toLowerCase()!==N.props.channelLogin.toLowerCase())return N.client.sendCommand(c,m);N.sendMessage(m)}scheduleMystery(c){c.line&&(c._timer||(c._timer=setTimeout(()=>requestAnimationFrame(()=>{c._timer=null,c.line&&c.line.forceUpdate()}),250)))}wrapChatService(c){const m=this,N=c.prototype.componentDidMount,P=c.prototype.addEventListeners;c.prototype._ffz_was_here=!0,c.prototype._ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const V=this,H=this.sendMessage,j=B((...ee)=>V.addMessage(...ee),"addMessage"),U=B((ee,he)=>V.sendMessage(ee,he),"sendMessage");V.sendMessage=function(ee,he){if(ee=ee.replace(/\s+/g," "),ee.startsWith("/ffz:")){ee=ee.slice(5).trim();const Te=ee.indexOf(" ");let Be;Te===-1?(Be=ee,ee=""):(Be=ee.slice(0,Te),ee=ee.slice(Te+1).trimStart());const Y=m.makeEvent({command:Be,message:ee,extra:he,context:m.chat.context,channel:V.props.channelLogin,_inst:V,addMessage:j,sendMessage:U}),ge=`chat:ffz-command:${Be}`;return m.listeners(ge)?.length>0?m.emit(ge,Y):V.addMessage({type:m.chat_types.Notice,message:m.i18n.t("chat.ffz-command.invalid","No such command: /ffz:{subcmd}",{subcmd:Be})}),!1}const Se=m.makeEvent({message:ee,extra:he,context:m.chat.context,channel:V.props.channelLogin,_inst:V,addMessage:j,sendMessage:U});if(m.emit("chat:pre-send-message",Se),!Se.defaultPrevented)return H.call(this,Se.message,Se.extra)}},c.prototype.componentDidMount=function(){try{this._ffzInstall()}catch(V){m.log.error("Error installing FFZ features onto chat service.",V)}return N.call(this)},c.prototype.addEventListeners=function(...V){if(!this._ffz_init){const H=this;for(const de of Wt){const ke=this[de];ke&&(this[de]=function(Oe,Ve){H._wrapped=Oe;const nt=ke.call(H,Oe,Ve);return H._wrapped=null,nt})}const j=this.onAnnouncementEvent;this.onAnnouncementEvent=function(de){return j.call(this,de)};const U=this.onSubscriptionEvent;this.onSubscriptionEvent=function(de){try{if(m.chat.context.get("chat.filtering.blocked-types").has("Subscription"))return;if(m.disable_handling||m.chat.context.get("chat.subs.native"))return U.call(H,de);if(m.chat.context.get("chat.subs.show")<3)return;de.body="";const ke=H.convertMessage({message:de});return ke.ffz_type="resub",ke.gift_theme=de.giftTheme,ke.sharedChat=de.sharedChat,ke.sub_goal=H.getGoalData?H.getGoalData(de.goalData):null,ke.sub_plan=de.methods,ke.sub_multi=de.multiMonthData?.multiMonthDuration?{count:de.multiMonthData.multiMonthDuration,tenure:de.multiMonthData.multiMonthTenure}:null,H.postMessageToCurrentChannel(de,ke)}catch(ke){return m.log.capture(ke,{extra:de}),U.call(H,de)}};const ee=this.onRoomStateEvent;this.onRoomStateEvent=function(de){try{const ke=de.channel,Oe=m.chat.context.get("context.channel");ke&&(ke===Oe||ke===`#${Oe}`)&&m.updateChatState(de.state)}catch(ke){m.log.capture(ke,{extra:de})}return ee.call(H,de)};const he=this.onPinnedChatEvent;this.onPinnedChatEvent=function(de){try{const ke=m.chat.context.get("chat.hype.message-style");if(ke!==1){if(de.isSystemMessage&&ke===0)return;const Oe=H.convertMessage(de);return Oe.ffz_type="hype",Oe.sharedChat=de.sharedChat,Oe.hype_amount=de.amount,Oe.hype_canonical_amount=de.canonical_amount,Oe.hype_currency=de.currency,Oe.hype_exponent=de.exponent,Oe.hype_level=de.level,de.isSystemMessage&&(Oe.message="",Oe.messageBody="",Oe.messageParts=[],de.message.body=""),H.postMessageToCurrentChannel(de,Oe)}}catch(ke){m.log.capture(ke,{extra:de})}return he.call(H,de)};const Se=this.onResubscriptionEvent;this.onResubscriptionEvent=function(de){try{if(m.chat.context.get("chat.filtering.blocked-types").has("Resubscription"))return;if(m.disable_handling||m.chat.context.get("chat.subs.native"))return Se.call(H,de);if(m.chat.context.get("chat.subs.show")<2&&!de.body)return;const ke=H.convertMessage({message:de});return ke.ffz_type="resub",ke.sharedChat=de.sharedChat,ke.gift_theme=de.giftTheme,ke.sub_goal=H.getGoalData?H.getGoalData(de.goalData):null,ke.sub_cumulative=de.cumulativeMonths||0,ke.sub_streak=de.streakMonths||0,ke.sub_share_streak=de.shouldShareStreakTenure,ke.sub_months=de.months,ke.sub_plan=de.methods,ke.sub_multi=de.multiMonthData?.multiMonthDuration?{count:de.multiMonthData.multiMonthDuration,tenure:de.multiMonthData.multiMonthTenure}:null,H.postMessageToCurrentChannel(de,ke)}catch(ke){return m.log.capture(ke,{extra:de}),Se.call(H,de)}};const Te=this.ffz_mysteries={},Be=this.onSubscriptionGiftEvent;this.onSubscriptionGiftEvent=function(de){try{if(m.chat.context.get("chat.filtering.blocked-types").has("SubGift"))return;if(m.disable_handling||m.chat.context.get("chat.subs.native"))return Be.call(H,de);const ke=`${de.channel}:${de.user.userID}`,Oe=Te[ke];if(Oe)if(Oe.expires<Date.now())Te[ke]=null;else{Oe.recipients.push({id:de.recipientID,login:de.recipientLogin,displayName:de.recipientName}),Oe.recipients.length>=Oe.size&&(Te[ke]=null),Oe.line&&m.scheduleMystery(Oe);return}de.body="";const Ve=H.convertMessage({message:de});return Ve.ffz_type="sub_gift",Ve.sharedChat=de.sharedChat,Ve.sub_recipient={id:de.recipientID,login:de.recipientLogin,displayName:de.recipientName},Ve.gift_theme=de.giftTheme,Ve.sub_goal=H.getGoalData?H.getGoalData(de.goalData):null,Ve.sub_months=de.giftMonths,Ve.sub_plan=de.methods,Ve.sub_total=de.senderCount,H.postMessageToCurrentChannel(de,Ve)}catch(ke){return m.log.capture(ke,{extra:de}),Be.call(H,de)}};const Y=this.onCommunityIntroductionEvent;this.onCommunityIntroductionEvent=function(de){try{if(m.disable_handling)return Y.call(this,de);if(m.chat.context.get("chat.filtering.blocked-types").has("CommunityIntroduction")){const ke=H.convertMessage(de);return ke.sharedChat=de.sharedChat,H.postMessageToCurrentChannel(de,ke)}}catch(ke){m.log.capture(ke,{extra:de}),m.log.error(ke)}return Y.call(this,de)};const ge=this.onAnonSubscriptionGiftEvent;this.onAnonSubscriptionGiftEvent=function(de){try{if(m.chat.context.get("chat.filtering.blocked-types").has("AnonSubGift"))return;if(m.disable_handling||m.chat.context.get("chat.subs.native"))return ge.call(H,de);const ke=`${de.channel}:ANON`,Oe=Te[ke];if(Oe)if(Oe.expires<Date.now())Te[ke]=null;else{Oe.recipients.push({id:de.recipientID,login:de.recipientLogin,displayName:de.recipientName}),Oe.recipients.length>=Oe.size&&(Te[ke]=null),Oe.line&&m.scheduleMystery(Oe);return}de.body="";const Ve=H.convertMessage({message:de});return Ve.ffz_type="sub_gift",Ve.sharedChat=de.sharedChat,Ve.gift_theme=de.giftTheme,Ve.sub_goal=H.getGoalData?H.getGoalData(de.goalData):null,Ve.sub_anon=!0,Ve.sub_recipient={id:de.recipientID,login:de.recipientLogin,displayName:de.recipientName},Ve.sub_months=de.giftMonths,Ve.sub_plan=de.methods,Ve.sub_total=de.senderCount,H.postMessageToCurrentChannel(de,Ve)}catch(ke){return m.log.capture(ke,{extra:de}),ge.call(H,de)}};const re=this.onSubscriptionMysteryGiftEvent;this.onSubscriptionMysteryGiftEvent=function(de){try{if(m.chat.context.get("chat.filtering.blocked-types").has("SubMysteryGift"))return;if(m.disable_handling||m.chat.context.get("chat.subs.native"))return re.call(H,de);let ke=null;if(de.massGiftCount>m.chat.context.get("chat.subs.merge-gifts")){const Ve=`${de.channel}:${de.user.userID}`;ke=Te[Ve]={recipients:[],size:de.massGiftCount,expires:Date.now()+3e4}}de.body="";const Oe=H.convertMessage({message:de});return Oe.ffz_type="sub_mystery",Oe.sharedChat=de.sharedChat,Oe.gift_theme=de.giftTheme,Oe.sub_goal=H.getGoalData?H.getGoalData(de.goalData):null,Oe.mystery=ke,Oe.sub_plan=de.plan,Oe.sub_count=de.massGiftCount,Oe.sub_total=de.senderCount,H.postMessageToCurrentChannel(de,Oe)}catch(ke){return m.log.capture(ke,{extra:de}),re.call(H,de)}};const Ce=this.onAnonSubscriptionMysteryGiftEvent;this.onAnonSubscriptionMysteryGiftEvent=function(de){try{if(m.chat.context.get("chat.filtering.blocked-types").has("AnonSubMysteryGift"))return;if(m.disable_handling||m.chat.context.get("chat.subs.native"))return Ce.call(H,de);let ke=null;if(de.massGiftCount>m.chat.context.get("chat.subs.merge-gifts")){const Ve=`${de.channel}:ANON`;ke=Te[Ve]={recipients:[],size:de.massGiftCount,expires:Date.now()+3e4}}de.body="";const Oe=H.convertMessage({message:de});return Oe.ffz_type="sub_mystery",Oe.sharedChat=de.sharedChat,Oe.sub_anon=!0,Oe.mystery=ke,Oe.sub_plan=de.plan,Oe.sub_count=de.massGiftCount,Oe.sub_total=de.senderCount,H.postMessageToCurrentChannel(de,Oe)}catch(ke){return m.log.capture(ke,{extra:de}),Ce.call(H,de)}};const Ne=this.onRitualEvent;this.onRitualEvent=function(de){try{if(m.chat.context.get("chat.filtering.blocked-types").has("Ritual"))return;if(m.disable_handling)return Ne.call(H,de);const ke=H.convertMessage(de);return ke.sharedChat=de.sharedChat,ke.ffz_type="ritual",ke.ritual=de.type,H.postMessageToCurrentChannel(de,ke)}catch(ke){return m.log.capture(ke,{extra:de}),Ne.call(H,de)}};const We=this.onChannelPointsRewardEvent;this.onChannelPointsRewardEvent=function(de){try{if(m.chat.context.get("chat.filtering.blocked-types").has("ChannelPointsReward"))return;if(m.disable_handling)return We.call(H,de);const ke=de.rewardID&&(0,M.get)(de.rewardID,H.props.rewardMap);if(ke){const Oe=H.convertMessage(de);return m.chat.context.get("chat.powerup.effects")&&(0,u.zZ)(ke)&&de.animationID?H.postMessageToCurrentChannel(de,{type:m.chat_types.ChannelPointsReward,id:Oe.id,displayName:Oe.user.userDisplayName,login:Oe.user.userLogin,reward:ke,message:Oe,userID:Oe.user.userID,animationID:de.animationID,sharedChat:de.sharedChat}):(Oe.ffz_animation_id=de.animationID,Oe.sharedChat=de.sharedChat,Oe.ffz_type="points",Oe.ffz_reward=ke,Oe.ffz_reward_highlight=(0,u.ZH)(ke),H.postMessageToCurrentChannel(de,Oe))}}catch(ke){m.log.error(ke),m.log.capture(ke,{extra:de})}return We.call(H,de)};const Xe=this.addMessage;this.addMessage=function(de){const ke=H._wrapped;return ke&&!de._ffz_checked?H.postMessageToCurrentChannel(ke,de):Xe.call(H,de)},this._ffz_init=!0}return P.apply(this,...V)},c.prototype.postMessageToCurrentChannel=function(V,H){const j=H;if(H._ffz_checked=!0,(H.type===m.chat_types.ChannelPointsReward||H.type===m.chat_types.CommunityIntroduction||H.message?.user&H.message?.badgeDynamicData)&&(H=H.message),V.channel){let U=H.channel=V.channel.toLowerCase();if(U.startsWith("#")&&(U=U.slice(1)),U!==this.props.channelLogin.toLowerCase())return;H.roomLogin=U}if(H.ffz_first_msg=H.isFirstMsg||V.message?.isFirstMsg||!1,H.ffz_returning=V.message?.isReturningChatter||!1,V.message){const U=V.message.user,ee=V.message.flags;if(U&&(H.emotes=U.emotes),ee&&this.getFilterFlagOptions){const he=this.props.isCurrentUserModerator&&m.chat.context.get("chat.automod.run-as-mod");he&&(this.props.isCurrentUserModerator=!1),H.flags=this.getFilterFlagOptions(ee),he&&(this.props.isCurrentUserModerator=!0)}(!H.message||typeof H.message=="string")&&(typeof V.action=="string"?H.message=V.action:H.message=V.message.body)}this.addMessage(j)}}addRoom(c,m){if(m||(m=c.props),!m.channelID)return null;const N=c._ffz_room=this.chat.getRoom(m.channelID,m.channelLogin&&m.channelLogin.toLowerCase(),!1,!0);return N.ref(c),N}removeRoom(c){c._ffz_room&&(c._ffz_room.unref(c),c._ffz_room=null)}chatMounted(c,m){c.chatBuffer&&(c.chatBuffer.ffzController=c),m||(m=c.props),this.addRoom(c,m)&&(this.updateRoomBitsConfig(c,m.bitsConfig),this.settings.updateContext({moderator:m.isCurrentUserModerator,chatHidden:m.isHidden}),(m.isEmbedded||m.isPopout)&&this.settings.updateContext({channel:m.channelLogin&&m.channelLogin.toLowerCase(),channelID:m.channelID}),this.chat.context.updateContext({moderator:m.isCurrentUserModerator,channel:m.channelLogin&&m.channelLogin.toLowerCase(),channelID:m.channelID}))}chatUnmounted(c){c.chatBuffer&&c.chatBuffer.ffzController===this&&(c.chatBuffer.ffzController=null),(c.props.isEmbedded||c.props.isPopout)&&this.settings.updateContext({channel:null,channelID:null}),this.settings.updateContext({moderator:!1,chatHidden:!1}),this.chat.context.updateContext({moderator:!1,channel:null,channelID:null}),this.removeRoom(c)}chatUpdated(c,m){if(c.chatBuffer&&(c.chatBuffer.ffzController=c),!c._ffz_room||m.channelID!=c._ffz_room.id){this.removeRoom(c),c._ffz_mounted&&this.chatMounted(c);return}m.bitsConfig!==c.props.bitsConfig&&this.updateRoomBitsConfig(c,c.props.bitsConfig);let N=c.props.channelLogin;N&&(N=N.toLowerCase()),(c.props.isEmbedded||c.props.isPopout)&&this.settings.updateContext({channel:N,channelID:c.props.channelID}),this.settings.updateContext({moderator:c.props.isCurrentUserModerator,chatHidden:c.props.isHidden}),this.chat.context.updateContext({moderator:c.props.isCurrentUserModerator,channel:N,channelID:c.props.channelID})}updateRoomBitsConfig(c,m){const N=c._ffz_room;if(!N)return;let P=null;if(m&&Array.isArray(m.orderedActions)){P=new Set;for(const V of m.orderedActions)V&&V.prefix&&P.add(V.prefix)}!this._ffz_old_bits&&!P||(0,M.set_equals)(this._ffz_old_bits,P)||(this._ffz_old_bits=P,N.updateBitsConfig(ue(m)),this.chat_line.updateLineTokens())}connectorMounted(c){const m=c.props.messageBufferAPI;m&&m._ffz_inst&&m._ffz_inst._ffz_connector!==c&&(m._ffz_inst._ffz_connector=c)}connectorUpdated(c,m){const N=m.messageBufferAPI,P=c.props.messageBufferAPI;N!==P&&(N&&N._ffz_inst&&N._ffz_inst._ffz_connector===c&&(N._ffz_inst._ffz_connector=null),P&&P._ffz_inst&&P._ffz_inst._ffz_connector!==c&&(N._ffz_inst._ffz_connector=c))}connectorUnmounted(c){const m=c.props.messageBufferAPI;m&&m._ffz_inst&&m._ffz_inst._ffz_connector===c&&(m._ffz_inst._ffz_connector=null)}rendererMounted(c,m){m||(m=c.props),this.updateRendererSharedChats(c,m?.sharedChatDataByChannelID)}updateRendererSharedChats(c,m){if(m??(m=c.props.sharedChatDataByChannelID),c._ffz_cached_shared===m)return;this.shared_room_data=c._ffz_cached_shared=m,this.shared_rooms=c._ffz_shared_rooms=c._ffz_shared_rooms||{};const N=new Set(Object.keys(c._ffz_shared_rooms));let P=!1;if(m!=null)for(const[H,j]of m.entries()){N.delete(H);let U=c._ffz_shared_rooms[H];U||(U=this.chat.getRoom(H,j.login),U.ref(c),c._ffz_shared_rooms[H]=U);const ee=j.badges?.channelsBySet;let he=0;if(ee)for(const Se of ee.values())for(const Te of Se.values())he++;U.badgeCount()!==he&&(P=!0,U.updateBadges(ee))}for(const H of N){const j=c._ffz_shared_rooms[H];j&&j.unref(c),j.unshareChat(),delete c._ffz_shared_rooms[H]}const V=Object.keys(c._ffz_shared_rooms);for(const H of Object.values(c._ffz_shared_rooms))H.shareChats(V);V.length>0&&this.settings.provider.get("shared-chat-notice")!==1&&(this.settings.provider.set("shared-chat-notice",1),this.addNotice("*",{icon:"ffz-i-zreknarf",message:this.i18n.t("chat.shared-chat.welcome","FrankerFaceZ: This is a Shared Chat, a new feature from Twitch to combine multiple stream chats into one. FrankerFaceZ support is early, so some messages might not look correct. Sorry for any trouble!")})),P&&this.chat_line.updateLineBadges()}rendererUnmounted(c){if(c._ffz_shared_rooms)for(const m of Object.values(c._ffz_shared_rooms))m.unref(c);c._ffz_shared_rooms=null,c._ffz_cached_shared=null,this.shared_room_data=new Map,this.shared_rooms={}}rendererUpdated(c,m){this.updateRendererSharedChats(c,m?.sharedChatDataByChannelID)}get shouldUpdateChannel(){const c=this.router.current_name;return p.Z.POPOUT_ROUTES.includes(c)||p.Z.SUNLIGHT_ROUTES.includes(c)}containerMounted(c,m){if(m||(m=c.props),!!this.addRoom(c,m)&&(this.updateRoomBitsConfig(c,m.bitsConfig),m.globalBadgeData?.badges?this.chat.badges.updateTwitchBadges(m.globalBadgeData.badges):m.data?.badges&&this.chat.badges.updateTwitchBadges(m.data.badges),m.data)){if(this.shouldUpdateChannel){const N=m.data.user?.primaryColorHex;this.resolve("site.channel").updateChannelColor(N),this.settings.updateContext({channel:m.channelLogin,channelID:m.channelID,channelColor:N})}this.updateRoomBadges(c,m.data.user&&m.data.user.broadcastBadges),this.updateRoomRules(c,m.chatRules)}}containerUnmounted(c){this.shouldUpdateChannel&&(this.resolve("site.channel").updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})),this.removeRoom(c)}containerUpdated(c,m){if(!c._ffz_room||m.channelID!=c._ffz_room.id){this.removeRoom(c),c._ffz_mounted&&this.containerMounted(c,m);return}if(m.bitsConfig!==c.props.bitsConfig&&this.updateRoomBitsConfig(c,m.bitsConfig),m.data&&p.Z.POPOUT_ROUTES.includes(this.router.current_name)){const j=m.data.user?.primaryColorHex;this.resolve("site.channel").updateChannelColor(j),this.settings.updateContext({channel:m.channelLogin,channelID:m.channelID,channelColor:j})}const N=m.data?.user?.broadcastBadges??[],P=c.props.data?.user?.broadcastBadges??[],V=m.globalBadgeData?.badges??[],H=c.props.globalBadgeData?.badges??[];(this.chat.badges.getTwitchBadgeCount()!==V.length||V.length!==H.length)&&this.chat.badges.updateTwitchBadges(V),(c._ffz_room.badgeCount()!==N.length||N.length!==P.length)&&this.updateRoomBadges(c,N),this.updateRoomRules(c,m.chatRules)}hasRoomBadges(c){const m=c._ffz_room;return m?m.hasBadges():!1}updateRoomBadges(c,m){const N=c._ffz_room;N&&(N.updateBadges(m),this.chat_line.updateLineBadges())}updateRoomRules(c,m){const N=c._ffz_room;N&&(N.rules=m)}};B(Kt,"ChatHook");let _e=Kt;function ue(st){if(!st)return;const c={},m=st.indexedActions,N={};if(Array.isArray(st.tiers))for(const P of st.tiers)N[P.bits]=P.color;for(const P in m)if((0,M.has)(m,P)){const V=m[P],H=c[P]={id:V.id,prefix:V.prefix,tiers:[]};if(st?.getImage)for(const j of V.orderedTiers){const U={};for(const ee of["light","dark"]){const he=U[ee]=U[ee]||{},Se=he.static=he.static||{},Te=he.animated=he.animated||{};for(const Be of[1,2,4])Se[Be]=st.getImage(V.prefix,ee,"static",j.bits,Be,"png"),Te[Be]=st.getImage(V.prefix,ee,"animated",j.bits,Be,"gif")}H.tiers.push({amount:j.bits,color:j.color||N[j.bits]||"inherit",id:j.id,images:U})}else if(V.orderedTiers[0]?.images)for(const j of V.orderedTiers){const U={};for(const ee of j.images){const he=U[ee.theme]=U[ee.theme]||[],Se=ee.isAnimated?"animated":"static",Te=he[Se]=he[Se]||{};Te[ee.dpiScale]=ee.url}H.tiers.push({amount:j.bits,color:j.color||N[j.bits]||"inherit",id:j.id,images:U})}}return c}B(ue,"formatBitsConfig")},44615:(me,te,S)=>{"use strict";S.d(te,{KC:()=>K,ZH:()=>O,_x:()=>W,at:()=>p,yg:()=>l,zZ:()=>x});function K(d){return d.pricingType==="BITS"}B(K,"doesRewardCostBits");function M(d){return d?.__typename==="CommunityPointsAutomaticReward"}B(M,"isAutomaticReward");function I(d){return d?.__typename==="CommunityPointsCustomReward"}B(I,"isCustomReward");function O(d){return M(d)&&d.type==="SEND_HIGHLIGHTED_MESSAGE"}B(O,"isHighlightedReward");function W(d){return d&&(d.title?.includes?.("FFZ:GE")||d.prompt?.includes?.("FFZ:GE"))}B(W,"isGiantEmoteReward");function x(d){return d?.type==="SEND_ANIMATED_MESSAGE"}B(x,"isMessageEffect");function p(d){const f=K(d);return M(d)?f?d.bitsCost||d.defaultBitsCost:d.cost||d.defaultCost:f?d.bitsCost:d.cost}B(p,"getRewardCost");function _(d){return M(d)?d.backgroundColor||d.defaultBackgroundColor:d.backgroundColor}B(_,"getRewardColor");function l(d,f){if(I(d))return d.title;switch(d.type){case"SEND_ANIMATED_MESSAGE":return f.t("chat.points.animated","Message Effects");case"SEND_HIGHLIGHTED_MESSAGE":return f.t("chat.points.highlighted","Highlight My Message");case"SINGLE_MESSAGE_BYPASS_SUB_MODE":return f.t("chat.points.bypass-sub","Send a Message in Sub-Only Mode");case"CHOSEN_SUB_EMOTE_UNLOCK":return f.t("chat.points.choose-emote","Choose an Emote to Unlock");case"RANDOM_SUB_EMOTE_UNLOCK":return f.t("chat.points.random-emote","Unlock a Random Sub Emote");case"CHOSEN_MODIFIED_SUB_EMOTE_UNLOCK":return f.t("chat.points.modify-emote","Modify a Single Emote");default:return f.t("chat.points.reward","Reward")}}B(l,"getRewardTitle")},6325:(me,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>I});var K=S(22527),M=S(46949);const O=class O extends K.default{constructor(...x){super(...x),this.should_enable=!0,this.inject("settings"),this.inject("site.chat"),this.inject("chat.emotes")}onEnable(){this.hookEmoteMenu()}async hookEmoteMenu(){const x=await this.findEmoteMenu();if(!x)return this.log.info("Emote Menu for Twitch was not found after 60 seconds.");x.registerEmoteGetter("FrankerFaceZ",()=>{const p=this.chat.ChatContainer.first,_=p&&p.props;if(!_)return;const l=this.emotes.getSets(_.userID,_.currentUserLogin,_.channelID,_.channelLogin),d=this.resolve("chat"),f=(d?.context||this.settings)?.get?.("chat.emotes.animated")>0,r=[];for(const b of l)if(!(!b||!b.emotes)){for(const u in b.emotes)if((0,M.has)(b.emotes,u)){const v=b.emotes[u];if(v.hidden)continue;r.push({text:v.name,url:f&&v.animated?.[1]||v.urls[1],channel:`${b.source||"FrankerFaceZ"} ${b.title}`,badge:b.icon||"//cdn.frankerfacez.com/script/devicon.png"})}}return r})}async findEmoteMenu(x=0){return window.emoteMenu&&emoteMenu.registerEmoteGetter?emoteMenu:x>=6e4?null:(await(0,M.sleep)(100),this.findEmoteMenu(x+100))}};B(O,"CompatEmoteMenu");let I=O},17103:(me,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>p});var K=S(22527),M=S(44589),I=S(46949),O=S(83342);const W=document.createElement("span"),x={"side-nav":".side-nav,#sideNav","side-nav-viewers":".side-nav-card__live-status","side-rec-channels":".side-nav .recommended-channels,.side-nav .side-nav-section + .side-nav-section:not(.online-friends):not(.bd--shelf)","side-friends":".side-nav .online-friends","side-closed-friends":".side-nav--collapsed .online-friends","side-closed-rec-channels":".side-nav--collapsed .recommended-channels,.side-nav--collapsed .side-nav-section + .side-nav-section:not(.online-friends):not(.bd--shelf)","side-offline-channels":".ffz--side-nav-card-offline","side-rerun-channels":".side-nav .ffz--side-nav-card-rerun","modview-hide-info":".modview-player-widget__hide-stream-info","community-highlights":".community-highlight-stack__card","elevate-your-message":'.chat-input__input-icons button[aria-label="ElevatedMessage"]',"prime-offers":".top-nav__prime","discover-luna":'.top-nav__external-link[data-a-target="try-presto-link"]',subtember:".subtember-gradient","player-gain-volume":'.video-player__container[data-compressed="true"] .volume-slider__slider-container:not(.ffz--player-gain)',"player-ext":".video-player .extension-taskbar,.video-player .extension-container,.video-player .extensions-dock__layout,.video-player .extensions-notifications,.video-player .extensions-video-overlay-size-container,.video-player .extensions-dock__layout","player-ext-hover":'.video-player__container[data-controls="false"] .extension-taskbar,.video-player__container[data-controls="false"] .extension-container,.video-player__container[data-controls="false"] .extensions-dock__layout,.video-player__container[data-controls="false"] .extensions-notifications,.video-player__container[data-controls="false"] .extensions-video-overlay-size-container',"player-cast":".video-player button:has(.tw-chromecast-button__icon)","player-event-bar":".channel-root .live-event-banner-ui__header","player-rerun-bar":'.channel-root__player-container div.tw-c-text-overlay:not([data-a-target="hosting-ui-header"])',"pinned-cheer":'.pinned-cheer,.pinned-cheer-v2,.channel-leaderboard,.channel-leaderboard-marquee,div[data-test-selector="channel-leaderboard-container"]',whispers:'body .whispers-open-threads,.tw-core-button[data-a-target="whisper-box-button"],.whispers__pill',"dir-live-ind":'.live-channel-card[data-ffz-type="live"] .tw-channel-status-text-indicator,article[data-ffz-type="live"] .tw-channel-status-text-indicator,.switcher-hopper__scroll-container .tw-tower a[data-ffz-type="live"] .tw-channel-status-text-indicator',"profile-hover":".preview-card .tw-relative:hover .ffz-channel-avatar","not-live-bar":'div[data-test-selector="non-live-video-banner-layout"]',"channel-live-ind":".channel-header__user .tw-channel-status-text-indicator,.channel-info-content .tw-halo__indicator",celebration:"body .celebration__overlay","last-x-events":".last-x-events_container","pinned-hype-chat":".paid-pinned-chat-message-list","side-stories":".side-nav__title + div[class*=storiesLeftNavSection]","ci-mod-view":'.chat-input__buttons-container a[href*="/moderator"]',"ci-highlight-settings":'.chat-input__buttons-container button[data-highlight-selector="chat-highlights-shortcut"]',"ci-shield-mode":'.chat-input__buttons-container > div:last-child button[class|="ScCoreButton"]:not([data-highlight-selector]):not([data-a-target])'},_=class _ extends K.default{constructor(...d){super(...d),this.should_enable=!0,this.inject("settings"),this.style=new M.ManagedStyle,this.chunks={},this.chunks_loaded=!1,this._state={},this.settings.add("metadata.modview.hide-info",{default:!1,ui:{path:"Channel > Metadata >> Mod View",title:'Hide "Hide Stream Info Stripe" button.',component:"setting-check-box"},changed:f=>this.toggleHide("modview-hide-info",f)}),this.settings.add("metadata.viewers.no-native",{requires:["metadata.viewers"],default:null,process(f,r){return r??f.get("metadata.viewers")},changed:f=>this.toggle("hide-native-viewers",f),ui:{path:"Channel > Metadata >> Player",title:"Hide Twitch's native Viewer Count.",description:"By default, this is enabled whenever FFZ's own Viewer Count display is enabled to avoid redundant information.",component:"setting-check-box"}}),this.settings.add("metadata.uptime.no-native",{requires:["metadata.uptime"],default:null,process(f,r){return r??f.get("metadata.uptime")!==0},changed:f=>this.toggle("hide-native-uptime",f),ui:{path:"Channel > Metadata >> Player",title:"Hide Twitch's native Stream Uptime.",description:"By default, this is enabled whenever FFZ's own Stream Uptime display is enabled to avoid redundant information.",component:"setting-check-box"}}),this.settings.add("layout.use-chat-fix",{requires:["context.force_chat_fix","layout.swap-sidebars","layout.use-portrait","chat.use-width","context.isWatchParty"],process(f){return f.get("context.isWatchParty")?!1:f.get("context.force_chat_fix")||f.get("layout.swap-sidebars")||f.get("layout.use-portrait")||f.get("chat.use-width")},changed:f=>{f?this.toggle("chat-no-animate",!0):!f&&!this._no_anim_timer&&(this._no_anim_timer=requestAnimationFrame(()=>{this._no_anim_timer=null,this.settings.get("layout.use-chat-fix")||this.toggle("chat-no-animate",!1)})),this.toggle("chat-fix",f),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}}),this.settings.add("layout.side-nav.hide-stories",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Stories",component:"setting-check-box"}}),this.settings.add("layout.side-nav.show",{default:1,requires:["layout.use-portrait"],process(f,r){return r===2?!f.get("layout.use-portrait"):r},ui:{sort:-1,path:"Appearance > Layout >> Side Navigation",title:"Display Side Navigation",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"Hide in Portrait"}]},changed:f=>{this.toggle("hide-side-nav",!f),this.emit("site.layout:resize")}}),this.settings.add("layout.side-nav.hide-viewers",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Channel View Counts",component:"setting-check-box"},changed:f=>this.toggleHide("side-nav-viewers",f)}),this.settings.add("layout.side-nav.show-avatars",{default:!0,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Channel Avatars",component:"setting-check-box"},changed:f=>this.toggle("hide-side-nav-avatars",!f)}),this.settings.add("layout.side-nav.show-rec-channels",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Recommended / Popular Channels",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Side Navigation is Open"}]},changed:f=>{this.toggleHide("side-rec-channels",f===0),this.toggleHide("side-closed-rec-channels",f===2)}}),this.settings.add("layout.side-nav.show-friends",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Online Friends",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Side Navigation is Open"}]},changed:f=>{this.toggleHide("side-friends",f===0),this.toggleHide("side-closed-friends",f===2)}}),this.settings.add("layout.side-nav.hide-offline",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Offline Channels",component:"setting-check-box"},changed:f=>this.toggleHide("side-offline-channels",f)}),this.settings.add("layout.side-nav.rerun-style",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Reruns",component:"setting-select-box",data:[{value:0,title:"Do Not Display"},{value:1,title:"Normally"},{value:2,title:"Faded (33% Opacity)"}]},changed:f=>{this.toggleHide("side-rerun-channels",f===0),this.toggle("side-rerun-opacity",f===2)}}),this.settings.add("layout.swap-sidebars",{default:!1,requires:["context.isWatchParty"],process(f,r){return f.get("context.isWatchParty")?!1:r},ui:{path:"Appearance > Layout >> Side Navigation",title:"Swap Sidebars",description:"Swap navigation and chat to the opposite sides of the window.",component:"setting-check-box"},changed:f=>{this.toggle("swap-sidebars",f),this.emit("site.layout:resize")}}),this.settings.add("layout.minimal-navigation",{requires:["layout.theatre-navigation","context.isWatchParty"],default:!1,process(f,r){return f.get("context.isWatchParty")?!1:f.get("layout.theatre-navigation")?!0:r},ui:{path:"Appearance > Layout >> Top Navigation",title:"Minimize Navigation",description:"Slide the site navigation bar up out of view when it isn't in use.",component:"setting-check-box"},changed:f=>{this.toggle("minimal-navigation",f),this.emit("site.layout:resize")}}),this.settings.add("layout.theatre-navigation",{requires:["layout.is-theater-mode"],default:!1,process(f,r){return f.get("layout.is-theater-mode")?r:!1},ui:{path:"Appearance > Layout >> Top Navigation",title:"Show the minimized navigation bar when in theatre mode.",component:"setting-check-box"},changed:f=>{this.toggle("theatre-nav",f),this.emit("site.layout:resize")}}),this.settings.add("layout.subtember",{default:!0,ui:{path:"Appearance > Layout >> Channel",title:"Allow the Subtember upsell banner to appear.",component:"setting-check-box"}}),this.settings.add("layout.turbo-cta",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Allow the Twitch Turbo button to appear.",component:"setting-check-box"}}),this.settings.add("layout.prime-offers",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Show Prime Gaming Loot.",component:"setting-check-box"},changed:f=>this.toggleHide("prime-offers",!f)}),this.settings.add("layout.hide-discover-luna",{default:!1,ui:{path:"Appearance > Layout >> Top Navigation",title:'Hide the "Discover Luna" link.',component:"setting-check-box"},changed:f=>this.toggleHide("discover-luna",f)}),this.settings.add("whispers.show",{default:!0,ui:{path:"Chat > Whispers >> General",title:"Display Whispers",component:"setting-check-box"},changed:f=>{this.toggleHide("whispers",!f),this.emit("site.layout:resize")}}),this.settings.add("chat.hype.show-pinned",{default:!0,ui:{path:"Chat > Hype Chat >> Appearance",title:"Allow Hype Chat messages to appear pinned at the top of chat.",component:"setting-check-box"},changed:f=>this.toggleHide("pinned-hype-chat",!f)}),this.settings.add("chat.bits.show",{default:!0,ui:{order:-1,path:"Chat > Bits and Cheering >> Appearance",title:"Display Bits",description:"Display UI associated with bits. Note: This will not hide cheering in chat messages.",component:"setting-check-box"},changed:f=>this.toggle("hide-bits",!f)}),this.settings.add("channel.show-celebrations",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Allow Celebrations to appear.",description:"Celebrations are animations that cover the entire Twitch page.",component:"setting-check-box"},changed:f=>this.toggleHide("celebration",!f)}),this.settings.add("layout.theme.global-font",{default:"",ui:{path:"Appearance > Theme >> Fonts",title:"Font Family",description:'Override the font used for the entire Twitch website. The old default font was: `"Helvetica Neue",Helvetica,Arial,sans-serif`\n\nAny font available via [Google Fonts](https://fonts.google.com/) can be loaded by prefixing the font name with `google:`.',component:"setting-combo-box",data:()=>(0,O.R7)()},changed:()=>this.updateFont()}),this.settings.add("channel.hide-unfollow",{default:!1,ui:{path:"Channel > Appearance >> General",title:"Hide the Unfollow button.",component:"setting-check-box"},changed:f=>this.toggle("hide-unfollow-button",f)}),this.settings.add("channel.hide-live-indicator",{requires:["context.route.name"],process(f,r){return f.get("context.route.name")==="user"||f.get("context.route.name")==="user-home"?r:!1},default:!1,ui:{path:"Channel > Appearance >> General",title:'Hide the "LIVE" indicator on live channel pages.',component:"setting-check-box"},changed:f=>this.toggleHide("channel-live-ind",f)}),this.settings.add("channel.round-avatars",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Allow avatar images to be rounded.",component:"setting-check-box"},changed:f=>this.toggle("square-avatars",!f)})}onEnable(){this.toggleHide("modview-hide-info",this.settings.get("metadata.modview.hide-info")),this.toggleHide("side-nav-viewers",this.settings.get("layout.side-nav.hide-viewers")),this.toggle("hide-native-uptime",this.settings.get("metadata.uptime.no-native")),this.toggle("hide-native-viewers",this.settings.get("metadata.viewers.no-native")),this.toggle("chat-fix",this.settings.get("layout.use-chat-fix")),this.toggle("swap-sidebars",this.settings.get("layout.swap-sidebars")),this.toggle("minimal-navigation",this.settings.get("layout.minimal-navigation")),this.toggle("theatre-nav",this.settings.get("layout.theatre-navigation")),this.toggle("hide-side-nav-avatars",!this.settings.get("layout.side-nav.show-avatars")),this.toggle("hide-side-nav",!this.settings.get("layout.side-nav.show")),this.toggleHide("side-offline-channels",this.settings.get("layout.side-nav.hide-offline")),this.toggleHide("discover-luna",this.settings.get("layout.hide-discover-luna")),this.toggleHide("prime-offers",!this.settings.get("layout.prime-offers")),this.toggle("hide-unfollow-button",this.settings.get("channel.hide-unfollow")),this.toggleHide("pinned-hype-chat",!this.settings.get("chat.hype.show-pinned")),this.toggle("square-avatars",!this.settings.get("channel.round-avatars")),this.toggleHide("channel-live-ind",this.settings.get("channel.hide-live-indicator"));const d=this.settings.get("layout.side-nav.rerun-style");this.toggleHide("side-rerun-channels",d===0),this.toggle("side-rerun-opacity",d===2);const f=this.settings.get("layout.side-nav.show-rec-channels");this.toggleHide("side-rec-channels",f===0),this.toggleHide("side-closed-rec-channels",f===2);const r=this.settings.get("layout.side-nav.show-friends");this.toggleHide("side-friends",r===0),this.toggleHide("side-closed-friends",r===2),this.toggleHide("whispers",!this.settings.get("whispers.show")),this.toggleHide("celebration",!this.settings.get("channel.show-celebrations")),this.settings.getChanges("layout.subtember",b=>this.toggleHide("subtember",!b)),this.settings.getChanges("layout.side-nav.hide-stories",b=>this.toggleHide("side-stories",b)),this.updateFont(),this.updateTopNav(),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}updateTopNav(){requestAnimationFrame(()=>this.emit("site.layout:update-nav"))}updateFont(){let d=this.settings.get("layout.theme.global-font");if(d&&d.length){const[f,r]=(0,O.jo)(d);if(d=f,this._font_unloader&&this._font_unloader(),this._font_unloader=r,d.indexOf(" ")!==-1&&d.indexOf(",")===-1&&d.indexOf('"')===-1&&d.indexOf("'")===-1&&(d=`"${d}"`),W.style.fontFamily="",W.style.fontFamily=d,W.style.fontFamily){this.setVariable("global-font",d),this.toggle("global-font",!0);return}}this.toggle("global-font",!1),this.deleteVariable("global-font")}toggleHide(d,f){const r=`hide--${d}`;if(!f){this.style.delete(r);return}if(!(0,I.has)(x,d))throw new Error(`cannot find class for "${d}"`);this.style.set(r,`${x[d]} { display: none !important }`)}toggle(d,f){f=!!f,(this._state[d]??!1)!==f&&(this._state[d]=f,this._apply(d))}_apply(d){if(!this._state[d]){this.style&&this.style.delete(d);return}if(!this.style.has(d)){if(!this.chunks_loaded)return this.loadFromContext().then(()=>this._apply(d));if(!(0,I.has)(this.chunks,d)){this.log.warn(`Unknown chunk name "${d}" for toggle()`);return}this.style.set(d,this.chunks[d])}}set(d,f){return this.style.set(d,f)}delete(d){return this.style.delete(d)}setVariable(d,f,r="body"){this.style.set(`var--${d}`,`${r} { --ffz-${d}: ${f}; }`)}deleteVariable(d){this.style.delete(`var--${d}`)}loadFromContext(){if(!this.chunks_loaded)return new Promise(async d=>{const f=(await S.e(2597).then(S.bind(S,96677))).default;for(const r of f.keys()){const b=r.slice(2,r.length-(r.endsWith(".scss")?5:4));this.chunks[b]=f(r).default}this.emit("site.layout:resize"),this.chunks_loaded=!0,d()})}};B(_,"CSSTweaks");let p=_},95778:(me,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>O});var K=S(22527),M=S(46949),I=S(89196);const W=class W extends K.default{constructor(...p){super(...p),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site.channel"),this.SunlightBroadcast=this.fine.define("sunlight-bcast",_=>_.getGame&&_.getTitle&&_.props?.data,I.Z.SUNLIGHT_ROUTES),this.SunlightManager=this.fine.define("sunlight-manager",_=>_.props?.channelID&&_.props.channelLogin&&(0,M.has)(_.props,"hostedChannel"),I.Z.SUNLIGHT_ROUTES)}onEnable(){this.SunlightManager.on("mount",this.updateSunlight,this),this.SunlightManager.on("update",this.updateSunlight,this),this.SunlightManager.on("unmount",this.removeSunlight,this),this.SunlightManager.ready((p,_)=>{for(const l of _)this.updateSunlight(l)}),this.SunlightBroadcast.on("mount",this.updateBroadcast,this),this.SunlightBroadcast.on("update",this.updateBroadcast,this),this.SunlightBroadcast.on("unmount",this.removeBroadcast,this),this.SunlightBroadcast.ready((p,_)=>{for(const l of _)this.updateBroadcast(l)})}updateSunlight(p){this.settings.updateContext({channel:(0,M.get)("props.channelLogin",p),channelID:(0,M.get)("props.channelID",p)})}removeSunlight(){this.settings.updateContext({channel:null,channelID:null})}updateBroadcast(p){const _=p.props?.data?.user?.broadcastSettings,l=_?.game;this.settings.updateContext({category:l?.name,categoryID:l?.id,title:_?.title})}removeBroadcast(){this.settings.updateContext({category:null,categoryID:null,title:null})}};B(W,"Dashboard");let O=W},96432:(me,te,S)=>{"use strict";S.r(te),S.d(te,{CARD_CONTEXTS:()=>x,CONTENT_FLAGS:()=>p,default:()=>d});var K=S(22527),M=S(83269),I=S(44589),O=S(46949);const f=class f extends K.default{constructor(...u){super(...u),this.inject("site"),this.inject("site.fine"),this.inject("site.apollo"),this.inject("i18n"),this.inject("settings"),this.GameHeader=this.fine.define("game-header",v=>v.props&&v.props.data&&v.getBannerImage&&v.getDirectoryCountAndTags,["dir-game-index","dir-community","dir-game-videos","dir-game-clips","dir-game-details"]),this.settings.addUI("directory.game.blocked-games",{path:`Directory > Categories @{"description": "Please note that due to limitations in Twitch's website, names here must be formatted exactly as displayed in your client. For best results, you can block or unblock categories directly from directory pages."} >> Blocked`,component:"game-list-editor",default:[],onUIChange:()=>this.parent.updateCards()}),this.settings.addUI("directory.game.hidden-thumbnails",{path:"Directory > Categories >> Hidden Thumbnails",component:"game-list-editor",default:[],onUIChange:()=>this.parent.updateCards()})}onEnable(){this.GameHeader.on("mount",this.updateGameHeader,this),this.GameHeader.on("update",this.updateGameHeader,this),this.GameHeader.on("unmount",()=>{this.settings.updateContext({category:null,categoryID:null})}),this.settings.provider.on("changed",u=>{if(u==="directory.game.blocked-games"||u==="directory.game.hidden-thumbnails"){this.parent.updateCards();for(const v of this.GameHeader.instances)this.updateGameHeader(v)}}),this.GameHeader.ready((u,v)=>{for(const A of v)this.updateGameHeader(A)}),this.on("site.router:route",u=>{u&&u.name==="dir-game-index"&&this.updateGameHeader()})}updateGameHeader(u){if(u===void 0){for(const A of this.GameHeader.instances)this.updateGameHeader(A);return}this.updateButtons(u);const v=u?.props?.data?.game;this.settings.updateContext({category:v?.name,categoryID:v?.id})}updateButtons(u){const v=this.fine.getChildNode(u);if((0,O.get)("data.game",u.props)==null||!v||!v.querySelector)return;const A=v.querySelector(".ffz-directory-buttons");A&&A.remove();const C=v.querySelector(".directory-header-new__info > div > div + div");if(!C)return;let y,a,w,F;const D=(0,O.get)("data.game.name",u.props)||u.props.directoryName,z=B(()=>{const J=this.settings.provider.get("directory.game.blocked-games",[]),Z=J.includes(D);y.classList.toggle("active",Z),a.textContent=Z?this.i18n.t("directory.unblock","Unblock"):this.i18n.t("directory.block","Block")},"update_block"),$=B(()=>{const J=this.settings.provider.get("directory.game.hidden-thumbnails",[]),Z=J.includes(D);w.classList.toggle("active",Z),F.textContent=Z?this.i18n.t("directory.show-thumbnails","Show Thumbnails"):this.i18n.t("directory.hide-thumbnails","Hide Thumbnails")},"update_hidden");y=(0,I.createElement)("button",{class:"tw-mg-r-1 tw-button ffz-directory-toggle-block",onClick:this.generateClickHandler("directory.game.blocked-games",D,z)},a=(0,I.createElement)("span",{class:"tw-button__text"})),z(),w=(0,I.createElement)("button",{class:"tw-button ffz-directory-toggle-thumbnail",onClick:this.generateClickHandler("directory.game.hidden-thumbnails",D,$)},F=(0,I.createElement)("span",{class:"tw-button__text"})),$(),C.appendChild((0,I.createElement)("div",{class:"tw-mg-t-1 ffz-directory-buttons"},y,w))}generateClickHandler(u,v,A){return C=>{C.preventDefault();const y=this.settings.provider.get(u)||[],a=y.indexOf(v);a===-1?y.push(v):y.splice(a,1),this.settings.provider.set(u,y),this.parent.updateCards(),A()}}};B(f,"Game");let W=f;const x=((b={})=>(b[b.SingleGameList=1]="SingleGameList",b[b.SingleChannelList=2]="SingleChannelList",b[b.MixedGameAndChannelList=3]="MixedGameAndChannelList",b))(),p=["DrugsIntoxication","Gambling","MatureGame","ProfanityVulgarity","SexualThemes","ViolentGraphic"];function _(b,u){return b[0].length&&b[1].push((0,O.addWordSeparators)(b[0].join("|"))),b[1].length?new RegExp(b[1].join("|"),u):null}B(_,"formatTerms");const l=["front-page","dir","dir-community","dir-community-index","dir-creative","dir-following","dir-game-index","dir-game-clips","dir-game-videos","dir-all","dir-category","user-videos","user-clips"],r=class r extends K.default{constructor(...u){super(...u),this.should_enable=!0,this.inject("site"),this.inject("site.elemental"),this.inject("site.fine"),this.inject("site.router"),this.inject("site.css_tweaks"),this.inject("site.twitch_data"),this.inject("i18n"),this.inject("settings"),this.inject(W),this.DirectoryCard=this.elemental.define("directory-card",'article[data-a-target^="video-carousel-card-"],article[data-a-target^="followed-vod-"],article[data-a-target^="card-"],div[data-a-target^="video-tower-card-"] article,div[data-a-target^="clips-card-"] article,.shelf-card__impression-wrapper article,.tw-tower div article',l,null,0,0),this.DirectoryExperimentCard=this.elemental.define("directory-experiment-card",".switcher-hopper__scroll-container .tw-tower > div > a",l,null,0,0),this.DirectoryGameCard=this.elemental.define("directory-game-card",".game-card[data-a-id]",l,null,0,0),this.DirectoryShelf=this.fine.define("directory-shelf",v=>v.shouldRenderNode&&v.props&&v.props.shelf,l),this.DirectorySorter=this.fine.define("directory-sorter",v=>v.getSortOptionLink&&v.getSortOptionText&&v.getSortOptionOnClick&&v.getFilterIDs,l),this.settings.add("directory.hidden.style",{default:2,ui:{path:'Directory > Categories >> Hidden Thumbnail Style @{"sort": 100}',title:"Hidden Style",component:"setting-select-box",sort:100,data:[{value:0,title:"Replace Image"},{value:1,title:"Replace Image and Blur Title"},{value:2,title:"Blur Image"},{value:3,title:"Blur Image and Title"}]},changed:v=>{this.css_tweaks.toggle("dir-no-blur",v<2),this.css_tweaks.toggle("dir-blur-title",v===1||v===3)}}),this.settings.add("directory.hide-costream-border",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Hide border on streams with guest stars.",component:"setting-check-box",getExtraTerms:()=>["costream","co-stream"]}}),this.settings.add("directory.hidden.reveal",{default:!1,ui:{path:"Directory > Categories >> Hidden Thumbnail Style",title:"Reveal hidden entries on mouse hover.",component:"setting-check-box",sort:101},changed:v=>this.css_tweaks.toggle("dir-reveal",v)}),this.settings.add("directory.uptime",{default:1,ui:{path:"Directory > Channels >> Appearance",title:"Stream Uptime",description:"Display the stream uptime on the channel cards.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enabled (with Seconds)"}]},changed:()=>this.updateCards()}),this.settings.add("directory.show-flags",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Display Content Flags on channel cards.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.hide-live",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show the Live indicator on channels that are live.",component:"setting-check-box"},changed:v=>this.css_tweaks.toggleHide("dir-live-ind",v)}),this.settings.add("directory.hide-promoted",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show Promoted streams in the directory.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.hide-vodcasts",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show reruns in the directory.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.hide-recommended",{default:!1,ui:{path:"Directory > Following >> Categories",title:"Do not show `Recommended Live Channels` in the Following Directory.",component:"setting-check-box"},changed:()=>this.DirectoryShelf.forceUpdate()}),this.settings.add("directory.block-users",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Block by Username",component:"basic-terms",words:!1}}),this.settings.add("__filter:directory.block-users",{requires:["directory.block-users"],equals:"requirements",process(v){const A=v.get("directory.block-users");if(!A||!A.length)return null;const C=[[],[]];for(const y of A){const a=y.t;let w=y.v;a==="glob"?w=(0,O.glob_to_regex)(w):a!=="raw"&&(w=(0,O.escape_regex)(w)),!(!w||!w.length)&&C[y.s?0:1].push(w)}return[C[0].length?new RegExp(`^(?:${C[0].join("|")})$`):null,C[1].length?new RegExp(`^(?:${C[1].join("|")})$`,"i"):null]},changed:()=>this.updateCards()}),this.settings.add("directory.block-titles",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Block by Title",component:"basic-terms"}}),this.settings.add("__filter:directory.block-titles",{requires:["directory.block-titles"],equals:"requirements",process(v){const A=v.get("directory.block-titles");if(!A||!A.length)return null;const C=[[[],[]],[[],[]]];for(const y of A){const a=y.t;let w=y.v;a==="glob"?w=(0,O.glob_to_regex)(w):a!=="raw"&&(w=(0,O.escape_regex)(w)),!(!w||!w.length)&&C[y.s?0:1][y.w?0:1].push(w)}return[_(C[0],"g"),_(C[1],"gi")]},changed:()=>this.updateCards()}),this.settings.add("directory.blocked-tags",{default:[],type:"basic_array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Block by Tag",component:"tag-list-editor"},changed:()=>this.updateCards()}),this.settings.add("directory.blur-titles",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Hide Thumbnails by Title",component:"basic-terms"}}),this.settings.add("__filter:directory.blur-titles",{requires:["directory.blur-titles"],equals:"requirements",process(v){const A=v.get("directory.blur-titles");if(!A||!A.length)return null;const C=[[[],[]],[[],[]]];for(const y of A){const a=y.t;let w=y.v;a==="glob"?w=(0,O.glob_to_regex)(w):a!=="raw"&&(w=(0,O.escape_regex)(w)),!(!w||!w.length)&&C[y.s?0:1][y.w?0:1].push(w)}return[_(C[0],"g"),_(C[1],"gi")]},changed:()=>this.updateCards()}),this.settings.add("directory.blur-tags",{default:[],type:"basic_array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Hide Thumbnails by Tag",component:"tag-list-editor"},changed:()=>this.updateCards()}),this.settings.add("directory.wait-flags",{default:!0,ui:{path:"Directory > Channels >> Appearance",title:"Hide Thumbnails for all channels until Content Flags have been loaded.",description:"We need to load content flags with a separate query, so they aren't immediately available to determine if a given stream should be hidden, or have its thumbnail blurred. This setting will blur ALL thumbnails until after we've finished loading the necessary content flag information, ensuring you don't see a flash of anything you would rather not.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.block-flags",{default:[],type:"array_merge",always_inherit:!0,process(v,A){const C=new Set;for(const y of A){let a=y?.v;a==="ViolentGrpahic"&&(a="ViolentGraphic"),a&&C.add(a)}return C},ui:{path:"Directory > Channels >> Block by Flag",component:"blocked-types",data:()=>[...p].sort()},changed:()=>this.updateCards()}),this.settings.add("directory.blur-flags",{default:[],type:"array_merge",always_inherit:!0,process(v,A){const C=new Set;for(const y of A)y?.v&&C.add(y.v);return C},ui:{path:"Directory > Channels >> Hide Thumbnails by Flag",component:"blocked-types",data:()=>[...p].sort()},changed:()=>this.updateCards()}),this.settings.add("directory.default-sort",{default:!1,ui:{path:"Directory > General >> General",title:"Force Default Sorting",component:"setting-select-box",data:[{value:!1,title:"Disabled"},{value:"RELEVANCE",title:"Recommended For You"},{value:"VIEWER_COUNT",title:"Viewers (High to Low)"},{value:"VIEWER_COUNT_ASC",title:"Viewers (Low to High)"},{value:"RECENT",title:"Recently Started"}]},changed:()=>this.updateSorting()}),this.routeClick=this.routeClick.bind(this)}onEnable(){this.css_tweaks.toggleHide("profile-hover",this.settings.get("directory.show-channel-avatars")===2),this.css_tweaks.toggleHide("dir-live-ind",this.settings.get("directory.hide-live")),this.css_tweaks.toggle("dir-reveal",this.settings.get("directory.hidden.reveal")),this.settings.getChanges("directory.hide-costream-border",A=>this.css_tweaks.toggle("hide-costream-border",A));const u=this.settings.get("directory.hidden.style");this.css_tweaks.toggle("dir-no-blur",u<2),this.css_tweaks.toggle("dir-blur-title",u===1||u===3),this.on("i18n:update",()=>this.updateCards()),this.DirectoryExperimentCard.on("mount",this.updateExpCard,this),this.DirectoryExperimentCard.on("mutate",this.updateExpCard,this),this.DirectoryExperimentCard.on("unmount",this.clearExpCard,this),this.DirectoryExperimentCard.each(A=>this.updateExpCard(A)),this.DirectoryCard.on("mount",this.updateCard,this),this.DirectoryCard.on("mutate",this.updateCard,this),this.DirectoryCard.on("unmount",this.clearCard,this),this.DirectoryCard.each(A=>this.updateCard(A)),this.DirectoryGameCard.on("mount",this.updateGameCard,this),this.DirectoryGameCard.on("mutate",this.updateGameCard,this),this.DirectoryGameCard.each(A=>this.updateGameCard(A)),this.DirectorySorter.on("mount",this.updateSorting,this),this.DirectorySorter.ready(()=>this.updateSorting());const v=this;this.DirectoryShelf.ready(A=>{const C=A.prototype.shouldRenderNode;A.prototype.shouldRenderNode=function(a,...w){try{let F;if(a.__typename==="Game"?F=a.name:a.game&&(F=a.game.name),F&&v.settings.provider.get("directory.game.blocked-games",[]).includes(F))return!1}catch(F){v.log.capture(F),v.log.error(F)}return C.call(this,a,...w)};const y=A.prototype.render;A.prototype.render=function(){try{if(v.settings.get("directory.hide-recommended")&&(0,O.get)("props.shelf.title.key",this)==="live_recs_following")return null}catch(a){v.log.capture(a)}return y.call(this)},this.DirectoryShelf.forceUpdate()})}updateSorting(u){if(!u){for(const C of this.DirectorySorter.instances)this.updateSorting(C);return}const v=this.settings.get("directory.default-sort");if(!v||v===u.state?.activeOption)return;const A=u.getSortOptionLink(v,!1,u.props);A?.props?.linkTo&&(A.props.onClick&&A.props.onClick(),this.router.history.push(A.props.linkTo))}updateGameCard(u){const v=this.fine.getReactInstance(u);if(!v)return;const A=v.return?.memoizedProps;if(!A?.trackingProps?.category)return;const C=A.trackingProps.category,y=A.tagListProps?.tags;let a=!1;if(Array.isArray(y)){const D=this.settings.get("directory.blocked-tags",[]);if(D.length){for(const z of y)if(z?.id&&D.includes(z.id)){a=!0;break}}}const w=a||this.settings.provider.get("directory.game.blocked-games",[]).includes(C);let F=u.closest(".tw-tower > div");F||(F=u),F.querySelectorAll('a[data-a-target="tw-box-art-card-link"]').length<2&&F.classList.toggle("tw-hide",w)}updateCards(){this.DirectoryCard.each(u=>this.updateCard(u)),this.DirectoryExperimentCard.each(u=>this.updateExpCard(u)),this.DirectoryGameCard.each(u=>this.updateGameCard(u)),this.DirectoryShelf.forceUpdate(),this.emit(":update-cards")}clearCard(u,v=!1){this.clearUptime(u),this.clearFlags(u);const A=this._getTopRightContainer(u,v);A&&A.remove(),u._ffz_top_right=null}clearExpCard(u){return this.clearCard(u,!0)}updateCard(u){const v=this.fine.searchParentNode(u,C=>C.memoizedProps?.channelLogin);if(!v)return;const A=v.memoizedProps;return this._updateCard(u,!1,A,A.trackingProps)}updateExpCard(u){const v=this.fine.searchParentNode(u,y=>y.memoizedProps?.item?.channelID);if(!v)return;const A=v.memoizedProps,C=A.item;return this._updateCard(u,!0,C,A.tracking)}_updateCard(u,v,A,C){const y=A.categoryName||A.gameTitle||C?.game||C?.categoryName||C?.category,a=A.tags??A.tagListProps?.freeformTags,w=this.settings.get("directory.wait-flags"),F=this.settings.get("directory.show-flags"),D=this.settings.get("directory.blur-flags",[]),z=this.settings.get("directory.block-flags",[]),$=D.size>0||z.size>0,J=F||$;u._ffz_flags===void 0&&J&&(u._ffz_flags=null,A.slug||A.type==="clips"?u._ffz_flags=[]:A.vodID||A.type==="videos"?u._ffz_flags=[]:this.twitch_data.getStreamFlags(A.channelID,A.channelID?null:A.channelLogin).then(ve=>{u._ffz_flags=ve??[],v?this.updateExpCard(u):this.updateCard(u)}));let Z=!1,G=!1;if(Array.isArray(a)){const ve=this.settings.get("directory.blocked-tags",[]),Re=this.settings.get("directory.blur-tags",[]);if(ve.length||Re.length)for(const oe of a){if(oe?.name){const ie=oe.name.toLowerCase();ve.includes(ie)&&(Z=!0),Re.includes(ie)&&(G=!0)}if((Z||!ve.length)&&(G||!Re.length))break}}let Q=G;if(w&&$&&u._ffz_flags==null&&(Q=!0),Q||(Q=this.settings.provider.get("directory.game.hidden-thumbnails",[]).includes(y)),!Q&&D.size&&u._ffz_flags){for(const ve of u._ffz_flags)if(ve?.id&&D.has(ve.id)){Q=!0;break}}if(!Q){const ve=this.settings.get("__filter:directory.blur-titles");ve&&(ve[0]&&(ve[0].lastIndex=-1),ve[1]&&(ve[1].lastIndex=-1),(ve[0]&&ve[0].test(A.title)||ve[1]&&ve[1].test(A.title))&&(Q=!0))}const se=A.type??A.streamType;u.classList.toggle("ffz-hide-thumbnail",Q),u.dataset.ffzType=se;let ce=!1;if(Z)ce=!0;else if(se==="rerun"&&this.settings.get("directory.hide-vodcasts"))ce=!0;else if(A.context!=null&&A.context!==x.SingleGameList&&this.settings.provider.get("directory.game.blocked-games",[]).includes(y))ce=!0;else if((A.isPromotion||A.sourceType==="COMMUNITY_BOOST"||A.sourceType==="PROMOTION"||A.sourceType==="SPONSORED")&&this.settings.get("directory.hide-promoted"))ce=!0;else{if(z.size&&u._ffz_flags){for(const ve of u._ffz_flags)if(ve?.id&&z.has(ve.id)){ce=!0;break}}if(!ce){const ve=this.settings.get("__filter:directory.block-users");ve&&(ve[0]&&(ve[0].lastIndex=-1),ve[1]&&(ve[1].lastIndex=-1),(ve[0]&&ve[0].test(A.channelLogin)||ve[1]&&ve[1].test(A.channelLogin))&&(ce=!0))}if(!ce){const ve=this.settings.get("__filter:directory.block-titles");ve&&(ve[0]&&(ve[0].lastIndex=-1),ve[1]&&(ve[1].lastIndex=-1),(ve[0]&&ve[0].test(A.title)||ve[1]&&ve[1].test(A.title))&&(ce=!0))}}let be=u.closest(".tw-tower > div");be||(be=u),be.querySelectorAll(".tw-aspect .tw-image:not(.tw-image-avatar)").length<2&&be.classList.toggle("tw-hide",ce),this.updateUptime(u,A,v),this.updateFlags(u,v)}updateFlags(u,v=!1){if(!document.contains(u))return this.clearFlags(u);if(!this.settings.get("directory.show-flags")||!u._ffz_flags?.length)return this.clearFlags(u);const C=this._getTopRightContainer(u,!0,v);if(!C)return this.clearFlags(u);u.ffz_flags_el?u.contains(u.ffz_flags_el)||C.appendChild(u.ffz_flags_el):C.appendChild(u.ffz_flags_el=(0,I.createElement)("div",{class:"tw-mg-y-05 ffz-flags-element tw-relative ffz-il-tooltip__container"},(0,I.createElement)("div",{class:"tw-border-radius-small tw-c-background-overlay tw-c-text-overlay tw-flex tw-pd-x-05"},(0,I.createElement)("figure",{class:"ffz-i-flag"})),u.ffz_flags_tt=(0,I.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--pre ffz-il-tooltip--down ffz-il-tooltip--align-right"}))),u.ffz_flags_tt.textContent=this.i18n.t("metadata.flags.tooltip","Intended for certain audiences. May contain:")+`

`+u._ffz_flags.map(y=>y.localizedName).join(`
`)}clearFlags(u){u.ffz_flags_el&&(u.ffz_flags_el.remove(),u.ffz_flags_tt=null,u.ffz_flags_el=null)}_getTopRightContainer(u,v=!0,A=!1){let C=u._ffz_top_right??u.querySelector(".ffz-top-right");if(C||!v)return C;let y=A?u.querySelector(".tw-aspect .tw-image"):u.querySelector('a[data-a-target="preview-card-image-link"] > div');return y&&A&&(y=y.parentElement?.parentElement),y?(C=(0,I.createElement)("div",{"data-test-selector":"top-right-selector",class:"tw-absolute tw-mg-1 tw-right-0 tw-top-0 ffz-top-right tw-flex tw-flex-column tw-align-items-end"}),u._ffz_top_right=C,y.appendChild(C),C):null}updateUptime(u,v,A=!1){if(!document.contains(u))return this.clearUptime(u);const C=this.settings.get("directory.uptime"),y=this._getTopRightContainer(u,C>0,A);if(!y||C===0||v.viewCount||v.animatedImageProps||v.type==="videos"||v.type==="clips")return this.clearUptime(u);let a=v.createdAt;a||(u.ffz_stream_meta===void 0&&(u.ffz_stream_meta=null,this.twitch_data.getStreamMeta(null,v.channelLogin).then(z=>{u.ffz_stream_meta=z,this.updateUptime(u,v,A)})),a=u.ffz_stream_meta?.createdAt);const w=a&&new Date(a),F=w&&Math.floor((Date.now()-w)/1e3)||0;if(F<1)return this.clearUptime(u);const D=(0,M.duration_to_string)(F,!1,!1,!1,C===1);if(u.ffz_uptime_el||(u.ffz_uptime_el=y.querySelector(".ffz-uptime-element")),u.ffz_uptime_el?u.contains(u.ffz_uptime_el)||y.appendChild(u.ffz_uptime_el):y.appendChild(u.ffz_uptime_el=(0,I.createElement)("div",{class:"ffz-uptime-element tw-relative ffz-il-tooltip__container"},(0,I.createElement)("div",{class:"tw-border-radius-small tw-c-background-overlay tw-c-text-overlay tw-flex tw-pd-x-05"},(0,I.createElement)("div",{class:"tw-flex tw-c-text-live"},(0,I.createElement)("figure",{class:"ffz-i-clock"})),u.ffz_uptime_span=(0,I.createElement)("p",null)),(0,I.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-right"},this.i18n.t("metadata.uptime.tooltip","Stream Uptime"),u.ffz_uptime_tt=(0,I.createElement)("div",{class:"tw-pd-t-05"})))),u.ffz_uptime_span||(u.ffz_uptime_span=u.ffz_uptime_el.querySelector("p")),!u.ffz_uptime_span)return this.clearUptime(u);if(u.ffz_uptime_tt||(u.ffz_uptime_tt=u.ffz_uptime_el.querySelector(".ffz-il-tooltip > div")),!u.ffz_uptime_tt)return this.clearUptime(u);u.ffz_update_timer||(u.ffz_update_timer=setInterval(this.updateUptime.bind(this,u,v,A),1e3)),u.ffz_uptime_span.textContent=D,u.ffz_last_created_at!==a&&(u.ffz_uptime_tt.textContent=this.i18n.t("metadata.uptime.since","(since {since,datetime})",{since:w}),u.ffz_last_created_at=a)}clearUptime(u){u.ffz_update_timer&&(clearInterval(u.ffz_update_timer),u.ffz_update_timer=null),u.ffz_uptime_el&&(u.ffz_uptime_el.remove(),u.ffz_uptime_el=null,u.ffz_uptime_span=null,u.ffz_uptime_tt=null,u.ffz_last_created_at=null)}routeClick(u,v){if(u.preventDefault(),u.stopPropagation(),!v){const A=u.currentTarget;if(A){const C=A.dataset;C&&C.href?v=C.href:A.href&&(v=A.href)}}v&&this.router.history.push(v)}hijackUserClick(u,v,A=null){u.preventDefault(),u.stopPropagation(),A&&A(u,v),this.router.navigate("user",{userName:v})}};B(r,"Directory");let d=r},68318:(me,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>x});var K=S(24431),M=S(22527),I=S(46949);const O=["user","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following"],W=["popout","embed-chat","dash-chat"],p=class p extends M.default{constructor(...l){super(...l),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject("site.elemental"),this.ResizeDetector=this.fine.define("resize-detector",d=>d.maybeDebounceOnScroll&&d.setGrowDivRef&&d.props.onResize),this.SideBar=this.elemental.define("sidebar",".side-bar-contents",null,{childNodes:!0,subtree:!0},1),this.settings.add("clips.layout.big",{default:!1,ui:{path:"Appearance > Layout >> Clips",title:"Allow the player to get larger on `clips.twitch.tv` pages.",description:"This only affects windows at least 1,200 pixels wide and attempts to make the player and chat replay as large as possible.",component:"setting-check-box"}}),this.settings.add("layout.portrait",{default:!1,ui:{path:"Appearance > Layout >> Channel",title:"Enable Portrait Mode",description:"In Portrait Mode, chat will be displayed beneath the player when the window is taller than it is wide.",component:"setting-check-box"}}),this.settings.add("layout.portrait-invert",{default:!1,ui:{path:"Appearance > Layout >> Channel",title:"When in portrait mode, place chat at the top.",component:"setting-check-box"},changed:d=>document.body.classList.toggle("ffz--portrait-invert",d)}),this.settings.add("layout.portrait-threshold",{default:1.25,ui:{path:"Appearance > Layout >> Channel",title:"Portrait Mode Threshold",description:"This is the Width to Height ratio at which point Portrait Mode will begin to activate.",component:"setting-text-box",process(d){return d=parseFloat(d,10),isNaN(d)||!isFinite(d)||d<=0?1.25:d}}}),this.settings.add("layout.portrait-min-chat",{default:!1,requires:["layout.use-portrait"],process(d,f){return d.get("layout.use-portrait")?f:!1},ui:{path:"Appearance > Layout >> Channel",title:"Use compact chat in Portrait Mode.",description:"When enabled, this minimizes the chat header and places the chat input box in line with the chat buttons in order to present a more compact chat able to display more lines with limited vertical space.",component:"setting-check-box"}}),this.settings.add("layout.use-portrait",{requires:["layout.portrait","layout.portrait-threshold","context.route.name","context.size","context.isWatchParty"],process(d){if(d.get("context.isWatchParty"))return!1;const f=d.get("context.size");return!f||!d.get("layout.portrait")||!O.includes(d.get("context.route.name"))?!1:f.width/f.height<=d.get("layout.portrait-threshold")},changed:()=>this.updatePortraitMode()}),this.settings.add("layout.inject-portrait",{requires:["layout.use-portrait","context.ui.rightColumnExpanded"],process(d){return d.get("layout.use-portrait")&&d.get("context.ui.rightColumnExpanded")}}),this.settings.add("layout.use-portrait-swapped",{requires:["layout.inject-portrait","layout.swap-sidebars"],process(d){return d.get("layout.inject-portrait")&&d.get("layout.swap-sidebars")}}),this.settings.add("layout.use-portrait-meta",{requires:["layout.inject-portrait","player.theatre.metadata"],process(d){return d.get("layout.inject-portrait")&&d.get("player.theatre.metadata")}}),this.settings.add("layout.use-portrait-meta-top",{requires:["layout.use-portrait-meta","layout.portrait-invert"],process(d){return d.get("layout.use-portrait-meta")&&!d.get("layout.portrait-invert")}}),this.settings.add("layout.is-theater-mode",{requires:["context.ui.theatreModeEnabled","context.fullscreen"],process(d){return d.get("context.fullscreen")?!1:d.get("context.ui.theatreModeEnabled")}}),this.settings.add("layout.show-portrait-chat",{requires:["layout.use-portrait","layout.portrait-extra-height","layout.portrait-extra-width"],process(){return!0},changed:()=>this.updatePortraitMode()}),this.settings.add("layout.portrait-extra-height",{requires:["context.new_channel","context.squad_bar","layout.is-theater-mode","player.theatre.no-whispers","whispers.show","layout.minimal-navigation"],process(d){let f=0;return d.get("layout.is-theater-mode")?(d.get("layout.minimal-navigation")&&(f+=1),d.get("whispers.show")&&!d.get("player.theatre.no-whispers")&&(f+=4)):(f=d.get("layout.minimal-navigation")?1:5,d.get("whispers.show")&&(f+=4),d.get("context.squad_bar")&&(f+=6),f+=d.get("context.new_channel")?1:5),f}}),this.settings.add("layout.portrait-extra-width",{require:["layout.side-nav.show","layout.is-theater-mode","context.ui.sideNavExpanded"],process(d){return!d.get("layout.side-nav.show")||d.get("layout.is-theater-mode")?0:d.get("context.ui.sideNavExpanded")?24:5}}),this.settings.add("layout.is-minimal",{require:["context.route.name"],process(d){return W.includes(d.get("context.route.name"))}})}onEnable(){document.body.classList.toggle("ffz--portrait-invert",this.settings.get("layout.portrait-invert")),this.on(":update-nav",this.updateNavLinks,this),this.on(":resize",this.handleResize,this),this.settings.getChanges("layout.portrait-min-chat",l=>this.css_tweaks.toggle("portrait-chat",l)),this.settings.getChanges("layout.inject-portrait",l=>this.css_tweaks.toggle("portrait",l)),this.settings.getChanges("layout.use-portrait-swapped",l=>this.css_tweaks.toggle("portrait-swapped",l)),this.settings.getChanges("layout.use-portrait-meta",l=>this.css_tweaks.toggle("portrait-metadata",l)),this.settings.getChanges("layout.use-portrait-meta-top",l=>this.css_tweaks.toggle("portrait-metadata-top",l)),this.settings.getChanges("layout.portrait-extra-width",l=>this.css_tweaks.setVariable("portrait-extra-width",`${l}rem`)),this.settings.getChanges("layout.portrait-extra-height",l=>this.css_tweaks.setVariable("portrait-extra-height",`${l}rem`)),this.on("site.directory:update-cards",()=>{this.SideBar.each(l=>this._updateSidebar(l))}),this.ResizeDetector.ready(()=>{this._needs_resize&&(this._needs_resize=!1,this.handleResize())}),this.SideBar.on("mount",this.updateSidebar,this),this.SideBar.on("mutate",this.updateSidebar,this),this.SideBar.each(l=>this.updateSidebar(l))}handleResize(){this._resize_timer||(this._resize_timer=setTimeout(()=>this._handleResize(),K.IS_FIREFOX?500:100))}_handleResize(){if(clearTimeout(this._resize_timer),this._resize_timer=null,!this.ResizeDetector.instances.size)this._needs_resize=!0;else{for(const l of this.ResizeDetector.instances)l?.onScroll?.();this.emit("site.player:fix-player")}}get is_minimal(){return this.settings.get("layout.is-minimal")}updateSidebar(l){l&&(l._ffz_update||(l._ffz_update=(0,I.debounce)(()=>requestAnimationFrame(()=>this._updateSidebar(l)),1e3,2)),l._ffz_update())}_updateSidebar(l){if(!l)return;const d=l.querySelectorAll(".side-nav-card"),f=this.settings.provider.get("directory.game.blocked-games",[]);for(const r of d){const b=this.fine.getReactInstance(r),u=b?.return?.return?.memoizedProps,v=u?.metadataRight?.props?.stream,A=v?.type==="rerun",C=v?.game?.displayName,y=u?.offline??!1;let a=!1;if(C&&f.includes(C)&&(a=!0),u?.isPromoted&&this.settings.get("directory.hide-promoted"))a=!0;else{if(!a){const w=this.settings.get("__filter:directory.block-users"),F=u?.userLogin;w&&F&&(w[0]&&(w[0].lastIndex=-1),w[1]&&(w[1].lastIndex=-1),(w[0]&&w[0].test(F)||w[1]&&w[1].test(F))&&(a=!0))}if(!a){const w=this.settings.get("__filter:directory.block-titles"),F=v?.broadcaster?.broadcastSettings?.title;w&&F&&(w[0]&&(w[0].lastIndex=-1),w[1]&&(w[1].lastIndex=-1),(w[0]&&w[0].test(F)||w[1]&&w[1].test(F))&&(a=!0))}}r.classList.toggle("ffz--side-nav-card-rerun",A),r.classList.toggle("ffz--side-nav-card-offline",y),r.classList.toggle("tw-hide",a)}}updateNavLinks(){}updatePortraitMode(){}};B(p,"Layout");let x=p},29333:(me,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>x});var K=S(24431),M=S(22527),I=S(44589),O=S(89196),W=S(6170);const p=class p extends M.default{constructor(...l){super(...l),this.inject("i18n"),this.inject("settings"),this.inject("site"),this.inject("site.fine"),this.inject("site.elemental"),this.pauseToasts=this.pauseToasts.bind(this),this.unpauseToasts=this.unpauseToasts.bind(this),this.should_enable=!0,this._pill_content=null,this._has_update=!1,this._important_update=!1,this._new_settings=0,this._loading=!1,this.toasts=[],this.settings.add("ffz.show-new-settings",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Display an indicator on the FFZ Control Center button whenever there are new settings added to FrankerFaceZ.",component:"setting-check-box"},changed:()=>this.update()}),this.ModBar=this.fine.define("mod-view-bar",d=>d.actions&&d.updateRoot&&d.childContext,["mod-view"]),this.SunlightNav=this.elemental.define("sunlight-nav",".sunlight-top-nav > div > div > div > div:last-child > div",O.Z.SUNLIGHT_ROUTES,{attributes:!0},1),this.NavBar=this.fine.define("nav-bar",d=>d.renderOnsiteNotifications&&d.renderTwitchPrimeCrown),this.SquadBar=this.fine.define("squad-nav-bar",d=>d.exitSquadMode&&d.props&&d.props.squadID,["squad"]),this.MultiController=this.fine.define("multi-controller",d=>d.handleAddStream&&d.handleRemoveStream&&d.getInitialStreamLayout,["command-center"])}get loading(){return this._loading}set loading(l){l!==this._loading&&(this._loading=l,this.update())}get new_settings(){return this._new_settings}set new_settings(l){l!==this._new_settings&&(this._new_settings=l,this.update())}get has_new(){return this.settings.get("ffz.show-new-settings")&&this._new_settings>0}get important_update(){return this._important_update}set important_update(l){this._important_update=!1,this.update()}get has_update(){return this._has_update}get has_strings(){return this.i18n.new_strings>0||this.i18n.changed_strings>0}set has_update(l){l&&!this._has_update&&(this._important_update=!0),this._has_update=l,this.update()}get pill(){return this._pill_content}set pill(l){this._pill_content=l,this.update()}formatPill(){const l=this._pill_content;return typeof l=="number"?this.i18n.formatNumber(l):l==null&&this.has_new?this.i18n.formatNumber(this._new_settings):l}formatExtraPill(){if(this.has_update)return null;if(this.settings.disable_profiles)return(0,I.createElement)("figure",{class:"ffz-i-cog"});if(this.has_strings)return this.i18n.formatNumber(this.i18n.new_strings+this.i18n.changed_strings);const l=this.resolve("addons");return K.DEBUG&&l.has_dev?this.i18n.t("site.menu_button.dev","dev"):K.DEBUG&&!l.has_dev?this.i18n.t("site.menu_button.main-dev","m-dev"):!K.DEBUG&&l.has_dev?this.i18n.t("site.menu_button.addon-dev","a-dev"):null}updateToasts(){requestAnimationFrame(()=>this._updateToasts())}_updateToasts(){for(const l of this.NavBar.instances)this.updateButtonToast(l);for(const l of this.SquadBar.instances)this.updateButtonToast(l);for(const l of this.MultiController.instances)this.updateButtonToast(l);for(const l of this.SunlightNav.instances)this.updateButtonToast(null,l,!0);for(const l of this.ModBar.instances)this.updateButtonToast(l)}update(){requestAnimationFrame(()=>this._update())}_update(){for(const l of this.NavBar.instances)this.updateButton(l);for(const l of this.SquadBar.instances)this.updateButton(l);for(const l of this.MultiController.instances)this.updateButton(l);for(const l of this.SunlightNav.instances)this.updateButton(null,l,!0);for(const l of this.ModBar.instances)this.updateButton(l)}onEnable(){this.NavBar.ready(()=>this.update()),this.NavBar.on("mount",this.updateButton,this),this.NavBar.on("update",this.updateButton,this),this.SquadBar.ready(()=>this.update()),this.SquadBar.on("mount",this.updateButton,this),this.SquadBar.on("update",this.updateButton,this),this.MultiController.ready(()=>this.update()),this.MultiController.on("mount",this.updateButton,this),this.MultiController.on("update",this.updateButton,this),this.SunlightNav.on("mount",l=>this.updateButton(null,l,!0)),this.SunlightNav.on("mutate",l=>this.updateButton(null,l,!0)),this.SunlightNav.each(l=>this.updateButton(null,l,!0)),this.ModBar.ready(()=>this.update()),this.ModBar.on("mount",this.updateButton,this),this.ModBar.on("update",this.updateButton,this),this.on(":clicked",()=>this.important_update=!1),this.once(":clicked",this.loadMenu),this.on("i18n:new-strings",this.update),this.on("i18n:changed-strings",this.update),this.on("i18n:update",this.update),this.on("addons:data-loaded",this.update),this.once("settings:quota-exceeded",()=>{this.addError("site.menu_button.quota-exceeded","Your local storage space for this website is full, and settings cannot be saved. Please backup your settings and switch to a higher capacity provider in [Data Management > Storage >> Provider](~data_management.storage.tabs.provider).","ffz-i-attention",!0),this.update()}),this.on("settings:change-provider",()=>{this.addError("site.menu_button.changed","The FrankerFaceZ settings provider has changed. Please refresh this tab to avoid strange behavior."),this.update()})}addError(l,d,f="ffz-i-attention",r=!1){this.addToast({icon:f,text_i18n:l,text:d,markdown:r})}addToast(l){if(l.markdown&&!(0,W.e)())return(0,W.Z)().then(()=>this.addToast(l));this.toasts.push(l),!(this.toasts.length>5)&&this.updateToasts()}pauseToasts(){const l=Math.min(5,this.toasts.length),d=performance.now();this._toasts_paused=!0;for(let f=0;f<l;f++){const r=this.toasts[f];if(!r||!r.started)continue;r._timer&&(clearTimeout(r._timer),r._timer=null);const b=d-r.started,u=r.timeout-b;r.remaining=u,r.percentage=100*u/r.timeout,r.el&&r.el.replaceWith(this.renderToast(r))}}unpauseToasts(){const l=Math.min(5,this.toasts.length),d=performance.now();this._toasts_paused=!1;for(let f=0;f<l;f++){const r=this.toasts[f];if(!(!r||!r.started)){if(r.remaining){const b=r.timeout-r.remaining;r.started=d-b}r.el&&r.el.replaceWith(this.renderToast(r))}}}renderToasts(){const l=Math.min(5,this.toasts.length);if(!l)return null;const d=[];for(let f=0;f<l;f++)d.push(this.renderToast(this.toasts[f]));return d}renderToast(l){l._remove||(l._remove=()=>{l._timer&&(clearTimeout(l._timer),l._timer=null),l.el=null;const r=this.toasts.indexOf(l);r!==-1&&(this.toasts.splice(r,1),this.toasts.length||(this._toasts_paused=!1),this.updateToasts())});let d=null;const f=l.markdown?(0,W.e)():null;if(l.markdown&&!f)return null;if(l.timeout){const r=performance.now();l.started||(l.started=r);const b=r-l.started,u=l.timeout-b;let v;this._toasts_paused?v=l.percentage:l._timer||(l._timer=setTimeout(l._remove,u)),v==null&&(v=l.percentage=100*u/l.timeout),d=(0,I.createElement)("div",{class:"ffz-toast--progress tw-absolute tw-overflow-hidden tw-z-below"},(0,I.createElement)("div",{class:"tw-border-radius-rounded ffz-progress-bar ffz-progress-bar--countdown ffz-progress-bar--default ffz-progress-bar--mask",role:"progressbar","aria-valuenow":v,"aria-valuemin":"0","aria-valuemax":"100"},(0,I.createElement)("div",{class:"tw-block tw-border-bottom-left-radius-rounded tw-border-top-left-radius-rounded ffz-progress-bar__fill","data-a-target":"tw-progress-bar-animation",style:{width:`${v}%`,"animation-duration":`${u/1e3}s`}})))}return l.el=(0,I.createElement)("div",{class:`ffz-toast ffz-balloon ffz-balloon--lg tw-mg-y-1${this._toasts_paused?" ffz-toast--paused":""}`},(0,I.createElement)("div",{class:"tw-pd-1 tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4 tw-relative"},(0,I.createElement)("div",{class:"tw-flex tw-align-items-start"},l.icon&&(typeof l.icon=="string"?(0,I.createElement)("figure",{class:`tw-font-size-3 tw-pd-r-1 ${l.icon}`}):l.icon),l.render?l.render.call(this,l):null,l.title||l.text?(0,I.createElement)("div",{class:"tw-flex-grow-1"},l.title?(0,I.createElement)("header",{class:"tw-semibold tw-font-size-3 tw-pd-b-05"},l.title_i18n?this.i18n.tList(l.title_i18n,l.title,l):l.title):null,l.text?(0,I.createElement)("span",{class:`${l.lines?"ffz--line-clamp":""}`,style:{"--ffz-lines":l.lines}},l.markdown?(0,I.createElement)("span",{dangerouslySetInnerHTML:{__html:(0,W.e)().render(l.text_i18n?this.i18n.t(l.text_i18n,l.text,l):l.text)}}):null,l.markdown?null:l.text_i18n?this.i18n.tList(l.text_i18n,l.text,l):l.text):null):null,!l.unclosable&&(0,I.createElement)("button",{class:"tw-button-icon tw-mg-l-05 tw-relative ffz-il-tooltip__container",onClick:l._remove},(0,I.createElement)("span",{class:"tw-button-icon__icon"},(0,I.createElement)("figure",{class:"ffz-i-cancel"})))),d)),l.el}updateButtonToast(l,d,f){const r=(l||d)._ffz_toast_el;if(r){r.innerHTML="",(0,I.setChildren)(r,this.renderToasts(),!1,!0);return}this.updateButton(l,d,f)}updateButton(l,d,f){const r=this.fine.getChildNode(l);let b=!1,u=!1;if(d||(d=r&&r.querySelector(".top-nav__menu")),d||(r&&r.classList.contains("squad-stream-top-bar__container")?d=r:d=r&&r.querySelector(".squad-stream-top-bar__container"),d&&(b=!0)),!d&&l.handleAddStream&&(d=this.fine.searchTree(l,F=>F.classList&&F.classList.contains("multiview-stream-page__header")),d&&(b=!0)),!d&&l.getIsAdsEnabled&&(d=r&&r.querySelector(".sunlight-top-nav > .tw-flex > .tw-flex > .tw-justify-content-end > .tw-flex"),d&&(f=!0)),!d&&l.childContext&&(d=r&&r.querySelector(".modview-dock > div:last-child"),d&&(u=!0)),!d)return;if(!b&&!u&&!f){let F=null;try{F=d.querySelector(":scope > .tw-justify-content-end:last-child")}catch{}F?d=F:d=d.lastElementChild}let v,A=d.querySelector(".ffz-top-nav");A&&A.remove();const C=this.resolve("addons"),y=this.renderToasts(),a=this.formatPill(),w=this.formatExtraPill();if(A=(0,I.createElement)("div",{class:`ffz-top-nav ${u?"ffz-mod-view-button tw-relative tw-mg-b-1":`tw-align-self-center tw-flex-grow-0 tw-flex-nowrap tw-flex-shrink-0 tw-relative ${f?"tw-mg-l-05 tw-mg-r-2":"tw-mg-x-05"}`}`},(0,I.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},v=(0,I.createElement)("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative${this.loading?" loading":""}`,onClick:F=>this.handleClick(F,v),onContextMenu:F=>this.renderContext(F,v)},(0,I.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,I.createElement)("span",{class:"tw-button-icon__icon"},(0,I.createElement)("figure",{class:"ffz-i-zreknarf"})))),this.has_error&&(0,I.createElement)("div",{class:`tw-absolute ffz-balloon ffz-balloon--lg tw-block ${u?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right"}`},(0,I.createElement)("div",{class:"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4 tw-pd-1"},(0,I.createElement)("div",{class:"tw-flex tw-align-items-center"},(0,I.createElement)("div",{class:"tw-flex-grow-1"},this.error.i18n?this.i18n.t(this.error.i18n,this.error.text):this.error.text),this.error.permanent?null:(0,I.createElement)("button",{class:"tw-button-icon tw-mg-l-05 tw-relative ffz-il-tooltip__container",onClick:()=>this.error=null},(0,I.createElement)("span",{class:"tw-button-icon__icon"},(0,I.createElement)("figure",{class:"ffz-i-cancel"})))))),(0,I.createElement)("div",{class:`ffz-il-tooltip ${u?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right"}`},this.i18n.t("site.menu_button","FrankerFaceZ Control Center"),this.has_update&&(0,I.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.update-desc","There is an update available. Please refresh your page.")),this.settings.disable_profiles&&(0,I.createElement)("div",{class:"tw-mg-t-1"},this.i18n.tList("site.menu_button.no-settings",'Settings are disabled in this tab due to the inclusion of "{param}" in the URL.',{param:(0,I.createElement)("code",{class:"ffz-monospace"},"?ffz-no-settings")})),this._new_settings>0&&(0,I.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.new-desc","There {count,plural,one {is one new setting} other {are # new settings}}.",{count:this._new_settings})),this.has_strings&&(0,I.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.strings","There {added,plural,one {is # new string} other {are # new strings}} and {changed,plural,one {# changed string} other {# changed strings}}.",{added:this.i18n.new_strings,changed:this.i18n.changed_strings})),K.DEBUG&&(0,I.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.main-dev-desc","You are running a developer build of FrankerFaceZ.")),C.has_dev&&(0,I.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.addon-dev-desc","You have loaded add-on data from a local development server.")))),(l||d)._ffz_toast_el=(0,I.createElement)("div",{class:`ffz-toast--container tw-absolute tw-block ${u?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right"}`,onmouseenter:this.pauseToasts,onmouseleave:this.unpauseToasts},y),this.has_update&&(0,I.createElement)("div",{class:"ffz-menu__extra-pill tw-absolute"},(0,I.createElement)("div",{class:`tw-pill ${this.important_update?"tw-pill--notification":""}`},(0,I.createElement)("figure",{class:"ffz-i-arrows-cw"}))),w&&(0,I.createElement)("div",{class:"ffz-menu__extra-pill tw-absolute"},(0,I.createElement)("div",{class:"tw-pill"},w)),a&&(0,I.createElement)("div",{class:"ffz-menu__pill tw-absolute"},(0,I.createElement)("div",{class:"tw-pill"},a))),u)d.insertBefore(A,d.firstElementChild);else{let F=d.lastElementChild;F&&F.classList.contains("resize-detector")&&(F=F.previousElementSibling),F?d.insertBefore(A,F):d.appendChild(A)}this._ctx_open&&this.renderContext(null,v)}handleClick(l,d){if(l.shiftKey)return K.DEBUG&&l.ctrlKey?requestAnimationFrame(()=>this.i18n.openUI()):this.resolve("main_menu").openPopout();this.emit(":clicked",l,d)}renderButtonIcon(l){const d=this.settings.main_context.hasProfile(l);return(0,I.createElement)("figure",{class:`ffz--profile__icon ${d?"ffz-i-ok":l.toggled?"ffz-i-minus":"ffz-i-cancel"}`})}renderButtonTip(l){return l.toggled?this.settings.main_context.hasProfile(l)?this.i18n.t("setting.profiles.active","This profile is enabled and active."):this.i18n.t("setting.profiles.disabled.rules","This profile is enabled, but inactive due to its rules."):this.i18n.t("setting.profiles.disabled","This profile is disabled.")}renderContext(l,d){if(l){if(l.shiftKey||l.ctrlKey)return;l.preventDefault()}const f=d.parentElement.parentElement,r=f.classList.contains("ffz-mod-view-button");let b=f.querySelector(".ffz--menu-context");if(b)if(b._ffz_destroy)b._ffz_destroy();else return;const u=B(()=>{this._ctx_open=!1,b._ffz_outside&&b._ffz_outside.destroy(),b.remove()},"destroy"),v=[];for(const A of this.settings.__profiles){const C=(0,I.createElement)("button",{class:"tw-flex-shrink-0 tw-mg-r-1 tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-relative ffz-tooltip ffz-tooltip--no-mouse","data-title":this.renderButtonTip(A),onClick:a=>{A.toggled=!A.toggled,(0,I.setChildren)(C,this.renderButtonIcon(A)),C.dataset.title=this.renderButtonTip(A),C._ffz_tooltip?.rerender&&C._ffz_tooltip.rerender(),this.emit("tooltips:cleanup"),a.preventDefault(),a.stopPropagation()}},this.renderButtonIcon(A)),y=A.desc_i18n_key||A.i18n_key&&`${A.i18n_key}.description`;v.push((0,I.createElement)("div",{class:"tw-relative tw-border-b tw-pd-y-05 tw-pd-x-1 tw-flex"},C,(0,I.createElement)("div",null,(0,I.createElement)("h4",null,A.i18n_key?this.i18n.t(A.i18n_key,A.name,A):A.name,A.ephemeral&&(0,I.createElement)("div",{class:"tw-inline tw-mg-l-05 ffz-il-tooltip__container ffz--profile-row__icon ffz-i-user-secret tw-relative"},(0,I.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},this.i18n.t("setting.profiles.ephemeral","This profile is ephemeral.")))),A.description&&(0,I.createElement)("div",{class:"description"},y?this.i18n.t(y,A.description,A):A.description))))}b=(0,I.createElement)("div",{class:`tw-absolute ffz-attached ${r?"ffz-attached--up ffz-attached--left":"ffz-attached--down ffz-attached--right"}`},(0,I.createElement)("div",{class:"ffz-balloon ffz-balloon--lg tw-block ffz--menu-context"},(0,I.createElement)("div",{class:"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4"},(0,I.createElement)("div",{class:"tw-c-text-base tw-elevation-1 tw-flex tw-flex-shrink-0 tw-pd-x-1 tw-pd-y-05 tw-popover-header"},(0,I.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--left"},(0,I.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},(0,I.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden",onDblClick:()=>{this.emit("site.player:reset"),u()}},(0,I.createElement)("span",{class:"tw-button-icon__icon"},(0,I.createElement)("figure",{class:"ffz-i-t-reset"}))),(0,I.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-left"},this.i18n.t("player.reset_button.all","Reset All Players (Double-Click)")))),(0,I.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-column tw-flex-grow-1 tw-justify-content-center"},(0,I.createElement)("h5",{class:"tw-align-center tw-c-text-alt tw-semibold"},this.i18n.t("site.menu_button.profiles","Profiles"))),(0,I.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--right"},(0,I.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},(0,I.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden",onClick:A=>{this.openSettings(A,d),u()}},(0,I.createElement)("span",{class:"tw-button-icon__icon"},(0,I.createElement)("figure",{class:"ffz-i-cog"}))),(0,I.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},this.i18n.t("setting.profiles.configure","Configure")))),(0,I.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--right"},(0,I.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",onClick:u},(0,I.createElement)("span",{class:"tw-button-icon__icon"},(0,I.createElement)("figure",{class:"ffz-i-cancel"}))))),(0,I.createElement)("div",{class:"center-window__long-scrollable-area scrollable-area scrollable-area--suppress-scroll-x","data-simplebar":!0},v)))),b._ffz_destroy=u,b._ffz_outside=new I.ClickOutside(b,u),f.appendChild(b),this._ctx_open=!0}openSettings(l,d){const f=this.resolve("main_menu");f&&(f.requestPage("data_management.profiles"),!f.showing&&this.emit(":clicked",l,d))}loadMenu(l,d,f){const r=this.resolve("main_menu");r&&(f&&r.requestPage(f),!r.showing&&(this.loading=!0,r.enable(l).then(()=>{this.loading=!1}).catch(b=>{this.log.capture(b),this.log.error("Error enabling main menu.",b),this.addError("site.menu_button.error","There was an error loading the FFZ Control Center. Please refresh and try again."),this.loading=!1,this.once(":clicked",this.loadMenu)})))}onDisable(){this.off("i18n:update",this.update),this.off(":clicked",this.loadMenu)}};B(p,"MenuButton");let x=p},94296:(me,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>I});var K=S(22527),M=S(46949);const O=class O extends K.default{constructor(...x){super(...x),this.inject("i18n"),this.inject("settings"),this.inject("site.channel"),this.inject("site.css_tweaks"),this.inject("site.fine"),this.inject("site.elemental"),this.inject("site.router"),this.inject("site.twitch_data"),this.inject("metadata"),this.inject("socket"),this.inject("pubsub"),this.should_enable=!0,this._cached_color=null,this._cached_channel=null,this._cached_id=null,this.Root=this.elemental.define("mod-view-root",".moderation-view-page",["mod-view"],{attributes:!0},1),this.ModInfoBar=this.elemental.define("mod-info-bar",".modview-player-widget__stream-info .simplebar-content",["mod-view"],{childNodes:!0,subtree:!0},1,3e4,!1),this.checkRoot=(0,M.debounce)(this.checkRoot,250),this.checkBar=(0,M.debounce)(this.checkBar,250)}onEnable(){this.Root.on("mount",this.updateRoot,this),this.Root.on("mutate",this.updateRoot,this),this.Root.on("unmount",this.removeRoot,this),this.Root.each(x=>this.updateRoot(x)),this.ModInfoBar.on("mount",this.updateBar,this),this.ModInfoBar.on("mutate",this.updateBar,this),this.ModInfoBar.on("unmount",this.removeBar,this),this.ModInfoBar.each(x=>this.updateBar(x)),this.router.on(":route",this.checkNavigation,this),this.checkNavigation()}updateSubscription(x,p){this._subbed_login===p&&this._subbed_id===x||(this._subbed_id&&(this.pubsub.unsubscribe(this,`twitch/${this._subbed_id}`),this._subbed_id=null),this._subbed_login&&(this.socket.unsubscribe(this,`channel.${this._subbed_login}`),this._subbed_login=null),x&&(this.pubsub.subscribe(this,`twitch/${x}`),this._subbed_id=x),p&&(this.socket.subscribe(this,`channel.${p}`),this._subbed_login=p))}checkNavigation(){this.router.current_name==="mod-view"&&(this.channel.updateChannelColor(this._cached_color),this.checkRoot())}checkBar(){this.ModInfoBar.clean()}checkRoot(){this.Root.each(x=>this.updateRoot(x))}updateRoot(x){const p=this.fine.getReactInstance(x);let _=null,l=p,d=0,f;for(;l!=null&&_==null&&d<10;){let r=l.memoizedState;for(f=0;r!=null&&_==null&&f<50;)_=r?.memoizedState?.current?.result?.data?.user??r?.memoizedState?.current?.previousData?.user,r=r?.next,f++;l=l?.child,d++}_?.id?this._cached_id!=_.id&&(this._cached_id=_.id,this._cached_channel=_,this._cached_color=null,this.updateSubscription(_.id,_.login),this.getChannelColor(x,_.id).then(r=>{this._cached_id==_.id&&(this._cached_color=r,this.channel.updateChannelColor(r),this.settings.updateContext({channelColor:r}))}).catch(()=>{this._cached_id==_.id&&(this._cached_color=null,this.channel.updateChannelColor(),this.settings.updateContext({channelColor:null}))}),this.settings.updateContext({channel:_.login,channelID:_.id})):this.removeRoot()}getChannelColor(x,p,_){const l=x._ffz_color_cache=x._ffz_color_cache||{};return p===l.channel_id&&Date.now()-l.saved<6e4?_?l.data:Promise.resolve(l.data):new Promise(async(d,f)=>{if(l.updating){l.updating.push([d,f]);return}l.channel_id=p,l.updating=[[d,f]];let r,b;try{r=await this.twitch_data.getChannelColor(p)}catch(v){r=null,b=v}const u=l.updating;if(l.updating=null,l.channel_id!==p){b=new Error("Outdated"),l.channel_id=null,l.data=null,l.saved=0;for(const v of u)v[1](b);return}l.data=r,l.saved=Date.now();for(const v of u)b?v[1](b):v[0](r)})}removeRoot(){this._cached_id=null,this._cached_channel=null,this._cached_color=null,this.updateSubscription(),this.channel.updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})}updateBar(x){const p=x.closest(".modview-player-widget__stream-info"),_=p&&this.fine.getReactInstance(p);let l=null,d=_?.return?.memoizedState,f=0;for(;d!=null&&l==null&&f<50;)l=d?.memoizedState?.current?.result?.data?.channel??d?.memoizedState?.current?.previousData?.channel,d=d?.next,f++;const r=l?.lastBroadcast,b=r?.title,u=r?.game;if(this._cached_bar_id!=l?.id&&(this._cached_bar_id=l?.id,this._cached_bar_channel=l),(b!=x._cached_title||u?.id!=x._cached_game)&&(x._cached_title=b,x._cached_game=u?.id,this.settings.updateContext({category:u?.name,categoryID:u?.id,title:b})),p){if(!p._ffz_cont){const v=p._ffz_cont=p.querySelector(".modview-player-widget__viewcount");v&&v.classList.add("ffz--mod-tray")}this.updateMetadata(p)}}removeBar(x){this.settings.updateContext({category:null,categoryID:null,title:null});const p=x.closest(".modview-player-widget__stream-info");if(p){if(p._ffz_cont&&p._ffz_cont.classList.remove("ffz--mod-tray"),p._ffz_cont=null,p._ffz_meta_timers){for(const _ of Object.values(p._ffz_meta_timers))clearTimeout(_);p._ffz_meta_timers=null}p._ffz_update=null}}updateMetadata(x,p){const _=x._ffz_cont,l=this._cached_bar_channel;if(!_||!document.contains(_)){this.checkBar();return}if(!l?.id)return;p?Array.isArray(p)||(p=[p]):p=this.metadata.keys;const d=x._ffz_meta_timers=x._ffz_meta_timers||{},f=B(b=>this.updateMetadata(x,b),"refresh_fn"),r={channel:{id:l.id,login:l.login,display_name:l.displayName},el:x,getViewerCount:()=>0,getUserSelfImmediate:()=>null,getUserSelf:()=>null,getBroadcastID:()=>null};for(const b of p)this.metadata.definitions[b].modview&&this.metadata.renderLegacy(b,r,_,d,f)}};B(O,"ModView");let I=O},63155:(me,te,S)=>{"use strict";S.r(te),S.d(te,{PLAYER_ROUTES:()=>M,default:()=>I});var K=S(10789);const M=["front-page","user","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following","dash","squad","command-center","dash-stream-manager","mod-view","user-home"],O=class O extends K.Z{constructor(...x){super(...x),this.should_enable=!0,this.inject("site.router"),this.inject("metadata"),this.DataSource=this.fine.define("data-source",p=>p.consentMetadata&&p.onPlaying&&p.props&&p.props.data,M),this.Player=this.fine.define("highwind-player",p=>p.setPlayerActive&&p.props?.playerEvents&&p.props?.mediaPlayerInstance,M),this.TheatreHost=this.fine.define("theatre-host",p=>p.toggleTheatreMode&&p.props&&p.props.onTheatreModeEnabled,["user","user-home","video","user-video","user-clip"]),this.PlayerSource=this.fine.define("player-source",p=>p.setSrc&&p.setInitialPlaybackSettings,M)}repositionPlayer(){if(!this._mover){const x=document.querySelector(".channel-root__player");this._mover=this.fine.searchNode(x,p=>p.memoizedProps?.triggerPlayerReposition,50)}this._mover&&this._mover.memoizedProps.triggerPlayerReposition()}registerSettings(){super.registerSettings(),this.settings.add("player.home.autoplay",{default:!0,ui:{path:"Player > General >> Playback",title:"Auto-play featured broadcasters on the front page.",component:"setting-check-box"}}),this.settings.add("player.theatre.no-whispers",{default:!1,requires:["whispers.show"],process(x,p){return x.get("whispers.show")?p:!0},ui:{path:"Player > General >> Theatre Mode",title:"Hide whispers when Theatre Mode is enabled.",component:"setting-check-box"},changed:x=>this.css_tweaks.toggle("theatre-no-whispers",x)}),this.settings.add("player.theatre.metadata",{default:!1,requires:["context.route.name","layout.is-theater-mode"],process(x,p){return!x.get("layout.is-theater-mode")||x.get("context.route.name")==="video"?!1:p},ui:{path:"Player > General >> Theatre Mode",title:"Show metadata when mousing over the player.",component:"setting-check-box"},changed:x=>this.css_tweaks.toggle("theatre-metadata",x)}),this.settings.add("player.theatre.auto-enter",{default:!1,ui:{path:"Player > General >> Theatre Mode",title:"Automatically open Theatre Mode when visiting a channel.",component:"setting-check-box"}}),this.settings.add("player.fullscreen.auto-chat",{default:!1,ui:{path:"Player > General >> Fullscreen",title:"Automatically expand chat when entering fullscreen mode.",component:"setting-check-box"}}),this.settings.add("player.hide-event-bar",{default:!1,ui:{path:"Channel > Appearance >> General",title:"Hide the Event Bar",description:"Hide the Event Bar which appears above the player when there is an ongoing event for the current channel.",component:"setting-check-box"},changed:x=>{this.css_tweaks.toggleHide("player-event-bar",x),this.repositionPlayer()}})}async onEnable(){await super.onEnable(),this.css_tweaks.toggle("theatre-no-whispers",this.settings.get("player.theatre.no-whispers")),this.css_tweaks.toggle("theatre-metadata",this.settings.get("player.theatre.metadata")),this.css_tweaks.toggleHide("player-event-bar",this.settings.get("player.hide-event-bar")),this.on(":fix-player",this.repositionPlayer,this),this.on("site:fullscreen",this.maybeOpenChat,this),this.TheatreHost.on("mount",x=>{x._ffz_theater_start=Date.now(),this.tryTheatreMode(x)}),this.TheatreHost.on("update",this.tryTheatreMode,this),this.TheatreHost.ready((x,p)=>{const _=Date.now();for(const l of p)l._ffz_theater_start=_,this.tryTheatreMode(l)}),this.PlayerSource.on("mount",this.checkCarousel,this),this.PlayerSource.on("update",this.checkCarousel,this)}maybeOpenChat(){this.settings.get("player.fullscreen.auto-chat")&&this.parent.awaitElement(".right-column--collapsed .right-column__toggle-visibility button",document.fullscreenElement,1e3).then(x=>x.click())}shouldStopAutoplay(){return this.settings.get("player.no-autoplay")||!this.settings.get("player.home.autoplay")&&this.router.current?.name==="front-page"}checkCarousel(x){}getData(){return this.DataSource.first}tryTheatreMode(x){x._ffz_theater_timer||(x._ffz_theater_timer=setTimeout(()=>{x._ffz_theater_timer=null,!(!this.settings.get("player.theatre.auto-enter")||!x._ffz_mounted)&&this.router.current_name==="user"&&(x.props.channelHomeLive||x.props.channelHomeCarousel||x.props.theatreModeEnabled||Date.now()-(x._ffz_theater_start||0)>2e3||x.props.onTheatreModeEnabled&&x.props.onTheatreModeEnabled())},250))}repositionPlayer(){}updateSquadContext(){this.settings.updateContext({squad_bar:this.hasSquadBar})}get hasSquadBar(){return!1}};B(O,"Player");let I=O},24020:(me,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>d});var K=S(22527),M=S(44589),I=S(14873);const O=S.p+"color_normalizer.css",W=["product","prime","turbo"],x=[-.62,-.578,-.539,-.469,-.4,-.32,-.21,-.098,0,.08,.151,.212,.271,.31,.351],p=":root{color-scheme: only light}",_=":root{forced-color-adjust: none}",l={dark:{c:{"background-brand":11,"background-accent":8,"background-accent-alt":7,"background-accent-alt-2":6,"background-button":7,"background-button-active":7,"background-button-focus":8,"background-button-hover":8,"background-button-primary-active":7,"background-button-primary-default":9,"background-button-primary-hover":8,"background-chat":1,"background-chat-alt":3,"background-chat-header":2,"background-graph":2,"background-graph-fill":8,"background-input-checkbox-checked":10,"background-input-checked":8,"background-interactable-selected":9,"background-modal":3,"background-progress-countdown-status":9,"background-progress-status":9,"background-range-fill":10,"background-subscriber-stream-tag-active":4,"background-subscriber-stream-tag-default":4,"background-subscriber-stream-tag-hover":3,"background-toggle-checked":2,"background-toggle-handle-checked":10,"background-top-nav":6,"border-brand":9,"border-button":7,"border-button-active":8,"border-button-focus":9,"border-button-hover":8,"border-input-checkbox-checked":10,"border-input-checkbox-focus":10,"border-input-focus":10,"border-interactable-selected":10,"border-range-handle":10,"border-subscriber-stream-tag":5,"border-tab-active":11,"border-tab-focus":11,"border-tab-hover":11,"border-toggle-checked":10,"border-toggle-focus":10,"border-whisper-incoming":10,"fill-brand":9,"text-button-text-active":"o2","text-link":10,"text-link-active":10,"text-link-focus":10,"text-link-hover":10,"text-link-visited":10,"text-overlay-link-active":13,"text-overlay-link-focus":13,"text-overlay-link-hover":13,"text-tab-active":11,"text-toggle-checked-icon":10,"text-tooltip":1,"text-button-text":10},s:{"button-active":[8," 0 0 6px 0",""],"button-focus":[8," 0 0 6px 0",""],input:[5," inset 0 0 0 1px",""],"input-focus":[8," 0 0 10px -2px",""],"interactable-focus":[8," 0 0 6px 0",""],"tab-focus":[11," 0 4px 6px -4px",""]}},light:{c:{"background-accent":8,"background-accent-alt":7,"background-accent-alt-2":6,"background-button":7,"background-button-active":7,"background-button-focus":8,"background-button-hover":8,"background-button-primary-active":7,"background-button-primary-default":9,"background-button-primary-hover":8,"background-chat":1,"background-chat-alt":3,"background-chat-header":2,"background-graph":15,"background-graph-fill":9,"background-input-checkbox-checked":9,"background-input-checked":8,"background-interactable-selected":9,"background-modal":3,"background-progress-countdown-status":8,"background-progress-status":8,"background-range-fill":9,"background-subscriber-stream-tag-active":13,"background-subscriber-stream-tag-default":13,"background-subscriber-stream-tag-hover":14,"background-toggle-checked":15,"background-top-nav":7,"background-toggle-handle-checked":10,"border-brand":9,"border-button":7,"border-button-active":8,"border-button-focus":9,"border-button-hover":8,"border-input-checkbox-checked":9,"border-input-checkbox-focus":9,"border-input-focus":9,"border-interactable-selected":9,"border-range-handle":9,"border-subscriber-stream-tag":10,"border-tab-active":8,"border-tab-focus":8,"border-tab-hover":8,"border-toggle-checked":9,"border-toggle-focus":9,"border-whisper-incoming":10,"fill-brand":9,"text-button-text-active":"o2","text-link":8,"text-link-active":9,"text-link-focus":9,"text-link-hover":9,"text-link-visited":9,"text-overlay-link-active":13,"text-overlay-link-focus":13,"text-overlay-link-hover":13,"text-tab-active":8,"text-toggle-checked-icon":9,"text-tooltip":1,"text-button-text":8,"background-tooltip":1,"text-button-text-focus":"o1","text-button-text-hover":"o1"},s:{"button-active":[8," 0 0 6px 0",""],"button-focus":[8," 0 0 6px 0",""],input:[5," inset 0 0 0 1px",""],"input-focus":[10," 0 0 10px -2px",""],"interactable-focus":[8," 0 0 6px 1px",""],"tab-focus":[8," 0 4px 6px -4px",""]}},accent_dark:{c:{"accent-hover":10,accent:9,"accent-primary-1":1,"accent-primary-2":5,"accent-primary-3":6,"accent-primary-4":7,"accent-primary-5":8},s:{}},accent_light:{c:{"accent-hover":10,accent:9,"accent-primary-1":1,"accent-primary-2":5,"accent-primary-3":6,"accent-primary-4":7,"accent-primary-5":8},s:{}}},f=class f extends K.default{constructor(...b){super(...b),this.inject("settings"),this.inject("site"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject("site.router"),this.should_enable=!0,this.settings.add("theme.high-contrast-tweaks",{default:null,requires:["context.is-forced-colors","theme.disable-high-contrast"],process(u,v){return v===null?u.get("theme.disable-high-contrast")?!1:u.get("context.is-forced-colors")??!1:v},ui:{path:"Appearance > Theme >> Tweaks",title:"Enable the use of High Contrast tweaks.",description:"This loads an additional set of styles when Forced Color / OS High Contrast mode is enabled to ensure page elements are displayed more appropriately.",component:"setting-check-box"}}),this.settings.add("theme.disable-high-contrast",{default:!1,ui:{path:"Appearance > Theme >> Tweaks",title:"Disable Forced Color / OS High Contrast",component:"setting-check-box",description:"Enabling this will instruct your browser to not respect your operating system's High Contrast settings when displaying Twitch. You may need to refresh for this to take full effect."},changed:()=>this.updateCSS()}),this.settings.add("theme.disable-auto-dark",{default:!1,ui:{path:'Appearance > Theme >> Tweaks @{"sort": 10}',title:"Disable Auto Dark Theme",component:"setting-check-box",description:"Enabling this will attempt to disable a browser's built-in automatic dark theme conversion for websites, which is unnecessary on Twitch and can cause display issues. This may not apply depending on your web browser and settings."},changed:()=>this.updateCSS()}),this.settings.add("theme.legacy-dark-input",{default:!1,ui:{path:"Appearance > Theme >> Tweaks",title:"Use old input element colors with dark theme.",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("theme.font.size",{default:13,process(u,v){if(typeof v!="number")try{v=parseFloat(v)}catch{v=null}return(!v||v<1||isNaN(v)||!isFinite(v)||v>25)&&(v=13),v},ui:{path:'Appearance > Theme >> Fonts @{"sort": 2}',title:"Font Size",description:"**Minimum:** `1`, **Maximum:** `25`, *Old Default:* `12`\n\nHow large should normal text be, in pixels. This may be affected by your browser's zoom and font settings.",component:"setting-text-box",type:"number"},changed:()=>this.updateFont()}),this.settings.add("theme.color.background",{default:"",ui:{path:'Appearance > Theme >> Colors @{"sort": 0, "description": "This is a quick preview of a new system coming soon to FrankerFaceZ. Expect heavy changes here, including separate Basic and Advanced modes, and better color selection."}',title:"Background",description:"Try `#0E0C13` for something close to the old dark theme, or `#0E0E0E` for a nice dark gray. Transparent colors not allowed.",component:"setting-color-box",sort:0,alpha:!1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.text",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Text",description:"If not set, this will automatically be set to white or black based on the brightness of the background.",component:"setting-color-box",sort:1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.accent",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Accent",description:"The accent color is used for buttons, links, etc.",component:"setting-color-box",alpha:!1,sort:2},changed:()=>this.updateCSS()}),this.settings.add("theme.color.tooltip.background",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Tooltip Background",description:"If not set, the tooltip settings will be automatically adjusted based on the brightness of the background.",component:"setting-color-box",alpha:!0,sort:10},changed:()=>this.updateCSS()}),this.settings.add("theme.color.tooltip.text",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Tooltip Text",component:"setting-color-box",sort:11},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-background",{default:"",ui:{path:'Appearance > Theme >> Chat Colors @{"sort":1}',title:"Background",component:"setting-color-box",sort:0,alpha:!1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-text",{default:"",ui:{path:"Appearance > Theme >> Chat Colors",title:"Text",description:"If not set, this will automatically be set to white or black based on the brightness of the background.",component:"setting-color-box",sort:1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-accent",{default:"",ui:{path:"Appearance > Theme >> Chat Colors",title:"Accent",description:"The accent color is used for buttons, links, etc.",component:"setting-color-box",alpha:!1,sort:2},changed:()=>this.updateCSS()}),this.settings.add("theme.can-dark",{requires:["context.route.name"],process(u){return!W.includes(u.get("context.route.name"))}}),this.settings.add("theme.is-dark",{requires:["context.force-dark","theme.can-dark","context.ui.theme","context.ui.theatreModeEnabled","context.route.name","context.location.search"],process(u){const v=u.get("context.force-theme");return v??(u.get("context.route.name")==="embed-chat"?(u.get("context.location.search")||"").includes("dark"):u.get("context.ui.theatreModeEnabled")||u.get("theme.can-dark")&&u.get("context.ui.theme")===1)},changed:()=>this.updateCSS()}),this.settings.add("theme.tooltips-dark",{requires:["theme.is-dark"],process(u){return!u.get("theme.is-dark")}}),this._style=null,this._normalizer=null}updateFont(){let b=this.settings.get("theme.font.size");if(typeof b=="string"&&/^[0-9.]+$/.test(b)?b=parseFloat(b):typeof b!="number"&&(b=null),!b||isNaN(b)||!isFinite(b)||b<1||b===13){this.css_tweaks.delete("font-size");return}b=b/10,this.css_tweaks.set("font-size",`html body {
	--font-size-1: ${4.153846153846154*b}rem;
	--font-size-2: ${2.769230769230769*b}rem;
	--font-size-3: ${1.8461538461538463*b}rem;
	--font-size-4: ${1.3846153846153846*b}rem;
	--font-size-5: ${1.0769230769230769*b}rem;
	--font-size-6: ${b}rem;
	--font-size-7: ${.9230769230769231*b}rem;
	--font-size-8: ${.9230769230769231*b}rem;
	--font-size-base: ${b}rem;
}
`)}generateBackgroundTextBlob(b){const u=b.toHSLA(),v=u.l,A=v<.5;return this.generateBackgroundBlob(b)+this.generateTextBlob(I.Color.RGBA.fromCSS(A?"#FFF":"#000"))}generateBackgroundBlob(b){const u=b.toHSLA(),v=u.l,A=v<.5;return[`--color-background-body:${b.toCSS()};`,`--color-background-input-focus:${b.toCSS()};`,`--color-background-base:${u._l(v+(A?.05:-.05)).toCSS()};`,`--color-background-alt:${u._l(v+(A?.1:-.1)).toCSS()};`,"--color-background-float:var(--color-background-alt);",`--color-background-alt-2:${u._l(v+(A?.15:-.15)).toCSS()};`].join("")}generateTextBlob(b){b.a<.4&&(b=b._a(.4));const u=b.a;return[`--color-text-base:${b.toCSS()};`,`--color-text-input:${b.toCSS()};`,`--color-text-label:${b.toCSS()};`,`--color-text-label-optional:${b._a(u-.4).toCSS()};`,`--color-text-alt:${b._a(u-.2).toCSS()};`,`--color-text-alt-2:${b._a(u-.4).toCSS()};`].join("")}generateAccentBlob(b,u){b.a<1&&(b=b._a(1));const v=b.toHSLA(),A=v.l,C=x.map(F=>F===0?b.toCSS():v._l(A+F).toCSS()),y=[],a=[];for(let F=0;F<C.length;F++)y.push(`--ffz-color-accent-${F+1}:${C[F]};`);let w=u?l.dark:l.light;for(const[F,D]of Object.entries(w.c))typeof D=="number"&&y.push(`--color-${F}:${C[D-1]};`);w=u?l.accent_dark:l.accent_light;for(const[F,D]of Object.entries(w.c))typeof D=="number"&&a.push(`--color-${F}:${C[D-1]} !important;`);return[y.join(""),a.join("")]}updateCSS(){if(this.settings.get("theme.disable-high-contrast")?this.css_tweaks.set("nofc",_):this.css_tweaks.delete("nofc"),this.settings.get("theme.disable-auto-dark")?this.css_tweaks.set("nodark",p):this.css_tweaks.delete("nodark"),this.css_tweaks.setVariable("border-color","var(--color-border-base)"),!this.settings.get("theme.can-dark")){this.toggleNormalizer(!1),this.toggleAccentNormal(!0),this.css_tweaks.delete("colors");return}let b=this.settings.get("theme.is-dark");const u=[],v=[],A=I.Color.RGBA.fromCSS(this.settings.get("theme.color.background"));if(A){A.a=1;const ce=A.toHSLA();b=ce.l<.5;try{const ve=this.resolve("site").store,Re=ve.getState().ui.theme,oe=b?1:0;Re!==oe&&ve.dispatch({type:"core.ui.THEME_CHANGED",theme:oe})}catch(ve){this.log.warning("Unable to automatically set the Twitch Dark Theme state.",ve)}u.push(this.generateBackgroundBlob(ce)),b&&(u.push("--color-border-base: var(--color-opac-gl-2);"),u.push("--color-background-interactable-hover: var(--color-opac-gl-1);"),u.push("--color-background-interactable-active: var(--color-opac-gl-2);"),u.push("--color-background-button-text-hover: var(--color-opac-gl-1);"),u.push("--color-background-button-text-active: var(--color-opac-gl-2);"))}let C=I.Color.RGBA.fromCSS(this.settings.get("theme.color.text"));!C&&A&&(C=I.Color.RGBA.fromCSS(b?"#FFF":"#000")),C&&u.push(this.generateTextBlob(C)),b&&this.settings.get("theme.legacy-dark-input")&&u.push(`--color-background-input: var(--color-opac-w-4);
--color-background-input-overlay: var(--color-opac-b-4);
--color-background-input-overlay-focus: var(--color-black);
--color-background-selectable: var(--color-opac-w-3);
--color-background-selectable-hover: var(--color-opac-w-4);
--color-border-input: var(--color-opac-w-4);
--color-border-input-hover: var(--color-opac-w-6);
--color-border-input-overlay: var(--color-opac-w-6);
--color-border-input-overlay-hover: var(--color-opac-w-8);
--color-border-input-checkbox: var(--color-opac-w-10);
--color-border-selectable: var(--color-opac-w-2);
--color-border-selectable-hover: var(--color-opac-w-3);`);const y=I.Color.RGBA.fromCSS(this.settings.get("theme.color.accent"));if(this.toggleAccentNormal(!y),y){const ce=this.generateAccentBlob(y,b);u.push(ce[0]),v.push(ce[1])}let a=I.Color.RGBA.fromCSS(this.settings.get("theme.color.tooltip.background")),w;!a&&A&&(a=I.Color.RGBA.fromCSS(b?"#FFF":"#000")),a?(u.push(`--color-background-tooltip: ${a.toCSS()};`),w=a.toHSLA().l<.5):w=!b;let F=I.Color.RGBA.fromCSS(this.settings.get("theme.color.tooltip.text"));const D=F||a;if(F||(F=I.Color.RGBA.fromCSS(w?"#FFF":"#000")),F){D&&u.push(`--color-text-tooltip: ${F.toCSS()};`);const ce=F.toHSLA(),be=ce.a;u.push(`--color-text-tooltip-alt: ${ce._a(be-.2).toCSS()};`),u.push(`--color-text-tooltip-alt-2: ${ce._a(be-.4).toCSS()};`)}const z=[],$=I.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-background"));let J=b;if($){$.a=1;const ce=$.toHSLA();J=ce.l<.5,z.push(this.generateBackgroundBlob(ce))}let Z=I.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-text"));!Z&&$&&(Z=I.Color.RGBA.fromCSS(J?"#FFF":"#000")),Z&&z.push(this.generateTextBlob(Z));const G=I.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-accent")),Q=[];if(G){const ce=this.generateAccentBlob(G,J);z.push(ce[0]),Q.push(ce[1])}z.length?this.css_tweaks.set("chat-colors",`.moderation-view-page-widget .stream-chat,.chat-shell {${z.join(`
`)}}.moderation-view-page-widget .stream-chat .tw-accent-region,.chat-shell .tw-accent-region{${Q.join(`
`)}}`):this.css_tweaks.delete("chat-colors"),this.toggleNormalizer(z.length||u.length);const se=b?"":":not(.settings-menu-button-component--forced-dark-theme)";u.length?this.css_tweaks.set("colors",`body,body .tw-root--theme-light,body .tw-root--theme-dark${se} {${u.join(`
`)}}.channel-info-content .tw-accent-region,.channel-info-content div[class^="ScAccentRegion"]{${v.join(`
`)}}`):this.css_tweaks.delete("colors")}toggleAccentNormal(b){if(b){const u=[];for(let v=0;v<15;v++)u.push(`--ffz-color-accent-${v+1}:var(--color-twitch-purple-${v+1});`);this.css_tweaks.set("accent-normal",`body {${u.join(`
`)}}`)}else this.css_tweaks.delete("accent-normal")}toggleNormalizer(b){if(this._normalizer){if(!b){this._normalizer.remove();return}}else{if(!b)return;this._normalizer=(0,M.createElement)("link",{rel:"stylesheet",type:"text/css",href:O})}document.head.contains(this._normalizer)||document.head.appendChild(this._normalizer)}onEnable(){let b;try{b=window.matchMedia("(forced-colors: active)")?.matches}catch{}this.settings.updateContext({"is-forced-colors":b??!1}),this.settings.getChanges("theme.high-contrast-tweaks",u=>{this.css_tweaks.toggle("hc-tweaks",u)}),this.updateCSS(),this.updateFont()}};B(f,"ThemeEngine");let d=f},4948:(me,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>l});var K=S(46949),M=S(83269),I=S(6172),O=S(22527),W=S(24431);const x=/^([^\s]+) subscribed ([^.]+)\. They've subscribed for (\d+) months(?:[^!]+streak)?!/,p={1e3:1,2e3:2,3e3:3};function _(f){try{/^[\d-]+$/.test(f)&&(f=parseInt(f,10))}catch{}return(typeof f!="number"||isNaN(f)||!isFinite(f))&&(f=0),f}B(_,"parseParamInt");const d=class d extends O.default{constructor(...r){super(...r),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site"),this.inject("site.router"),this.inject("site.fine"),this.inject("chat"),this.inject("chat.emotes"),this.inject("chat.overrides"),this.injectAs("site_chat","site.chat"),this.inject("site.chat.chat_line.rich_content"),this.VideoChatController=this.fine.define("video-chat-controller",b=>b.onError&&b.videoData&&b.props?.comments,["user-video","user-clip","video"]),this.VideoChatLine=this.fine.define("video-chat-line",b=>b.onTimestampClickHandler&&b.props?.messageContext,["user-video","user-clip","video"]),this.settings.add("chat.video-chat.timestamps",{default:!0,ui:{path:"Chat > Chat on Videos >> Appearance",title:"Display timestamps alongside chat messages.",component:"setting-check-box"}}),this.settings.add("chat.video-chat.enabled",{default:!0,ui:{path:'Chat > Chat on Videos @{"description": "This feature is currently in beta. As such, you may experience issues when using FFZ features with Chat on Videos."} >> General',title:"Enable FrankerFaceZ features for Chat on Videos.",description:"Display FFZ badges, emotes, and other features in Chat on Videos. Moderation features may be unavailable when this is enabled.",component:"setting-check-box"}}),this.active_room=null}async onEnable(){var A;this.chat.context.on("changed:chat.video-chat.enabled",this.rerenderLines,this),this.chat.context.on("changed:chat.video-chat.timestamps",this.rerenderLines,this),this.on("chat.overrides:changed",C=>this.updateLinesByUser(C,null,!1,!1),this),this.on("chat:update-lines-by-user",this.updateLinesByUser,this),this.on("chat:update-line",this.updateLineById,this),this.on("chat:update-lines",this.updateLines,this),this.on("chat:rerender-lines",this.rerenderLines,this),this.on("chat:update-line-tokens",this.updateLineTokens,this),this.on("chat:update-line-badges",this.updateLineBadges,this),this.on("i18n:update",this.rerenderLines,this),this.on("chat.emotes:update-effects",this.checkEffects,this);for(const C of W.RERENDER_SETTINGS)this.chat.context.on(`changed:${C}`,this.rerenderLines,this);for(const C of W.UPDATE_TOKEN_SETTINGS)this.chat.context.on(`changed:${C}`,this.updateLineTokens,this);for(const C of W.UPDATE_BADGE_SETTINGS)this.chat.context.on(`changed:${C}`,this.updateLineBadges,this);this.on("chat:get-messages",(C,y,a,w)=>{if(a)for(const F of this.VideoChatLine.instances){const D=F.props.messageContext;D.comment?._ffz_message&&w.push({message:D.comment._ffz_message,_instance:F,update:()=>F.forceUpdate()})}}),this.VideoChatController.on("mount",this.chatMounted,this),this.VideoChatController.on("unmount",this.chatUnmounted,this),this.VideoChatController.on("receive-props",this.chatUpdated,this),this.VideoChatController.ready((C,y)=>{for(const a of y)this.chatMounted(a)});const r=this,b=await this.site.findReact();if(!b)return;const u=b.createElement,v=this.rich_content&&this.rich_content.RichContent;this.MenuContainer=(A=class extends b.Component{constructor(y){super(y),this.onBanUser=()=>{this.props.onBanUserClick({bannedUser:this.props.context.comment.commenter,targetChannel:this.props.context.comment.channelId,comment:this.props.context.comment})},this.onDeleteComment=()=>{this.props.onDeleteCommentClick(this.props.context.comment)},this.onOpen=()=>{this.props.onDisableSync(),this.setState({force:!0})},this.onClose=()=>{this.setState({force:!1})},this.state={force:!1}}render(){return null}},B(A,"FFZMenuContainer"),A),this.VideoChatLine.ready(C=>{const y=C.prototype.render;C.prototype.ffzRenderMessage=function(a,w){const F=a.is_action,D=F?r.chat.context.get("chat.me-style"):0,z=D>=2,$=D===1||D===3,J=a.user,Z=r.overrides.getColor(J.id)||J.color,G=r.site_chat.colors.process(Z),Q=r.site.getUser();Q&&(Q.moderator=this.props.isCurrentUserModerator,Q.staff=Q.roles&&Q.roles.isStaff);let se;if(a.system_msg===!0){const ne=a.params||{};if(ne["msg-id"]==="resub"){const ze=r.chat.context.get("chat.subs.show"),Me=_(ne["msg-param-months"]),Pe=_(ne["msg-param-cumulative-months"]),Le=Pe||Me;if(r.log.info("resub-notice setting:",ze,"months:",Le,"cumulative:",Pe,"raw:",Me),r.log.info("-> params:",ne),ze===3||Le>1&&ze>0){const Ge=_(ne["msg-param-should-share-streak"])===1,Ye=ne["msg-param-sub-plan"],Ke=Ye==="Prime",ht=p[Ye]||1;r.log.info("-> share:",Ge,"plan:",Ye,"tier:",ht),se=r.i18n.tList("chat.sub.main","{user} subscribed {plan}. ",{user:u("span",{class:"tw-c-text-base tw-strong"},J.displayName),plan:Ke?r.i18n.t("chat.sub.twitch-prime","with Prime Gaming"):r.i18n.t("chat.sub.plan","at Tier {tier}",{tier:ht})}),Ge&&Me>1?se.push(r.i18n.t("chat.sub.cumulative-months","They've subscribed for {cumulative,number} months, currently on a {streak,number} month streak!",{cumulative:Pe,streak:Me})):Le>1&&se.push(r.i18n.t("chat.sub.months","They've subscribed for {count,number} months!",{count:Le}))}}}else a.system_msg&&(se=a.system_msg);const ce=a.ffz_tokens=a.ffz_tokens||r.chat.tokenizeMessage(a,Q),be=v&&r.chat.pluckRichContent(ce,a),ve=r.chat.formatUser(J,u),Re=r.overrides.getName(J.id);let oe=a.ffz_user_class;oe instanceof Set?oe=[...oe].join(" "):Array.isArray(oe)&&(oe=oe.join(" "));const ie={className:`video-chat__message-author notranslate${Re?" ffz--name-override tw-relative ffz-il-tooltip__container":""} ${oe??""}`,"data-test-selector":"comment-author-selector",href:`/${J.login}`,rel:"noopener noreferrer",target:"_blank",style:{color:G}};a.ffz_user_props&&Object.assign(ie,a.ffz_user_props),a.ffz_user_style&&Object.assign(ie.style,a.ffz_user_style);const ae=u("a",ie,Re?[u("span",{className:"chat-author__display-name"},Re),u("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},ve)]:ve);let xe=u("div",{class:"tw-flex-grow-1","data-room-id":a.roomID,"data-room":a.roomLogin,"data-user-id":J.id,"data-user":J.login},u("span",{class:"chat-line__message--badges"},r.chat.badges.render(a,u)),ae,u("div",{"data-test-selector":"comment-message-selector",class:"tw-inline video-chat__message"},u("span",null,F?" ":": "),u("span",{class:`message ${z?"chat-line__message-body--italicized":""}`,style:{color:$?G:null}},r.chat.renderTokens(ce,u)),be&&u(v,be)));return se&&(xe=u("div",{class:"tw-flex-grow-1"},u("div",{class:"tw-flex tw-c-text-alt-2"},u("div",null,se)),xe)),u("div",{class:"tw-align-items-start tw-flex tw-flex-nowrap tw-c-text-base"},xe,w?u(r.MenuContainer,{context:w,isCurrentUserModerator:this.props.isCurrentUserModerator,isExpandedLayout:this.props.isExpandedLayout,onBanUserClick:this.props.onBanUserClick,onDeleteCommentClick:this.props.onDeleteCommentClick,onDisableSync:this.props.onDisableSync,onReplyClick:this.onReplyClickHandler}):null)},C.prototype.ffzRenderExpanded=function(a){return a._reply_handler||(a._reply_handler=()=>this.onReplyClickHandler(a.user.login)),u("div",{class:"tw-align-items-center tw-flex tw-pd-t-05"},u("button",{class:"tw-button tw-button--text","data-test-selector":"parent-reply-button",onClick:a._reply_handler},u("span",{class:"tw-button__text tw-pd-0"},r.i18n.t("video-chat.reply","Reply"))),u("span",{class:"tw-c-text-alt-2 tw-font-size-7 tw-mg-l-05 tw-relative ffz-il-tooltip__container"},"\u2022 ",r.i18n.t("video-chat.time","{time,humantime} ago",{time:a.timestamp}),u("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-center ffz-il-tooltip--up",role:"tooltip"},r.i18n.formatDateTime(a.timestamp,"full"))))},C.prototype.render=function(){try{if(this._ffz_no_scan=!0,this.state?.showReplyForm||!r.chat.context.get("chat.video-chat.enabled"))return y.call(this);const a=this.props.messageContext,w=r.standardizeMessage(a.comment,a.author),F=this.ffzRenderMessage(w,a),D=this.props.hideTimestamp||!r.chat.context.get("chat.video-chat.timestamps"),z=w.mentioned&&w.mention_color?r.site_chat.inverse_colors.process(w.mention_color):null;if(w.ffz_removed)return null;const $=!z&&w.highlight&&r.chat.context.get("chat.points.allow-highlight");return u("div",{"data-test-selector":"message-layout",class:`tw-align-items-start tw-flex tw-flex-nowrap tw-full-width tw-pd-l-05 tw-pd-y-05 vod-message${w.is_sub?" ffz-notice-line ffz--subscribe-line":""}${w.highlight?" ffz-notice-line ffz--points-line":""}${$?" ffz--points-highlight ffz-custom-color":""}${w.mentioned?" ffz-mentioned":""}${z?" ffz-custom-color":""}`,style:{backgroundColor:z}},D||u("div",{"data-test-selector":"message-timestamp",class:"tw-align-right tw-flex tw-flex-shrink-0 vod-message__header"},u("div",{class:"tw-mg-r-05"},u("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},u("button",{class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this.onTimestampClickHandler},u("div",{class:"tw-pd-x-05"},u("p",{class:"tw-font-size-7"},(0,M.print_duration)(a.comment.contentOffset)))),u("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-left ffz-il-tooltip--up",role:"tooltip"},r.i18n.t("video-chat.jump","Jump to Video"))))),u("div",{class:"tw-full-width"},F,this.props.isExpandedLayout&&this.ffzRenderExpanded(w),a.replies&&a.replies.length>0&&u("div",{class:"qa-vod-chat-reply tw-mg-l-05 tw-mg-y-05 vod-message__reply"},a.comment.moreReplies&&u("div",{class:"tw-inline-block vod-message__show-more-replies"},u("button",{class:"tw-interactive tw-button tw-button--text",onClick:this.onLoadMoreRepliesClickHandler},u("span",{class:"tw-button__text","data-a-target":"tw-button-text"},r.i18n.t("video-chat.show-more","Show more replies...")))),u("ul",null,a.replies.map(J=>u("li",{key:J.comment&&J.comment.id,class:"tw-mg-l-05"},this.ffzRenderMessage(r.standardizeMessage(J.comment,J.author),J),this.props.isExpandedLayout&&this.ffzRenderExpanded(w)))))))}catch(a){return r.log.error("Problem rendering Chat",a),y.call(this)}},setTimeout(()=>this.VideoChatLine.forceUpdate())})}updateLines(){return this._updateLines()}rerenderLines(){this.VideoChatLine.forceUpdate()}updateLineTokens(){return this._updateLines(!0,!1)}updateLineBadges(){return this._updateLines(!1,!0)}_updateLines(r=!0,b=!0){for(const u of this.VideoChatLine.instances){const v=u.props.messageContext;if(v.comment&&(v.comment._ffz_message=null,Array.isArray(v.replies)))for(const A of v.replies)A.comment&&(A.comment._ffz_message=null)}this.VideoChatLine.forceUpdate()}updateLinesByUser(r,b){for(const u of this.VideoChatLine.instances){const v=u.props.messageContext;if(!v.comment)continue;const A=v.author;A&&(r&&r==A.id||b&&b==A.name)&&(v.comment._ffz_message=null,u.forceUpdate())}}updateLineById(r,b=!0,u=null){u==null&&(u=b);for(const v of this.VideoChatLine.instances){const A=v.props.messageContext;if(A.comment&&A.comment?.id===r){(b||u)&&(A.comment._ffz_message=null),v.forceUpdate();return}}}checkEffects(){for(const r of this.VideoChatLine.instances){const b=r.props.messageContext,u=b?.comment?._ffz_message,v=u?.ffz_tokens;if(v)for(const A of v)A.type==="emote"&&A.modifier_flags&&this.emotes.ensureEffect(A.modifier_flags)}}standardizeMessage(r,b){if(r._ffz_message)return r._ffz_message;const u=this.active_room||this.chat.getRoom(r.channelId,null,!0,!0),v=r.message.userNoticeParams,A=v&&v["msg-id"],C=r._ffz_message={id:r.id,user:{color:r.message.userColor,id:b.id,login:b.name,displayName:b.displayName,isIntl:b.name&&b.displayName&&b.displayName.trim().toLowerCase()!==b.name,type:b.type},roomLogin:u&&u.login,roomID:u&&u.id||r.channelId,ffz_badges:this.chat.badges.getBadges(b.id,b.login,u?.id,u?.login),badges:r.userBadges,messageParts:r.message.tokens,is_action:r.message.isAction,more_replies:r.moreReplies,timestamp:r.createdAt,ffz_context:"video",is_sub:A==="sub"||A==="resub",highlight:A==="highlighted-message",params:v};if(Array.isArray(C.messageParts)&&C.messageParts.length&&A==="resub"){let y=C.messageParts[0].content;if(typeof y=="string"){const a=x.exec(y);a&&(y=y.slice(a[0].length).trimLeft(),y.length&&(C.messageParts[0].ffz_content=y,C.system_msg=!0))}}return this.chat.detokenizeMessage(C),C}addRoom(r,b){b||(b=r.props);const u=(0,K.get)("data.video.owner",b);if(!u||!u.id)return null;const v=r._ffz_room=this.chat.getRoom(u.id,u.login&&u.login.toLowerCase(),!1,!0);return v.ref(r),v}removeRoom(r){r._ffz_room&&(r._ffz_room.unref(r),r._ffz_room=null)}chatMounted(r,b){b||(b=r.props),this.addRoom(r,b)&&(this.active_room=r._ffz_room,this.chat.badges.updateTwitchBadges((0,K.get)("data.badges",b)),this.updateRoomBadges(r,(0,K.get)("data.video.owner.broadcastBadges",b)),this.updateRoomBitsConfig(r,b.bitsConfig))}chatUpdated(r,b){if((0,K.get)("data.video.owner.id",b)!==(0,K.get)("data.video.owner.id",r.props)){this.removeRoom(r),this.chatMounted(r,b);return}const u=(0,K.get)("data.badges",b),v=(0,K.get)("data.badges",r.props),A=(0,K.get)("data.video.owner.broadcastBadges",b),C=(0,K.get)("data.video.owner.broadcastBadges",r.props);u!==v&&this.chat.badges.updateTwitchBadges(u),A!==C&&this.updateRoomBadges(r,A),b.bitsConfig!==r.props.bitsConfig&&this.updateRoomBitsConfig(r,b.bitsConfig);const y=(0,K.get)("data.video.owner",b);this.settings.updateContext({moderator:b.isCurrentUserModerator}),this.chat.context.updateContext({moderator:b.isCurrentUserModerator,channel:y?y.login:null,channelID:y?y.id:null})}chatUnmounted(r){this.active_room===r._ffz_room&&(this.active_room=null),this.removeRoom(r)}updateRoomBadges(r,b){const u=r._ffz_room;u&&u.updateBadges(b)}updateRoomBitsConfig(r,b){const u=r._ffz_room;u&&u.updateBitsConfig((0,I.formatBitsConfig)(b))}};B(d,"VideoChatHook");let l=d},29632:(me,te,S)=>{"use strict";S.d(te,{default:()=>p});var K=S(22527),M=S(46949),I=S(5286),O=S(17159);const _=class _ extends O.FFZEvent{constructor(r){super(r),this._changed=!1}markChanged(){return this._changed=!0,this}};B(_,"ApolloEvent");let W=_;const l=class l extends null{constructor(r){super(`${r.message}; Location: ${r.locations}`)}};B(l,"GQLError");let x=l;const d=class d extends K.default{constructor(...r){super(...r),this.modifiers={},this.post_modifiers={},this.inject("..fine")}get gqlPrint(){if(this._gql_print)return this._gql_print;const r=this.resolve("site.web_munch");return this._gql_print=r?.getModule?.("gql-printer")}onEnable(){let r=this.client;if(!r){const C=this.fine.react;if(r=(C&&C.stateNode)?.props?.client,C&&!r){let a=0,w=C;for(;!r?.queryManager&&w&&a++<20;)r=w?.memoizedProps?.client,w=w?.child;if(!r){const F=this.fine.searchTree(null,D=>D.props?.client?.queryManager,500);F&&(r=F.props.client)}}this.client=r}if(!r)return new Promise(()=>this.onEnable(),50);if(!this.client.link||!this.client.queryManager||!this.client.queryManager.link){this.log.error("Apollo does not have a Link. We are unable to manipulate queries.");return}this.hooked_query_init=!1;const b=this,u=this.client.queryManager.constructor.prototype,v=u.getCurrentQueryResult;if(u.getCurrentQueryResult=function(C,y=!0){const a=v.call(this,C,y);if(a&&a.partial)try{try{const w=C.getLastResult(),F=C.options;this.dataStore.getCache().read({query:F.query,variables:F.variables,previousResult:w?w.data:void 0,optimistic:y})}catch(w){if(w.toString().includes("Can't find field")&&C.lastResult&&!C.lastResult.loading&&!C.lastError&&Date.now()-(C._ffz_last_retry||0)>=12e4){const F=(0,M.get)("options.query.definitions.0.name",C),D=F&&F.kind==="Name"?F.value:`#${C.queryId}`;b.log.info("Forcing query to refetch due to missing field:",D),C._ffz_last_retry=Date.now(),C.refetch()}}}catch(w){b.log.capture(w)}return a},this.client.queryManager.queryStore){const C=this.client.queryManager.queryStore.initQuery;this.hooked_query_init=!0,this.client.queryManager.queryStore.initQuery=function(y){const a=this.store[y.queryId];return a&&a.queryString!==y.queryString&&(a.queryString=y.queryString),C.call(this,y)}}const A=this.ApolloLink=this.client.link.constructor;this.link=new A((C,y)=>{if(!this.enabled)return y(C);let a=C.variables;Object.keys(a).length||(a=void 0);try{this.hooked_query_init&&this.apolloPreFlight(C)}catch(w){return this.log.capture(w,{tags:{operation:C.operationName},extra:{variables:a}}),this.log.error("Error running Pre-Flight",w,C),y(C)}return y(C).map(w=>{w.extensions&&w.extensions.operationName===C.operationName&&this.log.crumb({level:"info",category:"gql",message:`${C.operationName} [${w.extensions&&w.extensions.durationMilliseconds||"??"}ms]`,data:{variables:a}});try{this.apolloPostFlight(w)}catch(F){this.log.capture(F,{tags:{operation:C.operationName},extra:{variables:a}}),this.log.error("Error running Post-Flight",F,w)}return w})}),this.old_link=this.client.link,this.old_qm_link=this.client.queryManager.link,this.client.link=A.from([this.link,this.old_link]),this.client.queryManager.link=A.from([this.link,this.old_qm_link])}onDisable(){this.client=this.printer=this._gql_print=this.old_link=this.old_qm_dedup=this.old_qm_link=null}apolloPreFlight(r){const b=r.operationName,u=this.modifiers[b],v=`:request.${b}`,A=this.hasListeners(v);if(!u&&!A)return;const C=this.client.queryManager,y=C&&C.queryIdsByName,a=C&&C.queries,w=y&&y[b],F=Array.isArray(w)?w[0]:w,D=a&&a.get(F);if(u)for(const $ of u)typeof $=="function"?$(r):$[1]&&this.applyModifier(r,$[1]);let z=!!u;if(A){const $=new W({operation:b,request:r});this.emit(v,$),$._changed&&(z=!0)}if(z){const $=this.client.queryManager.queryStore.store[F],J=this.gqlPrint&&this.gqlPrint(r.query);$&&(J?($.queryString=J,r.query.loc.source.body=J,r.query.loc.end=J.length,D&&(D.document=r.query,D.observableQuery&&D.observableQuery.options&&(D.observableQuery.options.query=r.query))):(this.log.info("Unable to find GQL Print. Clearing store for query:",b),this.client.queryManager.queryStore.store[F]=null))}}apolloPostFlight(r){if(!r.extensions)return;const b=r.extensions.operationName,u=this.post_modifiers[b];if(u)for(const v of u)v(r);this.emit(`:response.${b}`,r.data)}applyModifier(r,b){r.query=(0,I.default)(r.query,b)}registerModifier(r,b,u=!0){if(typeof b!="function"){if(!u)throw new Error("post modifiers must be functions");b=[b,b]}(u?this.modifiers[r]=this.modifiers[r]||[]:this.post_modifiers[r]=this.post_modifiers[r]||[]).push(b)}unregisterModifier(r,b,u=!0){const v=u?this.modifiers[r]:this.post_modifiers[r];if(v){if(typeof b!="function")throw new Error("graphql modifiers cannot be removed");for(let A=0;A<v.length;A++){const C=v[A];if(typeof C=="function"?C===b:C[0]===b){v.splice(A,1);return}}}}getQuery(r){const b=this.client.queryManager?.queries;if(b)for(const u of b.values()){const v=u?.observableQuery;if(v?.queryName===r)return v}}maybeRefetch(r){const b=this.getQuery(r);!b||!b.lastResult||b.lastResult.stale||b.refetch()}ensureQuery(r,b,u=500,v=12e4){const A=this.getQuery(r);if(A){const C=A.lastResult;let y;C?C.loading?y=!0:typeof b=="function"?y=b(C):y=(0,M.get)(b,C)!==void 0:y=!1,!y&&Date.now()-(A._ffz_last_retry||0)>=v&&(A._ffz_last_retry=Date.now(),A.options.query=Object.assign({},A.options.query),u===0?A.refetch():u>0&&setTimeout(()=>{A.refetch()},u))}return A}getFromQuery(r,b,u=500,v=12e4){const A=this.getQuery(r),C=A&&A.lastResult;if(!A)return;let y;if(!(C&&(typeof b=="function"?y=b(C):y=(0,M.get)(b,C),C.loading)))return y===void 0&&Date.now()-(A._ffz_last_retry||0)>=v&&(A._ffz_last_retry=Date.now(),A.options.query=Object.assign({},A.options.query),u===0?A.refetch():u>0&&setTimeout(()=>A.refetch(),u)),y}};B(d,"Apollo");let p=d},6170:(me,te,S)=>{"use strict";S.d(te,{Z:()=>_,e:()=>l});var K=S(20857);let M,I,O,W;function x(){return M?Promise.resolve(M):new Promise((d,f)=>{if(O)return O.push([d,f]);O=[[d,f]],Promise.all([S.e(2009).then(S.t.bind(S,19404,23)),S.e(2009).then(S.t.bind(S,43496,23))]).then(r=>{M=r[0]?.default,I=r[1]?.default;const b=O;O=null;for(const u of b)u[0](M)}).catch(r=>{const b=O;O=null;for(const u of b)u[1](r)})})}B(x,"loadMD");function p(d){const f=d.renderer.rules.link_open||this.defaultRender;d.renderer.rules.link_open=function(r,b,u,v,A){const C=r[b];if(C&&C.type==="link_open"&&Array.isArray(C.attrs)){let y;for(const a of C.attrs)if(a[0]==="href"){y=a[1];break}if(y.startsWith("~")){let a;if(y==="~"){let w=b+1,F=[];for(;w<r.length;){const z=r[w],$=z?.type;if($==="text")F.push(z);else if($==="link_close")break;w++}F=F.map(z=>z.content).join(""),a=(0,K.Q)(F).map(z=>z.key).join(".")}else a=y.slice(1);if(a&&a.length){for(const w of C.attrs)if(w[0]==="class"){w[1]=w[1].replace(/ffz-tooltip/g,"");break}C.attrs.push(["data-settings-link",a]),C.attrs.push(["onclick",'FrankerFaceZ.get().resolve("main_menu").mdNavigate(this);return false'])}}}return f(r,b,u,v,A)}}B(p,"SettingsLinks"),p.defaultRender=function(d,f,r,b,u){return u.renderToken(d,f,r)};async function _(){if(!W){const d=await x();if(!d)return null;const f=W=new d({html:!1,linkify:!0});f.use(p),f.use(I,{attrs:{class:"ffz-tooltip",target:"_blank",rel:"noopener","data-tooltip-type":"link"}})}return W}B(_,"awaitMD");function l(d){if(W)return W;d&&_().then(f=>d(f))}B(l,"getMD")},81011:(me,te,S)=>{"use strict";S.d(te,{Z:()=>O});var K=S(17159),M=S(46949),I=S(37087);const W=class W extends K.EventEmitter{constructor(p,_){super(),this._enabled=!1,this.ephemeral=!1,this.id=-1,this.uuid=null,this.name=null,this.pause_updates=!1,this.show_toggle=!1,this._hotkey_enabled=!1,this.onShortcut=this.onShortcut.bind(this),this._hotkey_enabled=!1,this.manager=p,this.provider=p.provider,this.data=_,this.prefix=`p:${this.id}:`,this.enabled_key=`${this.prefix}:enabled`,this.ephemeral&&(this._enabled=!0,this._storage=new Map)}get data(){return{id:this.id,uuid:this.uuid,name:this.name,i18n_key:this.i18n_key,hotkey:this.hotkey,pause_updates:this.pause_updates,ephemeral:this.ephemeral,description:this.description,desc_i18n_key:this.desc_i18n_key,url:this.url,show_toggle:this.show_toggle,context:this.context}}set data(p){if(typeof p!="object")throw new TypeError("data must be an object");this.clearMatcher(),p.ephemeral&&(this.ephemeral=!0);for(const[_,l]of Object.entries(p))this[_]=l}clearMatcher(){this.matcher=null}matches(p){return this.matcher||(this.matcher=(0,I.createTester)(this.context,this.manager.filters,!1,!1,()=>this.manager.updateSoon())),this.matcher(p)}save(){this.ephemeral||this.manager.saveProfile(this.id)}getBackup(){const p={version:2,type:"profile",profile:this.data,toggled:this.toggled,values:{}};delete p.profile.ephemeral;for(const[_,l]of this.entries())p.values[_]=l;return p}async checkUpdate(){if(!this.url||this.pause_updates)return!1;const p=await(0,M.fetchJSON)(this.url);if(!p||p.type!=="profile"||!p.profile||!p.values)return!1;delete p.profile.ephemeral,delete p.profile.id,delete p.profile.uuid,delete p.profile.name,delete p.profile.i18n_key,delete p.profile.hotkey,delete p.profile.description,delete p.profile.desc_i18n_key,delete p.profile.url,delete p.profile.pause_updates,this.data=p.profile;const _=new Set(this.keys());for(const[l,d]of Object.entries(p.values))_.delete(l),this.set(l,d);for(const l of _)this.delete(l);return!0}get hotkey(){return this._hotkey}set hotkey(p){p!==this._hotkey&&(this._hotkey=p,this._hotkey_enabled&&this._updateHotkey())}get hotkey_enabled(){return this._hotkey_enabled}set hotkey_enabled(p){this._hotkey_enabled=!!p,this._updateHotkey()}_updateHotkey(){const p=this.Mousetrap=this.Mousetrap||window.Mousetrap;if(!p)return;const _=this._hotkey;this._bound_key&&(this._bound_key!==_||!this._hotkey_enabled)&&(p.unbind(this._bound_key),this._bound_key=null),this._hotkey_enabled&&_&&(0,M.isValidShortcut)(_)&&(p.bind(_,this.onShortcut),this._bound_key=_)}onShortcut(p){this.toggled=!this.toggled,p&&(p.stopPropagation(),p.preventDefault())}get toggled(){return this.ephemeral?this._enabled:this.provider.get(this.enabled_key,!0)}set toggled(p){p!==this.toggled&&(this.ephemeral?this._enabled=p:this.provider.set(this.enabled_key,p),this.emit("toggled",this,p))}setContext(p){if(this.id===0)throw new Error("cannot set context of default profile");this.context=p,this.clearMatcher(),this.save()}get(p,_){return this.ephemeral?this._storage&&this._storage.has(p)?this._storage.get(p):_??null:this.provider.get(this.prefix+p,_)}set(p,_){this.ephemeral?this._storage&&this._storage.set(p,_):this.provider.set(this.prefix+p,_),this.emit("changed",p,_,!1)}delete(p){this.ephemeral?this._storage&&this._storage.delete(p):this.provider.delete(this.prefix+p),this.emit("changed",p,void 0,!0)}has(p){return this.ephemeral?this._storage?this._storage.has(p):!1:this.provider.has(this.prefix+p)}keys(){if(this.ephemeral)return this._storage?Array.from(this._storage.keys()):[];const p=[],_=this.prefix,l=_.length;for(const d of this.provider.keys())d.startsWith(_)&&d!==this.enabled_key&&p.push(d.slice(l));return p}clear(){if(this.ephemeral){if(this._storage){const l=this.keys();this._storage.clear();for(const d of l)this.emit("changed",d,void 0,!0)}return}const p=this.prefix,_=p.length;for(const l of this.provider.keys())l.startsWith(p)&&l!==this.enabled_key&&(this.provider.delete(l),this.emit("changed",l.slice(_),void 0,!0))}*entries(){if(this.ephemeral){if(this._storage)for(const p of this._storage.entries())yield p}else{const p=this.prefix,_=p.length;for(const l of this.provider.keys())l.startsWith(p)&&l!==this.enabled_key&&(yield[l.slice(_),this.provider.get(l)])}}get size(){if(this.ephemeral)return this._storage?this._storage.size:0;const p=this.prefix;let _=0;for(const l of this.provider.keys())l.startsWith(p)&&l!==this.enabled_key&&_++;return _}};B(W,"SettingsProfile");let O=W;O.Default={id:0,uuid:"ffz_profile_default",name:"Default Profile",i18n_key:"setting.profiles.default",description:"Settings that apply everywhere on Twitch."},O.Moderation={id:1,uuid:"ffz_profile_moderation",name:"Moderation",i18n_key:"setting.profiles.moderation",description:"Settings that apply when you are a moderator of the current channel.",context:[{type:"Moderator",data:!0}]}},34923:(me,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>M});var K=S(22527);const I=class I extends K.default{constructor(W,x){super(W,x),this.settings=null,this.site=null,this.fine=null,this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site"),this.LoadableComponent=this.fine.define("loadable-component",p=>p.props?.component&&p.props.loader),this.ErrorBoundaryComponent=this.fine.define("error-boundary-component",p=>p.props?.name&&p.props?.onError&&p.props?.children&&p.onErrorBoundaryTestEmit),this.overrides=new Map}onEnable(){this.settings.getChanges("chat.hype.show-pinned",W=>{this.toggle("PaidPinnedChatMessageList",W)}),this.settings.getChanges("layout.turbo-cta",W=>{this.toggle("TopNav__TurboButton_Available",W)}),this.ErrorBoundaryComponent.ready((W,x)=>{this.log.debug("Found Error Boundary component wrapper.");const p=this,_=W.prototype,l=_.render;_.render=function(){try{const d=this.props.name;if(p.overrides.has(d)&&!p.shouldRender(d))return null}catch(d){console.error(d)}return l.call(this)},this.ErrorBoundaryComponent.updateInstances()}),this.LoadableComponent.ready((W,x)=>{this.log.debug("Found Loadable component wrapper.");const p=this,_=W.prototype,l=_.render;_.render=function(){try{const d=this.props.component;if(p.overrides.has(d)&&this.state){let f=this.state.Component;if(typeof f=="function"&&!f.ffzWrapped){const r=p.site.getReact(),b=r&&r.createElement;if(b){if(!f.ffzWrapper){let u=B(function(A){return p.shouldRender(v.props.component)?b(f,A):null},"FFZWrapper");const v=this;u.ffzWrapped=!0,u.displayName=`FFZWrapper(${this.props.component})`,f.ffzWrapper=u}this.state.Component=f.ffzWrapper}}}}catch(d){console.error(d)}return l.call(this)},this.LoadableComponent.updateInstances()})}toggle(W,x=null){const p=this.overrides.get(W)??!0;x==null?x=!p:x=!!x,x!==p&&(this.overrides.set(W,x),this.update(W))}update(W){for(const x of this.LoadableComponent.instances){const p=x.props?.component;p&&p===W&&x.forceUpdate()}for(const x of this.ErrorBoundaryComponent.instances){const p=x.props?.name;p&&p===W&&x.forceUpdate()}}shouldRender(W){return this.overrides.get(W)??!0}};B(I,"Loadable");let M=I},70052:(me,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>I});var K=S(22527),M=S(44589);const O=class O extends K.default{constructor(x,p){super(x,p),this.i18n=null,this.fine=null,this.settings=null,this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.settings.add("sub-button.prime-notice",{default:!0,ui:{path:"Channel > Metadata >> Subscription",title:"Show Prime Reminder",description:"Display a crown on subscription buttons when your free channel sub with Prime is available.",component:"setting-check-box"},changed:()=>this.SubButton.forceUpdate()}),this.SubButton=this.fine.define("sub-button",_=>_.handleSubMenuAction&&_.openSubModal,["user","user-home","user-video","user-clip","video","user-videos","user-clips","user-collections","user-events","user-followers","user-following"])}onEnable(){this.settings.on(":changed:layout.swap-sidebars",()=>this.SubButton.forceUpdate()),this.SubButton.ready((x,p)=>{for(const _ of p)this.updateSubButton(_)}),this.SubButton.on("mount",this.updateSubButton,this),this.SubButton.on("update",this.updateSubButton,this)}updateSubButton(x){const p=this.fine.getChildNode(x),_=p?.querySelector('button[data-a-target="subscribe-button"]');if(!_)return;const l=x.props,d=l.data&&l.data.user,f=d&&d.self,r=this.settings.get("sub-button.prime-notice")&&f&&f.canPrimeSubscribe&&!f.subscriptionBenefit,b=_.querySelector(".ffz--can-prime");if(r&&!b)_.insertBefore((0,M.createElement)("span",{class:"tw-button__icon tw-button__icon--left ffz--can-prime"},(0,M.createElement)("figure",{class:"ffz-i-crown ffz-tooltip","data-title":this.i18n.t("sub-button.prime","Your free channel sub with Prime is available.")})),_.firstElementChild),_.appendChild((0,M.createElement)("span",{class:"ffz--post-prime"}));else if(!r&&b){b.remove();const u=_.querySelector(".ffz--post-prime");u&&u.remove()}}};B(O,"SubButton");let I=O},5227:(me,te,S)=>{"use strict";S.r(te),S.d(te,{Addon:()=>M});var K=S(22527);const I=class I extends K.default{constructor(W,x){super(W,x,!0),this.i18n=null,this.settings=null,this.inject("i18n"),this.inject("settings")}populate(W,x){return this.log.warn("[DEV-CHECK] populate() has been renamed to loadFromContext(). The populate() name is deprecated."),this.loadFromContext(W,x)}static register(W,x,p){if(typeof W=="object"&&(x=W,W=x.id||void 0),!W)if(this.name)W=this.name.toSnakeCase();else throw new Error("Unable to register module without ID.");!x&&this.info&&(x=this.info),p&&(this.version=p);const _=window.FrankerFaceZ.get(),l=_?.addons;l&&(x?(x.id=W,l.addAddon(x)):l.hasAddon(W)||l.addAddon({id:W}),p&&l.setVersion(W,p));try{_.register(`addon.${W}`,this)}catch(d){if(d instanceof Error&&d.message&&d.message.includes("Name Collision for Module")){const f=_.resolve(`addon.${W}`);f&&(f.external=!0)}throw d}}};B(I,"Addon");let M=I},38626:(me,te,S)=>{"use strict";S.r(te),S.d(te,{deserializeBlob:()=>I,isValidBlob:()=>K,serializeBlob:()=>M});function K(O){return O instanceof Blob||O instanceof File||O instanceof ArrayBuffer||O instanceof Uint8Array}B(K,"isValidBlob");async function M(O){if(!O)return null;if(O instanceof Blob)return{type:"blob",mime:O.type,buffer:await O.arrayBuffer()};if(O instanceof File)return{type:"file",mime:O.type,name:O.name,modified:O.lastModified,buffer:await O.arrayBuffer()};if(O instanceof ArrayBuffer)return{type:"ab",buffer:O};if(O instanceof Uint8Array)return{type:"u8",buffer:O.buffer};throw new TypeError("Invalid type")}B(M,"serializeBlob");function I(O){if(!O||!O.type)return null;if(O.type==="blob")return new Blob([O.buffer],{type:O.mime});if(O.type==="file")return new File([O.buffer],O.name,{type:O.mime,lastModified:O.modified});if(O.type==="ab")return O.buffer;if(O.type==="u8")return new Uint8Array(O.buffer);throw new TypeError("Invalid type")}B(I,"deserializeBlob")},14873:(me,te,S)=>{var v;"use strict";S.r(te),S.d(te,{Color:()=>d,ColorAdjuster:()=>f,bit2linear:()=>M,hue2rgb:()=>K,linear2bit:()=>I});function K(y,a,w){return w<0&&(w+=1),w>1&&(w-=1),w<.16666666666666666?y+(a-y)*6*w:w<.5?a:w<.6666666666666666?y+(a-y)*(.6666666666666666-w)*6:y}B(K,"hue2rgb");function M(y){return y<=.04045?y/12.92:Math.pow((y+.055)/1.055,2.4)}B(M,"bit2linear");function I(y){return y<=.0031308?y*12.92:Math.pow(1.055*y,.4166666666666667)-.055}B(I,"linear2bit");const r=class r{constructor(a,w,F,D){this.r=a||0,this.g=w||0,this.b=F||0,this.a=D||0}eq(a,w=!1){return a instanceof r?this.r===a.r&&this.g===a.g&&this.b===a.b&&(w||this.a===a.a):a?this.eq(a.toRGBA(),w):!1}_r(a){return new r(a,this.g,this.b,this.a)}_g(a){return new r(this.r,a,this.b,this.a)}_b(a){return new r(this.r,this.g,a,this.a)}_a(a){return new r(this.r,this.g,this.b,a)}static fromName(a){const w=d.getContext();w.clearRect(0,0,1,1),w.fillStyle=a,w.fillRect(0,0,1,1);const F=w.getImageData(0,0,1,1);return F?.data?.length!==4?null:new r(F.data[0],F.data[1],F.data[2],F.data[3]/255)}static fromCSS(a){return a=a&&a.trim(),a?.length?a.charAt(0)==="#"?r.fromHex(a):r.fromName(a):null}static fromHex(a){a.charAt(0)==="#"&&(a=a.slice(1));let w,F=255;return a.length===4?(F=parseInt(a[3],16)*17,a=a.slice(0,3)):a.length===8&&(F=parseInt(a.slice(6),16),a=a.slice(0,6)),a.length===3?w=(parseInt(a[0],16)*17<<16)+(parseInt(a[1],16)*17<<8)+parseInt(a[2],16)*17:w=parseInt(a,16),new r(w>>16,w>>8&255,w&255,F/255)}static fromHSVA(a,w,F,D){let z,$,J;const Z=Math.floor(a*6),G=a*6-Z,Q=F*(1-w),se=F*(1-G*w),ce=F*(1-(1-G)*w);switch(Z%6){case 0:z=F,$=ce,J=Q;break;case 1:z=se,$=F,J=Q;break;case 2:z=Q,$=F,J=ce;break;case 3:z=Q,$=se,J=F;break;case 4:z=ce,$=Q,J=F;break;default:z=F,$=Q,J=se}return new r(Math.round(Math.min(Math.max(0,z*255),255)),Math.round(Math.min(Math.max(0,$*255),255)),Math.round(Math.min(Math.max(0,J*255),255)),D===void 0?1:D)}static fromHSLA(a,w,F,D){if(w===0){const J=Math.round(Math.min(Math.max(0,255*F),255));return new r(J,J,J,D===void 0?1:D)}const z=F<.5?F*(1+w):F+w-F*w,$=2*F-z;return new r(Math.round(Math.min(Math.max(0,255*K($,z,a+.3333333333333333)),255)),Math.round(Math.min(Math.max(0,255*K($,z,a)),255)),Math.round(Math.min(Math.max(0,255*K($,z,a-.3333333333333333)),255)),D===void 0?1:D)}static fromXYZA(a,w,F,D){const z=3.240479*a-1.53715*w-.498535*F,$=-.969256*a+1.875992*w+.041556*F,J=.055648*a-.204043*w+1.057311*F;return new r(Math.max(0,Math.min(255,255*I(z))),Math.max(0,Math.min(255,255*I($))),Math.max(0,Math.min(255,255*I(J))),D===void 0?1:D)}toCSS(){return this.a!==1?`rgba(${this.r},${this.g},${this.b},${this.a})`:this.toHex()}toHex(){return`#${((Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)).toString(16).padStart(6,"0")}`}toRGBA(){return this}toHSVA(){return W.fromRGBA(this.r,this.g,this.b,this.a)}toHSLA(){return x.fromRGBA(this.r,this.g,this.b,this.a)}toXYZA(){return _.fromRGBA(this.r,this.g,this.b,this.a)}toLUVA(){return this.toXYZA().toLUVA()}get_Y(){return(.299*this.r+.587*this.g+.114*this.b)/255}luminance(){const a=M(this.r/255),w=M(this.g/255),F=M(this.b/255);return .2126*a+.7152*w+.0722*F}brighten(a){return a=typeof a=="number"?a:1,a=Math.round(255*(a/100)),new r(Math.max(0,Math.min(255,this.r+a)),Math.max(0,Math.min(255,this.g+a)),Math.max(0,Math.min(255,this.b+a)),this.a)}daltonize(a){let w;if(typeof a=="string")if(d.CVDMatrix.hasOwnProperty(a))w=d.CVDMatrix[a];else throw new Error("Invalid CVD matrix");else w=a;const F=w[0],D=w[1],z=w[2],$=w[3],J=w[4],Z=w[5],G=w[6],Q=w[7],se=w[8],ce=17.8824*this.r+43.5161*this.g+4.11935*this.b,be=3.45565*this.r+27.1554*this.g+3.86714*this.b,ve=.0299566*this.r+.184309*this.g+1.46709*this.b,Re=F*ce+D*be+z*ve,oe=$*ce+J*be+Z*ve,ie=G*ce+Q*be+se*ve;let ae=.0809444479*Re+-.130504409*oe+.116721066*ie,xe=-.0102485335*Re+.0540193266*oe+-.113614708*ie,ne=-.000365296938*Re+-.00412161469*oe+.693511405*ie;ae=this.r-ae,xe=this.g-xe,ne=this.b-ne;const we=0*ae+0*xe+0*ne,ze=.7*ae+1*xe+0*ne,Me=.7*ae+0*xe+1*ne;return ae=Math.min(Math.max(0,we+this.r),255),xe=Math.min(Math.max(0,ze+this.g),255),ne=Math.min(Math.max(0,Me+this.b),255),new r(ae,xe,ne,this.a)}};B(r,"RGBAColor");let O=r;const b=class b{constructor(a,w,F,D){this.h=a||0,this.s=w||0,this.v=F||0,this.a=D||0}eq(a,w=!1){return a instanceof b?this.h===a.h&&this.s===a.s&&this.v===a.v&&(w||this.a===a.a):a?this.eq(a.toHSVA(),w):!1}_h(a){return new b(a,this.s,this.v,this.a)}_s(a){return new b(this.h,a,this.v,this.a)}_v(a){return new b(this.h,this.s,a,this.a)}_a(a){return new b(this.h,this.s,this.v,a)}static fromRGBA(a,w,F,D){a/=255,w/=255,F/=255;const z=Math.max(a,w,F),$=Math.min(a,w,F),J=Math.min(Math.max(0,z-$),1),Z=z===0?0:J/z,G=z;let Q;if(J===0)Q=0;else{switch(z){case a:Q=(w-F)/J+(w<F?6:0);break;case w:Q=(F-a)/J+2;break;default:Q=(a-w)/J+4}Q/=6}return new b(Q,Z,G,D===void 0?1:D)}toCSS(){return this.toRGBA().toCSS()}toHex(){return this.toRGBA().toHex()}toRGBA(){return O.fromHSVA(this.h,this.s,this.v,this.a)}toHSVA(){return this}toHSLA(){return this.toRGBA().toHSLA()}toXYZA(){return this.toRGBA().toXYZA()}toLUVA(){return this.toRGBA().toLUVA()}};B(b,"HSVAColor");let W=b;const u=class u{constructor(a,w,F,D){this.h=a||0,this.s=w||0,this.l=F||0,this.a=D||0}eq(a,w=!1){return a instanceof u?this.h===a.h&&this.s===a.s&&this.l===a.l&&(w||this.a===a.a):a?this.eq(a.toHSLA(),w):!1}_h(a){return new u(a,this.s,this.l,this.a)}_s(a){return new u(this.h,a,this.l,this.a)}_l(a){return new u(this.h,this.s,a,this.a)}_a(a){return new u(this.h,this.s,this.l,a)}static fromRGBA(a,w,F,D){a/=255,w/=255,F/=255;const z=Math.max(a,w,F),$=Math.min(a,w,F),J=Math.min(Math.max(0,(z+$)/2),1),Z=Math.min(Math.max(0,z-$),1);let G,Q;if(Z===0)G=Q=0;else{switch(Q=J>.5?Z/(2-z-$):Z/(z+$),z){case a:G=(w-F)/Z+(w<F?6:0);break;case w:G=(F-a)/Z+2;break;default:G=(a-w)/Z+4}G/=6}return new u(G,Q,J,D===void 0?1:D)}toCSS(){const a=this.a;return`hsl${a!==1?"a":""}(${Math.round(this.h*360)},${Math.round(this.s*100)}%,${Math.round(this.l*100)}%${a!==1?`,${this.a}`:""})`}toHex(){return this.toRGBA().toHex()}toRGBA(){return O.fromHSLA(this.h,this.s,this.l,this.a)}toHSLA(){return this}toHSVA(){return this.toRGBA().toHSVA()}toXYZA(){return this.toRGBA().toXYZA()}toLUVA(){return this.toRGBA().toLUVA()}targetLuminance(a){let w=this.s,F=0,D=1;w*=Math.pow(this.l>.5?-this.l:this.l-1,7)+1;let z=(D-F)/2,$=F+z;for(;z>152587890625e-16;z/=2,$=F+z)O.fromHSLA(this.h,w,$,1).luminance()>a?D=$:F=$;return new u(this.h,w,$,this.a)}};B(u,"HSLAColor");let x=u;const p=(v=class{constructor(a,w,F,D){this.x=a||0,this.y=w||0,this.z=F||0,this.a=D||0}eq(a,w=!1){return a instanceof v?this.x===a.x&&this.y===a.y&&this.z===a.z&&(w||this.a===a.a):a?this.eq(a.toXYZA(),w):!1}_x(a){return new v(a,this.y,this.z,this.a)}_y(a){return new v(this.x,a,this.z,this.a)}_z(a){return new v(this.x,this.y,a,this.a)}_a(a){return new v(this.x,this.y,this.z,a)}static fromRGBA(a,w,F,D){const z=M(a/255),$=M(w/255),J=M(F/255);return new v(.412453*z+.35758*$+.180423*J,.212671*z+.71516*$+.072169*J,.019334*z+.119193*$+.950227*J,D===void 0?1:D)}static fromLUVA(a,w,F,D){const z=1/(v.WHITE.x+15*v.WHITE.y+3*v.WHITE.z),$=4*v.WHITE.x*z,J=9*v.WHITE.y*z,Z=a>8?Math.pow((a+16)/116,3):a/v.KAPPA,G=1/3*(52*a/(w+13*a*$)-1),Q=-5*Z,se=-1/3,ce=Z*(39*a/(F+13*a*J)-5),be=(ce-Q)/(G-se),ve=be*G+Q;return new v(be,Z,ve,D===void 0?1:D)}toCSS(){return this.toRGBA().toCSS()}toHex(){return this.toRGBA().toHex()}toRGBA(){return O.fromXYZA(this.x,this.y,this.z,this.a)}toHSLA(){return this.toRGBA().toHSLA()}toHSVA(){return this.toRGBA().toHSVA()}toXYZA(){return this}toLUVA(){return l.fromXYZA(this.x,this.y,this.z,this.a)}},B(v,"_XYZAColor2"),v);p.EPSILON=Math.pow(.20689655172413793,3),p.KAPPA=Math.pow(9.666666666666666,3),p.WHITE=null;let _=p;_.WHITE=new O(255,255,255,1).toXYZA();const A=class A{constructor(a,w,F,D){this.l=a||0,this.u=w||0,this.v=F||0,this.a=D||0}eq(a,w=!1){return a instanceof A?this.l===a.l&&this.u===a.u&&this.v===a.v&&(w||this.a===a.a):a?this.eq(a.toLUVA(),w):!1}_l(a){return new A(a,this.u,this.v,this.a)}_u(a){return new A(this.l,a,this.v,this.a)}_v(a){return new A(this.l,this.u,a,this.a)}_a(a){return new A(this.l,this.u,this.v,a)}static fromXYZA(a,w,F,D){const z=1/(_.WHITE.x+15*_.WHITE.y+3*_.WHITE.z),$=4*_.WHITE.x*z,J=9*_.WHITE.y*z,Z=w/_.WHITE.y;let G=a+15*w+3*F;G===0&&(G=1);const Q=1/G,se=4*a*Q,ce=9*w*Q,be=Z>_.EPSILON?116*Math.pow(Z,1/3)-16:_.KAPPA*Z,ve=13*be*(se-$),Re=13*be*(ce-J);return new A(be,ve,Re,D===void 0?1:D)}toCSS(){return this.toRGBA().toCSS()}toHex(){return this.toRGBA().toHex()}toRGBA(){return this.toXYZA().toRGBA()}toHSLA(){return this.toRGBA().toHSLA()}toHSVA(){return this.toRGBA().toHSVA()}toXYZA(){return _.fromLUVA(this.l,this.u,this.v,this.a)}toLUVA(){return this}};B(A,"LUVAColor");let l=A;const d={CVDMatrix:{protanope:[0,2.02344,-2.52581,0,1,0,0,0,1],deuteranope:[1,0,0,.494207,0,1.24827,0,0,1],tritanope:[1,0,0,0,1,0,-.395913,.801109,0]},getCanvas(){return d._canvas||(d._canvas=document.createElement("canvas")),d._canvas},getContext:()=>(d._context||(d._context=d.getCanvas().getContext("2d")),d._context),RGBA:O,HSVA:W,HSLA:x,XYZA:_,LUVA:l,fromCSS(y){return O.fromCSS(y)}},C=class C{constructor(a="#232323",w=0,F=4.5){this._dark=!1,this._cache=new Map,this._luv=0,this._luma=0,this._contrast=F,this._base=a,this._mode=w,this.rebuildContrast()}get contrast(){return this._contrast}set contrast(a){this._contrast=a,this.rebuildContrast()}get base(){return this._base}set base(a){this._base=a,this.rebuildContrast()}get dark(){return this._dark}get mode(){return this._mode}set mode(a){this._mode=a,this.rebuildContrast()}rebuildContrast(){this._cache=new Map;const a=O.fromCSS(this._base);if(!a)throw new Error("Invalid base color");const w=a.luminance();(this._dark=w<.5)?(this._luv=new _(0,this._contrast*(a.toXYZA().y+.05)-.05,0,1).toLUVA().l,this._luma=this._contrast*(a.luminance()+.05)-.05):(this._luv=new _(0,(a.toXYZA().y+.05)/this._contrast-.05,0,1).toLUVA().l,this._luma=(a.luminance()+.05)/this._contrast-.05)}process(a,w=!1){if(!a)return null;if(this._mode===-1)return"";if(typeof a!="string"&&(a=a.toCSS()),this._mode===0)return a;if(this._cache.has(a))return this._cache.get(a);let F;try{F=O.fromCSS(a)}catch(z){if(w)throw z;return null}if(!F)return null;if(this._mode===1){const z=F.luminance();(this._dark?z<this._luma:z>this._luma)&&(F=F.toHSLA().targetLuminance(this._luma).toRGBA())}else if(this._mode===2){const z=F.toLUVA();(this._dark?z.l<this._luv:z.l>this._luv)&&(F=z._l(this._luv).toRGBA())}else if(this._mode===3)if(this._dark)for(;F.get_Y()<.5;){const z=F.toHSLA();F=z._l(Math.min(Math.max(0,.1+.9*z.l),1)).toRGBA()}else for(;F.get_Y()>=.5;){const z=F.toHSLA();F=z._l(Math.min(Math.max(0,.9*z.l),1)).toRGBA()}else if(this._mode===4){let z=0;if(this._dark)for(;F.luminance()<.15&&z++<127;)F=F.brighten();else for(;F.luminance()>.3&&z++<127;)F=F.brighten(-1)}const D=F.toCSS();return this._cache.set(a,D),D}};B(C,"ColorAdjuster");let f=C},45866:(me,te,S)=>{"use strict";S.d(te,{Z:()=>W});var K=S(72167),M=S.n(K),I=S(22527),O=S(46949);const x=class x extends I.default{constructor(_,l){super(_,l),this.fine=null,this.inject("..fine"),this.__routes=[],this.routes={},this.route_names={},this.current=null,this.current_name=null,this.current_state=null,this.match=null,this.location=null}onEnable(){const _=this.fine.searchTree(null,d=>d.props&&d.props.history),l=this.history=_&&_.props&&_.props.history;if(!l)return(0,O.sleep)(50).then(()=>this.onEnable());l.listen(d=>{this.enabled&&this._navigateTo(d)}),this._navigateTo(l.location)}navigate(_,l,d,f){this.history.push(this.getURL(_,l,d),f)}_navigateTo(_){this.log.debug("New Location",_);const l=window.location.host,d=_.pathname,f=_.search,r=_.state;d===this.location&&l===this.domain&&f===this.search&&(0,O.deep_equals)(r,this.current_state)||(this.old_location=this.location,this.old_search=this.search,this.old_domain=this.domain,this.old_state=this.current_state,this.location=d,this.search=f,this.domain=l,this.current_state=r,this._pickRoute())}_pickRoute(){const _=this.location,l=this.domain;this.old_route=this.current,this.old_name=this.current_name,this.old_match=this.match;for(const d of this.__routes){if(d.domain&&d.domain!==l)continue;const f=d.regex.exec(_);if(f&&(!d.state_fn||d.state_fn(this.current_state))){this.log.debug("Matching Route",d,f),this.current=d,this.current_name=d.name,this.match=f,this.emit(":route",d,f);return}}this.current=this.current_name=this.match=null,this.emit(":route",null,null)}getURL(_,l,d,...f){const r=this.routes[_];if(!r)throw new Error(`unable to find route "${_}"`);if(typeof l!="object"){const b=[l,d,...f];l={};let u=0;for(const v of r.parts)if(v&&v.name&&(l[v.name]=b[u],u++,u>=b.length))break}return r.url(l,d)}getRoute(_){return this.routes[_]}getRoutes(){return this.routes}getRouteNames(){for(const _ of Object.keys(this.getRoutes()))this.getRouteName(_);return this.route_names}getRouteName(_){return this.route_names[_]||(this.route_names[_]=_.replace(/^dash-([a-z])/,(l,d)=>`Dashboard: ${d.toLocaleUpperCase()}`).replace(/(^|-)([a-z])/g,(l,d,f)=>`${d?" ":""}${f.toLocaleUpperCase()}`)),this.route_names[_]}routeName(_,l,d=!0){if(typeof _=="object"){for(const f in _)(0,O.has)(_,f)&&this.routeName(f,_[f],!1);d&&this.emit(":updated-route-names");return}l&&(this.route_names[_]=l,d&&this.emit(":updated-route-names"))}route(_,l,d=null,f=null,r=!0){if(typeof _=="object"){d=l;for(const A in _)(0,O.has)(_,A)&&this.route(A,_[A],d,f,!1);r&&(this.__routes.sort((A,C)=>C.score-A.score),this.location&&this._pickRoute(),this.emit(":updated-routes"));return}const b=(0,K.parse)(l),u=b.reduce((A,C)=>A+(typeof C=="string"?C.split("/").length-1:0),0),v=this.routes[_]={name:_,parts:b,score:u,domain:d,state_fn:f,regex:(0,K.tokensToRegExp)(b),url:(0,K.tokensToFunction)(b)};this.__routes.push(v),r&&(this.__routes.sort((A,C)=>C.score-A.score),this.location&&this._pickRoute(),this.emit(":updated-routes"))}};B(x,"FineRouter");let W=x},98247:(me,te,S)=>{"use strict";S.d(te,{Z:()=>I});var K=S(17159),M=S(22527);const x=class x extends M.default{constructor(l,d){super(l,d),this._route=null,this._wrappers=new Map,this._known_classes=new Map,this._observer=null,this._waiting=[],this._live_waiting=null}async onEnable(l=0){this.root_element||(this.root_element=await this.parent.awaitElement(this.selector||"body #root"));let d=this.root_element?._reactRootContainer;if(d?._internalRoot?.current&&(d=d?._internalRoot),d?.current){this.react_root=d,this.react=d?.current?.child;return}if(this.root_element&&!d){let f=x.findAccessor(this.root_element,"__reactContainer");if(f){this.react_root=null,this.react=this.root_element[f];return}}if(l>500)throw new Error("Unable to find React after 25 seconds");return this.root_element=null,new Promise(f=>setTimeout(f,50)).then(()=>this.onEnable(l+1))}onDisable(){this.react_root=this.root_element=this.react=this.accessor=null}static findAccessor(l,d){for(const f in l)if(d?f.startsWith(`${d}$`):f.startsWith("__reactInternalInstance$")||f.startsWith("__reactFiber$"))return f;return null}resolveNode(l){return!l&&this.react?this.react:l instanceof Node?this.getReactInstance(l):l?._reactInternals?l._reactInternals:l?._reactInternalFiber?l._reactInternalFiber:l||null}getReactInstance(l){return this.accessor||(this.accessor=x.findAccessor(l)),this.accessor?l[this.accessor]??l._reactRootContainer?._internalRoot?.current??l._reactRootContainer?.current??null:null}getOwner(l){return l=this.resolveNode(l),l?.return??null}getParentNode(l,d=100,f=!1){return this.searchParent(l,r=>r instanceof Node,d,0,f)}getChildNode(l,d=100,f=!1){return this.searchTree(l,r=>r instanceof Node,d,0,f)}getHostNode(l,d=100){return this.getChildNode(l,d)}getParent(l){return this.getOwner(l)}getFirstChild(l){return this.resolveNode(l)?.child??null}getChildren(l){const d=this.resolveNode(l);if(!d)return[];const f=[];let r=d.child;for(;r;)f.push(r),r=r.sibling;return f}searchParent(l,d,f=15,r=0,b=!0){if(r>f)return null;const u=this.resolveNode(l);if(!u)return null;if(typeof d=="string"){const A=this._wrappers.get(d);if(!A)throw new Error("invalid critera");if(!A.class)return null;d=B(C=>C&&C.constructor===A.class,"criteria")}const v=u.stateNode;if(v&&d(v,u))return v;if(u.return){const A=this.searchParent(u.return,d,f,r+1,b);if(A)return A}if(b&&v?.containerInfo){const A=v.containerInfo?.parentElement,C=A&&this.getReactInstance(A);if(C){const y=this.searchParent(C,d,f,r+1,b);if(y)return y}}return null}searchParentNode(l,d,f=15,r=0,b=!0){if(r>f)return null;const u=this.resolveNode(l);if(!u)return null;if(d(u))return u;if(u.return){const A=this.searchParentNode(u.return,d,f,r+1,b);if(A)return A}const v=u.stateNode;if(b&&v?.containerInfo){const A=v.containerInfo?.parentElement,C=A&&this.getReactInstance(A);if(C){const y=this.searchParentNode(C,d,f,r+1,b);if(y)return y}}return null}searchNode(l,d,f=15,r=0,b=!0){if(r>f)return null;const u=this.resolveNode(l);if(!u)return null;if(d(u))return u;if(u._ffz_no_scan||u.stateNode?._ffz_no_scan)return null;let v=u.child;for(;v;){const C=this.searchNode(v,d,f,r+1,b);if(C)return C;v=v.sibling}const A=u.stateNode;if(b&&A?.props?.root){const C=A.props.root._reactRootContainer;if(C){let y=C._internalRoot?.current||C.current;for(;y;){const a=this.searchNode(y,d,f,r+1,b);if(a)return a;y=y.sibling}}}return null}searchTree(l,d,f=15,r=0,b=!0,u){const v=this.resolveNode(l);if(u&&!(u instanceof Set)&&(u=new Set),!v||r>f)return u||null;if(typeof d=="string"){const y=this._wrappers.get(d);if(!y)throw new Error("invalid critera");if(!y.class)return u||null;d=B(a=>a&&a.constructor===y.class,"criteria")}const A=v.stateNode;if(A&&d(A,v))if(u)u.add(A);else return A;if(v._ffz_no_scan||v.stateNode?._ffz_no_scan)return u||null;let C=v.child;for(;C;){const y=this.searchTree(C,d,f,r+1,b,u);if(y&&!u)return y;C=C.sibling}if(b&&A?.props?.root){const y=A.props.root._reactRootContainer;if(y){let a=y._internalRoot?.current||y.current;for(;a;){const w=this.searchTree(a,d,f,r+1,b,u);if(w&&!u)return w;a=a.sibling}}}return u||null}findAllMatching(l,d,f=15,r=!0,b=!1,u=0,v=!0){const A=new Set;let C=B((y,a)=>!A.has(y)&&d(y,a),"crit");for(;;){const y=b?this.searchParent(l,C,f,u,v):this.searchTree(l,C,f,u,v);if(!y)break;if(r&&!A.size){const a=y.constructor;C=B((w,F)=>!A.has(w)&&w instanceof a&&d(w,F),"crit")}A.add(y)}return A}searchAll(l,d,f=15,r=0,b=null,u=!0){const v=this.resolveNode(l);if(b||(b={seen:new Set,classes:d.map(()=>null),out:d.map(()=>({cls:null,instances:new Set,depth:null})),max_depth:r}),!v||r>f)return b.out;r>b.max_depth&&(b.max_depth=r);const A=v.stateNode;if(A){const y=A.constructor,a=b.classes.indexOf(y);if(a!==-1)b.out[a].instances.add(A);else if(!b.seen.has(y)){let w=d.length;for(;w-- >0;)if(d[w](A,v)){b.classes[w]=b.out[w].cls=y,b.out[w].instances.add(A),b.out[w].depth=r;break}b.seen.add(y)}}if(v._ffz_no_scan||v.stateNode?._ffz_no_scan)return b.out;let C=v.child;for(;C;)this.searchAll(C,d,f,r+1,b,u),C=C.sibling;if(u&&A?.props?.root){const y=A.props.root._reactRootContainer;if(y){let a=y._internalRoot&&y._internalRoot.current||y.current;for(;a;)this.searchAll(a,d,f,r+1,b,u),a=a.sibling}}return b.out}route(l){this._route=l,this._updateLiveWaiting()}_updateLiveWaiting(){const l=this._live_waiting=[],d=this._waiting_crit=[],f=this._route;if(this._waiting)for(const r of this._waiting)r.routes===!1||!r.criteria||(!f||!r.routes?.length||r.routes.includes(f))&&(l.push(r),d.push(r.criteria));this._live_waiting.length?this._waiting_timer||this._startWaiting():this._stopWaiting()}define(l,d,f=null){if(this._wrappers.has(l))return this._wrappers.get(l);if(!d)throw new Error("cannot find definition and no criteria provided");const r=new W(l,d,f,this);this._wrappers.set(l,r);const b=this.react?this.searchAll(this.react,[d],1e3)[0]:null;return b?.cls?(r._set(b.cls,b.instances),this._known_classes.set(b.cls,r)):f!==!1&&(this._waiting.push(r),this._updateLiveWaiting()),r}wrap(l,d){let f;if(this._wrappers.has(l)?f=this._wrappers.get(l):(f=new W(l,null,null,this),this._wrappers.set(l,f)),d){if(f.class||f.criteria)throw new Error("tried setting a class on an already initialized FineWrapper");f._set(d,new Set),this._known_classes.set(d,f)}return f}_checkWaiters(l=null){if(this._live_waiting){Array.isArray(l)||(l=[l]);for(let d of l){if(!this._live_waiting.length||!this._waiting_crit)break;let f=null;if(!d&&this.react?f=this.react:d instanceof Node?f=this.getReactInstance(d):d?._reactInternals?f=d._reactInternals:d?._reactInternalFiber&&(f=d._reactInternalFiber),!f||f._ffz_no_scan||f.stateNode?._ffz_no_scan)continue;const r=this.searchAll(f,this._waiting_crit,1e3);let b=r.length;for(;b-- >0;)if(r[b].cls){const u=r[b],v=this._live_waiting.splice(b,1)[0];this._waiting_crit.splice(b,1);const A=this._waiting.indexOf(v);A!==-1&&this._waiting.splice(A,1),this.log.debug(`Found class for "${v.name}" at depth ${u.depth}`),v._set(u.cls,u.instances)}}this._live_waiting.length||this._stopWaiting()}}_startWaiting(){this.log.info("Installing MutationObserver."),this._waiting_timer=setInterval(()=>this._checkWaiters(),500),this._observer||(this._observer=new MutationObserver(l=>this._checkWaiters(l.map(d=>d.target)))),this._observer.observe(document.body,{childList:!0,subtree:!0})}_stopWaiting(){this.log.info("Stopping MutationObserver."),this._observer&&this._observer.disconnect(),this._waiting_timer&&clearInterval(this._waiting_timer),this._live_waiting=null,this._waiting_crit=null,this._waiting_timer=null}};B(x,"Fine");let I=x;const O={"will-mount":"UNSAFE_componentWillMount",mount:"componentDidMount",render:"render","receive-props":"UNSAFE_componentWillReceiveProps","should-update":"shouldComponentUpdate","will-update":"UNSAFE_componentWillUpdate",update:"componentDidUpdate",unmount:"componentWillUnmount"},p=class p extends K.EventEmitter{constructor(l,d,f,r){super(),this.name=l,this.criteria=d,this.fine=r,this.instances=new Set,this.routes=f??[],this._wrapped=new Map,this._class=null}get class(){return this._class}get first(){return this.toArray()[0]}__cleanListeners(){const l=super.__cleanListeners();for(const d of l){const f=O[d];if(f)try{this._unwrap(f)}catch{}}return l}toArray(){return Array.from(this.instances)}check(l=null,d=1e3){if(this._class||!this.criteria)return;const f=this.fine.findAllMatching(l,this.criteria,d);if(f.size){const r=Array.from(f);this._set(r[0].constructor,r)}}ready(l){this._class?l(this._class,this.instances):this.once("set",l)}each(l){for(const d of this.instances)l(d)}updateInstances(l=null,d=1e3){if(!this._class)return;const f=this.fine.findAllMatching(l,r=>r.constructor===this._class,d);for(const r of f)r._ffz_mounted=!0,this.instances.add(r)}_set(l,d){if(this._class)throw new Error("already have a class");this._class=l,l._ffz_wrapper=this;const f=this,r=this.instances,b=l.prototype,u=b.UNSAFE_componentWillMount,v=b.componentWillUnmount,A=b.UNSAFE_componentWillMount=u?function(...y){return this._ffz_mounted=!0,r.add(this),f.emit("will-mount",this,...y),u.apply(this,y)}:function(...y){this._ffz_mounted=!0,r.add(this),f.emit("will-mount",this,...y)},C=b.componentWillUnmount=v?function(...y){return f.emit("unmount",this,...y),r.delete(this),this._ffz_mounted=!1,v.apply(this,y)}:function(...y){f.emit("unmount",this,...y),r.delete(this),this._ffz_mounted=!1};this._wrapped.set("UNSAFE_componentWillMount",[A,u]),this._wrapped.set("componentWillUnmount",[C,v]);for(const y of this.events())this._maybeWrap(y);if(d)for(const y of d)y._ffz_mounted=!0,r.add(y);this.emit("set",l,r)}_add(l){for(const d of l)this.instances.add(d)}_maybeWrap(l){const d=O[l];!this._class||!d||this._wrapped.has(d)||this._wrap(l,d)}_wrap(l,d){if(this._wrapped.has(d)||!this._class)return;const f=this,r=this._class.prototype,b=r[d],u=r[d]=b?function(...v){return this._ffz_mounted||(this._ffz_mounted=!0,f.instances.add(this),f.emit("late-mount",this)),f.emit(l,this,...v),b.apply(this,v)}:d==="shouldComponentUpdate"?function(...v){return this._ffz_mounted||(this._ffz_mounted=!0,f.instances.add(this),f.emit("late-mount",this)),f.emit(l,this,...v),!0}:function(...v){this._ffz_mounted||(this._ffz_mounted=!0,f.instances.add(this),f.emit("late-mount",this)),f.emit(l,this,...v)};this._wrapped.set(d,[u,b])}_unwrap(l){const d=this._wrapped.get(l);if(!d||!this._class)return;const f=this._class.prototype,[r,b]=d;if(f[l]!==r)throw new Error("unable to unwrap -- prototype modified");f[l]=b,this._wrapped.delete(l)}forceUpdate(){for(const l of this.instances)try{l.forceUpdate(),this.fine.emit("site:dom-update",this.name,l)}catch(d){d instanceof Error&&this.fine.log.capture(d,{tags:{fine_wrapper:this.name}}),this.fine.log.error(`An error occurred when calling forceUpdate on an instance of ${this.name}`,d)}}on(l,d,f,r,b=!1){return this._maybeWrap(l),super.on(l,d,f,r,b)}once(l,d,f,r,b=!1){return this._maybeWrap(l),super.once(l,d,f,r,b)}many(l,d,f,r,b,u=!1){return this._maybeWrap(l),super.many(l,d,f,r,b,u)}waitFor(l,d,f,r=!1){return this._maybeWrap(l),super.waitFor(l,d,f,r)}};B(p,"FineWrapper");let W=p},24431:(me,te,S)=>{"use strict";S.r(te),S.d(te,{API_SERVER:()=>x,BAD_HOTKEYS:()=>b,DEBUG:()=>K,EMQX_SERVERS:()=>J,EXTENSION:()=>M,EmoteTypes:()=>oe,IS_FIREFOX:()=>se,IS_OSX:()=>Z,IS_WEBKIT:()=>Q,IS_WIN:()=>G,KEYS:()=>C,KNOWN_CODES:()=>a,LINK_DATA_HOSTS:()=>z,NEW_API:()=>l,PUBSUB_CLUSTERS:()=>$,REPLACEMENTS:()=>F,REPLACEMENT_BASE:()=>w,RERENDER_SETTINGS:()=>u,RESOLVERS_REQUIRE_TOS:()=>ie,SENTRY_ID:()=>d,SERVER:()=>I,SERVER_OR_EXT:()=>W,STAGING_API:()=>p,STAGING_CDN:()=>_,TWITCH_EMOTE_V2:()=>y,TWITCH_GLOBAL_SETS:()=>be,TWITCH_POINTS_SETS:()=>ve,TWITCH_PRIME_SETS:()=>Re,UPDATE_BADGE_SETTINGS:()=>v,UPDATE_TOKEN_SETTINGS:()=>A,WEBKIT_CSS:()=>ce,WEIRD_EMOTE_SIZES:()=>r,WORD_SEPARATORS:()=>f,WS_CLUSTERS:()=>D});const K=localStorage.ffzDebugMode==="true"&&document.body.classList.contains("ffz-dev"),M=!0,I=K?"https://localhost:8000":"https://cdn2.frankerfacez.com";let O=`${I}/script`;M&&(O=S.p,O.endsWith("/")&&(O=O.slice(0,O.length-1)));const W=O,x="https://api.frankerfacez.com",p="https://api-staging.frankerfacez.com",_="https://cdn-staging.frankerfacez.com",l="https://api2.frankerfacez.com",d="https://74b46b3894114f399d51949c6d237489@sentry.frankerfacez.com/2",f="[\\s`~<>!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}\\u00A1\\u00A7\\u00AB\\u00B6\\u00B7\\u00BB\\u00BF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0AF0\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E3B\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65]",r={15:[21,27],16:[22,27],17:[20,27],18:[20,27],22:[19,27],25:[25,28],26:[20,27],28:[39,27],30:[29,27],32:[21,27],33:[25,32],34:[21,28],36:[36,30],40:[21,27],41:[19,27],46:[24,24],47:[24,24],50:[18,27],52:[32,32],65:[40,30],66:[20,27],69:[41,28],73:[21,30],74:[24,30],86:[36,30],87:[24,30],92:[23,30],244:[24,30],354:[20,30],357:[28,30],360:[22,30],483:[20,18],484:[20,22],485:[27,18],486:[21,32],487:[15,32],488:[29,24],489:[20,18],490:[20,18],491:[20,18],492:[20,18],493:[20,18],494:[20,18],495:[20,18],496:[20,18],497:[20,18],498:[20,18],499:[20,18],500:[20,18],501:[20,18],1896:[20,30],1898:[26,28],1899:[22,30],1900:[33,30],1901:[24,28],1902:[27,29],1904:[24,30],1906:[24,30]},b=["f","space","k","shift+up","shift+down","esc","m","?","alt+t","alt+x"],u=["chat.name-format","chat.me-style","chat.rituals.show","chat.subs.show","chat.subs.compact","chat.actions.inline","chat.actions.hover","chat.timestamp-format","chat.points.allow-highlight","chat.filtering.display-deleted","chat.filtering.display-mod-action","chat.replies.style","chat.bits.cheer-notice","chat.filtering.hidden-tokens","chat.hype.message-style","chat.filtering.show-reasons","chat.emotes.allow-gigantify","chat.shared-chat.username-tooltip","chat.shared-chat.style"],v=["chat.badges.style","chat.badges.hidden","chat.badges.custom-mod","chat.badges.custom-vip"],A=["chat.emotes.enabled","chat.emotes.2x","chat.emotes.animated","chat.emoji.style","chat.emoji.replace-joiner","chat.bits.stack","chat.rich.enabled","chat.rich.want-mid","chat.rich.hide-tokens","chat.rich.all-links","chat.rich.minimum-level","chat.filtering.process-own","chat.filtering.mention-priority","chat.filtering.debug","chat.fix-bad-emotes","__filter:highlight-terms","__filter:highlight-users","__filter:highlight-badges","__filter:block-terms","__filter:block-users","__filter:block-badges"],C={Tab:9,Enter:13,Shift:16,Control:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Meta:91,Context:93},y="//static-cdn.jtvnw.net/emoticons/v2",a={"#-?[\\\\/]":"#-/",":-?(?:7|L)":":-7","\\&lt\\;\\]":"<]","\\:-?(S|s)":":-S","\\:-?\\\\":":-\\","\\:\\&gt\\;":":>","B-?\\)":"B-)","\\:-?[z|Z|\\|]":":-Z","\\:-?\\)":":-)","\\:-?\\(":":-(","\\:-?(p|P)":":-P","\\;-?(p|P)":";-P","\\&lt\\;3":"<3","\\:-?[\\\\/]":":-/","\\;-?\\)":";-)","R-?\\)":"R-)","[oO](_|\\.)[oO]":"O.o","[o|O](_|\\.)[o|O]":"O.o","\\:-?D":":-D","\\:-?(o|O)":":-O","\\&gt\\;\\(":">(","Gr(a|e)yFace":"GrayFace"},w=`${I}/static/replacements/`,F={15:"15-JKanStyle.png",16:"16-OptimizePrime.png",17:"17-StoneLightning.png",18:"18-TheRinger.png",22:"22-RedCoat.png",26:"26-JonCarnage.png",30:"30-BCWarrior.png",33:"33-DansGame.png",36:"36-PJSalt.png"},D={Production:[["wss://catbag.frankerfacez.com/",.25],["wss://andknuckles.frankerfacez.com/",.8],["wss://tuturu.frankerfacez.com/",.7],["wss://lilz.frankerfacez.com/",1],["wss://yoohoo.frankerfacez.com/",1],["wss://pog.frankerfacez.com/",1],["wss://ayaya.frankerfacez.com/",1],["wss://champ.frankerfacez.com/",1]],Development:[["ws://127.0.0.1:7999/",1]]},z={localhost:{title:"Local Dev Server (Port 8002)",value:"https://localhost:8002",has_sse:!0},"localhost-cf":{title:"Local Dev Worker (Wrangler, Port 8787)",value:"https://localhost:8787"},Production:{title:"Production",value:"https://link-service.workers.frankerfacez.com"}},$={Production:"https://pubsub.frankerfacez.com",Staging:"https://pubsub-staging-alt.frankerfacez.com",EMQXTest:"emqx-test",Development:"https://stendec.dev/ps/"},J=["biblethump.frankerfacez.com"],Z=navigator.platform?navigator.platform.indexOf("Mac")!==-1:/OS X/.test(navigator.userAgent),G=navigator.platform?navigator.platform.indexOf("Win")!==-1:/Windows/.test(navigator.userAgent),Q=navigator.userAgent.indexOf("AppleWebKit/")!==-1&&navigator.userAgent.indexOf("Edge/")===-1,se=navigator.userAgent.indexOf("Firefox/")!==-1,ce=Q?"-webkit-":"",be=[0,33,42],ve=[300238151],Re=[457,793,19151,19194];var oe=(ae=>(ae[ae.Unknown=0]="Unknown",ae[ae.Prime=1]="Prime",ae[ae.Turbo=2]="Turbo",ae[ae.LimitedTime=3]="LimitedTime",ae[ae.ChannelPoints=4]="ChannelPoints",ae[ae.Unavailable=5]="Unavailable",ae[ae.Subscription=6]="Subscription",ae[ae.BitsTier=7]="BitsTier",ae[ae.Global=8]="Global",ae[ae.TwoFactor=9]="TwoFactor",ae[ae.Follower=10]="Follower",ae))(oe||{});const ie={YouTube:{label:"You must agree to the YouTube Terms of Service to view this embed.",i18n_key:"embed.warn.youtube",i18n_links:"embed.warn.youtube.links",links:`To view YouTube embeds, you must agree to YouTube's Terms of Service:
* [Terms of Service](https://www.youtube.com/t/terms)
* [Privacy Policy](https://policies.google.com/privacy)`,i18n_accept:"embed.warn.youtube.agree",accept:"Yes, I accept the YouTube Terms of Service."}}},94417:(me,te,S)=>{var _;"use strict";S.d(te,{getDialogNextZ:()=>O});var K=S(17159),M=S(89196);let I=9e3;function O(){return I++}B(O,"getDialogNextZ");const W=(_=class extends K.EventEmitter{constructor(d,f={}){super(),this.selectors={exclusive:_.EXCLUSIVE,maximized:_.MAXIMIZED,normal:_.SELECTOR},f.selectors&&(this.selectors=Object.assign(this.selectors,f.selectors)),this._maximized=f.maximized||!1,this._exclusive=f.exclusive||!1,this.prepend=f.prepend||!1,this._element=null,this._visible=!1,typeof d=="function"?this.factory=d:this.element=d}get maximized(){return this._exclusive||this._maximized}set maximized(d){d=!!d,d!==this._maximized&&(this._visible?this.toggleSize():this._maximized=d)}get visible(){return this._visible}set visible(d){d=!!d,d!==this._visible&&this.toggleVisible()}get exclusive(){return this._exclusive}set exclusive(d){if(this._visible)throw new Error("cannot set exclusive flag when dialog already visible");this._exclusive=d}get element(){return this._element}set element(d){if(this._visible)throw new Error("cannot change element when dialog already visible");if(!(d instanceof Node))throw new Error("element must be an instance of Node");this._element=d}show(){this.visible=!0}hide(){this.visible=!1}maximize(){this.maximized=!0}restore(){this.maximized=!1}getContainer(){return document.querySelector(this._exclusive?this.selectors.exclusive:this._maximized?this.selectors.maximized:this.selectors.normal)}toggleVisible(d){if(d&&d.button!==0)return;const f=this.maximized,r=this._visible=!this._visible,b=this.getContainer();if(f&&b&&b.classList.toggle("ffz-has-dialog",r),!r){this._element&&this._element.remove(),this.emit("hide"),this.factory&&(this._element=null);return}if(b){if(this.factory){const u=this.factory();if(u instanceof Promise){u.then(v=>{this._element=v,this.prepend?b.insertBefore(v,b.firstChild):b.appendChild(v),this.emit("show")}).catch(v=>{this.emit("error",v)});return}else this._element=u}this._element&&(this.prepend?b.insertBefore(this._element,b.firstChild):b.appendChild(this._element),this.emit("show"))}}toggleSize(d){if(!this._visible||d&&d.button!==0||!this._element)return;this._maximized=!this._maximized;const f=this.maximized,r=this.getContainer(),b=this._element.parentElement;r!==b&&(f?r&&r.classList.add("ffz-has-dialog"):b&&b.classList.remove("ffz-has-dialog"),this._element.remove(),r&&(this.prepend?r.insertBefore(this._element,r.firstChild):r.appendChild(this._element)),this.emit("resize"))}},B(_,"_Dialog2"),_);W.EXCLUSIVE=M.Z.DIALOG_EXCLUSIVE,W.MAXIMIZED=M.Z.DIALOG_MAXIMIZED,W.SELECTOR=M.Z.DIALOG_SELECTOR;let x=null;var p=null},44589:(me,te,S)=>{"use strict";S.r(te),S.d(te,{ClickOutside:()=>a,ManagedStyle:()=>y,createElement:()=>d,findReactFragment:()=>l,hasSharedParent:()=>r,highlightJson:()=>w,off:()=>_,on:()=>p,openFile:()=>b,readFile:()=>u,sanitize:()=>A,setChildren:()=>f});var K=S(46949),M=S(24431);const I=["accept","accept-charset","accesskey","action","align","alt","async","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","crossorigin","data","data-*","datetime","default","defer","dir","dirname","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","integrity","ismap","itemprop","keytype","kind","label","lang","language","list","loop","low","manifest","max","maxlength","minlength","media","method","min","multiple","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","rel","required","reversed","rows","rowspan","sandbox","scope","scoped","seamless","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","type","usemap","value","width","wrap"],O=["controls","autoplay","loop"],W=document.createRange();function x(z){return z.replace(/[-_]\w/g,$=>$[1].toUpperCase())}B(x,"camelCase");function p(z,$,J,Z){return z.addEventListener($,J,Z)}B(p,"on");function _(z,$,J,Z){return z.removeEventListener($,J,Z)}B(_,"off");function l(z,$,J=25,Z=0,G){if(!G)G=new Set;else if(G.has(z))return null;if($(z))return z;if(Z>=J)return null;if(G.add(z),z?.props?.children)if(Array.isArray(z.props.children)){for(const Q of z.props.children)if(Q)if(Array.isArray(Q))for(const se of Q){const ce=l(se,$,J,Z+1,G);if(ce)return ce}else{const se=l(Q,$,J,Z+1,G);if(se)return se}}else{const Q=l(z.props.children,$,J,Z+1,G);if(Q)return Q}return null}B(l,"findReactFragment");function d(z,$,...J){const Z=document.createElement(z);if(J.length===0?J=null:J.length===1&&(J=J[0]),typeof $=="string")Z.className=$;else if($){for(const G in $)if((0,K.has)($,G)){const Q=G.toLowerCase(),se=$[G];if(Q==="style")if(typeof se=="string")Z.style.cssText=se;else if(se&&typeof se=="object")for(const[ce,be]of Object.entries(se))(0,K.has)(Z.style,ce)||(0,K.has)(Object.getPrototypeOf(Z.style),ce)?Z.style[ce]=be:Z.style.setProperty(ce,se[ce]);else M.DEBUG&&se!=null&&console.warn("unsupported style value",se);else if(Q==="dataset")if(se&&typeof se=="object")for(const ce in se)(0,K.has)(se,ce)&&(Z.dataset[x(ce)]=se[ce]);else M.DEBUG&&se!=null&&console.warn("unsupported dataset value",se);else G==="dangerouslySetInnerHTML"?se&&se.__html&&(Z.innerHTML=se.__html):Q.startsWith("on")?Z.addEventListener(Q.slice(2),se):Q.startsWith("data-")?Z.dataset[x(Q.slice(5))]=se:O.includes(Q)?se&&se!=="false"&&Z.setAttribute(G,se):Q.startsWith("aria-")||I.includes(Q)?Z.setAttribute(G,se):Z[G]=se}}return J&&f(Z,J),Z}B(d,"createElement");function f(z,$,J=!1,Z=!1){if(J&&window.FrankerFaceZ.get().log.warn("call to setChildren with no_sanitize set to true -- this is no longer supported"),$ instanceof Node)Z||(z.innerHTML=""),z.appendChild($);else if(Array.isArray($)){Z||(z.innerHTML="");for(const G of $)if(G instanceof Node)z.appendChild(G);else if(Array.isArray(G))f(z,G,J,!0);else if(G){const Q=typeof G=="string"?G:String(G);z.appendChild(document.createTextNode(Q))}}else if($){const G=typeof $=="string"?$:String($);z.appendChild(document.createTextNode(G))}}B(f,"setChildren");function r(z,$,J){for(;z;){if(z.contains($))return!0;z=z.parentElement,J&&(z=z instanceof Element?z.closest(J):null)}return!1}B(r,"hasSharedParent");function b(z,$){return new Promise(J=>{const Z=document.createElement("input");Z.type="file",Z.accept=z,Z.multiple=$;let G=!1;Z.onchange=()=>{if(!G){G=!0;const Q=Array.from(Z.files??[]);J($?Q:Q[0])}},Z.click()})}B(b,"openFile");function u(z,$="utf-8"){return new Promise((J,Z)=>{const G=new FileReader;G.readAsText(z,$),G.onload=()=>J(G.result),G.onerror=Q=>Z(Q)})}B(u,"readFile");const v=document.createElement("span");function A(z){v.textContent=z;const $=v.innerHTML;return v.textContent="",$}B(A,"sanitize");let C=0;const F=class F{constructor($){this.id=$||C++,this._blocks={},this._style=d("style",{type:"text/css",id:`ffz--managed-style--${this.id}`}),document.head.appendChild(this._style)}destroy(){this._style&&this._style.remove(),this._blocks=null,this._style=null}clear(){this._blocks={},this._style.innerHTML=""}get($){const J=this._blocks[$];if(J)return J.textContent}has($){return!!this._blocks[$]}set($,J,Z=!1){const G=this._blocks[$];if(G){if(!Z&&G.textContent===J)return;G.textContent=J}else this._style.appendChild(this._blocks[$]=document.createTextNode(J))}delete($){const J=this._blocks[$];J&&(this._style.contains(J)&&this._style.removeChild(J),this._blocks[$]=null)}};B(F,"ManagedStyle");let y=F;const D=class D{constructor($,J){this.el=$,this.cb=J,this._fn=this.handleClick.bind(this),document.documentElement.addEventListener("click",this._fn)}destroy(){this._fn&&document.documentElement.removeEventListener("click",this._fn),this.cb=this.el=this._fn=null}handleClick($){this.cb&&this.el&&!this.el.contains($.target)&&this.cb($)}};B(D,"ClickOutside");let a=D;function w(z,$=!1,J=1,Z=30){let G="",Q="";if($&&(G="    ".repeat(J-1),Q="    ".repeat(J)),J>Z)return'<span class="ffz-ct--obj-literal">&lt;nested&gt;</span>';if(z==null)return`<span class="ffz-ct--literal" depth="${J}">null</span>`;if(typeof z=="number"||typeof z=="boolean")return`<span class="ffz-ct--literal" depth="${J}">${z}</span>`;if(typeof z=="string")return`<span class=ffz-ct--string depth="${J}">${A(JSON.stringify(z))}</span>`;if(Array.isArray(z))return`<span class="ffz-ct--obj-open" depth="${J}">[</span>`+(z.length>0?z.map(ce=>($?`
${Q}`:"")+w(ce,$,J+1,Z)).join(`<span class="ffz-ct--obj-sep" depth="${J}">, </span>`)+($?`
${G}`:""):"")+`<span class="ffz-ct--obj-close" depth="${J}">]</span>`;const se=[];for(const[ce,be]of Object.entries(z))se.length>0&&se.push(`<span class="ffz-ct--obj-sep" depth="${J}">, </span>`),$&&se.push(`
${Q}`),se.push(`<span class="ffz-ct--obj-key" depth="${J}">${A(JSON.stringify(ce))}</span><span class="ffz-ct--obj-key-sep" depth="${J}">: </span>`),se.push(w(be,$,J+1,Z));return`<span class="ffz-ct--obj-open" depth="${J}">{</span>${se.join("")}${se.length&&$?`
${G}`:""}<span class="ffz-ct--obj-close" depth="${J}">}</span>`}B(w,"highlightJson")},17159:(me,te,S)=>{var r;"use strict";S.r(te),S.d(te,{Detach:()=>K,EventEmitter:()=>p,FFZEvent:()=>_,FFZWaitableEvent:()=>l,HierarchicalEventEmitter:()=>d,StopPropagation:()=>M,default:()=>f});const K=Symbol("Detach"),M=Symbol("StopPropagation"),I=/([a-z])([A-Z])/g,O=/[ \t\W]/g,W=/^_+|_+$/g;String.prototype.toSlug=function(A="-"){let C=this;return C.normalize&&(C=C.normalize("NFD")),C.replace(/[\u0300-\u036f]/g,"").trim().toLowerCase().replace(/[^a-z0-9 ]/g,"").replace(/\s+/g,A)},String.prototype.toSnakeCase=function(){let A=this;return A.normalize&&(A=A.normalize("NFD")),A.replace(/[\u0300-\u036f]/g,"").trim().replace(I,"$1_$2").replace(O,"_").replace(W,"").toLowerCase()};const x=(r=class{constructor(){this.__listeners={},this.__running=new Set,this.__dead_events=0}__cleanListeners(){if(!this.__dead_events)return[];const C={},y=this.__listeners,a=[];for(const[w,F]of Object.entries(y))F?.length?C[w]=F:a.push(w);return this.__listeners=C,this.__dead_events=0,a}__sortListeners(C){if(this.__running.has(C))return;const y=this.__listeners[C];y&&y.sort((a,w)=>a[3]-w[3])}transferListeners(C){if(!(C instanceof r))throw new Error("other must also be EventEmitter");if(!(C.events().length+C.__running.size)){C.__listeners=this.__listeners,C.__dead_events=this.__dead_events,this.__listeners={},this.__dead_events=0;return}for(const[a,w]of Object.entries(this.__listeners)){if(!w||!w.length)continue;let F=C.__listeners[a];Array.isArray(F)?(F.push(...w),C.__sortListeners(a)):C.__listeners[a]=w}this.__listeners={},this.__dead_events=0}makeEvent(C){return _.makeEvent(C)}makeWaitableEvent(C){return l.makeEvent(C)}on(C,y,a,w,F=!1){if(typeof y!="function")throw new TypeError("fn must be a function");const D=[y,a,!1,w??0,F],z=this.__listeners[C];return z?(F?z.unshift(D):z.push(D),this.__sortListeners(C)):this.__listeners[C]=[D],this}once(C,y,a,w,F=!1){return this.many(C,1,y,a,w,F)}many(C,y,a,w,F,D=!1){if(typeof a!="function")throw new TypeError("fn must be a function");if(typeof y!="number"||isNaN(y)||!isFinite(y)||y<1)throw new TypeError("ttl must be a positive, finite number");const z=[a,w,y,F??0,D],$=this.__listeners[C];return $?(D?$.unshift(z):$.push(z),this.__sortListeners(C)):this.__listeners[C]=[z],this}waitFor(C,y,a,w=!1){return new Promise(F=>{const D=[(...$)=>F($),y,1,a??0,w],z=this.__listeners[C];z?(w?z.unshift(D):z.push(D),this.__sortListeners(C)):this.__listeners[C]=[D]})}off(C,y,a){if(C==null){if(!y&&!a)throw new Error("you must provide at least one constraint when removing listeners");for(const F in Object.keys(this.__listeners))this.__running.has(F)||this.off(F,y,a);return this}if(this.__running.has(C))throw new Error("concurrent modification: tried removing event listener while event is running");let w=this.__listeners[C];return w?(!y&&!a?w=null:(w=w.filter(([F,D])=>!((!y||F===y)&&(!a||a===D))),w.length||(w=null)),this.__listeners[C]=w,w||this.__dead_events++,this):this}offContext(C,y){return this.off(C,void 0,y)}events(){return this.__cleanListeners(),Object.keys(this.__listeners)}listeners(C){const y=this.__listeners[C];return y?Array.from(y):[]}hasListeners(C){return!!this.__listeners[C]}emit(C,...y){let a=this.__listeners[C];if(!a)return;if(this.__running.has(C))throw new Error("concurrent access: tried to emit event while event is running");const w=new Set;this.__listeners[C]=null,this.__running.add(C);for(const z of a){const[$,J,Z]=z;let G;try{G=$.apply(J,y)}catch(Q){this.log&&(this.log.capture(Q,{tags:{event:C},extra:{args:y}}),this.log.error(Q))}if(G===K?w.add(z):Z!==!1&&(Z<=1?w.add(z):z[2]=Z-1),G instanceof Promise&&y[0]instanceof l&&y[0].waitFor(G),y[0]instanceof _&&y[0].propagationStopped||G===M)break}if(w.size)for(const z of w){const $=a.indexOf(z);$!==-1&&a.splice($,1)}let F=!1;const D=this.__listeners[C];D&&(a=a.concat(D),F=!0),a.length?this.__listeners[C]=a:(this.__listeners[C]=null,this.__dead_events++),this.__running.delete(C),F&&this.__sortListeners(C)}},B(r,"_EventEmitter2"),r);x.Detach=K,x.StopPropagation=M;let p=x;const b=class b{static makeEvent(C){return new b(C)}constructor(C){this.defaultPrevented=!1,this.propagationStopped=!1,Object.assign(this,C)}_reset(){this.defaultPrevented=!1,this.propagationStopped=!1}stopPropagation(){this.propagationStopped=!0}preventDefault(){this.defaultPrevented=!0}};B(b,"FFZEvent");let _=b;const u=class u extends _{constructor(){super(...arguments),this.__waiter_results=null}static makeEvent(C){return new u(C)}_wait(){if(this.__waiter)return this.__waiter;if(!this.__promises){const y=this.__waiter_results;return this.__waiter_results=null,y?Promise.resolve(y):null}const C=this.__promises;return this.__promises=null,this.__waiter=Promise.all(C).then(y=>(this.__waiter_results?this.__waiter_results.push(...y):this.__waiter_results=y,this.__waiter=null,this._wait()??[])).catch(y=>{throw this.__waiter=null,y})}_reset(){super._reset(),this.__waiter=null,this.__waiter_results=null,this.__promises=null}waitFor(C){this.__promises?this.__promises.push(C):this.__promises=[C]}};B(u,"FFZWaitableEvent");let l=u;const v=class v extends p{constructor(C,y){super(),this.name=C||(this.constructor.name||"").toSnakeCase(),this.parent=y,y?(this.root=y.root,this.__listeners=y.__listeners,this.__running=y.__running,this.__path=C&&y.__path?`${y.__path}.${C}`:C):(this.root=this,this.__path=void 0),this.__path_parts=this.__path?this.__path.split("."):[]}get path(){return this.__path}transferListeners(C){if(!(C instanceof v&&C.root===this.root))throw new Error("Transfering listeners from a HierarchicalEventEmitter is not supported.")}abs_path(C){if(typeof C!="string"||!C.length)throw new TypeError("path must be a non-empty string");let y=0,a;const w=this.__path_parts,F=w.length;do{if(a=C.charAt(y),C.charAt(y)==="."){if(y>F)throw new Error("invalid path: reached top of stack");continue}break}while(++y<C.length);const D=a===":";if(y===0)return D&&this.__path?`${this.__path}${C}`:C;const z=w.slice(0,F-(y-1)).join("."),$=C.slice(y);if(z.length)if($.length){if(D)return z+$}else return z;else return $;return`${z}.${$}`}on(C,y,a,w,F=!1){return super.on(this.abs_path(C),y,a,w,F)}once(C,y,a,w,F=!1){return super.once(this.abs_path(C),y,a,w,F)}many(C,y,a,w,F,D=!1){return super.many(this.abs_path(C),y,a,w,F,D)}waitFor(C,y,a,w=!1){return super.waitFor(this.abs_path(C),y,a,w)}off(C,y,a){return super.off(C&&this.abs_path(C),y,a)}listeners(C){return super.listeners(this.abs_path(C))}hasListeners(C){return super.hasListeners(this.abs_path(C))}emit(C,...y){return super.emit(this.abs_path(C),...y)}eventsWithChildren(){const C=super.events(),y=this.__path||"",a=y.length;return C.filter(w=>{const F=w.charAt(a);return w.startsWith(y)&&(F===""||F==="."||F===":")})}events(){const C=super.events(),y=this.__path||"",a=y.length;return C.filter(w=>{const F=w.charAt(a);return w.startsWith(y)&&(F===""||F===":")})}};B(v,"HierarchicalEventEmitter");let d=v;const f=d},37087:(me,te,S)=>{"use strict";S.d(te,{createTester:()=>K});function K(M,I,O=!1,W=!1,x){if(!Array.isArray(M)||!I)return O?()=>!1:()=>!0;const p=[],_=[];let l=0;for(const d of M){if(!d||!d.type)continue;const f=I[d.type];if(!f){l++,p.push(()=>!1),_.push(`f${l}`);continue}const r=f.createTest(d.data,I,x);r&&(l++,p.push(r),_.push(`f${l}`))}return p.length?p.length===1?O?d=>!p[0](d):p[0]:new Function(..._,"ctx",`return ${O?"!(":""}${_.map(d=>`${d}(ctx)`).join(W?" || ":" && ")}${O?")":""};`).bind(null,...p):O?()=>!1:()=>!0}B(K,"createTester")},61892:(me,te,S)=>{"use strict";S.d(te,{ALIASES:()=>I,ICONS:()=>O,load:()=>x,maybeLoad:()=>p});var K=S(44589);const M=S.p+"font-awesome.css",I={ban:["ban","block"],ok:["ok","unban","untimeout"],"clock-o":["clock-o","clock","timeout"],times:["remove","close","times"],cog:["gear","cog"],repeat:["rotate-right","repeat"],outdent:["dedent","outdent"],"picture-o":["photo","image","picture-o"],"pencil-square-o":["edit","pencil-square-o"],share:["mail-forward","share"],"exclamation-triangle":["warning","exclamation-triangle"],"bar-chart":["bar-chart-o","bar-chart"],cogs:["gears","cogs"],facebook:["facebook-f","facebook"],rss:["feed","rss"],users:["group","users"],link:["chain","link"],scissors:["cut","scissors"],"files-o":["copy","files-o"],"floppy-o":["save","floppy-o"],bars:["navicon","reorder","bars"],sort:["unsorted","sort"],"sort-desc":["sort-down","sort-desc"],"sort-asc":["sort-up","sort-asc"],undo:["rotate-left","undo"],gavel:["legal","gavel"],tachometer:["dashboard","tachometer"],bolt:["flash","bolt"],clipboard:["paste","clipboard"],mobile:["mobile-phone","mobile"],reply:["mail-reply","reply"],"reply-all":["mail-reply-all","reply-all"],"star-half-o":["star-half-empty","star-half-full","star-half-o"],"chain-broken":["unlink","chain-broken"],"caret-square-o-down":["toggle-down","caret-square-o-down"],"caret-square-o-up":["toggle-up","caret-square-o-up"],"caret-square-o-right":["toggle-right","caret-square-o-right"],eur:["euro","eur"],usd:["dollar","usd"],inr:["rupee","inr"],jpy:["cny","rmb","yen","jpy"],rub:["ruble","rouble","rub"],krw:["won","krw"],btc:["bitcoin","btc"],gratipay:["gittip","gratipay"],"caret-square-o-left":["toggle-left","caret-square-o-left"],try:["turkish-lira","try"],university:["institution","bank","university"],"graduation-cap":["mortar-board","graduation-cap"],car:["automobile","car"],taxi:["cab","taxi"],"file-image-o":["file-photo-o","file-picture-o","file-image-o"],"file-archive-o":["file-zip-o","file-archive-o"],"file-audio-o":["file-sound-o","file-audio-o"],"file-video-o":["file-movie-o","file-video-o"],"life-ring":["life-bouy","life-buoy","life-saver","support","life-ring"],rebel:["ra","resistance","rebel"],empire:["ge","empire"],"hacker-news":["y-combinator-square","yc-square","hacker-news"],weixin:["wechat","weixin"],"paper-plane":["send","paper-plane"],"paper-plane-o":["send-o","paper-plane-o"],"futbol-o":["soccer-ball-o","futbol-o"],ils:["shekel","sheqel","ils"],transgender:["intersex","transgender"],bed:["hotel","bed"],"y-combinator":["yc","y-combinator"],"battery-full":["battery-4","battery","battery-full"],"battery-three-quarters":["battery-3","battery-three-quarters"],"battery-half":["battery-2","battery-half"],"battery-quarter":["battery-1","battery-quarter"],"battery-empty":["battery-0","battery-empty"],"hourglass-start":["hourglass-1","hourglass-start"],"hourglass-half":["hourglass-2","hourglass-half"],"hourglass-end":["hourglass-3","hourglass-end"],"hand-rock-o":["hand-grab-o","hand-rock-o"],"hand-paper-o":["hand-stop-o","hand-paper-o"],television:["tv","television"],"american-sign-language-interpreting":["asl-interpreting","american-sign-language-interpreting"],deaf:["deafness","hard-of-hearing","deaf"],"sign-language":["signing","sign-language"],"google-plus-official":["google-plus-circle","google-plus-official"],"font-awesome":["fa","font-awesome"],"address-card":["vcard","address-card"],"address-card-o":["vcard-o","address-card-o"],"id-card":["drivers-license","id-card"],"id-card-o":["drivers-license-o","id-card-o"],"thermometer-full":["thermometer-4","thermometer","thermometer-full"],"thermometer-three-quarters":["thermometer-3","thermometer-three-quarters"],"thermometer-half":["thermometer-2","thermometer-half"],"thermometer-quarter":["thermometer-1","thermometer-quarter"],"thermometer-empty":["thermometer-0","thermometer-empty"],bath:["bathtub","s15","bath"],"window-close":["times-rectangle","window-close"],"window-close-o":["times-rectangle-o","window-close-o"]},O=["glass","music","search","envelope-o","heart","star","star-o","user","film","th-large","th","th-list","check","times","search-plus","search-minus","power-off","signal","cog","trash-o","home","file-o","clock-o","road","download","arrow-circle-o-down","arrow-circle-o-up","inbox","play-circle-o","repeat","refresh","list-alt","lock","flag","headphones","volume-off","volume-down","volume-up","qrcode","barcode","tag","tags","book","bookmark","print","camera","font","bold","italic","text-height","text-width","align-left","align-center","align-right","align-justify","list","outdent","indent","video-camera","picture-o","pencil","map-marker","adjust","tint","pencil-square-o","share-square-o","check-square-o","arrows","step-backward","fast-backward","backward","play","pause","stop","forward","fast-forward","step-forward","eject","chevron-left","chevron-right","plus-circle","minus-circle","times-circle","check-circle","question-circle","info-circle","crosshairs","times-circle-o","check-circle-o","ban","arrow-left","arrow-right","arrow-up","arrow-down","share","expand","compress","plus","minus","asterisk","exclamation-circle","gift","leaf","fire","eye","eye-slash","exclamation-triangle","plane","calendar","random","comment","magnet","chevron-up","chevron-down","retweet","shopping-cart","folder","folder-open","arrows-v","arrows-h","bar-chart","twitter-square","facebook-square","camera-retro","key","cogs","comments","thumbs-o-up","thumbs-o-down","star-half","heart-o","sign-out","linkedin-square","thumb-tack","external-link","sign-in","trophy","github-square","upload","lemon-o","phone","square-o","bookmark-o","phone-square","twitter","facebook","github","unlock","credit-card","rss","hdd-o","bullhorn","bell","certificate","hand-o-right","hand-o-left","hand-o-up","hand-o-down","arrow-circle-left","arrow-circle-right","arrow-circle-up","arrow-circle-down","globe","wrench","tasks","filter","briefcase","arrows-alt","users","link","cloud","flask","scissors","files-o","paperclip","floppy-o","square","bars","list-ul","list-ol","strikethrough","underline","table","magic","truck","pinterest","pinterest-square","google-plus-square","google-plus","money","caret-down","caret-up","caret-left","caret-right","columns","sort","sort-desc","sort-asc","envelope","linkedin","undo","gavel","tachometer","comment-o","comments-o","bolt","sitemap","umbrella","clipboard","lightbulb-o","exchange","cloud-download","cloud-upload","user-md","stethoscope","suitcase","bell-o","coffee","cutlery","file-text-o","building-o","hospital-o","ambulance","medkit","fighter-jet","beer","h-square","plus-square","angle-double-left","angle-double-right","angle-double-up","angle-double-down","angle-left","angle-right","angle-up","angle-down","desktop","laptop","tablet","mobile","circle-o","quote-left","quote-right","spinner","circle","reply","github-alt","folder-o","folder-open-o","smile-o","frown-o","meh-o","gamepad","keyboard-o","flag-o","flag-checkered","terminal","code","reply-all","star-half-o","location-arrow","crop","code-fork","chain-broken","question","info","exclamation","superscript","subscript","eraser","puzzle-piece","microphone","microphone-slash","shield","calendar-o","fire-extinguisher","rocket","maxcdn","chevron-circle-left","chevron-circle-right","chevron-circle-up","chevron-circle-down","html5","css3","anchor","unlock-alt","bullseye","ellipsis-h","ellipsis-v","rss-square","play-circle","ticket","minus-square","minus-square-o","level-up","level-down","check-square","pencil-square","external-link-square","share-square","compass","caret-square-o-down","caret-square-o-up","caret-square-o-right","eur","gbp","usd","inr","jpy","rub","krw","btc","file","file-text","sort-alpha-asc","sort-alpha-desc","sort-amount-asc","sort-amount-desc","sort-numeric-asc","sort-numeric-desc","thumbs-up","thumbs-down","youtube-square","youtube","xing","xing-square","youtube-play","dropbox","stack-overflow","instagram","flickr","adn","bitbucket","bitbucket-square","tumblr","tumblr-square","long-arrow-down","long-arrow-up","long-arrow-left","long-arrow-right","apple","windows","android","linux","dribbble","skype","foursquare","trello","female","male","gratipay","sun-o","moon-o","archive","bug","vk","weibo","renren","pagelines","stack-exchange","arrow-circle-o-right","arrow-circle-o-left","caret-square-o-left","dot-circle-o","wheelchair","vimeo-square","try","plus-square-o","space-shuttle","slack","envelope-square","wordpress","openid","university","graduation-cap","yahoo","google","reddit","reddit-square","stumbleupon-circle","stumbleupon","delicious","digg","pied-piper-pp","pied-piper-alt","drupal","joomla","language","fax","building","child","paw","spoon","cube","cubes","behance","behance-square","steam","steam-square","recycle","car","taxi","tree","spotify","deviantart","soundcloud","database","file-pdf-o","file-word-o","file-excel-o","file-powerpoint-o","file-image-o","file-archive-o","file-audio-o","file-video-o","file-code-o","vine","codepen","jsfiddle","life-ring","circle-o-notch","rebel","empire","git-square","git","hacker-news","tencent-weibo","qq","weixin","paper-plane","paper-plane-o","history","circle-thin","header","paragraph","sliders","share-alt","share-alt-square","bomb","futbol-o","tty","binoculars","plug","slideshare","twitch","yelp","newspaper-o","wifi","calculator","paypal","google-wallet","cc-visa","cc-mastercard","cc-discover","cc-amex","cc-paypal","cc-stripe","bell-slash","bell-slash-o","trash","copyright","at","eyedropper","paint-brush","birthday-cake","area-chart","pie-chart","line-chart","lastfm","lastfm-square","toggle-off","toggle-on","bicycle","bus","ioxhost","angellist","cc","ils","meanpath","buysellads","connectdevelop","dashcube","forumbee","leanpub","sellsy","shirtsinbulk","simplybuilt","skyatlas","cart-plus","cart-arrow-down","diamond","ship","user-secret","motorcycle","street-view","heartbeat","venus","mars","mercury","transgender","transgender-alt","venus-double","mars-double","venus-mars","mars-stroke","mars-stroke-v","mars-stroke-h","neuter","genderless","facebook-official","pinterest-p","whatsapp","server","user-plus","user-times","bed","viacoin","train","subway","medium","y-combinator","optin-monster","opencart","expeditedssl","battery-full","battery-three-quarters","battery-half","battery-quarter","battery-empty","mouse-pointer","i-cursor","object-group","object-ungroup","sticky-note","sticky-note-o","cc-jcb","cc-diners-club","clone","balance-scale","hourglass-o","hourglass-start","hourglass-half","hourglass-end","hourglass","hand-rock-o","hand-paper-o","hand-scissors-o","hand-lizard-o","hand-spock-o","hand-pointer-o","hand-peace-o","trademark","registered","creative-commons","gg","gg-circle","tripadvisor","odnoklassniki","odnoklassniki-square","get-pocket","wikipedia-w","safari","chrome","firefox","opera","internet-explorer","television","contao","500px","amazon","calendar-plus-o","calendar-minus-o","calendar-times-o","calendar-check-o","industry","map-pin","map-signs","map-o","map","commenting","commenting-o","houzz","vimeo","black-tie","fonticons","reddit-alien","edge","credit-card-alt","codiepie","modx","fort-awesome","usb","product-hunt","mixcloud","scribd","pause-circle","pause-circle-o","stop-circle","stop-circle-o","shopping-bag","shopping-basket","hashtag","bluetooth","bluetooth-b","percent","gitlab","wpbeginner","wpforms","envira","universal-access","wheelchair-alt","question-circle-o","blind","audio-description","volume-control-phone","braille","assistive-listening-systems","american-sign-language-interpreting","deaf","glide","glide-g","sign-language","low-vision","viadeo","viadeo-square","snapchat","snapchat-ghost","snapchat-square","pied-piper","first-order","yoast","themeisle","google-plus-official","font-awesome","handshake-o","envelope-open","envelope-open-o","linode","address-book","address-book-o","address-card","address-card-o","user-circle","user-circle-o","user-o","id-badge","id-card","id-card-o","quora","free-code-camp","telegram","thermometer-full","thermometer-three-quarters","thermometer-half","thermometer-quarter","thermometer-empty","shower","bath","podcast","window-maximize","window-minimize","window-restore","window-close","window-close-o","bandcamp","grav","etsy","imdb","ravelry","eercast","microchip","snowflake-o","superpowers","wpexplorer","meetup"];let W=!1;const x=B(()=>{W||(W=!0,document.head.appendChild((0,K.createElement)("link",{href:M,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"})))},"load"),p=B(_=>{W||!String(_).startsWith("fa-")&&!String(_).startsWith("ffz-fa")||x()},"maybeLoad")},83342:(me,te,S)=>{"use strict";S.d(te,{R7:()=>v,jo:()=>A});var K=S(44589);const M=S.p+"opendyslexic.css",I=["Roobert","Arial","Arial Black","Verdana","Helvetica","Tahoma","Trebuchet MS","Impact","Didot","American Typewriter","Lucida Console","Monaco","Bradley Hand","Times New Roman","Georgia","Garamond","Courier New","Brush Script MT","Comic Sans MS"],O=document.fonts?.check?I.filter(C=>document.fonts.check(`16px ${C}`)).sort():I.sort(),W=["Roboto","Open Sans","Noto Sans JP","Lato","Montserrat","Roboto Condensed","Source Sans Pro","Oswald","Poppins","Noto Sans","Roboto Mono","Raleway","Ubuntu","Merriweather","Nunito","PT Sans","Roboto Slab","Playfair Display","Lora","Rubik","Mukta","Noto Sans KR","Work Sans","Nunito Sans","Nanum Gothic","Inter","Quicksand","PT Serif","Hind Siliguri","Titilium Web","Fira Sans","Noto Serif","Noto Sans TC","Karla"],x=new Map,p=new Map;function _(C){if(p.has(C))return;const y=encodeURIComponent(C),a=(0,K.createElement)("link",{id:`ffz-font-${y}`,rel:"stylesheet",href:`https://fonts.googleapis.com/css2?family=${y}`});p.set(C,a),document.head.appendChild(a)}B(_,"loadGoogleFont");function l(C){const y=p.get(C);y&&(p.delete(C),y.remove())}B(l,"unloadGoogleFont");const d=["OpenDyslexic","OpenDyslexicAlta","OpenDyslexicMono"];let f=0,r=null;function b(){r||(r=(0,K.createElement)("link",{id:"ffz-font-opendyslexic",rel:"stylesheet",type:"text/css",href:M}),document.head.appendChild(r))}B(b,"loadOpenDyslexic");function u(){r&&(r.remove(),r=null)}B(u,"unloadOpenDyslexic");function v(){const C=[{value:"",i18n_key:"setting.font.default",title:"Default"},{separator:!0,i18n_key:"setting.font.builtin",title:"Built-in Fonts"}];for(const y of O)C.push({value:y,title:y});C.push({separator:!0,i18n_key:"setting.font.dyslexic",title:"Dyslexia Fonts"});for(const y of d)C.push({value:y,title:y});C.push({separator:!0,i18n_key:"setting.font.google",title:"Google Fonts"});for(const y of W)C.push({value:`google:${y}`,title:y});return C}B(v,"getFontsList");function A(C){if(!C)return[C,null];if(d.includes(C)){f++,f===1&&b();let y=!1;return[C,B(()=>{y||(y=!0,f--,f||u())},"unloader")]}if(C.startsWith("google:")){const y=C.slice(7),a=(x.get(y)??0)+1;x.set(y,a),a===1&&_(y);let w=!1;return[y,B(()=>{if(!w){w=!0;const D=(x.get(y)??0)-1;D>0?x.set(y,D):(x.delete(y),l(y))}},"unloader")]}return[C,null]}B(A,"useFont")},5286:(me,te,S)=>{"use strict";S.d(te,{default:()=>I});const K={Document:(O,W)=>(O.definitions&&W.definitions?O.definitions=M(O.definitions,W.definitions):W.definitions&&(O.definitions=W.definitions),O),Field:(O,W)=>(O.name&&(!W.name||W.name.value!==O.name.value)||(O.selectionSet&&W.selectionSet?O.selectionSet=I(O.selectionSet,W.selectionSet):W.selectionSet&&(O.selectionSet=W.selectionSet)),O),OperationDefinition:(O,W)=>(O.operation!==W.operation||(O.selectionSet&&W.selectionSet?O.selectionSet=I(O.selectionSet,W.selectionSet):W.selectionSet&&(O.selectionSet=W.selectionSet)),O),FragmentDefinition:(O,W)=>(O.typeCondition&&W.typeCondition&&(O.typeCondition.kind!==W.typeCondition.kind||O.typeCondition.name.value!=W.typeCondition.name.value)||(O.selectionSet&&W.selectionSet?O.selectionSet=I(O.selectionSet,W.selectionSet):W.selectionSet&&(O.selectionSet=W.selectionSet)),O),SelectionSet:(O,W)=>(O.selections&&W.selections?O.selections=M(O.selections,W.selections):W.selections&&(O.selections=W.selections),O)};function M(O,W){let x=!1;const p={};for(const _ of O)!_||!_.name||_.name.kind!=="Name"||(_.operation&&(x=!0),p[_.name.value]=_);for(const _ of W){if(!_||!_.name||_.name.kind!=="Name")continue;const l=_.name.value,d=p[l]?O.indexOf(p[l]):-1;if(d!==-1){if(O[d].operation&&_.operation&&O[d].operation!==_.operation)continue;O[d]=I(O[d],_),O[d].operation&&(x=!0)}else{if(x&&_.operation)continue;O.push(_)}}return O}B(M,"mergeList");function I(O,W){return O.kind!==W.kind?O:K[O.kind]?K[O.kind](O,W):O}B(I,"merge")},55467:(me,te,S)=>{var p;"use strict";S.r(te),S.d(te,{LogLevel:()=>M,Logger:()=>W,default:()=>x});const K={1:"debug",2:"info",4:"warn",8:"error"};var M=(_=>(_[_.Verbose=0]="Verbose",_[_.Debug=1]="Debug",_[_.Info=2]="Info",_[_.Warning=4]="Warning",_[_.Error=8]="Error",_[_.Off=99]="Off",_))(M||{});function I(){const _=localStorage.ffzLogLevel;if(!_)return null;const l=_.toUpperCase(),d=W[l];return typeof d=="number"?d:/^\d+$/.test(_)?parseInt(_,10):null}B(I,"readLSLevel");const O=(p=class{constructor(l,d,f,r){this.root=l?l.root:this,this.parent=l,this.name=d,this.root==this&&(this.init=!1,this.captured_init=[],this.label="FFZ"),this.enabled=!0,this.level=f??(l&&l.level)??I()??p.DEFAULT_LEVEL,this.raven=r||l&&l.raven,this.children={}}hi(l,d){const f=d??l.constructor?.version_info;this.info(`FrankerFaceZ v${f} (s:${l.host} f:${l.flavor} b:${f?.build} c:${f?.commit||"null"})`);try{const r=new URL(location.toString());r.search="",this.info(`Initial URL: ${r}`)}catch(r){this.warn("Unable to read location.",r)}}get(l,d){return this.children[l]||(this.children[l]=new p(this,this.name?`${this.name}.${l}`:l,d)),this.children[l]}verbose(l,...d){return this.invoke(0,l,d)}verboseColor(l,d,...f){return this.invokeColor(p.VERBOSE,l,d,f)}debug(l,...d){return this.invoke(p.DEBUG,l,d)}debugColor(l,d,...f){return this.invokeColor(p.DEBUG,l,d,f)}info(l,...d){return this.invoke(p.INFO,l,d)}infoColor(l,d,...f){return this.invokeColor(p.INFO,l,d,f)}warn(l,...d){return this.invoke(p.WARN,l,d)}warnColor(l,d,...f){return this.invokeColor(p.WARN,l,d,f)}warning(l,...d){return this.invoke(p.WARN,l,d)}warningColor(l,d,...f){return this.invokeColor(p.WARN,l,d,f)}error(l,...d){return this.invoke(p.ERROR,l,d)}errorColor(l,d,...f){return this.invokeColor(p.ERROR,l,d,f)}crumb(...l){if(this.raven)return this.raven.captureBreadcrumb(...l)}capture(l,d,...f){if(this.raven&&(d=d||{},d.logger||(d.logger=this.name),this.raven.captureException(l,d)),f.length){const r=f.shift();return this.error(r,...f)}}invokeColor(l,d,f,...r){if(!this.enabled||l<this.level)return;if(Array.isArray(f)||(f=[f]),l>0){let u=d;typeof u=="string"&&(u=u.replace(/%c/g,"")),r.length&&(u=`${u} ${r.join(" ")}`),this.root.init&&this.root.captured_init&&this.root.captured_init.push({time:Date.now(),category:this.name,message:u,level:K[l]||l}),this.crumb({message:u,category:this.name,level:K[l]||l})}const b=l<2?"color:#999999":"";this.name?(typeof d=="string"?d=`%c${this.root.label} [%c${this.name}%c]:%c ${d}`:(r.unshift(d),d=`%c${this.root.label} [%c${this.name}%c]:%c`),f.unshift("color:#755000; font-weight:bold",b,"color:#755000; font-weight:bold",b)):(typeof d=="string"?d=`%c${this.root.label}:%c ${d}`:(r.unshift(d),d=`%c${this.root.label}:%c`),f.unshift("color:#755000; font-weight:bold",b)),l<2?console.debug(d,...f,...r):l<4?console.info(d,...f,...r):l<8?console.warn(d,...f,...r):l<99&&console.error(d,...f,...r)}invoke(l,d,f){if(!this.enabled||l<this.level||l>=99)return;const r=f?[d,...f]:[d];if(l>0){const v=r.join(" ");this.root.init&&this.root.captured_init&&this.root.captured_init.push({time:Date.now(),category:this.name,message:v,level:K[l]||l}),this.crumb({message:v,category:this.name,level:K[l]||l})}const b=l<2?"color:#999999":"";let u="";if(b!=="")for(;r.length>0&&typeof r[0]=="string";)u+=" "+r.shift();this.name?r.unshift(`%c${this.root.label} [%c${this.name}%c]:%c${u}`,"color:#755000; font-weight:bold",b,"color:#755000; font-weight:bold",b):r.unshift(`%c${this.root.label}:%c${u}`,"color:#755000; font-weight:bold",b),l<2?console.debug(...r):l<4?console.info(...r):l<8?console.warn(...r):l<99&&console.error(...r)}},B(p,"_Logger2"),p);O.Levels=M,O.VERBOSE=0,O.DEBUG=1,O.INFO=2,O.WARN=4,O.WARNING=4,O.ERROR=8,O.OFF=99,O.DEFAULT_LEVEL=2;let W=O;const x=W},22527:(me,te,S)=>{var b;"use strict";S.r(te),S.d(te,{CyclicDependencyError:()=>r,LoadState:()=>I,Module:()=>_,ModuleError:()=>f,State:()=>O,buildAddonProxy:()=>d,default:()=>l});var K=S(17159),M=S(46949),I=(A=>(A[A.Unloaded=0]="Unloaded",A[A.Loading=1]="Loading",A[A.Loaded=2]="Loaded",A[A.Unloading=3]="Unloading",A))(I||{}),O=(A=>(A[A.Disabled=0]="Disabled",A[A.Enabling=1]="Enabling",A[A.Enabled=2]="Enabled",A[A.Disabling=3]="Disabling",A))(O||{});const W=/^addon\.([^.]+)(?:\.|$)/i;function x(A){return W.exec(A)?.[1]}B(x,"extractAddonId");const p=(b=class extends K.default{constructor(C,y,a){if(!y&&C instanceof b&&(y=C,C=void 0),super(C,y),this.load_dependents=null,this.dependents=null,this.references=null,this.__modules=y?y.__modules:{},this.children={},y?.__addon_id)this.__addon_id=y.__addon_id,this.__addon_root=y.__addon_root;else if(a){const F=x(this.__path);F&&(this.__addon_id=F,this.__addon_root=this)}y&&!y.children[this.name]&&(y.children[this.name]=this),this.root===this&&(this.__modules[this.__path||""]=this);let w=!!this.onLoad;if(!w){const F=this.__get_load_requires();w=Array.isArray(F)&&F.length>0}this.__load_state=w?0:2,this.__state=w||this.onEnable?0:2,this._time("instance"),this.emit(":registered",this)}get state(){return this.__state}get load_state(){return this.__load_state}get loaded(){return this.__load_state===2}get loading(){return this.__load_state===1}get enabled(){return this.__state===2}get enabling(){return this.__state===1}get addon_id(){return this.__addon_id}get addon_root(){return this.__addon_root}get addon_manifest(){if(this.__addon_id)return this.resolve("addons")?.getAddon(this.__addon_id)??this.__addon_root?.constructor?.info??void 0}get log(){return this.__log||(this.__log=this.parent&&this.parent.log?.get?.(this.name)),this.__log}set log(C){this.__log=C}_time(C){this.root.timing&&(typeof C!="object"&&(C={event:C}),C.module=this.__path||"core",this.root.timing.addEvent(C))}load(){return this.__load(this.__path,[])}unload(){return this.__unload(this.__path,[])}enable(){return this.__enable(this.__path,[])}disable(){return this.__disable(this.__path,[])}canUnload(){return this.__canUnload(this.__path,[])}canDisable(){return this.__canDisable(this.__path,[])}__load(C,y){const a=this.__path||this.name,w=this.__load_state;if(y.includes(this))return Promise.reject(new r(`cyclic load requirements when loading ${C}`,[...y,this]));if(this.load_requires)for(const F of this.load_requires){const D=this.__resolve(F);if(D instanceof b&&y.includes(D))return Promise.reject(new r(`cyclic load requirements when loading ${C}`,[...y,this,D]))}return y.push(this),w===1?this.__load_promise:w===2?Promise.resolve():w===3?Promise.reject(new f(`attempted to load module ${a} while module is being unloaded`)):(this._time("load-start"),this.__load_state=1,this.__load_promise=(async()=>{if(this.load_requires){const F=[];for(const D of this.load_requires){const z=this.__resolve(D);if(!z||!(z instanceof b))throw new f(`cannot find required module ${D} when loading ${a}`);F.push(z.__enable(C,Array.from(y)))}await Promise.all(F)}if(this.onLoad)return this._time("load-self"),this.onLoad()})().then(F=>(this.__load_state=2,this.__load_promise=null,this._time("load-end"),this.emit(":loaded",this),F)).catch(F=>{throw this.__load_state=0,this.__load_promise=null,this._time("load-end"),F}))}__canUnload(C,y){const a=this.__path||this.name,w=this.__load_state;if(y.includes(this))throw new r(`cyclic load requirements when checking if can unload ${C}`,[...y,this]);if(this.load_dependents){y.push(this);for(const F of this.load_dependents){const D=this.__resolve(F);if(D instanceof b){if(y.includes(D))throw new r(`cyclic load requirements when checking if can unload ${C}`,[...y,this,D]);if(!D.__canUnload(C,Array.from(y)))return!1}}}return w===3||w===0?!0:this.onLoad&&!this.onUnload?!1:w!==1}__unload(C,y){const a=this.__path||this.name,w=this.__load_state;if(y.includes(this))return Promise.reject(new r(`cyclic load requirements when unloading ${C}`,[...y,this]));if(this.load_dependents)for(const F of this.load_dependents){const D=this.__resolve(F);if(D instanceof b&&y.includes(D))return Promise.reject(new r(`cyclic load requirements when unloading ${C}`,[...y,this,D]))}return y.push(this),w===3?this.__load_promise:w===0?Promise.resolve():this.onLoad&&!this.onUnload?Promise.reject(new f(`attempted to unload module ${a} but module cannot be unloaded`)):w===1?Promise.reject(new f(`attempted to unload module ${a} while module is being loaded`)):(this._time("unload-start"),this.__load_state=3,this.__load_promise=(async()=>{if(this.__state!==0&&await this.disable(),this.load_dependents){const F=[];for(const D of this.load_dependents){const z=this.__resolve(D);!z||!(z instanceof b)||F.push(z.__unload(C,Array.from(y)))}await Promise.all(F)}if(this._time("unload-self"),this.onUnload)return this.onUnload()})().then(F=>(this.__load_state=0,this.__load_promise=null,this._time("unload-end"),this.emit(":unloaded",this),F)).catch(F=>{throw this.__load_state=2,this.__load_promise=null,this._time("unload-end"),F}))}__enable(C,y){const a=this.__path||this.name,w=this.__state;if(y.includes(this))return Promise.reject(new r(`cyclic requirements when enabling ${C}`,[...y,this]));if(this.requires)for(const F of this.requires){const D=this.__resolve(F);if(D instanceof b&&y.includes(D))return Promise.reject(new r(`cyclic requirements when enabling ${C}`,[...y,this,D]))}return y.push(this),w===1?this.__state_promise:w===2?Promise.resolve():w===3?Promise.reject(new f(`attempted to enable module ${a} while module is being disabled`)):(this._time("enable-start"),this.__state=1,this.__state_promise=(async()=>{const F=[],D=this.requires,z=this.__load_state;if(z===3)throw new f(`attempted to load module ${a} while module is being unloaded`);if((z===1||z===0)&&F.push(this.load()),D)for(const $ of D){const J=this.__resolve($);if(!J||!(J instanceof b))throw new f(`cannot find required module ${$} when enabling ${a}`);F.push(J.__enable(C,Array.from(y)))}if(await Promise.all(F),this.onEnable)return this._time("enable-self"),this.onEnable()})().then(F=>(this.__state=2,this.__state_promise=null,this._time("enable-end"),this.emit(":enabled",this),F)).catch(F=>{throw this.__state=0,this.__state_promise=null,this._time("enable-end"),F}))}__canDisable(C,y){const a=this.__path||this.name,w=this.__state;if(y.includes(this))throw new r(`cyclic load requirements when checking if can disable ${C}`,[...y,this]);if(this.dependents){y.push(this);for(const F of this.dependents){const D=this.__resolve(F);if(D&&D instanceof b){if(y.includes(D))throw new r(`cyclic load requirements when checking if can disable ${C}`,[...y,this,D]);if(!D.__canDisable(C,Array.from(y)))return!1}}}if(w===3||w===0)return!0;if(this.onDisable){if(w===1)return!1}else return!1;return!0}__disable(C,y){const a=this.__path||this.name,w=this.__state;if(y.includes(this))return Promise.reject(new r(`cyclic requirements when disabling ${C}`,[...y,this]));if(this.dependents)for(const F of this.dependents){const D=this.__resolve(F);if(D instanceof b&&y.includes(D))return Promise.reject(new r(`cyclic requirements when disabling ${C}`,[...y,this,D]))}if(y.push(this),w===3)return this.__state_promise;if(w===0)return Promise.resolve();if(this.onDisable){if(w===1)return Promise.reject(new f(`attempted to disable module ${a} but module is being enabled`))}else return Promise.reject(new f(`attempted to disable module ${a} but module cannot be disabled`));return this._time("disable-start"),this.__state=3,this.__state_promise=(async()=>{if(this.__load_state!==2)throw new f(`attempted to disable module ${a} but module is unloaded -- weird state`);if(this.dependents){const F=[];for(const D of this.dependents){const z=this.__resolve(D);!z||!(z instanceof b)||F.push(z.__disable(C,Array.from(y)))}await Promise.all(F)}if(this.onDisable)return this._time("disable-self"),this.onDisable()})().then(F=>(this.__state=0,this.__state_promise=null,this._time("disable-end"),this.emit(":disabled",this),F)).catch(F=>{throw this.__state=2,this.__state_promise=null,this._time("disable-end"),F})}on(C,y,a,w,F=!1){return super.on(C,y,a===void 0?this:a,w,F)}once(C,y,a,w,F=!1){return super.once(C,y,a===void 0?this:a,w,F)}many(C,y,a,w,F,D=!1){return super.many(C,y,a,w===void 0?this:w,F,D)}waitFor(C,y,a,w=!1){return super.waitFor(C,y===void 0?this:y,a,w)}off(C,y,a){return super.off(C,y,a===void 0?this:a)}__resolve(C){return C instanceof b?C:this.__modules[this.abs_path(C)]}resolve(C){let y=this.__resolve(C);return y instanceof b?(this.__processModule&&(y=this.__processModule(y)),y):null}hasModule(C){return this.__modules[this.abs_path(C)]instanceof b}__get_requires(){return(0,M.has)(this,"requires")?this.requires:(0,M.has)(this.constructor,"requires")?this.constructor.requires:null}__get_load_requires(){return(0,M.has)(this,"load_requires")?this.load_requires:(0,M.has)(this.constructor,"load_requires")?this.constructor.load_requires:null}__processModule(C){if(this.__addon_id&&C.getAddonProxy){const y=this.__addon_id;if(C.__proxies||(C.__proxies={}),C.__proxies[y])return C.__proxies[y];const a=this.__resolve("addons")?.getAddon?.(y),w=C.getAddonProxy(y,a,this.__addon_root??this,this);return w!==C&&(C.__proxies[y]=w),w}return C}inject(C,y,a=!0){(C instanceof b||C&&C.prototype instanceof b)&&(a=y??!0,y=C,C=null);const w=this.requires=this.__get_requires()||[];if(y instanceof b)C||(C=y.constructor.name.toSnakeCase());else if(y&&y.prototype instanceof b)C||(C=y.name.toSnakeCase()),y=this.register(C,y);else if(C){const F=C;if(C=C.replace(/^(?:[^.]*\.)+/,""),y=this.__resolve(F),!y||!(y instanceof b))return y?y[2].push([this.__path,C]):this.__modules[this.abs_path(F)]=[[],[],[[this.__path,C]]],w.push(this.abs_path(F)),this[C]=null}else throw new TypeError("must provide a valid module name or class");if(!y)throw new Error(`cannot find module ${C} or no module provided`);return a&&w.push(y.abs_path(".")),this.enabled&&!y.enabled&&y.enable(),y.references.push([this.__path,C]),y instanceof b&&this.__processModule&&(y=this.__processModule(y)),this[C]=y}injectAs(C,y,a,w=!0){(y instanceof b||y&&y.prototype instanceof b)&&(w=a??!0,a=y,y=null);const F=this.requires=this.__get_requires()||[];if(a instanceof b)y||(y=a.constructor.name.toSnakeCase());else if(a&&a.prototype instanceof b)y||(y=a.name.toSnakeCase()),a=this.register(y,a);else if(y){const D=y;if(y=y.replace(/^(?:[^.]*\.)+/,""),a=this.__resolve(D),!a||!(a instanceof b))return a?a[2].push([this.__path,C]):this.__modules[this.abs_path(D)]=[[],[],[[this.__path,C]]],F.push(this.abs_path(D)),this[C]=null}else throw new TypeError("must provide a valid module name or class");if(!a)throw new Error(`cannot find module ${y} or no module provided`);return w&&F.push(a.abs_path(".")),this.enabled&&!a.enabled&&a.enable(),a.references.push([this.__path,C]),this.__processModule&&(a=this.__processModule(a)),this[C]=a}register(C,y,a=!1){C.prototype instanceof b&&(a=y,y=C,C=y.name.toSnakeCase());const w=this.abs_path(`.${C}`),F=y.prototype,D=this.__modules[w];if(!(F instanceof b))throw new TypeError(`Module ${C} is not subclass of Module.`);if(D instanceof b)throw new f(`Name Collision for Module ${w}`);const z=D||[[],[],[]];let $=this.__modules[w]=new y(C,this);const J=$.requires=$.__get_requires()||[],Z=$.load_requires=$.__get_load_requires()||[];$.dependents=z[0],$.load_dependents=z[1],$.references=z[2];for(const G of J){const Q=$.abs_path(G),se=this.__modules[Q];se?Array.isArray(se)?se[0].push(w):se.dependents.push(w):this.__modules[Q]=[[w],[],[]]}for(const G of Z){const Q=$.abs_path(G),se=this.__modules[Q];se?Array.isArray(se)?se[1].push(w):se.load_dependents.push(w):this.__modules[Q]=[[],[w],[]]}for(const[G,Q]of z[2]){const se=this.__resolve(G);se&&!Array.isArray(se)?se[Q]=$:this.log.warn(`Unable to find module "${G}" that wanted "${Q}".`)}return this.__processModule&&($=this.__processModule($)),a&&(this[C]=$),$}async loadFromContext(C,y){y=y??this.log;const a={};for(const w of C.keys()){const F=await C(w),D=F.module||F.default,z=w.lastIndexOf("."),$=z>2?w.slice(2,z):w,J=$.endsWith("/index")?$.slice(0,-6):$;try{a[J]=this.register(J,D)}catch(Z){y&&Z instanceof Error&&(y.capture(Z,{extra:{module:J,path:w}}),y.warn(Z,`Skipping ${w}`))}}return a}},B(b,"_Module2"),b);p.buildAddonProxy=d;let _=p;const l=_;function d(A,C,y,a,w,F){const D={get(z,$,J){let Z=a[$];if(Z!==void 0)return typeof Z=="function"?Z.bind(z):Z;const G=w&&w[$];return A?.log&&G&&A.log.warn(`[DEV-CHECK] Accessed ${y}.${$} directly. ${typeof G=="string"?G:""}`),Z=z[$],typeof Z=="function"?Z.bind(z):A&&Z instanceof _?A.resolve(Z):Reflect.get(z,$,J)}};return F?D:new Proxy(C,D)}B(d,"buildAddonProxy");const u=class u extends Error{};B(u,"ModuleError");let f=u;const v=class v extends f{constructor(C,y){super(`${C} (${y.map(a=>a.path).join(" => ")})`),this.modules=y}};B(v,"CyclicDependencyError");let r=v},46949:(me,te,S)=>{"use strict";S.r(te),S.d(te,{Mutex:()=>C,SourcedSet:()=>Pe,TicketLock:()=>A,TimeoutError:()=>u,TranslatableError:()=>p,addWordSeparators:()=>ae,array_equals:()=>w,b64ToArrayBuffer:()=>Le,debounce:()=>y,deep_copy:()=>Q,deep_equals:()=>F,escape_regex:()=>ie,fetchJSON:()=>ht,generateHex:()=>Me,generateUUID:()=>x,get:()=>Z,getTwitchEmoteSrcSet:()=>O,getTwitchEmoteURL:()=>I,glob_to_regex:()=>ne,has:()=>d,importRsaKey:()=>Ke,isValidShortcut:()=>W,makeAddonIdChecker:()=>ce,make_enum:()=>r,make_enum_flags:()=>b,map_equals:()=>z,matchScreen:()=>l,maybe_call:()=>be,normalizeAddonIdForComparison:()=>se,once:()=>a,pick_random:()=>oe,set_equals:()=>$,sha256:()=>_,shallow_copy:()=>G,shallow_object_equals:()=>D,sleep:()=>f,split_chars:()=>Re,substr_count:()=>J,timeout:()=>v,truncate:()=>we});var K=S(24431);const M=Object.prototype.hasOwnProperty;function I(_e,ue,Ee=!1,$e=!0){return`${K.TWITCH_EMOTE_V2}/${_e}/${Ee?"default":"static"}/${$e?"dark":"light"}/${ue==4?3:ue}.0`}B(I,"getTwitchEmoteURL");function O(_e,ue=!1,Ee=!0,$e=!1){return $e?`${I(_e,2,ue,Ee)} 1x, ${I(_e,4,ue,Ee)} 2x`:`${I(_e,1,ue,Ee)} 1x, ${I(_e,2,ue,Ee)} 2x, ${I(_e,4,ue,Ee)} 4x`}B(O,"getTwitchEmoteSrcSet");function W(_e){return _e?(_e=_e.toLowerCase().trim(),!K.BAD_HOTKEYS.includes(_e)):!1}B(W,"isValidShortcut");const x=crypto.randomUUID?()=>crypto.randomUUID():B(function _e(ue){return ue?(ue^Math.random()*16>>ue/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,_e)},"generateUUID2"),wt=class wt extends Error{constructor(ue,Ee,$e){super(ue),this.i18n_key=Ee,this.data=$e}toString(){const ue=window.FrankerFaceZ?.get(),Ee=ue?.resolve("i18n");return Ee&&this.i18n_key?Ee.t(this.i18n_key,this.message,this.data):this.message}};B(wt,"TranslatableError");let p=wt;async function _(_e){const ue=new TextEncoder().encode(_e),Ee=await crypto.subtle.digest("SHA-256",ue);return Array.from(new Uint8Array(Ee)).map(Ze=>Ze.toString(16).padStart(2,"0")).join("")}B(_,"sha256");function l(_e,ue){let Ee,$e=0;for(let He=0;He<_e.length;He++){const Ze=_e[He];if(Ze.label!==ue.label)continue;let qe=1;ue.left&&ue.left===Ze.left&&(qe+=15),ue.top&&ue.top===Ze.top&&(qe+=15),ue.width&&ue.width===Ze.width&&(qe+=10),ue.height&&ue.height===Ze.height&&(qe+=10),ue.index&&(qe-=Math.abs(ue.index-He)),qe>$e&&(Ee=Ze,$e=qe)}return Ee}B(l,"matchScreen");function d(_e,ue){return _e?M.call(_e,ue):!1}B(d,"has");function f(_e){return new Promise(ue=>setTimeout(ue,_e))}B(f,"sleep");function r(..._e){const ue={};for(let Ee=0,$e=_e.length;Ee<$e;Ee++){const He=_e[Ee];ue[He]=Ee,ue[Ee]=He}return ue}B(r,"make_enum");function b(..._e){const ue={};ue.None=0,ue[0]="None";for(let Ee=0,$e=_e.length;Ee<$e;Ee++){const He=_e[Ee],Ze=Math.pow(2,Ee);ue[He]=Ze,ue[Ze]=He}return ue}B(b,"make_enum_flags");const zt=class zt extends Error{constructor(ue){super(ue??"timeout")}};B(zt,"TimeoutError");let u=zt;function v(_e,ue){return new Promise((Ee,$e)=>{let He=!1;const Ze=setTimeout(()=>{He||(He=!0,$e(new u))},ue);_e.then(qe=>{He||(He=!0,clearTimeout(Ze),Ee(qe))}).catch(qe=>{He||(He=!0,clearTimeout(Ze),$e(qe))})})}B(v,"timeout");const Ht=class Ht{constructor(ue=1){this.limit=ue,this.__active=0,this.__waiting=[]}get available(){return this.__active<this.limit}__done(){for(this.__active--;this.__active<this.limit&&this.__waiting.length>0;){this.__active++;const ue=this.__waiting.shift();ue&&ue(this.__getTicket())}}__getTicket(){let ue=!0;return()=>{ue&&(ue=!1,this.__done())}}wait(){return this.__active<this.limit?(this.__active++,Promise.resolve(this.__getTicket())):new Promise(ue=>this.__waiting.push(ue))}};B(Ht,"TicketLock");let A=Ht;const C=A;function y(_e,ue,Ee=!1){let $e;if(Ee){const He=B(()=>$e=null,"later");return Ee===2?B(function(...qe){$e?(clearTimeout($e),$e=setTimeout(()=>{$e=null,_e.apply(this,qe)},ue)):(_e.apply(this,qe),$e=setTimeout(He,ue))},"debouncedFunction"):function(...Ze){$e?clearTimeout($e):_e.apply(this,Ze),$e=setTimeout(He,ue)}}return function(...He){$e&&clearTimeout($e),$e=setTimeout(_e.bind(this,...He),ue)}}B(y,"debounce");function a(_e){let ue;return B(function(...$e){if(ue)return ue;try{ue=Promise.resolve(_e.call(this,...$e))}catch(He){return Promise.reject(He)}return ue.finally(()=>ue=void 0)},"onceFunction")}B(a,"once");function w(_e,ue){if(!Array.isArray(_e)||!Array.isArray(ue)||_e.length!==ue.length)return!1;let Ee=_e.length;for(;Ee--;)if(_e[Ee]!==ue[Ee])return!1;return!0}B(w,"array_equals");function F(_e,ue,Ee=!1,$e,He){if(_e===ue)return!0;if(typeof _e!=typeof ue||typeof _e!="object"||_e===null!=(ue===null))return!1;if($e||($e=new Set),He||(He=new Set),$e.has(_e)||He.has(ue))throw new Error("recursive structure detected");$e.add(_e),He.add(ue);const Ze=Object.keys(_e),qe=Object.keys(ue);if(!Ee&&!$(new Set(Ze),new Set(qe)))return!1;for(const it of Ze)if(!F(_e[it],ue[it],Ee,new Set($e),new Set(He)))return!1;if(Ee){for(const it of qe)if(!Ze.includes(it)&&!F(_e[it],ue[it],Ee,new Set($e),new Set(He)))return!1}return!0}B(F,"deep_equals");function D(_e,ue){if(typeof _e!="object"||typeof ue!="object")return!1;const Ee=Object.keys(_e);if(!$(new Set(Ee),new Set(Object.keys(ue))))return!1;for(const $e of Ee)if(_e[$e]!==ue[$e])return!1;return!0}B(D,"shallow_object_equals");function z(_e,ue){if(!(_e instanceof Map)||!(ue instanceof Map)||_e.size!==ue.size)return!1;for(const[Ee,$e]of _e)if(!ue.has(Ee)||ue.get(Ee)!==$e)return!1;return!0}B(z,"map_equals");function $(_e,ue){if(!(_e instanceof Set)||!(ue instanceof Set)||_e.size!==ue.size)return!1;for(const Ee of _e)if(!ue.has(Ee))return!1;return!0}B($,"set_equals");function J(_e,ue){let Ee=0,$e=0;for(;$e<_e.length;){const He=_e.indexOf(ue,$e);if(He===-1)break;Ee++,$e=He+1}return Ee}B(J,"substr_count");function Z(_e,ue){let Ee=_e;if(typeof Ee=="string"){if(M.call(ue,Ee))return ue[Ee];Ee=Ee.split(".")}for(let $e=0,He=Ee.length;$e<He;$e++){const Ze=Ee[$e];if(Ze==="@each"){const qe=Ee.slice($e+1);if(qe.length)if(Array.isArray(ue))ue=ue.map(it=>Z(qe,it));else{const it={};for(const xt in ue)M.call(ue,xt)&&(it[xt]=Z(qe,ue[xt]));ue=it}break}else Ze==="@last"?ue=ue[ue.length-1]:ue=ue[Ze];if(!ue)break}return ue}B(Z,"get");function G(_e,ue=2,Ee){if(_e==null)return _e;if(_e instanceof Promise||typeof _e=="function")return null;if(typeof _e!="object")return _e;if(ue===0)return null;if(Ee||(Ee=new Set),Ee.add(_e),Array.isArray(_e)){const He=[];for(const Ze of _e)Ee.has(Ze)||He.push(G(Ze,ue-1,new Set(Ee)));return He}const $e={};for(const[He,Ze]of Object.entries(_e))Ee.has(Ze)||($e[He]=G(Ze,ue-1,new Set(Ee)));return $e}B(G,"shallow_copy");function Q(_e,ue){if(_e===null)return null;if(_e===void 0)return;if(_e instanceof Promise)return new Promise(($e,He)=>_e.then($e).catch(He));if(typeof _e=="function")return function(...$e){return _e.apply(this,$e)};if(_e instanceof RegExp)return new RegExp(_e.source,_e.flags);if(_e instanceof Date)return new Date(_e);if(typeof _e!="object")return _e;if(ue||(ue=new Set),ue.has(_e))throw new Error("recursive structure detected");if(ue.add(_e),Array.isArray(_e))return _e.map($e=>Q($e,new Set(ue)));if(_e instanceof Set){const $e=new Set;for(const He of _e)typeof He=="object"?$e.add(Q(He)):$e.add(He);return $e}if(_e instanceof Map){const $e=new Map;for(const[He,Ze]of _e.entries()){let qe=typeof He=="object"?Q(He):He,it=typeof Ze=="object"?Q(Ze):Ze;$e.set(qe,it)}return $e}const Ee={};for(const[$e,He]of Object.entries(_e))typeof He=="object"?Ee[$e]=Q(He,new Set(ue)):Ee[$e]=He;return Ee}B(Q,"deep_copy");function se(_e){return _e.toLowerCase().replace(/[\.\_\-]+/,"-")}B(se,"normalizeAddonIdForComparison");function ce(_e){return _e=ie(se(_e)),_e=_e.replace(/-+/g,"[._-]+"),_e=_e.replace(/\bbttv\b/g,"(?:bttv|betterttv)"),_e=_e.replace(/\b7tv\b/g,"(?:7tv|seventv)"),_e=_e.replace(/\bpronouns\b/g,"(?:pronouns|addon-pn)"),new RegExp("\\b"+_e+"\\b","i")}B(ce,"makeAddonIdChecker");function be(_e,ue,...Ee){return typeof _e=="function"?ue?_e.call(ue,...Ee):_e(...Ee):_e}B(be,"maybe_call");const ve=/[^\uD800-\uDFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDFFF]/g;function Re(_e){return _e===""?[]:_e.match(ve)}B(Re,"split_chars");function oe(_e){if(!_e)return null;if(!Array.isArray(_e)){const ue=Object.keys(_e);return _e[oe(ue)]}return _e[Math.floor(Math.random()*_e.length)]}B(oe,"pick_random");const ie=RegExp.escape||B(function(ue){return ue.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},"escape_regex2");function ae(_e){return`(^|.*?${K.WORD_SEPARATORS})(?:${_e})(?=$|${K.WORD_SEPARATORS})`}B(ae,"addWordSeparators");const xe="/$^+.()=!|";function ne(_e){if(typeof _e!="string")throw new TypeError("input must be a string");let ue="",Ee=0;for(let $e=0,He=_e.length;$e<He;$e++){const Ze=_e[$e];if(xe.includes(Ze))ue+=`\\${Ze}`;else if(Ze==="\\"){$e++;const qe=_e[$e];qe&&(xe.includes(qe)?ue+=`\\${qe}`:ue+=qe)}else if(Ze==="?")ue+=".";else if(Ze==="[")ue+=Ze,_e[$e+1]==="!"&&($e++,ue+="^");else if(Ze==="]")ue+=Ze;else if(Ze==="{")ue+="(?:",Ee++;else if(Ze==="}")Ee>0&&(ue+=")",Ee--);else if(Ze===","&&Ee>0)ue+="|";else if(Ze==="*"){let qe=1;for(;_e[$e+1]==="*";)qe++,$e++;qe>1?ue+=".*?":ue+="[^\\s]*?"}else ue+=Ze}return ue}B(ne,"glob_to_regex");function we(_e,ue=100,Ee=15,$e="\u2026",He=!0,Ze=!0){if(!_e||!_e.length)return _e;Ze&&(_e=_e.trim());let qe=He?_e.indexOf(`
`):-1;if((qe===-1||qe>ue)&&(qe=ue),_e.length<=qe)return _e;let it=_e.slice(0,qe).trimEnd();if(Ee>0&&it.length>=qe){let xt=_e.slice(qe).search(/\s+/);if(xt===-1&&Ee+qe>_e.length&&(xt=_e.length-qe),xt!==-1&&xt<=Ee){if(_e.length<=qe+xt)return _e;it=_e.slice(0,qe+xt)}}return it+$e}B(we,"truncate");function ze(_e){return _e.toString(16).padStart(2,"0")}B(ze,"decimalToHex");function Me(_e=40){const ue=new Uint8Array(_e/2);return window.crypto.getRandomValues(ue),Array.from(ue,ze).join("")}B(Me,"generateHex");const Wt=class Wt{constructor(ue=!1,Ee){this._use_set=ue,this._cache=ue?new Set:[],this._sourceSortFn=Ee}resortSources(){this._sorted_sources=null,this._sources&&this._sources.size>1&&this._rebuild()}setSortFunction(ue){this._sourceSortFn!==ue&&(this._sourceSortFn=ue,this.resortSources())}_sortSources(){if(!this._sources||this._sources.size===0){this._sorted_sources=[];return}if(this._sources.size===1||!this._sourceSortFn){this._sorted_sources=[...this._sources.values()];return}const ue=[...this._sources?.entries()];ue.sort((Ee,$e)=>this._sourceSortFn(Ee[0],$e[0])),this._sorted_sources=ue.map(Ee=>Ee[1])}_rebuild(){if(!this._sources)return;const ue=this._use_set,Ee=this._cache=ue?new Set:[];this._sorted_sources||this._sortSources();for(const $e of this._sorted_sources)for(const He of $e)ue?Ee.add(He):Ee.includes(He)||Ee.push(He)}get(ue){return this._sources&&this._sources.get(ue)}has(ue){return this._sources?this._sources.has(ue):!1}*iterateSources(){if(this._sources)for(const ue of this._sources)yield ue}sourceIncludes(ue,Ee){const $e=this._sources&&this._sources.get(ue);return $e&&$e.includes(Ee)}includes(ue){return this._use_set?this._cache.has(ue):this._cache.includes(ue)}delete(ue){this._sources&&this._sources.has(ue)&&(this._sources.delete(ue),this._sorted_sources=null,this._rebuild())}extend(ue,...Ee){this._sources||(this._sources=new Map);const $e=this._sources.get(ue);if($e)for(const Ze of Ee)$e.includes(Ze)||$e.push(Ze);else this._sources.set(ue,Ee),this._sorted_sources=null;if(this._sourceSortFn!=null&&this._sources.size>1)this._rebuild();else{const Ze=this._use_set,qe=this._cache;for(const it of Ee)Ze?qe.add(it):qe.includes(it)||qe.push(it)}}set(ue,Ee){if(Array.isArray(Ee)||(Ee=[Ee]),!Ee.length)return this.delete(ue);this._sources||(this._sources=new Map);const $e=this._sources.has(ue);this._sources.set(ue,Ee),this._sorted_sources=null;const He=this._sourceSortFn!=null&&this._sources.size>1;if($e||He)this._rebuild();else{const Ze=this._use_set,qe=this._cache;for(const it of Ee)Ze?qe.add(it):qe.includes(it)||qe.push(it)}}push(ue,Ee){if(!this._sources)return this.set(ue,Ee);const $e=this._sources.get(ue);if($e?.length){if($e.includes(Ee))return}else return this.set(ue,Ee);$e.push(Ee),this._sourceSortFn!=null&&this._sources.size>1?this._rebuild():this._use_set?this._cache.add(Ee):this._cache.includes(Ee)||this._cache.push(Ee)}remove(ue,Ee){if(!this._sources||!this._sources.has(ue))return;const $e=this._sources.get(ue),He=$e?$e.indexOf(Ee):-1;He!==-1&&($e.splice(He,1),this._rebuild())}};B(Wt,"SourcedSet");let Pe=Wt;function Le(_e){const ue=atob(_e),Ee=ue.length,$e=new ArrayBuffer(Ee),He=new Uint8Array($e);for(let Ze=0,qe=ue.length;Ze<qe;Ze++)He[Ze]=ue.charCodeAt(Ze);return $e}B(Le,"b64ToArrayBuffer");const Ge=/-----BEGIN (.+?) KEY-----/,Ye=/-----END (.+?) KEY-----/;function Ke(_e,ue=["verify"]){const Ee=Ge.exec(_e),$e=Ye.exec(_e);if(!Ee||!$e||Ee[1]!==$e[1])throw new Error("invalid key");const He=/\bPRIVATE\b/i.test(Ee[1]),Ze=Ee.index+Ee[0].length,qe=$e.index,it=_e.slice(Ze,qe).replace(/\n/g,"").trim(),xt=Le(it);return crypto.subtle.importKey(He?"pkcs8":"spki",xt,{name:"RSA-PSS",hash:"SHA-256"},!0,ue)}B(Ke,"importRsaKey");function ht(_e,ue,Ee=null){return fetch(_e,ue).then($e=>$e.ok?$e.json():null).catch(()=>Ee)}B(ht,"fetchJSON")},20857:(me,te,S)=>{"use strict";S.d(te,{Q:()=>K});function K(O){return M({path:O,i:0})}B(K,"parse");function M(O){const W=O.path,x=W.length,p=[];let _=null,l=null,d=!1,f=!1;for(;O.i<x;){const r=O.i,b=W[r],u=W[r+1];if(_||(_={}),l||(l=""),b==="@"&&u==="{"){O.i++;const y=I(O);y&&Object.assign(_,y);continue}const v=b==="~"&&u===">",A=b===">"&&u===">";if(!(!A&&b===">")&&!A&&!v){l+=b,O.i++;continue}(v||A)&&O.i++,_.title=l.trim(),_.key=_.title.toSnakeCase(),_.page=f,_.tab=d,f=A,d=v,p.push(_),_=l=null,O.i++}return _&&l&&(_.title=l.trim(),_.key=_.title.toSnakeCase(),_.page=f,_.tab=d,p.push(_)),p}B(M,"parseAST");function I(O){const W=O.path,x=W.length,p=O.i;O.i++;const _=["{"];let l=!1;for(;O.i<x&&_.length;){const d=O.i,f=W[d];if(l){if(f==="\\"){O.i++;continue}(f==='"'||f==="'")&&f===l&&(_.pop(),l=!1)}else{if((f==='"'||f==="'")&&(l=f,_.push(f)),(f==="{"||f==="[")&&_.push(f),f==="]"&&_.pop()!=="[")throw new SyntaxError("Invalid JSON");if(f==="}"&&_.pop()!=="{")throw new SyntaxError("Invalid JSON")}O.i++}return JSON.parse(W.slice(p,O.i))}B(I,"parseJSON")},83269:(me,te,S)=>{"use strict";S.r(te),S.d(te,{durationForChat:()=>O,durationForURL:()=>W,duration_to_string:()=>M,getBuster:()=>K,print_duration:()=>I});function K(x=5){const p=Math.floor(Date.now()/1e3);return p-p%x}B(K,"getBuster");function M(x,p,_,l,d){const f=x%60;let r=Math.floor(x/60),b=Math.floor(r/60),u="";if(r=r%60,p){const A=Math.floor(b/24);if(b=b%24,_&&A>0)return`${u} days`;u=A>0?`${A} days, `:""}const v=l===!1||u?.length>0||b>0;return`${u}${v?`${u&&b<10?"0":""}${b}:`:""}${v&&r<10?"0":""}${r}${d?"":`:${f<10?"0":""}${f}`}`}B(M,"duration_to_string");function I(x){let p=Math.floor(x/60);const _=Math.floor(p/60);return p%=60,x%=60,`${_>0?`${_}:${p<10?"0":""}`:""}${p}:${x<10?"0":""}${x}`}B(I,"print_duration");function O(x){const p=x%60;let _=Math.floor(x/60),l=Math.floor(_/60);const d=Math.floor(l/24);return _=_%60,l=l%24,`${d>0?`${d}d`:""}${l>0?`${l}h`:""}${_>0?`${_}m`:""}${p>0?`${p}s`:""}`}B(O,"durationForChat");function W(x){const p=x%60;let _=Math.floor(x/60);const l=Math.floor(_/60);return _=_%60,`${l>0?`${l}h`:""}${_>0?`${_}m`:""}${p>0?`${p}s`:""}`}B(W,"durationForURL")},8528:(me,te,S)=>{"use strict";S.r(te),S.d(te,{DefaultOptions:()=>x,NoContent:()=>W,Tooltip:()=>p,default:()=>_,makeReference:()=>d,normalizeModifiers:()=>l});var K=S(44589),M=S(46949),I=S(78224);let O=0;const W=Symbol("NoContent"),x={html:!1,delayShow:0,delayHide:0,live:!0,tooltipClass:"ffz__tooltip",innerClass:"ffz__tooltip--inner",arrowClass:"ffz__tooltip--arrow"},r=class r{constructor(u,v,A){if(this.shift_state=!1,this.ctrl_state=!1,typeof u=="string"&&(u=document.querySelector(u)),!(u instanceof HTMLElement))throw new TypeError("invalid parent");if(this.options=Object.assign({},x,A),this.live=this.options.live,this.parent=u,this.container=this.options.container||this.parent,this.cls=v,this.options.check_modifiers&&this.installModifiers(),this.live)this.cls=v,this.elements=new Set;else{let C;if(typeof v=="string")C=Array.from(u.querySelectorAll(v));else if(Array.isArray(v))C=v;else if(v instanceof HTMLElement)C=[v];else throw new TypeError("invalid elements");this.elements=new Set(C)}if(this._accessor=`_ffz_tooltip$${O++}`,this._onMouseOut=C=>{const y=C.target;if(y&&y.dataset?.forceOpen!=="true")return this._exit(y)},!this.options.manual)if(this.live)this._onMouseOver=C=>{this.updateShift(C.shiftKey,C.ctrlKey);const y=C.target;y&&y.classList&&y.classList.contains(this.cls)&&y.dataset?.forceOpen!=="true"&&this._enter(y)},u.addEventListener("mouseover",this._onMouseOver),u.addEventListener("mouseout",this._onMouseOut);else if(this._onMouseOver=C=>{this.updateShift(C.shiftKey,C.ctrlKey);const y=C.target;this.elements.has(y)&&y.dataset.forceOpen!=="true"&&this._enter(y)},this.elements.size<=5)for(const C of this.elements)C.addEventListener("mouseenter",this._onMouseOver),C.addEventListener("mouseleave",this._onMouseOut);else u.addEventListener("mouseover",this._onMouseOver),u.addEventListener("mouseout",this._onMouseOut)}destroy(){if(this.removeModifiers(),!this.options.manual)if(this.live||this.elements.size>5)this._onMouseOver&&this.parent.removeEventListener("mouseover",this._onMouseOver),this.parent.removeEventListener("mouseout",this._onMouseOut);else for(const u of this.elements)this._onMouseOver&&u.removeEventListener("mouseenter",this._onMouseOver),u.removeEventListener("mouseleave",this._onMouseOut);for(const u of this.elements){const v=u[this._accessor];v&&v.visible&&this.hide(v),u[this._accessor]=null,u._ffz_tooltip=null}this.elements=null,this._onMouseOut=this._onMouseOver=null,this.container=null,this.parent=null}installModifiers(){this._keyUpdate||(this._keyUpdate=u=>this.updateShift(u.shiftKey,u.ctrlKey),window.addEventListener("keydown",this._keyUpdate),window.addEventListener("keyup",this._keyUpdate))}removeModifiers(){this._keyUpdate&&(window.removeEventListener("keydown",this._keyUpdate),window.removeEventListener("keyup",this._keyUpdate),this._keyUpdate=null)}updateShift(u,v){u===this.shift_state&&v===this.ctrl_state||(this.shift_state=u,this.ctrl_state=v,this._shift_af||(this._shift_af=requestAnimationFrame(()=>{if(this._shift_af=null,this.elements)for(const A of this.elements){const C=A[this._accessor];C&&C.outer&&(C.outer.dataset.shift=`${this.shift_state}`,C.outer.dataset.ctrl=`${this.ctrl_state}`,C.update())}})))}cleanup(){if(!(this.options.manual||!this.elements))for(const u of this.elements){const v=u[this._accessor];document.body.contains(u)||v&&v.visible&&this.hide(v)}}_enter(u){let v=u[this._accessor];if(v||(v=u[this._accessor]={target:u}),v.state=!0,v._show_timer&&(clearTimeout(v._show_timer),v._show_timer=null),v.visible)return;const A=(0,M.maybe_call)(this.options.delayShow,null,u,v);A===0?this.show(v):v._show_timer=setTimeout(()=>{v._show_timer=null,v.state&&this.show(v)},A)}_exit(u){const v=u[this._accessor];if(!v||(v.state=!1,v._show_timer&&(clearTimeout(v._show_timer),v._show_timer=null),!v.visible))return;const A=(0,M.maybe_call)(this.options.delayHide,null,u,v);A===0?this.hide(v):v._show_timer=setTimeout(()=>{v._show_timer=null,v.state||this.hide(v)},A)}show(u){const v=this.options,A=u.target;this.elements.add(A),A._ffz_tooltip=u,u._wait_promise=null,u.waitForDom=()=>u.element?Promise.resolve():(u._wait_promise||(u._wait_promise=new Promise(Q=>u._waiter=Q)),u._wait_promise),u.update=()=>u._update(),u.show=()=>{let Q=A[this._accessor];Q||(Q=A[this._accessor]={target:A}),this.show(Q)},u.hide=()=>this.hide(u),u.rerender=()=>{u.visible&&(u.hide(),u.show())};let C=(0,M.maybe_call)(v.content,null,A,u);if(C===void 0&&(C=u.target.title),u.visible||C===W||!C&&!v.onShow)return;const y=(0,K.createElement)("div",{className:v.arrowClass,"x-arrow":!0}),a=u.element=(0,K.createElement)("div",v.innerClass),w=u.outer=(0,K.createElement)("div",{className:v.tooltipClass,"data-shift":this.shift_state,"data-ctrl":this.ctrl_state},[a,y]);if(v.arrowInner&&y.appendChild((0,K.createElement)("div",v.arrowInner)),u.align&&a.classList.add(`${v.innerClass}--align-${u.align}`),u.add_class){for(const Q of Array.isArray(u.add_class)?u.add_class:[u.add_class])a.classList.add(Q);u.add_class=void 0}const F=(0,M.maybe_call)(v.interactive,null,A,u),D=(0,M.maybe_call)(v.hover_events,null,A,u);w.classList.toggle("interactive",F||!1),(!v.manual||D&&(v.onHover||v.onLeave||v.onMove))&&(D&&v.onMove&&w.addEventListener("mousemove",w._ffz_move_handler=Q=>{this.updateShift(Q.shiftKey,Q.ctrlKey),v.onMove(A,u,Q)}),w.addEventListener("mouseover",w._ffz_over_handler=Q=>{!v.no_auto_remove&&!document.contains(A)&&this.hide(u),D&&v.onHover&&v.onHover(A,u,Q),v.manual||((0,M.maybe_call)(v.interactive,null,A,u)?this._enter(A):A.dataset.forceOpen!=="true"&&this._exit(A))}),w.addEventListener("mouseout",w._ffz_out_handler=Q=>{D&&v.onLeave&&v.onLeave(A,u,Q),!v.manual&&A.dataset.forceOpen!=="true"&&this._exit(A)}));const z=(0,M.maybe_call)(v.html,null,A,u),$=z?"innerHTML":"textContent",J={flip:{behavior:["top","bottom","left","right"]},offset:{offset:[0,10]},arrow:{element:y}};let Z=Object.assign({modifiers:J},v.popper);Z.modifiers=Object.assign(J,Z.modifiers),v.popperConfig&&(Z=v.popperConfig(A,u,Z)??Z),Z.onUpdate=(0,M.debounce)(()=>{!v.no_auto_remove&&!document.contains(u.target)&&this.hide(u)},250);let G=A;v.no_update&&(G=d(A)),u._update=()=>{u.popper&&u.popper.forceUpdate()},u._waiter&&u._waiter(),u._waiter=null,u._wait_promise=null,C instanceof Promise?(a.innerHTML='<div class="ffz-i-zreknarf loader"></div>',C.then(Q=>{if(!Q)return this.hide(u);z&&(Q instanceof Node||Array.isArray(Q))?(a.innerHTML="",(0,K.setChildren)(a,Q,v.sanitizeChildren)):a[$]=Q,u._update()}).catch(Q=>{this.options.logger&&this.options.logger.error("Error rendering tooltip content.",Q),this.options.i18n?a.textContent=this.options.i18n.t("tooltip.render-error",`There was an error rendering this tooltip.
{err}`,{err:Q}):a.textContent=`There was an error rendering this tooltip.
${Q}`,u._update()})):C&&(z&&(C instanceof Node||Array.isArray(C))?(0,K.setChildren)(a,C,v.sanitizeChildren):a[$]=C),Z.modifiers=l(Z.modifiers),u.popper=(0,I.fi)(G,w,Z),this.container.appendChild(w),u.visible=!0,v.onShow&&v.onShow(A,u)}hide(u){const v=this.options;if(v.onHide&&v.onHide(u.target,u),u.popper&&(u.popper.destroy(),u.popper=null),u.outer){const A=u.outer;A._ffz_over_handler&&A.removeEventListener("mouseover",A._ffz_over_handler),A._ffz_out_handler&&A.removeEventListener("mouseout",A._ffz_out_handler),A._ffz_move_handler&&A.removeEventListener("mousemove",A._ffz_move_handler),A.remove(),u.outer=A._ffz_out_handler=A._ffz_over_handler=null}this.live&&this.elements&&this.elements.delete(u.target),u.target._ffz_tooltip===u&&(u.target._ffz_tooltip=null),u.target[this._accessor]=null,u._update=u.rerender=u.update=f,u.element=null,u.visible=!1}};B(r,"Tooltip");let p=r;const _=p;function l(b){const u=[];for(const[v,A]of Object.entries(b)){const C={name:v};if(A&&typeof A=="object"&&!Array.isArray(A)){(0,M.has)(A,"enabled")&&(C.enabled=A.enabled);const y=Object.keys(A);(y.length>1||y.length===1&&y[0]!=="enabled")&&(C.options=A)}u.push(C)}return u}B(l,"normalizeModifiers");function d(b,u,v=0,A=0){let C;if(b instanceof HTMLElement){const a=b.getBoundingClientRect();C=a.x,u=a.y,v=a.height,A=a.width}else C=b;return{getBoundingClientRect:()=>({top:u,bottom:u+v,y:u,left:C,right:C+A,x:b,height:v,width:A}),clientWidth:A,clientHeight:v}}B(d,"makeReference");function f(){}B(f,"noop")},2356:(me,te,S)=>{"use strict";S.r(te),S.d(te,{DEFAULT_FORMATS:()=>f,DEFAULT_TYPES:()=>d,TranslationCore:()=>r,default:()=>b,getCardinalName:()=>C,getOrdinalName:()=>w});var K=S(51722),M=S.n(K),I=S(92045),O=S.n(I),W=S(46949),x=S(83269),p=S(22923),_=S.n(p);M().extend(O());const l={allowTags:!1,requireOther:!1},d={tostring(D){return`${D}`},select(D,z,$,J,Z,G){const Q=z.o&&(z.o[D]||z.o.other);if(Q)return this._processAST(Q,G,$)},plural(D,z,$,J,Z,G){const Q=z.o&&(z.o[`=${D}`]||z.o[C($,D)]||z.o.other);if(Q)return this._processAST(Q,G,$)},selectordinal(D,z,$,J,Z,G){const Q=z.o&&(z.o[`=${D}`]||z.o[w($,D)]||z.o.other);if(Q)return this._processAST(Q,G,$)},number(D,z){if(typeof D!="number"){let $=parseFloat(D);if((isNaN($)||!isFinite($))&&($=parseInt(D,10)),isNaN($)||!isFinite($))return D;D=$}return this.formatNumber(D,z.f)},currency(D,z){if(typeof D!="number"){let $=parseFloat(D);if((isNaN($)||!isFinite($))&&($=parseInt(D,10)),isNaN($)||!isFinite($))return D;D=$}return this.formatCurrency(D,z.f)},date(D,z){return this.formatDate(D,z.f)},time(D,z){return this.formatTime(D,z.f)},datetime(D,z){return this.formatDateTime(D,z.f)},duration(D){return this.formatDuration(D)},localestring(D){return this.toLocaleString(D)},relativetime(D,z){return this.formatRelativeTime(D,z.f)},humantime(D,z){return this.formatRelativeTime(D,z.f)},en_plural:D=>D!==1?"s":""},f={number:{currency:{style:"currency"},percent:{style:"percent"},long_percent:{style:"percent",minimumFractionDigits:2}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},default:{},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}},datetime:{short:{month:"numeric",day:"numeric",year:"2-digit",hour:"numeric",minute:"numeric"},medium:{},long:{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},F=class F{constructor(z){if(z=z||{},this.warn=z.warn,this._locale=z.locale||"en",this._dayjs_locale=z.dayjsLocale||"en",this.defaultLocale=z.defaultLocale||this._locale,this.transformation=null,this.defaultDateFormat=z.defaultDateFormat??"default",this.defaultTimeFormat=z.defaultTimeFormat??"short",this.defaultDateTimeFormat=z.defaultDateTimeFormat??"medium",this.phrases=new Map,this.cache=new Map,this.numberFormats=new Map,this.currencyFormats=new Map,this.formats=Object.assign({},f),z.formats){const $=Object.keys(z.formats);for(const J of $)this.formats[J]=Object.assign({},this.formats[J],z.formats[J])}this.types=Object.assign({},d,z.types||{}),this.parser=new(_())(Object.assign({},l,z.parserOptions)),z.phrases&&this.extend(z.phrases)}get locale(){return this._locale}set locale(z){z!==this._locale&&(this._locale=z,this.numberFormats.clear(),this.currencyFormats.clear())}toLocaleString(z){return z?.toLocaleString?z.toLocaleString(this._locale):typeof z!="string"?`${z}`:z}formatRelativeTime(z,$){const J=M()(z),Z=$==="plain";try{return J.locale(this._dayjs_locale).fromNow(Z)}catch{return J.fromNow(Z)}}formatCurrency(z,$){let J=this.currencyFormats.get($);return J||(J=new Intl.NumberFormat(navigator.languages,{style:"currency",currency:$}),this.currencyFormats.set($,J)),J.format(z)}formatNumber(z,$){let J=this.numberFormats.get($);return J||(this.formats.number[$]?J=new Intl.NumberFormat(this.locale,this.formats.number[$]):typeof $=="number"?J=new Intl.NumberFormat(this.locale,{minimumFractionDigits:$,maximumFractionDigits:$}):J=new Intl.NumberFormat(this.locale),this.numberFormats.set($,J)),J.format(z)}formatDuration(z){return(0,x.duration_to_string)(z)}formatDate(z,$){if($||($=this.defaultDateFormat),$&&!this.formats.date[$]){const J=M()(z);try{return J.locale(this._dayjs_locale).format($)}catch{return J.format($)}}return z instanceof Date||(z=new Date(z)),z.toLocaleDateString(this._locale,this.formats.date[$]||{})}formatTime(z,$){if($||($=this.defaultTimeFormat),$&&!this.formats.time[$]){const J=M()(z);try{return J.locale(this._dayjs_locale).format($)}catch{return J.format($)}}return z instanceof Date||(z=new Date(z)),z.toLocaleTimeString(this._locale,this.formats.time[$]||{})}formatDateTime(z,$){if($||($=this.defaultDateTimeFormat),$&&!this.formats.datetime[$]){const J=M()(z);try{return J.locale(this._dayjs_locale).format($)}catch{return J.format($)}}return z instanceof Date||(z=new Date(z)),z.toLocaleString(this._locale,this.formats.datetime[$]||{})}extend(z,$){const J=[];if(!z||typeof z!="object")return J;for(const Z of Object.keys(z)){const G=$?Z==="_"?$:`${$}.${Z}`:Z,Q=z[Z];if(typeof Q=="object")J.push(...this.extend(Q,G));else{let se;try{se=this.parser.parse(Q)}catch(ce){this.warn&&this.warn(`Error parsing i18n phrase for key "${G}": ${Q}`,ce);continue}this.phrases.set(G,Q),this.cache.set(G,se),J.push(G)}}return J}unset(z,$){typeof z=="string"&&(z=[z]);const J=Array.isArray(z)?z:Object.keys(z);for(const Z of J){const G=$?Z==="_"?$:`${$}.${Z}`:Z;typeof z[Z]=="object"?this.unset(z,G):(this.phrases.delete(G),this.cache.delete(G))}}has(z){return this.phrases.has(z)}set(z,$){const J=this.parser.parse($);this.phrases.set(z,$),this.cache.set(z,J)}clear(){this.phrases.clear(),this.cache.clear()}replace(z){this.clear(),this.extend(z)}_preTransform(z,$,J,Z={}){let G,Q,se=J??{};if(typeof se=="number"&&(se={count:se}),!Z.noCache&&this.phrases.has(z))G=this.cache.get(z)??[],Q=this.locale;else if(!Z.noCache&&this.cache.has(z))G=this.cache.get(z)??[],Q=this.defaultLocale;else{let ce=null;try{ce=this.parser.parse($)}catch(be){if(Z.throwParse)throw be;!Z.noWarn&&this.warn&&this.warn(`Error parsing i18n phrase for key "${z}": ${$}`,be),G=["parsing error"],Q=this.defaultLocale}ce?(G=ce,Q=this.locale,Z.noCache||(this.locale===this.defaultLocale&&this.phrases.set(z,$),this.cache.set(z,ce))):(G=[],Q=this.defaultLocale)}return this.transformation&&(G=this.transformation(z,G)),[G,se,Q]}t(z,$,J,Z){return u(this.tList(z,$,J,Z))}tList(z,$,J,Z){return this._processAST(...this._preTransform(z,$,J,Z))}formatNode(z,$,J,Z,G){if(!z||typeof z!="object")return z;J==null&&(J=this.locale);const Q=(0,W.get)(z.v,$);if(Q==null)return null;if(z.t){const se=this.types[z.t];if(se)return se.call(this,Q,z,J,Z,G,$);this.warn&&this.warn(`Encountered unknown type "${z.t}" when formatting node.`)}return Q}_processAST(z,$,J){const Z=[];for(const G of z){const Q=this.formatNode(G,$,J,Z,z);Q!=null&&Z.push(Q)}return Z}};B(F,"TranslationCore");let r=F;const b=r;function u(D){return Array.isArray(D)?D.map(u).join(""):`${D}`}B(u,"listToString");let v=null,A=null;function C(D,z){return(!v||D!==A)&&(v=new Intl.PluralRules(D,{type:"cardinal"}),A=D),v.select(z)}B(C,"getCardinalName");let y=null,a=null;function w(D,z){return(!y||D!==a)&&(y=new Intl.PluralRules(D,{type:"ordinal"}),a=D),y.select(z)}B(w,"getOrdinalName")},27040:(me,te,S)=>{"use strict";S.d(te,{default:()=>I});var K=S(22527),M=S(46949);const O=class O extends K.default{constructor(x,p){super(x,p),this.apollo=null,this.site=null,this.site=this.parent,this.inject("site.apollo"),this._waiting_user_ids=new Map,this._waiting_user_logins=new Map,this._waiting_stream_ids=new Map,this._waiting_stream_logins=new Map,this._waiting_flag_ids=new Map,this._waiting_flag_logins=new Map,this.tag_cache=new Map,this._waiting_tags=new Map,this._loadStreams=(0,M.debounce)(this._loadStreams,50)}queryApollo(x,p,_){let l;return!p&&!_&&"query"in x&&x.query?l=x:(l={query:x,variables:p},_&&(l=Object.assign(l,_))),this.apollo.client.query(l)}mutate(x,p,_){let l;return!p&&!_&&"mutation"in x&&x.mutation?l=x:(l={mutation:x,variables:p},_&&(l=Object.assign(l,_))),this.apollo.client.mutate(l)}get languageCode(){const x=this.site.getSession();return x&&x.languageCode||"en"}get locale(){const x=this.site.getSession();return x&&x.locale||"en-US"}async getBadges(){const x=await this.queryApollo(await S.e(3224).then(S.t.bind(S,68905,23)));return(0,M.get)("data.badges",x)}async getMatchingCategories(x,p=15,_=null){const l=await this.queryApollo(await S.e(3224).then(S.t.bind(S,29817,23)),{query:x,first:p,cursor:_}),d=(0,M.get)("data.searchCategories.edges.@each.node",l)??[],f=x.toLowerCase();return Array.isArray(d)&&d.sort((r,b)=>{const u=r&&(r.name?.toLowerCase?.()===f||r?.displayName?.toLowerCase?.()===f),v=r&&(b.name?.toLowerCase?.()===f||b?.displayName?.toLowerCase?.()===f);return u&&!v?-1:!u&&v?1:0}),{cursor:(0,M.get)("data.searchCategories.edges.@last.cursor",l),items:d,finished:!(0,M.get)("data.searchCategories.pageInfo.hasNextPage",l),count:(0,M.get)("data.searchCategories.totalCount",l)||0}}async getCategory(x,p){const _=await this.queryApollo(await S.e(3224).then(S.t.bind(S,95373,23)),{id:x,name:p});return(0,M.get)("data.game",_)}async deleteChatMessage(x,p){x=String(x);const _=await this.mutate({mutation:await S.e(3224).then(S.t.bind(S,4223,23)),variables:{input:{channelID:x,messageID:p}}}),l=(0,M.get)("data.deleteChatMessage.responseCode",_);if(l==="TARGET_IS_BROADCASTER")throw new M.TranslatableError("You cannot delete the broadcaster's messages.","chat.delete.forbidden.broadcaster");if(l==="TARGET_IS_MODERATOR")throw new M.TranslatableError("You cannot delete messages from moderator {displayName}.","chat.delete.forbidden.moderator",(0,M.get)("data.deleteChatMessage.message.sender",_));if(l!=="SUCCESS")throw new M.TranslatableError("You don't have permission to delete messages.","chat.delete.forbidden");return!0}async getMatchingUsers(x,p=15,_=null){const l=await this.queryApollo(await S.e(3224).then(S.t.bind(S,4176,23)),{query:x,first:p,cursor:_}),d=(0,M.get)("data.searchUsers.edges.@each.node",l)??[],f=x.toLowerCase();return Array.isArray(d)&&d.sort((r,b)=>{const u=r&&(r.login?.toLowerCase?.()===f||r?.displayName?.toLowerCase?.()===f),v=r&&(b.login?.toLowerCase?.()===f||b?.displayName?.toLowerCase?.()===f);return u&&!v?-1:!u&&v?1:0}),{cursor:(0,M.get)("data.searchUsers.edges.@last.cursor",l),items:d,finished:!(0,M.get)("data.searchUsers.pageInfo.hasNextPage",l),count:(0,M.get)("data.searchUsers.totalCount",l)||0}}async getUser(x,p){const _=await this.queryApollo(await S.e(3224).then(S.t.bind(S,2247,23)),{id:x,login:p});return(0,M.get)("data.user",_)}async getUserGame(x,p){const _=await this.queryApollo(await S.e(3224).then(S.t.bind(S,34489,23)),{id:x,login:p});return(0,M.get)("data.user.broadcastSettings.game",_)}async getUserSelf(x,p){const _=await this.queryApollo(await S.e(3224).then(S.t.bind(S,23333,23)),{id:x,login:p});return(0,M.get)("data.user.self",_)}async getUserFollowed(x,p){const _=await this.queryApollo(await S.e(3224).then(S.t.bind(S,70470,23)),{id:x,login:p});return(0,M.get)("data.user.self.follower",_)}async followUser(x,p=!1){x=String(x),p=!!p;const _=await this.mutate({mutation:await S.e(3224).then(S.t.bind(S,33886,23)),variables:{input:{targetID:x,disableNotifications:p}}});console.log("result",_);const l=(0,M.get)("data.followUser.error",_);if(l?.code)throw new Error(l.code);return(0,M.get)("data.followUser.follow",_)}async unfollowUser(x,p=!1){x=String(x),p=!!p;const _=await this.mutate({mutation:await S.e(3224).then(S.t.bind(S,65199,23)),variables:{input:{targetID:x}}});return console.log("result",_),(0,M.get)("data.unfollowUser.follow",_)}async getLastBroadcast(x,p){const _=await this.queryApollo(await S.e(3224).then(S.t.bind(S,27991,23)),{id:x,login:p});return(0,M.get)("data.user.lastBroadcast",_)}getUserBasic(x,p){return new Promise((_,l)=>{x?this._waiting_user_ids.has(x)?this._waiting_user_ids.get(x).push([_,l]):this._waiting_user_ids.set(x,[[_,l]]):p?this._waiting_user_logins.has(p)?this._waiting_user_logins.get(p).push([_,l]):this._waiting_user_logins.set(p,[[_,l]]):l("id and login cannot both be null"),this._loading_users||this._loadUsers()})}async _loadUsers(){if(this._loading_users)return;this._loading_users=!0;const x=[...this._waiting_user_ids.keys()].slice(0,50),p=50-x.length,_=p>0?[...this._waiting_user_logins.keys()].slice(0,p):[];let l;try{const r=await this.queryApollo({query:await S.e(3224).then(S.t.bind(S,59649,23)),variables:{ids:x.length?x:null,logins:_.length?_:null}});l=(0,M.get)("data.users",r)}catch(r){for(const b of x){const u=this._waiting_user_ids.get(b);this._waiting_user_ids.delete(b);for(const v of u)v[1](r)}for(const b of _){const u=this._waiting_user_logins.get(b);this._waiting_user_logins.delete(b);for(const v of u)v[1](r)}return}const d=new Set(x),f=new Set(_);if(Array.isArray(l))for(const r of l){if(!r||!r.id)continue;d.delete(r.id),f.delete(r.login);let b=this._waiting_user_ids.get(r.id);if(b){this._waiting_user_ids.delete(r.id);for(const u of b)u[0](r)}if(b=this._waiting_user_logins.get(r.login),b){this._waiting_user_logins.delete(r.login);for(const u of b)u[0](r)}}for(const r of d){const b=this._waiting_user_ids.get(r);if(b){this._waiting_user_ids.delete(r);for(const u of b)u[0](null)}}for(const r of f){const b=this._waiting_user_logins.get(r);if(b){this._waiting_user_logins.delete(r);for(const u of b)u[0](null)}}this._loading_users=!1,(this._waiting_user_ids.size||this._waiting_user_logins.size)&&this._loadUsers()}async getBroadcastID(x,p){const _=await this.queryApollo({query:await S.e(3224).then(S.t.bind(S,33929,23)),variables:{id:x,login:p}});return(0,M.get)("data.user.stream.archiveVideo.id",_)}async getChannelColor(x,p){const _=await this.queryApollo({query:await S.e(3224).then(S.t.bind(S,30252,23)),variables:{id:x,login:p}});return(0,M.get)("data.user.primaryColorHex",_)}async getPoll(x){const p=await this.queryApollo({query:await S.e(3224).then(S.t.bind(S,89218,23)),variables:{id:x}});return(0,M.get)("data.poll",p)}async createPoll(x,p,_,l={}){if(typeof p!="string")throw new TypeError("title must be string");if(!Array.isArray(_)||_.some(b=>typeof b!="string"))throw new TypeError("choices must be array of strings");let d=l.bits||0,f=l.duration||60;(typeof d!="number"||d<0)&&(d=0),(typeof f!="number"||f<0)&&(f=60);const r=await this.mutate({mutation:await S.e(3224).then(S.t.bind(S,31902,23)),variables:{input:{bitsCost:d,bitsVoting:d>0,choices:_.map(b=>({title:b})),durationSeconds:f,ownedBy:`${x}`,subscriberMultiplier:l.subscriberMultiplier||!1,subscriberOnly:l.subscriberOnly||!1,title:p}}});return(0,M.get)("data.createPoll.poll",r)}async archivePoll(x){const p=await this.mutate({mutation:await S.e(3224).then(S.t.bind(S,83852,23)),variables:{id:x}});return(0,M.get)("data.archivePoll.poll",p)}async terminatePoll(x){const p=await this.mutate({mutation:await S.e(3224).then(S.t.bind(S,20685,23)),variables:{id:x}});return(0,M.get)("data.terminatePoll.poll",p)}getStreamMeta(x,p){return new Promise((_,l)=>{x?this._waiting_stream_ids.has(x)?this._waiting_stream_ids.get(x).push([_,l]):this._waiting_stream_ids.set(x,[[_,l]]):p?this._waiting_stream_logins.has(p)?this._waiting_stream_logins.get(p).push([_,l]):this._waiting_stream_logins.set(p,[[_,l]]):l("id and login cannot both be null"),this._loading_streams||this._loadStreams()})}async _loadStreams(){if(this._loading_streams)return;this._loading_streams=!0;const x=[...this._waiting_stream_ids.keys()].slice(0,50),p=50-x.length,_=p>0?[...this._waiting_stream_logins.keys()].slice(0,p):[];let l;try{const r=await this.queryApollo({query:await S.e(3224).then(S.t.bind(S,61421,23)),variables:{ids:x.length?x:null,logins:_.length?_:null}});l=(0,M.get)("data.users",r)}catch(r){for(const b of x){const u=this._waiting_stream_ids.get(b);this._waiting_stream_ids.delete(b);for(const v of u)v[1](r)}for(const b of _){const u=this._waiting_stream_logins.get(b);this._waiting_stream_logins.delete(b);for(const v of u)v[1](r)}return}const d=new Set(x),f=new Set(_);if(Array.isArray(l))for(const r of l){if(!r||!r.id)continue;d.delete(r.id),f.delete(r.login);let b=this._waiting_stream_ids.get(r.id);if(b){this._waiting_stream_ids.delete(r.id);for(const u of b)u[0](r.stream)}if(b=this._waiting_stream_logins.get(r.login),b){this._waiting_stream_logins.delete(r.login);for(const u of b)u[0](r.stream)}}for(const r of d){const b=this._waiting_stream_ids.get(r);if(b){this._waiting_stream_ids.delete(r);for(const u of b)u[0](null)}}for(const r of f){const b=this._waiting_stream_logins.get(r);if(b){this._waiting_stream_logins.delete(r);for(const u of b)u[0](null)}}this._loading_streams=!1,(this._waiting_stream_ids.size||this._waiting_stream_logins.size)&&this._loadStreams()}getStreamFlags(x,p){return new Promise((_,l)=>{if(typeof x=="number"&&(x=`${x}`),x){const d=this._waiting_flag_ids.get(x);d?d.push([_,l]):this._waiting_flag_ids.set(x,[[_,l]])}else if(p){const d=this._waiting_flag_logins.get(p);d?d.push([_,l]):this._waiting_flag_logins.set(p,[[_,l]])}else l("id and login cannot both be null");this._loading_flags||this._loadStreamFlags()})}async _loadStreamFlags(){if(this._loading_flags)return;this._loading_flags=!0;const x=[...this._waiting_flag_ids.keys()].slice(0,50),p=50-x.length,_=p>0?[...this._waiting_flag_logins.keys()].slice(0,p):[];let l;try{const r=await this.queryApollo({query:await S.e(3224).then(S.t.bind(S,9808,23)),variables:{ids:x.length?x:null,logins:_.length?_:null}});l=(0,M.get)("data.users",r)}catch(r){for(const b of x){const u=this._waiting_flag_ids.get(b);if(u){this._waiting_flag_ids.delete(b);for(const v of u)v[1](r)}}for(const b of _){const u=this._waiting_flag_logins.get(b);if(u){this._waiting_flag_logins.delete(b);for(const v of u)v[1](r)}}return}const d=new Set(x),f=new Set(_);if(Array.isArray(l))for(const r of l){if(!r||!r.id)continue;d.delete(r.id),f.delete(r.login);let b=this._waiting_flag_ids.get(r.id);if(b){this._waiting_flag_ids.delete(r.id);for(const u of b)u[0](r.stream?.contentClassificationLabels)}if(b=this._waiting_flag_logins.get(r.login),b){this._waiting_flag_logins.delete(r.login);for(const u of b)u[0](r.stream?.contentClassificationLabels)}}for(const r of d){const b=this._waiting_flag_ids.get(r);if(b){this._waiting_flag_ids.delete(r);for(const u of b)u[0](null)}}for(const r of f){const b=this._waiting_flag_logins.get(r);if(b){this._waiting_flag_logins.delete(r);for(const u of b)u[0](null)}}this._loading_flags=!1,(this._waiting_flag_ids.size||this._waiting_flag_logins.size)&&this._loadStreamFlags()}async getMatchingTags(x){const _=(await this.queryApollo({query:await S.e(3224).then(S.t.bind(S,50873,23)),variables:{query:x,first:100}}))?.data?.searchFreeformTags?.edges;if(!Array.isArray(_)||!_.length)return[];const l=[];for(const d of _){const f=d?.node?.tagName;f&&l.push(f)}return l}};B(O,"TwitchData");let I=O},36e3:me=>{var te={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetClipInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"slug"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"clip"},arguments:[{kind:"Argument",name:{kind:"Name",value:"slug"},value:{kind:"Variable",name:{kind:"Name",value:"slug"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"curator"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"broadcaster"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"game"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"thumbnailURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"86"}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"IntValue",value:"45"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"viewCount"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:184}};te.loc.source={body:"query FFZ_GetClipInfo($slug:ID!){clip(slug:$slug){id curator{id login displayName}broadcaster{id login displayName}game{id displayName}title thumbnailURL(width:86 height:45)viewCount}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function K(x){return x.filter(function(p){if(p.kind!=="FragmentDefinition")return!0;var _=p.name.value;return S[_]?!1:(S[_]=!0,!0)})}B(K,"unique");function M(x,p){if(x.kind==="FragmentSpread")p.add(x.name.value);else if(x.kind==="VariableDefinition"){var _=x.type;_.kind==="NamedType"&&p.add(_.name.value)}x.selectionSet&&x.selectionSet.selections.forEach(function(l){M(l,p)}),x.variableDefinitions&&x.variableDefinitions.forEach(function(l){M(l,p)}),x.definitions&&x.definitions.forEach(function(l){M(l,p)})}B(M,"collectFragmentReferences");var I={};B(function(){te.definitions.forEach(function(p){if(p.name){var _=new Set;M(p,_),I[p.name.value]=_}})},"extractReferences")();function O(x,p){for(var _=0;_<x.definitions.length;_++){var l=x.definitions[_];if(l.name&&l.name.value==p)return l}}B(O,"findOperation");function W(x,p){var _={kind:x.kind,definitions:[O(x,p)]};x.hasOwnProperty("loc")&&(_.loc=x.loc);var l=I[p]||new Set,d=new Set,f=new Set;for(l.forEach(function(b){f.add(b)});f.size>0;){var r=f;f=new Set,r.forEach(function(b){if(!d.has(b)){d.add(b);var u=I[b]||new Set;u.forEach(function(v){f.add(v)})}})}return d.forEach(function(b){var u=O(x,b);u&&_.definitions.push(u)}),_}B(W,"oneQuery"),me.exports=te,me.exports.FFZ_GetClipInfo=W(te,"FFZ_GetClipInfo")},98750:me=>{var te={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetEmoteInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"artist"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"setID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"text"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionProduct"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:174}};te.loc.source={body:"query FFZ_GetEmoteInfo($id:ID!){emote(id:$id){id artist{id login displayName}owner{id login displayName}setID text subscriptionProduct{id state owner{id login displayName}}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function K(x){return x.filter(function(p){if(p.kind!=="FragmentDefinition")return!0;var _=p.name.value;return S[_]?!1:(S[_]=!0,!0)})}B(K,"unique");function M(x,p){if(x.kind==="FragmentSpread")p.add(x.name.value);else if(x.kind==="VariableDefinition"){var _=x.type;_.kind==="NamedType"&&p.add(_.name.value)}x.selectionSet&&x.selectionSet.selections.forEach(function(l){M(l,p)}),x.variableDefinitions&&x.variableDefinitions.forEach(function(l){M(l,p)}),x.definitions&&x.definitions.forEach(function(l){M(l,p)})}B(M,"collectFragmentReferences");var I={};B(function(){te.definitions.forEach(function(p){if(p.name){var _=new Set;M(p,_),I[p.name.value]=_}})},"extractReferences")();function O(x,p){for(var _=0;_<x.definitions.length;_++){var l=x.definitions[_];if(l.name&&l.name.value==p)return l}}B(O,"findOperation");function W(x,p){var _={kind:x.kind,definitions:[O(x,p)]};x.hasOwnProperty("loc")&&(_.loc=x.loc);var l=I[p]||new Set,d=new Set,f=new Set;for(l.forEach(function(b){f.add(b)});f.size>0;){var r=f;f=new Set,r.forEach(function(b){if(!d.has(b)){d.add(b);var u=I[b]||new Set;u.forEach(function(v){f.add(v)})}})}return d.forEach(function(b){var u=O(x,b);u&&_.definitions.push(u)}),_}B(W,"oneQuery"),me.exports=te,me.exports.FFZ_GetEmoteInfo=W(te,"FFZ_GetEmoteInfo")},60795:me=>{var te={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetEmoteSetInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emoteSet"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionProducts"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emoteSetID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:126}};te.loc.source={body:"query FFZ_GetEmoteSetInfo($id:ID!){emoteSet(id:$id){id owner{id login displayName subscriptionProducts{id emoteSetID state}}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function K(x){return x.filter(function(p){if(p.kind!=="FragmentDefinition")return!0;var _=p.name.value;return S[_]?!1:(S[_]=!0,!0)})}B(K,"unique");function M(x,p){if(x.kind==="FragmentSpread")p.add(x.name.value);else if(x.kind==="VariableDefinition"){var _=x.type;_.kind==="NamedType"&&p.add(_.name.value)}x.selectionSet&&x.selectionSet.selections.forEach(function(l){M(l,p)}),x.variableDefinitions&&x.variableDefinitions.forEach(function(l){M(l,p)}),x.definitions&&x.definitions.forEach(function(l){M(l,p)})}B(M,"collectFragmentReferences");var I={};B(function(){te.definitions.forEach(function(p){if(p.name){var _=new Set;M(p,_),I[p.name.value]=_}})},"extractReferences")();function O(x,p){for(var _=0;_<x.definitions.length;_++){var l=x.definitions[_];if(l.name&&l.name.value==p)return l}}B(O,"findOperation");function W(x,p){var _={kind:x.kind,definitions:[O(x,p)]};x.hasOwnProperty("loc")&&(_.loc=x.loc);var l=I[p]||new Set,d=new Set,f=new Set;for(l.forEach(function(b){f.add(b)});f.size>0;){var r=f;f=new Set,r.forEach(function(b){if(!d.has(b)){d.add(b);var u=I[b]||new Set;u.forEach(function(v){f.add(v)})}})}return d.forEach(function(b){var u=O(x,b);u&&_.definitions.push(u)}),_}B(W,"oneQuery"),me.exports=te,me.exports.FFZ_GetEmoteSetInfo=W(te,"FFZ_GetEmoteSetInfo")},87590:me=>{var te={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetVideoInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"video"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"previewThumbnailURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"320"}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"IntValue",value:"180"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"lengthSeconds"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"publishedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"viewCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"game"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profileImageURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"50"}}],directives:[]}]}}]}}]}}],loc:{start:0,end:207}};te.loc.source={body:"query FFZ_GetVideoInfo($id:ID!){video(id:$id){id title previewThumbnailURL(width:320 height:180)lengthSeconds publishedAt viewCount game{id displayName}owner{id login displayName profileImageURL(width:50)}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function K(x){return x.filter(function(p){if(p.kind!=="FragmentDefinition")return!0;var _=p.name.value;return S[_]?!1:(S[_]=!0,!0)})}B(K,"unique");function M(x,p){if(x.kind==="FragmentSpread")p.add(x.name.value);else if(x.kind==="VariableDefinition"){var _=x.type;_.kind==="NamedType"&&p.add(_.name.value)}x.selectionSet&&x.selectionSet.selections.forEach(function(l){M(l,p)}),x.variableDefinitions&&x.variableDefinitions.forEach(function(l){M(l,p)}),x.definitions&&x.definitions.forEach(function(l){M(l,p)})}B(M,"collectFragmentReferences");var I={};B(function(){te.definitions.forEach(function(p){if(p.name){var _=new Set;M(p,_),I[p.name.value]=_}})},"extractReferences")();function O(x,p){for(var _=0;_<x.definitions.length;_++){var l=x.definitions[_];if(l.name&&l.name.value==p)return l}}B(O,"findOperation");function W(x,p){var _={kind:x.kind,definitions:[O(x,p)]};x.hasOwnProperty("loc")&&(_.loc=x.loc);var l=I[p]||new Set,d=new Set,f=new Set;for(l.forEach(function(b){f.add(b)});f.size>0;){var r=f;f=new Set,r.forEach(function(b){if(!d.has(b)){d.add(b);var u=I[b]||new Set;u.forEach(function(v){f.add(v)})}})}return d.forEach(function(b){var u=O(x,b);u&&_.definitions.push(u)}),_}B(W,"oneQuery"),me.exports=te,me.exports.FFZ_GetVideoInfo=W(te,"FFZ_GetVideoInfo")},96883:me=>{var te={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_EmoteCard"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"emoteID"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"emoteID"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"setID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"artist"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"channel"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"localEmoteSets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emotes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"stream"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"follower"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"followedAt"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"subscriptionBenefit"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tier"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"subscriptionProducts"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tier"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emotes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"priceInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"currency"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"price"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"bitsBadgeTierSummary"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"threshold"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isUnlocked"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"numberOfBitsUntilUnlock"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:418}};te.loc.source={body:"query FFZ_EmoteCard($emoteID:ID!){emote(id:$emoteID){id type token setID artist{id login displayName}owner{id login displayName channel{id localEmoteSets{id emotes{id token}}}stream{id type}self{follower{followedAt}subscriptionBenefit{id tier}}subscriptionProducts{id displayName tier name url emotes{id token}priceInfo{id currency price}}}bitsBadgeTierSummary{threshold self{isUnlocked numberOfBitsUntilUnlock}}type}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function K(x){return x.filter(function(p){if(p.kind!=="FragmentDefinition")return!0;var _=p.name.value;return S[_]?!1:(S[_]=!0,!0)})}B(K,"unique");function M(x,p){if(x.kind==="FragmentSpread")p.add(x.name.value);else if(x.kind==="VariableDefinition"){var _=x.type;_.kind==="NamedType"&&p.add(_.name.value)}x.selectionSet&&x.selectionSet.selections.forEach(function(l){M(l,p)}),x.variableDefinitions&&x.variableDefinitions.forEach(function(l){M(l,p)}),x.definitions&&x.definitions.forEach(function(l){M(l,p)})}B(M,"collectFragmentReferences");var I={};B(function(){te.definitions.forEach(function(p){if(p.name){var _=new Set;M(p,_),I[p.name.value]=_}})},"extractReferences")();function O(x,p){for(var _=0;_<x.definitions.length;_++){var l=x.definitions[_];if(l.name&&l.name.value==p)return l}}B(O,"findOperation");function W(x,p){var _={kind:x.kind,definitions:[O(x,p)]};x.hasOwnProperty("loc")&&(_.loc=x.loc);var l=I[p]||new Set,d=new Set,f=new Set;for(l.forEach(function(b){f.add(b)});f.size>0;){var r=f;f=new Set,r.forEach(function(b){if(!d.has(b)){d.add(b);var u=I[b]||new Set;u.forEach(function(v){f.add(v)})}})}return d.forEach(function(b){var u=O(x,b);u&&_.definitions.push(u)}),_}B(W,"oneQuery"),me.exports=te,me.exports.FFZ_EmoteCard=W(te,"FFZ_EmoteCard")},90424:me=>{var te={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_EmoteMenu_SubStatus"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"after"}},type:{kind:"NamedType",name:{kind:"Name",value:"Cursor"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"criteria"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SubscriptionBenefitCriteriaInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentUser"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionBenefits"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"after"}}},{kind:"Argument",name:{kind:"Name",value:"criteria"},value:{kind:"Variable",name:{kind:"Name",value:"criteria"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"pageInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasNextPage"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"edges"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cursor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"node"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"gift"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isGift"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"purchasedWithPrime"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"endsAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"renewsAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"product"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emoteSetID"},arguments:[],directives:[]}]}}]}}]}}]}}]}}]}}],loc:{start:0,end:296}};te.loc.source={body:"query FFZ_EmoteMenu_SubStatus($first:Int$after:Cursor$criteria:SubscriptionBenefitCriteriaInput!){currentUser{id subscriptionBenefits(first:$first after:$after criteria:$criteria){pageInfo{hasNextPage}edges{cursor node{id gift{isGift}purchasedWithPrime endsAt renewsAt product{id emoteSetID}}}}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function K(x){return x.filter(function(p){if(p.kind!=="FragmentDefinition")return!0;var _=p.name.value;return S[_]?!1:(S[_]=!0,!0)})}B(K,"unique");function M(x,p){if(x.kind==="FragmentSpread")p.add(x.name.value);else if(x.kind==="VariableDefinition"){var _=x.type;_.kind==="NamedType"&&p.add(_.name.value)}x.selectionSet&&x.selectionSet.selections.forEach(function(l){M(l,p)}),x.variableDefinitions&&x.variableDefinitions.forEach(function(l){M(l,p)}),x.definitions&&x.definitions.forEach(function(l){M(l,p)})}B(M,"collectFragmentReferences");var I={};B(function(){te.definitions.forEach(function(p){if(p.name){var _=new Set;M(p,_),I[p.name.value]=_}})},"extractReferences")();function O(x,p){for(var _=0;_<x.definitions.length;_++){var l=x.definitions[_];if(l.name&&l.name.value==p)return l}}B(O,"findOperation");function W(x,p){var _={kind:x.kind,definitions:[O(x,p)]};x.hasOwnProperty("loc")&&(_.loc=x.loc);var l=I[p]||new Set,d=new Set,f=new Set;for(l.forEach(function(b){f.add(b)});f.size>0;){var r=f;f=new Set,r.forEach(function(b){if(!d.has(b)){d.add(b);var u=I[b]||new Set;u.forEach(function(v){f.add(v)})}})}return d.forEach(function(b){var u=O(x,b);u&&_.definitions.push(u)}),_}B(W,"oneQuery"),me.exports=te,me.exports.FFZ_EmoteMenu_SubStatus=W(te,"FFZ_EmoteMenu_SubStatus")},4866:(me,te,S)=>{var K=S(89),M=S(49388),I=S(64311),O=S(45138);function W(x,p,_){if(arguments.length<2&&(_=x,x=null,p=null),this.capacity=_,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-cache: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-cache: capacity should be a finite positive integer.");var l=I.getPointerArray(_);this.forward=new l(_),this.backward=new l(_),this.K=typeof x=="function"?new x(_):new Array(_),this.V=typeof p=="function"?new p(_):new Array(_),this.size=0,this.head=0,this.tail=0,this.items={}}B(W,"LRUCache"),W.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items={}},W.prototype.splayOnTop=function(x){var p=this.head;if(this.head===x)return this;var _=this.backward[x],l=this.forward[x];return this.tail===x?this.tail=_:this.backward[l]=_,this.forward[_]=l,this.backward[p]=x,this.head=x,this.forward[x]=p,this},W.prototype.set=function(x,p){var _=this.items[x];if(typeof _<"u"){this.splayOnTop(_),this.V[_]=p;return}this.size<this.capacity?_=this.size++:(_=this.tail,this.tail=this.backward[_],delete this.items[this.K[_]]),this.items[x]=_,this.K[_]=x,this.V[_]=p,this.forward[_]=this.head,this.backward[this.head]=_,this.head=_},W.prototype.setpop=function(x,p){var _=null,l=null,d=this.items[x];return typeof d<"u"?(this.splayOnTop(d),_=this.V[d],this.V[d]=p,{evicted:!1,key:x,value:_}):(this.size<this.capacity?d=this.size++:(d=this.tail,this.tail=this.backward[d],_=this.V[d],l=this.K[d],delete this.items[this.K[d]]),this.items[x]=d,this.K[d]=x,this.V[d]=p,this.forward[d]=this.head,this.backward[this.head]=d,this.head=d,l?{evicted:!0,key:l,value:_}:null)},W.prototype.has=function(x){return x in this.items},W.prototype.get=function(x){var p=this.items[x];if(!(typeof p>"u"))return this.splayOnTop(p),this.V[p]},W.prototype.peek=function(x){var p=this.items[x];if(!(typeof p>"u"))return this.V[p]},W.prototype.forEach=function(x,p){p=arguments.length>1?p:this;for(var _=0,l=this.size,d=this.head,f=this.K,r=this.V,b=this.forward;_<l;)x.call(p,r[d],f[d],this),d=b[d],_++},W.prototype.keys=function(){var x=0,p=this.size,_=this.head,l=this.K,d=this.forward;return new K(function(){if(x>=p)return{done:!0};var f=l[_];return x++,x<p&&(_=d[_]),{done:!1,value:f}})},W.prototype.values=function(){var x=0,p=this.size,_=this.head,l=this.V,d=this.forward;return new K(function(){if(x>=p)return{done:!0};var f=l[_];return x++,x<p&&(_=d[_]),{done:!1,value:f}})},W.prototype.entries=function(){var x=0,p=this.size,_=this.head,l=this.K,d=this.V,f=this.forward;return new K(function(){if(x>=p)return{done:!0};var r=l[_],b=d[_];return x++,x<p&&(_=f[_]),{done:!1,value:[r,b]}})},typeof Symbol<"u"&&(W.prototype[Symbol.iterator]=W.prototype.entries),W.prototype.inspect=function(){for(var x=new Map,p=this.entries(),_;_=p.next(),!_.done;)x.set(_.value[0],_.value[1]);return Object.defineProperty(x,"constructor",{value:W,enumerable:!1}),x},typeof Symbol<"u"&&(W.prototype[Symbol.for("nodejs.util.inspect.custom")]=W.prototype.inspect),W.from=function(x,p,_,l){if(arguments.length<2){if(l=O.guessLength(x),typeof l!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(l=p,p=null,_=null);var d=new W(p,_,l);return M(x,function(f,r){d.set(r,f)}),d},me.exports=W},45138:(me,te,S)=>{var K=S(49388),M=S(64311);function I(p){return Array.isArray(p)||M.isTypedArray(p)}B(I,"isArrayLike");function O(p){if(typeof p.length=="number")return p.length;if(typeof p.size=="number")return p.size}B(O,"guessLength");function W(p){var _=O(p),l=typeof _=="number"?new Array(_):[],d=0;return K(p,function(f){l[d++]=f}),l}B(W,"toArray");function x(p){var _=O(p),l=typeof _=="number"?M.getPointerArray(_):Array,d=typeof _=="number"?new Array(_):[],f=typeof _=="number"?new l(_):[],r=0;return K(p,function(b){d[r]=b,f[r]=r++}),[d,f]}B(x,"toArrayWithIndices"),te.isArrayLike=I,te.guessLength=O,te.toArray=W,te.toArrayWithIndices=x},64311:(me,te)=>{var S=Math.pow(2,8)-1,K=Math.pow(2,16)-1,M=Math.pow(2,32)-1,I=Math.pow(2,7)-1,O=Math.pow(2,15)-1,W=Math.pow(2,31)-1;te.getPointerArray=function(p){var _=p-1;if(_<=S)return Uint8Array;if(_<=K)return Uint16Array;if(_<=M)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},te.getSignedPointerArray=function(p){var _=p-1;return _<=I?Int8Array:_<=O?Int16Array:_<=W?Int32Array:Float64Array},te.getNumberType=function(p){return p===(p|0)?Math.sign(p)===-1?p<=127&&p>=-128?Int8Array:p<=32767&&p>=-32768?Int16Array:Int32Array:p<=255?Uint8Array:p<=65535?Uint16Array:Uint32Array:Float64Array};var x={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};te.getMinimalRepresentation=function(p,_){var l=null,d=0,f,r,b,u,v;for(u=0,v=p.length;u<v;u++)b=_?_(p[u]):p[u],r=te.getNumberType(b),f=x[r.name],f>d&&(d=f,l=r);return l},te.isTypedArray=function(p){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(p)},te.concat=function(){var p=0,_,l,d;for(_=0,d=arguments.length;_<d;_++)p+=arguments[_].length;var f=new arguments[0].constructor(p);for(_=0,l=0;_<d;_++)f.set(arguments[_],l),l+=arguments[_].length;return f},te.indices=function(p){for(var _=te.getPointerArray(p),l=new _(p),d=0;d<p;d++)l[d]=d;return l}},49388:(me,te,S)=>{var K=S(18713),M=K.ARRAY_BUFFER_SUPPORT,I=K.SYMBOL_SUPPORT;me.exports=B(function(W,x){var p,_,l,d,f;if(!W)throw new Error("obliterator/forEach: invalid iterable.");if(typeof x!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(W)||M&&ArrayBuffer.isView(W)||typeof W=="string"||W.toString()==="[object Arguments]"){for(l=0,d=W.length;l<d;l++)x(W[l],l);return}if(typeof W.forEach=="function"){W.forEach(x);return}if(I&&Symbol.iterator in W&&typeof W.next!="function"&&(W=W[Symbol.iterator]()),typeof W.next=="function"){for(p=W,l=0;f=p.next(),f.done!==!0;)x(f.value,l),l++;return}for(_ in W)W.hasOwnProperty(_)&&x(W[_],_)},"forEach")},89:me=>{function te(S){if(typeof S!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=S}B(te,"Iterator"),typeof Symbol<"u"&&(te.prototype[Symbol.iterator]=function(){return this}),te.of=function(){var S=arguments,K=S.length,M=0;return new te(function(){return M>=K?{done:!0}:{done:!1,value:S[M++]}})},te.empty=function(){var S=new te(function(){return{done:!0}});return S},te.fromSequence=function(S){var K=0,M=S.length;return new te(function(){return K>=M?{done:!0}:{done:!1,value:S[K++]}})},te.is=function(S){return S instanceof te?!0:typeof S=="object"&&S!==null&&typeof S.next=="function"},me.exports=te},18713:(me,te)=>{te.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u",te.SYMBOL_SUPPORT=typeof Symbol<"u"},72167:me=>{me.exports=b,me.exports.match=I,me.exports.regexpToFunction=O,me.exports.parse=K,me.exports.compile=M,me.exports.tokensToFunction=W,me.exports.tokensToRegExp=r;var te="/",S=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function K(u,v){for(var A=[],C=0,y=0,a="",w=v&&v.delimiter||te,F=v&&v.whitelist||void 0,D=!1,z;(z=S.exec(u))!==null;){var $=z[0],J=z[1],Z=z.index;if(a+=u.slice(y,Z),y=Z+$.length,J){a+=J[1],D=!0;continue}var G="",Q=z[2],se=z[3],ce=z[4],be=z[5];if(!D&&a.length){var ve=a.length-1,Re=a[ve],oe=F?F.indexOf(Re)>-1:!0;oe&&(G=Re,a=a.slice(0,ve))}a&&(A.push(a),a="",D=!1);var ie=be==="+"||be==="*",ae=be==="?"||be==="*",xe=se||ce,ne=G||w;A.push({name:Q||C++,prefix:G,delimiter:ne,optional:ae,repeat:ie,pattern:xe?p(xe):"[^"+x(ne===w?ne:ne+w)+"]+?"})}return(a||y<u.length)&&A.push(a+u.substr(y)),A}B(K,"parse");function M(u,v){return W(K(u,v),v)}B(M,"compile");function I(u,v){var A=[],C=b(u,A,v);return O(C,A)}B(I,"match");function O(u,v){return function(A,C){var y=u.exec(A);if(!y)return!1;for(var a=y[0],w=y.index,F={},D=C&&C.decode||decodeURIComponent,z=1;z<y.length;z++)if(y[z]!==void 0){var $=v[z-1];$.repeat?F[$.name]=y[z].split($.delimiter).map(function(J){return D(J,$)}):F[$.name]=D(y[z],$)}return{path:a,index:w,params:F}}}B(O,"regexpToFunction");function W(u,v){for(var A=new Array(u.length),C=0;C<u.length;C++)typeof u[C]=="object"&&(A[C]=new RegExp("^(?:"+u[C].pattern+")$",_(v)));return function(y,a){for(var w="",F=a&&a.encode||encodeURIComponent,D=a?a.validate!==!1:!0,z=0;z<u.length;z++){var $=u[z];if(typeof $=="string"){w+=$;continue}var J=y?y[$.name]:void 0,Z;if(Array.isArray(J)){if(!$.repeat)throw new TypeError('Expected "'+$.name+'" to not repeat, but got array');if(J.length===0){if($.optional)continue;throw new TypeError('Expected "'+$.name+'" to not be empty')}for(var G=0;G<J.length;G++){if(Z=F(J[G],$),D&&!A[z].test(Z))throw new TypeError('Expected all "'+$.name+'" to match "'+$.pattern+'"');w+=(G===0?$.prefix:$.delimiter)+Z}continue}if(typeof J=="string"||typeof J=="number"||typeof J=="boolean"){if(Z=F(String(J),$),D&&!A[z].test(Z))throw new TypeError('Expected "'+$.name+'" to match "'+$.pattern+'", but got "'+Z+'"');w+=$.prefix+Z;continue}if(!$.optional)throw new TypeError('Expected "'+$.name+'" to be '+($.repeat?"an array":"a string"))}return w}}B(W,"tokensToFunction");function x(u){return u.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}B(x,"escapeString");function p(u){return u.replace(/([=!:$/()])/g,"\\$1")}B(p,"escapeGroup");function _(u){return u&&u.sensitive?"":"i"}B(_,"flags");function l(u,v){if(!v)return u;var A=u.source.match(/\((?!\?)/g);if(A)for(var C=0;C<A.length;C++)v.push({name:C,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return u}B(l,"regexpToRegexp");function d(u,v,A){for(var C=[],y=0;y<u.length;y++)C.push(b(u[y],v,A).source);return new RegExp("(?:"+C.join("|")+")",_(A))}B(d,"arrayToRegexp");function f(u,v,A){return r(K(u,A),v,A)}B(f,"stringToRegexp");function r(u,v,A){A=A||{};for(var C=A.strict,y=A.start!==!1,a=A.end!==!1,w=A.delimiter||te,F=[].concat(A.endsWith||[]).map(x).concat("$").join("|"),D=y?"^":"",z=0;z<u.length;z++){var $=u[z];if(typeof $=="string")D+=x($);else{var J=$.repeat?"(?:"+$.pattern+")(?:"+x($.delimiter)+"(?:"+$.pattern+"))*":$.pattern;v&&v.push($),$.optional?$.prefix?D+="(?:"+x($.prefix)+"("+J+"))?":D+="("+J+")?":D+=x($.prefix)+"("+J+")"}}if(a)C||(D+="(?:"+x(w)+")?"),D+=F==="$"?"$":"(?="+F+")";else{var Z=u[u.length-1],G=typeof Z=="string"?Z[Z.length-1]===w:Z===void 0;C||(D+="(?:"+x(w)+"(?="+F+"))?"),G||(D+="(?="+x(w)+"|"+F+")")}return new RegExp(D,_(A))}B(r,"tokensToRegExp");function b(u,v,A){return u instanceof RegExp?l(u,v):Array.isArray(u)?d(u,v,A):f(u,v,A)}B(b,"pathToRegexp")},47596:(me,te)=>{"use strict";var S;/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K=Symbol.for("react.element"),M=Symbol.for("react.portal"),I=Symbol.for("react.fragment"),O=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),x=Symbol.for("react.provider"),p=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),r=Symbol.iterator;function b(ne){return ne===null||typeof ne!="object"?null:(ne=r&&ne[r]||ne["@@iterator"],typeof ne=="function"?ne:null)}B(b,"A");var u={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,A={};function C(ne,we,ze){this.props=ne,this.context=we,this.refs=A,this.updater=ze||u}B(C,"E"),C.prototype.isReactComponent={},C.prototype.setState=function(ne,we){if(typeof ne!="object"&&typeof ne!="function"&&ne!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ne,we,"setState")},C.prototype.forceUpdate=function(ne){this.updater.enqueueForceUpdate(this,ne,"forceUpdate")};function y(){}B(y,"F"),y.prototype=C.prototype;function a(ne,we,ze){this.props=ne,this.context=we,this.refs=A,this.updater=ze||u}B(a,"G");var w=a.prototype=new y;w.constructor=a,v(w,C.prototype),w.isPureReactComponent=!0;var F=Array.isArray,D=Object.prototype.hasOwnProperty,z={current:null},$={key:!0,ref:!0,__self:!0,__source:!0};function J(ne,we,ze){var Me,Pe={},Le=null,Ge=null;if(we!=null)for(Me in we.ref!==void 0&&(Ge=we.ref),we.key!==void 0&&(Le=""+we.key),we)D.call(we,Me)&&!$.hasOwnProperty(Me)&&(Pe[Me]=we[Me]);var Ye=arguments.length-2;if(Ye===1)Pe.children=ze;else if(1<Ye){for(var Ke=Array(Ye),ht=0;ht<Ye;ht++)Ke[ht]=arguments[ht+2];Pe.children=Ke}if(ne&&ne.defaultProps)for(Me in Ye=ne.defaultProps,Ye)Pe[Me]===void 0&&(Pe[Me]=Ye[Me]);return{$$typeof:K,type:ne,key:Le,ref:Ge,props:Pe,_owner:z.current}}B(J,"M");function Z(ne,we){return{$$typeof:K,type:ne.type,key:we,ref:ne.ref,props:ne.props,_owner:ne._owner}}B(Z,"N");function G(ne){return typeof ne=="object"&&ne!==null&&ne.$$typeof===K}B(G,"O");function Q(ne){var we={"=":"=0",":":"=2"};return"$"+ne.replace(/[=:]/g,function(ze){return we[ze]})}B(Q,"escape2");var se=/\/+/g;function ce(ne,we){return typeof ne=="object"&&ne!==null&&ne.key!=null?Q(""+ne.key):we.toString(36)}B(ce,"Q");function be(ne,we,ze,Me,Pe){var Le=typeof ne;(Le==="undefined"||Le==="boolean")&&(ne=null);var Ge=!1;if(ne===null)Ge=!0;else switch(Le){case"string":case"number":Ge=!0;break;case"object":switch(ne.$$typeof){case K:case M:Ge=!0}}if(Ge)return Ge=ne,Pe=Pe(Ge),ne=Me===""?"."+ce(Ge,0):Me,F(Pe)?(ze="",ne!=null&&(ze=ne.replace(se,"$&/")+"/"),be(Pe,we,ze,"",function(ht){return ht})):Pe!=null&&(G(Pe)&&(Pe=Z(Pe,ze+(!Pe.key||Ge&&Ge.key===Pe.key?"":(""+Pe.key).replace(se,"$&/")+"/")+ne)),we.push(Pe)),1;if(Ge=0,Me=Me===""?".":Me+":",F(ne))for(var Ye=0;Ye<ne.length;Ye++){Le=ne[Ye];var Ke=Me+ce(Le,Ye);Ge+=be(Le,we,ze,Ke,Pe)}else if(Ke=b(ne),typeof Ke=="function")for(ne=Ke.call(ne),Ye=0;!(Le=ne.next()).done;)Le=Le.value,Ke=Me+ce(Le,Ye++),Ge+=be(Le,we,ze,Ke,Pe);else if(Le==="object")throw we=String(ne),Error("Objects are not valid as a React child (found: "+(we==="[object Object]"?"object with keys {"+Object.keys(ne).join(", ")+"}":we)+"). If you meant to render a collection of children, use an array instead.");return Ge}B(be,"R");function ve(ne,we,ze){if(ne==null)return ne;var Me=[],Pe=0;return be(ne,Me,"","",function(Le){return we.call(ze,Le,Pe++)}),Me}B(ve,"S");function Re(ne){if(ne._status===-1){var we=ne._result;we=we(),we.then(function(ze){(ne._status===0||ne._status===-1)&&(ne._status=1,ne._result=ze)},function(ze){(ne._status===0||ne._status===-1)&&(ne._status=2,ne._result=ze)}),ne._status===-1&&(ne._status=0,ne._result=we)}if(ne._status===1)return ne._result.default;throw ne._result}B(Re,"T");var oe={current:null},ie={transition:null},ae={ReactCurrentDispatcher:oe,ReactCurrentBatchConfig:ie,ReactCurrentOwner:z};function xe(){throw Error("act(...) is not supported in production builds of React.")}B(xe,"X"),S={map:ve,forEach:function(ne,we,ze){ve(ne,function(){we.apply(this,arguments)},ze)},count:function(ne){var we=0;return ve(ne,function(){we++}),we},toArray:function(ne){return ve(ne,function(we){return we})||[]},only:function(ne){if(!G(ne))throw Error("React.Children.only expected to receive a single React element child.");return ne}},S=C,S=I,S=W,S=a,S=O,S=l,S=ae,S=xe,S=B(function(ne,we,ze){if(ne==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ne+".");var Me=v({},ne.props),Pe=ne.key,Le=ne.ref,Ge=ne._owner;if(we!=null){if(we.ref!==void 0&&(Le=we.ref,Ge=z.current),we.key!==void 0&&(Pe=""+we.key),ne.type&&ne.type.defaultProps)var Ye=ne.type.defaultProps;for(Ke in we)D.call(we,Ke)&&!$.hasOwnProperty(Ke)&&(Me[Ke]=we[Ke]===void 0&&Ye!==void 0?Ye[Ke]:we[Ke])}var Ke=arguments.length-2;if(Ke===1)Me.children=ze;else if(1<Ke){Ye=Array(Ke);for(var ht=0;ht<Ke;ht++)Ye[ht]=arguments[ht+2];Me.children=Ye}return{$$typeof:K,type:ne.type,key:Pe,ref:Le,props:Me,_owner:Ge}},"__webpack_unused_export__"),S=B(function(ne){return ne={$$typeof:p,_currentValue:ne,_currentValue2:ne,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ne.Provider={$$typeof:x,_context:ne},ne.Consumer=ne},"__webpack_unused_export__"),te.createElement=J,S=B(function(ne){var we=J.bind(null,ne);return we.type=ne,we},"__webpack_unused_export__"),S=B(function(){return{current:null}},"__webpack_unused_export__"),S=B(function(ne){return{$$typeof:_,render:ne}},"__webpack_unused_export__"),S=G,S=B(function(ne){return{$$typeof:f,_payload:{_status:-1,_result:ne},_init:Re}},"__webpack_unused_export__"),S=B(function(ne,we){return{$$typeof:d,type:ne,compare:we===void 0?null:we}},"__webpack_unused_export__"),S=B(function(ne){var we=ie.transition;ie.transition={};try{ne()}finally{ie.transition=we}},"__webpack_unused_export__"),S=xe,S=B(function(ne,we){return oe.current.useCallback(ne,we)},"__webpack_unused_export__"),S=B(function(ne){return oe.current.useContext(ne)},"__webpack_unused_export__"),S=B(function(){},"__webpack_unused_export__"),S=B(function(ne){return oe.current.useDeferredValue(ne)},"__webpack_unused_export__"),S=B(function(ne,we){return oe.current.useEffect(ne,we)},"__webpack_unused_export__"),S=B(function(){return oe.current.useId()},"__webpack_unused_export__"),S=B(function(ne,we,ze){return oe.current.useImperativeHandle(ne,we,ze)},"__webpack_unused_export__"),S=B(function(ne,we){return oe.current.useInsertionEffect(ne,we)},"__webpack_unused_export__"),S=B(function(ne,we){return oe.current.useLayoutEffect(ne,we)},"__webpack_unused_export__"),S=B(function(ne,we){return oe.current.useMemo(ne,we)},"__webpack_unused_export__"),S=B(function(ne,we,ze){return oe.current.useReducer(ne,we,ze)},"__webpack_unused_export__"),S=B(function(ne){return oe.current.useRef(ne)},"__webpack_unused_export__"),S=B(function(ne){return oe.current.useState(ne)},"__webpack_unused_export__"),S=B(function(ne,we,ze){return oe.current.useSyncExternalStore(ne,we,ze)},"__webpack_unused_export__"),S=B(function(){return oe.current.useTransition()},"__webpack_unused_export__"),S="18.3.1"},75271:(me,te,S)=>{"use strict";me.exports=S(47596)},73637:(me,te,S)=>{var K={"./af.js":[20179,1081],"./am.js":[61783,5380],"./ar-dz.js":[98136,5215],"./ar-iq.js":[82690,789],"./ar-kw.js":[62009,5151],"./ar-ly.js":[49408,1722],"./ar-ma.js":[87330,909],"./ar-sa.js":[66575,5012],"./ar-tn.js":[5742,8757],"./ar.js":[46567,3030],"./az.js":[14319,8736],"./be.js":[41737,2244],"./bg.js":[86835,6757],"./bi.js":[50045,8111],"./bm.js":[65561,9082],"./bn.js":[57602,4667],"./bo.js":[92594,3134],"./br.js":[34467,3968],"./bs.js":[53169,9248],"./ca.js":[97569,4178],"./cs.js":[30625,5123],"./cv.js":[6326,4060],"./cy.js":[49268,3166],"./da.js":[11559,4103],"./de-at.js":[12369,5954],"./de-ch.js":[71107,7168],"./de.js":[24569,300],"./dv.js":[25427,5528],"./el.js":[90524,1784],"./en-au.js":[29061,4634],"./en-ca.js":[31304,2928],"./en-gb.js":[84252,627],"./en-ie.js":[48757,2730],"./en-il.js":[98038,9],"./en-in.js":[7282,6644],"./en-nz.js":[97960,485],"./en-sg.js":[435,3949],"./en-tt.js":[90954,5818],"./en.js":[22039,427],"./eo.js":[39399,3923],"./es-do.js":[47688,4026],"./es-mx.js":[81773,2972],"./es-pr.js":[66106,5624],"./es-us.js":[18541,187],"./es.js":[23607,172],"./et.js":[29776,9040],"./eu.js":[20166,6960],"./fa.js":[28288,6633],"./fi.js":[88189,5928],"./fo.js":[49697,9627],"./fr-ca.js":[15296,7007],"./fr-ch.js":[53415,7063],"./fr.js":[4938,3674],"./fy.js":[7811,8733],"./ga.js":[3368,6020],"./gd.js":[53560,3017],"./gl.js":[85222,4466],"./gom-latn.js":[38546,6099],"./gu.js":[78309,6993],"./he.js":[41436,9706],"./hi.js":[463,7409],"./hr.js":[27147,3793],"./ht.js":[95139,3104],"./hu.js":[18224,6994],"./hy-am.js":[25976,365],"./id.js":[74970,2698],"./is.js":[799,1087],"./it-ch.js":[6071,8302],"./it.js":[97727,8744],"./ja.js":[78117,9418],"./jv.js":[22281,3496],"./ka.js":[87931,3099],"./kk.js":[52334,1494],"./km.js":[35155,6169],"./kn.js":[72879,9701],"./ko.js":[62905,5929],"./ku.js":[34078,8555],"./ky.js":[24026,2819],"./lb.js":[62619,8124],"./lo.js":[29979,1462],"./lt.js":[75887,6903],"./lv.js":[35493,2437],"./me.js":[50532,4518],"./mi.js":[73059,3883],"./mk.js":[17450,3512],"./ml.js":[66422,8996],"./mn.js":[16428,8753],"./mr.js":[35778,3294],"./ms-my.js":[40583,2593],"./ms.js":[33650,6881],"./mt.js":[6045,4863],"./my.js":[74361,3741],"./nb.js":[10697,3148],"./ne.js":[16608,3868],"./nl-be.js":[11377,7953],"./nl.js":[6987,9724],"./nn.js":[8758,9663],"./oc-lnc.js":[68064,9495],"./pa-in.js":[16767,838],"./pl.js":[28012,8705],"./pt-br.js":[19978,3639],"./pt.js":[51357,7479],"./ro.js":[71948,3905],"./ru.js":[3381,8700],"./rw.js":[79914,3128],"./sd.js":[90126,7087],"./se.js":[46319,8723],"./si.js":[99008,9797],"./sk.js":[84600,6512],"./sl.js":[64955,3951],"./sq.js":[74716,3392],"./sr-cyrl.js":[55854,1532],"./sr.js":[23534,1907],"./ss.js":[19239,7003],"./sv-fi.js":[57972,9047],"./sv.js":[43032,8919],"./sw.js":[60125,4176],"./ta.js":[1565,9872],"./te.js":[92516,5825],"./tet.js":[26712,4984],"./tg.js":[39351,4653],"./th.js":[89225,5389],"./tk.js":[48485,2355],"./tl-ph.js":[17517,2343],"./tlh.js":[35984,3508],"./tr.js":[33092,2661],"./tzl.js":[69109,6199],"./tzm-latn.js":[13637,6782],"./tzm.js":[38063,1785],"./ug-cn.js":[98490,8256],"./uk.js":[65589,6190],"./ur.js":[85859,3199],"./uz-latn.js":[96588,3290],"./uz.js":[45589,9238],"./vi.js":[41191,357],"./x-pseudo.js":[59018,6858],"./yo.js":[14163,8898],"./zh-cn.js":[9073,5352],"./zh-hk.js":[74828,8638],"./zh-tw.js":[78141,4101],"./zh.js":[42882,5235]};function M(I){if(!S.o(K,I))return Promise.resolve().then(()=>{var x=new Error("Cannot find module '"+I+"'");throw x.code="MODULE_NOT_FOUND",x});var O=K[I],W=O[0];return S.e(O[1]).then(()=>S.t(W,23))}B(M,"webpackAsyncContext"),M.keys=()=>Object.keys(K),M.id=73637,me.exports=M},39706:(me,te,S)=>{var K={"./chat-borders-3d-inset.scss":84366,"./chat-borders-3d.scss":7757,"./chat-borders-wide.scss":7411,"./chat-borders.scss":52157,"./chat-font.scss":37602,"./chat-rows.scss":87338,"./emote-alignment-baseline.scss":4803,"./emote-alignment-padded.scss":22558,"./full-width.scss":241,"./global-font.scss":79001,"./player-ext-mouse.scss":61425,"./player-fade-paused.scss":5108,"./player-hide-mouse.scss":38374,"./player-volume.scss":7655,"./square-avatars.scss":17789};function M(O){return I(O).then(S)}B(M,"webpackAsyncContext");function I(O){return S.e(8089).then(()=>{if(!S.o(K,O)){var W=new Error("Cannot find module '"+O+"'");throw W.code="MODULE_NOT_FOUND",W}return K[O]})}B(I,"webpackAsyncContextResolve"),M.keys=()=>Object.keys(K),M.resolve=I,M.id=39706,me.exports=M},41152:(me,te,S)=>{var K={"./bits_button.js":24531,"./bttv_compat.js":11746,"./channel.jsx":74756,"./chat/index.js":6172,"./compat_emote_menu.js":6325,"./css_tweaks/index.js":17103,"./dashboard.js":95778,"./directory/index.jsx":96432,"./layout.js":68318,"./loadable.tsx":34923,"./menu_button.jsx":29333,"./mod-view.jsx":94296,"./player.jsx":63155,"./sub_button.tsx":70052,"./theme/index.js":24020,"./video_chat/index.jsx":4948};function M(O){var W=I(O);return S(W)}B(M,"webpackContext");function I(O){if(!S.o(K,O)){var W=new Error("Cannot find module '"+O+"'");throw W.code="MODULE_NOT_FOUND",W}return K[O]}B(I,"webpackContextResolve"),M.keys=B(function(){return Object.keys(K)},"webpackContextKeys"),M.resolve=I,me.exports=M,M.id=41152},77074:(me,te,S)=>{"use strict";me.exports=S.p+"experiments.json"},24290:me=>{"use strict";me.exports=ffzVue},91054:()=>{}},Pi={};function X(me){var te=Pi[me];if(te!==void 0)return te.exports;var S=Pi[me]={exports:{}};return Mi[me].call(S.exports,S,S.exports,X),S.exports}B(X,"__webpack_require__"),X.m=Mi,X.n=me=>{var te=me&&me.__esModule?()=>me.default:()=>me;return X.d(te,{a:te}),te},(()=>{var me=Object.getPrototypeOf?S=>Object.getPrototypeOf(S):S=>S.__proto__,te;X.t=function(S,K){if(K&1&&(S=this(S)),K&8||typeof S=="object"&&S&&(K&4&&S.__esModule||K&16&&typeof S.then=="function"))return S;var M=Object.create(null);X.r(M);var I={};te=te||[null,me({}),me([]),me(me)];for(var O=K&2&&S;typeof O=="object"&&!~te.indexOf(O);O=me(O))Object.getOwnPropertyNames(O).forEach(W=>I[W]=()=>S[W]);return I.default=()=>S,X.d(M,I),M}})(),X.d=(me,te)=>{for(var S in te)X.o(te,S)&&!X.o(me,S)&&Object.defineProperty(me,S,{enumerable:!0,get:te[S]})},X.f={},X.e=me=>Promise.all(Object.keys(X.f).reduce((te,S)=>(X.f[S](me,te),te),[])),X.u=me=>""+({9:"i18n-33",172:"i18n-44",187:"i18n-43",204:"menu-md4",208:"rich_tokens",300:"i18n-26",357:"i18n-134",365:"i18n-64",427:"i18n-38",485:"i18n-35",627:"i18n-31",789:"i18n-3",838:"i18n-98",909:"i18n-6",935:"zip",1081:"i18n-0",1087:"i18n-66",1462:"i18n-79",1494:"i18n-72",1532:"i18n-111",1722:"i18n-5",1784:"i18n-28",1785:"i18n-128",1871:"translation-ui",1907:"i18n-112",2009:"markdown",2086:"main-menu",2244:"i18n-11",2343:"i18n-123",2348:"chat",2355:"i18n-122",2437:"i18n-81",2593:"i18n-88",2597:"site-css-tweaks",2661:"i18n-125",2698:"i18n-65",2730:"i18n-32",2819:"i18n-77",2928:"i18n-30",2972:"i18n-41",3017:"i18n-55",3030:"i18n-9",3099:"i18n-71",3104:"i18n-62",3128:"i18n-104",3134:"i18n-16",3148:"i18n-92",3166:"i18n-22",3199:"i18n-131",3224:"queries",3290:"i18n-132",3294:"i18n-87",3392:"i18n-110",3496:"i18n-70",3508:"i18n-124",3512:"i18n-84",3639:"i18n-100",3674:"i18n-52",3741:"i18n-91",3793:"i18n-61",3868:"i18n-93",3883:"i18n-83",3905:"i18n-102",3923:"i18n-39",3949:"i18n-36",3951:"i18n-109",3968:"i18n-17",4026:"i18n-40",4060:"i18n-21",4101:"i18n-139",4103:"i18n-23",4164:"menu-md1",4176:"i18n-116",4178:"i18n-19",4466:"i18n-56",4518:"i18n-82",4634:"i18n-29",4653:"i18n-120",4667:"i18n-15",4863:"i18n-90",4984:"i18n-119",5012:"i18n-7",5123:"i18n-20",5151:"i18n-4",5215:"i18n-2",5235:"i18n-140",5352:"i18n-137",5380:"i18n-1",5389:"i18n-121",5528:"i18n-27",5624:"i18n-42",5818:"i18n-37",5825:"i18n-118",5928:"i18n-48",5929:"i18n-75",5954:"i18n-24",6020:"i18n-54",6099:"i18n-57",6115:"emote-cards",6169:"i18n-73",6190:"i18n-130",6199:"i18n-126",6512:"i18n-108",6530:"regex",6633:"i18n-47",6644:"i18n-34",6757:"i18n-12",6782:"i18n-127",6858:"i18n-135",6881:"i18n-89",6903:"i18n-80",6960:"i18n-46",6993:"i18n-58",6994:"i18n-63",7003:"i18n-113",7007:"i18n-50",7063:"i18n-51",7087:"i18n-105",7168:"i18n-25",7409:"i18n-60",7479:"i18n-101",7485:"vue",7629:"menu-md0",7953:"i18n-94",8111:"i18n-13",8124:"i18n-78",8163:"menu-md5",8256:"i18n-129",8302:"i18n-67",8555:"i18n-76",8586:"overrides",8638:"i18n-138",8700:"i18n-103",8705:"i18n-99",8723:"i18n-106",8733:"i18n-53",8736:"i18n-10",8744:"i18n-68",8753:"i18n-86",8757:"i18n-8",8898:"i18n-136",8919:"i18n-115",8996:"i18n-85",9040:"i18n-45",9047:"i18n-114",9082:"i18n-14",9238:"i18n-133",9248:"i18n-18",9418:"i18n-69",9442:"vue-chat",9495:"i18n-97",9627:"i18n-49",9663:"i18n-96",9701:"i18n-74",9706:"i18n-59",9724:"i18n-95",9797:"i18n-107",9872:"i18n-117"}[me]||me)+".js",X.h=()=>"965cd6a229543443152b",X.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),X.o=(me,te)=>Object.prototype.hasOwnProperty.call(me,te),(()=>{var me={},te="frankerfacez:";X.l=(S,K,M,I)=>{if(me[S]){me[S].push(K);return}var O,W;if(M!==void 0)for(var x=document.getElementsByTagName("script"),p=0;p<x.length;p++){var _=x[p];if(_.getAttribute("src")==S||_.getAttribute("data-webpack")==te+M){O=_;break}}O||(W=!0,O=document.createElement("script"),O.charset="utf-8",O.timeout=120,X.nc&&O.setAttribute("nonce",X.nc),O.setAttribute("data-webpack",te+M),O.src=S,O.src.indexOf(window.location.origin+"/")!==0&&(O.crossOrigin="anonymous")),me[S]=[K];var l=B((f,r)=>{O.onerror=O.onload=null,clearTimeout(d);var b=me[S];if(delete me[S],O.parentNode&&O.parentNode.removeChild(O),b&&b.forEach(u=>u(r)),f)return f(r)},"onScriptComplete"),d=setTimeout(l.bind(null,void 0,{type:"timeout",target:O}),12e4);O.onerror=l.bind(null,O.onerror),O.onload=l.bind(null,O.onload),W&&document.head.appendChild(O)}})(),X.r=me=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(me,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(me,"__esModule",{value:!0})},X.j=8102,(()=>{var me;X.g.importScripts&&(me=X.g.location+"");var te=X.g.document;if(!me&&te&&(te.currentScript&&(me=te.currentScript.src),!me)){var S=te.getElementsByTagName("script");if(S.length)for(var K=S.length-1;K>-1&&!me;)me=S[K--].src}if(!me)throw new Error("Automatic publicPath is not supported in this browser");me=me.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),X.p=me})(),(()=>{var me={8102:0,2682:0};X.f.j=(K,M)=>{var I=X.o(me,K)?me[K]:void 0;if(I!==0)if(I)M.push(I[2]);else{var O=new Promise((_,l)=>I=me[K]=[_,l]);M.push(I[2]=O);var W=X.p+X.u(K),x=new Error,p=B(_=>{if(X.o(me,K)&&(I=me[K],I!==0&&(me[K]=void 0),I)){var l=_&&(_.type==="load"?"missing":_.type),d=_&&_.target&&_.target.src;x.message="Loading chunk "+K+` failed.
(`+l+": "+d+")",x.name="ChunkLoadError",x.type=l,x.request=d,I[1](x)}},"loadingEnded");X.l(W,p,"chunk-"+K,K)}};var te=B((K,M)=>{var[I,O,W]=M,x,p,_=0;if(I.some(d=>me[d]!==0)){for(x in O)X.o(O,x)&&(X.m[x]=O[x]);if(W)var l=W(X)}for(K&&K(M);_<I.length;_++)p=I[_],X.o(me,p)&&me[p]&&me[p][0](),me[p]=0},"webpackJsonpCallback"),S=globalThis.ffzWebpackJsonp=globalThis.ffzWebpackJsonp||[];S.forEach(te.bind(null,0)),S.push=te.bind(null,S.push.bind(S))})();var fr={};(()=>{var wi,ki;"use strict";var me={};X.r(me),X.d(me,{to_float:()=>G,to_int:()=>Z});var te={};X.r(te),X.d(te,{process_to_float:()=>ce,process_to_int:()=>se});var S={};X.r(S),X.d(S,{AddonDebug:()=>Ke,And:()=>ae,Category:()=>Wt,Channel:()=>Ht,Constant:()=>we,Debug:()=>Ye,Fullscreen:()=>Le,If:()=>ne,Invert:()=>ie,Moderator:()=>Ge,Monitor:()=>ue,NativeDarkTheme:()=>wt,Or:()=>xe,Page:()=>zt,SquadMode:()=>ht,TheaterMode:()=>Pe,Time:()=>Me,Title:()=>_e});var K={};X.r(K),X.d(K,{Everything:()=>Se,Experiments:()=>H,FavoriteEmotes:()=>U,HiddenEmotes:()=>j,Overrides:()=>ee,Profiles:()=>he});var M={};X.r(M),X.d(M,{AddonEmotes:()=>kn,AutomoddedTerms:()=>vn,BadgeStuff:()=>_n,BlockedTerms:()=>yn,BlockedUsers:()=>mn,CheerEmotes:()=>wn,CustomHighlights:()=>bn,Emoji:()=>Sn,FilterTester:()=>hn,Links:()=>es,Mentions:()=>fn,Replies:()=>un,TwitchEmotes:()=>Cn,UserHighlights:()=>pn});var I={};X.r(I),X.d(I,{Links:()=>xn});var O={};X.r(O),X.d(O,{Clip:()=>Rn,User:()=>$n,Video:()=>On});var W={};X.r(W),X.d(W,{ban:()=>Gn,chat:()=>Hn,copy_message:()=>jn,edit_overrides:()=>Nn,mod:()=>qn,msg_delete:()=>Wn,open_url:()=>Un,pin:()=>In,reply:()=>Ln,timeout:()=>Vn,toggle_profile:()=>Jn,unban:()=>Zn,unmod:()=>Yn,untimeout:()=>Kn,whisper:()=>Xn});var x={};X.r(x),X.d(x,{combo:()=>sr,dynamic:()=>Qn,emote:()=>tr,icon:()=>ir,image:()=>nr,text:()=>er});var p=X(51722),_=X.n(p),l=X(55467),d=X(22527),f=X(24431),r=X(46949),b=X(20857),u=X(81011),v=X(17159);const A=Symbol("default"),F={basic:{get(k,e){for(const i of e)if(i.has(k))return[i.get(k),[i.id]]}},object_merge:{get(k,e,i,s){const n=[],o=[];for(const h of e)if(h.has(k)){const g=h.get(k);if(!g||typeof g!="object"){s.warn(`Profile #${h.id} has an invalid value for "${k}" of type ${typeof g}. Skipping.`);continue}o.push(h.id),n.unshift(g)}if(o.length)return[Object.assign({},...n),o]}},basic_array_merge:{get(k,e,i,s){const n=[],o=[];for(const h of e)if(h.has(k)){const g=h.get(k);if(!Array.isArray(g)){s.warn(`Profile #${h.id} has an invalid value for "${k}"`);continue}o.push(h.id);for(const E of g)n.push(E)}if(o.length)return[n,o]}},array_merge:{default(k){const e=[];for(const i of k)i.t!=="inherit"&&i.t!=="skip"&&i.v&&e.push(i.v);return e},get(k,e,i,s,n){const o=[],h=[];let g=[],E=!1,R=e;i.inherit_default&&(R=[...e,A]);for(const T of R){let L;if(T===A)L=i.default,typeof L=="function"&&(L=L(n));else if(T.has(k))L=T.get(k);else continue;if(!Array.isArray(L)){T!==A&&s.warn(`Profile #${T.id} has an invalid value for "${k}" of type ${typeof L}. Skipping.`);continue}const q=[];T!==A&&h.push(T.id);let le=!1;for(const pe of L)if(E=!0,pe.t==="inherit")le=!0;else{if(pe.t==="skip")continue;le?q.push(pe.v):o.push(pe.v)}if(g=q.concat(g),!le&&!i.always_inherit)break}if(E)return[o.concat(g),h]}}};function D(k,e,i){if(!k||!Array.isArray(k.requires))return!1;for(const s of k.requires){const n=i.get(s),o=e.get(s);if(typeof n!=typeof o)return!0;if(Array.isArray(n)&&Array.isArray(o)){if(!(0,r.array_equals)(o,n))return!0}else if(o instanceof Set&&n instanceof Set){if(!(0,r.set_equals)(o,n))return!0}else if(o instanceof Map&&n instanceof Map){if(!(0,r.map_equals)(o,n))return!0}else if(o!==n)return!0}return!1}B(D,"compare_requirements");const Ai=class Ai extends v.EventEmitter{constructor(e,i){super(),this.__context=null,e instanceof Ai?(this.parent=e,this.manager=e.manager,this.parent.on("context_changed",this._rebuildContext,this)):(this.parent=null,this.manager=e),this.manager.__contexts.push(this),this._context=i||{},this.__ls_listening=!1,this.__ls_wanted=new Map,this.__cache=new Map,this.__meta=new Map,this.__profiles=[],this.order=[],this._rebuildContext()}destroy(){this.parent&&this.parent.off("context_changed",this._rebuildContext,this);for(const s of this.__profiles)s.off("changed",this._onChanged,this);const e=this.manager.__contexts,i=e.indexOf(this);i!==-1&&e.splice(i,1)}_watchLS(){this.__ls_listening||(this.__ls_listening=!0,this.manager.on(":ls-update",this._onLSUpdate,this))}_unwatchLS(){this.__ls_listening&&(this.__ls_listening=!1,this.manager.off(":ls-update",this._onLSUpdate,this))}_onLSUpdate(e){const i=this.__ls_wanted.get(`ls.${e}`);if(i)for(const s of i)this._update(s,s,[])}_rebuildContext(){this.__context=this.parent?Object.assign({},this.parent.__context||this.parent._context,this._context):this._context,this.selectProfiles()||this.rebuildCache(),this.emit("context_changed")}selectProfiles(){const e=[],i=this.order=[];if(!this.manager.disable_profiles)for(const n of this.manager.__profiles)n.toggled&&n.matches(this.__context)&&(e.push(n),i.push(n.id));if((0,r.array_equals)(this.__profiles,e))return!1;const s=new Set;for(const n of this.__profiles)e.includes(n)||(n.off("changed",this._onChanged,this),s.add(n.id));for(const n of e)this.__profiles.includes(n)||(n.on("changed",this._onChanged,this),s.add(n.id));return this.__profiles=e,this.emit("profiles_changed"),this.rebuildCache(),!0}rebuildCache(){const e=this.__cache,i=this.__meta,s=this.__meta=new Map;this.__cache=new Map;for(const[n,o]of e){const h=this.get(n),g=s.get(n),E=i.get(n),R=g?g.uses:null,T=E?E.uses:null,L=this.manager.definitions.get(n);let q=!1;!Array.isArray(L)&&L?.equals?L.equals==="requirements"?q=D(L,this.__cache,e):typeof L.equals=="function"&&(q=!L.equals(h,o,this.__cache,e)):Array.isArray(h)&&Array.isArray(o)?q=!(0,r.array_equals)(h,o):h instanceof Set&&o instanceof Set?q=!(0,r.set_equals)(h,o):h instanceof Map&&o instanceof Map?q=!(0,r.map_equals)(h,o):h!==o&&(q=!0),q&&(this.emit("changed",n,h,o),this.emit(`changed:${n}`,h,o)),(0,r.array_equals)(R,T)||(this.emit("uses_changed",n,R,T),this.emit(`uses_changed:${n}`,R,T))}}context(e){return new Ai(this,e)}updateContext(e){let i=!1;for(const s in e)if((0,r.has)(e,s)){const n=e[s];try{if((0,r.deep_equals)(n,this._context[s]))continue}catch{}this._context[s]=n,i=!0}i&&this._rebuildContext()}setContext(e){this._context={},this.updateContext(e)}_onChanged(e){this._update(e,e,[])}_update(e,i,s){if(this.__cache.has(e)){if(s.includes(e))throw new Error(`cyclic dependent chain when updating setting "${i}"`)}else return;s.push(e);const n=this.__cache.get(e),o=this.__meta.get(e),h=this._get(e,e,[]),g=this.__meta.get(e),E=o?o.uses:null,R=g?g.uses:null;if((0,r.array_equals)(R,E)||(this.emit("uses_changed",e,R,E),this.emit(`uses_changed:${e}`,R,E)),n===h)return;this.emit("changed",e,h,n),this.emit(`changed:${e}`,h,n);const T=this.manager.definitions.get(e);if(!Array.isArray(T)&&T?.required_by)for(const L of T.required_by)!L.startsWith("context.")&&!L.startsWith("ls.")&&this._update(L,i,Array.from(s))}_get(e,i,s){if(s.includes(e))throw new Error(`cyclic dependency when resolving setting "${i}"`);s.push(e);const n=this.manager.definitions.get(e),o=!Array.isArray(n)&&n?.type,h=o?F[o]:F.basic;if(!h)throw new Error(`non-existent setting type "${o}"`);const g=this._getRaw(e,h),E={uses:g?g[1]:null};let R=g?g[0]:void 0;if(n){if(Array.isArray(n))throw new Error(`non-existent setting "${e}" required when resolving setting "${i}"`);if(E.uses===null){const T=n.default;typeof T=="function"?R=T(this):R=T,h.default&&(R=h.default(R,n,this.manager.log))}if(n.requires)for(const T of n.requires)if(T.startsWith("ls.")){this._watchLS();let L=this.__ls_wanted.get(T);L||this.__ls_wanted.set(T,L=new Set),L.add(e)}else!T.startsWith("context.")&&!this.__cache.has(T)&&this._get(T,i,Array.from(s));n.process&&(R=n.process(this,R,E))}return this.__cache.set(e,R),this.__meta.set(e,E),R}*profiles(){for(const e of this.__profiles)yield e}hasProfile(e){if(typeof e=="number"){for(const i of this.__profiles)if(i.id===e)return!0;return!1}return this.__profiles.includes(e)}_getRaw(e,i){if(!i)throw new Error(`non-existent type for ${e}`);return i.get(e,this.profiles(),this.manager.definitions.get(e),this.manager.log,this)}update(e){this._update(e,e,[])}get(e){return e.startsWith("ls.")?this.manager.getLS(e.slice(3)):e.startsWith("context.")?(0,r.get)(e.slice(8),this.__context):this.__cache.has(e)?this.__cache.get(e):this._get(e,e,[])}getChanges(e,i,s){this.onChange(e,i,s),i.call(s,this.get(e),void 0)}onChange(e,i,s){this.on(`changed:${e}`,i,s)}uses(e){return e.startsWith("ls.")||e.startsWith("context.")?null:(this.__meta.has(e)||this._get(e,e,[]),this.__meta.get(e)?.uses??null)}};B(Ai,"SettingsContext");let z=Ai;const $=Symbol("BAD");function J(k,e,i){if((typeof k!="number"||isNaN(k)||!isFinite(k))&&(k=$),k!==$){const s=i.bounds;Array.isArray(s)&&(s.length>=3?((s[1]?k<s[0]:k<=s[0])||(s[3]?k>s[2]:k>=s[2]))&&(k=$):s.length===2?typeof s[1]=="boolean"?(s[1]?k<s[0]:k<=s[0])&&(k=$):(k<s[0]||k>s[1])&&(k=$):s.length===1&&k<s[0]&&(k=$))}return k===$?e:k}B(J,"do_number");const Z=B((k,e,i)=>(typeof k=="string"&&/^-?\d+$/.test(k)?k=parseInt(k,10):typeof k!="number"&&(k=$),J(k,e,i)),"to_int"),G=B((k,e,i)=>(typeof k=="string"&&/^-?[\d.]+$/.test(k)?k=parseFloat(k):typeof k!="number"&&(k=$),J(k,e,i)),"to_float");function Q(k,e){if(typeof k!="number"||isNaN(k)||!isFinite(k))return!1;const i=e.bounds;if(Array.isArray(i)){if(i.length>=3){if((i[1]?k<i[0]:k<=i[0])||(i[3]?k>i[2]:k>=i[2]))return!1}else if(i.length===2){if(typeof i[1]=="boolean"){if(i[1]?k<i[0]:k<=i[0])return!1}else if(k<i[0]||k>i[1])return!1}else if(i.length===1&&k<i[0])return!1}return!0}B(Q,"validators_do_number");const se=B((k,e)=>{if(typeof k=="string"&&/^-?\d+$/.test(k))k=parseInt(k,10);else if(typeof k!="number")return!1;return Q(k,e)},"process_to_int"),ce=B((k,e)=>{if(typeof k=="string"&&/^-?[\d.]+$/.test(k))k=parseFloat(k);else if(typeof k!="number")return!1;return Q(k,e)},"process_to_float");var be=X(37087);let ve=null;function Re(k){X.e(6530).then(X.t.bind(X,28820,23)).then(e=>{ve=e.default,k&&k()})}B(Re,"loadSafety");const oe=B(()=>!1,"NeverMatch"),ie={createTest(k,e,i){return(0,be.createTester)(k,e,!0,!1,i)},maxRules:1,childRules:!0,tall:!0,title:"Invert",i18n:"settings.filter.invert",default:()=>[],editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,9786))},ae={createTest(k,e,i){return(0,be.createTester)(k,e,!1,!1,i)},childRules:!0,tall:!0,title:"And",i18n:"settings.filter.and",default:()=>[],editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,9786))},xe={createTest(k,e,i){return(0,be.createTester)(k,e,!1,!0,i)},childRules:!0,tall:!0,title:"Or",i18n:"settings.filter.or",default:()=>[],editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,9786))},ne={createTest(k,e,i){const s=(0,be.createTester)(k[0],e,!1,!1,i),n=(0,be.createTester)(k[1],e,!1,!1,i),o=(0,be.createTester)(k[2],e,!1,!1,i);return h=>s(h)?n(h):o(h)},childRules:!0,tall:!0,title:"If",i18n:"settings.filter.if",default:()=>[[],[],[]],editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,17907))},we={createTest(k){return k?()=>!0:oe},title:"True or False",i18n:"settings.filter.true_false",default:!0,editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,47178))};function ze(k){if(typeof k!="string"||!k.length)return null;const e=k.indexOf(":");if(e===-1)return null;let i,s;try{i=parseInt(k.slice(0,e),10),s=parseInt(k.slice(e+1),10)}catch{return null}return i*60+s}B(ze,"parseTime");const Me={_captured:new Set,createTest(k){const e=ze(k[0]),i=ze(k[1]);return e==null||i==null?oe:e<=i?()=>{Me._captured.add(e),Me._captured.add(i+1);const s=new Date,n=s.getHours()*60+s.getMinutes();return n>=e&&n<=i}:()=>{Me._captured.add(e+1),Me._captured.add(i);const s=new Date,n=s.getHours()*60+s.getMinutes();return n>=e||n<=i}},captured:()=>{const k=Array.from(Me._captured);return Me._captured=new Set,k.sort((e,i)=>e-i),k},title:"Time of Day",i18n:"settings.filter.time",default:()=>["08:00","18:00"],editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,64e3))},Pe={createTest(k){return e=>e.fullscreen?k===!1:e.ui?.theatreModeEnabled===k},title:"Theater Mode",i18n:"settings.filter.theater",default:!0,editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,47178))},Le={createTest(k){return e=>e.fullscreen===k},title:"Fullscreen",i18n:"settings.filter.fullscreen",default:!0,editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,47178))},Ge={createTest(k){return e=>e.moderator===k},title:"Is Moderator",i18n:"settings.filter.moderator",default:!0,editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,47178))},Ye={createTest(k){return()=>f.DEBUG===k},title:"Is Developer Mode",i18n:"settings.filter.dev",default:!0,editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,47178))},Ke={createTest(k){return e=>e.addonDev==k},title:"Is Addon Developer Mode",i18n:"settings.filter.addon-dev",default:!0,editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,47178))},ht={createTest(k){return e=>e.ui?.squadModeEnabled===k},title:"Squad Mode",i18n:"settings.filter.squad",default:!0,editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,47178))},wt={createTest(k){const e=k?1:0;return i=>i.ui?.theme===e},title:"Dark Theme",i18n:"settings.filter.native-dark",default:!0,editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,47178))},zt={createTest(k){if(!k)return oe;const e=k.route,i=[];if(Object.keys(k.values).length){const s=window.FrankerFaceZ?.get(),n=s&&s.resolve("site.router");if(!n)return oe;const o=n.getRoute(e);if(!o||!o.parts)return oe;let h=1;for(const g of o.parts)if(typeof g=="object"){const E=k.values[g.name];E&&E.length&&i.push([h,E.toLowerCase()]),h++}}return s=>{if(!s.route||!s.route_data||s.route.name!==e)return!1;for(const[n,o]of i){let h=s.route_data[n];if(typeof h=="string"&&(h=h.toLowerCase()),h!==o)return!1}return!0}},tall:!0,title:"Current Page",i18n:"settings.filter.page",default:()=>({route:"front-page",values:{}}),editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,38961))},Ht={createTest(k){const e=k?.login,i=k?.id;if(!i&&!e)return oe;if(i){if(!e)return s=>s.channelID===i}else return s=>s.channel===e;return s=>s.channelID===i||s.channelID==null&&s.channel===e},title:"Current Channel",i18n:"settings.filter.channel",default:()=>({login:null,id:null}),editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,69370))},Wt={createTest(k){const e=k?.name,i=k?.id;if(!i&&!e)return oe;if(i){if(!e)return s=>s.categoryID===i}else return s=>s.category===e;return s=>s.categoryID===i||s.categoryID==null&&s.category===e},title:"Current Category",i18n:"settings.filter.category",default:()=>({name:null,id:null}),editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,94344))},_e={createTest(k,e,i){const s=k?.mode;let n=k?.title,o=!0;if(!n||!s)return oe;if(s==="text")n=(0,r.escape_regex)(n),o=!1;else if(s==="glob")n=(0,r.glob_to_regex)(n);else if(s!=="raw")return oe;if(o&&(ve||Re(i),!ve||!ve(n)))return oe;let h;try{h=new RegExp(n,`g${k.sensitive?"":"i"}`)}catch{return oe}return g=>(h.lastIndex=0,g.title?h.test(g.title):!1)},title:"Current Title",i18n:"settings.filter.title",default:()=>({title:"",mode:"text",sensitive:!1}),editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,43922))};let ue=null;window.getScreenDetails&&(ue={_used:!1,details:void 0,used:()=>{const k=ue._used;return ue._used=!1,k},createTest(k,e,i){if(!k?.label)return oe;if(ue._used=!0,i&&ue.details===void 0){const s=window.FrankerFaceZ??window.FFZBridge,n=s?.get(),o=n?.resolve("settings");o&&o.createMonitorUpdate().then(()=>{i()})}return()=>{ue._used=!0;const s=ue.details;if(!s)return!1;const n=s.screens;return(0,r.matchScreen)(n,k)===s.currentScreen}},default:()=>({label:null}),title:"Current Monitor",i18n:"settings.filter.monitor",editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,57049))});var Ee=X(38626);const $e=1,He=window.location.host!=="www.twitch.tv",Ze=window.location.host!=="www.youtube.com",os=class os extends v.EventEmitter{constructor(e){super(),this.ready=!1,this.manager=e,this.disabled=!1}static supported(){return!1}awaitReady(){return this.ready?Promise.resolve():Promise.reject(new Error("Not Implemented"))}get allowTransfer(){return this.constructor.allowTransfer}get shouldUpdate(){return this.constructor.shouldUpdate}};B(os,"SettingsProvider");let qe=os;qe.priority=0,qe.allowTransfer=!0,qe.shouldUpdate=!0;const as=class as extends qe{get supportsBlobs(){return!0}isValidBlob(e){return this.supportsBlobs&&(0,Ee.isValidBlob)(e)}};B(as,"AdvancedSettingsProvider");let it=as;const ls=class ls extends it{constructor(e){super(e),this._start_time=performance.now(),this._rpc=new Map,this._cached=new Map,this.resolved_ready=!1,this.ready=!1,this._ready_wait=null,this._blobs=null,this._last_id=0}get supportsBlobs(){return this._blobs??!1}broadcastTransfer(){}disableEvents(){}resolveReady(e,i){this.manager&&this.manager.log.info(`${this.constructor.name} ready in ${(performance.now()-this._start_time).toFixed(5)}ms`),this.resolved_ready=!0,this.ready=e,e&&this._ready_wait_resolve?this._ready_wait_resolve():!e&&this._ready_wait_fail&&this._ready_wait_fail(i)}awaitReady(){return this.resolved_ready?this.ready?Promise.resolve():Promise.reject():this._ready_wait?this._ready_wait:this._ready_wait=new Promise((e,i)=>{this._ready_wait_resolve=e,this._ready_wait_fail=i}).finally(()=>{this._ready_wait=null,this._ready_wait_resolve=null,this._ready_wait_fail=null})}get(e,i){return this._cached.has(e)?this._cached.get(e):i}set(e,i){if(i===void 0){this.has(e)&&this.delete(e);return}this._cached.set(e,i),this.rpc({ffz_type:"set",key:e,value:i}).catch(s=>this.manager.log.error("Error setting value",s)),this.emit("set",e,i,!1)}delete(e){this._cached.delete(e),this.rpc({ffz_type:"delete",key:e}).catch(i=>this.manager.log.error("Error deleting value",i)),this.emit("set",e,void 0,!0)}clear(){const e=this._cached;this._cached=new Map;for(const i of e.keys())this.emit("changed",i,void 0,!0);this.rpc("clear").catch(i=>this.manager.log.error("Error clearing storage",i))}has(e){return this._cached.has(e)}keys(){return this._cached.keys()}entries(){return this._cached.entries()}get size(){return this._cached.size}async flush(){await this.rpc("flush")}async getBlob(e){const i=await this.rpc({ffz_type:"get-blob",key:e});return i?(0,Ee.deserializeBlob)(i):null}async setBlob(e,i){await this.rpc({ffz_type:"set-blob",key:e,value:await(0,Ee.serializeBlob)(i)})}async deleteBlob(e){await this.rpc({ffz_type:"delete-blob",key:e})}async hasBlob(e){return this.rpc({ffz_type:"has-blob",key:e})}async clearBlobs(){await this.rpc("clear-blobs")}async blobKeys(){return this.rpc("blob-keys")}rpc(e,i){const s=++this._last_id;return new Promise((n,o)=>{this._rpc.set(s,[n,o]);let h;typeof e=="string"?h={ffz_type:e}:h=e,h.id=s,this.send(h,i)})}handleMessage(e){e.ffz_type==="ready"?this.rpc("init-load").then(i=>{this._blobs=i.blobs;for(const[s,n]of Object.entries(i.values))this._cached.set(s,n);this.resolveReady(!0)}).catch(i=>{this.resolveReady(!1,i)}):e.ffz_type==="change"?this.onChange(e):e.ffz_type==="change-blob"?this.emit("changed-blob",e.key,e.deleted):e.ffz_type==="clear-blobs"?this.emit("clear-blobs"):e.ffz_type==="reply"||e.ffz_type==="reply-error"?this.onReply(e):this.manager.log.warn("Unknown Message",e.ffz_type,e)}onChange(e){const i=e.key,s=e.value;e.deleted?(this._cached.delete(i),this.emit("changed",i,void 0,!0)):(this._cached.set(i,s),this.emit("changed",i,s,!1))}onReply(e){const i=e.id,s=e.ffz_type==="reply",n=this._rpc.get(i);if(!n)return this.manager.log.warn("Received reply for unknown ID",i);this._rpc.delete(i),s?n[0](e.reply):n[1]()}};B(ls,"RemoteSettingsProvider");let xt=ls;const cs=class cs extends qe{constructor(e,i){super(e),this.prefix=i=i??"FFZ:setting:";const s=this._cached=new Map,n=i.length;for(const o in localStorage)if((0,r.has)(localStorage,o)&&o.startsWith(i)){const h=localStorage.getItem(o);if(h)try{s.set(o.slice(n),JSON.parse(h))}catch{this.manager.log.warn(`unable to parse value for ${o}`,h)}}this.ready=!0,window.BroadcastChannel?(this._broadcaster=new BroadcastChannel("ffz-settings")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this)):window.addEventListener("storage",this._boundHandleStorage=this.handleStorage.bind(this))}static supported(){return!0}static hasContent(e){e||(e="FFZ:setting:");for(const i in localStorage)if(i.startsWith(e)&&(0,r.has)(localStorage,i))return!0;return!1}broadcastTransfer(){this.broadcast({type:"change-provider"})}removeListeners(){this._broadcaster&&(this._boundHandleMessage&&this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null),this._boundHandleStorage&&(window.removeEventListener("storage",this._boundHandleStorage),this._boundHandleStorage=null)}disableEvents(){this.removeListeners(),this.broadcast=()=>{},this.emit=()=>{}}destroy(){this.disable(),this._cached.clear()}disable(){this.removeListeners(),this.disabled=!0}flush(){}broadcast(e){this._broadcaster&&this._broadcaster.postMessage(e)}handleMessage(e){if(this.disabled||!e.isTrusted||!e.data)return;this.manager.log.debug("storage broadcast event",e.data);const{type:i,key:s}=e.data;if(i==="change-provider")this.manager.log.info("Received notice of changed settings provider."),this.emit("change-provider"),this.disable(),this.disableEvents();else if(i==="set"){const n=JSON.parse(localStorage.getItem(this.prefix+s)??"null");this._cached.set(s,n),this.emit("changed",s,n,!1)}else if(i==="delete")this._cached.delete(s),this.emit("changed",s,void 0,!0);else if(i==="clear"){const n=Array.from(this._cached.keys());this._cached.clear();for(const o of n)this.emit("changed",o,void 0,!0)}}handleStorage(e){if(!this.disabled&&(this.manager.log.debug("storage event",e),e.storageArea===localStorage&&e.key&&e.key.startsWith(this.prefix))){const i=e.key.slice(this.prefix.length);let s=e.newValue;s===null?(this._cached.delete(i),this.emit("changed",i,void 0,!0)):(s=JSON.parse(s),this._cached.set(i,s),this.emit("changed",i,s,!1))}}get(e,i){return this._cached.has(e)?this._cached.get(e):i}set(e,i){if(!this.disabled){if(i===void 0){this.has(e)&&this.delete(e);return}this._cached.set(e,i);try{localStorage.setItem(this.prefix+e,JSON.stringify(i))}catch(s){throw this.manager&&this.manager.log.error(`An error occurred while trying to save a value to localStorage for key "${this.prefix+e}"`),s&&/quota/i.test(s.toString())&&this.emit("quota-exceeded",s),s}this.broadcast({type:"set",key:e}),this.emit("set",e,i,!1)}}delete(e){this.disabled||(this._cached.delete(e),localStorage.removeItem(this.prefix+e),this.broadcast({type:"delete",key:e}),this.emit("set",e,void 0,!0))}has(e){return this._cached.has(e)}keys(){return this._cached.keys()}clear(){if(this.disabled)return;const e=this._cached;this._cached=new Map;for(const i of e.keys())localStorage.removeItem(this.prefix+i),this.emit("changed",i,void 0,!0);this.broadcast({type:"clear"})}entries(){return this._cached.entries()}get size(){return this._cached.size}};B(cs,"LocalStorageProvider");let Kt=cs;Kt.priority=-1e3,Kt.title="Local Storage",Kt.description="[Local Storage](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API) is available on all platforms and fast to access, but has poorly defined capacity limits and may be cleared unexpectedly. Particularly, clearing cookies and cache in your browser will likely clear Local Storage as well.";const hs=class hs extends it{constructor(e,i=!0){super(e),this._last_tx=0,this.getDB=(0,r.once)(this.getDB),this._start_time=performance.now(),this._pending=new Set,this._flush_wait=null,this._lock=new r.TicketLock,this._cached=new Map,this.ready=!1,this._ready_wait=null,i&&(window.BroadcastChannel&&(this._broadcaster=new BroadcastChannel("ffz-settings")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this)),this._ready_wait=this.loadSettings().then(()=>{this.manager&&this.manager.log.info(`IDB ready in ${(performance.now()-this._start_time).toFixed(5)}ms`),this.ready=!0}).catch(s=>{this.manager&&this.manager.log.error(`IDB failed after ${(performance.now()-this._start_time).toFixed(5)}ms:`,s),this.ready=!1}).finally(()=>{this._ready_wait=null}))}static supported(){return window.indexedDB!=null}static hasContent(){return new Promise(e=>{const i=window.indexedDB.open("FFZ",$e);i.onerror=()=>e(!1),i.onupgradeneeded=s=>{s.target instanceof IDBRequest&&s.target.transaction?.abort(),e(!1)},i.onsuccess=()=>{const s=i.result;let n;try{n=s.transaction(["settings"],"readonly").objectStore("settings")}catch{return e(!1)}const o=n.getAllKeys();o.onerror=()=>{s.close(),e(!1)},o.onsuccess=()=>{const h=Array.isArray(o.result)&&o.result.length>0;return s.close(),e(h)}}})}destroy(){this.disable(),this._cached.clear()}disable(){this.disabled=!0,this.removeListeners(),this.db&&(this.db.close(),this.db=null)}removeListeners(){this._broadcaster&&(this._boundHandleMessage&&this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null)}broadcastTransfer(){this.broadcast({type:"change-provider"})}disableEvents(){this.removeListeners(),this.broadcast=()=>{},this.emit=()=>{}}_onStart(e){this._pending||(this._pending=new Set),this._pending.add(e)}_onFinish(e){this._pending&&(this._pending.delete(e),this._pending.size)||this._flush_wait_resolve&&this._flush_wait_resolve()}flush(){return this._flush_wait?this._flush_wait:!this._pending||!this._pending.size?Promise.resolve():this._flush_wait=new Promise(e=>{this._flush_wait_resolve=e}).finally(()=>{this._flush_wait_resolve=null,this._flush_wait=null})}broadcast(e){this._broadcaster&&this._broadcaster.postMessage(e)}handleMessage(e){if(this.disabled||!e.isTrusted||!e.data)return;this.manager&&this.manager.log.debug("storage broadcast event",e.data);const{type:i,key:s}=e.data;if(i==="change-provider")this.manager.log.info("Received notice of changed settings provider."),this.emit("change-provider"),this.disable(),this.disableEvents();else if(i==="set")this._get(s).then(n=>{this._cached.set(s,n),this.emit("changed",s,n,!1)}).catch(n=>this.manager&&this.manager.log.error(`Error getting setting "${s}" from database`,n));else if(i==="delete")this._cached.delete(s),this.emit("changed",s,void 0,!0);else if(i==="clear"){const n=Array.from(this._cached.keys());this._cached.clear();for(const o of n)this.emit("changed",o,void 0,!0)}else i==="set-blob"?this.emit("changed-blob",s,!1):i==="delete-blob"?this.emit("changed-blob",s,!0):i==="clear-blobs"&&this.emit("clear-blobs")}awaitReady(){return this._ready_wait?this._ready_wait:this.ready?Promise.resolve():Promise.reject()}get(e,i){return this._cached.has(e)?this._cached.get(e):i}set(e,i){if(!this.disabled){if(i===void 0){this.has(e)&&this.delete(e);return}this._cached.set(e,i),this._set(e,i).then(()=>this.broadcast({type:"set",key:e})).catch(s=>this.manager&&this.manager.log.error(`Error saving setting "${e}" to database`,s)),this.emit("set",e,i,!1)}}delete(e){this.disabled||(this._cached.delete(e),this._delete(e).catch(i=>this.manager&&this.manager.log.error(`Error deleting setting "${e}" from database`,i)).then(()=>this.broadcast({type:"delete",key:e})),this.emit("set",e,void 0,!0))}has(e){return this._cached.has(e)}keys(){return this._cached.keys()}clear(){if(this.disabled)return;const e=this._cached;this._cached=new Map;for(const i of e.keys())this.emit("changed",i,void 0,!0);this._clear().catch(i=>this.manager&&this.manager.log.error("Error clearing database",i)).then(()=>this.broadcast({type:"clear"}))}entries(){return this._cached.entries()}get size(){return this._cached.size}getDB(e=!1){if(this.db)return Promise.resolve(this.db);if(this._db_wait)return this._db_wait;let i;return this._db_wait=i=new Promise((s,n)=>{const o=window.indexedDB.open("FFZ",$e);this._onStart(o),o.onerror=h=>{this.manager&&this.manager.log.error("Error opening database.",h),n(h),this._onFinish(o)},o.onupgradeneeded=h=>{this.manager&&this.manager.log.info(`Upgrading database from version ${h.oldVersion} to ${$e}`);const g=o.result;g.createObjectStore("settings",{keyPath:"k"}),g.createObjectStore("blobs")},o.onsuccess=()=>{this.manager&&this.manager.log.info(`Database opened. (After: ${(performance.now()-this._start_time).toFixed(5)}ms)`),this.db=o.result;try{const h=this.db.transaction(["settings","blobs"],"readonly");h.objectStore("settings"),h.objectStore("blobs")}catch(h){this.manager&&this.manager.log.error("Database in invalid state.",h);try{this.db.close()}catch{}if(this._onFinish(o),this.db=null,e)n(h);else{const g=window.indexedDB.deleteDatabase("FFZ");this._onStart(g),g.onerror=E=>{this.manager&&this.manager.log.error("Error deleting invalid database.",E),n(E),this._onFinish(g)},g.onsuccess=()=>{this.manager&&this.manager.log.info("Deleted invalid database."),this._onFinish(g),this._db_wait=null,this.getDB(!0).then(s).catch(n)}}return}s(this.db),this._onFinish(o)}}).finally(()=>{i===this._db_wait&&(this._db_wait=null)})}async loadSettings(){const e=await this.getDB(),i=e.transaction(["settings"],"readonly"),s=i.objectStore("settings"),n=this._last_tx++;return this._onStart(n),new Promise((o,h)=>{i.onabort=E=>{this.manager&&this.manager.log.error("Transaction aborted reading settings from database.",E),this._onFinish(n),h()};const g=s.getAll();g.onsuccess=()=>{for(const E of g.result)this._cached.set(E.k,E.v);this._onFinish(n),o()},g.onerror=E=>{this.manager&&this.manager.log.error("Error reading settings from database.",E),this._onFinish(n),h()}})}async _getKeys(){const e=await this.getDB(),i=e.transaction(["settings"],"readonly"),s=i.objectStore("settings"),n=this._last_tx++;return this._onStart(n),new Promise((o,h)=>{i.onabort=E=>{this.manager&&this.manager.log.error("Transaction aborted reading keys from database.",E),this._onFinish(n),h()};const g=s.getAllKeys();g.onsuccess=()=>{this._onFinish(n),o(g.result)},g.onerror=E=>{this.manager&&this.manager.log.error("Error reading keys from database.",E),this._onFinish(n),h()}})}async _get(e){const i=await this.getDB(),s=i.transaction(["settings"],"readonly"),n=s.objectStore("settings"),o=this._last_tx++;return this._onStart(o),new Promise((h,g)=>{s.onabort=R=>{this.manager&&this.manager.log.error("Transaction aborted reading value from database.",R),this._onFinish(o),g()};const E=n.get(e);E.onerror=R=>{this.manager&&this.manager.log.error("Error reading value from database.",R),this._onFinish(o),g()},E.onsuccess=()=>{this._onFinish(o),h(E.result.v)}})}async _set(e,i){if(this.disabled)return;const s=this._last_tx++;this._onStart(s);const n=await this._lock.wait(),o=await this.getDB(),h=o.transaction(["settings"],"readwrite"),g=h.objectStore("settings");return new Promise((E,R)=>{h.onabort=L=>{this.manager&&this.manager.log.error("Transaction aborted setting value to database.",L),n(),this._onFinish(s),R()};const T=g.put({k:e,v:i});T.onerror=L=>{this.manager&&this.manager.log.error("Error setting value to database.",L),n(),this._onFinish(s),R()},T.onsuccess=()=>{n(),this._onFinish(s),E()}})}async _delete(e){if(this.disabled)return;const i=this._last_tx++;this._onStart(i);const s=await this._lock.wait(),n=await this.getDB(),o=n.transaction(["settings"],"readwrite"),h=o.objectStore("settings");return new Promise((g,E)=>{o.onabort=T=>{this.manager&&this.manager.log.error("Transaction aborted deleting value from database.",T),s(),this._onFinish(i),E()};const R=h.delete(e);R.onerror=T=>{this.manager&&this.manager.log.error("Error deleting value from database.",T),s(),this._onFinish(i),E()},R.onsuccess=()=>{s(),this._onFinish(i),g()}})}async _clear(){if(this.disabled)return;const e=this._last_tx++;this._onStart(e);const i=await this._lock.wait(),s=await this.getDB(),n=s.transaction(["settings"],"readwrite"),o=n.objectStore("settings");return new Promise((h,g)=>{n.onabort=R=>{this.manager&&this.manager.log.error("Transaction aborted clearing database.",R),i(),this._onFinish(e),g()};const E=o.clear();E.onerror=R=>{this.manager&&this.manager.log.error("Error clearing database.",R),i(),this._onFinish(e),g()},E.onsuccess=()=>{i(),this._onFinish(e),h()}})}async getBlob(e){const i=await this.getDB(),s=i.transaction(["blobs"],"readonly"),n=s.objectStore("blobs");return new Promise((o,h)=>{const g=n.get(e);this._onStart(g),g.onerror=()=>{h(),this._onFinish(g)},g.onsuccess=E=>{(0,Ee.isValidBlob)(g.result)?o(g.result):h(),this._onFinish(g)}})}async setBlob(e,i){if(this.disabled)return;if(!this.isValidBlob(i))throw new Error("Invalid blob type");const s=await this.getDB(),n=s.transaction(["blobs"],"readwrite"),o=n.objectStore("blobs");return new Promise((h,g)=>{const E=o.put(i,e);this._onStart(E),E.onerror=()=>{g(),this._onFinish(E)},E.onsuccess=()=>{h(),this.broadcast({type:"set-blob",key:e}),this.emit("set-blob",e,i,!1),this._onFinish(E)}})}async deleteBlob(e){if(this.disabled)return;const i=await this.getDB(),s=i.transaction(["blobs"],"readwrite"),n=s.objectStore("blobs");return new Promise((o,h)=>{const g=n.delete(e);this._onStart(g),g.onerror=()=>{h(),this._onFinish(g)},g.onsuccess=()=>{o(),this.broadcast({type:"delete-blob",key:e}),this.emit("set-blob",e,void 0,!0),this._onFinish(g)}})}async hasBlob(e){return(await this.blobKeys()).includes(e)}async clearBlobs(){if(this.disabled)return;const e=await this.getDB(),i=e.transaction(["blobs"],"readwrite"),s=i.objectStore("blobs");return new Promise((n,o)=>{const h=s.clear();this._onStart(h),h.onerror=()=>{o(),this._onFinish(h)},h.onsuccess=()=>{n(),this.broadcast({type:"clear-blobs"}),this._onFinish(h)}})}async blobKeys(){const e=await this.getDB(),i=e.transaction(["blobs"],"readonly"),s=i.objectStore("blobs");return new Promise((n,o)=>{const h=s.getAllKeys();this._onStart(h),h.onerror=()=>{o(),this._onFinish(h)},h.onsuccess=()=>{Array.isArray(h.result)?n(h.result):o(),this._onFinish(h)}})}};B(hs,"IndexedDBProvider");let st=hs;st.priority=10,st.title="IndexedDB",st.description="[IndexedDB](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API) is available on most platforms, and has a slightly slower initialization time than Local Storage. IndexedDB has a higher storage capacity and is less likely to be cleared unexpectedly.";const c=(wi=class extends xt{constructor(e){super(e);const i=this.frame=document.createElement("iframe");i.src=this.manager.root.host==="youtube"?"//www.youtube.com/__ffz_bridge/":"//www.twitch.tv/p/ffz_bridge/",i.id="ffz-settings-bridge",i.style.width="0",i.style.height="0",this.onMessage=this.onMessage.bind(this),window.addEventListener("message",this.onMessage),document.body.appendChild(i)}static supported(){return He&&Ze}static hasContent(){return wi.supported()}broadcastTransfer(){}disableEvents(){}onMessage(e){const i=e.data;!i||!i.ffz_type||this.handleMessage(i)}send(e,i){typeof e=="string"&&(e={ffz_type:e});try{this.frame.contentWindow.postMessage(e,"*",i?Array.isArray(i)?i:[i]:void 0)}catch(s){this.manager.log.error("Error sending message to bridge.",s,e,i)}}},B(wi,"_CrossOriginStorageBridge2"),wi);c.priority=100,c.title="Cross-Origin Storage Bridge",c.description="This provider uses an `<iframe>` to synchronize storage across subdomains. Due to the `<iframe>`, this provider takes longer than others to load, but should perform roughly the same once loaded. You should be using this on non-www subdomains of Twitch unless you don't want your settings to automatically synchronize for some reason.",c.allowTransfer=!1,c.shouldUpdate=!1;let m=c;const N=(ki=class extends xt{static supported(){return f.EXTENSION}static hasContent(){return ki.supported()?new Promise(e=>{let i=!1,s=null;const n=B(h=>{if(h.source===window&&h.data&&h.data.type==="ffz_from_ext"){const g=h.data.data;g?.ffz_type==="has-keys"&&(i=!0,e(g.value),o())}},"listener"),o=B(()=>{i||(i=!0,e(!1)),s&&(clearTimeout(s),s=null),window.removeEventListener("message",n)},"cleanup");window.addEventListener("message",n),window.postMessage({type:"ffz_to_ext",data:{ffz_type:"check-has-keys"}},"*"),s=setTimeout(o,1e3)}):!1}constructor(e){super(e),this.onExtMessage=this.onExtMessage.bind(this),window.addEventListener("message",this.onExtMessage)}broadcastTransfer(){}disableEvents(){}onExtMessage(e){e.source===window&&e.data?.type==="ffz_from_ext"&&e.data.data?.ffz_type&&this.handleMessage(e.data.data)}send(e,i){typeof e=="string"&&(e={ffz_type:e});try{window.postMessage({type:"ffz_to_ext",data:e},"*",i?Array.isArray(i)?i:[i]:void 0)}catch(s){this.manager.log.error("Error sending message to extension.",s,e,i)}}},B(ki,"_ExtensionProvider2"),ki);N.priority=101,N.title="Browser Extension Storage",N.description="This provider uses a browser extension service worker to store settings in a location that should not suffer from issues due to storage partitioning or cache clearing.",N.allowTransfer=!0,N.shouldUpdate=!0;let P=null;const V={local:Kt,idb:st,cosb:m},H={label:"Experiment Overrides",keys:["exp-lock","experiment-overrides"]},j={label:"Hidden Emotes",keys(k){const e=["emote-menu.hidden-sets"];for(const i of k.keys())i.startsWith("hidden-emotes.")&&e.push(i);return e}},U={label:"Favorited Emotes",keys(k){const e=[];for(const i of k.keys())i.startsWith("favorite-emotes.")&&e.push(i);return e}},ee={label:"Name and Color Overrides",keys:["overrides.colors","overrides.names"]},he={label:"Profiles",clear(k,e){const i=["profiles"];for(const s of k.keys())/^p:\d+:/.test(s)&&i.push(s);for(const s of i)k.delete(s);e.loadProfiles()}},Se={label:"Absolutely Everything",async clear(k,e){k.clear(),k.supportsBlobs&&k instanceof it&&await k.clearBlobs(),e.loadProfiles()}};function Te(k,e){try{return k.postMessage(e,"*"),!0}catch{return!1}}B(Te,"postMessage");const Be=["session"],us=class us extends d.default{constructor(e,i){super(e,i),this.provider=null,this._active_provider="local",this.disable_profiles=!1,this.providers={};for(const[s,n]of Object.entries(V))n.supported()&&(this.providers[s]=n);Object.seal(this.providers),this.updateSoon=(0,r.debounce)(()=>this.updateRoutes(),50,!1);try{const s=new URL(window.location).searchParams;s&&s.has("ffz-no-settings")&&(this.disable_profiles=!0)}catch{}this.__ls_scheduled=new Set,this.__ls_cache=new Map,this.__ls_hooked=!1,this._updateLS=this._updateLS.bind(this),this.__contexts=[],this.__profiles=[],this.__profile_ids={},this.__profile_uuids={},this.ui_structures=new Map,this.definitions=new Map,this.validators={};for(const s in te)(0,r.has)(te,s)&&(this.validators[s]=te[s]);this.processors={};for(const s in me)(0,r.has)(me,s)&&(this.processors[s]=me[s]);this.clearables={};for(const s in K)(0,r.has)(K,s)&&(this.clearables[s]=K[s]);this.filters={};for(const s in S)(0,r.has)(S,s)&&S[s]&&(this.filters[s]=S[s]);this._createProvider().then(s=>{this.provider=s,this.log.info(`Using Provider: ${s.constructor.name}`),s.on("changed",this._onProviderChange,this),s.on("quota-exceeded",n=>{this.emit(":quota-exceeded")}),s.on("change-provider",()=>{this.emit(":change-provider")}),this._provider_resolve&&this._provider_resolve(s)}),this.main_context=new z(this),this.main_context.on("changed",(s,n,o)=>{this.emit(`:changed:${s}`,n,o)}),this.main_context.on("uses_changed",(s,n,o)=>{this.emit(`:uses_changed:${s}`,n,o)}),this.main_context.on("context_changed",()=>this._updateContextProxies()),this._context_proxies=new Set,window.addEventListener("message",s=>{const n=s.data?.ffz_type;n==="open-settings"?this.emit("main_menu:open"):n==="request-context"&&s.source&&(this._context_proxies.add(s.source),this._updateContextProxies(s.source))}),window.addEventListener("beforeunload",()=>{for(const s of this._context_proxies)Te(s,{ffz_type:"context-gone"})}),this._start_time=performance.now(),this.enable()}_updateContextProxies(e){if(!e&&!this._context_proxies.size)return;const i=JSON.parse(JSON.stringify(this.main_context._context));for(const s of Be)(0,r.has)(i,s)&&delete i[s];if(e)Te(e,{ffz_type:"context-update",ctx:i});else for(const s of this._context_proxies)Te(s,{ffz_type:"context-update",ctx:i})}addFilter(e,i){if(this.filters[e])return this.log.warn("Tried to add already existing filter",e);this.filters[e]=i,this.updateRoutes()}getFilterBasicEditor(){return()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,47178))}generateLog(){const e=[];for(const[i,s]of this.main_context.__cache.entries())e.push(`${i}: ${JSON.stringify(s)}`);return e.join(`
`)}awaitProvider(){return this.provider?Promise.resolve(this.provider):this._provider_waiter?this._provider_waiter:this._provider_waiter=new Promise((e,i)=>{this._provider_resolve=e}).finally(()=>{this._provider_waiter=null,this._provider_resolve=null})}async onEnable(){if(await this.awaitProvider(),!this.provider)throw new Error("did not get provider");await this.provider.awaitReady(),this.on("site.router:updated-routes",this.updateRoutes,this),this.loadProfiles(!0);for(const i of this.__contexts)i.selectProfiles();const e=performance.now()-this._start_time;this.log.info(`Initialization complete after ${e.toFixed(5)}ms -- Values: ${this.provider.size} -- Profiles: ${this.__profiles.length}`),this.scheduleUpdates(),this.updateClock()}async createMonitorUpdate(){const e=S?.Monitor;if(!(!e||e.details!==void 0)){e.details=null;try{window.getScreenDetails?(e.details=await window.getScreenDetails(),e.details.addEventListener("currentscreenchange",()=>{for(const i of this.__contexts)i.selectProfiles()})):e.details=!1}catch(i){this.log.error("Unable to get monitor details",i),e.details=!1}}}updateClock(){const e=S?.Time?.captured?.();if(!e?.length)return;this._time_timer&&clearTimeout(this._time_timer);const i=new Date,s=i.getHours()*60+i.getMinutes();let n=this._time_next!=null?this._time_next:null;for(const h of e)h<=s||(n==null||h<n)&&(n=h);n==null&&(n=e[0]+1440);const o=(n-s)*60*1e3-59750+(6e4-Date.now()%6e4);this._time_timer=setTimeout(()=>{for(const h of this.__contexts)h.selectProfiles();this.updateClock()},o)}_updateLSKey(e){(this.__ls_cache.has(e)||this.__ls_cache.has(`raw.${e}`))&&(this.__ls_scheduled.add(e),this.__ls_timer||(this.__ls_timer=setTimeout(this._updateLS,0)))}_hookLS(){if(this.__ls_hooked)return;this.__ls_hooked=!0;const e=localStorage.setItem,i=this;localStorage.setItem=function(s,...n){try{i._updateLSKey(s)}catch{}return e.call(this,s,...n)},this._handleLSEvent=this._handleLSEvent.bind(this),window.addEventListener("storage",this._handleLSEvent)}_handleLSEvent(e){e.key&&e.storageArea===localStorage&&this._updateLSKey(e.key)}_updateLS(){clearTimeout(this.__ls_timer),this.__ls_timer=null;const e=this.__ls_scheduled;this.__ls_scheduled=new Set;for(const i of e){const s=this.__ls_cache.has(i),n=`raw.${i}`,o=this.__ls_cache.has(n);if(!o&&!s)continue;const h=localStorage.getItem(i);if(o&&(this.__ls_cache.set(n,h),this.emit(":ls-update",n,h)),s){let g;if(h)try{g=JSON.parse(h)}catch(E){this.log.warn(`Unable to parse localStorage value as JSON for "${i}"`,E)}this.__ls_cache.set(i,g),this.emit(":ls-update",i,g)}}}getLS(e){if(this.__ls_cache.has(e))return this.__ls_cache.get(e);this.__ls_hooked||this._hookLS();const i=e.startsWith("raw."),s=localStorage.getItem(i?e.slice(4):e);let n;if(i)n=s;else try{n=s?JSON.parse(s):null}catch(o){this.log.warn(`Unable to parse localStorage value as JSON for "${e}"`,o)}return this.__ls_cache.set(e,n),n}async generateBackupFile(){const e=new Date,i=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`;if(await this._needsZipBackup()){const n=await this._getZipBackup();return new File([n],`ffz-settings (${i}).zip`,{type:"application/zip"})}const s=await this.getSettingsDump();return new File([JSON.stringify(s)],`ffz-settings (${i}).json`,{type:"application/json;charset=utf-8"})}async _needsZipBackup(){if(await this.awaitProvider(),!this.provider||(await this.provider.awaitReady(),!(this.provider instanceof it)||!this.provider.supportsBlobs))return!1;const e=await this.provider.blobKeys();return Array.isArray(e)?e.length>0:!1}async _getZipBackup(){if(await this.awaitProvider(),!this.provider)throw new Error("provider not available");await this.provider.awaitReady();const e=(await X.e(935).then(X.t.bind(X,29597,23))).default,i=new e,s=await this.getSettingsDump();i.file("settings.json",JSON.stringify(s));const n={};if(this.provider instanceof it&&this.provider.supportsBlobs){const o=await this.provider.blobKeys();for(const h of o){const g=encodeURIComponent(h),E=await this.provider.getBlob(h);if(!E)continue;const R={key:h};if(E instanceof File)R.type="file",R.name=E.name,R.modified=E.lastModified,R.mime=E.type;else if(E instanceof Blob)R.type="blob";else if(E instanceof ArrayBuffer)R.type="ab";else if(E instanceof Uint8Array)R.type="ui8";else continue;n[g]=R,i.file(`blobs/${g}`,E)}}return i.file("blobs.json",JSON.stringify(n)),i.generateAsync({type:"blob"})}async getSettingsDump(){if(await this.awaitProvider(),!this.provider)return null;await this.provider.awaitReady();const e={version:2,type:"full",values:{}};for(const[i,s]of this.provider.entries())e.values[i]=s;return e}scheduleUpdates(){this._update_timer&&clearTimeout(this._update_timer),this._update_timer=setTimeout(()=>this.checkUpdates(),5e3)}async checkUpdates(){if(await this.awaitProvider(),await this.provider?.awaitReady(),!this.provider?.shouldUpdate)return;const e=[];for(const n of this.__profiles){if(!n||!n.url||n.pause_updates)continue;const o=n.checkUpdate();e.push(o instanceof Promise?o:Promise.resolve(o))}const i=await Promise.all(e);let s=0;for(const n of i)n&&s++;this.log.info(`Successfully refreshed ${s} of ${i.length} profiles from remote URLs.`)}getProviders(){return this.providers}getActiveProvider(){return this._active_provider}async _createProvider(){let e=localStorage.ffzProviderv2;if(e==null&&(e=localStorage.ffzProviderv2=await this.sniffProvider()),this.providers[e]){const i=new this.providers[e](this);return this._active_provider=e,i}return this._active_provider="local",new Kt(this)}async sniffProvider(){const e=Array.from(Object.entries(this.providers));e.sort((i,s)=>(s[1].priority??0)-(i[1].priority??0));for(const[i,s]of e)if(s.supported()&&await s.hasContent())return i;return"local"}async changeProvider(e,i){if(!this.providers[e]||!this.providers[e].supported())throw new Error(`Invalid provider: ${e}`);if(e===this._active_provider||!this.provider)return;const s=this.provider;if(this.provider=null,s.broadcastTransfer(),i){const n=new this.providers[e](this);if(await n.awaitReady(),n.allowTransfer&&s.allowTransfer){s.disableEvents(),n.clear(),n instanceof it&&n.supportsBlobs&&await n.clearBlobs(),await n.flush();for(const[o,h]of s.entries())n.set(o,h);if(s instanceof it&&s.supportsBlobs&&n instanceof it&&n.supportsBlobs){for(const o of await s.blobKeys()){const h=await s.getBlob(o);h&&await n.setBlob(o,h)}await s.clearBlobs()}s.clear(),await s.flush(),await n.flush()}}localStorage.ffzProviderv2=e,location.reload()}_onProviderChange(e,i,s){if(e==="profiles")return this.loadProfiles();if(!e.startsWith("p:"))return;e=e.slice(2);const n=e.indexOf(":");if(n===-1)return;const o=this.__profile_ids[e.slice(0,n)],h=e.slice(n+1);o&&!o.ephemeral&&(h===":enabled"?o.emit("toggled",o,s?!0:i):o.emit("changed",h,i,s))}updateRoutes(){for(const e of this.__profiles)e.clearMatcher();for(const e of this.__contexts)e.selectProfiles();this.updateClock()}_onProfileToggled(e,i){for(const s of this.__contexts)s.selectProfiles();this.updateClock(),this.emit(":profile-toggled",e,i)}profile(e){return this.__profile_uuids[e]??this.__profile_ids[e]??null}loadProfiles(e=!1){const i=this.__profile_ids,s=this.__profile_uuids,n=this.__profiles,o=this.__profile_ids={},h=this.__profiles=[],g=this.__profile_uuids={},E=new Set(n.map(fe=>fe.id)),R=new Set,T=new Set;let L=this.provider?.get("profiles")??[u.Z.Moderation,u.Z.Default];L?.length||(this.provider?.delete("profiles"),L=[u.Z.Moderation,u.Z.Default]);let q=!1;for(const fe of L)fe.uuid||(q=!0,fe.i18n_key===u.Z.Default.i18n_key?fe.uuid=u.Z.Default.uuid:fe.i18n_key===u.Z.Moderation.i18n_key?fe.uuid=u.Z.Moderation.uuid:fe.uuid=(0,r.generateUUID)());q&&this.provider?.set("profiles",L);let le=!1,pe=!1;for(const fe of n)fe.off("toggled",this._onProfileToggled,this),fe.hotkey_enabled=!1;for(const fe of L){const De=fe.id,Ae=h.length,ye=i[De],Ie=ye?n.indexOf(ye):-1;if(E.delete(De),Ie!==Ae&&(le=!0),ye&&(0,r.deep_equals)(ye.data,fe,!0)){Ie!==Ae&&(pe=!0),h.push(o[De]=ye),g[ye.uuid]=ye;continue}const Fe=o[De]=new u.Z(this,fe);ye?(ye.transferListeners(Fe),T.add(De)):R.add(De),h.push(Fe),g[Fe.uuid]=Fe,pe=!0}for(const fe of h)fe.on("toggled",this._onProfileToggled,this),fe.hotkey_enabled=!0;if(!(!pe&&!E.size||e)){for(const fe of this.__contexts)fe.selectProfiles();this.updateClock();for(const fe of R)this.emit(":profile-created",o[fe]);for(const fe of T)this.emit(":profile-changed",o[fe]);le&&this.emit(":profiles-reordered")}}createProfile(e={}){if(!this.enabled)throw new Error("Unable to create profile before settings have initialized. Please await enable()");if(e.id!==void 0)throw new Error("You cannot specify an ID when creating a profile.");let i=0;for(;this.__profile_ids[i];)e.ephemeral?i--:i++;e.id=i,e.uuid=(0,r.generateUUID)(),e.name||(e.name=`Unnamed Profile ${this.__profiles.length+1}`);const s=this.__profile_ids[i]=new u.Z(this,e);return this.__profile_uuids[e.uuid]=s,this.__profiles.unshift(s),s.on("toggled",this._onProfileToggled,this),s.hotkey_enabled=!0,s.ephemeral||this._saveProfiles(),this.emit(":profile-created",s),s}deleteProfile(e){if(!this.enabled)throw new Error("Unable to delete profile before settings have initialized. Please await enable()");if(typeof e=="object"&&typeof e.id=="number")e=e.id;else if(typeof e!="number")throw new Error("Invalid profile");const i=this.__profile_ids[e];if(!i)return;if(this.__profiles.length===1)throw new Error("cannot delete only profile");i.off("toggled",this._onProfileToggled,this),i.clear(),this.__profile_ids[e]=null,this.__profile_uuids[i.uuid]=null;const s=this.__profiles.indexOf(i);s!==-1&&this.__profiles.splice(s,1),i.ephemeral||this._saveProfiles(),this.emit(":profile-deleted",i)}moveProfile(e,i){if(!this.enabled)throw new Error("Unable to move profiles before settings have initialized. Please await enable()");if(typeof e=="object"&&typeof e.id=="number")e=e.id;else if(typeof e!="number")throw new Error("Invalid profile");const s=this.__profile_ids[e];if(!s)return;const n=this.__profiles,o=n.indexOf(s);o!==i&&(n.splice(i,0,...n.splice(o,1)),s.ephemeral||this._saveProfiles(),this.emit(":profiles-reordered"))}saveProfile(e){if(!this.enabled)throw new Error("Unable to save profile before settings have initialized. Please await enable()");if(typeof e=="object"&&typeof e.id=="number")e=e.id;else if(typeof e!="number")throw new Error("Invalid profile");const i=this.__profile_ids[e];i&&(i.ephemeral||this._saveProfiles(),this.emit(":profile-changed",i))}_saveProfiles(){const e=this.__profiles.filter(i=>!i.ephemeral).map(i=>i.data);if(!e){this.createProfile({name:"Default Profile",i18n_key:"setting.profiles.default",description:"Settings that apply everywhere on Twitch."});return}this.provider?.set("profiles",e);for(const i of this.__contexts)i.selectProfiles();this.updateClock()}context(e){return this.main_context.context(e)}get(e){return this.main_context.get(e)}getChanges(e,i,s){return this.main_context.getChanges(e,i,s)}onChange(e,i,s){return this.main_context.onChange(e,i,s)}uses(e){return this.main_context.uses(e)}update(e){return this.main_context.update(e)}updateContext(e){return this.main_context.updateContext(e)}setContext(e){return this.main_context.setContext(e)}getAddonProxy(e,i,s){if(!e)return this;const n={},o=f.DEBUG||i?.dev;return n.add=(h,g)=>this.add(h,g,e),n.addUI=(h,g)=>this.addUI(h,g,e),n.addClearable=(h,g)=>this.addClearable(h,g,e),(0,d.buildAddonProxy)(s,this,"settings",n)}add(e,i,s){const n=this.definitions.get(e),o=(Array.isArray(n)?n:n?.required_by)??[];i.required_by=o,i.requires=i.requires??[],i.__source=s;for(const h of i.requires){const g=this.definitions.get(h);Array.isArray(g)?g.push(e):g?g.required_by?.push(e):this.definitions.set(h,[e])}if(i.ui){const h=i.ui;if(h.path_tokens=h.path_tokens?ge(h.path_tokens):h.path?(0,b.Q)(h.path):void 0,s&&h.path_tokens&&h.path_tokens.length>=2&&h.path_tokens[0].key==="add_ons"){const g=this.resolve("addons"),E=g?.getAddon(s);if(E){const R=h.path_tokens[1],T=[];T.push(`add_ons.changelog.${s}`),E.short_name&&T.push(`add_ons.changelog.${E.short_name.toSnakeCase()}`),E.name&&T.push(`add_ons.changelog.${E.name.toSnakeCase()}`),R.header_links=[{navigate:T,i18n_key:"home.changelog",title:"Changelog"}]}}if(!h.key&&e&&(h.key=e),!h.key&&h.title&&(h.key=h.title.toSnakeCase()),(h.component==="setting-select-box"||h.component==="setting-combo-box")&&Array.isArray(h.data)&&!h.no_i18n){const g=`${h.i18n_key||`setting.entry.${e}`}.values`;for(const E of h.data)E.i18n_key===void 0&&E.value!==void 0&&(E.i18n_key=`${g}.${E.value}`)}}i.changed&&this.on(`:changed:${e}`,i.changed),this.definitions.set(e,i),(!n||Array.isArray(n))&&this.emit(":added-definition",e,i)}remove(e){const i=this.definitions.get(e);if(i&&!Array.isArray(i)){if(Array.isArray(i.required_by)&&i.required_by.length>0?this.definitions.set(e,i.required_by):this.definitions.delete(e),Array.isArray(i.requires))for(const s of i.requires){let n=this.definitions.get(s);if(Array.isArray(n)){const o=n.indexOf(e);o!==-1&&n.splice(o,1)}else n?.required_by&&(n=n.required_by)}i.changed&&this.off(`:changed:${e}`,i.changed),this.emit(":removed-definition",e,i)}}addUI(e,i,s){let n;i.ui?n=i:n={ui:i},n.__source=s;const o=n.ui;o.path_tokens=o.path_tokens?ge(o.path_tokens):o.path?(0,b.Q)(o.path):void 0,!o.key&&o.title&&(o.key=o.title.toSnakeCase());const h=this.ui_structures.get(e);this.ui_structures.set(e,n),h||this.emit(":added-definition",e,n)}addClearable(e,i,s){if(typeof e=="object"){for(const[n,o]of Object.entries(e))this.addClearable(n,o,s);return}else if(typeof e!="string")throw new Error("invalid key");i&&(i.__source=s,this.clearables[e]=i)}getClearables(){return(0,r.deep_copy)(this.clearables)}addProcessor(e,i){if(typeof e=="object"){for(const[s,n]of Object.entries(e))this.addProcessor(s,n);return}else if(typeof e!="string")throw new Error("invalid key");i&&(this.processors[e]=i)}getProcessor(e){return this.processors[e]??null}getProcessors(){return(0,r.deep_copy)(this.processors)}addValidator(e,i){if(typeof e=="object"){for(const[s,n]of Object.entries(e))this.addValidator(s,n);return}else if(typeof e!="string")throw new Error("invalid key");i&&(this.validators[e]=i)}getValidator(e){return this.validators[e]??null}getValidators(){return(0,r.deep_copy)(this.validators)}};B(us,"SettingsManager");let Y=us;function ge(k){for(let e=0,i=k.length;e<i;e++){const s=k[e];if(typeof s=="string"){k[e]={key:s.toSnakeCase(),title:s};continue}s.key||(s.key=s.title.toSnakeCase())}return k}B(ge,"format_path_tokens");var re=X(44589),Ce=X(83269);const ds=class ds extends d.default{constructor(e,i){super(e,i),this.i18n=null,this.load_tracker=null,this.settings=null,this.should_enable=!0,this.inject("settings"),this.inject("i18n"),this.inject("load_tracker"),this.load_requires=["settings"],this.target=this.parent.flavor||"unknown",this.has_dev=!1,this.reload_required=!1,this.addons={},this.enabled_addons=[],this.versions={},this.load_tracker.schedule("chat-data","addon-initial")}onLoad(){this._loader=this.loadAddonData()}onEnable(){this.settings.addUI("add-ons",{path:'Add-Ons @{"description": "Add-Ons are additional modules, often written by other people, that can be loaded automatically by FrankerFaceZ to add new capabilities and behaviors to the extension and Twitch.", "profile_warning": false}',component:"addon-list",title:"Add-Ons",no_filter:!0,getExtraTerms:()=>Object.values(this.addons).map(e=>e.search_terms),getFFZ:()=>this,isReady:()=>this.enabled,getAddons:()=>Object.values(this.addons),getVersions:()=>(0,r.deep_copy)(this.versions),hasAddon:e=>this.hasAddon(e),getVersion:e=>this.getVersion(e),doesAddonTarget:e=>this.doesAddonTarget(e),isAddonEnabled:e=>this.isAddonEnabled(e),isAddonExternal:e=>this.isAddonExternal(e),enableAddon:e=>this.enableAddon(e),disableAddon:e=>this.disableAddon(e),reloadAddon:e=>this.reloadAddon(e),canReloadAddon:e=>this.canReloadAddon(e),isReloadRequired:()=>this.reload_required,refresh:()=>window.location.reload(),on:(...e)=>this.on(...e),off:(...e)=>this.off(...e)}),f.EXTENSION||this.settings.add("addons.dev.server",{default:!1,ui:{path:"Add-Ons >> Development",title:"Use Local Development Server",description:"Attempt to load add-ons from local development server on port 8001.",component:"setting-check-box"}}),this.on("i18n:update",this.rebuildAddonSearch,this),this.settings.provider.on("changed",this.onProviderChange,this),this._loader?.then(()=>{this.enabled_addons=this.settings.provider.get("addons.enabled",[]);for(const e of this.enabled_addons)this.hasAddon(e)&&this.doesAddonTarget(e)&&this._enableAddon(e).catch(i=>{this.log.error(`An error occured while enabling the add-on "${e}":`,i),this.log.capture(i)});this.load_tracker.notify("chat-data","addon-initial"),this.emit(":ready")})}doesAddonTarget(e){const i=this.getAddon(e);if(!i)return!1;const s=i.targets??["main"];return Array.isArray(s)?s.includes(this.target):!1}generateLog(){const e=["Known"];for(const[i,s]of Object.entries(this.addons)){if(Array.isArray(s))continue;const n=this.versions[i];e.push(`${i} | ${this.isAddonEnabled(i)?"enabled":"disabled"} | ${n?`${n} | `:""}${s.dev?"dev | ":""}${this.isAddonExternal(i)?"external | ":""}${s.short_name} v${s.version}`)}e.push(""),e.push("Modules");for(const[i,s]of Object.entries(this.__modules))s&&e.push(`${s.loaded?"loaded  ":s.loading?"loading ":"unloaded"} | ${s.enabled?"enabled ":s.enabling?"enabling":"disabled"} | ${i}`);return e.join(`
`)}onProviderChange(e,i){if(e!="addons.enabled")return;const s=Array.isArray(i)?i:[],n=[...this.enabled_addons];for(const o of n)s.includes(o)||this.disableAddon(o,!1);for(const o of s)n.includes(o)||this.enableAddon(o,!1)}async loadAddonData(){const[e,i]=await Promise.all([(0,r.fetchJSON)(`${f.SERVER_OR_EXT}/addons.json?_=${(0,Ce.getBuster)(30)}`),!f.EXTENSION&&this.settings.get("addons.dev.server")?(0,r.fetchJSON)(`https://localhost:8001/script/addons.json?_=${(0,Ce.getBuster)()}`):null]);if(Array.isArray(e)){const s=`${f.SERVER_OR_EXT}/addons/`;for(const n of e)n.icon&&(n.icon=new URL(n.icon,s).toString()),this.addAddon(n,!1)}if(Array.isArray(i)){this.has_dev=!0;for(const s of i)this.addAddon(s,!0)}this.settings.updateContext({addonDev:this.has_dev}),this.rebuildAddonSearch(),this.emit(":data-loaded")}setVersion(e,i){this.versions[e]=i}addAddon(e,i=!1){let s=e;const n=this.addons[s.id];this.addons[s.id]=s,s.name=s.name??s.id,s.dev=i,s.requires=s.requires||[],s.required_by=Array.isArray(n)?n:n&&n.required_by||[],s.updated&&(s.updated=new Date(s.updated)),s.created&&(s.created=new Date(s.created)),s._search=s.search_terms;for(const o of s.requires){const h=this.addons[o];Array.isArray(h)?h.push(s.id):h?h.required_by.push(s.id):this.addons[o]=[s.id]}(!n||Array.isArray(n))&&this.settings.addUI(`addon-changelog.${s.id}`,{path:`Add-Ons > Changelog > ${s.name}`,component:"changelog",force_seen:!0,addons:!0,addon:(0,r.deep_copy)(s),getFFZ:()=>this,getVersion:()=>this.versions[s.id]}),this.emit(":added",s.id,s)}rebuildAddonSearch(){for(const e of Object.values(this.addons)){if(Array.isArray(e))continue;const i=new Set([e._search,e.name,e.short_name,e.author,e.description]);this.i18n.locale!=="en"&&(e.name_i18n&&i.add(this.i18n.t(e.name_i18n,e.name)),e.short_name_i18n&&i.add(this.i18n.t(e.short_name_i18n,e.short_name)),e.author_i18n&&i.add(this.i18n.t(e.author_i18n,e.author)),e.maintainer_i18n&&i.add(this.i18n.t(e.maintainer_i18n,e.maintainer)),e.description_i18n&&i.add(this.i18n.t(e.description_i18n,e.description))),e.search_terms=[...i].map(s=>s?s.toLocaleLowerCase():"").join(`
`)}}isAddonEnabled(e){return this.isAddonExternal(e)?!0:this.enabled_addons.includes(e)}getAddon(e){const i=this.addons[e]??null;return Array.isArray(i)?null:i}hasAddon(e){return this.getAddon(e)!=null}getVersion(e){const i=this.getAddon(e);if(!i)throw new Error(`Unknown add-on id: ${e}`);const s=this.resolve(`addon.${e}`);if(s){if("version"in s)return s.version;if(s.constructor&&"version"in s.constructor)return s.constructor.version}return i.version}isAddonExternal(e){if(!this.hasAddon(e))throw new Error(`Unknown add-on id: ${e}`);const i=this.resolve(`addon.${e}`);return i?document.head.querySelector(`script#ffz-loaded-addon-${e}`)?i.external||i.constructor?.external:!0:!1}canReloadAddon(e){if(!this.hasAddon(e))throw new Error(`Unknown add-on id: ${e}`);let i=this.resolve(`addon.${e}`);if(!i||!i.canDisable()||!i.canUnload())return!1;if(i.children){for(const s of Object.values(i.children))if(!s.canDisable()||!s.canUnload())return!1}return!0}async fullyUnloadModule(e){if(!(!e||!e.addon_id)){if(e.children)for(const i of Object.values(e.children))await this.fullyUnloadModule(i);await e.disable(),await e.unload(),e.parent instanceof d.default&&e.parent.children[e.name]===e&&delete e.parent.children[e.name];for(const i of e.references){const s=this.resolve(i[0]),n=i[1];s[n]===e&&(s[n]=null)}this.emit(":fully-unload",e.addon_id),this.__modules[e.__path]===e&&delete this.__modules[e.__path],this.off(void 0,void 0,e);for(const i of this.settings.__contexts)i.off(void 0,void 0,e);for(const[i,s]of Array.from(this.settings.definitions.entries()))!Array.isArray(s)&&s?.__source===e.addon_id&&this.settings.remove(i);e.__log=null}}async reloadAddon(e){const i=this.getAddon(e),s=this.resolve("site.menu_button");if(!i)throw new Error(`Unknown add-on id: ${e}`);const n=performance.now();let o=this.resolve(`addon.${e}`);if(o)try{await this.fullyUnloadModule(o)}catch(E){throw s&&s.addToast({title_i18n:"addons.reload.toast-error",title:"Error Reloading Add-On",text_i18n:"addons.reload.toast-error.unload",text:`Unable to unload existing modules for add-on "{addon_id}":

{error}`,icon:"ffz-i-attention",addon_id:e,error:String(E)}),E}let h=document.querySelector(`script#ffz-loaded-addon-${i.id}`);h&&h.remove(),window.ffzAddonsWebpackJsonp&&(window.ffzAddonsWebpackJsonp=void 0);try{await this._enableAddon(e)}catch(E){throw s&&s.addToast({title_i18n:"addons.reload.toast-error",title:"Error Reloading Add-On",text_i18n:"addons.reload.toast-error.reload",text:`Unable to load new module for add-on "{addon_id}":

{error}`,error:String(E),icon:"ffz-i-attention",addon_id:e}),E}const g=performance.now();s&&s.addToast({title_i18n:"addons.reload.toast",title:"Reloaded Add-On",text_i18n:"addons.reload.toast.text",text:'Successfully reloaded add-on "{addon_id}" in {duration}ms.',icon:"ffz-i-info",addon_id:e,timeout:5e3,duration:Math.round(100*(g-n))/100})}async _enableAddon(e){const i=this.getAddon(e);if(!i)throw new Error(`Unknown add-on id: ${e}`);if(Array.isArray(i.load_events))for(const n of i.load_events)this.load_tracker.schedule(n,`addon.${e}`);await this.loadAddon(e);const s=this.resolve(`addon.${e}`);if(s&&!s.enabled&&await s.enable(),Array.isArray(i.load_events))for(const n of i.load_events)this.load_tracker.notify(n,`addon.${e}`,!1)}async loadAddon(e){const i=this.getAddon(e);if(!i)throw new Error(`Unknown add-on id: ${e}`);await this.i18n.loadChunk(`addon.${e}`);let s=this.resolve(`addon.${e}`);if(s){s.loaded||await s.load(),this.emit(":addon-loaded",e);return}document.head.appendChild((0,re.createElement)("script",{id:`ffz-loaded-addon-${i.id}`,type:"text/javascript",src:i.src||`${i.dev?"https://localhost:8001/script":f.SERVER_OR_EXT}/addons/${i.id}/script.js?_=${(0,Ce.getBuster)(30)}`,crossorigin:"anonymous"})),await(0,r.timeout)(this.waitFor(`addon.${e}:registered`),6e4),s=this.resolve(`addon.${e}`),s&&!s.loaded&&await s.load(),this.emit(":addon-loaded",e)}unloadAddon(e){const i=this.resolve(`addon.${e}`);if(i)return i.unload()}enableAddon(e,i=!0){const s=this.getAddon(e);if(!s)throw new Error(`Unknown add-on id: ${e}`);if(!this.isAddonEnabled(e)){if(Array.isArray(s.requires))for(const n of s.requires){if(!this.hasAddon(n))throw new Error(`Unknown add-on id: ${n}`);this.enableAddon(n)}this.emit(":addon-enabled",e),this.enabled_addons.push(e),i&&this.settings.provider.set("addons.enabled",this.enabled_addons),this.doesAddonTarget(e)&&this._enableAddon(e).catch(n=>{this.log.error(`An error occured while enabling the add-on "${e}":`,n),this.log.capture(n)})}}async disableAddon(e,i=!0){const s=this.getAddon(e);if(!s)throw new Error(`Unknown add-on id: ${e}`);if(this.isAddonExternal(e))throw new Error(`Cannot disable external add-on with id: ${e}`);if(this.isAddonEnabled(e)){if(Array.isArray(s.required_by)){const n=[];for(const o of s.required_by)n.push(this.disableAddon(o));await Promise.all(n)}this.emit(":addon-disabled",e),this.enabled_addons.splice(this.enabled_addons.indexOf(e),1),i&&this.settings.provider.set("addons.enabled",this.enabled_addons);try{const n=this.resolve(`addon.${e}`);n&&await n.disable()}catch{this.reload_required=!0,this.emit(":reload-required")}}}};B(ds,"AddonManager");let Ne=ds;/*! js-cookie v3.0.5 | MIT */function We(k){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)k[s]=i[s]}return k}B(We,"js_cookie_assign");var Xe={read:function(k){return k[0]==='"'&&(k=k.slice(1,-1)),k.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(k){return encodeURIComponent(k).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function de(k,e){function i(n,o,h){if(!(typeof document>"u")){h=We({},e,h),typeof h.expires=="number"&&(h.expires=new Date(Date.now()+h.expires*864e5)),h.expires&&(h.expires=h.expires.toUTCString()),n=encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var g="";for(var E in h)h[E]&&(g+="; "+E,h[E]!==!0&&(g+="="+h[E].split(";")[0]));return document.cookie=n+"="+k.write(o,n)+g}}B(i,"set");function s(n){if(!(typeof document>"u"||arguments.length&&!n)){for(var o=document.cookie?document.cookie.split("; "):[],h={},g=0;g<o.length;g++){var E=o[g].split("="),R=E.slice(1).join("=");try{var T=decodeURIComponent(E[0]);if(h[T]=k.read(R,T),n===T)break}catch{}}return n?h[n]:h}}return B(s,"get"),Object.create({set:i,get:s,remove:function(n,o){i(n,"",We({},o,{expires:-1}))},withAttributes:function(n){return de(this.converter,We({},this.attributes,n))},withConverter:function(n){return de(We({},this.converter,n),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(k)}})}B(de,"init");var ke=de(Xe,{path:"/"}),Oe=X(99968),Ve=X.n(Oe);const nt="experiment_overrides",ot={expires:7,domain:".twitch.tv"},At=X(77074);var kt=(k=>(k[k.Unknown=0]="Unknown",k[k.Device=1]="Device",k[k.User=2]="User",k[k.Channel=3]="Channel",k))(kt||{});function It(k){return"t"in k}B(It,"isTwitchExperiment");function Bt(k){return"description"in k}B(Bt,"isFFZExperiment");function Et(k,e){return k.rarity<e.rarity?-1:k.rarity>e.rarity?1:k.name<e.name?-1:k.name>e.name?1:0}B(Et,"sortExperimentLog");const Wi=class Wi extends d.default{constructor(e,i){super(e,i),this.settings=null,this.get=this.getAssignment,this.inject("settings"),this.settings.addUI("experiments",{path:"Debugging > Experiments",component:"experiments",no_filter:!0,getExtraTerms:()=>{const s=[];for(const[n,o]of Object.entries(this.experiments))s.push(n),o.name&&s.push(o.name),o.description&&s.push(o.description);for(const[n,o]of Object.entries(this.getTwitchExperiments()))s.push(n),o.name&&s.push(o.name);return s},is_locked:()=>this.getControlsLocked(),unlock:()=>this.unlockControls(),unique_id:()=>this.unique_id,ffz_data:()=>(0,r.deep_copy)(this.experiments),twitch_data:()=>(0,r.deep_copy)(this.getTwitchExperiments()),usingTwitchExperiment:s=>this.usingTwitchExperiment(s),getTwitchAssignment:s=>this.getTwitchAssignment(s),getTwitchType:s=>this.getTwitchType(s),hasTwitchOverride:s=>this.hasTwitchOverride(s),setTwitchOverride:(s,n)=>this.setTwitchOverride(s,n),deleteTwitchOverride:s=>this.deleteTwitchOverride(s),getAssignment:s=>this.getAssignment(s),hasOverride:s=>this.hasOverride(s),setOverride:(s,n)=>this.setOverride(s,n),deleteOverride:s=>this.deleteOverride(s),on:(...s)=>this.on(...s),off:(...s)=>this.off(...s)}),this.unique_id=ke.get("unique_id"),this.Cookie=ke,this.experiments={},this.cache=new Map}getControlsLocked(){if(f.DEBUG)return!1;const e=this.settings.provider.get("exp-lock",0);return isNaN(e)||!isFinite(e)?!0:Date.now()-e>=864e5}unlockControls(){this.settings.provider.set("exp-lock",Date.now())}async onLoad(){await this.loadExperiments()}async loadExperiments(){let e;try{e=await(0,r.fetchJSON)(f.DEBUG?At:`${f.SERVER}/script/experiments.json?_=${(0,Ce.getBuster)()}`)}catch(n){this.log.warn("Unable to load experiment data.",n);return}if(!e)return;this.experiments=e;const i=this.cache;this.cache=new Map;let s=0;for(const[n,o]of i.entries()){const h=this.getAssignment(n);o!==h&&(s++,this.emit(":changed",n,h,o),this.emit(`:changed:${n}`,h,o))}this.log.info(`Loaded information on ${Object.keys(e).length} experiments.${s>0?` ${s} values updated.`:""}`)}onEnable(){this.on("pubsub:command:reload_experiments",this.loadExperiments,this),this.on("pubsub:command:update_experiment",e=>{this.updateExperiment(e.key,e.data)},this)}updateExperiment(e,i){if(this.log.info(`Received updated data for experiment "${e}" via PubSub.`,i),Array.isArray(i)){const s=this.experiments[e];if(!s)return;s.groups=i}else i?.groups&&(this.experiments[e]=i);this._rebuildKey(e)}generateLog(){const e=[`Unique ID: ${this.unique_id}`,""],i=[];for(const[o,h]of Object.entries(this.experiments)){const g=this.getAssignment(o),E=this.hasOverride(o);let R=0,T=0;for(const L of h.groups)L.value===g&&(R=L.weight),T+=L.weight;!E&&R===T||i.push({key:o,name:h.name,value:g,override:E,rarity:R/T})}i.sort(Et);for(const o of i)e.push(`FFZ | ${o.name}: ${o.value}${o.override?" (Override)":""} (r:${o.rarity})`);const s=[],n=this.settings.get("context.channel");for(const[o,h]of Object.entries(this.getTwitchExperiments())){if(!this.usingTwitchExperiment(o))continue;const g=this.getTwitchAssignment(o),E=this.hasTwitchOverride(o);let R=0,T=0;for(const L of h.groups)L.value===g&&(R=L.weight),T+=L.weight;!E&&R===T||s.push({key:o,name:h.name,value:g,override:E,type:this.getTwitchTypeByKey(o),rarity:R/T})}s.sort(Et);for(const o of s)e.push(`Twitch | ${o.name}: ${o.value}${o.override?" (Override)":""} (r:${o.rarity}, t:${o.type}${o.type==="channel_id"?`, c:${n}`:""})`);return e.join(`
`)}getTwitchType(e){const i=this.resolve("site")?.getCore?.();return i?.experiments?.getExperimentType?i.experiments.getExperimentType(e):e===1?"device_id":e===2?"user_id":e===3?"channel_id":e}getTwitchTypeByKey(e){const i=this.getTwitchExperiments(),s=i?.[e];return s?.t?this.getTwitchType(s.t):null}getTwitchExperiments(){if(window.__twilightSettings)return window.__twilightSettings.experiments??{};const e=this.resolve("site")?.getCore?.();return e&&e.experiments.experiments||{}}usingTwitchExperiment(e){const i=this.resolve("site")?.getCore?.();return i&&(0,r.has)(i.experiments.assignments,e)}_getOverrideCookie(){const e=ke.get(nt);let i;try{i=e?JSON.parse(e):{}}catch{i={}}return i.experiments||(i.experiments={}),i.disabled||(i.disabled=[]),i}_saveOverrideCookie(e){e&&(!e.experiments||!Object.keys(e.experiments).length)&&(!e.disabled||!e.disabled.length)&&(e=void 0),e?ke.set(nt,JSON.stringify(e),ot):ke.remove(nt,ot)}_checkExternalAccess(){let e;try{e=new Error().stack}catch(s){try{e=s.stack}catch{}}if(!e)return;e=e.split(/\s*\n+\s*/g).filter(s=>s.startsWith("at "));let i=!1;for(const s of e)if(!s.includes(f.SERVER_OR_EXT)){i=!0;break}i&&this.log.warn("Detected access by external script.")}setTwitchOverride(e,i){const s=this._getOverrideCookie(),n=s.experiments,o=s.disabled;this._checkExternalAccess(),n[e]=i;const h=o.indexOf(e);h!=-1&&o.splice(h,1),this._saveOverrideCookie(s);const g=this.resolve("site")?.getCore?.();g&&(g.experiments.overrides[e]=i),this._rebuildTwitchKey(e,!0,i)}deleteTwitchOverride(e){const i=this._getOverrideCookie(),s=i.experiments;if(this._checkExternalAccess(),!(0,r.has)(s,e))return;const n=s[e];delete s[e],this._saveOverrideCookie(i);const o=this.resolve("site")?.getCore?.();o&&delete o.experiments.overrides[e],this._rebuildTwitchKey(e,!1,n)}hasTwitchOverride(e){const i=this._getOverrideCookie(),s=i.experiments;return(0,r.has)(s,e)}getTwitchAssignment(e,i=null){const s=this.resolve("site")?.getCore?.(),n=s&&s.experiments;if(!n)return null;if(!n.hasInitialized&&n.initialize)try{n.initialize()}catch(g){this.log.warn("Error attempting to initialize Twitch experiments tracker.",g)}if(n.overrides&&n.overrides[e])return n.overrides[e];const o=n.experiments[e],h=this.getTwitchType(o?.t??0);return h==="channel_id"?n.getAssignmentById(e,{bucketing:{type:1,value:i??this.settings.get("context.channelID")}}):n.assignments?.[e]?n.assignments[e]:h==="device_id"?n.selectTreatment(e,o,this.unique_id):h==="user_id"?n.selectTreatment(e,o,this.resolve("site")?.getUser?.()?.id):null}getTwitchKeyFromName(e){const i=this.getTwitchExperiments();if(i){e=e.toLowerCase();for(const s in i)if((0,r.has)(i,s)){const n=i[s];if(n&&n.name&&n.name.toLowerCase()===e)return s}}}getTwitchAssignmentByName(e,i=null){const s=this.getTwitchKeyFromName(e);return s?this.getTwitchAssignment(s,i):null}_rebuildTwitchKey(e,i,s){const n=this.resolve("site")?.getCore?.(),o=n.experiments,h=(0,r.has)(o.assignments,e)?o.assignments[e]:null;if(h!==s){const g=i?s:h;this.emit(":twitch-changed",e,g,h),this.emit(`:twitch-changed:${e}`,g,h)}}setOverride(e,i){const s=this.settings.provider.get("experiment-overrides",{});s[e]=i,this.settings.provider.set("experiment-overrides",s),this._rebuildKey(e)}deleteOverride(e){const i=this.settings.provider.get("experiment-overrides");!i||!(0,r.has)(i,e)||(delete i[e],Object.keys(i).length?this.settings.provider.set("experiment-overrides",i):this.settings.provider.delete("experiment-overrides"),this._rebuildKey(e))}hasOverride(e){const i=this.settings.provider.get("experiment-overrides");return i?(0,r.has)(i,e):!1}getAssignment(e){if(this.cache.has(e))return this.cache.get(e);const i=this.experiments[e];if(!i)return this.log.warn(`Tried to get assignment for experiment "${e}" which is not known.`),null;const s=this.settings.provider.get("experiment-overrides"),n=s&&(0,r.has)(s,e)?s[e]:Wi.selectGroup(e,i,this.unique_id??"");return this.cache.set(e,n),n}_rebuildKey(e){if(!this.cache.has(e))return;const i=this.cache.get(e);this.cache.delete(e);const s=this.getAssignment(e);s!==i&&(this.emit(":changed",e,s,i),this.emit(`:changed:${e}`,s,i))}static selectGroup(e,i,s){const n=e+s+(i.seed||""),o=i.groups.reduce((g,E)=>g+E.weight,0);let h=(Ve()(n).words[0]>>>0)/Math.pow(2,32);for(const g of i.groups)if(h-=g.weight/o,h<=0)return g.value;return null}};B(Wi,"ExperimentManager");let Lt=Wi;var Dt=X(2356);const Qt=B((k,e)=>fetch(k,e).then(i=>i.ok?i.json():null).catch(()=>null),"fetchJSON"),Nt=/\s*at\s+(.+?)\s+\((.+)\)$/,jt=/^(.+):\/\/(.+?)(?:\?[a-zA-Z0-9]+)?:(\d+:\d+)$/,ut={filter(k){return k.includes(".frankerfacez.com")||k.includes("localhost")},cacheGlobally:!0},dt=["/src/i18n.js","/src/utilities/vue.js"],mt=["(\u30FB`\u03C9\xB4\u30FB)",";;w;;","owo","ono","oAo","oxo","ovo;","UwU",">w<","^w^","> w >","v.v"],Tt=B((k,e)=>k.map(i=>{if(typeof i=="string")return e(i);if(typeof i=="object"&&i.o){const s=Object.assign(i,{o:{}});for(const n of Object.keys(i.o))s.o[n]=Tt(i.o[n],e)}return i}),"transformText"),Rt=B(k=>k.replace(/(?:r|l)/g,"w").replace(/(?:R|L)/g,"W").replace(/n([aeiou])/g,"ny$1").replace(/N([aeiou])/g,"Ny$1").replace(/N([AEIOU])/g,"NY$1").replace(/ove/g,"uv").replace(/!+/g,` ${(0,r.pick_random)(mt)} `),"owo"),ei={double:(k,e)=>[...e," ",...e],upper:(k,e)=>Tt(e,i=>i.toUpperCase()),lower:(k,e)=>Tt(e,i=>i.toLowerCase()),append_key:(k,e)=>[...e,` (${k})`],set_key:k=>[k],owo:(k,e)=>Tt(e,Rt)},fs=class fs extends d.default{constructor(...e){super(...e),this.inject("settings"),this._seen=new Set,this.availableLocales=["en"],this.chunks=["client"],this.localeData={en:{name:"English"}},this.loadLocales(),this.strings_loaded=!1,this.new_strings=0,this.changed_strings=0,this.capturing=!1,this.captured=new Map,this.settings.addUI("i18n.debug.open",{path:"Debugging > Localization >> Editing",component:"i18n-open",force_seen:!0}),this.settings.add("i18n.debug.capture",{default:null,process(i,s){return s===null?f.DEBUG:s},ui:{path:"Debugging > Localization >> General",title:"Enable message capture.",description:"Capture all localized strings, including variables and call locations, for the purpose of reporting them to the backend. This is used to add new strings to the translation project. By default, message capture is enabled when running in development mode.",component:"setting-check-box",force_seen:!0},changed:i=>{this.capturing=i}}),this.settings.add("i18n.debug.transform",{default:null,ui:{path:"Debugging > Localization >> General",title:"Transformation",description:"Transform all localized strings to test string coverage as well as length.",component:"setting-select-box",data:[{value:null,title:"Disabled"},{value:"upper",title:"Upper Case"},{value:"lower",title:"Lower Case"},{value:"append_key",title:"Append Key"},{value:"set_key",title:"Set to Key"},{value:"double",title:"Double"},{value:"owo",title:"owo what's this"}]},changed:i=>{this._.transformation=ei[i],this.emit(":transform"),this.emit(":update")}}),this.settings.add("i18n.locale",{default:-1,process:(i,s)=>{if((s===-1||typeof s!="string")&&(s=i.get("context.session.languageCode")||"en"),this.availableLocales.includes(s))return s;if(s==="no"&&this.availableLocales.includes("nb"))return"nb";const n=s.indexOf("-");return n===-1?"en":(s=s.slice(0,n),this.availableLocales.includes(s)?s:"en")},ui:{path:'Appearance > Localization >> General @{"sort":-100}',title:"Language",description:"FrankerFaceZ is lovingly translated by volunteers from our community. Thank you. If you're interested in helping to translate FrankerFaceZ, please [join our Discord](https://discord.gg/UrAkGhT) and ask about localization.",component:"setting-select-box",data:(i,s)=>this.getLocaleOptions(s)},changed:i=>this.locale=i}),this.settings.add("i18n.format.date",{default:"default",ui:{path:"Appearance > Localization >> Formatting",title:"Date Format",description:"The default date format. Custom date formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"date",component:"format-preview"},data:()=>{const i=[],s=new Date;for(const[n,o]of Object.entries(this._.formats.date))i.push({value:n,title:`${this.formatDate(s,n)} (${n})`});return i}},changed:i=>{this._.defaultDateFormat=i,this.emit(":update")}}),this.settings.add("i18n.format.time",{default:"short",ui:{path:"Appearance > Localization >> Formatting",title:"Time Format",description:"The default time format. Custom time formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"time",component:"format-preview"},data:()=>{const i=[],s=new Date;for(const[n,o]of Object.entries(this._.formats.time))i.push({value:n,title:`${this.formatTime(s,n)} (${n})`});return i}},changed:i=>{this._.defaultTimeFormat=i,this.emit(":update")}}),this.settings.add("i18n.format.datetime",{default:"medium",ui:{path:"Appearance > Localization >> Formatting",title:"Date-Time Format",description:"The default combined date-time format. Custom time formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"datetime",component:"format-preview"},data:()=>{const i=[],s=new Date;for(const[n,o]of Object.entries(this._.formats.datetime))i.push({value:n,title:`${this.formatDateTime(s,n)} (${n})`});return i}},changed:i=>{this._.defaultDateTimeFormat=i,this.emit(":update")}})}getLocaleOptions(e){e===void 0&&(e=this.settings.get("i18n.locale"));const i=[],s=[];for(const o of this.availableLocales){const h=this.localeData[o];let g=h?.native_name||h?.name||o;h?.coverage!=null&&h?.coverage<100&&(g=this.t("i18n.locale-coverage","{name} ({coverage,number,percent} Complete)",{name:g,coverage:h.coverage/100}));const E={selected:e===o,value:o,title:g};h?.joke?s.push(E):i.push(E)}i.sort((o,h)=>o.title.localeCompare(h.title)),s.sort((o,h)=>o.title.localeCompare(h.title));let n=[{selected:e===-1,value:-1,i18n_key:"setting.appearance.localization.general.language.twitch",title:"Use Twitch's Language"}];return i.length&&(n.push({separator:!0,i18n_key:"setting.appearance.localization.general.language.languages",title:"Supported Languages"}),n=n.concat(i)),s.length&&(n.push({separator:!0,i18n_key:"setting.appearance.localization.general.language.joke",title:"Joke Languages"}),n=n.concat(s)),n}onEnable(){this.capturing=this.settings.get("i18n.debug.capture"),this.capturing&&this.loadStrings(),this._=new Dt.default({warn:(...e)=>this.log.warn(...e),defaultDateFormat:this.settings.get("i18n.format.date"),defaultTimeFormat:this.settings.get("i18n.format.time"),defaultDateTimeFormat:this.settings.get("i18n.format.datetime")}),window.BroadcastChannel&&(this._broadcaster=new BroadcastChannel("ffz-i18n")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this)),this._.transformation=ei[this.settings.get("i18n.debug.transform")],this.locale=this.settings.get("i18n.locale")}async loadChunk(e){if(this.chunks.includes(e))return[];this.chunks.push(e);const i=this._.locale,s=await this.loadLocale(i,e),n=this._.extend(s);return n.length&&(this.log.info(`Loaded Chunk: ${e} -- Phrases: ${n.length}`),this.emit(":loaded",n),this.emit(":update")),n}broadcast(e){this._broadcaster&&this._broadcaster.postMessage(e)}getKeys(){const e=[];for(const i of this.captured.values()){const s=(0,r.deep_copy)(i);s.translation=this._.phrases.get(s.key)||s.phrase,e.push(s)}return e}requestKeys(){this.broadcast({type:"request-keys"})}updatePhrase(e,i){this.broadcast({type:"update-key",key:e,phrase:i}),this._.extend({[e]:i}),this.emit(":loaded",[e]),this.emit(":update")}handleMessage(e){const i=e.data;if(i){if(i.type==="update-key")this._.extend({[i.key]:i.phrase}),this.emit(":loaded",[i.key]),this.emit(":update");else if(i.type==="request-keys")this.broadcast({type:"keys",data:Array.from(this.captured.values())});else if(i.type==="keys"&&Array.isArray(i.data)){for(const s of i.data)this.captured.set(s.key,s);this.emit(":got-keys")}}}openUI(e=!0){this.capturing||(this.capturing=!0,this.emit(":update"));const i=this.resolve("translation_ui");e?i.openPopout():i.enable()}get dayjsLocale(){return this._?._dayjs_locale}get locale(){return this._&&this._.locale}set locale(e){this.setLocale(e)}async loadStrings(e=!1){if(this.strings_loaded&&!e||this.strings_loading)return;this.strings_loading=!0;const i=await fetch(`${f.SERVER}/script/locale/strings.json?_=${(0,Ce.getBuster)(30)}`);let s;i.ok?s=await i.json():(this.log.warn(`Error Loading Strings -- Status: ${i.status}`),s=[]);for(const n of s){const o=n.id;let h=this.captured.get(o);if(h||(this.captured.set(o,h={key:o,phrase:n.default,hits:0,calls:[]}),n.source?.length&&h.calls.push(n.source)),!h.options&&n.context?.length)try{h.options=JSON.parse(n.context)}catch{}h.known=n.default,h.different=n.default!==h.phrase}this.new_strings=0,this.changed_strings=0;for(const n of this.captured.values())n.known||this.new_strings++,n.different&&this.changed_strings++;this.strings_loaded=!0,this.strings_loading=!1,this.log.info(`Loaded ${s.length} strings from the server.`),this.emit(":strings-loaded"),this.emit(":new-strings",this.new_strings),this.emit(":changed-strings",this.changed_strings)}see(e,i,s){if(!this.capturing)return;let n;try{n=new Error().stack}catch(h){try{n=h.stack}catch{}}let o=this.captured.get(e);o||(this.captured.set(e,o={key:e,phrase:i,hits:0,calls:[]}),this.strings_loaded&&(this.new_strings++,this.emit(":new-strings",this.new_strings))),i!==o.phrase&&(o.phrase=i,o.known&&i!==o.known&&!o.different&&(o.different=!0,this.changed_strings++,this.emit(":changed-strings",this.changed_strings))),o.options=this.pluckVariables(e,s),o.hits++,n&&(this.mapStackTrace?this.mapStackTrace(n,h=>this.recordCall(o,h),ut):Promise.all([X.e(7852),X.e(1871)]).then(X.t.bind(X,58194,23)).then(h=>{this.mapStackTrace=h.mapStackTrace,this.mapStackTrace(n,g=>this.recordCall(o,g),ut)}))}pluckVariables(e,i){const s=this._.cache.get(e);if(!s)return null;const n={};return this._doPluck(s,i,n),Object.keys(n).length?n:null}_doPluck(e,i,s){if(Array.isArray(e)){for(const n of e)this._doPluck(n,i,s);return}if(typeof e=="object"&&e.v){const n=(0,r.get)(e.v,i);if(n&&n.$$typeof)return;s[e.v]=(0,r.shallow_copy)(n)}}recordCall(e,i){if(Array.isArray(i))for(const s of i){const n=Nt.exec(s);if(!n)continue;const o=jt.exec(n[2]);if(!o||o[1]!=="webpack")continue;const h=o[2];if(h.includes("/node_modules/")||dt.includes(h))continue;let g;if(n[1]==="MainMenu.getSettingsTree")g="FFZ Control Center";else{let E=n[1];(E==="Proxy.render"||E.startsWith("Proxy.push"))&&o[2].includes(".vue")&&(E="Vue Component"),g=`${E} (${o[2]}:${o[3]})`}e.calls.includes(g)||e.calls.push(g);return}}async loadLocales(){const e=await fetch(`${f.SERVER}/script/locale/locales.json?_=${(0,Ce.getBuster)(30)}`);let i;e.ok?i=await e.json():this.log.warn(`Error Populating Locales -- Status: ${e.status}`),(!Array.isArray(i)||!i.length)&&(i=[{id:"en",name:"English",coverage:100,rtl:!1,hashes:{}}]),this.localeData={},this.availableLocales=[];for(const s of i){const n=s.id.toLowerCase();this.localeData[n]=s,this.availableLocales.push(n)}this.emit(":locales-loaded")}async loadLocale(e,i=null){if(e=e.toLowerCase(),e==="en")return{};const s=this.localeData[e]?.hashes;if(!s)return this.log.info(`Cannot Load Locale: ${e}`),{};i?Array.isArray(i)||(i=[i]):i=this.chunks;const n=this.localeData[e].id,o=[];for(const R of i){const T=s[R];T&&o.push(Qt(`https://cdn2.frankerfacez.com/static/locale/${n}/${R}.${T}.json`))}const h=await Promise.all(o),g={};let E=0;for(const R of h)if(R)for(const[T,L]of Object.entries(R))typeof L=="string"&&L.length>0?g[T]=L:E++;return E>0&&this.log.debug(`Ignored ${E} invalid values while loading ${e} chunks.`),g}async setLocale(e){e=e.toLowerCase();const i=this._.locale;if(e===i)return[];if(this._.locale=e,this._.clear(),this.log.info(`Changed Locale: ${e} -- Old: ${i}`),this.emit(":changed",e,i),this.emit(":update"),e==="en")return this.emit(":loaded",[]),this._._dayjs_locale="en",[];const s=this.localeData[e],n=await this.loadLocale(s?.id||e);let o;try{o=s?.dayjs_override||e,await this.loadDayjsLocale(o)}catch{this.log.warn(`Unable to load DayJS locale for ${e}`),o="en"}if(this._.locale!==e)throw new Error("locale has changed since we started loading");this._._dayjs_locale=o;const h=this._.extend(n);return h.length&&(this.log.info(`Loaded Locale: ${e} -- Phrases: ${h.length}`),this.emit(":loaded",h),this.emit(":update")),h}async loadDayjsLocale(e){if(!(e==="en"||e==="en-arrr"))try{await X(73637)(`./${e}.js`)}catch(i){this.log.warn(`Unable to load day.js locale data for locale "${e}"`,i)}}has(e){return this._.has(e)}formatNode(...e){return this._.formatNode(...e)}toLocaleString(...e){return this._.toLocaleString(...e)}toRelativeTime(...e){return this._.formatRelativeTime(...e)}formatNumber(...e){return this._.formatNumber(...e)}formatCurrency(...e){return this._.formatCurrency(...e)}formatDuration(...e){return this._.formatDuration(...e)}formatDate(...e){return this._.formatDate(...e)}formatTime(...e){return this._.formatTime(...e)}formatDateTime(...e){return this._.formatDateTime(...e)}t(e,...i){return this.see(e,...i),this._.t(e,...i)}tList(e,...i){return this.see(e,...i),this._.tList(e,...i)}};B(fs,"TranslationManager");let Jt=fs;const hi=/\$/g,lt=String.prototype.replace,tt=/^\s*([^(]+?)\s*(?:\(\s*([^)]+?)\s*\))?\s*$/;function $t(k){if(!k||!k.length)return;const e=[];for(const i of k.split(/\|/g)){const s=tt.exec(i);s&&e.push({fmt:s[1],extra:s[2]})}return e}B($t,"parseFormatters");function Ot(k,e,i,s,n){const o=Array.isArray(k);if(e==null)return o?k[0]:k;let h=k;const g=typeof e=="number"?{count:e}:e;return o&&(h=h[0]),typeof h=="string"&&(h=lt.call(h,s,(E,R,T)=>{let L=(0,r.get)(R.trim(),g);if(L==null)return"";const q=$t(T);let le=!1;if(q)for(const pe of q){const fe=n[pe.fmt];typeof fe=="function"&&(L=fe(L,i,g,pe.extra),le=!0)}return!le&&typeof L=="string"&&(L=lt.call(L,hi,"$$")),L})),h}B(Ot,"transformPhrase");var St=(k=>(k[k.Disconnected=0]="Disconnected",k[k.Connecting=1]="Connecting",k[k.Connected=2]="Connected",k))(St||{});function Ft(k){let e=k.length;const i=[k];for(;(e=k.lastIndexOf("/",e-1))!==-1;)i.push(`${k.slice(0,e)}/*`);return i.push("*"),i}B(Ft,"enumerateSubs");const ps=class ps extends v.EventEmitter{constructor(){super(),this._ws=null,this._topics=new Set,this._live_topics=new Set,this._want_connection=!1,this._state=0,this._reconnectTimer=null,this._failedConnections=0,this._performReconnect=this._performReconnect.bind(this)}_reconnect(e=!0){if(this._reconnectTimer)return;let i=250+(e?Math.floor(this._failedConnections*(Math.random()*5e3)+5e3):0);this._reconnectTimer=setTimeout(this._performReconnect,i)}_performReconnect(){if(this._reconnectTimer=null,this._ws&&(this._ws.close(),this._ws=null,this._state=0),this._live_topics=new Set(this._topics),!this._live_topics.size)return;this._state=1;const e=new URL("wss://pubsub.workers.frankerfacez.com/ws");if(this._live_topics.size>10)e.searchParams.append("t","*");else for(const s of this._live_topics)e.searchParams.append("t",s);const i=this._ws=new WebSocket(e.toString());i.addEventListener("open",s=>{this._state=2,this._failedConnections=0,this.emit("connect",s)}),i.addEventListener("error",s=>{this.emit("error",s)}),i.addEventListener("close",s=>{this._ws=null,this._state=0,this.emit("disconnect",s),this._want_connection&&this._reconnect()}),i.addEventListener("message",s=>{if(typeof s.data=="string"){let n;try{n=JSON.parse(s.data)}catch{return}if(!n.topic||typeof n.topic!="string")return;if(this._live_topics.size>10&&!this._live_topics.has(n.topic)){let o=!1;for(const h of Ft(n.topic))if(this._live_topics.has(h)){o=!0;break}if(!o)return}this.emit("message",n)}})}get connected(){return this._state===2}get connecting(){return this._state===1}get disconnected(){return this._state===0}connect(){this._want_connection=!0,this._reconnect(!1)}disconnect(){this._want_connection=!1,this._failedConnections=0,this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=null),this._ws&&(this._ws.close(),this._ws=null,this._state=0,this.emit("disconnect",null))}subscribe(e){Array.isArray(e)||(e=[e]);for(const i of e)this._topics.add(i);this._want_connection&&!(0,r.set_equals)(this._topics,this._live_topics)&&this._reconnect()}unsubscribe(e){Array.isArray(e)||(e=[e]);for(const i of e)this._topics.delete(i);this._want_connection&&!(0,r.set_equals)(this._topics,this._live_topics)&&this._reconnect()}};B(ps,"PubSubClient");let pt=ps;const ms=class ms extends d.default{constructor(e,i){super(e,i),this.experiments=null,this.settings=null,this.inject("settings"),this.inject("experiments"),this.settings.add("pubsub.enabled",{default:()=>this.experiments.getAssignment("worker_pubsub")??!1,ui:{path:'Debugging @{"expanded": false, "sort": 9999} > PubSub >> General',title:"Enable PubSub.",description:"Whether or not you want your client to connect to FrankerFaceZ's PubSub system. This is still in testing and should be left alone unless you know what you're doing.",force_seen:!0,component:"setting-check-box"},changed:s=>s?this.connect():this.disconnect()}),this._topics=new Map,this._client=null}onEnable(){this.subscribe(null,"global"),this.connect(),this.on("experiments:changed:worker_pubsub",this._updateSetting,this)}onDisable(){this.off("experiments:changed:worker_pubsub",this._updateSetting,this),this.disconnect(),this.unsubscribe(null,"global")}_updateSetting(){this.settings.update("pubsub.enabled")}get connected(){return this._client!=null}reconnect(){this.disconnect(),this.connect()}async connect(){if(this._client||!this.settings.get("pubsub.enabled"))return;const e=this._client=new pt;e.on("connect",()=>{this.log.info("Connected to PubSub.")}),e.on("disconnect",()=>{this.log.info("Disconnected from PubSub.")}),e.on("error",s=>{this.log.error("Error in PubSub",s)}),e.on("message",s=>{const n=s.topic,o=s.data;if(!o?.cmd){this.log.debug(`Received message on topic "${n}":`,o),this.emit(":message",n,o);return}o.topic=n,this.log.debug(`Received command on topic "${n}" for command "${o.cmd}":`,o.data),this.emit(`:command:${o.cmd}`,o.data,o)});const i=[...this._topics.keys()];e.subscribe(i),await e.connect()}disconnect(){this._client&&(this._client.disconnect(),this._client=null)}subscribe(e,...i){const s=this._topics;let n=!1;for(const o of i){let h=s.get(o);h?h.add(e):(this._client&&this._client.subscribe(o),h=new Set,h.add(e),s.set(o,h),n=!0)}n&&this.emit(":sub-change")}unsubscribe(e,...i){const s=this._topics;let n=!1;for(const o of i){const h=s.get(o);h&&(h.delete(e),h.size||(n=!0,s.delete(o),this._client&&this._client.unsubscribe(o)))}n&&this.emit(":sub-change")}get topics(){return Array.from(this._topics.keys())}};B(ms,"PubSub");let et=ms;const gs=class gs extends d.default{constructor(e,i){super(e,i),this.settings=null,this.api=f.API_SERVER,this.cdn=f.SERVER,this.active=!1,this.inject("settings"),this.settings.add("data.use-staging",{default:!1,ui:{path:'Debugging > Data Sources >> Staging @{"sort": -1}',force_seen:!0,title:"Use staging as data source.",component:"setting-check-box"}}),this.updateStaging(!1)}onEnable(){this.settings.getChanges("data.use-staging",this.updateStaging,this)}updateStaging(e){this.active=e,this.api=e?f.STAGING_API:f.API_SERVER,this.cdn=e?f.STAGING_CDN:f.SERVER,this.emit(":updated",this.api,this.cdn)}};B(gs,"StagingSelector");let at=gs;const _s=class _s extends d.default{constructor(e,i){super(e,i),this.pending_loads=new Map,this.settings=null,this.should_enable=!0,this.inject("settings"),this.settings.add("chat.update-when-loaded",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Update existing chat messages when loading new data.",component:"setting-check-box",description:"This may cause elements in chat to move, so you may wish to disable this when performing moderation."}})}onEnable(){this.on(":schedule",this.schedule)}schedule(e,i){let s=this.pending_loads.get(e);(!s||!s.pending||!s.timers)&&(s={pending:new Set,timers:{},success:!1},this.pending_loads.set(e,s)),!s.pending.has(i)&&(s.pending.add(i),s.timers[i]=setTimeout(()=>this.notify(e,i,!1),15e3))}notify(e,i,s=!0){const n=this.pending_loads.get(e);if(!(!n||!n.pending||!n.timers)&&(n.timers[i]&&(clearTimeout(n.timers[i]),n.timers[i]=null),!!n.pending.has(i)&&(n.pending.delete(i),s&&(n.success=!0),!n.pending.size))){const o=Object.keys(n.timers);this.log.debug("complete",e,o),n.success&&this.emit(`:complete:${e}`,o),this.pending_loads.delete(e)}}};B(_s,"LoadTracker");let gt=_s;var ft=X(33612),rt=X(98247),_t=X(45866),vt=X(29632),Ut=X(27040);const bs=class bs extends d.default{constructor(e,i){super(e,i),this.rules={},this.chunks={},this._toggle_state={},this._chunks_loaded=!1,this._loadChunks=(0,r.once)(this._loadChunks)}get chunks_loaded(){return this._chunks_loaded}get loader(){return this._chunk_loader}set loader(e){e!==this._chunk_loader&&(this._chunks_loaded=!1,this._chunk_loader=e)}get style(){return this._style||(this._style=new re.ManagedStyle),this._style}toggleHide(e,i){const s=`hide--${e}`;if(i=i!=null?!!i:!this._toggle_state[s],this._toggle_state[s]!==i){if(this._toggle_state[s]=i,!i){this._style&&this._style.delete(s);return}if(!(0,r.has)(this.rules,e))throw new Error(`unknown rule "${e}" for toggleHide`);this.style.set(s,`${this.rules[e]}{display:none !important}`)}}toggle(e,i){i=i!=null?!!i:!this._toggle_state[e],this._toggle_state[e]!=i&&(this._toggle_state[e]=i,this._apply(e))}_apply(e){if(!this._toggle_state[e]){this._style&&this._style.delete(e);return}this.style.has(e)||(this._chunks_loaded?(0,r.has)(this.chunks,e)?this.style.set(e,this.chunks[e]):this.log.warn(`Unknown chunk name "${e}" for toggle()`):this._loadChunks().then(()=>this._apply(e)))}set(e,i){return this.style.set(e,i)}delete(e){this._style&&this._style.delete(e)}setVariable(e,i,s="body"){this.style.set(`var--${e}`,`${s}{--ffz-${e}:${i};}`)}deleteVariable(e){this._style&&this._style.delete(`var--${e}`)}async _loadChunks(){if(this._chunks_loaded)return;if(!this._chunk_loader){this._chunks_loaded=!0;return}const e=[];for(const i of this._chunk_loader.keys()){const s=i.slice(2,i.length-(i.endsWith(".scss")?5:4));e.push(this._chunk_loader(i).then(n=>{typeof n?.default=="string"&&(this.chunks[s]=n.default)}))}await Promise.all(e),this._chunks_loaded=!0}};B(bs,"CSSTweaks");let Gt=bs;var gi=X(10789);const ys=class ys extends gi.Z{constructor(...e){super(...e),this.Player=this.fine.define("highwind-player",i=>i.setPlayerActive&&i.props?.playerEvents&&i.props?.mediaPlayerInstance),this.PlayerSource=this.fine.define("player-source",i=>i.setSrc&&i.setInitialPlaybackSettings)}};B(ys,"Player");let Vt=ys;var Mt=X(14873),Ci=X(83342),qt=X(75271);const vs=class vs extends d.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("chat.overrides"),this.inject("site.fine"),this.ChatLine=this.fine.define("clip-chat-line",i=>i.renderFragments&&i.renderUserBadges),this.render=!0,this.messages=new WeakMap,window.toggleLines=()=>{this.render=!this.render,this.updateLines()}}onEnable(){this.on("chat.overrides:changed",e=>this.updateLinesByUser(e,null,!1,!1),this),this.on("chat:update-lines-by-user",this.updateLinesByUser,this),this.on("chat:update-line",this.updateLineById,this),this.on("chat:update-lines",this.updateLines,this),this.on("chat:rerender-lines",this.rerenderLines,this),this.on("chat:update-line-tokens",this.updateLineTokens,this),this.on("chat:update-line-badges",this.updateLineBadges,this),this.on("i18n:update",this.rerenderLines,this);for(const e of f.RERENDER_SETTINGS)this.chat.context.on(`changed:${e}`,this.rerenderLines,this);for(const e of f.UPDATE_TOKEN_SETTINGS)this.chat.context.on(`changed:${e}`,this.updateLineTokens,this);for(const e of f.UPDATE_BADGE_SETTINGS)this.chat.context.on(`changed:${e}`,this.updateLineBadges,this);this.chat.context.on("changed:tooltip.link-images",this.maybeUpdateLines,this),this.chat.context.on("changed:tooltip.link-nsfw-images",this.maybeUpdateLines,this),this.on("chat:get-messages",(e,i,s,n)=>{if(e)for(const o of this.ChatLine.instances){const h=this.standardizeMessage(o.props.node,o.props.video);h&&n.push({message:h,_instance:o,update:()=>o.forceUpdate()})}}),this.site=this.resolve("site"),this.ChatLine.ready(e=>{const i=this,s=e.prototype.render;e.prototype.render=function(){try{if(this._ffz_no_scan=!0,!i.render)return s.call(this);const n=i.standardizeMessage(this.props.node,this.props.video),o=i.chat.context.get("chat.emotes.animated")===2,h=n.is_action,g=h?i.chat.context.get("chat.me-style"):0,E=g>=2,R=g===1||g===3,T=n.user,L=i.overrides.getColor(T.id)||T.color,q=i.parent.colors.process(L),le=i.site.getUser(),pe=n.ffz_tokens=n.ffz_tokens||i.chat.tokenizeMessage(n,le),fe=i.chat.formatUser(T,qt.createElement),De=i.overrides.getName(T.id);let Ae=n.ffz_user_class;Ae instanceof Set?Ae=[...Ae].join(" "):Array.isArray(Ae)&&(Ae=Ae.join(" "));const ye={className:`clip-chat__message-author tw-font-size-5 ffz-link notranslate tw-strong${De?" ffz--name-override tw-relative ffz-il-tooltip__container":""} ${Ae??""}`,href:`https://www.twitch.tv/${T.login}/clips`,style:{color:q}};n.ffz_user_props&&Object.assign(ye,n.ffz_user_props),n.ffz_user_style&&Object.assign(ye.style,n.ffz_user_style);const Ie=(0,qt.createElement)("a",ye,De?[(0,qt.createElement)("span",{className:"chat-author__display-name"},De),(0,qt.createElement)("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},fe)]:fe);return(0,qt.createElement)("div",{class:"tw-mg-b-1"},(0,qt.createElement)("div",{"data-a-target":"tw-animation-target",class:"ffz--clip-chat-line tw-animation tw-animation--animate tw-animation--duration-short tw-animation--fill-mode-both tw-animation--slide-in-bottom tw-animation--timing-ease","data-room-id":n.roomID,"data-room":n.roomLogin,"data-user-id":T.id,"data-user":T.login,onMouseOver:o?i.chat.emotes.animHover:null,onMouseOut:o?i.chat.emotes.animLeave:null},(0,qt.createElement)("span",{class:"chat-line__message--badges"},i.chat.badges.render(n,qt.createElement)),Ie,(0,qt.createElement)("div",{class:"tw-inline-block tw-mg-r-05"},h?"":":"),(0,qt.createElement)("span",{class:`message${E?" chat-line__message-body--italicized":""}`,style:{color:R?q:null}},i.chat.renderTokens(pe,qt.createElement))))}catch(n){i.log.error(n),i.log.capture(n,{extra:{props:this.props}})}return s.call(this)},this.ChatLine.forceUpdate()})}updateLinesByUser(e,i){for(const s of this.ChatLine.instances){const n=s.props.node,o=n?.commentor;o&&(e&&e==o.id||i&&i==o.login)&&(this.messages.delete(n),s.forceUpdate())}}updateLineById(e,i=!0,s=null){s==null&&(s=i);for(const n of this.ChatLine.instances){const o=n.props.node;if(o?.id===e){(i||s)&&this.messages.delete(o),n.forceUpdate();return}}}maybeUpdateLines(){this.chat.context.get("chat.rich.all-links")&&this.updateLines()}updateLines(){return this._updateLines()}rerenderLines(){this.ChatLine.forceUpdate()}updateLineTokens(){return this._updateLines(!0,!1)}updateLineBadges(){return this._updateLines(!1,!0)}_updateLines(e=!0,i=!0){for(const s of this.ChatLine.instances){const n=s.props.node;this.messages.delete(n)}this.ChatLine.forceUpdate()}standardizeMessage(e,i){if(!e||!e.message)return e;if(this.messages.has(e))return this.messages.get(e);const s=this.chat.getRoom(i.owner.id,null,!0,!0),n=e.commenter||{},o={};if(e.message.userBadges)for(const g of e.message.userBadges)g?.setID&&(o[g.setID]=g.version);const h={user:{color:n.chatColor,id:n.id,login:n.login,displayName:n.displayName,isIntl:n.login&&n.displayName&&n.displayName.trim().toLowerCase()!==n.login,type:"user"},roomLogin:s&&s.login,roomID:s&&s.id,badges:o,id:e.id,ffz_badges:this.chat.badges.getBadges(n.id,n.login,s?.id,s?.login),messageParts:e.message.fragments};return this.detokenizeMessage(h,e),this.messages.set(e,h),h}detokenizeMessage(e){const i=[],s=e.messageParts,n=s.length,o={};let h=0;for(let g=0;g<n;g++){const E=s[g],R=E&&E.text;if(!R||!R.length)continue;const T=(0,r.split_chars)(R).length;if(E.emote){const L=E.emote.emoteID;(o[L]=o[L]||[]).push({startIndex:h,endIndex:h+T-1})}i.push(R),h+=T}return e.message=i.join(""),e.ffz_emotes=o,e}};B(vs,"Line");let _i=vs;const ws=class ws extends d.default{constructor(...e){super(...e),this.colors=new Mt.ColorAdjuster,this.inverse_colors=new Mt.ColorAdjuster,this.inject("settings"),this.inject("i18n"),this.settings.add("theme.is-dark",{requires:["context.ui.theme"],process(i){return i.get("context.ui.theme")===1}}),this.inject("chat"),this.inject("site.twitch_data"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject(_i),this.ChatController=this.fine.define("clip-chat-controller",i=>i.filterChatLines)}onEnable(){this.chat.context.on("changed:chat.font-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.font-family",this.updateChatCSS,this),this.chat.context.on("changed:chat.lines.emote-alignment",this.updateChatCSS,this),this.chat.context.on("changed:chat.adjustment-mode",this.updateColors,this),this.chat.context.on("changed:chat.adjustment-contrast",this.updateColors,this),this.chat.context.on("changed:theme.is-dark",this.updateColors,this),this.chat.context.getChanges("chat.lines.alternate",e=>this.css_tweaks.toggle("chat-rows",e)),this.chat.context.getChanges("chat.lines.borders",this.updateLineBorders,this),this.ChatController.on("mount",this.chatMounted,this),this.ChatController.on("unmount",this.chatMounted,this),this.ChatController.on("update",this.chatUpdated,this),this.ChatController.on("receive-props",this.chatUpdated,this),this.ChatController.ready((e,i)=>{for(const s of i)this.chatMounted(s)}),this.loadBadges(),this.updateChatCSS(),this.updateColors()}updateLineBorders(){const e=this.chat.context.get("chat.lines.borders");this.css_tweaks.toggle("chat-borders",e>0),this.css_tweaks.toggle("chat-borders-3d",e===2),this.css_tweaks.toggle("chat-borders-3d-inset",e===3),this.css_tweaks.toggle("chat-borders-wide",e===4)}updateChatCSS(){const e=this.chat.context.get("chat.font-size"),i=this.chat.context.get("chat.lines.emote-alignment"),s=Math.round(20/12*e);let n=this.chat.context.get("chat.font-family")||"inherit";const[o,h]=(0,Ci.jo)(n);n=o,this._font_unloader&&this._font_unloader(),this._font_unloader=h,n.indexOf(" ")!==-1&&n.indexOf(",")===-1&&n.indexOf('"')===-1&&n.indexOf("'")===-1&&(n=`"${n}"`),this.css_tweaks.setVariable("chat-font-size",`${e/10}rem`),this.css_tweaks.setVariable("chat-line-height",`${s/10}rem`),this.css_tweaks.setVariable("chat-font-family",n),this.css_tweaks.toggle("chat-font",e!==12||n),this.css_tweaks.toggle("emote-alignment-padded",i===1),this.css_tweaks.toggle("emote-alignment-baseline",i===2)}updateColors(){const e=this.chat.context.get("theme.is-dark"),i=this.chat.context.get("chat.adjustment-mode"),s=this.chat.context.get("chat.adjustment-contrast"),n=this.colors,o=this.inverse_colors;n._base=e?"#191919":"#e0e0e0",n.mode=i,n.contrast=s,o._base=e?"#dad8de":"#19171c",o.mode=i,o.contrast=s,this.line.updateLines()}async loadBadges(){let e;try{e=await this.twitch_data.getBadges()}catch(i){this.log.warn("Error loading badge data.",i);return}e&&this.chat.badges.updateTwitchBadges(e)}addNotice(){return!1}sendMessage(){return null}addRoom(e,i){i||(i=e.props);const s=(0,r.get)("data.clip.broadcaster.id",i);if(!s)return null;const n=e._ffz_room=this.chat.getRoom(s,null,!1,!0);return n.ref(e),this.settings.updateContext({channelID:s}),n}removeRoom(e){e._ffz_room&&(e._ffz_room.unref(e),e._ffz_room=null,this.settings.updateContext({channelID:null}))}chatMounted(e,i){i||(i=e.props),this.addRoom(e,i)&&this.updateRoomBadges(e,(0,r.get)("data.clip.video.owner.broadcastBadges",i))}chatUmounted(e){this.removeRoom(e)}chatUpdated(e,i){if(!e._ffz_room||i?.data?.clip?.broadcaster?.id!==e._ffz_room.id){this.chatUmounted(e),this.chatMounted(e,i);return}const s=(0,r.get)("data.clip.video.owner.broadcastBadges",i),n=(0,r.get)("data.clip.video.owner.broadcastBadges",e.props);s!==n&&this.updateRoomBadges(e,s)}updateRoomBadges(e,i){const s=e._ffz_room;s&&s.updateBadges(i)}};B(ws,"Chat");let si=ws;const Xt=[-.62,-.578,-.539,-.469,-.4,-.32,-.21,-.098,0,.08,.151,.212,.271,.31,.351],ti={dark:{c:{"background-accent":8,"background-accent-alt":7,"background-accent-alt-2":6,"background-button":7,"background-button-active":7,"background-button-focus":8,"background-button-hover":8,"background-button-primary-active":7,"background-button-primary-default":9,"background-button-primary-hover":8,"background-chat":1,"background-chat-alt":3,"background-chat-header":2,"background-graph":2,"background-graph-fill":8,"background-input-checkbox-checked":10,"background-input-checked":8,"background-interactable-selected":9,"background-modal":3,"background-progress-countdown-status":9,"background-progress-status":9,"background-range-fill":10,"background-subscriber-stream-tag-active":4,"background-subscriber-stream-tag-default":4,"background-subscriber-stream-tag-hover":3,"background-toggle-checked":9,"background-top-nav":6,"border-brand":9,"border-button":7,"border-button-active":8,"border-button-focus":9,"border-button-hover":8,"border-input-checkbox-checked":10,"border-input-checkbox-focus":10,"border-input-focus":10,"border-interactable-selected":10,"border-range-handle":10,"border-subscriber-stream-tag":5,"border-tab-active":11,"border-tab-focus":11,"border-tab-hover":11,"border-toggle-checked":10,"border-toggle-focus":10,"border-whisper-incoming":10,"fill-brand":9,"text-button-text-active":"o2","text-link":10,"text-link-active":10,"text-link-focus":10,"text-link-hover":10,"text-link-visited":10,"text-overlay-link-active":13,"text-overlay-link-focus":13,"text-overlay-link-hover":13,"text-tab-active":11,"text-toggle-checked-icon":10,"text-tooltip":1,"text-button-text":10},s:{"button-active":[8," 0 0 6px 0",""],"button-focus":[8," 0 0 6px 0",""],input:[5," inset 0 0 0 1px",""],"input-focus":[8," 0 0 10px -2px",""],"interactable-focus":[8," 0 0 6px 0",""],"tab-focus":[11," 0 4px 6px -4px",""]}},light:{c:{"background-accent":8,"background-accent-alt":7,"background-accent-alt-2":6,"background-button":7,"background-button-active":7,"background-button-focus":8,"background-button-hover":8,"background-button-primary-active":7,"background-button-primary-default":9,"background-button-primary-hover":8,"background-chat":1,"background-chat-alt":3,"background-chat-header":2,"background-graph":15,"background-graph-fill":9,"background-input-checkbox-checked":9,"background-input-checked":8,"background-interactable-selected":9,"background-modal":3,"background-progress-countdown-status":8,"background-progress-status":8,"background-range-fill":9,"background-subscriber-stream-tag-active":13,"background-subscriber-stream-tag-default":13,"background-subscriber-stream-tag-hover":14,"background-toggle-checked":9,"background-top-nav":7,"border-brand":9,"border-button":7,"border-button-active":8,"border-button-focus":9,"border-button-hover":8,"border-input-checkbox-checked":9,"border-input-checkbox-focus":9,"border-input-focus":9,"border-interactable-selected":9,"border-range-handle":9,"border-subscriber-stream-tag":10,"border-tab-active":8,"border-tab-focus":8,"border-tab-hover":8,"border-toggle-checked":9,"border-toggle-focus":9,"border-whisper-incoming":10,"fill-brand":9,"text-button-text-active":"o2","text-link":8,"text-link-active":9,"text-link-focus":9,"text-link-hover":9,"text-link-visited":9,"text-overlay-link-active":13,"text-overlay-link-focus":13,"text-overlay-link-hover":13,"text-tab-active":8,"text-toggle-checked-icon":9,"text-tooltip":1,"text-button-text":8,"background-tooltip":1,"text-button-text-focus":"o1","text-button-text-hover":"o1"},s:{"button-active":[8," 0 0 6px 0",""],"button-focus":[8," 0 0 6px 0",""],input:[5," inset 0 0 0 1px",""],"input-focus":[10," 0 0 10px -2px",""],"interactable-focus":[8," 0 0 6px 1px",""],"tab-focus":[8," 0 4px 6px -4px",""]}},accent_dark:{c:{"accent-hover":10,accent:9,"accent-primary-1":1,"accent-primary-2":5,"accent-primary-3":6,"accent-primary-4":7,"accent-primary-5":8},s:{}},accent_light:{c:{"accent-hover":10,accent:9,"accent-primary-1":1,"accent-primary-2":5,"accent-primary-3":6,"accent-primary-4":7,"accent-primary-5":8},s:{}}},ks=class ks extends d.default{constructor(...e){super(...e),this.inject("settings"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject("site.router"),this.settings.add("theme.font.size",{default:13,process(i,s){if(typeof s!="number")try{s=parseFloat(s)}catch{s=null}return(!s||s<1||isNaN(s)||!isFinite(s)||s>25)&&(s=13),s},changed:()=>this.updateFont()}),this.settings.add("theme.color.background",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.color.text",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.color.accent",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.color.tooltip.background",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.color.tooltip.text",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-background",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-text",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-accent",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.can-dark",{requires:["context.route.name"],process(){return!0}}),this.settings.add("theme.is-dark",{requires:["context.force-dark","theme.can-dark","context.ui.theme","context.ui.theatreModeEnabled","context.route.name","context.location.search"],process(i){const s=i.get("context.force-theme");return s??(i.get("context.ui.theatreModeEnabled")||i.get("theme.can-dark")&&i.get("context.ui.theme")===1)},changed:()=>this.updateCSS()}),this.settings.add("theme.tooltips-dark",{requires:["theme.is-dark"],process(i){return!i.get("theme.is-dark")}}),this._style=null,this._normalizer=null}updateFont(){let e=this.settings.get("theme.font.size");if(typeof e=="string"&&/^[0-9.]+$/.test(e)?e=parseFloat(e):typeof e!="number"&&(e=null),!e||isNaN(e)||!isFinite(e)||e<1||e===13){this.css_tweaks.delete("font-size");return}e=e/10,this.css_tweaks.set("font-size",`html body {
	--font-size-1: ${54/13*e}rem;
	--font-size-2: ${36/13*e}rem;
	--font-size-3: ${24/13*e}rem;
	--font-size-4: ${18/13*e}rem;
	--font-size-5: ${14/13*e}rem;
	--font-size-6: ${e}rem;
	--font-size-7: ${12/13*e}rem;
	--font-size-8: ${12/13*e}rem;
	--font-size-base: ${e}rem;
}
`)}updateCSS(){if(this.css_tweaks.setVariable("border-color","var(--color-border-base)"),!this.settings.get("theme.can-dark")){this.toggleNormalizer(!1),this.toggleAccentNormal(!0),this.css_tweaks.delete("colors");return}let e=!1,i=this.settings.get("theme.is-dark");const s=[],n=[],o=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.background"));if(o){o.a=1,s.push(`--color-background-body: ${o.toCSS()};`);const ye=o.toHSLA(),Ie=ye.l;i=Ie<.5;try{const Fe=this.resolve("site").store,je=Fe.getState().ui.theme,Ue=i?1:0;je!==Ue&&Fe.dispatch({type:"core.ui.THEME_CHANGED",theme:Ue})}catch{}e=!0,s.push(`--color-background-input-focus: ${o.toCSS()};`),s.push(`--color-background-base: ${ye._l(Ie+(i?.05:-.05)).toCSS()};`),s.push(`--color-background-alt: ${ye._l(Ie+(i?.1:-.1)).toCSS()};`),s.push(`--color-background-alt-2: ${ye._l(Ie+(i?.15:-.15)).toCSS()};`)}this.css_tweaks.toggleHide("dark-toggle",e);let h=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.text"));if(!h&&o&&(h=Mt.Color.RGBA.fromCSS(i?"#FFF":"#000")),h){s.push(`--color-text-base: ${h.toCSS()};`),s.push(`--color-text-input: ${h.toCSS()};`);const ye=h.toHSLA(),Ie=ye.a;s.push(`--color-text-label: ${h.toCSS()};`),s.push(`--color-text-label-optional: ${ye._a(Ie-.4).toCSS()};`),s.push(`--color-text-alt: ${ye._a(Ie-.2).toCSS()};`),s.push(`--color-text-alt-2: ${ye._a(Ie-.4).toCSS()};`)}const g=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.accent"));if(this.toggleAccentNormal(!g),g){g.a=1;const ye=g.toHSLA(),Ie=ye.l,Fe=Xt.map(Ue=>Ue===0?g.toCSS():ye._l(Ie+Ue).toCSS());for(let Ue=0;Ue<Fe.length;Ue++)s.push(`--ffz-color-accent-${Ue+1}:${Fe[Ue]};`);let je=i?ti.dark:ti.light;for(const[Ue,Je]of Object.entries(je.c))typeof Je=="number"&&s.push(`--color-${Ue}:${Fe[Je-1]};`);je=i?ti.accent_dark:ti.accent_light;for(const[Ue,Je]of Object.entries(je.c))typeof Je=="number"&&n.push(`--color-${Ue}:${Fe[Je-1]} !important;`)}let E=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.tooltip.background")),R;!E&&o&&(E=Mt.Color.RGBA.fromCSS(i?"#FFF":"#000")),E?(s.push(`--color-background-tooltip: ${E.toCSS()};`),R=E.toHSLA().l<.5):R=!i;let T=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.tooltip.text"));const L=T||E;if(T||(T=Mt.Color.RGBA.fromCSS(R?"#FFF":"#000")),T){L&&s.push(`--color-text-tooltip: ${T.toCSS()};`);const ye=T.toHSLA(),Ie=ye.a;s.push(`--color-text-tooltip-alt: ${ye._a(Ie-.2).toCSS()};`),s.push(`--color-text-tooltip-alt-2: ${ye._a(Ie-.4).toCSS()};`)}const q=[],le=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-background"));let pe=i;if(le){le.a=1,q.push(`--color-background-body: ${le.toCSS()};`);const ye=le.toHSLA(),Ie=ye.l;pe=Ie<.5,q.push(`--color-background-input-focus: ${le.toCSS()};`),q.push(`--color-background-base: ${ye._l(Ie+(pe?.05:-.05)).toCSS()};`),q.push(`--color-background-alt: ${ye._l(Ie+(pe?.1:-.1)).toCSS()};`),q.push(`--color-background-alt-2: ${ye._l(Ie+(pe?.15:-.15)).toCSS()};`)}let fe=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-text"));if(!fe&&le&&(fe=Mt.Color.RGBA.fromCSS(pe?"#FFF":"#000")),fe){q.push(`--color-text-base: ${fe.toCSS()};`),q.push(`--color-text-input: ${fe.toCSS()};`);const ye=fe.toHSLA(),Ie=ye.a;q.push(`--color-text-label: ${fe.toCSS()};`),q.push(`--color-text-label-optional: ${ye._a(Ie-.4).toCSS()};`),q.push(`--color-text-alt: ${ye._a(Ie-.2).toCSS()};`),q.push(`--color-text-alt-2: ${ye._a(Ie-.4).toCSS()};`)}const De=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-accent")),Ae=[];if(De){De.a=1;const ye=De.toHSLA(),Ie=ye.l,Fe=Xt.map(Ue=>Ue===0?De.toCSS():ye._l(Ie+Ue).toCSS());for(let Ue=0;Ue<Fe.length;Ue++)q.push(`--ffz-color-accent-${Ue+1}:${Fe[Ue]};`);let je=pe?ti.dark:ti.light;for(const[Ue,Je]of Object.entries(je.c))typeof Je=="number"&&q.push(`--color-${Ue}:${Fe[Je-1]};`);je=pe?ti.accent_dark:ti.accent_light;for(const[Ue,Je]of Object.entries(je.c))typeof Je=="number"&&Ae.push(`--color-${Ue}:${Fe[Je-1]} !important;`)}q.length?this.css_tweaks.set("chat-colors",`.chat-shell {${q.join(`
`)}}.chat-shell .tw-accent-region{${Ae.join(`
`)}}`):this.css_tweaks.delete("chat-colors"),this.toggleNormalizer(q.length||s.length),s.length?this.css_tweaks.set("colors",`body {${s.join(`
`)}}.channel-info-content .tw-accent-region,.channel-info-content div[class^="ScAccentRegion"]{${n.join(`
`)}}`):this.css_tweaks.delete("colors")}toggleAccentNormal(e){if(e){const i=[];for(let s=0;s<15;s++)i.push(`--ffz-color-accent-${s+1}:var(--color-twitch-purple-${s+1});`);this.css_tweaks.set("accent-normal",`body {${i.join(`
`)}}`)}else this.css_tweaks.delete("accent-normal")}toggleNormalizer(e){}onEnable(){this.updateCSS(),this.updateFont()}};B(ks,"ThemeEngine");let bi=ks;const Vi=X.p+"clips-main.css",Gi=class Gi extends ft.Z{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject(rt.Z),this.inject("router",_t.Z),this.inject(vt.default,!1),this.inject(Ut.default),this.inject("css_tweaks",Gt),this.css_tweaks.loader=X(39706),this.css_tweaks.rules={"unfollow-button":".follow-btn__follow-btn--following,.follow-btn--following","player-gain-volume":'.video-player__overlay[data-compressed="true"] .volume-slider__slider-container:not(.ffz--player-gain)',"player-ext":".video-player .extension-taskbar,.video-player .extension-container,.video-player .extensions-dock__layout,.video-player .extensions-notifications,.video-player .extensions-video-overlay-size-container,.video-player .extensions-dock__layout","player-ext-hover":'.video-player__overlay[data-controls="false"] .extension-taskbar,.video-player__overlay[data-controls="false"] .extension-container,.video-player__overlay[data-controls="false"] .extensions-dock__layout,.video-player__overlay[data-controls="false"] .extensions-notifications,.video-player__overlay[data-controls="false"] .extensions-video-overlay-size-container',"dark-toggle":'div[data-a-target="dark-mode-toggle"],div[data-a-target="dark-mode-toggle"] + div'},this.inject(Vt),this.inject(si),this.inject("theme",bi),this.ClipsMenu=this.fine.define("clips-menu",i=>i.props?.signup&&(0,r.has)(i.state,"dropdownOpen")),document.head.appendChild((0,re.createElement)("link",{href:Vi,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"}))}onLoad(){this.router.route(Gi.CLIP_ROUTES,"clips.twitch.tv")}onEnable(){const e=this.fine.searchNode(null,o=>o.memoizedProps?.store),i=this.store=e?.memoizedProps?.store;if(!i)return(0,r.sleep)(50).then(()=>this.onEnable());this.ClipsMenu.on("mount",this.updateMenu,this),this.ClipsMenu.on("update",this.updateMenu,this),this.ClipsMenu.ready((o,h)=>{for(const g of h)this.updateMenu(g)}),this.on("i18n:update",()=>{for(const o of this.ClipsMenu.instances)this.updateMenu(o)}),i.subscribe(()=>this.updateContext()),this.updateContext(),this.settings.updateContext({clips:!0});const s=B(()=>this.settings.updateContext({size:{height:window.innerHeight,width:window.innerWidth}}),"update_size");window.addEventListener("resize",s),s(),this.router.on(":route",(o,h)=>{this.log.info("Navigation",o&&o.name,h&&h[0]),this.fine.route(o&&o.name),this.settings.updateContext({route:o,route_data:h})});const n=this.router.current;this.fine.route(n&&n.name),this.settings.updateContext({route:n,route_data:this.router.match}),this.settings.add("clips.layout.big",{default:!1}),this.settings.getChanges("channel.hide-unfollow",o=>this.css_tweaks.toggleHide("unfollow-button",o)),this.settings.getChanges("clips.layout.big",o=>this.css_tweaks.toggle("full-width",o))}updateContext(){try{const e=this.store.getState(),i=this.router&&this.router.history;this.settings.updateContext({location:i?.location,ui:e?.ui,session:e?.session})}catch(e){this.log.error("Error updating context.",e)}}getSession(){return this.store?.getState?.()?.session}getUser(){if(this._user)return this._user;const e=this.getSession();return this._user=e?.user}updateMenu(e){const i=this.fine.getChildNode(e),s=i&&i.querySelector(".clips-top-nav-user__dropdown--open");if(!s)return;const n=e.state.dropdownOpen;let o,h,g=s.querySelector(".ffz--cc-button");if(g)if(n)h=g.querySelector("button"),o=g.querySelector(".ffz--label");else{g.remove();return}else{if(!n)return;const E=B(()=>{const R=window.open("https://twitch.tv/popout/frankerfacez/chat?ffz-settings","_blank","resizable=yes,scrollbars=yes,width=850,height=600");R&&R.focus(),e.toggleDropdown(!1)},"handler");g=(0,re.createElement)("div",{class:"ffz--cc-button"},h=(0,re.createElement)("button",{class:"tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onclick:E},(0,re.createElement)("div",{class:"tw-align-items-center tw-c-text-alt tw-flex tw-pd-x-2 tw-pd-y-05"},o=(0,re.createElement)("div",{class:"ffz--label tw-flex-grow-1 tw-ellipsis"})))),s.insertBefore(g,s.lastElementChild)}o.textContent=h.title=this.i18n.t("site.menu_button","FrankerFaceZ Control Center")}};B(Gi,"ClipsSite");let ni=Gi;ni.CLIP_ROUTES={"clip-page":"/:slug"},ni.DIALOG_SELECTOR="#root > div";const Ss=class Ss extends d.default{constructor(e,i){super(e,i),this.Vue=null,this.i18n=null,this.key="ffz-stuff",this._components={},this.inject("i18n")}async onLoad(){const e=window.ffzVue=this.Vue=(await Promise.all([X.e(4047),X.e(7485)]).then(X.bind(X,35702))).default,i=this._components,[s,n,o]=await Promise.all([Promise.all([X.e(4047),X.e(7485)]).then(X.bind(X,6108)),Promise.all([X.e(4047),X.e(7485)]).then(X.t.bind(X,59010,19)),Promise.all([X.e(4047),X.e(7485)]).then(X.bind(X,8222))]);this.component(o.default),e.use(s),e.mixin(n.mixin);for(const h in i)(0,r.has)(i,h)&&e.component(h,i[h]);this._components=null,e.use(this)}component(e,i){if(typeof e=="function")for(const s of e.keys())this.component(s.slice(2,s.length-4),e(s).default);else if(typeof e=="object")for(const s in e)(0,r.has)(e,s)&&this.component(s,e[s]);else this.Vue?this.Vue.component(e,i):this._components&&(this._components[e]=i)}install(e){const i=this;this._vue_i18n||(this._vue_i18n=new e({data(){return{locale:i.i18n.locale,phrases:{}}},methods:{tNumber_(s,n){return this.locale,i.i18n.formatNumber(s,n)},tDate_(s,n){return this.locale,i.i18n.formatDate(s,n)},tTime_(s,n){return this.locale,i.i18n.formatTime(s,n)},tDateTime_(s,n){return this.locale,i.i18n.formatDateTime(s,n)},t_(s,n,o){return this.locale&&this.phrases[s],i.i18n.t(s,n,o)},tList_(s,n,o){return this.locale&&this.phrases[s],i.i18n.tList(s,n,o)},tNode_(s,n){return this.locale,i.i18n.formatNode(s,n)},setLocale(s){i.i18n.locale=s}}}),this.on("i18n:transform",()=>{this._vue_i18n.locale=this.i18n.locale,this._vue_i18n.phrases={}}),this.on("i18n:changed",()=>{this._vue_i18n.locale=this.i18n.locale,this._vue_i18n.phrases={}}),this.on("i18n:loaded",s=>{const n=this._vue_i18n,o=n.phrases;for(const h of s)n.$set(o,h,(o[h]||0)+1)}),e.prototype.$i18n=this._vue_i18n),e.component("t-list",{props:{tag:{required:!1},phrase:{type:String,required:!0},default:{type:String,required:!0},data:{type:Object,required:!1}},render(s){return s(this.tag||"span",this.$i18n.tList_(this.phrase,this.default,Object.assign({},this.data,this.$scopedSlots)).map(n=>typeof n=="function"?n():n))}}),e.mixin({methods:{reactNavigate(s,n,o){const h=i.resolve("site.router");h&&h.history&&(n&&(n.preventDefault(),n.stopPropagation()),h.history.push(s,o??void 0))},getReactURL(s,n,o,...h){return i.resolve("site.router").getURL(s,n,o,...h)},getI18n(){return i.i18n},t(s,n,o){return this.$i18n.t_(s,n,o)},tList(s,n,o){return this.$i18n.tList_(s,n,o)},tNode(s,n){return this.$i18n.tNode_(s,n)},tNumber(s,n){return this.$i18n.tNumber_(s,n)},tDate(s,n){return this.$i18n.tDate_(s,n)},tTime(s,n){return this.$i18n.tTime_(s,n)},tDateTime(s,n){return this.$i18n.tDateTime_(s,n)}}})}};B(Ss,"VueModule");let ui=Ss;const Bi=ui;var ri=X(8528),xi=X(6170);const Cs=class Cs extends d.default{constructor(e,i){super(e,i),this.i18n=null,this.types={},this.inject("i18n"),this.should_enable=!0,this.types.json=s=>{const n=s.dataset.title;return[n&&(0,re.createElement)("strong",null,n),(0,re.createElement)("code",{className:`block${n?" pd-t-05 border-t mg-t-05":""}`,style:{fontFamily:"monospace",textAlign:"left"}},s.dataset.data)]},this.types.child=s=>{const n=s.querySelector(":scope > .ffz-tooltip-child");return n?(s._ffz_child=n,n.remove(),n.classList.remove("ffz-tooltip-child"),n):null},this.types.child.onHide=s=>{const n=s._ffz_child;n&&(s._ffz_child=null,n.remove(),s.querySelector(":scope > .ffz-tooltip-child")||(n.classList.add("ffz-tooltip-child"),s.appendChild(n)))},this.types.markdown=(s,n)=>{n.add_class="ffz-tooltip--markdown";const o=(0,xi.e)();return o?o.render(s.dataset.title):(0,xi.Z)().then(h=>h.render(s.dataset.title))},this.types.text=s=>(0,re.sanitize)(s.dataset.title??""),this.types.html=s=>s.dataset.title,this.onFSChange=this.onFSChange.bind(this)}getAddonProxy(e,i,s){if(!e)return this;const n={},o=f.DEBUG||i?.dev;let h;return n.define=(g,E)=>(E&&(E.__source=e),this.define(g,E)),o&&(n.cleanup=()=>(s.log.warn('[DEV-CHECK] Instead of calling tooltips.cleanup(), you can emit the event "tooltips:cleanup"'),this.cleanup()),h={types:"Please use tooltips.define()"}),(0,d.buildAddonProxy)(s,this,"tooltips",n,h)}onEnable(){const e=this.getRoot();window.addEventListener("fullscreenchange",this.onFSChange),this.container=e,this.tip_element=e,this.tips=this._createInstance(e),this.on(":cleanup",this.cleanup),this.on("addon:fully-unload",i=>{let s=0;for(const[n,o]of Object.entries(this.types))o?.__source===i&&(s++,this.types[n]=void 0);s&&(this.log.debug(`Cleaned up ${s} entries when unloading addon:`,i),this.cleanup())})}define(e,i){this.types[e]=i}getRoot(){return document.querySelector(".sunlight-root")||document.querySelector("#root")||document.querySelector(".clips-root")||document.body}_createInstance(e,i="ffz-tooltip",s="text",n){return new ri.default(e,i,{html:!0,i18n:this.i18n,live:!0,check_modifiers:!0,container:n||e,delayHide:this.checkDelayHide.bind(this,s),delayShow:this.checkDelayShow.bind(this,s),content:this.process.bind(this,s),interactive:this.checkInteractive.bind(this,s),hover_events:this.checkHoverEvents.bind(this,s),onShow:this.delegateOnShow.bind(this,s),onHide:this.delegateOnHide.bind(this,s),popperConfig:this.delegatePopperConfig.bind(this,s),popper:{placement:"top",modifiers:{flip:{}}},onHover:(o,h,g)=>{this.emit(":hover",o,h,g)},onLeave:(o,h,g)=>{this.emit(":leave",o,h,g)}})}onFSChange(){this.container||(this.container=this.getRoot());let e=this.container;document.fullscreenElement instanceof HTMLElement&&(e=document.fullscreenElement),e!==this.tip_element&&(this.tip_element=e,this.tips&&(this.tips.destroy(),this.tips=this._createInstance(e)))}cleanup(){this.tips&&this.tips.cleanup()}delegatePopperConfig(e,i,s,n){const o=i.dataset.tooltipType||e,h=this.types[o];return i.dataset.tooltipSide&&(n.placement=i.dataset.tooltipSide),h&&h.popperConfig?h.popperConfig(i,s,n):n}delegateOnShow(e,i,s){const n=i.dataset.tooltipType||e,o=this.types[n];o&&o.onShow&&o.onShow(i,s)}delegateOnHide(e,i,s){const n=i.dataset.tooltipType||e,o=this.types[n];o&&o.onHide&&o.onHide(i,s)}checkDelayShow(e,i,s){const n=i.dataset.tooltipType||e,o=this.types[n];return o?.delayShow!=null?(0,r.maybe_call)(o.delayShow,null,i,s):0}checkDelayHide(e,i,s){const n=i.dataset.tooltipType||e,o=this.types[n];return o?.delayHide!=null?(0,r.maybe_call)(o.delayHide,null,i,s):0}checkInteractive(e,i,s){const n=i.dataset.tooltipType||e,o=this.types[n];return o?.interactive!=null?(0,r.maybe_call)(o.interactive,null,i,s):!1}checkHoverEvents(e,i,s){const n=i.dataset.tooltipType||e,o=this.types[n];return o?.hover_events!=null?(0,r.maybe_call)(o.hover_events,null,i,s):!1}process(e,i,s){const n=i.dataset.tooltipType||e||"text",o=i.dataset.tooltipAlign,h=this.types[n];return o&&(s.align=o),h?h(i,s):[(0,re.createElement)("strong",null,"Unhandled Tooltip Type"),(0,re.createElement)("code",{className:"tw-block pd-t-05 border-t mg-t-05",style:{fontFamily:"monospace",textAlign:"left"}},JSON.stringify(i.dataset,null,4))]}};B(Cs,"TooltipProvider");let di=Cs;const Ps={1:{staff:{1:{color:"#200f33",svg:!0,trans:{color:"#6441a5"}}},admin:{1:{color:"#faaf19",svg:!0}},global_mod:{1:{color:"#0c6f20",svg:!0}},broadcaster:{1:{color:"#e71818",svg:!0}},moderator:{1:{color:"#34ae0a",svg:!0}},twitchbot:{1:{color:"#34ae0a"}},partner:{1:{color:"transparent",trans:{image:!0,color:"#6441a5"}}},"clip-champ":{1:{color:"#6441a5"}},vip:{1:{color:"#b33ff0",trans:{color:"transparent",invert:!1}}},turbo:{1:{color:"#6441a5",svg:!0}},premium:{1:{color:"#009cdc"}},subscriber:{0:{color:"#6441a5"},1:{color:"#6441a5"}}},2:{staff:{1:{color:"#000"}},admin:{1:{color:"#DB7600"}},broadcaster:{1:{color:"#E91916"}},moderator:{1:{color:"#00AD03"}},global_mod:{1:{color:"#006441"}},twitchbot:{1:{color:"#00AD03"}},partner:{1:{color:"#9146FF"}},subscriber:{0:{color:"#8205B4"},1:{color:"#8205B4"}},vip:{1:{color:"#E005B9"}},turbo:{1:{color:"#59399A"}},premium:{1:{color:"#00A0D6"}},"anonymous-cheerer":{1:{color:"#4B367C"}},"clip-champ":{1:{color:"#9146FF"}},"artist-badge":{1:{color:"#1e69ff"}},no_audio:{1:{color:"#323239"}},no_video:{1:{color:"#323239"}}}},Bs={staff:-2,admin:-1,global_mod:-1,broadcaster:0,mod:1,moderator:1,twitchbot:1,vip:2,subscriber:25},Rs="background-repeat:no-repeat;background-position:center;",qs=`${f.SERVER}/static/badges/twitch/`,Zi=f.IS_WEBKIT?"webkitMaskImage":"maskImage",Ri={0:k=>`${k.fore?`color:${k.fore};`:""}background:${k.image||""} ${k.color};background-size:${k.scale*1.8}rem;${k.svg?"":`background-image:${k.image_set};`}${Rs}`,1:k=>`${Ri[0](k)}border-radius:${k.scale*.2}rem;`,2:k=>`${Ri[0](k)}border-radius:${k.scale*.9}rem;background-size:${k.scale*1.6}rem;`,3:k=>`${k.fore?`color:${k.fore};`:""}background:${k.color};border-radius:${k.scale*.9}rem;`,4:k=>`${Ri[3](k)}height:${k.scale}rem;min-width:${k.scale}rem;`,5:k=>`background:${k.image};background-size:${k.scale*1.8}rem;${k.svg?"":`background-image:${k.image_set};`}${Rs}`,6:k=>`background:linear-gradient(${k.color},${k.color});${f.WEBKIT_CSS}mask-image:${k.image};${f.WEBKIT_CSS}mask-size:${k.scale*1.8}rem ${k.scale*1.8}rem;${k.svg?"":`${f.WEBKIT_CSS}mask-image:${k.image_set};`}`};function Ys(k,e){const i=k.urls||{1:k.image},s=`url("${i[1]}")`,n=`${f.WEBKIT_CSS}image-set(${s} 1x${i[2]?`, url("${i[2]}") 2x`:""}${i[4]?`, url("${i[4]}") 4x`:""})`;return e===3||e===4?"":e===6?`${f.WEBKIT_CSS}mask-image:${s} !important;${f.WEBKIT_CSS}mask-image:${n} !important;`:`background-image:${s} !important;background-image:${n} !important;`}B(Ys,"generateOverrideCSS");function oi(k,e,i,s,n,o=2,h,g,E=1,R=!1){let T=i.color||"transparent",L=i.fore||n?"#fff":"#000",q=i.image||(i.addon?null:`${qs}${o}/${k}${i.svg?".svg":`/${e}/`}`),le=!1,pe=!1,fe,De,Ae;if(q&&s>4){const ye=i.trans||{};T=ye.color||T,ye.image&&(le=!0,ye.image!==!0&&(q=ye.image)),(0,r.has)(ye,"invert")?pe=ye.invert&&!n:pe=s===5&&!n}return(s===3||s===4)&&T==="transparent"&&i.trans&&(T=i.trans.color||T),T==="transparent"&&(s=0),q&&s!==3&&s!==4&&(fe=q.endsWith(".svg"),i.urls?De=`url("${i.urls[E]}")`:De=`url("${fe?q:`${q}${E}${le?"_trans":""}.png`}")`,i.urls&&E===1?Ae=`${f.WEBKIT_CSS}image-set(${De} 1x${i.urls[2]?`, url("${i.urls[2]}") 2x`:""}${i.urls[4]?`, url("${i.urls[4]}") 4x`:""})`:i.urls&&E===2?Ae=`${f.WEBKIT_CSS}image-set(${De} 1x${i.urls[4]?`, url("${i.urls[4]}") 2x`:""})`:!fe&&E<4?E===1?Ae=`${f.WEBKIT_CSS}image-set(${De} 1x, url("${q}2${le?"_trans":""}.png") 2x, url("${q}4${le?"_trans":""}.png") 4x)`:E===2&&(Ae=`${f.WEBKIT_CSS}image-set(${De} 1x, url("${q}4${le?"_trans":""}.png") 2x)`):Ae=De),h&&T&&T!=="transparent"&&(T=h.process(T)||T),g&&L&&L!=="transparent"&&T!=="transparent"&&(g.base=T,L=g.process(L)||L),q||(s>4?s=1:s>3&&(s=2)),`${R&&(i.click_handler||i.click_url||i.click_action)?"cursor:pointer;":""}${pe?"filter:invert(100%);":""}${Ri[s]({scale:1,color:T,fore:L,image:De,image_set:Ae,svg:fe})}${i.css||""}`}B(oi,"generateBadgeCSS");const xs=class xs extends d.default{constructor(...e){super(...e),this.inject("i18n"),this.inject("settings"),this.inject("tooltips"),this.inject("experiments"),this.inject("staging"),this.inject("load_tracker"),this.style=new re.ManagedStyle("badges"),this.bulk=new Map,this._woofer_months={},this.badges={},this.twitch_badges={},f.IS_FIREFOX&&this.settings.add("chat.badges.media-queries",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use @media queries to support High-DPI Badge images in Mozilla Firefox.",description:"This is required to see high-DPI badges on Firefox because Firefox still has yet to support `image-set()` after more than five years. It may be less reliable.",component:"setting-check-box"}}),this.settings.add("chat.badges.version",{default:2,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Version",component:"setting-select-box",data:[{value:1,title:"1 (Pre December 2019)"},{value:2,title:"2 (Current)"}]}}),this.settings.add("chat.badges.clickable",{default:2,process(i,s){return s===!0?2:s===!1?0:s},ui:{path:"Chat > Badges >> Behavior",title:"Allow clicking badges.",description:"Certain badges, such as Prime Gaming, act as links when this is enabled.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Legacy (Open URLs)"},{value:2,title:"Open Badge Card"}]}}),this.settings.add("chat.badges.fix-colors",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Adjust badge colors for visibility.",description:`Ensures that badges are visible against the current background.

**Note:** Only affects badges with custom rendering. Subscriber badges, bit badges, etc. are not affected.`,component:"setting-check-box"}}),this.settings.add("chat.badges.hidden",{default:{},type:"object_merge",ui:{path:"Chat > Badges >> tabs ~> Visibility",title:"Visibility",component:"badge-visibility",getBadges:i=>this.getSettingsBadges(!0,i)}}),this.settings.add("chat.badges.custom-mod",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use custom moderator badges where available.",component:"setting-check-box"}}),this.settings.add("chat.badges.custom-vip",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use custom VIP badges where available.",component:"setting-check-box"}}),this.settings.add("chat.badges.style",{default:1,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Style",component:"setting-select-box",data:[{value:0,title:"Square"},{value:1,title:"Rounded"},{value:2,title:"Circular"},{value:3,title:"Circular (Color Only)"},{value:4,title:"Circular (Color Only, Small)"},{value:5,title:"Transparent"},{value:6,title:"Transparent (Colored)"}]}}),this.handleClick=this.handleClick.bind(this)}getSettingsBadges(e,i){const s=[],n=[],o=[],h=[],g=[],E=[],R={},T=[];if(!Object.keys(this.twitch_badges).length&&i){const fe=this.resolve("site.twitch_data");fe&&fe.getBadges().then(De=>{this.updateTwitchBadges(De),i()})}for(const fe in this.twitch_badges)if((0,r.has)(this.twitch_badges,fe)){const De=this.twitch_badges[fe],Ae=[];let ye=De&&(De[1]||De[0]);for(const Ie in De)if(Ie!=="__cat"&&(0,r.has)(De,Ie)){const Fe=De[Ie];ye||(ye=Fe),Fe&&Fe.image1x&&Ae.push({version:Ie,name:Fe.title,image:Fe.image1x,styleImage:`url("${Fe.image1x}")`})}if(ye){let Ie;De.__cat==="m-other"?Ie=n:De.__cat==="m-owl"?Ie=o:De.__cat==="m-tcon"?Ie=h:De.__cat==="m-game"?Ie=g:Ie=s,Ie.push({id:fe,provider:"twitch",name:ye.title,color:"transparent",image:ye.image2x,versions:Ae,styleImage:`url("${ye.image2x}")`})}}if(e){const fe={};for(const[De,Ae]of Object.entries(this.badges)){if(Ae.no_visibility)continue;let ye=Ae.urls?Ae.urls[2]||Ae.urls[1]:Ae.image,Ie=Ae.urls?.[1]||Ae.image,Fe=Ae.color||"transparent";Ae.addon||(ye=`//cdn.frankerfacez.com/badge/${Ae.id}/2/rounded`,Ie=`//cdn.frankerfacez.com/badge/${Ae.id}/1/rounded`,Fe="transparent");let je;typeof Ae.addon=="string"?je=R[Ae.addon]=R[Ae.addon]||[]:je=Ae.addon?T:E;let Ue=Ae.title,Je;try{Je=(0,r.maybe_call)(Ae.tooltipExtra,this,null,Ae)}catch{Je=null}Je&&!(Je instanceof Promise)&&(Ue=Ue+Je);const ct=Ae.base_id??De,yt=ct===De;let Qe=fe[ct];Qe?(Qe.versions||(Qe.versions=[{version:Qe.key,name:Qe.tipname,color:Qe.color,image:Qe.image1x,styleImage:`url("${Qe.image1x}")`}]),Qe.versions.push({version:De,name:Ue,color:Fe,image:Ie,styleImage:`url("${Ie}")`}),yt&&(Qe.name=Ae.title,Qe.tipname=Ue,Qe.color=Fe,Qe.image=ye,Qe.styleImage=`url("${ye}")`)):(Qe={id:ct,key:De,provider:"ffz",name:Ae.title,tipname:Ue,color:Fe,image:ye,image1x:Ie,styleImage:`url("${ye}")`},Ae.base_id&&(Qe.always_versions=!0,Qe.versions=[{version:Qe.key,name:Qe.tipname,color:Qe.color,image:Qe.image1x,styleImage:`url("${Qe.image1x}")`}]),fe[ct]=Qe,je.push(Qe))}}const q=[{title:"Twitch",id:"m-twitch",badges:s},{title:"Twitch: TwitchCon",id:"m-tcon",badges:h},{title:"Twitch: Other",id:"m-other",badges:n},{title:"Twitch: Overwatch League",id:"m-owl",badges:o},{title:"Twitch: Game",id:"m-game",key:"game",badges:g}];E.length&&q.push({title:"FrankerFaceZ",id:"m-ffz",badges:E});const le=this.resolve("addons"),pe=[];for(const[fe,De]of Object.entries(R)){const Ae=le?.getAddon?.(fe),ye=Ae?.short_name??Ae?.name??fe;pe.push({title:`Add-On: ${ye}`,id:`m-addon-${fe}`,badges:De})}return pe.sort((fe,De)=>fe.title.localeCompare(De.title)),q.push(...pe),T.length&&q.push({title:"Add-on",id:"m-addon",badges:T}),q}onEnable(){this.parent.context.on("changed:chat.badges.custom-mod",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.custom-vip",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.style",this.rebuildAllCSS,this),this.parent.context.on("changed:theme.is-dark",this.rebuildAllCSS,this),this.parent.context.on("changed:theme.tooltips-dark",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.version",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.media-queries",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.fix-colors",this.rebuildColoredBadges,this),this.parent.context.on("changed:chat.badges.clickable",this.rebuildAllCSS,this),this.rebuildAllCSS(),this.loadGlobalBadges(),this.on("chat:reload-data",e=>{(!e||e.badges)&&this.loadGlobalBadges()}),this.on("addon:fully-unload",e=>{let i=0;for(const[s,n]of Object.entries(this.badges))n?.__source===e&&(i++,this.removeBadge(s,!1));i&&(this.log.debug(`Cleaned up ${i} entries when unloading addon:`,e),this.generateBadgeCSS())}),this.tooltips.types.badge=(e,i)=>{i.add_class="ffz__tooltip--badges";const s=this.parent.context.get("tooltip.badge-images"),n=this.getBadgeData(e);if(n.data==null)return ri.NoContent;const o=[];let h=!1;for(const g of n.data){let E=null;g.room&&(E=this.resolve("site.chat")?.shared_room_data?.get(g.room)?.displayName,E&&(E=`

${E}`));const R=g.provider;if(R==="twitch"){const T=this.getTwitchBadge(g.badge,g.version,n.room_id,n.room_login),L=this.getTwitchBadge(g.badge,g.version,null,null,!0)||{};if(!T)continue;let q=T.title||L.title;const le=T.tier||L.tier;g.data&&(g.badge==="subscriber"?le>0?q=this.i18n.t("badges.subscriber.tier-months",`{title}
(Tier {tier}, {months, plural, one {# Month} other {# Months}})`,{title:q,tier:le,months:g.data}):q=this.i18n.t("badges.subscriber.months",`{title}
({count, plural, one {# Month} other {# Months}})`,{title:q,count:g.data}):g.badge==="founder"&&(q=this.i18n.t("badges.founder.months",`{title}
(Subscribed for {count, plural, one {# Month} other {# Months}})`,{title:q,count:g.data}))),o.push((0,re.createElement)("div",{class:"ffz-badge-tip"},s&&(0,re.createElement)("img",{class:"preview-image ffz-badge",src:T.image4x}),q,E))}else if(R==="ffz"){const T=this.badges[g.id],L=g.badge,q=(0,r.maybe_call)(L?.tooltipExtra??T?.tooltipExtra,this,n,L,e,i);q instanceof Promise?(h=!0,o.push(q.then(le=>(0,re.createElement)("div",{class:"ffz-badge-tip"},s&&g.image&&(0,re.createElement)("div",{class:"preview-image ffz-badge",style:{backgroundColor:g.color,backgroundImage:`url("${g.image}")`}}),g.title,le||"",E)))):o.push((0,re.createElement)("div",{class:"ffz-badge-tip"},s&&g.image&&(0,re.createElement)("div",{class:"preview-image ffz-badge",style:{backgroundColor:g.color,backgroundImage:`url("${g.image}")`}}),g.title,q||"",E))}}return h?Promise.all(o):o}}getAddonProxy(e,i,s){if(!e)return this;const n=f.DEBUG||(i?.dev??!1),o=(0,r.makeAddonIdChecker)(e),h={},g={};return h.loadBadgeData=(E,R,...T)=>(R&&R.addon===void 0&&(R.addon=e),n&&!o.test(E)&&s.log.warn("[DEV-CHECK] Call to chat.badges.loadBadgeData() did not include addon ID in badge_id:",E),this.loadBadgeData(E,R,...T)),n&&(h.removeBadge=(E,...R)=>{const T=this.badges[E];return T&&T.addon!==e&&s.log.warn("[DEV-CHECK] Removed un-owned badge with chat.badges.removeBadge():",key," owner:",T.addon??"ffz"),this.removeBadge(E,...R)},h.setBulk=(E,...R)=>(o.test(E)||s.log.warn("[DEV-CHECK] Call to chat.badges.setBulk() did not include addon ID in source:",E),this.setBulk(E,...R)),h.deleteBulk=(E,...R)=>(o.test(E)||s.log.warn("[DEV-CHECK] Call to chat.badges.deleteBulk() did not include addon ID in source:",E),this.deleteBulk(E,...R)),h.extendBulk=(E,...R)=>(o.test(E)||s.log.warn("[DEV-CHECK] Call to chat.badges.extendBulk() did not include addon ID in source:",E),this.extendBulk(E,...R)),g.badges="Please use loadBadgeData() or removeBadge()"),(0,d.buildAddonProxy)(s,this,"chat.badges",h,g)}getBadgeData(e){let i=e.parentElement?.parentElement;i?.dataset?.roomId||(i=e.closest("[data-room-id]"));const s=i?.dataset?.roomId,n=i?.dataset?.room,o=i?.dataset?.userId,h=i?.dataset?.user;let g;if(e.dataset.badgeData)g=JSON.parse(e.dataset.badgeData);else{const E=e.dataset.badgeIdx;let R;if(i.message)R=i.message;else{const T=this.resolve("site.fine");if(T){if(R=i[T.accessor]?.return?.stateNode?.props?.message,R||(R=T.searchParent(i,L=>L.props?.message)?.props?.message),!R&&this.root.flavor==="clips"){const L=this.resolve("site.chat.line"),q=T.searchParent(i,le=>le.props?.node)?.props?.node;L&&q&&(R=L.messages.get(q))}R||(R=T.searchParent(i,L=>L.props?.node)?.props?.node?._ffz_message),R||(R=T.searchParent(i,L=>L.props?.messageContext)?.props?.messageContext?.comment?._ffz_message),R||(R=T.searchParent(i,L=>L._ffzIdentityMsg,50)?._ffzIdentityMsg)}}R?._ffz_message&&(R=R._ffz_message),R&&(g=R.ffz_badge_cache?.[E]?.[1]?.badges)}return{room_id:s,room_login:n,user_id:o,user_login:h,data:g}}handleClick(e){const i=this.parent.context.get("chat.badges.clickable");if(!i)return;const s=e.target,n=this.getBadgeData(s);if(n.data==null)return;let o=null,h=null;for(const g of n.data){const E=g.provider;if(E==="twitch"){const R=this.getTwitchBadge(g.badge,g.version,n.room_id,n.room_login),T=this.getTwitchBadge(g.badge,g.version,null,null,!0)||{};if(!R)continue;i==1&&R.click_url?o=R.click_url:i==1&&T.click_url?o=T.click_url:i==1&&(R.click_action==="sub"||T.click_action==="sub")&&n.room_login?o=`https://www.twitch.tv/subs/${n.room_login}`:h=R;break}else if(E==="ffz"){const R=this.badges[s.dataset.badge];if(R?.click_handler){o=R.click_handler(n.user_id,n.user_login,n.room_id,n.room_login,n.data,e);break}if(R?.click_url){o=R.click_url;break}}}if(h){const g=this.resolve("site.fine");if(g){const E=g.searchParent(s,R=>R.openBadgeDetails&&R.props?.message);if(E){E.openBadgeDetails(h,e);return}}}o&&(0,re.createElement)("a",{target:"_blank",rel:"noopener noreferrer",href:o}).click(),e.preventDefault()}cacheBadges(e,i=!1){if(e.ffz_badge_cache)return e.ffz_badge_cache;const s=i?{}:this.parent.context.get("chat.badges.hidden")||{},n=this.parent.context.get("chat.badges.style"),o=this.parent.context.get("chat.badges.custom-mod"),h=this.parent.context.get("chat.badges.custom-vip"),g=n>5,E=n!==5,R=n!==3&&n!==4,T=this.twitch_badges,L=new Map,q=e.badges||{},le=e.badgeDynamicData||{},pe=e.sourceRoomID?e.sourceRoomID:e.roomID,fe=e.sourceRoomID?null:e.roomLogin,De=this.parent.getRoom(pe,fe,!0),Ae=e.ffz_badges;let ye=50,Ie;for(const Fe in q)if((0,r.has)(q,Fe)){const je=q[Fe],Ue=s[Fe],Je=T&&T[Fe],ct=Je&&Je.__cat||"m-twitch";if(!Fe||Ue||Ue==null&&s[ct])continue;(0,r.has)(Bs,Fe)?Ie=Bs[Fe]:Ie=ye++;const yt=le[Fe]||Fe==="founder"&&le.subscriber,Qe=Fe==="moderator"&&o&&De&&De.data&&De.data.mod_urls,bt=Fe==="vip"&&h&&De&&De.data&&De.data.vip_badge,Ct=[];if(Qe){const Yt=this.getTwitchBadge(Fe,je,pe,fe);Ct.push({provider:"ffz",image:Qe[4]||Qe[2]||Qe[1],color:"#34ae0a",title:Yt?Yt.title:"Moderator",room:pe,data:yt})}else if(bt){const Yt=this.getTwitchBadge(Fe,je,pe,fe);Ct.push({provider:"ffz",image:bt[4]||bt[2]||bt[1],color:"transparent",title:Yt?Yt.title:"VIP",room:pe,data:yt})}else Ct.push({provider:"twitch",badge:Fe,version:je,room:pe,data:yt});L.set(Ie,{id:Fe,props:{"data-provider":"twitch","data-badge":Fe,"data-version":je,style:{}},badges:Ct})}if(Array.isArray(Ae)){const Fe=new Set;for(const je of Ae)if(je&&je.id!=null){if(Fe.has(je.id))continue;Fe.add(je.id);const Ue=this.badges[je.id]||{},Je=typeof Ue.addon=="string"?`m-addon-${Ue.addon}`:Ue.addon?"m-addon":"m-ffz",ct=je.base_id??je.id,yt=s[ct];if(yt||yt==null&&s[Je])continue;const Qe=(0,r.has)(je,"slot")?je.slot:Ue.slot,bt=L.get(Qe),Ct=je.urls||(je.image?{1:je.image}:null),Yt=je.color||Ue.color||"transparent",ci=je.no_invert,pi=Yt!=="transparent"&&g,Ti=Ct||Ue.urls||{1:Ue.image},mi={provider:"ffz",id:je.id,badge:je,room:je.room,image:Ti[4]||Ti[2]||Ti[1],color:je.color||Ue.color,title:je.title||Ue.title};Ue.addon||(mi.image=`//cdn.frankerfacez.com/badge/${je.id}/4/rounded`,mi.color=null);let Zt;if(bt){bt.badges.push(mi);const ii=(0,r.has)(je,"replaces")?je.replaces:Ue.replaces,Si=je.replaces_type||Ue.replaces_type;if(ii&&(!Si||Si===bt.id))bt.replaced=je.id,bt.content=je.content||Ue.content||bt.content;else continue;Zt=bt.props.style}else{if(Qe==null)continue;{Zt={};const ii={className:"ffz-tooltip ffz-badge","data-tooltip-type":"badge","data-provider":"ffz","data-badge":je.id,style:Zt};L.set(Qe,{id:je.id,props:ii,badges:[mi],content:je.content||Ue.content})}}if(ci){const ii=L.get(Qe);ii.full_size=!0,ii.no_invert=!0,Zt.background="unset",Zt.backgroundSize="unset",Zt[Zi]="unset"}if((R||Yt==="transparent")&&Ct){const ii=`url("${Ct[1]}")`;let Si;(Ct[2]||Ct[4])&&(Si=`${f.WEBKIT_CSS}image-set(${ii} 1x${Ct[2]?`, url("${Ct[2]}") 2x`:""}${Ct[4]?`, url("${Ct[4]}") 4x`:""})`),Zt[pi&&!ci?Zi:"backgroundImage"]=ii,Si&&(Zt[pi&&!ci?Zi:"backgroundImage"]=Si)}E&&je.color&&(pi&&!ci?Zt.backgroundImage=`linear-gradient(${je.color},${je.color})`:Zt.backgroundColor=je.color)}}return e.ffz_badge_cache=Array.from(L).sort((Fe,je)=>Fe[0]-je[0])}render(e,i,s=!1,n=!1){if(!e.badges&&!e.ffz_badges||(e.ffz_badge_cache||this.cacheBadges(e,s),!e.ffz_badge_cache.length))return null;const o=[];for(let h=0,g=e.ffz_badge_cache.length;h<g;h++){const E=e.ffz_badge_cache[h][1],R=E.props;let T=(0,r.maybe_call)(E.content,this,E,e,i);T&&!Array.isArray(T)&&(T=[T]),R.className=`ffz-tooltip ffz-badge${T?" tw-pd-x-05":""}${E.full_size?" ffz-full-size":""}${E.no_invert?" ffz-no-invert":""}`,R.key=`${R["data-provider"]}-${R["data-badge"]}`,R["data-tooltip-type"]="badge",R["data-badge-idx"]=h,n||(R.onClick=this.handleClick),E.replaced&&(R["data-replaced"]=E.replaced),o.push(i("span",R,T||void 0))}return o}rebuildColor(){this.parent.context.get("chat.badges.fix-colors")?(this.fg_fixer=new Mt.ColorAdjuster("#fff",1,4.5),this.color_fixer=new Mt.ColorAdjuster(this.parent.context.get("theme.is-dark")?"#181818":"#FFFFFF",1,2.5)):(this.fg_fixer=null,this.color_fixer=null)}rebuildColoredBadges(){this.rebuildColor(),this.buildBadgeCSS(),this.buildTwitchCSSBadgeCSS()}rebuildAllCSS(){this.rebuildColor();for(const e of this.parent.iterateRooms())e.buildBadgeCSS(),e.buildModBadgeCSS();this.buildBadgeCSS(),this.buildTwitchBadgeCSS(),this.buildTwitchCSSBadgeCSS()}getBadges(e,i,s,n){const o=this.parent.getRoom(s,n,!0),h=this.parent.getUser(e,i,!0);h&&(e=e??h.id,i=i??h.login);const g=o&&o.getUser(e,i,!0),E=(h?.badges?h.badges._cache:[]).concat(g?.badges?g.badges._cache.map(R=>({...R,room:s})):[]);if(this.bulk.size){const R=String(e);for(const[T,L]of this.bulk)L?._cache.has(R)&&E.push({id:T})}return E}setBulk(e,i,s){let n=this.bulk.get(i);n||this.bulk.set(i,n=new r.SourcedSet(!0)),n.set(e,s)}deleteBulk(e,i){const s=this.bulk.get(i);s&&s.delete(e)}extendBulk(e,i,s){let n=this.bulk.get(i);n||this.bulk.set(i,n=new r.SourcedSet(!0)),Array.isArray(s)||(s=[s]),n.extend(e,...s)}async loadGlobalBadges(e=0){this.load_tracker.schedule("chat-data","ffz-global-badges");let i,s;if(this.experiments.getAssignment("api_load")&&e<1)try{fetch(`${f.NEW_API}/v1/badges/ids`).catch(()=>{})}catch{}try{i=await fetch(`${this.staging.api}/v1/badges/ids`)}catch(h){return e++,e<10?setTimeout(()=>this.loadGlobalBadges(e),500*e):(this.log.error("Error loading global badge data.",h),this.load_tracker.notify("chat-data","ffz-global-badges",!1),!1)}if(!i.ok)return this.load_tracker.notify("chat-data","ffz-global-badges",!1),!1;try{s=await i.json()}catch(h){return this.log.error("Error parsing global badge data.",h),this.load_tracker.notify("chat-data","ffz-global-badges",!1),!1}let n=0,o=0;if(s.badges)for(const h of s.badges)h&&h.id&&(this.loadBadgeData(h.id,h,!1),n++);if(s.users){for(const h in s.users)if((0,r.has)(s.users,h)){const g=this.badges[h],E=g?.name;let R=0;if(E==="supporter"||E==="subwoofer"||E==="bot")this.setBulk("ffz-global",h,s.users[h].map(T=>String(T))),R=s.users[h].length;else for(const T of s.users[h])this.parent.getUser(T,void 0).addBadge("ffz-global",h)&&(R++,o++);R>0&&this.log.info(`Added "${g?g.name:`#${h}`}" to ${R} users.`)}}this.log.info(`Loaded ${n} badges and assigned them to ${o} users.`),this.buildBadgeCSS(),this.load_tracker.notify("chat-data","ffz-global-badges")}getBadge(e){return this.badges[e]??null}removeBadge(e,i=!0){this.badges[e]&&(delete this.badges[e],i&&this.buildBadgeCSS())}loadBadgeData(e,i,s=!0){this.badges[e]=i,i&&(i.addon===void 0&&(i.addon=/^addon/.test(e)),i.replaces&&!i.replaces_type&&(i.replaces_type=i.replaces,i.replaces=!0),!i.addon&&(i.name==="developer"||i.name==="subwoofer"||i.name==="supporter")&&(i.click_url="https://www.frankerfacez.com/subscribe"),!i.addon&&i.name==="subwoofer"&&(i.base_id=i.id,i.tooltipExtra=n=>n?.user_id?this.getSubwooferMonths(n.user_id).then(o=>{if(o?.months)return o.lifetime?`
`+this.i18n.t("badges.subwoofer.lifetime","Lifetime Subwoofer"):`
`+this.i18n.t("badges.subwoofer.months","({count, plural, one {# Month} other {# Months}})",{count:o.months})}):null)),s&&this.buildBadgeCSS()}getSubwooferMonths(e){let i=this._woofer_months[e];if(i instanceof Promise)return i;const s=i?.expires;return s&&Date.now()>=s&&(i=this._woofer_months[e]=null),i?.value?Promise.resolve(i.value):this._woofer_months[e]=fetch(`https://api.frankerfacez.com/v1/_user/id/${e}`).then(n=>n.ok?n.json():null).then(n=>{let o=null;return n?.user?.sub_months&&(o={months:n.user.sub_months,lifetime:n.user.sub_lifetime}),this._woofer_months[e]={expires:Date.now()+5*60*1e3,value:o},o}).catch(n=>(console.error("Error getting subwoofer data for user",e,n),this._woofer_months[e]={expires:Date.now()+60*1e3,value:null},null))}buildBadgeCSS(){const e=this.parent.context.get("chat.badges.style"),i=this.parent.context.get("theme.is-dark"),s=this.parent.context.get("chat.badges.clickable"),n=f.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),o=[];for(const h in this.badges)if((0,r.has)(this.badges,h)){const g=this.badges[h],E=`.ffz-badge[data-badge="${h}"]`;o.push(`.ffz-badge[data-replaced="${h}"]{${Ys(g,e,i)}}`),n?(o.push(`@media (max-resolution: 99dpi) {${E}{${oi(h,0,g,e,i,0,this.color_fixer,this.fg_fixer,1,s)}}}`),o.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) {${E}{${oi(h,0,g,e,i,0,this.color_fixer,this.fg_fixer,2,s)}}}`),o.push(`@media (min-resolution: 200dpi) {${E}{${oi(h,0,g,e,i,0,this.color_fixer,this.fg_fixer,4,s)}}}`)):o.push(`${E}{${oi(h,0,g,e,i,0,this.color_fixer,this.fg_fixer,void 0,s)}}`)}this.style.set("ext-badges",o.join(`
`))}getTwitchBadge(e,i,s,n,o=!1){const h=this.parent.getRoom(s,n,!0);let g;if(h){const E=h.badges&&h.badges[e];g=E&&E[i]}if(!g){const E=this.twitch_badges&&this.twitch_badges[e];g=E&&E[i]}if(!g&&!o){const E=this.resolve("site.chat");E&&E.tryUpdateBadges&&E.tryUpdateBadges()}return g}getTwitchBadgeCount(){return this.twitch_badge_count||0}updateTwitchBadges(e){if(this.twitch_badge_count=0,!e)this.twitch_badges={};else if(!Array.isArray(e))this.twitch_badges=e;else{let i=null;if(e.length){i={};for(const s of e){const n=s.setID,o=i[n]=i[n]||{__cat:qi(n)};this.twitch_badge_count++,o[s.version]=Yi(s)}}this.twitch_badges=i}this.buildTwitchBadgeCSS(),this.buildTwitchCSSBadgeCSS()}buildTwitchCSSBadgeCSS(){const e=this.parent.context.get("chat.badges.style"),i=this.parent.context.get("theme.is-dark"),s=this.parent.context.get("chat.badges.clickable"),n=f.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),o=this.parent.context.get("chat.badges.version"),h=Ps[o]||{},g=this.twitch_badges||{},E=[];for(const R in h)if((0,r.has)(h,R)){const T=h[R],L=g[R];for(const q in T)if((0,r.has)(T,q)){const le=T[q],pe=L?.[q],fe=`.ffz-badge[data-badge="${R}"][data-version="${q}"]`;pe&&pe.click_url&&(le.click_url=pe.click_url),pe&&pe.click_action&&(le.click_action=pe.click_action),n?(E.push(`@media (max-resolution: 99dpi) {${fe}{${oi(R,q,le,e,i,o,this.color_fixer,this.fg_fixer,1,s)}}}`),E.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) {${fe}{${oi(R,q,le,e,i,o,this.color_fixer,this.fg_fixer,2,s)}}}`),E.push(`@media (min-resolution: 200dpi) {${fe}{${oi(R,q,le,e,i,o,this.color_fixer,this.fg_fixer,4,s)}}}`)):E.push(`${fe}{${oi(R,q,le,e,i,o,this.color_fixer,this.fg_fixer,void 0,s)}}`)}}this.style.set("css-badges",E.join(`
`))}buildTwitchBadgeCSS(){this.twitch_badges||this.style.delete("twitch-badges");const e=this.parent.context.get("chat.badges.version"),i=f.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),s=this.parent.context.get("chat.badges.clickable"),n=Ps[e]||{},o=[];for(const h in this.twitch_badges)if((0,r.has)(this.twitch_badges,h)){if((0,r.has)(n,h))continue;const g=this.twitch_badges[h];for(const E in g)if((0,r.has)(g,E)){const R=g[E],T=`.ffz-badge[data-badge="${h}"][data-version="${E}"]`;o.push(`${T} {
			${s&&(R.click_action||R.click_url)?"cursor:pointer;":""}
			background-color: transparent;
			filter: none;
			${f.WEBKIT_CSS}mask-image: none;
			background-size: 1.8rem;
			background-image: url("${R.image1x}");
			background-image: ${f.WEBKIT_CSS}image-set(
				url("${R.image1x}") 1x,
				url("${R.image2x}") 2x,
				url("${R.image4x}") 4x
			);
		}`),i&&(o.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) { ${T} {
								background-image: url("${R.image2x}");
							}}`),o.push(`@media (min-resolution: 200dpi) { ${T} {
								background-image: url("${R.image4x}");
							}}`))}}o.length?this.style.set("twitch-badges",o.join(`
`)):this.style.delete("twitch-badges")}};B(xs,"Badges");let Ki=xs;const Xs=["vga-champ-2017","warcraft","samusoffer_beta","power-rangers","bits-charity","glhf-pledge"];function qi(k){return Xs.includes(k)?"m-other":k.startsWith("overwatch-league")?"m-owl":k.startsWith("twitchcon")||k.startsWith("glitchcon")?"m-tcon":/_\d+$/.test(k)?"m-game":"m-twitch"}B(qi,"getBadgeCategory");function Yi(k){if(!k)return k;if(k={...k},!k.clickAction&&k.onClickAction&&(k.clickAction=k.onClickAction),k.clickAction==="VISIT_URL"&&k.clickURL&&(k.click_url=k.clickURL),k.clickAction==="TURBO"&&(k.click_url="https://www.twitch.tv/products/turbo?ref=chat_badge"),k.clickAction==="SUBSCRIBE"&&k.channelName?k.click_url=`https://www.twitch.tv/subs/${k.channelName}`:k.clickAction&&(k.click_action="sub"),k.setID==="subscriber"){const e=parseInt(k.version,10);!isNaN(e)&&isFinite(e)?(k.tier=(e-e%1e3)/1e3,k.tier<0&&(k.tier=0)):k.tier=0}return k}B(Yi,"fixBadgeData");var Js=X(98750),$s=X.n(Js),Qs=X(60795),en=X.n(Qs);const ai=Symbol("FFZ:Hover:RAF"),yi=Symbol("FFZ:Hover:State"),tn=f.IS_OSX?"metaKey":"ctrlKey",Pt=(0,r.make_enum_flags)("Hidden","FlipX","FlipY","GrowX","Slide","Appear","Leave","Rotate","Rotate90","Greyscale","Sepia","Rainbow","HyperRed","Shake","Cursed","Jam","Bounce","NoSpace"),Ei=Pt,pr=Object.values(Ei).filter(k=>typeof k=="number"),$i=[[0,-18,0,0],[19.99,-18,0,0],[20,-18,.1,0],[25,-16,.2,.6],[30,-14,.3,-4],[35,-12,.4,.6],[40,-10,.5,-4],[45,-8,.6,2],[50,-6,.7,-3],[55,-4,.8,2],[60,-2,.9,-3],[65,0,1,0],[100,0,1,0]],Oi=[[0,0,1,0],[39.99,0,1,0],[40,0,-.9,.9,-3],[45,-2,-.8,.8,2],[50,-4,-.7,.7,-3],[55,-6,-.6,.6,2],[60,-8,-.5,.5,-4],[65,-10,-.4,.4,.6],[70,-12,-.3,.3,-4],[75,-14,-.2,.2,.6],[80,-16,-.1,.1,0],[85,-18,-.01,0,0],[100,-18,0,0,0]];function li(k,e=1,i=0,s=!1){const n=[];for(const o of k){const h=o[0]*e+i;let g,E,R,T;if(g=s?"var(--ffz-effect-transforms) ":"",E=o[1]===0?"":`translateX(${o[1]}px) `,o.length===4)R=`scale(${o[2]})`,T=o[3]===0?"":` translateY(${o[3]}px)`;else{const L=o[2],q=o[3];R=`scale(${L}, ${q})`,T=o[4]===0?"":` translateY(${o[4]}px)`}n.push(`	${h}% { transform:${g}${E}${R}${T}; }`)}return n.join(`
`)}B(li,"appearLeaveToKeyframes");const Fi=[{setting:"FlipX",flags:Pt.FlipX,title:"Flip Horizontal",transform:"scaleX(-1)"},{setting:"FlipY",flags:Pt.FlipY,title:"Flip Vertical",transform:"scaleY(-1)"},{setting:"ShrinkX",flags:Pt.ShrinkX,title:"Squish Horizontal"},{setting:"GrowX",flags:Pt.GrowX,title:"Stretch Horizontal"},{setting:"Slide",flags:Pt.Slide,title:"Slide Animation",as_background:!0,animation:"ffz-effect-slide var(--ffz-speed-x) linear infinite",raw:`@keyframes ffz-effect-slide {
0% { background-position-x: 0; }
100% { background-position-x: calc(-1 * var(--ffz-width)); }
}`},{setting:"Appear",flags:Pt.Appear,not_flags:Pt.Leave,title:"Appear Animation",animation:"ffz-effect-appear 3s infinite linear",animationTransform:"ffz-effect-appear-transform 3s linear infinite",raw:`@keyframes ffz-effect-appear {
${li($i)}
}
@keyframes ffz-effect-appear-transform {
${li($i,1,0,!0)}
}`},{setting:"Leave",flags:Pt.Leave,not_flags:Pt.Appear,title:"Leave Animation",animation:"ffz-effect-leave 3s infinite linear",animationTransform:"ffz-effect-leave-transform 3s infinite linear",raw:`@keyframes ffz-effect-leave {
${li(Oi)}
}
@keyframes ffz-effect-leave-transform {
${li(Oi,1,0,!0)}
}`},{setting:["Appear","Leave"],flags:Pt.Appear|Pt.Leave,animation:"ffz-effect-in-out 6s infinite linear",animationTransform:"ffz-effect-in-out-transform 6s linear infinite",raw:`@keyframes ffz-effect-in-out {
${li($i,.5,0)}
${li(Oi,.5,50)}
}
@keyframes ffz-effect-in-out-transform {
${li($i,.5,0,!0)}
${li(Oi,.5,50,!0)}
}`},{setting:"Rotate",flags:Pt.Rotate,not_flags:Pt.Slide,title:"Rotate Animation",no_wide:!0,animation:"ffz-effect-rotate 1.5s infinite linear",animationTransform:"ffz-effect-rotate-transform 1.5s infinite linear",raw:`@keyframes ffz-effect-rotate {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
@keyframes ffz-effect-rotate-transform {
0% { transform: var(--ffz-effect-transforms) rotate(0deg); }
100% { transform: var(--ffz-effect-transforms) rotate(360deg); }
}`},{setting:"Rainbow",flags:Pt.Rainbow,title:"Rainbow Animation",animation:"ffz-effect-rainbow 2s linear infinite",animationFilter:"ffz-effect-rainbow-filter 2s linear infinite",raw:`@keyframes ffz-effect-rainbow {
	0% { filter: hue-rotate(0deg) }
	100% { filter: hue-rotate(360deg) }
}
@keyframes ffz-effect-rainbow-filter {
	0% { filter: var(--ffz-effect-filters) hue-rotate(0deg) }
	100% { filter: var(--ffz-effect-filters) hue-rotate(360deg) }
}`},{setting:"HyperRed",flags:Pt.HyperRed,title:"Hyper Red",filter:"brightness(0.2) sepia(1) brightness(2.2) contrast(3) saturate(8)"},{setting:"Shake",flags:Pt.Shake,title:"Hyper Shake Animation",animation:"ffz-effect-shake 0.1s linear infinite",animationTransform:"ffz-effect-shake-transform 0.1s linear infinite",raw:`@keyframes ffz-effect-shake-transform {
	0% { transform: var(--ffz-effect-transforms) translate(1px, 1px); }
	10% { transform: var(--ffz-effect-transforms) translate(-1px, -2px); }
	20% { transform: var(--ffz-effect-transforms) translate(-3px, 0px); }
	30% { transform: var(--ffz-effect-transforms) translate(3px, 2px); }
	40% { transform: var(--ffz-effect-transforms) translate(1px, -1px); }
	50% { transform: var(--ffz-effect-transforms) translate(-1px, 2px); }
	60% { transform: var(--ffz-effect-transforms) translate(-3px, 1px); }
	70% { transform: var(--ffz-effect-transforms) translate(3px, 1px); }
	80% { transform: var(--ffz-effect-transforms) translate(-1px, -1px); }
	90% { transform: var(--ffz-effect-transforms) translate(1px, 2px); }
	100% { transform: var(--ffz-effect-transforms) translate(1px, -2px); }
}
@keyframes ffz-effect-shake {
	0% { transform: translate(1px, 1px); }
	10% { transform: translate(-1px, -2px); }
	20% { transform: translate(-3px, 0px); }
	30% { transform: translate(3px, 2px); }
	40% { transform: translate(1px, -1px); }
	50% { transform: translate(-1px, 2px); }
	60% { transform: translate(-3px, 1px); }
	70% { transform: translate(3px, 1px); }
	80% { transform: translate(-1px, -1px); }
	90% { transform: translate(1px, 2px); }
	100% { transform: translate(1px, -2px); }
}`},{setting:"Photocopy",flags:Pt.Cursed,title:"Cursed",filter:"grayscale(1) brightness(0.7) contrast(2.5)"},{setting:"Jam",flags:Pt.Jam,title:"Jam Animation",animation:"ffz-effect-jam 0.6s linear infinite",animationTransform:"ffz-effect-jam-transform 0.6s linear infinite",raw:`@keyframes ffz-effect-jam {
	0% { transform: translate(-2px, -2px) rotate(-6deg); }
	10% { transform: translate(-1.5px, -2px) rotate(-8deg); }
	20% { transform: translate(1px, -1.5px) rotate(-8deg); }
	30% { transform: translate(3px, 2.5px) rotate(-6deg); }
	40% { transform: translate(3px, 4px) rotate(-2deg); }
	50% { transform: translate(2px, 4px) rotate(3deg); }
	60% { transform: translate(1px, 4px) rotate(3deg); }
	70% { transform: translate(-0.5px, 3px) rotate(2deg); }
	80% { transform: translate(-1.25px, 1px) rotate(0deg); }
	90% { transform: translate(-1.75px, -0.5px) rotate(-2deg); }
	100% { transform: translate(-2px, -2px) rotate(-5deg); }
}
@keyframes ffz-effect-jam-transform {
	0% { transform: var(--ffz-effect-transforms) translate(-2px, -2px) rotate(-6deg); }
	10% { transform: var(--ffz-effect-transforms) translate(-1.5px, -2px) rotate(-8deg); }
	20% { transform: var(--ffz-effect-transforms) translate(1px, -1.5px) rotate(-8deg); }
	30% { transform: var(--ffz-effect-transforms) translate(3px, 2.5px) rotate(-6deg); }
	40% { transform: var(--ffz-effect-transforms) translate(3px, 4px) rotate(-2deg); }
	50% { transform: var(--ffz-effect-transforms) translate(2px, 4px) rotate(3deg); }
	60% { transform: var(--ffz-effect-transforms) translate(1px, 4px) rotate(3deg); }
	70% { transform: var(--ffz-effect-transforms) translate(-0.5px, 3px) rotate(2deg); }
	80% { transform: var(--ffz-effect-transforms) translate(-1.25px, 1px) rotate(0deg); }
	90% { transform: var(--ffz-effect-transforms) translate(-1.75px, -0.5px) rotate(-2deg); }
	100% { transform: var(--ffz-effect-transforms) translate(-2px, -2px) rotate(-5deg); }
}`},{setting:"Bounce",flags:Pt.Bounce,animation:"ffz-effect-bounce 0.5s linear infinite",animationTransform:"ffz-effect-bounce-transform 0.5s linear infinite",transformOrigin:"bottom center",raw:`@keyframes ffz-effect-bounce {
	0% { transform: scale(0.8, 1); }
	10% { transform: scale(0.9, 0.8); }
	20% { transform: scale(1, 0.4); }
	25% { transform: scale(1.2, 0.3); }
	25.001% { transform: scale(-1.2, 0.3); }
	30% { transform: scale(-1, 0.4); }
	40% { transform: scale(-0.9, 0.8); }
	50% { transform: scale(-0.8, 1); }
	60% { transform: scale(-0.9, 0.8); }
	70% { transform: scale(-1, 0.4); }
	75% { transform: scale(-1.2, 0.3); }
	75.001% { transform: scale(1.2, 0.3); }
	80% { transform: scale(1, 0.4); }
	90% { transform: scale(0.9, 0.8); }
	100% { transform: scale(0.8, 1); }
}
@keyframes ffz-effect-bounce-transform {
	0% { transform: scale(0.8, 1) var(--ffz-effect-transforms); }
	10% { transform: scale(0.9, 0.8) var(--ffz-effect-transforms); }
	20% { transform: scale(1, 0.4) var(--ffz-effect-transforms); }
	25% { transform: scale(1.2, 0.3) var(--ffz-effect-transforms); }
	25.001% { transform: scale(-1.2, 0.3) var(--ffz-effect-transforms); }
	30% { transform: scale(-1, 0.4) var(--ffz-effect-transforms); }
	40% { transform: scale(-0.9, 0.8) var(--ffz-effect-transforms); }
	50% { transform: scale(-0.8, 1) var(--ffz-effect-transforms); }
	60% { transform: scale(-0.9, 0.8) var(--ffz-effect-transforms); }
	70% { transform: scale(-1, 0.4) var(--ffz-effect-transforms); }
	75% { transform: scale(-1.2, 0.3) var(--ffz-effect-transforms); }
	75.001% { transform: scale(1.2, 0.3) var(--ffz-effect-transforms); }
	80% { transform: scale(1, 0.4) var(--ffz-effect-transforms); }
	90% { transform: scale(0.9, 0.8) var(--ffz-effect-transforms); }
	100% { transform: scale(0.8, 1) var(--ffz-effect-transforms); }
}`},{setting:["Bounce","FlipY"],flags:Pt.Bounce|Pt.FlipY,transform:"translateY(100%)"}];function sn(){const k=[`.modified-emote[data-effects] > .chat-line__message--emote {
	--ffz-effect-filters: none;
	--ffz-effect-transforms: initial;
	--ffz-effect-animations: initial;
}`];for(const e of Fi)e.raw&&k.push(e.raw);return k.join(`
`)}B(sn,"generateBaseFilterCss");const Os={59847:{modifier_offset:"0 15px 15px 0",modifier:!0},70852:{modifier:!0,modifier_offset:"0 5px 20px 0",extra_width:5,shrink_to_fit:!0},70854:{modifier:!0,modifier_offset:"30px 0 0"},147049:{modifier:!0,modifier_offset:"4px 1px 0 3px"},147011:{modifier:!0,modifier_offset:"0"},70864:{modifier:!0,modifier_offset:"0"},147038:{modifier:!0,modifier_offset:"0"}},Es=class Es extends d.default{constructor(...e){super(...e),this.EmoteTypes=f.EmoteTypes,this.ModifierFlags=Ei,this.filters={},this.__filters=[],this.inject("i18n"),this.inject("settings"),this.inject("experiments"),this.inject("staging"),this.inject("load_tracker"),this.twitch_inventory_sets=new Set,this.__twitch_emote_to_set={},this.__twitch_set_to_channel={},this.__twitch_emote_to_artist={},this.bulk=new Map,this.effects_enabled={},this.pending_effects=new Set,this.applyEffects=this.applyEffects.bind(this),this.sub_sets=new r.SourcedSet,this.default_sets=new r.SourcedSet,this.global_sets=new r.SourcedSet,this.providers=new Map,this.setProvider("ffz",{name:"FrankerFaceZ",font_icon:"ffz-i-zreknarf"}),this.emote_sets={},this._set_refs={},this._set_timers={},this.settings.add("chat.emotes.source-priorities",{default:null,ui:{path:"Chat > Emote Priorities",component:"emote-priorities",data:()=>(0,r.deep_copy)(this.providers)}}),this.settings.add("chat.emotes.enabled",{default:2,ui:{path:"Chat > Appearance >> Emotes",title:"Display Emotes",sort:-100,force_seen:!0,description:"If you do not wish to see emotes, you can disable them here.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch Only"},{value:2,title:"Enabled"}]}}),this.settings.add("chat.emotes.2x",{default:0,process(i,s){return s===!0?1:s===!1?0:s},ui:{path:"Chat > Appearance >> Emotes",title:"Larger Emotes",description:"This setting will make emotes appear twice as large in chat. It's good for use with larger fonts or just if you really like emotes.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Emotes"},{value:2,title:"Emotes and Emoji"}]}}),this.settings.add("chat.emotes.limit-size",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:"Limit Native Emote Size",description:"Sometimes, really obnoxiously large emotes slip through the cracks and wind up on Twitch. This limits the size of Twitch emotes to mitigate the issue.",component:"setting-check-box"}}),this.settings.add("chat.emotes.allow-gigantify",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:'Allow "Gigantify an Emote" Power-Up',description:"How big is too big? Giant? Disable this and the emotes will be displayed normally.",component:"setting-check-box"}}),this.settings.add("chat.fix-bad-emotes",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:"Fix Bad Twitch Global Emotes",description:"Clean up the images for bad Twitch global emotes, removing white borders and solid backgrounds.",component:"setting-check-box"}}),this.settings.add("chat.click-emotes",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open emote information pages by Shift-Clicking them.",component:"setting-check-box"}}),this.settings.add("chat.sub-emotes",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open Twitch subscription pages by Shift-Clicking emotes when relevant.",component:"setting-check-box"}}),this.settings.add("chat.emote-dialogs",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open emote information cards for Twitch emotes by clicking them.",component:"setting-check-box"}}),this.settings.add("chat.effects.enable",{default:!0,ui:{path:"Chat > Emote Effects >> General",title:"Enable the use of emote effects.",description:"Emote Effects are special effects that can be applied to some emotes using special modifiers.",component:"setting-check-box"}});for(const i of Fi){if(!i.setting||Array.isArray(i.setting))continue;const s={default:i.animation?null:!0,ui:{path:'Chat > Emote Effects >> Specific Effect @{"description": "**Note:** Animated effects are, by default, only enabled when [Animated Emotes](~chat.appearance.emotes) are enabled."}',title:`Enable the effect "${i.title??i.setting}".`,component:"setting-check-box",force_seen:!0}};i.animation&&(s.default=null,s.requires=["chat.emotes.animated"],s.process=function(n,o){return o??n.get("chat.emotes.animated")===1}),this.settings.add(`chat.effects.${i.setting}`,s)}this.handleClick=this.handleClick.bind(this),this.animHover=this.animHover.bind(this),this.animLeave=this.animLeave.bind(this)}getAddonProxy(e,i,s){if(!e)return this;const n=f.DEBUG||i?.dev,o=(0,r.makeAddonIdChecker)(e),h={},g={};return h.addFilter=E=>(E&&(E.__source=e),this.addFilter(E)),h.setProvider=(E,R)=>(n&&!o.test(E)&&s.log.warn("[DEV-CHECK] Call to emotes.setProvider did not include addon ID in provider:",E),R&&(R.__source=e),this.setProvider(E,R)),h.addDefaultSet=(E,R,T)=>(n&&!o.test(E)&&s.log.warn("[DEV-CHECK] Call to emotes.addDefaultSet did not include addon ID in provider:",E),this.providers.has(E)||(this.inferProvider(E,e),n&&s.log.warn("[DEV-CHECK] Call to emotes.addDefaultSet for provider that has not been registered with emotes.setProvider:",E)),T&&(n&&!o.test(R)&&s.log.warn("[DEV-CHECK] Call to emotes.addDefaultSet loaded set data but did not include addon ID in set ID:",R),T.__source=e),this.addDefaultSet(E,R,T)),h.addSubSet=(E,R,T)=>(n&&!o.test(E)&&s.log.warn("[DEV-CHECK] Call to emotes.addSubSet did not include addon ID in provider:",E),this.providers.has(E)||(this.inferProvider(E,e),n&&s.log.warn("[DEV-CHECK] Call to emotes.addSubSet for provider that has not been registered with emotes.setProvider:",E)),T&&(n&&!o.test(R)&&s.log.warn("[DEV-CHECK] Call to emotes.addSubSet loaded set data but did not include addon ID in set ID:",R),T.__source=e),this.addSubSet(E,R,T)),h.loadSetData=(E,R,...T)=>(n&&!o.test(E)&&s.log.warn("[DEV-CHECK] Call to emotes.loadSetData did not include addon ID in set ID:",E),R&&(R.__source=e),this.loadSetData(E,R,...T)),n&&(h.removeFilter=E=>{let R;typeof E=="string"?R=E:R=E.type;const T=this.filters[R];return T&&T.__source!==e&&s.log.warn("[DEV-CHECK] Removed un-owned emote filter with emotes.removeFilter:",R," owner:",T.__source??"ffz"),this.removeFilter(E)},h.removeDefaultSet=(E,...R)=>(o.test(E)||s.log.warn("[DEV-CHECK] Call to emotes.removeDefaultSet did not include addon ID in provider:",E),this.removeDefaultSet(E,...R)),h.removeSubSet=(E,...R)=>(o.test(E)||s.log.warn("[DEV-CHECK] Call to emotes.removeSubSet did not include addon ID in provider:",E),this.removeSubSet(E,...R)),g.style=!0,g.effect_style=!0,g.emote_sets=!0,g.loadSetUserIds=g.loadSetUsers="This method is meant for internal use."),(0,d.buildAddonProxy)(s,this,"emotes",h,g)}onEnable(){this.style=new re.ManagedStyle("emotes"),this.effect_style=new re.ManagedStyle("effects"),this.base_effect_css=sn(),this.parent.context.getChanges("chat.emotes.source-priorities",this.updatePriorities,this),this.parent.context.on("changed:chat.effects.enable",this.updateEffects,this);for(const s of Fi)s.setting&&!Array.isArray(s.setting)&&this.parent.context.on(`changed:chat.effects.${s.setting}`,this.updateEffects,this);this.updateEffects();const e=this.getFavorites("twitch");let i=!1;for(let s=0;s<e.length;s++)typeof e[s]=="number"&&(i=!0,e[s]=`${e[s]}`);if(i&&this.setFavorites("twitch",e),Object.keys(this.emote_sets).length){this.log.info("Generating CSS for existing emote sets.");for(const s in this.emote_sets)if((0,r.has)(this.emote_sets,s)){const n=this.emote_sets[s];n&&(n.pending_css||n.css)&&(this.style.set(`es--${s}`,(n.pending_css||"")+(n.css||"")),n.pending_css=null)}}this.on("pubsub:command:follow_sets",this.updateFollowSets,this),this.on("pubsub:command:add_emote",s=>{const n=s.set_id,o=s.emote,h=this.emote_sets[n];if(!h)return;const g=!!h.emotes?.[o.id]||!!h.disabled_emotes?.[o.id],E=this.addEmoteToSet(n,o);this.maybeNotifyChange(g?"modified":"added",n,E)}),this.on("pubsub:command:remove_emote",s=>{const n=s.set_id,o=s.emote_id;if(!this.emote_sets[n])return;const h=this.removeEmoteFromSet(n,o);h&&this.maybeNotifyChange("removed",n,h)}),this.on("chat:reload-data",s=>{(!s||s.emotes)&&this.loadGlobalSets()}),this.on("addon:fully-unload",s=>{let n=0;for(const[o,h]of Object.entries(this.emote_sets))h?.__source===s&&(n++,this.loadSetData(o,null,!0));for(const[o,h]of Object.entries(this.filters))h?.__source===s&&(n++,this.removeFilter(o));for(const[o,h]of this.providers.entries())h?.__source===s&&(n++,this.setProvider(o,null));n&&this.log.debug(`Cleaned up ${n} entries when unloading addon:`,s)}),this.loadGlobalSets()}updatePriorities(e){const i=e?.length;!i||i<=0?this.sourceSortFn=null:this.sourceSortFn=(s,n)=>{s.startsWith("ffz-")&&(s="ffz"),n.startsWith("ffz-")&&(n="ffz");let o=e.indexOf(s),h=e.indexOf(n);return o===-1&&(o=i),h===-1&&(h=i),o-h},this.default_sets.setSortFunction(this.sourceSortFn),this.emit(":update-priorities",this.sourceSortFn)}inferProvider(e,i){if(this.providers.has(e))return;const s=this.resolve("addons")?.getAddon(i);s&&this.setProvider(e,{name:s.name,i18n_key:s.name_i18n,icon:s.icon,description:e,__source:i})}setProvider(e,i){i?(i.id=e,this.providers.set(e,i)):this.providers.delete(e)}addFilter(e,i=!0){const s=e.type;if((0,r.has)(this.filters,s)){this.log.warn(`Tried adding emote filter of type '${s}' when one was already present.`);return}this.filters[s]=e,e.priority==null&&(e.priotiy=0),this.__filters.push(e),this.__filters.sort((n,o)=>n.priority>o.priority?-1:n.priority<o.priority?1:n.type<o.type),i&&this.updateFiltered()}removeFilter(e,i=!0){let s;if(typeof e=="string"?s=e:s=e.type,e=this.filters[s],!e)return null;delete this.filters[s];const n=this.__filters.indexOf(e);return n!==-1&&(this.__filters.splice(n,1),i&&this.updateFiltered()),e}shouldFilterEmote(e,i,s){for(const n of this.__filters)if(n.test(e,i,s))return!0;return!1}updateFiltered(){for(const e of Object.values(this.emote_sets)){const i={},s={};let n=0,o=0,h=!1;for(const E of Object.values(e.emotes))this.shouldFilterEmote(E,e,e.id)?(s[E.id]=E,o++,h=!0):(i[E.id]=E,n++);for(const E of Object.values(e.disabled_emotes))this.shouldFilterEmote(E,e,e.id)?(s[E.id]=E,o++):(i[E.id]=E,n++,h=!0);if(!h)continue;this.log.info(`Filtered emote set #${e.id}: ${e.title} (total: ${n+o}, old: ${e.disabled_count}, new: ${o})`),e.emotes=i,e.count=n,e.disabled_emotes=s,e.disabled_count=o;const g=[];for(const E of Object.values(i)){const R=this.generateEmoteCSS(E);R?.length&&g.push(R)}this.style&&(g.length||e.css)?this.style.set(`es--${e.id}`,g.join("")+(e.css||"")):g.length&&(e.pending_css=g.join("")),this.emit(":loaded",e.id,e)}}maybeNotifyChange(e,i,s){this._pending_notifications||(this._pending_notifications=[]),this._pending_notifications.push({action:e,set_id:i,emote:s}),this._pending_timer||(this._pending_timer=setTimeout(()=>this._handleNotifyChange(),1e3))}_handleNotifyChange(){clearTimeout(this._pending_timer),this._pending_timer=null;const e=this._pending_notifications;this._pending_notifications=null;const i=this.resolve("site.chat");if(!i?.addNotice)return;const s=this.resolve("site").getUser();if(!s?.id)return;let n=this.parent.context.get("context.channelID"),o=this.parent.context.get("context.channel");const h=this.getSetIDs(s.id,s.login,n,o),g={};for(const E of e){const R=`${E.set_id}`,T=E.action;if(h.includes(R)){const L=g[R]=g[R]||{},q=L[T]=L[T]||[];if(q.find(le=>le.id===E.emote.id))continue;q.push(E.emote)}}for(const[E,R]of Object.entries(g)){const T=this.emote_sets[E];if(T)for(const[L,q]of Object.entries(R)){const le=q.map(fe=>fe.name).join(", ");let pe;L==="added"?pe=this.i18n.t("emote-updates.added","The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been added to {set}.",{count:q.length,emotes:le,set:T.title}):L==="modified"?pe=this.i18n.t("emote-updates.modified","The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been updated in {set}.",{count:q.length,emotes:le,set:T.title}):L==="removed"&&(pe=this.i18n.t("emote-updates.removed","The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been removed from {set}.",{count:q.length,emotes:le,set:T.title})),pe&&i.addNotice("*",{icon:"ffz-i-zreknarf",message:pe})}}}ensureEffect(e){this.effect_style.has(`${e}`)||(this.pending_effects.add(e),this._effect_timer||(this._effect_timer=requestAnimationFrame(this.applyEffects)))}applyEffects(){this._effect_timer=null;const e=this.pending_effects;this.pending_effects=new Set;for(const i of e){const s=this.generateFilterCss(i);this.effect_style.set(`${i}`,s??"")}}generateFilterCss(e){if(!this.parent.context.get("chat.effects.enable"))return null;let i,s,n,o,h=[];for(const g of this.activeEffectStyles)(e&g.flags)===g.flags&&(g.not_flags&&(e&g.not_flags)===g.not_flags||(g.animation&&h.push(g),g.filter&&(i=i?`${i} ${g.filter}`:g.filter),g.transformOrigin&&(s=g.transformOrigin),g.transform&&(n=n?`${n} ${g.transform}`:g.transform)));if(h.length)for(const g of h)i&&g.animationFilter?o=o?`${o}, ${g.animationFilter}`:g.animationFilter:n&&g.animationTransform?o=o?`${o}, ${g.animationTransform}`:g.animationTransform:o=o?`${o}, ${g.animation}`:g.animation;return!i&&!n&&!o?null:`.modified-emote[data-effects="${e}"] > .chat-line__message--emote {${i?`
	--ffz-effect-filters: ${i};
	filter: var(--ffz-effect-filters);`:""}${s?`
	transform-origin: ${s};`:""}${n?`
	--ffz-effect-transforms: ${n};
	transform: var(--ffz-effect-transforms);`:""}${o?`
	--ffz-effect-animations: ${o};
	animation: var(--ffz-effect-animations);`:""}
}`}updateEffects(){const e=this.parent.context.get("chat.effects.enable");this.effects_enabled={},this.activeEffectStyles=[],this.activeAsBackgroundMask=0,this.activeNoWideMask=0;for(const i of Fi)i.setting&&!Array.isArray(i.setting)&&(this.effects_enabled[i.setting]=this.parent.context.get(`chat.effects.${i.setting}`));for(const i of Fi){let s=!0;if(Array.isArray(i.setting)){for(const n of i.setting)if(!this.effects_enabled[n]){s=!1;break}}else i.setting&&(s=this.effects_enabled[i.setting]);s&&(this.activeEffectStyles.push(i),i.as_background&&(this.activeAsBackgroundMask=this.activeAsBackgroundMask|i.flags),i.no_wide&&(this.activeNoWideMask=this.activeNoWideMask|i.flags))}this.effect_style.clear(),!(!e||!this.activeEffectStyles.length)&&(this.effect_style.set("base",this.base_effect_css),this.emit(":update-effects"))}updateFollowSets(e){for(const i in e)if((0,r.has)(e,i)){const s=this.parent.getRoom(null,i,!0);if(!s||s.destroyed)continue;const n=e[i]||[],o=s.emote_sets,h=o&&o._sources;if(h&&h.has("ffz-featured"))for(const g of h.get("ffz-featured")){const E=n.indexOf(g);E===-1?s.removeSet("ffz-featured",g):n.splice(E,1)}for(const g of n)s.addSet("ffz-featured",g),this.emote_sets[g]||this.loadSet(g)}}toggleHidden(e,i,s=null){const n=`hidden-emotes.${e}`,o=this.settings.provider,h=o.get(n,[]),g=h.indexOf(i);if(s===null&&(s=g===-1),s&&g===-1)h.push(i);else if(!s&&g!==-1)h.splice(g,1);else return;h.length?o.set(n,h):o.delete(n),this.emit(":change-hidden",e,i,s)}isHidden(e,i){return this.getHidden(e).includes(i)}getHidden(e){return this.settings.provider.get(`hidden-emotes.${e}`)||[]}setHidden(e,i){const s=`hidden-emotes.${e}`;!Array.isArray(i)||!i.length?this.settings.provider.delete(s):this.settings.provider.set(s,i)}animHover(e){const i=e.currentTarget;i[yi]||(i[ai]&&cancelAnimationFrame(i[ai]),i[ai]=requestAnimationFrame(()=>{if(i[ai]=null,i[yi]||!i.matches(":hover"))return;i[yi]=!0;const s=i.querySelectorAll(".ffz-hover-emote");for(const n of s){const o=n.dataset;o.normalSrc&&o.hoverSrc&&(n.src=o.hoverSrc,n.srcset&&(n.srcset=o.hoverSrcSet))}}))}animLeave(e){const i=e.currentTarget;i[yi]&&(i[ai]&&cancelAnimationFrame(i[ai]),i[ai]=requestAnimationFrame(()=>{if(i[ai]=null,!i[yi]||i.matches(":hover"))return;i[yi]=!1;const s=i.querySelectorAll(".ffz-hover-emote");for(const n of s){const o=n.dataset;o.normalSrc&&(n.src=o.normalSrc,n.srcset&&(n.srcset=o.normalSrcSet))}}))}toggleFavorite(e,i,s=null){const n=`favorite-emotes.${e}`,o=this.settings.provider,h=o.get(n)||[],g=h.indexOf(i);if(s===null&&(s=g===-1),s&&g===-1)h.push(i);else if(!s&&g!==-1)h.splice(g,1);else return s;return h.length?o.set(n,h):o.delete(n),this.emit(":change-favorite",e,i,s),s}isFavorite(e,i){const s=this.settings.provider.get(`favorite-emotes.${e}`);return s&&s.includes(i)}getFavorites(e){return this.settings.provider.get(`favorite-emotes.${e}`)||[]}setFavorites(e,i){const s=`favorite-emotes.${e}`;!Array.isArray(i)||!i.length?this.settings.provider.delete(s):this.settings.provider.set(s,i)}handleClick(e,i=!1){const s=e.target,n=s&&s.dataset;if(!n)return;const o=n.provider,h=this.parent.context.get("chat.click-emotes"),g=this.parent.context.get("chat.sub-emotes");if(e.shiftKey&&(h||g)){let T;if(o==="twitch"){if(T=null,g){const L=this.resolve("site.apollo");if(L)return L.client.query({query:$s(),variables:{id:n.id}}).then(q=>{const le=(0,r.get)("data.emote.subscriptionProduct",q);if(le&&le.state==="ACTIVE"&&le.owner&&le.owner.login)T=`https://www.twitch.tv/subs/${le.owner.login}`;else if(!h)return!1;if(T){const pe=window.open();pe&&(pe.opener=null,pe.location=T)}}),!0}}else if(o==="ffz"){const L=this.emote_sets[n.set],q=L&&(L.emotes[n.id]||L.disabled_emotes?.[n.id]);if(!q)return;q.click_url?T=q.click_url:L.source||(T=`https://www.frankerfacez.com/emoticons/${q.id}`)}if(!h)return!1;if(T){const L=window.open();L&&(L.opener=null,L.location=T)}return!0}if(e[tn]){let T,L;if(o==="twitch")T="twitch",L=n.id;else if(o==="ffz"){const le=this.emote_sets[n.set],pe=le&&(le.emotes[n.id]||le.disabled_emotes?.[n.id]);if(!pe)return;T=le.source||"ffz",L=pe.id}else if(o==="emoji")T="emoji",L=n.code;else return;this.toggleFavorite(T,L);const q=s._ffz_tooltip;return q&&q.visible&&(q.hide(),setTimeout(()=>document.contains(s)&&q.show(),0)),!0}if(i)return!1;let E;try{E=JSON.parse(n.modifierInfo)}catch{}const R=this.makeEvent({provider:o,id:n.id,set:n.set,code:n.code,variant:n.variant,name:n.name||s.alt,modifiers:E,source:e});if(this.emit("chat.emotes:click",R),R.defaultPrevented)return!0;if(o==="twitch"&&this.parent.context.get("chat.emote-dialogs")){const T=this.resolve("site.fine");if(!T)return;const L=T.searchParent(s,pe=>pe.props&&pe.props.message),q=T.searchParent(s,pe=>pe.onShowEmoteCard,500);if(!L||!q)return;const le=s.getBoundingClientRect();return q.onShowEmoteCard({channelID:L.props.channelID||"",channelLogin:L.props.channelLogin||"",emoteID:n.id,emoteCode:s.alt,sourceID:"chat",referrerID:"",initialTopOffset:le.bottom,initialBottomOffset:le.top}),!0}}getTargetEmote(){this.target_emote=null;const e=this.resolve("site").getUser(),i=e?this.resolve("site.chat.input"):null,s=i?i.getInput():null,n=this.resolve("site.chat.emote_menu")?.MenuWrapper?.first,o=n?.getAllSets?.(),h=o?o.map(g=>g.emotes).flat().filter(g=>!g.effects&&!g.locked):null;if(s&&h){const g={};for(let T=0;T<h.length;T++)g[h[T].name]||(g[h[T].name]=T);const E=s.split(" ");let R=E.length;for(;R--;){const T=E[R];if(g[T]!=null)return h[g[T]]}}if(h&&h.length){const g=Math.floor(Math.random()*h.length),E=h[g];return this.target_emote=E,E}return this.target_emote={provider:"ffz",set_id:3,id:149346,name:"LaterSooner",src:"https://cdn.frankerfacez.com/emote/149346/1",srcSet:"https://cdn.frankerfacez.com/emote/149346/1 1x, https://cdn.frankerfacez.com/emote/149346/2 2x, https://cdn.frankerfacez.com/emote/149346/4 4x",width:25,height:32}}getSetIDs(e,i,s,n){const o=this.parent.getRoom(s,n,!0),h=o&&o.getUser(e,i,!0),g=this.parent.getUser(e,i,!0);let E=(g?.emote_sets?g.emote_sets._cache:[]).concat(h?.emote_sets?h.emote_sets._cache:[],o?.emote_sets?o.emote_sets._cache:[],this.default_sets._cache);if(this.bulk.size){const R=String(e);for(const[T,L]of this.bulk)L?._cache.has(R)&&E.push(T)}if(o?.shared_chats?.size>0)for(const R of o.shared_chats){const T=this.parent.getRoom(R,null,!0),L=T&&T.getUser(e,i,!0);L?.emote_sets?._cache&&(E=E.concat(L.emote_sets._cache)),T?.emote_sets?._cache&&(E=E.concat(T.emote_sets._cache))}return E}getSets(e,i,s,n){return this.getSetIDs(e,i,s,n).map(o=>this.emote_sets[o])}_withSources(e,i,s,n=null){if(s?._sources){for(const[o,h]of s._sources)for(const g of h)i.has(g)||(e.push([g,o,n]),i.add(g));return e}}getRoomSetIDsWithSources(e,i,s,n){const o=this.parent.getRoom(s,n,!0),h=o&&o.getUser(e,i,!0);if(!o)return[];const g=[],E=new Set;if(this._withSources(g,E,o.emote_sets,o.id),h&&this._withSources(g,E,h.emote_sets,o.id),o?.shared_chats?.size>0)for(const R of o.shared_chats){const T=this.parent.getRoom(R,null,!0),L=T&&T.getUser(e,i,!0);L&&this._withSources(g,E,L.emote_sets,R),T&&this._withSources(g,E,T.emote_sets,R)}return g}getRoomSetsWithSources(e,i,s,n){return this.getRoomSetIDsWithSources(e,i,s,n).map(([o,h,g])=>[this.emote_sets[o],h,g])}getRoomSetIDs(e,i,s,n){const o=this.parent.getRoom(s,n,!0),h=o&&o.getUser(e,i,!0);let g;if(o?h?.emote_sets?o.emote_sets?g=h.emote_sets._cache.concat(o.emote_sets._cache):g=h.emote_sets._cache:g=o.emote_sets?o.emote_sets._cache:[]:g=[],o?.shared_chats?.size>0)for(const E of o.shared_chats){const R=this.parent.getRoom(E,null,!0),T=R&&R.getUser(e,i,!0);T?.emote_sets?._cache&&(g=g.concat(T.emote_sets._cache)),R?.emote_sets?._cache&&(g=g.concat(R.emote_sets._cache))}return g}getRoomSets(e,i,s,n){return this.getRoomSetIDs(e,i,s,n).map(o=>this.emote_sets[o])}getGlobalSetIDsWithSources(e,i){const s=this.parent.getUser(e,i,!0),n=[],o=new Set;if(this._withSources(n,o,this.default_sets),s&&this._withSources(n,o,s.emote_sets),this.bulk.size){const h=String(e);for(const[g,E]of this.bulk)if(!o.has(g)&&E?._cache.has(h)){for(const[R,T]of E._sources)if(T&&T.includes(h)){n.push([g,R,null]);break}}}return n}getGlobalSetsWithSources(e,i){return this.getGlobalSetIDsWithSources(e,i).map(([s,n])=>[this.emote_sets[s],n,null])}getSubSetIDsWithSources(){const e=[],i=new Set;return this._withSources(e,i,this.sub_sets),e}getSubSetsWithSources(){return this.getSubSetIDsWithSources().map(([e,i])=>[this.emote_sets[e],i,null])}getGlobalSetIDs(e,i){const s=this.parent.getUser(e,i,!0),n=(s?.emote_sets?s.emote_sets._cache:[]).concat(this.default_sets._cache);if(this.bulk.size){const o=String(e);for(const[h,g]of this.bulk)g?._cache.has(o)&&n.push(h)}return n}getGlobalSets(e,i){return this.getGlobalSetIDs(e,i).map(s=>this.emote_sets[s])}getEmotes(e,i,s,n){const o={};for(const h of this.getSets(e,i,s,n))if(h&&h.emotes)for(const g of Object.values(h.emotes))g&&!(0,r.has)(o,g.name)&&(o[g.name]=g);return o}setBulk(e,i,s){let n=this.bulk.get(i);n||this.bulk.set(i,n=new r.SourcedSet(!0));const o=n._cache.size;n.set(e,s);const h=n._cache.size;!o&&h&&this.refSet(i)}deleteBulk(e,i){const s=this.bulk.get(i);if(!s)return;const n=s._cache.size;s.delete(e);const o=s._cache.size;n&&!o&&this.unrefSet(i)}extendBulk(e,i,s){let n=this.bulk.get(i);n||this.bulk.set(i,n=new r.SourcedSet(!0)),Array.isArray(s)||(s=[s]);const o=n._cache.size;n.extend(e,...s);const h=n._cache.size;!o&&h&&this.refSet(i)}addDefaultSet(e,i,s){typeof i=="number"&&(i=`${i}`);let n=!1,o=!1;return this.default_sets.sourceIncludes(e,i)||(n=!this.default_sets.includes(i),this.default_sets.push(e,i),o=!0),s&&this.loadSetData(i,s),n&&(this.refSet(i),this.emit(":update-default-sets",e,i,!0)),o}removeDefaultSet(e,i){if(!i){const s=this.default_sets.get(e);if(s)for(const n of Array.from(s))this.removeDefaultSet(e,n);return}return typeof i=="number"&&(i=`${i}`),this.default_sets.sourceIncludes(e,i)?(this.default_sets.remove(e,i),this.default_sets.includes(i)||(this.unrefSet(i),this.emit(":update-default-sets",e,i,!1)),!0):!1}addSubSet(e,i,s){typeof i=="number"&&(i=`${i}`);let n=!1,o=!1;return this.sub_sets.sourceIncludes(e,i)||(n=!this.sub_sets.includes(i),this.sub_sets.push(e,i),o=!0),s&&this.loadSetData(i,s),n&&(this.refSet(i),this.emit(":update-sub-sets",e,i,!0)),o}removeSubSet(e,i){return typeof i=="number"&&(i=`${i}`),this.sub_sets.sourceIncludes(e,i)?(this.sub_sets.remove(e,i),this.sub_sets.includes(i)||(this.unrefSet(i),this.emit(":update-sub-sets",e,i,!1)),!0):!1}refSet(e){this._set_refs[e]=(this._set_refs[e]||0)+1,this._set_timers[e]&&(clearTimeout(this._set_timers[e]),this._set_timers[e]=null)}unrefSet(e){(this._set_refs[e]=(this._set_refs[e]||1)-1)<=0&&!this._set_timers[e]&&(this._set_timers[e]=setTimeout(()=>this.unloadSet(e),5e3))}async loadGlobalSets(e=0){this.load_tracker.schedule("chat-data","ffz-global");let i,s;if(this.experiments.getAssignment("api_load")&&e<1)try{fetch(`${f.NEW_API}/v1/set/global`).catch(()=>{})}catch{}try{i=await fetch(`${this.staging.api}/v1/set/global/ids`)}catch(o){return e++,e<10?setTimeout(()=>this.loadGlobalSets(e),500*e):(this.log.error("Error loading global emote sets.",o),this.load_tracker.notify("chat-data","ffz-global",!1),!1)}if(!i.ok)return this.load_tracker.notify("chat-data","ffz-global",!1),!1;try{s=await i.json()}catch(o){return this.log.error("Error parsing global emote data.",o),this.load_tracker.notify("chat-data","ffz-global",!1),!1}const n=s.sets||{};this.removeDefaultSet("ffz-global");for(const o of s.default_sets)this.addDefaultSet("ffz-global",o);for(const o in n)if((0,r.has)(n,o)){const h=n[o]?.id;this.loadSetData(o,n[o]),h&&!s.default_sets.includes(h)&&this.addSubSet("ffz-global",o)}return s.user_ids?this.loadSetUserIds(s.user_ids):s.users&&this.loadSetUsers(s.users),this.load_tracker.notify("chat-data","ffz-global"),!0}async loadSet(e,i=!1,s=0){const n=`ffz-${e}`;this.load_tracker.schedule("chat-data",n);let o,h;if(this.experiments.getAssignment("api_load"))try{fetch(`${f.NEW_API}/v1/set/${e}`).catch(()=>{})}catch{}try{o=await fetch(`${this.staging.api}/v1/set/${e}${this.staging.active?"/ids":""}`)}catch(E){return s++,s<10?setTimeout(()=>this.loadGlobalSets(s),500*s):(this.log.error(`Error loading data for set "${e}".`,E),this.load_tracker.notify("chat-data",n,!1),!1)}if(!o.ok)return this.load_tracker.notify("chat-data",n,!1),!1;try{h=await o.json()}catch(E){return this.log.error(`Error parsing data for set "${e}".`,E),this.load_tracker.notify("chat-data",n,!1),!1}const g=h.set;return g&&this.loadSetData(g.id,g,i),h.user_ids?this.loadSetUserIds(h.user_ids):h.users&&this.loadSetUsers(h.users),this.load_tracker.notify("chat-data",n,!0),!0}loadSetUserIds(e,i=!1){for(const s in e)if((0,r.has)(e,s)){const n=this.emote_sets[s],o=e[s];this.setBulk("ffz-global",s,o.map(h=>String(h))),i||this.log.info(`Added "${n?n.title:s}" emote set to ${o.length} users.`)}}loadSetUsers(e,i=!1){for(const s in e)if((0,r.has)(e,s)){const n=this.emote_sets[s],o=e[s];for(const h of o)this.parent.getUser(void 0,h).addSet("ffz-global",s);i||this.log.info(`Added "${n?n.title:s}" emote set to ${o.length} users.`)}}processEmote(e,i){return!e.id||!e.name||!e.urls?null:(e.set_id=i,e.src=e.urls[1],e.srcSet=`${e.urls[1]} 1x`,e.urls[2]&&(e.srcSet+=`, ${e.urls[2]} 2x`),e.urls[4]&&(e.srcSet+=`, ${e.urls[4]} 4x`),e.urls[2]&&(e.can_big=!0,e.src2=e.urls[2],e.srcSet2=`${e.urls[2]} 1x`,e.urls[4]&&(e.srcSet2+=`, ${e.urls[4]} 2x`)),e.animated?.[1]&&(e.animSrc=e.animated[1],e.animSrcSet=`${e.animated[1]} 1x`,e.animated[2]&&(e.animSrcSet+=`, ${e.animated[2]} 2x`,e.animSrc2=e.animated[2],e.animSrcSet2=`${e.animated[2]} 1x`,e.animated[4]&&(e.animSrcSet+=`, ${e.animated[4]} 4x`,e.animSrcSet2+=`, ${e.animated[4]} 2x`))),e.token={type:"emote",id:e.id,set:i,provider:"ffz",src:e.src,srcSet:e.srcSet,can_big:!!e.urls[2],src2:e.src2,srcSet2:e.srcSet2,animSrc:e.animSrc,animSrcSet:e.animSrcSet,animSrc2:e.animSrc2,animSrcSet2:e.animSrcSet2,masked:!!e.mask,mod:e.modifier,mod_prefix:e.modifier_prefix,mod_hidden:(e.modifier_flags&1)===1,text:e.hidden?"???":e.name,length:e.name.length,height:e.height,width:e.width,source_modifier_flags:e.modifier_flags??0},(0,r.has)(Os,e.id)&&Object.assign(e,Os[e.id]),e)}addEmoteToSet(e,i){const s=this.emote_sets[e];if(!s)throw new Error(`Invalid emote set "${e}"`);let n=this.processEmote(i,e);if(!n)throw new Error("Invalid emote data object.");const o=this.shouldFilterEmote(n,s,e);s.disabled_emotes[n.id]&&(delete s.disabled_emotes[n.id],s.disabled_count--);const g=s.emotes[n.id],E=g&&this.generateEmoteCSS(g);if(o)if(s.disabled_emotes[n.id]=n,s.disabled_count++,g){const T={};let L=0;for(const q of Object.values(s.emotes))q.id!=n.id&&(T[q.id]=q,L++);s.emotes=T,s.count=L}else return n;else s.emotes[n.id]=n,g||s.count++;const R=`es--${e}`;if(E&&E.length){const T=[];for(const L of Object.values(s.emotes)){const q=this.generateEmoteCSS(L);q&&q.length&&T.push(q)}this.style&&(T.length||s.css)?this.style.set(R,T.join("")+(s.css||"")):T.length&&(s.pending_css=T.join(""))}else if(!o){const T=this.generateEmoteCSS(n);T&&T.length&&(this.style?this.style.set(R,(this.style.get(R)||"")+T):s.pending_css=(s.pending_css||"")+T)}return this.emit(":loaded",e,s),n}removeEmoteFromSet(e,i){const s=this.emote_sets[e];if(!s)throw new Error(`Invalid emote set "${e}"`);i&&i.id&&(i=i.id);const n=s.disabled_emotes?.[i];if(n)return s.disabled_count--,delete s.disabled_emotes[i],n;const o=s.emotes[i];if(!o)return;const h=this.generateEmoteCSS(o),g=h&&h.length?[]:null,E={};let R=0;for(const T of Object.values(s.emotes))if(T.id!=i&&(E[T.id]=T,R++,g!=null)){const L=this.generateEmoteCSS(T);L&&L.length&&g.push(L)}if(s.emotes=E,s.count=R,g!=null){const T=`es--${e}`;this.style&&(g.length||s.css)?this.style.set(T,g.join("")+(s.css||"")):g.length&&(s.pending_css=g.join(""))}return this.emit(":loaded",e,s),o}loadSetData(e,i,s=!1){const n=this.emote_sets[e];if(!i){n&&(this.style&&this.style.delete(`es--${e}`),this.emote_sets[e]=null);return}this.emote_sets[e]=i;let o=0,h=0;const g=i.emotes||i.emoticons,E=i.emotes={},R=i.disabled_emotes={},T=[];i.id=e,i.emoticons=void 0;const L=[];for(const le of g){let pe=this.processEmote(le,e);if(!pe){L.push(le);continue}if(this.shouldFilterEmote(pe,i,e)){R[pe.id]=pe,h++;continue}const fe=this.generateEmoteCSS(pe);fe&&T.push(fe),o++,E[pe.id]=pe}L.length&&this.log.warn(`Bad Emote Data for Set #${e}`,L),i.count=o,i.disabled_count=h,this.style&&(T.length||i.css)?this.style.set(`es--${e}`,T.join("")+(i.css||"")):T.length&&(i.pending_css=T.join("")),s||this.log.info(`Loaded emote set #${e}: ${i.title} (${o} emotes, ${h} filtered)`),this.emit(":loaded",e,i),(this._set_refs[e]||0)<=0&&!this._set_timers[e]&&(this._set_timers[e]=setTimeout(()=>this.unloadSet(e),5e3))}unloadSet(e,i=!1,s=!1){const n=this.emote_sets[e],o=this._set_refs[e]||0;if(n){if(o>0){if(!i)return this.log.warn(`Attempted to unload emote set #${e} with ${o} users.`);this.log.warn(`Unloading emote set ${e} with ${o} users.`)}s||this.log.info(`Unloaded emote set #${e}: ${n.title}`),this._set_timers[e]&&(clearTimeout(this._set_timers[e]),this._set_timers[e]=null),this.emit(":unloaded",e,n),this.emote_sets[e]=null}}generateEmoteCSS(e){if(!e.mask&&!e.margins&&(!e.modifier||!e.modifier_offset&&!e.extra_width&&!e.shrink_to_fit)&&!e.css)return"";let i="";if(e.modifier&&(e.modifier_offset||e.margins||e.extra_width||e.shrink_to_fit)){let s=e.modifier_offset||e.margins||"0";s=s.split(/\s+/).map(R=>parseInt(R,10)),s.length===3&&s.push(s[1]);const n=s.length,o=s[0%n],h=s[1%n],g=s[2%n],E=s[3%n];i=`.modified-emote span .ffz-emote[data-id="${e.id}"] {
	padding: ${o}px ${h}px ${g}px ${E}px;
	${e.shrink_to_fit?`max-width: calc(100% - ${40-E-h-(e.extra_width||0)}px);`:""}
	margin: 0 !important;
}`}return e.modifier&&e.mask?.[1]&&(i=(i||"")+`.modified-emote[data-modifiers~="${e.id}"] > .chat-line__message--emote {
	-webkit-mask-image: url("${e.mask[1]}");
	-webkit-mask-position: center center;
}`),`${i}.ffz-emote[data-id="${e.id}"] {
	${e.margins&&!e.modifier?`margin: ${e.margins} !important;`:""}
	${e.css||""}
}`}setTwitchEmoteSet(e,i){if(typeof e=="number"){if(isNaN(e)||!isFinite(e))return;e=`${e}`}if(typeof i=="number"){if(isNaN(i)||!isFinite(i))return;i=`${i}`}this.__twitch_emote_to_set[e]=i}setTwitchSetChannel(e,i){if(typeof e=="number"){if(isNaN(e)||!isFinite(e))return;e=`${e}`}this.__twitch_set_to_channel[e]=i}_getTwitchEmoteSet(e,i=!1){const s=this.__twitch_emote_to_set,n=this.__twitch_set_to_channel,o=this.__twitch_emote_to_artist;if(typeof e=="number"){if(isNaN(e)||!isFinite(e))return Promise.resolve(null);e=`${e}`}if((0,r.has)(s,e)&&(!i||(0,r.has)(o,e))){const g=s[e];return Array.isArray(g)?new Promise(E=>g.push(E)):Promise.resolve(g)}const h=this.resolve("site.apollo");return h?.client?new Promise(g=>{const E=[g];s[e]=E,(0,r.timeout)(h.client.query({query:$s(),variables:{id:`${e}`}}),2e3).then(R=>{const T=R?.data?.emote;let L=null;if(T&&(L=T.setID,T.id&&!(0,r.has)(o,T.id)&&(o[T.id]=T.artist),L&&!(0,r.has)(n,L))){const q=nn(T);n[L]={id:L,type:q,owner:T?.subscriptionProduct?.owner||T?.owner}}s[e]=L;for(const q of E)q(L)}).catch(()=>{s[e]=null;for(const R of E)R(null)})}):Promise.resolve(null)}getTwitchEmoteSet(e,i){const s=this._getTwitchEmoteSet(e);if(i)s.then(i);else return s}_getTwitchEmoteArtist(e){const i=this.__twitch_emote_to_artist;return(0,r.has)(i,e)?Promise.resolve(i[e]):this._getTwitchEmoteSet(e,!0).then(()=>i[e]).catch(()=>(i[e]=null,null))}getTwitchEmoteArtist(e,i){const s=this._getTwitchEmoteArtist(e);if(i)s.then(i);else return s}_getTwitchSetChannel(e){const i=this.__twitch_set_to_channel;if(typeof e=="number"){if(isNaN(e)||!isFinite(e))return Promise.resolve(null);e=`${e}`}if((0,r.has)(i,e)){const n=i[e];return Array.isArray(n)?new Promise(o=>n.push(o)):Promise.resolve(n)}const s=this.resolve("site.apollo");return s?.client?new Promise(n=>{const o=[n];i[e]=o,(0,r.timeout)(s.client.query({query:en(),variables:{id:`${e}`}}),2e3).then(h=>{const g=h?.data?.emoteSet;let E=null;g&&(E={id:e,type:rn(g),owner:g.owner?{id:g.owner.id,login:g.owner.login,displayName:g.owner.displayName}:null}),i[e]=E;for(const R of o)R(E)}).catch(()=>{i[e]=null;for(const h of o)h(null)})}):Promise.resolve(null)}getTwitchSetChannel(e,i){const s=this._getTwitchSetChannel(e);if(i)s.then(i);else return s}};B(Es,"Emotes");let Xi=Es;function nn(k){const e=k.subscriptionProduct;if(e){if(e.id==12658)return f.EmoteTypes.Prime;if(e.id==324)return f.EmoteTypes.Turbo;const s=e.owner;if(s)return s.id==139075904||e.state==="INACTIVE"?f.EmoteTypes.LimitedTime:f.EmoteTypes.Subscription}if(k.setID==300238151)return f.EmoteTypes.ChannelPoints;if(k.setID==300374282)return f.EmoteTypes.TwoFactor;const i=parseInt(k.setID,10);return!isNaN(i)&&isFinite(i)&&i>=5e8?f.EmoteTypes.BitsTier:f.EmoteTypes.Global}B(nn,"determineEmoteType");function rn(k){const e=/^\d+$/.test(k.id)?parseInt(k.id,10):null;if(e&&f.TWITCH_GLOBAL_SETS.includes(e))return f.EmoteTypes.Global;if(e&&f.TWITCH_POINTS_SETS.includes(e))return f.EmoteTypes.ChannelPoints;if(e&&f.TWITCH_PRIME_SETS.includes(e))return f.EmoteTypes.Prime;if(e==300374282)return f.EmoteTypes.TwoFactor;const i=k.owner;if(i){if(i.id==139075904)return f.EmoteTypes.LimitedTime;let s;if(Array.isArray(i.subscriptionProducts)){for(const n of i.subscriptionProducts)if(k.id==n.emoteSetID){s=n;break}}if(s){if(s.id==12658)return f.EmoteTypes.Prime;if(s.id==324)return f.EmoteTypes.Turbo;if(s.state==="INACTIVE")return f.EmoteTypes.LimitedTime}return f.EmoteTypes.Subscription}return e>=5e8?f.EmoteTypes.BitsTier:f.EmoteTypes.Global}B(rn,"determineSetType");var Ji=X(49276);const Fs=class Fs extends d.default{constructor(e,i){super(e,i),this.settings=null,this.inject("settings"),this.color_cache=null,this.name_cache=null}onEnable(){this.settings.provider.on("changed",this.onProviderChange,this)}renderUserEditor(e,i){let s,n,o;const h=B(()=>{const E=s,R=n,T=o;s=n=o=null,E&&E.destroy(),R&&R.destroy(),T&&T.$destroy()},"destroy"),g=document.fullscreenElement??document.body.querySelector("#root>div")??document.body;n=new ri.default(g,[],{logger:this.log,manual:!0,live:!1,html:!0,hover_events:!0,no_update:!0,no_auto_remove:!0,tooltipClass:"ffz-action-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"",arrowInner:"",innerClass:"",popper:{placement:"bottom",modifiers:{preventOverflow:{boundariesElement:g},flip:{behavior:["bottom","top","left","right"]}}},content:async(E,R)=>{const T=this.resolve("vue"),L=X.e(8586).then(X.bind(X,54337));if(!T)throw new Error("unable to load vue");const[,q]=await Promise.all([T.enable(),L]);return T.component("override-editor",q.default),o=new T.Vue({el:(0,re.createElement)("div"),render:le=>le("override-editor",{user:e,name:this.getName(e.id),color:this.getColor(e.id),originalName:e.displayName??e.login,originalColor:e.color,updateTip:()=>R.update(),setColor:pe=>this.setColor(e.id,pe),deleteColor:()=>this.deleteColor(e.id),setName:pe=>this.setName(e.id,pe),deleteName:()=>this.deleteName(e.id),close:()=>R.hide()})}),o.$el},onShow:async(E,R)=>{await R.waitForDom(),requestAnimationFrame(()=>{R.outer&&(s=new re.ClickOutside(R.outer,h))})},onMove:(E,R,T)=>{this.emit("tooltips:hover",E,R,T)},onLeave:(E,R,T)=>{this.emit("tooltips:leave",E,R,T)},onHide:h}),n._enter(i)}onProviderChange(e){e==="overrides.colors"&&this.color_cache?this.loadColors():e==="overrides.names"&&this.name_cache&&this.loadNames()}get colors(){return this.color_cache??this.loadColors()}get names(){return this.name_cache??this.loadNames()}loadColors(){let e,i=!0;this.color_cache?e=new Set(Object.keys(this.color_cache)):(i=!1,this.color_cache={},e=new Set);const s=this.settings.provider.get("overrides.colors");if(s)for(const[n,o]of Object.entries(s))e.delete(n),this.color_cache[n]!==o&&(this.color_cache[n]=o,i&&this.emit(":changed",n,"color",o));for(const n of e)this.color_cache[n]=void 0,i&&this.emit(":changed",n,"color",void 0);return this.color_cache}loadNames(){let e,i=!0;this.name_cache?e=new Set(Object.keys(this.name_cache)):(i=!1,this.name_cache={},e=new Set);const s=this.settings.provider.get("overrides.names");if(s)for(const[n,o]of Object.entries(s))e.delete(n),this.name_cache[n]!==o&&(this.name_cache[n]=o,i&&this.emit(":changed",n,"name",o));for(const n of e)this.name_cache[n]=void 0,i&&this.emit(":changed",n,"name",void 0);return this.name_cache}getColor(e){return this.colors[e]??null}getName(e){return this.names[e]??null}setColor(e,i){this.colors[e]!==i&&(this.colors[e]=i,this.settings.provider.set("overrides.colors",this.colors),this.emit(":changed",e,"color",i))}setName(e,i){this.names[e]!==i&&(this.names[e]=i,this.settings.provider.set("overrides.names",this.names),this.emit(":changed",e,"name",i))}deleteColor(e){this.setColor(e,void 0)}deleteName(e){this.setName(e,void 0)}};B(Fs,"overrides_Overrides");let Qi=Fs;const zs=class zs{constructor(e,i,s,n){this.destroyed=!1,this._login=null,this.manager=e,this.room=i,this.emote_sets=null,this.badges=null,this._id=s,this.login=n,s&&((i??e).user_ids[s]=this)}destroy(){if(this.destroyed=!0,this.emote_sets){for(const i of this.emote_sets._cache)this.manager.emotes.unrefSet(i);this.emote_sets=null}this.badges&&(this.badges=null);const e=this.room||this.manager;e&&(this._login&&e.users&&e.users[this._login]===this&&(e.users[this._login]=null),e.user_ids&&e.user_ids[this._id]===this&&(e.user_ids[this._id]=null))}merge(e){if(!this.login&&e.login&&(this.login=e.login),e.emote_sets)for(const[i,s]of e.emote_sets.iterateSources())for(const n of s)this.addSet(i,n);if(e.badges)for(const[i,s]of e.badges.iterateSources())for(const n of s)this.addBadge(i,n.id,n)}_unloadAddon(e){return 0}get id(){return this._id}get login(){return this._login}set login(e){if(this._login===e)return;const i=this.room||this.manager;if(this._login&&i.users[this._login]===this&&(i.users[this._login]=null),this._login=e,!e)return;const s=i.users[e];s&&s!==this&&(s.login=null),this._login=e,i.users[e]=this}addBadge(e,i,s){if(this.destroyed)return!1;typeof i=="number"&&(i=`${i}`),s?s.id=i:s={id:i},this.badges||(this.badges=new r.SourcedSet(!1,this.manager.emotes.sourceSortFn));const n=this.badges.get(e);if(n){for(const o of n)if(o.id==i)return Object.assign(o,s),!1}return this.badges.push(e,s),!0}getBadges(){return this.badges?[...this.badges._cache]:[]}getBadge(e){if(this.badges){for(const i of this.badges._cache)if(i.id==e)return i}return null}removeBadge(e,i){if(!this.badges)return!1;const s=this.badges.get(e);if(s){for(const n of s)if(n.id==i)return this.badges.remove(e,n),!0}return!1}removeAllBadges(e){return!this.badges||!this.badges.has(e)?!1:(this.badges.delete(e),!0)}addSet(e,i,s){if(this.destroyed)return;this.emote_sets||(this.emote_sets=new r.SourcedSet),typeof i=="number"&&(i=`${i}`);let n=!1,o=!1;return this.emote_sets.sourceIncludes(e,i)||(n=!this.emote_sets.includes(i),this.emote_sets.push(e,i),o=!0),s&&this.manager.emotes.loadSetData(i,s),n&&(this.manager.emotes.refSet(i),this.manager.emotes.emit(":update-user-sets",this,e,i,!0)),o}removeAllSets(e){if(!this.emote_sets)return!1;const i=this.emote_sets.get(e);if(!Array.isArray(i)||!i.length)return!1;for(const s of i)this.removeSet(e,s);return!0}removeSet(e,i){if(this.emote_sets)return typeof i=="number"&&(i=`${i}`),this.emote_sets.sourceIncludes(e,i)?(this.emote_sets.remove(e,i),this.emote_sets.includes(i)||(this.manager.emotes.unrefSet(i),this.manager.emotes.emit(":update-user-sets",this,e,i,!1)),!0):!1}};B(zs,"User");let Ii=zs;var on=Object.defineProperty,an=B((k,e,i)=>e in k?on(k,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):k[e]=i,"__defNormalProp"),ln=B((k,e,i)=>(an(k,typeof e!="symbol"?e+"":e,i),i),"__publicField");const As=class As{constructor(e,i,s){ln(this,0),this._destroy_timer=null,this.refs=new Set,this.style=new re.ManagedStyle(`room--${s}`),this.emote_sets=null,this.badges=null,this.users={},this.user_ids={},this.shared_chats=new Set,this.manager=e,this._id=i,this.login=s,i&&(this.manager.room_ids[i]=this),i&&this.manager.pubsub&&this.manager.pubsub.subscribe(this,`twitch/${i}`),this.manager.emit(":room-add",this),this.load_data()}destroy(){if(clearTimeout(this._destroy_timer),this._destroy_timer=null,this.destroyed=!0,this.manager.emit(":room-remove",this),this.users)for(const e of Object.values(this.users))e&&e.destroy();if(this.user_ids)for(const e of Object.values(this.user_ids))e&&e.destroy();if(this.shared_chats=null,this.refs=null,this.users=null,this.user_ids=null,this.style&&(this.style.destroy(),this.style=null),this.emote_sets){for(const e of this.emote_sets._cache)this.manager.emotes.unrefSet(e);this.emote_sets=null}this._login&&(this.manager.rooms[this._login]===this&&(this.manager.rooms[this._login]=null),this.manager.socket&&this.manager.socket.unsubscribe(this,`room.${this.login}`)),this._id&&this.manager.pubsub&&this.manager.pubsub.unsubscribe(this,`twitch/${this._id}`),this.manager.room_ids[this._id]===this&&(this.manager.room_ids[this._id]=null)}merge(e){if(!this.login&&e.login&&(this.login=e.login),e.refs)for(const s of e.refs)this.ref(s);if(e.shared_chats)for(const s of e.shared_chats)this.shareChat(s);if(e.emote_sets&&e.emote_sets._sources)for(const[s,n]of e.emote_sets._sources.entries())for(const o of n)this.addSet(s,o);e.data&&!this.data&&(this.data=e.data,this.data.css?this.style.set("css",this.data.css):this.style.delete("css"),this.buildModBadgeCSS(),this.buildVIPBadgeCSS()),e.badges&&!this.badges&&(this.badges=e.badges,this.buildBadgeCSS()),e.bitsConfig&&!this.bitsConfig&&(this.bitsConfig=e.bitsConfig,this.buildBitsCSS());const i=new Set;if(e.users)for(const s of Object.values(e.users))!s.destroyed&&!i.has(s)&&(this.getUser(s.id,s.login).merge(s),i.add(s));if(e.user_ids)for(const s of Object.values(e.user_ids))!s.destroyed&&!i.has(s)&&(this.getUser(s.id,s.login).merge(s),i.add(s))}shareChat(e){this.shared_chats.add(e)}shareChats(e){this.shared_chats=new Set(e||[])}unshareChat(e){e?this.shared_chats.delete(e):this.shared_chats.clear()}_unloadAddon(e){return 0}get id(){return this._id}get login(){return this._login}set login(e){if(this._login===e||(this._login&&this.manager.rooms[this._login]===this&&(this.manager.rooms[this._login]=null,this.manager.socket&&this.manager.socket.unsubscribe(this,`room.${this.login}`)),this._login=e,!e))return;const i=this.manager.rooms[e];i&&i!==this&&(i.login=null),this._login=e,this.manager.rooms[e]=this,this.manager.socket&&this.manager.socket.subscribe(this,`room.${e}`),this.manager.emit(":room-update-login",this,e)}*iterateUsers(){const e=new Set;for(const i of Object.values(this.user_ids))i&&!i.destroyed&&(e.add(i),yield i);for(const i of Object.values(this.users))i&&!i.destroyed&&(yield i)}getUser(e,i,s,n,o=!1){if(this.destroyed)return null;let h;if(e&&typeof e=="number"&&(e=`${e}`),e&&this.user_ids[e]?h=this.user_ids[e]:i&&this.users[i]&&!n&&(h=this.users[i]),h&&h.destroyed&&(h=null),!h){if(s)return null;h=new Ii(this.manager,this,e,i)}if(e&&e!==h.id){if(h.id){if(this.manager.log.warn(`Data mismatch for user #${e} -- Stored ID: ${h.id} -- Login: ${i} -- Stored Login: ${h.login}`),o)throw new Error("id mismatch");this.user_ids[h.id]===h&&(this.user_ids[h.id]=null)}h._id=e,this.user_ids[e]=h}if(i){const g=this.users[i];g?g!==h&&!n&&(g.id?this.users[i]=h:(h.merge(g),g.destroy())):this.users[i]=h}return h}async load_data(e=0){if(this.destroyed)return;const i=`ffz-room-${this.id?`id:${this.id}`:this.login}`;if(this.manager.load_tracker.schedule("chat-data",i),this.manager.experiments.getAssignment("api_load"))try{fetch(`${f.NEW_API}/v1/room/${this.id?`id/${this.id}`:this.login}`).catch(()=>{})}catch{}let s,n;try{s=await fetch(`${this.manager.staging.api}/v1/room/${this.id?`id/${this.id}`:this.login}`)}catch(R){return e++,e<10?setTimeout(()=>this.load_data(e),500*e):(this.manager.log.error(`Error loading room data for ${this.id}:${this.login}`,R),this.manager.load_tracker.notify("chat-data",i,!1),!1)}if(!s.ok)return this.manager.load_tracker.notify("chat-data",i,!1),!1;try{n=await s.json()}catch(R){return this.manager.log.error(`Error parsing room data for ${this.id}:${this.login}`,R),this.manager.load_tracker.notify("chat-data",i,!1),!1}const o=this.data?.user_badge_ids;if(o){for(const R in o)if((0,r.has)(o,R))for(const T of o[R])this.getUser(T,void 0).removeBadge("ffz",R)}const h=n.room,g=`${h.twitch_id}`;if(!this._id)this._id=g,this.manager.room_ids[g]=this;else if(this._id!==g)return this.manager.log.warn(`Received data for ${this.id}:${this.login} with the wrong ID: ${g}`),this.manager.load_tracker.notify("chat-data",i,!1),!1;if(this.login?this.login!==h.id&&this.manager.log.warn(`Login mismatch for room ${this.id}:${this.login}. Got "${h.id}" from FFZ's API.`):this.login=h.id,this.data=h,this.removeAllSets("ffz-main"),h.set&&this.addSet("ffz-main",h.set),n.sets)for(const R in n.sets)(0,r.has)(n.sets,R)&&this.manager.emotes.loadSetData(R,n.sets[R]);const E=h.user_badge_ids;if(E){for(const R in E)if((0,r.has)(E,R))for(const T of E[R])this.getUser(T,void 0).addBadge("ffz",R)}return h.css?this.style.set("css",h.css):this.style.delete("css"),this.buildModBadgeCSS(),this.buildVIPBadgeCSS(),this.manager.load_tracker.notify("chat-data",i),!0}addSet(e,i,s){if(this.destroyed)return;this.emote_sets||(this.emote_sets=new r.SourcedSet(!1,this.manager.emotes.sourceSortFn)),typeof i=="number"&&(i=`${i}`);let n=!1,o=!1;return this.emote_sets.sourceIncludes(e,i)||(n=!this.emote_sets.includes(i),this.emote_sets.push(e,i),o=!0),s&&this.manager.emotes.loadSetData(i,s),n&&(this.manager.emotes.refSet(i),this.manager.emotes.emit(":update-room-sets",this,e,i,!0)),o}removeAllSets(e){if(this.destroyed||!this.emote_sets)return!1;const i=this.emote_sets.get(e);if(!Array.isArray(i)||!i.length)return!1;for(const s of i)this.removeSet(e,s);return!0}removeSet(e,i){if(!(this.destroyed||!this.emote_sets))return typeof i=="number"&&(i=`${i}`),this.emote_sets.sourceIncludes(e,i)?(this.emote_sets.remove(e,i),this.emote_sets.includes(i)||(this.manager.emotes.unrefSet(i),this.manager.emotes.emit(":update-room-sets",this,e,i,!1)),!0):!1}ref(e){if(!this.refs)throw new Error("Attempting to use destroyed Room");clearTimeout(this._destroy_timer),this._destroy_timer=null,this.refs.add(e)}unref(e){this.refs&&(this.refs.delete(e),!this.refs.size&&!this._destroy_timer&&(this._destroy_timer=setTimeout(()=>this.destroy(),5e3)))}badgeCount(){return this.badge_count||0}updateBadges(e){if(this.badge_count=0,e instanceof Map){const i={};for(const[s,n]of e.entries()){const o=i[s]=i[s]||{__cat:qi(s)};for(const[h,g]of n.entries())o[h]=Yi(g),this.badge_count++}this.badges=i}else if(!Array.isArray(e))this.badges=e;else{const i={};for(const s of e){const n=s.setID,o=i[n]=i[n]||{__cat:qi(n)};o[s.version]=Yi(s),this.badge_count++}this.badges=i}this.buildBadgeCSS()}buildVIPBadgeCSS(){if(this.destroyed)return;if(!this.data||!this.data.vip_badge||!this.manager.context.get("chat.badges.custom-vip"))return this.style.delete("vip-badge");const e=this.data.vip_badge,i=`url("${e[1]}")`;let s;(e[2]||e[4])&&(s=`${f.WEBKIT_CSS}image-set(${i} 1x${e[2]?`, url("${e[2]}") 2x`:""}${e[4]?`, url("${e[4]}") 4x`:""})`),this.style.set("vip-badge",`[data-room-id="${this.id}"] .ffz-badge[data-badge="vip"] {
			background-color: transparent;
			background-image: ${i};
			${s?`background-image: ${s};`:""}
			${f.WEBKIT_CSS}mask-image: unset;
		}`)}buildModBadgeCSS(){if(this.destroyed)return;if(!this.data||!this.data.mod_urls||!this.manager.context.get("chat.badges.custom-mod"))return this.style.delete("mod-badge");const e=this.manager.context.get("chat.badges.style"),i=e>5?`${f.WEBKIT_CSS}mask`:"background";if(!(e!==3&&e!==4))return this.style.delete("mod-badge");const n=this.data.mod_urls,o=`url("${n[1]}")`;let h;(n[2]||n[4])&&(h=`${f.WEBKIT_CSS}image-set(${o} 1x${n[2]?`, url("${n[2]}") 2x`:""}${n[4]?`, url("${n[4]}") 4x`:""})`),this.style.set("mod-badge",`[data-room-id="${this.id}"] .ffz-badge[data-badge="moderator"] {
			${i}-image: ${o};
			${h?`${i}-image: ${h};`:""}
		}`)}buildBadgeCSS(){if(this.destroyed)return;if(!this.badges)return this.style.delete("badges");const e=f.IS_FIREFOX&&this.manager.context.get("chat.badges.media-queries"),i=this.manager.context.get("chat.badges.clickable"),s=[],n=this.id;for(const o in this.badges)if((0,r.has)(this.badges,o)){const h=this.badges[o];for(const g in h)if((0,r.has)(h,g)){const E=h[g],R=`[data-room-id="${n}"] .ffz-badge[data-badge="${o}"][data-version="${g}"]`;s.push(`${R} {
			${i&&(E.click_action||E.click_url)?"cursor:pointer;":""}
			background-color: transparent;
			filter: none;
			${f.WEBKIT_CSS}mask-image: none;
			height: 1.8rem;
			width: 1.8rem;
			background-size: 1.8rem;
			background-image: url("${E.image1x}");
			background-image: ${f.WEBKIT_CSS}image-set(
				url("${E.image1x}") 1x,
				url("${E.image2x}") 2x,
				url("${E.image4x}") 4x
			);
		}`),e&&(s.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) { ${R} {
								background-image: url("${E.image2x}");
							}}`),s.push(`@media (min-resolution: 200dpi) { ${R} {
								background-image: url("${E.image4x}");
							}}`))}}this.style.set("badges",s.join(`
`))}updateBitsConfig(e,i){if(!i&&this.bitsConfig&&e){const s=new Set(Object.keys(this.bitsConfig)),n=new Set(Object.keys(e));if((0,r.set_equals)(s,n))return}this.bitsConfig=e,this.buildBitsCSS()}buildBitsCSS(){if(this.destroyed)return;if(!this.bitsConfig)return this.style.delete("bits");const e=this.manager.context.get("chat.bits.animated")?"animated":"static",i=this.manager.context.get("theme.is-dark")?"dark":"light",s=this.manager.context.get("theme.tooltips-dark")?"dark":"light",n=[];for(const o in this.bitsConfig)if((0,r.has)(this.bitsConfig,o)){const h=this.bitsConfig[o],g=h.prefix.toLowerCase(),E=h.tiers,R=E.length;for(let T=0;T<R;T++){const L=E[T].images[i][e],q=E[T].images[s][e];n.push(`.ffz-cheer[data-prefix="${g}"][data-tier="${T}"] {
	color: ${E[T].color||"inherit"};
	background-image: url("${L[1]}");
	background-image: ${f.WEBKIT_CSS}image-set(
		url("${L[1]}") 1x,
		url("${L[2]}") 2x,
		url("${L[4]}") 4x
	);
}
.ffz__tooltip .ffz-cheer[data-prefix="${g}"][data-tier="${T}"] {
	background-image: url("${q[1]}");
	background-image: ${f.WEBKIT_CSS}image-set(
		url("${q[1]}") 1x,
		url("${q[2]}") 2x,
		url("${q[4]}") 4x
	);
}
.ffz-cheer-preview[data-prefix="${g}"][data-tier="${T}"] {
	background-image: url("${q[4]}");
}`)}}this.style.set("bits",n.join(`
`))}};B(As,"Room");let Li=As;const Ni=Ei.ShrinkX,ji=Ei.Slide,Ui=Ei.GrowX,zi="chat-image chat-line__message--emote",Is=/(?:(https?:\/\/)?((?:[\w#%\-+=:~]+\.)+[a-z]{2,10}(?:\/[\w./#%&@()\-+=:?~]*[^\s\.!,?])?))/g,cn=/^(['"*([{<\\/]*)(@)((?:[^\u0000-\u007F]|[\w-])+)(?:\b|$)/,hn={type:"filter_test",priority:1e3,render(k,e){return k.msg.filters?.length?e("div",{class:"ffz-pill tw-mg-l-1"},k.msg.filters.join(", ")):null},process(k,e){if(!(!k||!k.length||!this.context.get("chat.filtering.debug")))return e.filters=[],k.push({type:"filter_test",msg:e}),k}};function Ls(k){return k==null?null:k==="true"}B(Ls,"datasetBool");const es={type:"link",priority:50,component:()=>X.e(9442).then(X.bind(X,12868)),render(k,e){return e("a",{class:"ffz-tooltip link-fragment","data-tooltip-type":"link","data-url":k.url,"data-is-mail":k.is_mail,rel:"noopener noreferrer",target:"_blank",href:k.url,onClick:this.handleLinkClick},k.text)},tooltip(k,e){if(!this.context.get("tooltip.rich-links")&&!k.dataset.forceTooltip)return ri.NoContent;if(k.dataset.isMail==="true")return[this.i18n.t("tooltip.email-link","E-Mail {address}",{address:k.textContent})];const i=k.dataset.url||k.href,s=Ls(k.dataset.forceMedia)??this.context.get("tooltip.link-images"),n=Ls(k.dataset.forceUnsafe)??this.context.get("tooltip.link-nsfw-images");return Promise.all([Promise.all([X.e(2009),X.e(208)]).then(X.bind(X,30642)),this.get_link_info(i)]).then(([o,h])=>{if(!h||(h.v||1)>o.VERSION)return"";const g={tList:(...L)=>this.i18n.tList(...L),i18n:this.i18n,fragments:h.fragments,i18n_prefix:h.i18n_prefix,tooltip:!0,allow_media:s,allow_unsafe:n,onload:()=>requestAnimationFrame(()=>e.update())};let E;if(e.element&&(e.element.classList.add("ffz-rich-tip"),e.element.classList.add("tw-align-left")),e.outer&&h.accent&&(e.outer.classList.add("ffz-accent-tip"),e.outer.style.setProperty("--ffz-color-accent",h.accent)),h.full?E=o.renderTokens(h.full,re.createElement,g):h.mid?E=o.renderTokens(h.mid,re.createElement,g):h.short?E=o.renderTokens(h.short,re.createElement,g):E=this.i18n.t("card.empty","No data was returned."),!h.urls)return E;const R=[];for(let L=0;L<h.urls.length;L++){const q=h.urls[L];R.push((0,re.createElement)("tr",null,(0,re.createElement)("td",null,this.i18n.formatNumber(L+1),"."),(0,re.createElement)("td",{class:"tw-c-text-alt-2 tw-pd-x-05 tw-word-break-all"},q.url),(0,re.createElement)("td",null,q.flags?q.flags.map(le=>(0,re.createElement)("span",{class:"ffz-pill"},le.toLowerCase())):null)))}let T;if(h.unsafe){const L=Array.from(new Set(h.urls.map(q=>q.flags).flat())).join(", ");T=(0,re.createElement)("div",{class:"ffz-i-attention"},this.i18n.tList("tooltip.link-unsafe","Caution: This URL is has been flagged as potentially harmful by: {reasons}",{reasons:L.toLowerCase()}))}else h.urls.length>1&&(T=this.i18n.t("tooltip.link-destination","Destination: {url}",{url:h.urls[h.urls.length-1].url}));return E=(0,re.createElement)("div",null,(0,re.createElement)("div",{class:"ffz--shift-hide"},E,T?(0,re.createElement)("div",{class:"tw-mg-t-05 tw-border-t tw-pd-t-05 tw-align-center"},T,(0,re.createElement)("div",{class:" tw-font-size-8"},this.i18n.t("tooltip.shift-detail","(Shift for Details)"))):null),(0,re.createElement)("div",{class:"ffz--shift-show tw-align-left"},(0,re.createElement)("div",{class:"tw-semibold tw-mg-b-05 tw-align-center"},this.i18n.t("tooltip.link.urls","Visited URLs")),(0,re.createElement)("table",null,R))),E}).catch(o=>(console.error(o),(0,re.sanitize)(this.i18n.t("tooltip.error","An error occurred. ({error})",{error:o}))))},process(k){if(!k||!k.length)return;const e=[];for(const i of k){if(i.type!=="text"){e.push(i);continue}Is.lastIndex=0;const s=i.text;let n=0,o;for(;o=Is.exec(s);){const h=o.index;n!==h&&e.push({type:"text",text:s.slice(n,h)});let g=o[0];if(g.endsWith(")")){let E=1,R=g.length-1;for(;R--;){const T=g[R];if(T===")"?E++:T==="("&&E--,!E)break}E&&(g=g.slice(0,g.length-1))}e.push({type:"link",url:`${o[1]?"":"https://"}${g}`,is_mail:!1,text:g}),n=h+g.length}n<s.length&&e.push({type:"text",text:s.slice(n)})}return e}};es.tooltip.interactive=function(k){if(!this.context.get("tooltip.rich-links")||!this.context.get("tooltip.link-interaction")||k.dataset.isMail==="true")return!1;const e=this.get_link_info(k.dataset.url,!0);return e&&e.interactive},es.tooltip.delayHide=function(k){return!this.context.get("tooltip.rich-links")||k.dataset.isMail==="true"?0:64};const un={type:"reply",priority:0,component:()=>null,render(k,e){let i=k.color;if(i){const s=this.resolve("site.chat");i=s?s.colors.process(i):i}return e("strong",{class:`chat-line__message-mention ffz--pointer-events ffz-tooltip ffz--reply-mention ffz-i-threads${k.me?" ffz--mention-me":""}`,style:{color:i},"data-tooltip-type":"reply","data-login":k.recipient,onClick:this.handleReplyClick},k.text)},tooltip(k){const e=this.resolve("site.fine");if(!k||!e)return null;const i=e.searchParent(k,n=>n.props&&n.props.reply&&n.setOPCardTray),s=i?.props?.reply;return s?[(0,re.createElement)("strong",{},this.i18n.t("chat.reply-to","Replying To:")),`

`,(0,re.createElement)("div",{className:"tw-align-left"},[(0,re.createElement)("strong",{},s.parentDisplayName),": ",s.parentMessageBody])]:null}};function dn(k,e,i,s){const n=i&&i.login&&i.login==e.user.login&&!this.context.get("chat.filtering.process-own"),o=this.context.get("chat.filtering.mention-priority");let h,g,E=!1;i&&i.login&&!n&&(h=i.login.toLowerCase(),g=i.displayName&&i.displayName.toLowerCase(),g===h&&(g=null),E=!0);const R=[];for(const T of k){if(T.type!=="text"){R.push(T);continue}let L=[];for(const q of T.text.split(/ +/)){const le=/^(@?)(\S+?)(?:\b|$)/.exec(q);if(le){let pe=le[2],fe=le[1]==="@",De=!1;const Ae=pe?pe.toLowerCase():"",ye=this.color_cache?this.color_cache.get(Ae):null;(Ae===h||Ae===g)&&(De=!0),!fe&&!ye&&!De?L.push(q):(L.length&&(R.push({type:"text",text:`${L.join(" ")} `}),L=[]),R.push({type:"mention",text:le[0],me:De,color:s?ye:null,recipient:Ae}),De&&this.applyHighlight(e,o,null,"mention",!0),L.push(q.substr(le[0].length)))}else L.push(q)}(L.length>1||L.length===1&&L[0]!=="")&&R.push({type:"text",text:L.join(" ")})}return R}B(dn,"mention_processAll");const fn={type:"mention",priority:0,component:()=>X.e(9442).then(X.bind(X,30884)),render(k,e){let i=k.color;if(i){const s=this.resolve("site.chat");i=s?s.colors.process(i):i}return e("strong",{class:`chat-line__message-mention${k.me?" ffz--mention-me":""} ffz--pointer-events`,style:{color:i},"data-login":k.recipient,onClick:this.handleMentionClick},k.text)},process(k,e,i){if(!k||!k.length)return;const s=this.context.get("chat.filtering.all-mentions"),n=this.context.get("chat.filtering.color-mentions");if(s)return dn.call(this,k,e,i,n);const o=i&&i.login&&i.login==e.user.login&&!this.context.get("chat.filtering.process-own"),h=this.context.get("chat.filtering.mention-priority");let g,E,R,T=!1;i&&i.login&&!o?(E=i.login.toLowerCase(),R=i.displayName&&i.displayName.toLowerCase(),R===E&&(R=null),T=!0,g=new RegExp(`^(['"*([{<\\/]*)(?:(@?)(${i.login.toLowerCase()}${R?`|${R}`:""})|@((?:[^\0-\x7F]|[\\w-])+))(?:\\b|$)`,"i")):g=cn;const L=[];for(const q of k){if(q.type!=="text"){L.push(q);continue}let le=[];for(const pe of q.text.split(/ +/)){const fe=g.exec(pe);if(fe){(le.length||fe[1])&&(L.push({type:"text",text:`${le.join(" ")} ${fe[1]||""}`}),le=[]);let De,Ae=!1,ye=fe[2];fe[4]?(De=fe[4],ye="@"):(De=fe[3],Ae=T);const Ie=De?De.toLowerCase():"",Fe=n&&this.color_cache?this.color_cache.get(Ie):null;L.push({type:"mention",text:`${ye}${De}`,me:Ae,color:Fe,recipient:Ie}),Ae&&this.applyHighlight(e,h,null,"mention",!0),le.push(pe.substr(fe[0].length))}else le.push(pe)}(le.length>1||le.length===1&&le[0]!=="")&&L.push({type:"text",text:le.join(" ")})}return L}},pn={type:"user_highlight",priority:90,process(k,e,i){if(i&&i.login&&i.login==e.user.login&&!this.context.get("chat.filtering.process-own"))return;const s=this.context.get("__filter:highlight-users");if(!s||!s.length)return;const n=e.user;for(const[o,h,g]of s)(g.test(n.login)||g.test(n.displayName))&&this.applyHighlight(e,o,h,"user")}},mn={type:"user_block",priority:100,process(k,e,i,s){if(i&&i.login&&i.login==e.user.login&&!this.context.get("chat.filtering.process-own"))return;const n=e.user,o=this.context.get("__filter:block-users");o&&(o[1]&&(o[1].test(n.login)||o[1].test(n.displayName))?(e.deleted=!0,e.ffz_removed=!0,s&&(e.ffz_halt_tokens=!0)):!e.deleted&&o[0]&&(o[0].test(n.login)||o[0].test(n.displayName))&&(e.deleted=!0))}};function gn(k){let e=k.badges?Object.keys(k.badges):null;if(!k.ffz_badges)return e;e||(e=[]);for(const i of k.ffz_badges)i?.id&&e.push(i.id);return e}B(gn,"getBadgeIDs");const _n={type:"badge_stuff",priority:97,process(k,e,i,s){if(i&&i.login&&i.login==e.user.login&&!this.context.get("chat.filtering.process-own"))return;const n=this.context.get("__filter:highlight-badges"),o=this.context.get("__filter:block-badges");if(!n&&!o)return;const h=gn(e);if(!(!h||!h.length))for(const g of h){if(o&&o[1].includes(g)){e.deleted=!0,e.ffz_removed=!0,s&&(e.ffz_halt_tokens=!0);return}if(o&&!e.deleted&&o[0].includes(g)&&(e.deleted=!0),n&&n.has(g)){const E=n.get(g);Array.isArray(E)&&E.length>1&&this.applyHighlight(e,E[0],E[1],"badge")}}}},bn={type:"highlight",priority:35,component:()=>X.e(9442).then(X.bind(X,27778)),render(k,e){return e("strong",{class:"ffz--highlight"},k.text)},process(k,e,i){if(!k||!k.length||i&&i.login&&i.login==e.user.login&&!this.context.get("chat.filtering.process-own"))return;const s=this.context.get("__filter:highlight-terms");if(!s)return;let n=!1;if(s.non)for(const[o,h,g]of s.non){if(n&&e.mention_priority!=null&&e.mention_priority>o)break;let E=!1;g[0]&&(g[0].lastIndex=0,E=g[0].test(e.message)),!E&&g[1]&&(g[1].lastIndex=0,E=g[1].test(e.message)),E&&(n=!0,this.applyHighlight(e,o,h,"term"))}if(!s.hl)return k;for(const[o,h,g]of s.hl){const E=[];for(const R of k){if(R.type!=="text"){E.push(R);continue}const T=R.text;let L=0,q;for(;L<T.length;){g[0]&&(g[0].lastIndex=L),g[1]&&(g[1].lastIndex=L),q=g[0]?g[0].exec(T):null;const le=g[1]?g[1].exec(T):null;if(le&&(!q||q.index>le.index)&&(q=le),!q)break;const pe=q.index,fe=q[1]?q[1].length:0,De=pe+fe;L!==De&&E.push({type:"text",text:T.slice(L,De)}),this.applyHighlight(e,o,h,"term"),E.push({type:"highlight",text:q[0].slice(fe)}),L=pe+q[0].length}L<T.length&&E.push({type:"text",text:T.slice(L)})}k=E}return k}};function Ns(k,e,i,s,n){const o=[];for(const h of k){if(h.type!=="text"){o.push(h);continue}const g=h.text;let E=0,R;for(;E<g.length;){i[0]&&(i[0].lastIndex=E),i[1]&&(i[1].lastIndex=E),R=i[0]?i[0].exec(g):null;const T=i[1]?i[1].exec(g):null;if(T&&(!R||R.index>T.index)&&(R=T),!R)break;const L=R.index,q=R[1]?R[1].length:0,le=L+q;if(E!==le&&o.push({type:"text",text:g.slice(E,le)}),s&&(e.ffz_removed=!0,n))return k;o.push({type:"blocked",text:R[0].slice(q)}),E=L+R[0].length}E<g.length&&o.push({type:"text",text:g.slice(E)})}return o}B(Ns,"blocked_process");const yn={type:"blocked",priority:99,component:()=>X.e(9442).then(X.bind(X,87307)),render(k,e){return e("strong",{"data-text":k.text,"data-tooltip-type":"blocked",class:"ffz-tooltip ffz--blocked ffz--pointer-events",onClick:this.clickToReveal},"\xD7\xD7\xD7")},tooltip(k){const e=k.dataset;return[(0,re.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.filtering.blocked-term","Blocked Term")),e.text]},process(k,e,i,s){if(!k||!k.length||i&&i.login&&i.login==e.user.login&&!this.context.get("chat.filtering.process-own"))return;const n=this.context.get("__filter:block-terms");if(n)return n.remove&&(k=Ns(k,e,n.remove,!0,s),s&&e.ffz_removed)?(e.ffz_halt_tokens=!0,k):(n.non&&(k=Ns(k,e,n.non,!1,s)),k)}},js={A:"Hostility",I:"Discrimination",P:"Profanity",S:"Sexually Explicit Language"},vn={type:"amterm",priority:95,component:()=>X.e(9442).then(X.bind(X,61669)),render(k,e){return e("strong",{"data-text":k.text,"data-categories":JSON.stringify(k.categories),"data-tooltip-type":"amterm",class:"ffz-tooltip ffz--blocked ffz--pointer-events",onClick:this.clickToReveal},"\xD7\xD7\xD7")},tooltip(k){const e=k.dataset,i=[];let s;try{s=JSON.parse(e.categories);for(const n in s)s[n]&&js[n]&&i.push(this.i18n.t(`chat.filtering.automod.${n}`,js[n]))}catch{i.push("Parse Error")}return[(0,re.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.filtering.automod-term","AutoMod Blocked Term")),this.i18n.t("chat.filtering.automod-why","This was flagged as: "),i.join(", ")]},process(k,e,i,s){if(!k||!k.length||!e.flags||!Array.isArray(e.flags.list))return;const n=e.flags.preferences,o=e.flags.list.filter(q=>{if(!q||q.startIndex==null||q.endIndex==null)return!1;const le=q.categories;if(!le)return!1;for(const pe in le)if(le[pe]&&n[pe])return!0}),h=o.length;if(!h)return;const g=[];let E=0,R=0;const T=this.context.get("chat.automod.remove-messages");if(this.context.get("chat.automod.delete-messages")&&(e.deleted=!0),T){e.ffz_removed=!0,s&&(e.ffz_halt_tokens=!0);return}for(const q of k){const le=q.length||q.text&&(0,r.split_chars)(q.text).length||0,pe=E,fe=E+le;if(q.type!=="text"){g.push(q),E=fe;continue}const De=(0,r.split_chars)(q.text);for(;R<h;){const Ae=o[R],ye=Ae.startIndex,Ie=Ae.endIndex+1;if(Ie<pe){R++;continue}if(ye>fe){g.push(q),E=fe;break}ye>E&&g.push({type:"text",text:De.slice(E-pe,ye-pe).join("")});let Fe=ye-pe;if(Fe<0&&(Fe=0),g.push({type:"amterm",categories:Ae.categories,text:De.slice(Fe,Ie-pe).join("")}),Ie>fe){E=fe;break}E=Ie,R++}E<fe&&(pe===E?g.push(q):g.push({type:"text",text:De.slice(E-pe).join("")}),E=fe)}return g}},wn={type:"cheer",priority:40,component:()=>X.e(9442).then(X.bind(X,93114)),render(k,e){return e("span",{class:"ffz-cheer ffz-tooltip ffz--pointer-events","data-tooltip-type":"cheer","data-prefix":k.prefix,"data-amount":this.i18n.formatNumber(k.amount),"data-tier":k.tier,"data-individuals":JSON.stringify(k.individuals||null),alt:k.text})},tooltip(k){const e=k.dataset,i=parseInt(e.amount.replace(/,/g,""),10),s=e.prefix,n=e.tier,o=e.individuals&&JSON.parse(e.individuals),h=o&&o.length,g=[this.context.get("tooltip.emote-images")&&(0,re.createElement)("div",{class:"preview-image ffz-cheer-preview","data-prefix":s,"data-tier":n}),this.i18n.t("tooltip.bits","{count,number} Bits",i)];if(h>1){g.push((0,re.createElement)("br",null)),o.sort(E=>-E[0]);for(let E=0;E<h&&E<12;E++){const[R,T,L]=o[E];g.push(this.tokenizers.cheer.render.call(this,{amount:R,prefix:L,tier:T},re.createElement))}h>12&&(g.push((0,re.createElement)("br",null)),g.push(this.i18n.t("tooltip.bits.more","(and {count, number} more)",h-12)))}return g},process(k,e){if(!k||!k.length||!e.bits)return;const i=this.getRoom(e.roomID,e.roomLogin,!0),s=i&&i.bitsConfig;if(!s)return;const n=new RegExp(`^(${Object.keys(s).join("|")})(\\d+)$`,"i"),o=[],h={},g=this.context.get("chat.bits.stack");for(const E of k){if(!E||E.type!=="text"){o.push(E);continue}let R=[];for(const T of E.text.split(/ +/)){const L=n.exec(T);if(L){const q=L[1].toLowerCase(),le=s[q];if(!le){R.push(T);continue}const pe=parseInt(L[2],10),fe=le.tiers;let De,Ae;for(let ye=0,Ie=fe.length;ye<Ie;ye++)if(pe>=fe[ye].amount){De=ye;break}if(R.length&&(o.push({type:"text",text:`${R.join(" ")} `}),R=[]),o.push(Ae={type:"cheer",prefix:q,tier:De,amount:pe,text:L[0]}),g){let ye=g===2?"cheer":q;s[ye]||(ye=q);const Ie=h[ye]=h[ye]||{total:0,individuals:[]};Ie.total+=pe,Ie.individuals.push([pe,De,q]),Ae.hidden=!0}R.push("")}else R.push(T)}(R.length>1||R.length===1&&R[0]!=="")&&o.push({type:"text",text:R.join(" ")})}if(g){for(const E in h)if((0,r.has)(h,E)){const R=h[E],T=s[E],L=T.tiers;let q=0;for(let le=L.length;q<le&&!(R.total>=L[q].amount);q++);o.unshift({type:"cheer",prefix:E,tier:q,amount:R.total,individuals:R.individuals,length:0})}}return o}},Us=B((k,e,i)=>{const s=k.anim===2,n=k.big&&k.can_big;let o,h,g,E,R,T;k.anim===1&&k.animSrc?(o=n?k.animSrc2:k.animSrc,h=n?k.animSrcSet2:k.animSrcSet):(o=n?k.src2:k.src,h=n?k.srcSet2:k.srcSet),s&&k.animSrc&&(R=o,T=h,g=n?k.animSrc2:k.animSrc,E=n?k.animSrcSet2:k.animSrcSet);const L=k.modifiers||[],q=L.length,le=e("img",{class:`${zi} ffz-tooltip${g?" ffz-hover-emote":""}${k.provider==="twitch"?" twitch-emote":k.provider==="ffz"?" ffz-emote":k.provider==="emoji"?" ffz-emoji":""}`,attrs:{src:f.IS_FIREFOX&&h?.length?void 0:o,srcSet:h,alt:k.text,height:k.big&&!k.can_big&&k.height?`${k.height*2}px`:void 0,"data-tooltip-type":"emote","data-provider":k.provider,"data-id":k.id,"data-set":k.set,"data-code":k.code,"data-variant":k.variant,"data-normal-src":R,"data-normal-src-set":T,"data-hover-src":g,"data-hover-src-set":E,"data-modifiers":q?L.map(pe=>pe.id).join(" "):null,"data-modifier-info":q?JSON.stringify(L.map(pe=>[pe.set,pe.id])):null}});return q?e("div",{class:"ffz--inline modified-emote",attrs:{"data-test-selector":"emote-button","data-provider":k.provider,"data-id":k.id,"data-set":k.set,"data-modifiers":q?L.map(pe=>pe.id).join(" "):null}},[le,L.map(pe=>e("span",{key:pe.text},Us(pe,e,!0)))]):i?le:e("div",{className:"ffz--inline",attrs:{"data-test-selector":"emote-button"}},[le])},"render_emote"),kn={type:"emote",priority:10,component:{functional:!0,render(k,{props:e}){return Us(e.token,k)}},render(k,e,i){const s=k.anim===2,n=k.big&&k.can_big;let o,h,g,E,R,T;k.anim===1&&k.animSrc?(o=n?k.animSrc2:k.animSrc,h=n?k.animSrcSet2:k.animSrcSet):(o=n?k.src2:k.src,h=n?k.srcSet2:k.srcSet),s&&k.animSrc&&(R=o,T=h,g=n?k.animSrc2:k.animSrc,E=n?k.animSrcSet2:k.animSrcSet);let L,q;const le=k.modifiers||[],pe=le.length,fe=k.modifier_flags,De=k.big&&!k.can_big&&k.height;let Ae=(this.emotes.activeAsBackgroundMask&fe)!==0,ye=(this.emotes.activeNoWideMask&fe)!==0;if(ye||fe||pe){if(k.provider==="emoji"){const Fe=k.big_emoji?2:1,je=Fe*1.5*(this.context.get("chat.font-size")??13);L={width:je,height:je},q={width:je,height:je}}else{const Fe=k.big?2:1;L={width:k.width*Fe,height:k.height*Fe},q={width:L.width,height:L.height}}for(const Fe of le)if(Fe.effect_bg&&(Ae=!0),!Fe.mod_hidden&&Fe.set!=="info"){const je=Fe.big?2:1,Ue=Fe.width*je,Je=Fe.height*je;Ue>q.width&&(q.width=Ue),Je>q.height&&(q.height=Je)}if(fe&&(this.emotes.ensureEffect(fe),(fe&Ni)===Ni&&this.emotes.effects_enabled?.ShrinkX&&(L.width*=.5),(fe&Ui)===Ui&&this.emotes.effects_enabled?.GrowX&&(L.width*=2),L.width=Math.min(L.width,k.big?256:128),L.height=Math.min(L.height,k.big?80:40)),ye){const Fe=k.big?64:32;if(L.width>Fe){const je=Fe/L.width;L.width*=je,L.height*=je}}L.width>q.width&&(q.width=L.width),L.height>q.height&&(q.height=L.height),L.width!==q.width&&(L.marginLeft=(q.width-L.width)/2),L.height!==q.height&&(L.marginTop=(q.height-L.height)/2),fe&&(fe&ji)===ji&&(L["--ffz-width"]=`${L.width}px`,L["--ffz-speed-x"]=`${.5*(L.width/(k.big?64:32))}s`)}let Ie;return Ae?(L=L||{},L.backgroundImage=`url("${o}")`,L.backgroundSize="100%",Ie=e("div",{class:`${zi} ffz--pointer-events ffz-tooltip${g?" ffz-hover-emote":""}${k.provider==="twitch"?" twitch-emote":k.provider==="ffz"?" ffz-emote":k.provider==="emoji"?" ffz-emoji":""}`,style:L,"data-name":k.text,"data-tooltip-type":"emote","data-provider":k.provider,"data-id":k.id,"data-set":k.set,"data-code":k.code,"data-variant":k.variant,"data-normal-src":R,"data-normal-src-set":T,"data-hover-src":g,"data-hover-src-set":E,"data-modifiers":pe?le.map(Fe=>Fe.id).join(" "):null,"data-modifier-info":pe?JSON.stringify(le.map(Fe=>[Fe.set,Fe.id])):null,onClick:this.emotes.handleClick},e("div",{class:"ffz-alt-text"},k.text))):Ie=e("img",{class:`${zi} ffz--pointer-events ffz-tooltip${g?" ffz-hover-emote":""}${k.provider==="twitch"?" twitch-emote":k.provider==="ffz"?" ffz-emote":k.provider==="emoji"?" ffz-emoji":""}`,src:f.IS_FIREFOX&&h?.length?void 0:o,srcSet:h,style:L,height:L?void 0:De?`${k.height*2}px`:void 0,alt:k.text,"data-tooltip-type":"emote","data-provider":k.provider,"data-id":k.id,"data-set":k.set,"data-code":k.code,"data-variant":k.variant,"data-normal-src":R,"data-normal-src-set":T,"data-hover-src":g,"data-hover-src-set":E,"data-modifiers":pe?le.map(Fe=>Fe.id).join(" "):null,"data-modifier-info":pe?JSON.stringify(le.map(Fe=>[Fe.set,Fe.id])):null,onClick:this.emotes.handleClick}),!pe&&!k.modifier_flags?i?Ie:e("div",{class:"ffz--inline","data-test-selector":"emote-button"},Ie):e("div",{class:`ffz--inline ffz--pointer-events modified-emote${L?" scaled-modified-emote":""}`,"data-test-selector":"emote-button","data-provider":k.provider,"data-id":k.id,"data-set":k.set,style:q,"data-modifiers":pe?le.map(Fe=>Fe.id).join(" "):null,"data-effects":fe||void 0},Ie,le.map(Fe=>Fe.set==="info"||(Fe.source_modifier_flags&1)===1&&Fe.text?null:e("span",{key:Fe.text},this.tokenizers.emote.render.call(this,Fe,e,!0))))},async tooltip(k,e){const i=k.dataset,s=i.provider,n=i.modifierInfo;let o,h,g,E,R,T,L,q,le,pe=!1;const fe=i.noSource==="true";if(n&&n!=="null"&&(T=JSON.parse(n).map(([Ae,ye])=>{if(Ae==="info")return(0,re.createElement)("span",{class:"tw-mg-05"},ye?.icon?(0,re.createElement)("img",{class:"ffz__tooltip__mod-icon",src:ye.icon}):null,ye?.icon?` - ${ye?.label}`:ye?.label);const Ie=this.emotes.emote_sets[Ae],Fe=Ie&&(Ie.emotes[ye]||Ie.disabled_emotes?.[ye]);if(Fe)return(0,re.createElement)("span",{class:"tw-mg-05"},this.tokenizers.emote.render.call(this,Fe.token,re.createElement),` - ${Fe.hidden?"???":Fe.name}`)})),s==="twitch"){q=i.id;const Ae=fe?null:await this.emotes.getTwitchEmoteSet(q),ye=Ae!=null&&await this.emotes.getTwitchSetChannel(Ae),Ie=fe?null:await this.emotes.getTwitchEmoteArtist(q);if(h=`${(0,r.getTwitchEmoteURL)(i.id,4,!0,!0)}?_=preview`,L="twitch",Ie&&(E=Ie.displayName||Ie.login),ye){const Fe=ye.type;Fe===f.EmoteTypes.Global?ye.owner?.login?g=this.i18n.t("tooltip.channel","Channel: {source}",{source:ye.owner.displayName||ye.owner.login}):g=this.i18n.t("emote.global","Twitch Global"):Fe===f.EmoteTypes.BitsTier?(g=this.i18n.t("emote.bits","Twitch Bits Reward"),ye.owner?.login&&(g=this.i18n.t("emote.bits-owner",`{source}
Channel: {channel}`,{source:g,channel:ye.owner.displayName||ye.owner.login}))):Fe===f.EmoteTypes.Prime||Fe===f.EmoteTypes.Turbo?g=this.i18n.t("emote.prime","Prime Gaming"):Fe===f.EmoteTypes.TwoFactor?g=this.i18n.t("emote.2fa","Twitch 2FA Emote"):Fe===f.EmoteTypes.LimitedTime?g=this.i18n.t("emote.limited","Limited-Time Only Emote"):Fe===f.EmoteTypes.ChannelPoints?g=this.i18n.t("emote.points","Channel Points Emote"):Fe===f.EmoteTypes.Follower&&ye.owner?.login?g=this.i18n.t("emote.follower","Follower Emote ({source})",{source:ye.owner.displayName||ye.owner.login}):Fe===f.EmoteTypes.Subscription&&ye.owner?.login&&(g=this.i18n.t("tooltip.channel","Channel: {source}",{source:ye.owner.displayName||ye.owner.login}))}}else if(s==="ffz"){const Ae=this.emotes.emote_sets[i.set],ye=Ae&&(Ae.emotes[i.id]||Ae.disabled_emotes?.[i.id]);if(Ae&&(g=Ae.source_line||`${Ae.source||"FFZ"} ${Ae.title||"Global"}`,L=Ae.source||"ffz"),ye&&(q=ye.id,ye.artist&&(E=ye.artist.display_name||ye.artist.name),ye.original_name&&ye.original_name!==ye.name&&(le=this.i18n.t("emote.original-name","Name: {name}",{name:ye.original_name})),ye.owner&&(R=this.i18n.t("emote.owner","By: {owner}",{owner:ye.owner.display_name})),this.context.get("tooltip.emote-images.animated")&&ye.animated?.[1]?ye.animated[4]?h=ye.animated[4]:ye.animated[2]&&(h=ye.animated[2]):ye.urls[4]?h=ye.urls[4]:ye.urls[2]&&(h=ye.urls[2]),i.effects&&ye.modifier&&ye.modifier_flags)){R=null;const Fe=ye.modifier_flags;this.emotes.ensureEffect(Fe);const je=this.emotes.getTargetEmote();let Ue={width:(je.width??28)*2,height:(je.height??28)*2},Je={width:Ue.width,height:Ue.height},ct=(this.emotes.activeAsBackgroundMask&Fe)!==0,yt=(this.emotes.activeNoWideMask&Fe)!==0,Qe=!1;if((Fe&Ni)===Ni&&this.emotes.effects_enabled?.ShrinkX&&(Ue.width*=.5,Qe=!0),(Fe&Ui)===Ui&&this.emotes.effects_enabled?.GrowX&&(Ue.width*=2,Qe=!0),Qe&&(Ue.width>512&&(Ue.width=512),Ue.height>160&&(Ue.height=160)),yt&&Ue.width>64){const Ct=64/Ue.width;Ue.width*=Ct,Ue.height*=Ct}Ue.width>Je.width&&(Je.width=Ue.width),Ue.height>Je.height&&(Je.height=Ue.height),Ue.width!==Je.width&&(Ue.marginLeft=(Je.width-Ue.width)/2),Ue.height!==Je.height&&(Ue.marginTop=(Je.height-Ue.height)/2),(Fe&ji)===ji&&(Ue["--ffz-width"]=`${Ue.width}px`,Ue["--ffz-speed-x"]=`${.5*Ue.width/64}s`),Ue.width=`${Ue.width}px`,Ue.height=`${Ue.height}px`,Je.width=`${Je.width}px`,Je.height=`${Je.height}px`,ct&&(Ue.backgroundImage=`url("${je.src}")`,Ue.backgroundSize="100%"),h=(0,re.createElement)("div",{class:"ffz-effect-tip"},(0,re.createElement)("img",{src:je.src,srcSet:je.srcSet,width:(je.width??28)*2,height:(je.height??28)*2,onLoad:e.update}),(0,re.createElement)("span",{class:"ffz-i-right-open"}),(0,re.createElement)("div",{class:`ffz--inline ffz--pointer-events modified-emote${Ue?" scaled-modified-emote":""}`,style:Je,"data-modifiers":ye.id,"data-effects":Fe},ct?(0,re.createElement)("div",{class:`${zi} ffz--pointer-events ffz-tooltip ffz-emote`,style:Ue}):(0,re.createElement)("img",{class:`${zi} ffz--pointer-events ffz-tooltip ffz-emote`,src:je.src,srcSet:je.srcSet,style:Ue,height:Ue?void 0:`${je.height*2}px`,onLoad:e.update})))}}else if(s==="emoji"){const Ae=this.emoji.emoji[i.code],ye=this.context.get("chat.emoji.style"),Ie=i.variant?Ae.variants[i.variant]:Ae,Fe=i.variant?this.emoji.emoji[i.variant]:null;L="emoji",q=i.code,h=(0,re.createElement)("img",{class:"preview-image ffz-emoji",src:this.emoji.getFullImage(Ie.image,ye),srcSet:this.emoji.getFullImageSet(Ie.image,ye),onLoad:e.update}),pe=!0,o=`:${Ae.names[0]}:${Fe?`:${Fe.names[0]}:`:""}`;const je=Ae.category?this.i18n.t(`emoji.category.${Ae.category.toSnakeCase()}`,Ji.aA[Ae.category]||Ae.category):null;g=this.i18n.t("tooltip.emoji","Emoji - {category}",{category:je})}else return;o||(o=i.name||k.alt);const De=L&&this.emotes.isFavorite(L,q);return[h&&this.context.get("tooltip.emote-images")&&(typeof h=="string"?(0,re.createElement)("img",{class:"preview-image",src:h,onLoad:e.update}):h),pe||fe&&!R?o:this.i18n.t("tooltip.emote","Emote: {name}",{name:o}),!fe&&g&&this.context.get("tooltip.emote-sources")&&(0,re.createElement)("div",{class:"tw-pd-t-05"},g),le&&(0,re.createElement)("div",{class:"tw-pd-t-05"},le),R&&this.context.get("tooltip.emote-sources")&&(0,re.createElement)("div",{class:"tw-pd-t-05"},R),E&&this.context.get("tooltip.emote-sources")&&(0,re.createElement)("div",{class:"tw-pd-t-05"},this.i18n.t("emote.artist","Artist: {artist}",{artist:E})),i.sellout&&(0,re.createElement)("div",{class:"tw-mg-t-05 tw-border-t tw-pd-t-05"},i.sellout),T&&(0,re.createElement)("div",{class:"tw-pd-t-1 tw-pd-b-05"},T),De&&(0,re.createElement)("figure",{class:"ffz--favorite ffz-i-star"})]},process(k,e){if(!k||!k.length||this.context.get("chat.emotes.enabled")!==2)return;const i=this.emotes.getEmotes(e.user.id,e.user.login,e.roomID,e.roomLogin);if(!i)return;const s=this.context.get("chat.emotes.2x")>0,n=this.context.get("chat.emotes.animated"),o=[];let h=!1,g=!1,E,R;const T=this.emotes.ModifierFlags?.NoSpace;for(const L of k){if(!L)continue;if(L.type!=="text"){L.type==="emote"&&(L.modifiers||(L.modifiers=[],L.modifier_flags=0)),o.push(L),E=L;continue}let q=[];for(const le of L.text.split(/ +/))if((0,r.has)(i,le)){if(R=i[le],R.modifier&&R.modifier_prefix)h=!0;else if(R.modifier&&E&&E.modifiers&&(!q.length||q.length===1&&q[0]==="")){E.modifiers.indexOf(R.token)===-1&&(R.modifier_flags&&(E.modifier_flags|=R.modifier_flags,T&&(R.modifier_flags&T)===T&&(g=!0)),E.modifiers.push(Object.assign({big:s,anim:n},R.token)));continue}if(q.length){const fe={type:"text",text:`${q.join(" ")} `};o.push(fe),fe.text.trim().length&&(E=fe),q=[]}const pe=Object.assign({modifiers:[],modifier_flags:0,big:s,anim:n},R.token);o.push(pe),E=pe,q.push("")}else q.push(le);if(q.length>1||q.length===1&&q[0]!==""){const le={type:"text",text:q.join(" ")};o.push(le)}}if(h){let L,q=!1,le=o.length;for(;le--;){const pe=o[le];pe.type==="emote"&&!pe.mod?(L=pe,q=!1):L&&pe.type==="emote"&&pe.mod&&pe.mod_prefix?(L.modifiers.push(pe),pe.source_modifier_flags&&(L.modifier_flags|=pe.source_modifier_flags,T&&(pe.source_modifier_flags&T)===T&&(g=!0)),o.splice(le,q?2:1),q=!1):L&&!q&&pe.type==="text"&&pe.text===" "?q=!0:(L=null,q=!1)}}if(g){let L=!1,q=o.length;for(;q--;){const le=o[q];le.type==="emote"&&(le.modifier_flags&T)===T?L=!0:(L&&le.type==="text"&&le.text===" "&&o.splice(q,1),L=!1)}}return o}},Sn={type:"emoji",priority:15,process(k){if(!k||!k.length)return;const e=this.emoji.splitter,i=this.context.get("chat.emotes.2x")>1,s=this.context.get("chat.emoji.replace-joiner")>0,n=this.context.get("chat.emoji.style");if(n===0)return;const o=[];for(const h of k){if(!h)continue;if(h.type!=="text"){o.push(h);continue}const g=s?h.text.replace(Ji.Dk,"\u200D"):h.text;e.lastIndex=0;let E=0,R;for(;R=e.exec(g);){const T=R.index,L=this.emoji.chars.get(R[0]);if(!L)continue;const q=this.emoji.emoji[L[0]],le=L[1]?q.variants[L[1]]:q,pe=(0,r.split_chars)(R[0]).length;E!==T&&o.push({type:"text",text:g.slice(E,T)}),o.push({type:"emote",provider:"emoji",code:L[0],variant:L[1],big_emoji:i,src:this.emoji.getFullImage(le.image,n),srcSet:this.emoji.getFullImageSet(le.image,n),text:R[0],length:pe,modifiers:[],modifier_flags:0}),E=T+R[0].length}E<g.length&&o.push({type:"text",text:g.slice(E)})}return o}},Cn={type:"twitch-emote",priority:20,process(k,e){if(!e.ffz_emotes||this.context.get("chat.emotes.enabled")<1)return;const i=e.ffz_emotes,s=this.context.get("chat.emotes.animated"),n=this.context.get("chat.emotes.2x")>0,o=this.context.get("chat.fix-bad-emotes"),h=[];for(const L in i)if((0,r.has)(i,L))for(const q of i[L])h.push([L,q.startIndex,q.endIndex+1]);const g=h.length;if(!g)return;const E=[];h.sort((L,q)=>L[1]!==q[1]?L[1]-q[1]:q[0]-L[0]);let R=0,T=0;for(const L of k){const q=L.length||L.text&&(0,r.split_chars)(L.text).length||0,le=R,pe=R+q;if(L.type!=="text"){E.push(L),R=pe;continue}const fe=(0,r.split_chars)(L.text);for(;T<g;){const[De,Ae,ye]=h[T];if(typeof De=="string"&&(De.startsWith("__FFZ__")||De.startsWith("__BTTV__"))){T++;continue}if(Ae>pe||ye>pe){le===R?E.push(L):E.push({type:"text",text:fe.slice(R-le).join("")}),Ae<pe&&ye>pe&&T++,R=pe;break}if(Ae<R){T++;continue}Ae>R&&E.push({type:"text",text:fe.slice(R-le,Ae-le).join("")});let Ie,Fe,je,Ue,Je,ct,yt,Qe,bt=!0;const Ct=f.REPLACEMENTS[De];Ct&&o?(Ie=`${f.REPLACEMENT_BASE}${Ct}`,Fe="",bt=!1):(Ie=(0,r.getTwitchEmoteURL)(De,1,!1),Fe=(0,r.getTwitchEmoteSrcSet)(De,!1),s>0&&(je=(0,r.getTwitchEmoteURL)(De,1,!0),Ue=(0,r.getTwitchEmoteSrcSet)(De,!0)),n&&(Je=(0,r.getTwitchEmoteURL)(De,2,!1),ct=(0,r.getTwitchEmoteSrcSet)(De,!1,!0,!0),s>0&&(yt=(0,r.getTwitchEmoteURL)(De,2,!0),Qe=(0,r.getTwitchEmoteSrcSet)(De,!0,!0,!0))));const Yt=f.WEIRD_EMOTE_SIZES[De],ci=Yt?Yt[0]:28,pi=Yt?Yt[1]:28;E.push({type:"emote",id:De,provider:"twitch",src:Ie,srcSet:Fe,src2:Je,srcSet2:ct,animSrc:je,animSrc2:yt,animSrcSet:Ue,animSrcSet2:Qe,anim:s,big:n,can_big:bt,width:ci,height:pi,text:fe.slice(Ae-le,ye-le).join(""),modifiers:[],modifier_flags:0}),R=ye,T++}R<pe&&(le===R?E.push(L):E.push({type:"text",text:fe.slice(R-le).join("")}),R=pe)}return E}},xn={type:"link",can_hide_token:!0,priority:-10,test(k){if(k.type!=="link")return!1;const e=k.url;for(const i of this.__link_providers)if(i.test.call(this,e))return!0;return this.context.get("chat.rich.all-links")||k.force_rich},process(k,e){return{card_tooltip:!0,url:k.url,timeout:0,want_mid:e,getData:async(i=!1)=>{let s;try{s=await this.get_link_info(k.url,!1,i)}catch(n){return{url:k.url,error:String(n)}}return s?{...s,allow_media:this.context.get("tooltip.link-images"),allow_unsafe:this.context.get("tooltip.link-nsfw-images")}:{url:k.url}}}}};var En=X(36e3),Fn=X.n(En),zn=X(87590),An=X.n(zn);const Dn=/^(?:https?:\/\/)?clips\.twitch\.tv\/([a-z0-9-_=]+)(?:\/)?(\w+)?(?:\/edit)?/i,Tn=/^(?:https?:\/\/)?(?:(?:www|m)\.)?twitch\.tv\/\w+\/clip\/([a-z0-9-_=]+)/i,Mn=/^(?:https?:\/\/)?(?:www\.)?twitch\.tv\/(?:\w+\/v|videos)\/(\w+)/,Pn=/^(?:https?:\/\/)?(?:www\.)?twitch\.tv\/([^/]+)$/,Bn=["directory","_deck","p","downloads","jobs","turbo","settings","friends","subscriptions","inventory","wallet","store","drops","search","prime"],Rn={type:"clip",test(k){const e=Dn.exec(k)||Tn.exec(k);if(e&&e[1]&&e[1]!=="create")return e[1]},receive(k,e){const i=e?.twitch_metadata?.clip_metadata;if(i)return{id:i.id,slug:i.slug,title:e.title,thumbnailURL:e.thumbnail_url,curator:{id:i.curator_id,displayName:e.author_name},broadcaster:{id:i.broadcaster_id,displayName:i.channel_display_name},game:{displayName:i.game}}},async process(k,e){let i=e;if(!i){const T=this.resolve("site.apollo");if(!T)return null;i=(await T.client.query({query:Fn(),variables:{slug:k}}))?.data?.clip}if(!i||!i.broadcaster)return null;const s=i.game,n=s&&s.displayName;let o={type:"style",weight:"semibold",color:"alt-2",content:i.broadcaster.displayName};i.broadcaster.login&&(o={type:"link",url:`https://www.twitch.tv/${i.broadcaster.login}`,content:o});const h=n?{type:"i18n",key:"clip.desc.1.playing",phrase:"{user} playing {game}",content:{user:o,game:{type:"style",weight:"semibold",content:n}}}:{type:"i18n",key:"clip.desc.1",phrase:"Clip of {user}",content:{user:o}};let g=i.curator?{type:"style",color:"alt-2",content:i.curator.displayName}:{type:"i18n",key:"clip.unknown",phrase:"Unknown"};i.curator?.login&&(g={type:"link",url:`https://www.twitch.tv/${i.curator.login}`,content:g});let E;return i.viewCount>0?E={type:"i18n",key:"clip.desc.2",phrase:"Clipped by {curator} \u2014 {views, plural, one {# View} other {# Views}}",content:{curator:g,views:i.viewCount}}:E={type:"i18n",key:"clip.desc.no-views",phrase:"Clipped by {curator}",content:{curator:g}},{accent:"#6441a4",fragments:{header:{type:"header",image:{type:"image",url:i.thumbnailURL,sfw:!0,aspect:16/9},title:i.title,subtitle:h,extra:E}},short:{type:"ref",name:"header"},full:[{type:"ref",name:"header"},{type:"conditional",media:!0,content:{type:"gallery",items:[{type:"player",iframe:`https://clips.twitch.tv/embed?parent=twitch.tv&clip=${k}`,aspect:16/9,content:{type:"overlay",content:{type:"image",url:i.thumbnailURL,sfw:!0,aspect:16/9},center:{type:"style",size:"2",content:{type:"icon",name:"play"}}}}]}}]}}},$n={type:"user",test(k){const e=Pn.exec(k);if(e&&!Bn.includes(e[1]))return e[1]},async process(k){const e=this.resolve("site.twitch_data"),i=e?await e.getUser(null,k):null;if(!i||!i.id)return null;const s=i.broadcastSettings?.game?.displayName,n=i.stream?.id,o={avatar:{type:"image",url:i.profileImageURL,rounding:-1,aspect:1},desc:i.description,title:[i.displayName]};n&&s&&(o.game={type:"style",weight:"semibold",content:s}),i.displayName.trim().toLowerCase()!==i.login&&o.title.push({type:"style",color:"alt-2",content:[" (",i.login,")"]}),i.roles?.isPartner&&o.title.push({type:"style",color:"link",content:{type:"icon",name:"verified"}});const h=[{type:"header",image:{type:"ref",name:"avatar"},title:{type:"ref",name:"title"}},{type:"box","mg-y":"small",wrap:"pre-wrap",lines:5,content:{type:"ref",name:"desc"}}];if(n&&s){const g=i.stream.previewImageURL?i.stream.previewImageURL.replace("{width}","320").replace("{height}","180"):null;h.push({type:"link",url:`https://www.twitch.tv/${i.login}`,embed:!0,interactive:!0,tooltip:!1,content:[{type:"conditional",media:!0,content:{type:"gallery",items:[{type:"image",url:g,aspect:16/9}]}},{type:"box","mg-y":"small",lines:2,content:i.broadcastSettings.title},{type:"ref",name:"game"}]})}return h.push({type:"header",compact:!0,subtitle:[{type:"icon",name:"twitch"}," Twitch"]}),{v:5,accent:i.primaryColorHex?`#${i.primaryColorHex}`:null,fragments:o,short:{type:"header",image:{type:"ref",name:"avatar"},title:{type:"ref",name:"title"},subtitle:{type:"ref",name:"desc"},extra:n?{type:"i18n",key:"cards.user.streaming",phrase:"streaming {game}",content:{game:{type:"ref",name:"game"}}}:null},full:h}}},On={type:"video",test(k){const e=Mn.exec(k);if(e)return e[1]},async process(k){const e=this.resolve("site.apollo");if(!e)return null;const i=await e.client.query({query:An(),variables:{id:k}});if(!i||!i.data||!i.data.video||!i.data.video.owner)return null;const s=i.data.video,n=s.game,o=n&&n.displayName,h={title:s.title,thumbnail:{type:"image",url:s.previewThumbnailURL,aspect:16/9}},g={type:"link",url:`https://www.twitch.tv/${s.owner.login}`,content:{type:"style",weight:"semibold",color:"alt-2",content:s.owner.displayName}};h.subtitle=s.game?.displayName?{type:"i18n",key:"video.desc.1.playing",phrase:"Video of {user} playing {game}",content:{user:g,game:{type:"style",weight:"semibold",content:s.game.displayName}}}:{type:"i18n",key:"video.desc.1",phrase:"Video of {user}",content:{user:g}};let E=s.lengthSeconds;return{v:5,fragments:h,short:{type:"header",image:{type:"ref",name:"thumbnail"},title:{type:"ref",name:"title"},subtitle:{type:"ref",name:"subtitle"},extra:{type:"i18n",key:"video.desc.2",phrase:"{length,duration} \u2014 {views,number} Views \u2014 {date,datetime}",content:{length:E,views:s.viewCount,date:s.publishedAt}}},full:[{type:"header",image:{type:"image",url:s.owner.profileImageURL,rounding:-1,aspect:1},title:{type:"ref",name:"title"},subtitle:{type:"ref",name:"subtitle"}},{type:"box","mg-y":"small",lines:5,wrap:"pre-wrap",content:s.description},{type:"conditional",media:!0,content:{type:"gallery",items:[{type:"overlay",content:{type:"ref",name:"thumbnail"},"top-left":{type:"format",format:"duration",value:E},"bottom-left":{type:"i18n",key:"video.views",phrase:"{views,number} views",content:{views:s.viewCount}}}]}},{type:"header",compact:!0,subtitle:[{type:"icon",name:"twitch"}," Twitch \u2022 ",{type:"format",format:"datetime",value:s.publishedAt}]}]}}},In={presets:[{appearance:{type:"icon",icon:"ffz-i-pin"}}],required_context:["message"],title:"Pin This Message",description:"Allows you to pin a chat message if you're a moderator.",can_self:!0,tooltip(k){return k.line?.props?.pinnedMessage?.message?.id===k.message_id?this.i18n.t("chat.actions.pin.already","This message is already pinned."):this.i18n.t("chat.actions.pin","Pin This Message")},disabled(k,e,i,s,n,o){return(o??k.line)?.props?.pinnedMessage?.message?.id===e.id&&e.id!=null},hidden(k,e,i,s,n,o){let h=o;if(!h||!h.props.isPinnable||!h.onPinMessageClick||!e.message||!e.message.length||e.deleted)return!0},click(k,e){let i=e.line;if(!i){const s=this.resolve("site.fine");i=s?s.searchParent(k.target,n=>n.setMessageTray&&n.props&&n.props.message):null}!i||!i.props.isPinnable||!i.onPinMessageClick||i.props.pinnedMessage?.message?.id!==e.message_id&&i.onPinMessageClick()}},Ln={presets:[{appearance:{type:"dynamic"}}],required_context:["message"],supports_dynamic:!0,title:"Reply to Message",description:"Allows you to directly reply to another user's message.",can_self:!0,dynamicAppearance(k,e,i,s,n,o,h){const g=h??e.line,E=g?.props;return{type:"icon",icon:E?.hasReply||E?.reply?"ffz-i-threads":"ffz-i-reply",color:k.color}},tooltip(k){const e=k.line?.props;return e?.hasReply||e?.reply?this.i18n.t("chat.actions.reply.thread","Open Thread"):this.i18n.t("chat.actions.reply","Reply to Message")},hidden(k,e,i,s){const n=e?.id;if(typeof n!="string"||!/^[0-9a-f]+-[0-9a-f]+/.test(n)||!s?.can_reply||s?.reply_mode===0||!e.message||e.deleted)return!0},click(k,e){let i=e.line;if(!i){const s=this.resolve("site.fine");i=s?s.searchParent(k.target,n=>n.setMessageTray&&n.props&&n.props.message):null}i&&i.ffzOpenReply()}},Nn={presets:[{appearance:{type:"icon",icon:"ffz-i-pencil"}}],required_context:["user"],title:"Change Name & Color",description:"Allows you to set local overrides for a user's name and color in chat.",can_self:!0,tooltip(){return this.i18n.t("chat.actions.edit_overrides","Change Name & Color")},click(k,e){this.resolve("chat.overrides").renderUserEditor(e.user,k.target)}},jn={presets:[{appearance:{type:"icon",icon:"ffz-i-docs"}}],defaults:{format:"{{user.displayName}}: {{message.text}}"},editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,66038)),required_context:["user","message"],title:"Copy Message",description:"Allows you to quickly copy a chat message to your clipboard.",can_self:!0,tooltip(k){const e=this.replaceVariables(k.options.format,k);return[(0,re.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.actions.copy_message","Copy Message")),(0,re.createElement)("div",{class:"tw-align-left"},e)]},click(k,e){const i=this.replaceVariables(e.options.format,e);navigator.clipboard.writeText(i)}},Un={presets:[{appearance:{type:"icon",icon:"ffz-i-link-ext"}}],defaults:{url:"https://link.example/{{user.login}}"},editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,86773)),title:"Open URL",description(k){return k.options.url},description_i18n:null,can_self:!0,tooltip(k){const e=this.replaceVariables(k.options.url,k);return[(0,re.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.actions.open_url","Open URL")),(0,re.createElement)("div",{class:"tw-align-left"},e)]},click(k,e){const i=this.replaceVariables(e.options.url,e),s=window.open();s&&(s.opener=null,s.location=i)}},Hn={presets:[{appearance:{type:"text",text:"C"}}],required_context:["room"],defaults:{command:"@{{user.login}} HeyGuys",paste:!1},title:"Chat Command",description(k){if(k.options.paste)return this.t("chat.actions.chat.desc.paste","Paste into chat: {cmd}",{cmd:k.options.command});const e=k.options.target??"";return this.t("chat.actions.chat.desc.target","Send in {target}: {cmd}",{cmd:k.options.command,target:/^\s*$/.test(e)?this.t("chat.actions.chat.desc.current","current channel"):e})},description_i18n:null,can_self:!0,editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,34727)),tooltip(k){const e=this.replaceVariables(k.options.command,k);let i=this.replaceVariables(k.options.target??"",k);return/^\s*$/.test(i)&&(i=null),[(0,re.createElement)("div",{class:"tw-border-b tw-mg-b-05"},i?this.i18n.t("chat.actions.chat.with-target","Chat Command in Channel: {target}",{target:i}):this.i18n.t("chat.actions.chat","Chat Command")),(0,re.createElement)("div",{class:"tw-align-left"},e)]},click(k,e){const i=this.replaceVariables(e.options.command,e);let s=this.replaceVariables(e.options.target??"",e);(e.options.paste||/^\s*$/.test(s))&&(s=e.room.login),e.options.paste?this.pasteMessage(s,i):this.sendMessage(s,i)}},Wn={presets:[{appearance:{type:"icon",icon:"ffz-i-trash"},display:{mod:!0,mod_icons:!0}}],defaults:{},required_context:["room","user","message"],title:"Delete Message",tooltip(k){return this.i18n.t("chat.actions.delete.tooltip","Delete {user.login}'s message",{user:k.user})},click(k,e){return this.resolve("site.twitch_data").deleteChatMessage(e.room.id,e.message_id).catch(s=>{s instanceof r.TranslatableError&&this.addNotice(e.room.login,this.i18n.t(s.i18n_key,s.message,s.data))})}},Gn={presets:[{appearance:{type:"icon",icon:"ffz-i-block"},display:{mod:!0,mod_icons:!0}}],defaults:{},required_context:["room","user"],uses_reason:!0,editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,93953)),title:"Ban User",reason_text(k){return this.i18n.t("chat.actions.ban-reason","Ban {user.login} for:",{user:k.user})},tooltip(k){return this.i18n.t("chat.actions.ban.tooltip","Ban {user.login}",{user:k.user})},click(k,e){let i=e.reason||e.options.reason||"";i.length&&(i=this.replaceVariables(i,e)),this.sendMessage(e.room.login,`/ban ${e.user.login} ${i}`)}},Vn={presets:[{appearance:{type:"icon",icon:"ffz-i-clock"},display:{mod:!0,mod_icons:!0}}],defaults:{duration:600},required_context:["room","user"],uses_reason:!0,editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,69454)),title:"Timeout User",description:"{options.duration, plural, one {# second} other {# seconds}}",reason_text(k){return this.i18n.t("chat.actions.timeout-reason","Timeout {user.login} for {duration, plural, one {# second} other {# seconds}} for:",{user:k.user,duration:k.options.duration})},tooltip(k){return this.i18n.t("chat.actions.timeout.tooltip","Timeout {user.login} for {duration, plural, one {# second} other {# seconds}}",{user:k.user,duration:k.options.duration})},click(k,e){let i=e.reason||e.options.reason||"";i.length&&(i=this.replaceVariables(i,e)),this.sendMessage(e.room.login,`/timeout ${e.user.login} ${e.options.duration} ${i}`)}},Zn={presets:[{appearance:{type:"icon",icon:"ffz-i-ok"},display:{mod:!0,mod_icons:!0}}],required_context:["room","user"],title:"Unban User",tooltip(k){return this.i18n.t("chat.actions.unban.tooltip","Unban {user.login}",{user:k.user})},click(k,e){this.sendMessage(e.room.login,`/unban ${e.user.login}`)}},Kn={presets:[{appearance:{type:"icon",icon:"ffz-i-ok"},display:{mod:!0,mod_icons:!0}}],required_context:["room","user"],title:"Untimeout User",tooltip(k){return this.i18n.t("chat.actions.untimeout.tooltip","Untimeout {user.login}",{user:k.user})},click(k,e){this.sendMessage(e.room.login,`/untimeout ${e.user.login}`)}},qn={presets:[{appearance:{type:"icon",icon:"ffz-i-mod"}}],required_context:["room","user"],title:"Mod User",tooltip(k){return this.i18n.t("chat.actions.mod.tooltip","Mod {user.login}",{user:k.user})},hidden(k,e,i,s,n,o){return e.user.type==="mod"||e.user.id===i.id?!0:i.id!==s.id},click(k,e){this.sendMessage(e.room.login,`/mod ${e.user.login}`)}},Yn={presets:[{appearance:{type:"icon",icon:"ffz-i-unmod"}}],required_context:["room","user"],title:"Un-Mod User",tooltip(k){return this.i18n.t("chat.actions.unmod.tooltip","Un-Mod {user.login}",{user:k.user})},hidden(k,e,i,s,n,o){return e.user.type!=="mod"?!0:e.user.id===s.id||e.user.id===i.id?!1:i.id!==s.id},click(k,e){this.sendMessage(e.room.login,`/unmod ${e.user.login}`)}},Xn={presets:[{appearance:{type:"text",text:"W"}}],required_context:["user"],title:"Whisper User",tooltip(k){return this.i18n.t("chat.actions.whisper.tooltip","Whisper {user.login}",k)},click(k,e){const i=this.resolve("site"),s=i&&i.getUser(),n=i&&i.store;if(!s||!n||!e.user||!e.user.id||s.id==e.user.id)return;const o=parseInt(s.id,10),h=parseInt(e.user.id,10),g=o<h?`${o}_${h}`:`${h}_${o}`;n.dispatch({type:"whispers.THREAD_OPENED",data:{threadID:g,collapsed:!1}})}},Jn={presets:[{appearance:{type:"dynamic"}}],editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,12893)),required_context:[],supports_dynamic:!0,can_self:!0,title:"Toggle Settings Profile",description(k){const e=window.FrankerFaceZ.get(),i=e?.resolve("settings"),s=i?.profile(k.options?.uuid);return s?s.i18n_key?this.t(s.i18n_key,s.name):s.name:null},description_i18n:null,dynamicAppearance(k,e){const i=this.settings.profile(e.options?.uuid);return i?{type:"icon",icon:i.toggled?"ffz-i-ok":"ffz-i-cancel",color:k.color}:{type:"icon",icon:"ffz-i-attention",color:k.color}},tooltip(k){const e=this.settings.profile(k.options?.uuid);let i;return e?i=e.i18n_key?this.i18n.t(e.i18n_key,e.name):e.name:i="invalid",this.i18n.t("chat.actions.toggle_profile.tooltip","Toggle Profile: {name}",{name:i})},click(k,e){const i=this.settings.profile(e.options?.uuid);if(!i)return;const s=new Set;for(const n of["inline","hover","user-context","room"]){const o=`chat.actions.${n}`,h=this.parent.context.get(o);if(Array.isArray(h)){for(const g of h)if(g.action==="toggle_profile"&&g.options?.uuid===i.uuid){s.add(n),this.parent.context.once(`changed:${o}`,()=>s.delete(n));break}}}i.toggled=!i.toggled,requestAnimationFrame(()=>{for(const n of s)this.parent.context.update(`chat.actions.${n}`)})}};var Hs=X(61892);const Qn={title:"Dynamic",title_i18n:"setting.actions.appearance.dynamic",colored:!0,render(k,e,i){return e("figure",{style:{color:i},class:`${k.icon||"ffz-i-zreknarf"}`})}},er={title:"Text",title_i18n:"setting.actions.appearance.text",colored:!0,editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,74640)),component:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,68185)),render(k,e,i){return e("span",{style:{color:i}},k.text)}},tr={title:"Emote",title_i18n:"setting.actions.appearance.emote",editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,29668)),component:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,25816)),render(k,e){return e("figure",{class:"mod-icon__image"},e("img",{src:k.src}))}},ir={title:"Icon",title_i18n:"setting.actions.appearance.icon",colored:!0,editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,8684)),load(k){return k.icon&&k.icon.startsWith("ffz-fa")&&(0,Hs.load)(),!0},component:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,92123)),render(k,e,i){return e("figure",{style:{color:i},class:`${k.icon||"ffz-i-zreknarf"}`})}},sr={title:"Text and Icon",title_i18n:"setting.actions.appearance.combo",colored:!0,editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,56727)),load(k){return k.icon&&k.icon.startsWith("ffz-fa")&&(0,Hs.load)(),!0},component:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,6234)),render(k,e,i){return e("span",{style:{color:i},class:k.icon},k.text)}},nr={title:"Image",title_i18n:"setting.actions.appearance.image",editor:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,17816)),component:()=>Promise.all([X.e(6530),X.e(6940),X.e(2086)]).then(X.bind(X,81725)),render(k,e){return e("figure",{class:"mod-icon__image"},e("img",{src:k.image}))}},rr=/\{\{(.*?)(?:\|(.*?))?\}\}/g,Ds=class Ds extends d.default{constructor(...e){super(...e),this.inject("settings"),this.inject("tooltips"),this.inject("i18n"),this.actions={},this.renderers={},this.filterAction=i=>i.appearance&&this.renderers[i.appearance.type]&&(!this.renderers[i.appearance.type].load||this.renderers[i.appearance.type].load(i.appearance))&&(!i.action||this.actions[i.action]),this.settings.add("chat.actions.size",{default:16,ui:{path:'Chat > Actions @{"always_list_pages": true} >> Appearance',title:"Action Size",description:"How tall actions should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.actions.hover-size",{default:30,ui:{path:"Chat > Actions > Message Hover >> Appearance",title:"Action Size",description:"How tall hover actions should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.actions.reasons",{default:[{v:{text:"One-Man Spam",i18n:"chat.reasons.spam"}},{v:{text:"Posting Bad Links",i18n:"chat.reasons.links"}},{v:{text:"Ban Evasion",i18n:"chat.reasons.evasion"}},{v:{text:"Threats / Personal Info",i18n:"chat.reasons.personal"}},{v:{text:"Hate / Harassment",i18n:"chat.reasons.hate"}},{v:{text:"Ignoring Broadcaster / Moderators",i18n:"chat.reason.ignore"}}],type:"array_merge",always_inherit:!0,process(i,s){if(Array.isArray(s))for(const n of s)n.i18n&&typeof n.i18n!="string"&&delete n.i18n;return s},ui:{path:"Chat > Actions > Reasons >> Custom Reasons",component:"chat-reasons"}}),this.settings.add("chat.actions.hover",{process:(i,s)=>s.filter(this.filterAction),default:[{v:{action:"pin",appearance:{type:"icon",icon:"ffz-i-pin"},options:{},display:{mod_icons:!0}}},{v:{action:"reply",appearance:{type:"dynamic"},options:{},display:{}}}],type:"array_merge",inherit_default:!0,ui:{path:`Chat > Actions > Message Hover @{"description": "Here, you can define custom actions that will appear on top of messages in chat when you hover over them. If you aren't seeing an action you've defined here in chat, please make sure that you have enabled Mod Icons in the chat settings menu."}`,component:"chat-actions",context:["user","room","message"],inline:!0,modifiers:!0,hover_modifier:!1,data:()=>{const i=this.resolve("site.chat");return{color:s=>i&&i.colors?i.colors.process(s):s,actions:(0,r.deep_copy)(this.actions),renderers:(0,r.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.inline",{process:(i,s)=>s.filter(this.filterAction),default:[{v:{action:"ban",appearance:{type:"icon",icon:"ffz-i-block"},options:{},display:{mod:!0,mod_icons:!0,deleted:!1}}},{v:{action:"unban",appearance:{type:"icon",icon:"ffz-i-ok"},options:{},display:{mod:!0,mod_icons:!0,deleted:!0}}},{v:{action:"timeout",appearance:{type:"icon",icon:"ffz-i-clock"},display:{mod:!0,mod_icons:!0}}},{v:{action:"msg_delete",appearance:{type:"icon",icon:"ffz-i-trash"},options:{},display:{mod:!0,mod_icons:!0}}}],type:"array_merge",inherit_default:!0,ui:{path:`Chat > Actions > In-Line @{"description": "Here, you can define custom actions that will appear along messages in chat. If you aren't seeing an action you've defined here in chat, please make sure that you have enabled Mod Icons in the chat settings menu."}`,component:"chat-actions",context:["user","room","message"],inline:!0,modifiers:!0,data:()=>{const i=this.resolve("site.chat");return{color:s=>i&&i.colors?i.colors.process(s):s,actions:(0,r.deep_copy)(this.actions),renderers:(0,r.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.user-context",{process:(i,s)=>s.filter(n=>n.type||this.filterAction(n)),default:[],type:"array_merge",inherit_default:!0,ui:{path:'Chat > Actions > User Context @{"description": "Here, you can define custom actions that will appear in a context menu when you right-click a username in chat."}',component:"chat-actions",context:["user","room","message"],mod_icons:!0,data:()=>{const i=this.resolve("site.chat");return{color:s=>i&&i.colors?i.colors.process(s):s,actions:(0,r.deep_copy)(this.actions),renderers:(0,r.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.room",{process:(i,s)=>s.filter(n=>n.type||this.filterAction(n)),default:[],type:"array_merge",inherit_default:!0,ui:{path:'Chat > Actions > Room @{"description": "Here, you can define custom actions that will appear above the chat input box."}',component:"chat-actions",context:["room","room-mode"],inline:!1,data:()=>{const i=this.resolve("site.chat");return{color:s=>i&&i.colors?i.colors.process(s):s,actions:(0,r.deep_copy)(this.actions),renderers:(0,r.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.room-above",{default:!1,ui:{path:"Chat > Actions > Room >> General",component:"setting-check-box",title:"Display Room Actions above the chat input box."}}),this.settings.add("chat.actions.rules-as-reasons",{default:!0,ui:{path:"Chat > Actions > Reasons >> Rules",component:"setting-check-box",title:"Include the current room's rules in the list of reasons."}}),this.handleClick=this.handleClick.bind(this),this.handleContext=this.handleContext.bind(this),this.handleUserContext=this.handleUserContext.bind(this)}onEnable(){this.tooltips.types.action=(e,i)=>{const s=this.getData(e);return s?s.definition.tooltip?s.tip&&s.tip.length?this.replaceVariables(s.tip,s):(0,r.maybe_call)(s.definition.tooltip,this,s,e,i):`Error: The "${s.action}" action provider does not have tooltip support.`:this.i18n.t("chat.actions.unknown","Unknown Action Type")};for(const e in W)(0,r.has)(W,e)&&this.addAction(e,W[e]);for(const e in x)(0,r.has)(x,e)&&this.addRenderer(e,x[e]);this.on("addon:fully-unload",e=>{let i=0;for(const[s,n]of Object.entries(this.actions))n?.__source===e&&(i++,delete this.actions[s]);for(const[s,n]of Object.entries(this.renderers))n?.__source===e&&(i++,delete this.renderers[s]);i&&(this.log.debug(`Cleaned up ${i} entries when unloading addon:`,e),this._updateContexts())})}getAddonProxy(e,i,s){if(!e)return this;const n={},o={},h=f.DEBUG||i?.dev;return n.addAction=(g,E)=>(E&&(E.__source=e),h&&!g.includes(e)&&s.log.warn("[DEV-CHECK] Call to actions.addAction() did not include add-on ID in key:",g),this.addAction(g,E)),n.addRenderer=(g,E)=>(E&&(E.__source=e),h&&!g.includes(e)&&s.log.warn("[DEV-CHECK] Call to actions.addRenderer() did not include add-on ID in key:",g),this.addRenderer(g,E)),h&&(n.removeAction=(...g)=>{for(const E of g){const R=this.actions[E];R&&R.__source!==e&&s.log.warn("[DEV-CHECK] Removed un-owned action with actions.removeAction:",E," owner:",R.__source??"ffz")}return this.removeAction(...g)},n.removeRenderer=(...g)=>{for(const E of g){const R=this.renderers[E];R&&R.__source!==e&&s.log.warn("[DEV-CHECK] Removed un-owned renderer with actions.removeRenderer:",E," owner:",R.__source??"ffz")}return this.removeRenderer(...g)},o.actions="Please use addAction() or removeAction()",o.renderers="Please use addRenderer() or removeRenderer()"),(0,d.buildAddonProxy)(s,this,"actions",n,o)}_updateContexts(){for(const e of this.settings.__contexts)e.update("chat.actions.inline"),e.update("chat.actions.hover"),e.update("chat.actions.user-context"),e.update("chat.actions.room")}addAction(e,i){if((0,r.has)(this.actions,e))return this.log.warn(`Attempted to add action "${e}" which is already defined.`);this.actions[e]=i,this._updateContexts()}addRenderer(e,i){if((0,r.has)(this.renderers,e))return this.log.warn(`Attempted to add renderer "${e}" which is already defined.`);this.renderers[e]=i,this._updateContexts()}getActions(){return{...this.actions}}getAction(e){return this.actions[e]??null}getRenderer(e){return this.renderers[e]??null}getRenderers(){return{...this.renderers}}removeAction(...e){let i=!1;for(const s of e)(0,r.has)(this.actions,s)&&(delete this.actions[s],i=!0);i&&this._updateContexts()}removeRenderer(...e){let i=!1;for(const s of e){if(!(0,r.has)(this.renderers,s))return;delete this.renderers[s],i=!0}i&&this._updateContexts()}replaceVariables(e,i){return Ot(e,i,this.i18n.locale,rr,{upper(s){return s.toString().toUpperCase()},uppercase(s){return s.toString().toUpperCase()},lower(s){return s.toString().toLowerCase()},lowercase(s){return s.toString().toLowerCase()},snakecase(s){return s.toString().toSnakeCase()},slugify(s,n,o,h){return s.toString().toSlug(h&&h.length?h:"-")},urlencode(s){return encodeURIComponent(s)},word(s,n,o,h){if(!h||!h.length)return s;let g,E;const R=h.split(",");try{if(g=parseInt(R[0],10),isNaN(g)||!isFinite(g))return s}catch{return this.log.warn("Invalid value for word(start)",R[0]),s}if(R.length>1)if(!R[1].trim().length)E=-1;else try{if(E=parseInt(R[1],10),isNaN(E)||!isFinite(E))return s}catch{return this.log.warn("Invalid value for word(end)",R[1]),s}const T=s.split(/\s+/);return g<0&&(g=T.length+g),g<0&&(g=0),g>=T.length&&(g=T.length-1),E!=null?(E<0&&(E=T.length+E),E<g&&(E=g),E>T.length&&(E=T.length),T.slice(g,E+1).join(" ")):T[g]}})}renderInlineReasons(e,i,s){const n=this.parent.context.get("chat.actions.reasons"),o=[],h=this.parent.context.get("chat.actions.rules-as-reasons")&&this.parent.getRoom(e.room.id,e.room.login,!0),g=h&&h.rules;if(!n&&!g)return s.hide(),null;const E=B(T=>L=>(s.hide(),e.definition.click.call(this,L,Object.assign({reason:T},e)),L.preventDefault(),!1),"click_fn");if(n&&n.length)for(const T of n){const L=this.replaceVariables(typeof T.i18n=="string"?this.i18n.t(T.i18n,T.text):T.text,e);o.push((0,re.createElement)("li",{class:"tw-full-width tw-relative"},(0,re.createElement)("a",{href:"#",class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-05",onClick:E(L)},L)))}if(g&&g.length){n&&n.length&&o.push((0,re.createElement)("div",{class:"tw-mg-y-05 tw-border-b"}));for(const T of g)o.push((0,re.createElement)("li",{class:"tw-full-width tw-relative"},(0,re.createElement)("a",{href:"#",class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-05",onClick:E(T)},T)))}let R;return e.definition.reason_text?R=e.definition.reason_text.call(this,e,i,s):R=this.i18n.t("chat.actions.select-reason","Please select a reason from the list below:"),(0,re.createElement)("div",{class:"ffz--inline-reasons"},R?(0,re.createElement)("div",{class:"tw-pd-05 tw-border-b"},R):null,(0,re.createElement)("div",{class:"scrollable-area","data-simplebar":!0},(0,re.createElement)("div",{class:"simplebar-scroll-content"},(0,re.createElement)("div",{class:"simplebar-content"},(0,re.createElement)("ul",null,o)))))}renderInlineContext(e,i){const s=i.definition;let n;if(s.context)n=B((o,h)=>s.context.call(this,i,o,h),"content");else if(s.uses_reason)n=B((o,h)=>this.renderInlineReasons(i,o,h),"content");else return;return this.renderPopup(e,n)}renderPopup(e,i){if(e._ffz_destroy)return e._ffz_destroy();const s=e._ffz_destroy=()=>{if(e._ffz_outside&&e._ffz_outside.destroy(),e._ffz_popup){const h=e._ffz_popup;e._ffz_popup=null,h.destroy()}e._ffz_on_destroy&&e._ffz_on_destroy(),e._ffz_destroy=e._ffz_outside=e._ffz_on_destroy=null},n=document.fullscreenElement||document.body.querySelector("#root>div")||document.body;(e._ffz_popup=new ri.default(n,e,{logger:this.log,manual:!0,live:!1,html:!0,hover_events:!0,no_update:!0,tooltipClass:"ffz-action-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"ffz-balloon__tail tw-overflow-hidden tw-absolute",arrowInner:"ffz-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base  tw-absolute",innerClass:"",popper:{placement:"bottom",modifiers:{preventOverflow:{boundariesElement:n},flip:{behavior:["bottom","top","left","right"]}}},content:i,onShow:async(h,g)=>{await g.waitForDom(),e._ffz_outside=new re.ClickOutside(g.outer,s)},onMove:(h,g,E)=>{this.emit("tooltips:hover",h,g,E)},onLeave:(h,g,E)=>{this.emit("tooltips:leave",h,g,E)},onHide:s}))._enter(e)}getUserLevel(e,i){return!e||!i?0:e.id===i.id||e.login===i.login?5:i.moderator||i.type==="mod"||i.badges&&i.badges.moderator?3:0}renderRoom(e,i,s,n,o){const h=[],g=this.resolve("site.chat");let E=null;for(const q of this.parent.context.get("chat.actions.room")){if(!q)continue;q.ctx="room";const le=q.type;if(le){le==="new-line"?E=null:le==="space"?(E||h.push(E=[]),E.push(o("div",{class:"tw-flex-grow-1"}))):le==="space-small"?(E||h.push(E=[]),E.push(o("div",{class:"tw-mg-x-1"}))):this.log.warn("Unknown action type",le);continue}if(!q.action||!q.appearance)continue;let pe=q.appearance||{};const fe=q.display||{},De=this.actions[q.action];if(!De||fe.disabled||fe.mod_icons!=null&&fe.mod_icons!==!!e||fe.mod!=null&&fe.mod!==(i?!!i.mod:!1)||fe.staff!=null&&fe.staff!==(i?!!i.staff:!1)||fe.emoteOnly!=null&&fe.emoteOnly!==s.emoteOnly||fe.slowMode!=null&&fe.slowMode!==s.slowMode||fe.subsMode!=null&&fe.subsMode!==s.subsMode||fe.r9kMode!=null&&fe.r9kMode!==s.r9kMode||fe.followersOnly!=null&&fe.followersOnly!==s.followersOnly||(0,r.maybe_call)(De.hidden,this,q,null,s,i,e))continue;if(pe.type==="dynamic"){const Ue=De.dynamicAppearance&&De.dynamicAppearance.call(this,Object.assign({},pe),q,null,s,i,e);Ue&&(pe=Ue)}if(De.override_appearance){const Ue=De.override_appearance.call(this,Object.assign({},pe),q,null,s,i,e);Ue&&(pe=Ue)}const Ae=this.renderers[pe.type];if(!Ae)continue;const ye=Ae.colored&&pe.color,Ie=(0,r.maybe_call)(De.disabled,this,q,null,s,i,e)||!1,Fe=ye&&(g&&g.colors?g.colors.process(pe.color):pe.color),je=Ae.render.call(this,pe,o,Fe);E||h.push(E=[]),E.push(o("button",{class:`ffz-tooltip tw-pd-x-05 mod-icon ffz-mod-icon tw-c-text-alt-2${Ie?" disabled":""}${ye?" colored":""}`,"data-tooltip-type":"action","data-action":q.action,"data-options":q.options?JSON.stringify(q.options):null,"data-tip":pe.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},je))}if(!h.length)return null;const R=s&&JSON.stringify(s),T=h.length>1,L=T?h.map((q,le)=>o("div",{key:le,class:"tw-flex tw-full-width tw-flex-row tw-flex-wrap"},q)):h[0];return o("div",{class:`ffz--room-actions${T?" tw-flex-column":""} ffz-action-data tw-flex tw-flex-grow-1 tw-flex-wrap tw-align-items-center ${n?"tw-pd-y-05 tw-border-t":"tw-mg-x-05"}`,"data-room":R},L)}renderUserContext(e,i){const s=this.resolve("site.fine"),n=this.resolve("site"),o=this.resolve("site.chat"),h=s&&s.searchParent(e,ye=>ye.props&&ye.props.message),g=h?.props?.message;if(!g||!n||!o)return;let E=g.roomLogin?g.roomLogin:g.channel?g.channel.slice(1):void 0;if(!E&&h.props.channelID){const ye=this.parent.getRoom(h.props.channelID,null,!0);ye&&ye.login&&(E=g.roomLogin=ye.login)}const R=n.getUser(),T={id:h.props.channelID,login:E},L=!!(h.props.hasReply||h.props.reply||!h.props.replyRestrictedReason),q=L&&g.message&&!g.deleted&&!h.props.disableReplyClick,le=q&&(L||R&&R.login!==g.user?.login);g.roomId=T.id,R&&(R.moderator=h.props.isCurrentUserModerator,R.staff=h.props.isCurrentUserStaff,R.reply_mode=this.parent.context.get("chat.replies.style"),R.can_reply=le);const pe=this.getUserLevel(T,R),fe=this.getUserLevel(T,g.user);let De=h.props.showModerationIcons;pe<3&&(De=!1);const Ae=h;return this.renderPopup(e,(ye,Ie)=>{const Fe=[];let je=null;const Ue=B(ct=>{this.handleClick(ct,je),Ie.hide()},"handle_click");for(const ct of i){if(!ct)continue;if(ct.ctx="user_context",ct.type==="new-line"){je=null;continue}else if(ct.type==="space-small"){je||Fe.push(je=[]),je.push((0,re.createElement)("div",{class:"tw-pd-x-1"}));continue}else if(ct.type==="space"){je||Fe.push(je=[]),je.push((0,re.createElement)("div",{class:"tw-flex-grow-1"}));continue}else if(!ct.action||!ct.appearance)continue;let yt=ct.appearance||{};const Qe=ct.display||{},bt=this.actions[ct.action];if(!bt||Qe.disabled||Qe.mod_icons!=null&&Qe.mod_icons!==!!De||Qe.mod!=null&&Qe.mod!==pe>fe||Qe.staff!=null&&Qe.staff!==(R?!!R.staff:!1)||Qe.deleted!=null&&Qe.deleted!==!!g.deleted||(0,r.maybe_call)(bt.hidden,this,ct,g,T,R,De,Ae))continue;if(yt.type==="dynamic"){const Zt=bt.dynamicAppearance&&bt.dynamicAppearance.call(this,Object.assign({},yt),ct,g,T,R,De,Ae);Zt&&(yt=Zt)}if(bt.override_appearance){const Zt=bt.override_appearance.call(this,Object.assign({},yt),ct,g,T,R,De,Ae);Zt&&(yt=Zt)}const Ct=this.renderers[yt.type];if(!Ct)continue;const Yt=Ct.colored&&yt.color,ci=(0,r.maybe_call)(bt.disabled,this,ct,g,T,R,De,Ae)||!1,pi=Yt&&(o&&o.colors?o.colors.process(yt.color):yt.color),Ti=Ct.render.call(this,yt,re.createElement,pi);je||Fe.push(je=[]);const mi=(0,re.createElement)("button",{class:`ffz-tooltip ffz-tooltip--no-mouse tw-button tw-button--text${ci?" tw-button--disabled disabled":""}`,"data-tooltip-type":"action","data-action":ct.action,"data-options":ct.options?JSON.stringify(ct.options):null,onClick:Ue,onContextMenu:this.handleContext},(0,re.createElement)("span",{class:"tw-button__text"},Ti));yt.tooltip&&(mi.dataset.tip=yt.tooltip),je.push(mi)}const Je=(0,re.createElement)("div",{class:"ffz-action-data tw-pd-05","data-source":"msg"},(0,re.createElement)("div",{class:"tw-pd-b-05 tw-border-b"},(0,re.createElement)("strong",null,g.user.displayName||g.user.login),"..."),Fe.map(ct=>!ct||!ct.length?null:(0,re.createElement)("div",{class:"tw-flex tw-flex-no-wrap"},ct)));return Je.ffz_message=g,Je.ffz_line=Ae,Je})}renderHover(e,i,s,n,o,h=null){const g=[],E=this.getUserLevel(n,s),R=this.getUserLevel(n,e.user),T=e.user&&s&&s.login===e.user.login;E<3&&(i=!1);const L=this.resolve("site.chat");let q=!1;for(const le of this.parent.context.get("chat.actions.hover")){if(!le.action||!le.appearance)continue;le.ctx="hover";let pe=le.appearance||{};const fe=le.display||{},De=fe.keys,Ae=this.actions[le.action];if(!Ae||fe.disabled||fe.mod_icons!=null&&fe.mod_icons!==!!i||fe.mod!=null&&fe.mod!==E>R||fe.staff!=null&&fe.staff!==(s?!!s.staff:!1)||fe.deleted!=null&&fe.deleted!==!!e.deleted||T&&!Ae.can_self||(0,r.maybe_call)(Ae.hidden,this,le,e,n,s,i,h))continue;if(pe.type==="dynamic"){const Je=Ae.dynamicAppearance&&Ae.dynamicAppearance.call(this,Object.assign({},pe),le,e,n,s,i,h);Je&&(pe=Je)}if(Ae.override_appearance){const Je=Ae.override_appearance.call(this,Object.assign({},pe),le,e,n,s,i,h);Je&&(pe=Je)}const ye=this.renderers[pe.type];if(!ye)continue;const Ie=ye.colored&&pe.color,Fe=(0,r.maybe_call)(Ae.disabled,this,le,e,n,s,i,h)||!1,je=Ie&&(L&&L.colors?L.colors.process(pe.color):pe.color),Ue=ye.render.call(this,pe,o,je);q=!0,g.push(o("div",{class:`ffz-hover-action${De?` ffz-has-modifier ffz-modifier-${De}`:""}`},o("button",{class:`ffz-tooltip ffz-mod-icon tw-c-text-alt-2${Fe?" disabled":""}${Ie?" colored":""}`,"data-tooltip-type":"action","data-action":le.action,"data-options":le.options?JSON.stringify(le.options):null,"data-tip":pe.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},Ue)))}return q?o("div",{class:"ffz--hover-actions ffz-action-data tw-mg-r-05","data-source":"line"},g):null}renderInline(e,i,s,n,o,h=null){const g=[],E=this.getUserLevel(n,s),R=this.getUserLevel(n,e.user),T=e.user&&s&&s.login===e.user.login;E<3&&(i=!1);const L=this.resolve("site.chat"),q=[];let le=!1;for(const fe of this.parent.context.get("chat.actions.inline")){if(!fe.action||!fe.appearance)continue;fe.ctx="inline";let De=fe.appearance||{};const Ae=fe.display||{},ye=Ae.keys,Ie=Ae.hover,Fe=this.actions[fe.action];if(!Fe||Ae.disabled||Ae.mod_icons!=null&&Ae.mod_icons!==!!i||Ae.mod!=null&&Ae.mod!==E>R||Ae.staff!=null&&Ae.staff!==(s?!!s.staff:!1)||Ae.deleted!=null&&Ae.deleted!==!!e.deleted||T&&!Fe.can_self||(0,r.maybe_call)(Fe.hidden,this,fe,e,n,s,i,h))continue;if(De.type==="dynamic"){const bt=Fe.dynamicAppearance&&Fe.dynamicAppearance.call(this,Object.assign({},De),fe,e,n,s,i,h);bt&&(De=bt)}if(Fe.override_appearance){const bt=Fe.override_appearance.call(this,Object.assign({},De),fe,e,n,s,i,h);bt&&(De=bt)}const je=this.renderers[De.type];if(!je)continue;const Ue=je.colored&&De.color,Je=(0,r.maybe_call)(Fe.disabled,this,fe,e,n,s,i,h)||!1,ct=Ue&&(L&&L.colors?L.colors.process(De.color):De.color),yt=je.render.call(this,De,o,ct);let Qe=g;(ye||Ie)&&(Qe=q),le=!0,Qe.push(o("button",{class:`ffz-tooltip mod-icon ffz-mod-icon tw-c-text-alt-2${Je?" disabled":""}${Ue?" colored":""}${ye?` ffz-modifier-${ye}`:""}${Ie?" ffz-hover":""}`,"data-tooltip-type":"action","data-action":fe.action,"data-options":fe.options?JSON.stringify(fe.options):null,"data-tip":De.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},yt))}if(!le)return null;let pe=null;if(g.length&&(pe=o("div",{class:"ffz--inline-actions ffz-action-data tw-inline-block tw-mg-r-05","data-source":"line"},g)),q.length){const fe=o("div",{class:"ffz--inline-actions ffz--modifier-actions ffz-action-data","data-source":"line"},q);return pe?[pe,fe]:fe}return pe}getData(e){const i=e.dataset,s=e.closest(".ffz-action-data"),n=s&&s.dataset,o=i&&i.action,h=this.actions[o];if(!h)return null;let g,E,R,T=!1,L;if(n){if(n.source==="msg"&&s.ffz_message){const le=s.ffz_message;L=s.ffz_line,T=!0,g=le.user?{color:le.user.color,id:le.user.id,login:le.user.login,displayName:le.user.displayName,type:le.user.type}:null,E={login:le.roomLogin,id:le.roomId},R={id:le.id,text:le.message}}else if(n.source==="line"){const le=this.resolve("site.fine");if(L=le&&le.searchParent(s,pe=>pe.props&&pe.props.message),L&&L.props&&L.props.message){T=!0;const pe=L.props.message;g=pe.user?{color:pe.user.color,id:pe.user.id,login:pe.user.login,displayName:pe.user.displayName,type:pe.user.type}:null,E={login:L.props.channelLogin,id:L.props.channelID},R={id:pe.id,text:pe.message}}}T||(g=n.user?JSON.parse(n.user):null,E=n.room?JSON.parse(n.room):null,R=n.message?JSON.parse(n.message):n.msgId?{id:n.msgId}:null)}const q={action:o,definition:h,tip:i.tip,options:i.options?JSON.parse(i.options):null,user:g,room:E,message:R,message_id:R?R.id:null,line:L};return h.defaults&&(q.options=Object.assign({},(0,r.maybe_call)(h.defaults,this,q,e),q.options)),q}handleClick(e){const i=e.target,s=this.getData(i);if(s&&!i.classList.contains("disabled"))return s.definition.click?(i._ffz_tooltip&&i._ffz_tooltip.hide(),s.definition.click.call(this,e,s)):s.definition.context?this.handleContext(e):this.log.warn(`No click handler for action provider "${s.action}"`)}handleContext(e){if(e.shiftKey)return;e.preventDefault();const i=e.target,s=this.getData(e.target);s&&(i.classList.contains("disabled")||(i._ffz_tooltip&&i._ffz_tooltip.hide(),!(!s.definition.context&&!s.definition.uses_reason)&&this.renderInlineContext(i,s)))}handleUserContext(e){if(e.shiftKey)return;const i=this.parent.context.get("chat.actions.user-context");if(!Array.isArray(i)||!i.length)return;e.preventDefault();const s=e.target;s._ffz_tooltip&&s._ffz_tooltip.hide(),this.renderUserContext(s,i)}pasteMessage(e,i){return this.resolve("site.chat.input").pasteMessage(e,i)}addNotice(e,i){return this.resolve("site.chat").addNotice(e,i)}sendMessage(e,i){return this.resolve("site.chat").sendMessage(e,i)}};B(Ds,"Actions");let ts=Ds;function is(k){return k.sort((e,i)=>e[0]<i[0]?1:e[0]>i[0]?-1:!e[1]&&i[1]?1:e[1]&&!i[1]?-1:0),k}B(is,"sortPriorityColorTerms");const or=["g","gi"],Ws=["filter_test"];function Hi(k){const e=[];for(let i=0;i<k.length;i++){const s=k[i];s[0].length&&s[1].push((0,r.addWordSeparators)(s[0].join("|"))),e.push(s[1].length?new RegExp(s[1].join("|"),or[i]||"gi"):null)}return e}B(Hi,"formatTerms");const ar="https://static-cdn.jtvnw.net/emoticons/v1/58765/2.0",lr=/[ .,!]/,Gs=["gif emotes","gif emoticons","gifs"],Ts=class Ts extends d.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("i18n"),this.inject("tooltips"),this.inject("experiments"),this.inject("staging"),this.inject("load_tracker"),this.inject(Ki),this.inject(Xi),this.inject(Ji.ZP),this.inject(ts),this.inject("overrides",Qi),this._link_info={},this.clickToReveal=this.clickToReveal.bind(this),this.handleLinkClick=this.handleLinkClick.bind(this),this.handleMentionClick=this.handleMentionClick.bind(this),this.handleReplyClick=this.handleReplyClick.bind(this),this.style=new re.ManagedStyle,this.context=this.settings.context({}),this.CommandPrefixes=new r.SourcedSet(!0),this.CommandPrefixes.set("ffz",["/","!"]),this.rooms={},this.users={},this.room_ids={},this.user_ids={},this.tokenizers={},this.__tokenizers=[],this.rich_providers={},this.__rich_providers=[],this.link_providers={},this.__link_providers=[],this._hl_reasons={},this.addHighlightReason("mention","Mentioned","Mention"),this.addHighlightReason("user","Highlight User","User"),this.addHighlightReason("badge","Highlight Badge","Badge"),this.addHighlightReason("term","Highlight Term","Term"),this.settings.add("debug.link-resolver.source",{process:(n,o)=>f.LINK_DATA_HOSTS[o]??f.LINK_DATA_HOSTS.Production,default:null,ui:{path:"Debugging > Data Sources >> Links",title:"Link Resolver",component:"setting-select-box",force_seen:!0,data:[{value:null,title:"Automatic"}].concat(Object.entries(f.LINK_DATA_HOSTS).map(n=>({value:n[0],title:n[1].title})))},changed:()=>this.clearLinkCache()}),this.settings.addUI("debug.link-resolver.test",{path:"Debugging > Data Sources >> Links",component:"link-tester",getChat:()=>this,force_seen:!0}),this.settings.add("chat.timestamp-size",{default:null,ui:{path:"Chat > Appearance >> General",title:"Timestamp Font Size",description:"How large should timestamps be, in pixels. Defaults to Font Size if not set.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.font-size",{default:13,ui:{path:"Chat > Appearance >> General",title:"Font Size",description:"How large should text in chat be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.font-family",{default:"",ui:{path:"Chat > Appearance >> General",title:"Font Family",description:"Set the font used for displaying chat messages.",component:"setting-combo-box",data:()=>(0,Ci.R7)()}}),this.settings.add("chat.name-format",{default:0,ui:{path:"Chat > Appearance >> Usernames",title:"Display Style",description:"Change how usernames are displayed in chat when users have an international display name set.",component:"setting-select-box",data:[{value:0,title:"International Name (Username) <Default>"},{value:1,title:"International Name"},{value:2,title:"Username"}]}}),this.settings.add("chat.lines.emote-alignment",{default:0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Emote Alignment",description:"Change how emotes are positioned in chat, potentially making messages taller in order to avoid having emotes overlap.",component:"setting-select-box",data:[{value:0,title:"Standard"},{value:1,title:"Padded"},{value:2,title:"Baseline (BTTV-Like)"}]}}),this.settings.add("chat.rich.enabled",{default:!0,ui:{path:"Chat > Appearance >> Rich Content",title:"Display rich content in chat.",description:"This displays rich content blocks for things like linked clips and videos.",component:"setting-check-box"}}),this.settings.add("chat.rich.want-mid",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Display larger rich content in chat.",description:`This enables the use of bigger rich content embeds in chat. This is **not** recommended for most users and/or chats.

**Note:** Enabling this may cause chat to scroll at inopportune times due to content loading. Moderators should not use this feature.`,component:"setting-check-box"}}),this.settings.add("chat.rich.hide-tokens",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Hide matching links for rich content.",component:"setting-check-box"}}),this.settings.add("chat.rich.all-links",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Display rich content embeds for all links.",description:"*Streamers: Please be aware that this is a potential vector for NSFW imagery via thumbnails, so be mindful when capturing chat with this enabled.*",component:"setting-check-box",extra:{component:"chat-rich-example",getChat:()=>this}}}),this.settings.add("chat.rich.minimum-level",{default:0,ui:{path:"Chat > Appearance >> Rich Content",title:"Required User Level",description:"Only display rich content embeds on messages posted by users with this level or higher.",component:"setting-select-box",data:[{value:4,title:"Broadcaster"},{value:3,title:"Moderator"},{value:2,title:"VIP"},{value:1,title:"Subscriber"},{value:0,title:"Everyone"}]}}),this.settings.add("chat.scrollback-length",{default:150,ui:{path:"Chat > Behavior >> General",title:"Scrollback Length",description:"Keep up to this many lines in chat. Setting this too high will create lag.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.filtering.debug",{default:!1,ui:{path:"Chat > Filtering > General >> Behavior",title:"Display a list of highlight reasons on every chat message for debugging.",component:"setting-check-box",force_seen:!0}}),this.settings.addUI("chat.filtering.pad-bottom",{path:"Chat > Filtering > Highlight",sort:1e3,component:"setting-spacer",top:"30rem",force_seen:!0}),this.settings.add("chat.filtering.click-to-reveal",{default:!1,ui:{path:'Chat > Filtering > General @{"sort":-1} >> Behavior',title:"Click to reveal deleted terms.",component:"setting-check-box"}}),this.settings.add("chat.filtering.deleted-style",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Detailed Message Style",description:"This style will be applied to deleted messages showed in Detailed rendering mode to differentiate them from normal chat messages.",component:"setting-select-box",data:[{value:0,title:"Faded"},{value:1,title:"Faded, Line Through"},{value:2,title:"Line Through"},{value:3,title:"No Change"}]}}),this.settings.add("chat.filtering.display-deleted",{default:!1,ui:{path:"Chat > Behavior >> Deleted Messages",sort:-1,title:"Rendering Mode",description:"This, when set, overrides the `Deleted Messages` mode selected in Twitch chat settings, which is normally only accessible for moderators. Brief hides messages entirely and shows a notice in chat that a number of messages were hidden. Detailed shows the contents of the message. Legacy shows `<message deleted>` with click to reveal.",component:"setting-select-box",data:[{value:!1,title:"Do Not Override"},{value:"BRIEF",title:"Brief"},{value:"DETAILED",title:"Detailed"},{value:"LEGACY",title:"Legacy"}]}}),this.settings.add("chat.filtering.display-mod-action",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Display Reason",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"In Detailed Mode"},{value:2,title:"Always"}]}}),this.settings.add("chat.automod.delete-messages",{default:!0,ui:{path:'Chat > Filtering > General >> AutoMod Filters @{"description": "Extra configuration for Twitch\'s native `Chat Filters`."}',title:"Mark messages as deleted if they contain filtered phrases.",component:"setting-check-box"}}),this.settings.add("chat.automod.remove-messages",{default:!0,ui:{path:"Chat > Filtering > General >> AutoMod Filters",title:"Remove messages entirely if they contain filtered phrases.",component:"setting-check-box"}}),this.settings.add("chat.automod.run-as-mod",{default:!1,ui:{path:"Chat > Filtering > General >> AutoMod Filters",title:"Use Chat Filters as a moderator.",description:"By default, Twitch's Chat Filters feature does not function for moderators. This overrides that behavior.",component:"setting-check-box"}}),this.settings.add("chat.filtering.process-own",{default:!1,ui:{path:"Chat > Filtering > General >> Behavior",title:"Filter your own messages.",component:"setting-check-box"}}),this.settings.add("chat.filtering.ignore-clear",{default:!1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Do not Clear Chat when commanded to.",component:"setting-check-box"}}),this.settings.add("chat.filtering.remove-deleted",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Remove deleted messages from chat.",description:"Deleted messages will be removed from chat entirely. This setting is not recommended for moderators.",component:"setting-select-box",data:[{value:0,title:"Do Not Remove"},{value:1,title:"Remove Unseen (Default)"},{value:2,title:"Remove Unseen as Moderator"},{value:3,title:"Remove All"}]}}),this.settings.add("chat.delay",{default:-1,ui:{path:"Chat > Behavior >> General",title:"Artificial Chat Delay",description:"Delay the appearance of chat messages to allow for moderation before you see them.",component:"setting-select-box",data:[{value:-1,title:"Default Delay (Room Specific; Non-Mod Only)"},{value:0,title:"No Delay"},{value:300,title:"Minor (Bot Moderation; 0.3s)"},{value:1200,title:"Normal (Human Moderation; 1.2s)"},{value:5e3,title:"Large (Spoiler Removal / Slow Mods; 5s)"},{value:1e4,title:"Extra Large (10s)"},{value:15e3,title:"Extremely Large (15s)"},{value:2e4,title:"Mods Asleep; Delay Chat (20s)"},{value:3e4,title:"Half a Minute (30s)"},{value:6e4,title:"Why??? (1m)"},{value:7884e8,title:"The CBenni Option (Literally 25 Years)"}]}}),this.settings.add("chat.filtering.hidden-tokens",{default:[],type:"array_merge",always_inherit:!0,process(n,o){const h=new Set;for(const g of o)(g?.v||!Ws.includes(g.v))&&h.add(g.v);return h},ui:{path:'Chat > Appearance >> Hidden Token Types @{"description":"This filter allows you to prevent specific content token types from appearing chat messages, such as hiding all cheers or emotes."}',component:"blocked-types",data:()=>Object.keys(this.tokenizers).filter(n=>!Ws.includes(n)&&this.tokenizers[n]?.render).sort()}}),this.settings.add("chat.filtering.highlight-basic-users",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Highlight @{"description": "These settings allow you to highlight messages in chat based on their contents. Setting priorities on rules allows you to determine which highlight color should be applied if a message matches multiple rules. Rules with a higher priority take priority over rules with lower priorities.\\n\\nYou can also create a rule that removes highlights from messages, preventing lower priority rules from highlighting them, by setting a color with an alpha value of zero. Example: `#00000000`"} >> Users',component:"basic-terms",colored:!0,words:!1,priority:!0}}),this.settings.add("__filter:highlight-users",{requires:["chat.filtering.highlight-basic-users"],equals:"requirements",process(n){const o=n.get("chat.filtering.highlight-basic-users");if(!o||!o.length)return null;const h=new Map;for(const E of o){const R=E.p||0,T=E.t;let L=E.c||null,q=E.v;if(T==="glob"?q=(0,r.glob_to_regex)(q):T!=="raw"&&(q=(0,r.escape_regex)(q)),!q||!q.length)continue;try{new RegExp(q)}catch{continue}let le=h.get(R);if(le||(le=new Map,h.set(R,le)),L){const pe=Mt.Color.RGBA.fromCSS(L);(!pe||!pe.a)&&(L=!1)}le.has(L)?le.get(L).push(q):le.set(L,[q])}const g=[];for(const[E,R]of h)for(const[T,L]of R)g.push([E,T,new RegExp(`^(?:${L.join("|")})$`,"gi")]);return is(g)}}),this.settings.add("chat.filtering.highlight-basic-users-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering > Block >> Users",component:"basic-terms",removable:!0,words:!1}}),this.settings.add("__filter:block-users",{requires:["chat.filtering.highlight-basic-users-blocked"],equals:"requirements",process(n){const o=n.get("chat.filtering.highlight-basic-users-blocked");if(!o||!o.length)return null;const h=[[],[]];for(const g of o){const E=g.t;let R=g.v;E==="glob"?R=(0,r.glob_to_regex)(R):E!=="raw"&&(R=(0,r.escape_regex)(R)),!(!R||!R.length)&&h[g.remove?1:0].push(R)}return h.map(g=>g.length?new RegExp(`^(?:${g.join("|")})$`,"i"):null)}}),this.settings.add("chat.filtering.highlight-basic-badges",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering > Highlight >> Badges",component:"badge-highlighting",colored:!0,priority:!0,data:()=>this.badges.getSettingsBadges(!0)}}),this.settings.add("__filter:highlight-badges",{requires:["chat.filtering.highlight-basic-badges"],equals:"requirements",process(n){const o=n.get("chat.filtering.highlight-basic-badges");if(!o||!o.length)return null;const h=new Map;for(const g of o){let E=g.c||null;const R=g.p||0,T=g.v;if(E){const q=Mt.Color.RGBA.fromCSS(E);(!q||!q.a)&&(E=!1)}const L=h.get(T);(!L||L[0]<R||E&&!L[1]&&L[0]<=R)&&h.set(T,[R,E])}return h}}),this.settings.add("chat.filtering.highlight-basic-badges-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Block >> Badges @{"description": "**Note:** This section is for filtering messages out of chat from users with specific badges. If you wish to hide a badge, go to [Chat > Badges >> Visibility](~chat.badges.tabs.visibility)."}',component:"badge-highlighting",removable:!0,data:()=>this.badges.getSettingsBadges(!0)}}),this.settings.add("__filter:block-badges",{requires:["chat.filtering.highlight-basic-badges-blocked"],equals:"requirements",process(n){const o=n.get("chat.filtering.highlight-basic-badges-blocked");if(!o||!o.length)return null;const h=[[],[]];for(const g of o)g.v&&h[g.remove?1:0].push(g.v);return!h[0].length&&!h[1].length?null:h}}),this.settings.add("chat.filtering.highlight-basic-terms",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Highlight >> Terms @{"description": "Please see [Chat > Filtering > Syntax Help](~) for details on how to use terms."}',component:"basic-terms",colored:!0,priority:!0,highlight:!0}}),this.settings.add("__filter:highlight-terms",{requires:["chat.filtering.highlight-tokens","chat.filtering.highlight-basic-terms"],equals:"requirements",process(n){const o=n.get("chat.filtering.highlight-tokens"),h=n.get("chat.filtering.highlight-basic-terms");if(!h||!h.length)return null;const g=new Map;let E=!1,R=!1;for(const L of h){const q=L.p||0,le=o&&((0,r.has)(L,"h")?L.h:!0),pe=L.s,fe=L.t,De=(0,r.has)(L,"w")?L.w:fe!=="raw";let Ae=L.c||null,ye=L.v;if(fe==="glob"?ye=(0,r.glob_to_regex)(ye):fe!=="regex"&&fe!=="raw"&&(ye=(0,r.escape_regex)(ye)),!ye||!ye.length)continue;try{new RegExp(ye)}catch{continue}le?E=!0:R=!0;let Ie=g.get(q);if(Ie||(Ie=new Map,g.set(q,Ie)),Ae){const je=Mt.Color.RGBA.fromCSS(Ae);(!je||!je.a)&&(Ae=!1)}let Fe=Ie.get(Ae);Fe||Ie.set(Ae,Fe=[[[[],[]],[[],[]]],[[[],[]],[[],[]]]]),Fe[le?0:1][pe?0:1][De?0:1].push(ye)}if(!E&&!R)return null;const T={hl:E?[]:null,non:R?[]:null};for(const[L,q]of g)for(const[le,pe]of q){const fe=Hi(pe[0]),De=Hi(pe[1]);(fe[0]||fe[1])&&T.hl.push([L,le,fe]),(De[0]||De[1])&&T.non.push([L,le,De])}return E&&is(T.hl),R&&is(T.non),T}}),this.settings.add("chat.filtering.highlight-basic-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Block >> Terms @{"description": "Please see [Chat > Filtering > Syntax Help](~) for details on how to use terms."}',component:"basic-terms",removable:!0}}),this.settings.add("__filter:block-terms",{requires:["chat.filtering.highlight-basic-blocked"],equals:"requirements",process(n){const o=n.get("chat.filtering.highlight-basic-blocked");if(!o||!o.length)return null;const h=[[[[],[]],[[],[]]],[[[],[]],[[],[]]]];let g=!1,E=!1;for(const R of o){const T=R.t,L=R.s,q=(0,r.has)(R,"w")?R.w:T!=="raw";let le=R.v;T==="glob"?le=(0,r.glob_to_regex)(le):T!=="regex"&&T!=="raw"&&(le=(0,r.escape_regex)(le)),!(!le||!le.length)&&(R.remove?g=!0:E=!0,h[R.remove?1:0][L?0:1][q?0:1].push(le))}return!g&&!E?null:{remove:g?Hi(h[1]):null,non:E?Hi(h[0]):null}}}),this.settings.add("chat.filtering.clickable-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Viewer Cards >> Behavior",title:"Enable opening viewer cards by clicking mentions in chat."}}),this.settings.add("chat.filtering.all-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Filtering > General >> Appearance",title:"Display mentions for all users without requiring an at sign (@).",description:"**Note**: This setting can increase memory usage and impact chat performance."}}),this.settings.add("chat.filtering.color-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Filtering > General >> Appearance",title:"Display mentions in chat with username colors.",description:"**Note:** Not compatible with color overrides as mentions do not include user IDs."}}),this.settings.add("chat.filtering.need-colors",{requires:["chat.filtering.all-mentions","chat.filtering.color-mentions"],process(n){return n.get("chat.filtering.all-mentions")||n.get("chat.filtering.color-mentions")}}),this.settings.add("chat.filtering.bold-mentions",{default:!0,ui:{component:"setting-check-box",path:"Chat > Filtering > General >> Appearance",title:"Display mentions in chat with a bold font."}}),this.settings.add("chat.filtering.mention-priority",{default:0,ui:{path:"Chat > Filtering > General >> Appearance",title:"Mention Priority",component:"setting-text-box",type:"number",process:"to_int",description:"Mentions of your name have this priority for the purpose of highlighting. See [Chat > Filtering > Highlight](~chat.filtering.highlight) for more details."}}),this.settings.add("chat.filtering.mention-color",{default:"",ui:{path:"Chat > Filtering > General >> Appearance",title:"Custom Highlight Color",component:"setting-color-box",description:"If this is set, highlighted messages with no default color set will use this color rather than red."}}),this.settings.add("chat.filtering.highlight-mentions",{default:!1,ui:{path:"Chat > Filtering > General >> Appearance",title:"Highlight messages that mention you.",component:"setting-check-box"}}),this.settings.add("chat.filtering.highlight-tokens",{default:!1,ui:{path:"Chat > Filtering > General >> Appearance",title:"Highlight matched words in chat.",component:"setting-check-box"}}),this.settings.add("tooltip.images",{default:!0,ui:{path:'Chat > Tooltips >> General @{"sort": -1}',title:"Display images in tooltips.",component:"setting-check-box"}}),this.settings.add("tooltip.badge-images",{default:!0,requires:["tooltip.images"],process(n,o){return n.get("tooltip.images")?o:!1},ui:{path:"Chat > Tooltips >> Badges",title:"Display large images of badges.",component:"setting-check-box"}}),this.settings.add("tooltip.emote-sources",{default:!0,ui:{path:"Chat > Tooltips >> Emotes",title:"Display known sources.",component:"setting-check-box"}}),this.settings.add("tooltip.emote-images",{default:!0,requires:["tooltip.images"],process(n,o){return n.get("tooltip.images")?o:!1},ui:{path:"Chat > Tooltips >> Emotes",title:"Display large images of emotes.",component:"setting-check-box"}}),this.settings.add("tooltip.rich-links",{default:!0,ui:{sort:-1,path:"Chat > Tooltips >> Links",title:"Display rich tooltips for links.",component:"setting-check-box",extra:{component:"chat-tooltip-example"}}}),this.settings.add("tooltip.link-interaction",{default:!0,ui:{path:"Chat > Tooltips >> Links",title:"Allow interaction with supported link tooltips.",component:"setting-check-box"}}),this.settings.add("tooltip.link-images",{default:!0,requires:["tooltip.images"],process(n,o){return n.get("tooltip.images")?o:!1},ui:{path:"Chat > Tooltips >> Links",title:"Display images for links.",component:"setting-check-box"}}),this.settings.add("tooltip.link-nsfw-images",{default:!1,ui:{path:"Chat > Tooltips >> Links",title:"Display potentially NSFW images.",description:"When enabled, FrankerFaceZ will include images that are tagged as unsafe or that are not rated.",component:"setting-check-box"}});for(const[n,o]of Object.entries(f.RESOLVERS_REQUIRE_TOS))this.settings.addUI(`tooltip.tos.${n}`,{path:'Chat > Tooltips >> Terms of Service @{"description": "The following services require you to agree to their Terms of Service before we can show you information from their platforms."}',component:"tooltip-tos",item:n,override_setting:"agreed-tos",getChat:()=>this,data:(0,r.deep_copy)(o),onUIChange:()=>this.emit(":update-link-resolver")});this.settings.add("chat.adjustment-mode",{default:null,process(n,o){return o??(n.get("ls.useHighContrastColors")??!0?1:0)},requires:["ls.useHighContrastColors"],ui:{path:"Chat > Appearance >> Colors",title:"Adjustment",description:"Alter user colors to ensure that they remain readable.",default(n){return n.get("ls.useHighContrastColors")??!0?1:0},component:"setting-select-box",data:[{value:-1,title:"No Color"},{value:0,title:"Unchanged"},{value:1,title:"HSL Luma"},{value:2,title:"Luv Luma"},{value:3,title:"HSL Loop (BTTV-Like)"},{value:4,title:"RGB Loop (Deprecated)"}]}}),this.settings.add("chat.adjustment-contrast",{default:4.5,ui:{path:"Chat > Appearance >> Colors",title:"Minimum Contrast",description:"Set the minimum contrast ratio used by Luma adjustments when determining readability.",component:"setting-text-box",process:"to_float"}}),this.settings.add("chat.me-style",{default:2,ui:{path:"Chat > Appearance >> Chat Lines",title:"Action Style",description:"When someone uses `/me`, the message will be rendered in this style.",component:"setting-select-box",data:[{value:0,title:"No Style"},{value:1,title:"Colorized (Old Style)"},{value:2,title:"Italic (New Style)"},{value:3,title:"Colorized Italic"}]}}),this.settings.add("chat.bits.stack",{default:0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Cheer Stacking",description:"Collect all the cheers in a message into a single cheer at the start of the message.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Grouped by Type"},{value:2,title:"All in One"}]}}),this.settings.add("chat.emotes.animated",{default:null,requires:["ls.emoteAnimationsEnabled"],process(n,o){return o??(n.get("ls.emoteAnimationsEnabled")??!0?1:0)},ui:{path:"Chat > Appearance >> Emotes",sort:-50,title:"Animated Emotes",default(n){return n.get("ls.emoteAnimationsEnabled")??!0?1:0},getExtraTerms:()=>Gs,description:"This controls whether or not animated emotes are allowed to play in chat. When this is `Disabled`, emotes will appear as static images. Setting this to `Enable on Hover` may cause performance issues.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enable on Hover"}]}}),this.settings.add("tooltip.emote-images.animated",{requires:["chat.emotes.animated"],default:null,process(n,o){return o==null&&(o=!!n.get("chat.emotes.animated")),o},ui:{path:"Chat > Tooltips >> Emotes",title:"Display animated images of emotes.",getExtraTerms:()=>Gs,description:"If this is not overridden, animated images are only shown in emote tool-tips if [Chat > Appearance >> Emotes > Animated Emotes](~chat.appearance.emotes) is not disabled.",component:"setting-check-box"}}),this.settings.add("chat.bits.animated",{default:!0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Display animated cheers.",component:"setting-check-box"}});const i=new Date(0).toLocaleTimeString().toUpperCase(),s=i.lastIndexOf("PM")===-1&&i.lastIndexOf("AM")===-1;this.settings.add("chat.timestamp-format",{default:s?"H:mm":"h:mm",ui:{path:"Chat > Appearance >> Chat Lines",title:"Timestamp Format",component:"setting-combo-box",description:"Timestamps are formatted using the [Day.js](https://github.com/iamkun/dayjs#readme) library. More details about formatting strings [can be found here](https://github.com/iamkun/dayjs/blob/HEAD/docs/en/API-reference.md#list-of-all-available-formats)",data:[{value:"h:mm",title:"12 Hour"},{value:"h:mm:ss",title:"12 Hour with Seconds"},{value:"H:mm",title:"24 Hour"},{value:"H:mm:ss",title:"24 Hour with Seconds"},{value:"hh:mm",title:"Padded"},{value:"hh:mm:ss",title:"Padded with Seconds"},{value:"HH:mm",title:"Padded 24 Hour"},{value:"HH:mm:ss",title:"Padded 24 Hour with Seconds"}]}}),this.context.on("changed:theme.is-dark",()=>{for(const n of this.iterateRooms())n.buildBitsCSS()}),this.context.on("changed:chat.bits.animated",()=>{for(const n of this.iterateRooms())n.buildBitsCSS()}),this.context.on("changed:chat.filtering.need-colors",async n=>{n?await this.createColorCache():this.color_cache=null,this.emit(":update-line-tokens")}),this.context.on("changed:chat.filtering.all-mentions",()=>this.emit(":update-line-tokens")),this.context.on("changed:chat.filtering.color-mentions",()=>this.emit(":update-line-tokens"))}async createColorCache(){const e=await X(4866);this.color_cache=new e(150)}generateLog(){const e=["chat settings","-------------------------------------------------------------------------------"];for(const[i,s]of this.context.__cache.entries())e.push(`${i}: ${JSON.stringify(s)}`);return e.join(`
`)}getAddonProxy(e,i,s){if(!e)return this;const n=f.DEBUG||i?.dev,o=(0,r.makeAddonIdChecker)(e),h={},g={},E=(0,d.buildAddonProxy)(s,null,"getUser()",{addBadge:n?function(T,...L){return o.test(T)||s.log.warn("[DEV-CHECK] Call to getUser().addBadge() did not include addon ID in provider:",T),this.addBadge(T,...L)}:void 0,removeBadge:n?function(T,...L){return o.test(T)||s.log.warn("[DEV-CHECK] Call to getUser().removeBadge() did not include addon ID in provider:",T),this.removeBadge(T,...L)}:void 0,addSet(T,L,q){return n&&!o.test(T)&&s.log.warn("[DEV-CHECK] Call to getUser().addSet() did not include addon ID in provider:",T),this.manager.emotes.providers.has(T)||(this.manager.emotes.inferProvider(T,e),n&&s.log.warn("[DEV-CHECK] Call to getUser().addSet() for provider that has not been registered with emotes.setProvider:",T)),q&&(n&&!o.test(L)&&s.log.warn("[DEV-CHECK] Call to getUser().addSet() loaded set data but did not include addon ID in set ID:",L),q.__source=e),this.addSet(T,L,q)},removeAllSets:n?function(T){return o.test(T)||s.log.warn("[DEV-CHECK] Call to getUser().removeAllSets() did not include addon ID in provider:",T),this.removeAllSets(T)}:void 0,removeSet:n?function(T,...L){return o.test(T)||s.log.warn("[DEV-CHECK] Call to getUser().removeSet() did not include addon ID in provider:",T),this.removeSet(T,...L)}:void 0},n?{badges:"Please use addBadge(), getBadge(), or removeBadge()",emote_sets:"Please use addSet(), removeSet(), or removeAllSets()",room:!0}:null,!0),R=(0,d.buildAddonProxy)(s,null,"getRoom()",{getUser(...T){const L=this.getUser(...T);if(L)return new Proxy(L,E)},addSet(T,L,q){return n&&!o.test(T)&&s.log.warn("[DEV-CHECK] Call to getRoom().addSet() did not include addon ID in provider:",T),this.manager.emotes.providers.has(T)||(this.manager.emotes.inferProvider(T,e),n&&s.log.warn("[DEV-CHECK] Call to getRoom().addSet() for provider that has not been registered with emotes.setProvider:",T)),q&&(n&&!o.test(L)&&s.log.warn("[DEV-CHECK] Call to getRoom().addSet() loaded set data but did not include addon ID in set ID:",L),q.__source=e),this.addSet(T,L,q)},removeAllSets:n?function(T){return o.test(T)||s.log.warn("[DEV-CHECK] Call to getRoom().removeAllSets() did not include addon ID in provider:",T),this.removeAllSets(T)}:void 0,removeSet:n?function(T,...L){return o.test(T)||s.log.warn("[DEV-CHECK] Call to getRoom().removeSet() did not include addon ID in provider:",T),this.removeSet(T,...L)}:void 0},{badges:!0,load_data:!0,emote_sets:"Please use addSet(), removeSet(), or removeAllSets()",refs:"Please use ref() or unref()",style:!0,users:"Please use getUser()",user_ids:"Please use getUser()"},!0);return h.iterateUsers=function*(){for(const T of this.iterateUsers())yield new Proxy(T,E)},h.iterateRooms=function*(){for(const T of this.iterateRooms())yield new Proxy(T,R)},h.iterateAllRoomsAndUsers=function*(){for(const T of this.iterateAllRoomsAndUsers())yield new Proxy(T,T instanceof Li?R:E)},h.addTabCommandPrefix=(T,L=null)=>(L==null&&(L=e),n&&L!==e&&s.log.warn("[DEV-CHECK] Used addTabCommandPrefix with incorrect provider."),this.addTabCommandPrefix(T,L)),h.removeTabCommandPrefix=(T,L=null)=>(L==null&&(L=e),n&&L!==e&&s.log.warn("[DEV-CHECK] Used removeTabCommandPrefix with incorrect provider."),this.removeTabCommandPrefix(T,L)),h.addTokenizer=T=>(T&&(T.__source=e),this.addTokenizer(T)),h.addLinkProvider=T=>(T&&(T.__source=e),this.addLinkProvider(T)),h.addRichProvider=T=>(T&&(T.__source=e),this.addRichProvider(T)),n&&(h.getUser=(...T)=>{let L=this.getUser(...T);if(L)return new Proxy(L,E)},h.getRoom=(...T)=>{let L=this.getRoom(...T);if(L)return new Proxy(L,R)},h.removeTokenizer=T=>{let L;typeof T=="string"?L=T:L=T.type;const q=this.tokenizers[L];return q&&q.__source!==e&&s.log.warn("[DEV-CHECK] Removed un-owned tokenizer with chat.removeTokenizer:",L," owner:",q.__source??"ffz"),this.removeTokenizer(T)},h.removeLinkProvider=T=>{let L;typeof T=="string"?L=T:L=T.type;const q=this.link_providers[L];return q&&q.__source!==e&&s.log.warn("[DEV-CHECK] Removed un-owned link provider with chat.removeLinkProvider:",L," owner:",q.__source??"ffz"),this.removeLinkProvider(T)},h.removeRichProvider=T=>{let L;typeof T=="string"?L=T:L=T.type;const q=this.link_providers[L];return q&&q.__source!==e&&s.log.warn("[DEV-CHECK] Removed un-owned rich provider with chat.removeRichProvider:",L," owner:",q.__source??"ffz"),this.removeRichProvider(T)}),(0,d.buildAddonProxy)(s,this,"chat",h,g)}onEnable(){this.socket=this.resolve("socket"),this.pubsub=this.resolve("pubsub"),this.settings.provider.on("changed",this.onProviderChange,this),this.on("site.subpump:pubsub-message",this.onPubSub,this),this.on("chat.emotes:update-priorities",e=>{for(const i of this.iterateAllRoomsAndUsers())i.emote_sets&&i.emote_sets.setSortFunction(e)}),this.context.get("chat.filtering.need-colors")&&this.createColorCache().then(()=>this.emit(":update-line-tokens"));for(const e in M)(0,r.has)(M,e)&&this.addTokenizer(M[e]);for(const e in I)(0,r.has)(I,e)&&this.addRichProvider(I[e]);for(const e in O)(0,r.has)(O,e)&&this.addLinkProvider(O[e]);this.on("chat:reload-data",e=>{for(const i of this.iterateRooms())i.load_data()}),this.on("chat:get-tab-commands",e=>{e.commands.push({name:"ffz:reload",description:this.i18n.t("chat.command.reload","Reload FFZ and add-on chat data (emotes, badges, etc.)"),permissionLevel:0,ffz_group:"FrankerFaceZ"})}),this.triggered_reload=!1,this.on("chat:ffz-command:reload",e=>{if(this.triggered_reload)return;const i=this.resolve("site.chat");i?.addNotice&&i.addNotice("*",this.i18n.t("chat.command.reload.starting","FFZ is reloading data...")),this.triggered_reload=!0,this.emit("chat:reload-data")}),this.on("load_tracker:complete:chat-data",e=>{if(this.triggered_reload){const i=this.resolve("site.chat");i?.addNotice&&i.addNotice("*",this.i18n.t("chat.command.reload.done","FFZ has finished reloading data. (Sources: {list})",{list:e.join(", ")}))}this.triggered_reload=!1}),this.on("addon:fully-unload",e=>{let i=0;for(const[s,n]of Object.entries(this.link_providers))n?.__source===e&&(i++,this.removeLinkProvider(s));for(const[s,n]of Object.entries(this.rich_providers))n?.__source===e&&(i++,this.removeRichProvider(s));for(const[s,n]of Object.entries(this.tokenizers))n?.__source===e&&(i++,this.removeTokenizer(s));this.CommandPrefixes.delete(e);for(const s of this.iterateAllRoomsAndUsers())i+=s._unloadAddon(e)??0;i&&(this.log.debug(`Cleaned up ${i} entries when unloading addon:`,e),this.emit(":update-line-tokens"))})}onPubSub(e){if(e.prefix==="stream-chat-room-v1"&&e.message.type==="chat_rich_embed"){const i=e.message.data,s=i.request_url,n=this.__link_providers;if(this._link_info[s])return;for(const o of n){const h=o.test.call(this,s);if(h){const g=o.receive?o.receive.call(this,h,i):i;let E=o.process.call(this,h,g);E instanceof Promise||(E=Promise.resolve(E)),E.then(R=>{this._link_info[s]||(this._link_info[s]=[!0,Date.now()+12e4,R])});return}}}}getUser(e,i,s,n,o=!1){let h;if(e&&typeof e=="number"&&(e=`${e}`),e&&this.user_ids[e]?h=this.user_ids[e]:i&&this.users[i]&&!n&&(h=this.users[i]),h&&h.destroyed&&(h=null),!h){if(s)return null;h=new Ii(this,null,e,i)}if(e&&e!==h.id){if(h.id){if(this.log.warn(`Data mismatch for user #${e} -- Stored ID: ${h.id} -- Login: ${i} -- Stored Login: ${h.login}`),o)throw new Error("id mismatch");this.user_ids[h.id]===h&&(this.user_ids[h.id]=null)}h._id=e,this.user_ids[e]=h}if(i){const g=this.users[i];g?g!==h&&!n&&(g.id?this.users[i]=h:(h.merge(g),g.destroy(!0))):this.users[i]=h}return h}getRoom(e,i,s,n,o=!1){let h;if(e&&typeof e=="number"&&(e=`${e}`),e&&this.room_ids[e]?h=this.room_ids[e]:i&&this.rooms[i]&&!n&&(h=this.rooms[i]),h&&h.destroyed&&(h=null),!h){if(s)return null;h=new Li(this,e,i)}if(e&&e!==h.id){if(h.id){if(this.log.warn(`Data mismatch for room #${e} -- Stored ID: ${h.id} -- Login: ${i} -- Stored Login: ${h.login}`),o)throw new Error("id mismatch");this.room_ids[h.id]===h&&(this.room_ids[h.id]=null)}h._id=e,this.room_ids[e]=h}if(i){const g=this.rooms[i];g?g!==h&&!n&&(g.id?this.rooms[i]=h:(h.merge(g),g.destroy(!0))):this.rooms[i]=h}return h}*iterateAllRoomsAndUsers(){for(const e of this.iterateRooms()){yield e;for(const i of e.iterateUsers())yield i}for(const e of this.iterateUsers())yield e}*iterateUsers(){const e=new Set;for(const i of Object.values(this.user_ids))i&&!i.destroyed&&(e.add(i),yield i);for(const i of Object.values(this.users))i&&!i.destroyed&&(yield i)}*iterateRooms(){const e=new Set;for(const i of Object.values(this.room_ids))i&&!i.destroyed&&(e.add(i),yield i);for(const i of Object.values(this.rooms))i&&!i.destroyed&&!e.has(i)&&(yield i)}iterateMessages(e=!0,i=!0,s=!0){const n=[];return this.emit("chat:get-messages",e,i,s,n),this.emit("chat:get-messages-late",e,i,s,n),n}handleLinkClick(e){if(e.ctrlKey||e.shiftKey)return;const i=e.currentTarget,s=i?.dataset;if(!s)return;const n=this.makeEvent({url:s.url??i.href,source:e});if(this.emit("chat:click-link",n),n.defaultPrevented)return e.preventDefault(),e.stopPropagation(),!0}handleReplyClick(e){const i=e.target,s=this.resolve("site.fine");if(!i||!s)return;const n=s.searchParent(i,o=>o.props&&o.props.reply&&o.setOPCardTray);n&&n.setOPCardTray(n.props.reply)}handleMentionClick(e){if(!this.context.get("chat.filtering.clickable-mentions"))return;const i=e.target,s=i&&i.dataset;if(!s||!s.login)return;const n=this.resolve("site.fine");if(!n)return;const o=n.searchParent(i,h=>h.props&&h.props.onUsernameClick);o&&o.props.onUsernameClick(s.login,void 0,void 0,e.currentTarget.getBoundingClientRect().bottom)}clickToReveal(e){const i=e.target;if(i){if(i._ffz_visible)i.textContent="\xD7\xD7\xD7";else if(this.context.get("chat.filtering.click-to-reveal"))i.dataset&&(i.textContent=i.dataset.text);else return;i._ffz_visible=!i._ffz_visible}}standardizeWhisper(e){if(!e)return e;if(e._ffz_message)return e._ffz_message;const i={},s=e.content.startsWith("/me "),n=s?4:0,o=e._ffz_message={id:e.id,user:{...e.from},message:e.content.slice(n),is_action:s,ffz_emotes:i,timestamp:e.sentAt&&e.sentAt.getTime(),deleted:!1};if(o.user.color=o.user.chatColor,Array.isArray(e.emotes)&&e.emotes.length)for(const h of e.emotes){const g=h.emoteID;(i[g]=i[g]||[]).push({startIndex:h.from-n,endIndex:h.to-n})}return o}getUserLevel(e){return!e||!e.user?0:e.user.login===e.roomLogin||e.badges&&e.badges.broadcaster?4:e.badges?e.badges.moderator?3:e.badges.vip?2:e.badges.subscriber?1:0:0}tokenizeReply(e){return e?[{type:"reply",text:e.parentDisplayName,color:this.context.get("chat.filtering.color-mentions")&&this.color_cache?this.color_cache.get(e.parentUserLogin):null,recipient:e.parentUserLogin},{type:"text",text:" "}]:null}applyHighlight(e,i,s,n,o=!1){if(!e)return e;const h=e.mention_priority==null,g=h||i>=e.mention_priority,E=h||i>e.mention_priority;if(e.filters&&e.filters.push(`${n}(${i})${g&&s===!1?":remove":s?`:${s}`:""}`),g){if(e.mention_priority=i,s===!1){E&&(e.mentioned=!1,e.clear_priority=i,e.mention_color=e.highlights=null);return}e.mentioned=!0,e.highlights||(e.highlights=new Set)}e.mentioned&&(e.clear_priority==null||i>=e.clear_priority)&&(e.highlights.add(n),(s||o)&&(E||!e.mention_color)&&(e.mention_color=s))}standardizeMessage(e){if(!e)return e;e.ffz_standardized=!0,e.sender&&!e.user&&(e.user=e.sender),e.from&&!e.user&&(e.user=e.from);let i=e.user;i||(i=e.user={});const s=e.extension||{};if(i.color=i.color||i.chatColor||s.chatColor||null,i.type=i.type||i.userType||null,i.id=i.id||i.userID||null,i.login=i.login||i.userLogin||null,i.displayName=i.displayName||i.userDisplayName||i.login||s.displayName,i.isIntl=i.login&&i.displayName&&i.displayName.trim().toLowerCase()!==i.login,this.color_cache&&i.color&&this.color_cache.set(i.login,i.color),!e.message&&e.messageParts&&this.detokenizeMessage(e),e.content&&!e.message&&(e.content.fragments?this.detokenizeContent(e):e.message=e.content.text),e.ffz_emotes||this.standardizeEmotes(e),!e.badges&&i.displayBadges){const n=e.badges={};for(const o of i.displayBadges)n[o.setID]=o.version}if(!e.badges&&s.displayBadges){const n=e.badges={};for(const o of s.displayBadges)n[o.setID]=o.version}return i.type==null&&e.badges&&e.badges.moderator&&(i.type="mod"),!e.timestamp&&e.sentAt&&(e.timestamp=new Date(e.sentAt).getTime()),e.deletedAt!==void 0&&(e.deleted=!!e.deletedAt),e.ffz_badges=e.sourceRoomID?this.badges.getBadges(i.id,i.login,e.sourceRoomID,null):this.badges.getBadges(i.id,i.login,e.roomID,e.roomLogin),e}standardizeEmotes(e){if(e.emotes&&e.message){const i={},s=(0,r.split_chars)(e.message);let n=0;e.message&&e.messageBody&&e.message!==e.messageBody&&(n=s.length-(0,r.split_chars)(e.messageBody).length);for(const o in e.emotes)if((0,r.has)(e.emotes,o)){const h=e.emotes[o];if(Array.isArray(h))return e.ffz_emotes=e.emotes;const g=i[h.id]=i[h.id]||[];let E=h.startIndex+1+n;for(;E<s.length&&!lr.test(s[E]);)E++;g.push({startIndex:h.startIndex+n,endIndex:E-1})}e.ffz_emotes=i;return}e.messageParts?this.detokenizeMessage(e,!0):e.content&&e.content.fragments&&this.detokenizeContent(e,!0)}detokenizeContent(e,i=!1){const s=[],n=e.content.fragments,o=n.length,h={};let g=0,E,R=!0;for(let T=0;T<o;T++){const L=n[T],q=L.content,le=q&&q.__typename;if(E=L.text,le==="Emote"){const pe=q.emoteID;(h[pe]=h[pe]||[]).push({startIndex:g,endIndex:g+E.length-1})}E&&E.length&&(R&&E.startsWith("/me ")&&(e.is_action=!0,E=E.slice(4)),g+=(0,r.split_chars)(E).length,s.push(E)),R=!1}return i||(e.message=s.join("")),e.ffz_emotes=h,e}detokenizeMessage(e,i=!1){const s=[],n=e.messageParts,o=n.length,h={};let g=0,E,R=null,T=0;for(let L=0;L<o;L++){const q=n[L],le=q.ffz_content??q.content;if(le){if(typeof le=="string")E=le;else if(le.recipient)E=`@${le.recipient}`;else if(le.url)E=le.url;else if(le.cheerAmount)T+=le.cheerAmount,E=`${le.alt}${le.cheerAmount}`;else if(le.images){const pe=le.images.themed?le.images.dark:le.images.sources;let fe=le.emoteID;if(!fe){const De=pe&&(/\/emoticons\/v1\/(\d+)\/[\d.]+$/.exec(pe["1x"])||/\/emoticons\/v2\/(\d+)\//.exec(pe["1x"]));fe=De&&De[1]}if(E=le.alt,fe){const De=h[fe]=h[fe]||[],Ae=R>0?1:0;De.push({startIndex:g+Ae,endIndex:g+E.length-1})}R>0&&(E=` ${E}`)}else continue;E&&(g+=(0,r.split_chars)(E).length,R=q.type,s.push(E))}}return i||(e.message=s.join("")),e.bits=T,e.ffz_emotes=h,e}formatUser(e,i){const s=this.context.get("chat.name-format"),n=s===2&&e.isIntl?e.login:e.displayName||e.login,o=[i("span",{className:"chat-author__display-name"},n)];return s===0&&e.isIntl&&o.push(i("span",{className:"chat-author__intl-login"},` (${e.login})`)),o}formatTime(e){e instanceof Date||(e=new Date(e));const i=this.context.get("chat.timestamp-format"),s=_()(e);try{return s.locale(this.i18n.locale).format(i)}catch{return s.format(i)}}addHighlightReason(e,i,s){if(typeof e=="object"&&e.key?(i=e,e=i.key):typeof i=="string"&&(i={title:i}),typeof s=="string"&&s.length>0&&(i.label=s),i.value=i.key=e,i.i18n_key||(i.i18n_key=`hl-reason.${e}`),i.label&&!i.i18n_label&&(i.i18n_label=`${i.i18n_key}.label`),this._hl_reasons[e])throw new Error(`Highlight Reason already exists with key ${e}`);this._hl_reasons[e]=i}getHighlightReason(e){return this._hl_reasons[e]??null}getHighlightReasons(){return Object.values(this._hl_reasons)}addTabCommandPrefix(e,i="ffz"){Array.isArray(e)||(e=[e]);for(const s of e){if(typeof s!="string"||s.length!==1)throw new Error("Invalid command prefix. Must be string of length 1.");this.CommandPrefixes.push(i,s)}}removeTabCommandPrefix(e,i="ffz"){Array.isArray(e)||(e=[e]);for(const s of e)this.CommandPrefixes.remove(i,s)}addTokenizer(e){const i=e.type;if((0,r.has)(this.tokenizers,i)){this.log.warn(`Tried adding tokenizer of type '${i}' when one was already present.`);return}if(this.tokenizers[i]=e,e.priority==null&&(e.priority=0),e.tooltip){const s=e.tooltip,n=this.tooltips.types[i]=s.bind(this);for(const o of["interactive","delayShow","delayHide","onShow","onHide"])n[o]=typeof s[o]=="function"?s[o].bind(this):s[o]}this.__tokenizers.push(e),this.__tokenizers.sort((s,n)=>s.priority>n.priority?-1:s.priority<n.priority?1:s.type<n.type)}removeTokenizer(e){let i;if(typeof e=="string"?i=e:i=e.type,e=this.tokenizers[i],!e)return null;delete this.tokenizers[i],e.tooltip&&delete this.tooltips.types[i];const s=this.__tokenizers.indexOf(e);return s!==-1&&this.__tokenizers.splice(s,1),e}addLinkProvider(e){const i=e.type;if((0,r.has)(this.link_providers,i)){this.log.warn(`Tried adding link provider of type '${i}' when one was already present.`);return}this.link_providers[i]=e,e.priority==null&&(e.priority=0),this.__link_providers.push(e),this.__link_providers.sort((s,n)=>s.priority>n.priority?-1:s.priority<n.priority?1:s.type<n.type)}removeLinkProvider(e){let i;if(typeof e=="string"?i=e:i=e.type,e=this.link_providers[i],!e)return null;delete this.link_providers[i];const s=this.__link_providers.indexOf(e);return s!==-1&&this.__link_providers.splice(s,1),e}addRichProvider(e){const i=e.type;if((0,r.has)(this.rich_providers,i)){this.log.warn(`Tried adding rich provider of type '${i}' when one was already present.`);return}this.rich_providers[i]=e,e.priority==null&&(e.priority=0),this.__rich_providers.push(e),this.__rich_providers.sort((s,n)=>s.priority>n.priority?-1:s.priority<n.priority?1:s.type<n.type)}removeRichProvider(e){let i;if(typeof e=="string"?i=e:i=e.type,e=this.rich_providers[i],!e)return null;delete this.rich_providers[i];const s=this.__rich_providers.indexOf(e);return s!==-1&&this.__rich_providers.splice(s,1),e}tokenizeString(e,i,s,n=!1){let o=[{type:"text",text:e}];for(const h of this.__tokenizers){if(!h.process)continue;const g=h.process.call(this,o,i,s,n);if(g&&(o=g),n&&i.ffz_halt_tokens){i.ffz_halt_tokens=void 0;break}}return o}pluckLastEmote(e){if(!Array.isArray(e))return;let i=e.length;for(;i--;){const s=e[i];if(s.type==="emote"&&s.provider!=="emoji")return this.context.get("chat.emotes.allow-gigantify")?(s.gigantify=!0,s.hidden=!0,s):(s.gigantify&&(s.hidden=!1),null);if(s.hidden)continue}}pluckRichContent(e,i){if(!this.context.get("chat.rich.enabled")||this.context.get("chat.rich.minimum-level")>this.getUserLevel(i)||!Array.isArray(e))return;const s=this.__rich_providers,n=this.context.get("chat.rich.want-mid");for(const o of e)if(o.allow_rich??!0){for(const h of s)if(h.test.call(this,o,i))return o.hidden=h.can_hide_token&&(this.context.get("chat.rich.hide-tokens")||h.hide_token),h.process.call(this,o,n)}}tokenizeMessage(e,i,s=!1){if(e.content&&!e.message&&(e.message=e.content.text),e.sender&&!e.user&&(e.user=e.sender),!e.message)return[];let n=[{type:"text",text:e.message}];for(const o of this.__tokenizers){if(!o.process)continue;const h=o.process.call(this,n,e,i,s);if(h&&(n=h),s&&e.ffz_halt_tokens){e.ffz_halt_tokens=void 0;break}}return n||[]}renderGiantEmote(e,i){i||(i=re.createElement);const s=e.anim===1,n=e.anim===2;let o,h,g;if(e.provider==="twitch")o=(0,r.getTwitchEmoteURL)(e.id,4,s,!0),n&&(h=(0,r.getTwitchEmoteURL)(e.id,4,!0,!0)),g=112;else if(e.provider==="ffz"){const E=this.emotes.emote_sets[e.set],R=E?.emotes?.[e.id];if(R){let T=(s?R.animated:null)??R.urls,L=Vs(T);if(!L)return null;o=L[0],g=R.height*L[1],n&&R.animated&&(L=Vs(R.animated),L&&(h=L[0]))}}else o=null;return o?i("img",{className:`chat-image chat-line__message--emote ffz--pointer-events ffz-tooltip${h?" ffz-hover-emote":""}${e.provider==="twitch"?" twitch-emote":e.provider==="ffz"?" ffz-emote":e.provider==="emoji"?" ffz-emoji":""}`,src:o,height:`${g}px`,alt:e.text,"data-normal-src":o,"data-hover-src":h,"data-tooltip-type":"emote","data-provider":e.provider,"data-id":e.id,"data-set":e.set,"data-code":e.code,"data-variant":e.variant,onClick:this.emotes.handleClick}):null}renderTokens(e,i,s){i||(i=re.createElement);const n=[],o=this.tokenizers,h=e.length,g=this.context.get("chat.filtering.hidden-tokens");for(let E=0;E<h;E++){const R=e[E],T=R.type,L=o[T];if(R.hidden||g.has(T))continue;let q;s&&E===0&&T==="mention"&&R.recipient&&R.recipient===s.parentUserLogin||(T==="text"?q=i("span",{className:"text-fragment","data-a-target":"chat-message-text"},R.text):L?q=L.render.call(this,R,i,s):q=i("em",{className:"ffz-unknown-token ffz-tooltip","data-tooltip-type":"json","data-data":JSON.stringify(R,null,2)},`[unknown token: ${T}]`),q&&n.push(q))}return n}clearLinkCache(e){if(e){const s=this._link_info[e];if(!s[0])for(const n of s[2])n[1]();this._link_info[e]=null,this.emit(":update-link-resolver",e);return}const i=this._link_info;this._link_info={};for(const s of Object.values(i))if(!s[0])for(const n of s[2])n[1]();this.emit(":update-link-resolver")}get_link_info(e,i,s=!1){let n=this._link_info[e];const o=n&&n[1];if((n&&n[0]&&s||o&&Date.now()>o)&&(n=this._link_info[e]=null),n&&n[0]){const h=this.handleLinkToS(n[2]);return i?h:Promise.resolve(h)}return i?null:n?new Promise((h,g)=>n[2].push([h,g])):new Promise((h,g)=>{n=this._link_info[e]=[!1,null,[[h,g]]];const E=B((T,L)=>{L=this.fixLinkInfo(L);const q=!n[0]&&n[2];if(n[0]=!0,n[1]=Date.now()+12e4,n[2]=T?L:null,L=this.handleLinkToS(L),q)for(const le of q)le[T?0:1](L)},"handle");for(const T of this.__link_providers){const L=T.test.call(this,e);if(L){(0,r.timeout)(T.process.call(this,L),15e3).then(q=>E(!0,q)).catch(q=>E(!1,q));return}}let R=this.settings.get("debug.link-resolver.source").value;R==="special:socket"&&!this.socket&&(R=f.LINK_DATA_HOSTS.test.value),R==="special:socket"?(0,r.timeout)(this.socket.call("get_link",e),15e3).then(T=>E(!0,T)).catch(T=>E(!1,T)):(0,r.timeout)(fetch(`${R}?url=${encodeURIComponent(e)}`).then(T=>T.json()),15e3).then(T=>E(!0,T)).catch(T=>E(!1,T))})}handleLinkToS(e){if(!Array.isArray(e?.urls))return e;const i=this.settings.provider.get("agreed-tos",[]),s=this.settings.provider.get("declined-tos",[]),n=new Set(e.urls.map(o=>o.resolver).filter(o=>o));for(const[o,h]of Object.entries(f.RESOLVERS_REQUIRE_TOS))if(n.has(o)&&!i.includes(o)){const g=s.includes(o);return{...e,url:null,short:[{type:"box",content:[h.i18n_key?{type:"i18n",key:h.i18n_key,phrase:h.label}:h.label,g?null:" ",g?null:{type:"conditional",tooltip:!1,content:{type:"i18n",key:"embed.tos-open-settings",phrase:"{link} to open your settings.",content:{link:{type:"open_settings",item:"chat.tooltips",content:{type:"i18n",key:"embed.tos-open-settings.click",phrase:"Click here"}}}},alternative:{type:"i18n",key:"embed.tos-settings",phrase:"Open the FFZ Control Center and navigate to Chat > Tooltips to agree."}}]}],mid:null,full:null}}return e}agreeToTerms(e){const i=this.settings.provider.get("agreed-tos",[]);i.includes(e)||(this.settings.provider.set("agreed-tos",[...i,e]),this.emit(":update-link-resolver"))}declineTerms(e){const i=this.settings.provider.get("declined-tos",[]);i.includes(e)||(this.settings.provider.set("declined-tos",[...i,e]),this.emit(":update-link-resolver"))}hasAgreedToTerms(e){const i=this.settings.provider.get("agreed-tos");return i?i.includes(e):!1}hasDeclinedTerms(e){const i=this.settings.provider.get("declined-tos");return i?i.includes(e):!1}onProviderChange(e,i){e!=="agreed-tos"&&e!=="declined-tos"||this.emit(":update-link-resolver")}fixLinkInfo(e){if(!e)return e;if(e.error&&e.message&&(e.error=e.message),e.error&&(e={v:5,title:this.i18n.t("card.error","An error occurred."),description:e.error,short:{type:"header",image:{type:"image",url:ar},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:e.error},unsafe:e.unsafe,urls:e.urls}),e.v<5&&!e.short&&!e.full&&(e.title||e.desc_1||e.desc_2)){const i=e.preview||e.image;e={v:5,short:{type:"header",image:i?{type:"image",url:i,sfw:e.image_safe??!1}:null,title:e.title,subtitle:e.desc_1,extra:e.desc_2}}}return e}};B(Ts,"chat_Chat");let ss=Ts;function Vs(k){return k?.[4]?[k[4],4]:k?.[3]?[k[3],3]:k?.[2]?[k[2],2]:k?.[1]?[k[1],1]:null}B(Vs,"getBiggestImage");var Zs=X(94417),cr=X(96883),hr=X.n(cr);function ur(k){return k==="SUBSCRIPTIONS"?f.EmoteTypes.Subscription:k==="FOLLOWER"?f.EmoteTypes.Follower:k==="GLOBALS"||k==="SMILIES"?f.EmoteTypes.Global:k==="LIMITED_TIME"||k==="MEGA_COMMERCE"?f.EmoteTypes.LimitedTime:k==="BITS_BADGE_TIERS"?f.EmoteTypes.BitsTier:k==="CHANNEL_POINTS"?f.EmoteTypes.ChannelPoints:k==="TWO_FACTOR"?f.EmoteTypes.TwoFactor:k==="PRIME"?f.EmoteTypes.Prime:k==="TURBO"?f.EmoteTypes.Turbo:f.EmoteTypes.Unknown}B(ur,"getEmoteTypeFromTwitchType");function ns(k){return k==="1000"||k==="prime"?1:k==="2000"?2:k==="3000"?3:1}B(ns,"tierToNumber");const Ms=class Ms extends d.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("i18n"),this.inject("chat"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("site"),this.inject("site.apollo"),this.inject("site.twitch_data"),this.vue=this.resolve("vue"),this.open_cards={},this.last_card=null}onEnable(){this.on("chat.emotes:click",this.handleClick,this)}handleClick(e){this.chat.context.get("chat.emote-dialogs")&&(e.preventDefault(),this.openCard({provider:e.provider,code:e.code,variant:e.variant,name:e.name,set:e.set,id:e.id??`${e.code}::${e.variant}`},e.modifiers,e.source))}async loadVue(){if(this._vue_loaded)return;await this.vue.enable();const e=await X.e(6115).then(X.bind(X,81414));this.vue.component("emote-card",e.default),this._vue_loaded=!0}canReportTwitch(){const e=this.resolve("site"),i=e.getUser(),s=this.resolve("site.web_munch");let n;try{n=s.getModule("user-report")}catch{return!1}return!!n&&!!i?.id&&e?.store?.dispatch}reportTwitchEmote(e,i){const s=this.resolve("site"),n=s.getUser(),o=this.resolve("site.web_munch");let h;try{h=o.getModule("user-report")}catch{return!1}return!n?.id||!s?.store?.dispatch?!1:(s.store.dispatch({type:"core.modal.MODAL_SHOWN",modalComponent:h,modalProps:{reportContext:{contentID:String(e),contentMetadata:{channelID:String(n.id)},contentType:"EMOTE_REPORT",targetUserID:String(i),trackingContext:"emote_card"}}}),!0)}async loadData(e){if(e.provider==="twitch"){const o=this.resolve("site.apollo");if(!o)throw new Error("Unable to load emote data");const h=await o.client.query({query:hr(),variables:{emoteID:e.id}});if(!h?.data?.emote)throw new Error("Unable to load emote data");const g=h.data.emote,E=(0,r.getTwitchEmoteURL)(g.id,2,!0,!0),R=`${E} 1x, ${(0,r.getTwitchEmoteURL)(g.id,4,!0,!0)} 2x`;let T,L,q,le=ur(g.type),pe;try{pe=parseInt(g.setID,10)}catch{}if(f.TWITCH_GLOBAL_SETS.includes(pe)?le=f.EmoteTypes.Global:f.TWITCH_POINTS_SETS.includes(pe)?le=f.EmoteTypes.ChannelPoints:f.TWITCH_PRIME_SETS.includes(pe)&&(le=f.EmoteTypes.Prime),le===f.EmoteTypes.Subscription){const De=g.owner?.subscriptionProducts;if(Array.isArray(De)){for(const Ae of De)if(Ae.emotes.some(ye=>ye.id===g.id)){q=ns(Ae.tier);break}}T=this.i18n.t("emote-card.sub","Tier {tier} Sub Emote ({source})",{tier:q,source:g.owner?.displayName||g.owner?.login}),L="twitch"}else le===f.EmoteTypes.Follower?(T=this.i18n.t("emote.follower","Follower Emote ({source})",{source:g.owner.displayName||g.owner.login}),L="twitch"):le===f.EmoteTypes.Global?T=this.i18n.t("emote.global","Twitch Global"):le===f.EmoteTypes.LimitedTime?T=this.i18n.t("emote.limited","Limited-Time Only Emote"):le===f.EmoteTypes.BitsTier?(T=this.i18n.t("emote-card.bits","{amount,number} Bits Reward ({source})",{amount:g.bitsBadgeTierSummary?.threshold,source:g.owner.displayName||g.owner.login}),L="twitch"):le===f.EmoteTypes.TwoFactor?T=this.i18n.t("emote.2fa","Twitch 2FA Emote"):le===f.EmoteTypes.ChannelPoints?(T=this.i18n.t("emote.points","Channel Points Emote"),L="twitch"):le===f.EmoteTypes.Prime||le===f.EmoteTypes.Turbo?T=this.i18n.t("emote.prime","Prime Gaming"):T=g.type;const fe={id:g.id,fav_source:"twitch",channel_id:g.owner?.id,more:[],body:L,src:E,srcSet:R,name:g.token,source:T,artist:g.artist?g.artist.displayName||g.artist.login:null,artistLink:g.artist?`https://www.twitch.tv/${g.artist.login}`:null};if(g.owner?.id&&(fe.channel_title=g.owner.displayName??g.owner.login,fe.channel_login=g.owner.login,fe.channel_live=!!g.owner.stream?.id,fe.channel_followed=!!g.owner?.self?.follower?.followedAt,fe.more.push({type:"link",icon:"ffz-i-link-ext",title:"View Channel on TwitchEmotes.com",href:`https://twitchemotes.com/channels/${g.owner.id}`}),this.canReportTwitch()&&fe.more.push({type:"report-twitch",title_i18n:"emote-card.report",title:"Report Emote",icon:"ffz-i-flag"})),g.bitsBadgeTierSummary?.threshold)fe.unlock_mode="bits",fe.unlocked=g.bitsBadgeTierSummary.self?.isUnlocked,fe.bits_amount=g.bitsBadgeTierSummary.threshold,fe.bits_remain=g.bitsBadgeTierSummary.self?.numberOfBitsUntilUnlock??fe.unlock_amount;else if(le===f.EmoteTypes.Follower){fe.unlock_mode="follow",fe.unlocked=!1;const De=fe.extra_emotes=[];if(!fe.unlocked&&Array.isArray(g.owner?.channel?.localEmoteSets)){for(const Ae of g.owner.channel.localEmoteSets)if(Array.isArray(Ae.emotes))for(const ye of Ae.emotes){const Ie=(0,r.getTwitchEmoteURL)(ye.id,1,!0,!0),Fe=`${Ie} 1x, ${(0,r.getTwitchEmoteURL)(ye.id,2,!0,!0)} 2x`;De.push({id:ye.id,name:ye.token,src:Ie,srcSet:Fe})}}}else if(le===f.EmoteTypes.Subscription){fe.unlock_mode="subscribe",fe.unlocked=!1,fe.unlock_tier=q,fe.existing_tier=0;const De=g.owner?.self?.subscriptionBenefit;De?.tier&&(fe.existing_tier=ns(De.tier));const Ae=fe.extra_emotes=[],ye=fe.existing_tier;if(ye>=q)fe.unlocked=!0;else if(Array.isArray(g.owner?.subscriptionProducts))for(const Ie of g.owner.subscriptionProducts){const Fe=ns(Ie.tier);if(Fe===q&&(fe.channel_product=Ie.name,Ie.priceInfo?.price&&Ie.priceInfo.currency)){const je=new Intl.NumberFormat(navigator.languages,{style:"currency",currency:Ie.priceInfo.currency});fe.product_price=je.format(Ie.priceInfo.price/100)}if(Fe>ye&&Fe<=q&&Array.isArray(Ie.emotes))for(const je of Ie.emotes){const Ue=(0,r.getTwitchEmoteURL)(je.id,1,!0,!0),Je=`${Ue} 1x, ${(0,r.getTwitchEmoteURL)(je.id,2,!0,!0)} 2x`;Ae.push({id:je.id,name:je.token,src:Ue,srcSet:Je})}}}return fe}if(e.provider==="emoji"){const o=this.emoji.emoji[e.code],h=this.chat.context.get("chat.emoji.style"),g=e.variant?o.variants[e.variant]:o,E=e.variant?this.emoji.emoji[e.variant]:null,R=o.category?this.i18n.t(`emoji.category.${o.category.toSnakeCase()}`,this.emoji.categories[o.category]||o.category):null;return{id:e.code,fav_source:"emoji",more:[],src:this.emoji.getFullImage(g.image,h),srcSet:this.emoji.getFullImageSet(g.image,h),width:18,height:18,name:`:${o.names[0]}:${E?`:${E.names[0]}:`:""}`,source:this.i18n.t("tooltip.emoji","Emoji - {category}",{category:R})}}if(e.provider!=="ffz")throw new Error("Invalid provider");const i=this.emotes.emote_sets[e.set],s=i?i.emotes?.[e.id]||i.disabled_emotes?.[e.id]:null;if(!s)throw new Error("Unable to load emote data");const n={id:s.id,fav_source:i.source??"ffz",more:[],src:s.animSrc2??s.src2,srcSet:s.animSrcSet2??s.srcSet2,width:s.width,height:s.height,name:s.name,originalName:s.original_name,source:i.source_line||`${i.source||"FFZ"} ${i.title||"Global Emotes"}`,owner:s.owner?s.owner.display_name||s.owner.name:null,ownerLink:s.owner&&!i.source?`https://www.frankerfacez.com/${s.owner.name}`:null,artist:s.artist?s.artist.display_name||s.artist.name:null,artistLink:s.artist&&!i.source?`https://www.frankerfacez.com/${s.artist.name}`:null};return i.source?s.click_url&&n.more.push({type:"link",title_i18n:"emote-card.view-external",title:"View on {source}",source:i.source,href:s.click_url}):(s.public&&(n.body="manage-ffz"),n.more.push({type:"link",title_i18n:"emote-card.view-on-ffz",title:"View on FrankerFaceZ",href:`https://www.frankerfacez.com/emoticon/${s.id}-`}),n.more.push({type:"report-ffz",title_i18n:"emote-card.report",title:"Report Emote",icon:"ffz-i-flag"})),n}async openCard(e,i,s){const n=`${e.provider}::${e.id}::${i??""}`,o=this.open_cards[n];if(o){o.$el.style.zIndex=(0,Zs.getDialogNextZ)(),o.focus();return}let h=s?s.clientX:window.innerWidth/2,g=s?s.clientY+15:window.innerHeight/2;if(this.last_card){const R=this.last_card;s||(h=R.$el.offsetLeft,g=R.$el.offsetTop),R.close()}const E=this.loadData(e);await this.loadVue(),this.last_card=this.open_cards[n]=this.buildCard(h,g,e,i,E)}buildCard(e,i,s,n,o){let h;const g=new this.vue.Vue({el:(0,re.createElement)("div"),render:T=>T("emote-card",{props:{raw_emote:(0,r.deep_copy)(s),raw_modifiers:n,data:o,getFFZ:()=>this,reportTwitchEmote:(...L)=>this.reportTwitchEmote(...L),getZ:Zs.getDialogNextZ},on:{emit:(L,...q)=>this.emit(L,...q),close:()=>{g.$el.remove(),g.$destroy(),this.last_card===h&&(this.last_card=null);const q=`${s.provider}::${s.id}::${n??""}`;this.open_cards[q]===h&&(this.open_cards[q]=null),this.emit("tooltips:cleanup")},pin:()=>{this.last_card===h&&(this.last_card=null)}}})});h=g.$children[0];const E=g.$el;return E.style.left=`${e}px`,E.style.top=`${i}px`,document.querySelector(this.site.constructor.DIALOG_SELECTOR??"#root>div>.tw-full-height,.twilight-minimal-root>.tw-full-height").appendChild(E),requestAnimationFrame(()=>h.constrain()),h}};B(Ms,"EmoteCard");let rs=Ms;const Di=class Di extends d.default{constructor(){super();const e=performance.now();Di.instance=this,this.host="twitch",this.flavor="clips",this.name="ffz_clips",this.__state=0,this.__modules.core=this,this.log=new l.default(null,null,null),this.log.label="FFZClips",this.log.init=!0,this.core_log=this.log.get("core"),this.log.hi(this),this.inject("settings",Y),this.inject("experiments",Lt),this.inject("i18n",Jt),this.inject("staging",at),this.inject("load_tracker",gt),this.inject("pubsub",et),this.inject("site",ni),this.inject("addons",Ne),this.register("vue",Bi),this.inject("tooltips",di),this.register("chat",ss),this.register("emote_card",rs),this.enable().then(()=>this.enableInitialModules()).then(()=>{const i=performance.now()-e;this.core_log.info(`Initialization complete in ${i.toFixed(5)}ms.`),this.log.init=!1}).catch(i=>{this.core_log.error("An error occurred during initialization.",i),this.log.init=!1})}static get(){return Di.instance}async enableInitialModules(){const e=[];for(const i in this.__modules){const s=this.__modules[i];s instanceof d.default&&s.should_enable&&e.push(s.enable())}await Promise.all(e)}async generateLog(){const e=[];for(const s in this.__modules){const n=this.__modules[s];n instanceof d.default&&n.generateLog&&n!=this&&e.push((async()=>{try{return[s,await(0,r.timeout)(Promise.resolve(n.generateLog()),5e3)]}catch(o){return[s,`Error: ${o}`]}})())}const i=await Promise.all(e);if(this.log.captured_init&&this.log.captured_init.length>0){const s=[];for(const n of this.log.captured_init){const o=_()(n.time).locale("en").format("H:mm:ss");s.push(`[${o}] ${n.level} | ${n.category||"core"}: ${n.message}`)}i.unshift(["initialization",s.join(`
`)])}return i.map(s=>`${s[0]}
-------------------------------------------------------------------------------
${typeof s[1]=="string"?s[1]:JSON.stringify(s[1],null,4)}`).join(`

`)}};B(Di,"FrankerFaceZ");let fi=Di;fi.Logger=l.default;const vi=fi.version_info=Object.freeze({major:4,minor:76,revision:4,extra:Ks?.length&&Ks[0],commit:"15c33281ad9d1b7898ab3739c0844740210b602b",build:"0",hash:X.h(),toString:()=>`${vi.major}.${vi.minor}.${vi.revision}${vi.build?`.${vi.build}`:""}${vi.extra||""}${f.DEBUG?"-dev":""}`});fi.utilities={addon:X(5227),blobs:X(38626),color:X(14873),constants:X(24431),dom:X(44589),events:X(17159),logging:X(55467),module:X(22527),object:X(46949),time:X(83269),tooltip:X(8528),i18n:X(2356),dayjs:X(51722),popper:X(16572)},window.FrankerFaceZ=fi,window.ffz=new fi})()})();})();

//# sourceMappingURL=clips.js.map