(()=>{"use strict";var e={4056:(e,t,i)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.maxResolution=t.handledVideosPlatform=t.url_belin_api_resources=t.url_belin_api=t.url_belin_resources=t.url_belin=t.url_labo=t.url_frigo=t.url_auth=t.url_keycloack=t.url_api=t.base_url_front=t.VERSION=void 0,i(7505),i(872),i(7466),i(3848);const r=i(7260);let s;i(3734),s=r.config,t.VERSION=null!==(n=s.VERSION)&&void 0!==n?n:"3.50.1",t.base_url_front=s.base_url_front,t.url_api=s.url_api,t.url_keycloack=s.url_keycloack,t.url_auth=t.url_keycloack+"/realms/lde-poplab/protocol/openid-connect",t.url_frigo=t.base_url_front+"/frigo",t.url_labo=t.base_url_front+"/labo/mes-documents",t.url_belin="https://manuelnumeriquemax.belin.education/",t.url_belin_resources="https://resources.manuelnumeriquemax.belin.education/",t.url_belin_api="https://api.manuelnumeriquemax.belin.education/main/v1/nodes/",t.url_belin_api_resources="https://api.manuelnumeriquemax.belin.education/main/v1/resources",t.handledVideosPlatform=["youtube.com/watch","youtube.com/embed","youtu.be/","vimeo.com/","dailymotion.com/"],t.maxResolution=49e6},7466:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.integration-its.poplab.education",url_api:"https://app.integration-its.poplab.education/api",url_keycloack:"https://id.integration-its.poplab.education"}},7505:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"http://localhost:8000",url_api:"http://localhost:8082/api",url_keycloack:"http://auth.poplab.local"}},3848:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.preprod-its.poplab.education",url_api:"https://app.preprod-its.poplab.education/api",url_keycloack:"https://id.preprod-its.poplab.education"}},7260:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.poplab.education",url_api:"https://app.poplab.education/api",url_keycloack:"https://auth.poplab.education"}},872:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={base_url_front:"https://app.sandbox.poplab.education",url_api:"https://app.sandbox.poplab.education/api",url_keycloack:"https://id.sandbox.poplab.education"}},3734:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={VERSION:"TEST",base_url_front:"https://app.sandbox.poplab.education",url_api:"https://app.sandbox.poplab.education/api",url_keycloack:"https://id.sandbox.poplab.education"}},9040:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getBelinPageResponse=t.getBelinToken=t.TypeFichierBelin=void 0;const r=i(4056);var s;function o(){const e=window.localStorage.getItem("edulibToken-undefined");return null!=e?JSON.parse(e).tokens.access_token:null}!function(e){e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.URL="URL",e.HTML="HTML",e.PDF="PDF"}(s||(t.TypeFichierBelin=s={})),t.getBelinToken=o,t.getBelinPageResponse=function(){return n(this,void 0,void 0,(function*(){let e;e=null!=o()?{authorization:"Bearer "+o()}:{"X-Authorization-Issuer":"Edulib"};const t=yield fetch(r.url_belin_api+function(){const e=window.location.href.split("/");return e[e.length-1].split("_")[0]}(),{method:"GET",headers:e});return yield t.json()}))}},8300:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas=void 0,t.Canvas=class{constructor(e,t){this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.ctx=this.canvas.getContext("2d"),this.verifier_taille()}get base64(){return this.canvas.toDataURL("image/png")}ajouter_image(e,t,n){return i(this,void 0,void 0,(function*(){t.x*=window.devicePixelRatio,t.y*=window.devicePixelRatio,t.largeur*=window.devicePixelRatio,t.hauteur*=window.devicePixelRatio,n.x=Math.floor(n.x),n.y=Math.floor(n.y);const i=yield new Promise(((t,i)=>{const n=new Image;n.onload=()=>t(n),n.onerror=i,n.src=e}));this.ctx.drawImage(i,t.x,t.y,t.largeur,t.hauteur,n.x,n.y,n.largeur,n.hauteur)}))}verifier_taille(){if(this.ctx.fillStyle="rgb(0, 100, 0)",this.ctx.fillRect(this.canvas.width-1,this.canvas.height-1,1,1),0==this.ctx.getImageData(this.canvas.width-1,this.canvas.height-1,1,1).data[1])throw new Error(chrome.i18n.getMessage("erreur_taille_element"));this.ctx.clearRect(this.canvas.width-1,this.canvas.height-1,1,1)}}},9270:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureApiCall=void 0;const n=i(1241);class r extends n.Capture{}t.CaptureApiCall=r},8628:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureAvecOverlay=void 0;const n=i(1241);class r extends n.Capture{constructor(e){super(e)}startCapture(){super.startCapture();const e=document.querySelectorAll(this.selector);if(1==e.length)return this.capturer(e[0]);this.afficher_overlay(0,0,0,0)}reinitializeCapture(){super.reinitializeCapture(),this.supprimer_overlay()}afficher_overlay(e,t,i,n){e=Math.round(e),t=Math.round(t),i=Math.round(i),n=Math.round(n);const r=(e,t,i,n,r)=>{let s=document.querySelector("#poplab-overlay-"+e);s||(s=document.createElement("div"),s.id="poplab-overlay-"+e,s.className="poplab-overlay",document.documentElement.appendChild(s)),s.style.top=`${i}px`,s.style.left=`${t}px`,s.style.width=`${n}px`,s.style.height=`${r}px`};document.documentElement.classList.add("poplab-capture-en-cours"),document.onselectstart=()=>!1,document.onmouseover=()=>!1;const s=e+i,o=t+n;r("haut",0,0,Math.max(document.documentElement.scrollWidth,window.innerWidth),t),r("gauche",0,t,e,n),r("droite",s,t,Math.max(document.documentElement.scrollWidth-s,window.innerWidth-s),n),r("bas",0,o,Math.max(document.documentElement.scrollWidth,window.innerWidth),Math.max(document.documentElement.scrollHeight-o,window.innerHeight-o));let a=document.querySelector(".poplab-auto-overlay");a||(a=document.createElement("div"),a.className="poplab-auto-overlay",document.documentElement.appendChild(a)),a.style.top=`${Math.round(t)}px`,a.style.left=`${Math.round(e)}px`,a.style.width=`${Math.round(i)}px`,a.style.height=`${Math.round(n)}px`}supprimer_overlay(){const e=document.querySelectorAll(".poplab-overlay");for(const t of e)document.documentElement.removeChild(t);const t=document.querySelector(".poplab-auto-overlay");t&&document.documentElement.removeChild(t),document.documentElement.classList.remove("poplab-capture-en-cours"),document.onselectstart=()=>!0,document.onmouseover=()=>!0}trouver_element(e,t){const i=document.querySelectorAll(this.selector);for(const n of i){const i=n.getBoundingClientRect();if(!(e<i.left||e>i.right||t<i.top||t>i.bottom))return n}return null}mousemove(e){super.mousemove(e),this.afficher_overlay(0,0,0,0);const t=this.trouver_element(e.clientX,e.clientY);if(!t)return;const i=t.getBoundingClientRect();return this.afficher_overlay(i.left+window.scrollX,i.top+window.scrollY,i.width,i.height),!0}mouseup(e){if(super.mouseup(e),0!=e.button)return this.afficher_overlay(0,0,0,0),!0;const t=this.trouver_element(e.clientX,e.clientY);return t?(this.capturer(t),!0):(this.afficher_overlay(0,0,0,0),!0)}}t.CaptureAvecOverlay=r},1241:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Capture=void 0;const n=i(8033),r=i(2688),s=i(853),o=i(4911);t.Capture=class{constructor(e){this.mediaPreviews=[],this.elementsLength=void 0,this.elementNumber=void 0,this.description="",this.titre="",this.type=r.CaptureType.BASIQUE,this.callback=void 0,this.capture_en_cours=!1,this.listeners=new Map,this.selector=void 0,this.recapturable=!0,this.editable=!0,this.menu=e}startCapture(){this.reinitializeCapture(),this.mediaPreviews=[],this.listeners.set("keydown",this.keydown.bind(this)),this.listeners.set("mousedown",this.mousedown.bind(this)),this.listeners.set("mousemove",this.mousemove.bind(this)),this.listeners.set("mouseup",this.mouseup.bind(this)),this.listeners.forEach(((e,t)=>{document.addEventListener(t,e)})),this.menu.div.style.top="-9999px",this.menu.div.style.right="-9999px",this.capture_en_cours=!0}reinitializeCapture(){this.listeners.forEach(((e,t)=>{document.removeEventListener(t,e)})),this.listeners.clear(),this.menu.div.style.top="10px",this.menu.div.style.right="10px",this.capture_en_cours=!1}capturer(e){this.startCapture(),this.sendCaptureToMenu(new r.ElementCaptureData)}sendCaptureToMenu(e){this.reinitializeCapture(),this.data=e,this.menu.displayCaptureInfos()}sendCaptureToPoplab(e,t){var i,a,l,c,u;if((0,o.clearHighlight)(),this.data instanceof r.ElementCaptureData&&t){this.data.titre=t.titre,this.data.description=t.description,this.data.credit||(this.data.credit=document.URL);const e=[],n=[],r=[],s=[],o=[];null===(i=this.data.images)||void 0===i||i.forEach((i=>{-1!==t.mediasIds.indexOf(i.id)&&e.push(i)})),null===(a=this.data.videos)||void 0===a||a.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&n.push(e)})),null===(l=this.data.audios)||void 0===l||l.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&r.push(e)})),null===(c=this.data.urls)||void 0===c||c.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&s.push(e)})),null===(u=this.data.fichiers)||void 0===u||u.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&o.push(e)})),this.data.images=e,this.data.audios=r,this.data.videos=n,this.data.urls=s,this.data.fichiers=o,this.titre=t.titre,this.description=t.description}this.menu.old_capture=this,browser.runtime.sendMessage(new n.BrowserRuntimeMessageForPoplab(this.data instanceof r.ElementCaptureData?s.PoplabObjectType.ELEMENT:s.PoplabObjectType.DOCUMENT,this.type,this.data,e))}mousedown(e){return!0}mousemove(e){return!0}mouseup(e){return!0}keydown(e){return!0}isEmpty(){var e,t;return!(this.titre||this.description||(null===(e=this.data)||void 0===e?void 0:e.titre)||(null===(t=this.data)||void 0===t?void 0:t.description)||0!==this.mediaPreviews.length)}}},3892:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinCommon=void 0;const n=i(2688),r=i(4056),s=i(4911),o=i(4393),a=i(8286);t.CaptureBelinCommon=class{constructor(e){this.captureBelin=e}transformHandableUrls(e,t){var i,n;const s=t.find((t=>t.content.url===e.url));return e.url.includes("json://")?`${r.url_belin_resources}${null===(i=s.content.downloadPath)||void 0===i?void 0:i.split(".zip")[0]}/index.html`:e.url.includes("astra://")?`${r.url_belin_resources}${null===(n=s.content.downloadPath)||void 0===n?void 0:n.split("/Astra/")[0]}/Astra/pack/${s.id}.html`:e.url.includes("word://")||e.url.includes("pptx://")?`${r.url_belin_resources}${s.content.downloadPath}`:e.url}removeTags(e,t){let i=e;for(const e of t)i=this.removeTag(i,e);return i}removeTag(e,t){const i=`<${t}`;let n=e.indexOf(i);for(;-1!==n;){const r=e.indexOf(">",n),s=e.slice(n,r+1),o=e.slice(0,n),a=e.slice(r+1);if(s.includes("/>"))e=o+a;else{const i=`</${t}>`,n=e.indexOf(i,r);e=-1!==n?o+e.slice(n+i.length):o+a}n=e.indexOf(i)}return e}isGrainComplexe(e,t){if((0,s.hasSameFileTypeMoreThanOnce)(t))return!0;const i=this.getGrainContentSections(e);for(const e of i)if(e.outerHTML.includes("<table"))return!0;return 1!==i.length&&this.hasMoreThanOneText(i)}removeEmptyTags(e){const t=new RegExp(/<(\w+)(\s*[^>]*)> *<\/\1>/g);let i=e.replace(t,"");for(;t.test(i);)i=i.replace(t,"");return i}hasMoreThanOneText(e){let t=0;for(const i of e)if("RESOURCE"!==i.tagName){let e=this.removeTags(i.innerHTML,["media","img","audio","video","resource"]).replace(new RegExp(/\n/g),"").trim();if(e=this.removeEmptyTags(e),e.length>0&&(t++,t>1))break}return t>1}getGrainContentSections(e){const t=(0,a.createElementFromDomParser)(e).querySelector("topic"),i=[];if(t){const e=t.children;for(const t of e){const e=t;"METADATA"!==e.tagName&&"BELIN-TITLE"!==e.tagName&&"SURTITLE"!==e.tagName&&(e.innerHTML=this.removeTag(e.innerHTML,"metadata"),i.push(e))}}return i}createCredit(e,t,i){let n="";e.images[0]&&(n=n.concat(e.images[0].copyright?e.images[0].copyright:"")),e.videos[0]&&(n=n.concat(e.videos[0].copyright?e.videos[0].copyright:"")),e.audios[0]&&(n=n.concat(e.audios[0].copyright?e.audios[0].copyright:""));const r=`<a href="${window.location.href}">${chrome.i18n.getMessage("voir_manuel_max")}</a> (${t} ${i})`;return n=n?`${n} - ${r}`:r,n}putManuelPageLinkInElement(e){var t,i;if(e.type===o.ElementType.ELEMENT){if(1===e.urls.length){const i=e.urls[0];e.description=null===(t=e.description)||void 0===t?void 0:t.concat(`\n<a href="${i.url}">${i.label}</a>`)}e.type===o.ElementType.ELEMENT&&(e.urls=[new n.UrlMediaObject(window.location.href,window.location.href,"",chrome.i18n.getMessage("voir_manuel_max"))])}else if(e.type===o.ElementType.SECTION&&e.description){const t=`<a href="${window.location.href}">${chrome.i18n.getMessage("voir_manuel_max")}</a>`;e.description.endsWith(t)||(e.description=null===(i=e.description)||void 0===i?void 0:i.concat(`\n${t}`))}}createMetaElement(e){const t={manualId:e.manualId,discipline:e.discipline,niveau:e.level,grainId:e.grainId,pageId:e.pageId};return{editeur:o.Editeur.BELIN,origine:window.location.href,additionalInfo:t}}createMetaDocument(e){const t={manualId:e.manualId,discipline:e.discipline,niveau:e.level,grainId:e.grainId,pageId:e.pageId};return{editeur:o.Editeur.BELIN,origine:window.location.href,additionalInfo:t}}setEditeurForMedias(e){e.getMedias().forEach((e=>e.editeur=o.Editeur.BELIN))}handleMathFormulas(e){let t=e;if(null==t?void 0:t.includes("<latex>")){let e;for(;e=t.match(/<latex>(.*?)<\/latex>/);)t=t.replace("<latex>",`<span data-latex='${e[1]}' data-evaluate='no' data-display='no' data-type='inlineMath'>`),t=t.replace("</latex>","</span>")}return t}}},1956:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinGrainComplexeLinkHandler=void 0;const n=i(2688),r=i(1845),s=i(4393),o=i(3892);class a extends o.CaptureBelinCommon{handleLink(e,t,i,s,o){const a=this.getMediaObject(e,t);a.type_fichier===n.TypeFichier.VIDEO?i.videos.push(a):(0,r.parseLinkAsPoplabMediaObject)(i,a,o,e),i.urls.length>0?this.putUrlInNearestExistingElement(i,s):s.push(i),i.description=this.removeTag(i.description||"","a")}getMediaObject(e,t){let i=e.getAttribute("uri");i||(i=e.children[0].getAttribute("uri"));const n=i.split("//")[1],r=t.medias.find((e=>e.id===i||e.url===i||e.id===n));return r.url=this.transformHandableUrls(r,t.grainResources),r}putUrlInNearestExistingElement(e,t){if(e.titre||e.description)t.push(e);else{const i=t.slice().reverse().find((e=>e.type===s.ElementType.ELEMENT&&0===e.urls.length));i?i.urls.push(e.urls[0]):t.push(e)}}}t.CaptureBelinGrainComplexeLinkHandler=a},1454:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinGrainComplexeMediaHandler=void 0;const n=i(2688),r=i(4393);t.CaptureBelinGrainComplexeMediaHandler=class{handleMedia(e,t,i){let s="";const o=e.children;for(const e of o){const t=e;"BELIN-TITLE"!==t.tagName&&(t.id||t.getAttribute("url"))&&(s=t.id||t.getAttribute("url"))}const a=new n.ElementCaptureData;a.type=r.ElementType.ELEMENT,a.description=e.outerHTML;const l=i.find((e=>e.id===s||e.url===s));if(l)switch(l.type_fichier){case n.TypeFichier.IMAGE:a.images.push(l);break;case n.TypeFichier.VIDEO:a.videos.push(l);break;case n.TypeFichier.AUDIO:a.audios.push(l);break;case n.TypeFichier.LIEN:a.urls.push(l)}t.push(a)}}},7956:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinGrainComplexe=void 0;const n=i(2688),r=i(4393),s=i(3892),o=i(4911),a=i(1956),l=i(1454),c=i(1142),u=i(8286);class d extends s.CaptureBelinCommon{constructor(e){super(e),this.linkHandler=new a.CaptureBelinGrainComplexeLinkHandler(e),this.mediaHandler=new l.CaptureBelinGrainComplexeMediaHandler}accept(e){return this.isGrainComplexe(e.grainContent,e.medias)}startCaptureType(e){const t=(new n.DocumentCaptureData).setTitre((0,u.createElementFromDomParser)(e.grainTitle).textContent||this.createDefaultDocumentTitle(e));t.auteurInitial=new c.Auteur(c.AuteurInitial.BELIN),t.elements=[],this.getGrainContentSections(e.grainContent).forEach((i=>{var s;const o=new n.ElementCaptureData;if(o.description=this.removeTags(i.innerHTML,["note","copyright"]).replace(new RegExp(/\n/g),"").replace(new RegExp(/ {2}/g),"").trim(),i.outerHTML.startsWith("<resource")){const n=null===(s=i.querySelector("belin-title"))||void 0===s?void 0:s.innerHTML;i.querySelector("a")?this.linkHandler.handleLink(i.querySelector("a"),e,o,t.elements,n):i.querySelector("media")&&(this.mediaHandler.handleMedia(i.querySelector("media"),t.elements,e.medias),t.elements[t.elements.length-1].titre=n)}else{const i=this.splitSectionCaptureData(o,e);t.elements=t.elements.concat(i),o.type=r.ElementType.SECTION}}));for(let i=1;i<=t.elements.length;i++){const n=t.elements[i],s=t.elements[i-1];s.auteurInitial=new c.Auteur(c.AuteurInitial.BELIN),s.credit=this.createCredit(s,e.discipline,e.level),s.meta=this.createMetaElement(e),s.description&&(s.description=this.removeEmptyTags(s.description),s.description=this.handleMathFormulas(s.description)),this.isElementSectionWithOnlyDescription(n)?s.type===r.ElementType.SECTION&&(s.description+=`<p>${n.description}</p>`,t.elements.splice(i,1),i--):this.isElementSectionAndEmpty(n)&&t.elements.splice(i,1),this.putManuelPageLinkInElement(s),this.setEditeurForMedias(s)}return t.meta=this.createMetaDocument(e),t}removeLastUnclosedTag(e){return e.replace(/<(\w+)(\s*[^>]*)>$/,"")}removeFirstOnlyClosingTag(e){return e.replace(/^<\/(\w+)(\s*[^>]*)>/,"")}isElementSectionWithOnlyDescription(e){return!(!e||e.type!==r.ElementType.SECTION||e.titre||!e.description)}isElementSectionAndEmpty(e){return!(!e||e.type!==r.ElementType.SECTION||e.titre||e.description)}splitSectionCaptureData(e,t){const i=[e];let n=e.description,r=e;const s=[{startTag:"<media",endTag:"</media>"},{startTag:"<img",endTag:""},{startTag:"<audio",endTag:""},{startTag:"<video",endTag:""},{startTag:"<belin-title",endTag:"</belin-title>"}];for(;s.some((e=>-1!==n.indexOf(e.startTag)));){const a=s.map((e=>n.indexOf(e.startTag))),l=a.filter((e=>-1!==e));if(0===l.length)break;const c=Math.min(...l),d=s[a.indexOf(c)],p=n.indexOf(d.startTag);let h;if(h=d.endTag?n.indexOf(d.endTag,p)+d.endTag.length:n.indexOf(">",p)+1,-1===p||-1===h)break;const m=n.substring(p,h),g=(0,o.fromHTML)(m);switch(d.startTag){case"<media":this.mediaHandler.handleMedia(g,i,t.medias);break;case"<img":case"<audio":case"<video":{const e=document.createElement("media");e.append(g),this.mediaHandler.handleMedia(e,i,t.medias);break}case"<belin-title":e.titre=(0,u.createElementFromDomParser)(g.textContent).textContent}n=this.removeTagFromSectionContent(r,n,i,p,h,s.map((e=>e.startTag))),r=i[i.length-1]}return i}removeTagFromSectionContent(e,t,i,s,o,a){e.description=this.removeLastUnclosedTag(t.substring(0,s));const l=t.indexOf(">")+1;let c=t.substring(0,l);a.some((e=>c.startsWith(e)))&&(c="");const u=this.removeFirstOnlyClosingTag(t.substring(o)).trim();t=u&&!u.startsWith(c)?c+this.removeFirstOnlyClosingTag(t.substring(o)):u;const d=(new n.ElementCaptureData).setDescription(t).setType(r.ElementType.SECTION);return i.push(d),t}createDefaultDocumentTitle(e){return`${(0,u.createElementFromDomParser)(e.pageTitle).textContent} (${e.discipline} ${e.level} p.${e.startPage}-${e.endPage})`}}t.CaptureBelinGrainComplexe=d},315:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinGrainSimple=void 0;const n=i(2688),r=i(3892),s=i(1142);class o extends r.CaptureBelinCommon{constructor(e){super(e)}accept(e){return!0}startCaptureType(e){this.captureBelin.titre=e.grainTitle.trim();const t=new n.ElementCaptureData;t.titre=this.captureBelin.titre;const i=this.getGrainContentSections(e.grainContent);return t.description="",i.forEach((i=>{"RESOURCE"===i.tagName&&i.innerHTML.includes("<a")?this.handleGrainSimpleLink(e,i):t.description+=i.innerHTML})),t.description=this.handleMathFormulas(t.description),t.description=this.cleanupContent(t.description),t.images=e.medias.filter((e=>e.type_fichier===n.TypeFichier.IMAGE)),t.videos=e.medias.filter((e=>e.type_fichier===n.TypeFichier.VIDEO)),t.audios=e.medias.filter((e=>e.type_fichier===n.TypeFichier.AUDIO)),t.urls=e.medias.filter((e=>e.type_fichier===n.TypeFichier.LIEN)),t.exerciseurs=e.medias.filter((e=>e.type_fichier===n.TypeFichier.EXERCISEUR)),t.fichiers=e.medias.filter((e=>e.type_fichier===n.TypeFichier.FICHIER)),this.setEditeurForMedias(t),t.auteurInitial=new s.Auteur(s.AuteurInitial.BELIN),this.putManuelPageLinkInElement(t),this.captureBelin.mediaPreviews=t.getAllEmbeds(),this.captureBelin.description=t.description,t.credit=this.createCredit(t,e.discipline,e.level),t.meta=this.createMetaElement(e),t}handleGrainSimpleLink(e,t){var i;const r=e.medias.find((e=>e.type_fichier===n.TypeFichier.LIEN));if(r){for(const e of t.children)"BELIN-TITLE"===e.tagName&&(r.label=e.textContent);r.label||(r.label=null===(i=t.textContent)||void 0===i?void 0:i.trim()),r.url=this.transformHandableUrls(r,e.grainResources),r.url.includes("https://")||r.url.includes("http://")||(e.medias=e.medias.filter((e=>e.type_fichier!==n.TypeFichier.LIEN)))}}cleanupContent(e){return e=this.removeTag(e,"image"),e=this.removeTag(e,"note"),e=this.removeTag(e,"copyright"),e=this.removeTag(e,"video"),e=this.removeTag(e,"metadata"),(e=(e=this.removeTag(e,"resource")).replace(new RegExp(/belin-title/g),"p")).replace(new RegExp(/\n/g),"")}}t.CaptureBelinGrainSimple=o},1845:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseLinkAsPoplabMediaObject=void 0,t.parseLinkAsPoplabMediaObject=function(e,t,s,o){const a=[new i,new r,new n];for(const i of a)if(i.accept(t.url)){i.processLink(e,t,s,o);break}};class i{accept(e){return e.startsWith("html://")}processLink(e,t){e.exerciseurs.push(t)}}class n{accept(e){return e.startsWith("pdf://")}processLink(e,t,i,n){t.label=i,e.fichiers.push(t)}}class r{accept(e){return e.startsWith("https://")||e.startsWith("http://")}processLink(e,t,i,n){n.textContent?t.label=n.textContent.trim():t.label=i,e.urls.push(t)}}},8286:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createElementFromDomParser=t.sanitize=void 0;const n=i(4056);function r(e,t){for(let i=e.length-1;i>=0;i--){const n=e[i],r=document.createElement(t);r.innerHTML=n.innerHTML,Array.from(n.attributes).forEach((e=>{r.setAttribute(e.name,e.value)})),n.replaceWith(r)}}function s(e){return e=e.replace(/<title>/g,"<belin-title>").replace(/<\/title>/g,"</belin-title>"),(new DOMParser).parseFromString(`<body>${e}</body>`,"text/html").body}t.sanitize=function(e,t){return function(e){const t=s(e);return r(t.querySelectorAll('[style="ordered"]'),"ol"),t.querySelectorAll("ol").forEach((e=>{const t=e.getAttribute("start");if(t){const i=parseInt(t,10)-1;e.style.counterReset="item "+i}})),r(t.querySelectorAll("list"),"ul"),r(t.querySelectorAll("item"),"li"),r(t.querySelectorAll("emphasis"),"i"),t.innerHTML}(e=function(e){const t=s(e);return t.querySelectorAll('[for="teacher"]').forEach((e=>{e.remove()})),t.innerHTML}(e=function(e,t,i){return e=(e=(e=e.replace(new RegExp(/<link/g),"<a")).replace(new RegExp(/<\/link>/g),"</a>")).replace(new RegExp(/uri="topic:\/\//g),`href="${n.url_belin}${t.toLowerCase()}-${i.toLowerCase()}/topics/`)}(e,t.discipline,t.level)))},t.createElementFromDomParser=s},4143:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureBelinAPI=void 0;const r=i(4056),s=i(9040),o=i(2688),a=i(4393),l=i(4911),c=i(9270),u=i(315),d=i(7956),p=i(8286);class h extends c.CaptureApiCall{constructor(e,t){super(e),this.type=o.CaptureType.UPLOAD,this.elementNumber=t,this.recapturable=!1,this.editable=!1,this.captureTypes=[new d.CaptureBelinGrainComplexe(this),new u.CaptureBelinGrainSimple(this)]}startCapture(){return n(this,void 0,void 0,(function*(){this.mediaPreviews=[];const e=yield this.getWantedGrain();if(null!=e)for(const t of this.captureTypes){const i=t;if(i.accept(e)){const t=i.startCaptureType(e);this.sendCaptureToMenu(t);break}}else this.reinitializeCapture()}))}getWantedGrain(){return n(this,void 0,void 0,(function*(){this.apiResponse||(this.apiResponse=yield(0,s.getBelinPageResponse)());const e=this.apiResponse.children;this.elementsLength=e.length;const t=e[this.elementNumber];(0,l.smoothScrollToTargetedHtmlElement)(t.id,118);const i=(0,p.sanitize)(t.content,this.apiResponse),n=[];let a=[];t.resources.length>0&&(a=yield this.processMedias(t,n));for(const e of this.processLinks(i))r.handledVideosPlatform.some((t=>e.includes(t)))?n.push(new o.VideoMediaObject(e,e)):n.push(new o.UrlMediaObject(e,e));return{grainContent:i,grainTitle:t.title,grainResources:a,medias:n,pageTitle:this.apiResponse.title,startPage:this.apiResponse.startPage,endPage:this.apiResponse.endPage,discipline:this.apiResponse.discipline,level:this.apiResponse.level,manualId:this.apiResponse.manualId,grainId:t.id,pageId:this.apiResponse.id}}))}getUrlOfResource(e){var t,i;return e.type===s.TypeFichierBelin.HTML?r.url_belin_resources+(null===(t=e.content.downloadPath)||void 0===t?void 0:t.split(".")[0])+"/index.html":null!==(i=e.content.url)&&void 0!==i?i:r.url_belin_resources+e.content.downloadPath}processMedias(e,t){return n(this,void 0,void 0,(function*(){const i=e.resources,n=[];for(const e of i){const t=e;t.type===s.TypeFichierBelin.IMAGE&&2===t.id.split("_").length||n.push({id:t.id,type:t.type,forTeacher:t.forTeacher,content:{url:this.getUrlOfResource(t),downloadPath:t.content.downloadPath,copyright:t.content.copyright,parentCopyright:t.content.parentCopyright}})}for(const e of n)e.type===s.TypeFichierBelin.HTML?t.push(new o.ExerciseurMediaObject(e.id,e.content.url,a.ExerciseurType.BELIN)):e.type===s.TypeFichierBelin.PDF?t.push(new o.FichierMediaObject(e.id,e.content.url,yield this.transformMediaIntoBase64(e.content.url,e.type,e.content.downloadPath),e.type)):t.push(new o.MediaObject(e.id,e.content.url,this.buildTypeFichier(e.type),this.buildCopyright(e.content.copyright,e.content.parentCopyright),yield this.transformMediaIntoBase64(e.content.url,e.type,e.content.downloadPath)));return n}))}processLinks(e){const t=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("resource"),i=[];return t.forEach((e=>{const t=e.querySelector("a");if(t){const e=t.getAttribute("uri");e.startsWith("http")&&i.push(e)}})),i}buildCopyright(e,t){return`${null!=e?e:""}${t?" - "+t:""}`}transformMediaIntoBase64(e,t,i){return n(this,void 0,void 0,(function*(){let n;if(e.includes(r.url_belin_resources))n=e;else{if(!i)return;{const e=yield fetch(`${r.url_belin_api_resources}?key=${i}`,{});n=(yield e.json()).location}}const o=yield fetch(n,{method:"GET",headers:{"Cache-Control":"no-cache","Access-Control-Allow-Origin":"*"}}),a=yield o.blob();if(t===s.TypeFichierBelin.IMAGE){const e=yield this.blobToImage(a);if(e.width*e.height>r.maxResolution)return}return yield this.blobToBase64(a)}))}blobToImage(e){return new Promise(((t,i)=>{const n=URL.createObjectURL(e),r=new Image;r.onload=()=>{URL.revokeObjectURL(n),t(r)},r.onerror=i,r.src=n}))}blobToBase64(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{const n=new FileReader;n.onload=()=>{const e=n.result;t(e)},n.onerror=i,n.readAsDataURL(e)}))}))}buildTypeFichier(e){switch(e){case s.TypeFichierBelin.IMAGE:return o.TypeFichier.IMAGE;case s.TypeFichierBelin.AUDIO:return o.TypeFichier.AUDIO;case s.TypeFichierBelin.VIDEO:return o.TypeFichier.VIDEO;case s.TypeFichierBelin.PDF:return o.TypeFichier.FICHIER;case s.TypeFichierBelin.HTML:return o.TypeFichier.EXERCISEUR;case s.TypeFichierBelin.URL:default:return o.TypeFichier.LIEN}}}t.CaptureBelinAPI=h},3719:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureImage=void 0;const n=i(8628),r=i(2688);class s extends n.CaptureAvecOverlay{constructor(e){super(e),this.type=r.CaptureType.BASIQUE,this.selector="img"}capturer(e){let t=e.src;0==t.indexOf("/")&&(t=document.location.origin+t),this.titre=e.title||e.alt||document.title,this.mediaPreviews.push(new r.ImageMediaObject("image",t)),this.sendCaptureToMenu((new r.ElementCaptureData).setImages([new r.ImageMediaObject("image",t)]))}}t.CaptureImage=s},7610:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureLien=void 0;const n=i(2688),r=i(1241);class s extends r.Capture{constructor(e){super(e),this.type=n.CaptureType.BASIQUE,this.selector="a",this.recapturable=!1}capturer(e){this.titre=e.title||document.title;const t=document.querySelector('meta[name="description"]');t&&(this.description=t.content),this.mediaPreviews=[new n.UrlMediaObject(e.href,e.href)],this.sendCaptureToMenu((new n.ElementCaptureData).setUrls([new n.UrlMediaObject(e.href,e.href)]))}startCapture(){this.titre=document.title;const e=document.querySelector('meta[name="description"]');e&&(this.description=e.content),this.mediaPreviews=[new n.UrlMediaObject(document.URL,document.URL)],this.sendCaptureToMenu((new n.ElementCaptureData).setUrls([new n.UrlMediaObject(document.URL,document.URL)]))}}t.CaptureLien=s},2181:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureVideo=void 0;const n=i(8628),r=i(2688);class s extends n.CaptureAvecOverlay{constructor(e){super(e),this.type=r.CaptureType.BASIQUE,this.selector="video"}capturer(e){this.titre=e.title,""==this.titre&&(this.titre=document.title),this.mediaPreviews.push(new r.VideoMediaObject("video",e.currentSrc)),this.sendCaptureToMenu((new r.ElementCaptureData).setVideos([new r.VideoMediaObject("video",e.currentSrc)]))}}t.CaptureVideo=s},1443:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureYoutube=void 0;const n=i(2688),r=i(1241);class s extends r.Capture{constructor(e){super(e),this.type=n.CaptureType.BASIQUE,this.recapturable=!1}startCapture(){super.startCapture(),this.titre=document.title.substring(0,document.title.length-10),this.mediaPreviews=[new n.VideoMediaObject(document.URL,this.getYoutubeVideoEmbedUrl(document.URL))],this.sendCaptureToMenu((new n.ElementCaptureData).setVideos([new n.VideoMediaObject(document.URL,document.URL)]))}getYoutubeVideoEmbedUrl(e){let t=e.split("v=")[1];const i=e.indexOf("&");return-1!==i&&(t=t.substring(0,i)),"https://www.youtube.com/embed/"+t}}t.CaptureYoutube=s},7200:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureZone=void 0;const r=i(8033),s=i(2688),o=i(8628),a=i(8300),l=i(4056);class c extends o.CaptureAvecOverlay{constructor(e){super(e),this.init_taille_scrollbar(),this.type=s.CaptureType.UPLOAD,this.selector="*",this.isCapturingZone=!1}startCapture(){super.startCapture(),this.position_initiale=void 0}init_taille_scrollbar(){const e=document.createElement("div");e.id="poplab-scroll-test";const t=document.createElement("div");t.style.height="100px",e.appendChild(t),document.body.appendChild(e),this.hauteur_scrollbar=Math.round(e.offsetHeight-t.offsetHeight),this.largeur_scrollbar=Math.round(e.offsetWidth-t.offsetWidth),document.body.removeChild(e)}get largeur_fenetre(){return document.documentElement.clientHeight==document.documentElement.scrollHeight?window.innerWidth:window.innerWidth-this.largeur_scrollbar}get hauteur_fenetre(){return document.documentElement.clientWidth==document.documentElement.scrollWidth?window.innerHeight:window.innerHeight-this.hauteur_scrollbar}smart_scroll(e,t){e=Math.min(e,document.documentElement.scrollWidth-this.largeur_fenetre),t=Math.min(t,document.documentElement.scrollHeight-this.hauteur_fenetre),e=Math.max(e,0),t=Math.max(t,0);const i=document.createElement("div");return i.id="poplab-fakescreen",i.style.top=`${t}px`,i.style.left=`${e}px`,i.style.width=`${this.largeur_fenetre}px`,i.style.height=`${this.hauteur_fenetre}px`,document.documentElement.appendChild(i),new Promise(((n,r)=>{const s=setInterval((()=>window.scrollTo(e,t)),100);new IntersectionObserver((([e])=>{e.isIntersecting&&(clearInterval(s),document.documentElement.removeChild(i),n())})).observe(i),window.scrollTo(e,t)}))}capturer_zone(e,t,i,o){return n(this,void 0,void 0,(function*(){this.isCapturingZone=!0,e=Math.round(e),t=Math.round(t),i=Math.min(document.documentElement.scrollWidth-e,Math.round(i)),o=Math.min(document.documentElement.scrollHeight-t,Math.round(o));const n=window.scrollX,c=window.scrollY;if(window.innerHeight<=500)return void window.alert(chrome.i18n.getMessage("fenetre_trop_petite"));if(i*o>l.maxResolution)return window.alert(chrome.i18n.getMessage("image_trop_grande")),void this.reinitializeCapture();const u=new a.Canvas(i,o);let d=0;this.supprimer_overlay(),yield new Promise(((e,t)=>window.requestAnimationFrame(e))),yield new Promise(((e,t)=>window.requestAnimationFrame(e)));e:for(;d<o;){const n=Math.min(250,t+d);let s=0;for(let a=0;a<i;a+=this.largeur_fenetre){yield this.smart_scroll(e+a,t+d-n);const l=e+a-window.scrollX,c=t+d-window.scrollY,p=Math.min(this.largeur_fenetre-l,i-a);if(0==a&&(s=Math.min(this.hauteur_fenetre-c,o-d),t+d+s+250<document.documentElement.scrollHeight&&(s-=250),s<=0&&(s=o-d)),s<=0||p<=0){console.error("Houlà ! On ne peut pas prendre de screenshot avec hauteur",s,"et largeur",p,": on suppose que la capture est terminée."),console.info({x:e,y:t,scrollX:window.scrollX,scrollY:window.scrollY,largeur:i,largeur_capturee:a,hauteur:o,hauteur_capturee:d});break e}window.chrome&&(yield new Promise(((e,t)=>setTimeout(e,500))));const h=yield browser.runtime.sendMessage(new r.BrowserRuntimeMessage(r.BrowserRuntimeMessageEventType.CAPTURE_TAB));yield u.ajouter_image(h,{x:l,y:c,largeur:p,hauteur:s},{x:a,y:d,largeur:p,hauteur:s})}d+=s}window.scrollTo(n,c),this.titre=document.title,this.fichier=u.base64;const p="webclipper-zone-"+self.crypto.randomUUID();return this.mediaPreviews.push(new s.ImageMediaObject(p,u.base64)),this.isCapturingZone=!1,this.sendCaptureToMenu((new s.ElementCaptureData).setImages([new s.ImageMediaObject(p,"",void 0,u.base64)]))}))}mousedown(e){if(this.isCapturingZone)return!0;if(0==e.button){const t=e.clientX+window.scrollX,i=e.clientY+window.scrollY;this.position_initiale={x:t,y:i},this.afficher_overlay(t,i,0,0)}return!0}mousemove(e){if(this.isCapturingZone)return!0;if(null==this.position_initiale){this.afficher_overlay(0,0,0,0);const t=document.elementFromPoint(e.clientX,e.clientY);if(t){const e=t.getBoundingClientRect();this.afficher_overlay(e.left+window.scrollX,e.top+window.scrollY,e.width,e.height)}}else{const t=Math.min(e.clientX+window.scrollX,this.position_initiale.x),i=Math.min(e.clientY+window.scrollY,this.position_initiale.y);this.afficher_overlay(t,i,Math.max(e.clientX+window.scrollX,this.position_initiale.x)-t,Math.max(e.clientY+window.scrollY,this.position_initiale.y)-i)}}mouseup(e){if(this.isCapturingZone)return!0;if(0!=e.button)return this.reinitializeCapture(),this.startCapture(),!0;if(Math.abs(e.clientX+window.scrollX-this.position_initiale.x)<5||Math.abs(e.clientY+window.scrollY-this.position_initiale.y)<5){this.position_initiale=void 0,this.afficher_overlay(0,0,0,0);const t=document.elementFromPoint(e.clientX,e.clientY);if(t){const e=t.getBoundingClientRect();this.capturer_zone(e.x+window.scrollX,e.y+window.scrollY,e.width,e.height)}}else{const t=Math.min(e.clientX+window.scrollX,this.position_initiale.x),i=Math.min(e.clientY+window.scrollY,this.position_initiale.y),n=Math.max(e.clientX+window.scrollX,this.position_initiale.x)-t,r=Math.max(e.clientY+window.scrollY,this.position_initiale.y)-i;this.capturer_zone(t,i,n,r)}}}t.CaptureZone=c},4911:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fromHTML=t.clearHighlight=t.smoothScrollToTargetedHtmlElement=t.hasSameFileTypeMoreThanOnce=t.getCountPerFileType=void 0;const n=i(2688);function r(e){return Object.entries(e.reduce(((e,t)=>{const i=t.type_fichier;return e[i]=(e[i]||0)+1,e}),{})).map((([e,t])=>({typeFichier:e,count:t})))}t.getCountPerFileType=r,t.hasSameFileTypeMoreThanOnce=function(e){const t=r(e);return t.filter((e=>e.count>1)).length>0||2===t.filter((e=>e.typeFichier===n.TypeFichier.IMAGE||e.typeFichier===n.TypeFichier.VIDEO)).length};t.smoothScrollToTargetedHtmlElement=function(e,t=0){const i=document.querySelector(`#${e}`);if(i){const e=function(e){let t=e.parentElement;for(;t;){const e=window.getComputedStyle(t);if("auto"===e.overflowY||"scroll"===e.overflowY)return t;t=t.parentElement}return null}(i);if(e){let n=i.getBoundingClientRect().top+e.scrollTop-t;n>e.scrollHeight-e.getBoundingClientRect().height&&(n=e.scrollHeight-e.getBoundingClientRect().height),a(Math.floor(n),e).then((()=>o(i)))}else{let e=i.getBoundingClientRect().top+window.scrollY-t;const n=function(){const e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)-window.innerHeight-40}();e>n&&(e=n),a(Math.floor(e)).then((()=>o(i)))}}};let s=null;function o(e){s&&s.classList.remove("poplab-highlighted"),s=e;let t=document.getElementById("poplab-highlight-stylesheet");t||(t=document.createElement("style"),t.id="poplab-highlight-stylesheet",t.textContent="\n        .poplab-highlighted {\n            border: solid 8px rgb(75, 198, 185);\n        }",document.head.appendChild(t)),setTimeout((()=>{e.classList.add("poplab-highlighted")}),100)}function a(e,t){return t?t.scrollTo({top:e,behavior:"smooth"}):window.scrollTo({top:e,behavior:"smooth"}),new Promise((i=>{const n=()=>{t?Math.floor(t.scrollTop)!==e&&Math.ceil(t.scrollTop)!==e||(t.removeEventListener("scroll",n),i()):Math.floor(window.scrollY)!==e&&Math.ceil(window.scrollY)!==e||(window.removeEventListener("scroll",n),i())};t?(t.removeEventListener("scroll",n),Math.floor(t.scrollTop)===e||Math.ceil(t.scrollTop)===e?i():t.addEventListener("scroll",n)):(window.removeEventListener("scroll",n),Math.floor(window.scrollY)===e||Math.ceil(window.scrollY)===e?i():window.addEventListener("scroll",n))}))}t.clearHighlight=function(){var e;const t=document.getElementById("poplab-highlight-stylesheet");t&&(null===(e=t.parentNode)||void 0===e||e.removeChild(t))},t.fromHTML=function(e){if(!e)return null;const t=document.createElement("template");t.innerHTML=e;const i=t.content.children;return 1===i.length?i[0]:i}},2688:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentCaptureData=t.ElementCaptureData=t.CaptureData=t.FichierMediaObject=t.ExerciseurMediaObject=t.UrlMediaObject=t.AudioMediaObject=t.VideoMediaObject=t.ImageMediaObject=t.MediaObject=t.TypeFichier=t.CaptureType=void 0;const n=i(4393);var r,s;!function(e){e.BASIQUE="BASIQUE",e.UPLOAD="UPLOAD"}(r||(t.CaptureType=r={})),function(e){e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.FICHIER="FICHIER",e.LIEN="LIEN",e.EXERCISEUR="EXERCISEUR"}(s||(t.TypeFichier=s={}));class o{constructor(e,t,i,n,r,s,o){this.id=e,this.url=t,this.type_fichier=i,this.copyright=n,this.file=r,this.editeur=s,this.subTypeFichier=o}}t.MediaObject=o,t.ImageMediaObject=class extends o{constructor(e,t,i,n,r){super(e,t,s.IMAGE,i,n,r)}},t.VideoMediaObject=class extends o{constructor(e,t,i,n,r){super(e,t,s.VIDEO,i,n,r)}},t.AudioMediaObject=class extends o{constructor(e,t,i,n,r){super(e,t,s.AUDIO,i,n,r)}},t.UrlMediaObject=class extends o{constructor(e,t,i,n){super(e,t,s.LIEN,i),this.displayPreview=!1,this.bigPreview=!1,this.label=n}},t.ExerciseurMediaObject=class extends o{constructor(e,t,i){super(e,t,s.EXERCISEUR),this.typeExerciseur=i}},t.FichierMediaObject=class extends o{constructor(e,t,i,n,r){super(e,t,s.FICHIER,void 0,i,void 0,n),this.label=r}};class a{constructor(e,t,i){this.titre=e,this.description=t,this.auteurInitial=i}}t.CaptureData=a;class l extends a{constructor(e){var t,i,r,s,o,a,l;super(null==e?void 0:e.titre,null==e?void 0:e.description,null==e?void 0:e.auteurInitial),this.type=n.ElementType.ELEMENT,this.images=[],this.videos=[],this.audios=[],this.urls=[],this.exerciseurs=[],this.fichiers=[],this.credit=null==e?void 0:e.credit,this.images=null!==(t=null==e?void 0:e.images)&&void 0!==t?t:[],this.videos=null!==(i=null==e?void 0:e.videos)&&void 0!==i?i:[],this.audios=null!==(r=null==e?void 0:e.audios)&&void 0!==r?r:[],this.urls=null!==(s=null==e?void 0:e.urls)&&void 0!==s?s:[],this.exerciseurs=null!==(o=null==e?void 0:e.exerciseurs)&&void 0!==o?o:[],this.fichiers=null!==(a=null==e?void 0:e.fichiers)&&void 0!==a?a:[],this.type=null!==(l=null==e?void 0:e.type)&&void 0!==l?l:n.ElementType.ELEMENT,this.options=null==e?void 0:e.options,this.meta=null==e?void 0:e.meta}setTitre(e){return this.titre=e,this}setDescription(e){return this.description=e,this}setCredit(e){return this.credit=e,this}setImages(e){return this.images=e,this}setVideos(e){return this.videos=e,this}setAudios(e){return this.audios=e,this}setUrls(e){return this.urls=e,this}setExerciseurs(e){return this.exerciseurs=e,this}setType(e){return this.type=e,this}getMedias(){return this.images.concat(this.videos.concat(this.audios.concat(this.fichiers)))}getAllEmbeds(){return this.getMedias().concat(this.urls).concat(this.exerciseurs)}}t.ElementCaptureData=l,t.DocumentCaptureData=class extends a{constructor(e){super(null==e?void 0:e.titre,null==e?void 0:e.description,null==e?void 0:e.auteurInitial),this.elements=[],null==e||e.elements.forEach((e=>this.elements.push(new l(e)))),this.meta=null==e?void 0:e.meta}setTitre(e){return this.titre=e,this}setDescription(e){return this.description=e,this}setElements(e){return this.elements=e,this}}},8033:(e,t)=>{var i,n,r,s,o;Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserContextMenusId=t.MessageOngletDone=t.MessageOnglet=t.MessageOngletType=t.BrowserRuntimeResponse=t.BrowserRuntimeMessageSearchArborescenceWithSelectionnable=t.BrowserRuntimeMessageSearchArborescence=t.BrowserRuntimeMessageGetRecentArborescenceWithSelectionnable=t.BrowserRuntimeMessageGetRecentArborescence=t.BrowserRuntimeMessageForPoplab=t.BrowserRuntimeMessage=t.BrowserRuntimeMessageEventSubType=t.BrowserRuntimeMessageEventType=void 0,function(e){e.STATUS="status",e.CONNECT="connect",e.ENVOYER_SUR_POPLAB="envoyer_sur_poplab",e.CAPTURE_TAB="captureTab",e.GET_RECENT_ARBORESCENCE="getRecentHierarchies",e.SEARCH_ARBORESCENCE="searchArborescence"}(i||(t.BrowserRuntimeMessageEventType=i={})),function(e){e.WITH_SELECTIONNABLE="WithSelectionnable"}(n||(t.BrowserRuntimeMessageEventSubType=n={}));class a{constructor(e,t,i){this.type=e,this.subType=t,this.idp=i}}t.BrowserRuntimeMessage=a,t.BrowserRuntimeMessageForPoplab=class extends a{constructor(e,t,n,r){super(i.ENVOYER_SUR_POPLAB),this.type_item_poplab=e,this.type_capture=t,this.data=n,this.destination=r}},t.BrowserRuntimeMessageGetRecentArborescence=class extends a{constructor(){super(i.GET_RECENT_ARBORESCENCE)}},t.BrowserRuntimeMessageGetRecentArborescenceWithSelectionnable=class extends a{constructor(){super(i.GET_RECENT_ARBORESCENCE,n.WITH_SELECTIONNABLE)}};class l extends a{constructor(e,t,i){super(t,i),this.value=e}}t.BrowserRuntimeMessageSearchArborescence=class extends l{constructor(e){super(e,i.SEARCH_ARBORESCENCE)}},t.BrowserRuntimeMessageSearchArborescenceWithSelectionnable=class extends l{constructor(e){super(e,i.SEARCH_ARBORESCENCE,n.WITH_SELECTIONNABLE)}},function(e){e.INTERDIT="interdit",e.DECONNECTE="déconnecté",e.CONNECTE="connecté",e.ENVOYE="envoyé"}(r||(t.BrowserRuntimeResponse=r={})),function(e){e.STOP_CAPTURE="stopCapture",e.CAPTURER_LIEN="capturerLien",e.CAPTURER_IMAGE="capturerImage",e.CAPTURER_VIDEO="capturerVideo",e.TOGGLE_CAPTURE="toggleCapture",e.START_CAPTURE="startCapture",e.UPLOAD_FRIGO_DONE="uploadFrigoDone",e.CANCEL_UPLOAD="cancelUpload",e.REFRESH_CAPTURE="refreshCapture"}(s||(t.MessageOngletType=s={}));class c{constructor(e,t,i){this.first_name=void 0,this.provenance=void 0,this.type=e,this.first_name=t,this.provenance=i}}t.MessageOnglet=c,t.MessageOngletDone=class extends c{constructor(e,t){super(e),this.documentId=t}},function(e){e.SE_DECONNECTER="se-deconnecter",e.VOIR_FRIGO="voir-frigo",e.ENVOYER_LIEN="envoyer-lien",e.ENVOYER_IMAGE="envoyer-image",e.ENVOYER_VIDEO="envoyer-video"}(o||(t.BrowserContextMenusId=o={}))},1142:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.AuteurInitial=t.Auteur=void 0,t.Auteur=class{constructor(e,t){this.username=e,this.userId=t}},function(e){e.BELIN="© Belin Éducation / Humensis"}(i||(t.AuteurInitial=i={}))},4393:(e,t)=>{var i,n,r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.Editeur=t.ElementType=t.ExerciseurType=t.PoplabElementCreationRequest=void 0,t.PoplabElementCreationRequest=class{constructor(e,t){var n,s,o;this.titre=null!==(n=e.titre)&&void 0!==n?n:"",this.description=null!==(s=e.description)&&void 0!==s?s:"",this.type=e.type,this.options={isnew:!0,separator:!1},this.type!==r.SECTION||this.titre||(this.options.separator=!0),this.credits=null!==(o=e.credit)&&void 0!==o?o:"",this.webAuteurInitial=e.auteurInitial,this.imageEmbed=e.images[0]?{url:e.images[0].url,type:i.IMAGE}:void 0,this.videoEmbed=e.videos[0]?{url:e.videos[0].url,type:i.VIDEO}:void 0,this.audioEmbed=e.audios[0]?{url:e.audios[0].url,type:i.AUDIO}:void 0,this.lienEmbed=e.urls[0]?{url:e.urls[0].url,label:e.urls[0].label,displayPreview:e.urls[0].displayPreview,bigPreview:e.urls[0].bigPreview,type:i.LIEN}:void 0,this.exerciseur=e.exerciseurs[0]?{url:e.exerciseurs[0].url,exerciseurType:e.exerciseurs[0].typeExerciseur,type:i.EXERCISEUR}:void 0,t&&(this.document=t),this.meta=e.meta}},function(e){e.LIEN="LIEN",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.FICHIER="FICHIER",e.EXERCISEUR="EXERCISEUR"}(i||(i={})),function(e){e.QUIZLET="QUIZLET",e.LEARNINGAPPS="LEARNINGAPPS",e.GENIALLY="GENIALLY",e.BOOKWIDGETS="BOOKWIDGETS",e.EDUPOOL="EDUPOOL",e.BELIN="BELIN"}(n||(t.ExerciseurType=n={})),function(e){e.ELEMENT="element",e.SECTION="section"}(r||(t.ElementType=r={})),function(e){e.BELIN="https://www.belin-education.com/"}(s||(t.Editeur=s={}))},853:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.PoplabObjectType=void 0,function(e){e.ELEMENT="ELEMENT",e.DOCUMENT="DOCUMENT"}(i||(t.PoplabObjectType=i={}))}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}i(7610),i(7200),i(3719),i(1443),i(2181),i(4143),i(4056),i(4911)})();