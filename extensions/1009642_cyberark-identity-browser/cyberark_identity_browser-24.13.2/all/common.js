"undefined"==typeof _idaptiveUniqueGlobal&&(_idaptiveUniqueGlobal={}),function(){var c=this;void 0===c.common&&(c.common={}),void 0===c.log&&(c.log={}),void 0===c.login&&(c.login={}),void 0===c.experimental&&(c.experimental={}),void 0===c.formfill&&(c.formfill={}),void 0===c.ui&&(c.ui={}),void 0===c.landcatch&&(c.landcatch={}),void 0===c.securedItem&&(c.securedItem={}),c.common.objectExtend=function(e,t){if(!e||!t)throw"child or parent is not defined";for(var n in t.prototype)e.prototype[n]||(e.prototype[n]=t.prototype[n])},c.common.combineArray=function(e,t,n){for(var o="",r=0;r<e.length;r++)0!==r&&(o+=t),o+=n?encodeURI(e[r]):e[r];return o},c.common.toSafeString=function(e,t){return encodeURI(e)+": "+encodeURI(t)+"\n"},c.log.LOG_LEVEL={OFF:99999,ERROR:1e3,WARN:900,INFO:800,DEBUG:500,TRACE:300,ON:0},c.log.logPrefix=c.brand.logPrefix,c.common.DefaultValues={debugMode:!1,debugDelay:0},c.common.userDataMatchesExperience=function(e,t){if(e&&t){try{var n=e.replace(/\./g,"+").replace(/\-/g,"/").replace(/_/g,"="),o=atob(n)}catch(e){return!1}e=JSON.parse(o)["Licensed"];if(e)return-1<t.indexOf("idaptive")&&-1<e.indexOf("EF120379-F613-427E-B85D-FE6397444DF9")}return!0},c.common.validateDomain=function(e){e=e.toLowerCase();for(var t=0;t<c.brand.brandAlternativeTenantDomains.length;t+=1){var n=c.brand.brandAlternativeTenantDomains[t];if(-1<e.indexOf(n))return!0}return!1},c.common.domainExistsInCache=function(t){return(async()=>{var e=await c.storage.get(t);return!(!e||(new Date).getTime()>e&&(c.storage.remove(t),1))})()},c.common.setDomainInCache=function(e,t){var n=new Date;c.storage.set(e,n.getTime()+t)},c.common.resolveDomain=function(e,t){c.common.resolveDomainSysInfo(e).then(t).catch(()=>{c.common.resolveDomainDns(e,t)})},c.common.resolveDomainSysInfo=function(o){return new Promise((t,n)=>{c.net.centrifyService.request("https://"+o+"/sysinfo/version",null,e=>c.common.validateDomain(e?.Result?.Name)?(c.common.setDomainInCache(o,864e5),t(!0)):t(!1),e=>{console.log("sysinfo/version request has been failed. Checking for google DNS"),n()},"GET")})},c.common.resolveDomainDns=function(n,o){try{c.net.centrifyService.request("https://dns.google/resolve?name="+encodeURIComponent(n)+"&type=a&do=1",null,e=>{for(i=0;i<e.Answer.length;i+=1){var t=e.Answer[i].data;if(c.common.validateDomain(t))return c.common.setDomainInCache(n,864e5),o(!0)}return o(!1)},e=>(console.log("DNS lookup request has been failed. "+e),o(!1)),"GET")}catch(e){console.log("Could not make the DNS Resolver Call")}},c.common.matchesAlternateTenantDomain=function(o){return(async()=>!(!c.common.validateDomain(o)&&!await c.common.domainExistsInCache(o))||!o.startsWith(".")&&(chrome.cookies?new Promise(n=>{c.cookieUtil.retrieveAllCookies({name:"podloc"},function(e){var t=!1;if(e.length<1)return n(!1);for(i=0;i<e.length;i++)if(o.toLowerCase().endsWith(e[i].domain.toLowerCase())){t=!0;break}return!1===t?n(!1):c.common.resolveDomain(o,n)})}):new Promise(e=>{c.common.resolveDomain(o,e)})))()},c.common.encryption={base64ToArrayBuffer:function(e){for(var t=window.atob(e),n=t.length,o=new Uint8Array(n),r=0;r<n;r++)o[r]=t.charCodeAt(r);return o.buffer},generateE2EKeys:function(){return window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["encrypt","decrypt"]).then(t=>this.exportPublicKey(t.publicKey).then(e=>({publicKey:e,privateKey:t.privateKey})))},ab2str:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},ab2str:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},exportPublicKey:function(e){return window.crypto.subtle.exportKey("spki",e).then(e=>{e=this.ab2str(e);return`-----BEGIN PUBLIC KEY-----
${window.btoa(e)}
-----END PUBLIC KEY-----`})},decryptMessage:function(e,t){return window.crypto.subtle.decrypt({name:"RSA-OAEP"},e,t).then(e=>(new TextDecoder).decode(e)).catch(e=>{console.error("exception = ",e)})},importSymmetricKey:function(e){e=window.atob(e),e=this.str2ab(e);return window.crypto.subtle.importKey("raw",e,{name:"AES-CBC"},!0,["encrypt","decrypt"]).then(function(e){return e}).catch(function(e){console.error(e)})},symmetricDecryptMessage:function(e,n,o){return this.importSymmetricKey(e).then(e=>{var t=window.atob(n),t=this.str2ab(t);return window.crypto.subtle.decrypt({name:"AES-CBC",iv:t},e,o).then(function(e){return(new TextDecoder).decode(e)}).catch(function(e){console.error(e)})})},decryptValueSymmetric:function(t,n,e){var o=this.base64ToArrayBuffer(e);return(async()=>{var e=await this.symmetricDecryptMessage(t,n,o);if(e)return(e=JSON.parse(e)).hasOwnProperty("Password")?e.Password:e})()},decryptCfaResponse:function(e,t){var n;return t&&t.Result&&t.Result.e?(n=this.base64ToArrayBuffer(t.Result.e),this.decryptMessage(e,n).then(e=>(e&&(e=JSON.parse(e))&&(e.hasOwnProperty("Username")&&(t.Result.u=e.Username),e.hasOwnProperty("Password"))&&(t.Result.p=e.Password),t))):Promise.resolve(t)},decryptSecuredItem:function(e,t,n){return t&&t.Result?n===c.constants.names.SECURED_ITEM_PASSWORDS?this.decryptCfaResponse(e,t):n===c.constants.names.SECURED_ITEM_NOTES?this.decryptSecuredNote(e,t):void 0:Promise.resolve(t)},decryptValue:function(t,e){var n;return e?(n=this.base64ToArrayBuffer(e),(async()=>{var e;if(decryptValue=await this.decryptMessage(t,n))return(e=JSON.parse(decryptValue)).hasOwnProperty("Password")?e.Password:e})()):Promise.resolve(e)},decryptSecuredNote:function(n,o){return o&&o.Result&&o.Result.ne?(async()=>{var e=await this.decryptValue(n,o.Result.skey),t=await this.decryptValue(n,o.Result.iv);return o.Result.ne&&(o.Result.n=await this.decryptValueSymmetric(e,t,o.Result.ne)),o})():Promise.resolve(o)},getE2EEncryptionInfo:function(i,a){return new Promise(function(t,n){function e(e){if(e&&e.Result){if(e.Result.PublicKey)return t(e.Result);if(e.Result.EncryptionEnforced)return n()}t()}var o="/uprest/GetE2EEncryptionInfo",r=()=>t();a?i(o,null,"post",e,r):i.centrifyService.request(o,null,e,r,"post")}).then(n=>n?this.importPublicKey(n.PublicKey).then(t=>this.sha256Hash(n.PublicKey).then(e=>({hash:e,key:t,connectorId:n.ConnectorId}))):{})},sha256Hash:function(e){e=(new TextEncoder).encode(e.trim());return crypto.subtle.digest("SHA-256",e).then(e=>Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join(""))},sha1Hash:function(e){e=(new TextEncoder).encode(e.trim());return crypto.subtle.digest("SHA-1",e).then(e=>Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join(""))},str2ab:function(n){var e=new ArrayBuffer(n.length),o=new Uint8Array(e);for(let e=0,t=n.length;e<t;e++)o[e]=n.charCodeAt(e);return e},importPublicKey:function(e){e=e.substring("-----BEGIN PUBLIC KEY-----".length,e.length-"-----END PUBLIC KEY-----".length),e=window.atob(e),e=this.str2ab(e);return window.crypto.subtle.importKey("spki",e,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"])},encryptMessage:function(e,t){t=(new TextEncoder).encode(t);return window.crypto.subtle.encrypt({name:"RSA-OAEP"},e,t)},encryptPasswordInPayload:function(n,e,t){var o,r=null;for(o of["Password","passwordValue"])if(n[o]&&""!==n[o]){r=o;break}return r?this.getE2EEncryptionInfo(e,t).then(t=>t&&t.key?this.encryptMessage(t.key,n[r]).then(e=>{e=this.ab2str(e),e=window.btoa(e);return n[r]=e,n.PublicKeyHash=t.hash,n.ConnectorId=t.connectorId,n}):n):Promise.resolve(n)}},c.common.CentrifyBEBase=function(){},c.common.CentrifyBEBase.prototype={debugMode:c.common.DefaultValues.debugMode,loggerName:"",logLevel:c.log.LOG_LEVEL.INFO,shadowDocArr:[],getTime:function(){var e=new Date,t=(t=e.getHours())<10?"0"+t:t,n=(n=e.getMinutes())<10?"0"+n:n,o=(o=e.getSeconds())<10?"0"+o:o,e=e.getMilliseconds();return t+":"+n+":"+o+"."+(e<100?e<10?"00"+e:"0"+e:e)},querySelector:function(e,t,n){try{return this.querySelectorAll(e,t,!0,n)[0]}catch(e){throw this.log("querySelector: selectors = "+t),e}},querySelectorAll:function(e,t,n,o){var r=[];try{var i=[];"2.1"===o?i.push(...t.split(",")):i.push(t);for(var a=0;a<i.length;a++){var l=i[a],s=[];if(s.push(...this.querySelectorAllShadow(e,l,n)),this.log("Found: "+s.length+" matching elements. Flag findFirst: "+n),0<s.length&&!0===n)return s.slice(0,1);r.push(...s)}return this.log("Found: "+r.length+" matching elements in total. Flag findFirst: "+n),r}catch(e){throw this.log("querySelectorAll: selectors = "+t+e),e}},querySelectorAllShadow:function(e,t,n){var o,r,i,a,l;return t?(o=[],r=function(e,t,n){for(var o=[],r=0;r<e.length;r++)if(o.push(...e[r].querySelectorAll(t)),!0===n)return o.slice(0,1);return o},t.includes(" #shadow-root ")||o.push(...r([e],t,n)),0===o.length&&(this.log("Searching for "+t+" in shadow dom"),a=t.split("#shadow-root"),i=a[0],a=a[1],(l=[]).push(...i&&a?this.getShadowDocs(e).filter(e=>e.host.tagName===i):this.getShadowDocs(e)),this.log("Number of shadow doms to search: "+l.length),o.push(...r(l,a||t,n))),n?o.slice(0,1):o):[]},getShadowDocs:function(e){var o=this,r=function(e){if(e)for(var t=0;t<e.length;t++){var n=e[t];n.shadowRoot&&(o.shadowDocArr.push(n.shadowRoot),r(n.getElementsByTagName("*")))}};return 0===this.shadowDocArr.length&&r(e.getElementsByTagName("*")),this.shadowDocArr},checkProtocol:function(e,t){if(t&&e){var n=new RegExp(/^[^:]*:/),o=e.match(n),n=t.match(n);if(o&&n)return curUrlProtocol=o[0],"https:"===(loginUrlProtocol=n[0])&&"http:"===curUrlProtocol?(this.log("LoginData protocol is https, but current url protocol http, unsecure situatoin, can't login"),!1):(this.log("LoginData protocol="+loginUrlProtocol+" and current url protocol="+curUrlProtocol+", proceed to login"),!0);this.log("can't find protocols in document url: "+e+" or applicationUrl: "+t+", for security reason, skip login")}return this.log("invalid urls: document url="+e+", applicationUrl="+t),!1},toLogger:function(e){console.log(e)},isLogLevelEnabled:function(e){return this.logLevel<=e&&(!!this.debugMode||e>c.log.LOG_LEVEL.INFO)},getLevelString:function(e){return e>=c.log.LOG_LEVEL.OFF?"NOTIC":e>=c.log.LOG_LEVEL.ERROR?"ERROR":e>=c.log.LOG_LEVEL.WARN?"WARN ":e>=c.log.LOG_LEVEL.INFO?"INFO ":e>=c.log.LOG_LEVEL.DEBUG?"DEBUG":"TRACE"},logWithLevel:function(e,t){this.isLogLevelEnabled(e)&&this.logWithEverything(c.log.logPrefix,this.getTime(),this.getLevelString(e),this.loggerName,t)},logWithEverything:function(e,t,n,o,r){this.toLogger(e+" "+t+" "+n+" ["+o+"]: "+r)},logNotice:function(e){this.logWithLevel(c.log.LOG_LEVEL.OFF,e)},logTrace:function(e){this.logWithLevel(c.log.LOG_LEVEL.TRACE,e)},logDebug:function(e){this.logWithLevel(c.log.LOG_LEVEL.DEBUG,e)},log:function(e){this.logWithLevel(c.log.LOG_LEVEL.INFO,e)},logWarn:function(e){this.logWithLevel(c.log.LOG_LEVEL.WARN,e)},logError:function(e){this.logWithLevel(c.log.LOG_LEVEL.ERROR,e)},getMyLogLevel:function(e){var t,n;try{e&&(n=JSON.parse(e)[this.loggerName])&&(t=c.log.LOG_LEVEL[n])}catch(e){this.logWarn("incorrect logging level "+e)}return t=t||c.log.LOG_LEVEL.INFO},readFromLocal:function(e){e(null)},writeToLocal:function(){}},c.login.SchemeEnum={httpHttps:"HttpHttps",httpOnly:"HttpOnly",https:"Https",ftp:"Ftp",basic:"Basic",digest:"Digest",any:"Any"},c.login.LoginOrderEnum={click:"click",newPage:"waitForNewPage",ups:"ups",sleep:"sleep",fill:"fill",submit:"submit",gotoUrl:"goto",fillEnter:"fillEnter",header401:"header401",iframe:"iframe",checkMultiAccountLoginStatus:"checkMultiAccountLoginStatus",captcha:"captcha",fillTotp:"fillTotp"},c.login.Common={initDefaultLoginOrder:function(e){switch(e.scheme){case c.login.SchemeEnum.httpHttps:case c.login.SchemeEnum.httpOnly:case c.login.SchemeEnum.https:case c.login.SchemeEnum.any:e.order=[[c.login.LoginOrderEnum.ups]];break;case c.login.SchemeEnum.ftp:case c.login.SchemeEnum.basic:case c.login.SchemeEnum.digest:e.order=[[c.login.LoginOrderEnum.header401]];break;default:e.order=[[c.login.LoginOrderEnum.ups]]}},setTotpOrder:function(e,t){t=t.isTotpAutoFillConfigValuesEnabled?t.totpAutoFillSleep:5e3;e.order&&0<e.order.length&&e.order.push([c.login.LoginOrderEnum.sleep,t],[c.login.LoginOrderEnum.newPage,{url:e.applicationUrl}],[c.login.LoginOrderEnum.fillTotp])}},c.experimental.EventEnum={login:"cbelogin"},c.experimental.consoleLoginListener=function(e){var e=e.target?e.target.ownerDocument||e.target:document,t=c.experimental.consoleLoginListener.getCbeLoginData(e);t&&t.value?(t=JSON.parse(t.value),c.login.centrifyBELogin.setLoginData(e,t),c.experimental.consoleLoginListener.redirect(e,t)):window.alert("you forget to set cbeLogin")},c.experimental.consoleLoginListener.redirect=function(e,t){c.login.centrifyBELogin.log("redirecting to "+t.applicationUrl),e.location=t.applicationUrl},c.experimental.consoleLoginListener.getCbeLoginData=function(e){return e.getElementById("cbeLogin")},void 0===c.experimental.parameter&&(c.experimental.parameter={}),c.experimental.parameter.KnownParameters={enableConsoleLogin:"enable-console-login"},c.experimental.parameter.isEnable=function(e,t){return!(!e||!t)&&-1!=e.toLowerCase().indexOf(t)},c.formfill.AppFormFillerBase=function(){c.common.CentrifyBEBase.call(this)},c.formfill.AppFormFillerBase.prototype={loggerName:"AppFormFiller",generateLoginDataOrder:function(e){for(var t=c.login.LoginOrderEnum,n=0,o=!1,r=0,i=!0,a=0;a<e.length;a++){var l=e[a][0];l!==t.ups&&l!==t.fill&&l!==t.fillEnter||(o||(n=a,o=!0),r=a,i=l===t.ups)}return i&&e.splice(r+1,e.length),e.splice(0,n),e},generateLoginData:function(t,e,n,o){var r={applicationUrl:t.url,appkey:t.appkey,fields:[{name:"username",pattern:t.usernamePattern,value:e},{name:"password",pattern:t.passwordPattern,value:n}],formPattern:t.formPattern,submitPattern:t.submitPattern,scheme:c.login.SchemeEnum.httpHttps};if(r.version=t.version||"1",r.IsTotpEnabled=t.IsTotpEnabled,t.corpIdPattern&&r.fields.push({name:"corpId",pattern:t.corpIdPattern,value:t.corpId}),o)r.order=[],t.corpIdPattern&&r.order.push(["fill","corpId"]),r.order.push(["fill","username"]),r.order.push(["fill","password"]);else if(t.order)try{for(var i=JSON.parse(t.order),a=0;a<i.length;a++){var l=i[a];if(l&&"iframe"===l[0]){var s=l[1];s&&(r.iframeBlacklist=s["blacklist"],r.iframeWhitelist=s["whitelist"]);break}}r.order=this.generateLoginDataOrder(i)}catch(e){this.logError("Fail on parsing the app order: "+t.order)}else r.order=[[c.login.LoginOrderEnum.ups]];return r},handleResult:function(e,t,n,o){n.success?o(this.generateLoginData(e,n.Result.u,n.Result.p,t),n):(this.logError("Fail on GetCFA. "+JSON.stringify(n)),o(null,n))},formfill:function(n,o,r,i){var a=this;c.common.encryption.generateE2EKeys().then(({publicKey:e,privateKey:t})=>{r.request("/Cbe/GetCFA",{appkey:n.appkey,publicKey:e},function(e){c.common.encryption.decryptCfaResponse(t,e).then(e=>{a.handleResult(n,o,e,i)})},null,"post")})}},c.common.objectExtend(c.formfill.AppFormFillerBase,c.common.CentrifyBEBase),c.landcatch.BehaviorTypesEnum={inputChange:"inputChange",mouseLClick:"mouseLClick",pressEnter:"pressEnter",navigate:"navigate",forceLoginDataValues:"forceLoginDataValues"},c.landcatch.BehaviorFieldsEnum={type:"type",data:"data",sender:"sender",appDetail:"appDetail"}}.call(_idaptiveUniqueGlobal);