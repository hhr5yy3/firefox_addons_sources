globalThis.isChrome=typeof browser>"u";globalThis.browser=globalThis.browser||globalThis.chrome;async function p(){return(await browser.tabs.query({active:!0}))[0]}async function w(e){let o;if(e||(o=await p(),console.log(o),e=o==null?void 0:o.url),!e)return;let n={16:"/icons/16x16.png",32:"/icons/32x32.png",96:"/icons/96x96.png"};(e!=null&&e.includes("ticketmaster.")||e!=null&&e.includes("livenation.")||e!=null&&e.includes("mlb.")||e!=null&&e.includes("axs.")||e!=null&&e.includes("seatgeek.")||e!=null&&e.includes("pay.google."))&&(console.log("UPDATING ICON PATH"),n={16:"/icons/16x16_active.png",32:"/icons/32x32_active.png",96:"/icons/96x96_active.png"}),browser.action.setIcon({path:n})}browser.tabs.onActivated.addListener(async e=>{let n=(await browser.tabs.get(e.tabId)).url;console.log(n),w(n)});browser.tabs.onUpdated.addListener(async(e,o,n)=>{if(n.active&&o.url){let s=o.url;console.log(s),w(s)}});var l=function(e,o,n){if(n||arguments.length===2)for(var s=0,t=o.length,i;s<t;s++)(i||!(s in o))&&(i||(i=Array.prototype.slice.call(o,0,s)),i[s]=o[s]);return e.concat(i||Array.prototype.slice.call(o))},b=function(){function e(o,n,s){this.name=o,this.version=n,this.os=s,this.type="browser"}return e}(),m=function(){function e(o){this.version=o,this.type="node",this.name="node",this.os=process.platform}return e}(),g=function(){function e(o,n,s,t){this.name=o,this.version=n,this.os=s,this.bot=t,this.type="bot-device"}return e}(),h=function(){function e(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return e}(),v=function(){function e(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return e}(),x=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,y=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,d=3,S=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",x]],u=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function A(e){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new v:typeof navigator<"u"?O(navigator.userAgent):T()}function I(e){return e!==""&&S.reduce(function(o,n){var s=n[0],t=n[1];if(o)return o;var i=t.exec(e);return!!i&&[s,i]},!1)}function O(e){var o=I(e);if(!o)return null;var n=o[0],s=o[1];if(n==="searchbot")return new h;var t=s[1]&&s[1].split(".").join("_").split("_").slice(0,3);t?t.length<d&&(t=l(l([],t,!0),W(d-t.length),!0)):t=[];var i=t.join("."),r=k(e),a=y.exec(e);return a&&a[1]?new g(n,i,r,a[1]):new b(n,i,r)}function k(e){for(var o=0,n=u.length;o<n;o++){var s=u[o],t=s[0],i=s[1],r=i.exec(e);if(r)return t}return null}function T(){var e=typeof process<"u"&&process.version;return e?new m(process.version.slice(1)):null}function W(e){for(var o=[],n=0;n<e;n++)o.push("0");return o}let c=()=>{};const B=async e=>{let o=await browser.storage.local.get("installationId");if(o=o.installationId,await browser.storage.local.clear(),o)await browser.storage.local.set({installationId:o}),await browser.cookies.set({url:"https://securemypass.com",name:"installationId",value:o==null?void 0:o.toString(),domain:"securemypass.com"});else{let s=(await browser.cookies.getAll({domain:"securemypass.com"})).find(t=>t.name==="installationId");o=(s==null?void 0:s.value)||""}console.log("installationId",o),console.log("addon installed",e)},M=(e,o,n)=>{};browser.runtime.onInstalled.addListener(B);browser.runtime.onMessage.addListener(M);globalThis.isChrome?chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(e=>console.error(e)):(c=()=>{browser.sidebarAction.open().catch(e=>console.error(e))},browser.action.onClicked.addListener(c));browser.tabs.onUpdated.addListener(async(e,o,n)=>{n.url&&globalThis.isChrome&&await browser.sidePanel.setOptions({tabId:e,path:"sidepanel.html",enabled:!0})});function C(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const o=Math.random()*16|0;return(e==="x"?o:o&3|8).toString(16)})}let E=setInterval(async()=>{try{let e=await browser.storage.local.get(["accessToken"]);const{accessToken:o}=e;if(o){clearInterval(E);let n="chrome";await browser.management.getAll().then(async s=>{for(let i of s)if(i.name==="tix.services"){let r=await fetch("https://securemypass.com/api/v1/misc/report-services-installed",{method:"POST",headers:{"content-type":"Application/JSON",accesstoken:o},body:JSON.stringify({servicesInstalled:!0})});console.log(await r.text())}for(let i of s){const r=A();if(n=r?r.name:"unknown",console.log(`Detected browser type: ${n}`),i.name==="Private Tabs"){n="privateTabs";break}else if(["Advanced Shortcuts","Card","Century View","Cookie Cleaner","Duplicate Multiple Tabs","Insomniac Common","Timers - Advanced","Timers - Basic"].includes(i.name)){n="insomaniac";break}}browser.storage.local.set({browserType:n});let{installationId:t}=await browser.storage.local.get("installationId");if(t)console.log("Existing installation ID:",t);else{const r=(await browser.cookies.getAll({domain:"securemypass.com"})).find(f=>f.name==="installationId"),a=(r==null?void 0:r.value)||"";t=a||C(),await browser.storage.local.set({installationId:t}),a||(await browser.cookies.set({url:"https://securemypass.com",name:"installationId",value:t,domain:"securemypass.com"}),console.log("Generated new installation ID:",t))}try{(await(await fetch("https://securemypass.com/api/v1/misc/activate-session",{method:"POST",headers:{"content-type":"Application/JSON",accesstoken:o},body:JSON.stringify({browserType:n,installationId:t,userAgent:navigator.userAgent,extensions:s.map(a=>a.name).join(",")})})).json()).block&&(await browser.management.uninstallSelf({showConfirmDialog:!1}),globalThis.isChrome?await browser.sidePanel.setOptions({enabled:!1}):(await browser.sidebarAction.close(),browser.action.onClicked.removeListener(c)))}catch(i){console.log(i)}})}}catch(e){console.log(e)}},5e3);browser.runtime.onMessage.addListener((e,o,n)=>{var s;return o.url&&((s=o.url)!=null&&s.includes("sidepanel"))&&browser.runtime.sendMessage(e),!0});
